{"meta":{"version":1,"warehouse":"4.0.0"},"models":{"Asset":[{"_id":"node_modules/hexo-theme-fluid/source/img/avatar.png","path":"img/avatar.png","modified":1,"renderable":1},{"_id":"node_modules/hexo-theme-fluid/source/img/default.png","path":"img/default.png","modified":1,"renderable":1},{"_id":"node_modules/hexo-theme-fluid/source/img/favicon.png","path":"img/favicon.png","modified":1,"renderable":1},{"_id":"node_modules/hexo-theme-fluid/source/img/loading.gif","path":"img/loading.gif","modified":1,"renderable":1},{"_id":"node_modules/hexo-theme-fluid/source/img/police_beian.png","path":"img/police_beian.png","modified":1,"renderable":1},{"_id":"node_modules/hexo-theme-fluid/source/css/gitalk.css","path":"css/gitalk.css","modified":1,"renderable":1},{"_id":"node_modules/hexo-theme-fluid/source/css/main.styl","path":"css/main.styl","modified":1,"renderable":1},{"_id":"node_modules/hexo-theme-fluid/source/xml/local-search.xml","path":"xml/local-search.xml","modified":1,"renderable":1},{"_id":"node_modules/hexo-theme-fluid/source/js/boot.js","path":"js/boot.js","modified":1,"renderable":1},{"_id":"node_modules/hexo-theme-fluid/source/js/color-schema.js","path":"js/color-schema.js","modified":1,"renderable":1},{"_id":"node_modules/hexo-theme-fluid/source/js/events.js","path":"js/events.js","modified":1,"renderable":1},{"_id":"node_modules/hexo-theme-fluid/source/js/img-lazyload.js","path":"js/img-lazyload.js","modified":1,"renderable":1},{"_id":"node_modules/hexo-theme-fluid/source/js/leancloud.js","path":"js/leancloud.js","modified":1,"renderable":1},{"_id":"node_modules/hexo-theme-fluid/source/js/local-search.js","path":"js/local-search.js","modified":1,"renderable":1},{"_id":"node_modules/hexo-theme-fluid/source/js/plugins.js","path":"js/plugins.js","modified":1,"renderable":1},{"_id":"node_modules/hexo-theme-fluid/source/js/utils.js","path":"js/utils.js","modified":1,"renderable":1},{"_id":"source/img/api-user.png","path":"img/api-user.png","modified":1,"renderable":0},{"_id":"source/img/api-userinfo.png","path":"img/api-userinfo.png","modified":1,"renderable":0},{"_id":"source/img/ast.jpg","path":"img/ast.jpg","modified":1,"renderable":0},{"_id":"source/img/avatar.jpg","path":"img/avatar.jpg","modified":1,"renderable":0},{"_id":"source/img/babel.jpg","path":"img/babel.jpg","modified":1,"renderable":0},{"_id":"source/img/backend.jpg","path":"img/backend.jpg","modified":1,"renderable":0},{"_id":"source/img/chicken.jpg","path":"img/chicken.jpg","modified":1,"renderable":0},{"_id":"source/img/city.jpg","path":"img/city.jpg","modified":1,"renderable":0},{"_id":"source/img/elem-plus-official.png","path":"img/elem-plus-official.png","modified":1,"renderable":0},{"_id":"source/img/event loop.jpg","path":"img/event loop.jpg","modified":1,"renderable":0},{"_id":"source/img/firewall.png","path":"img/firewall.png","modified":1,"renderable":0},{"_id":"source/img/general2.png","path":"img/general2.png","modified":1,"renderable":0},{"_id":"source/img/god.jpg","path":"img/god.jpg","modified":1,"renderable":0},{"_id":"source/img/home.jpg","path":"img/home.jpg","modified":1,"renderable":0},{"_id":"source/img/icon.png","path":"img/icon.png","modified":1,"renderable":0},{"_id":"source/img/import-scss-error.png","path":"img/import-scss-error.png","modified":1,"renderable":0},{"_id":"source/img/js.jpg","path":"img/js.jpg","modified":1,"renderable":0},{"_id":"source/img/layout-base.png","path":"img/layout-base.png","modified":1,"renderable":0},{"_id":"source/img/layout-result.png","path":"img/layout-result.png","modified":1,"renderable":0},{"_id":"source/img/layout.png","path":"img/layout.png","modified":1,"renderable":0},{"_id":"source/img/login.png","path":"img/login.png","modified":1,"renderable":0},{"_id":"source/img/mao.jpg","path":"img/mao.jpg","modified":1,"renderable":0},{"_id":"source/img/menu.png","path":"img/menu.png","modified":1,"renderable":0},{"_id":"source/img/micro-app.png","path":"img/micro-app.png","modified":1,"renderable":0},{"_id":"source/img/modules.jpg","path":"img/modules.jpg","modified":1,"renderable":0},{"_id":"source/img/nginx.png","path":"img/nginx.png","modified":1,"renderable":0},{"_id":"source/img/node-res.png","path":"img/node-res.png","modified":1,"renderable":0},{"_id":"source/img/nodejs.png","path":"img/nodejs.png","modified":1,"renderable":0},{"_id":"source/img/primary.png","path":"img/primary.png","modified":1,"renderable":0},{"_id":"source/img/qiankun.png","path":"img/qiankun.png","modified":1,"renderable":0},{"_id":"source/img/react-v16.gif","path":"img/react-v16.gif","modified":1,"renderable":0},{"_id":"source/img/react-v17.gif","path":"img/react-v17.gif","modified":1,"renderable":0},{"_id":"source/img/render-10w-data.jpg","path":"img/render-10w-data.jpg","modified":1,"renderable":0},{"_id":"source/img/svg-sprite-result.png","path":"img/svg-sprite-result.png","modified":1,"renderable":0},{"_id":"source/img/svg-sprite.png","path":"img/svg-sprite.png","modified":1,"renderable":0},{"_id":"source/img/theme-select.png","path":"img/theme-select.png","modified":1,"renderable":0},{"_id":"source/img/theme.png","path":"img/theme.png","modified":1,"renderable":0},{"_id":"source/img/ts.jpg","path":"img/ts.jpg","modified":1,"renderable":0},{"_id":"source/img/vue-logo.png","path":"img/vue-logo.png","modified":1,"renderable":0},{"_id":"source/img/vue3.jpg","path":"img/vue3.jpg","modified":1,"renderable":0},{"_id":"source/img/web3-week1.jpg","path":"img/web3-week1.jpg","modified":1,"renderable":0},{"_id":"source/img/web3-week2.jpg","path":"img/web3-week2.jpg","modified":1,"renderable":0},{"_id":"source/img/web3-week3.jpg","path":"img/web3-week3.jpg","modified":1,"renderable":0},{"_id":"source/img/web3-week4.jpg","path":"img/web3-week4.jpg","modified":1,"renderable":0},{"_id":"source/img/web3-week5.jpg","path":"img/web3-week5.jpg","modified":1,"renderable":0},{"_id":"source/img/webcomponents.png","path":"img/webcomponents.png","modified":1,"renderable":0},{"_id":"source/img/weight.png","path":"img/weight.png","modified":1,"renderable":0},{"_id":"source/img/wx.jpg","path":"img/wx.jpg","modified":1,"renderable":0},{"_id":"source/img/压测log.png","path":"img/压测log.png","modified":1,"renderable":0},{"_id":"source/img/压测结果.png","path":"img/压测结果.png","modified":1,"renderable":0},{"_id":"source/img/压测配置.jpg","path":"img/压测配置.jpg","modified":1,"renderable":0},{"_id":"source/img/组合继承.jpg","path":"img/组合继承.jpg","modified":1,"renderable":0},{"_id":"source/demo/2023面试准备/img/ast.jpg","path":"demo/2023面试准备/img/ast.jpg","modified":1,"renderable":0},{"_id":"source/demo/2023面试准备/img/babel.jpg","path":"demo/2023面试准备/img/babel.jpg","modified":1,"renderable":0},{"_id":"source/demo/2023面试准备/img/event loop.jpg","path":"demo/2023面试准备/img/event loop.jpg","modified":1,"renderable":0},{"_id":"source/demo/2023面试准备/img/组合继承.jpg","path":"demo/2023面试准备/img/组合继承.jpg","modified":1,"renderable":0},{"_id":"source/demo/2023面试准备/demo/module/node-esm.mjs","path":"demo/2023面试准备/demo/module/node-esm.mjs","modified":1,"renderable":0},{"_id":"source/demo/webcomponent/popup-info-box/img/avatar.jpg","path":"demo/webcomponent/popup-info-box/img/avatar.jpg","modified":1,"renderable":0}],"Cache":[{"_id":"source/demo/2023面试准备/css.md","hash":"da39a3ee5e6b4b0d3255bfef95601890afd80709","modified":1683888560020},{"_id":"source/demo/2023面试准备/打包工具.md","hash":"da39a3ee5e6b4b0d3255bfef95601890afd80709","modified":1683888560034},{"_id":"source/_drafts/linux.md","hash":"d4b5adb43b4ad5bd5124059fdd323bc3f3c5a823","modified":1683888560011},{"_id":"source/.DS_Store","hash":"d3a81ce8fe0f4c24c2d2169a3bc3e981274ef65c","modified":1683888560010},{"_id":"source/_drafts/english.md","hash":"9159c49ddc0865ee1a16da8a52b79f22fab72096","modified":1683888560011},{"_id":"source/_drafts/web3.md","hash":"ec925be529a37660936b26ef9fa1c88681aea8df","modified":1683888560011},{"_id":"source/about/index.md","hash":"bdf7332b3408ec5622870f7e8a435d87307a3cd6","modified":1683888560018},{"_id":"source/demo/.DS_Store","hash":"42d9310cb5b164bc3e430bc0ab6fefccdaac3585","modified":1683888560019},{"_id":"source/demo/ObserverMode.html","hash":"42e6115114f7e5e6a4ad56ba587a0afd25033c6b","modified":1683888560035},{"_id":"source/demo/PubSubMode.html","hash":"e5e764b9020c19dacc31968049348fb92f55bc18","modified":1683888560035},{"_id":"source/demo/Vue3Reactive.html","hash":"2d1f96478e6b58dbc357777d3191c32c0305973a","modified":1683888560035},{"_id":"source/demo/Vue3Reactive1.html","hash":"bb229ec82e7fb24f89fd6dad3859f8aa0efdf6ca","modified":1683888560035},{"_id":"source/demo/Vue3Reactive2.html","hash":"2cf48689caa19c4a5d65119eb47a489ea34ddfba","modified":1683888560036},{"_id":"source/demo/Vue3Reactive3.html","hash":"79285124a601ef58030fcc75c1f390186e96d31a","modified":1683888560036},{"_id":"source/demo/reactive.js","hash":"1c232a9be34b111285dbcfd4d803f618ea519f1d","modified":1683888560038},{"_id":"source/demo/Vue3Reactive4.html","hash":"292b660be70260121e261989bbac22b57d43bb70","modified":1683888560036},{"_id":"source/demo/replace$1.html","hash":"6b050aa9ef590df75949d3d965b421a0f32d5c7b","modified":1683888560038},{"_id":"source/_posts/ESM-ESBuild.md","hash":"a83aca564ffd0aea4422916132069067378a1214","modified":1683893833035},{"_id":"source/demo/resizeObserver.html","hash":"1ec44b744e56652815ed9f94bb53c493ac8c3b9c","modified":1683888560038},{"_id":"source/_posts/first-article.md","hash":"ac7986930f1d79fda890874fa3655281aea04c18","modified":1683888560012},{"_id":"source/demo/timeFragment.html","hash":"4c8287c48f6285c31849b0931038adca23cca9f0","modified":1683888560039},{"_id":"source/_posts/app-h5.md","hash":"20756bb700c51ae1769738b1160240d4ebdffa2f","modified":1683888560012},{"_id":"source/_posts/js-advice.md","hash":"0395d4fe0ac081c7e072cc9d2a4c2b7fee44aca6","modified":1683888560013},{"_id":"source/_posts/micro-qiankun.md","hash":"bac1f80d0ebbb21199e5016f495f3328630c36d4","modified":1683888560013},{"_id":"source/_posts/nginx.md","hash":"b6180aab77ed098908d634f527a4dd9ddd238909","modified":1683888560013},{"_id":"source/_posts/time-fragment.md","hash":"8ee8f495a8299cde2a2e61c3b2190b5ee0cc4ab0","modified":1683888560014},{"_id":"source/_posts/nodejs.md","hash":"18a599f77374e63ef0c71f78529bf08096e264ab","modified":1683888560013},{"_id":"source/_posts/virtual-list.md","hash":"cd3186ed711020643687679a66433de978851862","modified":1683888560014},{"_id":"source/_posts/vue-router4.md","hash":"690c0040c8417470b4151801101363e65693351a","modified":1683888560014},{"_id":"source/_posts/vue3-project-config.md","hash":"effc0c5632d15acba7426f4aabb807d322b1827f","modified":1683888560014},{"_id":"source/_posts/vue3-project-generalLogin.md","hash":"8d8dce489d5ed74b0cd1b45375e3b55609d25e88","modified":1683888560015},{"_id":"source/_posts/vue3-project-generalModule.md","hash":"4682cc466353407a93924201fc5abab06f076ef0","modified":1683888560015},{"_id":"source/_posts/vue3-project-generalModule2.md","hash":"2f33ffeb9ddd25f012148531ecdddf8b8ddfba36","modified":1683888560016},{"_id":"source/_posts/vue3-project-traning.md","hash":"6af63d8aec11d8c6d0ea40de1ce342a7f5c6f573","modified":1683888560017},{"_id":"source/_posts/vue3-project-layout.md","hash":"c589b2146270b56159f1b733820ac1083b39af18","modified":1683888560016},{"_id":"source/_posts/vue3-reactive.md","hash":"a9a76105c8334f54d73f4446441a35b1914d49d4","modified":1683888560017},{"_id":"source/_posts/react-hooks.md","hash":"42aa7e1c7a2283f52a2bce1ee6cfd510976b8d45","modified":1683888804159},{"_id":"source/_posts/web-components.md","hash":"628a53972cc30a580eeb9c5fd2b7f311b4b175bf","modified":1683888560018},{"_id":"source/_posts/vue3.md","hash":"808a3f4387ea1569eb145b14af8897ee706cce91","modified":1683888560017},{"_id":"source/_posts/重温JavaScript.md","hash":"6cebae5a22d9f24d5fd59a46cc6ecdbd13a037be","modified":1683893564558},{"_id":"source/_posts/深入浅出TypeScript.md","hash":"0c1bb83bf590a3877fab98054260629331f6210e","modified":1683888560018},{"_id":"source/img/avatar.jpg","hash":"7fc0c58e6b959b4987d6034fa585d9fa57bdc19f","modified":1683888560046},{"_id":"source/img/event loop.jpg","hash":"5406c471a76a65af2ee0b969d2957daf1cfc7d5f","modified":1683892562932},{"_id":"source/img/general2.png","hash":"23746b83868601e025385652fcd638eaa175d9ca","modified":1683888560061},{"_id":"source/img/elem-plus-official.png","hash":"1b973fc44af60d2ee626af0e218cbe0a0c8c2519","modified":1683888560059},{"_id":"source/img/layout.png","hash":"60d809e8ef455da522b2b5da25f59ea0a31db463","modified":1683888560068},{"_id":"source/img/login.png","hash":"d9dd1fe524456a7a9acbc0f3357c2f4317ec7dcf","modified":1683888560069},{"_id":"source/img/layout-base.png","hash":"d3de71d60daa30cac79639160f51b94c1f4174cb","modified":1683888560067},{"_id":"source/img/layout-result.png","hash":"8277069002f8006d0fdbc052c2932567175dbfa9","modified":1683888560068},{"_id":"source/img/nginx.png","hash":"c3a9f44c63fc7a6c0a9e5e6813879e8e8587da6b","modified":1683888560072},{"_id":"source/img/nodejs.png","hash":"42b2dbb15f130a8bf8397f4d881bb039d2e3b6f5","modified":1683888560072},{"_id":"source/img/menu.png","hash":"605ff9fa1c622f2478764e1e50de7f5362e5a043","modified":1683888560070},{"_id":"source/img/mao.jpg","hash":"9ba64ac134fefb9960a256df7b8413e4cd62d8fc","modified":1683888560070},{"_id":"source/img/node-res.png","hash":"d4f543f8e4a38a1e890e2f6e01ebca8bf3c71e15","modified":1683888560072},{"_id":"source/img/theme.png","hash":"34293047fcf8289c37a5c18ab3a14935ab0d6a27","modified":1683888560089},{"_id":"source/img/vue-logo.png","hash":"f8f9c2d6442e87f3f81cb858eeb756a26abf0e85","modified":1683888560089},{"_id":"source/img/vue3.jpg","hash":"46594ac934bccf237dd98ad88f67821f70c88a61","modified":1683888560090},{"_id":"source/img/web3-week2.jpg","hash":"ce1463d402878c00db930464a16ead2b60619817","modified":1683888560092},{"_id":"source/demo/2023面试准备/JavaScript.md","hash":"626792fc106d3ebcbf18acf6917a2c7d63c9d846","modified":1683888560019},{"_id":"source/demo/2023面试准备/react.md","hash":"e040b7300f892be75988a2e3bb3d69704161d47f","modified":1683888560034},{"_id":"source/demo/2023面试准备/模块化.md","hash":"d847567d67e41c4f94b1049603af72add709e76a","modified":1683888560034},{"_id":"source/demo/2023面试准备/JavaScript语言精粹与编程实战.md","hash":"5710e342018806968f061a14dfd441e8a2b8a069","modified":1683888560019},{"_id":"source/demo/canvas/demo1.html","hash":"0ee0bb254d1d57e5358852a8f7f4a6aa7f9d09aa","modified":1683888560037},{"_id":"source/demo/theme/prefers-color-scheme.html","hash":"8b0bf4ec8079c7341fe7ebdd116a235136c15fc8","modified":1683888560039},{"_id":"source/demo/2023面试准备/Vue2&Vue3.md","hash":"c3c5edb00c1623b833471d592636d8141ca153f0","modified":1683888560020},{"_id":"source/demo/micro-app/index.html","hash":"c27486eaa0cda7e53b9f576c8e8ebd6d977efff8","modified":1683888560037},{"_id":"source/demo/micro-app/SanpshotSandbox.js","hash":"0db2ea0c97cd6095353323b69f9c29bce8cb750d","modified":1683888560037},{"_id":"source/demo/micro-app/legacySandbox.js","hash":"9b417af48d02825088c73557b890561e76322181","modified":1683888560038},{"_id":"source/demo/webcomponent/README.md","hash":"96f91f84993669dd60e2b7736a86c6c06274fdcf","modified":1683888560039},{"_id":"source/demo/2023面试准备/demo/debounce.html","hash":"217dd46eafbb1b845922efb8b333c04af11849ca","modified":1683888560020},{"_id":"source/demo/2023面试准备/demo/demo.js","hash":"4be8dc789400ea7de05513fb806e228655b63a33","modified":1683888560020},{"_id":"source/demo/2023面试准备/img/event loop.jpg","hash":"5406c471a76a65af2ee0b969d2957daf1cfc7d5f","modified":1683888560031},{"_id":"source/demo/webcomponent/composed-path/index.html","hash":"99e22173b4484412ae0cfd0c21ff33be56a4c2d8","modified":1683888560039},{"_id":"source/demo/2023面试准备/demo/vue2-demo.html","hash":"a20c850bcfc69a96904a74f3fde6a5e0c2c35762","modified":1683888560024},{"_id":"source/demo/2023面试准备/demo/vue3-demo.html","hash":"226037c436c2ae574bc74321203d9ab36e4b1090","modified":1683888560025},{"_id":"source/demo/webcomponent/composed-path/main.js","hash":"d971d5719ab7bd33a3b3c46058facc1644f2a732","modified":1683888560040},{"_id":"source/demo/webcomponent/element-details-template/index.html","hash":"a2634bfab58e2afc43a7b339bb98a7d5a44a3179","modified":1683888560040},{"_id":"source/demo/webcomponent/expanding-list/index.html","hash":"b62cd79115773292d37dd0c6374ab6c7cf078a71","modified":1683888560041},{"_id":"source/demo/webcomponent/element-details-template/main.js","hash":"e786eeed042c5e1fca71556cdfd18b7a3ed10602","modified":1683888560040},{"_id":"source/demo/webcomponent/expanding-list/iframe.html","hash":"129ace10ada9198664f0038ad3e7ea38082fdd9b","modified":1683888560041},{"_id":"source/demo/webcomponent/expanding-list/main.js","hash":"4f1d20d9d8de4a4338d404cca0f7b6f240a1442a","modified":1683888560041},{"_id":"source/demo/webcomponent/parent-send-data-to-child/index.html","hash":"b7e2708127ee526f31457eef09ad6116d82d2a3b","modified":1683888560041},{"_id":"source/demo/webcomponent/parent-send-data-to-child/main.js","hash":"38444c7349b1b3b8acffdae3c070b90b787c3854","modified":1683888560042},{"_id":"source/demo/webcomponent/popup-info-box/index.html","hash":"7cd5b864abd579edce4a5c5132aba25c2c2adb60","modified":1683888560042},{"_id":"source/demo/webcomponent/popup-info-box/main.js","hash":"65cd026456e4ca9cb12af6af5a612a0db7ddfeb1","modified":1683888560043},{"_id":"source/demo/webcomponent/quark-design/index.html","hash":"3f412380c51d0750fd7f7ee1272430c1a2283a29","modified":1683888560043},{"_id":"source/demo/webcomponent/template&slot/index.html","hash":"a8d378c4b61ec6233541d78c2ed751094ce5f04e","modified":1683888560043},{"_id":"source/demo/webcomponent/template&slot/main.js","hash":"7a38214bbc47e9b300e9866caffc220b0a563e41","modified":1683888560043},{"_id":"source/demo/2023面试准备/demo/module/.babelrc","hash":"b0325d9e6ab7e0b3758e8eb4b9528391eab7050a","modified":1683888560021},{"_id":"source/demo/2023面试准备/demo/module/babel.js","hash":"e3596de2eade9e2634cc9229bccdeddd247b29fc","modified":1683888560021},{"_id":"source/demo/2023面试准备/demo/module/compiled.js","hash":"d0eae85db48e4e441f0ab71fbe887ec89b7b1dfb","modified":1683888560021},{"_id":"source/demo/2023面试准备/demo/module/lib.js","hash":"d8fa9430d41a45b086aa6cca7e38ca2be469df58","modified":1683888560022},{"_id":"source/demo/2023面试准备/demo/module/index.html","hash":"fb6bae693768b0a8708dcf7e0799227b04333046","modified":1683888560021},{"_id":"source/demo/2023面试准备/demo/module/main.js","hash":"9c854e687e61bb037377a89a3441687fcbae2253","modified":1683888560022},{"_id":"source/demo/2023面试准备/demo/module/node-esm.mjs","hash":"78bd681b9f408199eae38281372481fa247e5a2e","modified":1683888560022},{"_id":"source/demo/2023面试准备/demo/module/myPlugin.js","hash":"baa051cd0dfb4ac771c67eb571f54564f09e5e8f","modified":1683888560022},{"_id":"source/demo/2023面试准备/demo/module/package.json","hash":"697a96ca54a2b00338aa0cbc44b3d3a6a174defb","modified":1683888560024},{"_id":"source/demo/2023面试准备/demo/module/plugin.js","hash":"5d85ddb1f6a9f532ea2f11a71ea206f2fed1237c","modified":1683888560024},{"_id":"source/demo/2023面试准备/demo/module/plugin-test.js","hash":"10e8b9e704974b7d4354392c5de9dd56f5d72894","modified":1683888560024},{"_id":"source/demo/webcomponent/popup-info-box/img/avatar.jpg","hash":"7fc0c58e6b959b4987d6034fa585d9fa57bdc19f","modified":1683888560042},{"_id":"source/img/icon.png","hash":"02762bf39372c14048153dc023893df2b0db6028","modified":1683888560066},{"_id":"source/img/js.jpg","hash":"c1b5f8c607a09ce088f032e3141deacf2ebac54e","modified":1683892427944},{"_id":"source/img/import-scss-error.png","hash":"860c5db9c673dcc9995a2a008ae0b795bd841f16","modified":1683888560067},{"_id":"source/img/micro-app.png","hash":"206759e4a90bf3db82decb012b8d1e41284dbc10","modified":1683888560071},{"_id":"source/img/home.jpg","hash":"c8122e63226ad58f1658d72b8a4afb8470008610","modified":1683888560065},{"_id":"source/img/react-v16.gif","hash":"db895349e64224bb5e15a73d124dca322ed020c9","modified":1683888560079},{"_id":"source/img/react-v17.gif","hash":"e289c2c2ae0cd37b5419e48bc295fb86e9525e22","modified":1683888560081},{"_id":"source/img/ts.jpg","hash":"c6bbf43eb1cae7e8005f512fefca2e733d4cc189","modified":1683892393961},{"_id":"source/img/web3-week4.jpg","hash":"dc51e80baa45e2e25303dac4afadef1706f67a14","modified":1683888560093},{"_id":"source/img/web3-week5.jpg","hash":"e59cf168639a32af21ccb17254fe784d55b6d5c4","modified":1683888560094},{"_id":"source/img/web3-week3.jpg","hash":"37914c5820bc4ffcf58b53f60d73760557e6a7dd","modified":1683888560093},{"_id":"source/img/weight.png","hash":"76beadedb10a42a6438333d43fa8a8c2de34b0ce","modified":1683888560096},{"_id":"source/img/压测配置.jpg","hash":"e6f301bb3a08fcf1b27b8a2e80b97c4c28d878ab","modified":1683888560101},{"_id":"source/demo/2023面试准备/demo/module/package-lock.json","hash":"ff081c27f60efedb87a72fdd382ad4687a59942a","modified":1683888560023},{"_id":"source/img/ast.jpg","hash":"9da1e8119fe167fcb21fead4b2bdece7525ef44b","modified":1683892589490},{"_id":"source/img/api-user.png","hash":"3d10df46dd351377f5f878a4fb6349293e0f8719","modified":1683888560044},{"_id":"source/img/firewall.png","hash":"c0327a72d12eb59d0a7d74e3eacae7be3ce40c0b","modified":1683888560060},{"_id":"source/img/svg-sprite.png","hash":"de6ec0c5b85d36d57ad20456292557f8d88535c4","modified":1683888560087},{"_id":"source/img/webcomponents.png","hash":"169116069e8b151b9e4aacb53ef2e0f9fbaeaabe","modified":1683888560095},{"_id":"source/img/wx.jpg","hash":"9d2bf9f895d4fdfdb43ca82ef779dd7c97204b7e","modified":1683888560097},{"_id":"source/img/压测log.png","hash":"896c4baeaf70ce4b86207fcfad8da7fb3e6cc4a8","modified":1683888560099},{"_id":"source/demo/2023面试准备/img/ast.jpg","hash":"9da1e8119fe167fcb21fead4b2bdece7525ef44b","modified":1683888560026},{"_id":"source/img/backend.jpg","hash":"bc2b477645818e51442f68247c31dab8cc28bace","modified":1683888560048},{"_id":"source/img/api-userinfo.png","hash":"eeb49d9df442599574950ad65fc2e90e0b88738d","modified":1683888560045},{"_id":"source/img/qiankun.png","hash":"cb3cf7dc83c47d0f771ee90ee808c5551ea5cf7b","modified":1683888560078},{"_id":"source/img/web3-week1.jpg","hash":"f9542a6ec82523ce0413df731950b6319989ea2c","modified":1683888560091},{"_id":"source/img/chicken.jpg","hash":"448fd479b78c02c8a4eeb3a8d8efcbbb09b82bb5","modified":1683888560050},{"_id":"source/img/render-10w-data.jpg","hash":"ea2c8c396847af90cf2b9d87b955859da7016c35","modified":1683888560082},{"_id":"source/img/压测结果.png","hash":"2b742d41cde38f58925c6dab27670d2c7b6036d5","modified":1683888560100},{"_id":"node_modules/hexo-theme-fluid/source/css/_pages/_category/category.styl","hash":"da39a3ee5e6b4b0d3255bfef95601890afd80709","modified":499162500000},{"_id":"node_modules/hexo-theme-fluid/source/css/_pages/_tag/tag.styl","hash":"da39a3ee5e6b4b0d3255bfef95601890afd80709","modified":499162500000},{"_id":"source/img/theme-select.png","hash":"3569ae0c303c28f811e5c62c6474ee7eff32f0a9","modified":1683888560089},{"_id":"node_modules/hexo-theme-fluid/.editorconfig","hash":"33218fbd623feb43edf5f99f15965392cecc44a6","modified":499162500000},{"_id":"node_modules/hexo-theme-fluid/LICENSE","hash":"df5b54be535593d5442cebafbea34eb9bd69b987","modified":499162500000},{"_id":"node_modules/hexo-theme-fluid/README.md","hash":"03cfa8e5f149514b57ef80dcb84eb7fea261370d","modified":499162500000},{"_id":"node_modules/hexo-theme-fluid/.gitattributes","hash":"a54f902957d49356376b59287b894b1a3d7a003f","modified":499162500000},{"_id":"node_modules/hexo-theme-fluid/package.json","hash":"37b94535739ed7dc3c5ddd73158288b470444ddd","modified":1683887549253},{"_id":"node_modules/hexo-theme-fluid/.eslintrc","hash":"4bc2b19ce2b8c4d242f97d4ccf2d741e68ab0097","modified":499162500000},{"_id":"node_modules/hexo-theme-fluid/README_en.md","hash":"ca8fd19a4948de1f253616a62c0e8a7d81f692f5","modified":499162500000},{"_id":"node_modules/hexo-theme-fluid/languages/de.yml","hash":"13a6a799415fc2f6f69ebd1a399fb44426a5d641","modified":499162500000},{"_id":"node_modules/hexo-theme-fluid/_config.yml","hash":"8a7f1534c228538e2ab56249d5a65829650170ed","modified":499162500000},{"_id":"node_modules/hexo-theme-fluid/languages/en.yml","hash":"a85dcc5cc21f9cab50df31e5001b8818ee62d1e2","modified":499162500000},{"_id":"node_modules/hexo-theme-fluid/languages/eo.yml","hash":"a0c7984495d4f2d33b64adfa33adebbf768a5ac3","modified":499162500000},{"_id":"node_modules/hexo-theme-fluid/languages/ja.yml","hash":"91020031a847c0361a6fd7ab990c7be4bf17529b","modified":499162500000},{"_id":"node_modules/hexo-theme-fluid/languages/zh-CN.yml","hash":"21307b4137c3d9b04bb58243747e75af0abc5a71","modified":499162500000},{"_id":"node_modules/hexo-theme-fluid/languages/zh-TW.yml","hash":"1a6d415446da11dee5c5f400e7d67544fbe743ea","modified":499162500000},{"_id":"node_modules/hexo-theme-fluid/layout/404.ejs","hash":"689d9f4efd2a7f5edfd9b24561a7ade69d46617c","modified":499162500000},{"_id":"node_modules/hexo-theme-fluid/layout/about.ejs","hash":"ad6fed7b646d3ca961db83db0fbe020e3a5d42ad","modified":499162500000},{"_id":"node_modules/hexo-theme-fluid/layout/categories.ejs","hash":"20c2a195a109d2a263b5fa6e79cbcc62932508ad","modified":499162500000},{"_id":"node_modules/hexo-theme-fluid/layout/category.ejs","hash":"58291dfec65c36889dfce0ddc603540b67e4c598","modified":499162500000},{"_id":"node_modules/hexo-theme-fluid/layout/layout.ejs","hash":"7f566edf750241e62d7c54abfbb0c504fdab850a","modified":499162500000},{"_id":"node_modules/hexo-theme-fluid/layout/archive.ejs","hash":"472d0813ca5b88000a7bc6039f33b7e27b5a3216","modified":499162500000},{"_id":"node_modules/hexo-theme-fluid/layout/links.ejs","hash":"2a7b49f0f9aecf07550b5a0b99242aab5654cf2b","modified":499162500000},{"_id":"node_modules/hexo-theme-fluid/layout/index.ejs","hash":"f3ae4395e751c4a02d5895e07856b1e8edfdda08","modified":499162500000},{"_id":"node_modules/hexo-theme-fluid/layout/page.ejs","hash":"1014b901d396f4fc445cb1ffc938d5380d894d71","modified":499162500000},{"_id":"node_modules/hexo-theme-fluid/layout/post.ejs","hash":"79e3679a7069351a6172c281b9d09f59d7580484","modified":499162500000},{"_id":"node_modules/hexo-theme-fluid/layout/tag.ejs","hash":"0ad89eb7c92a822980fa9a85285e6d94ad845d1d","modified":499162500000},{"_id":"node_modules/hexo-theme-fluid/layout/tags.ejs","hash":"1d06af34b6cf1d8a20d2eb565e309326ceba309f","modified":499162500000},{"_id":"node_modules/hexo-theme-fluid/.github/workflows/limit.yaml","hash":"f8bd2edeb4424ee7a055b31583445d5d5dff91a4","modified":499162500000},{"_id":"node_modules/hexo-theme-fluid/.github/ISSUE_TEMPLATE/bug_report.md","hash":"16d33eb89ecf90f4046720fde5395d972c7ba1fd","modified":499162500000},{"_id":"node_modules/hexo-theme-fluid/.github/ISSUE_TEMPLATE/feature_request.md","hash":"c134dd57ffd269b93402ccfffe7dbe0f0b583bec","modified":499162500000},{"_id":"node_modules/hexo-theme-fluid/.github/ISSUE_TEMPLATE/feature_request_zh.md","hash":"ed08574b196447376dd74411cca664ac9227a5d4","modified":499162500000},{"_id":"node_modules/hexo-theme-fluid/scripts/events/index.js","hash":"44faef3e77ab08b91e4c5c6f1cd9087a9faff443","modified":499162500000},{"_id":"node_modules/hexo-theme-fluid/scripts/filters/locals.js","hash":"58d0fec976f6b1d35e7ea03edc45414088acf05c","modified":499162500000},{"_id":"node_modules/hexo-theme-fluid/.github/ISSUE_TEMPLATE/question.md","hash":"ab5eab9e3ff889c4ba7fd82846e7f5b7ae15bebc","modified":499162500000},{"_id":"node_modules/hexo-theme-fluid/scripts/filters/post-filter.js","hash":"6c37e9f1ac1d6d00b3c32794e02e244dba942cd9","modified":499162500000},{"_id":"node_modules/hexo-theme-fluid/scripts/generators/local-search.js","hash":"fc2c50405b771b06b7f6cfc4e9de97b992691555","modified":499162500000},{"_id":"node_modules/hexo-theme-fluid/scripts/helpers/export-config.js","hash":"cde964c8cd3217268a231de5e018a62c53c2e047","modified":499162500000},{"_id":"node_modules/hexo-theme-fluid/scripts/generators/pages.js","hash":"d9971f15fbb6b775e3d31a1b9b45011959395010","modified":499162500000},{"_id":"node_modules/hexo-theme-fluid/scripts/helpers/page.js","hash":"4607607445233b3029ef20ed5e91de0da0a7f9c5","modified":499162500000},{"_id":"node_modules/hexo-theme-fluid/scripts/helpers/url.js","hash":"2a6a8288176d0e0f6ec008056bf2745a86e8943e","modified":499162500000},{"_id":"node_modules/hexo-theme-fluid/scripts/helpers/utils.js","hash":"3aa5b4ea879cd34d3a32468d88da18d72cbcc8e0","modified":499162500000},{"_id":"node_modules/hexo-theme-fluid/scripts/helpers/wordcount.js","hash":"b917b893b1777e6ffcb53188f9f5644510e5f20d","modified":499162500000},{"_id":"node_modules/hexo-theme-fluid/scripts/tags/button.js","hash":"3eb43a8cdea0a64576ad6b31b4df6c2bf5698d4c","modified":499162500000},{"_id":"node_modules/hexo-theme-fluid/scripts/tags/checkbox.js","hash":"63468f7875c09d9557fe8315afc97175745d9087","modified":499162500000},{"_id":"node_modules/hexo-theme-fluid/scripts/tags/group-image.js","hash":"4aeebb797026f1df25646a5d69f7fde79b1bcd26","modified":499162500000},{"_id":"node_modules/hexo-theme-fluid/scripts/tags/label.js","hash":"f05a6d32cca79535b22907dc03edb9d3fa2d8176","modified":499162500000},{"_id":"node_modules/hexo-theme-fluid/scripts/tags/mermaid.js","hash":"75160561e1ef3603b6d2ad2938464ab1cb77fd38","modified":499162500000},{"_id":"node_modules/hexo-theme-fluid/scripts/tags/note.js","hash":"f52f3a005b41f48b4da274ac64710177c8d4502f","modified":499162500000},{"_id":"node_modules/hexo-theme-fluid/scripts/utils/compare-versions.js","hash":"dbbc928c914fc2bd242cd66aa0c45971aec13a5d","modified":499162500000},{"_id":"node_modules/hexo-theme-fluid/scripts/utils/object.js","hash":"649457796374c79e49a19bd541e4ad8e78fe8995","modified":499162500000},{"_id":"node_modules/hexo-theme-fluid/scripts/utils/url-join.js","hash":"718aab5e7b2059a06b093ca738de420d9afa44ba","modified":499162500000},{"_id":"node_modules/hexo-theme-fluid/.github/ISSUE_TEMPLATE/bug_report_zh.md","hash":"af977ed0792508bb0766ea8afe82d34ef1e8fb3c","modified":499162500000},{"_id":"node_modules/hexo-theme-fluid/.github/ISSUE_TEMPLATE/question_zh.md","hash":"e24b470f7aa8044499a4f5e39634e5dc43899011","modified":499162500000},{"_id":"node_modules/hexo-theme-fluid/layout/_partial/archive-list.ejs","hash":"53a4f6029373a40394a87aba9284696a71610f90","modified":499162500000},{"_id":"node_modules/hexo-theme-fluid/layout/_partial/beian.ejs","hash":"58b4bbe36386de4305a8da5ffd7d56802df23049","modified":499162500000},{"_id":"node_modules/hexo-theme-fluid/layout/_partial/css.ejs","hash":"c363829a4b80f74fc1c565e41f6dab41c95006ea","modified":499162500000},{"_id":"node_modules/hexo-theme-fluid/layout/_partial/nav.ejs","hash":"e71b3c4aa263163597d31b1f91e5a1a877084cfd","modified":499162500000},{"_id":"node_modules/hexo-theme-fluid/layout/_partial/paginator.ejs","hash":"0f38a2c238169edcb63fc46c23bfc529ff3859b7","modified":499162500000},{"_id":"node_modules/hexo-theme-fluid/layout/_partial/footer.ejs","hash":"a62278c38a310da495d96c39abacacef266945cb","modified":499162500000},{"_id":"node_modules/hexo-theme-fluid/layout/_partial/head.ejs","hash":"f7f3494ed001e8cdcdc3e8a1d2cd1195cff2ded5","modified":499162500000},{"_id":"node_modules/hexo-theme-fluid/layout/_partial/post-meta.ejs","hash":"32a17edadeed40da6db21d2d8031bd47d2fc9bf4","modified":499162500000},{"_id":"node_modules/hexo-theme-fluid/layout/_partial/scripts.ejs","hash":"0ee838b6fcd895d21a29d9d67dbb99b752d623d1","modified":499162500000},{"_id":"node_modules/hexo-theme-fluid/layout/_partial/statistics.ejs","hash":"920bc618d357d48d2b96f8758f6ae8f9488fc4d8","modified":499162500000},{"_id":"node_modules/hexo-theme-fluid/layout/_partial/search.ejs","hash":"cdd7919fa01f6ef7ccc09938d662ff3d77f5d999","modified":499162500000},{"_id":"node_modules/hexo-theme-fluid/layout/_partial/toc.ejs","hash":"3d2fb5552f373e5a0c56bc356702d807bcbcb411","modified":499162500000},{"_id":"node_modules/hexo-theme-fluid/source/img/favicon.png","hash":"64b215db2cb3af98fe639e94537cb5209f959c78","modified":499162500000},{"_id":"node_modules/hexo-theme-fluid/source/img/loading.gif","hash":"2d2fc0f947940f98c21afafef39ecf226a2e8d55","modified":499162500000},{"_id":"node_modules/hexo-theme-fluid/source/img/avatar.png","hash":"fe739a158cc128f70f780eb5fa96f388b81d478f","modified":499162500000},{"_id":"node_modules/hexo-theme-fluid/source/css/main.styl","hash":"d5a8a59c8d1fd17d699a951e59c4ce9ae44c419d","modified":499162500000},{"_id":"node_modules/hexo-theme-fluid/source/xml/local-search.xml","hash":"8c96ba6a064705602ce28d096fd7dd9069630a55","modified":499162500000},{"_id":"node_modules/hexo-theme-fluid/source/js/boot.js","hash":"3de344ee619da989f6dccf7c2ae459fe91075983","modified":499162500000},{"_id":"node_modules/hexo-theme-fluid/source/js/color-schema.js","hash":"f1fdd512f3ef92ff5db4a49f5a3143d5ddea9858","modified":499162500000},{"_id":"node_modules/hexo-theme-fluid/source/js/events.js","hash":"4b9d2676c9544db9cc40a8c7d18456792299ba86","modified":499162500000},{"_id":"node_modules/hexo-theme-fluid/source/js/img-lazyload.js","hash":"cbdeca434ec4da51f488c821d51b4d23c73294af","modified":499162500000},{"_id":"node_modules/hexo-theme-fluid/source/img/default.png","hash":"7bb2b8ee07db305bcadee2985b81b942027ae940","modified":499162500000},{"_id":"node_modules/hexo-theme-fluid/source/js/local-search.js","hash":"633f0142c657805359b0197f287e12ae4bcde731","modified":499162500000},{"_id":"node_modules/hexo-theme-fluid/source/js/plugins.js","hash":"d058f30bd09b28769c4d8313428ff23dfc8d52dd","modified":499162500000},{"_id":"node_modules/hexo-theme-fluid/source/js/utils.js","hash":"4a43f2700e91937650bef511fd438825b001c4c6","modified":499162500000},{"_id":"node_modules/hexo-theme-fluid/scripts/events/lib/footnote.js","hash":"3b2abc5f5e3b681874637e98e047dc4969eb1983","modified":499162500000},{"_id":"node_modules/hexo-theme-fluid/source/img/police_beian.png","hash":"90efded6baa2dde599a9d6b1387973e8e64923ea","modified":499162500000},{"_id":"node_modules/hexo-theme-fluid/scripts/events/lib/hello.js","hash":"28e186c32576eb3d5d923273471a001c47fe8071","modified":499162500000},{"_id":"node_modules/hexo-theme-fluid/source/js/leancloud.js","hash":"53987b7a668ea0623370eb83ed5311766221b557","modified":499162500000},{"_id":"node_modules/hexo-theme-fluid/scripts/events/lib/compatible-configs.js","hash":"b5fd5a2d9c463eb59318af0f47c591c485b6ad27","modified":499162500000},{"_id":"node_modules/hexo-theme-fluid/scripts/events/lib/lazyload.js","hash":"9ba0d4bc224e22af8a5a48d6ff13e5a0fcfee2a4","modified":499162500000},{"_id":"node_modules/hexo-theme-fluid/source/css/gitalk.css","hash":"a57b3cc8e04a0a4a27aefa07facf5b5e7bca0e76","modified":499162500000},{"_id":"node_modules/hexo-theme-fluid/scripts/events/lib/merge-configs.js","hash":"c1db1a4f9eca6e36b660530641e3a4fb6a30c8d8","modified":499162500000},{"_id":"node_modules/hexo-theme-fluid/scripts/events/lib/highlight.js","hash":"fd5fcb6a61ad865197a778eeae889b80484227dd","modified":499162500000},{"_id":"node_modules/hexo-theme-fluid/layout/_partial/comments/gitalk.ejs","hash":"843bc141a4545eb20d1c92fb63c85d459b4271ec","modified":499162500000},{"_id":"node_modules/hexo-theme-fluid/layout/_partial/comments/disqus.ejs","hash":"aab4a4d24c55231a37db308ae94414319cecdd9b","modified":499162500000},{"_id":"node_modules/hexo-theme-fluid/layout/_partial/comments/cusdis.ejs","hash":"5f9dc012be27040bbe874d0c093c0d53958cc987","modified":499162500000},{"_id":"node_modules/hexo-theme-fluid/layout/_partial/comments/changyan.ejs","hash":"c9b2d68ed3d375f1953e7007307d2a3f75ed6249","modified":499162500000},{"_id":"node_modules/hexo-theme-fluid/layout/_partial/comments/remark42.ejs","hash":"d4e9532feeb02aed61bd15eda536b5b631454dac","modified":499162500000},{"_id":"node_modules/hexo-theme-fluid/layout/_partial/comments/utterances.ejs","hash":"e1ed6530dfd7310f91060a75766a93ac3c39be3a","modified":499162500000},{"_id":"node_modules/hexo-theme-fluid/layout/_partial/comments/livere.ejs","hash":"2264758fed57542a7389c7aa9f00f1aefa17eb87","modified":499162500000},{"_id":"node_modules/hexo-theme-fluid/layout/_partial/comments/twikoo.ejs","hash":"1af53bc0be642610a3a4d4e7c05287854a821508","modified":499162500000},{"_id":"node_modules/hexo-theme-fluid/layout/_partial/comments/valine.ejs","hash":"4052ab2a8f78efa92f0fe17abe8f66135943390a","modified":499162500000},{"_id":"node_modules/hexo-theme-fluid/layout/_partial/plugins/math.ejs","hash":"df6941bd3b860180d01fd39ee859ed2d42f4d1f0","modified":499162500000},{"_id":"node_modules/hexo-theme-fluid/layout/_partial/plugins/mermaid.ejs","hash":"10ed1f9a611449d37736e17c4e251127b38b3772","modified":499162500000},{"_id":"node_modules/hexo-theme-fluid/layout/_partial/plugins/analytics.ejs","hash":"557077a8825fffc0a2c7fe2b29f319287950244f","modified":499162500000},{"_id":"node_modules/hexo-theme-fluid/source/css/_functions/base.styl","hash":"2e46f3f4e2c9fe34c1ff1c598738fc7349ae8188","modified":499162500000},{"_id":"node_modules/hexo-theme-fluid/layout/_partial/comments/waline.ejs","hash":"21e00443054802e893aac1f668b69d5bb4b39b3a","modified":499162500000},{"_id":"node_modules/hexo-theme-fluid/source/css/_mixins/base.styl","hash":"542e306ee9494e8a78e44d6d7d409605d94caeb3","modified":499162500000},{"_id":"node_modules/hexo-theme-fluid/source/css/_variables/base.styl","hash":"08b455b848b21d57e0563b87071c4bae2b63bafe","modified":499162500000},{"_id":"node_modules/hexo-theme-fluid/source/css/_pages/pages.styl","hash":"b8e887bc7fb3b765a1f8ec9448eff8603a41984f","modified":499162500000},{"_id":"node_modules/hexo-theme-fluid/source/css/_pages/_about/about.styl","hash":"97fe42516ea531fdad771489b68aa8b2a7f6ae46","modified":499162500000},{"_id":"node_modules/hexo-theme-fluid/source/css/_pages/_archive/archive.styl","hash":"6e6f22b664199772370b59ce1678b0c148b5849f","modified":499162500000},{"_id":"node_modules/hexo-theme-fluid/source/css/_pages/_base/color-schema.styl","hash":"80098e8354069631bde8edcd1181a53091a92949","modified":499162500000},{"_id":"node_modules/hexo-theme-fluid/layout/_partial/plugins/nprogress.ejs","hash":"4c2d39ce816b8a6dcd6b53113c8695f8bd650a23","modified":499162500000},{"_id":"node_modules/hexo-theme-fluid/source/css/_pages/_base/base.styl","hash":"c2d8bfd04bf0734b387c049402b46a06a05fc582","modified":499162500000},{"_id":"node_modules/hexo-theme-fluid/source/css/_pages/_base/inline.styl","hash":"d547ab0b91f84eb0acd0bc0c5d716ce17c30361a","modified":499162500000},{"_id":"node_modules/hexo-theme-fluid/source/css/_pages/_base/keyframes.styl","hash":"94065ea50f5bef7566d184f2422f6ac20866ba22","modified":499162500000},{"_id":"node_modules/hexo-theme-fluid/layout/_partial/plugins/typed.ejs","hash":"e8e01c5db46b383748855452aecd70fcda99f598","modified":499162500000},{"_id":"node_modules/hexo-theme-fluid/source/css/_pages/_base/rewrite.styl","hash":"a2993f23701de9a83e3f428300e62c5c52b4ff4b","modified":499162500000},{"_id":"node_modules/hexo-theme-fluid/source/css/_pages/_category/categories.styl","hash":"1ab7db37c2f7dc7ccdb994dcb41c16a4c8920397","modified":499162500000},{"_id":"node_modules/hexo-theme-fluid/source/css/_pages/_index/index.styl","hash":"616c1f7147078c3d532dd1cfd2af09c0c3a816f0","modified":499162500000},{"_id":"node_modules/hexo-theme-fluid/source/css/_pages/_links/links.styl","hash":"7e32a3268accf3d524209c213e15e2d5d5e2e1a6","modified":499162500000},{"_id":"node_modules/hexo-theme-fluid/source/css/_pages/_post/post.styl","hash":"5e86487de0f16c30ca3e16460ab94b57620e31c5","modified":499162500000},{"_id":"node_modules/hexo-theme-fluid/source/css/_pages/_post/tag_plugin.styl","hash":"b89b96c8a6a433a6f372b42710554b05cab85a24","modified":499162500000},{"_id":"node_modules/hexo-theme-fluid/source/css/_pages/_tag/tags.styl","hash":"65bfc01c76abc927fa1a23bf2422892b0d566c3f","modified":499162500000},{"_id":"node_modules/hexo-theme-fluid/source/css/_pages/_base/_widget/banner.styl","hash":"30f8fab95a5214d79df0ccc02b937df8bd885676","modified":499162500000},{"_id":"node_modules/hexo-theme-fluid/source/css/_pages/_base/_widget/copy-btn.styl","hash":"9f932ca3f9625c13aa5353f58319881e62c0c653","modified":499162500000},{"_id":"node_modules/hexo-theme-fluid/source/css/_pages/_base/_widget/footer.styl","hash":"0ce7552dc4993926426019398d73e817cfd841a1","modified":499162500000},{"_id":"node_modules/hexo-theme-fluid/source/css/_pages/_base/_widget/footnote.styl","hash":"ae9289cc89649af2042907f8a003303b987f3404","modified":499162500000},{"_id":"node_modules/hexo-theme-fluid/source/css/_pages/_base/_widget/board.styl","hash":"32d90bcc8bf2fd5d8d78e86a567973d4b69bcfa1","modified":499162500000},{"_id":"node_modules/hexo-theme-fluid/source/css/_pages/_base/_widget/header.styl","hash":"d8011325756eb6e4ce619b3e7b4d6d80c2de8a57","modified":499162500000},{"_id":"node_modules/hexo-theme-fluid/source/css/_pages/_base/_widget/qrcode.styl","hash":"78704a94c0436097abfb0e0a57abeb3429c749b7","modified":499162500000},{"_id":"node_modules/hexo-theme-fluid/source/css/_pages/_base/_widget/scroll-btn.styl","hash":"55e10a6965462f8f62f85e75fd5e143af02a4b44","modified":499162500000},{"_id":"node_modules/hexo-theme-fluid/source/css/_pages/_base/_widget/search.styl","hash":"10f7e91a91e681fb9fe46f9df7707b9ef78707c8","modified":499162500000},{"_id":"source/demo/2023面试准备/img/组合继承.jpg","hash":"1e99fbbebba1e5572b00584278cdea7983e2436f","modified":1683888560033},{"_id":"source/img/god.jpg","hash":"dd15799930cfbf9a222c2d8c1d6980d4da43adc6","modified":1683888560064},{"_id":"source/img/组合继承.jpg","hash":"1e99fbbebba1e5572b00584278cdea7983e2436f","modified":1683892589474},{"_id":"source/img/primary.png","hash":"06b6a8b5a8216208f787d4a8e29bc99310e60699","modified":1683888560077},{"_id":"source/img/modules.jpg","hash":"3fc76083b9d69479affc18879496fe3dc8d29073","modified":1683892427930},{"_id":"source/img/svg-sprite-result.png","hash":"b94411c7e3767c99e18f53c88a4e27a761f300a1","modified":1683888560086},{"_id":"source/demo/2023面试准备/img/babel.jpg","hash":"fd18a279d8da55d7ebc5101dbc033d60208de19d","modified":1683888560030},{"_id":"source/img/babel.jpg","hash":"fd18a279d8da55d7ebc5101dbc033d60208de19d","modified":1683892589507},{"_id":"source/img/city.jpg","hash":"085c7649b2838db2b6a831b043199dda61da17a6","modified":1683888560059},{"_id":"public/demo/micro-app/SanpshotSandbox.js","hash":"0db2ea0c97cd6095353323b69f9c29bce8cb750d","modified":1683893956660},{"_id":"public/demo/reactive.js","hash":"1c232a9be34b111285dbcfd4d803f618ea519f1d","modified":1683893956660},{"_id":"public/demo/micro-app/legacySandbox.js","hash":"9b417af48d02825088c73557b890561e76322181","modified":1683893956660},{"_id":"public/demo/webcomponent/composed-path/main.js","hash":"d971d5719ab7bd33a3b3c46058facc1644f2a732","modified":1683893956660},{"_id":"public/demo/2023面试准备/demo/demo.js","hash":"4be8dc789400ea7de05513fb806e228655b63a33","modified":1683893956660},{"_id":"public/demo/webcomponent/element-details-template/main.js","hash":"e786eeed042c5e1fca71556cdfd18b7a3ed10602","modified":1683893956660},{"_id":"public/demo/webcomponent/expanding-list/main.js","hash":"4f1d20d9d8de4a4338d404cca0f7b6f240a1442a","modified":1683893956660},{"_id":"public/demo/webcomponent/parent-send-data-to-child/main.js","hash":"38444c7349b1b3b8acffdae3c070b90b787c3854","modified":1683893956660},{"_id":"public/demo/webcomponent/popup-info-box/main.js","hash":"65cd026456e4ca9cb12af6af5a612a0db7ddfeb1","modified":1683893956660},{"_id":"public/demo/webcomponent/template&slot/main.js","hash":"7a38214bbc47e9b300e9866caffc220b0a563e41","modified":1683893956660},{"_id":"public/demo/2023面试准备/demo/module/babel.js","hash":"e3596de2eade9e2634cc9229bccdeddd247b29fc","modified":1683893956660},{"_id":"public/demo/2023面试准备/demo/module/compiled.js","hash":"d0eae85db48e4e441f0ab71fbe887ec89b7b1dfb","modified":1683893956660},{"_id":"public/demo/2023面试准备/demo/module/lib.js","hash":"d8fa9430d41a45b086aa6cca7e38ca2be469df58","modified":1683893956660},{"_id":"public/demo/2023面试准备/demo/module/main.js","hash":"9c854e687e61bb037377a89a3441687fcbae2253","modified":1683893956660},{"_id":"public/demo/2023面试准备/demo/module/myPlugin.js","hash":"baa051cd0dfb4ac771c67eb571f54564f09e5e8f","modified":1683893956660},{"_id":"public/demo/2023面试准备/demo/module/package.json","hash":"28ed24a0e850579949655654ead8dca50ce697ea","modified":1683893956660},{"_id":"public/demo/2023面试准备/demo/module/plugin.js","hash":"5d85ddb1f6a9f532ea2f11a71ea206f2fed1237c","modified":1683893956660},{"_id":"public/demo/2023面试准备/demo/module/package-lock.json","hash":"07c18b9e2e79b0f13f2508919b8a543f264df740","modified":1683893956660},{"_id":"public/demo/2023面试准备/demo/module/plugin-test.js","hash":"10e8b9e704974b7d4354392c5de9dd56f5d72894","modified":1683893956660},{"_id":"public/content.json","hash":"7ff5e4aa5e582d7dac795511ed423491286b4074","modified":1683893956660},{"_id":"public/local-search.xml","hash":"aa4fa7413dee088a6178e6132fda4558f4455175","modified":1683893956660},{"_id":"public/demo/2023面试准备/css.html","hash":"e5ca7a51f243205aec9d839c38da186a82342dc7","modified":1683893956660},{"_id":"public/demo/2023面试准备/打包工具.html","hash":"b7ed523806a650371afbf626464ccfef4118e850","modified":1683893956660},{"_id":"public/about/index.html","hash":"7b521b33333dfd63375b4a2bf069675114083efe","modified":1683893956660},{"_id":"public/demo/ObserverMode.html","hash":"080fbd56987ad1a48a69a2ee97cfba87f82bf1b5","modified":1683893956660},{"_id":"public/demo/Vue3Reactive.html","hash":"be0a86ae0e0fecd1dcd157de95ba76758106c4e8","modified":1683893956660},{"_id":"public/demo/Vue3Reactive1.html","hash":"80ffada2fb6013628273b950b87d4d17c8afeb56","modified":1683893956660},{"_id":"public/demo/Vue3Reactive2.html","hash":"1a84f36a06b9742bef1d0601f101e5d2d1a9fb32","modified":1683893956660},{"_id":"public/demo/PubSubMode.html","hash":"2aa21737b6d5b8ad838422dee4af7a354f439118","modified":1683893956660},{"_id":"public/demo/Vue3Reactive3.html","hash":"4b889c13b1bceb39ab9e59119556c10c2bad4c7a","modified":1683893956660},{"_id":"public/demo/Vue3Reactive4.html","hash":"b869b6e76a11520873d4e5c224d201abec923150","modified":1683893956660},{"_id":"public/demo/replace$1.html","hash":"e6473d51eb392152fc253bca3902044939a52532","modified":1683893956660},{"_id":"public/demo/resizeObserver.html","hash":"2aa700da12892ca1e0d2ce5f7932b83e144bebf9","modified":1683893956660},{"_id":"public/demo/timeFragment.html","hash":"e62aa85ad958cc90e04153a3cd12444cae8e9c5b","modified":1683893956660},{"_id":"public/demo/2023面试准备/JavaScript语言精粹与编程实战.html","hash":"f4819d4811fd1fa3e0fe56ffeb2ea9012cbd658a","modified":1683893956660},{"_id":"public/demo/2023面试准备/Vue2&Vue3.html","hash":"c6a390669addf48a62d76eb19390aaaa18942b53","modified":1683893956660},{"_id":"public/demo/2023面试准备/react.html","hash":"0aeb2b9c073e6227fbb770c93a1e1edbbc8b9bcd","modified":1683893956660},{"_id":"public/demo/theme/prefers-color-scheme.html","hash":"f4db91dcf7a0272f34df613fd30025d8378a6798","modified":1683893956660},{"_id":"public/demo/micro-app/index.html","hash":"4135a0540303a4472bfdcf8553345b99b762d32b","modified":1683893956660},{"_id":"public/demo/2023面试准备/demo/debounce.html","hash":"2bea6a4a2b5b7eb7f1312b8e34597c542ab9dc7b","modified":1683893956660},{"_id":"public/demo/2023面试准备/demo/vue2-demo.html","hash":"54d305583cfa09da233c856ffa73bb9ee4a81707","modified":1683893956660},{"_id":"public/demo/2023面试准备/demo/vue3-demo.html","hash":"eb63590051e110408d20b5fd7ff2f4d4cea9a60a","modified":1683893956660},{"_id":"public/demo/webcomponent/composed-path/index.html","hash":"8c9b828ba0c03feb2e0ee147ab377a3b040d35ac","modified":1683893956660},{"_id":"public/demo/webcomponent/element-details-template/index.html","hash":"4c854fb828e2b913f55010f825f3de682c95f28a","modified":1683893956660},{"_id":"public/demo/webcomponent/expanding-list/iframe.html","hash":"537dab82d9ac44776920c15bb24afba72571299f","modified":1683893956660},{"_id":"public/demo/webcomponent/expanding-list/index.html","hash":"aafb158515ebecd2d931aaa2af138c8f3a3413f2","modified":1683893956660},{"_id":"public/demo/webcomponent/parent-send-data-to-child/index.html","hash":"c0596500c9870990c6ac165dd6f1a40533a9e0f2","modified":1683893956660},{"_id":"public/demo/webcomponent/popup-info-box/index.html","hash":"fc3bd5333dc3f4457ff09fc70ee69932d1957dfe","modified":1683893956660},{"_id":"public/demo/webcomponent/quark-design/index.html","hash":"9f7a68ffe6daa372abd07a5effaf27f72cff2514","modified":1683893956660},{"_id":"public/demo/webcomponent/template&slot/index.html","hash":"98c2c370931490b396b6ab89d2ff51c6cd292505","modified":1683893956660},{"_id":"public/demo/2023面试准备/demo/module/index.html","hash":"21ac7f84f07fee161fb27e2eb7475a31ee8a8022","modified":1683893956660},{"_id":"public/post/micro-qiankun.html","hash":"748e4cbfcd5fdf071e3bfd7eb0428a8567ec7f23","modified":1683893956660},{"_id":"public/post/app-h5.html","hash":"477e308b746e4b9d5aaf140cdf28e156e9346ff1","modified":1683893956660},{"_id":"public/post/first-article.html","hash":"23e298883dd8e335496630881fb25d0f20438738","modified":1683893956660},{"_id":"public/archives/index.html","hash":"7f89337e656d72ca731effabb7c56d2a327efb84","modified":1683893956660},{"_id":"public/archives/page/2/index.html","hash":"6985bcc930aeea9e3df6a0bde0a88b215573772d","modified":1683893956660},{"_id":"public/archives/page/3/index.html","hash":"72d561d7b1a02ab348e8211287ce4db34734af73","modified":1683893956660},{"_id":"public/archives/2019/index.html","hash":"42862d94516f5890f2a22d351e3ff5e0926a62cd","modified":1683893956660},{"_id":"public/archives/2019/07/index.html","hash":"61dcb3bf1bddbd12d6e8c7d73675cef851e5e848","modified":1683893956660},{"_id":"public/archives/2022/index.html","hash":"3d5ad92ac40cd2c9b90ce0fdb57bd1e19bad0cdb","modified":1683893956660},{"_id":"public/archives/2022/page/2/index.html","hash":"3eb04265b2d81ba007185d316755224f26180b88","modified":1683893956660},{"_id":"public/archives/2022/03/index.html","hash":"0e46a7129013ab46ccd83b7e7adb20e6052c54f4","modified":1683893956660},{"_id":"public/archives/2022/06/index.html","hash":"63037d765d3b1b89dd001307d709c345ab903007","modified":1683893956660},{"_id":"public/archives/2022/09/index.html","hash":"48e087c9761f670685d94242a9c97c9fc69801e9","modified":1683893956660},{"_id":"public/archives/2022/11/index.html","hash":"9e7156dc3286386890189ccb953edb10c4f00db8","modified":1683893956660},{"_id":"public/archives/2022/12/index.html","hash":"3eb8ca451e5640796dd82cb43d4d49928bb25326","modified":1683893956660},{"_id":"public/archives/2023/index.html","hash":"08f62d6a28c34f781c6c42f3a9ab81e89196cc0c","modified":1683893956660},{"_id":"public/archives/2023/01/index.html","hash":"cad7c51c653fbe53ffe73938cb6017e1e35896c9","modified":1683893956660},{"_id":"public/archives/2023/05/index.html","hash":"17eb14fb25f54413b82e660b94cce18ba1e0cb62","modified":1683893956660},{"_id":"public/page/3/index.html","hash":"c8952f8161c2f23b4db5d32fca5b1a0bbc2d182c","modified":1683893956660},{"_id":"public/tags/Nodejs/index.html","hash":"5773c75b5e72a4015ebdbe87ecac17ed463f4084","modified":1683893956660},{"_id":"public/tags/RN-H5/index.html","hash":"0eb4948233157ddf0bf57cf33dd873c671e96a8d","modified":1683893956660},{"_id":"public/tags/One/index.html","hash":"459ac0095b75aa55895c75ab241cb930f9106d9f","modified":1683893956660},{"_id":"public/tags/JavaScript-ES6/index.html","hash":"2f4bcda8f63547bef127e2472a07b07fde9a9c3b","modified":1683893956660},{"_id":"public/tags/微前端/index.html","hash":"99ceae96ad068f8a11837701852bf641588e1da0","modified":1683893956660},{"_id":"public/tags/Nginx/index.html","hash":"4599c20655b698cd8b5b290f89a449eebd49c9a3","modified":1683893956660},{"_id":"public/tags/React，Hooks/index.html","hash":"8e6c0f63ae7b0fff393b2d8f32fdcf1a99915bef","modified":1683893956660},{"_id":"public/tags/JS/index.html","hash":"6a2ce942b06dfafe4a95eb2434e402dadc592fa6","modified":1683893956660},{"_id":"public/tags/JS-Vue-Router-Vue3/index.html","hash":"97ed6df5899da55891d7c76f0c9c943b8bbf8fb4","modified":1683893956660},{"_id":"public/tags/工程化-Vue3/index.html","hash":"4232ac7eca84c5e461c99b15a358b99df3de7ee4","modified":1683893956660},{"_id":"public/tags/工程化-Vue3-Config/index.html","hash":"2b234c498955b59281fc4e157a4d3aa9ea6b924a","modified":1683893956660},{"_id":"public/tags/Reactive-Vue3/index.html","hash":"e9d7843006b13543fb99e0e3bdc9dc3bc87b099e","modified":1683893956660},{"_id":"public/tags/组件/index.html","hash":"decc09726b2bc38b39e2173a0a0e2341a7349708","modified":1683893956660},{"_id":"public/tags/TypeScript-TS/index.html","hash":"b1fb98316606e32b31e195156b261a202f6cf300","modified":1683893956660},{"_id":"public/tags/ESM-ESModule-ESBuild/index.html","hash":"e417e5525ac65c0defe34d552ab35db00da35f20","modified":1683893956660},{"_id":"public/tags/工程化-Vue3-通用功能/index.html","hash":"c0b4a6c39e4e4ecb256b82a3eddb185975149d31","modified":1683893956660},{"_id":"public/tags/JS-Vue3/index.html","hash":"8d7148e0e5485967ec4425b774a3ef59e26b6f52","modified":1683893956660},{"_id":"public/tags/JavaScript/index.html","hash":"d9fa0c21c28417546b88eb800064de60e86591f8","modified":1683893956660},{"_id":"public/404.html","hash":"e94d7cb0f7a2dc80b15dd9f0ec4bb14f85f9215b","modified":1683893956660},{"_id":"public/tags/index.html","hash":"dce49452d40b12f95ca6597610fefcb1a7f6d423","modified":1683893956660},{"_id":"public/categories/index.html","hash":"5d5f352cca992fecf6ca867b3566bb027ef9842e","modified":1683893956660},{"_id":"public/links/index.html","hash":"de6717c69dc5e7cc5388e91d572101afaac61597","modified":1683893956660},{"_id":"public/demo/canvas/demo1.html","hash":"d5f6e0de5cd1b2558560b707e86ce66df5f803e4","modified":1683893956660},{"_id":"public/demo/webcomponent/README.html","hash":"4efbce7879779a6425da60c12286e19c290af493","modified":1683893956660},{"_id":"public/demo/2023面试准备/模块化.html","hash":"4bd0f1d79a8c11c7f20a204b013e7bccfd2e0816","modified":1683893956660},{"_id":"public/post/重温JavaScript.html","hash":"7bc012ef434dadea5856a448f4f31073e1521aad","modified":1683893956660},{"_id":"public/post/web-components.html","hash":"0678aa31fbaa16e82e593c342316f1d6cb3ac26a","modified":1683893956660},{"_id":"public/post/vue3-project-generalModule2.html","hash":"57a1db0384c912a36603d3c7706e7c120abfeb5d","modified":1683893956660},{"_id":"public/post/vue3-project-generalModule.html","hash":"9b2bd821b2d162aaf429d594809604eb0e6fcb7d","modified":1683893956660},{"_id":"public/post/vue3-project-layout.html","hash":"bcfe0ed2fc2956c3f8600d85c6d9e1fd96e71a0c","modified":1683893956660},{"_id":"public/post/vue3-project-generalLogin.html","hash":"502ac5efe039f155bb9741cdf88f42c37b96a415","modified":1683893956660},{"_id":"public/post/vue3-project-config.html","hash":"e46bc9f35e105f07f3978df6bb60c87f4cf015d1","modified":1683893956660},{"_id":"public/post/vue3-project-traning.html","hash":"b2478ede8cb30637ca05e32570d6fd60b687fc99","modified":1683893956660},{"_id":"public/post/vue3-reactive.html","hash":"e3940f5d9c9091f85219f0fc84962cf15d9dcf0b","modified":1683893956660},{"_id":"public/post/nginx.html","hash":"0823ad071703a08a33a0e7bf423b88862e5119f3","modified":1683893956660},{"_id":"public/post/nodejs.html","hash":"0d1ab67fdcee18a2f260209c0ce415f546578907","modified":1683893956660},{"_id":"public/post/vue-router4.html","hash":"4dde60ecd10e321f563c97fc85c6a7db03bb80c7","modified":1683893956660},{"_id":"public/post/vue3.html","hash":"2ea72b4ce9ec4e7cd9a2cfeaaf3ee66ff8f52a16","modified":1683893956660},{"_id":"public/post/virtual-list.html","hash":"bedf8beae350cd34f07202e1449e761ce31f6334","modified":1683893956660},{"_id":"public/post/time-fragment.html","hash":"e55e6898f70a6e58ad4d3fdd1f44eac725e83bfe","modified":1683893956660},{"_id":"public/post/ESM-ESBuild.html","hash":"ba5489cf492a8420e2573adb183f13942c49ec39","modified":1683893956660},{"_id":"public/post/深入浅出TypeScript.html","hash":"db9ca438809785ab2b5527795b2c35a4e56f7b76","modified":1683893956660},{"_id":"public/post/js-advice.html","hash":"9787984617ba09df210dbcdddee16563ebf57ab6","modified":1683893956660},{"_id":"public/post/react-hooks.html","hash":"fb5f87a19415f880f67a52f8a11dc304d2ce12ab","modified":1683893956660},{"_id":"public/index.html","hash":"dd0b92e11645076e171943e7df5a8c8b471ce0a6","modified":1683893956660},{"_id":"public/page/2/index.html","hash":"4ef8df68202b39396369feb259f33fa46566d9cf","modified":1683893956660},{"_id":"public/img/avatar.png","hash":"fe739a158cc128f70f780eb5fa96f388b81d478f","modified":1683893956660},{"_id":"public/img/favicon.png","hash":"64b215db2cb3af98fe639e94537cb5209f959c78","modified":1683893956660},{"_id":"public/img/police_beian.png","hash":"90efded6baa2dde599a9d6b1387973e8e64923ea","modified":1683893956660},{"_id":"public/xml/local-search.xml","hash":"8c96ba6a064705602ce28d096fd7dd9069630a55","modified":1683893956660},{"_id":"public/img/loading.gif","hash":"2d2fc0f947940f98c21afafef39ecf226a2e8d55","modified":1683893956660},{"_id":"public/img/default.png","hash":"7bb2b8ee07db305bcadee2985b81b942027ae940","modified":1683893956660},{"_id":"public/img/avatar.jpg","hash":"7fc0c58e6b959b4987d6034fa585d9fa57bdc19f","modified":1683893956660},{"_id":"public/img/general2.png","hash":"23746b83868601e025385652fcd638eaa175d9ca","modified":1683893956660},{"_id":"public/img/event loop.jpg","hash":"5406c471a76a65af2ee0b969d2957daf1cfc7d5f","modified":1683893956660},{"_id":"public/img/elem-plus-official.png","hash":"1b973fc44af60d2ee626af0e218cbe0a0c8c2519","modified":1683893956660},{"_id":"public/img/layout-base.png","hash":"d3de71d60daa30cac79639160f51b94c1f4174cb","modified":1683893956660},{"_id":"public/img/login.png","hash":"d9dd1fe524456a7a9acbc0f3357c2f4317ec7dcf","modified":1683893956660},{"_id":"public/img/menu.png","hash":"605ff9fa1c622f2478764e1e50de7f5362e5a043","modified":1683893956660},{"_id":"public/img/layout.png","hash":"60d809e8ef455da522b2b5da25f59ea0a31db463","modified":1683893956660},{"_id":"public/img/mao.jpg","hash":"9ba64ac134fefb9960a256df7b8413e4cd62d8fc","modified":1683893956660},{"_id":"public/img/node-res.png","hash":"d4f543f8e4a38a1e890e2f6e01ebca8bf3c71e15","modified":1683893956660},{"_id":"public/img/nginx.png","hash":"c3a9f44c63fc7a6c0a9e5e6813879e8e8587da6b","modified":1683893956660},{"_id":"public/img/nodejs.png","hash":"42b2dbb15f130a8bf8397f4d881bb039d2e3b6f5","modified":1683893956660},{"_id":"public/img/theme.png","hash":"34293047fcf8289c37a5c18ab3a14935ab0d6a27","modified":1683893956660},{"_id":"public/img/vue-logo.png","hash":"f8f9c2d6442e87f3f81cb858eeb756a26abf0e85","modified":1683893956660},{"_id":"public/img/vue3.jpg","hash":"46594ac934bccf237dd98ad88f67821f70c88a61","modified":1683893956660},{"_id":"public/demo/2023面试准备/img/event loop.jpg","hash":"5406c471a76a65af2ee0b969d2957daf1cfc7d5f","modified":1683893956660},{"_id":"public/demo/2023面试准备/demo/module/node-esm.mjs","hash":"78bd681b9f408199eae38281372481fa247e5a2e","modified":1683893956660},{"_id":"public/demo/webcomponent/popup-info-box/img/avatar.jpg","hash":"7fc0c58e6b959b4987d6034fa585d9fa57bdc19f","modified":1683893956660},{"_id":"public/img/icon.png","hash":"02762bf39372c14048153dc023893df2b0db6028","modified":1683893956660},{"_id":"public/img/js.jpg","hash":"c1b5f8c607a09ce088f032e3141deacf2ebac54e","modified":1683893956660},{"_id":"public/img/layout-result.png","hash":"8277069002f8006d0fdbc052c2932567175dbfa9","modified":1683893956660},{"_id":"public/img/react-v16.gif","hash":"db895349e64224bb5e15a73d124dca322ed020c9","modified":1683893956660},{"_id":"public/img/react-v17.gif","hash":"e289c2c2ae0cd37b5419e48bc295fb86e9525e22","modified":1683893956660},{"_id":"public/img/ts.jpg","hash":"c6bbf43eb1cae7e8005f512fefca2e733d4cc189","modified":1683893956660},{"_id":"public/img/web3-week4.jpg","hash":"dc51e80baa45e2e25303dac4afadef1706f67a14","modified":1683893956660},{"_id":"public/img/web3-week5.jpg","hash":"e59cf168639a32af21ccb17254fe784d55b6d5c4","modified":1683893956660},{"_id":"public/img/web3-week2.jpg","hash":"ce1463d402878c00db930464a16ead2b60619817","modified":1683893956660},{"_id":"public/img/weight.png","hash":"76beadedb10a42a6438333d43fa8a8c2de34b0ce","modified":1683893956660},{"_id":"public/img/压测配置.jpg","hash":"e6f301bb3a08fcf1b27b8a2e80b97c4c28d878ab","modified":1683893956660},{"_id":"public/img/api-user.png","hash":"3d10df46dd351377f5f878a4fb6349293e0f8719","modified":1683893956660},{"_id":"public/img/ast.jpg","hash":"9da1e8119fe167fcb21fead4b2bdece7525ef44b","modified":1683893956660},{"_id":"public/img/home.jpg","hash":"c8122e63226ad58f1658d72b8a4afb8470008610","modified":1683893956660},{"_id":"public/img/micro-app.png","hash":"206759e4a90bf3db82decb012b8d1e41284dbc10","modified":1683893956660},{"_id":"public/img/web3-week3.jpg","hash":"37914c5820bc4ffcf58b53f60d73760557e6a7dd","modified":1683893956660},{"_id":"public/img/webcomponents.png","hash":"169116069e8b151b9e4aacb53ef2e0f9fbaeaabe","modified":1683893956660},{"_id":"public/demo/2023面试准备/img/ast.jpg","hash":"9da1e8119fe167fcb21fead4b2bdece7525ef44b","modified":1683893956660},{"_id":"public/img/wx.jpg","hash":"9d2bf9f895d4fdfdb43ca82ef779dd7c97204b7e","modified":1683893956660},{"_id":"public/img/压测log.png","hash":"896c4baeaf70ce4b86207fcfad8da7fb3e6cc4a8","modified":1683893956660},{"_id":"public/js/events.js","hash":"4b9d2676c9544db9cc40a8c7d18456792299ba86","modified":1683893956660},{"_id":"public/css/gitalk.css","hash":"a57b3cc8e04a0a4a27aefa07facf5b5e7bca0e76","modified":1683893956660},{"_id":"public/js/boot.js","hash":"3de344ee619da989f6dccf7c2ae459fe91075983","modified":1683893956660},{"_id":"public/js/color-schema.js","hash":"f1fdd512f3ef92ff5db4a49f5a3143d5ddea9858","modified":1683893956660},{"_id":"public/js/img-lazyload.js","hash":"cbdeca434ec4da51f488c821d51b4d23c73294af","modified":1683893956660},{"_id":"public/js/utils.js","hash":"4a43f2700e91937650bef511fd438825b001c4c6","modified":1683893956660},{"_id":"public/js/leancloud.js","hash":"53987b7a668ea0623370eb83ed5311766221b557","modified":1683893956660},{"_id":"public/js/local-search.js","hash":"633f0142c657805359b0197f287e12ae4bcde731","modified":1683893956660},{"_id":"public/js/plugins.js","hash":"d058f30bd09b28769c4d8313428ff23dfc8d52dd","modified":1683893956660},{"_id":"public/css/main.css","hash":"63bc59b8ca4b03afa2b93883143c349d461b1052","modified":1683893956660},{"_id":"public/img/import-scss-error.png","hash":"860c5db9c673dcc9995a2a008ae0b795bd841f16","modified":1683893956660},{"_id":"public/img/firewall.png","hash":"c0327a72d12eb59d0a7d74e3eacae7be3ce40c0b","modified":1683893956660},{"_id":"public/img/svg-sprite.png","hash":"de6ec0c5b85d36d57ad20456292557f8d88535c4","modified":1683893956660},{"_id":"public/img/压测结果.png","hash":"2b742d41cde38f58925c6dab27670d2c7b6036d5","modified":1683893956660},{"_id":"public/img/backend.jpg","hash":"bc2b477645818e51442f68247c31dab8cc28bace","modified":1683893956660},{"_id":"public/img/api-userinfo.png","hash":"eeb49d9df442599574950ad65fc2e90e0b88738d","modified":1683893956660},{"_id":"public/img/qiankun.png","hash":"cb3cf7dc83c47d0f771ee90ee808c5551ea5cf7b","modified":1683893956660},{"_id":"public/img/web3-week1.jpg","hash":"f9542a6ec82523ce0413df731950b6319989ea2c","modified":1683893956660},{"_id":"public/img/chicken.jpg","hash":"448fd479b78c02c8a4eeb3a8d8efcbbb09b82bb5","modified":1683893956660},{"_id":"public/img/render-10w-data.jpg","hash":"ea2c8c396847af90cf2b9d87b955859da7016c35","modified":1683893956660},{"_id":"public/img/theme-select.png","hash":"3569ae0c303c28f811e5c62c6474ee7eff32f0a9","modified":1683893956660},{"_id":"public/img/组合继承.jpg","hash":"1e99fbbebba1e5572b00584278cdea7983e2436f","modified":1683893956660},{"_id":"public/img/god.jpg","hash":"dd15799930cfbf9a222c2d8c1d6980d4da43adc6","modified":1683893956660},{"_id":"public/demo/2023面试准备/img/组合继承.jpg","hash":"1e99fbbebba1e5572b00584278cdea7983e2436f","modified":1683893956660},{"_id":"public/img/modules.jpg","hash":"3fc76083b9d69479affc18879496fe3dc8d29073","modified":1683893956660},{"_id":"public/img/primary.png","hash":"06b6a8b5a8216208f787d4a8e29bc99310e60699","modified":1683893956660},{"_id":"public/img/svg-sprite-result.png","hash":"b94411c7e3767c99e18f53c88a4e27a761f300a1","modified":1683893956660},{"_id":"public/demo/2023面试准备/img/babel.jpg","hash":"fd18a279d8da55d7ebc5101dbc033d60208de19d","modified":1683893956660},{"_id":"public/img/babel.jpg","hash":"fd18a279d8da55d7ebc5101dbc033d60208de19d","modified":1683893956660},{"_id":"public/img/city.jpg","hash":"085c7649b2838db2b6a831b043199dda61da17a6","modified":1683893956660}],"Category":[],"Data":[],"Page":[{"_content":"","source":"demo/2023面试准备/css.md","raw":"","date":"2023-05-12T10:49:20.020Z","updated":"2023-05-12T10:49:20.020Z","path":"demo/2023面试准备/css.html","title":"","comments":1,"layout":"page","_id":"clhkizgx100003y0qd9uj2q1t","content":"","site":{"data":{}},"wordcount":0,"excerpt":"","more":""},{"_content":"","source":"demo/2023面试准备/打包工具.md","raw":"","date":"2023-05-12T10:49:20.034Z","updated":"2023-05-12T10:49:20.034Z","path":"demo/2023面试准备/打包工具.html","title":"","comments":1,"layout":"page","_id":"clhkizgx300013y0qerxhb0u4","content":"","site":{"data":{}},"wordcount":0,"excerpt":"","more":""},{"title":"About ME","date":"2022-03-30T02:53:37.000Z","layout":"about","index_img":"/img/home.jpg","avatar":"/img/avatar.jpg","comment":false,"_content":"\n## Story\n\nA long time ago ...\n\n![](/img/mao.jpg)\n\nA cat is sleeping，very very deep sleeping...\n\nSuddently, He find a mouse ...\n\n![](https://gimg2.baidu.com/image_search/src=http%3A%2F%2Fpic.51yuansu.com%2Fpic3%2Fcover%2F03%2F51%2F82%2F5bc01a2651fb3_610.jpg&refer=http%3A%2F%2Fpic.51yuansu.com&app=2002&size=f9999,10000&q=a80&n=0&g=0n&fmt=auto?sec=1651212876&t=ad19572bcc6b1b6323b0ca790e14946e)\n\nGod damn it, a so cute mouse!\n\nHe don't want to eat he, play with he.\n","source":"about/index.md","raw":"---\ntitle: About ME\ndate: 2022-03-30 10:53:37\nlayout: about\nindex_img: /img/home.jpg\navatar: /img/avatar.jpg\ncomment: false\n---\n\n## Story\n\nA long time ago ...\n\n![](/img/mao.jpg)\n\nA cat is sleeping，very very deep sleeping...\n\nSuddently, He find a mouse ...\n\n![](https://gimg2.baidu.com/image_search/src=http%3A%2F%2Fpic.51yuansu.com%2Fpic3%2Fcover%2F03%2F51%2F82%2F5bc01a2651fb3_610.jpg&refer=http%3A%2F%2Fpic.51yuansu.com&app=2002&size=f9999,10000&q=a80&n=0&g=0n&fmt=auto?sec=1651212876&t=ad19572bcc6b1b6323b0ca790e14946e)\n\nGod damn it, a so cute mouse!\n\nHe don't want to eat he, play with he.\n","updated":"2023-05-12T10:49:20.018Z","path":"about/index.html","comments":1,"_id":"clhkizgx800023y0q6onk7d7p","content":"<h2 id=\"Story\"><a href=\"#Story\" class=\"headerlink\" title=\"Story\"></a>Story</h2><p>A long time ago …</p>\n<p><img src=\"/img/mao.jpg\" alt=\"\"></p>\n<p>A cat is sleeping，very very deep sleeping…</p>\n<p>Suddently, He find a mouse …</p>\n<p><img src=\"https://gimg2.baidu.com/image_search/src=http%3A%2F%2Fpic.51yuansu.com%2Fpic3%2Fcover%2F03%2F51%2F82%2F5bc01a2651fb3_610.jpg&refer=http%3A%2F%2Fpic.51yuansu.com&app=2002&size=f9999,10000&q=a80&n=0&g=0n&fmt=auto?sec=1651212876&t=ad19572bcc6b1b6323b0ca790e14946e\" alt=\"\"></p>\n<p>God damn it, a so cute mouse!</p>\n<p>He don’t want to eat he, play with he.</p>\n","site":{"data":{}},"wordcount":130,"excerpt":"","more":"<h2 id=\"Story\"><a href=\"#Story\" class=\"headerlink\" title=\"Story\"></a>Story</h2><p>A long time ago …</p>\n<p><img src=\"/img/mao.jpg\" alt=\"\"></p>\n<p>A cat is sleeping，very very deep sleeping…</p>\n<p>Suddently, He find a mouse …</p>\n<p><img src=\"https://gimg2.baidu.com/image_search/src=http%3A%2F%2Fpic.51yuansu.com%2Fpic3%2Fcover%2F03%2F51%2F82%2F5bc01a2651fb3_610.jpg&refer=http%3A%2F%2Fpic.51yuansu.com&app=2002&size=f9999,10000&q=a80&n=0&g=0n&fmt=auto?sec=1651212876&t=ad19572bcc6b1b6323b0ca790e14946e\" alt=\"\"></p>\n<p>God damn it, a so cute mouse!</p>\n<p>He don’t want to eat he, play with he.</p>\n"},{"_content":"<!DOCTYPE html>\n<html lang=\"en\">\n\n<head>\n  <meta charset=\"UTF-8\">\n  <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n  <title>观察者模式</title>\n  <style>\n    ul {\n      background-color: antiquewhite;\n    }\n\n    li {\n      background-color: aqua;\n      margin-top: 12px;\n    }\n\n  </style>\n</head>\n\n<body>\n  <h3>面包屑 <span class=\"bread\"></span></h3>\n\n  <hr />\n  <ul class=\"left\">\n    <li>1</li>\n    <li>2</li>\n    <li>3</li>\n  </ul>\n\n  <script>\n    // 目标\n    class Subject {\n      constructor() {\n        this.observers = []\n      }\n\n      add(ob) {\n        this.observers.push(ob)\n      }\n\n      notify(text) {\n        this.observers.forEach(o => {\n          o.update(text)\n        })\n      }\n    }\n\n    // 观察者\n    class Observer {\n      constructor(name) {\n        this.ele = document.querySelector(name)\n      }\n\n      update(text) {\n        this.ele.innerHTML = text\n      }\n    }\n\n    const s = new Subject()\n    const o1 = new Observer('.bread')\n\n    s.add(o1)\n\n    let oLi = document.querySelectorAll('.left li')\n    for (let i = 0; i < oLi.length; i++) {\n      oLi[i].onclick = function () {\n        s.notify(this.innerHTML)\n      }\n    }\n\n  </script>\n</body>\n\n</html>\n","source":"demo/ObserverMode.html","raw":"<!DOCTYPE html>\n<html lang=\"en\">\n\n<head>\n  <meta charset=\"UTF-8\">\n  <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n  <title>观察者模式</title>\n  <style>\n    ul {\n      background-color: antiquewhite;\n    }\n\n    li {\n      background-color: aqua;\n      margin-top: 12px;\n    }\n\n  </style>\n</head>\n\n<body>\n  <h3>面包屑 <span class=\"bread\"></span></h3>\n\n  <hr />\n  <ul class=\"left\">\n    <li>1</li>\n    <li>2</li>\n    <li>3</li>\n  </ul>\n\n  <script>\n    // 目标\n    class Subject {\n      constructor() {\n        this.observers = []\n      }\n\n      add(ob) {\n        this.observers.push(ob)\n      }\n\n      notify(text) {\n        this.observers.forEach(o => {\n          o.update(text)\n        })\n      }\n    }\n\n    // 观察者\n    class Observer {\n      constructor(name) {\n        this.ele = document.querySelector(name)\n      }\n\n      update(text) {\n        this.ele.innerHTML = text\n      }\n    }\n\n    const s = new Subject()\n    const o1 = new Observer('.bread')\n\n    s.add(o1)\n\n    let oLi = document.querySelectorAll('.left li')\n    for (let i = 0; i < oLi.length; i++) {\n      oLi[i].onclick = function () {\n        s.notify(this.innerHTML)\n      }\n    }\n\n  </script>\n</body>\n\n</html>\n","date":"2023-05-12T10:49:20.035Z","updated":"2023-05-12T10:49:20.035Z","path":"demo/ObserverMode.html","title":"","comments":1,"layout":"page","_id":"clhkizgxb00043y0q9sop7z2f","content":"<!DOCTYPE html>\n<html lang=\"en\">\n\n<head>\n  <meta charset=\"UTF-8\">\n  <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n  <title>观察者模式</title>\n  <style>\n    ul {\n      background-color: antiquewhite;\n    }\n\n    li {\n      background-color: aqua;\n      margin-top: 12px;\n    }\n\n  </style>\n</head>\n\n<body>\n  <h3>面包屑 <span class=\"bread\"></span></h3>\n\n  <hr />\n  <ul class=\"left\">\n    <li>1</li>\n    <li>2</li>\n    <li>3</li>\n  </ul>\n\n  <script>\n    // 目标\n    class Subject {\n      constructor() {\n        this.observers = []\n      }\n\n      add(ob) {\n        this.observers.push(ob)\n      }\n\n      notify(text) {\n        this.observers.forEach(o => {\n          o.update(text)\n        })\n      }\n    }\n\n    // 观察者\n    class Observer {\n      constructor(name) {\n        this.ele = document.querySelector(name)\n      }\n\n      update(text) {\n        this.ele.innerHTML = text\n      }\n    }\n\n    const s = new Subject()\n    const o1 = new Observer('.bread')\n\n    s.add(o1)\n\n    let oLi = document.querySelectorAll('.left li')\n    for (let i = 0; i < oLi.length; i++) {\n      oLi[i].onclick = function () {\n        s.notify(this.innerHTML)\n      }\n    }\n\n  </script>\n</body>\n\n</html>\n","site":{"data":{}},"wordcount":520,"excerpt":"","more":"<!DOCTYPE html>\n<html lang=\"en\">\n\n<head>\n  <meta charset=\"UTF-8\">\n  <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n  <title>观察者模式</title>\n  <style>\n    ul {\n      background-color: antiquewhite;\n    }\n\n    li {\n      background-color: aqua;\n      margin-top: 12px;\n    }\n\n  </style>\n</head>\n\n<body>\n  <h3>面包屑 <span class=\"bread\"></span></h3>\n\n  <hr />\n  <ul class=\"left\">\n    <li>1</li>\n    <li>2</li>\n    <li>3</li>\n  </ul>\n\n  <script>\n    // 目标\n    class Subject {\n      constructor() {\n        this.observers = []\n      }\n\n      add(ob) {\n        this.observers.push(ob)\n      }\n\n      notify(text) {\n        this.observers.forEach(o => {\n          o.update(text)\n        })\n      }\n    }\n\n    // 观察者\n    class Observer {\n      constructor(name) {\n        this.ele = document.querySelector(name)\n      }\n\n      update(text) {\n        this.ele.innerHTML = text\n      }\n    }\n\n    const s = new Subject()\n    const o1 = new Observer('.bread')\n\n    s.add(o1)\n\n    let oLi = document.querySelectorAll('.left li')\n    for (let i = 0; i < oLi.length; i++) {\n      oLi[i].onclick = function () {\n        s.notify(this.innerHTML)\n      }\n    }\n\n  </script>\n</body>\n\n</html>\n"},{"_content":"<!DOCTYPE html>\n<html lang=\"en\">\n<head>\n  <meta charset=\"UTF-8\">\n  <meta http-equiv=\"X-UA-Compatible\" content=\"IE=edge\">\n  <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n  <title>Vue3 响应式原理</title>\n</head>\n<body>\n  <script>\n    // 定义一个存储副作用函数的集合，每次设置对象时，我们就会取出集合里面的副作用函数，并执行\n    const bucket = new Set()\n\n    const data = {\n      text: 'helloworld'\n    }\n\n    const obj = new Proxy(data, {\n      get(target, key) {\n        // 添加副作用函数\n        // 每一次触发 get 方法，都会向 集合 中添加一次 effect 方法\n        // 但是集合是不会存储相同的值的（包括相同的内存地址）\n        // 所以这里每一次执行 bucket.add 方法，因为 effect 地址没变，所以里面一直只会有一个副作用函数。\n        bucket.add(effect)\n\n        return target[key]\n      },\n      set(target, key, val) {\n        target[key] = val\n\n        // 批量执行副作用函数\n        bucket.forEach(fn => fn())\n\n        return true\n      }\n    })\n\n    // 执行副作用函数，会触发代理对象的 get 方法，从而收集到副作用函数\n    const effect = () => {\n      document.body.innerHTML = obj.text\n    }\n\n    effect()\n\n    // 一秒钟后，我们执行 代理对象的 set 操作，出发 set 方法\n    setTimeout(() => {\n      obj.text = 'update obj text'\n\n      console.log('??',bucket)\n    }, 1000);\n  </script>\n</body>\n</html>","source":"demo/Vue3Reactive.html","raw":"<!DOCTYPE html>\n<html lang=\"en\">\n<head>\n  <meta charset=\"UTF-8\">\n  <meta http-equiv=\"X-UA-Compatible\" content=\"IE=edge\">\n  <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n  <title>Vue3 响应式原理</title>\n</head>\n<body>\n  <script>\n    // 定义一个存储副作用函数的集合，每次设置对象时，我们就会取出集合里面的副作用函数，并执行\n    const bucket = new Set()\n\n    const data = {\n      text: 'helloworld'\n    }\n\n    const obj = new Proxy(data, {\n      get(target, key) {\n        // 添加副作用函数\n        // 每一次触发 get 方法，都会向 集合 中添加一次 effect 方法\n        // 但是集合是不会存储相同的值的（包括相同的内存地址）\n        // 所以这里每一次执行 bucket.add 方法，因为 effect 地址没变，所以里面一直只会有一个副作用函数。\n        bucket.add(effect)\n\n        return target[key]\n      },\n      set(target, key, val) {\n        target[key] = val\n\n        // 批量执行副作用函数\n        bucket.forEach(fn => fn())\n\n        return true\n      }\n    })\n\n    // 执行副作用函数，会触发代理对象的 get 方法，从而收集到副作用函数\n    const effect = () => {\n      document.body.innerHTML = obj.text\n    }\n\n    effect()\n\n    // 一秒钟后，我们执行 代理对象的 set 操作，出发 set 方法\n    setTimeout(() => {\n      obj.text = 'update obj text'\n\n      console.log('??',bucket)\n    }, 1000);\n  </script>\n</body>\n</html>","date":"2023-05-12T10:49:20.035Z","updated":"2023-05-12T10:49:20.035Z","path":"demo/Vue3Reactive.html","title":"","comments":1,"layout":"page","_id":"clhkizgxd00073y0q4pqr916e","content":"<!DOCTYPE html>\n<html lang=\"en\">\n<head>\n  <meta charset=\"UTF-8\">\n  <meta http-equiv=\"X-UA-Compatible\" content=\"IE=edge\">\n  <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n  <title>Vue3 响应式原理</title>\n</head>\n<body>\n  <script>\n    // 定义一个存储副作用函数的集合，每次设置对象时，我们就会取出集合里面的副作用函数，并执行\n    const bucket = new Set()\n\n    const data = {\n      text: 'helloworld'\n    }\n\n    const obj = new Proxy(data, {\n      get(target, key) {\n        // 添加副作用函数\n        // 每一次触发 get 方法，都会向 集合 中添加一次 effect 方法\n        // 但是集合是不会存储相同的值的（包括相同的内存地址）\n        // 所以这里每一次执行 bucket.add 方法，因为 effect 地址没变，所以里面一直只会有一个副作用函数。\n        bucket.add(effect)\n\n        return target[key]\n      },\n      set(target, key, val) {\n        target[key] = val\n\n        // 批量执行副作用函数\n        bucket.forEach(fn => fn())\n\n        return true\n      }\n    })\n\n    // 执行副作用函数，会触发代理对象的 get 方法，从而收集到副作用函数\n    const effect = () => {\n      document.body.innerHTML = obj.text\n    }\n\n    effect()\n\n    // 一秒钟后，我们执行 代理对象的 set 操作，出发 set 方法\n    setTimeout(() => {\n      obj.text = 'update obj text'\n\n      console.log('??',bucket)\n    }, 1000);\n  </script>\n</body>\n</html>","site":{"data":{}},"wordcount":577,"excerpt":"","more":"<!DOCTYPE html>\n<html lang=\"en\">\n<head>\n  <meta charset=\"UTF-8\">\n  <meta http-equiv=\"X-UA-Compatible\" content=\"IE=edge\">\n  <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n  <title>Vue3 响应式原理</title>\n</head>\n<body>\n  <script>\n    // 定义一个存储副作用函数的集合，每次设置对象时，我们就会取出集合里面的副作用函数，并执行\n    const bucket = new Set()\n\n    const data = {\n      text: 'helloworld'\n    }\n\n    const obj = new Proxy(data, {\n      get(target, key) {\n        // 添加副作用函数\n        // 每一次触发 get 方法，都会向 集合 中添加一次 effect 方法\n        // 但是集合是不会存储相同的值的（包括相同的内存地址）\n        // 所以这里每一次执行 bucket.add 方法，因为 effect 地址没变，所以里面一直只会有一个副作用函数。\n        bucket.add(effect)\n\n        return target[key]\n      },\n      set(target, key, val) {\n        target[key] = val\n\n        // 批量执行副作用函数\n        bucket.forEach(fn => fn())\n\n        return true\n      }\n    })\n\n    // 执行副作用函数，会触发代理对象的 get 方法，从而收集到副作用函数\n    const effect = () => {\n      document.body.innerHTML = obj.text\n    }\n\n    effect()\n\n    // 一秒钟后，我们执行 代理对象的 set 操作，出发 set 方法\n    setTimeout(() => {\n      obj.text = 'update obj text'\n\n      console.log('??',bucket)\n    }, 1000);\n  </script>\n</body>\n</html>"},{"_content":"<!DOCTYPE html>\n<html lang=\"en\">\n<head>\n  <meta charset=\"UTF-8\">\n  <meta http-equiv=\"X-UA-Compatible\" content=\"IE=edge\">\n  <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n  <title>Document</title>\n</head>\n<body>\n  <script>\n\n    let activeEffect = undefined\n\n    const data = {\n      text: 'hello world @.@'\n    }\n\n    function effect(fn) {\n      activeEffect = fn\n      fn()\n    }\n\n    const bucket = new WeakMap() // target => Map\n\n    const obj = new Proxy(data, {\n      get(target, key) {\n\n        if (!activeEffect) return target[key]\n\n        let depsMap = bucket.get(target)\n\n        if (!depsMap) {\n          // 关联 target 和 Map\n          bucket.set(target, depsMap = new Map())\n        }\n\n        let deps = depsMap.get(key)\n\n        if (!deps) {\n          // 依赖集合\n          depsMap.set(key, deps = new Set())\n        }\n\n        deps.add(activeEffect)\n\n        return target[key]\n      },\n      set(target, key, val) {\n        target[key] = val\n\n        const depsMap = bucket.get(target)\n\n        console.log('depsMap ', depsMap)\n\n        if (!depsMap) return\n \n        let effects = depsMap.get(key)\n\n        effects && effects.forEach(fn => fn())\n      }\n    })\n\n    // 注册副作用函数\n    effect(() => {\n      console.log('text effect')\n      document.body.innerHTML = obj.text // 读取\n    })\n\n    // effect(() => {\n    //   console.log('title effect')\n    //   obj.title = '标题123'\n    //   // document.title = obj.title // 读取\n    // })\n\n    setTimeout(() => {\n      obj.notExist = 'hello vue3'\n    }, 1000)\n\n  </script>\n</body>\n</html>","source":"demo/Vue3Reactive1.html","raw":"<!DOCTYPE html>\n<html lang=\"en\">\n<head>\n  <meta charset=\"UTF-8\">\n  <meta http-equiv=\"X-UA-Compatible\" content=\"IE=edge\">\n  <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n  <title>Document</title>\n</head>\n<body>\n  <script>\n\n    let activeEffect = undefined\n\n    const data = {\n      text: 'hello world @.@'\n    }\n\n    function effect(fn) {\n      activeEffect = fn\n      fn()\n    }\n\n    const bucket = new WeakMap() // target => Map\n\n    const obj = new Proxy(data, {\n      get(target, key) {\n\n        if (!activeEffect) return target[key]\n\n        let depsMap = bucket.get(target)\n\n        if (!depsMap) {\n          // 关联 target 和 Map\n          bucket.set(target, depsMap = new Map())\n        }\n\n        let deps = depsMap.get(key)\n\n        if (!deps) {\n          // 依赖集合\n          depsMap.set(key, deps = new Set())\n        }\n\n        deps.add(activeEffect)\n\n        return target[key]\n      },\n      set(target, key, val) {\n        target[key] = val\n\n        const depsMap = bucket.get(target)\n\n        console.log('depsMap ', depsMap)\n\n        if (!depsMap) return\n \n        let effects = depsMap.get(key)\n\n        effects && effects.forEach(fn => fn())\n      }\n    })\n\n    // 注册副作用函数\n    effect(() => {\n      console.log('text effect')\n      document.body.innerHTML = obj.text // 读取\n    })\n\n    // effect(() => {\n    //   console.log('title effect')\n    //   obj.title = '标题123'\n    //   // document.title = obj.title // 读取\n    // })\n\n    setTimeout(() => {\n      obj.notExist = 'hello vue3'\n    }, 1000)\n\n  </script>\n</body>\n</html>","date":"2023-05-12T10:49:20.035Z","updated":"2023-05-12T10:49:20.035Z","path":"demo/Vue3Reactive1.html","title":"","comments":1,"layout":"page","_id":"clhkizgxe00093y0q72azg0m2","content":"<!DOCTYPE html>\n<html lang=\"en\">\n<head>\n  <meta charset=\"UTF-8\">\n  <meta http-equiv=\"X-UA-Compatible\" content=\"IE=edge\">\n  <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n  <title>Document</title>\n</head>\n<body>\n  <script>\n\n    let activeEffect = undefined\n\n    const data = {\n      text: 'hello world @.@'\n    }\n\n    function effect(fn) {\n      activeEffect = fn\n      fn()\n    }\n\n    const bucket = new WeakMap() // target => Map\n\n    const obj = new Proxy(data, {\n      get(target, key) {\n\n        if (!activeEffect) return target[key]\n\n        let depsMap = bucket.get(target)\n\n        if (!depsMap) {\n          // 关联 target 和 Map\n          bucket.set(target, depsMap = new Map())\n        }\n\n        let deps = depsMap.get(key)\n\n        if (!deps) {\n          // 依赖集合\n          depsMap.set(key, deps = new Set())\n        }\n\n        deps.add(activeEffect)\n\n        return target[key]\n      },\n      set(target, key, val) {\n        target[key] = val\n\n        const depsMap = bucket.get(target)\n\n        console.log('depsMap ', depsMap)\n\n        if (!depsMap) return\n \n        let effects = depsMap.get(key)\n\n        effects && effects.forEach(fn => fn())\n      }\n    })\n\n    // 注册副作用函数\n    effect(() => {\n      console.log('text effect')\n      document.body.innerHTML = obj.text // 读取\n    })\n\n    // effect(() => {\n    //   console.log('title effect')\n    //   obj.title = '标题123'\n    //   // document.title = obj.title // 读取\n    // })\n\n    setTimeout(() => {\n      obj.notExist = 'hello vue3'\n    }, 1000)\n\n  </script>\n</body>\n</html>","site":{"data":{}},"wordcount":825,"excerpt":"","more":"<!DOCTYPE html>\n<html lang=\"en\">\n<head>\n  <meta charset=\"UTF-8\">\n  <meta http-equiv=\"X-UA-Compatible\" content=\"IE=edge\">\n  <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n  <title>Document</title>\n</head>\n<body>\n  <script>\n\n    let activeEffect = undefined\n\n    const data = {\n      text: 'hello world @.@'\n    }\n\n    function effect(fn) {\n      activeEffect = fn\n      fn()\n    }\n\n    const bucket = new WeakMap() // target => Map\n\n    const obj = new Proxy(data, {\n      get(target, key) {\n\n        if (!activeEffect) return target[key]\n\n        let depsMap = bucket.get(target)\n\n        if (!depsMap) {\n          // 关联 target 和 Map\n          bucket.set(target, depsMap = new Map())\n        }\n\n        let deps = depsMap.get(key)\n\n        if (!deps) {\n          // 依赖集合\n          depsMap.set(key, deps = new Set())\n        }\n\n        deps.add(activeEffect)\n\n        return target[key]\n      },\n      set(target, key, val) {\n        target[key] = val\n\n        const depsMap = bucket.get(target)\n\n        console.log('depsMap ', depsMap)\n\n        if (!depsMap) return\n \n        let effects = depsMap.get(key)\n\n        effects && effects.forEach(fn => fn())\n      }\n    })\n\n    // 注册副作用函数\n    effect(() => {\n      console.log('text effect')\n      document.body.innerHTML = obj.text // 读取\n    })\n\n    // effect(() => {\n    //   console.log('title effect')\n    //   obj.title = '标题123'\n    //   // document.title = obj.title // 读取\n    // })\n\n    setTimeout(() => {\n      obj.notExist = 'hello vue3'\n    }, 1000)\n\n  </script>\n</body>\n</html>"},{"_content":"<!DOCTYPE html>\n<html lang=\"en\">\n<head>\n  <meta charset=\"UTF-8\">\n  <meta http-equiv=\"X-UA-Compatible\" content=\"IE=edge\">\n  <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n  <title>收集 key 的依赖</title>\n</head>\n<body>\n  \n  <script>\n    // 存储被注册的副作用函数\n    let activeEffect;\n\n    const data = {\n      ok: true,\n      text: 'hello world'\n    }\n\n    const bucket = new WeakMap() // target => Map\n\n    const obj = new Proxy(data, {\n      get(target, key) {\n        // 追踪依赖\n        track(target, key)\n        return target[key]\n      },\n      set(target, key, value) {\n        target[key] = value\n        // 触发依赖\n        trigger(target, key)\n      }\n    })\n\n\n    function track(target, key) {\n      if (!activeEffect) return target[key]\n      let depsMap = bucket.get(target)\n\n      if (!depsMap) {\n        bucket.set(target, depsMap = new Map())\n      }\n\n      let deps = depsMap.get(key)\n\n      if (!deps) {\n        depsMap.set(key, deps = new Set())\n      }\n\n      // 添加副作用函数\n      deps.add(activeEffect)\n\n      // deps 存储与该副作用函数相关联的依赖集合\n      // 将来在 cleanup 中通过 activeEffect.deps[i] delete effectFn 时，其实，就是将 deps 中的副作用函数删除了\n      activeEffect.deps.push(deps)\n    }\n\n    function trigger(target, key) {\n      const depsMap = bucket.get(target)\n\n      if (!depsMap) return\n\n      const effects = depsMap.get(key)\n      const effectsToRun = new Set(effects)\n\n      // effects && effects.forEach(fn => fn())\n      effectsToRun && effectsToRun.forEach(fn => fn())\n    }\n\n    function effect(fn) {\n      function effectFn() {\n        activeEffect = effectFn\n\n        cleanup(effectFn)\n        fn()\n      }\n\n      effectFn.deps = [] // 存储所有包含当前副作用函数的依赖 集合，在 get 拦截函数中处理 deps\n\n      effectFn()\n    }\n\n    function cleanup(effectFn) {\n\n      console.log('effectFn ', effectFn.deps)\n      // 我们删除 effectFn.deps[i] 中的 effectFn，其实就是删除了 'xxx'(key) 中对应的依赖集合的副作用函数\n      // effectFn.deps[i] 中，存放的依赖集合，和 Map key 对应的依赖集合，是同一个集合，删除某一项，自然会影响到另一个\n      // 当我们在 trigger 中执行 effects 时，就是执行副作用函数\n      // 这个时候，会执行 cleanup，删除所有的 key 对应的副作用函数，最后执行 fn，重新走 属性的读取逻辑，触发 get 方法，重新收集依赖\n      // 当我们设置 obj.ok = false 后，不会再读取 obj.text 了，从而不会对其 key 收集依赖。\n      for(let i = 0; i < effectFn.deps.length; i++) {\n        const deps = effectFn.deps[i]\n\n        deps.delete(effectFn)\n      }\n\n      effectFn.deps.length = 0\n    }\n\n    effect(() => {\n      console.log(' obj.ok',  obj.ok)\n      // obj.ok = true 会触发 obj 的 get拦截方法，并且通过 track 函数收集到了副作用函数，并且将其存储在 deps 中\n      document.body.innerHTML = obj.ok ? obj.text : 'ok not'\n    })\n\n\n    setTimeout(() => {\n      // obj.text = 'Vue3 Reactive'\n      obj.ok = false\n\n      console.log('bucket ', bucket)\n    }, 1000)\n\n    // setTimeout(() => {\n    //   console.log('执行了')\n    //   obj.text = 'Vue3 Reactive'\n    // }, 3000)\n\n\n  </script>\n</body>\n</html>","source":"demo/Vue3Reactive2.html","raw":"<!DOCTYPE html>\n<html lang=\"en\">\n<head>\n  <meta charset=\"UTF-8\">\n  <meta http-equiv=\"X-UA-Compatible\" content=\"IE=edge\">\n  <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n  <title>收集 key 的依赖</title>\n</head>\n<body>\n  \n  <script>\n    // 存储被注册的副作用函数\n    let activeEffect;\n\n    const data = {\n      ok: true,\n      text: 'hello world'\n    }\n\n    const bucket = new WeakMap() // target => Map\n\n    const obj = new Proxy(data, {\n      get(target, key) {\n        // 追踪依赖\n        track(target, key)\n        return target[key]\n      },\n      set(target, key, value) {\n        target[key] = value\n        // 触发依赖\n        trigger(target, key)\n      }\n    })\n\n\n    function track(target, key) {\n      if (!activeEffect) return target[key]\n      let depsMap = bucket.get(target)\n\n      if (!depsMap) {\n        bucket.set(target, depsMap = new Map())\n      }\n\n      let deps = depsMap.get(key)\n\n      if (!deps) {\n        depsMap.set(key, deps = new Set())\n      }\n\n      // 添加副作用函数\n      deps.add(activeEffect)\n\n      // deps 存储与该副作用函数相关联的依赖集合\n      // 将来在 cleanup 中通过 activeEffect.deps[i] delete effectFn 时，其实，就是将 deps 中的副作用函数删除了\n      activeEffect.deps.push(deps)\n    }\n\n    function trigger(target, key) {\n      const depsMap = bucket.get(target)\n\n      if (!depsMap) return\n\n      const effects = depsMap.get(key)\n      const effectsToRun = new Set(effects)\n\n      // effects && effects.forEach(fn => fn())\n      effectsToRun && effectsToRun.forEach(fn => fn())\n    }\n\n    function effect(fn) {\n      function effectFn() {\n        activeEffect = effectFn\n\n        cleanup(effectFn)\n        fn()\n      }\n\n      effectFn.deps = [] // 存储所有包含当前副作用函数的依赖 集合，在 get 拦截函数中处理 deps\n\n      effectFn()\n    }\n\n    function cleanup(effectFn) {\n\n      console.log('effectFn ', effectFn.deps)\n      // 我们删除 effectFn.deps[i] 中的 effectFn，其实就是删除了 'xxx'(key) 中对应的依赖集合的副作用函数\n      // effectFn.deps[i] 中，存放的依赖集合，和 Map key 对应的依赖集合，是同一个集合，删除某一项，自然会影响到另一个\n      // 当我们在 trigger 中执行 effects 时，就是执行副作用函数\n      // 这个时候，会执行 cleanup，删除所有的 key 对应的副作用函数，最后执行 fn，重新走 属性的读取逻辑，触发 get 方法，重新收集依赖\n      // 当我们设置 obj.ok = false 后，不会再读取 obj.text 了，从而不会对其 key 收集依赖。\n      for(let i = 0; i < effectFn.deps.length; i++) {\n        const deps = effectFn.deps[i]\n\n        deps.delete(effectFn)\n      }\n\n      effectFn.deps.length = 0\n    }\n\n    effect(() => {\n      console.log(' obj.ok',  obj.ok)\n      // obj.ok = true 会触发 obj 的 get拦截方法，并且通过 track 函数收集到了副作用函数，并且将其存储在 deps 中\n      document.body.innerHTML = obj.ok ? obj.text : 'ok not'\n    })\n\n\n    setTimeout(() => {\n      // obj.text = 'Vue3 Reactive'\n      obj.ok = false\n\n      console.log('bucket ', bucket)\n    }, 1000)\n\n    // setTimeout(() => {\n    //   console.log('执行了')\n    //   obj.text = 'Vue3 Reactive'\n    // }, 3000)\n\n\n  </script>\n</body>\n</html>","date":"2023-05-12T10:49:20.036Z","updated":"2023-05-12T10:49:20.036Z","path":"demo/Vue3Reactive2.html","title":"","comments":1,"layout":"page","_id":"clhkizgxf000b3y0q4m455i2v","content":"<!DOCTYPE html>\n<html lang=\"en\">\n<head>\n  <meta charset=\"UTF-8\">\n  <meta http-equiv=\"X-UA-Compatible\" content=\"IE=edge\">\n  <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n  <title>收集 key 的依赖</title>\n</head>\n<body>\n  \n  <script>\n    // 存储被注册的副作用函数\n    let activeEffect;\n\n    const data = {\n      ok: true,\n      text: 'hello world'\n    }\n\n    const bucket = new WeakMap() // target => Map\n\n    const obj = new Proxy(data, {\n      get(target, key) {\n        // 追踪依赖\n        track(target, key)\n        return target[key]\n      },\n      set(target, key, value) {\n        target[key] = value\n        // 触发依赖\n        trigger(target, key)\n      }\n    })\n\n\n    function track(target, key) {\n      if (!activeEffect) return target[key]\n      let depsMap = bucket.get(target)\n\n      if (!depsMap) {\n        bucket.set(target, depsMap = new Map())\n      }\n\n      let deps = depsMap.get(key)\n\n      if (!deps) {\n        depsMap.set(key, deps = new Set())\n      }\n\n      // 添加副作用函数\n      deps.add(activeEffect)\n\n      // deps 存储与该副作用函数相关联的依赖集合\n      // 将来在 cleanup 中通过 activeEffect.deps[i] delete effectFn 时，其实，就是将 deps 中的副作用函数删除了\n      activeEffect.deps.push(deps)\n    }\n\n    function trigger(target, key) {\n      const depsMap = bucket.get(target)\n\n      if (!depsMap) return\n\n      const effects = depsMap.get(key)\n      const effectsToRun = new Set(effects)\n\n      // effects && effects.forEach(fn => fn())\n      effectsToRun && effectsToRun.forEach(fn => fn())\n    }\n\n    function effect(fn) {\n      function effectFn() {\n        activeEffect = effectFn\n\n        cleanup(effectFn)\n        fn()\n      }\n\n      effectFn.deps = [] // 存储所有包含当前副作用函数的依赖 集合，在 get 拦截函数中处理 deps\n\n      effectFn()\n    }\n\n    function cleanup(effectFn) {\n\n      console.log('effectFn ', effectFn.deps)\n      // 我们删除 effectFn.deps[i] 中的 effectFn，其实就是删除了 'xxx'(key) 中对应的依赖集合的副作用函数\n      // effectFn.deps[i] 中，存放的依赖集合，和 Map key 对应的依赖集合，是同一个集合，删除某一项，自然会影响到另一个\n      // 当我们在 trigger 中执行 effects 时，就是执行副作用函数\n      // 这个时候，会执行 cleanup，删除所有的 key 对应的副作用函数，最后执行 fn，重新走 属性的读取逻辑，触发 get 方法，重新收集依赖\n      // 当我们设置 obj.ok = false 后，不会再读取 obj.text 了，从而不会对其 key 收集依赖。\n      for(let i = 0; i < effectFn.deps.length; i++) {\n        const deps = effectFn.deps[i]\n\n        deps.delete(effectFn)\n      }\n\n      effectFn.deps.length = 0\n    }\n\n    effect(() => {\n      console.log(' obj.ok',  obj.ok)\n      // obj.ok = true 会触发 obj 的 get拦截方法，并且通过 track 函数收集到了副作用函数，并且将其存储在 deps 中\n      document.body.innerHTML = obj.ok ? obj.text : 'ok not'\n    })\n\n\n    setTimeout(() => {\n      // obj.text = 'Vue3 Reactive'\n      obj.ok = false\n\n      console.log('bucket ', bucket)\n    }, 1000)\n\n    // setTimeout(() => {\n    //   console.log('执行了')\n    //   obj.text = 'Vue3 Reactive'\n    // }, 3000)\n\n\n  </script>\n</body>\n</html>","site":{"data":{}},"wordcount":1744,"excerpt":"","more":"<!DOCTYPE html>\n<html lang=\"en\">\n<head>\n  <meta charset=\"UTF-8\">\n  <meta http-equiv=\"X-UA-Compatible\" content=\"IE=edge\">\n  <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n  <title>收集 key 的依赖</title>\n</head>\n<body>\n  \n  <script>\n    // 存储被注册的副作用函数\n    let activeEffect;\n\n    const data = {\n      ok: true,\n      text: 'hello world'\n    }\n\n    const bucket = new WeakMap() // target => Map\n\n    const obj = new Proxy(data, {\n      get(target, key) {\n        // 追踪依赖\n        track(target, key)\n        return target[key]\n      },\n      set(target, key, value) {\n        target[key] = value\n        // 触发依赖\n        trigger(target, key)\n      }\n    })\n\n\n    function track(target, key) {\n      if (!activeEffect) return target[key]\n      let depsMap = bucket.get(target)\n\n      if (!depsMap) {\n        bucket.set(target, depsMap = new Map())\n      }\n\n      let deps = depsMap.get(key)\n\n      if (!deps) {\n        depsMap.set(key, deps = new Set())\n      }\n\n      // 添加副作用函数\n      deps.add(activeEffect)\n\n      // deps 存储与该副作用函数相关联的依赖集合\n      // 将来在 cleanup 中通过 activeEffect.deps[i] delete effectFn 时，其实，就是将 deps 中的副作用函数删除了\n      activeEffect.deps.push(deps)\n    }\n\n    function trigger(target, key) {\n      const depsMap = bucket.get(target)\n\n      if (!depsMap) return\n\n      const effects = depsMap.get(key)\n      const effectsToRun = new Set(effects)\n\n      // effects && effects.forEach(fn => fn())\n      effectsToRun && effectsToRun.forEach(fn => fn())\n    }\n\n    function effect(fn) {\n      function effectFn() {\n        activeEffect = effectFn\n\n        cleanup(effectFn)\n        fn()\n      }\n\n      effectFn.deps = [] // 存储所有包含当前副作用函数的依赖 集合，在 get 拦截函数中处理 deps\n\n      effectFn()\n    }\n\n    function cleanup(effectFn) {\n\n      console.log('effectFn ', effectFn.deps)\n      // 我们删除 effectFn.deps[i] 中的 effectFn，其实就是删除了 'xxx'(key) 中对应的依赖集合的副作用函数\n      // effectFn.deps[i] 中，存放的依赖集合，和 Map key 对应的依赖集合，是同一个集合，删除某一项，自然会影响到另一个\n      // 当我们在 trigger 中执行 effects 时，就是执行副作用函数\n      // 这个时候，会执行 cleanup，删除所有的 key 对应的副作用函数，最后执行 fn，重新走 属性的读取逻辑，触发 get 方法，重新收集依赖\n      // 当我们设置 obj.ok = false 后，不会再读取 obj.text 了，从而不会对其 key 收集依赖。\n      for(let i = 0; i < effectFn.deps.length; i++) {\n        const deps = effectFn.deps[i]\n\n        deps.delete(effectFn)\n      }\n\n      effectFn.deps.length = 0\n    }\n\n    effect(() => {\n      console.log(' obj.ok',  obj.ok)\n      // obj.ok = true 会触发 obj 的 get拦截方法，并且通过 track 函数收集到了副作用函数，并且将其存储在 deps 中\n      document.body.innerHTML = obj.ok ? obj.text : 'ok not'\n    })\n\n\n    setTimeout(() => {\n      // obj.text = 'Vue3 Reactive'\n      obj.ok = false\n\n      console.log('bucket ', bucket)\n    }, 1000)\n\n    // setTimeout(() => {\n    //   console.log('执行了')\n    //   obj.text = 'Vue3 Reactive'\n    // }, 3000)\n\n\n  </script>\n</body>\n</html>"},{"_content":"<!DOCTYPE html>\n<html lang=\"en\">\n\n<head>\n  <meta charset=\"UTF-8\">\n  <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n  <title>发布订阅者模式</title>\n  <style>\n    ul {\n      background-color: antiquewhite;\n    }\n\n    li {\n      background-color: aqua;\n      margin-top: 12px;\n    }\n\n  </style>\n</head>\n\n<body>\n  <h3>面包屑 <span class=\"bread\"></span></h3>\n\n  <hr />\n  <ul class=\"left\">\n    <li>1</li>\n    <li>2</li>\n    <li>3</li>\n  </ul>\n\n  <script>\n    const PubSub = {\n      message: {}, // 将事件存储数组，改成对象，key 表示事件类型，value 表示订阅的事件数组\n      publist(type, text) {\n        if (!this.message[type]) return\n\n        this.message[type].forEach(cb => {\n          cb(text)\n        })\n      },\n      subscribe(type, cb) {\n        if (!this.message[type]) {\n          this.message[type] = [cb] // 如果事件 type 不存在，我们就创建一个事件类型数组\n        } else {\n          this.message[type].push(cb)\n        }\n      },\n      unsubscribe(type, cb) {\n        // 取消订阅\n        if (!this.message[type]) return\n\n        if (!cb) {\n          // 取消所有订阅的事件\n          this.message[type] = []\n        } else {\n          this.message[type] = this.message[type].filter(i => i !== cb)\n        }\n      }\n    }\n\n    PubSub.subscribe('updateBread', function (text) {\n      const breadEle = document.querySelector('.bread')\n      breadEle.innerHTML = text\n    })\n\n    let oLi = document.querySelectorAll('.left li')\n    for (let i = 0; i < oLi.length; i++) {\n      oLi[i].onclick = function () {\n        PubSub.publist('updateBread', this.innerHTML)\n      }\n    }\n\n  </script>\n</body>\n\n</html>\n","source":"demo/PubSubMode.html","raw":"<!DOCTYPE html>\n<html lang=\"en\">\n\n<head>\n  <meta charset=\"UTF-8\">\n  <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n  <title>发布订阅者模式</title>\n  <style>\n    ul {\n      background-color: antiquewhite;\n    }\n\n    li {\n      background-color: aqua;\n      margin-top: 12px;\n    }\n\n  </style>\n</head>\n\n<body>\n  <h3>面包屑 <span class=\"bread\"></span></h3>\n\n  <hr />\n  <ul class=\"left\">\n    <li>1</li>\n    <li>2</li>\n    <li>3</li>\n  </ul>\n\n  <script>\n    const PubSub = {\n      message: {}, // 将事件存储数组，改成对象，key 表示事件类型，value 表示订阅的事件数组\n      publist(type, text) {\n        if (!this.message[type]) return\n\n        this.message[type].forEach(cb => {\n          cb(text)\n        })\n      },\n      subscribe(type, cb) {\n        if (!this.message[type]) {\n          this.message[type] = [cb] // 如果事件 type 不存在，我们就创建一个事件类型数组\n        } else {\n          this.message[type].push(cb)\n        }\n      },\n      unsubscribe(type, cb) {\n        // 取消订阅\n        if (!this.message[type]) return\n\n        if (!cb) {\n          // 取消所有订阅的事件\n          this.message[type] = []\n        } else {\n          this.message[type] = this.message[type].filter(i => i !== cb)\n        }\n      }\n    }\n\n    PubSub.subscribe('updateBread', function (text) {\n      const breadEle = document.querySelector('.bread')\n      breadEle.innerHTML = text\n    })\n\n    let oLi = document.querySelectorAll('.left li')\n    for (let i = 0; i < oLi.length; i++) {\n      oLi[i].onclick = function () {\n        PubSub.publist('updateBread', this.innerHTML)\n      }\n    }\n\n  </script>\n</body>\n\n</html>\n","date":"2023-05-12T10:49:20.035Z","updated":"2023-05-12T10:49:20.035Z","path":"demo/PubSubMode.html","title":"","comments":1,"layout":"page","_id":"clhkizgxh000f3y0q7k3383h9","content":"<!DOCTYPE html>\n<html lang=\"en\">\n\n<head>\n  <meta charset=\"UTF-8\">\n  <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n  <title>发布订阅者模式</title>\n  <style>\n    ul {\n      background-color: antiquewhite;\n    }\n\n    li {\n      background-color: aqua;\n      margin-top: 12px;\n    }\n\n  </style>\n</head>\n\n<body>\n  <h3>面包屑 <span class=\"bread\"></span></h3>\n\n  <hr />\n  <ul class=\"left\">\n    <li>1</li>\n    <li>2</li>\n    <li>3</li>\n  </ul>\n\n  <script>\n    const PubSub = {\n      message: {}, // 将事件存储数组，改成对象，key 表示事件类型，value 表示订阅的事件数组\n      publist(type, text) {\n        if (!this.message[type]) return\n\n        this.message[type].forEach(cb => {\n          cb(text)\n        })\n      },\n      subscribe(type, cb) {\n        if (!this.message[type]) {\n          this.message[type] = [cb] // 如果事件 type 不存在，我们就创建一个事件类型数组\n        } else {\n          this.message[type].push(cb)\n        }\n      },\n      unsubscribe(type, cb) {\n        // 取消订阅\n        if (!this.message[type]) return\n\n        if (!cb) {\n          // 取消所有订阅的事件\n          this.message[type] = []\n        } else {\n          this.message[type] = this.message[type].filter(i => i !== cb)\n        }\n      }\n    }\n\n    PubSub.subscribe('updateBread', function (text) {\n      const breadEle = document.querySelector('.bread')\n      breadEle.innerHTML = text\n    })\n\n    let oLi = document.querySelectorAll('.left li')\n    for (let i = 0; i < oLi.length; i++) {\n      oLi[i].onclick = function () {\n        PubSub.publist('updateBread', this.innerHTML)\n      }\n    }\n\n  </script>\n</body>\n\n</html>\n","site":{"data":{}},"wordcount":794,"excerpt":"","more":"<!DOCTYPE html>\n<html lang=\"en\">\n\n<head>\n  <meta charset=\"UTF-8\">\n  <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n  <title>发布订阅者模式</title>\n  <style>\n    ul {\n      background-color: antiquewhite;\n    }\n\n    li {\n      background-color: aqua;\n      margin-top: 12px;\n    }\n\n  </style>\n</head>\n\n<body>\n  <h3>面包屑 <span class=\"bread\"></span></h3>\n\n  <hr />\n  <ul class=\"left\">\n    <li>1</li>\n    <li>2</li>\n    <li>3</li>\n  </ul>\n\n  <script>\n    const PubSub = {\n      message: {}, // 将事件存储数组，改成对象，key 表示事件类型，value 表示订阅的事件数组\n      publist(type, text) {\n        if (!this.message[type]) return\n\n        this.message[type].forEach(cb => {\n          cb(text)\n        })\n      },\n      subscribe(type, cb) {\n        if (!this.message[type]) {\n          this.message[type] = [cb] // 如果事件 type 不存在，我们就创建一个事件类型数组\n        } else {\n          this.message[type].push(cb)\n        }\n      },\n      unsubscribe(type, cb) {\n        // 取消订阅\n        if (!this.message[type]) return\n\n        if (!cb) {\n          // 取消所有订阅的事件\n          this.message[type] = []\n        } else {\n          this.message[type] = this.message[type].filter(i => i !== cb)\n        }\n      }\n    }\n\n    PubSub.subscribe('updateBread', function (text) {\n      const breadEle = document.querySelector('.bread')\n      breadEle.innerHTML = text\n    })\n\n    let oLi = document.querySelectorAll('.left li')\n    for (let i = 0; i < oLi.length; i++) {\n      oLi[i].onclick = function () {\n        PubSub.publist('updateBread', this.innerHTML)\n      }\n    }\n\n  </script>\n</body>\n\n</html>\n"},{"_content":"<!DOCTYPE html>\n<html lang=\"en\">\n<head>\n  <meta charset=\"UTF-8\">\n  <meta http-equiv=\"X-UA-Compatible\" content=\"IE=edge\">\n  <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n  <title>收集 key 的依赖</title>\n</head>\n<body>\n  \n  <h1>reactive</h1>\n\n  <script src=\"./reactive.js\"></script>\n  <script>\n    let temp1, temp2;\n    effect(function effect1() {\n      console.log('effect1 执行')\n\n      effect(function effect2() {\n        console.log('effect2 执行')\n\n        temp2 = obj.bar\n      })\n\n      temp1 = obj.foo\n    })\n\n    console.log('???', bucket)\n\n    obj.foo = false\n\n    // obj.bar = false\n\n\n  </script>\n</body>\n</html>","source":"demo/Vue3Reactive3.html","raw":"<!DOCTYPE html>\n<html lang=\"en\">\n<head>\n  <meta charset=\"UTF-8\">\n  <meta http-equiv=\"X-UA-Compatible\" content=\"IE=edge\">\n  <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n  <title>收集 key 的依赖</title>\n</head>\n<body>\n  \n  <h1>reactive</h1>\n\n  <script src=\"./reactive.js\"></script>\n  <script>\n    let temp1, temp2;\n    effect(function effect1() {\n      console.log('effect1 执行')\n\n      effect(function effect2() {\n        console.log('effect2 执行')\n\n        temp2 = obj.bar\n      })\n\n      temp1 = obj.foo\n    })\n\n    console.log('???', bucket)\n\n    obj.foo = false\n\n    // obj.bar = false\n\n\n  </script>\n</body>\n</html>","date":"2023-05-12T10:49:20.036Z","updated":"2023-05-12T10:49:20.036Z","path":"demo/Vue3Reactive3.html","title":"","comments":1,"layout":"page","_id":"clhkizgxi000h3y0qgnz6c84d","content":"<!DOCTYPE html>\n<html lang=\"en\">\n<head>\n  <meta charset=\"UTF-8\">\n  <meta http-equiv=\"X-UA-Compatible\" content=\"IE=edge\">\n  <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n  <title>收集 key 的依赖</title>\n</head>\n<body>\n  \n  <h1>reactive</h1>\n\n  <script src=\"./reactive.js\"></script>\n  <script>\n    let temp1, temp2;\n    effect(function effect1() {\n      console.log('effect1 执行')\n\n      effect(function effect2() {\n        console.log('effect2 执行')\n\n        temp2 = obj.bar\n      })\n\n      temp1 = obj.foo\n    })\n\n    console.log('???', bucket)\n\n    obj.foo = false\n\n    // obj.bar = false\n\n\n  </script>\n</body>\n</html>","site":{"data":{}},"wordcount":212,"excerpt":"","more":"<!DOCTYPE html>\n<html lang=\"en\">\n<head>\n  <meta charset=\"UTF-8\">\n  <meta http-equiv=\"X-UA-Compatible\" content=\"IE=edge\">\n  <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n  <title>收集 key 的依赖</title>\n</head>\n<body>\n  \n  <h1>reactive</h1>\n\n  <script src=\"./reactive.js\"></script>\n  <script>\n    let temp1, temp2;\n    effect(function effect1() {\n      console.log('effect1 执行')\n\n      effect(function effect2() {\n        console.log('effect2 执行')\n\n        temp2 = obj.bar\n      })\n\n      temp1 = obj.foo\n    })\n\n    console.log('???', bucket)\n\n    obj.foo = false\n\n    // obj.bar = false\n\n\n  </script>\n</body>\n</html>"},{"_content":"<!DOCTYPE html>\n<html lang=\"en\">\n<head>\n  <meta charset=\"UTF-8\">\n  <meta http-equiv=\"X-UA-Compatible\" content=\"IE=edge\">\n  <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n  <title>收集 key 的依赖</title>\n</head>\n<body>\n  \n  <h1>reactive</h1>\n\n  <script src=\"./reactive.js\"></script>\n  <script>\n\n    const data = {\n      foo: 1\n    }\n    const obj = handleProxy(data)\n\n    // 控制次数\n    const jobQueue = new Set()\n    const p = Promise.resolve()\n    let isFlushing = false\n\n    function flushJob() {\n      if (isFlushing) return\n\n      isFlushing = true\n\n      p.then(() => {\n        jobQueue.forEach(job => job())\n      }).finally(() => {\n        isFlushing = false\n      })\n    }\n\n    effect(() => {\n      console.log(obj.foo)\n    }, {\n      scheduler(fn) {\n        // 调度\n        // setTimeout(fn)\n        \n        // 控制次数\n        // fn() // 会依次从 1 打印到 6，而我不在过程，只需要结果 6\n        // 由于 Set 集合的特殊性，多次添加同一个 fn，最终都只会有个 fn 在 set 中\n        jobQueue.add(fn)\n\n        flushJob()\n      }\n    })\n    obj.foo++\n    obj.foo++\n    obj.foo++\n    obj.foo++\n    obj.foo++\n\n    console.log('结束了')\n  </script>\n</body>\n</html>","source":"demo/Vue3Reactive4.html","raw":"<!DOCTYPE html>\n<html lang=\"en\">\n<head>\n  <meta charset=\"UTF-8\">\n  <meta http-equiv=\"X-UA-Compatible\" content=\"IE=edge\">\n  <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n  <title>收集 key 的依赖</title>\n</head>\n<body>\n  \n  <h1>reactive</h1>\n\n  <script src=\"./reactive.js\"></script>\n  <script>\n\n    const data = {\n      foo: 1\n    }\n    const obj = handleProxy(data)\n\n    // 控制次数\n    const jobQueue = new Set()\n    const p = Promise.resolve()\n    let isFlushing = false\n\n    function flushJob() {\n      if (isFlushing) return\n\n      isFlushing = true\n\n      p.then(() => {\n        jobQueue.forEach(job => job())\n      }).finally(() => {\n        isFlushing = false\n      })\n    }\n\n    effect(() => {\n      console.log(obj.foo)\n    }, {\n      scheduler(fn) {\n        // 调度\n        // setTimeout(fn)\n        \n        // 控制次数\n        // fn() // 会依次从 1 打印到 6，而我不在过程，只需要结果 6\n        // 由于 Set 集合的特殊性，多次添加同一个 fn，最终都只会有个 fn 在 set 中\n        jobQueue.add(fn)\n\n        flushJob()\n      }\n    })\n    obj.foo++\n    obj.foo++\n    obj.foo++\n    obj.foo++\n    obj.foo++\n\n    console.log('结束了')\n  </script>\n</body>\n</html>","date":"2023-05-12T10:49:20.036Z","updated":"2023-05-12T10:49:20.036Z","path":"demo/Vue3Reactive4.html","title":"","comments":1,"layout":"page","_id":"clhkizgxj000k3y0q28mr5d0v","content":"<!DOCTYPE html>\n<html lang=\"en\">\n<head>\n  <meta charset=\"UTF-8\">\n  <meta http-equiv=\"X-UA-Compatible\" content=\"IE=edge\">\n  <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n  <title>收集 key 的依赖</title>\n</head>\n<body>\n  \n  <h1>reactive</h1>\n\n  <script src=\"./reactive.js\"></script>\n  <script>\n\n    const data = {\n      foo: 1\n    }\n    const obj = handleProxy(data)\n\n    // 控制次数\n    const jobQueue = new Set()\n    const p = Promise.resolve()\n    let isFlushing = false\n\n    function flushJob() {\n      if (isFlushing) return\n\n      isFlushing = true\n\n      p.then(() => {\n        jobQueue.forEach(job => job())\n      }).finally(() => {\n        isFlushing = false\n      })\n    }\n\n    effect(() => {\n      console.log(obj.foo)\n    }, {\n      scheduler(fn) {\n        // 调度\n        // setTimeout(fn)\n        \n        // 控制次数\n        // fn() // 会依次从 1 打印到 6，而我不在过程，只需要结果 6\n        // 由于 Set 集合的特殊性，多次添加同一个 fn，最终都只会有个 fn 在 set 中\n        jobQueue.add(fn)\n\n        flushJob()\n      }\n    })\n    obj.foo++\n    obj.foo++\n    obj.foo++\n    obj.foo++\n    obj.foo++\n\n    console.log('结束了')\n  </script>\n</body>\n</html>","site":{"data":{}},"wordcount":495,"excerpt":"","more":"<!DOCTYPE html>\n<html lang=\"en\">\n<head>\n  <meta charset=\"UTF-8\">\n  <meta http-equiv=\"X-UA-Compatible\" content=\"IE=edge\">\n  <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n  <title>收集 key 的依赖</title>\n</head>\n<body>\n  \n  <h1>reactive</h1>\n\n  <script src=\"./reactive.js\"></script>\n  <script>\n\n    const data = {\n      foo: 1\n    }\n    const obj = handleProxy(data)\n\n    // 控制次数\n    const jobQueue = new Set()\n    const p = Promise.resolve()\n    let isFlushing = false\n\n    function flushJob() {\n      if (isFlushing) return\n\n      isFlushing = true\n\n      p.then(() => {\n        jobQueue.forEach(job => job())\n      }).finally(() => {\n        isFlushing = false\n      })\n    }\n\n    effect(() => {\n      console.log(obj.foo)\n    }, {\n      scheduler(fn) {\n        // 调度\n        // setTimeout(fn)\n        \n        // 控制次数\n        // fn() // 会依次从 1 打印到 6，而我不在过程，只需要结果 6\n        // 由于 Set 集合的特殊性，多次添加同一个 fn，最终都只会有个 fn 在 set 中\n        jobQueue.add(fn)\n\n        flushJob()\n      }\n    })\n    obj.foo++\n    obj.foo++\n    obj.foo++\n    obj.foo++\n    obj.foo++\n\n    console.log('结束了')\n  </script>\n</body>\n</html>"},{"_content":"// 存储被注册的副作用函数\nlet activeEffect;\n\n// 副作用函数栈，用来存储当前执行的副作用函数，当副作用函数发生嵌套时，避免函数错误的使用\nconst effectStack = []\n\n\nconst bucket = new WeakMap() // target => Map\n\nconst handleProxy = data => {\n  return new Proxy(data, {\n    get(target, key) {\n      // 追踪依赖\n      track(target, key)\n      return target[key]\n    },\n    set(target, key, value) {\n      target[key] = value\n      // 触发依赖\n      trigger(target, key)\n    }\n  })\n}\n\n\nfunction track(target, key) {\n  if (!activeEffect) return target[key]\n  let depsMap = bucket.get(target)\n\n  if (!depsMap) {\n    bucket.set(target, depsMap = new Map())\n  }\n\n  let deps = depsMap.get(key)\n\n  if (!deps) {\n    depsMap.set(key, deps = new Set())\n  }\n\n  deps.add(activeEffect)\n\n  activeEffect.deps.push(deps)\n}\n\nfunction trigger(target, key) {\n  const depsMap = bucket.get(target)\n  if (!depsMap) return\n\n  const effects = depsMap.get(key)\n\n  // 避免无限循环\n  // const effectsToRun = new Set(effects)\n  const effectsToRun = new Set()\n  effects && effects.forEach(effectFn => {\n    if (effectFn !== activeEffect) {\n      effectsToRun.add(effectFn)\n    }\n  })\n\n  effectsToRun && effectsToRun.forEach(fn => {\n    if (fn.options.scheduler) {\n      fn.options.scheduler(fn)\n    } else {\n      fn()\n    }\n  })\n}\n\nfunction effect(fn, options = {}) {\n  function effectFn() {\n    activeEffect = effectFn\n\n    cleanup(effectFn)\n\n    effectStack.push(effectFn)\n\n    // 执行副作用函数\n    fn()\n\n    effectStack.pop()\n\n    activeEffect = effectStack[effectStack.length - 1]\n  }\n\n  effectFn.options = options\n\n  effectFn.deps = []\n\n  // 开始执行\n  effectFn()\n}\n\nfunction cleanup(effectFn) {\n  for(let i = 0; i < effectFn.deps.length; i++) {\n    const deps = effectFn.deps[i]\n\n    deps.delete(effectFn)\n  }\n\n  effectFn.deps.length = 0\n}\n","source":"demo/reactive.js","raw":"// 存储被注册的副作用函数\nlet activeEffect;\n\n// 副作用函数栈，用来存储当前执行的副作用函数，当副作用函数发生嵌套时，避免函数错误的使用\nconst effectStack = []\n\n\nconst bucket = new WeakMap() // target => Map\n\nconst handleProxy = data => {\n  return new Proxy(data, {\n    get(target, key) {\n      // 追踪依赖\n      track(target, key)\n      return target[key]\n    },\n    set(target, key, value) {\n      target[key] = value\n      // 触发依赖\n      trigger(target, key)\n    }\n  })\n}\n\n\nfunction track(target, key) {\n  if (!activeEffect) return target[key]\n  let depsMap = bucket.get(target)\n\n  if (!depsMap) {\n    bucket.set(target, depsMap = new Map())\n  }\n\n  let deps = depsMap.get(key)\n\n  if (!deps) {\n    depsMap.set(key, deps = new Set())\n  }\n\n  deps.add(activeEffect)\n\n  activeEffect.deps.push(deps)\n}\n\nfunction trigger(target, key) {\n  const depsMap = bucket.get(target)\n  if (!depsMap) return\n\n  const effects = depsMap.get(key)\n\n  // 避免无限循环\n  // const effectsToRun = new Set(effects)\n  const effectsToRun = new Set()\n  effects && effects.forEach(effectFn => {\n    if (effectFn !== activeEffect) {\n      effectsToRun.add(effectFn)\n    }\n  })\n\n  effectsToRun && effectsToRun.forEach(fn => {\n    if (fn.options.scheduler) {\n      fn.options.scheduler(fn)\n    } else {\n      fn()\n    }\n  })\n}\n\nfunction effect(fn, options = {}) {\n  function effectFn() {\n    activeEffect = effectFn\n\n    cleanup(effectFn)\n\n    effectStack.push(effectFn)\n\n    // 执行副作用函数\n    fn()\n\n    effectStack.pop()\n\n    activeEffect = effectStack[effectStack.length - 1]\n  }\n\n  effectFn.options = options\n\n  effectFn.deps = []\n\n  // 开始执行\n  effectFn()\n}\n\nfunction cleanup(effectFn) {\n  for(let i = 0; i < effectFn.deps.length; i++) {\n    const deps = effectFn.deps[i]\n\n    deps.delete(effectFn)\n  }\n\n  effectFn.deps.length = 0\n}\n","date":"2023-05-12T10:49:20.038Z","updated":"2023-05-12T10:49:20.038Z","path":"demo/reactive.js","layout":"false","title":"","comments":1,"_id":"clhkizgxk000n3y0q6j4jfkcn","content":"// 存储被注册的副作用函数\nlet activeEffect;\n\n// 副作用函数栈，用来存储当前执行的副作用函数，当副作用函数发生嵌套时，避免函数错误的使用\nconst effectStack = []\n\n\nconst bucket = new WeakMap() // target => Map\n\nconst handleProxy = data => {\n  return new Proxy(data, {\n    get(target, key) {\n      // 追踪依赖\n      track(target, key)\n      return target[key]\n    },\n    set(target, key, value) {\n      target[key] = value\n      // 触发依赖\n      trigger(target, key)\n    }\n  })\n}\n\n\nfunction track(target, key) {\n  if (!activeEffect) return target[key]\n  let depsMap = bucket.get(target)\n\n  if (!depsMap) {\n    bucket.set(target, depsMap = new Map())\n  }\n\n  let deps = depsMap.get(key)\n\n  if (!deps) {\n    depsMap.set(key, deps = new Set())\n  }\n\n  deps.add(activeEffect)\n\n  activeEffect.deps.push(deps)\n}\n\nfunction trigger(target, key) {\n  const depsMap = bucket.get(target)\n  if (!depsMap) return\n\n  const effects = depsMap.get(key)\n\n  // 避免无限循环\n  // const effectsToRun = new Set(effects)\n  const effectsToRun = new Set()\n  effects && effects.forEach(effectFn => {\n    if (effectFn !== activeEffect) {\n      effectsToRun.add(effectFn)\n    }\n  })\n\n  effectsToRun && effectsToRun.forEach(fn => {\n    if (fn.options.scheduler) {\n      fn.options.scheduler(fn)\n    } else {\n      fn()\n    }\n  })\n}\n\nfunction effect(fn, options = {}) {\n  function effectFn() {\n    activeEffect = effectFn\n\n    cleanup(effectFn)\n\n    effectStack.push(effectFn)\n\n    // 执行副作用函数\n    fn()\n\n    effectStack.pop()\n\n    activeEffect = effectStack[effectStack.length - 1]\n  }\n\n  effectFn.options = options\n\n  effectFn.deps = []\n\n  // 开始执行\n  effectFn()\n}\n\nfunction cleanup(effectFn) {\n  for(let i = 0; i < effectFn.deps.length; i++) {\n    const deps = effectFn.deps[i]\n\n    deps.delete(effectFn)\n  }\n\n  effectFn.deps.length = 0\n}\n","site":{"data":{}},"wordcount":1309,"excerpt":"","more":"// 存储被注册的副作用函数\nlet activeEffect;\n\n// 副作用函数栈，用来存储当前执行的副作用函数，当副作用函数发生嵌套时，避免函数错误的使用\nconst effectStack = []\n\n\nconst bucket = new WeakMap() // target => Map\n\nconst handleProxy = data => {\n  return new Proxy(data, {\n    get(target, key) {\n      // 追踪依赖\n      track(target, key)\n      return target[key]\n    },\n    set(target, key, value) {\n      target[key] = value\n      // 触发依赖\n      trigger(target, key)\n    }\n  })\n}\n\n\nfunction track(target, key) {\n  if (!activeEffect) return target[key]\n  let depsMap = bucket.get(target)\n\n  if (!depsMap) {\n    bucket.set(target, depsMap = new Map())\n  }\n\n  let deps = depsMap.get(key)\n\n  if (!deps) {\n    depsMap.set(key, deps = new Set())\n  }\n\n  deps.add(activeEffect)\n\n  activeEffect.deps.push(deps)\n}\n\nfunction trigger(target, key) {\n  const depsMap = bucket.get(target)\n  if (!depsMap) return\n\n  const effects = depsMap.get(key)\n\n  // 避免无限循环\n  // const effectsToRun = new Set(effects)\n  const effectsToRun = new Set()\n  effects && effects.forEach(effectFn => {\n    if (effectFn !== activeEffect) {\n      effectsToRun.add(effectFn)\n    }\n  })\n\n  effectsToRun && effectsToRun.forEach(fn => {\n    if (fn.options.scheduler) {\n      fn.options.scheduler(fn)\n    } else {\n      fn()\n    }\n  })\n}\n\nfunction effect(fn, options = {}) {\n  function effectFn() {\n    activeEffect = effectFn\n\n    cleanup(effectFn)\n\n    effectStack.push(effectFn)\n\n    // 执行副作用函数\n    fn()\n\n    effectStack.pop()\n\n    activeEffect = effectStack[effectStack.length - 1]\n  }\n\n  effectFn.options = options\n\n  effectFn.deps = []\n\n  // 开始执行\n  effectFn()\n}\n\nfunction cleanup(effectFn) {\n  for(let i = 0; i < effectFn.deps.length; i++) {\n    const deps = effectFn.deps[i]\n\n    deps.delete(effectFn)\n  }\n\n  effectFn.deps.length = 0\n}\n"},{"_content":"<!DOCTYPE html>\n<html lang=\"en\">\n<head>\n  <meta charset=\"UTF-8\">\n  <meta http-equiv=\"X-UA-Compatible\" content=\"IE=edge\">\n  <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n  <title>Document</title>\n</head>\n<body>\n  \n  <script>\n  \n    const name = \"Doe, John\";\n\n    name.replace(/(\\w+)\\s*, \\s*(\\w+)/, \"$2 $1\") // John, Doe\n\n    console.log('\"a\", \"b\"'.replace(/\"([^\"]*)\"/g, \"'$1'\"))\n\n  </script>\n</body>\n</html>","source":"demo/replace$1.html","raw":"<!DOCTYPE html>\n<html lang=\"en\">\n<head>\n  <meta charset=\"UTF-8\">\n  <meta http-equiv=\"X-UA-Compatible\" content=\"IE=edge\">\n  <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n  <title>Document</title>\n</head>\n<body>\n  \n  <script>\n  \n    const name = \"Doe, John\";\n\n    name.replace(/(\\w+)\\s*, \\s*(\\w+)/, \"$2 $1\") // John, Doe\n\n    console.log('\"a\", \"b\"'.replace(/\"([^\"]*)\"/g, \"'$1'\"))\n\n  </script>\n</body>\n</html>","date":"2023-05-12T10:49:20.038Z","updated":"2023-05-12T10:49:20.038Z","path":"demo/replace$1.html","title":"","comments":1,"layout":"page","_id":"clhkizgxl000q3y0qawr87rny","content":"<!DOCTYPE html>\n<html lang=\"en\">\n<head>\n  <meta charset=\"UTF-8\">\n  <meta http-equiv=\"X-UA-Compatible\" content=\"IE=edge\">\n  <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n  <title>Document</title>\n</head>\n<body>\n  \n  <script>\n  \n    const name = \"Doe, John\";\n\n    name.replace(/(\\w+)\\s*, \\s*(\\w+)/, \"$2 $1\") // John, Doe\n\n    console.log('\"a\", \"b\"'.replace(/\"([^\"]*)\"/g, \"'$1'\"))\n\n  </script>\n</body>\n</html>","site":{"data":{}},"wordcount":130,"excerpt":"","more":"<!DOCTYPE html>\n<html lang=\"en\">\n<head>\n  <meta charset=\"UTF-8\">\n  <meta http-equiv=\"X-UA-Compatible\" content=\"IE=edge\">\n  <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n  <title>Document</title>\n</head>\n<body>\n  \n  <script>\n  \n    const name = \"Doe, John\";\n\n    name.replace(/(\\w+)\\s*, \\s*(\\w+)/, \"$2 $1\") // John, Doe\n\n    console.log('\"a\", \"b\"'.replace(/\"([^\"]*)\"/g, \"'$1'\"))\n\n  </script>\n</body>\n</html>"},{"_content":"<!DOCTYPE html>\n<html>\n\n<head>\n  <meta charset=\"utf-8\">\n  <title>Resize observer text test</title>\n  <style>\n    html {\n      height: 100%;\n      font-family: 'helvetica neue', arial, sans-serif;\n    }\n\n    body {\n      height: inherit;\n      margin: 0;\n      display: flex;\n      justify-content: center;\n      align-items: center;\n    }\n\n    body>div {\n      background-color: #eee;\n      border: 1px solid #ccc;\n      padding: 20px;\n      width: 50%;\n      min-width: 320px;\n    }\n\n    h1 {\n      margin: 0;\n    }\n\n    p {\n      line-height: 1.5;\n    }\n\n    form {\n      width: 100%;\n    }\n\n    form>div {\n      display: flex;\n    }\n\n    form label {\n      flex: 2;\n    }\n\n    form input {\n      flex: 3;\n    }\n\n    input[type=\"checkbox\"] {\n      height: 2rem;\n    }\n\n  </style>\n</head>\n\n<body>\n  <div>\n    <h1>So what happened?</h1>\n    <p>https://developer.mozilla.org/zh-CN/docs/Web/API/ResizeObserver</p>\n    <p>\n      记住，不要做任何影响任何事情的事情，除非事实证明你应该这么做，那样的话，看在上帝的份上，不要不做！我的灵魂！我不想被救。你们不是圣诞老人！你们都不是机器人。我得想办法逃离年轻时可怕的摧残。突然间，我每三个小时就要上一次厕所。社保局的那些混蛋也不再给我寄支票了。现在我得付钱给他们！\n    </p>\n    <form>\n      <div><label>Observer enabled:</label><input type=\"checkbox\" checked></div>\n      <div><label>Adjust width:</label><input type=\"range\" value=\"600\" min=\"300\" max=\"1300\"></div>\n    </form>\n  </div>\n  <script>\n    if (window.ResizeObserver) {\n      const h1Elem = document.querySelector('h1');\n      const pElem = document.querySelector('p');\n      const divElem = document.querySelector('body > div');\n      const slider = document.querySelector('input[type=\"range\"]');\n      const checkbox = document.querySelector('input[type=\"checkbox\"]');\n\n      divElem.style.width = '600px';\n\n      slider.addEventListener('input', () => {\n        divElem.style.width = slider.value + 'px';\n      })\n\n      const resizeObserver = new ResizeObserver(entries => {\n        console.log('entries', entries)\n        for (let entry of entries) {\n          if (entry.contentBoxSize) {\n            // The standard makes contentBoxSize an array...\n            if (entry.contentBoxSize[0]) {\n              h1Elem.style.fontSize = Math.max(1.5, entry.contentBoxSize[0].inlineSize / 200) + 'rem';\n              pElem.style.fontSize = Math.max(1, entry.contentBoxSize[0].inlineSize / 600) + 'rem';\n            } else {\n              // ...but old versions of Firefox treat it as a single item\n              h1Elem.style.fontSize = Math.max(1.5, entry.contentBoxSize.inlineSize / 200) + 'rem';\n              pElem.style.fontSize = Math.max(1, entry.contentBoxSize.inlineSize / 600) + 'rem';\n            }\n\n          } else {\n            h1Elem.style.fontSize = Math.max(1.5, entry.contentRect.width / 200) + 'rem';\n            pElem.style.fontSize = Math.max(1, entry.contentRect.width / 600) + 'rem';\n          }\n        }\n        console.log('Size changed');\n      });\n\n      resizeObserver.observe(divElem);\n\n      checkbox.addEventListener('change', () => {\n        if (checkbox.checked) {\n          resizeObserver.observe(divElem);\n        } else {\n          resizeObserver.unobserve(divElem);\n        }\n      });\n    } else {\n      console.log('Resize observer not supported!');\n    }\n\n  </script>\n</body>\n\n</html>\n","source":"demo/resizeObserver.html","raw":"<!DOCTYPE html>\n<html>\n\n<head>\n  <meta charset=\"utf-8\">\n  <title>Resize observer text test</title>\n  <style>\n    html {\n      height: 100%;\n      font-family: 'helvetica neue', arial, sans-serif;\n    }\n\n    body {\n      height: inherit;\n      margin: 0;\n      display: flex;\n      justify-content: center;\n      align-items: center;\n    }\n\n    body>div {\n      background-color: #eee;\n      border: 1px solid #ccc;\n      padding: 20px;\n      width: 50%;\n      min-width: 320px;\n    }\n\n    h1 {\n      margin: 0;\n    }\n\n    p {\n      line-height: 1.5;\n    }\n\n    form {\n      width: 100%;\n    }\n\n    form>div {\n      display: flex;\n    }\n\n    form label {\n      flex: 2;\n    }\n\n    form input {\n      flex: 3;\n    }\n\n    input[type=\"checkbox\"] {\n      height: 2rem;\n    }\n\n  </style>\n</head>\n\n<body>\n  <div>\n    <h1>So what happened?</h1>\n    <p>https://developer.mozilla.org/zh-CN/docs/Web/API/ResizeObserver</p>\n    <p>\n      记住，不要做任何影响任何事情的事情，除非事实证明你应该这么做，那样的话，看在上帝的份上，不要不做！我的灵魂！我不想被救。你们不是圣诞老人！你们都不是机器人。我得想办法逃离年轻时可怕的摧残。突然间，我每三个小时就要上一次厕所。社保局的那些混蛋也不再给我寄支票了。现在我得付钱给他们！\n    </p>\n    <form>\n      <div><label>Observer enabled:</label><input type=\"checkbox\" checked></div>\n      <div><label>Adjust width:</label><input type=\"range\" value=\"600\" min=\"300\" max=\"1300\"></div>\n    </form>\n  </div>\n  <script>\n    if (window.ResizeObserver) {\n      const h1Elem = document.querySelector('h1');\n      const pElem = document.querySelector('p');\n      const divElem = document.querySelector('body > div');\n      const slider = document.querySelector('input[type=\"range\"]');\n      const checkbox = document.querySelector('input[type=\"checkbox\"]');\n\n      divElem.style.width = '600px';\n\n      slider.addEventListener('input', () => {\n        divElem.style.width = slider.value + 'px';\n      })\n\n      const resizeObserver = new ResizeObserver(entries => {\n        console.log('entries', entries)\n        for (let entry of entries) {\n          if (entry.contentBoxSize) {\n            // The standard makes contentBoxSize an array...\n            if (entry.contentBoxSize[0]) {\n              h1Elem.style.fontSize = Math.max(1.5, entry.contentBoxSize[0].inlineSize / 200) + 'rem';\n              pElem.style.fontSize = Math.max(1, entry.contentBoxSize[0].inlineSize / 600) + 'rem';\n            } else {\n              // ...but old versions of Firefox treat it as a single item\n              h1Elem.style.fontSize = Math.max(1.5, entry.contentBoxSize.inlineSize / 200) + 'rem';\n              pElem.style.fontSize = Math.max(1, entry.contentBoxSize.inlineSize / 600) + 'rem';\n            }\n\n          } else {\n            h1Elem.style.fontSize = Math.max(1.5, entry.contentRect.width / 200) + 'rem';\n            pElem.style.fontSize = Math.max(1, entry.contentRect.width / 600) + 'rem';\n          }\n        }\n        console.log('Size changed');\n      });\n\n      resizeObserver.observe(divElem);\n\n      checkbox.addEventListener('change', () => {\n        if (checkbox.checked) {\n          resizeObserver.observe(divElem);\n        } else {\n          resizeObserver.unobserve(divElem);\n        }\n      });\n    } else {\n      console.log('Resize observer not supported!');\n    }\n\n  </script>\n</body>\n\n</html>\n","date":"2023-05-12T10:49:20.038Z","updated":"2023-05-12T10:49:20.038Z","path":"demo/resizeObserver.html","title":"","comments":1,"layout":"page","_id":"clhkizgxl000t3y0qa8cm630t","content":"<!DOCTYPE html>\n<html>\n\n<head>\n  <meta charset=\"utf-8\">\n  <title>Resize observer text test</title>\n  <style>\n    html {\n      height: 100%;\n      font-family: 'helvetica neue', arial, sans-serif;\n    }\n\n    body {\n      height: inherit;\n      margin: 0;\n      display: flex;\n      justify-content: center;\n      align-items: center;\n    }\n\n    body>div {\n      background-color: #eee;\n      border: 1px solid #ccc;\n      padding: 20px;\n      width: 50%;\n      min-width: 320px;\n    }\n\n    h1 {\n      margin: 0;\n    }\n\n    p {\n      line-height: 1.5;\n    }\n\n    form {\n      width: 100%;\n    }\n\n    form>div {\n      display: flex;\n    }\n\n    form label {\n      flex: 2;\n    }\n\n    form input {\n      flex: 3;\n    }\n\n    input[type=\"checkbox\"] {\n      height: 2rem;\n    }\n\n  </style>\n</head>\n\n<body>\n  <div>\n    <h1>So what happened?</h1>\n    <p>https://developer.mozilla.org/zh-CN/docs/Web/API/ResizeObserver</p>\n    <p>\n      记住，不要做任何影响任何事情的事情，除非事实证明你应该这么做，那样的话，看在上帝的份上，不要不做！我的灵魂！我不想被救。你们不是圣诞老人！你们都不是机器人。我得想办法逃离年轻时可怕的摧残。突然间，我每三个小时就要上一次厕所。社保局的那些混蛋也不再给我寄支票了。现在我得付钱给他们！\n    </p>\n    <form>\n      <div><label>Observer enabled:</label><input type=\"checkbox\" checked></div>\n      <div><label>Adjust width:</label><input type=\"range\" value=\"600\" min=\"300\" max=\"1300\"></div>\n    </form>\n  </div>\n  <script>\n    if (window.ResizeObserver) {\n      const h1Elem = document.querySelector('h1');\n      const pElem = document.querySelector('p');\n      const divElem = document.querySelector('body > div');\n      const slider = document.querySelector('input[type=\"range\"]');\n      const checkbox = document.querySelector('input[type=\"checkbox\"]');\n\n      divElem.style.width = '600px';\n\n      slider.addEventListener('input', () => {\n        divElem.style.width = slider.value + 'px';\n      })\n\n      const resizeObserver = new ResizeObserver(entries => {\n        console.log('entries', entries)\n        for (let entry of entries) {\n          if (entry.contentBoxSize) {\n            // The standard makes contentBoxSize an array...\n            if (entry.contentBoxSize[0]) {\n              h1Elem.style.fontSize = Math.max(1.5, entry.contentBoxSize[0].inlineSize / 200) + 'rem';\n              pElem.style.fontSize = Math.max(1, entry.contentBoxSize[0].inlineSize / 600) + 'rem';\n            } else {\n              // ...but old versions of Firefox treat it as a single item\n              h1Elem.style.fontSize = Math.max(1.5, entry.contentBoxSize.inlineSize / 200) + 'rem';\n              pElem.style.fontSize = Math.max(1, entry.contentBoxSize.inlineSize / 600) + 'rem';\n            }\n\n          } else {\n            h1Elem.style.fontSize = Math.max(1.5, entry.contentRect.width / 200) + 'rem';\n            pElem.style.fontSize = Math.max(1, entry.contentRect.width / 600) + 'rem';\n          }\n        }\n        console.log('Size changed');\n      });\n\n      resizeObserver.observe(divElem);\n\n      checkbox.addEventListener('change', () => {\n        if (checkbox.checked) {\n          resizeObserver.observe(divElem);\n        } else {\n          resizeObserver.unobserve(divElem);\n        }\n      });\n    } else {\n      console.log('Resize observer not supported!');\n    }\n\n  </script>\n</body>\n\n</html>\n","site":{"data":{}},"wordcount":1988,"excerpt":"","more":"<!DOCTYPE html>\n<html>\n\n<head>\n  <meta charset=\"utf-8\">\n  <title>Resize observer text test</title>\n  <style>\n    html {\n      height: 100%;\n      font-family: 'helvetica neue', arial, sans-serif;\n    }\n\n    body {\n      height: inherit;\n      margin: 0;\n      display: flex;\n      justify-content: center;\n      align-items: center;\n    }\n\n    body>div {\n      background-color: #eee;\n      border: 1px solid #ccc;\n      padding: 20px;\n      width: 50%;\n      min-width: 320px;\n    }\n\n    h1 {\n      margin: 0;\n    }\n\n    p {\n      line-height: 1.5;\n    }\n\n    form {\n      width: 100%;\n    }\n\n    form>div {\n      display: flex;\n    }\n\n    form label {\n      flex: 2;\n    }\n\n    form input {\n      flex: 3;\n    }\n\n    input[type=\"checkbox\"] {\n      height: 2rem;\n    }\n\n  </style>\n</head>\n\n<body>\n  <div>\n    <h1>So what happened?</h1>\n    <p>https://developer.mozilla.org/zh-CN/docs/Web/API/ResizeObserver</p>\n    <p>\n      记住，不要做任何影响任何事情的事情，除非事实证明你应该这么做，那样的话，看在上帝的份上，不要不做！我的灵魂！我不想被救。你们不是圣诞老人！你们都不是机器人。我得想办法逃离年轻时可怕的摧残。突然间，我每三个小时就要上一次厕所。社保局的那些混蛋也不再给我寄支票了。现在我得付钱给他们！\n    </p>\n    <form>\n      <div><label>Observer enabled:</label><input type=\"checkbox\" checked></div>\n      <div><label>Adjust width:</label><input type=\"range\" value=\"600\" min=\"300\" max=\"1300\"></div>\n    </form>\n  </div>\n  <script>\n    if (window.ResizeObserver) {\n      const h1Elem = document.querySelector('h1');\n      const pElem = document.querySelector('p');\n      const divElem = document.querySelector('body > div');\n      const slider = document.querySelector('input[type=\"range\"]');\n      const checkbox = document.querySelector('input[type=\"checkbox\"]');\n\n      divElem.style.width = '600px';\n\n      slider.addEventListener('input', () => {\n        divElem.style.width = slider.value + 'px';\n      })\n\n      const resizeObserver = new ResizeObserver(entries => {\n        console.log('entries', entries)\n        for (let entry of entries) {\n          if (entry.contentBoxSize) {\n            // The standard makes contentBoxSize an array...\n            if (entry.contentBoxSize[0]) {\n              h1Elem.style.fontSize = Math.max(1.5, entry.contentBoxSize[0].inlineSize / 200) + 'rem';\n              pElem.style.fontSize = Math.max(1, entry.contentBoxSize[0].inlineSize / 600) + 'rem';\n            } else {\n              // ...but old versions of Firefox treat it as a single item\n              h1Elem.style.fontSize = Math.max(1.5, entry.contentBoxSize.inlineSize / 200) + 'rem';\n              pElem.style.fontSize = Math.max(1, entry.contentBoxSize.inlineSize / 600) + 'rem';\n            }\n\n          } else {\n            h1Elem.style.fontSize = Math.max(1.5, entry.contentRect.width / 200) + 'rem';\n            pElem.style.fontSize = Math.max(1, entry.contentRect.width / 600) + 'rem';\n          }\n        }\n        console.log('Size changed');\n      });\n\n      resizeObserver.observe(divElem);\n\n      checkbox.addEventListener('change', () => {\n        if (checkbox.checked) {\n          resizeObserver.observe(divElem);\n        } else {\n          resizeObserver.unobserve(divElem);\n        }\n      });\n    } else {\n      console.log('Resize observer not supported!');\n    }\n\n  </script>\n</body>\n\n</html>\n"},{"_content":"<!DOCTYPE html>\n<html lang=\"en\">\n\n<head>\n  <meta charset=\"UTF-8\">\n  <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n  <title>时间分片</title>\n</head>\n\n<body>\n  <ul id=\"container\"></ul>\n  <script>\n    // 记录任务开始时间\n    let now = Date.now();\n    // 插入十万条数据\n    const total = 100000;\n    // 获取容器\n    let ul = document.getElementById('container');\n    // 将数据插入容器中\n    for (let i = 0; i < total; i++) {\n      let li = document.createElement('li');\n      li.innerText = i\n      ul.appendChild(li);\n    }\n\n    console.log('JS运行时间：', Date.now() - now);\n    setTimeout(() => {\n      console.log('总运行时间：', Date.now() - now);\n    }, 0)\n\n\n\n    // // --------- 分批渲染 --------- \n    // //需要插入的容器\n    // let ul = document.getElementById('container');\n    // // 插入十万条数据\n    // let total = 100000;\n    // // 一次插入 20 条\n    // let once = 20;\n    // //总页数\n    // let page = total / once\n    // //每条记录的索引\n    // let index = 0;\n    // //循环加载数据\n    // function loop(curTotal, curIndex) {\n    //   if (curTotal <= 0) {\n    //     return false;\n    //   }\n    //   //每页多少条\n    //   let pageCount = Math.min(curTotal, once);\n    //   setTimeout(() => {\n    //     for (let i = 0; i < pageCount; i++) {\n    //       let li = document.createElement('li');\n    //       li.innerText = curIndex + i + ' : ' + ~~(Math.random() * total)\n    //       ul.appendChild(li)\n    //     }\n    //     loop(curTotal - pageCount, curIndex + pageCount)\n    //   }, 0)\n    // }\n    // loop(total, index);\n\n  </script>\n</body>\n\n</html>\n","source":"demo/timeFragment.html","raw":"<!DOCTYPE html>\n<html lang=\"en\">\n\n<head>\n  <meta charset=\"UTF-8\">\n  <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n  <title>时间分片</title>\n</head>\n\n<body>\n  <ul id=\"container\"></ul>\n  <script>\n    // 记录任务开始时间\n    let now = Date.now();\n    // 插入十万条数据\n    const total = 100000;\n    // 获取容器\n    let ul = document.getElementById('container');\n    // 将数据插入容器中\n    for (let i = 0; i < total; i++) {\n      let li = document.createElement('li');\n      li.innerText = i\n      ul.appendChild(li);\n    }\n\n    console.log('JS运行时间：', Date.now() - now);\n    setTimeout(() => {\n      console.log('总运行时间：', Date.now() - now);\n    }, 0)\n\n\n\n    // // --------- 分批渲染 --------- \n    // //需要插入的容器\n    // let ul = document.getElementById('container');\n    // // 插入十万条数据\n    // let total = 100000;\n    // // 一次插入 20 条\n    // let once = 20;\n    // //总页数\n    // let page = total / once\n    // //每条记录的索引\n    // let index = 0;\n    // //循环加载数据\n    // function loop(curTotal, curIndex) {\n    //   if (curTotal <= 0) {\n    //     return false;\n    //   }\n    //   //每页多少条\n    //   let pageCount = Math.min(curTotal, once);\n    //   setTimeout(() => {\n    //     for (let i = 0; i < pageCount; i++) {\n    //       let li = document.createElement('li');\n    //       li.innerText = curIndex + i + ' : ' + ~~(Math.random() * total)\n    //       ul.appendChild(li)\n    //     }\n    //     loop(curTotal - pageCount, curIndex + pageCount)\n    //   }, 0)\n    // }\n    // loop(total, index);\n\n  </script>\n</body>\n\n</html>\n","date":"2023-05-12T10:49:20.039Z","updated":"2023-05-12T10:49:20.039Z","path":"demo/timeFragment.html","title":"","comments":1,"layout":"page","_id":"clhkizgxm000x3y0q9j4b7ycs","content":"<!DOCTYPE html>\n<html lang=\"en\">\n\n<head>\n  <meta charset=\"UTF-8\">\n  <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n  <title>时间分片</title>\n</head>\n\n<body>\n  <ul id=\"container\"></ul>\n  <script>\n    // 记录任务开始时间\n    let now = Date.now();\n    // 插入十万条数据\n    const total = 100000;\n    // 获取容器\n    let ul = document.getElementById('container');\n    // 将数据插入容器中\n    for (let i = 0; i < total; i++) {\n      let li = document.createElement('li');\n      li.innerText = i\n      ul.appendChild(li);\n    }\n\n    console.log('JS运行时间：', Date.now() - now);\n    setTimeout(() => {\n      console.log('总运行时间：', Date.now() - now);\n    }, 0)\n\n\n\n    // // --------- 分批渲染 --------- \n    // //需要插入的容器\n    // let ul = document.getElementById('container');\n    // // 插入十万条数据\n    // let total = 100000;\n    // // 一次插入 20 条\n    // let once = 20;\n    // //总页数\n    // let page = total / once\n    // //每条记录的索引\n    // let index = 0;\n    // //循环加载数据\n    // function loop(curTotal, curIndex) {\n    //   if (curTotal <= 0) {\n    //     return false;\n    //   }\n    //   //每页多少条\n    //   let pageCount = Math.min(curTotal, once);\n    //   setTimeout(() => {\n    //     for (let i = 0; i < pageCount; i++) {\n    //       let li = document.createElement('li');\n    //       li.innerText = curIndex + i + ' : ' + ~~(Math.random() * total)\n    //       ul.appendChild(li)\n    //     }\n    //     loop(curTotal - pageCount, curIndex + pageCount)\n    //   }, 0)\n    // }\n    // loop(total, index);\n\n  </script>\n</body>\n\n</html>\n","site":{"data":{}},"wordcount":767,"excerpt":"","more":"<!DOCTYPE html>\n<html lang=\"en\">\n\n<head>\n  <meta charset=\"UTF-8\">\n  <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n  <title>时间分片</title>\n</head>\n\n<body>\n  <ul id=\"container\"></ul>\n  <script>\n    // 记录任务开始时间\n    let now = Date.now();\n    // 插入十万条数据\n    const total = 100000;\n    // 获取容器\n    let ul = document.getElementById('container');\n    // 将数据插入容器中\n    for (let i = 0; i < total; i++) {\n      let li = document.createElement('li');\n      li.innerText = i\n      ul.appendChild(li);\n    }\n\n    console.log('JS运行时间：', Date.now() - now);\n    setTimeout(() => {\n      console.log('总运行时间：', Date.now() - now);\n    }, 0)\n\n\n\n    // // --------- 分批渲染 --------- \n    // //需要插入的容器\n    // let ul = document.getElementById('container');\n    // // 插入十万条数据\n    // let total = 100000;\n    // // 一次插入 20 条\n    // let once = 20;\n    // //总页数\n    // let page = total / once\n    // //每条记录的索引\n    // let index = 0;\n    // //循环加载数据\n    // function loop(curTotal, curIndex) {\n    //   if (curTotal <= 0) {\n    //     return false;\n    //   }\n    //   //每页多少条\n    //   let pageCount = Math.min(curTotal, once);\n    //   setTimeout(() => {\n    //     for (let i = 0; i < pageCount; i++) {\n    //       let li = document.createElement('li');\n    //       li.innerText = curIndex + i + ' : ' + ~~(Math.random() * total)\n    //       ul.appendChild(li)\n    //     }\n    //     loop(curTotal - pageCount, curIndex + pageCount)\n    //   }, 0)\n    // }\n    // loop(total, index);\n\n  </script>\n</body>\n\n</html>\n"},{"_content":"> 你还需要更多的耐心与时间！\n\n","source":"demo/2023面试准备/JavaScript语言精粹与编程实战.md","raw":"> 你还需要更多的耐心与时间！\n\n","date":"2023-05-12T10:49:20.019Z","updated":"2023-05-12T10:49:20.019Z","path":"demo/2023面试准备/JavaScript语言精粹与编程实战.html","title":"","comments":1,"layout":"page","_id":"clhkizgxn00103y0q6vel8uxi","content":"<blockquote>\n<p>你还需要更多的耐心与时间！</p>\n</blockquote>\n","site":{"data":{}},"wordcount":13,"excerpt":"","more":"<blockquote>\n<p>你还需要更多的耐心与时间！</p>\n</blockquote>\n"},{"_content":"# Vue组件通信\n\n- props 和 $emit\n\n  ```js\n  // 触发父组件传递过来的事件\n  this.$emit('xxx', params)\n  ```\n\n- 组件间通信 - 自定义事件\n  ```js\n  const eventBus = new Vue()\n\n  export default eventBus\n  ```\n\n  用法：\n\n  ```js\n  import event from './eventBus.js'\n\n  // 触发事件\n  event.$emit('eventName', params)\n\n  // 接收事件\n  event.$on('eventName', this.functionName)\n\n  // 卸载事件，一般是放在组件销毁的生命钩子里\n  // 防止造成内存泄露\n  beforeDestroy() {\n    event.$off('eventName')\n  }\n  ```\n\n# Vue组件生命周期\n\n- beforeCreate\n\n  实例在内存中创建出来，但未初始化 data和 methods\n\n- created\n\n  实例已经在内存中创建完成，此时data和methods已初始化\n\n- beforeMount\n\n  此时已经完成了模版的编译，只是还没有渲染到界面中去\n\n- mouted\n\n  模版已经渲染到了浏览器，创建阶段结束，即将进入运行阶段（最新的dom）\n\n- beforeUpdate\n\n  界面中的数据还是旧的，但是data数据已经更新，页面中和data不会保持同步\n\n- updated\n\n  页面重新渲染完毕，页面中的数据和data保持一致\n- beforeDestroy\n\n  执行该方法的时候，Vue的生命周期已经进入销毁阶段，但是实例上的各种数据和方法还处于可用状态\n\n- destroyed\n\n   组件已经全部销毁，Vue实例已经被销毁，Vue中的任何数据都不可用\n\n# 父子组件生命周期的执行过程\n\nVue官网生命钩子示例图拆解\n\n> https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/e06a5ec0d21f4907ba780ae03da4d548~tplv-k3u1fbpfcp-zoom-in-crop-mark:4536:0:0:0.awebp\n\n父子组件生命钩子调用过程\n\n创建和挂载过程（子组件挂载完成后，父组件才会挂载完毕）\n\n1. parent created\n\n2. child created\n\n3. child mounted\n\n4. parent mounted\n\n组件更新过程 同上。\n\n1. parent beforeUpdate\n\n2. child beforeUpdate\n\n3. child updated\n\n4. parent updated\n\n组件销毁过程。\n","source":"demo/2023面试准备/Vue2&Vue3.md","raw":"# Vue组件通信\n\n- props 和 $emit\n\n  ```js\n  // 触发父组件传递过来的事件\n  this.$emit('xxx', params)\n  ```\n\n- 组件间通信 - 自定义事件\n  ```js\n  const eventBus = new Vue()\n\n  export default eventBus\n  ```\n\n  用法：\n\n  ```js\n  import event from './eventBus.js'\n\n  // 触发事件\n  event.$emit('eventName', params)\n\n  // 接收事件\n  event.$on('eventName', this.functionName)\n\n  // 卸载事件，一般是放在组件销毁的生命钩子里\n  // 防止造成内存泄露\n  beforeDestroy() {\n    event.$off('eventName')\n  }\n  ```\n\n# Vue组件生命周期\n\n- beforeCreate\n\n  实例在内存中创建出来，但未初始化 data和 methods\n\n- created\n\n  实例已经在内存中创建完成，此时data和methods已初始化\n\n- beforeMount\n\n  此时已经完成了模版的编译，只是还没有渲染到界面中去\n\n- mouted\n\n  模版已经渲染到了浏览器，创建阶段结束，即将进入运行阶段（最新的dom）\n\n- beforeUpdate\n\n  界面中的数据还是旧的，但是data数据已经更新，页面中和data不会保持同步\n\n- updated\n\n  页面重新渲染完毕，页面中的数据和data保持一致\n- beforeDestroy\n\n  执行该方法的时候，Vue的生命周期已经进入销毁阶段，但是实例上的各种数据和方法还处于可用状态\n\n- destroyed\n\n   组件已经全部销毁，Vue实例已经被销毁，Vue中的任何数据都不可用\n\n# 父子组件生命周期的执行过程\n\nVue官网生命钩子示例图拆解\n\n> https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/e06a5ec0d21f4907ba780ae03da4d548~tplv-k3u1fbpfcp-zoom-in-crop-mark:4536:0:0:0.awebp\n\n父子组件生命钩子调用过程\n\n创建和挂载过程（子组件挂载完成后，父组件才会挂载完毕）\n\n1. parent created\n\n2. child created\n\n3. child mounted\n\n4. parent mounted\n\n组件更新过程 同上。\n\n1. parent beforeUpdate\n\n2. child beforeUpdate\n\n3. child updated\n\n4. parent updated\n\n组件销毁过程。\n","date":"2023-05-12T10:49:20.020Z","updated":"2023-05-12T10:49:20.020Z","path":"demo/2023面试准备/Vue2&Vue3.html","title":"","comments":1,"layout":"page","_id":"clhkizgxo00123y0q7ma8hsx4","content":"<h1 id=\"Vue组件通信\"><a href=\"#Vue组件通信\" class=\"headerlink\" title=\"Vue组件通信\"></a>Vue组件通信</h1><ul>\n<li><p>props 和 $emit</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><div class=\"code-wrapper\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></div></td><td class=\"code\"><pre><code class=\"hljs js\"><span class=\"hljs-comment\">// 触发父组件传递过来的事件</span><br><span class=\"hljs-variable language_\">this</span>.$emit(<span class=\"hljs-string\">&#x27;xxx&#x27;</span>, params)<br></code></pre></td></tr></table></figure>\n</li>\n<li><p>组件间通信 - 自定义事件</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\"><span class=\"hljs-keyword\">const</span> eventBus = <span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">Vue</span>()<br><br><span class=\"hljs-keyword\">export</span> <span class=\"hljs-keyword\">default</span> eventBus<br></code></pre></td></tr></table></figure>\n\n<p>用法：</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\"><span class=\"hljs-keyword\">import</span> event <span class=\"hljs-keyword\">from</span> <span class=\"hljs-string\">&#x27;./eventBus.js&#x27;</span><br><br><span class=\"hljs-comment\">// 触发事件</span><br>event.$emit(<span class=\"hljs-string\">&#x27;eventName&#x27;</span>, params)<br><br><span class=\"hljs-comment\">// 接收事件</span><br>event.$on(<span class=\"hljs-string\">&#x27;eventName&#x27;</span>, <span class=\"hljs-variable language_\">this</span>.<span class=\"hljs-property\">functionName</span>)<br><br><span class=\"hljs-comment\">// 卸载事件，一般是放在组件销毁的生命钩子里</span><br><span class=\"hljs-comment\">// 防止造成内存泄露</span><br><span class=\"hljs-title function_\">beforeDestroy</span>(<span class=\"hljs-params\"></span>) &#123;<br>  event.$off(<span class=\"hljs-string\">&#x27;eventName&#x27;</span>)<br>&#125;<br></code></pre></td></tr></table></figure>\n\n</li>\n</ul>\n<h1 id=\"Vue组件生命周期\"><a href=\"#Vue组件生命周期\" class=\"headerlink\" title=\"Vue组件生命周期\"></a>Vue组件生命周期</h1><ul>\n<li><p>beforeCreate</p>\n<p>实例在内存中创建出来，但未初始化 data和 methods</p>\n</li>\n<li><p>created</p>\n<p>实例已经在内存中创建完成，此时data和methods已初始化</p>\n</li>\n<li><p>beforeMount</p>\n<p>此时已经完成了模版的编译，只是还没有渲染到界面中去</p>\n</li>\n<li><p>mouted</p>\n<p>模版已经渲染到了浏览器，创建阶段结束，即将进入运行阶段（最新的dom）</p>\n</li>\n<li><p>beforeUpdate</p>\n<p>界面中的数据还是旧的，但是data数据已经更新，页面中和data不会保持同步</p>\n</li>\n<li><p>updated</p>\n<p>页面重新渲染完毕，页面中的数据和data保持一致</p>\n</li>\n<li><p>beforeDestroy</p>\n<p>执行该方法的时候，Vue的生命周期已经进入销毁阶段，但是实例上的各种数据和方法还处于可用状态</p>\n</li>\n<li><p>destroyed</p>\n<p> 组件已经全部销毁，Vue实例已经被销毁，Vue中的任何数据都不可用</p>\n</li>\n</ul>\n<h1 id=\"父子组件生命周期的执行过程\"><a href=\"#父子组件生命周期的执行过程\" class=\"headerlink\" title=\"父子组件生命周期的执行过程\"></a>父子组件生命周期的执行过程</h1><p>Vue官网生命钩子示例图拆解</p>\n<blockquote>\n<p><a href=\"https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/e06a5ec0d21f4907ba780ae03da4d548~tplv-k3u1fbpfcp-zoom-in-crop-mark:4536:0:0:0.awebp\">https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/e06a5ec0d21f4907ba780ae03da4d548~tplv-k3u1fbpfcp-zoom-in-crop-mark:4536:0:0:0.awebp</a></p>\n</blockquote>\n<p>父子组件生命钩子调用过程</p>\n<p>创建和挂载过程（子组件挂载完成后，父组件才会挂载完毕）</p>\n<ol>\n<li><p>parent created</p>\n</li>\n<li><p>child created</p>\n</li>\n<li><p>child mounted</p>\n</li>\n<li><p>parent mounted</p>\n</li>\n</ol>\n<p>组件更新过程 同上。</p>\n<ol>\n<li><p>parent beforeUpdate</p>\n</li>\n<li><p>child beforeUpdate</p>\n</li>\n<li><p>child updated</p>\n</li>\n<li><p>parent updated</p>\n</li>\n</ol>\n<p>组件销毁过程。</p>\n","site":{"data":{}},"wordcount":1051,"excerpt":"","more":"<h1 id=\"Vue组件通信\"><a href=\"#Vue组件通信\" class=\"headerlink\" title=\"Vue组件通信\"></a>Vue组件通信</h1><ul>\n<li><p>props 和 $emit</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\"><span class=\"hljs-comment\">// 触发父组件传递过来的事件</span><br><span class=\"hljs-variable language_\">this</span>.$emit(<span class=\"hljs-string\">&#x27;xxx&#x27;</span>, params)<br></code></pre></td></tr></table></figure>\n</li>\n<li><p>组件间通信 - 自定义事件</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\"><span class=\"hljs-keyword\">const</span> eventBus = <span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">Vue</span>()<br><br><span class=\"hljs-keyword\">export</span> <span class=\"hljs-keyword\">default</span> eventBus<br></code></pre></td></tr></table></figure>\n\n<p>用法：</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\"><span class=\"hljs-keyword\">import</span> event <span class=\"hljs-keyword\">from</span> <span class=\"hljs-string\">&#x27;./eventBus.js&#x27;</span><br><br><span class=\"hljs-comment\">// 触发事件</span><br>event.$emit(<span class=\"hljs-string\">&#x27;eventName&#x27;</span>, params)<br><br><span class=\"hljs-comment\">// 接收事件</span><br>event.$on(<span class=\"hljs-string\">&#x27;eventName&#x27;</span>, <span class=\"hljs-variable language_\">this</span>.<span class=\"hljs-property\">functionName</span>)<br><br><span class=\"hljs-comment\">// 卸载事件，一般是放在组件销毁的生命钩子里</span><br><span class=\"hljs-comment\">// 防止造成内存泄露</span><br><span class=\"hljs-title function_\">beforeDestroy</span>(<span class=\"hljs-params\"></span>) &#123;<br>  event.$off(<span class=\"hljs-string\">&#x27;eventName&#x27;</span>)<br>&#125;<br></code></pre></td></tr></table></figure>\n\n</li>\n</ul>\n<h1 id=\"Vue组件生命周期\"><a href=\"#Vue组件生命周期\" class=\"headerlink\" title=\"Vue组件生命周期\"></a>Vue组件生命周期</h1><ul>\n<li><p>beforeCreate</p>\n<p>实例在内存中创建出来，但未初始化 data和 methods</p>\n</li>\n<li><p>created</p>\n<p>实例已经在内存中创建完成，此时data和methods已初始化</p>\n</li>\n<li><p>beforeMount</p>\n<p>此时已经完成了模版的编译，只是还没有渲染到界面中去</p>\n</li>\n<li><p>mouted</p>\n<p>模版已经渲染到了浏览器，创建阶段结束，即将进入运行阶段（最新的dom）</p>\n</li>\n<li><p>beforeUpdate</p>\n<p>界面中的数据还是旧的，但是data数据已经更新，页面中和data不会保持同步</p>\n</li>\n<li><p>updated</p>\n<p>页面重新渲染完毕，页面中的数据和data保持一致</p>\n</li>\n<li><p>beforeDestroy</p>\n<p>执行该方法的时候，Vue的生命周期已经进入销毁阶段，但是实例上的各种数据和方法还处于可用状态</p>\n</li>\n<li><p>destroyed</p>\n<p> 组件已经全部销毁，Vue实例已经被销毁，Vue中的任何数据都不可用</p>\n</li>\n</ul>\n<h1 id=\"父子组件生命周期的执行过程\"><a href=\"#父子组件生命周期的执行过程\" class=\"headerlink\" title=\"父子组件生命周期的执行过程\"></a>父子组件生命周期的执行过程</h1><p>Vue官网生命钩子示例图拆解</p>\n<blockquote>\n<p><a href=\"https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/e06a5ec0d21f4907ba780ae03da4d548~tplv-k3u1fbpfcp-zoom-in-crop-mark:4536:0:0:0.awebp\">https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/e06a5ec0d21f4907ba780ae03da4d548~tplv-k3u1fbpfcp-zoom-in-crop-mark:4536:0:0:0.awebp</a></p>\n</blockquote>\n<p>父子组件生命钩子调用过程</p>\n<p>创建和挂载过程（子组件挂载完成后，父组件才会挂载完毕）</p>\n<ol>\n<li><p>parent created</p>\n</li>\n<li><p>child created</p>\n</li>\n<li><p>child mounted</p>\n</li>\n<li><p>parent mounted</p>\n</li>\n</ol>\n<p>组件更新过程 同上。</p>\n<ol>\n<li><p>parent beforeUpdate</p>\n</li>\n<li><p>child beforeUpdate</p>\n</li>\n<li><p>child updated</p>\n</li>\n<li><p>parent updated</p>\n</li>\n</ol>\n<p>组件销毁过程。</p>\n"},{"_content":"\n# 百度网盘\n\n我的资源 - js面试 - 第7章 组件化与react","source":"demo/2023面试准备/react.md","raw":"\n# 百度网盘\n\n我的资源 - js面试 - 第7章 组件化与react","date":"2023-05-12T10:49:20.034Z","updated":"2023-05-12T10:49:20.034Z","path":"demo/2023面试准备/react.html","title":"","comments":1,"layout":"page","_id":"clhkizgxp00163y0qfwwu17j7","content":"<h1 id=\"百度网盘\"><a href=\"#百度网盘\" class=\"headerlink\" title=\"百度网盘\"></a>百度网盘</h1><p>我的资源 - js面试 - 第7章 组件化与react</p>\n","site":{"data":{}},"wordcount":26,"excerpt":"","more":"<h1 id=\"百度网盘\"><a href=\"#百度网盘\" class=\"headerlink\" title=\"百度网盘\"></a>百度网盘</h1><p>我的资源 - js面试 - 第7章 组件化与react</p>\n"},{"_content":"<!DOCTYPE html>\n<html lang=\"en\">\n\n<head>\n    <meta charset=\"UTF-8\">\n    <meta http-equiv=\"X-UA-Compatible\" content=\"IE=edge\">\n    <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n    <title>山羊の前端小窝</title>\n    <style>\n        body {\n            margin: 0px;\n            padding: 0px;\n            position: fixed;\n            /* 网页背景色 */\n            background: rgb(0, 0, 0);\n        }\n    </style>\n</head>\n\n<body>\n    <canvas id=\"canvas\"></canvas>\n\n\n\n    <script>\n        // 定义requestAnimFrame函数\n        window.requestAnimFrame = function () {\n            // 检查浏览器是否支持requestAnimFrame函数\n            return (\n                window.requestAnimationFrame ||\n                window.webkitRequestAnimationFrame ||\n                window.mozRequestAnimationFrame ||\n                window.oRequestAnimationFrame ||\n                window.msRequestAnimationFrame ||\n                // 如果所有这些选项都不可用，使用设置超时来调用回调函数\n                function (callback) {\n                    window.setTimeout(callback)\n                }\n            )\n        }\n\n        // 初始化函数，用于获取canvas元素并返回相关信息\n        function init(elemid) {\n            // 获取canvas元素\n            let canvas = document.getElementById(elemid)\n            // 获取2d绘图上下文,这里d是小写的\n            c = canvas.getContext('2d')\n            // 设置canvas的宽度为窗口内宽度，高度为窗口内高度\n            w = (canvas.width = window.innerWidth)\n            h = (canvas.height = window.innerHeight)\n            // 设置填充样式为半透明黑\n            c.fillStyle = \"rgba(30,30,30,1)\"\n            // 使用填充样式填充整个canvas\n            c.fillRect(0, 0, w, h)\n            // 返回绘图上下文和canvas元素\n            return { c: c, canvas: canvas }\n        }\n\n        // 等待页面加载完成后执行函数\n        window.onload = function () {\n            // 获取绘图上下文和canvas元素\n            let c = init(\"canvas\").c,\n                canvas = init(\"canvas\").canvas,\n                // 设置canvas的宽度为窗口内宽度，高度为窗口内高度\n                w = (canvas.width = window.innerWidth),\n                h = (canvas.height = window.innerHeight),\n                // 初始化鼠标对象\n                mouse = { x: false, y: false },\n                last_mouse = {}\n\n            // 定义计算两点距离的函数\n            function dist(p1x, p1y, p2x, p2y) {\n                return Math.sqrt(Math.pow(p2x - p1x, 2) + Math.pow(p2y - p1y, 2))\n            }\n\n            // 定义 segment 类\n            class segment {\n                // 构造函数，用于初始化 segment 对象\n                constructor(parent, l, a, first) {\n                    // 如果是第一条触手段，则位置坐标为触手顶部位置\n                    // 否则位置坐标为上一个segment对象的nextPos坐标\n                    this.first = first\n                    if (first) {\n                        this.pos = {\n                            x: parent.x,\n                            y: parent.y,\n                        }\n                    } else {\n                        this.pos = {\n                            x: parent.nextPos.x,\n                            y: parent.nextPos.y,\n                        }\n                    }\n                    // 设置segment的长度和角度\n                    this.l = l\n                    this.ang = a\n                    // 计算下一个segment的坐标位置\n                    this.nextPos = {\n                        x: this.pos.x + this.l * Math.cos(this.ang),\n                        y: this.pos.y + this.l * Math.sin(this.ang),\n                    }\n                }\n                // 更新segment位置的方法\n                update(t) {\n                    // 计算segment与目标点的角度\n                    this.ang = Math.atan2(t.y - this.pos.y, t.x - this.pos.x)\n                    // 根据目标点和角度更新位置坐标\n                    this.pos.x = t.x + this.l * Math.cos(this.ang - Math.PI)\n                    this.pos.y = t.y + this.l * Math.sin(this.ang - Math.PI)\n                    // 根据新的位置坐标更新nextPos坐标\n                    this.nextPos.x = this.pos.x + this.l * Math.cos(this.ang)\n                    this.nextPos.y = this.pos.y + this.l * Math.sin(this.ang)\n                }\n                // 将 segment 回执回初始位置的方法\n                fallback(t) {\n                    // 将位置坐标设置为目标点坐标\n                    this.pos.x = t.x\n                    this.pos.y = t.y\n                    this.nextPos.x = this.pos.x + this.l * Math.cos(this.ang)\n                    this.nextPos.y = this.pos.y + this.l * Math.sin(this.ang)\n                }\n                show() {\n                    c.lineTo(this.nextPos.x, this.nextPos.y)\n                }\n            }\n\n            // 定义 tentacle 类\n            class tentacle {\n                // 构造函数，用于初始化 tentacle 对象\n                constructor(x, y, l, n, a) {\n                    // 设置触手的顶部位置坐标\n                    this.x = x\n                    this.y = y\n                    // 设置触手的长度\n                    this.l = l\n                    // 设置触手的段数\n                    this.n = n\n                    // 初始化触手的目标点对象\n                    this.t = {}\n                    // 设置触手的随机移动参数\n                    this.rand = Math.random()\n                    // 创建触手的第一条段\n                    this.segments = [new segment(this, this.l / this.n, 0, true)]\n                    // 创建其他的段\n                    for (let i = 1; i < this.n; i++) {\n                        this.segments.push(\n                            new segment(this.segments[i - 1], this.l / this.n, 0, false)\n                        )\n                    }\n                }\n                // 移动触手到目标点的方法\n                move(last_target, target) {\n                    // 计算触手顶部与目标点的角度\n                    this.angle = Math.atan2(target.y - this.y, target.x - this.x)\n                    // 计算触手的距离参数\n                    this.dt = dist(last_target.x, last_target.y, target.x, target.y)\n                    // 计算触手的目标点坐标\n                    this.t = {\n                        x: target.x - 0.8 * this.dt * Math.cos(this.angle),\n                        y: target.y - 0.8 * this.dt * Math.sin(this.angle)\n                    }\n                    // 如果计算出了目标点，则更新最后一个segment对象的位置坐标\n                    // 否则，更新最后一个segment对象的位置坐标为目标点坐标\n                    if (this.t.x) {\n                        this.segments[this.n - 1].update(this.t)\n                    } else {\n                        this.segments[this.n - 1].update(target)\n                    }\n                    // 遍历所有segment对象，更新它们的位置坐标\n                    for (let i = this.n - 2; i >= 0; i--) {\n                        this.segments[i].update(this.segments[i + 1].pos)\n                    }\n                    if (\n                        dist(this.x, this.y, target.x, target.y) <=\n                        this.l + dist(last_target.x, last_target.y, target.x, target.y)\n                    ) {\n                        this.segments[0].fallback({ x: this.x, y: this.y })\n                        for (let i = 1; i < this.n; i++) {\n                            this.segments[i].fallback(this.segments[i - 1].nextPos)\n                        }\n                    }\n                }\n                show(target) {\n                    // 如果触手与目标点的距离小于触手的长度，则回执触手\n                    if (dist(this.x, this.y, target.x, target.y) <= this.l) {\n                        // 设置全局合成操作为lighter\n                        c.globalCompositeOperation = \"lighter\"\n                        // 开始新路径\n                        c.beginPath()\n                        // 从触手起始位置开始绘制线条\n                        c.moveTo(this.x, this.y)\n                        // 遍历所有的segment对象，并使用他们的show方法回执线条\n                        for (let i = 0; i < this.n; i++) {\n                            this.segments[i].show()\n                        }\n                        // 设置线条样式\n                        c.strokeStyle = \"hsl(\" + (this.rand * 60 + 180) +\n                            \",100%,\" + (this.rand * 60 + 25) + \"%)\"\n                        // 设置线条宽度\n                        c.lineWidth = this.rand * 2\n                        // 设置线条端点样式\n                        c.lineCap = \"round\"\n                        // 设置线条连接处样式\n                        c.lineJoin = \"round\"\n                        // 绘制线条\n                        c.stroke()\n                        // 设置全局合成操作为“source-over”\n                        c.globalCompositeOperation = \"source-over\"\n                    }\n                }\n                // 绘制触手的圆形头的方法\n                show2(target) {\n                    // 开始新路径\n                    c.beginPath()\n                    // 如果触手与目标点的距离小于触手的长度，则回执白色的圆形\n                    // 否则绘制青色的圆形\n                    if (dist(this.x, this.y, target.x, target.y) <= this.l) {\n                        c.arc(this.x, this.y, 2 * this.rand + 1, 0, 2 * Math.PI)\n                        c.fillStyle = \"whith\"\n                    } else {\n                        c.arc(this.x, this.y, this.rand * 2, 0, 2 * Math.PI)\n                        c.fillStyle = \"darkcyan\"\n                    }\n                    // 填充圆形\n                    c.fill()\n                }\n            }\n            // 初始化变量\n            let maxl = 400,//触手的最大长度\n                minl = 50,//触手的最小长度\n                n = 30,//触手的段数\n                numt = 600,//触手的数量\n                tent = [],//触手的数组\n                clicked = false,//鼠标是否被按下\n                target = { x: 0, y: 0 }, //触手的目标点\n                last_target = {},//上一个触手的目标点\n                t = 0,//当前时间\n                q = 10;//触手每次移动的步长\n\n            // 创建触手对象\n            for (let i = 0; i < numt; i++) {\n                tent.push(\n                    new tentacle(\n                        Math.random() * w,//触手的横坐标\n                        Math.random() * h,//触手的纵坐标\n                        Math.random() * (maxl - minl) + minl,//触手的长度\n                        n,//触手的段数\n                        Math.random() * 2 * Math.PI,//触手的角度\n                    )\n                )\n            }\n            // 绘制图像的方法\n            function draw() {\n                // 如果鼠标移动，则计算触手的目标点与当前点的偏差\n                if (mouse.x) {\n                    target.errx = mouse.x - target.x\n                    target.erry = mouse.y - target.y\n                } else {\n                    // 否则，计算触手的目标点的横坐标\n                    target.errx =\n                        w / 2 +\n                        ((h / 2 - q) * Math.sqrt(2) * Math.cos(t)) /\n                        (Math.pow(Math.sin(t), 2) + 1) -\n                        target.x;\n                    target.erry =\n                        h / 2 +\n                        ((h / 2 - q) * Math.sqrt(2) * Math.cos(t) * Math.sin(t)) /\n                        (Math.pow(Math.sin(t), 2) + 1) -\n                        target.y;\n                }\n\n                // 更新触手的目标点坐标\n                target.x += target.errx / 10\n                target.y += target.erry / 10\n\n                // 更新时间\n                t += 0.01;\n\n                // 绘制触手的目标点\n                c.beginPath();\n                c.arc(\n                    target.x,\n                    target.y,\n                    dist(last_target.x, last_target.y, target.x, target.y) + 5,\n                    0,\n                    2 * Math.PI\n                );\n                c.fillStyle = \"hsl(210,100%,80%)\"\n                c.fill();\n\n                // 绘制所有触手的中心点\n                for (i = 0; i < numt; i++) {\n                    tent[i].move(last_target, target)\n                    tent[i].show2(target)\n                }\n                // 绘制所有触手\n                for (i = 0; i < numt; i++) {\n                    tent[i].show(target)\n                }\n                // 更新上一个触手的目标点坐标\n                last_target.x = target.x\n                last_target.y = target.y\n            }\n            // 循环执行绘制动画的函数\n            function loop() {\n                // 使用requestAnimFrame函数循环执行\n                window.requestAnimFrame(loop)\n\n                // 清空canvas\n                c.clearRect(0, 0, w, h)\n\n                // 绘制动画\n                draw()\n            }\n\n            // 监听窗口大小改变事件\n            window.addEventListener(\"resize\", function () {\n                // 重置canvas的大小\n                w = canvas.width = window.innerWidth\n                w = canvas.height = window.innerHeight\n\n                // 循环执行回执动画的函数\n                loop()\n            })\n\n            // 循环执行回执动画的函数\n            loop()\n            // 使用setInterval函数循环\n            setInterval(loop, 1000 / 60)\n\n            // 监听鼠标移动事件\n            canvas.addEventListener(\"mousemove\", function (e) {\n                // 记录上一次的鼠标位置\n                last_mouse.x = mouse.x\n                last_mouse.y = mouse.y\n\n                // 更新点前的鼠标位置\n                mouse.x = e.pageX - this.offsetLeft\n                mouse.y = e.pageY - this.offsetTop\n            }, false)\n\n            // 监听鼠标离开事件\n            canvas.addEventListener(\"mouseleave\", function (e) {\n                // 将mouse设为false\n                mouse.x = false\n                mouse.y = false\n            })\n        }\n    </script>\n</body>\n\n</html>","source":"demo/canvas/demo1.html","raw":"<!DOCTYPE html>\n<html lang=\"en\">\n\n<head>\n    <meta charset=\"UTF-8\">\n    <meta http-equiv=\"X-UA-Compatible\" content=\"IE=edge\">\n    <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n    <title>山羊の前端小窝</title>\n    <style>\n        body {\n            margin: 0px;\n            padding: 0px;\n            position: fixed;\n            /* 网页背景色 */\n            background: rgb(0, 0, 0);\n        }\n    </style>\n</head>\n\n<body>\n    <canvas id=\"canvas\"></canvas>\n\n\n\n    <script>\n        // 定义requestAnimFrame函数\n        window.requestAnimFrame = function () {\n            // 检查浏览器是否支持requestAnimFrame函数\n            return (\n                window.requestAnimationFrame ||\n                window.webkitRequestAnimationFrame ||\n                window.mozRequestAnimationFrame ||\n                window.oRequestAnimationFrame ||\n                window.msRequestAnimationFrame ||\n                // 如果所有这些选项都不可用，使用设置超时来调用回调函数\n                function (callback) {\n                    window.setTimeout(callback)\n                }\n            )\n        }\n\n        // 初始化函数，用于获取canvas元素并返回相关信息\n        function init(elemid) {\n            // 获取canvas元素\n            let canvas = document.getElementById(elemid)\n            // 获取2d绘图上下文,这里d是小写的\n            c = canvas.getContext('2d')\n            // 设置canvas的宽度为窗口内宽度，高度为窗口内高度\n            w = (canvas.width = window.innerWidth)\n            h = (canvas.height = window.innerHeight)\n            // 设置填充样式为半透明黑\n            c.fillStyle = \"rgba(30,30,30,1)\"\n            // 使用填充样式填充整个canvas\n            c.fillRect(0, 0, w, h)\n            // 返回绘图上下文和canvas元素\n            return { c: c, canvas: canvas }\n        }\n\n        // 等待页面加载完成后执行函数\n        window.onload = function () {\n            // 获取绘图上下文和canvas元素\n            let c = init(\"canvas\").c,\n                canvas = init(\"canvas\").canvas,\n                // 设置canvas的宽度为窗口内宽度，高度为窗口内高度\n                w = (canvas.width = window.innerWidth),\n                h = (canvas.height = window.innerHeight),\n                // 初始化鼠标对象\n                mouse = { x: false, y: false },\n                last_mouse = {}\n\n            // 定义计算两点距离的函数\n            function dist(p1x, p1y, p2x, p2y) {\n                return Math.sqrt(Math.pow(p2x - p1x, 2) + Math.pow(p2y - p1y, 2))\n            }\n\n            // 定义 segment 类\n            class segment {\n                // 构造函数，用于初始化 segment 对象\n                constructor(parent, l, a, first) {\n                    // 如果是第一条触手段，则位置坐标为触手顶部位置\n                    // 否则位置坐标为上一个segment对象的nextPos坐标\n                    this.first = first\n                    if (first) {\n                        this.pos = {\n                            x: parent.x,\n                            y: parent.y,\n                        }\n                    } else {\n                        this.pos = {\n                            x: parent.nextPos.x,\n                            y: parent.nextPos.y,\n                        }\n                    }\n                    // 设置segment的长度和角度\n                    this.l = l\n                    this.ang = a\n                    // 计算下一个segment的坐标位置\n                    this.nextPos = {\n                        x: this.pos.x + this.l * Math.cos(this.ang),\n                        y: this.pos.y + this.l * Math.sin(this.ang),\n                    }\n                }\n                // 更新segment位置的方法\n                update(t) {\n                    // 计算segment与目标点的角度\n                    this.ang = Math.atan2(t.y - this.pos.y, t.x - this.pos.x)\n                    // 根据目标点和角度更新位置坐标\n                    this.pos.x = t.x + this.l * Math.cos(this.ang - Math.PI)\n                    this.pos.y = t.y + this.l * Math.sin(this.ang - Math.PI)\n                    // 根据新的位置坐标更新nextPos坐标\n                    this.nextPos.x = this.pos.x + this.l * Math.cos(this.ang)\n                    this.nextPos.y = this.pos.y + this.l * Math.sin(this.ang)\n                }\n                // 将 segment 回执回初始位置的方法\n                fallback(t) {\n                    // 将位置坐标设置为目标点坐标\n                    this.pos.x = t.x\n                    this.pos.y = t.y\n                    this.nextPos.x = this.pos.x + this.l * Math.cos(this.ang)\n                    this.nextPos.y = this.pos.y + this.l * Math.sin(this.ang)\n                }\n                show() {\n                    c.lineTo(this.nextPos.x, this.nextPos.y)\n                }\n            }\n\n            // 定义 tentacle 类\n            class tentacle {\n                // 构造函数，用于初始化 tentacle 对象\n                constructor(x, y, l, n, a) {\n                    // 设置触手的顶部位置坐标\n                    this.x = x\n                    this.y = y\n                    // 设置触手的长度\n                    this.l = l\n                    // 设置触手的段数\n                    this.n = n\n                    // 初始化触手的目标点对象\n                    this.t = {}\n                    // 设置触手的随机移动参数\n                    this.rand = Math.random()\n                    // 创建触手的第一条段\n                    this.segments = [new segment(this, this.l / this.n, 0, true)]\n                    // 创建其他的段\n                    for (let i = 1; i < this.n; i++) {\n                        this.segments.push(\n                            new segment(this.segments[i - 1], this.l / this.n, 0, false)\n                        )\n                    }\n                }\n                // 移动触手到目标点的方法\n                move(last_target, target) {\n                    // 计算触手顶部与目标点的角度\n                    this.angle = Math.atan2(target.y - this.y, target.x - this.x)\n                    // 计算触手的距离参数\n                    this.dt = dist(last_target.x, last_target.y, target.x, target.y)\n                    // 计算触手的目标点坐标\n                    this.t = {\n                        x: target.x - 0.8 * this.dt * Math.cos(this.angle),\n                        y: target.y - 0.8 * this.dt * Math.sin(this.angle)\n                    }\n                    // 如果计算出了目标点，则更新最后一个segment对象的位置坐标\n                    // 否则，更新最后一个segment对象的位置坐标为目标点坐标\n                    if (this.t.x) {\n                        this.segments[this.n - 1].update(this.t)\n                    } else {\n                        this.segments[this.n - 1].update(target)\n                    }\n                    // 遍历所有segment对象，更新它们的位置坐标\n                    for (let i = this.n - 2; i >= 0; i--) {\n                        this.segments[i].update(this.segments[i + 1].pos)\n                    }\n                    if (\n                        dist(this.x, this.y, target.x, target.y) <=\n                        this.l + dist(last_target.x, last_target.y, target.x, target.y)\n                    ) {\n                        this.segments[0].fallback({ x: this.x, y: this.y })\n                        for (let i = 1; i < this.n; i++) {\n                            this.segments[i].fallback(this.segments[i - 1].nextPos)\n                        }\n                    }\n                }\n                show(target) {\n                    // 如果触手与目标点的距离小于触手的长度，则回执触手\n                    if (dist(this.x, this.y, target.x, target.y) <= this.l) {\n                        // 设置全局合成操作为lighter\n                        c.globalCompositeOperation = \"lighter\"\n                        // 开始新路径\n                        c.beginPath()\n                        // 从触手起始位置开始绘制线条\n                        c.moveTo(this.x, this.y)\n                        // 遍历所有的segment对象，并使用他们的show方法回执线条\n                        for (let i = 0; i < this.n; i++) {\n                            this.segments[i].show()\n                        }\n                        // 设置线条样式\n                        c.strokeStyle = \"hsl(\" + (this.rand * 60 + 180) +\n                            \",100%,\" + (this.rand * 60 + 25) + \"%)\"\n                        // 设置线条宽度\n                        c.lineWidth = this.rand * 2\n                        // 设置线条端点样式\n                        c.lineCap = \"round\"\n                        // 设置线条连接处样式\n                        c.lineJoin = \"round\"\n                        // 绘制线条\n                        c.stroke()\n                        // 设置全局合成操作为“source-over”\n                        c.globalCompositeOperation = \"source-over\"\n                    }\n                }\n                // 绘制触手的圆形头的方法\n                show2(target) {\n                    // 开始新路径\n                    c.beginPath()\n                    // 如果触手与目标点的距离小于触手的长度，则回执白色的圆形\n                    // 否则绘制青色的圆形\n                    if (dist(this.x, this.y, target.x, target.y) <= this.l) {\n                        c.arc(this.x, this.y, 2 * this.rand + 1, 0, 2 * Math.PI)\n                        c.fillStyle = \"whith\"\n                    } else {\n                        c.arc(this.x, this.y, this.rand * 2, 0, 2 * Math.PI)\n                        c.fillStyle = \"darkcyan\"\n                    }\n                    // 填充圆形\n                    c.fill()\n                }\n            }\n            // 初始化变量\n            let maxl = 400,//触手的最大长度\n                minl = 50,//触手的最小长度\n                n = 30,//触手的段数\n                numt = 600,//触手的数量\n                tent = [],//触手的数组\n                clicked = false,//鼠标是否被按下\n                target = { x: 0, y: 0 }, //触手的目标点\n                last_target = {},//上一个触手的目标点\n                t = 0,//当前时间\n                q = 10;//触手每次移动的步长\n\n            // 创建触手对象\n            for (let i = 0; i < numt; i++) {\n                tent.push(\n                    new tentacle(\n                        Math.random() * w,//触手的横坐标\n                        Math.random() * h,//触手的纵坐标\n                        Math.random() * (maxl - minl) + minl,//触手的长度\n                        n,//触手的段数\n                        Math.random() * 2 * Math.PI,//触手的角度\n                    )\n                )\n            }\n            // 绘制图像的方法\n            function draw() {\n                // 如果鼠标移动，则计算触手的目标点与当前点的偏差\n                if (mouse.x) {\n                    target.errx = mouse.x - target.x\n                    target.erry = mouse.y - target.y\n                } else {\n                    // 否则，计算触手的目标点的横坐标\n                    target.errx =\n                        w / 2 +\n                        ((h / 2 - q) * Math.sqrt(2) * Math.cos(t)) /\n                        (Math.pow(Math.sin(t), 2) + 1) -\n                        target.x;\n                    target.erry =\n                        h / 2 +\n                        ((h / 2 - q) * Math.sqrt(2) * Math.cos(t) * Math.sin(t)) /\n                        (Math.pow(Math.sin(t), 2) + 1) -\n                        target.y;\n                }\n\n                // 更新触手的目标点坐标\n                target.x += target.errx / 10\n                target.y += target.erry / 10\n\n                // 更新时间\n                t += 0.01;\n\n                // 绘制触手的目标点\n                c.beginPath();\n                c.arc(\n                    target.x,\n                    target.y,\n                    dist(last_target.x, last_target.y, target.x, target.y) + 5,\n                    0,\n                    2 * Math.PI\n                );\n                c.fillStyle = \"hsl(210,100%,80%)\"\n                c.fill();\n\n                // 绘制所有触手的中心点\n                for (i = 0; i < numt; i++) {\n                    tent[i].move(last_target, target)\n                    tent[i].show2(target)\n                }\n                // 绘制所有触手\n                for (i = 0; i < numt; i++) {\n                    tent[i].show(target)\n                }\n                // 更新上一个触手的目标点坐标\n                last_target.x = target.x\n                last_target.y = target.y\n            }\n            // 循环执行绘制动画的函数\n            function loop() {\n                // 使用requestAnimFrame函数循环执行\n                window.requestAnimFrame(loop)\n\n                // 清空canvas\n                c.clearRect(0, 0, w, h)\n\n                // 绘制动画\n                draw()\n            }\n\n            // 监听窗口大小改变事件\n            window.addEventListener(\"resize\", function () {\n                // 重置canvas的大小\n                w = canvas.width = window.innerWidth\n                w = canvas.height = window.innerHeight\n\n                // 循环执行回执动画的函数\n                loop()\n            })\n\n            // 循环执行回执动画的函数\n            loop()\n            // 使用setInterval函数循环\n            setInterval(loop, 1000 / 60)\n\n            // 监听鼠标移动事件\n            canvas.addEventListener(\"mousemove\", function (e) {\n                // 记录上一次的鼠标位置\n                last_mouse.x = mouse.x\n                last_mouse.y = mouse.y\n\n                // 更新点前的鼠标位置\n                mouse.x = e.pageX - this.offsetLeft\n                mouse.y = e.pageY - this.offsetTop\n            }, false)\n\n            // 监听鼠标离开事件\n            canvas.addEventListener(\"mouseleave\", function (e) {\n                // 将mouse设为false\n                mouse.x = false\n                mouse.y = false\n            })\n        }\n    </script>\n</body>\n\n</html>","date":"2023-05-12T10:49:20.037Z","updated":"2023-05-12T10:49:20.037Z","path":"demo/canvas/demo1.html","title":"","comments":1,"layout":"page","_id":"clhkizgxq00183y0q7tjvht67","content":"<!DOCTYPE html>\n<html lang=\"en\">\n\n<head>\n    <meta charset=\"UTF-8\">\n    <meta http-equiv=\"X-UA-Compatible\" content=\"IE=edge\">\n    <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n    <title>山羊の前端小窝</title>\n    <style>\n        body {\n            margin: 0px;\n            padding: 0px;\n            position: fixed;\n            /* 网页背景色 */\n            background: rgb(0, 0, 0);\n        }\n    </style>\n</head>\n\n<body>\n    <canvas id=\"canvas\"></canvas>\n\n\n\n    <script>\n        // 定义requestAnimFrame函数\n        window.requestAnimFrame = function () {\n            // 检查浏览器是否支持requestAnimFrame函数\n            return (\n                window.requestAnimationFrame ||\n                window.webkitRequestAnimationFrame ||\n                window.mozRequestAnimationFrame ||\n                window.oRequestAnimationFrame ||\n                window.msRequestAnimationFrame ||\n                // 如果所有这些选项都不可用，使用设置超时来调用回调函数\n                function (callback) {\n                    window.setTimeout(callback)\n                }\n            )\n        }\n\n        // 初始化函数，用于获取canvas元素并返回相关信息\n        function init(elemid) {\n            // 获取canvas元素\n            let canvas = document.getElementById(elemid)\n            // 获取2d绘图上下文,这里d是小写的\n            c = canvas.getContext('2d')\n            // 设置canvas的宽度为窗口内宽度，高度为窗口内高度\n            w = (canvas.width = window.innerWidth)\n            h = (canvas.height = window.innerHeight)\n            // 设置填充样式为半透明黑\n            c.fillStyle = \"rgba(30,30,30,1)\"\n            // 使用填充样式填充整个canvas\n            c.fillRect(0, 0, w, h)\n            // 返回绘图上下文和canvas元素\n            return { c: c, canvas: canvas }\n        }\n\n        // 等待页面加载完成后执行函数\n        window.onload = function () {\n            // 获取绘图上下文和canvas元素\n            let c = init(\"canvas\").c,\n                canvas = init(\"canvas\").canvas,\n                // 设置canvas的宽度为窗口内宽度，高度为窗口内高度\n                w = (canvas.width = window.innerWidth),\n                h = (canvas.height = window.innerHeight),\n                // 初始化鼠标对象\n                mouse = { x: false, y: false },\n                last_mouse = {}\n\n            // 定义计算两点距离的函数\n            function dist(p1x, p1y, p2x, p2y) {\n                return Math.sqrt(Math.pow(p2x - p1x, 2) + Math.pow(p2y - p1y, 2))\n            }\n\n            // 定义 segment 类\n            class segment {\n                // 构造函数，用于初始化 segment 对象\n                constructor(parent, l, a, first) {\n                    // 如果是第一条触手段，则位置坐标为触手顶部位置\n                    // 否则位置坐标为上一个segment对象的nextPos坐标\n                    this.first = first\n                    if (first) {\n                        this.pos = {\n                            x: parent.x,\n                            y: parent.y,\n                        }\n                    } else {\n                        this.pos = {\n                            x: parent.nextPos.x,\n                            y: parent.nextPos.y,\n                        }\n                    }\n                    // 设置segment的长度和角度\n                    this.l = l\n                    this.ang = a\n                    // 计算下一个segment的坐标位置\n                    this.nextPos = {\n                        x: this.pos.x + this.l * Math.cos(this.ang),\n                        y: this.pos.y + this.l * Math.sin(this.ang),\n                    }\n                }\n                // 更新segment位置的方法\n                update(t) {\n                    // 计算segment与目标点的角度\n                    this.ang = Math.atan2(t.y - this.pos.y, t.x - this.pos.x)\n                    // 根据目标点和角度更新位置坐标\n                    this.pos.x = t.x + this.l * Math.cos(this.ang - Math.PI)\n                    this.pos.y = t.y + this.l * Math.sin(this.ang - Math.PI)\n                    // 根据新的位置坐标更新nextPos坐标\n                    this.nextPos.x = this.pos.x + this.l * Math.cos(this.ang)\n                    this.nextPos.y = this.pos.y + this.l * Math.sin(this.ang)\n                }\n                // 将 segment 回执回初始位置的方法\n                fallback(t) {\n                    // 将位置坐标设置为目标点坐标\n                    this.pos.x = t.x\n                    this.pos.y = t.y\n                    this.nextPos.x = this.pos.x + this.l * Math.cos(this.ang)\n                    this.nextPos.y = this.pos.y + this.l * Math.sin(this.ang)\n                }\n                show() {\n                    c.lineTo(this.nextPos.x, this.nextPos.y)\n                }\n            }\n\n            // 定义 tentacle 类\n            class tentacle {\n                // 构造函数，用于初始化 tentacle 对象\n                constructor(x, y, l, n, a) {\n                    // 设置触手的顶部位置坐标\n                    this.x = x\n                    this.y = y\n                    // 设置触手的长度\n                    this.l = l\n                    // 设置触手的段数\n                    this.n = n\n                    // 初始化触手的目标点对象\n                    this.t = {}\n                    // 设置触手的随机移动参数\n                    this.rand = Math.random()\n                    // 创建触手的第一条段\n                    this.segments = [new segment(this, this.l / this.n, 0, true)]\n                    // 创建其他的段\n                    for (let i = 1; i < this.n; i++) {\n                        this.segments.push(\n                            new segment(this.segments[i - 1], this.l / this.n, 0, false)\n                        )\n                    }\n                }\n                // 移动触手到目标点的方法\n                move(last_target, target) {\n                    // 计算触手顶部与目标点的角度\n                    this.angle = Math.atan2(target.y - this.y, target.x - this.x)\n                    // 计算触手的距离参数\n                    this.dt = dist(last_target.x, last_target.y, target.x, target.y)\n                    // 计算触手的目标点坐标\n                    this.t = {\n                        x: target.x - 0.8 * this.dt * Math.cos(this.angle),\n                        y: target.y - 0.8 * this.dt * Math.sin(this.angle)\n                    }\n                    // 如果计算出了目标点，则更新最后一个segment对象的位置坐标\n                    // 否则，更新最后一个segment对象的位置坐标为目标点坐标\n                    if (this.t.x) {\n                        this.segments[this.n - 1].update(this.t)\n                    } else {\n                        this.segments[this.n - 1].update(target)\n                    }\n                    // 遍历所有segment对象，更新它们的位置坐标\n                    for (let i = this.n - 2; i >= 0; i--) {\n                        this.segments[i].update(this.segments[i + 1].pos)\n                    }\n                    if (\n                        dist(this.x, this.y, target.x, target.y) <=\n                        this.l + dist(last_target.x, last_target.y, target.x, target.y)\n                    ) {\n                        this.segments[0].fallback({ x: this.x, y: this.y })\n                        for (let i = 1; i < this.n; i++) {\n                            this.segments[i].fallback(this.segments[i - 1].nextPos)\n                        }\n                    }\n                }\n                show(target) {\n                    // 如果触手与目标点的距离小于触手的长度，则回执触手\n                    if (dist(this.x, this.y, target.x, target.y) <= this.l) {\n                        // 设置全局合成操作为lighter\n                        c.globalCompositeOperation = \"lighter\"\n                        // 开始新路径\n                        c.beginPath()\n                        // 从触手起始位置开始绘制线条\n                        c.moveTo(this.x, this.y)\n                        // 遍历所有的segment对象，并使用他们的show方法回执线条\n                        for (let i = 0; i < this.n; i++) {\n                            this.segments[i].show()\n                        }\n                        // 设置线条样式\n                        c.strokeStyle = \"hsl(\" + (this.rand * 60 + 180) +\n                            \",100%,\" + (this.rand * 60 + 25) + \"%)\"\n                        // 设置线条宽度\n                        c.lineWidth = this.rand * 2\n                        // 设置线条端点样式\n                        c.lineCap = \"round\"\n                        // 设置线条连接处样式\n                        c.lineJoin = \"round\"\n                        // 绘制线条\n                        c.stroke()\n                        // 设置全局合成操作为“source-over”\n                        c.globalCompositeOperation = \"source-over\"\n                    }\n                }\n                // 绘制触手的圆形头的方法\n                show2(target) {\n                    // 开始新路径\n                    c.beginPath()\n                    // 如果触手与目标点的距离小于触手的长度，则回执白色的圆形\n                    // 否则绘制青色的圆形\n                    if (dist(this.x, this.y, target.x, target.y) <= this.l) {\n                        c.arc(this.x, this.y, 2 * this.rand + 1, 0, 2 * Math.PI)\n                        c.fillStyle = \"whith\"\n                    } else {\n                        c.arc(this.x, this.y, this.rand * 2, 0, 2 * Math.PI)\n                        c.fillStyle = \"darkcyan\"\n                    }\n                    // 填充圆形\n                    c.fill()\n                }\n            }\n            // 初始化变量\n            let maxl = 400,//触手的最大长度\n                minl = 50,//触手的最小长度\n                n = 30,//触手的段数\n                numt = 600,//触手的数量\n                tent = [],//触手的数组\n                clicked = false,//鼠标是否被按下\n                target = { x: 0, y: 0 }, //触手的目标点\n                last_target = {},//上一个触手的目标点\n                t = 0,//当前时间\n                q = 10;//触手每次移动的步长\n\n            // 创建触手对象\n            for (let i = 0; i < numt; i++) {\n                tent.push(\n                    new tentacle(\n                        Math.random() * w,//触手的横坐标\n                        Math.random() * h,//触手的纵坐标\n                        Math.random() * (maxl - minl) + minl,//触手的长度\n                        n,//触手的段数\n                        Math.random() * 2 * Math.PI,//触手的角度\n                    )\n                )\n            }\n            // 绘制图像的方法\n            function draw() {\n                // 如果鼠标移动，则计算触手的目标点与当前点的偏差\n                if (mouse.x) {\n                    target.errx = mouse.x - target.x\n                    target.erry = mouse.y - target.y\n                } else {\n                    // 否则，计算触手的目标点的横坐标\n                    target.errx =\n                        w / 2 +\n                        ((h / 2 - q) * Math.sqrt(2) * Math.cos(t)) /\n                        (Math.pow(Math.sin(t), 2) + 1) -\n                        target.x;\n                    target.erry =\n                        h / 2 +\n                        ((h / 2 - q) * Math.sqrt(2) * Math.cos(t) * Math.sin(t)) /\n                        (Math.pow(Math.sin(t), 2) + 1) -\n                        target.y;\n                }\n\n                // 更新触手的目标点坐标\n                target.x += target.errx / 10\n                target.y += target.erry / 10\n\n                // 更新时间\n                t += 0.01;\n\n                // 绘制触手的目标点\n                c.beginPath();\n                c.arc(\n                    target.x,\n                    target.y,\n                    dist(last_target.x, last_target.y, target.x, target.y) + 5,\n                    0,\n                    2 * Math.PI\n                );\n                c.fillStyle = \"hsl(210,100%,80%)\"\n                c.fill();\n\n                // 绘制所有触手的中心点\n                for (i = 0; i < numt; i++) {\n                    tent[i].move(last_target, target)\n                    tent[i].show2(target)\n                }\n                // 绘制所有触手\n                for (i = 0; i < numt; i++) {\n                    tent[i].show(target)\n                }\n                // 更新上一个触手的目标点坐标\n                last_target.x = target.x\n                last_target.y = target.y\n            }\n            // 循环执行绘制动画的函数\n            function loop() {\n                // 使用requestAnimFrame函数循环执行\n                window.requestAnimFrame(loop)\n\n                // 清空canvas\n                c.clearRect(0, 0, w, h)\n\n                // 绘制动画\n                draw()\n            }\n\n            // 监听窗口大小改变事件\n            window.addEventListener(\"resize\", function () {\n                // 重置canvas的大小\n                w = canvas.width = window.innerWidth\n                w = canvas.height = window.innerHeight\n\n                // 循环执行回执动画的函数\n                loop()\n            })\n\n            // 循环执行回执动画的函数\n            loop()\n            // 使用setInterval函数循环\n            setInterval(loop, 1000 / 60)\n\n            // 监听鼠标移动事件\n            canvas.addEventListener(\"mousemove\", function (e) {\n                // 记录上一次的鼠标位置\n                last_mouse.x = mouse.x\n                last_mouse.y = mouse.y\n\n                // 更新点前的鼠标位置\n                mouse.x = e.pageX - this.offsetLeft\n                mouse.y = e.pageY - this.offsetTop\n            }, false)\n\n            // 监听鼠标离开事件\n            canvas.addEventListener(\"mouseleave\", function (e) {\n                // 将mouse设为false\n                mouse.x = false\n                mouse.y = false\n            })\n        }\n    </script>\n</body>\n\n</html>","site":{"data":{}},"wordcount":3036,"excerpt":"","more":"<!DOCTYPE html>\n<html lang=\"en\">\n\n<head>\n    <meta charset=\"UTF-8\">\n    <meta http-equiv=\"X-UA-Compatible\" content=\"IE=edge\">\n    <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n    <title>山羊の前端小窝</title>\n    <style>\n        body {\n            margin: 0px;\n            padding: 0px;\n            position: fixed;\n            /* 网页背景色 */\n            background: rgb(0, 0, 0);\n        }\n    </style>\n</head>\n\n<body>\n    <canvas id=\"canvas\"></canvas>\n\n\n\n    <script>\n        // 定义requestAnimFrame函数\n        window.requestAnimFrame = function () {\n            // 检查浏览器是否支持requestAnimFrame函数\n            return (\n                window.requestAnimationFrame ||\n                window.webkitRequestAnimationFrame ||\n                window.mozRequestAnimationFrame ||\n                window.oRequestAnimationFrame ||\n                window.msRequestAnimationFrame ||\n                // 如果所有这些选项都不可用，使用设置超时来调用回调函数\n                function (callback) {\n                    window.setTimeout(callback)\n                }\n            )\n        }\n\n        // 初始化函数，用于获取canvas元素并返回相关信息\n        function init(elemid) {\n            // 获取canvas元素\n            let canvas = document.getElementById(elemid)\n            // 获取2d绘图上下文,这里d是小写的\n            c = canvas.getContext('2d')\n            // 设置canvas的宽度为窗口内宽度，高度为窗口内高度\n            w = (canvas.width = window.innerWidth)\n            h = (canvas.height = window.innerHeight)\n            // 设置填充样式为半透明黑\n            c.fillStyle = \"rgba(30,30,30,1)\"\n            // 使用填充样式填充整个canvas\n            c.fillRect(0, 0, w, h)\n            // 返回绘图上下文和canvas元素\n            return { c: c, canvas: canvas }\n        }\n\n        // 等待页面加载完成后执行函数\n        window.onload = function () {\n            // 获取绘图上下文和canvas元素\n            let c = init(\"canvas\").c,\n                canvas = init(\"canvas\").canvas,\n                // 设置canvas的宽度为窗口内宽度，高度为窗口内高度\n                w = (canvas.width = window.innerWidth),\n                h = (canvas.height = window.innerHeight),\n                // 初始化鼠标对象\n                mouse = { x: false, y: false },\n                last_mouse = {}\n\n            // 定义计算两点距离的函数\n            function dist(p1x, p1y, p2x, p2y) {\n                return Math.sqrt(Math.pow(p2x - p1x, 2) + Math.pow(p2y - p1y, 2))\n            }\n\n            // 定义 segment 类\n            class segment {\n                // 构造函数，用于初始化 segment 对象\n                constructor(parent, l, a, first) {\n                    // 如果是第一条触手段，则位置坐标为触手顶部位置\n                    // 否则位置坐标为上一个segment对象的nextPos坐标\n                    this.first = first\n                    if (first) {\n                        this.pos = {\n                            x: parent.x,\n                            y: parent.y,\n                        }\n                    } else {\n                        this.pos = {\n                            x: parent.nextPos.x,\n                            y: parent.nextPos.y,\n                        }\n                    }\n                    // 设置segment的长度和角度\n                    this.l = l\n                    this.ang = a\n                    // 计算下一个segment的坐标位置\n                    this.nextPos = {\n                        x: this.pos.x + this.l * Math.cos(this.ang),\n                        y: this.pos.y + this.l * Math.sin(this.ang),\n                    }\n                }\n                // 更新segment位置的方法\n                update(t) {\n                    // 计算segment与目标点的角度\n                    this.ang = Math.atan2(t.y - this.pos.y, t.x - this.pos.x)\n                    // 根据目标点和角度更新位置坐标\n                    this.pos.x = t.x + this.l * Math.cos(this.ang - Math.PI)\n                    this.pos.y = t.y + this.l * Math.sin(this.ang - Math.PI)\n                    // 根据新的位置坐标更新nextPos坐标\n                    this.nextPos.x = this.pos.x + this.l * Math.cos(this.ang)\n                    this.nextPos.y = this.pos.y + this.l * Math.sin(this.ang)\n                }\n                // 将 segment 回执回初始位置的方法\n                fallback(t) {\n                    // 将位置坐标设置为目标点坐标\n                    this.pos.x = t.x\n                    this.pos.y = t.y\n                    this.nextPos.x = this.pos.x + this.l * Math.cos(this.ang)\n                    this.nextPos.y = this.pos.y + this.l * Math.sin(this.ang)\n                }\n                show() {\n                    c.lineTo(this.nextPos.x, this.nextPos.y)\n                }\n            }\n\n            // 定义 tentacle 类\n            class tentacle {\n                // 构造函数，用于初始化 tentacle 对象\n                constructor(x, y, l, n, a) {\n                    // 设置触手的顶部位置坐标\n                    this.x = x\n                    this.y = y\n                    // 设置触手的长度\n                    this.l = l\n                    // 设置触手的段数\n                    this.n = n\n                    // 初始化触手的目标点对象\n                    this.t = {}\n                    // 设置触手的随机移动参数\n                    this.rand = Math.random()\n                    // 创建触手的第一条段\n                    this.segments = [new segment(this, this.l / this.n, 0, true)]\n                    // 创建其他的段\n                    for (let i = 1; i < this.n; i++) {\n                        this.segments.push(\n                            new segment(this.segments[i - 1], this.l / this.n, 0, false)\n                        )\n                    }\n                }\n                // 移动触手到目标点的方法\n                move(last_target, target) {\n                    // 计算触手顶部与目标点的角度\n                    this.angle = Math.atan2(target.y - this.y, target.x - this.x)\n                    // 计算触手的距离参数\n                    this.dt = dist(last_target.x, last_target.y, target.x, target.y)\n                    // 计算触手的目标点坐标\n                    this.t = {\n                        x: target.x - 0.8 * this.dt * Math.cos(this.angle),\n                        y: target.y - 0.8 * this.dt * Math.sin(this.angle)\n                    }\n                    // 如果计算出了目标点，则更新最后一个segment对象的位置坐标\n                    // 否则，更新最后一个segment对象的位置坐标为目标点坐标\n                    if (this.t.x) {\n                        this.segments[this.n - 1].update(this.t)\n                    } else {\n                        this.segments[this.n - 1].update(target)\n                    }\n                    // 遍历所有segment对象，更新它们的位置坐标\n                    for (let i = this.n - 2; i >= 0; i--) {\n                        this.segments[i].update(this.segments[i + 1].pos)\n                    }\n                    if (\n                        dist(this.x, this.y, target.x, target.y) <=\n                        this.l + dist(last_target.x, last_target.y, target.x, target.y)\n                    ) {\n                        this.segments[0].fallback({ x: this.x, y: this.y })\n                        for (let i = 1; i < this.n; i++) {\n                            this.segments[i].fallback(this.segments[i - 1].nextPos)\n                        }\n                    }\n                }\n                show(target) {\n                    // 如果触手与目标点的距离小于触手的长度，则回执触手\n                    if (dist(this.x, this.y, target.x, target.y) <= this.l) {\n                        // 设置全局合成操作为lighter\n                        c.globalCompositeOperation = \"lighter\"\n                        // 开始新路径\n                        c.beginPath()\n                        // 从触手起始位置开始绘制线条\n                        c.moveTo(this.x, this.y)\n                        // 遍历所有的segment对象，并使用他们的show方法回执线条\n                        for (let i = 0; i < this.n; i++) {\n                            this.segments[i].show()\n                        }\n                        // 设置线条样式\n                        c.strokeStyle = \"hsl(\" + (this.rand * 60 + 180) +\n                            \",100%,\" + (this.rand * 60 + 25) + \"%)\"\n                        // 设置线条宽度\n                        c.lineWidth = this.rand * 2\n                        // 设置线条端点样式\n                        c.lineCap = \"round\"\n                        // 设置线条连接处样式\n                        c.lineJoin = \"round\"\n                        // 绘制线条\n                        c.stroke()\n                        // 设置全局合成操作为“source-over”\n                        c.globalCompositeOperation = \"source-over\"\n                    }\n                }\n                // 绘制触手的圆形头的方法\n                show2(target) {\n                    // 开始新路径\n                    c.beginPath()\n                    // 如果触手与目标点的距离小于触手的长度，则回执白色的圆形\n                    // 否则绘制青色的圆形\n                    if (dist(this.x, this.y, target.x, target.y) <= this.l) {\n                        c.arc(this.x, this.y, 2 * this.rand + 1, 0, 2 * Math.PI)\n                        c.fillStyle = \"whith\"\n                    } else {\n                        c.arc(this.x, this.y, this.rand * 2, 0, 2 * Math.PI)\n                        c.fillStyle = \"darkcyan\"\n                    }\n                    // 填充圆形\n                    c.fill()\n                }\n            }\n            // 初始化变量\n            let maxl = 400,//触手的最大长度\n                minl = 50,//触手的最小长度\n                n = 30,//触手的段数\n                numt = 600,//触手的数量\n                tent = [],//触手的数组\n                clicked = false,//鼠标是否被按下\n                target = { x: 0, y: 0 }, //触手的目标点\n                last_target = {},//上一个触手的目标点\n                t = 0,//当前时间\n                q = 10;//触手每次移动的步长\n\n            // 创建触手对象\n            for (let i = 0; i < numt; i++) {\n                tent.push(\n                    new tentacle(\n                        Math.random() * w,//触手的横坐标\n                        Math.random() * h,//触手的纵坐标\n                        Math.random() * (maxl - minl) + minl,//触手的长度\n                        n,//触手的段数\n                        Math.random() * 2 * Math.PI,//触手的角度\n                    )\n                )\n            }\n            // 绘制图像的方法\n            function draw() {\n                // 如果鼠标移动，则计算触手的目标点与当前点的偏差\n                if (mouse.x) {\n                    target.errx = mouse.x - target.x\n                    target.erry = mouse.y - target.y\n                } else {\n                    // 否则，计算触手的目标点的横坐标\n                    target.errx =\n                        w / 2 +\n                        ((h / 2 - q) * Math.sqrt(2) * Math.cos(t)) /\n                        (Math.pow(Math.sin(t), 2) + 1) -\n                        target.x;\n                    target.erry =\n                        h / 2 +\n                        ((h / 2 - q) * Math.sqrt(2) * Math.cos(t) * Math.sin(t)) /\n                        (Math.pow(Math.sin(t), 2) + 1) -\n                        target.y;\n                }\n\n                // 更新触手的目标点坐标\n                target.x += target.errx / 10\n                target.y += target.erry / 10\n\n                // 更新时间\n                t += 0.01;\n\n                // 绘制触手的目标点\n                c.beginPath();\n                c.arc(\n                    target.x,\n                    target.y,\n                    dist(last_target.x, last_target.y, target.x, target.y) + 5,\n                    0,\n                    2 * Math.PI\n                );\n                c.fillStyle = \"hsl(210,100%,80%)\"\n                c.fill();\n\n                // 绘制所有触手的中心点\n                for (i = 0; i < numt; i++) {\n                    tent[i].move(last_target, target)\n                    tent[i].show2(target)\n                }\n                // 绘制所有触手\n                for (i = 0; i < numt; i++) {\n                    tent[i].show(target)\n                }\n                // 更新上一个触手的目标点坐标\n                last_target.x = target.x\n                last_target.y = target.y\n            }\n            // 循环执行绘制动画的函数\n            function loop() {\n                // 使用requestAnimFrame函数循环执行\n                window.requestAnimFrame(loop)\n\n                // 清空canvas\n                c.clearRect(0, 0, w, h)\n\n                // 绘制动画\n                draw()\n            }\n\n            // 监听窗口大小改变事件\n            window.addEventListener(\"resize\", function () {\n                // 重置canvas的大小\n                w = canvas.width = window.innerWidth\n                w = canvas.height = window.innerHeight\n\n                // 循环执行回执动画的函数\n                loop()\n            })\n\n            // 循环执行回执动画的函数\n            loop()\n            // 使用setInterval函数循环\n            setInterval(loop, 1000 / 60)\n\n            // 监听鼠标移动事件\n            canvas.addEventListener(\"mousemove\", function (e) {\n                // 记录上一次的鼠标位置\n                last_mouse.x = mouse.x\n                last_mouse.y = mouse.y\n\n                // 更新点前的鼠标位置\n                mouse.x = e.pageX - this.offsetLeft\n                mouse.y = e.pageY - this.offsetTop\n            }, false)\n\n            // 监听鼠标离开事件\n            canvas.addEventListener(\"mouseleave\", function (e) {\n                // 将mouse设为false\n                mouse.x = false\n                mouse.y = false\n            })\n        }\n    </script>\n</body>\n\n</html>"},{"_content":"<!DOCTYPE html>\n<html lang=\"en\">\n<head>\n  <meta charset=\"UTF-8\">\n  <meta http-equiv=\"X-UA-Compatible\" content=\"IE=edge\">\n  <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n  <title>prefers-color-scheme</title>\n\n  <style>\n    .day   { background: #eee; color: black; }\n    .night { background: #333; color: white; }\n\n    @media (prefers-color-scheme: dark) {\n      .day.dark-scheme   { background:  #333; color: white; }\n      .night.dark-scheme { background: black; color:  red; }\n    }\n\n    @media (prefers-color-scheme: light) {\n      .day.light-scheme   { background: skyblue; color:  #333; }\n      .night.light-scheme { background:  pink; color: #333; }\n    }\n\n    .day, .night {\n      display: inline-block;\n      padding: 1em;\n      width: 7em;\n      height: 7em;\n      vertical-align: middle;\n    }\n\n    :root {\n      --color: #333;\n      --background-color: pink;\n    }\n\n    [data-theme=\"dark\"] {\n      --color: #fff;\n      --background-color: #000;\n    }\n\n  </style>\n</head>\n<body>\n  <h1 style=\"background-color: var(--background-color); color: var(--color)\">MDN: prefers-color-scheme CSS 媒体特性用于检测用户是否有将系统的主题色设置为亮色或者暗色。</h1>\n\n  <hr>\n\n  <div class=\"day light-scheme\">Day (changes in light scheme)</div>\n  <div class=\"day dark-scheme\">Day (changes in dark scheme)</div> <br>\n\n  <div class=\"night light-scheme\">Night (changes in light scheme)</div>\n  <div class=\"night dark-scheme\">Night (changes in dark scheme)</div>\n\n  <button class=\"dark-btn\">dark mode</button>\n  \n  <script>\n\n    window.onload = function() {\n      // 如果匹配成功，scheme.matches === true\n      // 也就是说，如果我们的系统是暗黑色，那么这个 matches 就是true，否则是 false\n      const scheme = window.matchMedia('(prefers-color-scheme: dark)')\n\n      scheme.addEventListener('change', e => {\n        console.log(e)\n        if (e.matches) {\n          // 表示亮色模式\n          document.documentElement.setAttribute('data-theme', 'dark')\n        } else {\n          document.documentElement.setAttribute('data-theme', 'light')\n        }\n      })\n      \n      const darkBtn = document.querySelector('.dark-btn')\n\n      darkBtn.addEventListener('click', () => {\n        // 设置主题色\n        document.documentElement.setAttribute('data-theme', 'dark')\n        // document.documentElement.style.setProperty('--color', '#fff')\n        // document.documentElement.style.setProperty('--background-color', '#000')\n      })\n    }\n  </script>\n</body>\n</html>","source":"demo/theme/prefers-color-scheme.html","raw":"<!DOCTYPE html>\n<html lang=\"en\">\n<head>\n  <meta charset=\"UTF-8\">\n  <meta http-equiv=\"X-UA-Compatible\" content=\"IE=edge\">\n  <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n  <title>prefers-color-scheme</title>\n\n  <style>\n    .day   { background: #eee; color: black; }\n    .night { background: #333; color: white; }\n\n    @media (prefers-color-scheme: dark) {\n      .day.dark-scheme   { background:  #333; color: white; }\n      .night.dark-scheme { background: black; color:  red; }\n    }\n\n    @media (prefers-color-scheme: light) {\n      .day.light-scheme   { background: skyblue; color:  #333; }\n      .night.light-scheme { background:  pink; color: #333; }\n    }\n\n    .day, .night {\n      display: inline-block;\n      padding: 1em;\n      width: 7em;\n      height: 7em;\n      vertical-align: middle;\n    }\n\n    :root {\n      --color: #333;\n      --background-color: pink;\n    }\n\n    [data-theme=\"dark\"] {\n      --color: #fff;\n      --background-color: #000;\n    }\n\n  </style>\n</head>\n<body>\n  <h1 style=\"background-color: var(--background-color); color: var(--color)\">MDN: prefers-color-scheme CSS 媒体特性用于检测用户是否有将系统的主题色设置为亮色或者暗色。</h1>\n\n  <hr>\n\n  <div class=\"day light-scheme\">Day (changes in light scheme)</div>\n  <div class=\"day dark-scheme\">Day (changes in dark scheme)</div> <br>\n\n  <div class=\"night light-scheme\">Night (changes in light scheme)</div>\n  <div class=\"night dark-scheme\">Night (changes in dark scheme)</div>\n\n  <button class=\"dark-btn\">dark mode</button>\n  \n  <script>\n\n    window.onload = function() {\n      // 如果匹配成功，scheme.matches === true\n      // 也就是说，如果我们的系统是暗黑色，那么这个 matches 就是true，否则是 false\n      const scheme = window.matchMedia('(prefers-color-scheme: dark)')\n\n      scheme.addEventListener('change', e => {\n        console.log(e)\n        if (e.matches) {\n          // 表示亮色模式\n          document.documentElement.setAttribute('data-theme', 'dark')\n        } else {\n          document.documentElement.setAttribute('data-theme', 'light')\n        }\n      })\n      \n      const darkBtn = document.querySelector('.dark-btn')\n\n      darkBtn.addEventListener('click', () => {\n        // 设置主题色\n        document.documentElement.setAttribute('data-theme', 'dark')\n        // document.documentElement.style.setProperty('--color', '#fff')\n        // document.documentElement.style.setProperty('--background-color', '#000')\n      })\n    }\n  </script>\n</body>\n</html>","date":"2023-05-12T10:49:20.039Z","updated":"2023-05-12T10:49:20.039Z","path":"demo/theme/prefers-color-scheme.html","title":"","comments":1,"layout":"page","_id":"clhkizgxr001b3y0q0w94hvs7","content":"<!DOCTYPE html>\n<html lang=\"en\">\n<head>\n  <meta charset=\"UTF-8\">\n  <meta http-equiv=\"X-UA-Compatible\" content=\"IE=edge\">\n  <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n  <title>prefers-color-scheme</title>\n\n  <style>\n    .day   { background: #eee; color: black; }\n    .night { background: #333; color: white; }\n\n    @media (prefers-color-scheme: dark) {\n      .day.dark-scheme   { background:  #333; color: white; }\n      .night.dark-scheme { background: black; color:  red; }\n    }\n\n    @media (prefers-color-scheme: light) {\n      .day.light-scheme   { background: skyblue; color:  #333; }\n      .night.light-scheme { background:  pink; color: #333; }\n    }\n\n    .day, .night {\n      display: inline-block;\n      padding: 1em;\n      width: 7em;\n      height: 7em;\n      vertical-align: middle;\n    }\n\n    :root {\n      --color: #333;\n      --background-color: pink;\n    }\n\n    [data-theme=\"dark\"] {\n      --color: #fff;\n      --background-color: #000;\n    }\n\n  </style>\n</head>\n<body>\n  <h1 style=\"background-color: var(--background-color); color: var(--color)\">MDN: prefers-color-scheme CSS 媒体特性用于检测用户是否有将系统的主题色设置为亮色或者暗色。</h1>\n\n  <hr>\n\n  <div class=\"day light-scheme\">Day (changes in light scheme)</div>\n  <div class=\"day dark-scheme\">Day (changes in dark scheme)</div> <br>\n\n  <div class=\"night light-scheme\">Night (changes in light scheme)</div>\n  <div class=\"night dark-scheme\">Night (changes in dark scheme)</div>\n\n  <button class=\"dark-btn\">dark mode</button>\n  \n  <script>\n\n    window.onload = function() {\n      // 如果匹配成功，scheme.matches === true\n      // 也就是说，如果我们的系统是暗黑色，那么这个 matches 就是true，否则是 false\n      const scheme = window.matchMedia('(prefers-color-scheme: dark)')\n\n      scheme.addEventListener('change', e => {\n        console.log(e)\n        if (e.matches) {\n          // 表示亮色模式\n          document.documentElement.setAttribute('data-theme', 'dark')\n        } else {\n          document.documentElement.setAttribute('data-theme', 'light')\n        }\n      })\n      \n      const darkBtn = document.querySelector('.dark-btn')\n\n      darkBtn.addEventListener('click', () => {\n        // 设置主题色\n        document.documentElement.setAttribute('data-theme', 'dark')\n        // document.documentElement.style.setProperty('--color', '#fff')\n        // document.documentElement.style.setProperty('--background-color', '#000')\n      })\n    }\n  </script>\n</body>\n</html>","site":{"data":{}},"wordcount":1357,"excerpt":"","more":"<!DOCTYPE html>\n<html lang=\"en\">\n<head>\n  <meta charset=\"UTF-8\">\n  <meta http-equiv=\"X-UA-Compatible\" content=\"IE=edge\">\n  <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n  <title>prefers-color-scheme</title>\n\n  <style>\n    .day   { background: #eee; color: black; }\n    .night { background: #333; color: white; }\n\n    @media (prefers-color-scheme: dark) {\n      .day.dark-scheme   { background:  #333; color: white; }\n      .night.dark-scheme { background: black; color:  red; }\n    }\n\n    @media (prefers-color-scheme: light) {\n      .day.light-scheme   { background: skyblue; color:  #333; }\n      .night.light-scheme { background:  pink; color: #333; }\n    }\n\n    .day, .night {\n      display: inline-block;\n      padding: 1em;\n      width: 7em;\n      height: 7em;\n      vertical-align: middle;\n    }\n\n    :root {\n      --color: #333;\n      --background-color: pink;\n    }\n\n    [data-theme=\"dark\"] {\n      --color: #fff;\n      --background-color: #000;\n    }\n\n  </style>\n</head>\n<body>\n  <h1 style=\"background-color: var(--background-color); color: var(--color)\">MDN: prefers-color-scheme CSS 媒体特性用于检测用户是否有将系统的主题色设置为亮色或者暗色。</h1>\n\n  <hr>\n\n  <div class=\"day light-scheme\">Day (changes in light scheme)</div>\n  <div class=\"day dark-scheme\">Day (changes in dark scheme)</div> <br>\n\n  <div class=\"night light-scheme\">Night (changes in light scheme)</div>\n  <div class=\"night dark-scheme\">Night (changes in dark scheme)</div>\n\n  <button class=\"dark-btn\">dark mode</button>\n  \n  <script>\n\n    window.onload = function() {\n      // 如果匹配成功，scheme.matches === true\n      // 也就是说，如果我们的系统是暗黑色，那么这个 matches 就是true，否则是 false\n      const scheme = window.matchMedia('(prefers-color-scheme: dark)')\n\n      scheme.addEventListener('change', e => {\n        console.log(e)\n        if (e.matches) {\n          // 表示亮色模式\n          document.documentElement.setAttribute('data-theme', 'dark')\n        } else {\n          document.documentElement.setAttribute('data-theme', 'light')\n        }\n      })\n      \n      const darkBtn = document.querySelector('.dark-btn')\n\n      darkBtn.addEventListener('click', () => {\n        // 设置主题色\n        document.documentElement.setAttribute('data-theme', 'dark')\n        // document.documentElement.style.setProperty('--color', '#fff')\n        // document.documentElement.style.setProperty('--background-color', '#000')\n      })\n    }\n  </script>\n</body>\n</html>"},{"_content":"class SanpshotSandbox {\n  constructor() {\n      this.proxy = window; //window属性\n      this.modifyPropsMap = {} //记录在window上的修改\n      this.active();\n  }\n\n  // 激活沙箱\n  active() {\n      this.windowSnapshot = {}; //拍照，将 window 的每个属性都记录到 windowSnapshot\n      for (const prop in window) {\n          if (window.hasOwnProperty(prop)) {\n              this.windowSnapshot[prop] = window[prop];\n          }\n      }\n      // 将上次的修改进行一个应用 到 当前的window上\n      Object.keys(this.modifyPropsMap).forEach(p => {\n          // 将上次修改过得赋到window上\n          window[p] = this.modifyPropsMap[p];\n      })\n  }\n\n  // 丢弃沙箱\n  inactve() {\n      for (const prop in window) {\n          if (window.hasOwnProperty(prop)) {\n              if (window[prop] !== this.windowSnapshot[prop]) {\n                  // 拿现在的和一年前的作比较 如果他俩不一样了 说明换这个属性有变化 有变化就把变化记录在变化表里\n                  this.modifyPropsMap[prop] = window[prop]\n                  // 最后在将window变回一年前\n                  window[prop] = this.windowSnapshot[prop]\n              }\n          }\n      }\n  }\n}\n\nlet sandbox = new SanpshotSandbox();\n\n//通过沙箱返回一个代理\n((window) => {\n  window.a = 1;\n  window.b = 2;\n  console.log(window.a, window.b); // 1  2\n  sandbox.inactve(); //失去激活后\n  console.log(window.a, window.b); // undefined  undefined\n  sandbox.active(); //激活\n  console.log(window.a, window.b);  // 1  2\n})(sandbox.proxy); //sandbox.proxy就是window","source":"demo/micro-app/SanpshotSandbox.js","raw":"class SanpshotSandbox {\n  constructor() {\n      this.proxy = window; //window属性\n      this.modifyPropsMap = {} //记录在window上的修改\n      this.active();\n  }\n\n  // 激活沙箱\n  active() {\n      this.windowSnapshot = {}; //拍照，将 window 的每个属性都记录到 windowSnapshot\n      for (const prop in window) {\n          if (window.hasOwnProperty(prop)) {\n              this.windowSnapshot[prop] = window[prop];\n          }\n      }\n      // 将上次的修改进行一个应用 到 当前的window上\n      Object.keys(this.modifyPropsMap).forEach(p => {\n          // 将上次修改过得赋到window上\n          window[p] = this.modifyPropsMap[p];\n      })\n  }\n\n  // 丢弃沙箱\n  inactve() {\n      for (const prop in window) {\n          if (window.hasOwnProperty(prop)) {\n              if (window[prop] !== this.windowSnapshot[prop]) {\n                  // 拿现在的和一年前的作比较 如果他俩不一样了 说明换这个属性有变化 有变化就把变化记录在变化表里\n                  this.modifyPropsMap[prop] = window[prop]\n                  // 最后在将window变回一年前\n                  window[prop] = this.windowSnapshot[prop]\n              }\n          }\n      }\n  }\n}\n\nlet sandbox = new SanpshotSandbox();\n\n//通过沙箱返回一个代理\n((window) => {\n  window.a = 1;\n  window.b = 2;\n  console.log(window.a, window.b); // 1  2\n  sandbox.inactve(); //失去激活后\n  console.log(window.a, window.b); // undefined  undefined\n  sandbox.active(); //激活\n  console.log(window.a, window.b);  // 1  2\n})(sandbox.proxy); //sandbox.proxy就是window","date":"2023-05-12T10:49:20.037Z","updated":"2023-05-12T10:49:20.037Z","path":"demo/micro-app/SanpshotSandbox.js","layout":"false","title":"","comments":1,"_id":"clhkizgxs001e3y0q7ls1dmiv","content":"class SanpshotSandbox {\n  constructor() {\n      this.proxy = window; //window属性\n      this.modifyPropsMap = {} //记录在window上的修改\n      this.active();\n  }\n\n  // 激活沙箱\n  active() {\n      this.windowSnapshot = {}; //拍照，将 window 的每个属性都记录到 windowSnapshot\n      for (const prop in window) {\n          if (window.hasOwnProperty(prop)) {\n              this.windowSnapshot[prop] = window[prop];\n          }\n      }\n      // 将上次的修改进行一个应用 到 当前的window上\n      Object.keys(this.modifyPropsMap).forEach(p => {\n          // 将上次修改过得赋到window上\n          window[p] = this.modifyPropsMap[p];\n      })\n  }\n\n  // 丢弃沙箱\n  inactve() {\n      for (const prop in window) {\n          if (window.hasOwnProperty(prop)) {\n              if (window[prop] !== this.windowSnapshot[prop]) {\n                  // 拿现在的和一年前的作比较 如果他俩不一样了 说明换这个属性有变化 有变化就把变化记录在变化表里\n                  this.modifyPropsMap[prop] = window[prop]\n                  // 最后在将window变回一年前\n                  window[prop] = this.windowSnapshot[prop]\n              }\n          }\n      }\n  }\n}\n\nlet sandbox = new SanpshotSandbox();\n\n//通过沙箱返回一个代理\n((window) => {\n  window.a = 1;\n  window.b = 2;\n  console.log(window.a, window.b); // 1  2\n  sandbox.inactve(); //失去激活后\n  console.log(window.a, window.b); // undefined  undefined\n  sandbox.active(); //激活\n  console.log(window.a, window.b);  // 1  2\n})(sandbox.proxy); //sandbox.proxy就是window","site":{"data":{}},"wordcount":954,"excerpt":"","more":"class SanpshotSandbox {\n  constructor() {\n      this.proxy = window; //window属性\n      this.modifyPropsMap = {} //记录在window上的修改\n      this.active();\n  }\n\n  // 激活沙箱\n  active() {\n      this.windowSnapshot = {}; //拍照，将 window 的每个属性都记录到 windowSnapshot\n      for (const prop in window) {\n          if (window.hasOwnProperty(prop)) {\n              this.windowSnapshot[prop] = window[prop];\n          }\n      }\n      // 将上次的修改进行一个应用 到 当前的window上\n      Object.keys(this.modifyPropsMap).forEach(p => {\n          // 将上次修改过得赋到window上\n          window[p] = this.modifyPropsMap[p];\n      })\n  }\n\n  // 丢弃沙箱\n  inactve() {\n      for (const prop in window) {\n          if (window.hasOwnProperty(prop)) {\n              if (window[prop] !== this.windowSnapshot[prop]) {\n                  // 拿现在的和一年前的作比较 如果他俩不一样了 说明换这个属性有变化 有变化就把变化记录在变化表里\n                  this.modifyPropsMap[prop] = window[prop]\n                  // 最后在将window变回一年前\n                  window[prop] = this.windowSnapshot[prop]\n              }\n          }\n      }\n  }\n}\n\nlet sandbox = new SanpshotSandbox();\n\n//通过沙箱返回一个代理\n((window) => {\n  window.a = 1;\n  window.b = 2;\n  console.log(window.a, window.b); // 1  2\n  sandbox.inactve(); //失去激活后\n  console.log(window.a, window.b); // undefined  undefined\n  sandbox.active(); //激活\n  console.log(window.a, window.b);  // 1  2\n})(sandbox.proxy); //sandbox.proxy就是window"},{"_content":"<!DOCTYPE html>\n<html lang=\"en\">\n<head>\n  <meta charset=\"UTF-8\">\n  <meta http-equiv=\"X-UA-Compatible\" content=\"IE=edge\">\n  <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n  <title>Document</title>\n</head>\n<body>\n  <!-- <script src=\"./SanpshotSandbox.js\"></script> -->\n  <script src=\"./legacySandbox.js\"></script>\n</body>\n</html>","source":"demo/micro-app/index.html","raw":"<!DOCTYPE html>\n<html lang=\"en\">\n<head>\n  <meta charset=\"UTF-8\">\n  <meta http-equiv=\"X-UA-Compatible\" content=\"IE=edge\">\n  <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n  <title>Document</title>\n</head>\n<body>\n  <!-- <script src=\"./SanpshotSandbox.js\"></script> -->\n  <script src=\"./legacySandbox.js\"></script>\n</body>\n</html>","date":"2023-05-12T10:49:20.037Z","updated":"2023-05-12T10:49:20.037Z","path":"demo/micro-app/index.html","title":"","comments":1,"layout":"page","_id":"clhkizgxu001h3y0qbjfg3yl0","content":"<!DOCTYPE html>\n<html lang=\"en\">\n<head>\n  <meta charset=\"UTF-8\">\n  <meta http-equiv=\"X-UA-Compatible\" content=\"IE=edge\">\n  <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n  <title>Document</title>\n</head>\n<body>\n  <!-- <script src=\"./SanpshotSandbox.js\"></script> -->\n  <script src=\"./legacySandbox.js\"></script>\n</body>\n</html>","site":{"data":{}},"wordcount":8,"excerpt":"","more":"<!DOCTYPE html>\n<html lang=\"en\">\n<head>\n  <meta charset=\"UTF-8\">\n  <meta http-equiv=\"X-UA-Compatible\" content=\"IE=edge\">\n  <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n  <title>Document</title>\n</head>\n<body>\n  <!-- <script src=\"./SanpshotSandbox.js\"></script> -->\n  <script src=\"./legacySandbox.js\"></script>\n</body>\n</html>"},{"_content":"class LegacySandBox{\n  addedPropsMapInSandbox = new Map();\n  modifiedPropsOriginalValueMapInSandbox = new Map();\n  currentUpdatedPropsValueMap = new Map();\n  proxyWindow;\n  setWindowProp(prop, value, toDelete = false){\n      if(value === undefined && toDelete){\n          delete window[prop];\n      }else{\n          window[prop] = value;\n      }\n  }\n  active(){\n      this.currentUpdatedPropsValueMap.forEach((value, prop)=>this.setWindowProp(prop, value));\n  }\n  inactive(){\n      this.modifiedPropsOriginalValueMapInSandbox.forEach((value, prop)=>this.setWindowProp(prop, value));\n      this.addedPropsMapInSandbox.forEach((_, prop)=>this.setWindowProp(prop, undefined, true));\n  }\n  constructor(){\n      const fakeWindow = Object.create(null);\n      this.proxyWindow = new Proxy(fakeWindow,{\n          set:(target, prop, value, receiver)=>{\n              const originalVal = window[prop];\n              if(!window.hasOwnProperty(prop)){\n                  this.addedPropsMapInSandbox.set(prop, value);\n              }else if(!this.modifiedPropsOriginalValueMapInSandbox.has(prop)){\n                  this.modifiedPropsOriginalValueMapInSandbox.set(prop, originalVal);\n              }\n              this.currentUpdatedPropsValueMap.set(prop, value);\n              window[prop] = value;\n          },\n          get:(target, prop, receiver)=>{\n              return target[prop];\n          }\n      });\n  }\n}\n// 验证：\nlet legacySandBox = new LegacySandBox();\nlegacySandBox.active();\nlegacySandBox.proxyWindow.city = 'Beijing';\nconsole.log('window.city-01:', window.city);\nlegacySandBox.inactive();\nconsole.log('window.city-02:', window.city);\nlegacySandBox.active();\nconsole.log('window.city-03:', window.city);\nlegacySandBox.inactive();\n","source":"demo/micro-app/legacySandbox.js","raw":"class LegacySandBox{\n  addedPropsMapInSandbox = new Map();\n  modifiedPropsOriginalValueMapInSandbox = new Map();\n  currentUpdatedPropsValueMap = new Map();\n  proxyWindow;\n  setWindowProp(prop, value, toDelete = false){\n      if(value === undefined && toDelete){\n          delete window[prop];\n      }else{\n          window[prop] = value;\n      }\n  }\n  active(){\n      this.currentUpdatedPropsValueMap.forEach((value, prop)=>this.setWindowProp(prop, value));\n  }\n  inactive(){\n      this.modifiedPropsOriginalValueMapInSandbox.forEach((value, prop)=>this.setWindowProp(prop, value));\n      this.addedPropsMapInSandbox.forEach((_, prop)=>this.setWindowProp(prop, undefined, true));\n  }\n  constructor(){\n      const fakeWindow = Object.create(null);\n      this.proxyWindow = new Proxy(fakeWindow,{\n          set:(target, prop, value, receiver)=>{\n              const originalVal = window[prop];\n              if(!window.hasOwnProperty(prop)){\n                  this.addedPropsMapInSandbox.set(prop, value);\n              }else if(!this.modifiedPropsOriginalValueMapInSandbox.has(prop)){\n                  this.modifiedPropsOriginalValueMapInSandbox.set(prop, originalVal);\n              }\n              this.currentUpdatedPropsValueMap.set(prop, value);\n              window[prop] = value;\n          },\n          get:(target, prop, receiver)=>{\n              return target[prop];\n          }\n      });\n  }\n}\n// 验证：\nlet legacySandBox = new LegacySandBox();\nlegacySandBox.active();\nlegacySandBox.proxyWindow.city = 'Beijing';\nconsole.log('window.city-01:', window.city);\nlegacySandBox.inactive();\nconsole.log('window.city-02:', window.city);\nlegacySandBox.active();\nconsole.log('window.city-03:', window.city);\nlegacySandBox.inactive();\n","date":"2023-05-12T10:49:20.038Z","updated":"2023-05-12T10:49:20.038Z","path":"demo/micro-app/legacySandbox.js","layout":"false","title":"","comments":1,"_id":"clhkizgxv001j3y0q4cvucocv","content":"class LegacySandBox{\n  addedPropsMapInSandbox = new Map();\n  modifiedPropsOriginalValueMapInSandbox = new Map();\n  currentUpdatedPropsValueMap = new Map();\n  proxyWindow;\n  setWindowProp(prop, value, toDelete = false){\n      if(value === undefined && toDelete){\n          delete window[prop];\n      }else{\n          window[prop] = value;\n      }\n  }\n  active(){\n      this.currentUpdatedPropsValueMap.forEach((value, prop)=>this.setWindowProp(prop, value));\n  }\n  inactive(){\n      this.modifiedPropsOriginalValueMapInSandbox.forEach((value, prop)=>this.setWindowProp(prop, value));\n      this.addedPropsMapInSandbox.forEach((_, prop)=>this.setWindowProp(prop, undefined, true));\n  }\n  constructor(){\n      const fakeWindow = Object.create(null);\n      this.proxyWindow = new Proxy(fakeWindow,{\n          set:(target, prop, value, receiver)=>{\n              const originalVal = window[prop];\n              if(!window.hasOwnProperty(prop)){\n                  this.addedPropsMapInSandbox.set(prop, value);\n              }else if(!this.modifiedPropsOriginalValueMapInSandbox.has(prop)){\n                  this.modifiedPropsOriginalValueMapInSandbox.set(prop, originalVal);\n              }\n              this.currentUpdatedPropsValueMap.set(prop, value);\n              window[prop] = value;\n          },\n          get:(target, prop, receiver)=>{\n              return target[prop];\n          }\n      });\n  }\n}\n// 验证：\nlet legacySandBox = new LegacySandBox();\nlegacySandBox.active();\nlegacySandBox.proxyWindow.city = 'Beijing';\nconsole.log('window.city-01:', window.city);\nlegacySandBox.inactive();\nconsole.log('window.city-02:', window.city);\nlegacySandBox.active();\nconsole.log('window.city-03:', window.city);\nlegacySandBox.inactive();\n","site":{"data":{}},"wordcount":1353,"excerpt":"","more":"class LegacySandBox{\n  addedPropsMapInSandbox = new Map();\n  modifiedPropsOriginalValueMapInSandbox = new Map();\n  currentUpdatedPropsValueMap = new Map();\n  proxyWindow;\n  setWindowProp(prop, value, toDelete = false){\n      if(value === undefined && toDelete){\n          delete window[prop];\n      }else{\n          window[prop] = value;\n      }\n  }\n  active(){\n      this.currentUpdatedPropsValueMap.forEach((value, prop)=>this.setWindowProp(prop, value));\n  }\n  inactive(){\n      this.modifiedPropsOriginalValueMapInSandbox.forEach((value, prop)=>this.setWindowProp(prop, value));\n      this.addedPropsMapInSandbox.forEach((_, prop)=>this.setWindowProp(prop, undefined, true));\n  }\n  constructor(){\n      const fakeWindow = Object.create(null);\n      this.proxyWindow = new Proxy(fakeWindow,{\n          set:(target, prop, value, receiver)=>{\n              const originalVal = window[prop];\n              if(!window.hasOwnProperty(prop)){\n                  this.addedPropsMapInSandbox.set(prop, value);\n              }else if(!this.modifiedPropsOriginalValueMapInSandbox.has(prop)){\n                  this.modifiedPropsOriginalValueMapInSandbox.set(prop, originalVal);\n              }\n              this.currentUpdatedPropsValueMap.set(prop, value);\n              window[prop] = value;\n          },\n          get:(target, prop, receiver)=>{\n              return target[prop];\n          }\n      });\n  }\n}\n// 验证：\nlet legacySandBox = new LegacySandBox();\nlegacySandBox.active();\nlegacySandBox.proxyWindow.city = 'Beijing';\nconsole.log('window.city-01:', window.city);\nlegacySandBox.inactive();\nconsole.log('window.city-02:', window.city);\nlegacySandBox.active();\nconsole.log('window.city-03:', window.city);\nlegacySandBox.inactive();\n"},{"_content":"# Web Components\n\n作为开发者，我们都知道尽可能多的重用代码是一个好主意。这对于自定义标记结构来说通常不是那么容易 — 想想复杂的 HTML（以及相关的样式和脚本），有时您不得不写代码来呈现自定义 UI 控件，并且如果您不小心的话，多次使用它们会使您的页面变得一团糟。\n\n## 组成\n\n- Custom elements（自定义元素）\n\n- Shadow DOM（影子 DOM）\n\n- HTML templates（HTML 模板）\n\n## Custom elements（自定义元素）\n\n##  Shadow DOM（影子 DOM）\n\n## templates and slots\n\n复用结构，减少使用相同的标记结构。\n\n\n## 组件通信\n\n> Lightning Web Component\n\n在 LWC 中，可以通过实现 CustomEvent 接口进行自定义事件，通过 EventTarget.dispatchEvent() 来分配事件。\n\n**注意：**\n\n定义事件时，不需要在事件名前加 on，因为在使用的时候会默认在名称前使用 on，比如：当我们定义了 click 事件，在 HTML 代码中用 onclick 来调用它\n\n- 父组件\n```js\n// parent comp\nconnectedCallback() {\n  const child = this.shadowRoot.querySelector('child-wc')\n\n  // 1. 通过 DOM 属性传参，会触发子组件的 attributeChangedCallback 钩子\n  child.setAttribute('text', 'Parent changed the Text')\n\n  // 2. 通过组件实例直接修改内部数据（⚠️未获取到）\n  // console.log('??', child)\n\n  // 3. 监听子组件内部定义的事件\n  child.addEventListener('custom-event', ({ detail }) => {\n    console.log('事件触发 ', detail.value);\n  })\n  }\n```\n\n- 子组件\n\n```js\n// child comp\nconnectedCallback() {\n  // 定义事件\n  const event = new CustomEvent('custom-event', {\n    detail: {\n      value: 'child web component'\n    }\n  })\n  this.dispatchEvent(event)\n\n  const btn = this.shadowRoot.querySelector('button')\n  btn.addEventListener('click', () => {\n    // 获取父组件\n    this.getRootNode().host.sayHello('Hello :')\n  })\n}\n```\n\n## 子组件直接调用父组件实例上的方法\n\n```js\n// parent comp\nsayHello(msg) {\n  console.log(msg, this.data)\n}\n\n\n// child comp\nconnectedCallback() {\n  const btn = this.shadowRoot.querySelector('button')\n\n  btn.addEventListener('click', () => {\n    // 获取父组件实例\n    this.getRootNode().host.sayHello('Hello :')\n  })\n}\n```\n\n## 监听组件上属性的变化\n\n```js\n// parent\nconst child = this.shadowRoot.querySelector('child-wc')\n// 1. 通过 DOM 属性传参，会触发子组件的 attributeChangedCallback 钩子\nchild.setAttribute('text', 'Parent changed the Text')\n\n\n\n// child\n// 监听属性变化，必须定静态的 observedAttributes 方法\nstatic get observedAttributes() {\n  return ['text'];\n}\nattributeChangedCallback(name, oldValue, newValue) {\n  console.log('name', name)\n  console.log('oldValue', oldValue)\n  console.log('newValue', newValue)\n}\n```\n\n# web component in ReactJS\n\nReact 和 Web Components 为了解决不同的问题而生。\n\nWeb Components 为可复用组件提供了强大的封装，而 React 则提供了声明式的解决方案，使 DOM 与数据保持同步。\n\n两者旨在互补。作为开发人员，可以自由选择在 Web Components 中使用 React，或者在 React 中使用 Web Components，或者两者共存。\n\n## 问题\n\n> \"react\": \"^16.12.0\"\n\n```js\nclass MyApp extends React.Component {\n  render() {\n  \treturn <span onClick={() => alert('I have been clicked')}>Click me</span>;\n  }\n}\n\nclass ShadowElement extends HTMLElement {\n  constructor() {\n    super()\n  }\n\n  connectedCallback() {\n    const mountPoint = document.createElement('div');\n    const shadowRoot = this.attachShadow({ mode: 'open' });\n\n    shadowRoot.appendChild(mountPoint);\n\n    ReactDOM.render(<MyApp />, mountPoint);\n  }\n}\n\n\ncustomElements.define('my-custom-element', ShadowElement);\n\n\n// 使用\n\n<div className=\"app-main\" onClick={()=> console.log('app main clicked')}>\n  <my-custom-element></my-custom-element>\n</div>\n```\n\n效果图\n\n![](/img/react-v16.gif)\n\n> \"react\": \"^17.0.2\" 及以上版本，已解决此问题。\n\n代码一致，效果图。\n\n![](/img/react-v17.gif)\n\n\n## 解决方案\n\n> Web Components 触发的事件可能无法通过 React 渲染树正确的传递。 你需要在 React 组件中手动添加事件处理器来处理这些事件。\n\nShadow DOM 重定向了 click 事件并将其封装在 shadow 中，将组件内部的所有内容封装在单独的作用域中，并隔离事件。React 并不支持这样的 Shadow DOM，因此事件委托失败，事件无法触发。\n\n这意味着，如果您将带有 click 事件的 React 组件放在 Web 组件中，则点击事件可能不会冒泡到 React 组件中。这是因为事件在 Web 组件的 Shadow DOM 中触发，然后被封装在 Shadow DOM 中，而不会传播到外部组件。\n\n如果您希望在使用 Web 组件时能够触发 React 事件，则可以使用上述方法之一，例如重新绑定事件到实际的 shadow 容器并使用 \"__reactInternalInstances\" 来调度正确的 React 事件。您还可以使用其他方法来解决此问题，例如使用自定义事件或使用事件代理。\n\n\n> https://stackoverflow.com/questions/37866237/click-event-not-firing-when-react-component-in-a-shadow-dom\n\n\n**相关文章：当 Shadow Dom 遇上 React event**\n\n> https://github.com/huruji/blog/issues/104\n\n\n# 参考链接\n- [MDN官方文档](https://developer.mozilla.org/zh-CN/docs/Web/Web_Components/Using_templates_and_slots)\n- [WC官方示例](https://github1s.com/mdn/web-components-examples/blob/main/shadow-part/main.js)\n- [基于 Web Components 跨框架组件开发](http://www.xieluping.cn/post/wc/)\n- [Shadow :host 选择器](https://blog.csdn.net/qq_37718797/article/details/122970991)\n","source":"demo/webcomponent/README.md","raw":"# Web Components\n\n作为开发者，我们都知道尽可能多的重用代码是一个好主意。这对于自定义标记结构来说通常不是那么容易 — 想想复杂的 HTML（以及相关的样式和脚本），有时您不得不写代码来呈现自定义 UI 控件，并且如果您不小心的话，多次使用它们会使您的页面变得一团糟。\n\n## 组成\n\n- Custom elements（自定义元素）\n\n- Shadow DOM（影子 DOM）\n\n- HTML templates（HTML 模板）\n\n## Custom elements（自定义元素）\n\n##  Shadow DOM（影子 DOM）\n\n## templates and slots\n\n复用结构，减少使用相同的标记结构。\n\n\n## 组件通信\n\n> Lightning Web Component\n\n在 LWC 中，可以通过实现 CustomEvent 接口进行自定义事件，通过 EventTarget.dispatchEvent() 来分配事件。\n\n**注意：**\n\n定义事件时，不需要在事件名前加 on，因为在使用的时候会默认在名称前使用 on，比如：当我们定义了 click 事件，在 HTML 代码中用 onclick 来调用它\n\n- 父组件\n```js\n// parent comp\nconnectedCallback() {\n  const child = this.shadowRoot.querySelector('child-wc')\n\n  // 1. 通过 DOM 属性传参，会触发子组件的 attributeChangedCallback 钩子\n  child.setAttribute('text', 'Parent changed the Text')\n\n  // 2. 通过组件实例直接修改内部数据（⚠️未获取到）\n  // console.log('??', child)\n\n  // 3. 监听子组件内部定义的事件\n  child.addEventListener('custom-event', ({ detail }) => {\n    console.log('事件触发 ', detail.value);\n  })\n  }\n```\n\n- 子组件\n\n```js\n// child comp\nconnectedCallback() {\n  // 定义事件\n  const event = new CustomEvent('custom-event', {\n    detail: {\n      value: 'child web component'\n    }\n  })\n  this.dispatchEvent(event)\n\n  const btn = this.shadowRoot.querySelector('button')\n  btn.addEventListener('click', () => {\n    // 获取父组件\n    this.getRootNode().host.sayHello('Hello :')\n  })\n}\n```\n\n## 子组件直接调用父组件实例上的方法\n\n```js\n// parent comp\nsayHello(msg) {\n  console.log(msg, this.data)\n}\n\n\n// child comp\nconnectedCallback() {\n  const btn = this.shadowRoot.querySelector('button')\n\n  btn.addEventListener('click', () => {\n    // 获取父组件实例\n    this.getRootNode().host.sayHello('Hello :')\n  })\n}\n```\n\n## 监听组件上属性的变化\n\n```js\n// parent\nconst child = this.shadowRoot.querySelector('child-wc')\n// 1. 通过 DOM 属性传参，会触发子组件的 attributeChangedCallback 钩子\nchild.setAttribute('text', 'Parent changed the Text')\n\n\n\n// child\n// 监听属性变化，必须定静态的 observedAttributes 方法\nstatic get observedAttributes() {\n  return ['text'];\n}\nattributeChangedCallback(name, oldValue, newValue) {\n  console.log('name', name)\n  console.log('oldValue', oldValue)\n  console.log('newValue', newValue)\n}\n```\n\n# web component in ReactJS\n\nReact 和 Web Components 为了解决不同的问题而生。\n\nWeb Components 为可复用组件提供了强大的封装，而 React 则提供了声明式的解决方案，使 DOM 与数据保持同步。\n\n两者旨在互补。作为开发人员，可以自由选择在 Web Components 中使用 React，或者在 React 中使用 Web Components，或者两者共存。\n\n## 问题\n\n> \"react\": \"^16.12.0\"\n\n```js\nclass MyApp extends React.Component {\n  render() {\n  \treturn <span onClick={() => alert('I have been clicked')}>Click me</span>;\n  }\n}\n\nclass ShadowElement extends HTMLElement {\n  constructor() {\n    super()\n  }\n\n  connectedCallback() {\n    const mountPoint = document.createElement('div');\n    const shadowRoot = this.attachShadow({ mode: 'open' });\n\n    shadowRoot.appendChild(mountPoint);\n\n    ReactDOM.render(<MyApp />, mountPoint);\n  }\n}\n\n\ncustomElements.define('my-custom-element', ShadowElement);\n\n\n// 使用\n\n<div className=\"app-main\" onClick={()=> console.log('app main clicked')}>\n  <my-custom-element></my-custom-element>\n</div>\n```\n\n效果图\n\n![](/img/react-v16.gif)\n\n> \"react\": \"^17.0.2\" 及以上版本，已解决此问题。\n\n代码一致，效果图。\n\n![](/img/react-v17.gif)\n\n\n## 解决方案\n\n> Web Components 触发的事件可能无法通过 React 渲染树正确的传递。 你需要在 React 组件中手动添加事件处理器来处理这些事件。\n\nShadow DOM 重定向了 click 事件并将其封装在 shadow 中，将组件内部的所有内容封装在单独的作用域中，并隔离事件。React 并不支持这样的 Shadow DOM，因此事件委托失败，事件无法触发。\n\n这意味着，如果您将带有 click 事件的 React 组件放在 Web 组件中，则点击事件可能不会冒泡到 React 组件中。这是因为事件在 Web 组件的 Shadow DOM 中触发，然后被封装在 Shadow DOM 中，而不会传播到外部组件。\n\n如果您希望在使用 Web 组件时能够触发 React 事件，则可以使用上述方法之一，例如重新绑定事件到实际的 shadow 容器并使用 \"__reactInternalInstances\" 来调度正确的 React 事件。您还可以使用其他方法来解决此问题，例如使用自定义事件或使用事件代理。\n\n\n> https://stackoverflow.com/questions/37866237/click-event-not-firing-when-react-component-in-a-shadow-dom\n\n\n**相关文章：当 Shadow Dom 遇上 React event**\n\n> https://github.com/huruji/blog/issues/104\n\n\n# 参考链接\n- [MDN官方文档](https://developer.mozilla.org/zh-CN/docs/Web/Web_Components/Using_templates_and_slots)\n- [WC官方示例](https://github1s.com/mdn/web-components-examples/blob/main/shadow-part/main.js)\n- [基于 Web Components 跨框架组件开发](http://www.xieluping.cn/post/wc/)\n- [Shadow :host 选择器](https://blog.csdn.net/qq_37718797/article/details/122970991)\n","date":"2023-05-12T10:49:20.039Z","updated":"2023-05-12T10:49:20.039Z","path":"demo/webcomponent/README.html","title":"","comments":1,"layout":"page","_id":"clhkizgxv001l3y0qadj6a0hl","content":"<h1 id=\"Web-Components\"><a href=\"#Web-Components\" class=\"headerlink\" title=\"Web Components\"></a>Web Components</h1><p>作为开发者，我们都知道尽可能多的重用代码是一个好主意。这对于自定义标记结构来说通常不是那么容易 — 想想复杂的 HTML（以及相关的样式和脚本），有时您不得不写代码来呈现自定义 UI 控件，并且如果您不小心的话，多次使用它们会使您的页面变得一团糟。</p>\n<h2 id=\"组成\"><a href=\"#组成\" class=\"headerlink\" title=\"组成\"></a>组成</h2><ul>\n<li><p>Custom elements（自定义元素）</p>\n</li>\n<li><p>Shadow DOM（影子 DOM）</p>\n</li>\n<li><p>HTML templates（HTML 模板）</p>\n</li>\n</ul>\n<h2 id=\"Custom-elements（自定义元素）\"><a href=\"#Custom-elements（自定义元素）\" class=\"headerlink\" title=\"Custom elements（自定义元素）\"></a>Custom elements（自定义元素）</h2><h2 id=\"Shadow-DOM（影子-DOM）\"><a href=\"#Shadow-DOM（影子-DOM）\" class=\"headerlink\" title=\"Shadow DOM（影子 DOM）\"></a>Shadow DOM（影子 DOM）</h2><h2 id=\"templates-and-slots\"><a href=\"#templates-and-slots\" class=\"headerlink\" title=\"templates and slots\"></a>templates and slots</h2><p>复用结构，减少使用相同的标记结构。</p>\n<h2 id=\"组件通信\"><a href=\"#组件通信\" class=\"headerlink\" title=\"组件通信\"></a>组件通信</h2><blockquote>\n<p>Lightning Web Component</p>\n</blockquote>\n<p>在 LWC 中，可以通过实现 CustomEvent 接口进行自定义事件，通过 EventTarget.dispatchEvent() 来分配事件。</p>\n<p><strong>注意：</strong></p>\n<p>定义事件时，不需要在事件名前加 on，因为在使用的时候会默认在名称前使用 on，比如：当我们定义了 click 事件，在 HTML 代码中用 onclick 来调用它</p>\n<ul>\n<li><p>父组件</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><div class=\"code-wrapper\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></div></td><td class=\"code\"><pre><code class=\"hljs js\"><span class=\"hljs-comment\">// parent comp</span><br><span class=\"hljs-title function_\">connectedCallback</span>(<span class=\"hljs-params\"></span>) &#123;<br>  <span class=\"hljs-keyword\">const</span> child = <span class=\"hljs-variable language_\">this</span>.<span class=\"hljs-property\">shadowRoot</span>.<span class=\"hljs-title function_\">querySelector</span>(<span class=\"hljs-string\">&#x27;child-wc&#x27;</span>)<br><br>  <span class=\"hljs-comment\">// 1. 通过 DOM 属性传参，会触发子组件的 attributeChangedCallback 钩子</span><br>  child.<span class=\"hljs-title function_\">setAttribute</span>(<span class=\"hljs-string\">&#x27;text&#x27;</span>, <span class=\"hljs-string\">&#x27;Parent changed the Text&#x27;</span>)<br><br>  <span class=\"hljs-comment\">// 2. 通过组件实例直接修改内部数据（⚠️未获取到）</span><br>  <span class=\"hljs-comment\">// console.log(&#x27;??&#x27;, child)</span><br><br>  <span class=\"hljs-comment\">// 3. 监听子组件内部定义的事件</span><br>  child.<span class=\"hljs-title function_\">addEventListener</span>(<span class=\"hljs-string\">&#x27;custom-event&#x27;</span>, <span class=\"hljs-function\">(<span class=\"hljs-params\">&#123; detail &#125;</span>) =&gt;</span> &#123;<br>    <span class=\"hljs-variable language_\">console</span>.<span class=\"hljs-title function_\">log</span>(<span class=\"hljs-string\">&#x27;事件触发 &#x27;</span>, detail.<span class=\"hljs-property\">value</span>);<br>  &#125;)<br>  &#125;<br></code></pre></td></tr></table></figure>\n</li>\n<li><p>子组件</p>\n</li>\n</ul>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\"><span class=\"hljs-comment\">// child comp</span><br><span class=\"hljs-title function_\">connectedCallback</span>(<span class=\"hljs-params\"></span>) &#123;<br>  <span class=\"hljs-comment\">// 定义事件</span><br>  <span class=\"hljs-keyword\">const</span> event = <span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">CustomEvent</span>(<span class=\"hljs-string\">&#x27;custom-event&#x27;</span>, &#123;<br>    <span class=\"hljs-attr\">detail</span>: &#123;<br>      <span class=\"hljs-attr\">value</span>: <span class=\"hljs-string\">&#x27;child web component&#x27;</span><br>    &#125;<br>  &#125;)<br>  <span class=\"hljs-variable language_\">this</span>.<span class=\"hljs-title function_\">dispatchEvent</span>(event)<br><br>  <span class=\"hljs-keyword\">const</span> btn = <span class=\"hljs-variable language_\">this</span>.<span class=\"hljs-property\">shadowRoot</span>.<span class=\"hljs-title function_\">querySelector</span>(<span class=\"hljs-string\">&#x27;button&#x27;</span>)<br>  btn.<span class=\"hljs-title function_\">addEventListener</span>(<span class=\"hljs-string\">&#x27;click&#x27;</span>, <span class=\"hljs-function\">() =&gt;</span> &#123;<br>    <span class=\"hljs-comment\">// 获取父组件</span><br>    <span class=\"hljs-variable language_\">this</span>.<span class=\"hljs-title function_\">getRootNode</span>().<span class=\"hljs-property\">host</span>.<span class=\"hljs-title function_\">sayHello</span>(<span class=\"hljs-string\">&#x27;Hello :&#x27;</span>)<br>  &#125;)<br>&#125;<br></code></pre></td></tr></table></figure>\n\n<h2 id=\"子组件直接调用父组件实例上的方法\"><a href=\"#子组件直接调用父组件实例上的方法\" class=\"headerlink\" title=\"子组件直接调用父组件实例上的方法\"></a>子组件直接调用父组件实例上的方法</h2><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\"><span class=\"hljs-comment\">// parent comp</span><br><span class=\"hljs-title function_\">sayHello</span>(<span class=\"hljs-params\">msg</span>) &#123;<br>  <span class=\"hljs-variable language_\">console</span>.<span class=\"hljs-title function_\">log</span>(msg, <span class=\"hljs-variable language_\">this</span>.<span class=\"hljs-property\">data</span>)<br>&#125;<br><br><br><span class=\"hljs-comment\">// child comp</span><br><span class=\"hljs-title function_\">connectedCallback</span>(<span class=\"hljs-params\"></span>) &#123;<br>  <span class=\"hljs-keyword\">const</span> btn = <span class=\"hljs-variable language_\">this</span>.<span class=\"hljs-property\">shadowRoot</span>.<span class=\"hljs-title function_\">querySelector</span>(<span class=\"hljs-string\">&#x27;button&#x27;</span>)<br><br>  btn.<span class=\"hljs-title function_\">addEventListener</span>(<span class=\"hljs-string\">&#x27;click&#x27;</span>, <span class=\"hljs-function\">() =&gt;</span> &#123;<br>    <span class=\"hljs-comment\">// 获取父组件实例</span><br>    <span class=\"hljs-variable language_\">this</span>.<span class=\"hljs-title function_\">getRootNode</span>().<span class=\"hljs-property\">host</span>.<span class=\"hljs-title function_\">sayHello</span>(<span class=\"hljs-string\">&#x27;Hello :&#x27;</span>)<br>  &#125;)<br>&#125;<br></code></pre></td></tr></table></figure>\n\n<h2 id=\"监听组件上属性的变化\"><a href=\"#监听组件上属性的变化\" class=\"headerlink\" title=\"监听组件上属性的变化\"></a>监听组件上属性的变化</h2><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\"><span class=\"hljs-comment\">// parent</span><br><span class=\"hljs-keyword\">const</span> child = <span class=\"hljs-variable language_\">this</span>.<span class=\"hljs-property\">shadowRoot</span>.<span class=\"hljs-title function_\">querySelector</span>(<span class=\"hljs-string\">&#x27;child-wc&#x27;</span>)<br><span class=\"hljs-comment\">// 1. 通过 DOM 属性传参，会触发子组件的 attributeChangedCallback 钩子</span><br>child.<span class=\"hljs-title function_\">setAttribute</span>(<span class=\"hljs-string\">&#x27;text&#x27;</span>, <span class=\"hljs-string\">&#x27;Parent changed the Text&#x27;</span>)<br><br><br><br><span class=\"hljs-comment\">// child</span><br><span class=\"hljs-comment\">// 监听属性变化，必须定静态的 observedAttributes 方法</span><br><span class=\"hljs-keyword\">static</span> <span class=\"hljs-keyword\">get</span> <span class=\"hljs-title function_\">observedAttributes</span>() &#123;<br>  <span class=\"hljs-keyword\">return</span> [<span class=\"hljs-string\">&#x27;text&#x27;</span>];<br>&#125;<br><span class=\"hljs-title function_\">attributeChangedCallback</span>(<span class=\"hljs-params\">name, oldValue, newValue</span>) &#123;<br>  <span class=\"hljs-variable language_\">console</span>.<span class=\"hljs-title function_\">log</span>(<span class=\"hljs-string\">&#x27;name&#x27;</span>, name)<br>  <span class=\"hljs-variable language_\">console</span>.<span class=\"hljs-title function_\">log</span>(<span class=\"hljs-string\">&#x27;oldValue&#x27;</span>, oldValue)<br>  <span class=\"hljs-variable language_\">console</span>.<span class=\"hljs-title function_\">log</span>(<span class=\"hljs-string\">&#x27;newValue&#x27;</span>, newValue)<br>&#125;<br></code></pre></td></tr></table></figure>\n\n<h1 id=\"web-component-in-ReactJS\"><a href=\"#web-component-in-ReactJS\" class=\"headerlink\" title=\"web component in ReactJS\"></a>web component in ReactJS</h1><p>React 和 Web Components 为了解决不同的问题而生。</p>\n<p>Web Components 为可复用组件提供了强大的封装，而 React 则提供了声明式的解决方案，使 DOM 与数据保持同步。</p>\n<p>两者旨在互补。作为开发人员，可以自由选择在 Web Components 中使用 React，或者在 React 中使用 Web Components，或者两者共存。</p>\n<h2 id=\"问题\"><a href=\"#问题\" class=\"headerlink\" title=\"问题\"></a>问题</h2><blockquote>\n<p>“react”: “^16.12.0”</p>\n</blockquote>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\"><span class=\"hljs-keyword\">class</span> <span class=\"hljs-title class_\">MyApp</span> <span class=\"hljs-keyword\">extends</span> <span class=\"hljs-title class_ inherited__\">React.Component</span> &#123;<br>  <span class=\"hljs-title function_\">render</span>(<span class=\"hljs-params\"></span>) &#123;<br>  \t<span class=\"hljs-keyword\">return</span> <span class=\"language-xml\"><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">span</span> <span class=\"hljs-attr\">onClick</span>=<span class=\"hljs-string\">&#123;()</span> =&gt;</span> alert(&#x27;I have been clicked&#x27;)&#125;&gt;Click me<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">span</span>&gt;</span></span>;<br>  &#125;<br>&#125;<br><br><span class=\"hljs-keyword\">class</span> <span class=\"hljs-title class_\">ShadowElement</span> <span class=\"hljs-keyword\">extends</span> <span class=\"hljs-title class_ inherited__\">HTMLElement</span> &#123;<br>  <span class=\"hljs-title function_\">constructor</span>(<span class=\"hljs-params\"></span>) &#123;<br>    <span class=\"hljs-variable language_\">super</span>()<br>  &#125;<br><br>  <span class=\"hljs-title function_\">connectedCallback</span>(<span class=\"hljs-params\"></span>) &#123;<br>    <span class=\"hljs-keyword\">const</span> mountPoint = <span class=\"hljs-variable language_\">document</span>.<span class=\"hljs-title function_\">createElement</span>(<span class=\"hljs-string\">&#x27;div&#x27;</span>);<br>    <span class=\"hljs-keyword\">const</span> shadowRoot = <span class=\"hljs-variable language_\">this</span>.<span class=\"hljs-title function_\">attachShadow</span>(&#123; <span class=\"hljs-attr\">mode</span>: <span class=\"hljs-string\">&#x27;open&#x27;</span> &#125;);<br><br>    shadowRoot.<span class=\"hljs-title function_\">appendChild</span>(mountPoint);<br><br>    <span class=\"hljs-title class_\">ReactDOM</span>.<span class=\"hljs-title function_\">render</span>(<span class=\"language-xml\"><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">MyApp</span> /&gt;</span></span>, mountPoint);<br>  &#125;<br>&#125;<br><br><br>customElements.<span class=\"hljs-title function_\">define</span>(<span class=\"hljs-string\">&#x27;my-custom-element&#x27;</span>, <span class=\"hljs-title class_\">ShadowElement</span>);<br><br><br><span class=\"hljs-comment\">// 使用</span><br><br><span class=\"language-xml\"><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">div</span> <span class=\"hljs-attr\">className</span>=<span class=\"hljs-string\">&quot;app-main&quot;</span> <span class=\"hljs-attr\">onClick</span>=<span class=\"hljs-string\">&#123;()</span>=&gt;</span> console.log(&#x27;app main clicked&#x27;)&#125;&gt;</span><br><span class=\"language-xml\">  <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">my-custom-element</span>&gt;</span><span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">my-custom-element</span>&gt;</span></span><br><span class=\"language-xml\"><span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">div</span>&gt;</span></span><br></code></pre></td></tr></table></figure>\n\n<p>效果图</p>\n<p><img src=\"/img/react-v16.gif\" alt=\"\"></p>\n<blockquote>\n<p>“react”: “^17.0.2” 及以上版本，已解决此问题。</p>\n</blockquote>\n<p>代码一致，效果图。</p>\n<p><img src=\"/img/react-v17.gif\" alt=\"\"></p>\n<h2 id=\"解决方案\"><a href=\"#解决方案\" class=\"headerlink\" title=\"解决方案\"></a>解决方案</h2><blockquote>\n<p>Web Components 触发的事件可能无法通过 React 渲染树正确的传递。 你需要在 React 组件中手动添加事件处理器来处理这些事件。</p>\n</blockquote>\n<p>Shadow DOM 重定向了 click 事件并将其封装在 shadow 中，将组件内部的所有内容封装在单独的作用域中，并隔离事件。React 并不支持这样的 Shadow DOM，因此事件委托失败，事件无法触发。</p>\n<p>这意味着，如果您将带有 click 事件的 React 组件放在 Web 组件中，则点击事件可能不会冒泡到 React 组件中。这是因为事件在 Web 组件的 Shadow DOM 中触发，然后被封装在 Shadow DOM 中，而不会传播到外部组件。</p>\n<p>如果您希望在使用 Web 组件时能够触发 React 事件，则可以使用上述方法之一，例如重新绑定事件到实际的 shadow 容器并使用 “__reactInternalInstances” 来调度正确的 React 事件。您还可以使用其他方法来解决此问题，例如使用自定义事件或使用事件代理。</p>\n<blockquote>\n<p><a href=\"https://stackoverflow.com/questions/37866237/click-event-not-firing-when-react-component-in-a-shadow-dom\">https://stackoverflow.com/questions/37866237/click-event-not-firing-when-react-component-in-a-shadow-dom</a></p>\n</blockquote>\n<p><strong>相关文章：当 Shadow Dom 遇上 React event</strong></p>\n<blockquote>\n<p><a href=\"https://github.com/huruji/blog/issues/104\">https://github.com/huruji/blog/issues/104</a></p>\n</blockquote>\n<h1 id=\"参考链接\"><a href=\"#参考链接\" class=\"headerlink\" title=\"参考链接\"></a>参考链接</h1><ul>\n<li><a href=\"https://developer.mozilla.org/zh-CN/docs/Web/Web_Components/Using_templates_and_slots\">MDN官方文档</a></li>\n<li><a href=\"https://github1s.com/mdn/web-components-examples/blob/main/shadow-part/main.js\">WC官方示例</a></li>\n<li><a href=\"http://www.xieluping.cn/post/wc/\">基于 Web Components 跨框架组件开发</a></li>\n<li><a href=\"https://blog.csdn.net/qq_37718797/article/details/122970991\">Shadow :host 选择器</a></li>\n</ul>\n","site":{"data":{}},"wordcount":3764,"excerpt":"","more":"<h1 id=\"Web-Components\"><a href=\"#Web-Components\" class=\"headerlink\" title=\"Web Components\"></a>Web Components</h1><p>作为开发者，我们都知道尽可能多的重用代码是一个好主意。这对于自定义标记结构来说通常不是那么容易 — 想想复杂的 HTML（以及相关的样式和脚本），有时您不得不写代码来呈现自定义 UI 控件，并且如果您不小心的话，多次使用它们会使您的页面变得一团糟。</p>\n<h2 id=\"组成\"><a href=\"#组成\" class=\"headerlink\" title=\"组成\"></a>组成</h2><ul>\n<li><p>Custom elements（自定义元素）</p>\n</li>\n<li><p>Shadow DOM（影子 DOM）</p>\n</li>\n<li><p>HTML templates（HTML 模板）</p>\n</li>\n</ul>\n<h2 id=\"Custom-elements（自定义元素）\"><a href=\"#Custom-elements（自定义元素）\" class=\"headerlink\" title=\"Custom elements（自定义元素）\"></a>Custom elements（自定义元素）</h2><h2 id=\"Shadow-DOM（影子-DOM）\"><a href=\"#Shadow-DOM（影子-DOM）\" class=\"headerlink\" title=\"Shadow DOM（影子 DOM）\"></a>Shadow DOM（影子 DOM）</h2><h2 id=\"templates-and-slots\"><a href=\"#templates-and-slots\" class=\"headerlink\" title=\"templates and slots\"></a>templates and slots</h2><p>复用结构，减少使用相同的标记结构。</p>\n<h2 id=\"组件通信\"><a href=\"#组件通信\" class=\"headerlink\" title=\"组件通信\"></a>组件通信</h2><blockquote>\n<p>Lightning Web Component</p>\n</blockquote>\n<p>在 LWC 中，可以通过实现 CustomEvent 接口进行自定义事件，通过 EventTarget.dispatchEvent() 来分配事件。</p>\n<p><strong>注意：</strong></p>\n<p>定义事件时，不需要在事件名前加 on，因为在使用的时候会默认在名称前使用 on，比如：当我们定义了 click 事件，在 HTML 代码中用 onclick 来调用它</p>\n<ul>\n<li><p>父组件</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\"><span class=\"hljs-comment\">// parent comp</span><br><span class=\"hljs-title function_\">connectedCallback</span>(<span class=\"hljs-params\"></span>) &#123;<br>  <span class=\"hljs-keyword\">const</span> child = <span class=\"hljs-variable language_\">this</span>.<span class=\"hljs-property\">shadowRoot</span>.<span class=\"hljs-title function_\">querySelector</span>(<span class=\"hljs-string\">&#x27;child-wc&#x27;</span>)<br><br>  <span class=\"hljs-comment\">// 1. 通过 DOM 属性传参，会触发子组件的 attributeChangedCallback 钩子</span><br>  child.<span class=\"hljs-title function_\">setAttribute</span>(<span class=\"hljs-string\">&#x27;text&#x27;</span>, <span class=\"hljs-string\">&#x27;Parent changed the Text&#x27;</span>)<br><br>  <span class=\"hljs-comment\">// 2. 通过组件实例直接修改内部数据（⚠️未获取到）</span><br>  <span class=\"hljs-comment\">// console.log(&#x27;??&#x27;, child)</span><br><br>  <span class=\"hljs-comment\">// 3. 监听子组件内部定义的事件</span><br>  child.<span class=\"hljs-title function_\">addEventListener</span>(<span class=\"hljs-string\">&#x27;custom-event&#x27;</span>, <span class=\"hljs-function\">(<span class=\"hljs-params\">&#123; detail &#125;</span>) =&gt;</span> &#123;<br>    <span class=\"hljs-variable language_\">console</span>.<span class=\"hljs-title function_\">log</span>(<span class=\"hljs-string\">&#x27;事件触发 &#x27;</span>, detail.<span class=\"hljs-property\">value</span>);<br>  &#125;)<br>  &#125;<br></code></pre></td></tr></table></figure>\n</li>\n<li><p>子组件</p>\n</li>\n</ul>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\"><span class=\"hljs-comment\">// child comp</span><br><span class=\"hljs-title function_\">connectedCallback</span>(<span class=\"hljs-params\"></span>) &#123;<br>  <span class=\"hljs-comment\">// 定义事件</span><br>  <span class=\"hljs-keyword\">const</span> event = <span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">CustomEvent</span>(<span class=\"hljs-string\">&#x27;custom-event&#x27;</span>, &#123;<br>    <span class=\"hljs-attr\">detail</span>: &#123;<br>      <span class=\"hljs-attr\">value</span>: <span class=\"hljs-string\">&#x27;child web component&#x27;</span><br>    &#125;<br>  &#125;)<br>  <span class=\"hljs-variable language_\">this</span>.<span class=\"hljs-title function_\">dispatchEvent</span>(event)<br><br>  <span class=\"hljs-keyword\">const</span> btn = <span class=\"hljs-variable language_\">this</span>.<span class=\"hljs-property\">shadowRoot</span>.<span class=\"hljs-title function_\">querySelector</span>(<span class=\"hljs-string\">&#x27;button&#x27;</span>)<br>  btn.<span class=\"hljs-title function_\">addEventListener</span>(<span class=\"hljs-string\">&#x27;click&#x27;</span>, <span class=\"hljs-function\">() =&gt;</span> &#123;<br>    <span class=\"hljs-comment\">// 获取父组件</span><br>    <span class=\"hljs-variable language_\">this</span>.<span class=\"hljs-title function_\">getRootNode</span>().<span class=\"hljs-property\">host</span>.<span class=\"hljs-title function_\">sayHello</span>(<span class=\"hljs-string\">&#x27;Hello :&#x27;</span>)<br>  &#125;)<br>&#125;<br></code></pre></td></tr></table></figure>\n\n<h2 id=\"子组件直接调用父组件实例上的方法\"><a href=\"#子组件直接调用父组件实例上的方法\" class=\"headerlink\" title=\"子组件直接调用父组件实例上的方法\"></a>子组件直接调用父组件实例上的方法</h2><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\"><span class=\"hljs-comment\">// parent comp</span><br><span class=\"hljs-title function_\">sayHello</span>(<span class=\"hljs-params\">msg</span>) &#123;<br>  <span class=\"hljs-variable language_\">console</span>.<span class=\"hljs-title function_\">log</span>(msg, <span class=\"hljs-variable language_\">this</span>.<span class=\"hljs-property\">data</span>)<br>&#125;<br><br><br><span class=\"hljs-comment\">// child comp</span><br><span class=\"hljs-title function_\">connectedCallback</span>(<span class=\"hljs-params\"></span>) &#123;<br>  <span class=\"hljs-keyword\">const</span> btn = <span class=\"hljs-variable language_\">this</span>.<span class=\"hljs-property\">shadowRoot</span>.<span class=\"hljs-title function_\">querySelector</span>(<span class=\"hljs-string\">&#x27;button&#x27;</span>)<br><br>  btn.<span class=\"hljs-title function_\">addEventListener</span>(<span class=\"hljs-string\">&#x27;click&#x27;</span>, <span class=\"hljs-function\">() =&gt;</span> &#123;<br>    <span class=\"hljs-comment\">// 获取父组件实例</span><br>    <span class=\"hljs-variable language_\">this</span>.<span class=\"hljs-title function_\">getRootNode</span>().<span class=\"hljs-property\">host</span>.<span class=\"hljs-title function_\">sayHello</span>(<span class=\"hljs-string\">&#x27;Hello :&#x27;</span>)<br>  &#125;)<br>&#125;<br></code></pre></td></tr></table></figure>\n\n<h2 id=\"监听组件上属性的变化\"><a href=\"#监听组件上属性的变化\" class=\"headerlink\" title=\"监听组件上属性的变化\"></a>监听组件上属性的变化</h2><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\"><span class=\"hljs-comment\">// parent</span><br><span class=\"hljs-keyword\">const</span> child = <span class=\"hljs-variable language_\">this</span>.<span class=\"hljs-property\">shadowRoot</span>.<span class=\"hljs-title function_\">querySelector</span>(<span class=\"hljs-string\">&#x27;child-wc&#x27;</span>)<br><span class=\"hljs-comment\">// 1. 通过 DOM 属性传参，会触发子组件的 attributeChangedCallback 钩子</span><br>child.<span class=\"hljs-title function_\">setAttribute</span>(<span class=\"hljs-string\">&#x27;text&#x27;</span>, <span class=\"hljs-string\">&#x27;Parent changed the Text&#x27;</span>)<br><br><br><br><span class=\"hljs-comment\">// child</span><br><span class=\"hljs-comment\">// 监听属性变化，必须定静态的 observedAttributes 方法</span><br><span class=\"hljs-keyword\">static</span> <span class=\"hljs-keyword\">get</span> <span class=\"hljs-title function_\">observedAttributes</span>() &#123;<br>  <span class=\"hljs-keyword\">return</span> [<span class=\"hljs-string\">&#x27;text&#x27;</span>];<br>&#125;<br><span class=\"hljs-title function_\">attributeChangedCallback</span>(<span class=\"hljs-params\">name, oldValue, newValue</span>) &#123;<br>  <span class=\"hljs-variable language_\">console</span>.<span class=\"hljs-title function_\">log</span>(<span class=\"hljs-string\">&#x27;name&#x27;</span>, name)<br>  <span class=\"hljs-variable language_\">console</span>.<span class=\"hljs-title function_\">log</span>(<span class=\"hljs-string\">&#x27;oldValue&#x27;</span>, oldValue)<br>  <span class=\"hljs-variable language_\">console</span>.<span class=\"hljs-title function_\">log</span>(<span class=\"hljs-string\">&#x27;newValue&#x27;</span>, newValue)<br>&#125;<br></code></pre></td></tr></table></figure>\n\n<h1 id=\"web-component-in-ReactJS\"><a href=\"#web-component-in-ReactJS\" class=\"headerlink\" title=\"web component in ReactJS\"></a>web component in ReactJS</h1><p>React 和 Web Components 为了解决不同的问题而生。</p>\n<p>Web Components 为可复用组件提供了强大的封装，而 React 则提供了声明式的解决方案，使 DOM 与数据保持同步。</p>\n<p>两者旨在互补。作为开发人员，可以自由选择在 Web Components 中使用 React，或者在 React 中使用 Web Components，或者两者共存。</p>\n<h2 id=\"问题\"><a href=\"#问题\" class=\"headerlink\" title=\"问题\"></a>问题</h2><blockquote>\n<p>“react”: “^16.12.0”</p>\n</blockquote>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\"><span class=\"hljs-keyword\">class</span> <span class=\"hljs-title class_\">MyApp</span> <span class=\"hljs-keyword\">extends</span> <span class=\"hljs-title class_ inherited__\">React.Component</span> &#123;<br>  <span class=\"hljs-title function_\">render</span>(<span class=\"hljs-params\"></span>) &#123;<br>  \t<span class=\"hljs-keyword\">return</span> <span class=\"language-xml\"><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">span</span> <span class=\"hljs-attr\">onClick</span>=<span class=\"hljs-string\">&#123;()</span> =&gt;</span> alert(&#x27;I have been clicked&#x27;)&#125;&gt;Click me<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">span</span>&gt;</span></span>;<br>  &#125;<br>&#125;<br><br><span class=\"hljs-keyword\">class</span> <span class=\"hljs-title class_\">ShadowElement</span> <span class=\"hljs-keyword\">extends</span> <span class=\"hljs-title class_ inherited__\">HTMLElement</span> &#123;<br>  <span class=\"hljs-title function_\">constructor</span>(<span class=\"hljs-params\"></span>) &#123;<br>    <span class=\"hljs-variable language_\">super</span>()<br>  &#125;<br><br>  <span class=\"hljs-title function_\">connectedCallback</span>(<span class=\"hljs-params\"></span>) &#123;<br>    <span class=\"hljs-keyword\">const</span> mountPoint = <span class=\"hljs-variable language_\">document</span>.<span class=\"hljs-title function_\">createElement</span>(<span class=\"hljs-string\">&#x27;div&#x27;</span>);<br>    <span class=\"hljs-keyword\">const</span> shadowRoot = <span class=\"hljs-variable language_\">this</span>.<span class=\"hljs-title function_\">attachShadow</span>(&#123; <span class=\"hljs-attr\">mode</span>: <span class=\"hljs-string\">&#x27;open&#x27;</span> &#125;);<br><br>    shadowRoot.<span class=\"hljs-title function_\">appendChild</span>(mountPoint);<br><br>    <span class=\"hljs-title class_\">ReactDOM</span>.<span class=\"hljs-title function_\">render</span>(<span class=\"language-xml\"><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">MyApp</span> /&gt;</span></span>, mountPoint);<br>  &#125;<br>&#125;<br><br><br>customElements.<span class=\"hljs-title function_\">define</span>(<span class=\"hljs-string\">&#x27;my-custom-element&#x27;</span>, <span class=\"hljs-title class_\">ShadowElement</span>);<br><br><br><span class=\"hljs-comment\">// 使用</span><br><br><span class=\"language-xml\"><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">div</span> <span class=\"hljs-attr\">className</span>=<span class=\"hljs-string\">&quot;app-main&quot;</span> <span class=\"hljs-attr\">onClick</span>=<span class=\"hljs-string\">&#123;()</span>=&gt;</span> console.log(&#x27;app main clicked&#x27;)&#125;&gt;</span><br><span class=\"language-xml\">  <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">my-custom-element</span>&gt;</span><span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">my-custom-element</span>&gt;</span></span><br><span class=\"language-xml\"><span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">div</span>&gt;</span></span><br></code></pre></td></tr></table></figure>\n\n<p>效果图</p>\n<p><img src=\"/img/react-v16.gif\" alt=\"\"></p>\n<blockquote>\n<p>“react”: “^17.0.2” 及以上版本，已解决此问题。</p>\n</blockquote>\n<p>代码一致，效果图。</p>\n<p><img src=\"/img/react-v17.gif\" alt=\"\"></p>\n<h2 id=\"解决方案\"><a href=\"#解决方案\" class=\"headerlink\" title=\"解决方案\"></a>解决方案</h2><blockquote>\n<p>Web Components 触发的事件可能无法通过 React 渲染树正确的传递。 你需要在 React 组件中手动添加事件处理器来处理这些事件。</p>\n</blockquote>\n<p>Shadow DOM 重定向了 click 事件并将其封装在 shadow 中，将组件内部的所有内容封装在单独的作用域中，并隔离事件。React 并不支持这样的 Shadow DOM，因此事件委托失败，事件无法触发。</p>\n<p>这意味着，如果您将带有 click 事件的 React 组件放在 Web 组件中，则点击事件可能不会冒泡到 React 组件中。这是因为事件在 Web 组件的 Shadow DOM 中触发，然后被封装在 Shadow DOM 中，而不会传播到外部组件。</p>\n<p>如果您希望在使用 Web 组件时能够触发 React 事件，则可以使用上述方法之一，例如重新绑定事件到实际的 shadow 容器并使用 “__reactInternalInstances” 来调度正确的 React 事件。您还可以使用其他方法来解决此问题，例如使用自定义事件或使用事件代理。</p>\n<blockquote>\n<p><a href=\"https://stackoverflow.com/questions/37866237/click-event-not-firing-when-react-component-in-a-shadow-dom\">https://stackoverflow.com/questions/37866237/click-event-not-firing-when-react-component-in-a-shadow-dom</a></p>\n</blockquote>\n<p><strong>相关文章：当 Shadow Dom 遇上 React event</strong></p>\n<blockquote>\n<p><a href=\"https://github.com/huruji/blog/issues/104\">https://github.com/huruji/blog/issues/104</a></p>\n</blockquote>\n<h1 id=\"参考链接\"><a href=\"#参考链接\" class=\"headerlink\" title=\"参考链接\"></a>参考链接</h1><ul>\n<li><a href=\"https://developer.mozilla.org/zh-CN/docs/Web/Web_Components/Using_templates_and_slots\">MDN官方文档</a></li>\n<li><a href=\"https://github1s.com/mdn/web-components-examples/blob/main/shadow-part/main.js\">WC官方示例</a></li>\n<li><a href=\"http://www.xieluping.cn/post/wc/\">基于 Web Components 跨框架组件开发</a></li>\n<li><a href=\"https://blog.csdn.net/qq_37718797/article/details/122970991\">Shadow :host 选择器</a></li>\n</ul>\n"},{"_content":"<!DOCTYPE html>\n<html lang=\"en\">\n<head>\n  <meta charset=\"UTF-8\">\n  <meta http-equiv=\"X-UA-Compatible\" content=\"IE=edge\">\n  <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n  <title>Document</title>\n  <style>\n    body {\n      height: 2000px;\n    }\n  </style>\n</head>\n<body>\n  <h1>防抖：用户触发事件频繁，只需要用户最后一次操作的结果</h1>\n  <input type=\"text\" id=\"input\">\n\n\n  <script>\n    const input = document.querySelector('#input')\n\n    input.oninput = debounce(function() {\n      console.log('value: ', this.value)\n    }, 800)\n\n    function debounce(fn, delay = 500) {\n      // 闭包\n      let timer = null\n      // this ===> window\n\n      return function() {\n        // this ===> input\n        if (timer !== null) {\n          clearTimeout(timer)\n        }\n\n        timer = setTimeout(() => {\n          fn.call(this)\n        }, delay);\n      }\n    }\n\n    let time = 0\n    window.onscroll = throttle(function() {\n      console.log('hello world')\n    }, 1000)\n\n    function throttle(fn, delay) {\n      let time = 0\n\n      return function() {\n        let now = Date.now()\n        if (now - time > delay) {\n          fn.call(this)\n          time = now\n        }\n      }\n    }\n  </script>\n</body>\n</html>","source":"demo/2023面试准备/demo/debounce.html","raw":"<!DOCTYPE html>\n<html lang=\"en\">\n<head>\n  <meta charset=\"UTF-8\">\n  <meta http-equiv=\"X-UA-Compatible\" content=\"IE=edge\">\n  <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n  <title>Document</title>\n  <style>\n    body {\n      height: 2000px;\n    }\n  </style>\n</head>\n<body>\n  <h1>防抖：用户触发事件频繁，只需要用户最后一次操作的结果</h1>\n  <input type=\"text\" id=\"input\">\n\n\n  <script>\n    const input = document.querySelector('#input')\n\n    input.oninput = debounce(function() {\n      console.log('value: ', this.value)\n    }, 800)\n\n    function debounce(fn, delay = 500) {\n      // 闭包\n      let timer = null\n      // this ===> window\n\n      return function() {\n        // this ===> input\n        if (timer !== null) {\n          clearTimeout(timer)\n        }\n\n        timer = setTimeout(() => {\n          fn.call(this)\n        }, delay);\n      }\n    }\n\n    let time = 0\n    window.onscroll = throttle(function() {\n      console.log('hello world')\n    }, 1000)\n\n    function throttle(fn, delay) {\n      let time = 0\n\n      return function() {\n        let now = Date.now()\n        if (now - time > delay) {\n          fn.call(this)\n          time = now\n        }\n      }\n    }\n  </script>\n</body>\n</html>","date":"2023-05-12T10:49:20.020Z","updated":"2023-05-12T10:49:20.020Z","path":"demo/2023面试准备/demo/debounce.html","title":"","comments":1,"layout":"page","_id":"clhkizgxv001n3y0qdzgu5f3t","content":"<!DOCTYPE html>\n<html lang=\"en\">\n<head>\n  <meta charset=\"UTF-8\">\n  <meta http-equiv=\"X-UA-Compatible\" content=\"IE=edge\">\n  <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n  <title>Document</title>\n  <style>\n    body {\n      height: 2000px;\n    }\n  </style>\n</head>\n<body>\n  <h1>防抖：用户触发事件频繁，只需要用户最后一次操作的结果</h1>\n  <input type=\"text\" id=\"input\">\n\n\n  <script>\n    const input = document.querySelector('#input')\n\n    input.oninput = debounce(function() {\n      console.log('value: ', this.value)\n    }, 800)\n\n    function debounce(fn, delay = 500) {\n      // 闭包\n      let timer = null\n      // this ===> window\n\n      return function() {\n        // this ===> input\n        if (timer !== null) {\n          clearTimeout(timer)\n        }\n\n        timer = setTimeout(() => {\n          fn.call(this)\n        }, delay);\n      }\n    }\n\n    let time = 0\n    window.onscroll = throttle(function() {\n      console.log('hello world')\n    }, 1000)\n\n    function throttle(fn, delay) {\n      let time = 0\n\n      return function() {\n        let now = Date.now()\n        if (now - time > delay) {\n          fn.call(this)\n          time = now\n        }\n      }\n    }\n  </script>\n</body>\n</html>","site":{"data":{}},"wordcount":538,"excerpt":"","more":"<!DOCTYPE html>\n<html lang=\"en\">\n<head>\n  <meta charset=\"UTF-8\">\n  <meta http-equiv=\"X-UA-Compatible\" content=\"IE=edge\">\n  <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n  <title>Document</title>\n  <style>\n    body {\n      height: 2000px;\n    }\n  </style>\n</head>\n<body>\n  <h1>防抖：用户触发事件频繁，只需要用户最后一次操作的结果</h1>\n  <input type=\"text\" id=\"input\">\n\n\n  <script>\n    const input = document.querySelector('#input')\n\n    input.oninput = debounce(function() {\n      console.log('value: ', this.value)\n    }, 800)\n\n    function debounce(fn, delay = 500) {\n      // 闭包\n      let timer = null\n      // this ===> window\n\n      return function() {\n        // this ===> input\n        if (timer !== null) {\n          clearTimeout(timer)\n        }\n\n        timer = setTimeout(() => {\n          fn.call(this)\n        }, delay);\n      }\n    }\n\n    let time = 0\n    window.onscroll = throttle(function() {\n      console.log('hello world')\n    }, 1000)\n\n    function throttle(fn, delay) {\n      let time = 0\n\n      return function() {\n        let now = Date.now()\n        if (now - time > delay) {\n          fn.call(this)\n          time = now\n        }\n      }\n    }\n  </script>\n</body>\n</html>"},{"_content":"// const cat = {\n//   name: '喵喵喵',\n//   sayName(params) {\n//     console.log('params ', params)\n//     setTimeout(() => {\n//       console.log(this) // cat\n//       console.log(this.name) // 喵喵喵\n//     })\n//   }\n// }\n\n// const dog = {\n//   name: '汪汪汪'\n// }\n\n// cat.sayName.call(dog, 1,2,3)\n\n\n\n\n\n\n\n// setImmediate(() => {\n//   console.log('setImmediate')\n// })\n\n// process.nextTick(() => {\n//   console.log(1)\n// })\n\n// console.log(2)\n\n// setTimeout(() => {\n//   console.log(3)\n// }, 0);\n\n\n\n\n\n\n\n\n// setImmediate(() => {\n//   console.log('setImmediate')\n// })\n\n// process.nextTick(() => {\n//   console.log(1)\n// })\n\n// console.log(2)\n\n// new Promise(r => {\n//   console.log(7)\n//   r()\n// }).then(() => {\n//   console.log(8)\n// })\n\n// setTimeout(() => {\n//   console.log(3)\n// }, 0);\n// setTimeout(() => {\n//   console.log(4)\n// }, 1000);\n// setTimeout(() => {\n//   console.log(5)\n// }, 0);\n\n// console.log(6)\n\n// // 2 7 6 1 8 3 5 setImmediate 4\n\n\n\n\n\n\n\n\n\nconst obj = {\n  name: 'is obj',\n  girlfriend: {\n    name: '小红'\n  },\n  list: [1,2,3],\n  u: undefined,\n  n: null,\n  f: function() {\n    console.log('func')\n  },\n  arrow: () => {},\n  error: new Error('错误啦')\n}\n\n// // 属于浅拷贝\n// const o = Object.assign({}, obj)\n\n// obj.name = 'is o'\n// obj.girlfriend.name = '小花'\n\n// console.log(o)\n\n\n// // 深拷贝\n// function deepClone(obj) {\n//   const o = {}\n\n//   for (const key in obj) {\n//     if (Object.hasOwnProperty.call(obj, key)) {\n      \n//       if(typeof obj[key] === 'object') {\n//         o[key] = deepClone(obj[key])\n//       } else {\n//         o[key] = obj[key];\n//       }\n//     }\n//   }\n\n//   return o\n// }\n\n\n// const o = deepClone(obj)\n\n// obj.girlfriend.name = '小花'\n// obj.list[1] = 99\n\n// console.log('??', o)\n// console.log('??', obj)\n\n\n\n\n\n// // JSON.stringify实现深克隆\n// // JSON.stringify存在的问题\n// // 如果属性值是 undefined 或者是方法（含箭头函数），克隆出来后，undefined 和函数会丢失\n\n// const o = JSON.stringify(obj)\n\n// console.log(o)\n\n\n\n// class User {\n//   constructor(name) {\n//     this.name = name\n//   }\n// }\n\n// class Admin extends User {\n//   constructor() {\n//     // 子类继承父类，写了 constructor 函数，必须手动调用 super()\n//     // super 指的是父类(User)\n//     super()\n\n//     this.age = 28\n//   }\n// }\n\n// const a = new Admin()\n\n// console.log(a)\n\n\n\n\n\n\n// // async 将函数包装成 Promise\n// // 相当于 function say() { return new Promise() }\n\n// async function say() {\n//   return 'say hello'\n// }\n\n// const s = say()\n\n// s.then(value => {\n//   console.log('value ', value)\n// })\n\n\n\n\n\n\n\n\n\n\n// // 可缓存的纯函数\n\n// function add(a, b) {\n//   console.log('计算中...')\n\n//   return a + b\n// }\n\n// const resolver = (...args) => JSON.stringify(args)\n\n// function memoize(func, resolver) {\n//   const cache = {}\n\n//   return function(...args) {\n//     const key = resolver(...args) // \"[a, b]\"\n\n//     if (cache[key]) {\n//       return cache[key]\n//     } else {\n//       return cache[key] = func(...args)\n//     }\n//   }\n// }\n\n// const memoized = memoize(add, resolver)\n\n// console.log(memoized(9, 9))\n// console.log(memoized(9, 9))\n// console.log(memoized(9, 9))\n\n\n\n\n\n\n\n\n// // 函数柯里化\n// function curry(func) {\n//   const curried = function(...args) {\n//     // 函数的length 表示它有几个参数\n//     if (args.length < func.length) {\n//       // 累加参数\n//       return (...rest) => curried(...args, ...rest)\n//     } else {\n//       // 传入的参数和方法接收的参数相同，直接执行 func 函数\n//       return func(...args)\n//     }\n//   }\n\n//   return curried\n// }\n\n// function add(a, b, c) {\n//   return a + b + c\n// }\n\n// const curried = curry(add)\n// const fn = curried(1)\n\n// console.log(fn(2)(3))\n\n\n\n\n\n\n\n\n\n\n\n// const str = 'hello - '\n\n// function add1(str) {\n//   return str + 'wor'\n// }\n\n// function add2(str) {\n//   return str + 'l'\n// }\n\n// function add3(str) {\n//   return str + 'd'\n// }\n\n// // console.log(add3(add2(add1(str))))\n\n// function flow(...fns) {\n//   if (fns.length === 1) {\n//     return fns[0]\n//   }\n\n//   return fns.reduceRight((a, b) => {\n//     // 从右往左\n//     // 第一步 a === add3, b === add2\n//     // 第二步 a === (...args) => add3(add2(...args)), b === add1\n//     // 第二步的 a 显示为 (...args) => a(b(...args))\n//     // 返回 a(add1(...args))\n\n//     // 当我们最后调用 f 时，会先计算 add1(...args)，拿到结果后，执行 a \"add3(add2(add1(...args)))\"\n//     return (...args) => a(b(...args))\n//   })\n// }\n\n// const f = flow(add1, add2, add3)\n\n\n\n\n\n// function Person(name) {\n//   this.name = name\n//   this.colors = ['red', 'blue']\n// }\n\n// Person.prototype.sayName = function() {\n//   console.log(this.name)\n// }\n\n// function User() {\n//   Person.call(this, 'xiaoming')\n\n//   this.age = 19\n// }\n\n// User.prototype = new Person()\n// User.prototype.constructor = User\n\n// const u = new User()\n\n// console.log(u instanceof User)\n// console.log(u instanceof Person)\n// console.log(User.prototype.isPrototypeOf(u))\n// console.log(Person.prototype.isPrototypeOf(u))\n\n\n\n\n\n\n\n\n\n\n\n// let person = {\n//   name: \"Nicholas\",\n//   friends: [\"Shelby\", \"Court\", \"Van\"]\n// };\n// let anotherPerson = object(person);\n// anotherPerson.name = \"Greg\";\n// anotherPerson.friends.push(\"Rob\");\n// let yetAnotherPerson = object(person);\n// yetAnotherPerson.name = \"Linda\";\n// yetAnotherPerson.friends.push(\"Barbie\");\n// console.log(person.friends);   // \"Shelby, Court, Van, Rob, Barbie\"\n\n\n\n\n\n\n\n\n\n\n\n// const proxy = new Proxy({\n//   name: 'hello'\n// }, {\n//   get(target, property) {\n//     console.log(target, property)\n//     return 11\n//   }\n// })\n\n// console.log(proxy.name)\n\n\n\n\n\n\n\n// function timeout(ms) {\n//   return new Promise(resolve => {\n//     setTimeout(resolve, ms, 'done') // 第三个参数，是传递给 resolve 方法的\n//   })\n// }\n// console.log(1)\n// timeout(1000).then(res => {\n//   console.log(res)\n// })\n\n// console.log(2)\n\n\n\n\n\n// const p1 = new Promise((r, reject) => {\n//   setTimeout(() => {\n//     reject(new Error('fail'))\n//   }, 3000);\n// })\n\n// const p2 = new Promise((r, reject) => {\n//   r(p1)\n// })\n\n// p2.then(result => {\n//   console.log('result ', result)\n// }, error => {\n//   console.log('error ', error)\n// })\n\n\n\n\n\n\n\n// new Promise(r => {\n//   r(x + 2)\n// }).then(res => {\n//   console.log('结果 ', res)\n// }).catch(err => {\n//   console.log('错误 ', err)\n// }).then(() => {\n//   console.log('随便打印')\n// }).finally(() => {\n//   console.log('最后打印')\n// })\n\n\n\n// const p3 = function() {\n//   return new Promise(r => {\n//     setTimeout(() => {\n//       r('p3 success')\n//     }, 3000);\n//   })\n// }\n\n// const allP = Promise.all([1, 2, p3()])\n\n// allP.then(r => {\n//   console.log(r)\n// })\n\n\n\n// console.log(Promise.resolve('helo') instanceof Promise)\n\nconst sleep = function(ms) {\n  return new Promise(r => {\n    console.log(xxxxx + 3)\n\n    setTimeout(() => {\n      r()\n    }, ms)\n  })\n}\n\nasync function sayName() {\n  console.log(1)\n\n  try {\n    await sleep(3000)\n  } catch (error) {\n    console.log(' - - - ', error)\n  }\n\n\n  console.log(2)\n\n  return 'name'\n}\n\nsayName().then(res => console.log(res))\n\n","source":"demo/2023面试准备/demo/demo.js","raw":"// const cat = {\n//   name: '喵喵喵',\n//   sayName(params) {\n//     console.log('params ', params)\n//     setTimeout(() => {\n//       console.log(this) // cat\n//       console.log(this.name) // 喵喵喵\n//     })\n//   }\n// }\n\n// const dog = {\n//   name: '汪汪汪'\n// }\n\n// cat.sayName.call(dog, 1,2,3)\n\n\n\n\n\n\n\n// setImmediate(() => {\n//   console.log('setImmediate')\n// })\n\n// process.nextTick(() => {\n//   console.log(1)\n// })\n\n// console.log(2)\n\n// setTimeout(() => {\n//   console.log(3)\n// }, 0);\n\n\n\n\n\n\n\n\n// setImmediate(() => {\n//   console.log('setImmediate')\n// })\n\n// process.nextTick(() => {\n//   console.log(1)\n// })\n\n// console.log(2)\n\n// new Promise(r => {\n//   console.log(7)\n//   r()\n// }).then(() => {\n//   console.log(8)\n// })\n\n// setTimeout(() => {\n//   console.log(3)\n// }, 0);\n// setTimeout(() => {\n//   console.log(4)\n// }, 1000);\n// setTimeout(() => {\n//   console.log(5)\n// }, 0);\n\n// console.log(6)\n\n// // 2 7 6 1 8 3 5 setImmediate 4\n\n\n\n\n\n\n\n\n\nconst obj = {\n  name: 'is obj',\n  girlfriend: {\n    name: '小红'\n  },\n  list: [1,2,3],\n  u: undefined,\n  n: null,\n  f: function() {\n    console.log('func')\n  },\n  arrow: () => {},\n  error: new Error('错误啦')\n}\n\n// // 属于浅拷贝\n// const o = Object.assign({}, obj)\n\n// obj.name = 'is o'\n// obj.girlfriend.name = '小花'\n\n// console.log(o)\n\n\n// // 深拷贝\n// function deepClone(obj) {\n//   const o = {}\n\n//   for (const key in obj) {\n//     if (Object.hasOwnProperty.call(obj, key)) {\n      \n//       if(typeof obj[key] === 'object') {\n//         o[key] = deepClone(obj[key])\n//       } else {\n//         o[key] = obj[key];\n//       }\n//     }\n//   }\n\n//   return o\n// }\n\n\n// const o = deepClone(obj)\n\n// obj.girlfriend.name = '小花'\n// obj.list[1] = 99\n\n// console.log('??', o)\n// console.log('??', obj)\n\n\n\n\n\n// // JSON.stringify实现深克隆\n// // JSON.stringify存在的问题\n// // 如果属性值是 undefined 或者是方法（含箭头函数），克隆出来后，undefined 和函数会丢失\n\n// const o = JSON.stringify(obj)\n\n// console.log(o)\n\n\n\n// class User {\n//   constructor(name) {\n//     this.name = name\n//   }\n// }\n\n// class Admin extends User {\n//   constructor() {\n//     // 子类继承父类，写了 constructor 函数，必须手动调用 super()\n//     // super 指的是父类(User)\n//     super()\n\n//     this.age = 28\n//   }\n// }\n\n// const a = new Admin()\n\n// console.log(a)\n\n\n\n\n\n\n// // async 将函数包装成 Promise\n// // 相当于 function say() { return new Promise() }\n\n// async function say() {\n//   return 'say hello'\n// }\n\n// const s = say()\n\n// s.then(value => {\n//   console.log('value ', value)\n// })\n\n\n\n\n\n\n\n\n\n\n// // 可缓存的纯函数\n\n// function add(a, b) {\n//   console.log('计算中...')\n\n//   return a + b\n// }\n\n// const resolver = (...args) => JSON.stringify(args)\n\n// function memoize(func, resolver) {\n//   const cache = {}\n\n//   return function(...args) {\n//     const key = resolver(...args) // \"[a, b]\"\n\n//     if (cache[key]) {\n//       return cache[key]\n//     } else {\n//       return cache[key] = func(...args)\n//     }\n//   }\n// }\n\n// const memoized = memoize(add, resolver)\n\n// console.log(memoized(9, 9))\n// console.log(memoized(9, 9))\n// console.log(memoized(9, 9))\n\n\n\n\n\n\n\n\n// // 函数柯里化\n// function curry(func) {\n//   const curried = function(...args) {\n//     // 函数的length 表示它有几个参数\n//     if (args.length < func.length) {\n//       // 累加参数\n//       return (...rest) => curried(...args, ...rest)\n//     } else {\n//       // 传入的参数和方法接收的参数相同，直接执行 func 函数\n//       return func(...args)\n//     }\n//   }\n\n//   return curried\n// }\n\n// function add(a, b, c) {\n//   return a + b + c\n// }\n\n// const curried = curry(add)\n// const fn = curried(1)\n\n// console.log(fn(2)(3))\n\n\n\n\n\n\n\n\n\n\n\n// const str = 'hello - '\n\n// function add1(str) {\n//   return str + 'wor'\n// }\n\n// function add2(str) {\n//   return str + 'l'\n// }\n\n// function add3(str) {\n//   return str + 'd'\n// }\n\n// // console.log(add3(add2(add1(str))))\n\n// function flow(...fns) {\n//   if (fns.length === 1) {\n//     return fns[0]\n//   }\n\n//   return fns.reduceRight((a, b) => {\n//     // 从右往左\n//     // 第一步 a === add3, b === add2\n//     // 第二步 a === (...args) => add3(add2(...args)), b === add1\n//     // 第二步的 a 显示为 (...args) => a(b(...args))\n//     // 返回 a(add1(...args))\n\n//     // 当我们最后调用 f 时，会先计算 add1(...args)，拿到结果后，执行 a \"add3(add2(add1(...args)))\"\n//     return (...args) => a(b(...args))\n//   })\n// }\n\n// const f = flow(add1, add2, add3)\n\n\n\n\n\n// function Person(name) {\n//   this.name = name\n//   this.colors = ['red', 'blue']\n// }\n\n// Person.prototype.sayName = function() {\n//   console.log(this.name)\n// }\n\n// function User() {\n//   Person.call(this, 'xiaoming')\n\n//   this.age = 19\n// }\n\n// User.prototype = new Person()\n// User.prototype.constructor = User\n\n// const u = new User()\n\n// console.log(u instanceof User)\n// console.log(u instanceof Person)\n// console.log(User.prototype.isPrototypeOf(u))\n// console.log(Person.prototype.isPrototypeOf(u))\n\n\n\n\n\n\n\n\n\n\n\n// let person = {\n//   name: \"Nicholas\",\n//   friends: [\"Shelby\", \"Court\", \"Van\"]\n// };\n// let anotherPerson = object(person);\n// anotherPerson.name = \"Greg\";\n// anotherPerson.friends.push(\"Rob\");\n// let yetAnotherPerson = object(person);\n// yetAnotherPerson.name = \"Linda\";\n// yetAnotherPerson.friends.push(\"Barbie\");\n// console.log(person.friends);   // \"Shelby, Court, Van, Rob, Barbie\"\n\n\n\n\n\n\n\n\n\n\n\n// const proxy = new Proxy({\n//   name: 'hello'\n// }, {\n//   get(target, property) {\n//     console.log(target, property)\n//     return 11\n//   }\n// })\n\n// console.log(proxy.name)\n\n\n\n\n\n\n\n// function timeout(ms) {\n//   return new Promise(resolve => {\n//     setTimeout(resolve, ms, 'done') // 第三个参数，是传递给 resolve 方法的\n//   })\n// }\n// console.log(1)\n// timeout(1000).then(res => {\n//   console.log(res)\n// })\n\n// console.log(2)\n\n\n\n\n\n// const p1 = new Promise((r, reject) => {\n//   setTimeout(() => {\n//     reject(new Error('fail'))\n//   }, 3000);\n// })\n\n// const p2 = new Promise((r, reject) => {\n//   r(p1)\n// })\n\n// p2.then(result => {\n//   console.log('result ', result)\n// }, error => {\n//   console.log('error ', error)\n// })\n\n\n\n\n\n\n\n// new Promise(r => {\n//   r(x + 2)\n// }).then(res => {\n//   console.log('结果 ', res)\n// }).catch(err => {\n//   console.log('错误 ', err)\n// }).then(() => {\n//   console.log('随便打印')\n// }).finally(() => {\n//   console.log('最后打印')\n// })\n\n\n\n// const p3 = function() {\n//   return new Promise(r => {\n//     setTimeout(() => {\n//       r('p3 success')\n//     }, 3000);\n//   })\n// }\n\n// const allP = Promise.all([1, 2, p3()])\n\n// allP.then(r => {\n//   console.log(r)\n// })\n\n\n\n// console.log(Promise.resolve('helo') instanceof Promise)\n\nconst sleep = function(ms) {\n  return new Promise(r => {\n    console.log(xxxxx + 3)\n\n    setTimeout(() => {\n      r()\n    }, ms)\n  })\n}\n\nasync function sayName() {\n  console.log(1)\n\n  try {\n    await sleep(3000)\n  } catch (error) {\n    console.log(' - - - ', error)\n  }\n\n\n  console.log(2)\n\n  return 'name'\n}\n\nsayName().then(res => console.log(res))\n\n","date":"2023-05-12T10:49:20.020Z","updated":"2023-05-12T10:49:20.020Z","path":"demo/2023面试准备/demo/demo.js","layout":"false","title":"","comments":1,"_id":"clhkizgxw001o3y0qa04tg8or","content":"// const cat = {\n//   name: '喵喵喵',\n//   sayName(params) {\n//     console.log('params ', params)\n//     setTimeout(() => {\n//       console.log(this) // cat\n//       console.log(this.name) // 喵喵喵\n//     })\n//   }\n// }\n\n// const dog = {\n//   name: '汪汪汪'\n// }\n\n// cat.sayName.call(dog, 1,2,3)\n\n\n\n\n\n\n\n// setImmediate(() => {\n//   console.log('setImmediate')\n// })\n\n// process.nextTick(() => {\n//   console.log(1)\n// })\n\n// console.log(2)\n\n// setTimeout(() => {\n//   console.log(3)\n// }, 0);\n\n\n\n\n\n\n\n\n// setImmediate(() => {\n//   console.log('setImmediate')\n// })\n\n// process.nextTick(() => {\n//   console.log(1)\n// })\n\n// console.log(2)\n\n// new Promise(r => {\n//   console.log(7)\n//   r()\n// }).then(() => {\n//   console.log(8)\n// })\n\n// setTimeout(() => {\n//   console.log(3)\n// }, 0);\n// setTimeout(() => {\n//   console.log(4)\n// }, 1000);\n// setTimeout(() => {\n//   console.log(5)\n// }, 0);\n\n// console.log(6)\n\n// // 2 7 6 1 8 3 5 setImmediate 4\n\n\n\n\n\n\n\n\n\nconst obj = {\n  name: 'is obj',\n  girlfriend: {\n    name: '小红'\n  },\n  list: [1,2,3],\n  u: undefined,\n  n: null,\n  f: function() {\n    console.log('func')\n  },\n  arrow: () => {},\n  error: new Error('错误啦')\n}\n\n// // 属于浅拷贝\n// const o = Object.assign({}, obj)\n\n// obj.name = 'is o'\n// obj.girlfriend.name = '小花'\n\n// console.log(o)\n\n\n// // 深拷贝\n// function deepClone(obj) {\n//   const o = {}\n\n//   for (const key in obj) {\n//     if (Object.hasOwnProperty.call(obj, key)) {\n      \n//       if(typeof obj[key] === 'object') {\n//         o[key] = deepClone(obj[key])\n//       } else {\n//         o[key] = obj[key];\n//       }\n//     }\n//   }\n\n//   return o\n// }\n\n\n// const o = deepClone(obj)\n\n// obj.girlfriend.name = '小花'\n// obj.list[1] = 99\n\n// console.log('??', o)\n// console.log('??', obj)\n\n\n\n\n\n// // JSON.stringify实现深克隆\n// // JSON.stringify存在的问题\n// // 如果属性值是 undefined 或者是方法（含箭头函数），克隆出来后，undefined 和函数会丢失\n\n// const o = JSON.stringify(obj)\n\n// console.log(o)\n\n\n\n// class User {\n//   constructor(name) {\n//     this.name = name\n//   }\n// }\n\n// class Admin extends User {\n//   constructor() {\n//     // 子类继承父类，写了 constructor 函数，必须手动调用 super()\n//     // super 指的是父类(User)\n//     super()\n\n//     this.age = 28\n//   }\n// }\n\n// const a = new Admin()\n\n// console.log(a)\n\n\n\n\n\n\n// // async 将函数包装成 Promise\n// // 相当于 function say() { return new Promise() }\n\n// async function say() {\n//   return 'say hello'\n// }\n\n// const s = say()\n\n// s.then(value => {\n//   console.log('value ', value)\n// })\n\n\n\n\n\n\n\n\n\n\n// // 可缓存的纯函数\n\n// function add(a, b) {\n//   console.log('计算中...')\n\n//   return a + b\n// }\n\n// const resolver = (...args) => JSON.stringify(args)\n\n// function memoize(func, resolver) {\n//   const cache = {}\n\n//   return function(...args) {\n//     const key = resolver(...args) // \"[a, b]\"\n\n//     if (cache[key]) {\n//       return cache[key]\n//     } else {\n//       return cache[key] = func(...args)\n//     }\n//   }\n// }\n\n// const memoized = memoize(add, resolver)\n\n// console.log(memoized(9, 9))\n// console.log(memoized(9, 9))\n// console.log(memoized(9, 9))\n\n\n\n\n\n\n\n\n// // 函数柯里化\n// function curry(func) {\n//   const curried = function(...args) {\n//     // 函数的length 表示它有几个参数\n//     if (args.length < func.length) {\n//       // 累加参数\n//       return (...rest) => curried(...args, ...rest)\n//     } else {\n//       // 传入的参数和方法接收的参数相同，直接执行 func 函数\n//       return func(...args)\n//     }\n//   }\n\n//   return curried\n// }\n\n// function add(a, b, c) {\n//   return a + b + c\n// }\n\n// const curried = curry(add)\n// const fn = curried(1)\n\n// console.log(fn(2)(3))\n\n\n\n\n\n\n\n\n\n\n\n// const str = 'hello - '\n\n// function add1(str) {\n//   return str + 'wor'\n// }\n\n// function add2(str) {\n//   return str + 'l'\n// }\n\n// function add3(str) {\n//   return str + 'd'\n// }\n\n// // console.log(add3(add2(add1(str))))\n\n// function flow(...fns) {\n//   if (fns.length === 1) {\n//     return fns[0]\n//   }\n\n//   return fns.reduceRight((a, b) => {\n//     // 从右往左\n//     // 第一步 a === add3, b === add2\n//     // 第二步 a === (...args) => add3(add2(...args)), b === add1\n//     // 第二步的 a 显示为 (...args) => a(b(...args))\n//     // 返回 a(add1(...args))\n\n//     // 当我们最后调用 f 时，会先计算 add1(...args)，拿到结果后，执行 a \"add3(add2(add1(...args)))\"\n//     return (...args) => a(b(...args))\n//   })\n// }\n\n// const f = flow(add1, add2, add3)\n\n\n\n\n\n// function Person(name) {\n//   this.name = name\n//   this.colors = ['red', 'blue']\n// }\n\n// Person.prototype.sayName = function() {\n//   console.log(this.name)\n// }\n\n// function User() {\n//   Person.call(this, 'xiaoming')\n\n//   this.age = 19\n// }\n\n// User.prototype = new Person()\n// User.prototype.constructor = User\n\n// const u = new User()\n\n// console.log(u instanceof User)\n// console.log(u instanceof Person)\n// console.log(User.prototype.isPrototypeOf(u))\n// console.log(Person.prototype.isPrototypeOf(u))\n\n\n\n\n\n\n\n\n\n\n\n// let person = {\n//   name: \"Nicholas\",\n//   friends: [\"Shelby\", \"Court\", \"Van\"]\n// };\n// let anotherPerson = object(person);\n// anotherPerson.name = \"Greg\";\n// anotherPerson.friends.push(\"Rob\");\n// let yetAnotherPerson = object(person);\n// yetAnotherPerson.name = \"Linda\";\n// yetAnotherPerson.friends.push(\"Barbie\");\n// console.log(person.friends);   // \"Shelby, Court, Van, Rob, Barbie\"\n\n\n\n\n\n\n\n\n\n\n\n// const proxy = new Proxy({\n//   name: 'hello'\n// }, {\n//   get(target, property) {\n//     console.log(target, property)\n//     return 11\n//   }\n// })\n\n// console.log(proxy.name)\n\n\n\n\n\n\n\n// function timeout(ms) {\n//   return new Promise(resolve => {\n//     setTimeout(resolve, ms, 'done') // 第三个参数，是传递给 resolve 方法的\n//   })\n// }\n// console.log(1)\n// timeout(1000).then(res => {\n//   console.log(res)\n// })\n\n// console.log(2)\n\n\n\n\n\n// const p1 = new Promise((r, reject) => {\n//   setTimeout(() => {\n//     reject(new Error('fail'))\n//   }, 3000);\n// })\n\n// const p2 = new Promise((r, reject) => {\n//   r(p1)\n// })\n\n// p2.then(result => {\n//   console.log('result ', result)\n// }, error => {\n//   console.log('error ', error)\n// })\n\n\n\n\n\n\n\n// new Promise(r => {\n//   r(x + 2)\n// }).then(res => {\n//   console.log('结果 ', res)\n// }).catch(err => {\n//   console.log('错误 ', err)\n// }).then(() => {\n//   console.log('随便打印')\n// }).finally(() => {\n//   console.log('最后打印')\n// })\n\n\n\n// const p3 = function() {\n//   return new Promise(r => {\n//     setTimeout(() => {\n//       r('p3 success')\n//     }, 3000);\n//   })\n// }\n\n// const allP = Promise.all([1, 2, p3()])\n\n// allP.then(r => {\n//   console.log(r)\n// })\n\n\n\n// console.log(Promise.resolve('helo') instanceof Promise)\n\nconst sleep = function(ms) {\n  return new Promise(r => {\n    console.log(xxxxx + 3)\n\n    setTimeout(() => {\n      r()\n    }, ms)\n  })\n}\n\nasync function sayName() {\n  console.log(1)\n\n  try {\n    await sleep(3000)\n  } catch (error) {\n    console.log(' - - - ', error)\n  }\n\n\n  console.log(2)\n\n  return 'name'\n}\n\nsayName().then(res => console.log(res))\n\n","site":{"data":{}},"wordcount":5122,"excerpt":"","more":"// const cat = {\n//   name: '喵喵喵',\n//   sayName(params) {\n//     console.log('params ', params)\n//     setTimeout(() => {\n//       console.log(this) // cat\n//       console.log(this.name) // 喵喵喵\n//     })\n//   }\n// }\n\n// const dog = {\n//   name: '汪汪汪'\n// }\n\n// cat.sayName.call(dog, 1,2,3)\n\n\n\n\n\n\n\n// setImmediate(() => {\n//   console.log('setImmediate')\n// })\n\n// process.nextTick(() => {\n//   console.log(1)\n// })\n\n// console.log(2)\n\n// setTimeout(() => {\n//   console.log(3)\n// }, 0);\n\n\n\n\n\n\n\n\n// setImmediate(() => {\n//   console.log('setImmediate')\n// })\n\n// process.nextTick(() => {\n//   console.log(1)\n// })\n\n// console.log(2)\n\n// new Promise(r => {\n//   console.log(7)\n//   r()\n// }).then(() => {\n//   console.log(8)\n// })\n\n// setTimeout(() => {\n//   console.log(3)\n// }, 0);\n// setTimeout(() => {\n//   console.log(4)\n// }, 1000);\n// setTimeout(() => {\n//   console.log(5)\n// }, 0);\n\n// console.log(6)\n\n// // 2 7 6 1 8 3 5 setImmediate 4\n\n\n\n\n\n\n\n\n\nconst obj = {\n  name: 'is obj',\n  girlfriend: {\n    name: '小红'\n  },\n  list: [1,2,3],\n  u: undefined,\n  n: null,\n  f: function() {\n    console.log('func')\n  },\n  arrow: () => {},\n  error: new Error('错误啦')\n}\n\n// // 属于浅拷贝\n// const o = Object.assign({}, obj)\n\n// obj.name = 'is o'\n// obj.girlfriend.name = '小花'\n\n// console.log(o)\n\n\n// // 深拷贝\n// function deepClone(obj) {\n//   const o = {}\n\n//   for (const key in obj) {\n//     if (Object.hasOwnProperty.call(obj, key)) {\n      \n//       if(typeof obj[key] === 'object') {\n//         o[key] = deepClone(obj[key])\n//       } else {\n//         o[key] = obj[key];\n//       }\n//     }\n//   }\n\n//   return o\n// }\n\n\n// const o = deepClone(obj)\n\n// obj.girlfriend.name = '小花'\n// obj.list[1] = 99\n\n// console.log('??', o)\n// console.log('??', obj)\n\n\n\n\n\n// // JSON.stringify实现深克隆\n// // JSON.stringify存在的问题\n// // 如果属性值是 undefined 或者是方法（含箭头函数），克隆出来后，undefined 和函数会丢失\n\n// const o = JSON.stringify(obj)\n\n// console.log(o)\n\n\n\n// class User {\n//   constructor(name) {\n//     this.name = name\n//   }\n// }\n\n// class Admin extends User {\n//   constructor() {\n//     // 子类继承父类，写了 constructor 函数，必须手动调用 super()\n//     // super 指的是父类(User)\n//     super()\n\n//     this.age = 28\n//   }\n// }\n\n// const a = new Admin()\n\n// console.log(a)\n\n\n\n\n\n\n// // async 将函数包装成 Promise\n// // 相当于 function say() { return new Promise() }\n\n// async function say() {\n//   return 'say hello'\n// }\n\n// const s = say()\n\n// s.then(value => {\n//   console.log('value ', value)\n// })\n\n\n\n\n\n\n\n\n\n\n// // 可缓存的纯函数\n\n// function add(a, b) {\n//   console.log('计算中...')\n\n//   return a + b\n// }\n\n// const resolver = (...args) => JSON.stringify(args)\n\n// function memoize(func, resolver) {\n//   const cache = {}\n\n//   return function(...args) {\n//     const key = resolver(...args) // \"[a, b]\"\n\n//     if (cache[key]) {\n//       return cache[key]\n//     } else {\n//       return cache[key] = func(...args)\n//     }\n//   }\n// }\n\n// const memoized = memoize(add, resolver)\n\n// console.log(memoized(9, 9))\n// console.log(memoized(9, 9))\n// console.log(memoized(9, 9))\n\n\n\n\n\n\n\n\n// // 函数柯里化\n// function curry(func) {\n//   const curried = function(...args) {\n//     // 函数的length 表示它有几个参数\n//     if (args.length < func.length) {\n//       // 累加参数\n//       return (...rest) => curried(...args, ...rest)\n//     } else {\n//       // 传入的参数和方法接收的参数相同，直接执行 func 函数\n//       return func(...args)\n//     }\n//   }\n\n//   return curried\n// }\n\n// function add(a, b, c) {\n//   return a + b + c\n// }\n\n// const curried = curry(add)\n// const fn = curried(1)\n\n// console.log(fn(2)(3))\n\n\n\n\n\n\n\n\n\n\n\n// const str = 'hello - '\n\n// function add1(str) {\n//   return str + 'wor'\n// }\n\n// function add2(str) {\n//   return str + 'l'\n// }\n\n// function add3(str) {\n//   return str + 'd'\n// }\n\n// // console.log(add3(add2(add1(str))))\n\n// function flow(...fns) {\n//   if (fns.length === 1) {\n//     return fns[0]\n//   }\n\n//   return fns.reduceRight((a, b) => {\n//     // 从右往左\n//     // 第一步 a === add3, b === add2\n//     // 第二步 a === (...args) => add3(add2(...args)), b === add1\n//     // 第二步的 a 显示为 (...args) => a(b(...args))\n//     // 返回 a(add1(...args))\n\n//     // 当我们最后调用 f 时，会先计算 add1(...args)，拿到结果后，执行 a \"add3(add2(add1(...args)))\"\n//     return (...args) => a(b(...args))\n//   })\n// }\n\n// const f = flow(add1, add2, add3)\n\n\n\n\n\n// function Person(name) {\n//   this.name = name\n//   this.colors = ['red', 'blue']\n// }\n\n// Person.prototype.sayName = function() {\n//   console.log(this.name)\n// }\n\n// function User() {\n//   Person.call(this, 'xiaoming')\n\n//   this.age = 19\n// }\n\n// User.prototype = new Person()\n// User.prototype.constructor = User\n\n// const u = new User()\n\n// console.log(u instanceof User)\n// console.log(u instanceof Person)\n// console.log(User.prototype.isPrototypeOf(u))\n// console.log(Person.prototype.isPrototypeOf(u))\n\n\n\n\n\n\n\n\n\n\n\n// let person = {\n//   name: \"Nicholas\",\n//   friends: [\"Shelby\", \"Court\", \"Van\"]\n// };\n// let anotherPerson = object(person);\n// anotherPerson.name = \"Greg\";\n// anotherPerson.friends.push(\"Rob\");\n// let yetAnotherPerson = object(person);\n// yetAnotherPerson.name = \"Linda\";\n// yetAnotherPerson.friends.push(\"Barbie\");\n// console.log(person.friends);   // \"Shelby, Court, Van, Rob, Barbie\"\n\n\n\n\n\n\n\n\n\n\n\n// const proxy = new Proxy({\n//   name: 'hello'\n// }, {\n//   get(target, property) {\n//     console.log(target, property)\n//     return 11\n//   }\n// })\n\n// console.log(proxy.name)\n\n\n\n\n\n\n\n// function timeout(ms) {\n//   return new Promise(resolve => {\n//     setTimeout(resolve, ms, 'done') // 第三个参数，是传递给 resolve 方法的\n//   })\n// }\n// console.log(1)\n// timeout(1000).then(res => {\n//   console.log(res)\n// })\n\n// console.log(2)\n\n\n\n\n\n// const p1 = new Promise((r, reject) => {\n//   setTimeout(() => {\n//     reject(new Error('fail'))\n//   }, 3000);\n// })\n\n// const p2 = new Promise((r, reject) => {\n//   r(p1)\n// })\n\n// p2.then(result => {\n//   console.log('result ', result)\n// }, error => {\n//   console.log('error ', error)\n// })\n\n\n\n\n\n\n\n// new Promise(r => {\n//   r(x + 2)\n// }).then(res => {\n//   console.log('结果 ', res)\n// }).catch(err => {\n//   console.log('错误 ', err)\n// }).then(() => {\n//   console.log('随便打印')\n// }).finally(() => {\n//   console.log('最后打印')\n// })\n\n\n\n// const p3 = function() {\n//   return new Promise(r => {\n//     setTimeout(() => {\n//       r('p3 success')\n//     }, 3000);\n//   })\n// }\n\n// const allP = Promise.all([1, 2, p3()])\n\n// allP.then(r => {\n//   console.log(r)\n// })\n\n\n\n// console.log(Promise.resolve('helo') instanceof Promise)\n\nconst sleep = function(ms) {\n  return new Promise(r => {\n    console.log(xxxxx + 3)\n\n    setTimeout(() => {\n      r()\n    }, ms)\n  })\n}\n\nasync function sayName() {\n  console.log(1)\n\n  try {\n    await sleep(3000)\n  } catch (error) {\n    console.log(' - - - ', error)\n  }\n\n\n  console.log(2)\n\n  return 'name'\n}\n\nsayName().then(res => console.log(res))\n\n"},{"_content":"<!DOCTYPE html>\n<html lang=\"en\">\n<head>\n  <meta charset=\"UTF-8\">\n  <meta http-equiv=\"X-UA-Compatible\" content=\"IE=edge\">\n  <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n  <title>Document</title>\n</head>\n<body>\n  <div id=\"app\">\n    <form @submit.prevent=\"add\">\n      <input type=\"text\" v-model=\"student.name\">\n      <input type=\"text\" v-model=\"student.age\">\n      <button>添加</button>\n    </form>\n\n    <ul>\n      <li v-for=\"item in list\">姓名：{{item.name}}, 年龄：{{item.age}}</li>\n    </ul>\n\n    <div id=\"my-component\"></div>\n  </div>\n\n  <script src=\"https://cdn.jsdelivr.net/npm/vue@2.7.14/dist/vue.js\"></script>\n\n  <script>\n    const mixin = {\n      mounted() {\n        console.log('??????')\n        this.sayHello()\n      },\n      methods: {\n        sayHello() {\n          console.log('say hello from mixin!!!!')\n        }\n      }\n    }\n\n    const MyCompnent = Vue.extend({\n      mixins: [mixin],\n      template: `\n        <h1>mixin</h1>\n      `\n    })\n\n    new MyCompnent().$mount('#my-component')\n\n    new Vue({\n      el: '#app',\n      data() {\n        return {\n          student: {\n            name: '',\n            age: ''\n          },\n          list: []\n        }\n      },\n      methods: {\n        add() {\n          this.list.push(Object.assign({}, this.student))\n        }\n      }\n    })\n  </script>\n</body>\n</html>","source":"demo/2023面试准备/demo/vue2-demo.html","raw":"<!DOCTYPE html>\n<html lang=\"en\">\n<head>\n  <meta charset=\"UTF-8\">\n  <meta http-equiv=\"X-UA-Compatible\" content=\"IE=edge\">\n  <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n  <title>Document</title>\n</head>\n<body>\n  <div id=\"app\">\n    <form @submit.prevent=\"add\">\n      <input type=\"text\" v-model=\"student.name\">\n      <input type=\"text\" v-model=\"student.age\">\n      <button>添加</button>\n    </form>\n\n    <ul>\n      <li v-for=\"item in list\">姓名：{{item.name}}, 年龄：{{item.age}}</li>\n    </ul>\n\n    <div id=\"my-component\"></div>\n  </div>\n\n  <script src=\"https://cdn.jsdelivr.net/npm/vue@2.7.14/dist/vue.js\"></script>\n\n  <script>\n    const mixin = {\n      mounted() {\n        console.log('??????')\n        this.sayHello()\n      },\n      methods: {\n        sayHello() {\n          console.log('say hello from mixin!!!!')\n        }\n      }\n    }\n\n    const MyCompnent = Vue.extend({\n      mixins: [mixin],\n      template: `\n        <h1>mixin</h1>\n      `\n    })\n\n    new MyCompnent().$mount('#my-component')\n\n    new Vue({\n      el: '#app',\n      data() {\n        return {\n          student: {\n            name: '',\n            age: ''\n          },\n          list: []\n        }\n      },\n      methods: {\n        add() {\n          this.list.push(Object.assign({}, this.student))\n        }\n      }\n    })\n  </script>\n</body>\n</html>","date":"2023-05-12T10:49:20.024Z","updated":"2023-05-12T10:49:20.024Z","path":"demo/2023面试准备/demo/vue2-demo.html","title":"","comments":1,"layout":"page","_id":"clhkizgxx001r3y0q5fkdalio","content":"<!DOCTYPE html>\n<html lang=\"en\">\n<head>\n  <meta charset=\"UTF-8\">\n  <meta http-equiv=\"X-UA-Compatible\" content=\"IE=edge\">\n  <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n  <title>Document</title>\n</head>\n<body>\n  <div id=\"app\">\n    <form @submit.prevent=\"add\">\n      <input type=\"text\" v-model=\"student.name\">\n      <input type=\"text\" v-model=\"student.age\">\n      <button>添加</button>\n    </form>\n\n    <ul>\n      <li v-for=\"item in list\">姓名：, 年龄：</li>\n    </ul>\n\n    <div id=\"my-component\"></div>\n  </div>\n\n  <script src=\"https://cdn.jsdelivr.net/npm/vue@2.7.14/dist/vue.js\"></script>\n\n  <script>\n    const mixin = {\n      mounted() {\n        console.log('??????')\n        this.sayHello()\n      },\n      methods: {\n        sayHello() {\n          console.log('say hello from mixin!!!!')\n        }\n      }\n    }\n\n    const MyCompnent = Vue.extend({\n      mixins: [mixin],\n      template: `\n        <h1>mixin</h1>\n      `\n    })\n\n    new MyCompnent().$mount('#my-component')\n\n    new Vue({\n      el: '#app',\n      data() {\n        return {\n          student: {\n            name: '',\n            age: ''\n          },\n          list: []\n        }\n      },\n      methods: {\n        add() {\n          this.list.push(Object.assign({}, this.student))\n        }\n      }\n    })\n  </script>\n</body>\n</html>","site":{"data":{}},"wordcount":368,"excerpt":"","more":"<!DOCTYPE html>\n<html lang=\"en\">\n<head>\n  <meta charset=\"UTF-8\">\n  <meta http-equiv=\"X-UA-Compatible\" content=\"IE=edge\">\n  <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n  <title>Document</title>\n</head>\n<body>\n  <div id=\"app\">\n    <form @submit.prevent=\"add\">\n      <input type=\"text\" v-model=\"student.name\">\n      <input type=\"text\" v-model=\"student.age\">\n      <button>添加</button>\n    </form>\n\n    <ul>\n      <li v-for=\"item in list\">姓名：, 年龄：</li>\n    </ul>\n\n    <div id=\"my-component\"></div>\n  </div>\n\n  <script src=\"https://cdn.jsdelivr.net/npm/vue@2.7.14/dist/vue.js\"></script>\n\n  <script>\n    const mixin = {\n      mounted() {\n        console.log('??????')\n        this.sayHello()\n      },\n      methods: {\n        sayHello() {\n          console.log('say hello from mixin!!!!')\n        }\n      }\n    }\n\n    const MyCompnent = Vue.extend({\n      mixins: [mixin],\n      template: `\n        <h1>mixin</h1>\n      `\n    })\n\n    new MyCompnent().$mount('#my-component')\n\n    new Vue({\n      el: '#app',\n      data() {\n        return {\n          student: {\n            name: '',\n            age: ''\n          },\n          list: []\n        }\n      },\n      methods: {\n        add() {\n          this.list.push(Object.assign({}, this.student))\n        }\n      }\n    })\n  </script>\n</body>\n</html>"},{"_content":"<!DOCTYPE html>\n<html lang=\"en\">\n<head>\n  <meta charset=\"UTF-8\">\n  <meta http-equiv=\"X-UA-Compatible\" content=\"IE=edge\">\n  <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n  <title>Document</title>\n</head>\n<body>\n  \n  <!-- https://cn.vuejs.org/guide/quick-start.html#using-vue-from-cdn -->\n  <script src=\"https://unpkg.com/vue@3/dist/vue.global.js\"></script>\n</body>\n</html>","source":"demo/2023面试准备/demo/vue3-demo.html","raw":"<!DOCTYPE html>\n<html lang=\"en\">\n<head>\n  <meta charset=\"UTF-8\">\n  <meta http-equiv=\"X-UA-Compatible\" content=\"IE=edge\">\n  <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n  <title>Document</title>\n</head>\n<body>\n  \n  <!-- https://cn.vuejs.org/guide/quick-start.html#using-vue-from-cdn -->\n  <script src=\"https://unpkg.com/vue@3/dist/vue.global.js\"></script>\n</body>\n</html>","date":"2023-05-12T10:49:20.025Z","updated":"2023-05-12T10:49:20.025Z","path":"demo/2023面试准备/demo/vue3-demo.html","title":"","comments":1,"layout":"page","_id":"clhkizgxy001s3y0q8lg8an3c","content":"<!DOCTYPE html>\n<html lang=\"en\">\n<head>\n  <meta charset=\"UTF-8\">\n  <meta http-equiv=\"X-UA-Compatible\" content=\"IE=edge\">\n  <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n  <title>Document</title>\n</head>\n<body>\n  \n  <!-- https://cn.vuejs.org/guide/quick-start.html#using-vue-from-cdn -->\n  <script src=\"https://unpkg.com/vue@3/dist/vue.global.js\"></script>\n</body>\n</html>","site":{"data":{}},"wordcount":8,"excerpt":"","more":"<!DOCTYPE html>\n<html lang=\"en\">\n<head>\n  <meta charset=\"UTF-8\">\n  <meta http-equiv=\"X-UA-Compatible\" content=\"IE=edge\">\n  <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n  <title>Document</title>\n</head>\n<body>\n  \n  <!-- https://cn.vuejs.org/guide/quick-start.html#using-vue-from-cdn -->\n  <script src=\"https://unpkg.com/vue@3/dist/vue.global.js\"></script>\n</body>\n</html>"},{"_content":"<!DOCTYPE html>\n<html lang=\"en\">\n<head>\n  <meta charset=\"UTF-8\">\n  <meta http-equiv=\"X-UA-Compatible\" content=\"IE=edge\">\n  <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n  <title>Document</title>\n  <script src=\"main.js\"></script>\n</head>\n<body>\n  <h1><code>composed</code> and <code>composedPath</code> demo</h1>\n\n  <open-shadow text=\"I have an open shadow root\"></open-shadow>\n\n  <closed-shadow text=\"I have a closed shadow root\"></closed-shadow>\n</body>\n</html>","source":"demo/webcomponent/composed-path/index.html","raw":"<!DOCTYPE html>\n<html lang=\"en\">\n<head>\n  <meta charset=\"UTF-8\">\n  <meta http-equiv=\"X-UA-Compatible\" content=\"IE=edge\">\n  <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n  <title>Document</title>\n  <script src=\"main.js\"></script>\n</head>\n<body>\n  <h1><code>composed</code> and <code>composedPath</code> demo</h1>\n\n  <open-shadow text=\"I have an open shadow root\"></open-shadow>\n\n  <closed-shadow text=\"I have a closed shadow root\"></closed-shadow>\n</body>\n</html>","date":"2023-05-12T10:49:20.039Z","updated":"2023-05-12T10:49:20.039Z","path":"demo/webcomponent/composed-path/index.html","title":"","comments":1,"layout":"page","_id":"clhkizgxy001v3y0q6yb412cd","content":"<!DOCTYPE html>\n<html lang=\"en\">\n<head>\n  <meta charset=\"UTF-8\">\n  <meta http-equiv=\"X-UA-Compatible\" content=\"IE=edge\">\n  <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n  <title>Document</title>\n  <script src=\"main.js\"></script>\n</head>\n<body>\n  <h1><code>composed</code> and <code>composedPath</code> demo</h1>\n\n  <open-shadow text=\"I have an open shadow root\"></open-shadow>\n\n  <closed-shadow text=\"I have a closed shadow root\"></closed-shadow>\n</body>\n</html>","site":{"data":{}},"wordcount":35,"excerpt":"","more":"<!DOCTYPE html>\n<html lang=\"en\">\n<head>\n  <meta charset=\"UTF-8\">\n  <meta http-equiv=\"X-UA-Compatible\" content=\"IE=edge\">\n  <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n  <title>Document</title>\n  <script src=\"main.js\"></script>\n</head>\n<body>\n  <h1><code>composed</code> and <code>composedPath</code> demo</h1>\n\n  <open-shadow text=\"I have an open shadow root\"></open-shadow>\n\n  <closed-shadow text=\"I have a closed shadow root\"></closed-shadow>\n</body>\n</html>"},{"_content":"customElements.define('open-shadow',\n  class extends HTMLElement {\n    constructor() {\n      super();\n    }\n\n    connectedCallback() {\n      const pElem = document.createElement('p');\n      pElem.textContent = this.getAttribute('text');\n\n      const shadowRoot = this.attachShadow({mode: 'open'});\n      shadowRoot.appendChild(pElem);\n    }\n  }\n);\n\ncustomElements.define('closed-shadow',\n  class extends HTMLElement {\n    constructor() {\n      super();\n    }\n\n    connectedCallback() {\n      const pElem = document.createElement('p');\n      pElem.textContent = this.getAttribute('text');\n\n      const shadowRoot = this.attachShadow({mode: 'closed'});\n      shadowRoot.appendChild(pElem);\n    }\n  }\n);\n\ndocument.querySelector('html').addEventListener('click', e => {\n  console.log(e.composed);\n  console.log(e.composedPath());\n});\n","source":"demo/webcomponent/composed-path/main.js","raw":"customElements.define('open-shadow',\n  class extends HTMLElement {\n    constructor() {\n      super();\n    }\n\n    connectedCallback() {\n      const pElem = document.createElement('p');\n      pElem.textContent = this.getAttribute('text');\n\n      const shadowRoot = this.attachShadow({mode: 'open'});\n      shadowRoot.appendChild(pElem);\n    }\n  }\n);\n\ncustomElements.define('closed-shadow',\n  class extends HTMLElement {\n    constructor() {\n      super();\n    }\n\n    connectedCallback() {\n      const pElem = document.createElement('p');\n      pElem.textContent = this.getAttribute('text');\n\n      const shadowRoot = this.attachShadow({mode: 'closed'});\n      shadowRoot.appendChild(pElem);\n    }\n  }\n);\n\ndocument.querySelector('html').addEventListener('click', e => {\n  console.log(e.composed);\n  console.log(e.composedPath());\n});\n","date":"2023-05-12T10:49:20.040Z","updated":"2023-05-12T10:49:20.040Z","path":"demo/webcomponent/composed-path/main.js","layout":"false","title":"","comments":1,"_id":"clhkizgxz001w3y0q76t0fq0j","content":"customElements.define('open-shadow',\n  class extends HTMLElement {\n    constructor() {\n      super();\n    }\n\n    connectedCallback() {\n      const pElem = document.createElement('p');\n      pElem.textContent = this.getAttribute('text');\n\n      const shadowRoot = this.attachShadow({mode: 'open'});\n      shadowRoot.appendChild(pElem);\n    }\n  }\n);\n\ncustomElements.define('closed-shadow',\n  class extends HTMLElement {\n    constructor() {\n      super();\n    }\n\n    connectedCallback() {\n      const pElem = document.createElement('p');\n      pElem.textContent = this.getAttribute('text');\n\n      const shadowRoot = this.attachShadow({mode: 'closed'});\n      shadowRoot.appendChild(pElem);\n    }\n  }\n);\n\ndocument.querySelector('html').addEventListener('click', e => {\n  console.log(e.composed);\n  console.log(e.composedPath());\n});\n","site":{"data":{}},"wordcount":659,"excerpt":"","more":"customElements.define('open-shadow',\n  class extends HTMLElement {\n    constructor() {\n      super();\n    }\n\n    connectedCallback() {\n      const pElem = document.createElement('p');\n      pElem.textContent = this.getAttribute('text');\n\n      const shadowRoot = this.attachShadow({mode: 'open'});\n      shadowRoot.appendChild(pElem);\n    }\n  }\n);\n\ncustomElements.define('closed-shadow',\n  class extends HTMLElement {\n    constructor() {\n      super();\n    }\n\n    connectedCallback() {\n      const pElem = document.createElement('p');\n      pElem.textContent = this.getAttribute('text');\n\n      const shadowRoot = this.attachShadow({mode: 'closed'});\n      shadowRoot.appendChild(pElem);\n    }\n  }\n);\n\ndocument.querySelector('html').addEventListener('click', e => {\n  console.log(e.composed);\n  console.log(e.composedPath());\n});\n"},{"_content":"<!DOCTYPE html>\n<html lang=\"en\">\n<head>\n  <meta charset=\"UTF-8\">\n  <meta http-equiv=\"X-UA-Compatible\" content=\"IE=edge\">\n  <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n  <title>Document</title>\n  <script src=\"main.js\"></script>\n</head>\n<body>\n  <h1>element-details-template</h1>\n\n  <template id=\"element-details-template\">\n    <style>\n    details {font-family: \"Open Sans Light\",Helvetica,Arial}\n    .name {font-weight: bold; color: #217ac0; font-size: 120%}\n    h4 { margin: 10px 0 -8px 0; }\n    h4 span { background: #217ac0; padding: 2px 6px 2px 6px }\n    h4 span { border: 1px solid #cee9f9; border-radius: 4px }\n    h4 span { color: white }\n    .attributes { margin-left: 22px; font-size: 90% }\n    .attributes p { margin-left: 16px; font-style: italic }\n\n\n    dl { margin-left: 6px; }\n    dt { font-weight: bold; color: #217ac0; font-size: 110% }\n    dt { font-family: Consolas, \"Liberation Mono\", Courier }\n    dd { margin-left: 16px }\n    </style>\n\n    <details>\n      <summary>\n        <span>\n          <code class=\"name\">&lt;<slot name=\"element-name\">NEED NAME</slot>&gt;</code>\n          <i class=\"desc\"><slot name=\"description\">NEED DESCRIPTION</slot></i>\n        </span>\n      </summary>\n      <div class=\"attributes\">\n        <h4><span>Attributes</span></h4>\n        <slot name=\"attributes\"><p>None</p></slot>\n      </div>\n    </details>\n    <hr>\n  </template>\n\n  <hr>\n\n  <details-element>\n    <p slot=\"element-name\">Hello_AlexCc</p>\n    <p slot=\"description\">A mechanism for holding client-\n      side content that is not to be rendered when a page is\n      loaded but may subsequently be instantiated during\n      runtime using JavaScript.</p>\n      <dl slot=\"attributes\">\n        <dt>name</dt>\n        <dd>The name of the slot.</dd>\n      </dl>\n  </details-element>\n\n</body>\n</html>","source":"demo/webcomponent/element-details-template/index.html","raw":"<!DOCTYPE html>\n<html lang=\"en\">\n<head>\n  <meta charset=\"UTF-8\">\n  <meta http-equiv=\"X-UA-Compatible\" content=\"IE=edge\">\n  <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n  <title>Document</title>\n  <script src=\"main.js\"></script>\n</head>\n<body>\n  <h1>element-details-template</h1>\n\n  <template id=\"element-details-template\">\n    <style>\n    details {font-family: \"Open Sans Light\",Helvetica,Arial}\n    .name {font-weight: bold; color: #217ac0; font-size: 120%}\n    h4 { margin: 10px 0 -8px 0; }\n    h4 span { background: #217ac0; padding: 2px 6px 2px 6px }\n    h4 span { border: 1px solid #cee9f9; border-radius: 4px }\n    h4 span { color: white }\n    .attributes { margin-left: 22px; font-size: 90% }\n    .attributes p { margin-left: 16px; font-style: italic }\n\n\n    dl { margin-left: 6px; }\n    dt { font-weight: bold; color: #217ac0; font-size: 110% }\n    dt { font-family: Consolas, \"Liberation Mono\", Courier }\n    dd { margin-left: 16px }\n    </style>\n\n    <details>\n      <summary>\n        <span>\n          <code class=\"name\">&lt;<slot name=\"element-name\">NEED NAME</slot>&gt;</code>\n          <i class=\"desc\"><slot name=\"description\">NEED DESCRIPTION</slot></i>\n        </span>\n      </summary>\n      <div class=\"attributes\">\n        <h4><span>Attributes</span></h4>\n        <slot name=\"attributes\"><p>None</p></slot>\n      </div>\n    </details>\n    <hr>\n  </template>\n\n  <hr>\n\n  <details-element>\n    <p slot=\"element-name\">Hello_AlexCc</p>\n    <p slot=\"description\">A mechanism for holding client-\n      side content that is not to be rendered when a page is\n      loaded but may subsequently be instantiated during\n      runtime using JavaScript.</p>\n      <dl slot=\"attributes\">\n        <dt>name</dt>\n        <dd>The name of the slot.</dd>\n      </dl>\n  </details-element>\n\n</body>\n</html>","date":"2023-05-12T10:49:20.040Z","updated":"2023-05-12T10:49:20.040Z","path":"demo/webcomponent/element-details-template/index.html","title":"","comments":1,"layout":"page","_id":"clhkizgxz001y3y0q7rt5fhjj","content":"<!DOCTYPE html>\n<html lang=\"en\">\n<head>\n  <meta charset=\"UTF-8\">\n  <meta http-equiv=\"X-UA-Compatible\" content=\"IE=edge\">\n  <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n  <title>Document</title>\n  <script src=\"main.js\"></script>\n</head>\n<body>\n  <h1>element-details-template</h1>\n\n  <template id=\"element-details-template\">\n    <style>\n    details {font-family: \"Open Sans Light\",Helvetica,Arial}\n    .name {font-weight: bold; color: #217ac0; font-size: 120%}\n    h4 { margin: 10px 0 -8px 0; }\n    h4 span { background: #217ac0; padding: 2px 6px 2px 6px }\n    h4 span { border: 1px solid #cee9f9; border-radius: 4px }\n    h4 span { color: white }\n    .attributes { margin-left: 22px; font-size: 90% }\n    .attributes p { margin-left: 16px; font-style: italic }\n\n\n    dl { margin-left: 6px; }\n    dt { font-weight: bold; color: #217ac0; font-size: 110% }\n    dt { font-family: Consolas, \"Liberation Mono\", Courier }\n    dd { margin-left: 16px }\n    </style>\n\n    <details>\n      <summary>\n        <span>\n          <code class=\"name\">&lt;<slot name=\"element-name\">NEED NAME</slot>&gt;</code>\n          <i class=\"desc\"><slot name=\"description\">NEED DESCRIPTION</slot></i>\n        </span>\n      </summary>\n      <div class=\"attributes\">\n        <h4><span>Attributes</span></h4>\n        <slot name=\"attributes\"><p>None</p></slot>\n      </div>\n    </details>\n    <hr>\n  </template>\n\n  <hr>\n\n  <details-element>\n    <p slot=\"element-name\">Hello_AlexCc</p>\n    <p slot=\"description\">A mechanism for holding client-\n      side content that is not to be rendered when a page is\n      loaded but may subsequently be instantiated during\n      runtime using JavaScript.</p>\n      <dl slot=\"attributes\">\n        <dt>name</dt>\n        <dd>The name of the slot.</dd>\n      </dl>\n  </details-element>\n\n</body>\n</html>","site":{"data":{}},"wordcount":716,"excerpt":"","more":"<!DOCTYPE html>\n<html lang=\"en\">\n<head>\n  <meta charset=\"UTF-8\">\n  <meta http-equiv=\"X-UA-Compatible\" content=\"IE=edge\">\n  <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n  <title>Document</title>\n  <script src=\"main.js\"></script>\n</head>\n<body>\n  <h1>element-details-template</h1>\n\n  <template id=\"element-details-template\">\n    <style>\n    details {font-family: \"Open Sans Light\",Helvetica,Arial}\n    .name {font-weight: bold; color: #217ac0; font-size: 120%}\n    h4 { margin: 10px 0 -8px 0; }\n    h4 span { background: #217ac0; padding: 2px 6px 2px 6px }\n    h4 span { border: 1px solid #cee9f9; border-radius: 4px }\n    h4 span { color: white }\n    .attributes { margin-left: 22px; font-size: 90% }\n    .attributes p { margin-left: 16px; font-style: italic }\n\n\n    dl { margin-left: 6px; }\n    dt { font-weight: bold; color: #217ac0; font-size: 110% }\n    dt { font-family: Consolas, \"Liberation Mono\", Courier }\n    dd { margin-left: 16px }\n    </style>\n\n    <details>\n      <summary>\n        <span>\n          <code class=\"name\">&lt;<slot name=\"element-name\">NEED NAME</slot>&gt;</code>\n          <i class=\"desc\"><slot name=\"description\">NEED DESCRIPTION</slot></i>\n        </span>\n      </summary>\n      <div class=\"attributes\">\n        <h4><span>Attributes</span></h4>\n        <slot name=\"attributes\"><p>None</p></slot>\n      </div>\n    </details>\n    <hr>\n  </template>\n\n  <hr>\n\n  <details-element>\n    <p slot=\"element-name\">Hello_AlexCc</p>\n    <p slot=\"description\">A mechanism for holding client-\n      side content that is not to be rendered when a page is\n      loaded but may subsequently be instantiated during\n      runtime using JavaScript.</p>\n      <dl slot=\"attributes\">\n        <dt>name</dt>\n        <dd>The name of the slot.</dd>\n      </dl>\n  </details-element>\n\n</body>\n</html>"},{"_content":"\nclass DetailsElement extends HTMLElement {\n  constructor() {\n    super()\n\n    const template = document.getElementById('element-details-template').content\n\n    const shadowRoot = this.attachShadow({mode: 'open'})\n    \n    shadowRoot.appendChild(template.cloneNode(true))\n\n    console.log('host ', shadowRoot.host === this) // ShadowRoot 附加的宿主 DOM 元素。\n  }\n}\n\nconst a = customElements.define('details-element', DetailsElement)\n\nconsole.log('?? ', customElements.get('details-element'))\nconsole.log('?? a', a)\n\n","source":"demo/webcomponent/element-details-template/main.js","raw":"\nclass DetailsElement extends HTMLElement {\n  constructor() {\n    super()\n\n    const template = document.getElementById('element-details-template').content\n\n    const shadowRoot = this.attachShadow({mode: 'open'})\n    \n    shadowRoot.appendChild(template.cloneNode(true))\n\n    console.log('host ', shadowRoot.host === this) // ShadowRoot 附加的宿主 DOM 元素。\n  }\n}\n\nconst a = customElements.define('details-element', DetailsElement)\n\nconsole.log('?? ', customElements.get('details-element'))\nconsole.log('?? a', a)\n\n","date":"2023-05-12T10:49:20.040Z","updated":"2023-05-12T10:49:20.040Z","path":"demo/webcomponent/element-details-template/main.js","layout":"false","title":"","comments":1,"_id":"clhkizgy000203y0q83o34x72","content":"\nclass DetailsElement extends HTMLElement {\n  constructor() {\n    super()\n\n    const template = document.getElementById('element-details-template').content\n\n    const shadowRoot = this.attachShadow({mode: 'open'})\n    \n    shadowRoot.appendChild(template.cloneNode(true))\n\n    console.log('host ', shadowRoot.host === this) // ShadowRoot 附加的宿主 DOM 元素。\n  }\n}\n\nconst a = customElements.define('details-element', DetailsElement)\n\nconsole.log('?? ', customElements.get('details-element'))\nconsole.log('?? a', a)\n\n","site":{"data":{}},"wordcount":432,"excerpt":"","more":"\nclass DetailsElement extends HTMLElement {\n  constructor() {\n    super()\n\n    const template = document.getElementById('element-details-template').content\n\n    const shadowRoot = this.attachShadow({mode: 'open'})\n    \n    shadowRoot.appendChild(template.cloneNode(true))\n\n    console.log('host ', shadowRoot.host === this) // ShadowRoot 附加的宿主 DOM 元素。\n  }\n}\n\nconst a = customElements.define('details-element', DetailsElement)\n\nconsole.log('?? ', customElements.get('details-element'))\nconsole.log('?? a', a)\n\n"},{"_content":"<html lang=\"en\">\n<head>\n    <meta charset=\"UTF-8\">\n    <meta http-equiv=\"X-UA-Compatible\" content=\"IE=edge\">\n    <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n    <title>iframe</title>\n    <style>\n      body {\n        background-color: coral;\n      }\n    </style>\n</head>\n<body>\n  <p>iframe body</p>\n  <h1>iframe page</h1>\n</body>\n</html>","source":"demo/webcomponent/expanding-list/iframe.html","raw":"<html lang=\"en\">\n<head>\n    <meta charset=\"UTF-8\">\n    <meta http-equiv=\"X-UA-Compatible\" content=\"IE=edge\">\n    <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n    <title>iframe</title>\n    <style>\n      body {\n        background-color: coral;\n      }\n    </style>\n</head>\n<body>\n  <p>iframe body</p>\n  <h1>iframe page</h1>\n</body>\n</html>","date":"2023-05-12T10:49:20.041Z","updated":"2023-05-12T10:49:20.041Z","path":"demo/webcomponent/expanding-list/iframe.html","title":"","comments":1,"layout":"page","_id":"clhkizgy000223y0qhvv1fozr","content":"<html lang=\"en\">\n<head>\n    <meta charset=\"UTF-8\">\n    <meta http-equiv=\"X-UA-Compatible\" content=\"IE=edge\">\n    <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n    <title>iframe</title>\n    <style>\n      body {\n        background-color: coral;\n      }\n    </style>\n</head>\n<body>\n  <p>iframe body</p>\n  <h1>iframe page</h1>\n</body>\n</html>","site":{"data":{}},"wordcount":55,"excerpt":"","more":"<html lang=\"en\">\n<head>\n    <meta charset=\"UTF-8\">\n    <meta http-equiv=\"X-UA-Compatible\" content=\"IE=edge\">\n    <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n    <title>iframe</title>\n    <style>\n      body {\n        background-color: coral;\n      }\n    </style>\n</head>\n<body>\n  <p>iframe body</p>\n  <h1>iframe page</h1>\n</body>\n</html>"},{"_content":"// Create a class for the element\nclass Square extends HTMLElement {\n  // Specify observed attributes so that\n  // attributeChangedCallback will work\n  static get observedAttributes() {\n    return ['c', 'l'];\n  }\n\n  constructor() {\n    // Always call super first in constructor\n    super();\n\n    const shadow = this.attachShadow({mode: 'open'});\n\n    const div = document.createElement('div');\n    const style = document.createElement('style');\n    shadow.appendChild(style);\n    shadow.appendChild(div);\n  }\n\n  connectedCallback() {\n    console.log('connectedCallback 当 custom element 首次被插入文档 DOM 时，被调用。');\n    updateStyle(this);\n  }\n\n  disconnectedCallback() {\n    console.log('Custom square element 从页面上被删除！');\n  }\n\n  adoptedCallback() {\n    console.log('Custom square element 移动到了一个新的页面？');\n  }\n\n  attributeChangedCallback(name, oldValue, newValue) {\n    console.log('Custom square element 属性发生了改变');\n    updateStyle(this);\n  }\n}\n\ncustomElements.define('custom-square', Square);\n\nfunction updateStyle(elem) {\n  const shadow = elem.shadowRoot;\n  shadow.querySelector('style').textContent = `\n    div {\n      width: ${elem.getAttribute('l')}px;\n      height: ${elem.getAttribute('l')}px;\n      background-color: ${elem.getAttribute('c')};\n    }\n  `;\n}\n\nconst add = document.querySelector('.add');\nconst update = document.querySelector('.update');\nconst remove = document.querySelector('.remove');\nconst move = document.querySelector('.move');\nconst other = document.querySelector('.other');\nlet square;\n\nupdate.disabled = true;\nremove.disabled = true;\nmove.disabled = true;\n\nfunction random(min, max) {\n  return Math.floor(Math.random() * (max - min + 1) + min);\n}\n\nadd.onclick = function() {\n  // Create a custom square element\n  square = document.createElement('custom-square');\n  square.setAttribute('l', '100');\n  square.setAttribute('c', 'red');\n  document.body.appendChild(square);\n\n  update.disabled = false;\n  remove.disabled = false;\n  move.disabled = false;\n  add.disabled = true;\n};\n\nupdate.onclick = function() {\n  // Randomly update square's attributes\n  square.setAttribute('l', random(50, 200));\n  square.setAttribute('c', `rgb(${random(0, 255)}, ${random(0, 255)}, ${random(0, 255)})`);\n};\n\nremove.onclick = function() {\n  // Remove the square\n  document.body.removeChild(square);\n\n  update.disabled = true;\n  remove.disabled = true;\n  add.disabled = false;\n};\n\nmove.onclick = function() {\n\n  const square1 = document.querySelector('custom-square')\n\n  // move，我以为的移动到新文档\n  other.appendChild(square1)\n\n  /**\n   * @result 生命周期执行顺序: disconnectedCallback > connectedCallback\n   * @desc 很尴尬，这不叫移动到新的文档么？\n   */\n  \n  // 那我们来试试 iframe\n  setTimeout(() => {\n    const iframe = document.querySelector('iframe')\n    iframe.contentDocument.querySelector('body').appendChild(square1)\n    move.disabled = true\n  }, 1500);\n\n  // 这下就对了，生命周期执行顺序 disconnectedCallback > adoptedCallback > connectedCallback\n};","source":"demo/webcomponent/expanding-list/main.js","raw":"// Create a class for the element\nclass Square extends HTMLElement {\n  // Specify observed attributes so that\n  // attributeChangedCallback will work\n  static get observedAttributes() {\n    return ['c', 'l'];\n  }\n\n  constructor() {\n    // Always call super first in constructor\n    super();\n\n    const shadow = this.attachShadow({mode: 'open'});\n\n    const div = document.createElement('div');\n    const style = document.createElement('style');\n    shadow.appendChild(style);\n    shadow.appendChild(div);\n  }\n\n  connectedCallback() {\n    console.log('connectedCallback 当 custom element 首次被插入文档 DOM 时，被调用。');\n    updateStyle(this);\n  }\n\n  disconnectedCallback() {\n    console.log('Custom square element 从页面上被删除！');\n  }\n\n  adoptedCallback() {\n    console.log('Custom square element 移动到了一个新的页面？');\n  }\n\n  attributeChangedCallback(name, oldValue, newValue) {\n    console.log('Custom square element 属性发生了改变');\n    updateStyle(this);\n  }\n}\n\ncustomElements.define('custom-square', Square);\n\nfunction updateStyle(elem) {\n  const shadow = elem.shadowRoot;\n  shadow.querySelector('style').textContent = `\n    div {\n      width: ${elem.getAttribute('l')}px;\n      height: ${elem.getAttribute('l')}px;\n      background-color: ${elem.getAttribute('c')};\n    }\n  `;\n}\n\nconst add = document.querySelector('.add');\nconst update = document.querySelector('.update');\nconst remove = document.querySelector('.remove');\nconst move = document.querySelector('.move');\nconst other = document.querySelector('.other');\nlet square;\n\nupdate.disabled = true;\nremove.disabled = true;\nmove.disabled = true;\n\nfunction random(min, max) {\n  return Math.floor(Math.random() * (max - min + 1) + min);\n}\n\nadd.onclick = function() {\n  // Create a custom square element\n  square = document.createElement('custom-square');\n  square.setAttribute('l', '100');\n  square.setAttribute('c', 'red');\n  document.body.appendChild(square);\n\n  update.disabled = false;\n  remove.disabled = false;\n  move.disabled = false;\n  add.disabled = true;\n};\n\nupdate.onclick = function() {\n  // Randomly update square's attributes\n  square.setAttribute('l', random(50, 200));\n  square.setAttribute('c', `rgb(${random(0, 255)}, ${random(0, 255)}, ${random(0, 255)})`);\n};\n\nremove.onclick = function() {\n  // Remove the square\n  document.body.removeChild(square);\n\n  update.disabled = true;\n  remove.disabled = true;\n  add.disabled = false;\n};\n\nmove.onclick = function() {\n\n  const square1 = document.querySelector('custom-square')\n\n  // move，我以为的移动到新文档\n  other.appendChild(square1)\n\n  /**\n   * @result 生命周期执行顺序: disconnectedCallback > connectedCallback\n   * @desc 很尴尬，这不叫移动到新的文档么？\n   */\n  \n  // 那我们来试试 iframe\n  setTimeout(() => {\n    const iframe = document.querySelector('iframe')\n    iframe.contentDocument.querySelector('body').appendChild(square1)\n    move.disabled = true\n  }, 1500);\n\n  // 这下就对了，生命周期执行顺序 disconnectedCallback > adoptedCallback > connectedCallback\n};","date":"2023-05-12T10:49:20.041Z","updated":"2023-05-12T10:49:20.041Z","path":"demo/webcomponent/expanding-list/main.js","layout":"false","title":"","comments":1,"_id":"clhkizgy000243y0q72lp8ubl","content":"// Create a class for the element\nclass Square extends HTMLElement {\n  // Specify observed attributes so that\n  // attributeChangedCallback will work\n  static get observedAttributes() {\n    return ['c', 'l'];\n  }\n\n  constructor() {\n    // Always call super first in constructor\n    super();\n\n    const shadow = this.attachShadow({mode: 'open'});\n\n    const div = document.createElement('div');\n    const style = document.createElement('style');\n    shadow.appendChild(style);\n    shadow.appendChild(div);\n  }\n\n  connectedCallback() {\n    console.log('connectedCallback 当 custom element 首次被插入文档 DOM 时，被调用。');\n    updateStyle(this);\n  }\n\n  disconnectedCallback() {\n    console.log('Custom square element 从页面上被删除！');\n  }\n\n  adoptedCallback() {\n    console.log('Custom square element 移动到了一个新的页面？');\n  }\n\n  attributeChangedCallback(name, oldValue, newValue) {\n    console.log('Custom square element 属性发生了改变');\n    updateStyle(this);\n  }\n}\n\ncustomElements.define('custom-square', Square);\n\nfunction updateStyle(elem) {\n  const shadow = elem.shadowRoot;\n  shadow.querySelector('style').textContent = `\n    div {\n      width: ${elem.getAttribute('l')}px;\n      height: ${elem.getAttribute('l')}px;\n      background-color: ${elem.getAttribute('c')};\n    }\n  `;\n}\n\nconst add = document.querySelector('.add');\nconst update = document.querySelector('.update');\nconst remove = document.querySelector('.remove');\nconst move = document.querySelector('.move');\nconst other = document.querySelector('.other');\nlet square;\n\nupdate.disabled = true;\nremove.disabled = true;\nmove.disabled = true;\n\nfunction random(min, max) {\n  return Math.floor(Math.random() * (max - min + 1) + min);\n}\n\nadd.onclick = function() {\n  // Create a custom square element\n  square = document.createElement('custom-square');\n  square.setAttribute('l', '100');\n  square.setAttribute('c', 'red');\n  document.body.appendChild(square);\n\n  update.disabled = false;\n  remove.disabled = false;\n  move.disabled = false;\n  add.disabled = true;\n};\n\nupdate.onclick = function() {\n  // Randomly update square's attributes\n  square.setAttribute('l', random(50, 200));\n  square.setAttribute('c', `rgb(${random(0, 255)}, ${random(0, 255)}, ${random(0, 255)})`);\n};\n\nremove.onclick = function() {\n  // Remove the square\n  document.body.removeChild(square);\n\n  update.disabled = true;\n  remove.disabled = true;\n  add.disabled = false;\n};\n\nmove.onclick = function() {\n\n  const square1 = document.querySelector('custom-square')\n\n  // move，我以为的移动到新文档\n  other.appendChild(square1)\n\n  /**\n   * @result 生命周期执行顺序: disconnectedCallback > connectedCallback\n   * @desc 很尴尬，这不叫移动到新的文档么？\n   */\n  \n  // 那我们来试试 iframe\n  setTimeout(() => {\n    const iframe = document.querySelector('iframe')\n    iframe.contentDocument.querySelector('body').appendChild(square1)\n    move.disabled = true\n  }, 1500);\n\n  // 这下就对了，生命周期执行顺序 disconnectedCallback > adoptedCallback > connectedCallback\n};","site":{"data":{}},"wordcount":2417,"excerpt":"","more":"// Create a class for the element\nclass Square extends HTMLElement {\n  // Specify observed attributes so that\n  // attributeChangedCallback will work\n  static get observedAttributes() {\n    return ['c', 'l'];\n  }\n\n  constructor() {\n    // Always call super first in constructor\n    super();\n\n    const shadow = this.attachShadow({mode: 'open'});\n\n    const div = document.createElement('div');\n    const style = document.createElement('style');\n    shadow.appendChild(style);\n    shadow.appendChild(div);\n  }\n\n  connectedCallback() {\n    console.log('connectedCallback 当 custom element 首次被插入文档 DOM 时，被调用。');\n    updateStyle(this);\n  }\n\n  disconnectedCallback() {\n    console.log('Custom square element 从页面上被删除！');\n  }\n\n  adoptedCallback() {\n    console.log('Custom square element 移动到了一个新的页面？');\n  }\n\n  attributeChangedCallback(name, oldValue, newValue) {\n    console.log('Custom square element 属性发生了改变');\n    updateStyle(this);\n  }\n}\n\ncustomElements.define('custom-square', Square);\n\nfunction updateStyle(elem) {\n  const shadow = elem.shadowRoot;\n  shadow.querySelector('style').textContent = `\n    div {\n      width: ${elem.getAttribute('l')}px;\n      height: ${elem.getAttribute('l')}px;\n      background-color: ${elem.getAttribute('c')};\n    }\n  `;\n}\n\nconst add = document.querySelector('.add');\nconst update = document.querySelector('.update');\nconst remove = document.querySelector('.remove');\nconst move = document.querySelector('.move');\nconst other = document.querySelector('.other');\nlet square;\n\nupdate.disabled = true;\nremove.disabled = true;\nmove.disabled = true;\n\nfunction random(min, max) {\n  return Math.floor(Math.random() * (max - min + 1) + min);\n}\n\nadd.onclick = function() {\n  // Create a custom square element\n  square = document.createElement('custom-square');\n  square.setAttribute('l', '100');\n  square.setAttribute('c', 'red');\n  document.body.appendChild(square);\n\n  update.disabled = false;\n  remove.disabled = false;\n  move.disabled = false;\n  add.disabled = true;\n};\n\nupdate.onclick = function() {\n  // Randomly update square's attributes\n  square.setAttribute('l', random(50, 200));\n  square.setAttribute('c', `rgb(${random(0, 255)}, ${random(0, 255)}, ${random(0, 255)})`);\n};\n\nremove.onclick = function() {\n  // Remove the square\n  document.body.removeChild(square);\n\n  update.disabled = true;\n  remove.disabled = true;\n  add.disabled = false;\n};\n\nmove.onclick = function() {\n\n  const square1 = document.querySelector('custom-square')\n\n  // move，我以为的移动到新文档\n  other.appendChild(square1)\n\n  /**\n   * @result 生命周期执行顺序: disconnectedCallback > connectedCallback\n   * @desc 很尴尬，这不叫移动到新的文档么？\n   */\n  \n  // 那我们来试试 iframe\n  setTimeout(() => {\n    const iframe = document.querySelector('iframe')\n    iframe.contentDocument.querySelector('body').appendChild(square1)\n    move.disabled = true\n  }, 1500);\n\n  // 这下就对了，生命周期执行顺序 disconnectedCallback > adoptedCallback > connectedCallback\n};"},{"_content":"<!DOCTYPE html>\n<html>\n  <head>\n    <meta charset=\"utf-8\">\n    <title>Life cycle callbacks test</title>\n    <style>\n      custom-square {\n        margin: 20px;\n      }\n\n      .other {\n        /* position: absolute; */\n        top: 20%;\n        left: 50%;\n        width: 200px;\n        height: 200px;\n        background-color: #808080;\n      }\n    </style>\n    <script defer src=\"main.js\"></script>\n  </head>\n  <body>\n    <h1>Life cycle callbacks test</h1>\n\n    <div>\n      <button class=\"add\">Add custom-square to DOM</button>\n      <button class=\"update\">Update attributes</button>\n      <button class=\"remove\">Remove custom-square from DOM</button>\n      <button class=\"move\">Move custom-square to new Dom</button>\n    </div>\n\n    <div class=\"other\"></div>\n\n    <iframe src=\"./iframe.html\" frameborder=\"0\" width=\"800px\" height=\"500px\"></iframe>\n\n  </body>\n</html>","source":"demo/webcomponent/expanding-list/index.html","raw":"<!DOCTYPE html>\n<html>\n  <head>\n    <meta charset=\"utf-8\">\n    <title>Life cycle callbacks test</title>\n    <style>\n      custom-square {\n        margin: 20px;\n      }\n\n      .other {\n        /* position: absolute; */\n        top: 20%;\n        left: 50%;\n        width: 200px;\n        height: 200px;\n        background-color: #808080;\n      }\n    </style>\n    <script defer src=\"main.js\"></script>\n  </head>\n  <body>\n    <h1>Life cycle callbacks test</h1>\n\n    <div>\n      <button class=\"add\">Add custom-square to DOM</button>\n      <button class=\"update\">Update attributes</button>\n      <button class=\"remove\">Remove custom-square from DOM</button>\n      <button class=\"move\">Move custom-square to new Dom</button>\n    </div>\n\n    <div class=\"other\"></div>\n\n    <iframe src=\"./iframe.html\" frameborder=\"0\" width=\"800px\" height=\"500px\"></iframe>\n\n  </body>\n</html>","date":"2023-05-12T10:49:20.041Z","updated":"2023-05-12T10:49:20.041Z","path":"demo/webcomponent/expanding-list/index.html","title":"","comments":1,"layout":"page","_id":"clhkizgy100263y0q8mf872de","content":"<!DOCTYPE html>\n<html>\n  <head>\n    <meta charset=\"utf-8\">\n    <title>Life cycle callbacks test</title>\n    <style>\n      custom-square {\n        margin: 20px;\n      }\n\n      .other {\n        /* position: absolute; */\n        top: 20%;\n        left: 50%;\n        width: 200px;\n        height: 200px;\n        background-color: #808080;\n      }\n    </style>\n    <script defer src=\"main.js\"></script>\n  </head>\n  <body>\n    <h1>Life cycle callbacks test</h1>\n\n    <div>\n      <button class=\"add\">Add custom-square to DOM</button>\n      <button class=\"update\">Update attributes</button>\n      <button class=\"remove\">Remove custom-square from DOM</button>\n      <button class=\"move\">Move custom-square to new Dom</button>\n    </div>\n\n    <div class=\"other\"></div>\n\n    <iframe src=\"./iframe.html\" frameborder=\"0\" width=\"800px\" height=\"500px\"></iframe>\n\n  </body>\n</html>","site":{"data":{}},"wordcount":256,"excerpt":"","more":"<!DOCTYPE html>\n<html>\n  <head>\n    <meta charset=\"utf-8\">\n    <title>Life cycle callbacks test</title>\n    <style>\n      custom-square {\n        margin: 20px;\n      }\n\n      .other {\n        /* position: absolute; */\n        top: 20%;\n        left: 50%;\n        width: 200px;\n        height: 200px;\n        background-color: #808080;\n      }\n    </style>\n    <script defer src=\"main.js\"></script>\n  </head>\n  <body>\n    <h1>Life cycle callbacks test</h1>\n\n    <div>\n      <button class=\"add\">Add custom-square to DOM</button>\n      <button class=\"update\">Update attributes</button>\n      <button class=\"remove\">Remove custom-square from DOM</button>\n      <button class=\"move\">Move custom-square to new Dom</button>\n    </div>\n\n    <div class=\"other\"></div>\n\n    <iframe src=\"./iframe.html\" frameborder=\"0\" width=\"800px\" height=\"500px\"></iframe>\n\n  </body>\n</html>"},{"_content":"<!DOCTYPE html>\n<html>\n  <head>\n    <meta charset=\"utf-8\">\n    <title>Life cycle callbacks test</title>\n    <style>\n    </style>\n    <script defer src=\"main.js\"></script>\n  </head>\n  <body>\n    <h1>00</h1>\n\n    <template id=\"child\">\n      <button>Child Button</button>\n    </template>\n\n    <template id=\"parent\">\n      <p>parent template</p>\n      <child-wc text=\"Btn\"></child-wc>\n    </template>\n\n    <parent-wc />\n\n  </body>\n</html>","source":"demo/webcomponent/parent-send-data-to-child/index.html","raw":"<!DOCTYPE html>\n<html>\n  <head>\n    <meta charset=\"utf-8\">\n    <title>Life cycle callbacks test</title>\n    <style>\n    </style>\n    <script defer src=\"main.js\"></script>\n  </head>\n  <body>\n    <h1>00</h1>\n\n    <template id=\"child\">\n      <button>Child Button</button>\n    </template>\n\n    <template id=\"parent\">\n      <p>parent template</p>\n      <child-wc text=\"Btn\"></child-wc>\n    </template>\n\n    <parent-wc />\n\n  </body>\n</html>","date":"2023-05-12T10:49:20.041Z","updated":"2023-05-12T10:49:20.041Z","path":"demo/webcomponent/parent-send-data-to-child/index.html","title":"","comments":1,"layout":"page","_id":"clhkizgy100283y0qgdwt0xpq","content":"<!DOCTYPE html>\n<html>\n  <head>\n    <meta charset=\"utf-8\">\n    <title>Life cycle callbacks test</title>\n    <style>\n    </style>\n    <script defer src=\"main.js\"></script>\n  </head>\n  <body>\n    <h1>00</h1>\n\n    <template id=\"child\">\n      <button>Child Button</button>\n    </template>\n\n    <template id=\"parent\">\n      <p>parent template</p>\n      <child-wc text=\"Btn\"></child-wc>\n    </template>\n\n    <parent-wc />\n\n  </body>\n</html>","site":{"data":{}},"wordcount":49,"excerpt":"","more":"<!DOCTYPE html>\n<html>\n  <head>\n    <meta charset=\"utf-8\">\n    <title>Life cycle callbacks test</title>\n    <style>\n    </style>\n    <script defer src=\"main.js\"></script>\n  </head>\n  <body>\n    <h1>00</h1>\n\n    <template id=\"child\">\n      <button>Child Button</button>\n    </template>\n\n    <template id=\"parent\">\n      <p>parent template</p>\n      <child-wc text=\"Btn\"></child-wc>\n    </template>\n\n    <parent-wc />\n\n  </body>\n</html>"},{"_content":"\nclass ParentWc extends HTMLElement {\n  constructor() {\n    super()\n\n    this.data = {\n      value: 'Parent instance value'\n    }\n\n    const template = document.getElementById('parent').content\n    const shadowRoot = this.attachShadow({mode: 'open'})\n    shadowRoot.appendChild(template.cloneNode(true))\n  }\n\n  sayHello(msg) {\n    console.log(msg, this.data)\n  }\n\n  connectedCallback() {\n    const child = this.shadowRoot.querySelector('child-wc')\n\n    // 1. 通过 DOM 属性传参\n    // child.setAttribute('text', 'Parent changed the Text')\n\n    // 2. 通过组件实例直接修改内部数据（目前主流的形式）\n    // console.log('??', child)\n\n    // 3. 事件监听\n    child.addEventListener('custom-event', ({ detail }) => {\n      console.log('事件触发 ', detail.value);\n   })\n  }\n}\n\nwindow.customElements.define('parent-wc', ParentWc)\n\n// childWc\nclass ChildWc extends HTMLElement {\n  constructor() {\n    super()\n\n    this.data = {\n      value: 'Child instance value'\n    }\n\n    Object.defineProperty(this.data, 'text', {\n      set: value => {\n        console.log('data text changed: ', value)\n      }\n    })\n\n    const template = document.getElementById('child').content\n    const shadowRoot = this.attachShadow({mode: 'open'})\n    shadowRoot.appendChild(template.cloneNode(true))\n  }\n\n  // 必须先申明需要监听的属性\n  static get observedAttributes() {\n    return ['text'];\n  }\n\n  connectedCallback() {\n    const event = new CustomEvent('custom-event', {\n      detail: {\n        value: 'child web component'\n      }\n    })\n    this.dispatchEvent(event)\n\n    const btn = this.shadowRoot.querySelector('button')\n\n    btn.addEventListener('click', () => {\n      // 获取父组件\n      this.getRootNode().host.sayHello('Hello :')\n    })\n  }\n\n  attributeChangedCallback(name, oldValue, newValue) {\n    console.log('name', name)\n    console.log('oldValue', oldValue)\n    console.log('newValue', newValue)\n  }\n}\nwindow.customElements.define('child-wc', ChildWc);\n","source":"demo/webcomponent/parent-send-data-to-child/main.js","raw":"\nclass ParentWc extends HTMLElement {\n  constructor() {\n    super()\n\n    this.data = {\n      value: 'Parent instance value'\n    }\n\n    const template = document.getElementById('parent').content\n    const shadowRoot = this.attachShadow({mode: 'open'})\n    shadowRoot.appendChild(template.cloneNode(true))\n  }\n\n  sayHello(msg) {\n    console.log(msg, this.data)\n  }\n\n  connectedCallback() {\n    const child = this.shadowRoot.querySelector('child-wc')\n\n    // 1. 通过 DOM 属性传参\n    // child.setAttribute('text', 'Parent changed the Text')\n\n    // 2. 通过组件实例直接修改内部数据（目前主流的形式）\n    // console.log('??', child)\n\n    // 3. 事件监听\n    child.addEventListener('custom-event', ({ detail }) => {\n      console.log('事件触发 ', detail.value);\n   })\n  }\n}\n\nwindow.customElements.define('parent-wc', ParentWc)\n\n// childWc\nclass ChildWc extends HTMLElement {\n  constructor() {\n    super()\n\n    this.data = {\n      value: 'Child instance value'\n    }\n\n    Object.defineProperty(this.data, 'text', {\n      set: value => {\n        console.log('data text changed: ', value)\n      }\n    })\n\n    const template = document.getElementById('child').content\n    const shadowRoot = this.attachShadow({mode: 'open'})\n    shadowRoot.appendChild(template.cloneNode(true))\n  }\n\n  // 必须先申明需要监听的属性\n  static get observedAttributes() {\n    return ['text'];\n  }\n\n  connectedCallback() {\n    const event = new CustomEvent('custom-event', {\n      detail: {\n        value: 'child web component'\n      }\n    })\n    this.dispatchEvent(event)\n\n    const btn = this.shadowRoot.querySelector('button')\n\n    btn.addEventListener('click', () => {\n      // 获取父组件\n      this.getRootNode().host.sayHello('Hello :')\n    })\n  }\n\n  attributeChangedCallback(name, oldValue, newValue) {\n    console.log('name', name)\n    console.log('oldValue', oldValue)\n    console.log('newValue', newValue)\n  }\n}\nwindow.customElements.define('child-wc', ChildWc);\n","date":"2023-05-12T10:49:20.042Z","updated":"2023-05-12T10:49:20.042Z","path":"demo/webcomponent/parent-send-data-to-child/main.js","layout":"false","title":"","comments":1,"_id":"clhkizgy2002a3y0q37z936y0","content":"\nclass ParentWc extends HTMLElement {\n  constructor() {\n    super()\n\n    this.data = {\n      value: 'Parent instance value'\n    }\n\n    const template = document.getElementById('parent').content\n    const shadowRoot = this.attachShadow({mode: 'open'})\n    shadowRoot.appendChild(template.cloneNode(true))\n  }\n\n  sayHello(msg) {\n    console.log(msg, this.data)\n  }\n\n  connectedCallback() {\n    const child = this.shadowRoot.querySelector('child-wc')\n\n    // 1. 通过 DOM 属性传参\n    // child.setAttribute('text', 'Parent changed the Text')\n\n    // 2. 通过组件实例直接修改内部数据（目前主流的形式）\n    // console.log('??', child)\n\n    // 3. 事件监听\n    child.addEventListener('custom-event', ({ detail }) => {\n      console.log('事件触发 ', detail.value);\n   })\n  }\n}\n\nwindow.customElements.define('parent-wc', ParentWc)\n\n// childWc\nclass ChildWc extends HTMLElement {\n  constructor() {\n    super()\n\n    this.data = {\n      value: 'Child instance value'\n    }\n\n    Object.defineProperty(this.data, 'text', {\n      set: value => {\n        console.log('data text changed: ', value)\n      }\n    })\n\n    const template = document.getElementById('child').content\n    const shadowRoot = this.attachShadow({mode: 'open'})\n    shadowRoot.appendChild(template.cloneNode(true))\n  }\n\n  // 必须先申明需要监听的属性\n  static get observedAttributes() {\n    return ['text'];\n  }\n\n  connectedCallback() {\n    const event = new CustomEvent('custom-event', {\n      detail: {\n        value: 'child web component'\n      }\n    })\n    this.dispatchEvent(event)\n\n    const btn = this.shadowRoot.querySelector('button')\n\n    btn.addEventListener('click', () => {\n      // 获取父组件\n      this.getRootNode().host.sayHello('Hello :')\n    })\n  }\n\n  attributeChangedCallback(name, oldValue, newValue) {\n    console.log('name', name)\n    console.log('oldValue', oldValue)\n    console.log('newValue', newValue)\n  }\n}\nwindow.customElements.define('child-wc', ChildWc);\n","site":{"data":{}},"wordcount":1466,"excerpt":"","more":"\nclass ParentWc extends HTMLElement {\n  constructor() {\n    super()\n\n    this.data = {\n      value: 'Parent instance value'\n    }\n\n    const template = document.getElementById('parent').content\n    const shadowRoot = this.attachShadow({mode: 'open'})\n    shadowRoot.appendChild(template.cloneNode(true))\n  }\n\n  sayHello(msg) {\n    console.log(msg, this.data)\n  }\n\n  connectedCallback() {\n    const child = this.shadowRoot.querySelector('child-wc')\n\n    // 1. 通过 DOM 属性传参\n    // child.setAttribute('text', 'Parent changed the Text')\n\n    // 2. 通过组件实例直接修改内部数据（目前主流的形式）\n    // console.log('??', child)\n\n    // 3. 事件监听\n    child.addEventListener('custom-event', ({ detail }) => {\n      console.log('事件触发 ', detail.value);\n   })\n  }\n}\n\nwindow.customElements.define('parent-wc', ParentWc)\n\n// childWc\nclass ChildWc extends HTMLElement {\n  constructor() {\n    super()\n\n    this.data = {\n      value: 'Child instance value'\n    }\n\n    Object.defineProperty(this.data, 'text', {\n      set: value => {\n        console.log('data text changed: ', value)\n      }\n    })\n\n    const template = document.getElementById('child').content\n    const shadowRoot = this.attachShadow({mode: 'open'})\n    shadowRoot.appendChild(template.cloneNode(true))\n  }\n\n  // 必须先申明需要监听的属性\n  static get observedAttributes() {\n    return ['text'];\n  }\n\n  connectedCallback() {\n    const event = new CustomEvent('custom-event', {\n      detail: {\n        value: 'child web component'\n      }\n    })\n    this.dispatchEvent(event)\n\n    const btn = this.shadowRoot.querySelector('button')\n\n    btn.addEventListener('click', () => {\n      // 获取父组件\n      this.getRootNode().host.sayHello('Hello :')\n    })\n  }\n\n  attributeChangedCallback(name, oldValue, newValue) {\n    console.log('name', name)\n    console.log('oldValue', oldValue)\n    console.log('newValue', newValue)\n  }\n}\nwindow.customElements.define('child-wc', ChildWc);\n"},{"_content":"<!DOCTYPE html>\n<html lang=\"en\">\n<head>\n  <meta charset=\"UTF-8\">\n  <!-- <meta http-equiv=\"X-UA-Compatible\" content=\"IE=edge\"> -->\n  <!-- <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\"> -->\n  <title>Document</title>\n  <script src=\"main.js\"></script>\n</head>\n<body>\n  <div>\n    <h1>Pop-up info widget - web components</h1>\n\n    <form>\n      <div>\n        <label for=\"cvc\">Enter your CVC <popup-info img=\"img/avatar.jpg\" data-text=\"Your card validation code (CVC) is an extra security feature — it is the last 3 or 4 numbers on the back of your card.\"></popup-info></label>\n        <input type=\"text\" id=\"cvc\">\n      </div>\n    </form>\n  </div>\n</body>\n</html>","source":"demo/webcomponent/popup-info-box/index.html","raw":"<!DOCTYPE html>\n<html lang=\"en\">\n<head>\n  <meta charset=\"UTF-8\">\n  <!-- <meta http-equiv=\"X-UA-Compatible\" content=\"IE=edge\"> -->\n  <!-- <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\"> -->\n  <title>Document</title>\n  <script src=\"main.js\"></script>\n</head>\n<body>\n  <div>\n    <h1>Pop-up info widget - web components</h1>\n\n    <form>\n      <div>\n        <label for=\"cvc\">Enter your CVC <popup-info img=\"img/avatar.jpg\" data-text=\"Your card validation code (CVC) is an extra security feature — it is the last 3 or 4 numbers on the back of your card.\"></popup-info></label>\n        <input type=\"text\" id=\"cvc\">\n      </div>\n    </form>\n  </div>\n</body>\n</html>","date":"2023-05-12T10:49:20.042Z","updated":"2023-05-12T10:49:20.042Z","path":"demo/webcomponent/popup-info-box/index.html","title":"","comments":1,"layout":"page","_id":"clhkizgy2002c3y0qgrtw39w6","content":"<!DOCTYPE html>\n<html lang=\"en\">\n<head>\n  <meta charset=\"UTF-8\">\n  <!-- <meta http-equiv=\"X-UA-Compatible\" content=\"IE=edge\"> -->\n  <!-- <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\"> -->\n  <title>Document</title>\n  <script src=\"main.js\"></script>\n</head>\n<body>\n  <div>\n    <h1>Pop-up info widget - web components</h1>\n\n    <form>\n      <div>\n        <label for=\"cvc\">Enter your CVC <popup-info img=\"img/avatar.jpg\" data-text=\"Your card validation code (CVC) is an extra security feature — it is the last 3 or 4 numbers on the back of your card.\"></popup-info></label>\n        <input type=\"text\" id=\"cvc\">\n      </div>\n    </form>\n  </div>\n</body>\n</html>","site":{"data":{}},"wordcount":50,"excerpt":"","more":"<!DOCTYPE html>\n<html lang=\"en\">\n<head>\n  <meta charset=\"UTF-8\">\n  <!-- <meta http-equiv=\"X-UA-Compatible\" content=\"IE=edge\"> -->\n  <!-- <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\"> -->\n  <title>Document</title>\n  <script src=\"main.js\"></script>\n</head>\n<body>\n  <div>\n    <h1>Pop-up info widget - web components</h1>\n\n    <form>\n      <div>\n        <label for=\"cvc\">Enter your CVC <popup-info img=\"img/avatar.jpg\" data-text=\"Your card validation code (CVC) is an extra security feature — it is the last 3 or 4 numbers on the back of your card.\"></popup-info></label>\n        <input type=\"text\" id=\"cvc\">\n      </div>\n    </form>\n  </div>\n</body>\n</html>"},{"_content":"// Create a class for the element\nclass PopUpInfo extends HTMLElement {\n  constructor() {\n    // Always call super first in constructor\n    super();\n\n\n  }\n\n  connectedCallback() {\n    /**\n     * @name connectedCallback函数\n     * @desc 当 custom element 首次被插入文档 DOM 时，被调用。\n     */\n\n    // Create a shadow root\n    const shadow = this.attachShadow({mode: 'open'});\n\n    // Create spans\n    const wrapper = document.createElement('span');\n    wrapper.setAttribute('class', 'wrapper');\n\n    const icon = document.createElement('span');\n    icon.setAttribute('class', 'icon');\n    icon.setAttribute('tabindex', 0);\n\n    const info = document.createElement('span');\n    info.setAttribute('class', 'info');\n\n    /**\n     * @name 🔥🔥🔥 我们想要获取元素上的属性，必须放在 connectedCallback 函数内去获取\n     * @desc 因为只有元素插入到了 dom 中，才能获取到\n     */\n    const text = this.getAttribute('data-text');\n    info.textContent = text;\n\n    // Insert icon\n    let imgUrl;\n    if(this.hasAttribute('img')) {\n      imgUrl = this.getAttribute('img');\n    } else {\n      // imgUrl = './img/avatar.jpg';\n    }\n\n    const img = document.createElement('img');\n    img.src = imgUrl;\n    icon.appendChild(img);\n\n    // Create some CSS to apply to the shadow dom\n    const style = document.createElement('style');\n    console.log(style.isConnected);\n\n    style.textContent = `\n      .wrapper {\n        position: relative;\n      }\n\n      .info {\n        font-size: 0.8rem;\n        width: 200px;\n        display: inline-block;\n        border: 1px solid black;\n        padding: 10px;\n        background: white;\n        border-radius: 10px;\n        opacity: 0;\n        transition: 0.6s all;\n        position: absolute;\n        bottom: 20px;\n        left: 10px;\n        z-index: 3;\n      }\n\n      img {\n        width: 1.2rem;\n      }\n\n      .icon:hover + .info, .icon:focus + .info {\n        opacity: 1;\n      }\n    `;\n\n    // Attach the created elements to the shadow dom\n    shadow.appendChild(style);\n    // 一开始这个style.isConnected 为false，把他添加给shadow Root后 isConnected就为true了\n    console.log(style.isConnected);\n    shadow.appendChild(wrapper);\n    wrapper.appendChild(icon);\n    wrapper.appendChild(info);\n  }\n}\n\n// Define the new element\ncustomElements.define('popup-info', PopUpInfo);\n","source":"demo/webcomponent/popup-info-box/main.js","raw":"// Create a class for the element\nclass PopUpInfo extends HTMLElement {\n  constructor() {\n    // Always call super first in constructor\n    super();\n\n\n  }\n\n  connectedCallback() {\n    /**\n     * @name connectedCallback函数\n     * @desc 当 custom element 首次被插入文档 DOM 时，被调用。\n     */\n\n    // Create a shadow root\n    const shadow = this.attachShadow({mode: 'open'});\n\n    // Create spans\n    const wrapper = document.createElement('span');\n    wrapper.setAttribute('class', 'wrapper');\n\n    const icon = document.createElement('span');\n    icon.setAttribute('class', 'icon');\n    icon.setAttribute('tabindex', 0);\n\n    const info = document.createElement('span');\n    info.setAttribute('class', 'info');\n\n    /**\n     * @name 🔥🔥🔥 我们想要获取元素上的属性，必须放在 connectedCallback 函数内去获取\n     * @desc 因为只有元素插入到了 dom 中，才能获取到\n     */\n    const text = this.getAttribute('data-text');\n    info.textContent = text;\n\n    // Insert icon\n    let imgUrl;\n    if(this.hasAttribute('img')) {\n      imgUrl = this.getAttribute('img');\n    } else {\n      // imgUrl = './img/avatar.jpg';\n    }\n\n    const img = document.createElement('img');\n    img.src = imgUrl;\n    icon.appendChild(img);\n\n    // Create some CSS to apply to the shadow dom\n    const style = document.createElement('style');\n    console.log(style.isConnected);\n\n    style.textContent = `\n      .wrapper {\n        position: relative;\n      }\n\n      .info {\n        font-size: 0.8rem;\n        width: 200px;\n        display: inline-block;\n        border: 1px solid black;\n        padding: 10px;\n        background: white;\n        border-radius: 10px;\n        opacity: 0;\n        transition: 0.6s all;\n        position: absolute;\n        bottom: 20px;\n        left: 10px;\n        z-index: 3;\n      }\n\n      img {\n        width: 1.2rem;\n      }\n\n      .icon:hover + .info, .icon:focus + .info {\n        opacity: 1;\n      }\n    `;\n\n    // Attach the created elements to the shadow dom\n    shadow.appendChild(style);\n    // 一开始这个style.isConnected 为false，把他添加给shadow Root后 isConnected就为true了\n    console.log(style.isConnected);\n    shadow.appendChild(wrapper);\n    wrapper.appendChild(icon);\n    wrapper.appendChild(info);\n  }\n}\n\n// Define the new element\ncustomElements.define('popup-info', PopUpInfo);\n","date":"2023-05-12T10:49:20.043Z","updated":"2023-05-12T10:49:20.043Z","path":"demo/webcomponent/popup-info-box/main.js","layout":"false","title":"","comments":1,"_id":"clhkizgy3002d3y0q3vfo1c7t","content":"// Create a class for the element\nclass PopUpInfo extends HTMLElement {\n  constructor() {\n    // Always call super first in constructor\n    super();\n\n\n  }\n\n  connectedCallback() {\n    /**\n     * @name connectedCallback函数\n     * @desc 当 custom element 首次被插入文档 DOM 时，被调用。\n     */\n\n    // Create a shadow root\n    const shadow = this.attachShadow({mode: 'open'});\n\n    // Create spans\n    const wrapper = document.createElement('span');\n    wrapper.setAttribute('class', 'wrapper');\n\n    const icon = document.createElement('span');\n    icon.setAttribute('class', 'icon');\n    icon.setAttribute('tabindex', 0);\n\n    const info = document.createElement('span');\n    info.setAttribute('class', 'info');\n\n    /**\n     * @name 🔥🔥🔥 我们想要获取元素上的属性，必须放在 connectedCallback 函数内去获取\n     * @desc 因为只有元素插入到了 dom 中，才能获取到\n     */\n    const text = this.getAttribute('data-text');\n    info.textContent = text;\n\n    // Insert icon\n    let imgUrl;\n    if(this.hasAttribute('img')) {\n      imgUrl = this.getAttribute('img');\n    } else {\n      // imgUrl = './img/avatar.jpg';\n    }\n\n    const img = document.createElement('img');\n    img.src = imgUrl;\n    icon.appendChild(img);\n\n    // Create some CSS to apply to the shadow dom\n    const style = document.createElement('style');\n    console.log(style.isConnected);\n\n    style.textContent = `\n      .wrapper {\n        position: relative;\n      }\n\n      .info {\n        font-size: 0.8rem;\n        width: 200px;\n        display: inline-block;\n        border: 1px solid black;\n        padding: 10px;\n        background: white;\n        border-radius: 10px;\n        opacity: 0;\n        transition: 0.6s all;\n        position: absolute;\n        bottom: 20px;\n        left: 10px;\n        z-index: 3;\n      }\n\n      img {\n        width: 1.2rem;\n      }\n\n      .icon:hover + .info, .icon:focus + .info {\n        opacity: 1;\n      }\n    `;\n\n    // Attach the created elements to the shadow dom\n    shadow.appendChild(style);\n    // 一开始这个style.isConnected 为false，把他添加给shadow Root后 isConnected就为true了\n    console.log(style.isConnected);\n    shadow.appendChild(wrapper);\n    wrapper.appendChild(icon);\n    wrapper.appendChild(info);\n  }\n}\n\n// Define the new element\ncustomElements.define('popup-info', PopUpInfo);\n","site":{"data":{}},"wordcount":1628,"excerpt":"","more":"// Create a class for the element\nclass PopUpInfo extends HTMLElement {\n  constructor() {\n    // Always call super first in constructor\n    super();\n\n\n  }\n\n  connectedCallback() {\n    /**\n     * @name connectedCallback函数\n     * @desc 当 custom element 首次被插入文档 DOM 时，被调用。\n     */\n\n    // Create a shadow root\n    const shadow = this.attachShadow({mode: 'open'});\n\n    // Create spans\n    const wrapper = document.createElement('span');\n    wrapper.setAttribute('class', 'wrapper');\n\n    const icon = document.createElement('span');\n    icon.setAttribute('class', 'icon');\n    icon.setAttribute('tabindex', 0);\n\n    const info = document.createElement('span');\n    info.setAttribute('class', 'info');\n\n    /**\n     * @name 🔥🔥🔥 我们想要获取元素上的属性，必须放在 connectedCallback 函数内去获取\n     * @desc 因为只有元素插入到了 dom 中，才能获取到\n     */\n    const text = this.getAttribute('data-text');\n    info.textContent = text;\n\n    // Insert icon\n    let imgUrl;\n    if(this.hasAttribute('img')) {\n      imgUrl = this.getAttribute('img');\n    } else {\n      // imgUrl = './img/avatar.jpg';\n    }\n\n    const img = document.createElement('img');\n    img.src = imgUrl;\n    icon.appendChild(img);\n\n    // Create some CSS to apply to the shadow dom\n    const style = document.createElement('style');\n    console.log(style.isConnected);\n\n    style.textContent = `\n      .wrapper {\n        position: relative;\n      }\n\n      .info {\n        font-size: 0.8rem;\n        width: 200px;\n        display: inline-block;\n        border: 1px solid black;\n        padding: 10px;\n        background: white;\n        border-radius: 10px;\n        opacity: 0;\n        transition: 0.6s all;\n        position: absolute;\n        bottom: 20px;\n        left: 10px;\n        z-index: 3;\n      }\n\n      img {\n        width: 1.2rem;\n      }\n\n      .icon:hover + .info, .icon:focus + .info {\n        opacity: 1;\n      }\n    `;\n\n    // Attach the created elements to the shadow dom\n    shadow.appendChild(style);\n    // 一开始这个style.isConnected 为false，把他添加给shadow Root后 isConnected就为true了\n    console.log(style.isConnected);\n    shadow.appendChild(wrapper);\n    wrapper.appendChild(icon);\n    wrapper.appendChild(info);\n  }\n}\n\n// Define the new element\ncustomElements.define('popup-info', PopUpInfo);\n"},{"_content":"<!DOCTYPE html>\n<html lang=\"en\">\n<head>\n  <meta charset=\"UTF-8\">\n  <meta http-equiv=\"X-UA-Compatible\" content=\"IE=edge\">\n  <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n  <title>Document</title>\n  <script src=\"https://fastly.jsdelivr.net/npm/quarkd@latest/umd/index.js\"></script>\n  <style>\n  </style>\n</head>\n<body>\n  <div>\n    <h1>Quark Design</h1>\n\n    <quark-button plain type=\"primary\">默认按钮</quark-button>\n    <quark-button type=\"danger\" loading>danger</quark-button>\n  </div>\n</body>\n</html>","source":"demo/webcomponent/quark-design/index.html","raw":"<!DOCTYPE html>\n<html lang=\"en\">\n<head>\n  <meta charset=\"UTF-8\">\n  <meta http-equiv=\"X-UA-Compatible\" content=\"IE=edge\">\n  <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n  <title>Document</title>\n  <script src=\"https://fastly.jsdelivr.net/npm/quarkd@latest/umd/index.js\"></script>\n  <style>\n  </style>\n</head>\n<body>\n  <div>\n    <h1>Quark Design</h1>\n\n    <quark-button plain type=\"primary\">默认按钮</quark-button>\n    <quark-button type=\"danger\" loading>danger</quark-button>\n  </div>\n</body>\n</html>","date":"2023-05-12T10:49:20.043Z","updated":"2023-05-12T10:49:20.043Z","path":"demo/webcomponent/quark-design/index.html","title":"","comments":1,"layout":"page","_id":"clhkizgy3002g3y0qb3dfdsbt","content":"<!DOCTYPE html>\n<html lang=\"en\">\n<head>\n  <meta charset=\"UTF-8\">\n  <meta http-equiv=\"X-UA-Compatible\" content=\"IE=edge\">\n  <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n  <title>Document</title>\n  <script src=\"https://fastly.jsdelivr.net/npm/quarkd@latest/umd/index.js\"></script>\n  <style>\n  </style>\n</head>\n<body>\n  <div>\n    <h1>Quark Design</h1>\n\n    <quark-button plain type=\"primary\">默认按钮</quark-button>\n    <quark-button type=\"danger\" loading>danger</quark-button>\n  </div>\n</body>\n</html>","site":{"data":{}},"wordcount":29,"excerpt":"","more":"<!DOCTYPE html>\n<html lang=\"en\">\n<head>\n  <meta charset=\"UTF-8\">\n  <meta http-equiv=\"X-UA-Compatible\" content=\"IE=edge\">\n  <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n  <title>Document</title>\n  <script src=\"https://fastly.jsdelivr.net/npm/quarkd@latest/umd/index.js\"></script>\n  <style>\n  </style>\n</head>\n<body>\n  <div>\n    <h1>Quark Design</h1>\n\n    <quark-button plain type=\"primary\">默认按钮</quark-button>\n    <quark-button type=\"danger\" loading>danger</quark-button>\n  </div>\n</body>\n</html>"},{"_content":"<!DOCTYPE html>\n<html lang=\"en\">\n<head>\n  <meta charset=\"UTF-8\">\n  <meta http-equiv=\"X-UA-Compatible\" content=\"IE=edge\">\n  <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n  <title>Document</title>\n  <script src=\"main.js\"></script>\n</head>\n<body>\n  <h1>template & slot</h1>\n\n  <template id=\"my-paragraph\">\n    <!-- 默认插槽 -->\n    <slot name=\"title\">\n      <h1>Default Title</h1>\n    </slot>\n\n    <slot>default slot</slot>\n    <p>My paragraph</p>\n  </template>\n\n  <my-paragraph>\n    <!-- 使用插槽 -->\n    <h1 slot=\"title\">Slot title</h1>\n  </my-paragraph>\n\n  <hr>\n</body>\n</html>","source":"demo/webcomponent/template&slot/index.html","raw":"<!DOCTYPE html>\n<html lang=\"en\">\n<head>\n  <meta charset=\"UTF-8\">\n  <meta http-equiv=\"X-UA-Compatible\" content=\"IE=edge\">\n  <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n  <title>Document</title>\n  <script src=\"main.js\"></script>\n</head>\n<body>\n  <h1>template & slot</h1>\n\n  <template id=\"my-paragraph\">\n    <!-- 默认插槽 -->\n    <slot name=\"title\">\n      <h1>Default Title</h1>\n    </slot>\n\n    <slot>default slot</slot>\n    <p>My paragraph</p>\n  </template>\n\n  <my-paragraph>\n    <!-- 使用插槽 -->\n    <h1 slot=\"title\">Slot title</h1>\n  </my-paragraph>\n\n  <hr>\n</body>\n</html>","date":"2023-05-12T10:49:20.043Z","updated":"2023-05-12T10:49:20.043Z","path":"demo/webcomponent/template&slot/index.html","title":"","comments":1,"layout":"page","_id":"clhkizgy4002h3y0q5f684p5z","content":"<!DOCTYPE html>\n<html lang=\"en\">\n<head>\n  <meta charset=\"UTF-8\">\n  <meta http-equiv=\"X-UA-Compatible\" content=\"IE=edge\">\n  <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n  <title>Document</title>\n  <script src=\"main.js\"></script>\n</head>\n<body>\n  <h1>template & slot</h1>\n\n  <template id=\"my-paragraph\">\n    <!-- 默认插槽 -->\n    <slot name=\"title\">\n      <h1>Default Title</h1>\n    </slot>\n\n    <slot>default slot</slot>\n    <p>My paragraph</p>\n  </template>\n\n  <my-paragraph>\n    <!-- 使用插槽 -->\n    <h1 slot=\"title\">Slot title</h1>\n  </my-paragraph>\n\n  <hr>\n</body>\n</html>","site":{"data":{}},"wordcount":64,"excerpt":"","more":"<!DOCTYPE html>\n<html lang=\"en\">\n<head>\n  <meta charset=\"UTF-8\">\n  <meta http-equiv=\"X-UA-Compatible\" content=\"IE=edge\">\n  <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n  <title>Document</title>\n  <script src=\"main.js\"></script>\n</head>\n<body>\n  <h1>template & slot</h1>\n\n  <template id=\"my-paragraph\">\n    <!-- 默认插槽 -->\n    <slot name=\"title\">\n      <h1>Default Title</h1>\n    </slot>\n\n    <slot>default slot</slot>\n    <p>My paragraph</p>\n  </template>\n\n  <my-paragraph>\n    <!-- 使用插槽 -->\n    <h1 slot=\"title\">Slot title</h1>\n  </my-paragraph>\n\n  <hr>\n</body>\n</html>"},{"_content":"\n// 单独使用\n// window.onload = function() {\n//   let template = document.getElementById('my-paragraph');\n//   let templateContent = template.content;\n//   document.body.appendChild(templateContent);\n// }\n\n// 在 Web Components 中使用模板\n\nclass MyParagraph extends HTMLElement {\n  constructor() {\n    super()\n  }\n\n  connectedCallback() {\n    let template = document.getElementById('my-paragraph');\n    let templateContent = template.content;\n\n    this.attachShadow({ mode: 'open' })\n      .appendChild(templateContent.cloneNode(true))\n  }\n}\n\ncustomElements.define('my-paragraph', MyParagraph)\n","source":"demo/webcomponent/template&slot/main.js","raw":"\n// 单独使用\n// window.onload = function() {\n//   let template = document.getElementById('my-paragraph');\n//   let templateContent = template.content;\n//   document.body.appendChild(templateContent);\n// }\n\n// 在 Web Components 中使用模板\n\nclass MyParagraph extends HTMLElement {\n  constructor() {\n    super()\n  }\n\n  connectedCallback() {\n    let template = document.getElementById('my-paragraph');\n    let templateContent = template.content;\n\n    this.attachShadow({ mode: 'open' })\n      .appendChild(templateContent.cloneNode(true))\n  }\n}\n\ncustomElements.define('my-paragraph', MyParagraph)\n","date":"2023-05-12T10:49:20.043Z","updated":"2023-05-12T10:49:20.043Z","path":"demo/webcomponent/template&slot/main.js","layout":"false","title":"","comments":1,"_id":"clhkizgy4002j3y0q2530c493","content":"\n// 单独使用\n// window.onload = function() {\n//   let template = document.getElementById('my-paragraph');\n//   let templateContent = template.content;\n//   document.body.appendChild(templateContent);\n// }\n\n// 在 Web Components 中使用模板\n\nclass MyParagraph extends HTMLElement {\n  constructor() {\n    super()\n  }\n\n  connectedCallback() {\n    let template = document.getElementById('my-paragraph');\n    let templateContent = template.content;\n\n    this.attachShadow({ mode: 'open' })\n      .appendChild(templateContent.cloneNode(true))\n  }\n}\n\ncustomElements.define('my-paragraph', MyParagraph)\n","site":{"data":{}},"wordcount":487,"excerpt":"","more":"\n// 单独使用\n// window.onload = function() {\n//   let template = document.getElementById('my-paragraph');\n//   let templateContent = template.content;\n//   document.body.appendChild(templateContent);\n// }\n\n// 在 Web Components 中使用模板\n\nclass MyParagraph extends HTMLElement {\n  constructor() {\n    super()\n  }\n\n  connectedCallback() {\n    let template = document.getElementById('my-paragraph');\n    let templateContent = template.content;\n\n    this.attachShadow({ mode: 'open' })\n      .appendChild(templateContent.cloneNode(true))\n  }\n}\n\ncustomElements.define('my-paragraph', MyParagraph)\n"},{"_content":"class Person {\n  sayName() {\n    alert(this.name)\n  }\n}\n","source":"demo/2023面试准备/demo/module/babel.js","raw":"class Person {\n  sayName() {\n    alert(this.name)\n  }\n}\n","date":"2023-05-12T10:49:20.021Z","updated":"2023-05-12T10:49:20.021Z","path":"demo/2023面试准备/demo/module/babel.js","layout":"false","title":"","comments":1,"_id":"clhkizgy4002l3y0q42mo50tq","content":"class Person {\n  sayName() {\n    alert(this.name)\n  }\n}\n","site":{"data":{}},"wordcount":40,"excerpt":"","more":"class Person {\n  sayName() {\n    alert(this.name)\n  }\n}\n"},{"_content":"let cat = 'is caaat...';\n","source":"demo/2023面试准备/demo/module/compiled.js","raw":"let cat = 'is caaat...';\n","date":"2023-05-12T10:49:20.021Z","updated":"2023-05-12T10:49:20.021Z","path":"demo/2023面试准备/demo/module/compiled.js","layout":"false","title":"","comments":1,"_id":"clhkizgy4002m3y0q0uf7chg0","content":"let cat = 'is caaat...';\n","site":{"data":{}},"wordcount":20,"excerpt":"","more":"let cat = 'is caaat...';\n"},{"_content":"<!DOCTYPE html>\n<html lang=\"en\">\n<head>\n  <meta charset=\"UTF-8\">\n  <meta http-equiv=\"X-UA-Compatible\" content=\"IE=edge\">\n  <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n  <title>Document</title>\n</head>\n<body>\n  \n  <script src=\"./main.js\" type=\"module\"></script>\n</body>\n</html>","source":"demo/2023面试准备/demo/module/index.html","raw":"<!DOCTYPE html>\n<html lang=\"en\">\n<head>\n  <meta charset=\"UTF-8\">\n  <meta http-equiv=\"X-UA-Compatible\" content=\"IE=edge\">\n  <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n  <title>Document</title>\n</head>\n<body>\n  \n  <script src=\"./main.js\" type=\"module\"></script>\n</body>\n</html>","date":"2023-05-12T10:49:20.021Z","updated":"2023-05-12T10:49:20.021Z","path":"demo/2023面试准备/demo/module/index.html","title":"","comments":1,"layout":"page","_id":"clhkizgy5002o3y0q5thnhtco","content":"<!DOCTYPE html>\n<html lang=\"en\">\n<head>\n  <meta charset=\"UTF-8\">\n  <meta http-equiv=\"X-UA-Compatible\" content=\"IE=edge\">\n  <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n  <title>Document</title>\n</head>\n<body>\n  \n  <script src=\"./main.js\" type=\"module\"></script>\n</body>\n</html>","site":{"data":{}},"wordcount":8,"excerpt":"","more":"<!DOCTYPE html>\n<html lang=\"en\">\n<head>\n  <meta charset=\"UTF-8\">\n  <meta http-equiv=\"X-UA-Compatible\" content=\"IE=edge\">\n  <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n  <title>Document</title>\n</head>\n<body>\n  \n  <script src=\"./main.js\" type=\"module\"></script>\n</body>\n</html>"},{"_content":"export let count = 3\n\nexport function incCount() {\n  count++\n\n  return true\n}","source":"demo/2023面试准备/demo/module/lib.js","raw":"export let count = 3\n\nexport function incCount() {\n  count++\n\n  return true\n}","date":"2023-05-12T10:49:20.022Z","updated":"2023-05-12T10:49:20.022Z","path":"demo/2023面试准备/demo/module/lib.js","layout":"false","title":"","comments":1,"_id":"clhkizgy5002p3y0qfagacaka","content":"export let count = 3\n\nexport function incCount() {\n  count++\n\n  return true\n}","site":{"data":{}},"wordcount":59,"excerpt":"","more":"export let count = 3\n\nexport function incCount() {\n  count++\n\n  return true\n}"},{"_content":"import { count, incCount } from './lib.js'\n\nincCount()\n\nconsole.log(count)\n","source":"demo/2023面试准备/demo/module/main.js","raw":"import { count, incCount } from './lib.js'\n\nincCount()\n\nconsole.log(count)\n","date":"2023-05-12T10:49:20.022Z","updated":"2023-05-12T10:49:20.022Z","path":"demo/2023面试准备/demo/module/main.js","layout":"false","title":"","comments":1,"_id":"clhkizgy5002q3y0q7g1re5ig","content":"import { count, incCount } from './lib.js'\n\nincCount()\n\nconsole.log(count)\n","site":{"data":{}},"wordcount":64,"excerpt":"","more":"import { count, incCount } from './lib.js'\n\nincCount()\n\nconsole.log(count)\n"},{"_content":"module.exports = function(params) {\n\n  console.log('params', params)\n  return {\n    visitor: {}\n  }\n}","source":"demo/2023面试准备/demo/module/myPlugin.js","raw":"module.exports = function(params) {\n\n  console.log('params', params)\n  return {\n    visitor: {}\n  }\n}","date":"2023-05-12T10:49:20.022Z","updated":"2023-05-12T10:49:20.022Z","path":"demo/2023面试准备/demo/module/myPlugin.js","layout":"false","title":"","comments":1,"_id":"clhkizgy5002r3y0qe3s26bgm","content":"module.exports = function(params) {\n\n  console.log('params', params)\n  return {\n    visitor: {}\n  }\n}","site":{"data":{}},"wordcount":79,"excerpt":"","more":"module.exports = function(params) {\n\n  console.log('params', params)\n  return {\n    visitor: {}\n  }\n}"},{"_content":"{\n  \"name\": \"module\",\n  \"version\": \"1.0.0\",\n  \"description\": \"\",\n  \"main\": \"main.js\",\n  \"scripts\": {\n    \"dev\": \"node main.js\"\n  },\n  \"type\": \"module\",\n  \"keywords\": [],\n  \"author\": \"\",\n  \"license\": \"ISC\",\n  \"devDependencies\": {\n    \"babel-cli\": \"^6.26.0\",\n    \"babel-core\": \"^6.26.3\",\n    \"babel-plugin-transform-runtime\": \"^6.23.0\",\n    \"babel-preset-env\": \"^1.7.0\",\n    \"babel-runtime\": \"^6.26.0\"\n  }\n}\n","source":"demo/2023面试准备/demo/module/package.json","raw":"{\n  \"name\": \"module\",\n  \"version\": \"1.0.0\",\n  \"description\": \"\",\n  \"main\": \"main.js\",\n  \"scripts\": {\n    \"dev\": \"node main.js\"\n  },\n  \"type\": \"module\",\n  \"keywords\": [],\n  \"author\": \"\",\n  \"license\": \"ISC\",\n  \"devDependencies\": {\n    \"babel-cli\": \"^6.26.0\",\n    \"babel-core\": \"^6.26.3\",\n    \"babel-plugin-transform-runtime\": \"^6.23.0\",\n    \"babel-preset-env\": \"^1.7.0\",\n    \"babel-runtime\": \"^6.26.0\"\n  }\n}\n","date":"2023-05-12T10:49:20.024Z","updated":"2023-05-12T10:49:20.024Z","path":"demo/2023面试准备/demo/module/package.json","layout":"false","title":"","comments":1,"_id":"clhkizgy5002s3y0q5clk0qks","content":"{\"name\":\"module\",\"version\":\"1.0.0\",\"description\":\"\",\"main\":\"main.js\",\"scripts\":{\"dev\":\"node main.js\"},\"type\":\"module\",\"keywords\":[],\"author\":\"\",\"license\":\"ISC\",\"devDependencies\":{\"babel-cli\":\"^6.26.0\",\"babel-core\":\"^6.26.3\",\"babel-plugin-transform-runtime\":\"^6.23.0\",\"babel-preset-env\":\"^1.7.0\",\"babel-runtime\":\"^6.26.0\"}}","site":{"data":{}},"wordcount":321,"excerpt":"","more":"{\"name\":\"module\",\"version\":\"1.0.0\",\"description\":\"\",\"main\":\"main.js\",\"scripts\":{\"dev\":\"node main.js\"},\"type\":\"module\",\"keywords\":[],\"author\":\"\",\"license\":\"ISC\",\"devDependencies\":{\"babel-cli\":\"^6.26.0\",\"babel-core\":\"^6.26.3\",\"babel-plugin-transform-runtime\":\"^6.23.0\",\"babel-preset-env\":\"^1.7.0\",\"babel-runtime\":\"^6.26.0\"}}"},{"_content":"const dog = 'is dog'","source":"demo/2023面试准备/demo/module/plugin-test.js","raw":"const dog = 'is dog'","date":"2023-05-12T10:49:20.024Z","updated":"2023-05-12T10:49:20.024Z","path":"demo/2023面试准备/demo/module/plugin-test.js","layout":"false","title":"","comments":1,"_id":"clhkizgy6002t3y0qdrr59n38","content":"const dog = 'is dog'","site":{"data":{}},"wordcount":16,"excerpt":"","more":"const dog = 'is dog'"},{"_content":"module.exports = function({ types: t }) {\n  return {\n    visitor: {\n      Identifier(path, state) {\n\n        // console.log('🔥', path.node)\n        // console.log('🔥', path.parent)\n        path.node.name = 'cat'\n      },\n      VariableDeclaration(path, state) {\n\n        // console.log('🔥', path.node)\n        if (path.node.kind === 'const') {\n          path.node.kind = 'let'\n        }\n      },\n      Literal(path, state) {\n        console.log('🔥', state.opts)\n        path.node.value = 'is caaat...'\n      }\n    }\n  }\n}\n","source":"demo/2023面试准备/demo/module/plugin.js","raw":"module.exports = function({ types: t }) {\n  return {\n    visitor: {\n      Identifier(path, state) {\n\n        // console.log('🔥', path.node)\n        // console.log('🔥', path.parent)\n        path.node.name = 'cat'\n      },\n      VariableDeclaration(path, state) {\n\n        // console.log('🔥', path.node)\n        if (path.node.kind === 'const') {\n          path.node.kind = 'let'\n        }\n      },\n      Literal(path, state) {\n        console.log('🔥', state.opts)\n        path.node.value = 'is caaat...'\n      }\n    }\n  }\n}\n","date":"2023-05-12T10:49:20.024Z","updated":"2023-05-12T10:49:20.024Z","path":"demo/2023面试准备/demo/module/plugin.js","layout":"false","title":"","comments":1,"_id":"clhkizgy6002u3y0qf7jedrri","content":"module.exports = function({ types: t }) {\n  return {\n    visitor: {\n      Identifier(path, state) {\n\n        // console.log('🔥', path.node)\n        // console.log('🔥', path.parent)\n        path.node.name = 'cat'\n      },\n      VariableDeclaration(path, state) {\n\n        // console.log('🔥', path.node)\n        if (path.node.kind === 'const') {\n          path.node.kind = 'let'\n        }\n      },\n      Literal(path, state) {\n        console.log('🔥', state.opts)\n        path.node.value = 'is caaat...'\n      }\n    }\n  }\n}\n","site":{"data":{}},"wordcount":349,"excerpt":"","more":"module.exports = function({ types: t }) {\n  return {\n    visitor: {\n      Identifier(path, state) {\n\n        // console.log('🔥', path.node)\n        // console.log('🔥', path.parent)\n        path.node.name = 'cat'\n      },\n      VariableDeclaration(path, state) {\n\n        // console.log('🔥', path.node)\n        if (path.node.kind === 'const') {\n          path.node.kind = 'let'\n        }\n      },\n      Literal(path, state) {\n        console.log('🔥', state.opts)\n        path.node.value = 'is caaat...'\n      }\n    }\n  }\n}\n"},{"_content":"# Module\n\n在ES6之前，社区制定了一些模块加载方案，最主要的有CommonJS和AMD两种。前者用于服务器，后者用于浏览器。\n\nES6在语言规格的层面上实现了模块功能，而且实现得相当简单，完全可以取代现有的CommonJS和AMD规范，成为浏览器和服务器通用的模块解决方案。\n\n\n## stage1\n\n> 文件划分方式，约定每一个 js 文件就是一个独立的模块\n\n```html\n<script src=\"./lib.js\"></script>\n<script src=\"./main.js\"></script>\n\n<script>\n  // 直接使用导入文件中的变量与方法\n  method1()\n\n  // 模块成员可以被修改\n  count = 2\n</script>\n```\n\n缺点：\n1. 污染全局作用域\n2. 命名冲突\n3. 无法管理模块间的依赖关系\n4. 模块成员可以在外部直接修改\n\n## stage2\n\n> 命名空间，减少命名冲突\n\n每个文件中，通过一个命名对象来包裹所有的变量和方法\n\n```js\n// module a 相关的数据和方法\n\nconst moduleA = {\n  name: 'module a',\n  count: 1,\n  incCount() {\n    this.count ++\n  }\n}\n```\n\n缺点：\n1. 污染全局作用域\n2. 无法管理模块间的依赖关系\n3. 模块成员可以在外部直接修改\n\n\n## stage3\n\n> IIFE（立即执行函数）\n\n```js\n;(function($){\n  const name = 'moduleA'\n  let count = 1\n  function incCount() {\n    count++\n  }\n\n  window.moduleA = {\n    incCount\n  }\n})(jQuery)\n```\n\n通过闭包的方式，模块内部的变量只能被模块内部修改，外部无法修改。\n\n通过 IIFE 的传参，我们可以传递一些依赖包给模块使用。\n\n# 模块化规范\n\n- CommonJS（NodeJS）\n\n  1. 一个文件就是一个模块\n  2. 每个模块都有单独的作用域\n  3. 通过 module.exports 导出成员\n  4. 通过 require 函数加载成员\n\n以同步的方式加载模块，如果放在浏览器中，那么会出现大量的文件请求，有时候并不是立马就需要的文件也会被加载，从而造成性能问题，不适合在浏览器中使用。\n\n- AMD（Asyncronous module definition）\n\n  异步的模块定义\n\n```js\n// 定义一个模块\n// 第二个参数表示当前模块的依赖项\ndefine('module1', ['lodash', './module2'], function('lodash', 'module2') {\n  \n  // 导出成员，外部可以方法 start 方法\n  return {\n    start:function() {\n      // lodash\n\n      module2()\n    }\n  }\n})\n\n  // 加载模块\n\n  require('./module1', function(module1) {\n    module1.start()\n  })\n  ```\n\n- CMD规范（类似 CommonJS）\n\n- ES Modules（浏览器）\n\n# ES6 模块化\n\n```html\n<script src=\"./main.js\" type=\"module\"></script>\n\n<script type=\"module\">\n  console.log(1)\n</script>\n```\n\n特性：\n\n- ES6的模块自动采用严格模式，不管有没有在模块头部加上＂use strict＂。\n- 每个 ES Module 都运行在私有作用域中\n- ESM 是通过 CORS(跨域) 的方式去请求外部的 JS 资源的。（原 script 标签默认支持跨域）\n- ESM 的 script 标签会延迟执行脚本（类似标签的 defer 属性），等待网页渲染完成后，再执行。\n  ```js\n  // 会比有 type=\"module\" 的script 先执行\n  <script>\n    alert('hello')\n  </script>\n\n  // 延迟执行\n  <script type=\"module\"> // 等同于加了 defer 属性\n    console.log(1)\n  </script>\n  ```\n\n严格模式主要有以下限制：\n\n- 变量必须声明后再使用。\n- 函数的参数不能有同名属性，否则报错。\n- 不能使用with语句。\n- 不能对只读属性赋值，否则报错。\n- 不能使用前缀0表示八进制数，否则报错。\n- 不能删除不可删除的属性，否则报错。\n- 不能删除变量(delete prop)，会报错，只能删除属性(delete global[prop])。\n- eval不会在其外层作用域引入变量。\n- eval和arguments不能被重新赋值。\n- arguments不会自动反映函数参数的变化。\n- 不能使用arguments.callee。\n- 不能使用arguments.caller。\n- 禁止this指向全局对象。\n- 不能使用fn.caller和fn.arguments获取函数调用的堆栈。\n- 增加了保留字（比如protected、static和interface）。\n\n## export & import\n\n模块功能主要由两个命令构成：export和import。\n\nexport命令用于规定模块的对外接口，import命令用于输入其他模块提供的功能。一个模块就是一个独立的文件。该文件内部的所有变量，外部无法获取。\n\n如果希望外部能够读取模块内部的某个变量，就必须使用export关键字输出该变量。\n\n```js\n// test.js\nexport const myName = 'Hello_AlexCC'\n\n// 组合导出\nconst myAge = 18\nconst sayMe = function() {\n  console.log(`my name is ${myName}, and I'm ${myAge} years old!`)\n}\n\nexport {\n  myAge,\n  sayMe\n}\n```\n\n如果在一个模块中先输入后输出同一个模块，import语句可以与export语句写在一起。\n\n```js\nexport { sayName as default} from './someModule'\n\n// 等价于\n\nimport { sayName } from './someModule'\nexport default sayName\n```\n\n另外，ES7有一个提案(https://github.com/leebyron/ecmascript-more-export-from)，简化先输入后输出的写法，拿掉了输出时的大括号。\n\n```js\n// 提案\nexport v from 'mod'\n\n// 现在\nexport { v } from 'mod'\n```\n\nimport语句会执行所加载的模块\n\n```js\nimport 'lodash'\n```\n\n## 模块整体加载\n```js\nimport * as myModule from './myModule'\n```\n\n## module 命令\nmodule命令可以取代import语句，达到整体输入模块的作用。\n\n```js\nmodule myModule from './myModule'\n\nmyModule.sayName()\n```\n\n## 动态加载模块\n\n返回的是 Promise\n\n```js\nimport('./moduleA.js').then(module => {\n  ...\n})\n```\n\n## ES6模块加载的实质\n\nES6模块加载的机制与CommonJS模块完全不同。\n\nCommonJS模块输出的是一个值的拷贝，而ES6模块输出的是 `值的引用`。\n\n```js\n// lib.js\nexport let count = 1\nexport function incCount() {\n  count++\n}\n\n// main.js\nimport { count, incCount } from './lib.js'\n\nconsole.log(count) // 1\n\nincCount()\n\nconsole.log(count) // 2\n```\n\n\n注意加上 type=\"module\"\n\n```html\n<script src=\"./main.js\" type=\"module\"></script>\n```\n\n## ES Module in NodeJS\n\n如何在 Nodejs 中使用 ES module!\n\n有两个步骤：\n\n1. `.js` 后缀都改为 `.mjs`\n2. 执行脚本时，加上 `node --experimental-modules main.mjs`\n\n```js\n// node\n\n// main.mjs\nimport fs from 'fs'\nimport _ from 'lodash'\n```\n\n注意事项：\n\n1. 在 node 环境中，我们可以使用 ES Module 导入 CommonJS 导出的成员\n\n```js\n// commonjs.js\nmodule.exports = {\n  foo: 'commonjs exports foo'\n}\n\n// esmodule.js\nimport mod from './commonjs.js'\n\nconsole.log(mod.foo)\n```\n\n2. 在 node 环境中，CommonJS 中`不能`导入 ES Module 导出的成员\n\n```js\nconst mod = require('./esmodule.js') // 报错\n```\n\n## CommonJS 与 ES Module 差异\n\n```js\n// CommonJS\n\nrequire // 加载模块函数\n\nmodule // 模块对象\n\nexports // 导出对象别名 exports.name = 'hello world'\n\n__filename // 当前文件的绝对路径\n\n__dirname // 当前文件所在目录\n```\n\n```js\n// ES Module\n\nimport.meta.url // 文件路径信息\n\n// 可以通过内置模块 url 和 path 处理，拿到 __filename 和 __dirname\nimport { fileURLToPath } from 'url'\nimport { dirname } from 'path'\n\nconst __filename = fileURLToPath(import.meta.url)\nconst __dirname = dirname(__filename)\n```\n\n## 高版本 NodeJS 已支持 ESM (Version > 12.10.0)\n\n不需要再写 `.mjs` 结尾了，直接 `.js`\n\n```js\n// package.json\n{\n  \"type\": \"module\"\n}\n\n// 执行\nnode --experimental-modules main.js \n```\n\n加上 type module 配置之后，如果我们还想用 `CommonJS` 规范，发现会报错了。因为我们已经使用了 ESM。\n\n如果继续使用 `CommonJS` 规范，那么就需要将 `.js` 改为 `.cjs`。\n\n## ESM in NodeJS （babel 兼容方案）\n\n> yarn add @babel/node @babel/preset-env --save-dev\n\n```js\n// 通过 babel-node 命令执行脚本\nyarn babel-node main.js\n```\n\n要注意的是，`babel/core` 并不会转换我们的代码，转换代码的工作交给 babel 内置的插件去实现的。也就是说，我们需要一个插件，去转换 ES6 中的一个新特性。\n\n<img src=\"./img/babel.jpg\" />\n\n而 `@bable/preset-env` 是插件的集合，所以不需要每个插件都安装一遍。\n\n```js\n// 命令行使用\nyarn babel-node main.js --presets=@bable/preset-env\n```\n\n结合 babel 配置文件使用\n```js\n// .babelrc\n{\n  \"presets\": [\"@babel/presets-env\"]\n}\n\nyarn babel-node main.js\n```\n\n既然 `@babel/preset-env` 是插件的集合，而我不想要那么多，只是想处理 `ESM` 怎么办呢？\n\n我们卸载掉 `@babel/preset-env`，安装 `@babel/plugin-transform-modules-commonjs`\n\n```js\n// .babelrc\n{\n  \"presets\": [\"@babel/plugin-transform-modules-commonjs\"]\n}\n\nyarn babel-node main.js\n```\n\n# babel\n\n> 编译器\n\n主要用于将ES6版本的JS代码转换为ES5等向后兼容的JS代码，从而使代码可以运行在低版本浏览器或其他环境中。\n\n> npm install --save-dev babel-core babel-preset-es2015 babel-preset-latest --registry=https://registry.npm.taobao.org\n\n配置文件 `.babelrc`（或者 babel.config.js || .babelrc.js）\n\n```js\n{\n  \"presets\": [\"es2015\", \"latest\"], // 安装包的别名，用来处理最新的 ES6 语法\n  \"plugins\": []\n}\n```\n\n安装 `babel-cli`，命令行编译工具，依赖 `babel/core`\n\n```js\nnpm install --save-dev babel-cli \n```\n\n查看 babel 版本（npx 是新版 NodeJS 附带的命令）\n\n```js\nnpx babel --version // ===== node_modules/.bin/babel --version \n\n// ====> 6.26.0 (babel-core 6.26.3)\n```\n\n到这里，我们就可以使用 babel 来编译js 文件了。创建一个 babel.js 文件，写入一些 es6 的语法。\n\n```js\n// babel.js\n\nconst foo = () => {\n  return 3 * 3\n}\n\nconst count = 123\n```\n\n打开命令行工具：\n\n```js\nnpx babel babel.js -o compiled.js // 等效 node_modules/.bin/babel babel.js -o compiled.js \n```\n\n转化后的结果：\n\n```js\n\"use strict\";\n\nvar foo = function foo() {\n  return 3 * 3;\n};\n\nvar count = 123;\n```\n\n## Polyfill\n\nBabel默认只转换新的JS语法（syntax），而不转换新的API（Promise、Map）。如果只是做语法转换，Promise 是不会被降级的，在低版本的浏览器中可能无法使用。\n\n引入 Polyfill，为当前环境提供一个“垫片”。所谓“垫片”，是指垫平不同浏览器之间差异的东西。polyfill提供了全局的ES6对象及通过修改原型链Array.prototype等来补充对实例的实现。\n\n## babel 版本\n\nBabel版本主要是Babel 6和Babel 7这两个版本。\n\n提到Babel版本的时候，通常指的是@babel/core这个Babel核心包的版本。\n\nBabel 7的npm包都存放在babel域下，即在安装npm包的时候，我们安装的是名称以@babel/开头的npm包，如@babel/cli、@babel/core等。而在Babel 6中，我们安装的包名是babel-cli、babel-core等以babel-开头的npm包。其实它们本质上是一样的，都是Babel官方提供的cli命令行工具和core核心包。在平时开发和学习的过程中，碰到@babel/和babel-时应该认识到它俩是作用相同、内容接近的包，只是版本不一样而已。\n\n## babel 配置文件\n\n> 指定编译的规则。\n\n```js\n.babelrc || babel.config.js || .babelrc.js || package.json（配置 babel 属性，配置项都是 一样的）\n```\n\n```js\n// package.json\n\n{\n  ...\n\n  babel: {\n    \"presets\": [\"es2015\", \"react\"],\n    \"plugin\": [\"transform-class-properties\"]\n  },\n\n  ...\n}\n```\n\n推荐使用后缀名是js的配置文件来进行配置，因为可以使用该文件做一些逻辑处理，适用性更强。\n\n## 插件 & 预设\n\nplugin代表插件，preset代表预设。通常每个插件或预设都是一个npm包。\n\nBabel的插件实在太多了，假如只配置插件数组，那我们前端工程要把ES2015、ES2016、ES2017……下的所有插件都写到配置项里，这样的Babel配置文件会非常臃肿。\n\npreset预设就是帮我们解决这个问题的。预设是一组Babel插件的集合，通俗的说法就是插件包，例如babel-preset-es2015就是所有处理ES2015的二十多个Babel插件的集合。这样我们就不用写一大堆插件配置项了，只需要用一个预设代替就可以。另外，预设也可以是插件和其他预设的集合。\n\nBabel官方已经针对常用的环境做了如下这些preset包。\n\n1）@babel/preset-env.\n\n2）@babel/preset-react.\n\n3）@babel/preset-typescript.\n\n4）@babel/preset-stage-0.\n\n5）@babel/preset-stage-1.\n\n## 插件与预设的简称\n\n如果插件的npm包名称的前缀为babel-plugin-，则可以省略其前缀。\n\n如果npm包名称的前缀带有npm作用域@，如@org/babel-plugin-xxx，则短名称可以写成@org/xxx。\n\n```js\n{\n  \"plugins\": [\"babel-plugin-transform-decorators-legacy\"]\n}\n\n// =====\n\n{\n  \"plugins\": [\"transform-decorators-legacy\"]\n}\n```\n\n预设的短名称规则与插件的类似，预设npm包名称的前缀为babel-preset-或作用域@xxx/babel-preset-xxx的可以省略掉babel-preset-。\n\n## 插件和预设执行顺序\n\nplugins插件数组和presets预设数组是有顺序要求的。如果两个插件或预设都要处理同一个代码片段，那么会根据插件和预设的顺序来执行。规则如下:\n\n1）插件比预设先执行。\n\n2）插件执行顺序是插件数组元素从前向后依次执行。\n\n3）预设执行顺序是预设数组元素从后向前依次执行。\n\n## 预设的选择\n\nbabel-preset-latest，在Babel 6时期，是所有年代preset的集合，在Babel 6最后一个版本中，它是babel-preset-es2015、babel-preset-es2016、babel-preset-es2017的集合。\n\n@babel/preset-env`包含了babel-preset-latest的功能，并对其进行了增强`，现在@babel/preset-env完全可以替代babel-preset-latest。\n\nBabel 6 中是babel-preset-env，Babel 7版本开始，@babel/preset-env。\n\n```js\n// babel 6\nnpm install babel-preset-env --save-dev\n\n// .babelrc\n{\n  \"presets\": [\"env\"]\n}\n\n// babel 7\nnpm install @babel/preset-env --save-dev\n\n// .babelrc\n{\n  \"presets\": [\"@babel/env\"]\n}\n```\n\n总结起来，Babel官方提供的预设，我们实际会用到的其实就只有四个。\n\n1）@babel/preset-env.\n\n2）@babel/preset-flow.\n\n3）@babel/preset-react.\n\n4）@babel/preset-typescript.\n\n\n## 插件的选择\n\nBabel 7 官方有九十多个插件，不过其中大多数都已经整合在@babel/preset-env和@babel/preset-react等预设里了，我们在开发的时候直接使用预设就可以。\n\n目前比较常用的插件只有@babel/plugin-transform-runtime。\n\n## browserslist\n\n在 package.json 中经常遇到这个配置项：\n\n```js\n// package.json\n\n{\n  \"browserslist\": [\n    \"> 1%\",\n    \"not ie <= 8\"\n  ]\n}\n```\n上面配置的含义是，该项目工程的目标环境是市场份额大于1%的浏览器并且不考虑IE 8及以下的IE浏览器。\n\nbrowserslist叫作目标环境配置表，除了写在package.json文件里，也可以单独写在工程目录下的.browserslistrc文件里。\n\n我们写一个含有箭头函数的 js 文件，如果我们在browserslist里指定目标环境是Chrome 60浏览器，再来看一下转换结果:\n```js\n// package.json\n{\n  \"browserslist\": [\"chrome 60\"]\n}\n```\n我们发现转换后的代码仍然是箭头函数，因为Chrome 60浏览器已经实现了箭头函数语法，所以不会转换成ES5的函数定义语法。\n\n## @babel/runtime\n\n我们写个 js 文件，里面包含 es6 的 class 语法:\n```js\nclass Person {\n  sayName() {\n    alert(this.name)\n  }\n}\n```\n\n然后执行 babel 命令，查看转换后的结果 `npx babel babel.js -o compiled.js`\n```js\n\"use strict\";\n\nvar _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nvar Person = function () {\n  function Person() {\n    _classCallCheck(this, Person);\n  }\n\n  _createClass(Person, [{\n    key: \"sayName\",\n    value: function sayName() {\n      alert(this.name);\n    }\n  }]);\n\n  return Person;\n}();\n```\n\n可以看到，转换后的代码上部增加了好几个函数声明，这些函数是Babel转码时注入的，我们称之为辅助函数。@babel/preset-env在做语法转换的时候，注入了这些函数声明，以便语法转换后使用。\n\n但这样做存在一个问题。在我们正常地进行前端工程开发的时候，少则有几十个JS文件，多则有上千个。如果每个文件里都使用了class类语法，那么会导致每个转换后的代码上部都会注入这些相同的函数声明。这会导致我们用构建工具打包出来的包体积非常大。\n\n那么应该怎么办呢？一个思路就是，我们把这些函数声明都放在一个npm包里，需要使用的时候直接从这个包里引入我们的文件。这样即使有上千个文件，也会从相同的包里引入这些函数。使用Webpack这一类的构建工具进行打包时，我们只需要引入一次npm包里的函数，这样就做到了复用，减小了包的体积。\n\n`@babel/runtime` 就是上面说的这个npm包，**@babel/runtime把所有语法转换会用到的辅助函数都集中在了一起。**\n\n```js\n// babbel 6\nnpm install babel-runtime --save-dev // /node_modules/babel-runtime/helpers/createClass.js\n\n// babel 7\nnpm install @babel/runtime@7.12.5 --save-dev\n```\n\n然后到node_modules目录下看一下这个包的结构，找到 _classCallCheck、_defineProperties与_createClass这三个辅助函数的位置，我们直接引入即可。\n\n这时，我们就可以替换转换后自动创建的方法，而是使用 @babel/runtime/helpers 中已有的方法。\n\n不过，这么多辅助函数要一个个记住并手动引入，是很难做到的。这时Babel插件 `@babel/plugin-transform-runtime` 就可以用来帮我们解决这个问题。\n\n## @babel/plugin-transform-runtime\n\n辅助函数的自动引入。\n\n@babel/plugin-transform-runtime有三大作用，其中之一就是自动移除语法转换后内联的辅助函数（inline Babel helpers），而是使用@babel/runtime/helpers里的辅助函数来替代，这样就减少了我们手动引入的麻烦。\n\n```js\n// babel6\nnpm install babel-plugin-transform-runtime --save-dev\n\n// babel 7\nnpm install @babel/plugin-transform-runtime@7.12.10 --save-dev\n```\n\n```js\n{\n  \"plugins\": [\"@babel/plugin-transform-runtime\"] // babel 6: \"babel-plugin-transform-runtime\"\n}\n```\n\n还是上面的例子，我们再看看转换后的结果，会发现插件已经自动帮我们处理了。\n\n```js\n\"use strict\";\n\nvar _classCallCheck2 = require(\"babel-runtime/helpers/classCallCheck\");\n\nvar _classCallCheck3 = _interopRequireDefault(_classCallCheck2);\n\nvar _createClass2 = require(\"babel-runtime/helpers/createClass\");\n\nvar _createClass3 = _interopRequireDefault(_createClass2);\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nvar Person = function () {\n  function Person() {\n    (0, _classCallCheck3.default)(this, Person);\n  }\n\n  (0, _createClass3.default)(Person, [{\n    key: \"sayName\",\n    value: function sayName() {\n      alert(this.name);\n    }\n  }]);\n  return Person;\n}();\n```\n\n实际进行前端开发时，我们除了安装@babel/runtime包，基本也会安装@babel/plugin-transform-runtime这个Babel插件。\n\n\n# Babel 原理与插件开发\n\nBabel的转码过程主要由三个阶段组成：解析（parse）、转换（transform）和生成（generate）。这三个阶段分别由@babel/parser、@babel/core和@babel/generator来完成。\n\n1. **解析阶段**\n\n该阶段由Babel读取源码并生成抽象语法树（AST），该阶段由两部分组成：词法分析与语法分析。\n\n词法分析会将字符串形式的代码转换成tokens流，语法分析会将tokens流转换成AST。\n\n```js\nconst name = \"hello AlexCc\"\n```\n\nAST\n\n```js\n-\n#1\n  type: VariableDeclaration\n  declarations\n    #1\n    type: VariableDeclarator\n    id\n      type: Identifier\n      name: name\n    init\n      type: Literal\n      value: hello AlexCc\n      raw: \"hello AlexCc\"\n    kind: const\n```\n\n2. **转换阶段**\n\n完成了解析工作，生成了AST，AST是一个树状的JSON结构。接下来就可以通过Babel插件对该树状结构执行修改操作，修改完成后就得到了新的AST。\n\n3. **生成阶段**\n\n通过转换阶段的工作，我们得到了新的AST。在生成阶段，我们对AST的树状JSON结构进行还原操作，生成新的JS代码，通常这就是我们需要的ES5代码。\n\n## Babel 插件开发\n> babel-handbook\n>\n> https://github.com/jamiebuilds/babel-handbook/blob/master/translations/zh-Hans/plugin-handbook.md\n\n开发Babel转码插件的重点是在第二阶段（转换阶段），在这一阶段我们要从AST上找出需要转换的节点，改成我们需要的形式，最后在生成阶段把AST变回JS代码。\n\n插件模板结构:\n\n```js\nmodule.exports = function({ types: t }) {\n  return {\n    name: 'pluginName',\n    visitor: {}\n  }\n}\n```\n\n假设我们有这样一段代码：\n\n```js\nconst dog = 'is dog'\n```\n\n现在我想将 dog 变成喵咪。\n\n```js\nmodule.exports = function({ types: t }) {\n  return {\n    visitor: {\n      Identifier(path, state) {\n        if (path.node.name === 'dog') {\n          path.node.name = 'cat'\n          path.parent.init.value = 'is cat'\n        }\n      },\n      var\n    }\n  }\n}\n```\n\n转换后：\n\n```js\nconst cat = 'is cat';\n```\n\n我们编写Babel插件的主要工作就是修改`visitor`对象，该对象是遍历AST各个节点的方法。\n\n在上面的插件里，要把变量名dog修改为cat，于是我们修改了visitor.Identifier方法，那我们如何知道要修改的是Identifier方法呢？\n\nBabel原理里讲过Babel转码的三个阶段：解析阶段、转换阶段和生成阶段，我们编写的Babel插件实际上是在执行第二个阶段（转换阶段）的工作，该工作需要前一个阶段解析工作先完成。在解析阶段，我们得到了转码前代码的AST树状结构信息，该AST上会有Identifier等节点信息，我们编写插件的时候参考该AST的信息即可。\n\n<img src=\"./img/ast.jpg\" />\n\n接着看Identifier方法，可以看到它有两个参数path和state，visitor中的每个方法都接收这两个参数，path代表路径。最后我们判断path上节点信息name是不是dog，是的话把它修改为cat即可。\n\n同理，我们也可以修改 `const`、`value`：\n\n```js\nmodule.exports = function({ types: t }) {\n  return {\n    visitor: {\n      Identifier(path, state) {\n        path.node.name = 'cat'\n        path.parent.init.value = 'is cat'\n      },\n      VariableDeclaration(path, state) {\n        if (path.node.kind === 'const') {\n          path.node.kind = 'let'\n        }\n      },\n      Literal(path, state) {\n        // 修改 value\n        path.node.value = 'is caaat...'\n      }\n    }\n  }\n}\n```\n\n## 插件传参\n\n给插件传递参数，注意第一个成员变成了数组，数组的第二项是参数\n\n```js\n// .babelrc\n{\n  \"plugins\": [[\"./plugin.js\", {\n    \"ES5\": false\n  }]]\n}\n```\n\n在插件中，我们可以通过 `state.opts` 获取到参数：\n\n```js\n// plugin.js\n\n...\nVariableDeclaration(path, state) {\n  if (state.opts.ES5 === true && ['let', 'const'].includes(path.node.kind)) {\n    path.node.kind = 'var'\n  }\n},\n...\n```\n","source":"demo/2023面试准备/模块化.md","raw":"# Module\n\n在ES6之前，社区制定了一些模块加载方案，最主要的有CommonJS和AMD两种。前者用于服务器，后者用于浏览器。\n\nES6在语言规格的层面上实现了模块功能，而且实现得相当简单，完全可以取代现有的CommonJS和AMD规范，成为浏览器和服务器通用的模块解决方案。\n\n\n## stage1\n\n> 文件划分方式，约定每一个 js 文件就是一个独立的模块\n\n```html\n<script src=\"./lib.js\"></script>\n<script src=\"./main.js\"></script>\n\n<script>\n  // 直接使用导入文件中的变量与方法\n  method1()\n\n  // 模块成员可以被修改\n  count = 2\n</script>\n```\n\n缺点：\n1. 污染全局作用域\n2. 命名冲突\n3. 无法管理模块间的依赖关系\n4. 模块成员可以在外部直接修改\n\n## stage2\n\n> 命名空间，减少命名冲突\n\n每个文件中，通过一个命名对象来包裹所有的变量和方法\n\n```js\n// module a 相关的数据和方法\n\nconst moduleA = {\n  name: 'module a',\n  count: 1,\n  incCount() {\n    this.count ++\n  }\n}\n```\n\n缺点：\n1. 污染全局作用域\n2. 无法管理模块间的依赖关系\n3. 模块成员可以在外部直接修改\n\n\n## stage3\n\n> IIFE（立即执行函数）\n\n```js\n;(function($){\n  const name = 'moduleA'\n  let count = 1\n  function incCount() {\n    count++\n  }\n\n  window.moduleA = {\n    incCount\n  }\n})(jQuery)\n```\n\n通过闭包的方式，模块内部的变量只能被模块内部修改，外部无法修改。\n\n通过 IIFE 的传参，我们可以传递一些依赖包给模块使用。\n\n# 模块化规范\n\n- CommonJS（NodeJS）\n\n  1. 一个文件就是一个模块\n  2. 每个模块都有单独的作用域\n  3. 通过 module.exports 导出成员\n  4. 通过 require 函数加载成员\n\n以同步的方式加载模块，如果放在浏览器中，那么会出现大量的文件请求，有时候并不是立马就需要的文件也会被加载，从而造成性能问题，不适合在浏览器中使用。\n\n- AMD（Asyncronous module definition）\n\n  异步的模块定义\n\n```js\n// 定义一个模块\n// 第二个参数表示当前模块的依赖项\ndefine('module1', ['lodash', './module2'], function('lodash', 'module2') {\n  \n  // 导出成员，外部可以方法 start 方法\n  return {\n    start:function() {\n      // lodash\n\n      module2()\n    }\n  }\n})\n\n  // 加载模块\n\n  require('./module1', function(module1) {\n    module1.start()\n  })\n  ```\n\n- CMD规范（类似 CommonJS）\n\n- ES Modules（浏览器）\n\n# ES6 模块化\n\n```html\n<script src=\"./main.js\" type=\"module\"></script>\n\n<script type=\"module\">\n  console.log(1)\n</script>\n```\n\n特性：\n\n- ES6的模块自动采用严格模式，不管有没有在模块头部加上＂use strict＂。\n- 每个 ES Module 都运行在私有作用域中\n- ESM 是通过 CORS(跨域) 的方式去请求外部的 JS 资源的。（原 script 标签默认支持跨域）\n- ESM 的 script 标签会延迟执行脚本（类似标签的 defer 属性），等待网页渲染完成后，再执行。\n  ```js\n  // 会比有 type=\"module\" 的script 先执行\n  <script>\n    alert('hello')\n  </script>\n\n  // 延迟执行\n  <script type=\"module\"> // 等同于加了 defer 属性\n    console.log(1)\n  </script>\n  ```\n\n严格模式主要有以下限制：\n\n- 变量必须声明后再使用。\n- 函数的参数不能有同名属性，否则报错。\n- 不能使用with语句。\n- 不能对只读属性赋值，否则报错。\n- 不能使用前缀0表示八进制数，否则报错。\n- 不能删除不可删除的属性，否则报错。\n- 不能删除变量(delete prop)，会报错，只能删除属性(delete global[prop])。\n- eval不会在其外层作用域引入变量。\n- eval和arguments不能被重新赋值。\n- arguments不会自动反映函数参数的变化。\n- 不能使用arguments.callee。\n- 不能使用arguments.caller。\n- 禁止this指向全局对象。\n- 不能使用fn.caller和fn.arguments获取函数调用的堆栈。\n- 增加了保留字（比如protected、static和interface）。\n\n## export & import\n\n模块功能主要由两个命令构成：export和import。\n\nexport命令用于规定模块的对外接口，import命令用于输入其他模块提供的功能。一个模块就是一个独立的文件。该文件内部的所有变量，外部无法获取。\n\n如果希望外部能够读取模块内部的某个变量，就必须使用export关键字输出该变量。\n\n```js\n// test.js\nexport const myName = 'Hello_AlexCC'\n\n// 组合导出\nconst myAge = 18\nconst sayMe = function() {\n  console.log(`my name is ${myName}, and I'm ${myAge} years old!`)\n}\n\nexport {\n  myAge,\n  sayMe\n}\n```\n\n如果在一个模块中先输入后输出同一个模块，import语句可以与export语句写在一起。\n\n```js\nexport { sayName as default} from './someModule'\n\n// 等价于\n\nimport { sayName } from './someModule'\nexport default sayName\n```\n\n另外，ES7有一个提案(https://github.com/leebyron/ecmascript-more-export-from)，简化先输入后输出的写法，拿掉了输出时的大括号。\n\n```js\n// 提案\nexport v from 'mod'\n\n// 现在\nexport { v } from 'mod'\n```\n\nimport语句会执行所加载的模块\n\n```js\nimport 'lodash'\n```\n\n## 模块整体加载\n```js\nimport * as myModule from './myModule'\n```\n\n## module 命令\nmodule命令可以取代import语句，达到整体输入模块的作用。\n\n```js\nmodule myModule from './myModule'\n\nmyModule.sayName()\n```\n\n## 动态加载模块\n\n返回的是 Promise\n\n```js\nimport('./moduleA.js').then(module => {\n  ...\n})\n```\n\n## ES6模块加载的实质\n\nES6模块加载的机制与CommonJS模块完全不同。\n\nCommonJS模块输出的是一个值的拷贝，而ES6模块输出的是 `值的引用`。\n\n```js\n// lib.js\nexport let count = 1\nexport function incCount() {\n  count++\n}\n\n// main.js\nimport { count, incCount } from './lib.js'\n\nconsole.log(count) // 1\n\nincCount()\n\nconsole.log(count) // 2\n```\n\n\n注意加上 type=\"module\"\n\n```html\n<script src=\"./main.js\" type=\"module\"></script>\n```\n\n## ES Module in NodeJS\n\n如何在 Nodejs 中使用 ES module!\n\n有两个步骤：\n\n1. `.js` 后缀都改为 `.mjs`\n2. 执行脚本时，加上 `node --experimental-modules main.mjs`\n\n```js\n// node\n\n// main.mjs\nimport fs from 'fs'\nimport _ from 'lodash'\n```\n\n注意事项：\n\n1. 在 node 环境中，我们可以使用 ES Module 导入 CommonJS 导出的成员\n\n```js\n// commonjs.js\nmodule.exports = {\n  foo: 'commonjs exports foo'\n}\n\n// esmodule.js\nimport mod from './commonjs.js'\n\nconsole.log(mod.foo)\n```\n\n2. 在 node 环境中，CommonJS 中`不能`导入 ES Module 导出的成员\n\n```js\nconst mod = require('./esmodule.js') // 报错\n```\n\n## CommonJS 与 ES Module 差异\n\n```js\n// CommonJS\n\nrequire // 加载模块函数\n\nmodule // 模块对象\n\nexports // 导出对象别名 exports.name = 'hello world'\n\n__filename // 当前文件的绝对路径\n\n__dirname // 当前文件所在目录\n```\n\n```js\n// ES Module\n\nimport.meta.url // 文件路径信息\n\n// 可以通过内置模块 url 和 path 处理，拿到 __filename 和 __dirname\nimport { fileURLToPath } from 'url'\nimport { dirname } from 'path'\n\nconst __filename = fileURLToPath(import.meta.url)\nconst __dirname = dirname(__filename)\n```\n\n## 高版本 NodeJS 已支持 ESM (Version > 12.10.0)\n\n不需要再写 `.mjs` 结尾了，直接 `.js`\n\n```js\n// package.json\n{\n  \"type\": \"module\"\n}\n\n// 执行\nnode --experimental-modules main.js \n```\n\n加上 type module 配置之后，如果我们还想用 `CommonJS` 规范，发现会报错了。因为我们已经使用了 ESM。\n\n如果继续使用 `CommonJS` 规范，那么就需要将 `.js` 改为 `.cjs`。\n\n## ESM in NodeJS （babel 兼容方案）\n\n> yarn add @babel/node @babel/preset-env --save-dev\n\n```js\n// 通过 babel-node 命令执行脚本\nyarn babel-node main.js\n```\n\n要注意的是，`babel/core` 并不会转换我们的代码，转换代码的工作交给 babel 内置的插件去实现的。也就是说，我们需要一个插件，去转换 ES6 中的一个新特性。\n\n<img src=\"./img/babel.jpg\" />\n\n而 `@bable/preset-env` 是插件的集合，所以不需要每个插件都安装一遍。\n\n```js\n// 命令行使用\nyarn babel-node main.js --presets=@bable/preset-env\n```\n\n结合 babel 配置文件使用\n```js\n// .babelrc\n{\n  \"presets\": [\"@babel/presets-env\"]\n}\n\nyarn babel-node main.js\n```\n\n既然 `@babel/preset-env` 是插件的集合，而我不想要那么多，只是想处理 `ESM` 怎么办呢？\n\n我们卸载掉 `@babel/preset-env`，安装 `@babel/plugin-transform-modules-commonjs`\n\n```js\n// .babelrc\n{\n  \"presets\": [\"@babel/plugin-transform-modules-commonjs\"]\n}\n\nyarn babel-node main.js\n```\n\n# babel\n\n> 编译器\n\n主要用于将ES6版本的JS代码转换为ES5等向后兼容的JS代码，从而使代码可以运行在低版本浏览器或其他环境中。\n\n> npm install --save-dev babel-core babel-preset-es2015 babel-preset-latest --registry=https://registry.npm.taobao.org\n\n配置文件 `.babelrc`（或者 babel.config.js || .babelrc.js）\n\n```js\n{\n  \"presets\": [\"es2015\", \"latest\"], // 安装包的别名，用来处理最新的 ES6 语法\n  \"plugins\": []\n}\n```\n\n安装 `babel-cli`，命令行编译工具，依赖 `babel/core`\n\n```js\nnpm install --save-dev babel-cli \n```\n\n查看 babel 版本（npx 是新版 NodeJS 附带的命令）\n\n```js\nnpx babel --version // ===== node_modules/.bin/babel --version \n\n// ====> 6.26.0 (babel-core 6.26.3)\n```\n\n到这里，我们就可以使用 babel 来编译js 文件了。创建一个 babel.js 文件，写入一些 es6 的语法。\n\n```js\n// babel.js\n\nconst foo = () => {\n  return 3 * 3\n}\n\nconst count = 123\n```\n\n打开命令行工具：\n\n```js\nnpx babel babel.js -o compiled.js // 等效 node_modules/.bin/babel babel.js -o compiled.js \n```\n\n转化后的结果：\n\n```js\n\"use strict\";\n\nvar foo = function foo() {\n  return 3 * 3;\n};\n\nvar count = 123;\n```\n\n## Polyfill\n\nBabel默认只转换新的JS语法（syntax），而不转换新的API（Promise、Map）。如果只是做语法转换，Promise 是不会被降级的，在低版本的浏览器中可能无法使用。\n\n引入 Polyfill，为当前环境提供一个“垫片”。所谓“垫片”，是指垫平不同浏览器之间差异的东西。polyfill提供了全局的ES6对象及通过修改原型链Array.prototype等来补充对实例的实现。\n\n## babel 版本\n\nBabel版本主要是Babel 6和Babel 7这两个版本。\n\n提到Babel版本的时候，通常指的是@babel/core这个Babel核心包的版本。\n\nBabel 7的npm包都存放在babel域下，即在安装npm包的时候，我们安装的是名称以@babel/开头的npm包，如@babel/cli、@babel/core等。而在Babel 6中，我们安装的包名是babel-cli、babel-core等以babel-开头的npm包。其实它们本质上是一样的，都是Babel官方提供的cli命令行工具和core核心包。在平时开发和学习的过程中，碰到@babel/和babel-时应该认识到它俩是作用相同、内容接近的包，只是版本不一样而已。\n\n## babel 配置文件\n\n> 指定编译的规则。\n\n```js\n.babelrc || babel.config.js || .babelrc.js || package.json（配置 babel 属性，配置项都是 一样的）\n```\n\n```js\n// package.json\n\n{\n  ...\n\n  babel: {\n    \"presets\": [\"es2015\", \"react\"],\n    \"plugin\": [\"transform-class-properties\"]\n  },\n\n  ...\n}\n```\n\n推荐使用后缀名是js的配置文件来进行配置，因为可以使用该文件做一些逻辑处理，适用性更强。\n\n## 插件 & 预设\n\nplugin代表插件，preset代表预设。通常每个插件或预设都是一个npm包。\n\nBabel的插件实在太多了，假如只配置插件数组，那我们前端工程要把ES2015、ES2016、ES2017……下的所有插件都写到配置项里，这样的Babel配置文件会非常臃肿。\n\npreset预设就是帮我们解决这个问题的。预设是一组Babel插件的集合，通俗的说法就是插件包，例如babel-preset-es2015就是所有处理ES2015的二十多个Babel插件的集合。这样我们就不用写一大堆插件配置项了，只需要用一个预设代替就可以。另外，预设也可以是插件和其他预设的集合。\n\nBabel官方已经针对常用的环境做了如下这些preset包。\n\n1）@babel/preset-env.\n\n2）@babel/preset-react.\n\n3）@babel/preset-typescript.\n\n4）@babel/preset-stage-0.\n\n5）@babel/preset-stage-1.\n\n## 插件与预设的简称\n\n如果插件的npm包名称的前缀为babel-plugin-，则可以省略其前缀。\n\n如果npm包名称的前缀带有npm作用域@，如@org/babel-plugin-xxx，则短名称可以写成@org/xxx。\n\n```js\n{\n  \"plugins\": [\"babel-plugin-transform-decorators-legacy\"]\n}\n\n// =====\n\n{\n  \"plugins\": [\"transform-decorators-legacy\"]\n}\n```\n\n预设的短名称规则与插件的类似，预设npm包名称的前缀为babel-preset-或作用域@xxx/babel-preset-xxx的可以省略掉babel-preset-。\n\n## 插件和预设执行顺序\n\nplugins插件数组和presets预设数组是有顺序要求的。如果两个插件或预设都要处理同一个代码片段，那么会根据插件和预设的顺序来执行。规则如下:\n\n1）插件比预设先执行。\n\n2）插件执行顺序是插件数组元素从前向后依次执行。\n\n3）预设执行顺序是预设数组元素从后向前依次执行。\n\n## 预设的选择\n\nbabel-preset-latest，在Babel 6时期，是所有年代preset的集合，在Babel 6最后一个版本中，它是babel-preset-es2015、babel-preset-es2016、babel-preset-es2017的集合。\n\n@babel/preset-env`包含了babel-preset-latest的功能，并对其进行了增强`，现在@babel/preset-env完全可以替代babel-preset-latest。\n\nBabel 6 中是babel-preset-env，Babel 7版本开始，@babel/preset-env。\n\n```js\n// babel 6\nnpm install babel-preset-env --save-dev\n\n// .babelrc\n{\n  \"presets\": [\"env\"]\n}\n\n// babel 7\nnpm install @babel/preset-env --save-dev\n\n// .babelrc\n{\n  \"presets\": [\"@babel/env\"]\n}\n```\n\n总结起来，Babel官方提供的预设，我们实际会用到的其实就只有四个。\n\n1）@babel/preset-env.\n\n2）@babel/preset-flow.\n\n3）@babel/preset-react.\n\n4）@babel/preset-typescript.\n\n\n## 插件的选择\n\nBabel 7 官方有九十多个插件，不过其中大多数都已经整合在@babel/preset-env和@babel/preset-react等预设里了，我们在开发的时候直接使用预设就可以。\n\n目前比较常用的插件只有@babel/plugin-transform-runtime。\n\n## browserslist\n\n在 package.json 中经常遇到这个配置项：\n\n```js\n// package.json\n\n{\n  \"browserslist\": [\n    \"> 1%\",\n    \"not ie <= 8\"\n  ]\n}\n```\n上面配置的含义是，该项目工程的目标环境是市场份额大于1%的浏览器并且不考虑IE 8及以下的IE浏览器。\n\nbrowserslist叫作目标环境配置表，除了写在package.json文件里，也可以单独写在工程目录下的.browserslistrc文件里。\n\n我们写一个含有箭头函数的 js 文件，如果我们在browserslist里指定目标环境是Chrome 60浏览器，再来看一下转换结果:\n```js\n// package.json\n{\n  \"browserslist\": [\"chrome 60\"]\n}\n```\n我们发现转换后的代码仍然是箭头函数，因为Chrome 60浏览器已经实现了箭头函数语法，所以不会转换成ES5的函数定义语法。\n\n## @babel/runtime\n\n我们写个 js 文件，里面包含 es6 的 class 语法:\n```js\nclass Person {\n  sayName() {\n    alert(this.name)\n  }\n}\n```\n\n然后执行 babel 命令，查看转换后的结果 `npx babel babel.js -o compiled.js`\n```js\n\"use strict\";\n\nvar _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nvar Person = function () {\n  function Person() {\n    _classCallCheck(this, Person);\n  }\n\n  _createClass(Person, [{\n    key: \"sayName\",\n    value: function sayName() {\n      alert(this.name);\n    }\n  }]);\n\n  return Person;\n}();\n```\n\n可以看到，转换后的代码上部增加了好几个函数声明，这些函数是Babel转码时注入的，我们称之为辅助函数。@babel/preset-env在做语法转换的时候，注入了这些函数声明，以便语法转换后使用。\n\n但这样做存在一个问题。在我们正常地进行前端工程开发的时候，少则有几十个JS文件，多则有上千个。如果每个文件里都使用了class类语法，那么会导致每个转换后的代码上部都会注入这些相同的函数声明。这会导致我们用构建工具打包出来的包体积非常大。\n\n那么应该怎么办呢？一个思路就是，我们把这些函数声明都放在一个npm包里，需要使用的时候直接从这个包里引入我们的文件。这样即使有上千个文件，也会从相同的包里引入这些函数。使用Webpack这一类的构建工具进行打包时，我们只需要引入一次npm包里的函数，这样就做到了复用，减小了包的体积。\n\n`@babel/runtime` 就是上面说的这个npm包，**@babel/runtime把所有语法转换会用到的辅助函数都集中在了一起。**\n\n```js\n// babbel 6\nnpm install babel-runtime --save-dev // /node_modules/babel-runtime/helpers/createClass.js\n\n// babel 7\nnpm install @babel/runtime@7.12.5 --save-dev\n```\n\n然后到node_modules目录下看一下这个包的结构，找到 _classCallCheck、_defineProperties与_createClass这三个辅助函数的位置，我们直接引入即可。\n\n这时，我们就可以替换转换后自动创建的方法，而是使用 @babel/runtime/helpers 中已有的方法。\n\n不过，这么多辅助函数要一个个记住并手动引入，是很难做到的。这时Babel插件 `@babel/plugin-transform-runtime` 就可以用来帮我们解决这个问题。\n\n## @babel/plugin-transform-runtime\n\n辅助函数的自动引入。\n\n@babel/plugin-transform-runtime有三大作用，其中之一就是自动移除语法转换后内联的辅助函数（inline Babel helpers），而是使用@babel/runtime/helpers里的辅助函数来替代，这样就减少了我们手动引入的麻烦。\n\n```js\n// babel6\nnpm install babel-plugin-transform-runtime --save-dev\n\n// babel 7\nnpm install @babel/plugin-transform-runtime@7.12.10 --save-dev\n```\n\n```js\n{\n  \"plugins\": [\"@babel/plugin-transform-runtime\"] // babel 6: \"babel-plugin-transform-runtime\"\n}\n```\n\n还是上面的例子，我们再看看转换后的结果，会发现插件已经自动帮我们处理了。\n\n```js\n\"use strict\";\n\nvar _classCallCheck2 = require(\"babel-runtime/helpers/classCallCheck\");\n\nvar _classCallCheck3 = _interopRequireDefault(_classCallCheck2);\n\nvar _createClass2 = require(\"babel-runtime/helpers/createClass\");\n\nvar _createClass3 = _interopRequireDefault(_createClass2);\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nvar Person = function () {\n  function Person() {\n    (0, _classCallCheck3.default)(this, Person);\n  }\n\n  (0, _createClass3.default)(Person, [{\n    key: \"sayName\",\n    value: function sayName() {\n      alert(this.name);\n    }\n  }]);\n  return Person;\n}();\n```\n\n实际进行前端开发时，我们除了安装@babel/runtime包，基本也会安装@babel/plugin-transform-runtime这个Babel插件。\n\n\n# Babel 原理与插件开发\n\nBabel的转码过程主要由三个阶段组成：解析（parse）、转换（transform）和生成（generate）。这三个阶段分别由@babel/parser、@babel/core和@babel/generator来完成。\n\n1. **解析阶段**\n\n该阶段由Babel读取源码并生成抽象语法树（AST），该阶段由两部分组成：词法分析与语法分析。\n\n词法分析会将字符串形式的代码转换成tokens流，语法分析会将tokens流转换成AST。\n\n```js\nconst name = \"hello AlexCc\"\n```\n\nAST\n\n```js\n-\n#1\n  type: VariableDeclaration\n  declarations\n    #1\n    type: VariableDeclarator\n    id\n      type: Identifier\n      name: name\n    init\n      type: Literal\n      value: hello AlexCc\n      raw: \"hello AlexCc\"\n    kind: const\n```\n\n2. **转换阶段**\n\n完成了解析工作，生成了AST，AST是一个树状的JSON结构。接下来就可以通过Babel插件对该树状结构执行修改操作，修改完成后就得到了新的AST。\n\n3. **生成阶段**\n\n通过转换阶段的工作，我们得到了新的AST。在生成阶段，我们对AST的树状JSON结构进行还原操作，生成新的JS代码，通常这就是我们需要的ES5代码。\n\n## Babel 插件开发\n> babel-handbook\n>\n> https://github.com/jamiebuilds/babel-handbook/blob/master/translations/zh-Hans/plugin-handbook.md\n\n开发Babel转码插件的重点是在第二阶段（转换阶段），在这一阶段我们要从AST上找出需要转换的节点，改成我们需要的形式，最后在生成阶段把AST变回JS代码。\n\n插件模板结构:\n\n```js\nmodule.exports = function({ types: t }) {\n  return {\n    name: 'pluginName',\n    visitor: {}\n  }\n}\n```\n\n假设我们有这样一段代码：\n\n```js\nconst dog = 'is dog'\n```\n\n现在我想将 dog 变成喵咪。\n\n```js\nmodule.exports = function({ types: t }) {\n  return {\n    visitor: {\n      Identifier(path, state) {\n        if (path.node.name === 'dog') {\n          path.node.name = 'cat'\n          path.parent.init.value = 'is cat'\n        }\n      },\n      var\n    }\n  }\n}\n```\n\n转换后：\n\n```js\nconst cat = 'is cat';\n```\n\n我们编写Babel插件的主要工作就是修改`visitor`对象，该对象是遍历AST各个节点的方法。\n\n在上面的插件里，要把变量名dog修改为cat，于是我们修改了visitor.Identifier方法，那我们如何知道要修改的是Identifier方法呢？\n\nBabel原理里讲过Babel转码的三个阶段：解析阶段、转换阶段和生成阶段，我们编写的Babel插件实际上是在执行第二个阶段（转换阶段）的工作，该工作需要前一个阶段解析工作先完成。在解析阶段，我们得到了转码前代码的AST树状结构信息，该AST上会有Identifier等节点信息，我们编写插件的时候参考该AST的信息即可。\n\n<img src=\"./img/ast.jpg\" />\n\n接着看Identifier方法，可以看到它有两个参数path和state，visitor中的每个方法都接收这两个参数，path代表路径。最后我们判断path上节点信息name是不是dog，是的话把它修改为cat即可。\n\n同理，我们也可以修改 `const`、`value`：\n\n```js\nmodule.exports = function({ types: t }) {\n  return {\n    visitor: {\n      Identifier(path, state) {\n        path.node.name = 'cat'\n        path.parent.init.value = 'is cat'\n      },\n      VariableDeclaration(path, state) {\n        if (path.node.kind === 'const') {\n          path.node.kind = 'let'\n        }\n      },\n      Literal(path, state) {\n        // 修改 value\n        path.node.value = 'is caaat...'\n      }\n    }\n  }\n}\n```\n\n## 插件传参\n\n给插件传递参数，注意第一个成员变成了数组，数组的第二项是参数\n\n```js\n// .babelrc\n{\n  \"plugins\": [[\"./plugin.js\", {\n    \"ES5\": false\n  }]]\n}\n```\n\n在插件中，我们可以通过 `state.opts` 获取到参数：\n\n```js\n// plugin.js\n\n...\nVariableDeclaration(path, state) {\n  if (state.opts.ES5 === true && ['let', 'const'].includes(path.node.kind)) {\n    path.node.kind = 'var'\n  }\n},\n...\n```\n","date":"2023-05-12T10:49:20.034Z","updated":"2023-05-12T10:49:20.034Z","path":"demo/2023面试准备/模块化.html","title":"","comments":1,"layout":"page","_id":"clhkizgy8002v3y0q22uuh1ke","content":"<h1 id=\"Module\"><a href=\"#Module\" class=\"headerlink\" title=\"Module\"></a>Module</h1><p>在ES6之前，社区制定了一些模块加载方案，最主要的有CommonJS和AMD两种。前者用于服务器，后者用于浏览器。</p>\n<p>ES6在语言规格的层面上实现了模块功能，而且实现得相当简单，完全可以取代现有的CommonJS和AMD规范，成为浏览器和服务器通用的模块解决方案。</p>\n<h2 id=\"stage1\"><a href=\"#stage1\" class=\"headerlink\" title=\"stage1\"></a>stage1</h2><blockquote>\n<p>文件划分方式，约定每一个 js 文件就是一个独立的模块</p>\n</blockquote>\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><div class=\"code-wrapper\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></div></td><td class=\"code\"><pre><code class=\"hljs html\"><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">script</span> <span class=\"hljs-attr\">src</span>=<span class=\"hljs-string\">&quot;./lib.js&quot;</span>&gt;</span><span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">script</span>&gt;</span><br><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">script</span> <span class=\"hljs-attr\">src</span>=<span class=\"hljs-string\">&quot;./main.js&quot;</span>&gt;</span><span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">script</span>&gt;</span><br><br><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">script</span>&gt;</span><span class=\"language-javascript\"></span><br><span class=\"language-javascript\">  <span class=\"hljs-comment\">// 直接使用导入文件中的变量与方法</span></span><br><span class=\"language-javascript\">  <span class=\"hljs-title function_\">method1</span>()</span><br><span class=\"language-javascript\"></span><br><span class=\"language-javascript\">  <span class=\"hljs-comment\">// 模块成员可以被修改</span></span><br><span class=\"language-javascript\">  count = <span class=\"hljs-number\">2</span></span><br><span class=\"language-javascript\"></span><span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">script</span>&gt;</span><br></code></pre></td></tr></table></figure>\n\n<p>缺点：</p>\n<ol>\n<li>污染全局作用域</li>\n<li>命名冲突</li>\n<li>无法管理模块间的依赖关系</li>\n<li>模块成员可以在外部直接修改</li>\n</ol>\n<h2 id=\"stage2\"><a href=\"#stage2\" class=\"headerlink\" title=\"stage2\"></a>stage2</h2><blockquote>\n<p>命名空间，减少命名冲突</p>\n</blockquote>\n<p>每个文件中，通过一个命名对象来包裹所有的变量和方法</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\"><span class=\"hljs-comment\">// module a 相关的数据和方法</span><br><br><span class=\"hljs-keyword\">const</span> moduleA = &#123;<br>  <span class=\"hljs-attr\">name</span>: <span class=\"hljs-string\">&#x27;module a&#x27;</span>,<br>  <span class=\"hljs-attr\">count</span>: <span class=\"hljs-number\">1</span>,<br>  <span class=\"hljs-title function_\">incCount</span>(<span class=\"hljs-params\"></span>) &#123;<br>    <span class=\"hljs-variable language_\">this</span>.<span class=\"hljs-property\">count</span> ++<br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure>\n\n<p>缺点：</p>\n<ol>\n<li>污染全局作用域</li>\n<li>无法管理模块间的依赖关系</li>\n<li>模块成员可以在外部直接修改</li>\n</ol>\n<h2 id=\"stage3\"><a href=\"#stage3\" class=\"headerlink\" title=\"stage3\"></a>stage3</h2><blockquote>\n<p>IIFE（立即执行函数）</p>\n</blockquote>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\">;(<span class=\"hljs-keyword\">function</span>(<span class=\"hljs-params\">$</span>)&#123;<br>  <span class=\"hljs-keyword\">const</span> name = <span class=\"hljs-string\">&#x27;moduleA&#x27;</span><br>  <span class=\"hljs-keyword\">let</span> count = <span class=\"hljs-number\">1</span><br>  <span class=\"hljs-keyword\">function</span> <span class=\"hljs-title function_\">incCount</span>(<span class=\"hljs-params\"></span>) &#123;<br>    count++<br>  &#125;<br><br>  <span class=\"hljs-variable language_\">window</span>.<span class=\"hljs-property\">moduleA</span> = &#123;<br>    incCount<br>  &#125;<br>&#125;)(jQuery)<br></code></pre></td></tr></table></figure>\n\n<p>通过闭包的方式，模块内部的变量只能被模块内部修改，外部无法修改。</p>\n<p>通过 IIFE 的传参，我们可以传递一些依赖包给模块使用。</p>\n<h1 id=\"模块化规范\"><a href=\"#模块化规范\" class=\"headerlink\" title=\"模块化规范\"></a>模块化规范</h1><ul>\n<li><p>CommonJS（NodeJS）</p>\n<ol>\n<li>一个文件就是一个模块</li>\n<li>每个模块都有单独的作用域</li>\n<li>通过 module.exports 导出成员</li>\n<li>通过 require 函数加载成员</li>\n</ol>\n</li>\n</ul>\n<p>以同步的方式加载模块，如果放在浏览器中，那么会出现大量的文件请求，有时候并不是立马就需要的文件也会被加载，从而造成性能问题，不适合在浏览器中使用。</p>\n<ul>\n<li><p>AMD（Asyncronous module definition）</p>\n<p>异步的模块定义</p>\n</li>\n</ul>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\"><span class=\"hljs-comment\">// 定义一个模块</span><br><span class=\"hljs-comment\">// 第二个参数表示当前模块的依赖项</span><br><span class=\"hljs-title function_\">define</span>(<span class=\"hljs-string\">&#x27;module1&#x27;</span>, [<span class=\"hljs-string\">&#x27;lodash&#x27;</span>, <span class=\"hljs-string\">&#x27;./module2&#x27;</span>], <span class=\"hljs-keyword\">function</span>(<span class=\"hljs-params\"><span class=\"hljs-string\">&#x27;lodash&#x27;</span>, <span class=\"hljs-string\">&#x27;module2&#x27;</span></span>) &#123;<br>  <br>  <span class=\"hljs-comment\">// 导出成员，外部可以方法 start 方法</span><br>  <span class=\"hljs-keyword\">return</span> &#123;<br>    <span class=\"hljs-attr\">start</span>:<span class=\"hljs-keyword\">function</span>(<span class=\"hljs-params\"></span>) &#123;<br>      <span class=\"hljs-comment\">// lodash</span><br><br>      <span class=\"hljs-title function_\">module2</span>()<br>    &#125;<br>  &#125;<br>&#125;)<br><br>  <span class=\"hljs-comment\">// 加载模块</span><br><br>  <span class=\"hljs-built_in\">require</span>(<span class=\"hljs-string\">&#x27;./module1&#x27;</span>, <span class=\"hljs-keyword\">function</span>(<span class=\"hljs-params\">module1</span>) &#123;<br>    module1.<span class=\"hljs-title function_\">start</span>()<br>  &#125;)<br></code></pre></td></tr></table></figure>\n\n<ul>\n<li><p>CMD规范（类似 CommonJS）</p>\n</li>\n<li><p>ES Modules（浏览器）</p>\n</li>\n</ul>\n<h1 id=\"ES6-模块化\"><a href=\"#ES6-模块化\" class=\"headerlink\" title=\"ES6 模块化\"></a>ES6 模块化</h1><figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs html\"><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">script</span> <span class=\"hljs-attr\">src</span>=<span class=\"hljs-string\">&quot;./main.js&quot;</span> <span class=\"hljs-attr\">type</span>=<span class=\"hljs-string\">&quot;module&quot;</span>&gt;</span><span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">script</span>&gt;</span><br><br><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">script</span> <span class=\"hljs-attr\">type</span>=<span class=\"hljs-string\">&quot;module&quot;</span>&gt;</span><span class=\"language-javascript\"></span><br><span class=\"language-javascript\">  <span class=\"hljs-variable language_\">console</span>.<span class=\"hljs-title function_\">log</span>(<span class=\"hljs-number\">1</span>)</span><br><span class=\"language-javascript\"></span><span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">script</span>&gt;</span><br></code></pre></td></tr></table></figure>\n\n<p>特性：</p>\n<ul>\n<li>ES6的模块自动采用严格模式，不管有没有在模块头部加上＂use strict＂。</li>\n<li>每个 ES Module 都运行在私有作用域中</li>\n<li>ESM 是通过 CORS(跨域) 的方式去请求外部的 JS 资源的。（原 script 标签默认支持跨域）</li>\n<li>ESM 的 script 标签会延迟执行脚本（类似标签的 defer 属性），等待网页渲染完成后，再执行。<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\"><span class=\"hljs-comment\">// 会比有 type=&quot;module&quot; 的script 先执行</span><br>&lt;script&gt;<br>  <span class=\"hljs-title function_\">alert</span>(<span class=\"hljs-string\">&#x27;hello&#x27;</span>)<br>&lt;/script&gt;<br><br><span class=\"hljs-comment\">// 延迟执行</span><br><span class=\"language-xml\"><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">script</span> <span class=\"hljs-attr\">type</span>=<span class=\"hljs-string\">&quot;module&quot;</span>&gt;</span><span class=\"language-javascript\"> <span class=\"hljs-comment\">// 等同于加了 defer 属性</span></span></span><br><span class=\"language-javascript\"><span class=\"language-xml\">  <span class=\"hljs-variable language_\">console</span>.<span class=\"hljs-title function_\">log</span>(<span class=\"hljs-number\">1</span>)</span></span><br><span class=\"language-javascript\"><span class=\"language-xml\"></span><span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">script</span>&gt;</span></span><br></code></pre></td></tr></table></figure>\n\n</li>\n</ul>\n<p>严格模式主要有以下限制：</p>\n<ul>\n<li>变量必须声明后再使用。</li>\n<li>函数的参数不能有同名属性，否则报错。</li>\n<li>不能使用with语句。</li>\n<li>不能对只读属性赋值，否则报错。</li>\n<li>不能使用前缀0表示八进制数，否则报错。</li>\n<li>不能删除不可删除的属性，否则报错。</li>\n<li>不能删除变量(delete prop)，会报错，只能删除属性(delete global[prop])。</li>\n<li>eval不会在其外层作用域引入变量。</li>\n<li>eval和arguments不能被重新赋值。</li>\n<li>arguments不会自动反映函数参数的变化。</li>\n<li>不能使用arguments.callee。</li>\n<li>不能使用arguments.caller。</li>\n<li>禁止this指向全局对象。</li>\n<li>不能使用fn.caller和fn.arguments获取函数调用的堆栈。</li>\n<li>增加了保留字（比如protected、static和interface）。</li>\n</ul>\n<h2 id=\"export-amp-import\"><a href=\"#export-amp-import\" class=\"headerlink\" title=\"export &amp; import\"></a>export &amp; import</h2><p>模块功能主要由两个命令构成：export和import。</p>\n<p>export命令用于规定模块的对外接口，import命令用于输入其他模块提供的功能。一个模块就是一个独立的文件。该文件内部的所有变量，外部无法获取。</p>\n<p>如果希望外部能够读取模块内部的某个变量，就必须使用export关键字输出该变量。</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\"><span class=\"hljs-comment\">// test.js</span><br><span class=\"hljs-keyword\">export</span> <span class=\"hljs-keyword\">const</span> myName = <span class=\"hljs-string\">&#x27;Hello_AlexCC&#x27;</span><br><br><span class=\"hljs-comment\">// 组合导出</span><br><span class=\"hljs-keyword\">const</span> myAge = <span class=\"hljs-number\">18</span><br><span class=\"hljs-keyword\">const</span> sayMe = <span class=\"hljs-keyword\">function</span>(<span class=\"hljs-params\"></span>) &#123;<br>  <span class=\"hljs-variable language_\">console</span>.<span class=\"hljs-title function_\">log</span>(<span class=\"hljs-string\">`my name is <span class=\"hljs-subst\">$&#123;myName&#125;</span>, and I&#x27;m <span class=\"hljs-subst\">$&#123;myAge&#125;</span> years old!`</span>)<br>&#125;<br><br><span class=\"hljs-keyword\">export</span> &#123;<br>  myAge,<br>  sayMe<br>&#125;<br></code></pre></td></tr></table></figure>\n\n<p>如果在一个模块中先输入后输出同一个模块，import语句可以与export语句写在一起。</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\"><span class=\"hljs-keyword\">export</span> &#123; sayName <span class=\"hljs-keyword\">as</span> <span class=\"hljs-keyword\">default</span>&#125; <span class=\"hljs-keyword\">from</span> <span class=\"hljs-string\">&#x27;./someModule&#x27;</span><br><br><span class=\"hljs-comment\">// 等价于</span><br><br><span class=\"hljs-keyword\">import</span> &#123; sayName &#125; <span class=\"hljs-keyword\">from</span> <span class=\"hljs-string\">&#x27;./someModule&#x27;</span><br><span class=\"hljs-keyword\">export</span> <span class=\"hljs-keyword\">default</span> sayName<br></code></pre></td></tr></table></figure>\n\n<p>另外，ES7有一个提案(<a href=\"https://github.com/leebyron/ecmascript-more-export-from)，简化先输入后输出的写法，拿掉了输出时的大括号。\">https://github.com/leebyron/ecmascript-more-export-from)，简化先输入后输出的写法，拿掉了输出时的大括号。</a></p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\"><span class=\"hljs-comment\">// 提案</span><br><span class=\"hljs-keyword\">export</span> v <span class=\"hljs-keyword\">from</span> <span class=\"hljs-string\">&#x27;mod&#x27;</span><br><br><span class=\"hljs-comment\">// 现在</span><br><span class=\"hljs-keyword\">export</span> &#123; v &#125; <span class=\"hljs-keyword\">from</span> <span class=\"hljs-string\">&#x27;mod&#x27;</span><br></code></pre></td></tr></table></figure>\n\n<p>import语句会执行所加载的模块</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\"><span class=\"hljs-keyword\">import</span> <span class=\"hljs-string\">&#x27;lodash&#x27;</span><br></code></pre></td></tr></table></figure>\n\n<h2 id=\"模块整体加载\"><a href=\"#模块整体加载\" class=\"headerlink\" title=\"模块整体加载\"></a>模块整体加载</h2><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\"><span class=\"hljs-keyword\">import</span> * <span class=\"hljs-keyword\">as</span> myModule <span class=\"hljs-keyword\">from</span> <span class=\"hljs-string\">&#x27;./myModule&#x27;</span><br></code></pre></td></tr></table></figure>\n\n<h2 id=\"module-命令\"><a href=\"#module-命令\" class=\"headerlink\" title=\"module 命令\"></a>module 命令</h2><p>module命令可以取代import语句，达到整体输入模块的作用。</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\"><span class=\"hljs-variable language_\">module</span> myModule <span class=\"hljs-keyword\">from</span> <span class=\"hljs-string\">&#x27;./myModule&#x27;</span><br><br>myModule.<span class=\"hljs-title function_\">sayName</span>()<br></code></pre></td></tr></table></figure>\n\n<h2 id=\"动态加载模块\"><a href=\"#动态加载模块\" class=\"headerlink\" title=\"动态加载模块\"></a>动态加载模块</h2><p>返回的是 Promise</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\"><span class=\"hljs-title function_\">import</span>(<span class=\"hljs-string\">&#x27;./moduleA.js&#x27;</span>).<span class=\"hljs-title function_\">then</span>(<span class=\"hljs-function\"><span class=\"hljs-params\">module</span> =&gt;</span> &#123;<br>  ...<br>&#125;)<br></code></pre></td></tr></table></figure>\n\n<h2 id=\"ES6模块加载的实质\"><a href=\"#ES6模块加载的实质\" class=\"headerlink\" title=\"ES6模块加载的实质\"></a>ES6模块加载的实质</h2><p>ES6模块加载的机制与CommonJS模块完全不同。</p>\n<p>CommonJS模块输出的是一个值的拷贝，而ES6模块输出的是 <code>值的引用</code>。</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\"><span class=\"hljs-comment\">// lib.js</span><br><span class=\"hljs-keyword\">export</span> <span class=\"hljs-keyword\">let</span> count = <span class=\"hljs-number\">1</span><br><span class=\"hljs-keyword\">export</span> <span class=\"hljs-keyword\">function</span> <span class=\"hljs-title function_\">incCount</span>(<span class=\"hljs-params\"></span>) &#123;<br>  count++<br>&#125;<br><br><span class=\"hljs-comment\">// main.js</span><br><span class=\"hljs-keyword\">import</span> &#123; count, incCount &#125; <span class=\"hljs-keyword\">from</span> <span class=\"hljs-string\">&#x27;./lib.js&#x27;</span><br><br><span class=\"hljs-variable language_\">console</span>.<span class=\"hljs-title function_\">log</span>(count) <span class=\"hljs-comment\">// 1</span><br><br><span class=\"hljs-title function_\">incCount</span>()<br><br><span class=\"hljs-variable language_\">console</span>.<span class=\"hljs-title function_\">log</span>(count) <span class=\"hljs-comment\">// 2</span><br></code></pre></td></tr></table></figure>\n\n\n<p>注意加上 type=”module”</p>\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs html\"><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">script</span> <span class=\"hljs-attr\">src</span>=<span class=\"hljs-string\">&quot;./main.js&quot;</span> <span class=\"hljs-attr\">type</span>=<span class=\"hljs-string\">&quot;module&quot;</span>&gt;</span><span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">script</span>&gt;</span><br></code></pre></td></tr></table></figure>\n\n<h2 id=\"ES-Module-in-NodeJS\"><a href=\"#ES-Module-in-NodeJS\" class=\"headerlink\" title=\"ES Module in NodeJS\"></a>ES Module in NodeJS</h2><p>如何在 Nodejs 中使用 ES module!</p>\n<p>有两个步骤：</p>\n<ol>\n<li><code>.js</code> 后缀都改为 <code>.mjs</code></li>\n<li>执行脚本时，加上 <code>node --experimental-modules main.mjs</code></li>\n</ol>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\"><span class=\"hljs-comment\">// node</span><br><br><span class=\"hljs-comment\">// main.mjs</span><br><span class=\"hljs-keyword\">import</span> fs <span class=\"hljs-keyword\">from</span> <span class=\"hljs-string\">&#x27;fs&#x27;</span><br><span class=\"hljs-keyword\">import</span> _ <span class=\"hljs-keyword\">from</span> <span class=\"hljs-string\">&#x27;lodash&#x27;</span><br></code></pre></td></tr></table></figure>\n\n<p>注意事项：</p>\n<ol>\n<li>在 node 环境中，我们可以使用 ES Module 导入 CommonJS 导出的成员</li>\n</ol>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\"><span class=\"hljs-comment\">// commonjs.js</span><br><span class=\"hljs-variable language_\">module</span>.<span class=\"hljs-property\">exports</span> = &#123;<br>  <span class=\"hljs-attr\">foo</span>: <span class=\"hljs-string\">&#x27;commonjs exports foo&#x27;</span><br>&#125;<br><br><span class=\"hljs-comment\">// esmodule.js</span><br><span class=\"hljs-keyword\">import</span> mod <span class=\"hljs-keyword\">from</span> <span class=\"hljs-string\">&#x27;./commonjs.js&#x27;</span><br><br><span class=\"hljs-variable language_\">console</span>.<span class=\"hljs-title function_\">log</span>(mod.<span class=\"hljs-property\">foo</span>)<br></code></pre></td></tr></table></figure>\n\n<ol start=\"2\">\n<li>在 node 环境中，CommonJS 中<code>不能</code>导入 ES Module 导出的成员</li>\n</ol>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\"><span class=\"hljs-keyword\">const</span> mod = <span class=\"hljs-built_in\">require</span>(<span class=\"hljs-string\">&#x27;./esmodule.js&#x27;</span>) <span class=\"hljs-comment\">// 报错</span><br></code></pre></td></tr></table></figure>\n\n<h2 id=\"CommonJS-与-ES-Module-差异\"><a href=\"#CommonJS-与-ES-Module-差异\" class=\"headerlink\" title=\"CommonJS 与 ES Module 差异\"></a>CommonJS 与 ES Module 差异</h2><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\"><span class=\"hljs-comment\">// CommonJS</span><br><br><span class=\"hljs-built_in\">require</span> <span class=\"hljs-comment\">// 加载模块函数</span><br><br><span class=\"hljs-variable language_\">module</span> <span class=\"hljs-comment\">// 模块对象</span><br><br><span class=\"hljs-built_in\">exports</span> <span class=\"hljs-comment\">// 导出对象别名 exports.name = &#x27;hello world&#x27;</span><br><br>__filename <span class=\"hljs-comment\">// 当前文件的绝对路径</span><br><br>__dirname <span class=\"hljs-comment\">// 当前文件所在目录</span><br></code></pre></td></tr></table></figure>\n\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\"><span class=\"hljs-comment\">// ES Module</span><br><br><span class=\"hljs-keyword\">import</span>.<span class=\"hljs-property\">meta</span>.<span class=\"hljs-property\">url</span> <span class=\"hljs-comment\">// 文件路径信息</span><br><br><span class=\"hljs-comment\">// 可以通过内置模块 url 和 path 处理，拿到 __filename 和 __dirname</span><br><span class=\"hljs-keyword\">import</span> &#123; fileURLToPath &#125; <span class=\"hljs-keyword\">from</span> <span class=\"hljs-string\">&#x27;url&#x27;</span><br><span class=\"hljs-keyword\">import</span> &#123; dirname &#125; <span class=\"hljs-keyword\">from</span> <span class=\"hljs-string\">&#x27;path&#x27;</span><br><br><span class=\"hljs-keyword\">const</span> __filename = <span class=\"hljs-title function_\">fileURLToPath</span>(<span class=\"hljs-keyword\">import</span>.<span class=\"hljs-property\">meta</span>.<span class=\"hljs-property\">url</span>)<br><span class=\"hljs-keyword\">const</span> __dirname = <span class=\"hljs-title function_\">dirname</span>(__filename)<br></code></pre></td></tr></table></figure>\n\n<h2 id=\"高版本-NodeJS-已支持-ESM-Version-gt-12-10-0\"><a href=\"#高版本-NodeJS-已支持-ESM-Version-gt-12-10-0\" class=\"headerlink\" title=\"高版本 NodeJS 已支持 ESM (Version &gt; 12.10.0)\"></a>高版本 NodeJS 已支持 ESM (Version &gt; 12.10.0)</h2><p>不需要再写 <code>.mjs</code> 结尾了，直接 <code>.js</code></p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\"><span class=\"hljs-comment\">// package.json</span><br>&#123;<br>  <span class=\"hljs-string\">&quot;type&quot;</span>: <span class=\"hljs-string\">&quot;module&quot;</span><br>&#125;<br><br><span class=\"hljs-comment\">// 执行</span><br>node --experimental-modules main.<span class=\"hljs-property\">js</span> <br></code></pre></td></tr></table></figure>\n\n<p>加上 type module 配置之后，如果我们还想用 <code>CommonJS</code> 规范，发现会报错了。因为我们已经使用了 ESM。</p>\n<p>如果继续使用 <code>CommonJS</code> 规范，那么就需要将 <code>.js</code> 改为 <code>.cjs</code>。</p>\n<h2 id=\"ESM-in-NodeJS-（babel-兼容方案）\"><a href=\"#ESM-in-NodeJS-（babel-兼容方案）\" class=\"headerlink\" title=\"ESM in NodeJS （babel 兼容方案）\"></a>ESM in NodeJS （babel 兼容方案）</h2><blockquote>\n<p>yarn add @babel/node @babel/preset-env –save-dev</p>\n</blockquote>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\"><span class=\"hljs-comment\">// 通过 babel-node 命令执行脚本</span><br>yarn babel-node main.<span class=\"hljs-property\">js</span><br></code></pre></td></tr></table></figure>\n\n<p>要注意的是，<code>babel/core</code> 并不会转换我们的代码，转换代码的工作交给 babel 内置的插件去实现的。也就是说，我们需要一个插件，去转换 ES6 中的一个新特性。</p>\n<img src=\"./img/babel.jpg\" />\n\n<p>而 <code>@bable/preset-env</code> 是插件的集合，所以不需要每个插件都安装一遍。</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\"><span class=\"hljs-comment\">// 命令行使用</span><br>yarn babel-node main.<span class=\"hljs-property\">js</span> --presets=@bable/preset-env<br></code></pre></td></tr></table></figure>\n\n<p>结合 babel 配置文件使用</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\"><span class=\"hljs-comment\">// .babelrc</span><br>&#123;<br>  <span class=\"hljs-string\">&quot;presets&quot;</span>: [<span class=\"hljs-string\">&quot;@babel/presets-env&quot;</span>]<br>&#125;<br><br>yarn babel-node main.<span class=\"hljs-property\">js</span><br></code></pre></td></tr></table></figure>\n\n<p>既然 <code>@babel/preset-env</code> 是插件的集合，而我不想要那么多，只是想处理 <code>ESM</code> 怎么办呢？</p>\n<p>我们卸载掉 <code>@babel/preset-env</code>，安装 <code>@babel/plugin-transform-modules-commonjs</code></p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\"><span class=\"hljs-comment\">// .babelrc</span><br>&#123;<br>  <span class=\"hljs-string\">&quot;presets&quot;</span>: [<span class=\"hljs-string\">&quot;@babel/plugin-transform-modules-commonjs&quot;</span>]<br>&#125;<br><br>yarn babel-node main.<span class=\"hljs-property\">js</span><br></code></pre></td></tr></table></figure>\n\n<h1 id=\"babel\"><a href=\"#babel\" class=\"headerlink\" title=\"babel\"></a>babel</h1><blockquote>\n<p>编译器</p>\n</blockquote>\n<p>主要用于将ES6版本的JS代码转换为ES5等向后兼容的JS代码，从而使代码可以运行在低版本浏览器或其他环境中。</p>\n<blockquote>\n<p>npm install –save-dev babel-core babel-preset-es2015 babel-preset-latest –registry=<a href=\"https://registry.npm.taobao.org\">https://registry.npm.taobao.org</a></p>\n</blockquote>\n<p>配置文件 <code>.babelrc</code>（或者 babel.config.js || .babelrc.js）</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\">&#123;<br>  <span class=\"hljs-string\">&quot;presets&quot;</span>: [<span class=\"hljs-string\">&quot;es2015&quot;</span>, <span class=\"hljs-string\">&quot;latest&quot;</span>], <span class=\"hljs-comment\">// 安装包的别名，用来处理最新的 ES6 语法</span><br>  <span class=\"hljs-string\">&quot;plugins&quot;</span>: []<br>&#125;<br></code></pre></td></tr></table></figure>\n\n<p>安装 <code>babel-cli</code>，命令行编译工具，依赖 <code>babel/core</code></p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\">npm install --save-dev babel-cli <br></code></pre></td></tr></table></figure>\n\n<p>查看 babel 版本（npx 是新版 NodeJS 附带的命令）</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\">npx babel --version <span class=\"hljs-comment\">// ===== node_modules/.bin/babel --version </span><br><br><span class=\"hljs-comment\">// ====&gt; 6.26.0 (babel-core 6.26.3)</span><br></code></pre></td></tr></table></figure>\n\n<p>到这里，我们就可以使用 babel 来编译js 文件了。创建一个 babel.js 文件，写入一些 es6 的语法。</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\"><span class=\"hljs-comment\">// babel.js</span><br><br><span class=\"hljs-keyword\">const</span> <span class=\"hljs-title function_\">foo</span> = (<span class=\"hljs-params\"></span>) =&gt; &#123;<br>  <span class=\"hljs-keyword\">return</span> <span class=\"hljs-number\">3</span> * <span class=\"hljs-number\">3</span><br>&#125;<br><br><span class=\"hljs-keyword\">const</span> count = <span class=\"hljs-number\">123</span><br></code></pre></td></tr></table></figure>\n\n<p>打开命令行工具：</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\">npx babel babel.<span class=\"hljs-property\">js</span> -o compiled.<span class=\"hljs-property\">js</span> <span class=\"hljs-comment\">// 等效 node_modules/.bin/babel babel.js -o compiled.js </span><br></code></pre></td></tr></table></figure>\n\n<p>转化后的结果：</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\"><span class=\"hljs-meta\">&quot;use strict&quot;</span>;<br><br><span class=\"hljs-keyword\">var</span> foo = <span class=\"hljs-keyword\">function</span> <span class=\"hljs-title function_\">foo</span>(<span class=\"hljs-params\"></span>) &#123;<br>  <span class=\"hljs-keyword\">return</span> <span class=\"hljs-number\">3</span> * <span class=\"hljs-number\">3</span>;<br>&#125;;<br><br><span class=\"hljs-keyword\">var</span> count = <span class=\"hljs-number\">123</span>;<br></code></pre></td></tr></table></figure>\n\n<h2 id=\"Polyfill\"><a href=\"#Polyfill\" class=\"headerlink\" title=\"Polyfill\"></a>Polyfill</h2><p>Babel默认只转换新的JS语法（syntax），而不转换新的API（Promise、Map）。如果只是做语法转换，Promise 是不会被降级的，在低版本的浏览器中可能无法使用。</p>\n<p>引入 Polyfill，为当前环境提供一个“垫片”。所谓“垫片”，是指垫平不同浏览器之间差异的东西。polyfill提供了全局的ES6对象及通过修改原型链Array.prototype等来补充对实例的实现。</p>\n<h2 id=\"babel-版本\"><a href=\"#babel-版本\" class=\"headerlink\" title=\"babel 版本\"></a>babel 版本</h2><p>Babel版本主要是Babel 6和Babel 7这两个版本。</p>\n<p>提到Babel版本的时候，通常指的是@babel/core这个Babel核心包的版本。</p>\n<p>Babel 7的npm包都存放在babel域下，即在安装npm包的时候，我们安装的是名称以@babel/开头的npm包，如@babel/cli、@babel/core等。而在Babel 6中，我们安装的包名是babel-cli、babel-core等以babel-开头的npm包。其实它们本质上是一样的，都是Babel官方提供的cli命令行工具和core核心包。在平时开发和学习的过程中，碰到@babel/和babel-时应该认识到它俩是作用相同、内容接近的包，只是版本不一样而已。</p>\n<h2 id=\"babel-配置文件\"><a href=\"#babel-配置文件\" class=\"headerlink\" title=\"babel 配置文件\"></a>babel 配置文件</h2><blockquote>\n<p>指定编译的规则。</p>\n</blockquote>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\">.<span class=\"hljs-property\">babelrc</span> || babel.<span class=\"hljs-property\">config</span>.<span class=\"hljs-property\">js</span> || .<span class=\"hljs-property\">babelrc</span>.<span class=\"hljs-property\">js</span> || package.<span class=\"hljs-property\">json</span>（配置 babel 属性，配置项都是 一样的）<br></code></pre></td></tr></table></figure>\n\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\"><span class=\"hljs-comment\">// package.json</span><br><br>&#123;<br>  ...<br><br>  <span class=\"hljs-attr\">babel</span>: &#123;<br>    <span class=\"hljs-string\">&quot;presets&quot;</span>: [<span class=\"hljs-string\">&quot;es2015&quot;</span>, <span class=\"hljs-string\">&quot;react&quot;</span>],<br>    <span class=\"hljs-string\">&quot;plugin&quot;</span>: [<span class=\"hljs-string\">&quot;transform-class-properties&quot;</span>]<br>  &#125;,<br><br>  ...<br>&#125;<br></code></pre></td></tr></table></figure>\n\n<p>推荐使用后缀名是js的配置文件来进行配置，因为可以使用该文件做一些逻辑处理，适用性更强。</p>\n<h2 id=\"插件-amp-预设\"><a href=\"#插件-amp-预设\" class=\"headerlink\" title=\"插件 &amp; 预设\"></a>插件 &amp; 预设</h2><p>plugin代表插件，preset代表预设。通常每个插件或预设都是一个npm包。</p>\n<p>Babel的插件实在太多了，假如只配置插件数组，那我们前端工程要把ES2015、ES2016、ES2017……下的所有插件都写到配置项里，这样的Babel配置文件会非常臃肿。</p>\n<p>preset预设就是帮我们解决这个问题的。预设是一组Babel插件的集合，通俗的说法就是插件包，例如babel-preset-es2015就是所有处理ES2015的二十多个Babel插件的集合。这样我们就不用写一大堆插件配置项了，只需要用一个预设代替就可以。另外，预设也可以是插件和其他预设的集合。</p>\n<p>Babel官方已经针对常用的环境做了如下这些preset包。</p>\n<p>1）@babel/preset-env.</p>\n<p>2）@babel/preset-react.</p>\n<p>3）@babel/preset-typescript.</p>\n<p>4）@babel/preset-stage-0.</p>\n<p>5）@babel/preset-stage-1.</p>\n<h2 id=\"插件与预设的简称\"><a href=\"#插件与预设的简称\" class=\"headerlink\" title=\"插件与预设的简称\"></a>插件与预设的简称</h2><p>如果插件的npm包名称的前缀为babel-plugin-，则可以省略其前缀。</p>\n<p>如果npm包名称的前缀带有npm作用域@，如@org/babel-plugin-xxx，则短名称可以写成@org/xxx。</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\">&#123;<br>  <span class=\"hljs-string\">&quot;plugins&quot;</span>: [<span class=\"hljs-string\">&quot;babel-plugin-transform-decorators-legacy&quot;</span>]<br>&#125;<br><br><span class=\"hljs-comment\">// =====</span><br><br>&#123;<br>  <span class=\"hljs-string\">&quot;plugins&quot;</span>: [<span class=\"hljs-string\">&quot;transform-decorators-legacy&quot;</span>]<br>&#125;<br></code></pre></td></tr></table></figure>\n\n<p>预设的短名称规则与插件的类似，预设npm包名称的前缀为babel-preset-或作用域@xxx/babel-preset-xxx的可以省略掉babel-preset-。</p>\n<h2 id=\"插件和预设执行顺序\"><a href=\"#插件和预设执行顺序\" class=\"headerlink\" title=\"插件和预设执行顺序\"></a>插件和预设执行顺序</h2><p>plugins插件数组和presets预设数组是有顺序要求的。如果两个插件或预设都要处理同一个代码片段，那么会根据插件和预设的顺序来执行。规则如下:</p>\n<p>1）插件比预设先执行。</p>\n<p>2）插件执行顺序是插件数组元素从前向后依次执行。</p>\n<p>3）预设执行顺序是预设数组元素从后向前依次执行。</p>\n<h2 id=\"预设的选择\"><a href=\"#预设的选择\" class=\"headerlink\" title=\"预设的选择\"></a>预设的选择</h2><p>babel-preset-latest，在Babel 6时期，是所有年代preset的集合，在Babel 6最后一个版本中，它是babel-preset-es2015、babel-preset-es2016、babel-preset-es2017的集合。</p>\n<p>@babel/preset-env<code>包含了babel-preset-latest的功能，并对其进行了增强</code>，现在@babel/preset-env完全可以替代babel-preset-latest。</p>\n<p>Babel 6 中是babel-preset-env，Babel 7版本开始，@babel/preset-env。</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\"><span class=\"hljs-comment\">// babel 6</span><br>npm install babel-preset-env --save-dev<br><br><span class=\"hljs-comment\">// .babelrc</span><br>&#123;<br>  <span class=\"hljs-string\">&quot;presets&quot;</span>: [<span class=\"hljs-string\">&quot;env&quot;</span>]<br>&#125;<br><br><span class=\"hljs-comment\">// babel 7</span><br>npm install @babel/preset-env --save-dev<br><br><span class=\"hljs-comment\">// .babelrc</span><br>&#123;<br>  <span class=\"hljs-string\">&quot;presets&quot;</span>: [<span class=\"hljs-string\">&quot;@babel/env&quot;</span>]<br>&#125;<br></code></pre></td></tr></table></figure>\n\n<p>总结起来，Babel官方提供的预设，我们实际会用到的其实就只有四个。</p>\n<p>1）@babel/preset-env.</p>\n<p>2）@babel/preset-flow.</p>\n<p>3）@babel/preset-react.</p>\n<p>4）@babel/preset-typescript.</p>\n<h2 id=\"插件的选择\"><a href=\"#插件的选择\" class=\"headerlink\" title=\"插件的选择\"></a>插件的选择</h2><p>Babel 7 官方有九十多个插件，不过其中大多数都已经整合在@babel/preset-env和@babel/preset-react等预设里了，我们在开发的时候直接使用预设就可以。</p>\n<p>目前比较常用的插件只有@babel/plugin-transform-runtime。</p>\n<h2 id=\"browserslist\"><a href=\"#browserslist\" class=\"headerlink\" title=\"browserslist\"></a>browserslist</h2><p>在 package.json 中经常遇到这个配置项：</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\"><span class=\"hljs-comment\">// package.json</span><br><br>&#123;<br>  <span class=\"hljs-string\">&quot;browserslist&quot;</span>: [<br>    <span class=\"hljs-string\">&quot;&gt; 1%&quot;</span>,<br>    <span class=\"hljs-string\">&quot;not ie &lt;= 8&quot;</span><br>  ]<br>&#125;<br></code></pre></td></tr></table></figure>\n<p>上面配置的含义是，该项目工程的目标环境是市场份额大于1%的浏览器并且不考虑IE 8及以下的IE浏览器。</p>\n<p>browserslist叫作目标环境配置表，除了写在package.json文件里，也可以单独写在工程目录下的.browserslistrc文件里。</p>\n<p>我们写一个含有箭头函数的 js 文件，如果我们在browserslist里指定目标环境是Chrome 60浏览器，再来看一下转换结果:</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\"><span class=\"hljs-comment\">// package.json</span><br>&#123;<br>  <span class=\"hljs-string\">&quot;browserslist&quot;</span>: [<span class=\"hljs-string\">&quot;chrome 60&quot;</span>]<br>&#125;<br></code></pre></td></tr></table></figure>\n<p>我们发现转换后的代码仍然是箭头函数，因为Chrome 60浏览器已经实现了箭头函数语法，所以不会转换成ES5的函数定义语法。</p>\n<h2 id=\"babel-runtime\"><a href=\"#babel-runtime\" class=\"headerlink\" title=\"@babel/runtime\"></a>@babel/runtime</h2><p>我们写个 js 文件，里面包含 es6 的 class 语法:</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\"><span class=\"hljs-keyword\">class</span> <span class=\"hljs-title class_\">Person</span> &#123;<br>  <span class=\"hljs-title function_\">sayName</span>(<span class=\"hljs-params\"></span>) &#123;<br>    <span class=\"hljs-title function_\">alert</span>(<span class=\"hljs-variable language_\">this</span>.<span class=\"hljs-property\">name</span>)<br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure>\n\n<p>然后执行 babel 命令，查看转换后的结果 <code>npx babel babel.js -o compiled.js</code></p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\"><span class=\"hljs-meta\">&quot;use strict&quot;</span>;<br><br><span class=\"hljs-keyword\">var</span> _createClass = <span class=\"hljs-keyword\">function</span> (<span class=\"hljs-params\"></span>) &#123; <span class=\"hljs-keyword\">function</span> <span class=\"hljs-title function_\">defineProperties</span>(<span class=\"hljs-params\">target, props</span>) &#123; <span class=\"hljs-keyword\">for</span> (<span class=\"hljs-keyword\">var</span> i = <span class=\"hljs-number\">0</span>; i &lt; props.<span class=\"hljs-property\">length</span>; i++) &#123; <span class=\"hljs-keyword\">var</span> descriptor = props[i]; descriptor.<span class=\"hljs-property\">enumerable</span> = descriptor.<span class=\"hljs-property\">enumerable</span> || <span class=\"hljs-literal\">false</span>; descriptor.<span class=\"hljs-property\">configurable</span> = <span class=\"hljs-literal\">true</span>; <span class=\"hljs-keyword\">if</span> (<span class=\"hljs-string\">&quot;value&quot;</span> <span class=\"hljs-keyword\">in</span> descriptor) descriptor.<span class=\"hljs-property\">writable</span> = <span class=\"hljs-literal\">true</span>; <span class=\"hljs-title class_\">Object</span>.<span class=\"hljs-title function_\">defineProperty</span>(target, descriptor.<span class=\"hljs-property\">key</span>, descriptor); &#125; &#125; <span class=\"hljs-keyword\">return</span> <span class=\"hljs-keyword\">function</span> (<span class=\"hljs-params\">Constructor, protoProps, staticProps</span>) &#123; <span class=\"hljs-keyword\">if</span> (protoProps) <span class=\"hljs-title function_\">defineProperties</span>(<span class=\"hljs-title class_\">Constructor</span>.<span class=\"hljs-property\"><span class=\"hljs-keyword\">prototype</span></span>, protoProps); <span class=\"hljs-keyword\">if</span> (staticProps) <span class=\"hljs-title function_\">defineProperties</span>(<span class=\"hljs-title class_\">Constructor</span>, staticProps); <span class=\"hljs-keyword\">return</span> <span class=\"hljs-title class_\">Constructor</span>; &#125;; &#125;();<br><br><span class=\"hljs-keyword\">function</span> <span class=\"hljs-title function_\">_classCallCheck</span>(<span class=\"hljs-params\">instance, Constructor</span>) &#123; <span class=\"hljs-keyword\">if</span> (!(instance <span class=\"hljs-keyword\">instanceof</span> <span class=\"hljs-title class_\">Constructor</span>)) &#123; <span class=\"hljs-keyword\">throw</span> <span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">TypeError</span>(<span class=\"hljs-string\">&quot;Cannot call a class as a function&quot;</span>); &#125; &#125;<br><br><span class=\"hljs-keyword\">var</span> <span class=\"hljs-title class_\">Person</span> = <span class=\"hljs-keyword\">function</span> (<span class=\"hljs-params\"></span>) &#123;<br>  <span class=\"hljs-keyword\">function</span> <span class=\"hljs-title function_\">Person</span>(<span class=\"hljs-params\"></span>) &#123;<br>    <span class=\"hljs-title function_\">_classCallCheck</span>(<span class=\"hljs-variable language_\">this</span>, <span class=\"hljs-title class_\">Person</span>);<br>  &#125;<br><br>  <span class=\"hljs-title function_\">_createClass</span>(<span class=\"hljs-title class_\">Person</span>, [&#123;<br>    <span class=\"hljs-attr\">key</span>: <span class=\"hljs-string\">&quot;sayName&quot;</span>,<br>    <span class=\"hljs-attr\">value</span>: <span class=\"hljs-keyword\">function</span> <span class=\"hljs-title function_\">sayName</span>(<span class=\"hljs-params\"></span>) &#123;<br>      <span class=\"hljs-title function_\">alert</span>(<span class=\"hljs-variable language_\">this</span>.<span class=\"hljs-property\">name</span>);<br>    &#125;<br>  &#125;]);<br><br>  <span class=\"hljs-keyword\">return</span> <span class=\"hljs-title class_\">Person</span>;<br>&#125;();<br></code></pre></td></tr></table></figure>\n\n<p>可以看到，转换后的代码上部增加了好几个函数声明，这些函数是Babel转码时注入的，我们称之为辅助函数。@babel/preset-env在做语法转换的时候，注入了这些函数声明，以便语法转换后使用。</p>\n<p>但这样做存在一个问题。在我们正常地进行前端工程开发的时候，少则有几十个JS文件，多则有上千个。如果每个文件里都使用了class类语法，那么会导致每个转换后的代码上部都会注入这些相同的函数声明。这会导致我们用构建工具打包出来的包体积非常大。</p>\n<p>那么应该怎么办呢？一个思路就是，我们把这些函数声明都放在一个npm包里，需要使用的时候直接从这个包里引入我们的文件。这样即使有上千个文件，也会从相同的包里引入这些函数。使用Webpack这一类的构建工具进行打包时，我们只需要引入一次npm包里的函数，这样就做到了复用，减小了包的体积。</p>\n<p><code>@babel/runtime</code> 就是上面说的这个npm包，<strong>@babel/runtime把所有语法转换会用到的辅助函数都集中在了一起。</strong></p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\"><span class=\"hljs-comment\">// babbel 6</span><br>npm install babel-runtime --save-dev <span class=\"hljs-comment\">// /node_modules/babel-runtime/helpers/createClass.js</span><br><br><span class=\"hljs-comment\">// babel 7</span><br>npm install @babel/runtime@<span class=\"hljs-number\">7.12</span><span class=\"hljs-number\">.5</span> --save-dev<br></code></pre></td></tr></table></figure>\n\n<p>然后到node_modules目录下看一下这个包的结构，找到 _classCallCheck、_defineProperties与_createClass这三个辅助函数的位置，我们直接引入即可。</p>\n<p>这时，我们就可以替换转换后自动创建的方法，而是使用 @babel/runtime/helpers 中已有的方法。</p>\n<p>不过，这么多辅助函数要一个个记住并手动引入，是很难做到的。这时Babel插件 <code>@babel/plugin-transform-runtime</code> 就可以用来帮我们解决这个问题。</p>\n<h2 id=\"babel-plugin-transform-runtime\"><a href=\"#babel-plugin-transform-runtime\" class=\"headerlink\" title=\"@babel/plugin-transform-runtime\"></a>@babel/plugin-transform-runtime</h2><p>辅助函数的自动引入。</p>\n<p>@babel/plugin-transform-runtime有三大作用，其中之一就是自动移除语法转换后内联的辅助函数（inline Babel helpers），而是使用@babel/runtime/helpers里的辅助函数来替代，这样就减少了我们手动引入的麻烦。</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\"><span class=\"hljs-comment\">// babel6</span><br>npm install babel-plugin-transform-runtime --save-dev<br><br><span class=\"hljs-comment\">// babel 7</span><br>npm install @babel/plugin-transform-runtime@<span class=\"hljs-number\">7.12</span><span class=\"hljs-number\">.10</span> --save-dev<br></code></pre></td></tr></table></figure>\n\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\">&#123;<br>  <span class=\"hljs-string\">&quot;plugins&quot;</span>: [<span class=\"hljs-string\">&quot;@babel/plugin-transform-runtime&quot;</span>] <span class=\"hljs-comment\">// babel 6: &quot;babel-plugin-transform-runtime&quot;</span><br>&#125;<br></code></pre></td></tr></table></figure>\n\n<p>还是上面的例子，我们再看看转换后的结果，会发现插件已经自动帮我们处理了。</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\"><span class=\"hljs-meta\">&quot;use strict&quot;</span>;<br><br><span class=\"hljs-keyword\">var</span> _classCallCheck2 = <span class=\"hljs-built_in\">require</span>(<span class=\"hljs-string\">&quot;babel-runtime/helpers/classCallCheck&quot;</span>);<br><br><span class=\"hljs-keyword\">var</span> _classCallCheck3 = <span class=\"hljs-title function_\">_interopRequireDefault</span>(_classCallCheck2);<br><br><span class=\"hljs-keyword\">var</span> _createClass2 = <span class=\"hljs-built_in\">require</span>(<span class=\"hljs-string\">&quot;babel-runtime/helpers/createClass&quot;</span>);<br><br><span class=\"hljs-keyword\">var</span> _createClass3 = <span class=\"hljs-title function_\">_interopRequireDefault</span>(_createClass2);<br><br><span class=\"hljs-keyword\">function</span> <span class=\"hljs-title function_\">_interopRequireDefault</span>(<span class=\"hljs-params\">obj</span>) &#123; <span class=\"hljs-keyword\">return</span> obj &amp;&amp; obj.<span class=\"hljs-property\">__esModule</span> ? obj : &#123; <span class=\"hljs-attr\">default</span>: obj &#125;; &#125;<br><br><span class=\"hljs-keyword\">var</span> <span class=\"hljs-title class_\">Person</span> = <span class=\"hljs-keyword\">function</span> (<span class=\"hljs-params\"></span>) &#123;<br>  <span class=\"hljs-keyword\">function</span> <span class=\"hljs-title function_\">Person</span>(<span class=\"hljs-params\"></span>) &#123;<br>    (<span class=\"hljs-number\">0</span>, _classCallCheck3.<span class=\"hljs-property\">default</span>)(<span class=\"hljs-variable language_\">this</span>, <span class=\"hljs-title class_\">Person</span>);<br>  &#125;<br><br>  (<span class=\"hljs-number\">0</span>, _createClass3.<span class=\"hljs-property\">default</span>)(<span class=\"hljs-title class_\">Person</span>, [&#123;<br>    <span class=\"hljs-attr\">key</span>: <span class=\"hljs-string\">&quot;sayName&quot;</span>,<br>    <span class=\"hljs-attr\">value</span>: <span class=\"hljs-keyword\">function</span> <span class=\"hljs-title function_\">sayName</span>(<span class=\"hljs-params\"></span>) &#123;<br>      <span class=\"hljs-title function_\">alert</span>(<span class=\"hljs-variable language_\">this</span>.<span class=\"hljs-property\">name</span>);<br>    &#125;<br>  &#125;]);<br>  <span class=\"hljs-keyword\">return</span> <span class=\"hljs-title class_\">Person</span>;<br>&#125;();<br></code></pre></td></tr></table></figure>\n\n<p>实际进行前端开发时，我们除了安装@babel/runtime包，基本也会安装@babel/plugin-transform-runtime这个Babel插件。</p>\n<h1 id=\"Babel-原理与插件开发\"><a href=\"#Babel-原理与插件开发\" class=\"headerlink\" title=\"Babel 原理与插件开发\"></a>Babel 原理与插件开发</h1><p>Babel的转码过程主要由三个阶段组成：解析（parse）、转换（transform）和生成（generate）。这三个阶段分别由@babel/parser、@babel/core和@babel/generator来完成。</p>\n<ol>\n<li><strong>解析阶段</strong></li>\n</ol>\n<p>该阶段由Babel读取源码并生成抽象语法树（AST），该阶段由两部分组成：词法分析与语法分析。</p>\n<p>词法分析会将字符串形式的代码转换成tokens流，语法分析会将tokens流转换成AST。</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\"><span class=\"hljs-keyword\">const</span> name = <span class=\"hljs-string\">&quot;hello AlexCc&quot;</span><br></code></pre></td></tr></table></figure>\n\n<p>AST</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\">-<br>#<span class=\"hljs-number\">1</span><br>  <span class=\"hljs-attr\">type</span>: <span class=\"hljs-title class_\">VariableDeclaration</span><br>  declarations<br>    #<span class=\"hljs-number\">1</span><br>    <span class=\"hljs-attr\">type</span>: <span class=\"hljs-title class_\">VariableDeclarator</span><br>    id<br>      <span class=\"hljs-attr\">type</span>: <span class=\"hljs-title class_\">Identifier</span><br>      <span class=\"hljs-attr\">name</span>: name<br>    init<br>      <span class=\"hljs-attr\">type</span>: <span class=\"hljs-title class_\">Literal</span><br>      <span class=\"hljs-attr\">value</span>: hello <span class=\"hljs-title class_\">AlexCc</span><br>      <span class=\"hljs-attr\">raw</span>: <span class=\"hljs-string\">&quot;hello AlexCc&quot;</span><br>    <span class=\"hljs-attr\">kind</span>: <span class=\"hljs-keyword\">const</span><br></code></pre></td></tr></table></figure>\n\n<ol start=\"2\">\n<li><strong>转换阶段</strong></li>\n</ol>\n<p>完成了解析工作，生成了AST，AST是一个树状的JSON结构。接下来就可以通过Babel插件对该树状结构执行修改操作，修改完成后就得到了新的AST。</p>\n<ol start=\"3\">\n<li><strong>生成阶段</strong></li>\n</ol>\n<p>通过转换阶段的工作，我们得到了新的AST。在生成阶段，我们对AST的树状JSON结构进行还原操作，生成新的JS代码，通常这就是我们需要的ES5代码。</p>\n<h2 id=\"Babel-插件开发\"><a href=\"#Babel-插件开发\" class=\"headerlink\" title=\"Babel 插件开发\"></a>Babel 插件开发</h2><blockquote>\n<p>babel-handbook</p>\n<p><a href=\"https://github.com/jamiebuilds/babel-handbook/blob/master/translations/zh-Hans/plugin-handbook.md\">https://github.com/jamiebuilds/babel-handbook/blob/master/translations/zh-Hans/plugin-handbook.md</a></p>\n</blockquote>\n<p>开发Babel转码插件的重点是在第二阶段（转换阶段），在这一阶段我们要从AST上找出需要转换的节点，改成我们需要的形式，最后在生成阶段把AST变回JS代码。</p>\n<p>插件模板结构:</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\"><span class=\"hljs-variable language_\">module</span>.<span class=\"hljs-property\">exports</span> = <span class=\"hljs-keyword\">function</span>(<span class=\"hljs-params\">&#123; types: t &#125;</span>) &#123;<br>  <span class=\"hljs-keyword\">return</span> &#123;<br>    <span class=\"hljs-attr\">name</span>: <span class=\"hljs-string\">&#x27;pluginName&#x27;</span>,<br>    <span class=\"hljs-attr\">visitor</span>: &#123;&#125;<br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure>\n\n<p>假设我们有这样一段代码：</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\"><span class=\"hljs-keyword\">const</span> dog = <span class=\"hljs-string\">&#x27;is dog&#x27;</span><br></code></pre></td></tr></table></figure>\n\n<p>现在我想将 dog 变成喵咪。</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\"><span class=\"hljs-variable language_\">module</span>.<span class=\"hljs-property\">exports</span> = <span class=\"hljs-keyword\">function</span>(<span class=\"hljs-params\">&#123; types: t &#125;</span>) &#123;<br>  <span class=\"hljs-keyword\">return</span> &#123;<br>    <span class=\"hljs-attr\">visitor</span>: &#123;<br>      <span class=\"hljs-title class_\">Identifier</span>(path, state) &#123;<br>        <span class=\"hljs-keyword\">if</span> (path.<span class=\"hljs-property\">node</span>.<span class=\"hljs-property\">name</span> === <span class=\"hljs-string\">&#x27;dog&#x27;</span>) &#123;<br>          path.<span class=\"hljs-property\">node</span>.<span class=\"hljs-property\">name</span> = <span class=\"hljs-string\">&#x27;cat&#x27;</span><br>          path.<span class=\"hljs-property\">parent</span>.<span class=\"hljs-property\">init</span>.<span class=\"hljs-property\">value</span> = <span class=\"hljs-string\">&#x27;is cat&#x27;</span><br>        &#125;<br>      &#125;,<br>      <span class=\"hljs-keyword\">var</span><br>    &#125;<br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure>\n\n<p>转换后：</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\"><span class=\"hljs-keyword\">const</span> cat = <span class=\"hljs-string\">&#x27;is cat&#x27;</span>;<br></code></pre></td></tr></table></figure>\n\n<p>我们编写Babel插件的主要工作就是修改<code>visitor</code>对象，该对象是遍历AST各个节点的方法。</p>\n<p>在上面的插件里，要把变量名dog修改为cat，于是我们修改了visitor.Identifier方法，那我们如何知道要修改的是Identifier方法呢？</p>\n<p>Babel原理里讲过Babel转码的三个阶段：解析阶段、转换阶段和生成阶段，我们编写的Babel插件实际上是在执行第二个阶段（转换阶段）的工作，该工作需要前一个阶段解析工作先完成。在解析阶段，我们得到了转码前代码的AST树状结构信息，该AST上会有Identifier等节点信息，我们编写插件的时候参考该AST的信息即可。</p>\n<img src=\"./img/ast.jpg\" />\n\n<p>接着看Identifier方法，可以看到它有两个参数path和state，visitor中的每个方法都接收这两个参数，path代表路径。最后我们判断path上节点信息name是不是dog，是的话把它修改为cat即可。</p>\n<p>同理，我们也可以修改 <code>const</code>、<code>value</code>：</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\"><span class=\"hljs-variable language_\">module</span>.<span class=\"hljs-property\">exports</span> = <span class=\"hljs-keyword\">function</span>(<span class=\"hljs-params\">&#123; types: t &#125;</span>) &#123;<br>  <span class=\"hljs-keyword\">return</span> &#123;<br>    <span class=\"hljs-attr\">visitor</span>: &#123;<br>      <span class=\"hljs-title class_\">Identifier</span>(path, state) &#123;<br>        path.<span class=\"hljs-property\">node</span>.<span class=\"hljs-property\">name</span> = <span class=\"hljs-string\">&#x27;cat&#x27;</span><br>        path.<span class=\"hljs-property\">parent</span>.<span class=\"hljs-property\">init</span>.<span class=\"hljs-property\">value</span> = <span class=\"hljs-string\">&#x27;is cat&#x27;</span><br>      &#125;,<br>      <span class=\"hljs-title class_\">VariableDeclaration</span>(path, state) &#123;<br>        <span class=\"hljs-keyword\">if</span> (path.<span class=\"hljs-property\">node</span>.<span class=\"hljs-property\">kind</span> === <span class=\"hljs-string\">&#x27;const&#x27;</span>) &#123;<br>          path.<span class=\"hljs-property\">node</span>.<span class=\"hljs-property\">kind</span> = <span class=\"hljs-string\">&#x27;let&#x27;</span><br>        &#125;<br>      &#125;,<br>      <span class=\"hljs-title class_\">Literal</span>(path, state) &#123;<br>        <span class=\"hljs-comment\">// 修改 value</span><br>        path.<span class=\"hljs-property\">node</span>.<span class=\"hljs-property\">value</span> = <span class=\"hljs-string\">&#x27;is caaat...&#x27;</span><br>      &#125;<br>    &#125;<br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure>\n\n<h2 id=\"插件传参\"><a href=\"#插件传参\" class=\"headerlink\" title=\"插件传参\"></a>插件传参</h2><p>给插件传递参数，注意第一个成员变成了数组，数组的第二项是参数</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\"><span class=\"hljs-comment\">// .babelrc</span><br>&#123;<br>  <span class=\"hljs-string\">&quot;plugins&quot;</span>: [[<span class=\"hljs-string\">&quot;./plugin.js&quot;</span>, &#123;<br>    <span class=\"hljs-string\">&quot;ES5&quot;</span>: <span class=\"hljs-literal\">false</span><br>  &#125;]]<br>&#125;<br></code></pre></td></tr></table></figure>\n\n<p>在插件中，我们可以通过 <code>state.opts</code> 获取到参数：</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\"><span class=\"hljs-comment\">// plugin.js</span><br><br>...<br><span class=\"hljs-title class_\">VariableDeclaration</span>(path, state) &#123;<br>  <span class=\"hljs-keyword\">if</span> (state.<span class=\"hljs-property\">opts</span>.<span class=\"hljs-property\">ES5</span> === <span class=\"hljs-literal\">true</span> &amp;&amp; [<span class=\"hljs-string\">&#x27;let&#x27;</span>, <span class=\"hljs-string\">&#x27;const&#x27;</span>].<span class=\"hljs-title function_\">includes</span>(path.<span class=\"hljs-property\">node</span>.<span class=\"hljs-property\">kind</span>)) &#123;<br>    path.<span class=\"hljs-property\">node</span>.<span class=\"hljs-property\">kind</span> = <span class=\"hljs-string\">&#x27;var&#x27;</span><br>  &#125;<br>&#125;,<br>...<br></code></pre></td></tr></table></figure>\n","site":{"data":{}},"wordcount":14897,"excerpt":"","more":"<h1 id=\"Module\"><a href=\"#Module\" class=\"headerlink\" title=\"Module\"></a>Module</h1><p>在ES6之前，社区制定了一些模块加载方案，最主要的有CommonJS和AMD两种。前者用于服务器，后者用于浏览器。</p>\n<p>ES6在语言规格的层面上实现了模块功能，而且实现得相当简单，完全可以取代现有的CommonJS和AMD规范，成为浏览器和服务器通用的模块解决方案。</p>\n<h2 id=\"stage1\"><a href=\"#stage1\" class=\"headerlink\" title=\"stage1\"></a>stage1</h2><blockquote>\n<p>文件划分方式，约定每一个 js 文件就是一个独立的模块</p>\n</blockquote>\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs html\"><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">script</span> <span class=\"hljs-attr\">src</span>=<span class=\"hljs-string\">&quot;./lib.js&quot;</span>&gt;</span><span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">script</span>&gt;</span><br><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">script</span> <span class=\"hljs-attr\">src</span>=<span class=\"hljs-string\">&quot;./main.js&quot;</span>&gt;</span><span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">script</span>&gt;</span><br><br><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">script</span>&gt;</span><span class=\"language-javascript\"></span><br><span class=\"language-javascript\">  <span class=\"hljs-comment\">// 直接使用导入文件中的变量与方法</span></span><br><span class=\"language-javascript\">  <span class=\"hljs-title function_\">method1</span>()</span><br><span class=\"language-javascript\"></span><br><span class=\"language-javascript\">  <span class=\"hljs-comment\">// 模块成员可以被修改</span></span><br><span class=\"language-javascript\">  count = <span class=\"hljs-number\">2</span></span><br><span class=\"language-javascript\"></span><span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">script</span>&gt;</span><br></code></pre></td></tr></table></figure>\n\n<p>缺点：</p>\n<ol>\n<li>污染全局作用域</li>\n<li>命名冲突</li>\n<li>无法管理模块间的依赖关系</li>\n<li>模块成员可以在外部直接修改</li>\n</ol>\n<h2 id=\"stage2\"><a href=\"#stage2\" class=\"headerlink\" title=\"stage2\"></a>stage2</h2><blockquote>\n<p>命名空间，减少命名冲突</p>\n</blockquote>\n<p>每个文件中，通过一个命名对象来包裹所有的变量和方法</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\"><span class=\"hljs-comment\">// module a 相关的数据和方法</span><br><br><span class=\"hljs-keyword\">const</span> moduleA = &#123;<br>  <span class=\"hljs-attr\">name</span>: <span class=\"hljs-string\">&#x27;module a&#x27;</span>,<br>  <span class=\"hljs-attr\">count</span>: <span class=\"hljs-number\">1</span>,<br>  <span class=\"hljs-title function_\">incCount</span>(<span class=\"hljs-params\"></span>) &#123;<br>    <span class=\"hljs-variable language_\">this</span>.<span class=\"hljs-property\">count</span> ++<br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure>\n\n<p>缺点：</p>\n<ol>\n<li>污染全局作用域</li>\n<li>无法管理模块间的依赖关系</li>\n<li>模块成员可以在外部直接修改</li>\n</ol>\n<h2 id=\"stage3\"><a href=\"#stage3\" class=\"headerlink\" title=\"stage3\"></a>stage3</h2><blockquote>\n<p>IIFE（立即执行函数）</p>\n</blockquote>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\">;(<span class=\"hljs-keyword\">function</span>(<span class=\"hljs-params\">$</span>)&#123;<br>  <span class=\"hljs-keyword\">const</span> name = <span class=\"hljs-string\">&#x27;moduleA&#x27;</span><br>  <span class=\"hljs-keyword\">let</span> count = <span class=\"hljs-number\">1</span><br>  <span class=\"hljs-keyword\">function</span> <span class=\"hljs-title function_\">incCount</span>(<span class=\"hljs-params\"></span>) &#123;<br>    count++<br>  &#125;<br><br>  <span class=\"hljs-variable language_\">window</span>.<span class=\"hljs-property\">moduleA</span> = &#123;<br>    incCount<br>  &#125;<br>&#125;)(jQuery)<br></code></pre></td></tr></table></figure>\n\n<p>通过闭包的方式，模块内部的变量只能被模块内部修改，外部无法修改。</p>\n<p>通过 IIFE 的传参，我们可以传递一些依赖包给模块使用。</p>\n<h1 id=\"模块化规范\"><a href=\"#模块化规范\" class=\"headerlink\" title=\"模块化规范\"></a>模块化规范</h1><ul>\n<li><p>CommonJS（NodeJS）</p>\n<ol>\n<li>一个文件就是一个模块</li>\n<li>每个模块都有单独的作用域</li>\n<li>通过 module.exports 导出成员</li>\n<li>通过 require 函数加载成员</li>\n</ol>\n</li>\n</ul>\n<p>以同步的方式加载模块，如果放在浏览器中，那么会出现大量的文件请求，有时候并不是立马就需要的文件也会被加载，从而造成性能问题，不适合在浏览器中使用。</p>\n<ul>\n<li><p>AMD（Asyncronous module definition）</p>\n<p>异步的模块定义</p>\n</li>\n</ul>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\"><span class=\"hljs-comment\">// 定义一个模块</span><br><span class=\"hljs-comment\">// 第二个参数表示当前模块的依赖项</span><br><span class=\"hljs-title function_\">define</span>(<span class=\"hljs-string\">&#x27;module1&#x27;</span>, [<span class=\"hljs-string\">&#x27;lodash&#x27;</span>, <span class=\"hljs-string\">&#x27;./module2&#x27;</span>], <span class=\"hljs-keyword\">function</span>(<span class=\"hljs-params\"><span class=\"hljs-string\">&#x27;lodash&#x27;</span>, <span class=\"hljs-string\">&#x27;module2&#x27;</span></span>) &#123;<br>  <br>  <span class=\"hljs-comment\">// 导出成员，外部可以方法 start 方法</span><br>  <span class=\"hljs-keyword\">return</span> &#123;<br>    <span class=\"hljs-attr\">start</span>:<span class=\"hljs-keyword\">function</span>(<span class=\"hljs-params\"></span>) &#123;<br>      <span class=\"hljs-comment\">// lodash</span><br><br>      <span class=\"hljs-title function_\">module2</span>()<br>    &#125;<br>  &#125;<br>&#125;)<br><br>  <span class=\"hljs-comment\">// 加载模块</span><br><br>  <span class=\"hljs-built_in\">require</span>(<span class=\"hljs-string\">&#x27;./module1&#x27;</span>, <span class=\"hljs-keyword\">function</span>(<span class=\"hljs-params\">module1</span>) &#123;<br>    module1.<span class=\"hljs-title function_\">start</span>()<br>  &#125;)<br></code></pre></td></tr></table></figure>\n\n<ul>\n<li><p>CMD规范（类似 CommonJS）</p>\n</li>\n<li><p>ES Modules（浏览器）</p>\n</li>\n</ul>\n<h1 id=\"ES6-模块化\"><a href=\"#ES6-模块化\" class=\"headerlink\" title=\"ES6 模块化\"></a>ES6 模块化</h1><figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs html\"><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">script</span> <span class=\"hljs-attr\">src</span>=<span class=\"hljs-string\">&quot;./main.js&quot;</span> <span class=\"hljs-attr\">type</span>=<span class=\"hljs-string\">&quot;module&quot;</span>&gt;</span><span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">script</span>&gt;</span><br><br><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">script</span> <span class=\"hljs-attr\">type</span>=<span class=\"hljs-string\">&quot;module&quot;</span>&gt;</span><span class=\"language-javascript\"></span><br><span class=\"language-javascript\">  <span class=\"hljs-variable language_\">console</span>.<span class=\"hljs-title function_\">log</span>(<span class=\"hljs-number\">1</span>)</span><br><span class=\"language-javascript\"></span><span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">script</span>&gt;</span><br></code></pre></td></tr></table></figure>\n\n<p>特性：</p>\n<ul>\n<li>ES6的模块自动采用严格模式，不管有没有在模块头部加上＂use strict＂。</li>\n<li>每个 ES Module 都运行在私有作用域中</li>\n<li>ESM 是通过 CORS(跨域) 的方式去请求外部的 JS 资源的。（原 script 标签默认支持跨域）</li>\n<li>ESM 的 script 标签会延迟执行脚本（类似标签的 defer 属性），等待网页渲染完成后，再执行。<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\"><span class=\"hljs-comment\">// 会比有 type=&quot;module&quot; 的script 先执行</span><br>&lt;script&gt;<br>  <span class=\"hljs-title function_\">alert</span>(<span class=\"hljs-string\">&#x27;hello&#x27;</span>)<br>&lt;/script&gt;<br><br><span class=\"hljs-comment\">// 延迟执行</span><br><span class=\"language-xml\"><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">script</span> <span class=\"hljs-attr\">type</span>=<span class=\"hljs-string\">&quot;module&quot;</span>&gt;</span><span class=\"language-javascript\"> <span class=\"hljs-comment\">// 等同于加了 defer 属性</span></span></span><br><span class=\"language-javascript\"><span class=\"language-xml\">  <span class=\"hljs-variable language_\">console</span>.<span class=\"hljs-title function_\">log</span>(<span class=\"hljs-number\">1</span>)</span></span><br><span class=\"language-javascript\"><span class=\"language-xml\"></span><span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">script</span>&gt;</span></span><br></code></pre></td></tr></table></figure>\n\n</li>\n</ul>\n<p>严格模式主要有以下限制：</p>\n<ul>\n<li>变量必须声明后再使用。</li>\n<li>函数的参数不能有同名属性，否则报错。</li>\n<li>不能使用with语句。</li>\n<li>不能对只读属性赋值，否则报错。</li>\n<li>不能使用前缀0表示八进制数，否则报错。</li>\n<li>不能删除不可删除的属性，否则报错。</li>\n<li>不能删除变量(delete prop)，会报错，只能删除属性(delete global[prop])。</li>\n<li>eval不会在其外层作用域引入变量。</li>\n<li>eval和arguments不能被重新赋值。</li>\n<li>arguments不会自动反映函数参数的变化。</li>\n<li>不能使用arguments.callee。</li>\n<li>不能使用arguments.caller。</li>\n<li>禁止this指向全局对象。</li>\n<li>不能使用fn.caller和fn.arguments获取函数调用的堆栈。</li>\n<li>增加了保留字（比如protected、static和interface）。</li>\n</ul>\n<h2 id=\"export-amp-import\"><a href=\"#export-amp-import\" class=\"headerlink\" title=\"export &amp; import\"></a>export &amp; import</h2><p>模块功能主要由两个命令构成：export和import。</p>\n<p>export命令用于规定模块的对外接口，import命令用于输入其他模块提供的功能。一个模块就是一个独立的文件。该文件内部的所有变量，外部无法获取。</p>\n<p>如果希望外部能够读取模块内部的某个变量，就必须使用export关键字输出该变量。</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\"><span class=\"hljs-comment\">// test.js</span><br><span class=\"hljs-keyword\">export</span> <span class=\"hljs-keyword\">const</span> myName = <span class=\"hljs-string\">&#x27;Hello_AlexCC&#x27;</span><br><br><span class=\"hljs-comment\">// 组合导出</span><br><span class=\"hljs-keyword\">const</span> myAge = <span class=\"hljs-number\">18</span><br><span class=\"hljs-keyword\">const</span> sayMe = <span class=\"hljs-keyword\">function</span>(<span class=\"hljs-params\"></span>) &#123;<br>  <span class=\"hljs-variable language_\">console</span>.<span class=\"hljs-title function_\">log</span>(<span class=\"hljs-string\">`my name is <span class=\"hljs-subst\">$&#123;myName&#125;</span>, and I&#x27;m <span class=\"hljs-subst\">$&#123;myAge&#125;</span> years old!`</span>)<br>&#125;<br><br><span class=\"hljs-keyword\">export</span> &#123;<br>  myAge,<br>  sayMe<br>&#125;<br></code></pre></td></tr></table></figure>\n\n<p>如果在一个模块中先输入后输出同一个模块，import语句可以与export语句写在一起。</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\"><span class=\"hljs-keyword\">export</span> &#123; sayName <span class=\"hljs-keyword\">as</span> <span class=\"hljs-keyword\">default</span>&#125; <span class=\"hljs-keyword\">from</span> <span class=\"hljs-string\">&#x27;./someModule&#x27;</span><br><br><span class=\"hljs-comment\">// 等价于</span><br><br><span class=\"hljs-keyword\">import</span> &#123; sayName &#125; <span class=\"hljs-keyword\">from</span> <span class=\"hljs-string\">&#x27;./someModule&#x27;</span><br><span class=\"hljs-keyword\">export</span> <span class=\"hljs-keyword\">default</span> sayName<br></code></pre></td></tr></table></figure>\n\n<p>另外，ES7有一个提案(<a href=\"https://github.com/leebyron/ecmascript-more-export-from)，简化先输入后输出的写法，拿掉了输出时的大括号。\">https://github.com/leebyron/ecmascript-more-export-from)，简化先输入后输出的写法，拿掉了输出时的大括号。</a></p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\"><span class=\"hljs-comment\">// 提案</span><br><span class=\"hljs-keyword\">export</span> v <span class=\"hljs-keyword\">from</span> <span class=\"hljs-string\">&#x27;mod&#x27;</span><br><br><span class=\"hljs-comment\">// 现在</span><br><span class=\"hljs-keyword\">export</span> &#123; v &#125; <span class=\"hljs-keyword\">from</span> <span class=\"hljs-string\">&#x27;mod&#x27;</span><br></code></pre></td></tr></table></figure>\n\n<p>import语句会执行所加载的模块</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\"><span class=\"hljs-keyword\">import</span> <span class=\"hljs-string\">&#x27;lodash&#x27;</span><br></code></pre></td></tr></table></figure>\n\n<h2 id=\"模块整体加载\"><a href=\"#模块整体加载\" class=\"headerlink\" title=\"模块整体加载\"></a>模块整体加载</h2><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\"><span class=\"hljs-keyword\">import</span> * <span class=\"hljs-keyword\">as</span> myModule <span class=\"hljs-keyword\">from</span> <span class=\"hljs-string\">&#x27;./myModule&#x27;</span><br></code></pre></td></tr></table></figure>\n\n<h2 id=\"module-命令\"><a href=\"#module-命令\" class=\"headerlink\" title=\"module 命令\"></a>module 命令</h2><p>module命令可以取代import语句，达到整体输入模块的作用。</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\"><span class=\"hljs-variable language_\">module</span> myModule <span class=\"hljs-keyword\">from</span> <span class=\"hljs-string\">&#x27;./myModule&#x27;</span><br><br>myModule.<span class=\"hljs-title function_\">sayName</span>()<br></code></pre></td></tr></table></figure>\n\n<h2 id=\"动态加载模块\"><a href=\"#动态加载模块\" class=\"headerlink\" title=\"动态加载模块\"></a>动态加载模块</h2><p>返回的是 Promise</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\"><span class=\"hljs-title function_\">import</span>(<span class=\"hljs-string\">&#x27;./moduleA.js&#x27;</span>).<span class=\"hljs-title function_\">then</span>(<span class=\"hljs-function\"><span class=\"hljs-params\">module</span> =&gt;</span> &#123;<br>  ...<br>&#125;)<br></code></pre></td></tr></table></figure>\n\n<h2 id=\"ES6模块加载的实质\"><a href=\"#ES6模块加载的实质\" class=\"headerlink\" title=\"ES6模块加载的实质\"></a>ES6模块加载的实质</h2><p>ES6模块加载的机制与CommonJS模块完全不同。</p>\n<p>CommonJS模块输出的是一个值的拷贝，而ES6模块输出的是 <code>值的引用</code>。</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\"><span class=\"hljs-comment\">// lib.js</span><br><span class=\"hljs-keyword\">export</span> <span class=\"hljs-keyword\">let</span> count = <span class=\"hljs-number\">1</span><br><span class=\"hljs-keyword\">export</span> <span class=\"hljs-keyword\">function</span> <span class=\"hljs-title function_\">incCount</span>(<span class=\"hljs-params\"></span>) &#123;<br>  count++<br>&#125;<br><br><span class=\"hljs-comment\">// main.js</span><br><span class=\"hljs-keyword\">import</span> &#123; count, incCount &#125; <span class=\"hljs-keyword\">from</span> <span class=\"hljs-string\">&#x27;./lib.js&#x27;</span><br><br><span class=\"hljs-variable language_\">console</span>.<span class=\"hljs-title function_\">log</span>(count) <span class=\"hljs-comment\">// 1</span><br><br><span class=\"hljs-title function_\">incCount</span>()<br><br><span class=\"hljs-variable language_\">console</span>.<span class=\"hljs-title function_\">log</span>(count) <span class=\"hljs-comment\">// 2</span><br></code></pre></td></tr></table></figure>\n\n\n<p>注意加上 type=”module”</p>\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs html\"><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">script</span> <span class=\"hljs-attr\">src</span>=<span class=\"hljs-string\">&quot;./main.js&quot;</span> <span class=\"hljs-attr\">type</span>=<span class=\"hljs-string\">&quot;module&quot;</span>&gt;</span><span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">script</span>&gt;</span><br></code></pre></td></tr></table></figure>\n\n<h2 id=\"ES-Module-in-NodeJS\"><a href=\"#ES-Module-in-NodeJS\" class=\"headerlink\" title=\"ES Module in NodeJS\"></a>ES Module in NodeJS</h2><p>如何在 Nodejs 中使用 ES module!</p>\n<p>有两个步骤：</p>\n<ol>\n<li><code>.js</code> 后缀都改为 <code>.mjs</code></li>\n<li>执行脚本时，加上 <code>node --experimental-modules main.mjs</code></li>\n</ol>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\"><span class=\"hljs-comment\">// node</span><br><br><span class=\"hljs-comment\">// main.mjs</span><br><span class=\"hljs-keyword\">import</span> fs <span class=\"hljs-keyword\">from</span> <span class=\"hljs-string\">&#x27;fs&#x27;</span><br><span class=\"hljs-keyword\">import</span> _ <span class=\"hljs-keyword\">from</span> <span class=\"hljs-string\">&#x27;lodash&#x27;</span><br></code></pre></td></tr></table></figure>\n\n<p>注意事项：</p>\n<ol>\n<li>在 node 环境中，我们可以使用 ES Module 导入 CommonJS 导出的成员</li>\n</ol>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\"><span class=\"hljs-comment\">// commonjs.js</span><br><span class=\"hljs-variable language_\">module</span>.<span class=\"hljs-property\">exports</span> = &#123;<br>  <span class=\"hljs-attr\">foo</span>: <span class=\"hljs-string\">&#x27;commonjs exports foo&#x27;</span><br>&#125;<br><br><span class=\"hljs-comment\">// esmodule.js</span><br><span class=\"hljs-keyword\">import</span> mod <span class=\"hljs-keyword\">from</span> <span class=\"hljs-string\">&#x27;./commonjs.js&#x27;</span><br><br><span class=\"hljs-variable language_\">console</span>.<span class=\"hljs-title function_\">log</span>(mod.<span class=\"hljs-property\">foo</span>)<br></code></pre></td></tr></table></figure>\n\n<ol start=\"2\">\n<li>在 node 环境中，CommonJS 中<code>不能</code>导入 ES Module 导出的成员</li>\n</ol>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\"><span class=\"hljs-keyword\">const</span> mod = <span class=\"hljs-built_in\">require</span>(<span class=\"hljs-string\">&#x27;./esmodule.js&#x27;</span>) <span class=\"hljs-comment\">// 报错</span><br></code></pre></td></tr></table></figure>\n\n<h2 id=\"CommonJS-与-ES-Module-差异\"><a href=\"#CommonJS-与-ES-Module-差异\" class=\"headerlink\" title=\"CommonJS 与 ES Module 差异\"></a>CommonJS 与 ES Module 差异</h2><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\"><span class=\"hljs-comment\">// CommonJS</span><br><br><span class=\"hljs-built_in\">require</span> <span class=\"hljs-comment\">// 加载模块函数</span><br><br><span class=\"hljs-variable language_\">module</span> <span class=\"hljs-comment\">// 模块对象</span><br><br><span class=\"hljs-built_in\">exports</span> <span class=\"hljs-comment\">// 导出对象别名 exports.name = &#x27;hello world&#x27;</span><br><br>__filename <span class=\"hljs-comment\">// 当前文件的绝对路径</span><br><br>__dirname <span class=\"hljs-comment\">// 当前文件所在目录</span><br></code></pre></td></tr></table></figure>\n\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\"><span class=\"hljs-comment\">// ES Module</span><br><br><span class=\"hljs-keyword\">import</span>.<span class=\"hljs-property\">meta</span>.<span class=\"hljs-property\">url</span> <span class=\"hljs-comment\">// 文件路径信息</span><br><br><span class=\"hljs-comment\">// 可以通过内置模块 url 和 path 处理，拿到 __filename 和 __dirname</span><br><span class=\"hljs-keyword\">import</span> &#123; fileURLToPath &#125; <span class=\"hljs-keyword\">from</span> <span class=\"hljs-string\">&#x27;url&#x27;</span><br><span class=\"hljs-keyword\">import</span> &#123; dirname &#125; <span class=\"hljs-keyword\">from</span> <span class=\"hljs-string\">&#x27;path&#x27;</span><br><br><span class=\"hljs-keyword\">const</span> __filename = <span class=\"hljs-title function_\">fileURLToPath</span>(<span class=\"hljs-keyword\">import</span>.<span class=\"hljs-property\">meta</span>.<span class=\"hljs-property\">url</span>)<br><span class=\"hljs-keyword\">const</span> __dirname = <span class=\"hljs-title function_\">dirname</span>(__filename)<br></code></pre></td></tr></table></figure>\n\n<h2 id=\"高版本-NodeJS-已支持-ESM-Version-gt-12-10-0\"><a href=\"#高版本-NodeJS-已支持-ESM-Version-gt-12-10-0\" class=\"headerlink\" title=\"高版本 NodeJS 已支持 ESM (Version &gt; 12.10.0)\"></a>高版本 NodeJS 已支持 ESM (Version &gt; 12.10.0)</h2><p>不需要再写 <code>.mjs</code> 结尾了，直接 <code>.js</code></p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\"><span class=\"hljs-comment\">// package.json</span><br>&#123;<br>  <span class=\"hljs-string\">&quot;type&quot;</span>: <span class=\"hljs-string\">&quot;module&quot;</span><br>&#125;<br><br><span class=\"hljs-comment\">// 执行</span><br>node --experimental-modules main.<span class=\"hljs-property\">js</span> <br></code></pre></td></tr></table></figure>\n\n<p>加上 type module 配置之后，如果我们还想用 <code>CommonJS</code> 规范，发现会报错了。因为我们已经使用了 ESM。</p>\n<p>如果继续使用 <code>CommonJS</code> 规范，那么就需要将 <code>.js</code> 改为 <code>.cjs</code>。</p>\n<h2 id=\"ESM-in-NodeJS-（babel-兼容方案）\"><a href=\"#ESM-in-NodeJS-（babel-兼容方案）\" class=\"headerlink\" title=\"ESM in NodeJS （babel 兼容方案）\"></a>ESM in NodeJS （babel 兼容方案）</h2><blockquote>\n<p>yarn add @babel/node @babel/preset-env –save-dev</p>\n</blockquote>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\"><span class=\"hljs-comment\">// 通过 babel-node 命令执行脚本</span><br>yarn babel-node main.<span class=\"hljs-property\">js</span><br></code></pre></td></tr></table></figure>\n\n<p>要注意的是，<code>babel/core</code> 并不会转换我们的代码，转换代码的工作交给 babel 内置的插件去实现的。也就是说，我们需要一个插件，去转换 ES6 中的一个新特性。</p>\n<img src=\"./img/babel.jpg\" />\n\n<p>而 <code>@bable/preset-env</code> 是插件的集合，所以不需要每个插件都安装一遍。</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\"><span class=\"hljs-comment\">// 命令行使用</span><br>yarn babel-node main.<span class=\"hljs-property\">js</span> --presets=@bable/preset-env<br></code></pre></td></tr></table></figure>\n\n<p>结合 babel 配置文件使用</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\"><span class=\"hljs-comment\">// .babelrc</span><br>&#123;<br>  <span class=\"hljs-string\">&quot;presets&quot;</span>: [<span class=\"hljs-string\">&quot;@babel/presets-env&quot;</span>]<br>&#125;<br><br>yarn babel-node main.<span class=\"hljs-property\">js</span><br></code></pre></td></tr></table></figure>\n\n<p>既然 <code>@babel/preset-env</code> 是插件的集合，而我不想要那么多，只是想处理 <code>ESM</code> 怎么办呢？</p>\n<p>我们卸载掉 <code>@babel/preset-env</code>，安装 <code>@babel/plugin-transform-modules-commonjs</code></p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\"><span class=\"hljs-comment\">// .babelrc</span><br>&#123;<br>  <span class=\"hljs-string\">&quot;presets&quot;</span>: [<span class=\"hljs-string\">&quot;@babel/plugin-transform-modules-commonjs&quot;</span>]<br>&#125;<br><br>yarn babel-node main.<span class=\"hljs-property\">js</span><br></code></pre></td></tr></table></figure>\n\n<h1 id=\"babel\"><a href=\"#babel\" class=\"headerlink\" title=\"babel\"></a>babel</h1><blockquote>\n<p>编译器</p>\n</blockquote>\n<p>主要用于将ES6版本的JS代码转换为ES5等向后兼容的JS代码，从而使代码可以运行在低版本浏览器或其他环境中。</p>\n<blockquote>\n<p>npm install –save-dev babel-core babel-preset-es2015 babel-preset-latest –registry=<a href=\"https://registry.npm.taobao.org\">https://registry.npm.taobao.org</a></p>\n</blockquote>\n<p>配置文件 <code>.babelrc</code>（或者 babel.config.js || .babelrc.js）</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\">&#123;<br>  <span class=\"hljs-string\">&quot;presets&quot;</span>: [<span class=\"hljs-string\">&quot;es2015&quot;</span>, <span class=\"hljs-string\">&quot;latest&quot;</span>], <span class=\"hljs-comment\">// 安装包的别名，用来处理最新的 ES6 语法</span><br>  <span class=\"hljs-string\">&quot;plugins&quot;</span>: []<br>&#125;<br></code></pre></td></tr></table></figure>\n\n<p>安装 <code>babel-cli</code>，命令行编译工具，依赖 <code>babel/core</code></p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\">npm install --save-dev babel-cli <br></code></pre></td></tr></table></figure>\n\n<p>查看 babel 版本（npx 是新版 NodeJS 附带的命令）</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\">npx babel --version <span class=\"hljs-comment\">// ===== node_modules/.bin/babel --version </span><br><br><span class=\"hljs-comment\">// ====&gt; 6.26.0 (babel-core 6.26.3)</span><br></code></pre></td></tr></table></figure>\n\n<p>到这里，我们就可以使用 babel 来编译js 文件了。创建一个 babel.js 文件，写入一些 es6 的语法。</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\"><span class=\"hljs-comment\">// babel.js</span><br><br><span class=\"hljs-keyword\">const</span> <span class=\"hljs-title function_\">foo</span> = (<span class=\"hljs-params\"></span>) =&gt; &#123;<br>  <span class=\"hljs-keyword\">return</span> <span class=\"hljs-number\">3</span> * <span class=\"hljs-number\">3</span><br>&#125;<br><br><span class=\"hljs-keyword\">const</span> count = <span class=\"hljs-number\">123</span><br></code></pre></td></tr></table></figure>\n\n<p>打开命令行工具：</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\">npx babel babel.<span class=\"hljs-property\">js</span> -o compiled.<span class=\"hljs-property\">js</span> <span class=\"hljs-comment\">// 等效 node_modules/.bin/babel babel.js -o compiled.js </span><br></code></pre></td></tr></table></figure>\n\n<p>转化后的结果：</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\"><span class=\"hljs-meta\">&quot;use strict&quot;</span>;<br><br><span class=\"hljs-keyword\">var</span> foo = <span class=\"hljs-keyword\">function</span> <span class=\"hljs-title function_\">foo</span>(<span class=\"hljs-params\"></span>) &#123;<br>  <span class=\"hljs-keyword\">return</span> <span class=\"hljs-number\">3</span> * <span class=\"hljs-number\">3</span>;<br>&#125;;<br><br><span class=\"hljs-keyword\">var</span> count = <span class=\"hljs-number\">123</span>;<br></code></pre></td></tr></table></figure>\n\n<h2 id=\"Polyfill\"><a href=\"#Polyfill\" class=\"headerlink\" title=\"Polyfill\"></a>Polyfill</h2><p>Babel默认只转换新的JS语法（syntax），而不转换新的API（Promise、Map）。如果只是做语法转换，Promise 是不会被降级的，在低版本的浏览器中可能无法使用。</p>\n<p>引入 Polyfill，为当前环境提供一个“垫片”。所谓“垫片”，是指垫平不同浏览器之间差异的东西。polyfill提供了全局的ES6对象及通过修改原型链Array.prototype等来补充对实例的实现。</p>\n<h2 id=\"babel-版本\"><a href=\"#babel-版本\" class=\"headerlink\" title=\"babel 版本\"></a>babel 版本</h2><p>Babel版本主要是Babel 6和Babel 7这两个版本。</p>\n<p>提到Babel版本的时候，通常指的是@babel/core这个Babel核心包的版本。</p>\n<p>Babel 7的npm包都存放在babel域下，即在安装npm包的时候，我们安装的是名称以@babel/开头的npm包，如@babel/cli、@babel/core等。而在Babel 6中，我们安装的包名是babel-cli、babel-core等以babel-开头的npm包。其实它们本质上是一样的，都是Babel官方提供的cli命令行工具和core核心包。在平时开发和学习的过程中，碰到@babel/和babel-时应该认识到它俩是作用相同、内容接近的包，只是版本不一样而已。</p>\n<h2 id=\"babel-配置文件\"><a href=\"#babel-配置文件\" class=\"headerlink\" title=\"babel 配置文件\"></a>babel 配置文件</h2><blockquote>\n<p>指定编译的规则。</p>\n</blockquote>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\">.<span class=\"hljs-property\">babelrc</span> || babel.<span class=\"hljs-property\">config</span>.<span class=\"hljs-property\">js</span> || .<span class=\"hljs-property\">babelrc</span>.<span class=\"hljs-property\">js</span> || package.<span class=\"hljs-property\">json</span>（配置 babel 属性，配置项都是 一样的）<br></code></pre></td></tr></table></figure>\n\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\"><span class=\"hljs-comment\">// package.json</span><br><br>&#123;<br>  ...<br><br>  <span class=\"hljs-attr\">babel</span>: &#123;<br>    <span class=\"hljs-string\">&quot;presets&quot;</span>: [<span class=\"hljs-string\">&quot;es2015&quot;</span>, <span class=\"hljs-string\">&quot;react&quot;</span>],<br>    <span class=\"hljs-string\">&quot;plugin&quot;</span>: [<span class=\"hljs-string\">&quot;transform-class-properties&quot;</span>]<br>  &#125;,<br><br>  ...<br>&#125;<br></code></pre></td></tr></table></figure>\n\n<p>推荐使用后缀名是js的配置文件来进行配置，因为可以使用该文件做一些逻辑处理，适用性更强。</p>\n<h2 id=\"插件-amp-预设\"><a href=\"#插件-amp-预设\" class=\"headerlink\" title=\"插件 &amp; 预设\"></a>插件 &amp; 预设</h2><p>plugin代表插件，preset代表预设。通常每个插件或预设都是一个npm包。</p>\n<p>Babel的插件实在太多了，假如只配置插件数组，那我们前端工程要把ES2015、ES2016、ES2017……下的所有插件都写到配置项里，这样的Babel配置文件会非常臃肿。</p>\n<p>preset预设就是帮我们解决这个问题的。预设是一组Babel插件的集合，通俗的说法就是插件包，例如babel-preset-es2015就是所有处理ES2015的二十多个Babel插件的集合。这样我们就不用写一大堆插件配置项了，只需要用一个预设代替就可以。另外，预设也可以是插件和其他预设的集合。</p>\n<p>Babel官方已经针对常用的环境做了如下这些preset包。</p>\n<p>1）@babel/preset-env.</p>\n<p>2）@babel/preset-react.</p>\n<p>3）@babel/preset-typescript.</p>\n<p>4）@babel/preset-stage-0.</p>\n<p>5）@babel/preset-stage-1.</p>\n<h2 id=\"插件与预设的简称\"><a href=\"#插件与预设的简称\" class=\"headerlink\" title=\"插件与预设的简称\"></a>插件与预设的简称</h2><p>如果插件的npm包名称的前缀为babel-plugin-，则可以省略其前缀。</p>\n<p>如果npm包名称的前缀带有npm作用域@，如@org/babel-plugin-xxx，则短名称可以写成@org/xxx。</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\">&#123;<br>  <span class=\"hljs-string\">&quot;plugins&quot;</span>: [<span class=\"hljs-string\">&quot;babel-plugin-transform-decorators-legacy&quot;</span>]<br>&#125;<br><br><span class=\"hljs-comment\">// =====</span><br><br>&#123;<br>  <span class=\"hljs-string\">&quot;plugins&quot;</span>: [<span class=\"hljs-string\">&quot;transform-decorators-legacy&quot;</span>]<br>&#125;<br></code></pre></td></tr></table></figure>\n\n<p>预设的短名称规则与插件的类似，预设npm包名称的前缀为babel-preset-或作用域@xxx/babel-preset-xxx的可以省略掉babel-preset-。</p>\n<h2 id=\"插件和预设执行顺序\"><a href=\"#插件和预设执行顺序\" class=\"headerlink\" title=\"插件和预设执行顺序\"></a>插件和预设执行顺序</h2><p>plugins插件数组和presets预设数组是有顺序要求的。如果两个插件或预设都要处理同一个代码片段，那么会根据插件和预设的顺序来执行。规则如下:</p>\n<p>1）插件比预设先执行。</p>\n<p>2）插件执行顺序是插件数组元素从前向后依次执行。</p>\n<p>3）预设执行顺序是预设数组元素从后向前依次执行。</p>\n<h2 id=\"预设的选择\"><a href=\"#预设的选择\" class=\"headerlink\" title=\"预设的选择\"></a>预设的选择</h2><p>babel-preset-latest，在Babel 6时期，是所有年代preset的集合，在Babel 6最后一个版本中，它是babel-preset-es2015、babel-preset-es2016、babel-preset-es2017的集合。</p>\n<p>@babel/preset-env<code>包含了babel-preset-latest的功能，并对其进行了增强</code>，现在@babel/preset-env完全可以替代babel-preset-latest。</p>\n<p>Babel 6 中是babel-preset-env，Babel 7版本开始，@babel/preset-env。</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\"><span class=\"hljs-comment\">// babel 6</span><br>npm install babel-preset-env --save-dev<br><br><span class=\"hljs-comment\">// .babelrc</span><br>&#123;<br>  <span class=\"hljs-string\">&quot;presets&quot;</span>: [<span class=\"hljs-string\">&quot;env&quot;</span>]<br>&#125;<br><br><span class=\"hljs-comment\">// babel 7</span><br>npm install @babel/preset-env --save-dev<br><br><span class=\"hljs-comment\">// .babelrc</span><br>&#123;<br>  <span class=\"hljs-string\">&quot;presets&quot;</span>: [<span class=\"hljs-string\">&quot;@babel/env&quot;</span>]<br>&#125;<br></code></pre></td></tr></table></figure>\n\n<p>总结起来，Babel官方提供的预设，我们实际会用到的其实就只有四个。</p>\n<p>1）@babel/preset-env.</p>\n<p>2）@babel/preset-flow.</p>\n<p>3）@babel/preset-react.</p>\n<p>4）@babel/preset-typescript.</p>\n<h2 id=\"插件的选择\"><a href=\"#插件的选择\" class=\"headerlink\" title=\"插件的选择\"></a>插件的选择</h2><p>Babel 7 官方有九十多个插件，不过其中大多数都已经整合在@babel/preset-env和@babel/preset-react等预设里了，我们在开发的时候直接使用预设就可以。</p>\n<p>目前比较常用的插件只有@babel/plugin-transform-runtime。</p>\n<h2 id=\"browserslist\"><a href=\"#browserslist\" class=\"headerlink\" title=\"browserslist\"></a>browserslist</h2><p>在 package.json 中经常遇到这个配置项：</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\"><span class=\"hljs-comment\">// package.json</span><br><br>&#123;<br>  <span class=\"hljs-string\">&quot;browserslist&quot;</span>: [<br>    <span class=\"hljs-string\">&quot;&gt; 1%&quot;</span>,<br>    <span class=\"hljs-string\">&quot;not ie &lt;= 8&quot;</span><br>  ]<br>&#125;<br></code></pre></td></tr></table></figure>\n<p>上面配置的含义是，该项目工程的目标环境是市场份额大于1%的浏览器并且不考虑IE 8及以下的IE浏览器。</p>\n<p>browserslist叫作目标环境配置表，除了写在package.json文件里，也可以单独写在工程目录下的.browserslistrc文件里。</p>\n<p>我们写一个含有箭头函数的 js 文件，如果我们在browserslist里指定目标环境是Chrome 60浏览器，再来看一下转换结果:</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\"><span class=\"hljs-comment\">// package.json</span><br>&#123;<br>  <span class=\"hljs-string\">&quot;browserslist&quot;</span>: [<span class=\"hljs-string\">&quot;chrome 60&quot;</span>]<br>&#125;<br></code></pre></td></tr></table></figure>\n<p>我们发现转换后的代码仍然是箭头函数，因为Chrome 60浏览器已经实现了箭头函数语法，所以不会转换成ES5的函数定义语法。</p>\n<h2 id=\"babel-runtime\"><a href=\"#babel-runtime\" class=\"headerlink\" title=\"@babel/runtime\"></a>@babel/runtime</h2><p>我们写个 js 文件，里面包含 es6 的 class 语法:</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\"><span class=\"hljs-keyword\">class</span> <span class=\"hljs-title class_\">Person</span> &#123;<br>  <span class=\"hljs-title function_\">sayName</span>(<span class=\"hljs-params\"></span>) &#123;<br>    <span class=\"hljs-title function_\">alert</span>(<span class=\"hljs-variable language_\">this</span>.<span class=\"hljs-property\">name</span>)<br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure>\n\n<p>然后执行 babel 命令，查看转换后的结果 <code>npx babel babel.js -o compiled.js</code></p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\"><span class=\"hljs-meta\">&quot;use strict&quot;</span>;<br><br><span class=\"hljs-keyword\">var</span> _createClass = <span class=\"hljs-keyword\">function</span> (<span class=\"hljs-params\"></span>) &#123; <span class=\"hljs-keyword\">function</span> <span class=\"hljs-title function_\">defineProperties</span>(<span class=\"hljs-params\">target, props</span>) &#123; <span class=\"hljs-keyword\">for</span> (<span class=\"hljs-keyword\">var</span> i = <span class=\"hljs-number\">0</span>; i &lt; props.<span class=\"hljs-property\">length</span>; i++) &#123; <span class=\"hljs-keyword\">var</span> descriptor = props[i]; descriptor.<span class=\"hljs-property\">enumerable</span> = descriptor.<span class=\"hljs-property\">enumerable</span> || <span class=\"hljs-literal\">false</span>; descriptor.<span class=\"hljs-property\">configurable</span> = <span class=\"hljs-literal\">true</span>; <span class=\"hljs-keyword\">if</span> (<span class=\"hljs-string\">&quot;value&quot;</span> <span class=\"hljs-keyword\">in</span> descriptor) descriptor.<span class=\"hljs-property\">writable</span> = <span class=\"hljs-literal\">true</span>; <span class=\"hljs-title class_\">Object</span>.<span class=\"hljs-title function_\">defineProperty</span>(target, descriptor.<span class=\"hljs-property\">key</span>, descriptor); &#125; &#125; <span class=\"hljs-keyword\">return</span> <span class=\"hljs-keyword\">function</span> (<span class=\"hljs-params\">Constructor, protoProps, staticProps</span>) &#123; <span class=\"hljs-keyword\">if</span> (protoProps) <span class=\"hljs-title function_\">defineProperties</span>(<span class=\"hljs-title class_\">Constructor</span>.<span class=\"hljs-property\"><span class=\"hljs-keyword\">prototype</span></span>, protoProps); <span class=\"hljs-keyword\">if</span> (staticProps) <span class=\"hljs-title function_\">defineProperties</span>(<span class=\"hljs-title class_\">Constructor</span>, staticProps); <span class=\"hljs-keyword\">return</span> <span class=\"hljs-title class_\">Constructor</span>; &#125;; &#125;();<br><br><span class=\"hljs-keyword\">function</span> <span class=\"hljs-title function_\">_classCallCheck</span>(<span class=\"hljs-params\">instance, Constructor</span>) &#123; <span class=\"hljs-keyword\">if</span> (!(instance <span class=\"hljs-keyword\">instanceof</span> <span class=\"hljs-title class_\">Constructor</span>)) &#123; <span class=\"hljs-keyword\">throw</span> <span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">TypeError</span>(<span class=\"hljs-string\">&quot;Cannot call a class as a function&quot;</span>); &#125; &#125;<br><br><span class=\"hljs-keyword\">var</span> <span class=\"hljs-title class_\">Person</span> = <span class=\"hljs-keyword\">function</span> (<span class=\"hljs-params\"></span>) &#123;<br>  <span class=\"hljs-keyword\">function</span> <span class=\"hljs-title function_\">Person</span>(<span class=\"hljs-params\"></span>) &#123;<br>    <span class=\"hljs-title function_\">_classCallCheck</span>(<span class=\"hljs-variable language_\">this</span>, <span class=\"hljs-title class_\">Person</span>);<br>  &#125;<br><br>  <span class=\"hljs-title function_\">_createClass</span>(<span class=\"hljs-title class_\">Person</span>, [&#123;<br>    <span class=\"hljs-attr\">key</span>: <span class=\"hljs-string\">&quot;sayName&quot;</span>,<br>    <span class=\"hljs-attr\">value</span>: <span class=\"hljs-keyword\">function</span> <span class=\"hljs-title function_\">sayName</span>(<span class=\"hljs-params\"></span>) &#123;<br>      <span class=\"hljs-title function_\">alert</span>(<span class=\"hljs-variable language_\">this</span>.<span class=\"hljs-property\">name</span>);<br>    &#125;<br>  &#125;]);<br><br>  <span class=\"hljs-keyword\">return</span> <span class=\"hljs-title class_\">Person</span>;<br>&#125;();<br></code></pre></td></tr></table></figure>\n\n<p>可以看到，转换后的代码上部增加了好几个函数声明，这些函数是Babel转码时注入的，我们称之为辅助函数。@babel/preset-env在做语法转换的时候，注入了这些函数声明，以便语法转换后使用。</p>\n<p>但这样做存在一个问题。在我们正常地进行前端工程开发的时候，少则有几十个JS文件，多则有上千个。如果每个文件里都使用了class类语法，那么会导致每个转换后的代码上部都会注入这些相同的函数声明。这会导致我们用构建工具打包出来的包体积非常大。</p>\n<p>那么应该怎么办呢？一个思路就是，我们把这些函数声明都放在一个npm包里，需要使用的时候直接从这个包里引入我们的文件。这样即使有上千个文件，也会从相同的包里引入这些函数。使用Webpack这一类的构建工具进行打包时，我们只需要引入一次npm包里的函数，这样就做到了复用，减小了包的体积。</p>\n<p><code>@babel/runtime</code> 就是上面说的这个npm包，<strong>@babel/runtime把所有语法转换会用到的辅助函数都集中在了一起。</strong></p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\"><span class=\"hljs-comment\">// babbel 6</span><br>npm install babel-runtime --save-dev <span class=\"hljs-comment\">// /node_modules/babel-runtime/helpers/createClass.js</span><br><br><span class=\"hljs-comment\">// babel 7</span><br>npm install @babel/runtime@<span class=\"hljs-number\">7.12</span><span class=\"hljs-number\">.5</span> --save-dev<br></code></pre></td></tr></table></figure>\n\n<p>然后到node_modules目录下看一下这个包的结构，找到 _classCallCheck、_defineProperties与_createClass这三个辅助函数的位置，我们直接引入即可。</p>\n<p>这时，我们就可以替换转换后自动创建的方法，而是使用 @babel/runtime/helpers 中已有的方法。</p>\n<p>不过，这么多辅助函数要一个个记住并手动引入，是很难做到的。这时Babel插件 <code>@babel/plugin-transform-runtime</code> 就可以用来帮我们解决这个问题。</p>\n<h2 id=\"babel-plugin-transform-runtime\"><a href=\"#babel-plugin-transform-runtime\" class=\"headerlink\" title=\"@babel/plugin-transform-runtime\"></a>@babel/plugin-transform-runtime</h2><p>辅助函数的自动引入。</p>\n<p>@babel/plugin-transform-runtime有三大作用，其中之一就是自动移除语法转换后内联的辅助函数（inline Babel helpers），而是使用@babel/runtime/helpers里的辅助函数来替代，这样就减少了我们手动引入的麻烦。</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\"><span class=\"hljs-comment\">// babel6</span><br>npm install babel-plugin-transform-runtime --save-dev<br><br><span class=\"hljs-comment\">// babel 7</span><br>npm install @babel/plugin-transform-runtime@<span class=\"hljs-number\">7.12</span><span class=\"hljs-number\">.10</span> --save-dev<br></code></pre></td></tr></table></figure>\n\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\">&#123;<br>  <span class=\"hljs-string\">&quot;plugins&quot;</span>: [<span class=\"hljs-string\">&quot;@babel/plugin-transform-runtime&quot;</span>] <span class=\"hljs-comment\">// babel 6: &quot;babel-plugin-transform-runtime&quot;</span><br>&#125;<br></code></pre></td></tr></table></figure>\n\n<p>还是上面的例子，我们再看看转换后的结果，会发现插件已经自动帮我们处理了。</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\"><span class=\"hljs-meta\">&quot;use strict&quot;</span>;<br><br><span class=\"hljs-keyword\">var</span> _classCallCheck2 = <span class=\"hljs-built_in\">require</span>(<span class=\"hljs-string\">&quot;babel-runtime/helpers/classCallCheck&quot;</span>);<br><br><span class=\"hljs-keyword\">var</span> _classCallCheck3 = <span class=\"hljs-title function_\">_interopRequireDefault</span>(_classCallCheck2);<br><br><span class=\"hljs-keyword\">var</span> _createClass2 = <span class=\"hljs-built_in\">require</span>(<span class=\"hljs-string\">&quot;babel-runtime/helpers/createClass&quot;</span>);<br><br><span class=\"hljs-keyword\">var</span> _createClass3 = <span class=\"hljs-title function_\">_interopRequireDefault</span>(_createClass2);<br><br><span class=\"hljs-keyword\">function</span> <span class=\"hljs-title function_\">_interopRequireDefault</span>(<span class=\"hljs-params\">obj</span>) &#123; <span class=\"hljs-keyword\">return</span> obj &amp;&amp; obj.<span class=\"hljs-property\">__esModule</span> ? obj : &#123; <span class=\"hljs-attr\">default</span>: obj &#125;; &#125;<br><br><span class=\"hljs-keyword\">var</span> <span class=\"hljs-title class_\">Person</span> = <span class=\"hljs-keyword\">function</span> (<span class=\"hljs-params\"></span>) &#123;<br>  <span class=\"hljs-keyword\">function</span> <span class=\"hljs-title function_\">Person</span>(<span class=\"hljs-params\"></span>) &#123;<br>    (<span class=\"hljs-number\">0</span>, _classCallCheck3.<span class=\"hljs-property\">default</span>)(<span class=\"hljs-variable language_\">this</span>, <span class=\"hljs-title class_\">Person</span>);<br>  &#125;<br><br>  (<span class=\"hljs-number\">0</span>, _createClass3.<span class=\"hljs-property\">default</span>)(<span class=\"hljs-title class_\">Person</span>, [&#123;<br>    <span class=\"hljs-attr\">key</span>: <span class=\"hljs-string\">&quot;sayName&quot;</span>,<br>    <span class=\"hljs-attr\">value</span>: <span class=\"hljs-keyword\">function</span> <span class=\"hljs-title function_\">sayName</span>(<span class=\"hljs-params\"></span>) &#123;<br>      <span class=\"hljs-title function_\">alert</span>(<span class=\"hljs-variable language_\">this</span>.<span class=\"hljs-property\">name</span>);<br>    &#125;<br>  &#125;]);<br>  <span class=\"hljs-keyword\">return</span> <span class=\"hljs-title class_\">Person</span>;<br>&#125;();<br></code></pre></td></tr></table></figure>\n\n<p>实际进行前端开发时，我们除了安装@babel/runtime包，基本也会安装@babel/plugin-transform-runtime这个Babel插件。</p>\n<h1 id=\"Babel-原理与插件开发\"><a href=\"#Babel-原理与插件开发\" class=\"headerlink\" title=\"Babel 原理与插件开发\"></a>Babel 原理与插件开发</h1><p>Babel的转码过程主要由三个阶段组成：解析（parse）、转换（transform）和生成（generate）。这三个阶段分别由@babel/parser、@babel/core和@babel/generator来完成。</p>\n<ol>\n<li><strong>解析阶段</strong></li>\n</ol>\n<p>该阶段由Babel读取源码并生成抽象语法树（AST），该阶段由两部分组成：词法分析与语法分析。</p>\n<p>词法分析会将字符串形式的代码转换成tokens流，语法分析会将tokens流转换成AST。</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\"><span class=\"hljs-keyword\">const</span> name = <span class=\"hljs-string\">&quot;hello AlexCc&quot;</span><br></code></pre></td></tr></table></figure>\n\n<p>AST</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\">-<br>#<span class=\"hljs-number\">1</span><br>  <span class=\"hljs-attr\">type</span>: <span class=\"hljs-title class_\">VariableDeclaration</span><br>  declarations<br>    #<span class=\"hljs-number\">1</span><br>    <span class=\"hljs-attr\">type</span>: <span class=\"hljs-title class_\">VariableDeclarator</span><br>    id<br>      <span class=\"hljs-attr\">type</span>: <span class=\"hljs-title class_\">Identifier</span><br>      <span class=\"hljs-attr\">name</span>: name<br>    init<br>      <span class=\"hljs-attr\">type</span>: <span class=\"hljs-title class_\">Literal</span><br>      <span class=\"hljs-attr\">value</span>: hello <span class=\"hljs-title class_\">AlexCc</span><br>      <span class=\"hljs-attr\">raw</span>: <span class=\"hljs-string\">&quot;hello AlexCc&quot;</span><br>    <span class=\"hljs-attr\">kind</span>: <span class=\"hljs-keyword\">const</span><br></code></pre></td></tr></table></figure>\n\n<ol start=\"2\">\n<li><strong>转换阶段</strong></li>\n</ol>\n<p>完成了解析工作，生成了AST，AST是一个树状的JSON结构。接下来就可以通过Babel插件对该树状结构执行修改操作，修改完成后就得到了新的AST。</p>\n<ol start=\"3\">\n<li><strong>生成阶段</strong></li>\n</ol>\n<p>通过转换阶段的工作，我们得到了新的AST。在生成阶段，我们对AST的树状JSON结构进行还原操作，生成新的JS代码，通常这就是我们需要的ES5代码。</p>\n<h2 id=\"Babel-插件开发\"><a href=\"#Babel-插件开发\" class=\"headerlink\" title=\"Babel 插件开发\"></a>Babel 插件开发</h2><blockquote>\n<p>babel-handbook</p>\n<p><a href=\"https://github.com/jamiebuilds/babel-handbook/blob/master/translations/zh-Hans/plugin-handbook.md\">https://github.com/jamiebuilds/babel-handbook/blob/master/translations/zh-Hans/plugin-handbook.md</a></p>\n</blockquote>\n<p>开发Babel转码插件的重点是在第二阶段（转换阶段），在这一阶段我们要从AST上找出需要转换的节点，改成我们需要的形式，最后在生成阶段把AST变回JS代码。</p>\n<p>插件模板结构:</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\"><span class=\"hljs-variable language_\">module</span>.<span class=\"hljs-property\">exports</span> = <span class=\"hljs-keyword\">function</span>(<span class=\"hljs-params\">&#123; types: t &#125;</span>) &#123;<br>  <span class=\"hljs-keyword\">return</span> &#123;<br>    <span class=\"hljs-attr\">name</span>: <span class=\"hljs-string\">&#x27;pluginName&#x27;</span>,<br>    <span class=\"hljs-attr\">visitor</span>: &#123;&#125;<br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure>\n\n<p>假设我们有这样一段代码：</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\"><span class=\"hljs-keyword\">const</span> dog = <span class=\"hljs-string\">&#x27;is dog&#x27;</span><br></code></pre></td></tr></table></figure>\n\n<p>现在我想将 dog 变成喵咪。</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\"><span class=\"hljs-variable language_\">module</span>.<span class=\"hljs-property\">exports</span> = <span class=\"hljs-keyword\">function</span>(<span class=\"hljs-params\">&#123; types: t &#125;</span>) &#123;<br>  <span class=\"hljs-keyword\">return</span> &#123;<br>    <span class=\"hljs-attr\">visitor</span>: &#123;<br>      <span class=\"hljs-title class_\">Identifier</span>(path, state) &#123;<br>        <span class=\"hljs-keyword\">if</span> (path.<span class=\"hljs-property\">node</span>.<span class=\"hljs-property\">name</span> === <span class=\"hljs-string\">&#x27;dog&#x27;</span>) &#123;<br>          path.<span class=\"hljs-property\">node</span>.<span class=\"hljs-property\">name</span> = <span class=\"hljs-string\">&#x27;cat&#x27;</span><br>          path.<span class=\"hljs-property\">parent</span>.<span class=\"hljs-property\">init</span>.<span class=\"hljs-property\">value</span> = <span class=\"hljs-string\">&#x27;is cat&#x27;</span><br>        &#125;<br>      &#125;,<br>      <span class=\"hljs-keyword\">var</span><br>    &#125;<br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure>\n\n<p>转换后：</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\"><span class=\"hljs-keyword\">const</span> cat = <span class=\"hljs-string\">&#x27;is cat&#x27;</span>;<br></code></pre></td></tr></table></figure>\n\n<p>我们编写Babel插件的主要工作就是修改<code>visitor</code>对象，该对象是遍历AST各个节点的方法。</p>\n<p>在上面的插件里，要把变量名dog修改为cat，于是我们修改了visitor.Identifier方法，那我们如何知道要修改的是Identifier方法呢？</p>\n<p>Babel原理里讲过Babel转码的三个阶段：解析阶段、转换阶段和生成阶段，我们编写的Babel插件实际上是在执行第二个阶段（转换阶段）的工作，该工作需要前一个阶段解析工作先完成。在解析阶段，我们得到了转码前代码的AST树状结构信息，该AST上会有Identifier等节点信息，我们编写插件的时候参考该AST的信息即可。</p>\n<img src=\"./img/ast.jpg\" />\n\n<p>接着看Identifier方法，可以看到它有两个参数path和state，visitor中的每个方法都接收这两个参数，path代表路径。最后我们判断path上节点信息name是不是dog，是的话把它修改为cat即可。</p>\n<p>同理，我们也可以修改 <code>const</code>、<code>value</code>：</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\"><span class=\"hljs-variable language_\">module</span>.<span class=\"hljs-property\">exports</span> = <span class=\"hljs-keyword\">function</span>(<span class=\"hljs-params\">&#123; types: t &#125;</span>) &#123;<br>  <span class=\"hljs-keyword\">return</span> &#123;<br>    <span class=\"hljs-attr\">visitor</span>: &#123;<br>      <span class=\"hljs-title class_\">Identifier</span>(path, state) &#123;<br>        path.<span class=\"hljs-property\">node</span>.<span class=\"hljs-property\">name</span> = <span class=\"hljs-string\">&#x27;cat&#x27;</span><br>        path.<span class=\"hljs-property\">parent</span>.<span class=\"hljs-property\">init</span>.<span class=\"hljs-property\">value</span> = <span class=\"hljs-string\">&#x27;is cat&#x27;</span><br>      &#125;,<br>      <span class=\"hljs-title class_\">VariableDeclaration</span>(path, state) &#123;<br>        <span class=\"hljs-keyword\">if</span> (path.<span class=\"hljs-property\">node</span>.<span class=\"hljs-property\">kind</span> === <span class=\"hljs-string\">&#x27;const&#x27;</span>) &#123;<br>          path.<span class=\"hljs-property\">node</span>.<span class=\"hljs-property\">kind</span> = <span class=\"hljs-string\">&#x27;let&#x27;</span><br>        &#125;<br>      &#125;,<br>      <span class=\"hljs-title class_\">Literal</span>(path, state) &#123;<br>        <span class=\"hljs-comment\">// 修改 value</span><br>        path.<span class=\"hljs-property\">node</span>.<span class=\"hljs-property\">value</span> = <span class=\"hljs-string\">&#x27;is caaat...&#x27;</span><br>      &#125;<br>    &#125;<br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure>\n\n<h2 id=\"插件传参\"><a href=\"#插件传参\" class=\"headerlink\" title=\"插件传参\"></a>插件传参</h2><p>给插件传递参数，注意第一个成员变成了数组，数组的第二项是参数</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\"><span class=\"hljs-comment\">// .babelrc</span><br>&#123;<br>  <span class=\"hljs-string\">&quot;plugins&quot;</span>: [[<span class=\"hljs-string\">&quot;./plugin.js&quot;</span>, &#123;<br>    <span class=\"hljs-string\">&quot;ES5&quot;</span>: <span class=\"hljs-literal\">false</span><br>  &#125;]]<br>&#125;<br></code></pre></td></tr></table></figure>\n\n<p>在插件中，我们可以通过 <code>state.opts</code> 获取到参数：</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\"><span class=\"hljs-comment\">// plugin.js</span><br><br>...<br><span class=\"hljs-title class_\">VariableDeclaration</span>(path, state) &#123;<br>  <span class=\"hljs-keyword\">if</span> (state.<span class=\"hljs-property\">opts</span>.<span class=\"hljs-property\">ES5</span> === <span class=\"hljs-literal\">true</span> &amp;&amp; [<span class=\"hljs-string\">&#x27;let&#x27;</span>, <span class=\"hljs-string\">&#x27;const&#x27;</span>].<span class=\"hljs-title function_\">includes</span>(path.<span class=\"hljs-property\">node</span>.<span class=\"hljs-property\">kind</span>)) &#123;<br>    path.<span class=\"hljs-property\">node</span>.<span class=\"hljs-property\">kind</span> = <span class=\"hljs-string\">&#x27;var&#x27;</span><br>  &#125;<br>&#125;,<br>...<br></code></pre></td></tr></table></figure>\n"},{"_content":"{\n  \"name\": \"module\",\n  \"version\": \"1.0.0\",\n  \"lockfileVersion\": 1,\n  \"requires\": true,\n  \"dependencies\": {\n    \"ansi-regex\": {\n      \"version\": \"2.1.1\",\n      \"resolved\": \"https://registry.npmmirror.com/ansi-regex/-/ansi-regex-2.1.1.tgz\",\n      \"integrity\": \"sha512-TIGnTpdo+E3+pCyAluZvtED5p5wCqLdezCyhPZzKPcxvFplEt4i+W7OONCKgeZFT3+y5NZZfOOS/Bdcanm1MYA==\",\n      \"dev\": true\n    },\n    \"ansi-styles\": {\n      \"version\": \"2.2.1\",\n      \"resolved\": \"https://registry.npmmirror.com/ansi-styles/-/ansi-styles-2.2.1.tgz\",\n      \"integrity\": \"sha512-kmCevFghRiWM7HB5zTPULl4r9bVFSWjz62MhqizDGUrq2NWuNMQyuv4tHHoKJHs69M/MF64lEcHdYIocrdWQYA==\",\n      \"dev\": true\n    },\n    \"anymatch\": {\n      \"version\": \"1.3.2\",\n      \"resolved\": \"https://registry.npmmirror.com/anymatch/-/anymatch-1.3.2.tgz\",\n      \"integrity\": \"sha512-0XNayC8lTHQ2OI8aljNCN3sSx6hsr/1+rlcDAotXJR7C1oZZHCNsfpbKwMjRA3Uqb5tF1Rae2oloTr4xpq+WjA==\",\n      \"dev\": true,\n      \"optional\": true,\n      \"requires\": {\n        \"micromatch\": \"^2.1.5\",\n        \"normalize-path\": \"^2.0.0\"\n      }\n    },\n    \"arr-diff\": {\n      \"version\": \"2.0.0\",\n      \"resolved\": \"https://registry.npmmirror.com/arr-diff/-/arr-diff-2.0.0.tgz\",\n      \"integrity\": \"sha512-dtXTVMkh6VkEEA7OhXnN1Ecb8aAGFdZ1LFxtOCoqj4qkyOJMt7+qs6Ahdy6p/NQCPYsRSXXivhSB/J5E9jmYKA==\",\n      \"dev\": true,\n      \"optional\": true,\n      \"requires\": {\n        \"arr-flatten\": \"^1.0.1\"\n      }\n    },\n    \"arr-flatten\": {\n      \"version\": \"1.1.0\",\n      \"resolved\": \"https://registry.npmmirror.com/arr-flatten/-/arr-flatten-1.1.0.tgz\",\n      \"integrity\": \"sha512-L3hKV5R/p5o81R7O02IGnwpDmkp6E982XhtbuwSe3O4qOtMMMtodicASA1Cny2U+aCXcNpml+m4dPsvsJ3jatg==\",\n      \"dev\": true,\n      \"optional\": true\n    },\n    \"arr-union\": {\n      \"version\": \"3.1.0\",\n      \"resolved\": \"https://registry.npmmirror.com/arr-union/-/arr-union-3.1.0.tgz\",\n      \"integrity\": \"sha512-sKpyeERZ02v1FeCZT8lrfJq5u6goHCtpTAzPwJYe7c8SPFOboNjNg1vz2L4VTn9T4PQxEx13TbXLmYUcS6Ug7Q==\",\n      \"dev\": true,\n      \"optional\": true\n    },\n    \"array-unique\": {\n      \"version\": \"0.2.1\",\n      \"resolved\": \"https://registry.npmmirror.com/array-unique/-/array-unique-0.2.1.tgz\",\n      \"integrity\": \"sha512-G2n5bG5fSUCpnsXz4+8FUkYsGPkNfLn9YvS66U5qbTIXI2Ynnlo4Bi42bWv+omKUCqz+ejzfClwne0alJWJPhg==\",\n      \"dev\": true,\n      \"optional\": true\n    },\n    \"assign-symbols\": {\n      \"version\": \"1.0.0\",\n      \"resolved\": \"https://registry.npmmirror.com/assign-symbols/-/assign-symbols-1.0.0.tgz\",\n      \"integrity\": \"sha512-Q+JC7Whu8HhmTdBph/Tq59IoRtoy6KAm5zzPv00WdujX82lbAL8K7WVjne7vdCsAmbF4AYaDOPyO3k0kl8qIrw==\",\n      \"dev\": true,\n      \"optional\": true\n    },\n    \"async-each\": {\n      \"version\": \"1.0.6\",\n      \"resolved\": \"https://registry.npmmirror.com/async-each/-/async-each-1.0.6.tgz\",\n      \"integrity\": \"sha512-c646jH1avxr+aVpndVMeAfYw7wAa6idufrlN3LPA4PmKS0QEGp6PIC9nwz0WQkkvBGAMEki3pFdtxaF39J9vvg==\",\n      \"dev\": true,\n      \"optional\": true\n    },\n    \"atob\": {\n      \"version\": \"2.1.2\",\n      \"resolved\": \"https://registry.npmmirror.com/atob/-/atob-2.1.2.tgz\",\n      \"integrity\": \"sha512-Wm6ukoaOGJi/73p/cl2GvLjTI5JM1k/O14isD73YML8StrH/7/lRFgmg8nICZgD3bZZvjwCGxtMOD3wWNAu8cg==\",\n      \"dev\": true,\n      \"optional\": true\n    },\n    \"babel-cli\": {\n      \"version\": \"6.26.0\",\n      \"resolved\": \"https://registry.npmmirror.com/babel-cli/-/babel-cli-6.26.0.tgz\",\n      \"integrity\": \"sha512-wau+BDtQfuSBGQ9PzzFL3REvR9Sxnd4LKwtcHAiPjhugA7K/80vpHXafj+O5bAqJOuSefjOx5ZJnNSR2J1Qw6Q==\",\n      \"dev\": true,\n      \"requires\": {\n        \"babel-core\": \"^6.26.0\",\n        \"babel-polyfill\": \"^6.26.0\",\n        \"babel-register\": \"^6.26.0\",\n        \"babel-runtime\": \"^6.26.0\",\n        \"chokidar\": \"^1.6.1\",\n        \"commander\": \"^2.11.0\",\n        \"convert-source-map\": \"^1.5.0\",\n        \"fs-readdir-recursive\": \"^1.0.0\",\n        \"glob\": \"^7.1.2\",\n        \"lodash\": \"^4.17.4\",\n        \"output-file-sync\": \"^1.1.2\",\n        \"path-is-absolute\": \"^1.0.1\",\n        \"slash\": \"^1.0.0\",\n        \"source-map\": \"^0.5.6\",\n        \"v8flags\": \"^2.1.1\"\n      }\n    },\n    \"babel-code-frame\": {\n      \"version\": \"6.26.0\",\n      \"resolved\": \"https://registry.npmmirror.com/babel-code-frame/-/babel-code-frame-6.26.0.tgz\",\n      \"integrity\": \"sha512-XqYMR2dfdGMW+hd0IUZ2PwK+fGeFkOxZJ0wY+JaQAHzt1Zx8LcvpiZD2NiGkEG8qx0CfkAOr5xt76d1e8vG90g==\",\n      \"dev\": true,\n      \"requires\": {\n        \"chalk\": \"^1.1.3\",\n        \"esutils\": \"^2.0.2\",\n        \"js-tokens\": \"^3.0.2\"\n      }\n    },\n    \"babel-core\": {\n      \"version\": \"6.26.3\",\n      \"resolved\": \"https://registry.npmmirror.com/babel-core/-/babel-core-6.26.3.tgz\",\n      \"integrity\": \"sha512-6jyFLuDmeidKmUEb3NM+/yawG0M2bDZ9Z1qbZP59cyHLz8kYGKYwpJP0UwUKKUiTRNvxfLesJnTedqczP7cTDA==\",\n      \"dev\": true,\n      \"requires\": {\n        \"babel-code-frame\": \"^6.26.0\",\n        \"babel-generator\": \"^6.26.0\",\n        \"babel-helpers\": \"^6.24.1\",\n        \"babel-messages\": \"^6.23.0\",\n        \"babel-register\": \"^6.26.0\",\n        \"babel-runtime\": \"^6.26.0\",\n        \"babel-template\": \"^6.26.0\",\n        \"babel-traverse\": \"^6.26.0\",\n        \"babel-types\": \"^6.26.0\",\n        \"babylon\": \"^6.18.0\",\n        \"convert-source-map\": \"^1.5.1\",\n        \"debug\": \"^2.6.9\",\n        \"json5\": \"^0.5.1\",\n        \"lodash\": \"^4.17.4\",\n        \"minimatch\": \"^3.0.4\",\n        \"path-is-absolute\": \"^1.0.1\",\n        \"private\": \"^0.1.8\",\n        \"slash\": \"^1.0.0\",\n        \"source-map\": \"^0.5.7\"\n      }\n    },\n    \"babel-generator\": {\n      \"version\": \"6.26.1\",\n      \"resolved\": \"https://registry.npmmirror.com/babel-generator/-/babel-generator-6.26.1.tgz\",\n      \"integrity\": \"sha512-HyfwY6ApZj7BYTcJURpM5tznulaBvyio7/0d4zFOeMPUmfxkCjHocCuoLa2SAGzBI8AREcH3eP3758F672DppA==\",\n      \"dev\": true,\n      \"requires\": {\n        \"babel-messages\": \"^6.23.0\",\n        \"babel-runtime\": \"^6.26.0\",\n        \"babel-types\": \"^6.26.0\",\n        \"detect-indent\": \"^4.0.0\",\n        \"jsesc\": \"^1.3.0\",\n        \"lodash\": \"^4.17.4\",\n        \"source-map\": \"^0.5.7\",\n        \"trim-right\": \"^1.0.1\"\n      }\n    },\n    \"babel-helper-builder-binary-assignment-operator-visitor\": {\n      \"version\": \"6.24.1\",\n      \"resolved\": \"https://registry.npmmirror.com/babel-helper-builder-binary-assignment-operator-visitor/-/babel-helper-builder-binary-assignment-operator-visitor-6.24.1.tgz\",\n      \"integrity\": \"sha512-gCtfYORSG1fUMX4kKraymq607FWgMWg+j42IFPc18kFQEsmtaibP4UrqsXt8FlEJle25HUd4tsoDR7H2wDhe9Q==\",\n      \"dev\": true,\n      \"requires\": {\n        \"babel-helper-explode-assignable-expression\": \"^6.24.1\",\n        \"babel-runtime\": \"^6.22.0\",\n        \"babel-types\": \"^6.24.1\"\n      }\n    },\n    \"babel-helper-call-delegate\": {\n      \"version\": \"6.24.1\",\n      \"resolved\": \"https://registry.npmmirror.com/babel-helper-call-delegate/-/babel-helper-call-delegate-6.24.1.tgz\",\n      \"integrity\": \"sha512-RL8n2NiEj+kKztlrVJM9JT1cXzzAdvWFh76xh/H1I4nKwunzE4INBXn8ieCZ+wh4zWszZk7NBS1s/8HR5jDkzQ==\",\n      \"dev\": true,\n      \"requires\": {\n        \"babel-helper-hoist-variables\": \"^6.24.1\",\n        \"babel-runtime\": \"^6.22.0\",\n        \"babel-traverse\": \"^6.24.1\",\n        \"babel-types\": \"^6.24.1\"\n      }\n    },\n    \"babel-helper-define-map\": {\n      \"version\": \"6.26.0\",\n      \"resolved\": \"https://registry.npmmirror.com/babel-helper-define-map/-/babel-helper-define-map-6.26.0.tgz\",\n      \"integrity\": \"sha512-bHkmjcC9lM1kmZcVpA5t2om2nzT/xiZpo6TJq7UlZ3wqKfzia4veeXbIhKvJXAMzhhEBd3cR1IElL5AenWEUpA==\",\n      \"dev\": true,\n      \"requires\": {\n        \"babel-helper-function-name\": \"^6.24.1\",\n        \"babel-runtime\": \"^6.26.0\",\n        \"babel-types\": \"^6.26.0\",\n        \"lodash\": \"^4.17.4\"\n      }\n    },\n    \"babel-helper-explode-assignable-expression\": {\n      \"version\": \"6.24.1\",\n      \"resolved\": \"https://registry.npmmirror.com/babel-helper-explode-assignable-expression/-/babel-helper-explode-assignable-expression-6.24.1.tgz\",\n      \"integrity\": \"sha512-qe5csbhbvq6ccry9G7tkXbzNtcDiH4r51rrPUbwwoTzZ18AqxWYRZT6AOmxrpxKnQBW0pYlBI/8vh73Z//78nQ==\",\n      \"dev\": true,\n      \"requires\": {\n        \"babel-runtime\": \"^6.22.0\",\n        \"babel-traverse\": \"^6.24.1\",\n        \"babel-types\": \"^6.24.1\"\n      }\n    },\n    \"babel-helper-function-name\": {\n      \"version\": \"6.24.1\",\n      \"resolved\": \"https://registry.npmmirror.com/babel-helper-function-name/-/babel-helper-function-name-6.24.1.tgz\",\n      \"integrity\": \"sha512-Oo6+e2iX+o9eVvJ9Y5eKL5iryeRdsIkwRYheCuhYdVHsdEQysbc2z2QkqCLIYnNxkT5Ss3ggrHdXiDI7Dhrn4Q==\",\n      \"dev\": true,\n      \"requires\": {\n        \"babel-helper-get-function-arity\": \"^6.24.1\",\n        \"babel-runtime\": \"^6.22.0\",\n        \"babel-template\": \"^6.24.1\",\n        \"babel-traverse\": \"^6.24.1\",\n        \"babel-types\": \"^6.24.1\"\n      }\n    },\n    \"babel-helper-get-function-arity\": {\n      \"version\": \"6.24.1\",\n      \"resolved\": \"https://registry.npmmirror.com/babel-helper-get-function-arity/-/babel-helper-get-function-arity-6.24.1.tgz\",\n      \"integrity\": \"sha512-WfgKFX6swFB1jS2vo+DwivRN4NB8XUdM3ij0Y1gnC21y1tdBoe6xjVnd7NSI6alv+gZXCtJqvrTeMW3fR/c0ng==\",\n      \"dev\": true,\n      \"requires\": {\n        \"babel-runtime\": \"^6.22.0\",\n        \"babel-types\": \"^6.24.1\"\n      }\n    },\n    \"babel-helper-hoist-variables\": {\n      \"version\": \"6.24.1\",\n      \"resolved\": \"https://registry.npmmirror.com/babel-helper-hoist-variables/-/babel-helper-hoist-variables-6.24.1.tgz\",\n      \"integrity\": \"sha512-zAYl3tqerLItvG5cKYw7f1SpvIxS9zi7ohyGHaI9cgDUjAT6YcY9jIEH5CstetP5wHIVSceXwNS7Z5BpJg+rOw==\",\n      \"dev\": true,\n      \"requires\": {\n        \"babel-runtime\": \"^6.22.0\",\n        \"babel-types\": \"^6.24.1\"\n      }\n    },\n    \"babel-helper-optimise-call-expression\": {\n      \"version\": \"6.24.1\",\n      \"resolved\": \"https://registry.npmmirror.com/babel-helper-optimise-call-expression/-/babel-helper-optimise-call-expression-6.24.1.tgz\",\n      \"integrity\": \"sha512-Op9IhEaxhbRT8MDXx2iNuMgciu2V8lDvYCNQbDGjdBNCjaMvyLf4wl4A3b8IgndCyQF8TwfgsQ8T3VD8aX1/pA==\",\n      \"dev\": true,\n      \"requires\": {\n        \"babel-runtime\": \"^6.22.0\",\n        \"babel-types\": \"^6.24.1\"\n      }\n    },\n    \"babel-helper-regex\": {\n      \"version\": \"6.26.0\",\n      \"resolved\": \"https://registry.npmmirror.com/babel-helper-regex/-/babel-helper-regex-6.26.0.tgz\",\n      \"integrity\": \"sha512-VlPiWmqmGJp0x0oK27Out1D+71nVVCTSdlbhIVoaBAj2lUgrNjBCRR9+llO4lTSb2O4r7PJg+RobRkhBrf6ofg==\",\n      \"dev\": true,\n      \"requires\": {\n        \"babel-runtime\": \"^6.26.0\",\n        \"babel-types\": \"^6.26.0\",\n        \"lodash\": \"^4.17.4\"\n      }\n    },\n    \"babel-helper-remap-async-to-generator\": {\n      \"version\": \"6.24.1\",\n      \"resolved\": \"https://registry.npmmirror.com/babel-helper-remap-async-to-generator/-/babel-helper-remap-async-to-generator-6.24.1.tgz\",\n      \"integrity\": \"sha512-RYqaPD0mQyQIFRu7Ho5wE2yvA/5jxqCIj/Lv4BXNq23mHYu/vxikOy2JueLiBxQknwapwrJeNCesvY0ZcfnlHg==\",\n      \"dev\": true,\n      \"requires\": {\n        \"babel-helper-function-name\": \"^6.24.1\",\n        \"babel-runtime\": \"^6.22.0\",\n        \"babel-template\": \"^6.24.1\",\n        \"babel-traverse\": \"^6.24.1\",\n        \"babel-types\": \"^6.24.1\"\n      }\n    },\n    \"babel-helper-replace-supers\": {\n      \"version\": \"6.24.1\",\n      \"resolved\": \"https://registry.npmmirror.com/babel-helper-replace-supers/-/babel-helper-replace-supers-6.24.1.tgz\",\n      \"integrity\": \"sha512-sLI+u7sXJh6+ToqDr57Bv973kCepItDhMou0xCP2YPVmR1jkHSCY+p1no8xErbV1Siz5QE8qKT1WIwybSWlqjw==\",\n      \"dev\": true,\n      \"requires\": {\n        \"babel-helper-optimise-call-expression\": \"^6.24.1\",\n        \"babel-messages\": \"^6.23.0\",\n        \"babel-runtime\": \"^6.22.0\",\n        \"babel-template\": \"^6.24.1\",\n        \"babel-traverse\": \"^6.24.1\",\n        \"babel-types\": \"^6.24.1\"\n      }\n    },\n    \"babel-helpers\": {\n      \"version\": \"6.24.1\",\n      \"resolved\": \"https://registry.npmmirror.com/babel-helpers/-/babel-helpers-6.24.1.tgz\",\n      \"integrity\": \"sha512-n7pFrqQm44TCYvrCDb0MqabAF+JUBq+ijBvNMUxpkLjJaAu32faIexewMumrH5KLLJ1HDyT0PTEqRyAe/GwwuQ==\",\n      \"dev\": true,\n      \"requires\": {\n        \"babel-runtime\": \"^6.22.0\",\n        \"babel-template\": \"^6.24.1\"\n      }\n    },\n    \"babel-messages\": {\n      \"version\": \"6.23.0\",\n      \"resolved\": \"https://registry.npmmirror.com/babel-messages/-/babel-messages-6.23.0.tgz\",\n      \"integrity\": \"sha512-Bl3ZiA+LjqaMtNYopA9TYE9HP1tQ+E5dLxE0XrAzcIJeK2UqF0/EaqXwBn9esd4UmTfEab+P+UYQ1GnioFIb/w==\",\n      \"dev\": true,\n      \"requires\": {\n        \"babel-runtime\": \"^6.22.0\"\n      }\n    },\n    \"babel-plugin-check-es2015-constants\": {\n      \"version\": \"6.22.0\",\n      \"resolved\": \"https://registry.npmmirror.com/babel-plugin-check-es2015-constants/-/babel-plugin-check-es2015-constants-6.22.0.tgz\",\n      \"integrity\": \"sha512-B1M5KBP29248dViEo1owyY32lk1ZSH2DaNNrXLGt8lyjjHm7pBqAdQ7VKUPR6EEDO323+OvT3MQXbCin8ooWdA==\",\n      \"dev\": true,\n      \"requires\": {\n        \"babel-runtime\": \"^6.22.0\"\n      }\n    },\n    \"babel-plugin-syntax-async-functions\": {\n      \"version\": \"6.13.0\",\n      \"resolved\": \"https://registry.npmmirror.com/babel-plugin-syntax-async-functions/-/babel-plugin-syntax-async-functions-6.13.0.tgz\",\n      \"integrity\": \"sha512-4Zp4unmHgw30A1eWI5EpACji2qMocisdXhAftfhXoSV9j0Tvj6nRFE3tOmRY912E0FMRm/L5xWE7MGVT2FoLnw==\",\n      \"dev\": true\n    },\n    \"babel-plugin-syntax-exponentiation-operator\": {\n      \"version\": \"6.13.0\",\n      \"resolved\": \"https://registry.npmmirror.com/babel-plugin-syntax-exponentiation-operator/-/babel-plugin-syntax-exponentiation-operator-6.13.0.tgz\",\n      \"integrity\": \"sha512-Z/flU+T9ta0aIEKl1tGEmN/pZiI1uXmCiGFRegKacQfEJzp7iNsKloZmyJlQr+75FCJtiFfGIK03SiCvCt9cPQ==\",\n      \"dev\": true\n    },\n    \"babel-plugin-syntax-trailing-function-commas\": {\n      \"version\": \"6.22.0\",\n      \"resolved\": \"https://registry.npmmirror.com/babel-plugin-syntax-trailing-function-commas/-/babel-plugin-syntax-trailing-function-commas-6.22.0.tgz\",\n      \"integrity\": \"sha512-Gx9CH3Q/3GKbhs07Bszw5fPTlU+ygrOGfAhEt7W2JICwufpC4SuO0mG0+4NykPBSYPMJhqvVlDBU17qB1D+hMQ==\",\n      \"dev\": true\n    },\n    \"babel-plugin-transform-async-to-generator\": {\n      \"version\": \"6.24.1\",\n      \"resolved\": \"https://registry.npmmirror.com/babel-plugin-transform-async-to-generator/-/babel-plugin-transform-async-to-generator-6.24.1.tgz\",\n      \"integrity\": \"sha512-7BgYJujNCg0Ti3x0c/DL3tStvnKS6ktIYOmo9wginv/dfZOrbSZ+qG4IRRHMBOzZ5Awb1skTiAsQXg/+IWkZYw==\",\n      \"dev\": true,\n      \"requires\": {\n        \"babel-helper-remap-async-to-generator\": \"^6.24.1\",\n        \"babel-plugin-syntax-async-functions\": \"^6.8.0\",\n        \"babel-runtime\": \"^6.22.0\"\n      }\n    },\n    \"babel-plugin-transform-es2015-arrow-functions\": {\n      \"version\": \"6.22.0\",\n      \"resolved\": \"https://registry.npmmirror.com/babel-plugin-transform-es2015-arrow-functions/-/babel-plugin-transform-es2015-arrow-functions-6.22.0.tgz\",\n      \"integrity\": \"sha512-PCqwwzODXW7JMrzu+yZIaYbPQSKjDTAsNNlK2l5Gg9g4rz2VzLnZsStvp/3c46GfXpwkyufb3NCyG9+50FF1Vg==\",\n      \"dev\": true,\n      \"requires\": {\n        \"babel-runtime\": \"^6.22.0\"\n      }\n    },\n    \"babel-plugin-transform-es2015-block-scoped-functions\": {\n      \"version\": \"6.22.0\",\n      \"resolved\": \"https://registry.npmmirror.com/babel-plugin-transform-es2015-block-scoped-functions/-/babel-plugin-transform-es2015-block-scoped-functions-6.22.0.tgz\",\n      \"integrity\": \"sha512-2+ujAT2UMBzYFm7tidUsYh+ZoIutxJ3pN9IYrF1/H6dCKtECfhmB8UkHVpyxDwkj0CYbQG35ykoz925TUnBc3A==\",\n      \"dev\": true,\n      \"requires\": {\n        \"babel-runtime\": \"^6.22.0\"\n      }\n    },\n    \"babel-plugin-transform-es2015-block-scoping\": {\n      \"version\": \"6.26.0\",\n      \"resolved\": \"https://registry.npmmirror.com/babel-plugin-transform-es2015-block-scoping/-/babel-plugin-transform-es2015-block-scoping-6.26.0.tgz\",\n      \"integrity\": \"sha512-YiN6sFAQ5lML8JjCmr7uerS5Yc/EMbgg9G8ZNmk2E3nYX4ckHR01wrkeeMijEf5WHNK5TW0Sl0Uu3pv3EdOJWw==\",\n      \"dev\": true,\n      \"requires\": {\n        \"babel-runtime\": \"^6.26.0\",\n        \"babel-template\": \"^6.26.0\",\n        \"babel-traverse\": \"^6.26.0\",\n        \"babel-types\": \"^6.26.0\",\n        \"lodash\": \"^4.17.4\"\n      }\n    },\n    \"babel-plugin-transform-es2015-classes\": {\n      \"version\": \"6.24.1\",\n      \"resolved\": \"https://registry.npmmirror.com/babel-plugin-transform-es2015-classes/-/babel-plugin-transform-es2015-classes-6.24.1.tgz\",\n      \"integrity\": \"sha512-5Dy7ZbRinGrNtmWpquZKZ3EGY8sDgIVB4CU8Om8q8tnMLrD/m94cKglVcHps0BCTdZ0TJeeAWOq2TK9MIY6cag==\",\n      \"dev\": true,\n      \"requires\": {\n        \"babel-helper-define-map\": \"^6.24.1\",\n        \"babel-helper-function-name\": \"^6.24.1\",\n        \"babel-helper-optimise-call-expression\": \"^6.24.1\",\n        \"babel-helper-replace-supers\": \"^6.24.1\",\n        \"babel-messages\": \"^6.23.0\",\n        \"babel-runtime\": \"^6.22.0\",\n        \"babel-template\": \"^6.24.1\",\n        \"babel-traverse\": \"^6.24.1\",\n        \"babel-types\": \"^6.24.1\"\n      }\n    },\n    \"babel-plugin-transform-es2015-computed-properties\": {\n      \"version\": \"6.24.1\",\n      \"resolved\": \"https://registry.npmmirror.com/babel-plugin-transform-es2015-computed-properties/-/babel-plugin-transform-es2015-computed-properties-6.24.1.tgz\",\n      \"integrity\": \"sha512-C/uAv4ktFP/Hmh01gMTvYvICrKze0XVX9f2PdIXuriCSvUmV9j+u+BB9f5fJK3+878yMK6dkdcq+Ymr9mrcLzw==\",\n      \"dev\": true,\n      \"requires\": {\n        \"babel-runtime\": \"^6.22.0\",\n        \"babel-template\": \"^6.24.1\"\n      }\n    },\n    \"babel-plugin-transform-es2015-destructuring\": {\n      \"version\": \"6.23.0\",\n      \"resolved\": \"https://registry.npmmirror.com/babel-plugin-transform-es2015-destructuring/-/babel-plugin-transform-es2015-destructuring-6.23.0.tgz\",\n      \"integrity\": \"sha512-aNv/GDAW0j/f4Uy1OEPZn1mqD+Nfy9viFGBfQ5bZyT35YqOiqx7/tXdyfZkJ1sC21NyEsBdfDY6PYmLHF4r5iA==\",\n      \"dev\": true,\n      \"requires\": {\n        \"babel-runtime\": \"^6.22.0\"\n      }\n    },\n    \"babel-plugin-transform-es2015-duplicate-keys\": {\n      \"version\": \"6.24.1\",\n      \"resolved\": \"https://registry.npmmirror.com/babel-plugin-transform-es2015-duplicate-keys/-/babel-plugin-transform-es2015-duplicate-keys-6.24.1.tgz\",\n      \"integrity\": \"sha512-ossocTuPOssfxO2h+Z3/Ea1Vo1wWx31Uqy9vIiJusOP4TbF7tPs9U0sJ9pX9OJPf4lXRGj5+6Gkl/HHKiAP5ug==\",\n      \"dev\": true,\n      \"requires\": {\n        \"babel-runtime\": \"^6.22.0\",\n        \"babel-types\": \"^6.24.1\"\n      }\n    },\n    \"babel-plugin-transform-es2015-for-of\": {\n      \"version\": \"6.23.0\",\n      \"resolved\": \"https://registry.npmmirror.com/babel-plugin-transform-es2015-for-of/-/babel-plugin-transform-es2015-for-of-6.23.0.tgz\",\n      \"integrity\": \"sha512-DLuRwoygCoXx+YfxHLkVx5/NpeSbVwfoTeBykpJK7JhYWlL/O8hgAK/reforUnZDlxasOrVPPJVI/guE3dCwkw==\",\n      \"dev\": true,\n      \"requires\": {\n        \"babel-runtime\": \"^6.22.0\"\n      }\n    },\n    \"babel-plugin-transform-es2015-function-name\": {\n      \"version\": \"6.24.1\",\n      \"resolved\": \"https://registry.npmmirror.com/babel-plugin-transform-es2015-function-name/-/babel-plugin-transform-es2015-function-name-6.24.1.tgz\",\n      \"integrity\": \"sha512-iFp5KIcorf11iBqu/y/a7DK3MN5di3pNCzto61FqCNnUX4qeBwcV1SLqe10oXNnCaxBUImX3SckX2/o1nsrTcg==\",\n      \"dev\": true,\n      \"requires\": {\n        \"babel-helper-function-name\": \"^6.24.1\",\n        \"babel-runtime\": \"^6.22.0\",\n        \"babel-types\": \"^6.24.1\"\n      }\n    },\n    \"babel-plugin-transform-es2015-literals\": {\n      \"version\": \"6.22.0\",\n      \"resolved\": \"https://registry.npmmirror.com/babel-plugin-transform-es2015-literals/-/babel-plugin-transform-es2015-literals-6.22.0.tgz\",\n      \"integrity\": \"sha512-tjFl0cwMPpDYyoqYA9li1/7mGFit39XiNX5DKC/uCNjBctMxyL1/PT/l4rSlbvBG1pOKI88STRdUsWXB3/Q9hQ==\",\n      \"dev\": true,\n      \"requires\": {\n        \"babel-runtime\": \"^6.22.0\"\n      }\n    },\n    \"babel-plugin-transform-es2015-modules-amd\": {\n      \"version\": \"6.24.1\",\n      \"resolved\": \"https://registry.npmmirror.com/babel-plugin-transform-es2015-modules-amd/-/babel-plugin-transform-es2015-modules-amd-6.24.1.tgz\",\n      \"integrity\": \"sha512-LnIIdGWIKdw7zwckqx+eGjcS8/cl8D74A3BpJbGjKTFFNJSMrjN4bIh22HY1AlkUbeLG6X6OZj56BDvWD+OeFA==\",\n      \"dev\": true,\n      \"requires\": {\n        \"babel-plugin-transform-es2015-modules-commonjs\": \"^6.24.1\",\n        \"babel-runtime\": \"^6.22.0\",\n        \"babel-template\": \"^6.24.1\"\n      }\n    },\n    \"babel-plugin-transform-es2015-modules-commonjs\": {\n      \"version\": \"6.26.2\",\n      \"resolved\": \"https://registry.npmmirror.com/babel-plugin-transform-es2015-modules-commonjs/-/babel-plugin-transform-es2015-modules-commonjs-6.26.2.tgz\",\n      \"integrity\": \"sha512-CV9ROOHEdrjcwhIaJNBGMBCodN+1cfkwtM1SbUHmvyy35KGT7fohbpOxkE2uLz1o6odKK2Ck/tz47z+VqQfi9Q==\",\n      \"dev\": true,\n      \"requires\": {\n        \"babel-plugin-transform-strict-mode\": \"^6.24.1\",\n        \"babel-runtime\": \"^6.26.0\",\n        \"babel-template\": \"^6.26.0\",\n        \"babel-types\": \"^6.26.0\"\n      }\n    },\n    \"babel-plugin-transform-es2015-modules-systemjs\": {\n      \"version\": \"6.24.1\",\n      \"resolved\": \"https://registry.npmmirror.com/babel-plugin-transform-es2015-modules-systemjs/-/babel-plugin-transform-es2015-modules-systemjs-6.24.1.tgz\",\n      \"integrity\": \"sha512-ONFIPsq8y4bls5PPsAWYXH/21Hqv64TBxdje0FvU3MhIV6QM2j5YS7KvAzg/nTIVLot2D2fmFQrFWCbgHlFEjg==\",\n      \"dev\": true,\n      \"requires\": {\n        \"babel-helper-hoist-variables\": \"^6.24.1\",\n        \"babel-runtime\": \"^6.22.0\",\n        \"babel-template\": \"^6.24.1\"\n      }\n    },\n    \"babel-plugin-transform-es2015-modules-umd\": {\n      \"version\": \"6.24.1\",\n      \"resolved\": \"https://registry.npmmirror.com/babel-plugin-transform-es2015-modules-umd/-/babel-plugin-transform-es2015-modules-umd-6.24.1.tgz\",\n      \"integrity\": \"sha512-LpVbiT9CLsuAIp3IG0tfbVo81QIhn6pE8xBJ7XSeCtFlMltuar5VuBV6y6Q45tpui9QWcy5i0vLQfCfrnF7Kiw==\",\n      \"dev\": true,\n      \"requires\": {\n        \"babel-plugin-transform-es2015-modules-amd\": \"^6.24.1\",\n        \"babel-runtime\": \"^6.22.0\",\n        \"babel-template\": \"^6.24.1\"\n      }\n    },\n    \"babel-plugin-transform-es2015-object-super\": {\n      \"version\": \"6.24.1\",\n      \"resolved\": \"https://registry.npmmirror.com/babel-plugin-transform-es2015-object-super/-/babel-plugin-transform-es2015-object-super-6.24.1.tgz\",\n      \"integrity\": \"sha512-8G5hpZMecb53vpD3mjs64NhI1au24TAmokQ4B+TBFBjN9cVoGoOvotdrMMRmHvVZUEvqGUPWL514woru1ChZMA==\",\n      \"dev\": true,\n      \"requires\": {\n        \"babel-helper-replace-supers\": \"^6.24.1\",\n        \"babel-runtime\": \"^6.22.0\"\n      }\n    },\n    \"babel-plugin-transform-es2015-parameters\": {\n      \"version\": \"6.24.1\",\n      \"resolved\": \"https://registry.npmmirror.com/babel-plugin-transform-es2015-parameters/-/babel-plugin-transform-es2015-parameters-6.24.1.tgz\",\n      \"integrity\": \"sha512-8HxlW+BB5HqniD+nLkQ4xSAVq3bR/pcYW9IigY+2y0dI+Y7INFeTbfAQr+63T3E4UDsZGjyb+l9txUnABWxlOQ==\",\n      \"dev\": true,\n      \"requires\": {\n        \"babel-helper-call-delegate\": \"^6.24.1\",\n        \"babel-helper-get-function-arity\": \"^6.24.1\",\n        \"babel-runtime\": \"^6.22.0\",\n        \"babel-template\": \"^6.24.1\",\n        \"babel-traverse\": \"^6.24.1\",\n        \"babel-types\": \"^6.24.1\"\n      }\n    },\n    \"babel-plugin-transform-es2015-shorthand-properties\": {\n      \"version\": \"6.24.1\",\n      \"resolved\": \"https://registry.npmmirror.com/babel-plugin-transform-es2015-shorthand-properties/-/babel-plugin-transform-es2015-shorthand-properties-6.24.1.tgz\",\n      \"integrity\": \"sha512-mDdocSfUVm1/7Jw/FIRNw9vPrBQNePy6wZJlR8HAUBLybNp1w/6lr6zZ2pjMShee65t/ybR5pT8ulkLzD1xwiw==\",\n      \"dev\": true,\n      \"requires\": {\n        \"babel-runtime\": \"^6.22.0\",\n        \"babel-types\": \"^6.24.1\"\n      }\n    },\n    \"babel-plugin-transform-es2015-spread\": {\n      \"version\": \"6.22.0\",\n      \"resolved\": \"https://registry.npmmirror.com/babel-plugin-transform-es2015-spread/-/babel-plugin-transform-es2015-spread-6.22.0.tgz\",\n      \"integrity\": \"sha512-3Ghhi26r4l3d0Js933E5+IhHwk0A1yiutj9gwvzmFbVV0sPMYk2lekhOufHBswX7NCoSeF4Xrl3sCIuSIa+zOg==\",\n      \"dev\": true,\n      \"requires\": {\n        \"babel-runtime\": \"^6.22.0\"\n      }\n    },\n    \"babel-plugin-transform-es2015-sticky-regex\": {\n      \"version\": \"6.24.1\",\n      \"resolved\": \"https://registry.npmmirror.com/babel-plugin-transform-es2015-sticky-regex/-/babel-plugin-transform-es2015-sticky-regex-6.24.1.tgz\",\n      \"integrity\": \"sha512-CYP359ADryTo3pCsH0oxRo/0yn6UsEZLqYohHmvLQdfS9xkf+MbCzE3/Kolw9OYIY4ZMilH25z/5CbQbwDD+lQ==\",\n      \"dev\": true,\n      \"requires\": {\n        \"babel-helper-regex\": \"^6.24.1\",\n        \"babel-runtime\": \"^6.22.0\",\n        \"babel-types\": \"^6.24.1\"\n      }\n    },\n    \"babel-plugin-transform-es2015-template-literals\": {\n      \"version\": \"6.22.0\",\n      \"resolved\": \"https://registry.npmmirror.com/babel-plugin-transform-es2015-template-literals/-/babel-plugin-transform-es2015-template-literals-6.22.0.tgz\",\n      \"integrity\": \"sha512-x8b9W0ngnKzDMHimVtTfn5ryimars1ByTqsfBDwAqLibmuuQY6pgBQi5z1ErIsUOWBdw1bW9FSz5RZUojM4apg==\",\n      \"dev\": true,\n      \"requires\": {\n        \"babel-runtime\": \"^6.22.0\"\n      }\n    },\n    \"babel-plugin-transform-es2015-typeof-symbol\": {\n      \"version\": \"6.23.0\",\n      \"resolved\": \"https://registry.npmmirror.com/babel-plugin-transform-es2015-typeof-symbol/-/babel-plugin-transform-es2015-typeof-symbol-6.23.0.tgz\",\n      \"integrity\": \"sha512-fz6J2Sf4gYN6gWgRZaoFXmq93X+Li/8vf+fb0sGDVtdeWvxC9y5/bTD7bvfWMEq6zetGEHpWjtzRGSugt5kNqw==\",\n      \"dev\": true,\n      \"requires\": {\n        \"babel-runtime\": \"^6.22.0\"\n      }\n    },\n    \"babel-plugin-transform-es2015-unicode-regex\": {\n      \"version\": \"6.24.1\",\n      \"resolved\": \"https://registry.npmmirror.com/babel-plugin-transform-es2015-unicode-regex/-/babel-plugin-transform-es2015-unicode-regex-6.24.1.tgz\",\n      \"integrity\": \"sha512-v61Dbbihf5XxnYjtBN04B/JBvsScY37R1cZT5r9permN1cp+b70DY3Ib3fIkgn1DI9U3tGgBJZVD8p/mE/4JbQ==\",\n      \"dev\": true,\n      \"requires\": {\n        \"babel-helper-regex\": \"^6.24.1\",\n        \"babel-runtime\": \"^6.22.0\",\n        \"regexpu-core\": \"^2.0.0\"\n      }\n    },\n    \"babel-plugin-transform-exponentiation-operator\": {\n      \"version\": \"6.24.1\",\n      \"resolved\": \"https://registry.npmmirror.com/babel-plugin-transform-exponentiation-operator/-/babel-plugin-transform-exponentiation-operator-6.24.1.tgz\",\n      \"integrity\": \"sha512-LzXDmbMkklvNhprr20//RStKVcT8Cu+SQtX18eMHLhjHf2yFzwtQ0S2f0jQ+89rokoNdmwoSqYzAhq86FxlLSQ==\",\n      \"dev\": true,\n      \"requires\": {\n        \"babel-helper-builder-binary-assignment-operator-visitor\": \"^6.24.1\",\n        \"babel-plugin-syntax-exponentiation-operator\": \"^6.8.0\",\n        \"babel-runtime\": \"^6.22.0\"\n      }\n    },\n    \"babel-plugin-transform-regenerator\": {\n      \"version\": \"6.26.0\",\n      \"resolved\": \"https://registry.npmmirror.com/babel-plugin-transform-regenerator/-/babel-plugin-transform-regenerator-6.26.0.tgz\",\n      \"integrity\": \"sha512-LS+dBkUGlNR15/5WHKe/8Neawx663qttS6AGqoOUhICc9d1KciBvtrQSuc0PI+CxQ2Q/S1aKuJ+u64GtLdcEZg==\",\n      \"dev\": true,\n      \"requires\": {\n        \"regenerator-transform\": \"^0.10.0\"\n      }\n    },\n    \"babel-plugin-transform-runtime\": {\n      \"version\": \"6.23.0\",\n      \"resolved\": \"https://registry.npmmirror.com/babel-plugin-transform-runtime/-/babel-plugin-transform-runtime-6.23.0.tgz\",\n      \"integrity\": \"sha512-cpGMVC1vt/772y3jx1gwSaTitQVZuFDlllgreMsZ+rTYC6jlYXRyf5FQOgSnckOiA5QmzbXTyBY2A5AmZXF1fA==\",\n      \"dev\": true,\n      \"requires\": {\n        \"babel-runtime\": \"^6.22.0\"\n      }\n    },\n    \"babel-plugin-transform-strict-mode\": {\n      \"version\": \"6.24.1\",\n      \"resolved\": \"https://registry.npmmirror.com/babel-plugin-transform-strict-mode/-/babel-plugin-transform-strict-mode-6.24.1.tgz\",\n      \"integrity\": \"sha512-j3KtSpjyLSJxNoCDrhwiJad8kw0gJ9REGj8/CqL0HeRyLnvUNYV9zcqluL6QJSXh3nfsLEmSLvwRfGzrgR96Pw==\",\n      \"dev\": true,\n      \"requires\": {\n        \"babel-runtime\": \"^6.22.0\",\n        \"babel-types\": \"^6.24.1\"\n      }\n    },\n    \"babel-polyfill\": {\n      \"version\": \"6.26.0\",\n      \"resolved\": \"https://registry.npmmirror.com/babel-polyfill/-/babel-polyfill-6.26.0.tgz\",\n      \"integrity\": \"sha512-F2rZGQnAdaHWQ8YAoeRbukc7HS9QgdgeyJ0rQDd485v9opwuPvjpPFcOOT/WmkKTdgy9ESgSPXDcTNpzrGr6iQ==\",\n      \"dev\": true,\n      \"requires\": {\n        \"babel-runtime\": \"^6.26.0\",\n        \"core-js\": \"^2.5.0\",\n        \"regenerator-runtime\": \"^0.10.5\"\n      },\n      \"dependencies\": {\n        \"regenerator-runtime\": {\n          \"version\": \"0.10.5\",\n          \"resolved\": \"https://registry.npmmirror.com/regenerator-runtime/-/regenerator-runtime-0.10.5.tgz\",\n          \"integrity\": \"sha512-02YopEIhAgiBHWeoTiA8aitHDt8z6w+rQqNuIftlM+ZtvSl/brTouaU7DW6GO/cHtvxJvS4Hwv2ibKdxIRi24w==\",\n          \"dev\": true\n        }\n      }\n    },\n    \"babel-preset-env\": {\n      \"version\": \"1.7.0\",\n      \"resolved\": \"https://registry.npmmirror.com/babel-preset-env/-/babel-preset-env-1.7.0.tgz\",\n      \"integrity\": \"sha512-9OR2afuKDneX2/q2EurSftUYM0xGu4O2D9adAhVfADDhrYDaxXV0rBbevVYoY9n6nyX1PmQW/0jtpJvUNr9CHg==\",\n      \"dev\": true,\n      \"requires\": {\n        \"babel-plugin-check-es2015-constants\": \"^6.22.0\",\n        \"babel-plugin-syntax-trailing-function-commas\": \"^6.22.0\",\n        \"babel-plugin-transform-async-to-generator\": \"^6.22.0\",\n        \"babel-plugin-transform-es2015-arrow-functions\": \"^6.22.0\",\n        \"babel-plugin-transform-es2015-block-scoped-functions\": \"^6.22.0\",\n        \"babel-plugin-transform-es2015-block-scoping\": \"^6.23.0\",\n        \"babel-plugin-transform-es2015-classes\": \"^6.23.0\",\n        \"babel-plugin-transform-es2015-computed-properties\": \"^6.22.0\",\n        \"babel-plugin-transform-es2015-destructuring\": \"^6.23.0\",\n        \"babel-plugin-transform-es2015-duplicate-keys\": \"^6.22.0\",\n        \"babel-plugin-transform-es2015-for-of\": \"^6.23.0\",\n        \"babel-plugin-transform-es2015-function-name\": \"^6.22.0\",\n        \"babel-plugin-transform-es2015-literals\": \"^6.22.0\",\n        \"babel-plugin-transform-es2015-modules-amd\": \"^6.22.0\",\n        \"babel-plugin-transform-es2015-modules-commonjs\": \"^6.23.0\",\n        \"babel-plugin-transform-es2015-modules-systemjs\": \"^6.23.0\",\n        \"babel-plugin-transform-es2015-modules-umd\": \"^6.23.0\",\n        \"babel-plugin-transform-es2015-object-super\": \"^6.22.0\",\n        \"babel-plugin-transform-es2015-parameters\": \"^6.23.0\",\n        \"babel-plugin-transform-es2015-shorthand-properties\": \"^6.22.0\",\n        \"babel-plugin-transform-es2015-spread\": \"^6.22.0\",\n        \"babel-plugin-transform-es2015-sticky-regex\": \"^6.22.0\",\n        \"babel-plugin-transform-es2015-template-literals\": \"^6.22.0\",\n        \"babel-plugin-transform-es2015-typeof-symbol\": \"^6.23.0\",\n        \"babel-plugin-transform-es2015-unicode-regex\": \"^6.22.0\",\n        \"babel-plugin-transform-exponentiation-operator\": \"^6.22.0\",\n        \"babel-plugin-transform-regenerator\": \"^6.22.0\",\n        \"browserslist\": \"^3.2.6\",\n        \"invariant\": \"^2.2.2\",\n        \"semver\": \"^5.3.0\"\n      }\n    },\n    \"babel-register\": {\n      \"version\": \"6.26.0\",\n      \"resolved\": \"https://registry.npmmirror.com/babel-register/-/babel-register-6.26.0.tgz\",\n      \"integrity\": \"sha512-veliHlHX06wjaeY8xNITbveXSiI+ASFnOqvne/LaIJIqOWi2Ogmj91KOugEz/hoh/fwMhXNBJPCv8Xaz5CyM4A==\",\n      \"dev\": true,\n      \"requires\": {\n        \"babel-core\": \"^6.26.0\",\n        \"babel-runtime\": \"^6.26.0\",\n        \"core-js\": \"^2.5.0\",\n        \"home-or-tmp\": \"^2.0.0\",\n        \"lodash\": \"^4.17.4\",\n        \"mkdirp\": \"^0.5.1\",\n        \"source-map-support\": \"^0.4.15\"\n      }\n    },\n    \"babel-runtime\": {\n      \"version\": \"6.26.0\",\n      \"resolved\": \"https://registry.npmmirror.com/babel-runtime/-/babel-runtime-6.26.0.tgz\",\n      \"integrity\": \"sha512-ITKNuq2wKlW1fJg9sSW52eepoYgZBggvOAHC0u/CYu/qxQ9EVzThCgR69BnSXLHjy2f7SY5zaQ4yt7H9ZVxY2g==\",\n      \"dev\": true,\n      \"requires\": {\n        \"core-js\": \"^2.4.0\",\n        \"regenerator-runtime\": \"^0.11.0\"\n      }\n    },\n    \"babel-template\": {\n      \"version\": \"6.26.0\",\n      \"resolved\": \"https://registry.npmmirror.com/babel-template/-/babel-template-6.26.0.tgz\",\n      \"integrity\": \"sha512-PCOcLFW7/eazGUKIoqH97sO9A2UYMahsn/yRQ7uOk37iutwjq7ODtcTNF+iFDSHNfkctqsLRjLP7URnOx0T1fg==\",\n      \"dev\": true,\n      \"requires\": {\n        \"babel-runtime\": \"^6.26.0\",\n        \"babel-traverse\": \"^6.26.0\",\n        \"babel-types\": \"^6.26.0\",\n        \"babylon\": \"^6.18.0\",\n        \"lodash\": \"^4.17.4\"\n      }\n    },\n    \"babel-traverse\": {\n      \"version\": \"6.26.0\",\n      \"resolved\": \"https://registry.npmmirror.com/babel-traverse/-/babel-traverse-6.26.0.tgz\",\n      \"integrity\": \"sha512-iSxeXx7apsjCHe9c7n8VtRXGzI2Bk1rBSOJgCCjfyXb6v1aCqE1KSEpq/8SXuVN8Ka/Rh1WDTF0MDzkvTA4MIA==\",\n      \"dev\": true,\n      \"requires\": {\n        \"babel-code-frame\": \"^6.26.0\",\n        \"babel-messages\": \"^6.23.0\",\n        \"babel-runtime\": \"^6.26.0\",\n        \"babel-types\": \"^6.26.0\",\n        \"babylon\": \"^6.18.0\",\n        \"debug\": \"^2.6.8\",\n        \"globals\": \"^9.18.0\",\n        \"invariant\": \"^2.2.2\",\n        \"lodash\": \"^4.17.4\"\n      }\n    },\n    \"babel-types\": {\n      \"version\": \"6.26.0\",\n      \"resolved\": \"https://registry.npmmirror.com/babel-types/-/babel-types-6.26.0.tgz\",\n      \"integrity\": \"sha512-zhe3V/26rCWsEZK8kZN+HaQj5yQ1CilTObixFzKW1UWjqG7618Twz6YEsCnjfg5gBcJh02DrpCkS9h98ZqDY+g==\",\n      \"dev\": true,\n      \"requires\": {\n        \"babel-runtime\": \"^6.26.0\",\n        \"esutils\": \"^2.0.2\",\n        \"lodash\": \"^4.17.4\",\n        \"to-fast-properties\": \"^1.0.3\"\n      }\n    },\n    \"babylon\": {\n      \"version\": \"6.18.0\",\n      \"resolved\": \"https://registry.npmmirror.com/babylon/-/babylon-6.18.0.tgz\",\n      \"integrity\": \"sha512-q/UEjfGJ2Cm3oKV71DJz9d25TPnq5rhBVL2Q4fA5wcC3jcrdn7+SssEybFIxwAvvP+YCsCYNKughoF33GxgycQ==\",\n      \"dev\": true\n    },\n    \"balanced-match\": {\n      \"version\": \"1.0.2\",\n      \"resolved\": \"https://registry.npmmirror.com/balanced-match/-/balanced-match-1.0.2.tgz\",\n      \"integrity\": \"sha512-3oSeUO0TMV67hN1AmbXsK4yaqU7tjiHlbxRDZOpH0KW9+CeX4bRAaX0Anxt0tx2MrpRpWwQaPwIlISEJhYU5Pw==\",\n      \"dev\": true\n    },\n    \"base\": {\n      \"version\": \"0.11.2\",\n      \"resolved\": \"https://registry.npmmirror.com/base/-/base-0.11.2.tgz\",\n      \"integrity\": \"sha512-5T6P4xPgpp0YDFvSWwEZ4NoE3aM4QBQXDzmVbraCkFj8zHM+mba8SyqB5DbZWyR7mYHo6Y7BdQo3MoA4m0TeQg==\",\n      \"dev\": true,\n      \"optional\": true,\n      \"requires\": {\n        \"cache-base\": \"^1.0.1\",\n        \"class-utils\": \"^0.3.5\",\n        \"component-emitter\": \"^1.2.1\",\n        \"define-property\": \"^1.0.0\",\n        \"isobject\": \"^3.0.1\",\n        \"mixin-deep\": \"^1.2.0\",\n        \"pascalcase\": \"^0.1.1\"\n      },\n      \"dependencies\": {\n        \"define-property\": {\n          \"version\": \"1.0.0\",\n          \"resolved\": \"https://registry.npmmirror.com/define-property/-/define-property-1.0.0.tgz\",\n          \"integrity\": \"sha512-cZTYKFWspt9jZsMscWo8sc/5lbPC9Q0N5nBLgb+Yd915iL3udB1uFgS3B8YCx66UVHq018DAVFoee7x+gxggeA==\",\n          \"dev\": true,\n          \"optional\": true,\n          \"requires\": {\n            \"is-descriptor\": \"^1.0.0\"\n          }\n        },\n        \"is-accessor-descriptor\": {\n          \"version\": \"1.0.0\",\n          \"resolved\": \"https://registry.npmmirror.com/is-accessor-descriptor/-/is-accessor-descriptor-1.0.0.tgz\",\n          \"integrity\": \"sha512-m5hnHTkcVsPfqx3AKlyttIPb7J+XykHvJP2B9bZDjlhLIoEq4XoK64Vg7boZlVWYK6LUY94dYPEE7Lh0ZkZKcQ==\",\n          \"dev\": true,\n          \"optional\": true,\n          \"requires\": {\n            \"kind-of\": \"^6.0.0\"\n          }\n        },\n        \"is-data-descriptor\": {\n          \"version\": \"1.0.0\",\n          \"resolved\": \"https://registry.npmmirror.com/is-data-descriptor/-/is-data-descriptor-1.0.0.tgz\",\n          \"integrity\": \"sha512-jbRXy1FmtAoCjQkVmIVYwuuqDFUbaOeDjmed1tOGPrsMhtJA4rD9tkgA0F1qJ3gRFRXcHYVkdeaP50Q5rE/jLQ==\",\n          \"dev\": true,\n          \"optional\": true,\n          \"requires\": {\n            \"kind-of\": \"^6.0.0\"\n          }\n        },\n        \"is-descriptor\": {\n          \"version\": \"1.0.2\",\n          \"resolved\": \"https://registry.npmmirror.com/is-descriptor/-/is-descriptor-1.0.2.tgz\",\n          \"integrity\": \"sha512-2eis5WqQGV7peooDyLmNEPUrps9+SXX5c9pL3xEB+4e9HnGuDa7mB7kHxHw4CbqS9k1T2hOH3miL8n8WtiYVtg==\",\n          \"dev\": true,\n          \"optional\": true,\n          \"requires\": {\n            \"is-accessor-descriptor\": \"^1.0.0\",\n            \"is-data-descriptor\": \"^1.0.0\",\n            \"kind-of\": \"^6.0.2\"\n          }\n        },\n        \"isobject\": {\n          \"version\": \"3.0.1\",\n          \"resolved\": \"https://registry.npmmirror.com/isobject/-/isobject-3.0.1.tgz\",\n          \"integrity\": \"sha512-WhB9zCku7EGTj/HQQRz5aUQEUeoQZH2bWcltRErOpymJ4boYE6wL9Tbr23krRPSZ+C5zqNSrSw+Cc7sZZ4b7vg==\",\n          \"dev\": true,\n          \"optional\": true\n        },\n        \"kind-of\": {\n          \"version\": \"6.0.3\",\n          \"resolved\": \"https://registry.npmmirror.com/kind-of/-/kind-of-6.0.3.tgz\",\n          \"integrity\": \"sha512-dcS1ul+9tmeD95T+x28/ehLgd9mENa3LsvDTtzm3vyBEO7RPptvAD+t44WVXaUjTBRcrpFeFlC8WCruUR456hw==\",\n          \"dev\": true,\n          \"optional\": true\n        }\n      }\n    },\n    \"binary-extensions\": {\n      \"version\": \"1.13.1\",\n      \"resolved\": \"https://registry.npmmirror.com/binary-extensions/-/binary-extensions-1.13.1.tgz\",\n      \"integrity\": \"sha512-Un7MIEDdUC5gNpcGDV97op1Ywk748MpHcFTHoYs6qnj1Z3j7I53VG3nwZhKzoBZmbdRNnb6WRdFlwl7tSDuZGw==\",\n      \"dev\": true,\n      \"optional\": true\n    },\n    \"bindings\": {\n      \"version\": \"1.5.0\",\n      \"resolved\": \"https://registry.npmmirror.com/bindings/-/bindings-1.5.0.tgz\",\n      \"integrity\": \"sha512-p2q/t/mhvuOj/UeLlV6566GD/guowlr0hHxClI0W9m7MWYkL1F0hLo+0Aexs9HSPCtR1SXQ0TD3MMKrXZajbiQ==\",\n      \"dev\": true,\n      \"optional\": true,\n      \"requires\": {\n        \"file-uri-to-path\": \"1.0.0\"\n      }\n    },\n    \"brace-expansion\": {\n      \"version\": \"1.1.11\",\n      \"resolved\": \"https://registry.npmmirror.com/brace-expansion/-/brace-expansion-1.1.11.tgz\",\n      \"integrity\": \"sha512-iCuPHDFgrHX7H2vEI/5xpz07zSHB00TpugqhmYtVmMO6518mCuRMoOYFldEBl0g187ufozdaHgWKcYFb61qGiA==\",\n      \"dev\": true,\n      \"requires\": {\n        \"balanced-match\": \"^1.0.0\",\n        \"concat-map\": \"0.0.1\"\n      }\n    },\n    \"braces\": {\n      \"version\": \"1.8.5\",\n      \"resolved\": \"https://registry.npmmirror.com/braces/-/braces-1.8.5.tgz\",\n      \"integrity\": \"sha512-xU7bpz2ytJl1bH9cgIurjpg/n8Gohy9GTw81heDYLJQ4RU60dlyJsa+atVF2pI0yMMvKxI9HkKwjePCj5XI1hw==\",\n      \"dev\": true,\n      \"optional\": true,\n      \"requires\": {\n        \"expand-range\": \"^1.8.1\",\n        \"preserve\": \"^0.2.0\",\n        \"repeat-element\": \"^1.1.2\"\n      }\n    },\n    \"browserslist\": {\n      \"version\": \"3.2.8\",\n      \"resolved\": \"https://registry.npmmirror.com/browserslist/-/browserslist-3.2.8.tgz\",\n      \"integrity\": \"sha512-WHVocJYavUwVgVViC0ORikPHQquXwVh939TaelZ4WDqpWgTX/FsGhl/+P4qBUAGcRvtOgDgC+xftNWWp2RUTAQ==\",\n      \"dev\": true,\n      \"requires\": {\n        \"caniuse-lite\": \"^1.0.30000844\",\n        \"electron-to-chromium\": \"^1.3.47\"\n      }\n    },\n    \"cache-base\": {\n      \"version\": \"1.0.1\",\n      \"resolved\": \"https://registry.npmmirror.com/cache-base/-/cache-base-1.0.1.tgz\",\n      \"integrity\": \"sha512-AKcdTnFSWATd5/GCPRxr2ChwIJ85CeyrEyjRHlKxQ56d4XJMGym0uAiKn0xbLOGOl3+yRpOTi484dVCEc5AUzQ==\",\n      \"dev\": true,\n      \"optional\": true,\n      \"requires\": {\n        \"collection-visit\": \"^1.0.0\",\n        \"component-emitter\": \"^1.2.1\",\n        \"get-value\": \"^2.0.6\",\n        \"has-value\": \"^1.0.0\",\n        \"isobject\": \"^3.0.1\",\n        \"set-value\": \"^2.0.0\",\n        \"to-object-path\": \"^0.3.0\",\n        \"union-value\": \"^1.0.0\",\n        \"unset-value\": \"^1.0.0\"\n      },\n      \"dependencies\": {\n        \"isobject\": {\n          \"version\": \"3.0.1\",\n          \"resolved\": \"https://registry.npmmirror.com/isobject/-/isobject-3.0.1.tgz\",\n          \"integrity\": \"sha512-WhB9zCku7EGTj/HQQRz5aUQEUeoQZH2bWcltRErOpymJ4boYE6wL9Tbr23krRPSZ+C5zqNSrSw+Cc7sZZ4b7vg==\",\n          \"dev\": true,\n          \"optional\": true\n        }\n      }\n    },\n    \"caniuse-lite\": {\n      \"version\": \"1.0.30001486\",\n      \"resolved\": \"https://registry.npmmirror.com/caniuse-lite/-/caniuse-lite-1.0.30001486.tgz\",\n      \"integrity\": \"sha512-uv7/gXuHi10Whlj0pp5q/tsK/32J2QSqVRKQhs2j8VsDCjgyruAh/eEXHF822VqO9yT6iZKw3nRwZRSPBE9OQg==\",\n      \"dev\": true\n    },\n    \"chalk\": {\n      \"version\": \"1.1.3\",\n      \"resolved\": \"https://registry.npmmirror.com/chalk/-/chalk-1.1.3.tgz\",\n      \"integrity\": \"sha512-U3lRVLMSlsCfjqYPbLyVv11M9CPW4I728d6TCKMAOJueEeB9/8o+eSsMnxPJD+Q+K909sdESg7C+tIkoH6on1A==\",\n      \"dev\": true,\n      \"requires\": {\n        \"ansi-styles\": \"^2.2.1\",\n        \"escape-string-regexp\": \"^1.0.2\",\n        \"has-ansi\": \"^2.0.0\",\n        \"strip-ansi\": \"^3.0.0\",\n        \"supports-color\": \"^2.0.0\"\n      }\n    },\n    \"chokidar\": {\n      \"version\": \"1.7.0\",\n      \"resolved\": \"https://registry.npmmirror.com/chokidar/-/chokidar-1.7.0.tgz\",\n      \"integrity\": \"sha512-mk8fAWcRUOxY7btlLtitj3A45jOwSAxH4tOFOoEGbVsl6cL6pPMWUy7dwZ/canfj3QEdP6FHSnf/l1c6/WkzVg==\",\n      \"dev\": true,\n      \"optional\": true,\n      \"requires\": {\n        \"anymatch\": \"^1.3.0\",\n        \"async-each\": \"^1.0.0\",\n        \"fsevents\": \"^1.0.0\",\n        \"glob-parent\": \"^2.0.0\",\n        \"inherits\": \"^2.0.1\",\n        \"is-binary-path\": \"^1.0.0\",\n        \"is-glob\": \"^2.0.0\",\n        \"path-is-absolute\": \"^1.0.0\",\n        \"readdirp\": \"^2.0.0\"\n      }\n    },\n    \"class-utils\": {\n      \"version\": \"0.3.6\",\n      \"resolved\": \"https://registry.npmmirror.com/class-utils/-/class-utils-0.3.6.tgz\",\n      \"integrity\": \"sha512-qOhPa/Fj7s6TY8H8esGu5QNpMMQxz79h+urzrNYN6mn+9BnxlDGf5QZ+XeCDsxSjPqsSR56XOZOJmpeurnLMeg==\",\n      \"dev\": true,\n      \"optional\": true,\n      \"requires\": {\n        \"arr-union\": \"^3.1.0\",\n        \"define-property\": \"^0.2.5\",\n        \"isobject\": \"^3.0.0\",\n        \"static-extend\": \"^0.1.1\"\n      },\n      \"dependencies\": {\n        \"define-property\": {\n          \"version\": \"0.2.5\",\n          \"resolved\": \"https://registry.npmmirror.com/define-property/-/define-property-0.2.5.tgz\",\n          \"integrity\": \"sha512-Rr7ADjQZenceVOAKop6ALkkRAmH1A4Gx9hV/7ZujPUN2rkATqFO0JZLZInbAjpZYoJ1gUx8MRMQVkYemcbMSTA==\",\n          \"dev\": true,\n          \"optional\": true,\n          \"requires\": {\n            \"is-descriptor\": \"^0.1.0\"\n          }\n        },\n        \"isobject\": {\n          \"version\": \"3.0.1\",\n          \"resolved\": \"https://registry.npmmirror.com/isobject/-/isobject-3.0.1.tgz\",\n          \"integrity\": \"sha512-WhB9zCku7EGTj/HQQRz5aUQEUeoQZH2bWcltRErOpymJ4boYE6wL9Tbr23krRPSZ+C5zqNSrSw+Cc7sZZ4b7vg==\",\n          \"dev\": true,\n          \"optional\": true\n        }\n      }\n    },\n    \"collection-visit\": {\n      \"version\": \"1.0.0\",\n      \"resolved\": \"https://registry.npmmirror.com/collection-visit/-/collection-visit-1.0.0.tgz\",\n      \"integrity\": \"sha512-lNkKvzEeMBBjUGHZ+q6z9pSJla0KWAQPvtzhEV9+iGyQYG+pBpl7xKDhxoNSOZH2hhv0v5k0y2yAM4o4SjoSkw==\",\n      \"dev\": true,\n      \"optional\": true,\n      \"requires\": {\n        \"map-visit\": \"^1.0.0\",\n        \"object-visit\": \"^1.0.0\"\n      }\n    },\n    \"commander\": {\n      \"version\": \"2.20.3\",\n      \"resolved\": \"https://registry.npmmirror.com/commander/-/commander-2.20.3.tgz\",\n      \"integrity\": \"sha512-GpVkmM8vF2vQUkj2LvZmD35JxeJOLCwJ9cUkugyk2nuhbv3+mJvpLYYt+0+USMxE+oj+ey/lJEnhZw75x/OMcQ==\",\n      \"dev\": true\n    },\n    \"component-emitter\": {\n      \"version\": \"1.3.0\",\n      \"resolved\": \"https://registry.npmmirror.com/component-emitter/-/component-emitter-1.3.0.tgz\",\n      \"integrity\": \"sha512-Rd3se6QB+sO1TwqZjscQrurpEPIfO0/yYnSin6Q/rD3mOutHvUrCAhJub3r90uNb+SESBuE0QYoB90YdfatsRg==\",\n      \"dev\": true,\n      \"optional\": true\n    },\n    \"concat-map\": {\n      \"version\": \"0.0.1\",\n      \"resolved\": \"https://registry.npmmirror.com/concat-map/-/concat-map-0.0.1.tgz\",\n      \"integrity\": \"sha512-/Srv4dswyQNBfohGpz9o6Yb3Gz3SrUDqBH5rTuhGR7ahtlbYKnVxw2bCFMRljaA7EXHaXZ8wsHdodFvbkhKmqg==\",\n      \"dev\": true\n    },\n    \"convert-source-map\": {\n      \"version\": \"1.9.0\",\n      \"resolved\": \"https://registry.npmmirror.com/convert-source-map/-/convert-source-map-1.9.0.tgz\",\n      \"integrity\": \"sha512-ASFBup0Mz1uyiIjANan1jzLQami9z1PoYSZCiiYW2FczPbenXc45FZdBZLzOT+r6+iciuEModtmCti+hjaAk0A==\",\n      \"dev\": true\n    },\n    \"copy-descriptor\": {\n      \"version\": \"0.1.1\",\n      \"resolved\": \"https://registry.npmmirror.com/copy-descriptor/-/copy-descriptor-0.1.1.tgz\",\n      \"integrity\": \"sha512-XgZ0pFcakEUlbwQEVNg3+QAis1FyTL3Qel9FYy8pSkQqoG3PNoT0bOCQtOXcOkur21r2Eq2kI+IE+gsmAEVlYw==\",\n      \"dev\": true,\n      \"optional\": true\n    },\n    \"core-js\": {\n      \"version\": \"2.6.12\",\n      \"resolved\": \"https://registry.npmmirror.com/core-js/-/core-js-2.6.12.tgz\",\n      \"integrity\": \"sha512-Kb2wC0fvsWfQrgk8HU5lW6U/Lcs8+9aaYcy4ZFc6DDlo4nZ7n70dEgE5rtR0oG6ufKDUnrwfWL1mXR5ljDatrQ==\",\n      \"dev\": true\n    },\n    \"core-util-is\": {\n      \"version\": \"1.0.3\",\n      \"resolved\": \"https://registry.npmmirror.com/core-util-is/-/core-util-is-1.0.3.tgz\",\n      \"integrity\": \"sha512-ZQBvi1DcpJ4GDqanjucZ2Hj3wEO5pZDS89BWbkcrvdxksJorwUDDZamX9ldFkp9aw2lmBDLgkObEA4DWNJ9FYQ==\",\n      \"dev\": true,\n      \"optional\": true\n    },\n    \"debug\": {\n      \"version\": \"2.6.9\",\n      \"resolved\": \"https://registry.npmmirror.com/debug/-/debug-2.6.9.tgz\",\n      \"integrity\": \"sha512-bC7ElrdJaJnPbAP+1EotYvqZsb3ecl5wi6Bfi6BJTUcNowp6cvspg0jXznRTKDjm/E7AdgFBVeAPVMNcKGsHMA==\",\n      \"dev\": true,\n      \"requires\": {\n        \"ms\": \"2.0.0\"\n      }\n    },\n    \"decode-uri-component\": {\n      \"version\": \"0.2.2\",\n      \"resolved\": \"https://registry.npmmirror.com/decode-uri-component/-/decode-uri-component-0.2.2.tgz\",\n      \"integrity\": \"sha512-FqUYQ+8o158GyGTrMFJms9qh3CqTKvAqgqsTnkLI8sKu0028orqBhxNMFkFen0zGyg6epACD32pjVk58ngIErQ==\",\n      \"dev\": true,\n      \"optional\": true\n    },\n    \"define-property\": {\n      \"version\": \"2.0.2\",\n      \"resolved\": \"https://registry.npmmirror.com/define-property/-/define-property-2.0.2.tgz\",\n      \"integrity\": \"sha512-jwK2UV4cnPpbcG7+VRARKTZPUWowwXA8bzH5NP6ud0oeAxyYPuGZUAC7hMugpCdz4BeSZl2Dl9k66CHJ/46ZYQ==\",\n      \"dev\": true,\n      \"optional\": true,\n      \"requires\": {\n        \"is-descriptor\": \"^1.0.2\",\n        \"isobject\": \"^3.0.1\"\n      },\n      \"dependencies\": {\n        \"is-accessor-descriptor\": {\n          \"version\": \"1.0.0\",\n          \"resolved\": \"https://registry.npmmirror.com/is-accessor-descriptor/-/is-accessor-descriptor-1.0.0.tgz\",\n          \"integrity\": \"sha512-m5hnHTkcVsPfqx3AKlyttIPb7J+XykHvJP2B9bZDjlhLIoEq4XoK64Vg7boZlVWYK6LUY94dYPEE7Lh0ZkZKcQ==\",\n          \"dev\": true,\n          \"optional\": true,\n          \"requires\": {\n            \"kind-of\": \"^6.0.0\"\n          }\n        },\n        \"is-data-descriptor\": {\n          \"version\": \"1.0.0\",\n          \"resolved\": \"https://registry.npmmirror.com/is-data-descriptor/-/is-data-descriptor-1.0.0.tgz\",\n          \"integrity\": \"sha512-jbRXy1FmtAoCjQkVmIVYwuuqDFUbaOeDjmed1tOGPrsMhtJA4rD9tkgA0F1qJ3gRFRXcHYVkdeaP50Q5rE/jLQ==\",\n          \"dev\": true,\n          \"optional\": true,\n          \"requires\": {\n            \"kind-of\": \"^6.0.0\"\n          }\n        },\n        \"is-descriptor\": {\n          \"version\": \"1.0.2\",\n          \"resolved\": \"https://registry.npmmirror.com/is-descriptor/-/is-descriptor-1.0.2.tgz\",\n          \"integrity\": \"sha512-2eis5WqQGV7peooDyLmNEPUrps9+SXX5c9pL3xEB+4e9HnGuDa7mB7kHxHw4CbqS9k1T2hOH3miL8n8WtiYVtg==\",\n          \"dev\": true,\n          \"optional\": true,\n          \"requires\": {\n            \"is-accessor-descriptor\": \"^1.0.0\",\n            \"is-data-descriptor\": \"^1.0.0\",\n            \"kind-of\": \"^6.0.2\"\n          }\n        },\n        \"isobject\": {\n          \"version\": \"3.0.1\",\n          \"resolved\": \"https://registry.npmmirror.com/isobject/-/isobject-3.0.1.tgz\",\n          \"integrity\": \"sha512-WhB9zCku7EGTj/HQQRz5aUQEUeoQZH2bWcltRErOpymJ4boYE6wL9Tbr23krRPSZ+C5zqNSrSw+Cc7sZZ4b7vg==\",\n          \"dev\": true,\n          \"optional\": true\n        },\n        \"kind-of\": {\n          \"version\": \"6.0.3\",\n          \"resolved\": \"https://registry.npmmirror.com/kind-of/-/kind-of-6.0.3.tgz\",\n          \"integrity\": \"sha512-dcS1ul+9tmeD95T+x28/ehLgd9mENa3LsvDTtzm3vyBEO7RPptvAD+t44WVXaUjTBRcrpFeFlC8WCruUR456hw==\",\n          \"dev\": true,\n          \"optional\": true\n        }\n      }\n    },\n    \"detect-indent\": {\n      \"version\": \"4.0.0\",\n      \"resolved\": \"https://registry.npmmirror.com/detect-indent/-/detect-indent-4.0.0.tgz\",\n      \"integrity\": \"sha512-BDKtmHlOzwI7iRuEkhzsnPoi5ypEhWAJB5RvHWe1kMr06js3uK5B3734i3ui5Yd+wOJV1cpE4JnivPD283GU/A==\",\n      \"dev\": true,\n      \"requires\": {\n        \"repeating\": \"^2.0.0\"\n      }\n    },\n    \"electron-to-chromium\": {\n      \"version\": \"1.4.392\",\n      \"resolved\": \"https://registry.npmmirror.com/electron-to-chromium/-/electron-to-chromium-1.4.392.tgz\",\n      \"integrity\": \"sha512-TXQOMW9tnhIms3jGy/lJctLjICOgyueZFJ1KUtm6DTQ+QpxX3p7ZBwB6syuZ9KBuT5S4XX7bgY1ECPgfxKUdOg==\",\n      \"dev\": true\n    },\n    \"escape-string-regexp\": {\n      \"version\": \"1.0.5\",\n      \"resolved\": \"https://registry.npmmirror.com/escape-string-regexp/-/escape-string-regexp-1.0.5.tgz\",\n      \"integrity\": \"sha512-vbRorB5FUQWvla16U8R/qgaFIya2qGzwDrNmCZuYKrbdSUMG6I1ZCGQRefkRVhuOkIGVne7BQ35DSfo1qvJqFg==\",\n      \"dev\": true\n    },\n    \"esutils\": {\n      \"version\": \"2.0.3\",\n      \"resolved\": \"https://registry.npmmirror.com/esutils/-/esutils-2.0.3.tgz\",\n      \"integrity\": \"sha512-kVscqXk4OCp68SZ0dkgEKVi6/8ij300KBWTJq32P/dYeWTSwK41WyTxalN1eRmA5Z9UU/LX9D7FWSmV9SAYx6g==\",\n      \"dev\": true\n    },\n    \"expand-brackets\": {\n      \"version\": \"0.1.5\",\n      \"resolved\": \"https://registry.npmmirror.com/expand-brackets/-/expand-brackets-0.1.5.tgz\",\n      \"integrity\": \"sha512-hxx03P2dJxss6ceIeri9cmYOT4SRs3Zk3afZwWpOsRqLqprhTR8u++SlC+sFGsQr7WGFPdMF7Gjc1njDLDK6UA==\",\n      \"dev\": true,\n      \"optional\": true,\n      \"requires\": {\n        \"is-posix-bracket\": \"^0.1.0\"\n      }\n    },\n    \"expand-range\": {\n      \"version\": \"1.8.2\",\n      \"resolved\": \"https://registry.npmmirror.com/expand-range/-/expand-range-1.8.2.tgz\",\n      \"integrity\": \"sha512-AFASGfIlnIbkKPQwX1yHaDjFvh/1gyKJODme52V6IORh69uEYgZp0o9C+qsIGNVEiuuhQU0CSSl++Rlegg1qvA==\",\n      \"dev\": true,\n      \"optional\": true,\n      \"requires\": {\n        \"fill-range\": \"^2.1.0\"\n      }\n    },\n    \"extend-shallow\": {\n      \"version\": \"3.0.2\",\n      \"resolved\": \"https://registry.npmmirror.com/extend-shallow/-/extend-shallow-3.0.2.tgz\",\n      \"integrity\": \"sha512-BwY5b5Ql4+qZoefgMj2NUmx+tehVTH/Kf4k1ZEtOHNFcm2wSxMRo992l6X3TIgni2eZVTZ85xMOjF31fwZAj6Q==\",\n      \"dev\": true,\n      \"optional\": true,\n      \"requires\": {\n        \"assign-symbols\": \"^1.0.0\",\n        \"is-extendable\": \"^1.0.1\"\n      },\n      \"dependencies\": {\n        \"is-extendable\": {\n          \"version\": \"1.0.1\",\n          \"resolved\": \"https://registry.npmmirror.com/is-extendable/-/is-extendable-1.0.1.tgz\",\n          \"integrity\": \"sha512-arnXMxT1hhoKo9k1LZdmlNyJdDDfy2v0fXjFlmok4+i8ul/6WlbVge9bhM74OpNPQPMGUToDtz+KXa1PneJxOA==\",\n          \"dev\": true,\n          \"optional\": true,\n          \"requires\": {\n            \"is-plain-object\": \"^2.0.4\"\n          }\n        }\n      }\n    },\n    \"extglob\": {\n      \"version\": \"0.3.2\",\n      \"resolved\": \"https://registry.npmmirror.com/extglob/-/extglob-0.3.2.tgz\",\n      \"integrity\": \"sha512-1FOj1LOwn42TMrruOHGt18HemVnbwAmAak7krWk+wa93KXxGbK+2jpezm+ytJYDaBX0/SPLZFHKM7m+tKobWGg==\",\n      \"dev\": true,\n      \"optional\": true,\n      \"requires\": {\n        \"is-extglob\": \"^1.0.0\"\n      }\n    },\n    \"file-uri-to-path\": {\n      \"version\": \"1.0.0\",\n      \"resolved\": \"https://registry.npmmirror.com/file-uri-to-path/-/file-uri-to-path-1.0.0.tgz\",\n      \"integrity\": \"sha512-0Zt+s3L7Vf1biwWZ29aARiVYLx7iMGnEUl9x33fbB/j3jR81u/O2LbqK+Bm1CDSNDKVtJ/YjwY7TUd5SkeLQLw==\",\n      \"dev\": true,\n      \"optional\": true\n    },\n    \"filename-regex\": {\n      \"version\": \"2.0.1\",\n      \"resolved\": \"https://registry.npmmirror.com/filename-regex/-/filename-regex-2.0.1.tgz\",\n      \"integrity\": \"sha512-BTCqyBaWBTsauvnHiE8i562+EdJj+oUpkqWp2R1iCoR8f6oo8STRu3of7WJJ0TqWtxN50a5YFpzYK4Jj9esYfQ==\",\n      \"dev\": true,\n      \"optional\": true\n    },\n    \"fill-range\": {\n      \"version\": \"2.2.4\",\n      \"resolved\": \"https://registry.npmmirror.com/fill-range/-/fill-range-2.2.4.tgz\",\n      \"integrity\": \"sha512-cnrcCbj01+j2gTG921VZPnHbjmdAf8oQV/iGeV2kZxGSyfYjjTyY79ErsK1WJWMpw6DaApEX72binqJE+/d+5Q==\",\n      \"dev\": true,\n      \"optional\": true,\n      \"requires\": {\n        \"is-number\": \"^2.1.0\",\n        \"isobject\": \"^2.0.0\",\n        \"randomatic\": \"^3.0.0\",\n        \"repeat-element\": \"^1.1.2\",\n        \"repeat-string\": \"^1.5.2\"\n      }\n    },\n    \"for-in\": {\n      \"version\": \"1.0.2\",\n      \"resolved\": \"https://registry.npmmirror.com/for-in/-/for-in-1.0.2.tgz\",\n      \"integrity\": \"sha512-7EwmXrOjyL+ChxMhmG5lnW9MPt1aIeZEwKhQzoBUdTV0N3zuwWDZYVJatDvZ2OyzPUvdIAZDsCetk3coyMfcnQ==\",\n      \"dev\": true,\n      \"optional\": true\n    },\n    \"for-own\": {\n      \"version\": \"0.1.5\",\n      \"resolved\": \"https://registry.npmmirror.com/for-own/-/for-own-0.1.5.tgz\",\n      \"integrity\": \"sha512-SKmowqGTJoPzLO1T0BBJpkfp3EMacCMOuH40hOUbrbzElVktk4DioXVM99QkLCyKoiuOmyjgcWMpVz2xjE7LZw==\",\n      \"dev\": true,\n      \"optional\": true,\n      \"requires\": {\n        \"for-in\": \"^1.0.1\"\n      }\n    },\n    \"fragment-cache\": {\n      \"version\": \"0.2.1\",\n      \"resolved\": \"https://registry.npmmirror.com/fragment-cache/-/fragment-cache-0.2.1.tgz\",\n      \"integrity\": \"sha512-GMBAbW9antB8iZRHLoGw0b3HANt57diZYFO/HL1JGIC1MjKrdmhxvrJbupnVvpys0zsz7yBApXdQyfepKly2kA==\",\n      \"dev\": true,\n      \"optional\": true,\n      \"requires\": {\n        \"map-cache\": \"^0.2.2\"\n      }\n    },\n    \"fs-readdir-recursive\": {\n      \"version\": \"1.1.0\",\n      \"resolved\": \"https://registry.npmmirror.com/fs-readdir-recursive/-/fs-readdir-recursive-1.1.0.tgz\",\n      \"integrity\": \"sha512-GNanXlVr2pf02+sPN40XN8HG+ePaNcvM0q5mZBd668Obwb0yD5GiUbZOFgwn8kGMY6I3mdyDJzieUy3PTYyTRA==\",\n      \"dev\": true\n    },\n    \"fs.realpath\": {\n      \"version\": \"1.0.0\",\n      \"resolved\": \"https://registry.npmmirror.com/fs.realpath/-/fs.realpath-1.0.0.tgz\",\n      \"integrity\": \"sha512-OO0pH2lK6a0hZnAdau5ItzHPI6pUlvI7jMVnxUQRtw4owF2wk8lOSabtGDCTP4Ggrg2MbGnWO9X8K1t4+fGMDw==\",\n      \"dev\": true\n    },\n    \"fsevents\": {\n      \"version\": \"1.2.13\",\n      \"resolved\": \"https://registry.npmmirror.com/fsevents/-/fsevents-1.2.13.tgz\",\n      \"integrity\": \"sha512-oWb1Z6mkHIskLzEJ/XWX0srkpkTQ7vaopMQkyaEIoq0fmtFVxOthb8cCxeT+p3ynTdkk/RZwbgG4brR5BeWECw==\",\n      \"dev\": true,\n      \"optional\": true,\n      \"requires\": {\n        \"bindings\": \"^1.5.0\",\n        \"nan\": \"^2.12.1\"\n      }\n    },\n    \"get-value\": {\n      \"version\": \"2.0.6\",\n      \"resolved\": \"https://registry.npmmirror.com/get-value/-/get-value-2.0.6.tgz\",\n      \"integrity\": \"sha512-Ln0UQDlxH1BapMu3GPtf7CuYNwRZf2gwCuPqbyG6pB8WfmFpzqcy4xtAaAMUhnNqjMKTiCPZG2oMT3YSx8U2NA==\",\n      \"dev\": true,\n      \"optional\": true\n    },\n    \"glob\": {\n      \"version\": \"7.2.3\",\n      \"resolved\": \"https://registry.npmmirror.com/glob/-/glob-7.2.3.tgz\",\n      \"integrity\": \"sha512-nFR0zLpU2YCaRxwoCJvL6UvCH2JFyFVIvwTLsIf21AuHlMskA1hhTdk+LlYJtOlYt9v6dvszD2BGRqBL+iQK9Q==\",\n      \"dev\": true,\n      \"requires\": {\n        \"fs.realpath\": \"^1.0.0\",\n        \"inflight\": \"^1.0.4\",\n        \"inherits\": \"2\",\n        \"minimatch\": \"^3.1.1\",\n        \"once\": \"^1.3.0\",\n        \"path-is-absolute\": \"^1.0.0\"\n      }\n    },\n    \"glob-base\": {\n      \"version\": \"0.3.0\",\n      \"resolved\": \"https://registry.npmmirror.com/glob-base/-/glob-base-0.3.0.tgz\",\n      \"integrity\": \"sha512-ab1S1g1EbO7YzauaJLkgLp7DZVAqj9M/dvKlTt8DkXA2tiOIcSMrlVI2J1RZyB5iJVccEscjGn+kpOG9788MHA==\",\n      \"dev\": true,\n      \"optional\": true,\n      \"requires\": {\n        \"glob-parent\": \"^2.0.0\",\n        \"is-glob\": \"^2.0.0\"\n      }\n    },\n    \"glob-parent\": {\n      \"version\": \"2.0.0\",\n      \"resolved\": \"https://registry.npmmirror.com/glob-parent/-/glob-parent-2.0.0.tgz\",\n      \"integrity\": \"sha512-JDYOvfxio/t42HKdxkAYaCiBN7oYiuxykOxKxdaUW5Qn0zaYN3gRQWolrwdnf0shM9/EP0ebuuTmyoXNr1cC5w==\",\n      \"dev\": true,\n      \"optional\": true,\n      \"requires\": {\n        \"is-glob\": \"^2.0.0\"\n      }\n    },\n    \"globals\": {\n      \"version\": \"9.18.0\",\n      \"resolved\": \"https://registry.npmmirror.com/globals/-/globals-9.18.0.tgz\",\n      \"integrity\": \"sha512-S0nG3CLEQiY/ILxqtztTWH/3iRRdyBLw6KMDxnKMchrtbj2OFmehVh0WUCfW3DUrIgx/qFrJPICrq4Z4sTR9UQ==\",\n      \"dev\": true\n    },\n    \"graceful-fs\": {\n      \"version\": \"4.2.11\",\n      \"resolved\": \"https://registry.npmmirror.com/graceful-fs/-/graceful-fs-4.2.11.tgz\",\n      \"integrity\": \"sha512-RbJ5/jmFcNNCcDV5o9eTnBLJ/HszWV0P73bc+Ff4nS/rJj+YaS6IGyiOL0VoBYX+l1Wrl3k63h/KrH+nhJ0XvQ==\",\n      \"dev\": true\n    },\n    \"has-ansi\": {\n      \"version\": \"2.0.0\",\n      \"resolved\": \"https://registry.npmmirror.com/has-ansi/-/has-ansi-2.0.0.tgz\",\n      \"integrity\": \"sha512-C8vBJ8DwUCx19vhm7urhTuUsr4/IyP6l4VzNQDv+ryHQObW3TTTp9yB68WpYgRe2bbaGuZ/se74IqFeVnMnLZg==\",\n      \"dev\": true,\n      \"requires\": {\n        \"ansi-regex\": \"^2.0.0\"\n      }\n    },\n    \"has-value\": {\n      \"version\": \"1.0.0\",\n      \"resolved\": \"https://registry.npmmirror.com/has-value/-/has-value-1.0.0.tgz\",\n      \"integrity\": \"sha512-IBXk4GTsLYdQ7Rvt+GRBrFSVEkmuOUy4re0Xjd9kJSUQpnTrWR4/y9RpfexN9vkAPMFuQoeWKwqzPozRTlasGw==\",\n      \"dev\": true,\n      \"optional\": true,\n      \"requires\": {\n        \"get-value\": \"^2.0.6\",\n        \"has-values\": \"^1.0.0\",\n        \"isobject\": \"^3.0.0\"\n      },\n      \"dependencies\": {\n        \"isobject\": {\n          \"version\": \"3.0.1\",\n          \"resolved\": \"https://registry.npmmirror.com/isobject/-/isobject-3.0.1.tgz\",\n          \"integrity\": \"sha512-WhB9zCku7EGTj/HQQRz5aUQEUeoQZH2bWcltRErOpymJ4boYE6wL9Tbr23krRPSZ+C5zqNSrSw+Cc7sZZ4b7vg==\",\n          \"dev\": true,\n          \"optional\": true\n        }\n      }\n    },\n    \"has-values\": {\n      \"version\": \"1.0.0\",\n      \"resolved\": \"https://registry.npmmirror.com/has-values/-/has-values-1.0.0.tgz\",\n      \"integrity\": \"sha512-ODYZC64uqzmtfGMEAX/FvZiRyWLpAC3vYnNunURUnkGVTS+mI0smVsWaPydRBsE3g+ok7h960jChO8mFcWlHaQ==\",\n      \"dev\": true,\n      \"optional\": true,\n      \"requires\": {\n        \"is-number\": \"^3.0.0\",\n        \"kind-of\": \"^4.0.0\"\n      },\n      \"dependencies\": {\n        \"is-number\": {\n          \"version\": \"3.0.0\",\n          \"resolved\": \"https://registry.npmmirror.com/is-number/-/is-number-3.0.0.tgz\",\n          \"integrity\": \"sha512-4cboCqIpliH+mAvFNegjZQ4kgKc3ZUhQVr3HvWbSh5q3WH2v82ct+T2Y1hdU5Gdtorx/cLifQjqCbL7bpznLTg==\",\n          \"dev\": true,\n          \"optional\": true,\n          \"requires\": {\n            \"kind-of\": \"^3.0.2\"\n          },\n          \"dependencies\": {\n            \"kind-of\": {\n              \"version\": \"3.2.2\",\n              \"resolved\": \"https://registry.npmmirror.com/kind-of/-/kind-of-3.2.2.tgz\",\n              \"integrity\": \"sha512-NOW9QQXMoZGg/oqnVNoNTTIFEIid1627WCffUBJEdMxYApq7mNE7CpzucIPc+ZQg25Phej7IJSmX3hO+oblOtQ==\",\n              \"dev\": true,\n              \"optional\": true,\n              \"requires\": {\n                \"is-buffer\": \"^1.1.5\"\n              }\n            }\n          }\n        },\n        \"kind-of\": {\n          \"version\": \"4.0.0\",\n          \"resolved\": \"https://registry.npmmirror.com/kind-of/-/kind-of-4.0.0.tgz\",\n          \"integrity\": \"sha512-24XsCxmEbRwEDbz/qz3stgin8TTzZ1ESR56OMCN0ujYg+vRutNSiOj9bHH9u85DKgXguraugV5sFuvbD4FW/hw==\",\n          \"dev\": true,\n          \"optional\": true,\n          \"requires\": {\n            \"is-buffer\": \"^1.1.5\"\n          }\n        }\n      }\n    },\n    \"home-or-tmp\": {\n      \"version\": \"2.0.0\",\n      \"resolved\": \"https://registry.npmmirror.com/home-or-tmp/-/home-or-tmp-2.0.0.tgz\",\n      \"integrity\": \"sha512-ycURW7oUxE2sNiPVw1HVEFsW+ecOpJ5zaj7eC0RlwhibhRBod20muUN8qu/gzx956YrLolVvs1MTXwKgC2rVEg==\",\n      \"dev\": true,\n      \"requires\": {\n        \"os-homedir\": \"^1.0.0\",\n        \"os-tmpdir\": \"^1.0.1\"\n      }\n    },\n    \"inflight\": {\n      \"version\": \"1.0.6\",\n      \"resolved\": \"https://registry.npmmirror.com/inflight/-/inflight-1.0.6.tgz\",\n      \"integrity\": \"sha512-k92I/b08q4wvFscXCLvqfsHCrjrF7yiXsQuIVvVE7N82W3+aqpzuUdBbfhWcy/FZR3/4IgflMgKLOsvPDrGCJA==\",\n      \"dev\": true,\n      \"requires\": {\n        \"once\": \"^1.3.0\",\n        \"wrappy\": \"1\"\n      }\n    },\n    \"inherits\": {\n      \"version\": \"2.0.4\",\n      \"resolved\": \"https://registry.npmmirror.com/inherits/-/inherits-2.0.4.tgz\",\n      \"integrity\": \"sha512-k/vGaX4/Yla3WzyMCvTQOXYeIHvqOKtnqBduzTHpzpQZzAskKMhZ2K+EnBiSM9zGSoIFeMpXKxa4dYeZIQqewQ==\",\n      \"dev\": true\n    },\n    \"invariant\": {\n      \"version\": \"2.2.4\",\n      \"resolved\": \"https://registry.npmmirror.com/invariant/-/invariant-2.2.4.tgz\",\n      \"integrity\": \"sha512-phJfQVBuaJM5raOpJjSfkiD6BpbCE4Ns//LaXl6wGYtUBY83nWS6Rf9tXm2e8VaK60JEjYldbPif/A2B1C2gNA==\",\n      \"dev\": true,\n      \"requires\": {\n        \"loose-envify\": \"^1.0.0\"\n      }\n    },\n    \"is-accessor-descriptor\": {\n      \"version\": \"0.1.6\",\n      \"resolved\": \"https://registry.npmmirror.com/is-accessor-descriptor/-/is-accessor-descriptor-0.1.6.tgz\",\n      \"integrity\": \"sha512-e1BM1qnDbMRG3ll2U9dSK0UMHuWOs3pY3AtcFsmvwPtKL3MML/Q86i+GilLfvqEs4GW+ExB91tQ3Ig9noDIZ+A==\",\n      \"dev\": true,\n      \"optional\": true,\n      \"requires\": {\n        \"kind-of\": \"^3.0.2\"\n      }\n    },\n    \"is-binary-path\": {\n      \"version\": \"1.0.1\",\n      \"resolved\": \"https://registry.npmmirror.com/is-binary-path/-/is-binary-path-1.0.1.tgz\",\n      \"integrity\": \"sha512-9fRVlXc0uCxEDj1nQzaWONSpbTfx0FmJfzHF7pwlI8DkWGoHBBea4Pg5Ky0ojwwxQmnSifgbKkI06Qv0Ljgj+Q==\",\n      \"dev\": true,\n      \"optional\": true,\n      \"requires\": {\n        \"binary-extensions\": \"^1.0.0\"\n      }\n    },\n    \"is-buffer\": {\n      \"version\": \"1.1.6\",\n      \"resolved\": \"https://registry.npmmirror.com/is-buffer/-/is-buffer-1.1.6.tgz\",\n      \"integrity\": \"sha512-NcdALwpXkTm5Zvvbk7owOUSvVvBKDgKP5/ewfXEznmQFfs4ZRmanOeKBTjRVjka3QFoN6XJ+9F3USqfHqTaU5w==\",\n      \"dev\": true,\n      \"optional\": true\n    },\n    \"is-data-descriptor\": {\n      \"version\": \"0.1.4\",\n      \"resolved\": \"https://registry.npmmirror.com/is-data-descriptor/-/is-data-descriptor-0.1.4.tgz\",\n      \"integrity\": \"sha512-+w9D5ulSoBNlmw9OHn3U2v51SyoCd0he+bB3xMl62oijhrspxowjU+AIcDY0N3iEJbUEkB15IlMASQsxYigvXg==\",\n      \"dev\": true,\n      \"optional\": true,\n      \"requires\": {\n        \"kind-of\": \"^3.0.2\"\n      }\n    },\n    \"is-descriptor\": {\n      \"version\": \"0.1.6\",\n      \"resolved\": \"https://registry.npmmirror.com/is-descriptor/-/is-descriptor-0.1.6.tgz\",\n      \"integrity\": \"sha512-avDYr0SB3DwO9zsMov0gKCESFYqCnE4hq/4z3TdUlukEy5t9C0YRq7HLrsN52NAcqXKaepeCD0n+B0arnVG3Hg==\",\n      \"dev\": true,\n      \"optional\": true,\n      \"requires\": {\n        \"is-accessor-descriptor\": \"^0.1.6\",\n        \"is-data-descriptor\": \"^0.1.4\",\n        \"kind-of\": \"^5.0.0\"\n      },\n      \"dependencies\": {\n        \"kind-of\": {\n          \"version\": \"5.1.0\",\n          \"resolved\": \"https://registry.npmmirror.com/kind-of/-/kind-of-5.1.0.tgz\",\n          \"integrity\": \"sha512-NGEErnH6F2vUuXDh+OlbcKW7/wOcfdRHaZ7VWtqCztfHri/++YKmP51OdWeGPuqCOba6kk2OTe5d02VmTB80Pw==\",\n          \"dev\": true,\n          \"optional\": true\n        }\n      }\n    },\n    \"is-dotfile\": {\n      \"version\": \"1.0.3\",\n      \"resolved\": \"https://registry.npmmirror.com/is-dotfile/-/is-dotfile-1.0.3.tgz\",\n      \"integrity\": \"sha512-9YclgOGtN/f8zx0Pr4FQYMdibBiTaH3sn52vjYip4ZSf6C4/6RfTEZ+MR4GvKhCxdPh21Bg42/WL55f6KSnKpg==\",\n      \"dev\": true,\n      \"optional\": true\n    },\n    \"is-equal-shallow\": {\n      \"version\": \"0.1.3\",\n      \"resolved\": \"https://registry.npmmirror.com/is-equal-shallow/-/is-equal-shallow-0.1.3.tgz\",\n      \"integrity\": \"sha512-0EygVC5qPvIyb+gSz7zdD5/AAoS6Qrx1e//6N4yv4oNm30kqvdmG66oZFWVlQHUWe5OjP08FuTw2IdT0EOTcYA==\",\n      \"dev\": true,\n      \"optional\": true,\n      \"requires\": {\n        \"is-primitive\": \"^2.0.0\"\n      }\n    },\n    \"is-extendable\": {\n      \"version\": \"0.1.1\",\n      \"resolved\": \"https://registry.npmmirror.com/is-extendable/-/is-extendable-0.1.1.tgz\",\n      \"integrity\": \"sha512-5BMULNob1vgFX6EjQw5izWDxrecWK9AM72rugNr0TFldMOi0fj6Jk+zeKIt0xGj4cEfQIJth4w3OKWOJ4f+AFw==\",\n      \"dev\": true,\n      \"optional\": true\n    },\n    \"is-extglob\": {\n      \"version\": \"1.0.0\",\n      \"resolved\": \"https://registry.npmmirror.com/is-extglob/-/is-extglob-1.0.0.tgz\",\n      \"integrity\": \"sha512-7Q+VbVafe6x2T+Tu6NcOf6sRklazEPmBoB3IWk3WdGZM2iGUwU/Oe3Wtq5lSEkDTTlpp8yx+5t4pzO/i9Ty1ww==\",\n      \"dev\": true,\n      \"optional\": true\n    },\n    \"is-finite\": {\n      \"version\": \"1.1.0\",\n      \"resolved\": \"https://registry.npmmirror.com/is-finite/-/is-finite-1.1.0.tgz\",\n      \"integrity\": \"sha512-cdyMtqX/BOqqNBBiKlIVkytNHm49MtMlYyn1zxzvJKWmFMlGzm+ry5BBfYyeY9YmNKbRSo/o7OX9w9ale0wg3w==\",\n      \"dev\": true\n    },\n    \"is-glob\": {\n      \"version\": \"2.0.1\",\n      \"resolved\": \"https://registry.npmmirror.com/is-glob/-/is-glob-2.0.1.tgz\",\n      \"integrity\": \"sha512-a1dBeB19NXsf/E0+FHqkagizel/LQw2DjSQpvQrj3zT+jYPpaUCryPnrQajXKFLCMuf4I6FhRpaGtw4lPrG6Eg==\",\n      \"dev\": true,\n      \"optional\": true,\n      \"requires\": {\n        \"is-extglob\": \"^1.0.0\"\n      }\n    },\n    \"is-number\": {\n      \"version\": \"2.1.0\",\n      \"resolved\": \"https://registry.npmmirror.com/is-number/-/is-number-2.1.0.tgz\",\n      \"integrity\": \"sha512-QUzH43Gfb9+5yckcrSA0VBDwEtDUchrk4F6tfJZQuNzDJbEDB9cZNzSfXGQ1jqmdDY/kl41lUOWM9syA8z8jlg==\",\n      \"dev\": true,\n      \"optional\": true,\n      \"requires\": {\n        \"kind-of\": \"^3.0.2\"\n      }\n    },\n    \"is-plain-object\": {\n      \"version\": \"2.0.4\",\n      \"resolved\": \"https://registry.npmmirror.com/is-plain-object/-/is-plain-object-2.0.4.tgz\",\n      \"integrity\": \"sha512-h5PpgXkWitc38BBMYawTYMWJHFZJVnBquFE57xFpjB8pJFiF6gZ+bU+WyI/yqXiFR5mdLsgYNaPe8uao6Uv9Og==\",\n      \"dev\": true,\n      \"optional\": true,\n      \"requires\": {\n        \"isobject\": \"^3.0.1\"\n      },\n      \"dependencies\": {\n        \"isobject\": {\n          \"version\": \"3.0.1\",\n          \"resolved\": \"https://registry.npmmirror.com/isobject/-/isobject-3.0.1.tgz\",\n          \"integrity\": \"sha512-WhB9zCku7EGTj/HQQRz5aUQEUeoQZH2bWcltRErOpymJ4boYE6wL9Tbr23krRPSZ+C5zqNSrSw+Cc7sZZ4b7vg==\",\n          \"dev\": true,\n          \"optional\": true\n        }\n      }\n    },\n    \"is-posix-bracket\": {\n      \"version\": \"0.1.1\",\n      \"resolved\": \"https://registry.npmmirror.com/is-posix-bracket/-/is-posix-bracket-0.1.1.tgz\",\n      \"integrity\": \"sha512-Yu68oeXJ7LeWNmZ3Zov/xg/oDBnBK2RNxwYY1ilNJX+tKKZqgPK+qOn/Gs9jEu66KDY9Netf5XLKNGzas/vPfQ==\",\n      \"dev\": true,\n      \"optional\": true\n    },\n    \"is-primitive\": {\n      \"version\": \"2.0.0\",\n      \"resolved\": \"https://registry.npmmirror.com/is-primitive/-/is-primitive-2.0.0.tgz\",\n      \"integrity\": \"sha512-N3w1tFaRfk3UrPfqeRyD+GYDASU3W5VinKhlORy8EWVf/sIdDL9GAcew85XmktCfH+ngG7SRXEVDoO18WMdB/Q==\",\n      \"dev\": true,\n      \"optional\": true\n    },\n    \"is-windows\": {\n      \"version\": \"1.0.2\",\n      \"resolved\": \"https://registry.npmmirror.com/is-windows/-/is-windows-1.0.2.tgz\",\n      \"integrity\": \"sha512-eXK1UInq2bPmjyX6e3VHIzMLobc4J94i4AWn+Hpq3OU5KkrRC96OAcR3PRJ/pGu6m8TRnBHP9dkXQVsT/COVIA==\",\n      \"dev\": true,\n      \"optional\": true\n    },\n    \"isarray\": {\n      \"version\": \"1.0.0\",\n      \"resolved\": \"https://registry.npmmirror.com/isarray/-/isarray-1.0.0.tgz\",\n      \"integrity\": \"sha512-VLghIWNM6ELQzo7zwmcg0NmTVyWKYjvIeM83yjp0wRDTmUnrM678fQbcKBo6n2CJEF0szoG//ytg+TKla89ALQ==\",\n      \"dev\": true,\n      \"optional\": true\n    },\n    \"isobject\": {\n      \"version\": \"2.1.0\",\n      \"resolved\": \"https://registry.npmmirror.com/isobject/-/isobject-2.1.0.tgz\",\n      \"integrity\": \"sha512-+OUdGJlgjOBZDfxnDjYYG6zp487z0JGNQq3cYQYg5f5hKR+syHMsaztzGeml/4kGG55CSpKSpWTY+jYGgsHLgA==\",\n      \"dev\": true,\n      \"optional\": true,\n      \"requires\": {\n        \"isarray\": \"1.0.0\"\n      }\n    },\n    \"js-tokens\": {\n      \"version\": \"3.0.2\",\n      \"resolved\": \"https://registry.npmmirror.com/js-tokens/-/js-tokens-3.0.2.tgz\",\n      \"integrity\": \"sha512-RjTcuD4xjtthQkaWH7dFlH85L+QaVtSoOyGdZ3g6HFhS9dFNDfLyqgm2NFe2X6cQpeFmt0452FJjFG5UameExg==\",\n      \"dev\": true\n    },\n    \"jsesc\": {\n      \"version\": \"1.3.0\",\n      \"resolved\": \"https://registry.npmmirror.com/jsesc/-/jsesc-1.3.0.tgz\",\n      \"integrity\": \"sha512-Mke0DA0QjUWuJlhsE0ZPPhYiJkRap642SmI/4ztCFaUs6V2AiH1sfecc+57NgaryfAA2VR3v6O+CSjC1jZJKOA==\",\n      \"dev\": true\n    },\n    \"json5\": {\n      \"version\": \"0.5.1\",\n      \"resolved\": \"https://registry.npmmirror.com/json5/-/json5-0.5.1.tgz\",\n      \"integrity\": \"sha512-4xrs1aW+6N5DalkqSVA8fxh458CXvR99WU8WLKmq4v8eWAL86Xo3BVqyd3SkA9wEVjCMqyvvRRkshAdOnBp5rw==\",\n      \"dev\": true\n    },\n    \"kind-of\": {\n      \"version\": \"3.2.2\",\n      \"resolved\": \"https://registry.npmmirror.com/kind-of/-/kind-of-3.2.2.tgz\",\n      \"integrity\": \"sha512-NOW9QQXMoZGg/oqnVNoNTTIFEIid1627WCffUBJEdMxYApq7mNE7CpzucIPc+ZQg25Phej7IJSmX3hO+oblOtQ==\",\n      \"dev\": true,\n      \"optional\": true,\n      \"requires\": {\n        \"is-buffer\": \"^1.1.5\"\n      }\n    },\n    \"lodash\": {\n      \"version\": \"4.17.21\",\n      \"resolved\": \"https://registry.npmmirror.com/lodash/-/lodash-4.17.21.tgz\",\n      \"integrity\": \"sha512-v2kDEe57lecTulaDIuNTPy3Ry4gLGJ6Z1O3vE1krgXZNrsQ+LFTGHVxVjcXPs17LhbZVGedAJv8XZ1tvj5FvSg==\",\n      \"dev\": true\n    },\n    \"loose-envify\": {\n      \"version\": \"1.4.0\",\n      \"resolved\": \"https://registry.npmmirror.com/loose-envify/-/loose-envify-1.4.0.tgz\",\n      \"integrity\": \"sha512-lyuxPGr/Wfhrlem2CL/UcnUc1zcqKAImBDzukY7Y5F/yQiNdko6+fRLevlw1HgMySw7f611UIY408EtxRSoK3Q==\",\n      \"dev\": true,\n      \"requires\": {\n        \"js-tokens\": \"^3.0.0 || ^4.0.0\"\n      }\n    },\n    \"map-cache\": {\n      \"version\": \"0.2.2\",\n      \"resolved\": \"https://registry.npmmirror.com/map-cache/-/map-cache-0.2.2.tgz\",\n      \"integrity\": \"sha512-8y/eV9QQZCiyn1SprXSrCmqJN0yNRATe+PO8ztwqrvrbdRLA3eYJF0yaR0YayLWkMbsQSKWS9N2gPcGEc4UsZg==\",\n      \"dev\": true,\n      \"optional\": true\n    },\n    \"map-visit\": {\n      \"version\": \"1.0.0\",\n      \"resolved\": \"https://registry.npmmirror.com/map-visit/-/map-visit-1.0.0.tgz\",\n      \"integrity\": \"sha512-4y7uGv8bd2WdM9vpQsiQNo41Ln1NvhvDRuVt0k2JZQ+ezN2uaQes7lZeZ+QQUHOLQAtDaBJ+7wCbi+ab/KFs+w==\",\n      \"dev\": true,\n      \"optional\": true,\n      \"requires\": {\n        \"object-visit\": \"^1.0.0\"\n      }\n    },\n    \"math-random\": {\n      \"version\": \"1.0.4\",\n      \"resolved\": \"https://registry.npmmirror.com/math-random/-/math-random-1.0.4.tgz\",\n      \"integrity\": \"sha512-rUxjysqif/BZQH2yhd5Aaq7vXMSx9NdEsQcyA07uEzIvxgI7zIr33gGsh+RU0/XjmQpCW7RsVof1vlkvQVCK5A==\",\n      \"dev\": true,\n      \"optional\": true\n    },\n    \"micromatch\": {\n      \"version\": \"2.3.11\",\n      \"resolved\": \"https://registry.npmmirror.com/micromatch/-/micromatch-2.3.11.tgz\",\n      \"integrity\": \"sha512-LnU2XFEk9xxSJ6rfgAry/ty5qwUTyHYOBU0g4R6tIw5ljwgGIBmiKhRWLw5NpMOnrgUNcDJ4WMp8rl3sYVHLNA==\",\n      \"dev\": true,\n      \"optional\": true,\n      \"requires\": {\n        \"arr-diff\": \"^2.0.0\",\n        \"array-unique\": \"^0.2.1\",\n        \"braces\": \"^1.8.2\",\n        \"expand-brackets\": \"^0.1.4\",\n        \"extglob\": \"^0.3.1\",\n        \"filename-regex\": \"^2.0.0\",\n        \"is-extglob\": \"^1.0.0\",\n        \"is-glob\": \"^2.0.1\",\n        \"kind-of\": \"^3.0.2\",\n        \"normalize-path\": \"^2.0.1\",\n        \"object.omit\": \"^2.0.0\",\n        \"parse-glob\": \"^3.0.4\",\n        \"regex-cache\": \"^0.4.2\"\n      }\n    },\n    \"minimatch\": {\n      \"version\": \"3.1.2\",\n      \"resolved\": \"https://registry.npmmirror.com/minimatch/-/minimatch-3.1.2.tgz\",\n      \"integrity\": \"sha512-J7p63hRiAjw1NDEww1W7i37+ByIrOWO5XQQAzZ3VOcL0PNybwpfmV/N05zFAzwQ9USyEcX6t3UO+K5aqBQOIHw==\",\n      \"dev\": true,\n      \"requires\": {\n        \"brace-expansion\": \"^1.1.7\"\n      }\n    },\n    \"minimist\": {\n      \"version\": \"1.2.8\",\n      \"resolved\": \"https://registry.npmmirror.com/minimist/-/minimist-1.2.8.tgz\",\n      \"integrity\": \"sha512-2yyAR8qBkN3YuheJanUpWC5U3bb5osDywNB8RzDVlDwDHbocAJveqqj1u8+SVD7jkWT4yvsHCpWqqWqAxb0zCA==\",\n      \"dev\": true\n    },\n    \"mixin-deep\": {\n      \"version\": \"1.3.2\",\n      \"resolved\": \"https://registry.npmmirror.com/mixin-deep/-/mixin-deep-1.3.2.tgz\",\n      \"integrity\": \"sha512-WRoDn//mXBiJ1H40rqa3vH0toePwSsGb45iInWlTySa+Uu4k3tYUSxa2v1KqAiLtvlrSzaExqS1gtk96A9zvEA==\",\n      \"dev\": true,\n      \"optional\": true,\n      \"requires\": {\n        \"for-in\": \"^1.0.2\",\n        \"is-extendable\": \"^1.0.1\"\n      },\n      \"dependencies\": {\n        \"is-extendable\": {\n          \"version\": \"1.0.1\",\n          \"resolved\": \"https://registry.npmmirror.com/is-extendable/-/is-extendable-1.0.1.tgz\",\n          \"integrity\": \"sha512-arnXMxT1hhoKo9k1LZdmlNyJdDDfy2v0fXjFlmok4+i8ul/6WlbVge9bhM74OpNPQPMGUToDtz+KXa1PneJxOA==\",\n          \"dev\": true,\n          \"optional\": true,\n          \"requires\": {\n            \"is-plain-object\": \"^2.0.4\"\n          }\n        }\n      }\n    },\n    \"mkdirp\": {\n      \"version\": \"0.5.6\",\n      \"resolved\": \"https://registry.npmmirror.com/mkdirp/-/mkdirp-0.5.6.tgz\",\n      \"integrity\": \"sha512-FP+p8RB8OWpF3YZBCrP5gtADmtXApB5AMLn+vdyA+PyxCjrCs00mjyUozssO33cwDeT3wNGdLxJ5M//YqtHAJw==\",\n      \"dev\": true,\n      \"requires\": {\n        \"minimist\": \"^1.2.6\"\n      }\n    },\n    \"ms\": {\n      \"version\": \"2.0.0\",\n      \"resolved\": \"https://registry.npmmirror.com/ms/-/ms-2.0.0.tgz\",\n      \"integrity\": \"sha512-Tpp60P6IUJDTuOq/5Z8cdskzJujfwqfOTkrwIwj7IRISpnkJnT6SyJ4PCPnGMoFjC9ddhal5KVIYtAt97ix05A==\",\n      \"dev\": true\n    },\n    \"nan\": {\n      \"version\": \"2.17.0\",\n      \"resolved\": \"https://registry.npmmirror.com/nan/-/nan-2.17.0.tgz\",\n      \"integrity\": \"sha512-2ZTgtl0nJsO0KQCjEpxcIr5D+Yv90plTitZt9JBfQvVJDS5seMl3FOvsh3+9CoYWXf/1l5OaZzzF6nDm4cagaQ==\",\n      \"dev\": true,\n      \"optional\": true\n    },\n    \"nanomatch\": {\n      \"version\": \"1.2.13\",\n      \"resolved\": \"https://registry.npmmirror.com/nanomatch/-/nanomatch-1.2.13.tgz\",\n      \"integrity\": \"sha512-fpoe2T0RbHwBTBUOftAfBPaDEi06ufaUai0mE6Yn1kacc3SnTErfb/h+X94VXzI64rKFHYImXSvdwGGCmwOqCA==\",\n      \"dev\": true,\n      \"optional\": true,\n      \"requires\": {\n        \"arr-diff\": \"^4.0.0\",\n        \"array-unique\": \"^0.3.2\",\n        \"define-property\": \"^2.0.2\",\n        \"extend-shallow\": \"^3.0.2\",\n        \"fragment-cache\": \"^0.2.1\",\n        \"is-windows\": \"^1.0.2\",\n        \"kind-of\": \"^6.0.2\",\n        \"object.pick\": \"^1.3.0\",\n        \"regex-not\": \"^1.0.0\",\n        \"snapdragon\": \"^0.8.1\",\n        \"to-regex\": \"^3.0.1\"\n      },\n      \"dependencies\": {\n        \"arr-diff\": {\n          \"version\": \"4.0.0\",\n          \"resolved\": \"https://registry.npmmirror.com/arr-diff/-/arr-diff-4.0.0.tgz\",\n          \"integrity\": \"sha512-YVIQ82gZPGBebQV/a8dar4AitzCQs0jjXwMPZllpXMaGjXPYVUawSxQrRsjhjupyVxEvbHgUmIhKVlND+j02kA==\",\n          \"dev\": true,\n          \"optional\": true\n        },\n        \"array-unique\": {\n          \"version\": \"0.3.2\",\n          \"resolved\": \"https://registry.npmmirror.com/array-unique/-/array-unique-0.3.2.tgz\",\n          \"integrity\": \"sha512-SleRWjh9JUud2wH1hPs9rZBZ33H6T9HOiL0uwGnGx9FpE6wKGyfWugmbkEOIs6qWrZhg0LWeLziLrEwQJhs5mQ==\",\n          \"dev\": true,\n          \"optional\": true\n        },\n        \"kind-of\": {\n          \"version\": \"6.0.3\",\n          \"resolved\": \"https://registry.npmmirror.com/kind-of/-/kind-of-6.0.3.tgz\",\n          \"integrity\": \"sha512-dcS1ul+9tmeD95T+x28/ehLgd9mENa3LsvDTtzm3vyBEO7RPptvAD+t44WVXaUjTBRcrpFeFlC8WCruUR456hw==\",\n          \"dev\": true,\n          \"optional\": true\n        }\n      }\n    },\n    \"normalize-path\": {\n      \"version\": \"2.1.1\",\n      \"resolved\": \"https://registry.npmmirror.com/normalize-path/-/normalize-path-2.1.1.tgz\",\n      \"integrity\": \"sha512-3pKJwH184Xo/lnH6oyP1q2pMd7HcypqqmRs91/6/i2CGtWwIKGCkOOMTm/zXbgTEWHw1uNpNi/igc3ePOYHb6w==\",\n      \"dev\": true,\n      \"optional\": true,\n      \"requires\": {\n        \"remove-trailing-separator\": \"^1.0.1\"\n      }\n    },\n    \"object-assign\": {\n      \"version\": \"4.1.1\",\n      \"resolved\": \"https://registry.npmmirror.com/object-assign/-/object-assign-4.1.1.tgz\",\n      \"integrity\": \"sha512-rJgTQnkUnH1sFw8yT6VSU3zD3sWmu6sZhIseY8VX+GRu3P6F7Fu+JNDoXfklElbLJSnc3FUQHVe4cU5hj+BcUg==\",\n      \"dev\": true\n    },\n    \"object-copy\": {\n      \"version\": \"0.1.0\",\n      \"resolved\": \"https://registry.npmmirror.com/object-copy/-/object-copy-0.1.0.tgz\",\n      \"integrity\": \"sha512-79LYn6VAb63zgtmAteVOWo9Vdj71ZVBy3Pbse+VqxDpEP83XuujMrGqHIwAXJ5I/aM0zU7dIyIAhifVTPrNItQ==\",\n      \"dev\": true,\n      \"optional\": true,\n      \"requires\": {\n        \"copy-descriptor\": \"^0.1.0\",\n        \"define-property\": \"^0.2.5\",\n        \"kind-of\": \"^3.0.3\"\n      },\n      \"dependencies\": {\n        \"define-property\": {\n          \"version\": \"0.2.5\",\n          \"resolved\": \"https://registry.npmmirror.com/define-property/-/define-property-0.2.5.tgz\",\n          \"integrity\": \"sha512-Rr7ADjQZenceVOAKop6ALkkRAmH1A4Gx9hV/7ZujPUN2rkATqFO0JZLZInbAjpZYoJ1gUx8MRMQVkYemcbMSTA==\",\n          \"dev\": true,\n          \"optional\": true,\n          \"requires\": {\n            \"is-descriptor\": \"^0.1.0\"\n          }\n        }\n      }\n    },\n    \"object-visit\": {\n      \"version\": \"1.0.1\",\n      \"resolved\": \"https://registry.npmmirror.com/object-visit/-/object-visit-1.0.1.tgz\",\n      \"integrity\": \"sha512-GBaMwwAVK9qbQN3Scdo0OyvgPW7l3lnaVMj84uTOZlswkX0KpF6fyDBJhtTthf7pymztoN36/KEr1DyhF96zEA==\",\n      \"dev\": true,\n      \"optional\": true,\n      \"requires\": {\n        \"isobject\": \"^3.0.0\"\n      },\n      \"dependencies\": {\n        \"isobject\": {\n          \"version\": \"3.0.1\",\n          \"resolved\": \"https://registry.npmmirror.com/isobject/-/isobject-3.0.1.tgz\",\n          \"integrity\": \"sha512-WhB9zCku7EGTj/HQQRz5aUQEUeoQZH2bWcltRErOpymJ4boYE6wL9Tbr23krRPSZ+C5zqNSrSw+Cc7sZZ4b7vg==\",\n          \"dev\": true,\n          \"optional\": true\n        }\n      }\n    },\n    \"object.omit\": {\n      \"version\": \"2.0.1\",\n      \"resolved\": \"https://registry.npmmirror.com/object.omit/-/object.omit-2.0.1.tgz\",\n      \"integrity\": \"sha512-UiAM5mhmIuKLsOvrL+B0U2d1hXHF3bFYWIuH1LMpuV2EJEHG1Ntz06PgLEHjm6VFd87NpH8rastvPoyv6UW2fA==\",\n      \"dev\": true,\n      \"optional\": true,\n      \"requires\": {\n        \"for-own\": \"^0.1.4\",\n        \"is-extendable\": \"^0.1.1\"\n      }\n    },\n    \"object.pick\": {\n      \"version\": \"1.3.0\",\n      \"resolved\": \"https://registry.npmmirror.com/object.pick/-/object.pick-1.3.0.tgz\",\n      \"integrity\": \"sha512-tqa/UMy/CCoYmj+H5qc07qvSL9dqcs/WZENZ1JbtWBlATP+iVOe778gE6MSijnyCnORzDuX6hU+LA4SZ09YjFQ==\",\n      \"dev\": true,\n      \"optional\": true,\n      \"requires\": {\n        \"isobject\": \"^3.0.1\"\n      },\n      \"dependencies\": {\n        \"isobject\": {\n          \"version\": \"3.0.1\",\n          \"resolved\": \"https://registry.npmmirror.com/isobject/-/isobject-3.0.1.tgz\",\n          \"integrity\": \"sha512-WhB9zCku7EGTj/HQQRz5aUQEUeoQZH2bWcltRErOpymJ4boYE6wL9Tbr23krRPSZ+C5zqNSrSw+Cc7sZZ4b7vg==\",\n          \"dev\": true,\n          \"optional\": true\n        }\n      }\n    },\n    \"once\": {\n      \"version\": \"1.4.0\",\n      \"resolved\": \"https://registry.npmmirror.com/once/-/once-1.4.0.tgz\",\n      \"integrity\": \"sha512-lNaJgI+2Q5URQBkccEKHTQOPaXdUxnZZElQTZY0MFUAuaEqe1E+Nyvgdz/aIyNi6Z9MzO5dv1H8n58/GELp3+w==\",\n      \"dev\": true,\n      \"requires\": {\n        \"wrappy\": \"1\"\n      }\n    },\n    \"os-homedir\": {\n      \"version\": \"1.0.2\",\n      \"resolved\": \"https://registry.npmmirror.com/os-homedir/-/os-homedir-1.0.2.tgz\",\n      \"integrity\": \"sha512-B5JU3cabzk8c67mRRd3ECmROafjYMXbuzlwtqdM8IbS8ktlTix8aFGb2bAGKrSRIlnfKwovGUUr72JUPyOb6kQ==\",\n      \"dev\": true\n    },\n    \"os-tmpdir\": {\n      \"version\": \"1.0.2\",\n      \"resolved\": \"https://registry.npmmirror.com/os-tmpdir/-/os-tmpdir-1.0.2.tgz\",\n      \"integrity\": \"sha512-D2FR03Vir7FIu45XBY20mTb+/ZSWB00sjU9jdQXt83gDrI4Ztz5Fs7/yy74g2N5SVQY4xY1qDr4rNddwYRVX0g==\",\n      \"dev\": true\n    },\n    \"output-file-sync\": {\n      \"version\": \"1.1.2\",\n      \"resolved\": \"https://registry.npmmirror.com/output-file-sync/-/output-file-sync-1.1.2.tgz\",\n      \"integrity\": \"sha512-uQLlclru4xpCi+tfs80l3QF24KL81X57ELNMy7W/dox+JTtxUf1bLyQ8968fFCmSqqbokjW0kn+WBIlO+rSkNg==\",\n      \"dev\": true,\n      \"requires\": {\n        \"graceful-fs\": \"^4.1.4\",\n        \"mkdirp\": \"^0.5.1\",\n        \"object-assign\": \"^4.1.0\"\n      }\n    },\n    \"parse-glob\": {\n      \"version\": \"3.0.4\",\n      \"resolved\": \"https://registry.npmmirror.com/parse-glob/-/parse-glob-3.0.4.tgz\",\n      \"integrity\": \"sha512-FC5TeK0AwXzq3tUBFtH74naWkPQCEWs4K+xMxWZBlKDWu0bVHXGZa+KKqxKidd7xwhdZ19ZNuF2uO1M/r196HA==\",\n      \"dev\": true,\n      \"optional\": true,\n      \"requires\": {\n        \"glob-base\": \"^0.3.0\",\n        \"is-dotfile\": \"^1.0.0\",\n        \"is-extglob\": \"^1.0.0\",\n        \"is-glob\": \"^2.0.0\"\n      }\n    },\n    \"pascalcase\": {\n      \"version\": \"0.1.1\",\n      \"resolved\": \"https://registry.npmmirror.com/pascalcase/-/pascalcase-0.1.1.tgz\",\n      \"integrity\": \"sha512-XHXfu/yOQRy9vYOtUDVMN60OEJjW013GoObG1o+xwQTpB9eYJX/BjXMsdW13ZDPruFhYYn0AG22w0xgQMwl3Nw==\",\n      \"dev\": true,\n      \"optional\": true\n    },\n    \"path-is-absolute\": {\n      \"version\": \"1.0.1\",\n      \"resolved\": \"https://registry.npmmirror.com/path-is-absolute/-/path-is-absolute-1.0.1.tgz\",\n      \"integrity\": \"sha512-AVbw3UJ2e9bq64vSaS9Am0fje1Pa8pbGqTTsmXfaIiMpnr5DlDhfJOuLj9Sf95ZPVDAUerDfEk88MPmPe7UCQg==\",\n      \"dev\": true\n    },\n    \"posix-character-classes\": {\n      \"version\": \"0.1.1\",\n      \"resolved\": \"https://registry.npmmirror.com/posix-character-classes/-/posix-character-classes-0.1.1.tgz\",\n      \"integrity\": \"sha512-xTgYBc3fuo7Yt7JbiuFxSYGToMoz8fLoE6TC9Wx1P/u+LfeThMOAqmuyECnlBaaJb+u1m9hHiXUEtwW4OzfUJg==\",\n      \"dev\": true,\n      \"optional\": true\n    },\n    \"preserve\": {\n      \"version\": \"0.2.0\",\n      \"resolved\": \"https://registry.npmmirror.com/preserve/-/preserve-0.2.0.tgz\",\n      \"integrity\": \"sha512-s/46sYeylUfHNjI+sA/78FAHlmIuKqI9wNnzEOGehAlUUYeObv5C2mOinXBjyUyWmJ2SfcS2/ydApH4hTF4WXQ==\",\n      \"dev\": true,\n      \"optional\": true\n    },\n    \"private\": {\n      \"version\": \"0.1.8\",\n      \"resolved\": \"https://registry.npmmirror.com/private/-/private-0.1.8.tgz\",\n      \"integrity\": \"sha512-VvivMrbvd2nKkiG38qjULzlc+4Vx4wm/whI9pQD35YrARNnhxeiRktSOhSukRLFNlzg6Br/cJPet5J/u19r/mg==\",\n      \"dev\": true\n    },\n    \"process-nextick-args\": {\n      \"version\": \"2.0.1\",\n      \"resolved\": \"https://registry.npmmirror.com/process-nextick-args/-/process-nextick-args-2.0.1.tgz\",\n      \"integrity\": \"sha512-3ouUOpQhtgrbOa17J7+uxOTpITYWaGP7/AhoR3+A+/1e9skrzelGi/dXzEYyvbxubEF6Wn2ypscTKiKJFFn1ag==\",\n      \"dev\": true,\n      \"optional\": true\n    },\n    \"randomatic\": {\n      \"version\": \"3.1.1\",\n      \"resolved\": \"https://registry.npmmirror.com/randomatic/-/randomatic-3.1.1.tgz\",\n      \"integrity\": \"sha512-TuDE5KxZ0J461RVjrJZCJc+J+zCkTb1MbH9AQUq68sMhOMcy9jLcb3BrZKgp9q9Ncltdg4QVqWrH02W2EFFVYw==\",\n      \"dev\": true,\n      \"optional\": true,\n      \"requires\": {\n        \"is-number\": \"^4.0.0\",\n        \"kind-of\": \"^6.0.0\",\n        \"math-random\": \"^1.0.1\"\n      },\n      \"dependencies\": {\n        \"is-number\": {\n          \"version\": \"4.0.0\",\n          \"resolved\": \"https://registry.npmmirror.com/is-number/-/is-number-4.0.0.tgz\",\n          \"integrity\": \"sha512-rSklcAIlf1OmFdyAqbnWTLVelsQ58uvZ66S/ZyawjWqIviTWCjg2PzVGw8WUA+nNuPTqb4wgA+NszrJ+08LlgQ==\",\n          \"dev\": true,\n          \"optional\": true\n        },\n        \"kind-of\": {\n          \"version\": \"6.0.3\",\n          \"resolved\": \"https://registry.npmmirror.com/kind-of/-/kind-of-6.0.3.tgz\",\n          \"integrity\": \"sha512-dcS1ul+9tmeD95T+x28/ehLgd9mENa3LsvDTtzm3vyBEO7RPptvAD+t44WVXaUjTBRcrpFeFlC8WCruUR456hw==\",\n          \"dev\": true,\n          \"optional\": true\n        }\n      }\n    },\n    \"readable-stream\": {\n      \"version\": \"2.3.8\",\n      \"resolved\": \"https://registry.npmmirror.com/readable-stream/-/readable-stream-2.3.8.tgz\",\n      \"integrity\": \"sha512-8p0AUk4XODgIewSi0l8Epjs+EVnWiK7NoDIEGU0HhE7+ZyY8D1IMY7odu5lRrFXGg71L15KG8QrPmum45RTtdA==\",\n      \"dev\": true,\n      \"optional\": true,\n      \"requires\": {\n        \"core-util-is\": \"~1.0.0\",\n        \"inherits\": \"~2.0.3\",\n        \"isarray\": \"~1.0.0\",\n        \"process-nextick-args\": \"~2.0.0\",\n        \"safe-buffer\": \"~5.1.1\",\n        \"string_decoder\": \"~1.1.1\",\n        \"util-deprecate\": \"~1.0.1\"\n      }\n    },\n    \"readdirp\": {\n      \"version\": \"2.2.1\",\n      \"resolved\": \"https://registry.npmmirror.com/readdirp/-/readdirp-2.2.1.tgz\",\n      \"integrity\": \"sha512-1JU/8q+VgFZyxwrJ+SVIOsh+KywWGpds3NTqikiKpDMZWScmAYyKIgqkO+ARvNWJfXeXR1zxz7aHF4u4CyH6vQ==\",\n      \"dev\": true,\n      \"optional\": true,\n      \"requires\": {\n        \"graceful-fs\": \"^4.1.11\",\n        \"micromatch\": \"^3.1.10\",\n        \"readable-stream\": \"^2.0.2\"\n      },\n      \"dependencies\": {\n        \"arr-diff\": {\n          \"version\": \"4.0.0\",\n          \"resolved\": \"https://registry.npmmirror.com/arr-diff/-/arr-diff-4.0.0.tgz\",\n          \"integrity\": \"sha512-YVIQ82gZPGBebQV/a8dar4AitzCQs0jjXwMPZllpXMaGjXPYVUawSxQrRsjhjupyVxEvbHgUmIhKVlND+j02kA==\",\n          \"dev\": true,\n          \"optional\": true\n        },\n        \"array-unique\": {\n          \"version\": \"0.3.2\",\n          \"resolved\": \"https://registry.npmmirror.com/array-unique/-/array-unique-0.3.2.tgz\",\n          \"integrity\": \"sha512-SleRWjh9JUud2wH1hPs9rZBZ33H6T9HOiL0uwGnGx9FpE6wKGyfWugmbkEOIs6qWrZhg0LWeLziLrEwQJhs5mQ==\",\n          \"dev\": true,\n          \"optional\": true\n        },\n        \"braces\": {\n          \"version\": \"2.3.2\",\n          \"resolved\": \"https://registry.npmmirror.com/braces/-/braces-2.3.2.tgz\",\n          \"integrity\": \"sha512-aNdbnj9P8PjdXU4ybaWLK2IF3jc/EoDYbC7AazW6to3TRsfXxscC9UXOB5iDiEQrkyIbWp2SLQda4+QAa7nc3w==\",\n          \"dev\": true,\n          \"optional\": true,\n          \"requires\": {\n            \"arr-flatten\": \"^1.1.0\",\n            \"array-unique\": \"^0.3.2\",\n            \"extend-shallow\": \"^2.0.1\",\n            \"fill-range\": \"^4.0.0\",\n            \"isobject\": \"^3.0.1\",\n            \"repeat-element\": \"^1.1.2\",\n            \"snapdragon\": \"^0.8.1\",\n            \"snapdragon-node\": \"^2.0.1\",\n            \"split-string\": \"^3.0.2\",\n            \"to-regex\": \"^3.0.1\"\n          },\n          \"dependencies\": {\n            \"extend-shallow\": {\n              \"version\": \"2.0.1\",\n              \"resolved\": \"https://registry.npmmirror.com/extend-shallow/-/extend-shallow-2.0.1.tgz\",\n              \"integrity\": \"sha512-zCnTtlxNoAiDc3gqY2aYAWFx7XWWiasuF2K8Me5WbN8otHKTUKBwjPtNpRs/rbUZm7KxWAaNj7P1a/p52GbVug==\",\n              \"dev\": true,\n              \"optional\": true,\n              \"requires\": {\n                \"is-extendable\": \"^0.1.0\"\n              }\n            }\n          }\n        },\n        \"expand-brackets\": {\n          \"version\": \"2.1.4\",\n          \"resolved\": \"https://registry.npmmirror.com/expand-brackets/-/expand-brackets-2.1.4.tgz\",\n          \"integrity\": \"sha512-w/ozOKR9Obk3qoWeY/WDi6MFta9AoMR+zud60mdnbniMcBxRuFJyDt2LdX/14A1UABeqk+Uk+LDfUpvoGKppZA==\",\n          \"dev\": true,\n          \"optional\": true,\n          \"requires\": {\n            \"debug\": \"^2.3.3\",\n            \"define-property\": \"^0.2.5\",\n            \"extend-shallow\": \"^2.0.1\",\n            \"posix-character-classes\": \"^0.1.0\",\n            \"regex-not\": \"^1.0.0\",\n            \"snapdragon\": \"^0.8.1\",\n            \"to-regex\": \"^3.0.1\"\n          },\n          \"dependencies\": {\n            \"define-property\": {\n              \"version\": \"0.2.5\",\n              \"resolved\": \"https://registry.npmmirror.com/define-property/-/define-property-0.2.5.tgz\",\n              \"integrity\": \"sha512-Rr7ADjQZenceVOAKop6ALkkRAmH1A4Gx9hV/7ZujPUN2rkATqFO0JZLZInbAjpZYoJ1gUx8MRMQVkYemcbMSTA==\",\n              \"dev\": true,\n              \"optional\": true,\n              \"requires\": {\n                \"is-descriptor\": \"^0.1.0\"\n              }\n            },\n            \"extend-shallow\": {\n              \"version\": \"2.0.1\",\n              \"resolved\": \"https://registry.npmmirror.com/extend-shallow/-/extend-shallow-2.0.1.tgz\",\n              \"integrity\": \"sha512-zCnTtlxNoAiDc3gqY2aYAWFx7XWWiasuF2K8Me5WbN8otHKTUKBwjPtNpRs/rbUZm7KxWAaNj7P1a/p52GbVug==\",\n              \"dev\": true,\n              \"optional\": true,\n              \"requires\": {\n                \"is-extendable\": \"^0.1.0\"\n              }\n            },\n            \"is-accessor-descriptor\": {\n              \"version\": \"0.1.6\",\n              \"resolved\": \"https://registry.npmmirror.com/is-accessor-descriptor/-/is-accessor-descriptor-0.1.6.tgz\",\n              \"integrity\": \"sha512-e1BM1qnDbMRG3ll2U9dSK0UMHuWOs3pY3AtcFsmvwPtKL3MML/Q86i+GilLfvqEs4GW+ExB91tQ3Ig9noDIZ+A==\",\n              \"dev\": true,\n              \"optional\": true,\n              \"requires\": {\n                \"kind-of\": \"^3.0.2\"\n              },\n              \"dependencies\": {\n                \"kind-of\": {\n                  \"version\": \"3.2.2\",\n                  \"resolved\": \"https://registry.npmmirror.com/kind-of/-/kind-of-3.2.2.tgz\",\n                  \"integrity\": \"sha512-NOW9QQXMoZGg/oqnVNoNTTIFEIid1627WCffUBJEdMxYApq7mNE7CpzucIPc+ZQg25Phej7IJSmX3hO+oblOtQ==\",\n                  \"dev\": true,\n                  \"optional\": true,\n                  \"requires\": {\n                    \"is-buffer\": \"^1.1.5\"\n                  }\n                }\n              }\n            },\n            \"is-data-descriptor\": {\n              \"version\": \"0.1.4\",\n              \"resolved\": \"https://registry.npmmirror.com/is-data-descriptor/-/is-data-descriptor-0.1.4.tgz\",\n              \"integrity\": \"sha512-+w9D5ulSoBNlmw9OHn3U2v51SyoCd0he+bB3xMl62oijhrspxowjU+AIcDY0N3iEJbUEkB15IlMASQsxYigvXg==\",\n              \"dev\": true,\n              \"optional\": true,\n              \"requires\": {\n                \"kind-of\": \"^3.0.2\"\n              },\n              \"dependencies\": {\n                \"kind-of\": {\n                  \"version\": \"3.2.2\",\n                  \"resolved\": \"https://registry.npmmirror.com/kind-of/-/kind-of-3.2.2.tgz\",\n                  \"integrity\": \"sha512-NOW9QQXMoZGg/oqnVNoNTTIFEIid1627WCffUBJEdMxYApq7mNE7CpzucIPc+ZQg25Phej7IJSmX3hO+oblOtQ==\",\n                  \"dev\": true,\n                  \"optional\": true,\n                  \"requires\": {\n                    \"is-buffer\": \"^1.1.5\"\n                  }\n                }\n              }\n            },\n            \"is-descriptor\": {\n              \"version\": \"0.1.6\",\n              \"resolved\": \"https://registry.npmmirror.com/is-descriptor/-/is-descriptor-0.1.6.tgz\",\n              \"integrity\": \"sha512-avDYr0SB3DwO9zsMov0gKCESFYqCnE4hq/4z3TdUlukEy5t9C0YRq7HLrsN52NAcqXKaepeCD0n+B0arnVG3Hg==\",\n              \"dev\": true,\n              \"optional\": true,\n              \"requires\": {\n                \"is-accessor-descriptor\": \"^0.1.6\",\n                \"is-data-descriptor\": \"^0.1.4\",\n                \"kind-of\": \"^5.0.0\"\n              }\n            },\n            \"kind-of\": {\n              \"version\": \"5.1.0\",\n              \"resolved\": \"https://registry.npmmirror.com/kind-of/-/kind-of-5.1.0.tgz\",\n              \"integrity\": \"sha512-NGEErnH6F2vUuXDh+OlbcKW7/wOcfdRHaZ7VWtqCztfHri/++YKmP51OdWeGPuqCOba6kk2OTe5d02VmTB80Pw==\",\n              \"dev\": true,\n              \"optional\": true\n            }\n          }\n        },\n        \"extglob\": {\n          \"version\": \"2.0.4\",\n          \"resolved\": \"https://registry.npmmirror.com/extglob/-/extglob-2.0.4.tgz\",\n          \"integrity\": \"sha512-Nmb6QXkELsuBr24CJSkilo6UHHgbekK5UiZgfE6UHD3Eb27YC6oD+bhcT+tJ6cl8dmsgdQxnWlcry8ksBIBLpw==\",\n          \"dev\": true,\n          \"optional\": true,\n          \"requires\": {\n            \"array-unique\": \"^0.3.2\",\n            \"define-property\": \"^1.0.0\",\n            \"expand-brackets\": \"^2.1.4\",\n            \"extend-shallow\": \"^2.0.1\",\n            \"fragment-cache\": \"^0.2.1\",\n            \"regex-not\": \"^1.0.0\",\n            \"snapdragon\": \"^0.8.1\",\n            \"to-regex\": \"^3.0.1\"\n          },\n          \"dependencies\": {\n            \"define-property\": {\n              \"version\": \"1.0.0\",\n              \"resolved\": \"https://registry.npmmirror.com/define-property/-/define-property-1.0.0.tgz\",\n              \"integrity\": \"sha512-cZTYKFWspt9jZsMscWo8sc/5lbPC9Q0N5nBLgb+Yd915iL3udB1uFgS3B8YCx66UVHq018DAVFoee7x+gxggeA==\",\n              \"dev\": true,\n              \"optional\": true,\n              \"requires\": {\n                \"is-descriptor\": \"^1.0.0\"\n              }\n            },\n            \"extend-shallow\": {\n              \"version\": \"2.0.1\",\n              \"resolved\": \"https://registry.npmmirror.com/extend-shallow/-/extend-shallow-2.0.1.tgz\",\n              \"integrity\": \"sha512-zCnTtlxNoAiDc3gqY2aYAWFx7XWWiasuF2K8Me5WbN8otHKTUKBwjPtNpRs/rbUZm7KxWAaNj7P1a/p52GbVug==\",\n              \"dev\": true,\n              \"optional\": true,\n              \"requires\": {\n                \"is-extendable\": \"^0.1.0\"\n              }\n            }\n          }\n        },\n        \"fill-range\": {\n          \"version\": \"4.0.0\",\n          \"resolved\": \"https://registry.npmmirror.com/fill-range/-/fill-range-4.0.0.tgz\",\n          \"integrity\": \"sha512-VcpLTWqWDiTerugjj8e3+esbg+skS3M9e54UuR3iCeIDMXCLTsAH8hTSzDQU/X6/6t3eYkOKoZSef2PlU6U1XQ==\",\n          \"dev\": true,\n          \"optional\": true,\n          \"requires\": {\n            \"extend-shallow\": \"^2.0.1\",\n            \"is-number\": \"^3.0.0\",\n            \"repeat-string\": \"^1.6.1\",\n            \"to-regex-range\": \"^2.1.0\"\n          },\n          \"dependencies\": {\n            \"extend-shallow\": {\n              \"version\": \"2.0.1\",\n              \"resolved\": \"https://registry.npmmirror.com/extend-shallow/-/extend-shallow-2.0.1.tgz\",\n              \"integrity\": \"sha512-zCnTtlxNoAiDc3gqY2aYAWFx7XWWiasuF2K8Me5WbN8otHKTUKBwjPtNpRs/rbUZm7KxWAaNj7P1a/p52GbVug==\",\n              \"dev\": true,\n              \"optional\": true,\n              \"requires\": {\n                \"is-extendable\": \"^0.1.0\"\n              }\n            }\n          }\n        },\n        \"is-accessor-descriptor\": {\n          \"version\": \"1.0.0\",\n          \"resolved\": \"https://registry.npmmirror.com/is-accessor-descriptor/-/is-accessor-descriptor-1.0.0.tgz\",\n          \"integrity\": \"sha512-m5hnHTkcVsPfqx3AKlyttIPb7J+XykHvJP2B9bZDjlhLIoEq4XoK64Vg7boZlVWYK6LUY94dYPEE7Lh0ZkZKcQ==\",\n          \"dev\": true,\n          \"optional\": true,\n          \"requires\": {\n            \"kind-of\": \"^6.0.0\"\n          }\n        },\n        \"is-data-descriptor\": {\n          \"version\": \"1.0.0\",\n          \"resolved\": \"https://registry.npmmirror.com/is-data-descriptor/-/is-data-descriptor-1.0.0.tgz\",\n          \"integrity\": \"sha512-jbRXy1FmtAoCjQkVmIVYwuuqDFUbaOeDjmed1tOGPrsMhtJA4rD9tkgA0F1qJ3gRFRXcHYVkdeaP50Q5rE/jLQ==\",\n          \"dev\": true,\n          \"optional\": true,\n          \"requires\": {\n            \"kind-of\": \"^6.0.0\"\n          }\n        },\n        \"is-descriptor\": {\n          \"version\": \"1.0.2\",\n          \"resolved\": \"https://registry.npmmirror.com/is-descriptor/-/is-descriptor-1.0.2.tgz\",\n          \"integrity\": \"sha512-2eis5WqQGV7peooDyLmNEPUrps9+SXX5c9pL3xEB+4e9HnGuDa7mB7kHxHw4CbqS9k1T2hOH3miL8n8WtiYVtg==\",\n          \"dev\": true,\n          \"optional\": true,\n          \"requires\": {\n            \"is-accessor-descriptor\": \"^1.0.0\",\n            \"is-data-descriptor\": \"^1.0.0\",\n            \"kind-of\": \"^6.0.2\"\n          }\n        },\n        \"is-number\": {\n          \"version\": \"3.0.0\",\n          \"resolved\": \"https://registry.npmmirror.com/is-number/-/is-number-3.0.0.tgz\",\n          \"integrity\": \"sha512-4cboCqIpliH+mAvFNegjZQ4kgKc3ZUhQVr3HvWbSh5q3WH2v82ct+T2Y1hdU5Gdtorx/cLifQjqCbL7bpznLTg==\",\n          \"dev\": true,\n          \"optional\": true,\n          \"requires\": {\n            \"kind-of\": \"^3.0.2\"\n          },\n          \"dependencies\": {\n            \"kind-of\": {\n              \"version\": \"3.2.2\",\n              \"resolved\": \"https://registry.npmmirror.com/kind-of/-/kind-of-3.2.2.tgz\",\n              \"integrity\": \"sha512-NOW9QQXMoZGg/oqnVNoNTTIFEIid1627WCffUBJEdMxYApq7mNE7CpzucIPc+ZQg25Phej7IJSmX3hO+oblOtQ==\",\n              \"dev\": true,\n              \"optional\": true,\n              \"requires\": {\n                \"is-buffer\": \"^1.1.5\"\n              }\n            }\n          }\n        },\n        \"isobject\": {\n          \"version\": \"3.0.1\",\n          \"resolved\": \"https://registry.npmmirror.com/isobject/-/isobject-3.0.1.tgz\",\n          \"integrity\": \"sha512-WhB9zCku7EGTj/HQQRz5aUQEUeoQZH2bWcltRErOpymJ4boYE6wL9Tbr23krRPSZ+C5zqNSrSw+Cc7sZZ4b7vg==\",\n          \"dev\": true,\n          \"optional\": true\n        },\n        \"kind-of\": {\n          \"version\": \"6.0.3\",\n          \"resolved\": \"https://registry.npmmirror.com/kind-of/-/kind-of-6.0.3.tgz\",\n          \"integrity\": \"sha512-dcS1ul+9tmeD95T+x28/ehLgd9mENa3LsvDTtzm3vyBEO7RPptvAD+t44WVXaUjTBRcrpFeFlC8WCruUR456hw==\",\n          \"dev\": true,\n          \"optional\": true\n        },\n        \"micromatch\": {\n          \"version\": \"3.1.10\",\n          \"resolved\": \"https://registry.npmmirror.com/micromatch/-/micromatch-3.1.10.tgz\",\n          \"integrity\": \"sha512-MWikgl9n9M3w+bpsY3He8L+w9eF9338xRl8IAO5viDizwSzziFEyUzo2xrrloB64ADbTf8uA8vRqqttDTOmccg==\",\n          \"dev\": true,\n          \"optional\": true,\n          \"requires\": {\n            \"arr-diff\": \"^4.0.0\",\n            \"array-unique\": \"^0.3.2\",\n            \"braces\": \"^2.3.1\",\n            \"define-property\": \"^2.0.2\",\n            \"extend-shallow\": \"^3.0.2\",\n            \"extglob\": \"^2.0.4\",\n            \"fragment-cache\": \"^0.2.1\",\n            \"kind-of\": \"^6.0.2\",\n            \"nanomatch\": \"^1.2.9\",\n            \"object.pick\": \"^1.3.0\",\n            \"regex-not\": \"^1.0.0\",\n            \"snapdragon\": \"^0.8.1\",\n            \"to-regex\": \"^3.0.2\"\n          }\n        }\n      }\n    },\n    \"regenerate\": {\n      \"version\": \"1.4.2\",\n      \"resolved\": \"https://registry.npmmirror.com/regenerate/-/regenerate-1.4.2.tgz\",\n      \"integrity\": \"sha512-zrceR/XhGYU/d/opr2EKO7aRHUeiBI8qjtfHqADTwZd6Szfy16la6kqD0MIUs5z5hx6AaKa+PixpPrR289+I0A==\",\n      \"dev\": true\n    },\n    \"regenerator-runtime\": {\n      \"version\": \"0.11.1\",\n      \"resolved\": \"https://registry.npmmirror.com/regenerator-runtime/-/regenerator-runtime-0.11.1.tgz\",\n      \"integrity\": \"sha512-MguG95oij0fC3QV3URf4V2SDYGJhJnJGqvIIgdECeODCT98wSWDAJ94SSuVpYQUoTcGUIL6L4yNB7j1DFFHSBg==\",\n      \"dev\": true\n    },\n    \"regenerator-transform\": {\n      \"version\": \"0.10.1\",\n      \"resolved\": \"https://registry.npmmirror.com/regenerator-transform/-/regenerator-transform-0.10.1.tgz\",\n      \"integrity\": \"sha512-PJepbvDbuK1xgIgnau7Y90cwaAmO/LCLMI2mPvaXq2heGMR3aWW5/BQvYrhJ8jgmQjXewXvBjzfqKcVOmhjZ6Q==\",\n      \"dev\": true,\n      \"requires\": {\n        \"babel-runtime\": \"^6.18.0\",\n        \"babel-types\": \"^6.19.0\",\n        \"private\": \"^0.1.6\"\n      }\n    },\n    \"regex-cache\": {\n      \"version\": \"0.4.4\",\n      \"resolved\": \"https://registry.npmmirror.com/regex-cache/-/regex-cache-0.4.4.tgz\",\n      \"integrity\": \"sha512-nVIZwtCjkC9YgvWkpM55B5rBhBYRZhAaJbgcFYXXsHnbZ9UZI9nnVWYZpBlCqv9ho2eZryPnWrZGsOdPwVWXWQ==\",\n      \"dev\": true,\n      \"optional\": true,\n      \"requires\": {\n        \"is-equal-shallow\": \"^0.1.3\"\n      }\n    },\n    \"regex-not\": {\n      \"version\": \"1.0.2\",\n      \"resolved\": \"https://registry.npmmirror.com/regex-not/-/regex-not-1.0.2.tgz\",\n      \"integrity\": \"sha512-J6SDjUgDxQj5NusnOtdFxDwN/+HWykR8GELwctJ7mdqhcyy1xEc4SRFHUXvxTp661YaVKAjfRLZ9cCqS6tn32A==\",\n      \"dev\": true,\n      \"optional\": true,\n      \"requires\": {\n        \"extend-shallow\": \"^3.0.2\",\n        \"safe-regex\": \"^1.1.0\"\n      }\n    },\n    \"regexpu-core\": {\n      \"version\": \"2.0.0\",\n      \"resolved\": \"https://registry.npmmirror.com/regexpu-core/-/regexpu-core-2.0.0.tgz\",\n      \"integrity\": \"sha512-tJ9+S4oKjxY8IZ9jmjnp/mtytu1u3iyIQAfmI51IKWH6bFf7XR1ybtaO6j7INhZKXOTYADk7V5qxaqLkmNxiZQ==\",\n      \"dev\": true,\n      \"requires\": {\n        \"regenerate\": \"^1.2.1\",\n        \"regjsgen\": \"^0.2.0\",\n        \"regjsparser\": \"^0.1.4\"\n      }\n    },\n    \"regjsgen\": {\n      \"version\": \"0.2.0\",\n      \"resolved\": \"https://registry.npmmirror.com/regjsgen/-/regjsgen-0.2.0.tgz\",\n      \"integrity\": \"sha512-x+Y3yA24uF68m5GA+tBjbGYo64xXVJpbToBaWCoSNSc1hdk6dfctaRWrNFTVJZIIhL5GxW8zwjoixbnifnK59g==\",\n      \"dev\": true\n    },\n    \"regjsparser\": {\n      \"version\": \"0.1.5\",\n      \"resolved\": \"https://registry.npmmirror.com/regjsparser/-/regjsparser-0.1.5.tgz\",\n      \"integrity\": \"sha512-jlQ9gYLfk2p3V5Ag5fYhA7fv7OHzd1KUH0PRP46xc3TgwjwgROIW572AfYg/X9kaNq/LJnu6oJcFRXlIrGoTRw==\",\n      \"dev\": true,\n      \"requires\": {\n        \"jsesc\": \"~0.5.0\"\n      },\n      \"dependencies\": {\n        \"jsesc\": {\n          \"version\": \"0.5.0\",\n          \"resolved\": \"https://registry.npmmirror.com/jsesc/-/jsesc-0.5.0.tgz\",\n          \"integrity\": \"sha512-uZz5UnB7u4T9LvwmFqXii7pZSouaRPorGs5who1Ip7VO0wxanFvBL7GkM6dTHlgX+jhBApRetaWpnDabOeTcnA==\",\n          \"dev\": true\n        }\n      }\n    },\n    \"remove-trailing-separator\": {\n      \"version\": \"1.1.0\",\n      \"resolved\": \"https://registry.npmmirror.com/remove-trailing-separator/-/remove-trailing-separator-1.1.0.tgz\",\n      \"integrity\": \"sha512-/hS+Y0u3aOfIETiaiirUFwDBDzmXPvO+jAfKTitUngIPzdKc6Z0LoFjM/CK5PL4C+eKwHohlHAb6H0VFfmmUsw==\",\n      \"dev\": true,\n      \"optional\": true\n    },\n    \"repeat-element\": {\n      \"version\": \"1.1.4\",\n      \"resolved\": \"https://registry.npmmirror.com/repeat-element/-/repeat-element-1.1.4.tgz\",\n      \"integrity\": \"sha512-LFiNfRcSu7KK3evMyYOuCzv3L10TW7yC1G2/+StMjK8Y6Vqd2MG7r/Qjw4ghtuCOjFvlnms/iMmLqpvW/ES/WQ==\",\n      \"dev\": true,\n      \"optional\": true\n    },\n    \"repeat-string\": {\n      \"version\": \"1.6.1\",\n      \"resolved\": \"https://registry.npmmirror.com/repeat-string/-/repeat-string-1.6.1.tgz\",\n      \"integrity\": \"sha512-PV0dzCYDNfRi1jCDbJzpW7jNNDRuCOG/jI5ctQcGKt/clZD+YcPS3yIlWuTJMmESC8aevCFmWJy5wjAFgNqN6w==\",\n      \"dev\": true,\n      \"optional\": true\n    },\n    \"repeating\": {\n      \"version\": \"2.0.1\",\n      \"resolved\": \"https://registry.npmmirror.com/repeating/-/repeating-2.0.1.tgz\",\n      \"integrity\": \"sha512-ZqtSMuVybkISo2OWvqvm7iHSWngvdaW3IpsT9/uP8v4gMi591LY6h35wdOfvQdWCKFWZWm2Y1Opp4kV7vQKT6A==\",\n      \"dev\": true,\n      \"requires\": {\n        \"is-finite\": \"^1.0.0\"\n      }\n    },\n    \"resolve-url\": {\n      \"version\": \"0.2.1\",\n      \"resolved\": \"https://registry.npmmirror.com/resolve-url/-/resolve-url-0.2.1.tgz\",\n      \"integrity\": \"sha512-ZuF55hVUQaaczgOIwqWzkEcEidmlD/xl44x1UZnhOXcYuFN2S6+rcxpG+C1N3So0wvNI3DmJICUFfu2SxhBmvg==\",\n      \"dev\": true,\n      \"optional\": true\n    },\n    \"ret\": {\n      \"version\": \"0.1.15\",\n      \"resolved\": \"https://registry.npmmirror.com/ret/-/ret-0.1.15.tgz\",\n      \"integrity\": \"sha512-TTlYpa+OL+vMMNG24xSlQGEJ3B/RzEfUlLct7b5G/ytav+wPrplCpVMFuwzXbkecJrb6IYo1iFb0S9v37754mg==\",\n      \"dev\": true,\n      \"optional\": true\n    },\n    \"safe-buffer\": {\n      \"version\": \"5.1.2\",\n      \"resolved\": \"https://registry.npmmirror.com/safe-buffer/-/safe-buffer-5.1.2.tgz\",\n      \"integrity\": \"sha512-Gd2UZBJDkXlY7GbJxfsE8/nvKkUEU1G38c1siN6QP6a9PT9MmHB8GnpscSmMJSoF8LOIrt8ud/wPtojys4G6+g==\",\n      \"dev\": true,\n      \"optional\": true\n    },\n    \"safe-regex\": {\n      \"version\": \"1.1.0\",\n      \"resolved\": \"https://registry.npmmirror.com/safe-regex/-/safe-regex-1.1.0.tgz\",\n      \"integrity\": \"sha512-aJXcif4xnaNUzvUuC5gcb46oTS7zvg4jpMTnuqtrEPlR3vFr4pxtdTwaF1Qs3Enjn9HK+ZlwQui+a7z0SywIzg==\",\n      \"dev\": true,\n      \"optional\": true,\n      \"requires\": {\n        \"ret\": \"~0.1.10\"\n      }\n    },\n    \"semver\": {\n      \"version\": \"5.7.1\",\n      \"resolved\": \"https://registry.npmmirror.com/semver/-/semver-5.7.1.tgz\",\n      \"integrity\": \"sha512-sauaDf/PZdVgrLTNYHRtpXa1iRiKcaebiKQ1BJdpQlWH2lCvexQdX55snPFyK7QzpudqbCI0qXFfOasHdyNDGQ==\",\n      \"dev\": true\n    },\n    \"set-value\": {\n      \"version\": \"2.0.1\",\n      \"resolved\": \"https://registry.npmmirror.com/set-value/-/set-value-2.0.1.tgz\",\n      \"integrity\": \"sha512-JxHc1weCN68wRY0fhCoXpyK55m/XPHafOmK4UWD7m2CI14GMcFypt4w/0+NV5f/ZMby2F6S2wwA7fgynh9gWSw==\",\n      \"dev\": true,\n      \"optional\": true,\n      \"requires\": {\n        \"extend-shallow\": \"^2.0.1\",\n        \"is-extendable\": \"^0.1.1\",\n        \"is-plain-object\": \"^2.0.3\",\n        \"split-string\": \"^3.0.1\"\n      },\n      \"dependencies\": {\n        \"extend-shallow\": {\n          \"version\": \"2.0.1\",\n          \"resolved\": \"https://registry.npmmirror.com/extend-shallow/-/extend-shallow-2.0.1.tgz\",\n          \"integrity\": \"sha512-zCnTtlxNoAiDc3gqY2aYAWFx7XWWiasuF2K8Me5WbN8otHKTUKBwjPtNpRs/rbUZm7KxWAaNj7P1a/p52GbVug==\",\n          \"dev\": true,\n          \"optional\": true,\n          \"requires\": {\n            \"is-extendable\": \"^0.1.0\"\n          }\n        }\n      }\n    },\n    \"slash\": {\n      \"version\": \"1.0.0\",\n      \"resolved\": \"https://registry.npmmirror.com/slash/-/slash-1.0.0.tgz\",\n      \"integrity\": \"sha512-3TYDR7xWt4dIqV2JauJr+EJeW356RXijHeUlO+8djJ+uBXPn8/2dpzBc8yQhh583sVvc9CvFAeQVgijsH+PNNg==\",\n      \"dev\": true\n    },\n    \"snapdragon\": {\n      \"version\": \"0.8.2\",\n      \"resolved\": \"https://registry.npmmirror.com/snapdragon/-/snapdragon-0.8.2.tgz\",\n      \"integrity\": \"sha512-FtyOnWN/wCHTVXOMwvSv26d+ko5vWlIDD6zoUJ7LW8vh+ZBC8QdljveRP+crNrtBwioEUWy/4dMtbBjA4ioNlg==\",\n      \"dev\": true,\n      \"optional\": true,\n      \"requires\": {\n        \"base\": \"^0.11.1\",\n        \"debug\": \"^2.2.0\",\n        \"define-property\": \"^0.2.5\",\n        \"extend-shallow\": \"^2.0.1\",\n        \"map-cache\": \"^0.2.2\",\n        \"source-map\": \"^0.5.6\",\n        \"source-map-resolve\": \"^0.5.0\",\n        \"use\": \"^3.1.0\"\n      },\n      \"dependencies\": {\n        \"define-property\": {\n          \"version\": \"0.2.5\",\n          \"resolved\": \"https://registry.npmmirror.com/define-property/-/define-property-0.2.5.tgz\",\n          \"integrity\": \"sha512-Rr7ADjQZenceVOAKop6ALkkRAmH1A4Gx9hV/7ZujPUN2rkATqFO0JZLZInbAjpZYoJ1gUx8MRMQVkYemcbMSTA==\",\n          \"dev\": true,\n          \"optional\": true,\n          \"requires\": {\n            \"is-descriptor\": \"^0.1.0\"\n          }\n        },\n        \"extend-shallow\": {\n          \"version\": \"2.0.1\",\n          \"resolved\": \"https://registry.npmmirror.com/extend-shallow/-/extend-shallow-2.0.1.tgz\",\n          \"integrity\": \"sha512-zCnTtlxNoAiDc3gqY2aYAWFx7XWWiasuF2K8Me5WbN8otHKTUKBwjPtNpRs/rbUZm7KxWAaNj7P1a/p52GbVug==\",\n          \"dev\": true,\n          \"optional\": true,\n          \"requires\": {\n            \"is-extendable\": \"^0.1.0\"\n          }\n        }\n      }\n    },\n    \"snapdragon-node\": {\n      \"version\": \"2.1.1\",\n      \"resolved\": \"https://registry.npmmirror.com/snapdragon-node/-/snapdragon-node-2.1.1.tgz\",\n      \"integrity\": \"sha512-O27l4xaMYt/RSQ5TR3vpWCAB5Kb/czIcqUFOM/C4fYcLnbZUc1PkjTAMjof2pBWaSTwOUd6qUHcFGVGj7aIwnw==\",\n      \"dev\": true,\n      \"optional\": true,\n      \"requires\": {\n        \"define-property\": \"^1.0.0\",\n        \"isobject\": \"^3.0.0\",\n        \"snapdragon-util\": \"^3.0.1\"\n      },\n      \"dependencies\": {\n        \"define-property\": {\n          \"version\": \"1.0.0\",\n          \"resolved\": \"https://registry.npmmirror.com/define-property/-/define-property-1.0.0.tgz\",\n          \"integrity\": \"sha512-cZTYKFWspt9jZsMscWo8sc/5lbPC9Q0N5nBLgb+Yd915iL3udB1uFgS3B8YCx66UVHq018DAVFoee7x+gxggeA==\",\n          \"dev\": true,\n          \"optional\": true,\n          \"requires\": {\n            \"is-descriptor\": \"^1.0.0\"\n          }\n        },\n        \"is-accessor-descriptor\": {\n          \"version\": \"1.0.0\",\n          \"resolved\": \"https://registry.npmmirror.com/is-accessor-descriptor/-/is-accessor-descriptor-1.0.0.tgz\",\n          \"integrity\": \"sha512-m5hnHTkcVsPfqx3AKlyttIPb7J+XykHvJP2B9bZDjlhLIoEq4XoK64Vg7boZlVWYK6LUY94dYPEE7Lh0ZkZKcQ==\",\n          \"dev\": true,\n          \"optional\": true,\n          \"requires\": {\n            \"kind-of\": \"^6.0.0\"\n          }\n        },\n        \"is-data-descriptor\": {\n          \"version\": \"1.0.0\",\n          \"resolved\": \"https://registry.npmmirror.com/is-data-descriptor/-/is-data-descriptor-1.0.0.tgz\",\n          \"integrity\": \"sha512-jbRXy1FmtAoCjQkVmIVYwuuqDFUbaOeDjmed1tOGPrsMhtJA4rD9tkgA0F1qJ3gRFRXcHYVkdeaP50Q5rE/jLQ==\",\n          \"dev\": true,\n          \"optional\": true,\n          \"requires\": {\n            \"kind-of\": \"^6.0.0\"\n          }\n        },\n        \"is-descriptor\": {\n          \"version\": \"1.0.2\",\n          \"resolved\": \"https://registry.npmmirror.com/is-descriptor/-/is-descriptor-1.0.2.tgz\",\n          \"integrity\": \"sha512-2eis5WqQGV7peooDyLmNEPUrps9+SXX5c9pL3xEB+4e9HnGuDa7mB7kHxHw4CbqS9k1T2hOH3miL8n8WtiYVtg==\",\n          \"dev\": true,\n          \"optional\": true,\n          \"requires\": {\n            \"is-accessor-descriptor\": \"^1.0.0\",\n            \"is-data-descriptor\": \"^1.0.0\",\n            \"kind-of\": \"^6.0.2\"\n          }\n        },\n        \"isobject\": {\n          \"version\": \"3.0.1\",\n          \"resolved\": \"https://registry.npmmirror.com/isobject/-/isobject-3.0.1.tgz\",\n          \"integrity\": \"sha512-WhB9zCku7EGTj/HQQRz5aUQEUeoQZH2bWcltRErOpymJ4boYE6wL9Tbr23krRPSZ+C5zqNSrSw+Cc7sZZ4b7vg==\",\n          \"dev\": true,\n          \"optional\": true\n        },\n        \"kind-of\": {\n          \"version\": \"6.0.3\",\n          \"resolved\": \"https://registry.npmmirror.com/kind-of/-/kind-of-6.0.3.tgz\",\n          \"integrity\": \"sha512-dcS1ul+9tmeD95T+x28/ehLgd9mENa3LsvDTtzm3vyBEO7RPptvAD+t44WVXaUjTBRcrpFeFlC8WCruUR456hw==\",\n          \"dev\": true,\n          \"optional\": true\n        }\n      }\n    },\n    \"snapdragon-util\": {\n      \"version\": \"3.0.1\",\n      \"resolved\": \"https://registry.npmmirror.com/snapdragon-util/-/snapdragon-util-3.0.1.tgz\",\n      \"integrity\": \"sha512-mbKkMdQKsjX4BAL4bRYTj21edOf8cN7XHdYUJEe+Zn99hVEYcMvKPct1IqNe7+AZPirn8BCDOQBHQZknqmKlZQ==\",\n      \"dev\": true,\n      \"optional\": true,\n      \"requires\": {\n        \"kind-of\": \"^3.2.0\"\n      }\n    },\n    \"source-map\": {\n      \"version\": \"0.5.7\",\n      \"resolved\": \"https://registry.npmmirror.com/source-map/-/source-map-0.5.7.tgz\",\n      \"integrity\": \"sha512-LbrmJOMUSdEVxIKvdcJzQC+nQhe8FUZQTXQy6+I75skNgn3OoQ0DZA8YnFa7gp8tqtL3KPf1kmo0R5DoApeSGQ==\",\n      \"dev\": true\n    },\n    \"source-map-resolve\": {\n      \"version\": \"0.5.3\",\n      \"resolved\": \"https://registry.npmmirror.com/source-map-resolve/-/source-map-resolve-0.5.3.tgz\",\n      \"integrity\": \"sha512-Htz+RnsXWk5+P2slx5Jh3Q66vhQj1Cllm0zvnaY98+NFx+Dv2CF/f5O/t8x+KaNdrdIAsruNzoh/KpialbqAnw==\",\n      \"dev\": true,\n      \"optional\": true,\n      \"requires\": {\n        \"atob\": \"^2.1.2\",\n        \"decode-uri-component\": \"^0.2.0\",\n        \"resolve-url\": \"^0.2.1\",\n        \"source-map-url\": \"^0.4.0\",\n        \"urix\": \"^0.1.0\"\n      }\n    },\n    \"source-map-support\": {\n      \"version\": \"0.4.18\",\n      \"resolved\": \"https://registry.npmmirror.com/source-map-support/-/source-map-support-0.4.18.tgz\",\n      \"integrity\": \"sha512-try0/JqxPLF9nOjvSta7tVondkP5dwgyLDjVoyMDlmjugT2lRZ1OfsrYTkCd2hkDnJTKRbO/Rl3orm8vlsUzbA==\",\n      \"dev\": true,\n      \"requires\": {\n        \"source-map\": \"^0.5.6\"\n      }\n    },\n    \"source-map-url\": {\n      \"version\": \"0.4.1\",\n      \"resolved\": \"https://registry.npmmirror.com/source-map-url/-/source-map-url-0.4.1.tgz\",\n      \"integrity\": \"sha512-cPiFOTLUKvJFIg4SKVScy4ilPPW6rFgMgfuZJPNoDuMs3nC1HbMUycBoJw77xFIp6z1UJQJOfx6C9GMH80DiTw==\",\n      \"dev\": true,\n      \"optional\": true\n    },\n    \"split-string\": {\n      \"version\": \"3.1.0\",\n      \"resolved\": \"https://registry.npmmirror.com/split-string/-/split-string-3.1.0.tgz\",\n      \"integrity\": \"sha512-NzNVhJDYpwceVVii8/Hu6DKfD2G+NrQHlS/V/qgv763EYudVwEcMQNxd2lh+0VrUByXN/oJkl5grOhYWvQUYiw==\",\n      \"dev\": true,\n      \"optional\": true,\n      \"requires\": {\n        \"extend-shallow\": \"^3.0.0\"\n      }\n    },\n    \"static-extend\": {\n      \"version\": \"0.1.2\",\n      \"resolved\": \"https://registry.npmmirror.com/static-extend/-/static-extend-0.1.2.tgz\",\n      \"integrity\": \"sha512-72E9+uLc27Mt718pMHt9VMNiAL4LMsmDbBva8mxWUCkT07fSzEGMYUCk0XWY6lp0j6RBAG4cJ3mWuZv2OE3s0g==\",\n      \"dev\": true,\n      \"optional\": true,\n      \"requires\": {\n        \"define-property\": \"^0.2.5\",\n        \"object-copy\": \"^0.1.0\"\n      },\n      \"dependencies\": {\n        \"define-property\": {\n          \"version\": \"0.2.5\",\n          \"resolved\": \"https://registry.npmmirror.com/define-property/-/define-property-0.2.5.tgz\",\n          \"integrity\": \"sha512-Rr7ADjQZenceVOAKop6ALkkRAmH1A4Gx9hV/7ZujPUN2rkATqFO0JZLZInbAjpZYoJ1gUx8MRMQVkYemcbMSTA==\",\n          \"dev\": true,\n          \"optional\": true,\n          \"requires\": {\n            \"is-descriptor\": \"^0.1.0\"\n          }\n        }\n      }\n    },\n    \"string_decoder\": {\n      \"version\": \"1.1.1\",\n      \"resolved\": \"https://registry.npmmirror.com/string_decoder/-/string_decoder-1.1.1.tgz\",\n      \"integrity\": \"sha512-n/ShnvDi6FHbbVfviro+WojiFzv+s8MPMHBczVePfUpDJLwoLT0ht1l4YwBCbi8pJAveEEdnkHyPyTP/mzRfwg==\",\n      \"dev\": true,\n      \"optional\": true,\n      \"requires\": {\n        \"safe-buffer\": \"~5.1.0\"\n      }\n    },\n    \"strip-ansi\": {\n      \"version\": \"3.0.1\",\n      \"resolved\": \"https://registry.npmmirror.com/strip-ansi/-/strip-ansi-3.0.1.tgz\",\n      \"integrity\": \"sha512-VhumSSbBqDTP8p2ZLKj40UjBCV4+v8bUSEpUb4KjRgWk9pbqGF4REFj6KEagidb2f/M6AzC0EmFyDNGaw9OCzg==\",\n      \"dev\": true,\n      \"requires\": {\n        \"ansi-regex\": \"^2.0.0\"\n      }\n    },\n    \"supports-color\": {\n      \"version\": \"2.0.0\",\n      \"resolved\": \"https://registry.npmmirror.com/supports-color/-/supports-color-2.0.0.tgz\",\n      \"integrity\": \"sha512-KKNVtd6pCYgPIKU4cp2733HWYCpplQhddZLBUryaAHou723x+FRzQ5Df824Fj+IyyuiQTRoub4SnIFfIcrp70g==\",\n      \"dev\": true\n    },\n    \"to-fast-properties\": {\n      \"version\": \"1.0.3\",\n      \"resolved\": \"https://registry.npmmirror.com/to-fast-properties/-/to-fast-properties-1.0.3.tgz\",\n      \"integrity\": \"sha512-lxrWP8ejsq+7E3nNjwYmUBMAgjMTZoTI+sdBOpvNyijeDLa29LUn9QaoXAHv4+Z578hbmHHJKZknzxVtvo77og==\",\n      \"dev\": true\n    },\n    \"to-object-path\": {\n      \"version\": \"0.3.0\",\n      \"resolved\": \"https://registry.npmmirror.com/to-object-path/-/to-object-path-0.3.0.tgz\",\n      \"integrity\": \"sha512-9mWHdnGRuh3onocaHzukyvCZhzvr6tiflAy/JRFXcJX0TjgfWA9pk9t8CMbzmBE4Jfw58pXbkngtBtqYxzNEyg==\",\n      \"dev\": true,\n      \"optional\": true,\n      \"requires\": {\n        \"kind-of\": \"^3.0.2\"\n      }\n    },\n    \"to-regex\": {\n      \"version\": \"3.0.2\",\n      \"resolved\": \"https://registry.npmmirror.com/to-regex/-/to-regex-3.0.2.tgz\",\n      \"integrity\": \"sha512-FWtleNAtZ/Ki2qtqej2CXTOayOH9bHDQF+Q48VpWyDXjbYxA4Yz8iDB31zXOBUlOHHKidDbqGVrTUvQMPmBGBw==\",\n      \"dev\": true,\n      \"optional\": true,\n      \"requires\": {\n        \"define-property\": \"^2.0.2\",\n        \"extend-shallow\": \"^3.0.2\",\n        \"regex-not\": \"^1.0.2\",\n        \"safe-regex\": \"^1.1.0\"\n      }\n    },\n    \"to-regex-range\": {\n      \"version\": \"2.1.1\",\n      \"resolved\": \"https://registry.npmmirror.com/to-regex-range/-/to-regex-range-2.1.1.tgz\",\n      \"integrity\": \"sha512-ZZWNfCjUokXXDGXFpZehJIkZqq91BcULFq/Pi7M5i4JnxXdhMKAK682z8bCW3o8Hj1wuuzoKcW3DfVzaP6VuNg==\",\n      \"dev\": true,\n      \"optional\": true,\n      \"requires\": {\n        \"is-number\": \"^3.0.0\",\n        \"repeat-string\": \"^1.6.1\"\n      },\n      \"dependencies\": {\n        \"is-number\": {\n          \"version\": \"3.0.0\",\n          \"resolved\": \"https://registry.npmmirror.com/is-number/-/is-number-3.0.0.tgz\",\n          \"integrity\": \"sha512-4cboCqIpliH+mAvFNegjZQ4kgKc3ZUhQVr3HvWbSh5q3WH2v82ct+T2Y1hdU5Gdtorx/cLifQjqCbL7bpznLTg==\",\n          \"dev\": true,\n          \"optional\": true,\n          \"requires\": {\n            \"kind-of\": \"^3.0.2\"\n          }\n        }\n      }\n    },\n    \"trim-right\": {\n      \"version\": \"1.0.1\",\n      \"resolved\": \"https://registry.npmmirror.com/trim-right/-/trim-right-1.0.1.tgz\",\n      \"integrity\": \"sha512-WZGXGstmCWgeevgTL54hrCuw1dyMQIzWy7ZfqRJfSmJZBwklI15egmQytFP6bPidmw3M8d5yEowl1niq4vmqZw==\",\n      \"dev\": true\n    },\n    \"union-value\": {\n      \"version\": \"1.0.1\",\n      \"resolved\": \"https://registry.npmmirror.com/union-value/-/union-value-1.0.1.tgz\",\n      \"integrity\": \"sha512-tJfXmxMeWYnczCVs7XAEvIV7ieppALdyepWMkHkwciRpZraG/xwT+s2JN8+pr1+8jCRf80FFzvr+MpQeeoF4Xg==\",\n      \"dev\": true,\n      \"optional\": true,\n      \"requires\": {\n        \"arr-union\": \"^3.1.0\",\n        \"get-value\": \"^2.0.6\",\n        \"is-extendable\": \"^0.1.1\",\n        \"set-value\": \"^2.0.1\"\n      }\n    },\n    \"unset-value\": {\n      \"version\": \"1.0.0\",\n      \"resolved\": \"https://registry.npmmirror.com/unset-value/-/unset-value-1.0.0.tgz\",\n      \"integrity\": \"sha512-PcA2tsuGSF9cnySLHTLSh2qrQiJ70mn+r+Glzxv2TWZblxsxCC52BDlZoPCsz7STd9pN7EZetkWZBAvk4cgZdQ==\",\n      \"dev\": true,\n      \"optional\": true,\n      \"requires\": {\n        \"has-value\": \"^0.3.1\",\n        \"isobject\": \"^3.0.0\"\n      },\n      \"dependencies\": {\n        \"has-value\": {\n          \"version\": \"0.3.1\",\n          \"resolved\": \"https://registry.npmmirror.com/has-value/-/has-value-0.3.1.tgz\",\n          \"integrity\": \"sha512-gpG936j8/MzaeID5Yif+577c17TxaDmhuyVgSwtnL/q8UUTySg8Mecb+8Cf1otgLoD7DDH75axp86ER7LFsf3Q==\",\n          \"dev\": true,\n          \"optional\": true,\n          \"requires\": {\n            \"get-value\": \"^2.0.3\",\n            \"has-values\": \"^0.1.4\",\n            \"isobject\": \"^2.0.0\"\n          },\n          \"dependencies\": {\n            \"isobject\": {\n              \"version\": \"2.1.0\",\n              \"resolved\": \"https://registry.npmmirror.com/isobject/-/isobject-2.1.0.tgz\",\n              \"integrity\": \"sha512-+OUdGJlgjOBZDfxnDjYYG6zp487z0JGNQq3cYQYg5f5hKR+syHMsaztzGeml/4kGG55CSpKSpWTY+jYGgsHLgA==\",\n              \"dev\": true,\n              \"optional\": true,\n              \"requires\": {\n                \"isarray\": \"1.0.0\"\n              }\n            }\n          }\n        },\n        \"has-values\": {\n          \"version\": \"0.1.4\",\n          \"resolved\": \"https://registry.npmmirror.com/has-values/-/has-values-0.1.4.tgz\",\n          \"integrity\": \"sha512-J8S0cEdWuQbqD9//tlZxiMuMNmxB8PlEwvYwuxsTmR1G5RXUePEX/SJn7aD0GMLieuZYSwNH0cQuJGwnYunXRQ==\",\n          \"dev\": true,\n          \"optional\": true\n        },\n        \"isobject\": {\n          \"version\": \"3.0.1\",\n          \"resolved\": \"https://registry.npmmirror.com/isobject/-/isobject-3.0.1.tgz\",\n          \"integrity\": \"sha512-WhB9zCku7EGTj/HQQRz5aUQEUeoQZH2bWcltRErOpymJ4boYE6wL9Tbr23krRPSZ+C5zqNSrSw+Cc7sZZ4b7vg==\",\n          \"dev\": true,\n          \"optional\": true\n        }\n      }\n    },\n    \"urix\": {\n      \"version\": \"0.1.0\",\n      \"resolved\": \"https://registry.npmmirror.com/urix/-/urix-0.1.0.tgz\",\n      \"integrity\": \"sha512-Am1ousAhSLBeB9cG/7k7r2R0zj50uDRlZHPGbazid5s9rlF1F/QKYObEKSIunSjIOkJZqwRRLpvewjEkM7pSqg==\",\n      \"dev\": true,\n      \"optional\": true\n    },\n    \"use\": {\n      \"version\": \"3.1.1\",\n      \"resolved\": \"https://registry.npmmirror.com/use/-/use-3.1.1.tgz\",\n      \"integrity\": \"sha512-cwESVXlO3url9YWlFW/TA9cshCEhtu7IKJ/p5soJ/gGpj7vbvFrAY/eIioQ6Dw23KjZhYgiIo8HOs1nQ2vr/oQ==\",\n      \"dev\": true,\n      \"optional\": true\n    },\n    \"user-home\": {\n      \"version\": \"1.1.1\",\n      \"resolved\": \"https://registry.npmmirror.com/user-home/-/user-home-1.1.1.tgz\",\n      \"integrity\": \"sha512-aggiKfEEubv3UwRNqTzLInZpAOmKzwdHqEBmW/hBA/mt99eg+b4VrX6i+IRLxU8+WJYfa33rGwRseg4eElUgsQ==\",\n      \"dev\": true\n    },\n    \"util-deprecate\": {\n      \"version\": \"1.0.2\",\n      \"resolved\": \"https://registry.npmmirror.com/util-deprecate/-/util-deprecate-1.0.2.tgz\",\n      \"integrity\": \"sha512-EPD5q1uXyFxJpCrLnCc1nHnq3gOa6DZBocAIiI2TaSCA7VCJ1UJDMagCzIkXNsUYfD1daK//LTEQ8xiIbrHtcw==\",\n      \"dev\": true,\n      \"optional\": true\n    },\n    \"v8flags\": {\n      \"version\": \"2.1.1\",\n      \"resolved\": \"https://registry.npmmirror.com/v8flags/-/v8flags-2.1.1.tgz\",\n      \"integrity\": \"sha512-SKfhk/LlaXzvtowJabLZwD4K6SGRYeoxA7KJeISlUMAB/NT4CBkZjMq3WceX2Ckm4llwqYVo8TICgsDYCBU2tA==\",\n      \"dev\": true,\n      \"requires\": {\n        \"user-home\": \"^1.1.1\"\n      }\n    },\n    \"wrappy\": {\n      \"version\": \"1.0.2\",\n      \"resolved\": \"https://registry.npmmirror.com/wrappy/-/wrappy-1.0.2.tgz\",\n      \"integrity\": \"sha512-l4Sp/DRseor9wL6EvV2+TuQn63dMkPjZ/sp9XkghTEbV9KlPS1xUsZ3u7/IQO4wxtcFB4bgpQPRcR3QCvezPcQ==\",\n      \"dev\": true\n    }\n  }\n}\n","source":"demo/2023面试准备/demo/module/package-lock.json","raw":"{\n  \"name\": \"module\",\n  \"version\": \"1.0.0\",\n  \"lockfileVersion\": 1,\n  \"requires\": true,\n  \"dependencies\": {\n    \"ansi-regex\": {\n      \"version\": \"2.1.1\",\n      \"resolved\": \"https://registry.npmmirror.com/ansi-regex/-/ansi-regex-2.1.1.tgz\",\n      \"integrity\": \"sha512-TIGnTpdo+E3+pCyAluZvtED5p5wCqLdezCyhPZzKPcxvFplEt4i+W7OONCKgeZFT3+y5NZZfOOS/Bdcanm1MYA==\",\n      \"dev\": true\n    },\n    \"ansi-styles\": {\n      \"version\": \"2.2.1\",\n      \"resolved\": \"https://registry.npmmirror.com/ansi-styles/-/ansi-styles-2.2.1.tgz\",\n      \"integrity\": \"sha512-kmCevFghRiWM7HB5zTPULl4r9bVFSWjz62MhqizDGUrq2NWuNMQyuv4tHHoKJHs69M/MF64lEcHdYIocrdWQYA==\",\n      \"dev\": true\n    },\n    \"anymatch\": {\n      \"version\": \"1.3.2\",\n      \"resolved\": \"https://registry.npmmirror.com/anymatch/-/anymatch-1.3.2.tgz\",\n      \"integrity\": \"sha512-0XNayC8lTHQ2OI8aljNCN3sSx6hsr/1+rlcDAotXJR7C1oZZHCNsfpbKwMjRA3Uqb5tF1Rae2oloTr4xpq+WjA==\",\n      \"dev\": true,\n      \"optional\": true,\n      \"requires\": {\n        \"micromatch\": \"^2.1.5\",\n        \"normalize-path\": \"^2.0.0\"\n      }\n    },\n    \"arr-diff\": {\n      \"version\": \"2.0.0\",\n      \"resolved\": \"https://registry.npmmirror.com/arr-diff/-/arr-diff-2.0.0.tgz\",\n      \"integrity\": \"sha512-dtXTVMkh6VkEEA7OhXnN1Ecb8aAGFdZ1LFxtOCoqj4qkyOJMt7+qs6Ahdy6p/NQCPYsRSXXivhSB/J5E9jmYKA==\",\n      \"dev\": true,\n      \"optional\": true,\n      \"requires\": {\n        \"arr-flatten\": \"^1.0.1\"\n      }\n    },\n    \"arr-flatten\": {\n      \"version\": \"1.1.0\",\n      \"resolved\": \"https://registry.npmmirror.com/arr-flatten/-/arr-flatten-1.1.0.tgz\",\n      \"integrity\": \"sha512-L3hKV5R/p5o81R7O02IGnwpDmkp6E982XhtbuwSe3O4qOtMMMtodicASA1Cny2U+aCXcNpml+m4dPsvsJ3jatg==\",\n      \"dev\": true,\n      \"optional\": true\n    },\n    \"arr-union\": {\n      \"version\": \"3.1.0\",\n      \"resolved\": \"https://registry.npmmirror.com/arr-union/-/arr-union-3.1.0.tgz\",\n      \"integrity\": \"sha512-sKpyeERZ02v1FeCZT8lrfJq5u6goHCtpTAzPwJYe7c8SPFOboNjNg1vz2L4VTn9T4PQxEx13TbXLmYUcS6Ug7Q==\",\n      \"dev\": true,\n      \"optional\": true\n    },\n    \"array-unique\": {\n      \"version\": \"0.2.1\",\n      \"resolved\": \"https://registry.npmmirror.com/array-unique/-/array-unique-0.2.1.tgz\",\n      \"integrity\": \"sha512-G2n5bG5fSUCpnsXz4+8FUkYsGPkNfLn9YvS66U5qbTIXI2Ynnlo4Bi42bWv+omKUCqz+ejzfClwne0alJWJPhg==\",\n      \"dev\": true,\n      \"optional\": true\n    },\n    \"assign-symbols\": {\n      \"version\": \"1.0.0\",\n      \"resolved\": \"https://registry.npmmirror.com/assign-symbols/-/assign-symbols-1.0.0.tgz\",\n      \"integrity\": \"sha512-Q+JC7Whu8HhmTdBph/Tq59IoRtoy6KAm5zzPv00WdujX82lbAL8K7WVjne7vdCsAmbF4AYaDOPyO3k0kl8qIrw==\",\n      \"dev\": true,\n      \"optional\": true\n    },\n    \"async-each\": {\n      \"version\": \"1.0.6\",\n      \"resolved\": \"https://registry.npmmirror.com/async-each/-/async-each-1.0.6.tgz\",\n      \"integrity\": \"sha512-c646jH1avxr+aVpndVMeAfYw7wAa6idufrlN3LPA4PmKS0QEGp6PIC9nwz0WQkkvBGAMEki3pFdtxaF39J9vvg==\",\n      \"dev\": true,\n      \"optional\": true\n    },\n    \"atob\": {\n      \"version\": \"2.1.2\",\n      \"resolved\": \"https://registry.npmmirror.com/atob/-/atob-2.1.2.tgz\",\n      \"integrity\": \"sha512-Wm6ukoaOGJi/73p/cl2GvLjTI5JM1k/O14isD73YML8StrH/7/lRFgmg8nICZgD3bZZvjwCGxtMOD3wWNAu8cg==\",\n      \"dev\": true,\n      \"optional\": true\n    },\n    \"babel-cli\": {\n      \"version\": \"6.26.0\",\n      \"resolved\": \"https://registry.npmmirror.com/babel-cli/-/babel-cli-6.26.0.tgz\",\n      \"integrity\": \"sha512-wau+BDtQfuSBGQ9PzzFL3REvR9Sxnd4LKwtcHAiPjhugA7K/80vpHXafj+O5bAqJOuSefjOx5ZJnNSR2J1Qw6Q==\",\n      \"dev\": true,\n      \"requires\": {\n        \"babel-core\": \"^6.26.0\",\n        \"babel-polyfill\": \"^6.26.0\",\n        \"babel-register\": \"^6.26.0\",\n        \"babel-runtime\": \"^6.26.0\",\n        \"chokidar\": \"^1.6.1\",\n        \"commander\": \"^2.11.0\",\n        \"convert-source-map\": \"^1.5.0\",\n        \"fs-readdir-recursive\": \"^1.0.0\",\n        \"glob\": \"^7.1.2\",\n        \"lodash\": \"^4.17.4\",\n        \"output-file-sync\": \"^1.1.2\",\n        \"path-is-absolute\": \"^1.0.1\",\n        \"slash\": \"^1.0.0\",\n        \"source-map\": \"^0.5.6\",\n        \"v8flags\": \"^2.1.1\"\n      }\n    },\n    \"babel-code-frame\": {\n      \"version\": \"6.26.0\",\n      \"resolved\": \"https://registry.npmmirror.com/babel-code-frame/-/babel-code-frame-6.26.0.tgz\",\n      \"integrity\": \"sha512-XqYMR2dfdGMW+hd0IUZ2PwK+fGeFkOxZJ0wY+JaQAHzt1Zx8LcvpiZD2NiGkEG8qx0CfkAOr5xt76d1e8vG90g==\",\n      \"dev\": true,\n      \"requires\": {\n        \"chalk\": \"^1.1.3\",\n        \"esutils\": \"^2.0.2\",\n        \"js-tokens\": \"^3.0.2\"\n      }\n    },\n    \"babel-core\": {\n      \"version\": \"6.26.3\",\n      \"resolved\": \"https://registry.npmmirror.com/babel-core/-/babel-core-6.26.3.tgz\",\n      \"integrity\": \"sha512-6jyFLuDmeidKmUEb3NM+/yawG0M2bDZ9Z1qbZP59cyHLz8kYGKYwpJP0UwUKKUiTRNvxfLesJnTedqczP7cTDA==\",\n      \"dev\": true,\n      \"requires\": {\n        \"babel-code-frame\": \"^6.26.0\",\n        \"babel-generator\": \"^6.26.0\",\n        \"babel-helpers\": \"^6.24.1\",\n        \"babel-messages\": \"^6.23.0\",\n        \"babel-register\": \"^6.26.0\",\n        \"babel-runtime\": \"^6.26.0\",\n        \"babel-template\": \"^6.26.0\",\n        \"babel-traverse\": \"^6.26.0\",\n        \"babel-types\": \"^6.26.0\",\n        \"babylon\": \"^6.18.0\",\n        \"convert-source-map\": \"^1.5.1\",\n        \"debug\": \"^2.6.9\",\n        \"json5\": \"^0.5.1\",\n        \"lodash\": \"^4.17.4\",\n        \"minimatch\": \"^3.0.4\",\n        \"path-is-absolute\": \"^1.0.1\",\n        \"private\": \"^0.1.8\",\n        \"slash\": \"^1.0.0\",\n        \"source-map\": \"^0.5.7\"\n      }\n    },\n    \"babel-generator\": {\n      \"version\": \"6.26.1\",\n      \"resolved\": \"https://registry.npmmirror.com/babel-generator/-/babel-generator-6.26.1.tgz\",\n      \"integrity\": \"sha512-HyfwY6ApZj7BYTcJURpM5tznulaBvyio7/0d4zFOeMPUmfxkCjHocCuoLa2SAGzBI8AREcH3eP3758F672DppA==\",\n      \"dev\": true,\n      \"requires\": {\n        \"babel-messages\": \"^6.23.0\",\n        \"babel-runtime\": \"^6.26.0\",\n        \"babel-types\": \"^6.26.0\",\n        \"detect-indent\": \"^4.0.0\",\n        \"jsesc\": \"^1.3.0\",\n        \"lodash\": \"^4.17.4\",\n        \"source-map\": \"^0.5.7\",\n        \"trim-right\": \"^1.0.1\"\n      }\n    },\n    \"babel-helper-builder-binary-assignment-operator-visitor\": {\n      \"version\": \"6.24.1\",\n      \"resolved\": \"https://registry.npmmirror.com/babel-helper-builder-binary-assignment-operator-visitor/-/babel-helper-builder-binary-assignment-operator-visitor-6.24.1.tgz\",\n      \"integrity\": \"sha512-gCtfYORSG1fUMX4kKraymq607FWgMWg+j42IFPc18kFQEsmtaibP4UrqsXt8FlEJle25HUd4tsoDR7H2wDhe9Q==\",\n      \"dev\": true,\n      \"requires\": {\n        \"babel-helper-explode-assignable-expression\": \"^6.24.1\",\n        \"babel-runtime\": \"^6.22.0\",\n        \"babel-types\": \"^6.24.1\"\n      }\n    },\n    \"babel-helper-call-delegate\": {\n      \"version\": \"6.24.1\",\n      \"resolved\": \"https://registry.npmmirror.com/babel-helper-call-delegate/-/babel-helper-call-delegate-6.24.1.tgz\",\n      \"integrity\": \"sha512-RL8n2NiEj+kKztlrVJM9JT1cXzzAdvWFh76xh/H1I4nKwunzE4INBXn8ieCZ+wh4zWszZk7NBS1s/8HR5jDkzQ==\",\n      \"dev\": true,\n      \"requires\": {\n        \"babel-helper-hoist-variables\": \"^6.24.1\",\n        \"babel-runtime\": \"^6.22.0\",\n        \"babel-traverse\": \"^6.24.1\",\n        \"babel-types\": \"^6.24.1\"\n      }\n    },\n    \"babel-helper-define-map\": {\n      \"version\": \"6.26.0\",\n      \"resolved\": \"https://registry.npmmirror.com/babel-helper-define-map/-/babel-helper-define-map-6.26.0.tgz\",\n      \"integrity\": \"sha512-bHkmjcC9lM1kmZcVpA5t2om2nzT/xiZpo6TJq7UlZ3wqKfzia4veeXbIhKvJXAMzhhEBd3cR1IElL5AenWEUpA==\",\n      \"dev\": true,\n      \"requires\": {\n        \"babel-helper-function-name\": \"^6.24.1\",\n        \"babel-runtime\": \"^6.26.0\",\n        \"babel-types\": \"^6.26.0\",\n        \"lodash\": \"^4.17.4\"\n      }\n    },\n    \"babel-helper-explode-assignable-expression\": {\n      \"version\": \"6.24.1\",\n      \"resolved\": \"https://registry.npmmirror.com/babel-helper-explode-assignable-expression/-/babel-helper-explode-assignable-expression-6.24.1.tgz\",\n      \"integrity\": \"sha512-qe5csbhbvq6ccry9G7tkXbzNtcDiH4r51rrPUbwwoTzZ18AqxWYRZT6AOmxrpxKnQBW0pYlBI/8vh73Z//78nQ==\",\n      \"dev\": true,\n      \"requires\": {\n        \"babel-runtime\": \"^6.22.0\",\n        \"babel-traverse\": \"^6.24.1\",\n        \"babel-types\": \"^6.24.1\"\n      }\n    },\n    \"babel-helper-function-name\": {\n      \"version\": \"6.24.1\",\n      \"resolved\": \"https://registry.npmmirror.com/babel-helper-function-name/-/babel-helper-function-name-6.24.1.tgz\",\n      \"integrity\": \"sha512-Oo6+e2iX+o9eVvJ9Y5eKL5iryeRdsIkwRYheCuhYdVHsdEQysbc2z2QkqCLIYnNxkT5Ss3ggrHdXiDI7Dhrn4Q==\",\n      \"dev\": true,\n      \"requires\": {\n        \"babel-helper-get-function-arity\": \"^6.24.1\",\n        \"babel-runtime\": \"^6.22.0\",\n        \"babel-template\": \"^6.24.1\",\n        \"babel-traverse\": \"^6.24.1\",\n        \"babel-types\": \"^6.24.1\"\n      }\n    },\n    \"babel-helper-get-function-arity\": {\n      \"version\": \"6.24.1\",\n      \"resolved\": \"https://registry.npmmirror.com/babel-helper-get-function-arity/-/babel-helper-get-function-arity-6.24.1.tgz\",\n      \"integrity\": \"sha512-WfgKFX6swFB1jS2vo+DwivRN4NB8XUdM3ij0Y1gnC21y1tdBoe6xjVnd7NSI6alv+gZXCtJqvrTeMW3fR/c0ng==\",\n      \"dev\": true,\n      \"requires\": {\n        \"babel-runtime\": \"^6.22.0\",\n        \"babel-types\": \"^6.24.1\"\n      }\n    },\n    \"babel-helper-hoist-variables\": {\n      \"version\": \"6.24.1\",\n      \"resolved\": \"https://registry.npmmirror.com/babel-helper-hoist-variables/-/babel-helper-hoist-variables-6.24.1.tgz\",\n      \"integrity\": \"sha512-zAYl3tqerLItvG5cKYw7f1SpvIxS9zi7ohyGHaI9cgDUjAT6YcY9jIEH5CstetP5wHIVSceXwNS7Z5BpJg+rOw==\",\n      \"dev\": true,\n      \"requires\": {\n        \"babel-runtime\": \"^6.22.0\",\n        \"babel-types\": \"^6.24.1\"\n      }\n    },\n    \"babel-helper-optimise-call-expression\": {\n      \"version\": \"6.24.1\",\n      \"resolved\": \"https://registry.npmmirror.com/babel-helper-optimise-call-expression/-/babel-helper-optimise-call-expression-6.24.1.tgz\",\n      \"integrity\": \"sha512-Op9IhEaxhbRT8MDXx2iNuMgciu2V8lDvYCNQbDGjdBNCjaMvyLf4wl4A3b8IgndCyQF8TwfgsQ8T3VD8aX1/pA==\",\n      \"dev\": true,\n      \"requires\": {\n        \"babel-runtime\": \"^6.22.0\",\n        \"babel-types\": \"^6.24.1\"\n      }\n    },\n    \"babel-helper-regex\": {\n      \"version\": \"6.26.0\",\n      \"resolved\": \"https://registry.npmmirror.com/babel-helper-regex/-/babel-helper-regex-6.26.0.tgz\",\n      \"integrity\": \"sha512-VlPiWmqmGJp0x0oK27Out1D+71nVVCTSdlbhIVoaBAj2lUgrNjBCRR9+llO4lTSb2O4r7PJg+RobRkhBrf6ofg==\",\n      \"dev\": true,\n      \"requires\": {\n        \"babel-runtime\": \"^6.26.0\",\n        \"babel-types\": \"^6.26.0\",\n        \"lodash\": \"^4.17.4\"\n      }\n    },\n    \"babel-helper-remap-async-to-generator\": {\n      \"version\": \"6.24.1\",\n      \"resolved\": \"https://registry.npmmirror.com/babel-helper-remap-async-to-generator/-/babel-helper-remap-async-to-generator-6.24.1.tgz\",\n      \"integrity\": \"sha512-RYqaPD0mQyQIFRu7Ho5wE2yvA/5jxqCIj/Lv4BXNq23mHYu/vxikOy2JueLiBxQknwapwrJeNCesvY0ZcfnlHg==\",\n      \"dev\": true,\n      \"requires\": {\n        \"babel-helper-function-name\": \"^6.24.1\",\n        \"babel-runtime\": \"^6.22.0\",\n        \"babel-template\": \"^6.24.1\",\n        \"babel-traverse\": \"^6.24.1\",\n        \"babel-types\": \"^6.24.1\"\n      }\n    },\n    \"babel-helper-replace-supers\": {\n      \"version\": \"6.24.1\",\n      \"resolved\": \"https://registry.npmmirror.com/babel-helper-replace-supers/-/babel-helper-replace-supers-6.24.1.tgz\",\n      \"integrity\": \"sha512-sLI+u7sXJh6+ToqDr57Bv973kCepItDhMou0xCP2YPVmR1jkHSCY+p1no8xErbV1Siz5QE8qKT1WIwybSWlqjw==\",\n      \"dev\": true,\n      \"requires\": {\n        \"babel-helper-optimise-call-expression\": \"^6.24.1\",\n        \"babel-messages\": \"^6.23.0\",\n        \"babel-runtime\": \"^6.22.0\",\n        \"babel-template\": \"^6.24.1\",\n        \"babel-traverse\": \"^6.24.1\",\n        \"babel-types\": \"^6.24.1\"\n      }\n    },\n    \"babel-helpers\": {\n      \"version\": \"6.24.1\",\n      \"resolved\": \"https://registry.npmmirror.com/babel-helpers/-/babel-helpers-6.24.1.tgz\",\n      \"integrity\": \"sha512-n7pFrqQm44TCYvrCDb0MqabAF+JUBq+ijBvNMUxpkLjJaAu32faIexewMumrH5KLLJ1HDyT0PTEqRyAe/GwwuQ==\",\n      \"dev\": true,\n      \"requires\": {\n        \"babel-runtime\": \"^6.22.0\",\n        \"babel-template\": \"^6.24.1\"\n      }\n    },\n    \"babel-messages\": {\n      \"version\": \"6.23.0\",\n      \"resolved\": \"https://registry.npmmirror.com/babel-messages/-/babel-messages-6.23.0.tgz\",\n      \"integrity\": \"sha512-Bl3ZiA+LjqaMtNYopA9TYE9HP1tQ+E5dLxE0XrAzcIJeK2UqF0/EaqXwBn9esd4UmTfEab+P+UYQ1GnioFIb/w==\",\n      \"dev\": true,\n      \"requires\": {\n        \"babel-runtime\": \"^6.22.0\"\n      }\n    },\n    \"babel-plugin-check-es2015-constants\": {\n      \"version\": \"6.22.0\",\n      \"resolved\": \"https://registry.npmmirror.com/babel-plugin-check-es2015-constants/-/babel-plugin-check-es2015-constants-6.22.0.tgz\",\n      \"integrity\": \"sha512-B1M5KBP29248dViEo1owyY32lk1ZSH2DaNNrXLGt8lyjjHm7pBqAdQ7VKUPR6EEDO323+OvT3MQXbCin8ooWdA==\",\n      \"dev\": true,\n      \"requires\": {\n        \"babel-runtime\": \"^6.22.0\"\n      }\n    },\n    \"babel-plugin-syntax-async-functions\": {\n      \"version\": \"6.13.0\",\n      \"resolved\": \"https://registry.npmmirror.com/babel-plugin-syntax-async-functions/-/babel-plugin-syntax-async-functions-6.13.0.tgz\",\n      \"integrity\": \"sha512-4Zp4unmHgw30A1eWI5EpACji2qMocisdXhAftfhXoSV9j0Tvj6nRFE3tOmRY912E0FMRm/L5xWE7MGVT2FoLnw==\",\n      \"dev\": true\n    },\n    \"babel-plugin-syntax-exponentiation-operator\": {\n      \"version\": \"6.13.0\",\n      \"resolved\": \"https://registry.npmmirror.com/babel-plugin-syntax-exponentiation-operator/-/babel-plugin-syntax-exponentiation-operator-6.13.0.tgz\",\n      \"integrity\": \"sha512-Z/flU+T9ta0aIEKl1tGEmN/pZiI1uXmCiGFRegKacQfEJzp7iNsKloZmyJlQr+75FCJtiFfGIK03SiCvCt9cPQ==\",\n      \"dev\": true\n    },\n    \"babel-plugin-syntax-trailing-function-commas\": {\n      \"version\": \"6.22.0\",\n      \"resolved\": \"https://registry.npmmirror.com/babel-plugin-syntax-trailing-function-commas/-/babel-plugin-syntax-trailing-function-commas-6.22.0.tgz\",\n      \"integrity\": \"sha512-Gx9CH3Q/3GKbhs07Bszw5fPTlU+ygrOGfAhEt7W2JICwufpC4SuO0mG0+4NykPBSYPMJhqvVlDBU17qB1D+hMQ==\",\n      \"dev\": true\n    },\n    \"babel-plugin-transform-async-to-generator\": {\n      \"version\": \"6.24.1\",\n      \"resolved\": \"https://registry.npmmirror.com/babel-plugin-transform-async-to-generator/-/babel-plugin-transform-async-to-generator-6.24.1.tgz\",\n      \"integrity\": \"sha512-7BgYJujNCg0Ti3x0c/DL3tStvnKS6ktIYOmo9wginv/dfZOrbSZ+qG4IRRHMBOzZ5Awb1skTiAsQXg/+IWkZYw==\",\n      \"dev\": true,\n      \"requires\": {\n        \"babel-helper-remap-async-to-generator\": \"^6.24.1\",\n        \"babel-plugin-syntax-async-functions\": \"^6.8.0\",\n        \"babel-runtime\": \"^6.22.0\"\n      }\n    },\n    \"babel-plugin-transform-es2015-arrow-functions\": {\n      \"version\": \"6.22.0\",\n      \"resolved\": \"https://registry.npmmirror.com/babel-plugin-transform-es2015-arrow-functions/-/babel-plugin-transform-es2015-arrow-functions-6.22.0.tgz\",\n      \"integrity\": \"sha512-PCqwwzODXW7JMrzu+yZIaYbPQSKjDTAsNNlK2l5Gg9g4rz2VzLnZsStvp/3c46GfXpwkyufb3NCyG9+50FF1Vg==\",\n      \"dev\": true,\n      \"requires\": {\n        \"babel-runtime\": \"^6.22.0\"\n      }\n    },\n    \"babel-plugin-transform-es2015-block-scoped-functions\": {\n      \"version\": \"6.22.0\",\n      \"resolved\": \"https://registry.npmmirror.com/babel-plugin-transform-es2015-block-scoped-functions/-/babel-plugin-transform-es2015-block-scoped-functions-6.22.0.tgz\",\n      \"integrity\": \"sha512-2+ujAT2UMBzYFm7tidUsYh+ZoIutxJ3pN9IYrF1/H6dCKtECfhmB8UkHVpyxDwkj0CYbQG35ykoz925TUnBc3A==\",\n      \"dev\": true,\n      \"requires\": {\n        \"babel-runtime\": \"^6.22.0\"\n      }\n    },\n    \"babel-plugin-transform-es2015-block-scoping\": {\n      \"version\": \"6.26.0\",\n      \"resolved\": \"https://registry.npmmirror.com/babel-plugin-transform-es2015-block-scoping/-/babel-plugin-transform-es2015-block-scoping-6.26.0.tgz\",\n      \"integrity\": \"sha512-YiN6sFAQ5lML8JjCmr7uerS5Yc/EMbgg9G8ZNmk2E3nYX4ckHR01wrkeeMijEf5WHNK5TW0Sl0Uu3pv3EdOJWw==\",\n      \"dev\": true,\n      \"requires\": {\n        \"babel-runtime\": \"^6.26.0\",\n        \"babel-template\": \"^6.26.0\",\n        \"babel-traverse\": \"^6.26.0\",\n        \"babel-types\": \"^6.26.0\",\n        \"lodash\": \"^4.17.4\"\n      }\n    },\n    \"babel-plugin-transform-es2015-classes\": {\n      \"version\": \"6.24.1\",\n      \"resolved\": \"https://registry.npmmirror.com/babel-plugin-transform-es2015-classes/-/babel-plugin-transform-es2015-classes-6.24.1.tgz\",\n      \"integrity\": \"sha512-5Dy7ZbRinGrNtmWpquZKZ3EGY8sDgIVB4CU8Om8q8tnMLrD/m94cKglVcHps0BCTdZ0TJeeAWOq2TK9MIY6cag==\",\n      \"dev\": true,\n      \"requires\": {\n        \"babel-helper-define-map\": \"^6.24.1\",\n        \"babel-helper-function-name\": \"^6.24.1\",\n        \"babel-helper-optimise-call-expression\": \"^6.24.1\",\n        \"babel-helper-replace-supers\": \"^6.24.1\",\n        \"babel-messages\": \"^6.23.0\",\n        \"babel-runtime\": \"^6.22.0\",\n        \"babel-template\": \"^6.24.1\",\n        \"babel-traverse\": \"^6.24.1\",\n        \"babel-types\": \"^6.24.1\"\n      }\n    },\n    \"babel-plugin-transform-es2015-computed-properties\": {\n      \"version\": \"6.24.1\",\n      \"resolved\": \"https://registry.npmmirror.com/babel-plugin-transform-es2015-computed-properties/-/babel-plugin-transform-es2015-computed-properties-6.24.1.tgz\",\n      \"integrity\": \"sha512-C/uAv4ktFP/Hmh01gMTvYvICrKze0XVX9f2PdIXuriCSvUmV9j+u+BB9f5fJK3+878yMK6dkdcq+Ymr9mrcLzw==\",\n      \"dev\": true,\n      \"requires\": {\n        \"babel-runtime\": \"^6.22.0\",\n        \"babel-template\": \"^6.24.1\"\n      }\n    },\n    \"babel-plugin-transform-es2015-destructuring\": {\n      \"version\": \"6.23.0\",\n      \"resolved\": \"https://registry.npmmirror.com/babel-plugin-transform-es2015-destructuring/-/babel-plugin-transform-es2015-destructuring-6.23.0.tgz\",\n      \"integrity\": \"sha512-aNv/GDAW0j/f4Uy1OEPZn1mqD+Nfy9viFGBfQ5bZyT35YqOiqx7/tXdyfZkJ1sC21NyEsBdfDY6PYmLHF4r5iA==\",\n      \"dev\": true,\n      \"requires\": {\n        \"babel-runtime\": \"^6.22.0\"\n      }\n    },\n    \"babel-plugin-transform-es2015-duplicate-keys\": {\n      \"version\": \"6.24.1\",\n      \"resolved\": \"https://registry.npmmirror.com/babel-plugin-transform-es2015-duplicate-keys/-/babel-plugin-transform-es2015-duplicate-keys-6.24.1.tgz\",\n      \"integrity\": \"sha512-ossocTuPOssfxO2h+Z3/Ea1Vo1wWx31Uqy9vIiJusOP4TbF7tPs9U0sJ9pX9OJPf4lXRGj5+6Gkl/HHKiAP5ug==\",\n      \"dev\": true,\n      \"requires\": {\n        \"babel-runtime\": \"^6.22.0\",\n        \"babel-types\": \"^6.24.1\"\n      }\n    },\n    \"babel-plugin-transform-es2015-for-of\": {\n      \"version\": \"6.23.0\",\n      \"resolved\": \"https://registry.npmmirror.com/babel-plugin-transform-es2015-for-of/-/babel-plugin-transform-es2015-for-of-6.23.0.tgz\",\n      \"integrity\": \"sha512-DLuRwoygCoXx+YfxHLkVx5/NpeSbVwfoTeBykpJK7JhYWlL/O8hgAK/reforUnZDlxasOrVPPJVI/guE3dCwkw==\",\n      \"dev\": true,\n      \"requires\": {\n        \"babel-runtime\": \"^6.22.0\"\n      }\n    },\n    \"babel-plugin-transform-es2015-function-name\": {\n      \"version\": \"6.24.1\",\n      \"resolved\": \"https://registry.npmmirror.com/babel-plugin-transform-es2015-function-name/-/babel-plugin-transform-es2015-function-name-6.24.1.tgz\",\n      \"integrity\": \"sha512-iFp5KIcorf11iBqu/y/a7DK3MN5di3pNCzto61FqCNnUX4qeBwcV1SLqe10oXNnCaxBUImX3SckX2/o1nsrTcg==\",\n      \"dev\": true,\n      \"requires\": {\n        \"babel-helper-function-name\": \"^6.24.1\",\n        \"babel-runtime\": \"^6.22.0\",\n        \"babel-types\": \"^6.24.1\"\n      }\n    },\n    \"babel-plugin-transform-es2015-literals\": {\n      \"version\": \"6.22.0\",\n      \"resolved\": \"https://registry.npmmirror.com/babel-plugin-transform-es2015-literals/-/babel-plugin-transform-es2015-literals-6.22.0.tgz\",\n      \"integrity\": \"sha512-tjFl0cwMPpDYyoqYA9li1/7mGFit39XiNX5DKC/uCNjBctMxyL1/PT/l4rSlbvBG1pOKI88STRdUsWXB3/Q9hQ==\",\n      \"dev\": true,\n      \"requires\": {\n        \"babel-runtime\": \"^6.22.0\"\n      }\n    },\n    \"babel-plugin-transform-es2015-modules-amd\": {\n      \"version\": \"6.24.1\",\n      \"resolved\": \"https://registry.npmmirror.com/babel-plugin-transform-es2015-modules-amd/-/babel-plugin-transform-es2015-modules-amd-6.24.1.tgz\",\n      \"integrity\": \"sha512-LnIIdGWIKdw7zwckqx+eGjcS8/cl8D74A3BpJbGjKTFFNJSMrjN4bIh22HY1AlkUbeLG6X6OZj56BDvWD+OeFA==\",\n      \"dev\": true,\n      \"requires\": {\n        \"babel-plugin-transform-es2015-modules-commonjs\": \"^6.24.1\",\n        \"babel-runtime\": \"^6.22.0\",\n        \"babel-template\": \"^6.24.1\"\n      }\n    },\n    \"babel-plugin-transform-es2015-modules-commonjs\": {\n      \"version\": \"6.26.2\",\n      \"resolved\": \"https://registry.npmmirror.com/babel-plugin-transform-es2015-modules-commonjs/-/babel-plugin-transform-es2015-modules-commonjs-6.26.2.tgz\",\n      \"integrity\": \"sha512-CV9ROOHEdrjcwhIaJNBGMBCodN+1cfkwtM1SbUHmvyy35KGT7fohbpOxkE2uLz1o6odKK2Ck/tz47z+VqQfi9Q==\",\n      \"dev\": true,\n      \"requires\": {\n        \"babel-plugin-transform-strict-mode\": \"^6.24.1\",\n        \"babel-runtime\": \"^6.26.0\",\n        \"babel-template\": \"^6.26.0\",\n        \"babel-types\": \"^6.26.0\"\n      }\n    },\n    \"babel-plugin-transform-es2015-modules-systemjs\": {\n      \"version\": \"6.24.1\",\n      \"resolved\": \"https://registry.npmmirror.com/babel-plugin-transform-es2015-modules-systemjs/-/babel-plugin-transform-es2015-modules-systemjs-6.24.1.tgz\",\n      \"integrity\": \"sha512-ONFIPsq8y4bls5PPsAWYXH/21Hqv64TBxdje0FvU3MhIV6QM2j5YS7KvAzg/nTIVLot2D2fmFQrFWCbgHlFEjg==\",\n      \"dev\": true,\n      \"requires\": {\n        \"babel-helper-hoist-variables\": \"^6.24.1\",\n        \"babel-runtime\": \"^6.22.0\",\n        \"babel-template\": \"^6.24.1\"\n      }\n    },\n    \"babel-plugin-transform-es2015-modules-umd\": {\n      \"version\": \"6.24.1\",\n      \"resolved\": \"https://registry.npmmirror.com/babel-plugin-transform-es2015-modules-umd/-/babel-plugin-transform-es2015-modules-umd-6.24.1.tgz\",\n      \"integrity\": \"sha512-LpVbiT9CLsuAIp3IG0tfbVo81QIhn6pE8xBJ7XSeCtFlMltuar5VuBV6y6Q45tpui9QWcy5i0vLQfCfrnF7Kiw==\",\n      \"dev\": true,\n      \"requires\": {\n        \"babel-plugin-transform-es2015-modules-amd\": \"^6.24.1\",\n        \"babel-runtime\": \"^6.22.0\",\n        \"babel-template\": \"^6.24.1\"\n      }\n    },\n    \"babel-plugin-transform-es2015-object-super\": {\n      \"version\": \"6.24.1\",\n      \"resolved\": \"https://registry.npmmirror.com/babel-plugin-transform-es2015-object-super/-/babel-plugin-transform-es2015-object-super-6.24.1.tgz\",\n      \"integrity\": \"sha512-8G5hpZMecb53vpD3mjs64NhI1au24TAmokQ4B+TBFBjN9cVoGoOvotdrMMRmHvVZUEvqGUPWL514woru1ChZMA==\",\n      \"dev\": true,\n      \"requires\": {\n        \"babel-helper-replace-supers\": \"^6.24.1\",\n        \"babel-runtime\": \"^6.22.0\"\n      }\n    },\n    \"babel-plugin-transform-es2015-parameters\": {\n      \"version\": \"6.24.1\",\n      \"resolved\": \"https://registry.npmmirror.com/babel-plugin-transform-es2015-parameters/-/babel-plugin-transform-es2015-parameters-6.24.1.tgz\",\n      \"integrity\": \"sha512-8HxlW+BB5HqniD+nLkQ4xSAVq3bR/pcYW9IigY+2y0dI+Y7INFeTbfAQr+63T3E4UDsZGjyb+l9txUnABWxlOQ==\",\n      \"dev\": true,\n      \"requires\": {\n        \"babel-helper-call-delegate\": \"^6.24.1\",\n        \"babel-helper-get-function-arity\": \"^6.24.1\",\n        \"babel-runtime\": \"^6.22.0\",\n        \"babel-template\": \"^6.24.1\",\n        \"babel-traverse\": \"^6.24.1\",\n        \"babel-types\": \"^6.24.1\"\n      }\n    },\n    \"babel-plugin-transform-es2015-shorthand-properties\": {\n      \"version\": \"6.24.1\",\n      \"resolved\": \"https://registry.npmmirror.com/babel-plugin-transform-es2015-shorthand-properties/-/babel-plugin-transform-es2015-shorthand-properties-6.24.1.tgz\",\n      \"integrity\": \"sha512-mDdocSfUVm1/7Jw/FIRNw9vPrBQNePy6wZJlR8HAUBLybNp1w/6lr6zZ2pjMShee65t/ybR5pT8ulkLzD1xwiw==\",\n      \"dev\": true,\n      \"requires\": {\n        \"babel-runtime\": \"^6.22.0\",\n        \"babel-types\": \"^6.24.1\"\n      }\n    },\n    \"babel-plugin-transform-es2015-spread\": {\n      \"version\": \"6.22.0\",\n      \"resolved\": \"https://registry.npmmirror.com/babel-plugin-transform-es2015-spread/-/babel-plugin-transform-es2015-spread-6.22.0.tgz\",\n      \"integrity\": \"sha512-3Ghhi26r4l3d0Js933E5+IhHwk0A1yiutj9gwvzmFbVV0sPMYk2lekhOufHBswX7NCoSeF4Xrl3sCIuSIa+zOg==\",\n      \"dev\": true,\n      \"requires\": {\n        \"babel-runtime\": \"^6.22.0\"\n      }\n    },\n    \"babel-plugin-transform-es2015-sticky-regex\": {\n      \"version\": \"6.24.1\",\n      \"resolved\": \"https://registry.npmmirror.com/babel-plugin-transform-es2015-sticky-regex/-/babel-plugin-transform-es2015-sticky-regex-6.24.1.tgz\",\n      \"integrity\": \"sha512-CYP359ADryTo3pCsH0oxRo/0yn6UsEZLqYohHmvLQdfS9xkf+MbCzE3/Kolw9OYIY4ZMilH25z/5CbQbwDD+lQ==\",\n      \"dev\": true,\n      \"requires\": {\n        \"babel-helper-regex\": \"^6.24.1\",\n        \"babel-runtime\": \"^6.22.0\",\n        \"babel-types\": \"^6.24.1\"\n      }\n    },\n    \"babel-plugin-transform-es2015-template-literals\": {\n      \"version\": \"6.22.0\",\n      \"resolved\": \"https://registry.npmmirror.com/babel-plugin-transform-es2015-template-literals/-/babel-plugin-transform-es2015-template-literals-6.22.0.tgz\",\n      \"integrity\": \"sha512-x8b9W0ngnKzDMHimVtTfn5ryimars1ByTqsfBDwAqLibmuuQY6pgBQi5z1ErIsUOWBdw1bW9FSz5RZUojM4apg==\",\n      \"dev\": true,\n      \"requires\": {\n        \"babel-runtime\": \"^6.22.0\"\n      }\n    },\n    \"babel-plugin-transform-es2015-typeof-symbol\": {\n      \"version\": \"6.23.0\",\n      \"resolved\": \"https://registry.npmmirror.com/babel-plugin-transform-es2015-typeof-symbol/-/babel-plugin-transform-es2015-typeof-symbol-6.23.0.tgz\",\n      \"integrity\": \"sha512-fz6J2Sf4gYN6gWgRZaoFXmq93X+Li/8vf+fb0sGDVtdeWvxC9y5/bTD7bvfWMEq6zetGEHpWjtzRGSugt5kNqw==\",\n      \"dev\": true,\n      \"requires\": {\n        \"babel-runtime\": \"^6.22.0\"\n      }\n    },\n    \"babel-plugin-transform-es2015-unicode-regex\": {\n      \"version\": \"6.24.1\",\n      \"resolved\": \"https://registry.npmmirror.com/babel-plugin-transform-es2015-unicode-regex/-/babel-plugin-transform-es2015-unicode-regex-6.24.1.tgz\",\n      \"integrity\": \"sha512-v61Dbbihf5XxnYjtBN04B/JBvsScY37R1cZT5r9permN1cp+b70DY3Ib3fIkgn1DI9U3tGgBJZVD8p/mE/4JbQ==\",\n      \"dev\": true,\n      \"requires\": {\n        \"babel-helper-regex\": \"^6.24.1\",\n        \"babel-runtime\": \"^6.22.0\",\n        \"regexpu-core\": \"^2.0.0\"\n      }\n    },\n    \"babel-plugin-transform-exponentiation-operator\": {\n      \"version\": \"6.24.1\",\n      \"resolved\": \"https://registry.npmmirror.com/babel-plugin-transform-exponentiation-operator/-/babel-plugin-transform-exponentiation-operator-6.24.1.tgz\",\n      \"integrity\": \"sha512-LzXDmbMkklvNhprr20//RStKVcT8Cu+SQtX18eMHLhjHf2yFzwtQ0S2f0jQ+89rokoNdmwoSqYzAhq86FxlLSQ==\",\n      \"dev\": true,\n      \"requires\": {\n        \"babel-helper-builder-binary-assignment-operator-visitor\": \"^6.24.1\",\n        \"babel-plugin-syntax-exponentiation-operator\": \"^6.8.0\",\n        \"babel-runtime\": \"^6.22.0\"\n      }\n    },\n    \"babel-plugin-transform-regenerator\": {\n      \"version\": \"6.26.0\",\n      \"resolved\": \"https://registry.npmmirror.com/babel-plugin-transform-regenerator/-/babel-plugin-transform-regenerator-6.26.0.tgz\",\n      \"integrity\": \"sha512-LS+dBkUGlNR15/5WHKe/8Neawx663qttS6AGqoOUhICc9d1KciBvtrQSuc0PI+CxQ2Q/S1aKuJ+u64GtLdcEZg==\",\n      \"dev\": true,\n      \"requires\": {\n        \"regenerator-transform\": \"^0.10.0\"\n      }\n    },\n    \"babel-plugin-transform-runtime\": {\n      \"version\": \"6.23.0\",\n      \"resolved\": \"https://registry.npmmirror.com/babel-plugin-transform-runtime/-/babel-plugin-transform-runtime-6.23.0.tgz\",\n      \"integrity\": \"sha512-cpGMVC1vt/772y3jx1gwSaTitQVZuFDlllgreMsZ+rTYC6jlYXRyf5FQOgSnckOiA5QmzbXTyBY2A5AmZXF1fA==\",\n      \"dev\": true,\n      \"requires\": {\n        \"babel-runtime\": \"^6.22.0\"\n      }\n    },\n    \"babel-plugin-transform-strict-mode\": {\n      \"version\": \"6.24.1\",\n      \"resolved\": \"https://registry.npmmirror.com/babel-plugin-transform-strict-mode/-/babel-plugin-transform-strict-mode-6.24.1.tgz\",\n      \"integrity\": \"sha512-j3KtSpjyLSJxNoCDrhwiJad8kw0gJ9REGj8/CqL0HeRyLnvUNYV9zcqluL6QJSXh3nfsLEmSLvwRfGzrgR96Pw==\",\n      \"dev\": true,\n      \"requires\": {\n        \"babel-runtime\": \"^6.22.0\",\n        \"babel-types\": \"^6.24.1\"\n      }\n    },\n    \"babel-polyfill\": {\n      \"version\": \"6.26.0\",\n      \"resolved\": \"https://registry.npmmirror.com/babel-polyfill/-/babel-polyfill-6.26.0.tgz\",\n      \"integrity\": \"sha512-F2rZGQnAdaHWQ8YAoeRbukc7HS9QgdgeyJ0rQDd485v9opwuPvjpPFcOOT/WmkKTdgy9ESgSPXDcTNpzrGr6iQ==\",\n      \"dev\": true,\n      \"requires\": {\n        \"babel-runtime\": \"^6.26.0\",\n        \"core-js\": \"^2.5.0\",\n        \"regenerator-runtime\": \"^0.10.5\"\n      },\n      \"dependencies\": {\n        \"regenerator-runtime\": {\n          \"version\": \"0.10.5\",\n          \"resolved\": \"https://registry.npmmirror.com/regenerator-runtime/-/regenerator-runtime-0.10.5.tgz\",\n          \"integrity\": \"sha512-02YopEIhAgiBHWeoTiA8aitHDt8z6w+rQqNuIftlM+ZtvSl/brTouaU7DW6GO/cHtvxJvS4Hwv2ibKdxIRi24w==\",\n          \"dev\": true\n        }\n      }\n    },\n    \"babel-preset-env\": {\n      \"version\": \"1.7.0\",\n      \"resolved\": \"https://registry.npmmirror.com/babel-preset-env/-/babel-preset-env-1.7.0.tgz\",\n      \"integrity\": \"sha512-9OR2afuKDneX2/q2EurSftUYM0xGu4O2D9adAhVfADDhrYDaxXV0rBbevVYoY9n6nyX1PmQW/0jtpJvUNr9CHg==\",\n      \"dev\": true,\n      \"requires\": {\n        \"babel-plugin-check-es2015-constants\": \"^6.22.0\",\n        \"babel-plugin-syntax-trailing-function-commas\": \"^6.22.0\",\n        \"babel-plugin-transform-async-to-generator\": \"^6.22.0\",\n        \"babel-plugin-transform-es2015-arrow-functions\": \"^6.22.0\",\n        \"babel-plugin-transform-es2015-block-scoped-functions\": \"^6.22.0\",\n        \"babel-plugin-transform-es2015-block-scoping\": \"^6.23.0\",\n        \"babel-plugin-transform-es2015-classes\": \"^6.23.0\",\n        \"babel-plugin-transform-es2015-computed-properties\": \"^6.22.0\",\n        \"babel-plugin-transform-es2015-destructuring\": \"^6.23.0\",\n        \"babel-plugin-transform-es2015-duplicate-keys\": \"^6.22.0\",\n        \"babel-plugin-transform-es2015-for-of\": \"^6.23.0\",\n        \"babel-plugin-transform-es2015-function-name\": \"^6.22.0\",\n        \"babel-plugin-transform-es2015-literals\": \"^6.22.0\",\n        \"babel-plugin-transform-es2015-modules-amd\": \"^6.22.0\",\n        \"babel-plugin-transform-es2015-modules-commonjs\": \"^6.23.0\",\n        \"babel-plugin-transform-es2015-modules-systemjs\": \"^6.23.0\",\n        \"babel-plugin-transform-es2015-modules-umd\": \"^6.23.0\",\n        \"babel-plugin-transform-es2015-object-super\": \"^6.22.0\",\n        \"babel-plugin-transform-es2015-parameters\": \"^6.23.0\",\n        \"babel-plugin-transform-es2015-shorthand-properties\": \"^6.22.0\",\n        \"babel-plugin-transform-es2015-spread\": \"^6.22.0\",\n        \"babel-plugin-transform-es2015-sticky-regex\": \"^6.22.0\",\n        \"babel-plugin-transform-es2015-template-literals\": \"^6.22.0\",\n        \"babel-plugin-transform-es2015-typeof-symbol\": \"^6.23.0\",\n        \"babel-plugin-transform-es2015-unicode-regex\": \"^6.22.0\",\n        \"babel-plugin-transform-exponentiation-operator\": \"^6.22.0\",\n        \"babel-plugin-transform-regenerator\": \"^6.22.0\",\n        \"browserslist\": \"^3.2.6\",\n        \"invariant\": \"^2.2.2\",\n        \"semver\": \"^5.3.0\"\n      }\n    },\n    \"babel-register\": {\n      \"version\": \"6.26.0\",\n      \"resolved\": \"https://registry.npmmirror.com/babel-register/-/babel-register-6.26.0.tgz\",\n      \"integrity\": \"sha512-veliHlHX06wjaeY8xNITbveXSiI+ASFnOqvne/LaIJIqOWi2Ogmj91KOugEz/hoh/fwMhXNBJPCv8Xaz5CyM4A==\",\n      \"dev\": true,\n      \"requires\": {\n        \"babel-core\": \"^6.26.0\",\n        \"babel-runtime\": \"^6.26.0\",\n        \"core-js\": \"^2.5.0\",\n        \"home-or-tmp\": \"^2.0.0\",\n        \"lodash\": \"^4.17.4\",\n        \"mkdirp\": \"^0.5.1\",\n        \"source-map-support\": \"^0.4.15\"\n      }\n    },\n    \"babel-runtime\": {\n      \"version\": \"6.26.0\",\n      \"resolved\": \"https://registry.npmmirror.com/babel-runtime/-/babel-runtime-6.26.0.tgz\",\n      \"integrity\": \"sha512-ITKNuq2wKlW1fJg9sSW52eepoYgZBggvOAHC0u/CYu/qxQ9EVzThCgR69BnSXLHjy2f7SY5zaQ4yt7H9ZVxY2g==\",\n      \"dev\": true,\n      \"requires\": {\n        \"core-js\": \"^2.4.0\",\n        \"regenerator-runtime\": \"^0.11.0\"\n      }\n    },\n    \"babel-template\": {\n      \"version\": \"6.26.0\",\n      \"resolved\": \"https://registry.npmmirror.com/babel-template/-/babel-template-6.26.0.tgz\",\n      \"integrity\": \"sha512-PCOcLFW7/eazGUKIoqH97sO9A2UYMahsn/yRQ7uOk37iutwjq7ODtcTNF+iFDSHNfkctqsLRjLP7URnOx0T1fg==\",\n      \"dev\": true,\n      \"requires\": {\n        \"babel-runtime\": \"^6.26.0\",\n        \"babel-traverse\": \"^6.26.0\",\n        \"babel-types\": \"^6.26.0\",\n        \"babylon\": \"^6.18.0\",\n        \"lodash\": \"^4.17.4\"\n      }\n    },\n    \"babel-traverse\": {\n      \"version\": \"6.26.0\",\n      \"resolved\": \"https://registry.npmmirror.com/babel-traverse/-/babel-traverse-6.26.0.tgz\",\n      \"integrity\": \"sha512-iSxeXx7apsjCHe9c7n8VtRXGzI2Bk1rBSOJgCCjfyXb6v1aCqE1KSEpq/8SXuVN8Ka/Rh1WDTF0MDzkvTA4MIA==\",\n      \"dev\": true,\n      \"requires\": {\n        \"babel-code-frame\": \"^6.26.0\",\n        \"babel-messages\": \"^6.23.0\",\n        \"babel-runtime\": \"^6.26.0\",\n        \"babel-types\": \"^6.26.0\",\n        \"babylon\": \"^6.18.0\",\n        \"debug\": \"^2.6.8\",\n        \"globals\": \"^9.18.0\",\n        \"invariant\": \"^2.2.2\",\n        \"lodash\": \"^4.17.4\"\n      }\n    },\n    \"babel-types\": {\n      \"version\": \"6.26.0\",\n      \"resolved\": \"https://registry.npmmirror.com/babel-types/-/babel-types-6.26.0.tgz\",\n      \"integrity\": \"sha512-zhe3V/26rCWsEZK8kZN+HaQj5yQ1CilTObixFzKW1UWjqG7618Twz6YEsCnjfg5gBcJh02DrpCkS9h98ZqDY+g==\",\n      \"dev\": true,\n      \"requires\": {\n        \"babel-runtime\": \"^6.26.0\",\n        \"esutils\": \"^2.0.2\",\n        \"lodash\": \"^4.17.4\",\n        \"to-fast-properties\": \"^1.0.3\"\n      }\n    },\n    \"babylon\": {\n      \"version\": \"6.18.0\",\n      \"resolved\": \"https://registry.npmmirror.com/babylon/-/babylon-6.18.0.tgz\",\n      \"integrity\": \"sha512-q/UEjfGJ2Cm3oKV71DJz9d25TPnq5rhBVL2Q4fA5wcC3jcrdn7+SssEybFIxwAvvP+YCsCYNKughoF33GxgycQ==\",\n      \"dev\": true\n    },\n    \"balanced-match\": {\n      \"version\": \"1.0.2\",\n      \"resolved\": \"https://registry.npmmirror.com/balanced-match/-/balanced-match-1.0.2.tgz\",\n      \"integrity\": \"sha512-3oSeUO0TMV67hN1AmbXsK4yaqU7tjiHlbxRDZOpH0KW9+CeX4bRAaX0Anxt0tx2MrpRpWwQaPwIlISEJhYU5Pw==\",\n      \"dev\": true\n    },\n    \"base\": {\n      \"version\": \"0.11.2\",\n      \"resolved\": \"https://registry.npmmirror.com/base/-/base-0.11.2.tgz\",\n      \"integrity\": \"sha512-5T6P4xPgpp0YDFvSWwEZ4NoE3aM4QBQXDzmVbraCkFj8zHM+mba8SyqB5DbZWyR7mYHo6Y7BdQo3MoA4m0TeQg==\",\n      \"dev\": true,\n      \"optional\": true,\n      \"requires\": {\n        \"cache-base\": \"^1.0.1\",\n        \"class-utils\": \"^0.3.5\",\n        \"component-emitter\": \"^1.2.1\",\n        \"define-property\": \"^1.0.0\",\n        \"isobject\": \"^3.0.1\",\n        \"mixin-deep\": \"^1.2.0\",\n        \"pascalcase\": \"^0.1.1\"\n      },\n      \"dependencies\": {\n        \"define-property\": {\n          \"version\": \"1.0.0\",\n          \"resolved\": \"https://registry.npmmirror.com/define-property/-/define-property-1.0.0.tgz\",\n          \"integrity\": \"sha512-cZTYKFWspt9jZsMscWo8sc/5lbPC9Q0N5nBLgb+Yd915iL3udB1uFgS3B8YCx66UVHq018DAVFoee7x+gxggeA==\",\n          \"dev\": true,\n          \"optional\": true,\n          \"requires\": {\n            \"is-descriptor\": \"^1.0.0\"\n          }\n        },\n        \"is-accessor-descriptor\": {\n          \"version\": \"1.0.0\",\n          \"resolved\": \"https://registry.npmmirror.com/is-accessor-descriptor/-/is-accessor-descriptor-1.0.0.tgz\",\n          \"integrity\": \"sha512-m5hnHTkcVsPfqx3AKlyttIPb7J+XykHvJP2B9bZDjlhLIoEq4XoK64Vg7boZlVWYK6LUY94dYPEE7Lh0ZkZKcQ==\",\n          \"dev\": true,\n          \"optional\": true,\n          \"requires\": {\n            \"kind-of\": \"^6.0.0\"\n          }\n        },\n        \"is-data-descriptor\": {\n          \"version\": \"1.0.0\",\n          \"resolved\": \"https://registry.npmmirror.com/is-data-descriptor/-/is-data-descriptor-1.0.0.tgz\",\n          \"integrity\": \"sha512-jbRXy1FmtAoCjQkVmIVYwuuqDFUbaOeDjmed1tOGPrsMhtJA4rD9tkgA0F1qJ3gRFRXcHYVkdeaP50Q5rE/jLQ==\",\n          \"dev\": true,\n          \"optional\": true,\n          \"requires\": {\n            \"kind-of\": \"^6.0.0\"\n          }\n        },\n        \"is-descriptor\": {\n          \"version\": \"1.0.2\",\n          \"resolved\": \"https://registry.npmmirror.com/is-descriptor/-/is-descriptor-1.0.2.tgz\",\n          \"integrity\": \"sha512-2eis5WqQGV7peooDyLmNEPUrps9+SXX5c9pL3xEB+4e9HnGuDa7mB7kHxHw4CbqS9k1T2hOH3miL8n8WtiYVtg==\",\n          \"dev\": true,\n          \"optional\": true,\n          \"requires\": {\n            \"is-accessor-descriptor\": \"^1.0.0\",\n            \"is-data-descriptor\": \"^1.0.0\",\n            \"kind-of\": \"^6.0.2\"\n          }\n        },\n        \"isobject\": {\n          \"version\": \"3.0.1\",\n          \"resolved\": \"https://registry.npmmirror.com/isobject/-/isobject-3.0.1.tgz\",\n          \"integrity\": \"sha512-WhB9zCku7EGTj/HQQRz5aUQEUeoQZH2bWcltRErOpymJ4boYE6wL9Tbr23krRPSZ+C5zqNSrSw+Cc7sZZ4b7vg==\",\n          \"dev\": true,\n          \"optional\": true\n        },\n        \"kind-of\": {\n          \"version\": \"6.0.3\",\n          \"resolved\": \"https://registry.npmmirror.com/kind-of/-/kind-of-6.0.3.tgz\",\n          \"integrity\": \"sha512-dcS1ul+9tmeD95T+x28/ehLgd9mENa3LsvDTtzm3vyBEO7RPptvAD+t44WVXaUjTBRcrpFeFlC8WCruUR456hw==\",\n          \"dev\": true,\n          \"optional\": true\n        }\n      }\n    },\n    \"binary-extensions\": {\n      \"version\": \"1.13.1\",\n      \"resolved\": \"https://registry.npmmirror.com/binary-extensions/-/binary-extensions-1.13.1.tgz\",\n      \"integrity\": \"sha512-Un7MIEDdUC5gNpcGDV97op1Ywk748MpHcFTHoYs6qnj1Z3j7I53VG3nwZhKzoBZmbdRNnb6WRdFlwl7tSDuZGw==\",\n      \"dev\": true,\n      \"optional\": true\n    },\n    \"bindings\": {\n      \"version\": \"1.5.0\",\n      \"resolved\": \"https://registry.npmmirror.com/bindings/-/bindings-1.5.0.tgz\",\n      \"integrity\": \"sha512-p2q/t/mhvuOj/UeLlV6566GD/guowlr0hHxClI0W9m7MWYkL1F0hLo+0Aexs9HSPCtR1SXQ0TD3MMKrXZajbiQ==\",\n      \"dev\": true,\n      \"optional\": true,\n      \"requires\": {\n        \"file-uri-to-path\": \"1.0.0\"\n      }\n    },\n    \"brace-expansion\": {\n      \"version\": \"1.1.11\",\n      \"resolved\": \"https://registry.npmmirror.com/brace-expansion/-/brace-expansion-1.1.11.tgz\",\n      \"integrity\": \"sha512-iCuPHDFgrHX7H2vEI/5xpz07zSHB00TpugqhmYtVmMO6518mCuRMoOYFldEBl0g187ufozdaHgWKcYFb61qGiA==\",\n      \"dev\": true,\n      \"requires\": {\n        \"balanced-match\": \"^1.0.0\",\n        \"concat-map\": \"0.0.1\"\n      }\n    },\n    \"braces\": {\n      \"version\": \"1.8.5\",\n      \"resolved\": \"https://registry.npmmirror.com/braces/-/braces-1.8.5.tgz\",\n      \"integrity\": \"sha512-xU7bpz2ytJl1bH9cgIurjpg/n8Gohy9GTw81heDYLJQ4RU60dlyJsa+atVF2pI0yMMvKxI9HkKwjePCj5XI1hw==\",\n      \"dev\": true,\n      \"optional\": true,\n      \"requires\": {\n        \"expand-range\": \"^1.8.1\",\n        \"preserve\": \"^0.2.0\",\n        \"repeat-element\": \"^1.1.2\"\n      }\n    },\n    \"browserslist\": {\n      \"version\": \"3.2.8\",\n      \"resolved\": \"https://registry.npmmirror.com/browserslist/-/browserslist-3.2.8.tgz\",\n      \"integrity\": \"sha512-WHVocJYavUwVgVViC0ORikPHQquXwVh939TaelZ4WDqpWgTX/FsGhl/+P4qBUAGcRvtOgDgC+xftNWWp2RUTAQ==\",\n      \"dev\": true,\n      \"requires\": {\n        \"caniuse-lite\": \"^1.0.30000844\",\n        \"electron-to-chromium\": \"^1.3.47\"\n      }\n    },\n    \"cache-base\": {\n      \"version\": \"1.0.1\",\n      \"resolved\": \"https://registry.npmmirror.com/cache-base/-/cache-base-1.0.1.tgz\",\n      \"integrity\": \"sha512-AKcdTnFSWATd5/GCPRxr2ChwIJ85CeyrEyjRHlKxQ56d4XJMGym0uAiKn0xbLOGOl3+yRpOTi484dVCEc5AUzQ==\",\n      \"dev\": true,\n      \"optional\": true,\n      \"requires\": {\n        \"collection-visit\": \"^1.0.0\",\n        \"component-emitter\": \"^1.2.1\",\n        \"get-value\": \"^2.0.6\",\n        \"has-value\": \"^1.0.0\",\n        \"isobject\": \"^3.0.1\",\n        \"set-value\": \"^2.0.0\",\n        \"to-object-path\": \"^0.3.0\",\n        \"union-value\": \"^1.0.0\",\n        \"unset-value\": \"^1.0.0\"\n      },\n      \"dependencies\": {\n        \"isobject\": {\n          \"version\": \"3.0.1\",\n          \"resolved\": \"https://registry.npmmirror.com/isobject/-/isobject-3.0.1.tgz\",\n          \"integrity\": \"sha512-WhB9zCku7EGTj/HQQRz5aUQEUeoQZH2bWcltRErOpymJ4boYE6wL9Tbr23krRPSZ+C5zqNSrSw+Cc7sZZ4b7vg==\",\n          \"dev\": true,\n          \"optional\": true\n        }\n      }\n    },\n    \"caniuse-lite\": {\n      \"version\": \"1.0.30001486\",\n      \"resolved\": \"https://registry.npmmirror.com/caniuse-lite/-/caniuse-lite-1.0.30001486.tgz\",\n      \"integrity\": \"sha512-uv7/gXuHi10Whlj0pp5q/tsK/32J2QSqVRKQhs2j8VsDCjgyruAh/eEXHF822VqO9yT6iZKw3nRwZRSPBE9OQg==\",\n      \"dev\": true\n    },\n    \"chalk\": {\n      \"version\": \"1.1.3\",\n      \"resolved\": \"https://registry.npmmirror.com/chalk/-/chalk-1.1.3.tgz\",\n      \"integrity\": \"sha512-U3lRVLMSlsCfjqYPbLyVv11M9CPW4I728d6TCKMAOJueEeB9/8o+eSsMnxPJD+Q+K909sdESg7C+tIkoH6on1A==\",\n      \"dev\": true,\n      \"requires\": {\n        \"ansi-styles\": \"^2.2.1\",\n        \"escape-string-regexp\": \"^1.0.2\",\n        \"has-ansi\": \"^2.0.0\",\n        \"strip-ansi\": \"^3.0.0\",\n        \"supports-color\": \"^2.0.0\"\n      }\n    },\n    \"chokidar\": {\n      \"version\": \"1.7.0\",\n      \"resolved\": \"https://registry.npmmirror.com/chokidar/-/chokidar-1.7.0.tgz\",\n      \"integrity\": \"sha512-mk8fAWcRUOxY7btlLtitj3A45jOwSAxH4tOFOoEGbVsl6cL6pPMWUy7dwZ/canfj3QEdP6FHSnf/l1c6/WkzVg==\",\n      \"dev\": true,\n      \"optional\": true,\n      \"requires\": {\n        \"anymatch\": \"^1.3.0\",\n        \"async-each\": \"^1.0.0\",\n        \"fsevents\": \"^1.0.0\",\n        \"glob-parent\": \"^2.0.0\",\n        \"inherits\": \"^2.0.1\",\n        \"is-binary-path\": \"^1.0.0\",\n        \"is-glob\": \"^2.0.0\",\n        \"path-is-absolute\": \"^1.0.0\",\n        \"readdirp\": \"^2.0.0\"\n      }\n    },\n    \"class-utils\": {\n      \"version\": \"0.3.6\",\n      \"resolved\": \"https://registry.npmmirror.com/class-utils/-/class-utils-0.3.6.tgz\",\n      \"integrity\": \"sha512-qOhPa/Fj7s6TY8H8esGu5QNpMMQxz79h+urzrNYN6mn+9BnxlDGf5QZ+XeCDsxSjPqsSR56XOZOJmpeurnLMeg==\",\n      \"dev\": true,\n      \"optional\": true,\n      \"requires\": {\n        \"arr-union\": \"^3.1.0\",\n        \"define-property\": \"^0.2.5\",\n        \"isobject\": \"^3.0.0\",\n        \"static-extend\": \"^0.1.1\"\n      },\n      \"dependencies\": {\n        \"define-property\": {\n          \"version\": \"0.2.5\",\n          \"resolved\": \"https://registry.npmmirror.com/define-property/-/define-property-0.2.5.tgz\",\n          \"integrity\": \"sha512-Rr7ADjQZenceVOAKop6ALkkRAmH1A4Gx9hV/7ZujPUN2rkATqFO0JZLZInbAjpZYoJ1gUx8MRMQVkYemcbMSTA==\",\n          \"dev\": true,\n          \"optional\": true,\n          \"requires\": {\n            \"is-descriptor\": \"^0.1.0\"\n          }\n        },\n        \"isobject\": {\n          \"version\": \"3.0.1\",\n          \"resolved\": \"https://registry.npmmirror.com/isobject/-/isobject-3.0.1.tgz\",\n          \"integrity\": \"sha512-WhB9zCku7EGTj/HQQRz5aUQEUeoQZH2bWcltRErOpymJ4boYE6wL9Tbr23krRPSZ+C5zqNSrSw+Cc7sZZ4b7vg==\",\n          \"dev\": true,\n          \"optional\": true\n        }\n      }\n    },\n    \"collection-visit\": {\n      \"version\": \"1.0.0\",\n      \"resolved\": \"https://registry.npmmirror.com/collection-visit/-/collection-visit-1.0.0.tgz\",\n      \"integrity\": \"sha512-lNkKvzEeMBBjUGHZ+q6z9pSJla0KWAQPvtzhEV9+iGyQYG+pBpl7xKDhxoNSOZH2hhv0v5k0y2yAM4o4SjoSkw==\",\n      \"dev\": true,\n      \"optional\": true,\n      \"requires\": {\n        \"map-visit\": \"^1.0.0\",\n        \"object-visit\": \"^1.0.0\"\n      }\n    },\n    \"commander\": {\n      \"version\": \"2.20.3\",\n      \"resolved\": \"https://registry.npmmirror.com/commander/-/commander-2.20.3.tgz\",\n      \"integrity\": \"sha512-GpVkmM8vF2vQUkj2LvZmD35JxeJOLCwJ9cUkugyk2nuhbv3+mJvpLYYt+0+USMxE+oj+ey/lJEnhZw75x/OMcQ==\",\n      \"dev\": true\n    },\n    \"component-emitter\": {\n      \"version\": \"1.3.0\",\n      \"resolved\": \"https://registry.npmmirror.com/component-emitter/-/component-emitter-1.3.0.tgz\",\n      \"integrity\": \"sha512-Rd3se6QB+sO1TwqZjscQrurpEPIfO0/yYnSin6Q/rD3mOutHvUrCAhJub3r90uNb+SESBuE0QYoB90YdfatsRg==\",\n      \"dev\": true,\n      \"optional\": true\n    },\n    \"concat-map\": {\n      \"version\": \"0.0.1\",\n      \"resolved\": \"https://registry.npmmirror.com/concat-map/-/concat-map-0.0.1.tgz\",\n      \"integrity\": \"sha512-/Srv4dswyQNBfohGpz9o6Yb3Gz3SrUDqBH5rTuhGR7ahtlbYKnVxw2bCFMRljaA7EXHaXZ8wsHdodFvbkhKmqg==\",\n      \"dev\": true\n    },\n    \"convert-source-map\": {\n      \"version\": \"1.9.0\",\n      \"resolved\": \"https://registry.npmmirror.com/convert-source-map/-/convert-source-map-1.9.0.tgz\",\n      \"integrity\": \"sha512-ASFBup0Mz1uyiIjANan1jzLQami9z1PoYSZCiiYW2FczPbenXc45FZdBZLzOT+r6+iciuEModtmCti+hjaAk0A==\",\n      \"dev\": true\n    },\n    \"copy-descriptor\": {\n      \"version\": \"0.1.1\",\n      \"resolved\": \"https://registry.npmmirror.com/copy-descriptor/-/copy-descriptor-0.1.1.tgz\",\n      \"integrity\": \"sha512-XgZ0pFcakEUlbwQEVNg3+QAis1FyTL3Qel9FYy8pSkQqoG3PNoT0bOCQtOXcOkur21r2Eq2kI+IE+gsmAEVlYw==\",\n      \"dev\": true,\n      \"optional\": true\n    },\n    \"core-js\": {\n      \"version\": \"2.6.12\",\n      \"resolved\": \"https://registry.npmmirror.com/core-js/-/core-js-2.6.12.tgz\",\n      \"integrity\": \"sha512-Kb2wC0fvsWfQrgk8HU5lW6U/Lcs8+9aaYcy4ZFc6DDlo4nZ7n70dEgE5rtR0oG6ufKDUnrwfWL1mXR5ljDatrQ==\",\n      \"dev\": true\n    },\n    \"core-util-is\": {\n      \"version\": \"1.0.3\",\n      \"resolved\": \"https://registry.npmmirror.com/core-util-is/-/core-util-is-1.0.3.tgz\",\n      \"integrity\": \"sha512-ZQBvi1DcpJ4GDqanjucZ2Hj3wEO5pZDS89BWbkcrvdxksJorwUDDZamX9ldFkp9aw2lmBDLgkObEA4DWNJ9FYQ==\",\n      \"dev\": true,\n      \"optional\": true\n    },\n    \"debug\": {\n      \"version\": \"2.6.9\",\n      \"resolved\": \"https://registry.npmmirror.com/debug/-/debug-2.6.9.tgz\",\n      \"integrity\": \"sha512-bC7ElrdJaJnPbAP+1EotYvqZsb3ecl5wi6Bfi6BJTUcNowp6cvspg0jXznRTKDjm/E7AdgFBVeAPVMNcKGsHMA==\",\n      \"dev\": true,\n      \"requires\": {\n        \"ms\": \"2.0.0\"\n      }\n    },\n    \"decode-uri-component\": {\n      \"version\": \"0.2.2\",\n      \"resolved\": \"https://registry.npmmirror.com/decode-uri-component/-/decode-uri-component-0.2.2.tgz\",\n      \"integrity\": \"sha512-FqUYQ+8o158GyGTrMFJms9qh3CqTKvAqgqsTnkLI8sKu0028orqBhxNMFkFen0zGyg6epACD32pjVk58ngIErQ==\",\n      \"dev\": true,\n      \"optional\": true\n    },\n    \"define-property\": {\n      \"version\": \"2.0.2\",\n      \"resolved\": \"https://registry.npmmirror.com/define-property/-/define-property-2.0.2.tgz\",\n      \"integrity\": \"sha512-jwK2UV4cnPpbcG7+VRARKTZPUWowwXA8bzH5NP6ud0oeAxyYPuGZUAC7hMugpCdz4BeSZl2Dl9k66CHJ/46ZYQ==\",\n      \"dev\": true,\n      \"optional\": true,\n      \"requires\": {\n        \"is-descriptor\": \"^1.0.2\",\n        \"isobject\": \"^3.0.1\"\n      },\n      \"dependencies\": {\n        \"is-accessor-descriptor\": {\n          \"version\": \"1.0.0\",\n          \"resolved\": \"https://registry.npmmirror.com/is-accessor-descriptor/-/is-accessor-descriptor-1.0.0.tgz\",\n          \"integrity\": \"sha512-m5hnHTkcVsPfqx3AKlyttIPb7J+XykHvJP2B9bZDjlhLIoEq4XoK64Vg7boZlVWYK6LUY94dYPEE7Lh0ZkZKcQ==\",\n          \"dev\": true,\n          \"optional\": true,\n          \"requires\": {\n            \"kind-of\": \"^6.0.0\"\n          }\n        },\n        \"is-data-descriptor\": {\n          \"version\": \"1.0.0\",\n          \"resolved\": \"https://registry.npmmirror.com/is-data-descriptor/-/is-data-descriptor-1.0.0.tgz\",\n          \"integrity\": \"sha512-jbRXy1FmtAoCjQkVmIVYwuuqDFUbaOeDjmed1tOGPrsMhtJA4rD9tkgA0F1qJ3gRFRXcHYVkdeaP50Q5rE/jLQ==\",\n          \"dev\": true,\n          \"optional\": true,\n          \"requires\": {\n            \"kind-of\": \"^6.0.0\"\n          }\n        },\n        \"is-descriptor\": {\n          \"version\": \"1.0.2\",\n          \"resolved\": \"https://registry.npmmirror.com/is-descriptor/-/is-descriptor-1.0.2.tgz\",\n          \"integrity\": \"sha512-2eis5WqQGV7peooDyLmNEPUrps9+SXX5c9pL3xEB+4e9HnGuDa7mB7kHxHw4CbqS9k1T2hOH3miL8n8WtiYVtg==\",\n          \"dev\": true,\n          \"optional\": true,\n          \"requires\": {\n            \"is-accessor-descriptor\": \"^1.0.0\",\n            \"is-data-descriptor\": \"^1.0.0\",\n            \"kind-of\": \"^6.0.2\"\n          }\n        },\n        \"isobject\": {\n          \"version\": \"3.0.1\",\n          \"resolved\": \"https://registry.npmmirror.com/isobject/-/isobject-3.0.1.tgz\",\n          \"integrity\": \"sha512-WhB9zCku7EGTj/HQQRz5aUQEUeoQZH2bWcltRErOpymJ4boYE6wL9Tbr23krRPSZ+C5zqNSrSw+Cc7sZZ4b7vg==\",\n          \"dev\": true,\n          \"optional\": true\n        },\n        \"kind-of\": {\n          \"version\": \"6.0.3\",\n          \"resolved\": \"https://registry.npmmirror.com/kind-of/-/kind-of-6.0.3.tgz\",\n          \"integrity\": \"sha512-dcS1ul+9tmeD95T+x28/ehLgd9mENa3LsvDTtzm3vyBEO7RPptvAD+t44WVXaUjTBRcrpFeFlC8WCruUR456hw==\",\n          \"dev\": true,\n          \"optional\": true\n        }\n      }\n    },\n    \"detect-indent\": {\n      \"version\": \"4.0.0\",\n      \"resolved\": \"https://registry.npmmirror.com/detect-indent/-/detect-indent-4.0.0.tgz\",\n      \"integrity\": \"sha512-BDKtmHlOzwI7iRuEkhzsnPoi5ypEhWAJB5RvHWe1kMr06js3uK5B3734i3ui5Yd+wOJV1cpE4JnivPD283GU/A==\",\n      \"dev\": true,\n      \"requires\": {\n        \"repeating\": \"^2.0.0\"\n      }\n    },\n    \"electron-to-chromium\": {\n      \"version\": \"1.4.392\",\n      \"resolved\": \"https://registry.npmmirror.com/electron-to-chromium/-/electron-to-chromium-1.4.392.tgz\",\n      \"integrity\": \"sha512-TXQOMW9tnhIms3jGy/lJctLjICOgyueZFJ1KUtm6DTQ+QpxX3p7ZBwB6syuZ9KBuT5S4XX7bgY1ECPgfxKUdOg==\",\n      \"dev\": true\n    },\n    \"escape-string-regexp\": {\n      \"version\": \"1.0.5\",\n      \"resolved\": \"https://registry.npmmirror.com/escape-string-regexp/-/escape-string-regexp-1.0.5.tgz\",\n      \"integrity\": \"sha512-vbRorB5FUQWvla16U8R/qgaFIya2qGzwDrNmCZuYKrbdSUMG6I1ZCGQRefkRVhuOkIGVne7BQ35DSfo1qvJqFg==\",\n      \"dev\": true\n    },\n    \"esutils\": {\n      \"version\": \"2.0.3\",\n      \"resolved\": \"https://registry.npmmirror.com/esutils/-/esutils-2.0.3.tgz\",\n      \"integrity\": \"sha512-kVscqXk4OCp68SZ0dkgEKVi6/8ij300KBWTJq32P/dYeWTSwK41WyTxalN1eRmA5Z9UU/LX9D7FWSmV9SAYx6g==\",\n      \"dev\": true\n    },\n    \"expand-brackets\": {\n      \"version\": \"0.1.5\",\n      \"resolved\": \"https://registry.npmmirror.com/expand-brackets/-/expand-brackets-0.1.5.tgz\",\n      \"integrity\": \"sha512-hxx03P2dJxss6ceIeri9cmYOT4SRs3Zk3afZwWpOsRqLqprhTR8u++SlC+sFGsQr7WGFPdMF7Gjc1njDLDK6UA==\",\n      \"dev\": true,\n      \"optional\": true,\n      \"requires\": {\n        \"is-posix-bracket\": \"^0.1.0\"\n      }\n    },\n    \"expand-range\": {\n      \"version\": \"1.8.2\",\n      \"resolved\": \"https://registry.npmmirror.com/expand-range/-/expand-range-1.8.2.tgz\",\n      \"integrity\": \"sha512-AFASGfIlnIbkKPQwX1yHaDjFvh/1gyKJODme52V6IORh69uEYgZp0o9C+qsIGNVEiuuhQU0CSSl++Rlegg1qvA==\",\n      \"dev\": true,\n      \"optional\": true,\n      \"requires\": {\n        \"fill-range\": \"^2.1.0\"\n      }\n    },\n    \"extend-shallow\": {\n      \"version\": \"3.0.2\",\n      \"resolved\": \"https://registry.npmmirror.com/extend-shallow/-/extend-shallow-3.0.2.tgz\",\n      \"integrity\": \"sha512-BwY5b5Ql4+qZoefgMj2NUmx+tehVTH/Kf4k1ZEtOHNFcm2wSxMRo992l6X3TIgni2eZVTZ85xMOjF31fwZAj6Q==\",\n      \"dev\": true,\n      \"optional\": true,\n      \"requires\": {\n        \"assign-symbols\": \"^1.0.0\",\n        \"is-extendable\": \"^1.0.1\"\n      },\n      \"dependencies\": {\n        \"is-extendable\": {\n          \"version\": \"1.0.1\",\n          \"resolved\": \"https://registry.npmmirror.com/is-extendable/-/is-extendable-1.0.1.tgz\",\n          \"integrity\": \"sha512-arnXMxT1hhoKo9k1LZdmlNyJdDDfy2v0fXjFlmok4+i8ul/6WlbVge9bhM74OpNPQPMGUToDtz+KXa1PneJxOA==\",\n          \"dev\": true,\n          \"optional\": true,\n          \"requires\": {\n            \"is-plain-object\": \"^2.0.4\"\n          }\n        }\n      }\n    },\n    \"extglob\": {\n      \"version\": \"0.3.2\",\n      \"resolved\": \"https://registry.npmmirror.com/extglob/-/extglob-0.3.2.tgz\",\n      \"integrity\": \"sha512-1FOj1LOwn42TMrruOHGt18HemVnbwAmAak7krWk+wa93KXxGbK+2jpezm+ytJYDaBX0/SPLZFHKM7m+tKobWGg==\",\n      \"dev\": true,\n      \"optional\": true,\n      \"requires\": {\n        \"is-extglob\": \"^1.0.0\"\n      }\n    },\n    \"file-uri-to-path\": {\n      \"version\": \"1.0.0\",\n      \"resolved\": \"https://registry.npmmirror.com/file-uri-to-path/-/file-uri-to-path-1.0.0.tgz\",\n      \"integrity\": \"sha512-0Zt+s3L7Vf1biwWZ29aARiVYLx7iMGnEUl9x33fbB/j3jR81u/O2LbqK+Bm1CDSNDKVtJ/YjwY7TUd5SkeLQLw==\",\n      \"dev\": true,\n      \"optional\": true\n    },\n    \"filename-regex\": {\n      \"version\": \"2.0.1\",\n      \"resolved\": \"https://registry.npmmirror.com/filename-regex/-/filename-regex-2.0.1.tgz\",\n      \"integrity\": \"sha512-BTCqyBaWBTsauvnHiE8i562+EdJj+oUpkqWp2R1iCoR8f6oo8STRu3of7WJJ0TqWtxN50a5YFpzYK4Jj9esYfQ==\",\n      \"dev\": true,\n      \"optional\": true\n    },\n    \"fill-range\": {\n      \"version\": \"2.2.4\",\n      \"resolved\": \"https://registry.npmmirror.com/fill-range/-/fill-range-2.2.4.tgz\",\n      \"integrity\": \"sha512-cnrcCbj01+j2gTG921VZPnHbjmdAf8oQV/iGeV2kZxGSyfYjjTyY79ErsK1WJWMpw6DaApEX72binqJE+/d+5Q==\",\n      \"dev\": true,\n      \"optional\": true,\n      \"requires\": {\n        \"is-number\": \"^2.1.0\",\n        \"isobject\": \"^2.0.0\",\n        \"randomatic\": \"^3.0.0\",\n        \"repeat-element\": \"^1.1.2\",\n        \"repeat-string\": \"^1.5.2\"\n      }\n    },\n    \"for-in\": {\n      \"version\": \"1.0.2\",\n      \"resolved\": \"https://registry.npmmirror.com/for-in/-/for-in-1.0.2.tgz\",\n      \"integrity\": \"sha512-7EwmXrOjyL+ChxMhmG5lnW9MPt1aIeZEwKhQzoBUdTV0N3zuwWDZYVJatDvZ2OyzPUvdIAZDsCetk3coyMfcnQ==\",\n      \"dev\": true,\n      \"optional\": true\n    },\n    \"for-own\": {\n      \"version\": \"0.1.5\",\n      \"resolved\": \"https://registry.npmmirror.com/for-own/-/for-own-0.1.5.tgz\",\n      \"integrity\": \"sha512-SKmowqGTJoPzLO1T0BBJpkfp3EMacCMOuH40hOUbrbzElVktk4DioXVM99QkLCyKoiuOmyjgcWMpVz2xjE7LZw==\",\n      \"dev\": true,\n      \"optional\": true,\n      \"requires\": {\n        \"for-in\": \"^1.0.1\"\n      }\n    },\n    \"fragment-cache\": {\n      \"version\": \"0.2.1\",\n      \"resolved\": \"https://registry.npmmirror.com/fragment-cache/-/fragment-cache-0.2.1.tgz\",\n      \"integrity\": \"sha512-GMBAbW9antB8iZRHLoGw0b3HANt57diZYFO/HL1JGIC1MjKrdmhxvrJbupnVvpys0zsz7yBApXdQyfepKly2kA==\",\n      \"dev\": true,\n      \"optional\": true,\n      \"requires\": {\n        \"map-cache\": \"^0.2.2\"\n      }\n    },\n    \"fs-readdir-recursive\": {\n      \"version\": \"1.1.0\",\n      \"resolved\": \"https://registry.npmmirror.com/fs-readdir-recursive/-/fs-readdir-recursive-1.1.0.tgz\",\n      \"integrity\": \"sha512-GNanXlVr2pf02+sPN40XN8HG+ePaNcvM0q5mZBd668Obwb0yD5GiUbZOFgwn8kGMY6I3mdyDJzieUy3PTYyTRA==\",\n      \"dev\": true\n    },\n    \"fs.realpath\": {\n      \"version\": \"1.0.0\",\n      \"resolved\": \"https://registry.npmmirror.com/fs.realpath/-/fs.realpath-1.0.0.tgz\",\n      \"integrity\": \"sha512-OO0pH2lK6a0hZnAdau5ItzHPI6pUlvI7jMVnxUQRtw4owF2wk8lOSabtGDCTP4Ggrg2MbGnWO9X8K1t4+fGMDw==\",\n      \"dev\": true\n    },\n    \"fsevents\": {\n      \"version\": \"1.2.13\",\n      \"resolved\": \"https://registry.npmmirror.com/fsevents/-/fsevents-1.2.13.tgz\",\n      \"integrity\": \"sha512-oWb1Z6mkHIskLzEJ/XWX0srkpkTQ7vaopMQkyaEIoq0fmtFVxOthb8cCxeT+p3ynTdkk/RZwbgG4brR5BeWECw==\",\n      \"dev\": true,\n      \"optional\": true,\n      \"requires\": {\n        \"bindings\": \"^1.5.0\",\n        \"nan\": \"^2.12.1\"\n      }\n    },\n    \"get-value\": {\n      \"version\": \"2.0.6\",\n      \"resolved\": \"https://registry.npmmirror.com/get-value/-/get-value-2.0.6.tgz\",\n      \"integrity\": \"sha512-Ln0UQDlxH1BapMu3GPtf7CuYNwRZf2gwCuPqbyG6pB8WfmFpzqcy4xtAaAMUhnNqjMKTiCPZG2oMT3YSx8U2NA==\",\n      \"dev\": true,\n      \"optional\": true\n    },\n    \"glob\": {\n      \"version\": \"7.2.3\",\n      \"resolved\": \"https://registry.npmmirror.com/glob/-/glob-7.2.3.tgz\",\n      \"integrity\": \"sha512-nFR0zLpU2YCaRxwoCJvL6UvCH2JFyFVIvwTLsIf21AuHlMskA1hhTdk+LlYJtOlYt9v6dvszD2BGRqBL+iQK9Q==\",\n      \"dev\": true,\n      \"requires\": {\n        \"fs.realpath\": \"^1.0.0\",\n        \"inflight\": \"^1.0.4\",\n        \"inherits\": \"2\",\n        \"minimatch\": \"^3.1.1\",\n        \"once\": \"^1.3.0\",\n        \"path-is-absolute\": \"^1.0.0\"\n      }\n    },\n    \"glob-base\": {\n      \"version\": \"0.3.0\",\n      \"resolved\": \"https://registry.npmmirror.com/glob-base/-/glob-base-0.3.0.tgz\",\n      \"integrity\": \"sha512-ab1S1g1EbO7YzauaJLkgLp7DZVAqj9M/dvKlTt8DkXA2tiOIcSMrlVI2J1RZyB5iJVccEscjGn+kpOG9788MHA==\",\n      \"dev\": true,\n      \"optional\": true,\n      \"requires\": {\n        \"glob-parent\": \"^2.0.0\",\n        \"is-glob\": \"^2.0.0\"\n      }\n    },\n    \"glob-parent\": {\n      \"version\": \"2.0.0\",\n      \"resolved\": \"https://registry.npmmirror.com/glob-parent/-/glob-parent-2.0.0.tgz\",\n      \"integrity\": \"sha512-JDYOvfxio/t42HKdxkAYaCiBN7oYiuxykOxKxdaUW5Qn0zaYN3gRQWolrwdnf0shM9/EP0ebuuTmyoXNr1cC5w==\",\n      \"dev\": true,\n      \"optional\": true,\n      \"requires\": {\n        \"is-glob\": \"^2.0.0\"\n      }\n    },\n    \"globals\": {\n      \"version\": \"9.18.0\",\n      \"resolved\": \"https://registry.npmmirror.com/globals/-/globals-9.18.0.tgz\",\n      \"integrity\": \"sha512-S0nG3CLEQiY/ILxqtztTWH/3iRRdyBLw6KMDxnKMchrtbj2OFmehVh0WUCfW3DUrIgx/qFrJPICrq4Z4sTR9UQ==\",\n      \"dev\": true\n    },\n    \"graceful-fs\": {\n      \"version\": \"4.2.11\",\n      \"resolved\": \"https://registry.npmmirror.com/graceful-fs/-/graceful-fs-4.2.11.tgz\",\n      \"integrity\": \"sha512-RbJ5/jmFcNNCcDV5o9eTnBLJ/HszWV0P73bc+Ff4nS/rJj+YaS6IGyiOL0VoBYX+l1Wrl3k63h/KrH+nhJ0XvQ==\",\n      \"dev\": true\n    },\n    \"has-ansi\": {\n      \"version\": \"2.0.0\",\n      \"resolved\": \"https://registry.npmmirror.com/has-ansi/-/has-ansi-2.0.0.tgz\",\n      \"integrity\": \"sha512-C8vBJ8DwUCx19vhm7urhTuUsr4/IyP6l4VzNQDv+ryHQObW3TTTp9yB68WpYgRe2bbaGuZ/se74IqFeVnMnLZg==\",\n      \"dev\": true,\n      \"requires\": {\n        \"ansi-regex\": \"^2.0.0\"\n      }\n    },\n    \"has-value\": {\n      \"version\": \"1.0.0\",\n      \"resolved\": \"https://registry.npmmirror.com/has-value/-/has-value-1.0.0.tgz\",\n      \"integrity\": \"sha512-IBXk4GTsLYdQ7Rvt+GRBrFSVEkmuOUy4re0Xjd9kJSUQpnTrWR4/y9RpfexN9vkAPMFuQoeWKwqzPozRTlasGw==\",\n      \"dev\": true,\n      \"optional\": true,\n      \"requires\": {\n        \"get-value\": \"^2.0.6\",\n        \"has-values\": \"^1.0.0\",\n        \"isobject\": \"^3.0.0\"\n      },\n      \"dependencies\": {\n        \"isobject\": {\n          \"version\": \"3.0.1\",\n          \"resolved\": \"https://registry.npmmirror.com/isobject/-/isobject-3.0.1.tgz\",\n          \"integrity\": \"sha512-WhB9zCku7EGTj/HQQRz5aUQEUeoQZH2bWcltRErOpymJ4boYE6wL9Tbr23krRPSZ+C5zqNSrSw+Cc7sZZ4b7vg==\",\n          \"dev\": true,\n          \"optional\": true\n        }\n      }\n    },\n    \"has-values\": {\n      \"version\": \"1.0.0\",\n      \"resolved\": \"https://registry.npmmirror.com/has-values/-/has-values-1.0.0.tgz\",\n      \"integrity\": \"sha512-ODYZC64uqzmtfGMEAX/FvZiRyWLpAC3vYnNunURUnkGVTS+mI0smVsWaPydRBsE3g+ok7h960jChO8mFcWlHaQ==\",\n      \"dev\": true,\n      \"optional\": true,\n      \"requires\": {\n        \"is-number\": \"^3.0.0\",\n        \"kind-of\": \"^4.0.0\"\n      },\n      \"dependencies\": {\n        \"is-number\": {\n          \"version\": \"3.0.0\",\n          \"resolved\": \"https://registry.npmmirror.com/is-number/-/is-number-3.0.0.tgz\",\n          \"integrity\": \"sha512-4cboCqIpliH+mAvFNegjZQ4kgKc3ZUhQVr3HvWbSh5q3WH2v82ct+T2Y1hdU5Gdtorx/cLifQjqCbL7bpznLTg==\",\n          \"dev\": true,\n          \"optional\": true,\n          \"requires\": {\n            \"kind-of\": \"^3.0.2\"\n          },\n          \"dependencies\": {\n            \"kind-of\": {\n              \"version\": \"3.2.2\",\n              \"resolved\": \"https://registry.npmmirror.com/kind-of/-/kind-of-3.2.2.tgz\",\n              \"integrity\": \"sha512-NOW9QQXMoZGg/oqnVNoNTTIFEIid1627WCffUBJEdMxYApq7mNE7CpzucIPc+ZQg25Phej7IJSmX3hO+oblOtQ==\",\n              \"dev\": true,\n              \"optional\": true,\n              \"requires\": {\n                \"is-buffer\": \"^1.1.5\"\n              }\n            }\n          }\n        },\n        \"kind-of\": {\n          \"version\": \"4.0.0\",\n          \"resolved\": \"https://registry.npmmirror.com/kind-of/-/kind-of-4.0.0.tgz\",\n          \"integrity\": \"sha512-24XsCxmEbRwEDbz/qz3stgin8TTzZ1ESR56OMCN0ujYg+vRutNSiOj9bHH9u85DKgXguraugV5sFuvbD4FW/hw==\",\n          \"dev\": true,\n          \"optional\": true,\n          \"requires\": {\n            \"is-buffer\": \"^1.1.5\"\n          }\n        }\n      }\n    },\n    \"home-or-tmp\": {\n      \"version\": \"2.0.0\",\n      \"resolved\": \"https://registry.npmmirror.com/home-or-tmp/-/home-or-tmp-2.0.0.tgz\",\n      \"integrity\": \"sha512-ycURW7oUxE2sNiPVw1HVEFsW+ecOpJ5zaj7eC0RlwhibhRBod20muUN8qu/gzx956YrLolVvs1MTXwKgC2rVEg==\",\n      \"dev\": true,\n      \"requires\": {\n        \"os-homedir\": \"^1.0.0\",\n        \"os-tmpdir\": \"^1.0.1\"\n      }\n    },\n    \"inflight\": {\n      \"version\": \"1.0.6\",\n      \"resolved\": \"https://registry.npmmirror.com/inflight/-/inflight-1.0.6.tgz\",\n      \"integrity\": \"sha512-k92I/b08q4wvFscXCLvqfsHCrjrF7yiXsQuIVvVE7N82W3+aqpzuUdBbfhWcy/FZR3/4IgflMgKLOsvPDrGCJA==\",\n      \"dev\": true,\n      \"requires\": {\n        \"once\": \"^1.3.0\",\n        \"wrappy\": \"1\"\n      }\n    },\n    \"inherits\": {\n      \"version\": \"2.0.4\",\n      \"resolved\": \"https://registry.npmmirror.com/inherits/-/inherits-2.0.4.tgz\",\n      \"integrity\": \"sha512-k/vGaX4/Yla3WzyMCvTQOXYeIHvqOKtnqBduzTHpzpQZzAskKMhZ2K+EnBiSM9zGSoIFeMpXKxa4dYeZIQqewQ==\",\n      \"dev\": true\n    },\n    \"invariant\": {\n      \"version\": \"2.2.4\",\n      \"resolved\": \"https://registry.npmmirror.com/invariant/-/invariant-2.2.4.tgz\",\n      \"integrity\": \"sha512-phJfQVBuaJM5raOpJjSfkiD6BpbCE4Ns//LaXl6wGYtUBY83nWS6Rf9tXm2e8VaK60JEjYldbPif/A2B1C2gNA==\",\n      \"dev\": true,\n      \"requires\": {\n        \"loose-envify\": \"^1.0.0\"\n      }\n    },\n    \"is-accessor-descriptor\": {\n      \"version\": \"0.1.6\",\n      \"resolved\": \"https://registry.npmmirror.com/is-accessor-descriptor/-/is-accessor-descriptor-0.1.6.tgz\",\n      \"integrity\": \"sha512-e1BM1qnDbMRG3ll2U9dSK0UMHuWOs3pY3AtcFsmvwPtKL3MML/Q86i+GilLfvqEs4GW+ExB91tQ3Ig9noDIZ+A==\",\n      \"dev\": true,\n      \"optional\": true,\n      \"requires\": {\n        \"kind-of\": \"^3.0.2\"\n      }\n    },\n    \"is-binary-path\": {\n      \"version\": \"1.0.1\",\n      \"resolved\": \"https://registry.npmmirror.com/is-binary-path/-/is-binary-path-1.0.1.tgz\",\n      \"integrity\": \"sha512-9fRVlXc0uCxEDj1nQzaWONSpbTfx0FmJfzHF7pwlI8DkWGoHBBea4Pg5Ky0ojwwxQmnSifgbKkI06Qv0Ljgj+Q==\",\n      \"dev\": true,\n      \"optional\": true,\n      \"requires\": {\n        \"binary-extensions\": \"^1.0.0\"\n      }\n    },\n    \"is-buffer\": {\n      \"version\": \"1.1.6\",\n      \"resolved\": \"https://registry.npmmirror.com/is-buffer/-/is-buffer-1.1.6.tgz\",\n      \"integrity\": \"sha512-NcdALwpXkTm5Zvvbk7owOUSvVvBKDgKP5/ewfXEznmQFfs4ZRmanOeKBTjRVjka3QFoN6XJ+9F3USqfHqTaU5w==\",\n      \"dev\": true,\n      \"optional\": true\n    },\n    \"is-data-descriptor\": {\n      \"version\": \"0.1.4\",\n      \"resolved\": \"https://registry.npmmirror.com/is-data-descriptor/-/is-data-descriptor-0.1.4.tgz\",\n      \"integrity\": \"sha512-+w9D5ulSoBNlmw9OHn3U2v51SyoCd0he+bB3xMl62oijhrspxowjU+AIcDY0N3iEJbUEkB15IlMASQsxYigvXg==\",\n      \"dev\": true,\n      \"optional\": true,\n      \"requires\": {\n        \"kind-of\": \"^3.0.2\"\n      }\n    },\n    \"is-descriptor\": {\n      \"version\": \"0.1.6\",\n      \"resolved\": \"https://registry.npmmirror.com/is-descriptor/-/is-descriptor-0.1.6.tgz\",\n      \"integrity\": \"sha512-avDYr0SB3DwO9zsMov0gKCESFYqCnE4hq/4z3TdUlukEy5t9C0YRq7HLrsN52NAcqXKaepeCD0n+B0arnVG3Hg==\",\n      \"dev\": true,\n      \"optional\": true,\n      \"requires\": {\n        \"is-accessor-descriptor\": \"^0.1.6\",\n        \"is-data-descriptor\": \"^0.1.4\",\n        \"kind-of\": \"^5.0.0\"\n      },\n      \"dependencies\": {\n        \"kind-of\": {\n          \"version\": \"5.1.0\",\n          \"resolved\": \"https://registry.npmmirror.com/kind-of/-/kind-of-5.1.0.tgz\",\n          \"integrity\": \"sha512-NGEErnH6F2vUuXDh+OlbcKW7/wOcfdRHaZ7VWtqCztfHri/++YKmP51OdWeGPuqCOba6kk2OTe5d02VmTB80Pw==\",\n          \"dev\": true,\n          \"optional\": true\n        }\n      }\n    },\n    \"is-dotfile\": {\n      \"version\": \"1.0.3\",\n      \"resolved\": \"https://registry.npmmirror.com/is-dotfile/-/is-dotfile-1.0.3.tgz\",\n      \"integrity\": \"sha512-9YclgOGtN/f8zx0Pr4FQYMdibBiTaH3sn52vjYip4ZSf6C4/6RfTEZ+MR4GvKhCxdPh21Bg42/WL55f6KSnKpg==\",\n      \"dev\": true,\n      \"optional\": true\n    },\n    \"is-equal-shallow\": {\n      \"version\": \"0.1.3\",\n      \"resolved\": \"https://registry.npmmirror.com/is-equal-shallow/-/is-equal-shallow-0.1.3.tgz\",\n      \"integrity\": \"sha512-0EygVC5qPvIyb+gSz7zdD5/AAoS6Qrx1e//6N4yv4oNm30kqvdmG66oZFWVlQHUWe5OjP08FuTw2IdT0EOTcYA==\",\n      \"dev\": true,\n      \"optional\": true,\n      \"requires\": {\n        \"is-primitive\": \"^2.0.0\"\n      }\n    },\n    \"is-extendable\": {\n      \"version\": \"0.1.1\",\n      \"resolved\": \"https://registry.npmmirror.com/is-extendable/-/is-extendable-0.1.1.tgz\",\n      \"integrity\": \"sha512-5BMULNob1vgFX6EjQw5izWDxrecWK9AM72rugNr0TFldMOi0fj6Jk+zeKIt0xGj4cEfQIJth4w3OKWOJ4f+AFw==\",\n      \"dev\": true,\n      \"optional\": true\n    },\n    \"is-extglob\": {\n      \"version\": \"1.0.0\",\n      \"resolved\": \"https://registry.npmmirror.com/is-extglob/-/is-extglob-1.0.0.tgz\",\n      \"integrity\": \"sha512-7Q+VbVafe6x2T+Tu6NcOf6sRklazEPmBoB3IWk3WdGZM2iGUwU/Oe3Wtq5lSEkDTTlpp8yx+5t4pzO/i9Ty1ww==\",\n      \"dev\": true,\n      \"optional\": true\n    },\n    \"is-finite\": {\n      \"version\": \"1.1.0\",\n      \"resolved\": \"https://registry.npmmirror.com/is-finite/-/is-finite-1.1.0.tgz\",\n      \"integrity\": \"sha512-cdyMtqX/BOqqNBBiKlIVkytNHm49MtMlYyn1zxzvJKWmFMlGzm+ry5BBfYyeY9YmNKbRSo/o7OX9w9ale0wg3w==\",\n      \"dev\": true\n    },\n    \"is-glob\": {\n      \"version\": \"2.0.1\",\n      \"resolved\": \"https://registry.npmmirror.com/is-glob/-/is-glob-2.0.1.tgz\",\n      \"integrity\": \"sha512-a1dBeB19NXsf/E0+FHqkagizel/LQw2DjSQpvQrj3zT+jYPpaUCryPnrQajXKFLCMuf4I6FhRpaGtw4lPrG6Eg==\",\n      \"dev\": true,\n      \"optional\": true,\n      \"requires\": {\n        \"is-extglob\": \"^1.0.0\"\n      }\n    },\n    \"is-number\": {\n      \"version\": \"2.1.0\",\n      \"resolved\": \"https://registry.npmmirror.com/is-number/-/is-number-2.1.0.tgz\",\n      \"integrity\": \"sha512-QUzH43Gfb9+5yckcrSA0VBDwEtDUchrk4F6tfJZQuNzDJbEDB9cZNzSfXGQ1jqmdDY/kl41lUOWM9syA8z8jlg==\",\n      \"dev\": true,\n      \"optional\": true,\n      \"requires\": {\n        \"kind-of\": \"^3.0.2\"\n      }\n    },\n    \"is-plain-object\": {\n      \"version\": \"2.0.4\",\n      \"resolved\": \"https://registry.npmmirror.com/is-plain-object/-/is-plain-object-2.0.4.tgz\",\n      \"integrity\": \"sha512-h5PpgXkWitc38BBMYawTYMWJHFZJVnBquFE57xFpjB8pJFiF6gZ+bU+WyI/yqXiFR5mdLsgYNaPe8uao6Uv9Og==\",\n      \"dev\": true,\n      \"optional\": true,\n      \"requires\": {\n        \"isobject\": \"^3.0.1\"\n      },\n      \"dependencies\": {\n        \"isobject\": {\n          \"version\": \"3.0.1\",\n          \"resolved\": \"https://registry.npmmirror.com/isobject/-/isobject-3.0.1.tgz\",\n          \"integrity\": \"sha512-WhB9zCku7EGTj/HQQRz5aUQEUeoQZH2bWcltRErOpymJ4boYE6wL9Tbr23krRPSZ+C5zqNSrSw+Cc7sZZ4b7vg==\",\n          \"dev\": true,\n          \"optional\": true\n        }\n      }\n    },\n    \"is-posix-bracket\": {\n      \"version\": \"0.1.1\",\n      \"resolved\": \"https://registry.npmmirror.com/is-posix-bracket/-/is-posix-bracket-0.1.1.tgz\",\n      \"integrity\": \"sha512-Yu68oeXJ7LeWNmZ3Zov/xg/oDBnBK2RNxwYY1ilNJX+tKKZqgPK+qOn/Gs9jEu66KDY9Netf5XLKNGzas/vPfQ==\",\n      \"dev\": true,\n      \"optional\": true\n    },\n    \"is-primitive\": {\n      \"version\": \"2.0.0\",\n      \"resolved\": \"https://registry.npmmirror.com/is-primitive/-/is-primitive-2.0.0.tgz\",\n      \"integrity\": \"sha512-N3w1tFaRfk3UrPfqeRyD+GYDASU3W5VinKhlORy8EWVf/sIdDL9GAcew85XmktCfH+ngG7SRXEVDoO18WMdB/Q==\",\n      \"dev\": true,\n      \"optional\": true\n    },\n    \"is-windows\": {\n      \"version\": \"1.0.2\",\n      \"resolved\": \"https://registry.npmmirror.com/is-windows/-/is-windows-1.0.2.tgz\",\n      \"integrity\": \"sha512-eXK1UInq2bPmjyX6e3VHIzMLobc4J94i4AWn+Hpq3OU5KkrRC96OAcR3PRJ/pGu6m8TRnBHP9dkXQVsT/COVIA==\",\n      \"dev\": true,\n      \"optional\": true\n    },\n    \"isarray\": {\n      \"version\": \"1.0.0\",\n      \"resolved\": \"https://registry.npmmirror.com/isarray/-/isarray-1.0.0.tgz\",\n      \"integrity\": \"sha512-VLghIWNM6ELQzo7zwmcg0NmTVyWKYjvIeM83yjp0wRDTmUnrM678fQbcKBo6n2CJEF0szoG//ytg+TKla89ALQ==\",\n      \"dev\": true,\n      \"optional\": true\n    },\n    \"isobject\": {\n      \"version\": \"2.1.0\",\n      \"resolved\": \"https://registry.npmmirror.com/isobject/-/isobject-2.1.0.tgz\",\n      \"integrity\": \"sha512-+OUdGJlgjOBZDfxnDjYYG6zp487z0JGNQq3cYQYg5f5hKR+syHMsaztzGeml/4kGG55CSpKSpWTY+jYGgsHLgA==\",\n      \"dev\": true,\n      \"optional\": true,\n      \"requires\": {\n        \"isarray\": \"1.0.0\"\n      }\n    },\n    \"js-tokens\": {\n      \"version\": \"3.0.2\",\n      \"resolved\": \"https://registry.npmmirror.com/js-tokens/-/js-tokens-3.0.2.tgz\",\n      \"integrity\": \"sha512-RjTcuD4xjtthQkaWH7dFlH85L+QaVtSoOyGdZ3g6HFhS9dFNDfLyqgm2NFe2X6cQpeFmt0452FJjFG5UameExg==\",\n      \"dev\": true\n    },\n    \"jsesc\": {\n      \"version\": \"1.3.0\",\n      \"resolved\": \"https://registry.npmmirror.com/jsesc/-/jsesc-1.3.0.tgz\",\n      \"integrity\": \"sha512-Mke0DA0QjUWuJlhsE0ZPPhYiJkRap642SmI/4ztCFaUs6V2AiH1sfecc+57NgaryfAA2VR3v6O+CSjC1jZJKOA==\",\n      \"dev\": true\n    },\n    \"json5\": {\n      \"version\": \"0.5.1\",\n      \"resolved\": \"https://registry.npmmirror.com/json5/-/json5-0.5.1.tgz\",\n      \"integrity\": \"sha512-4xrs1aW+6N5DalkqSVA8fxh458CXvR99WU8WLKmq4v8eWAL86Xo3BVqyd3SkA9wEVjCMqyvvRRkshAdOnBp5rw==\",\n      \"dev\": true\n    },\n    \"kind-of\": {\n      \"version\": \"3.2.2\",\n      \"resolved\": \"https://registry.npmmirror.com/kind-of/-/kind-of-3.2.2.tgz\",\n      \"integrity\": \"sha512-NOW9QQXMoZGg/oqnVNoNTTIFEIid1627WCffUBJEdMxYApq7mNE7CpzucIPc+ZQg25Phej7IJSmX3hO+oblOtQ==\",\n      \"dev\": true,\n      \"optional\": true,\n      \"requires\": {\n        \"is-buffer\": \"^1.1.5\"\n      }\n    },\n    \"lodash\": {\n      \"version\": \"4.17.21\",\n      \"resolved\": \"https://registry.npmmirror.com/lodash/-/lodash-4.17.21.tgz\",\n      \"integrity\": \"sha512-v2kDEe57lecTulaDIuNTPy3Ry4gLGJ6Z1O3vE1krgXZNrsQ+LFTGHVxVjcXPs17LhbZVGedAJv8XZ1tvj5FvSg==\",\n      \"dev\": true\n    },\n    \"loose-envify\": {\n      \"version\": \"1.4.0\",\n      \"resolved\": \"https://registry.npmmirror.com/loose-envify/-/loose-envify-1.4.0.tgz\",\n      \"integrity\": \"sha512-lyuxPGr/Wfhrlem2CL/UcnUc1zcqKAImBDzukY7Y5F/yQiNdko6+fRLevlw1HgMySw7f611UIY408EtxRSoK3Q==\",\n      \"dev\": true,\n      \"requires\": {\n        \"js-tokens\": \"^3.0.0 || ^4.0.0\"\n      }\n    },\n    \"map-cache\": {\n      \"version\": \"0.2.2\",\n      \"resolved\": \"https://registry.npmmirror.com/map-cache/-/map-cache-0.2.2.tgz\",\n      \"integrity\": \"sha512-8y/eV9QQZCiyn1SprXSrCmqJN0yNRATe+PO8ztwqrvrbdRLA3eYJF0yaR0YayLWkMbsQSKWS9N2gPcGEc4UsZg==\",\n      \"dev\": true,\n      \"optional\": true\n    },\n    \"map-visit\": {\n      \"version\": \"1.0.0\",\n      \"resolved\": \"https://registry.npmmirror.com/map-visit/-/map-visit-1.0.0.tgz\",\n      \"integrity\": \"sha512-4y7uGv8bd2WdM9vpQsiQNo41Ln1NvhvDRuVt0k2JZQ+ezN2uaQes7lZeZ+QQUHOLQAtDaBJ+7wCbi+ab/KFs+w==\",\n      \"dev\": true,\n      \"optional\": true,\n      \"requires\": {\n        \"object-visit\": \"^1.0.0\"\n      }\n    },\n    \"math-random\": {\n      \"version\": \"1.0.4\",\n      \"resolved\": \"https://registry.npmmirror.com/math-random/-/math-random-1.0.4.tgz\",\n      \"integrity\": \"sha512-rUxjysqif/BZQH2yhd5Aaq7vXMSx9NdEsQcyA07uEzIvxgI7zIr33gGsh+RU0/XjmQpCW7RsVof1vlkvQVCK5A==\",\n      \"dev\": true,\n      \"optional\": true\n    },\n    \"micromatch\": {\n      \"version\": \"2.3.11\",\n      \"resolved\": \"https://registry.npmmirror.com/micromatch/-/micromatch-2.3.11.tgz\",\n      \"integrity\": \"sha512-LnU2XFEk9xxSJ6rfgAry/ty5qwUTyHYOBU0g4R6tIw5ljwgGIBmiKhRWLw5NpMOnrgUNcDJ4WMp8rl3sYVHLNA==\",\n      \"dev\": true,\n      \"optional\": true,\n      \"requires\": {\n        \"arr-diff\": \"^2.0.0\",\n        \"array-unique\": \"^0.2.1\",\n        \"braces\": \"^1.8.2\",\n        \"expand-brackets\": \"^0.1.4\",\n        \"extglob\": \"^0.3.1\",\n        \"filename-regex\": \"^2.0.0\",\n        \"is-extglob\": \"^1.0.0\",\n        \"is-glob\": \"^2.0.1\",\n        \"kind-of\": \"^3.0.2\",\n        \"normalize-path\": \"^2.0.1\",\n        \"object.omit\": \"^2.0.0\",\n        \"parse-glob\": \"^3.0.4\",\n        \"regex-cache\": \"^0.4.2\"\n      }\n    },\n    \"minimatch\": {\n      \"version\": \"3.1.2\",\n      \"resolved\": \"https://registry.npmmirror.com/minimatch/-/minimatch-3.1.2.tgz\",\n      \"integrity\": \"sha512-J7p63hRiAjw1NDEww1W7i37+ByIrOWO5XQQAzZ3VOcL0PNybwpfmV/N05zFAzwQ9USyEcX6t3UO+K5aqBQOIHw==\",\n      \"dev\": true,\n      \"requires\": {\n        \"brace-expansion\": \"^1.1.7\"\n      }\n    },\n    \"minimist\": {\n      \"version\": \"1.2.8\",\n      \"resolved\": \"https://registry.npmmirror.com/minimist/-/minimist-1.2.8.tgz\",\n      \"integrity\": \"sha512-2yyAR8qBkN3YuheJanUpWC5U3bb5osDywNB8RzDVlDwDHbocAJveqqj1u8+SVD7jkWT4yvsHCpWqqWqAxb0zCA==\",\n      \"dev\": true\n    },\n    \"mixin-deep\": {\n      \"version\": \"1.3.2\",\n      \"resolved\": \"https://registry.npmmirror.com/mixin-deep/-/mixin-deep-1.3.2.tgz\",\n      \"integrity\": \"sha512-WRoDn//mXBiJ1H40rqa3vH0toePwSsGb45iInWlTySa+Uu4k3tYUSxa2v1KqAiLtvlrSzaExqS1gtk96A9zvEA==\",\n      \"dev\": true,\n      \"optional\": true,\n      \"requires\": {\n        \"for-in\": \"^1.0.2\",\n        \"is-extendable\": \"^1.0.1\"\n      },\n      \"dependencies\": {\n        \"is-extendable\": {\n          \"version\": \"1.0.1\",\n          \"resolved\": \"https://registry.npmmirror.com/is-extendable/-/is-extendable-1.0.1.tgz\",\n          \"integrity\": \"sha512-arnXMxT1hhoKo9k1LZdmlNyJdDDfy2v0fXjFlmok4+i8ul/6WlbVge9bhM74OpNPQPMGUToDtz+KXa1PneJxOA==\",\n          \"dev\": true,\n          \"optional\": true,\n          \"requires\": {\n            \"is-plain-object\": \"^2.0.4\"\n          }\n        }\n      }\n    },\n    \"mkdirp\": {\n      \"version\": \"0.5.6\",\n      \"resolved\": \"https://registry.npmmirror.com/mkdirp/-/mkdirp-0.5.6.tgz\",\n      \"integrity\": \"sha512-FP+p8RB8OWpF3YZBCrP5gtADmtXApB5AMLn+vdyA+PyxCjrCs00mjyUozssO33cwDeT3wNGdLxJ5M//YqtHAJw==\",\n      \"dev\": true,\n      \"requires\": {\n        \"minimist\": \"^1.2.6\"\n      }\n    },\n    \"ms\": {\n      \"version\": \"2.0.0\",\n      \"resolved\": \"https://registry.npmmirror.com/ms/-/ms-2.0.0.tgz\",\n      \"integrity\": \"sha512-Tpp60P6IUJDTuOq/5Z8cdskzJujfwqfOTkrwIwj7IRISpnkJnT6SyJ4PCPnGMoFjC9ddhal5KVIYtAt97ix05A==\",\n      \"dev\": true\n    },\n    \"nan\": {\n      \"version\": \"2.17.0\",\n      \"resolved\": \"https://registry.npmmirror.com/nan/-/nan-2.17.0.tgz\",\n      \"integrity\": \"sha512-2ZTgtl0nJsO0KQCjEpxcIr5D+Yv90plTitZt9JBfQvVJDS5seMl3FOvsh3+9CoYWXf/1l5OaZzzF6nDm4cagaQ==\",\n      \"dev\": true,\n      \"optional\": true\n    },\n    \"nanomatch\": {\n      \"version\": \"1.2.13\",\n      \"resolved\": \"https://registry.npmmirror.com/nanomatch/-/nanomatch-1.2.13.tgz\",\n      \"integrity\": \"sha512-fpoe2T0RbHwBTBUOftAfBPaDEi06ufaUai0mE6Yn1kacc3SnTErfb/h+X94VXzI64rKFHYImXSvdwGGCmwOqCA==\",\n      \"dev\": true,\n      \"optional\": true,\n      \"requires\": {\n        \"arr-diff\": \"^4.0.0\",\n        \"array-unique\": \"^0.3.2\",\n        \"define-property\": \"^2.0.2\",\n        \"extend-shallow\": \"^3.0.2\",\n        \"fragment-cache\": \"^0.2.1\",\n        \"is-windows\": \"^1.0.2\",\n        \"kind-of\": \"^6.0.2\",\n        \"object.pick\": \"^1.3.0\",\n        \"regex-not\": \"^1.0.0\",\n        \"snapdragon\": \"^0.8.1\",\n        \"to-regex\": \"^3.0.1\"\n      },\n      \"dependencies\": {\n        \"arr-diff\": {\n          \"version\": \"4.0.0\",\n          \"resolved\": \"https://registry.npmmirror.com/arr-diff/-/arr-diff-4.0.0.tgz\",\n          \"integrity\": \"sha512-YVIQ82gZPGBebQV/a8dar4AitzCQs0jjXwMPZllpXMaGjXPYVUawSxQrRsjhjupyVxEvbHgUmIhKVlND+j02kA==\",\n          \"dev\": true,\n          \"optional\": true\n        },\n        \"array-unique\": {\n          \"version\": \"0.3.2\",\n          \"resolved\": \"https://registry.npmmirror.com/array-unique/-/array-unique-0.3.2.tgz\",\n          \"integrity\": \"sha512-SleRWjh9JUud2wH1hPs9rZBZ33H6T9HOiL0uwGnGx9FpE6wKGyfWugmbkEOIs6qWrZhg0LWeLziLrEwQJhs5mQ==\",\n          \"dev\": true,\n          \"optional\": true\n        },\n        \"kind-of\": {\n          \"version\": \"6.0.3\",\n          \"resolved\": \"https://registry.npmmirror.com/kind-of/-/kind-of-6.0.3.tgz\",\n          \"integrity\": \"sha512-dcS1ul+9tmeD95T+x28/ehLgd9mENa3LsvDTtzm3vyBEO7RPptvAD+t44WVXaUjTBRcrpFeFlC8WCruUR456hw==\",\n          \"dev\": true,\n          \"optional\": true\n        }\n      }\n    },\n    \"normalize-path\": {\n      \"version\": \"2.1.1\",\n      \"resolved\": \"https://registry.npmmirror.com/normalize-path/-/normalize-path-2.1.1.tgz\",\n      \"integrity\": \"sha512-3pKJwH184Xo/lnH6oyP1q2pMd7HcypqqmRs91/6/i2CGtWwIKGCkOOMTm/zXbgTEWHw1uNpNi/igc3ePOYHb6w==\",\n      \"dev\": true,\n      \"optional\": true,\n      \"requires\": {\n        \"remove-trailing-separator\": \"^1.0.1\"\n      }\n    },\n    \"object-assign\": {\n      \"version\": \"4.1.1\",\n      \"resolved\": \"https://registry.npmmirror.com/object-assign/-/object-assign-4.1.1.tgz\",\n      \"integrity\": \"sha512-rJgTQnkUnH1sFw8yT6VSU3zD3sWmu6sZhIseY8VX+GRu3P6F7Fu+JNDoXfklElbLJSnc3FUQHVe4cU5hj+BcUg==\",\n      \"dev\": true\n    },\n    \"object-copy\": {\n      \"version\": \"0.1.0\",\n      \"resolved\": \"https://registry.npmmirror.com/object-copy/-/object-copy-0.1.0.tgz\",\n      \"integrity\": \"sha512-79LYn6VAb63zgtmAteVOWo9Vdj71ZVBy3Pbse+VqxDpEP83XuujMrGqHIwAXJ5I/aM0zU7dIyIAhifVTPrNItQ==\",\n      \"dev\": true,\n      \"optional\": true,\n      \"requires\": {\n        \"copy-descriptor\": \"^0.1.0\",\n        \"define-property\": \"^0.2.5\",\n        \"kind-of\": \"^3.0.3\"\n      },\n      \"dependencies\": {\n        \"define-property\": {\n          \"version\": \"0.2.5\",\n          \"resolved\": \"https://registry.npmmirror.com/define-property/-/define-property-0.2.5.tgz\",\n          \"integrity\": \"sha512-Rr7ADjQZenceVOAKop6ALkkRAmH1A4Gx9hV/7ZujPUN2rkATqFO0JZLZInbAjpZYoJ1gUx8MRMQVkYemcbMSTA==\",\n          \"dev\": true,\n          \"optional\": true,\n          \"requires\": {\n            \"is-descriptor\": \"^0.1.0\"\n          }\n        }\n      }\n    },\n    \"object-visit\": {\n      \"version\": \"1.0.1\",\n      \"resolved\": \"https://registry.npmmirror.com/object-visit/-/object-visit-1.0.1.tgz\",\n      \"integrity\": \"sha512-GBaMwwAVK9qbQN3Scdo0OyvgPW7l3lnaVMj84uTOZlswkX0KpF6fyDBJhtTthf7pymztoN36/KEr1DyhF96zEA==\",\n      \"dev\": true,\n      \"optional\": true,\n      \"requires\": {\n        \"isobject\": \"^3.0.0\"\n      },\n      \"dependencies\": {\n        \"isobject\": {\n          \"version\": \"3.0.1\",\n          \"resolved\": \"https://registry.npmmirror.com/isobject/-/isobject-3.0.1.tgz\",\n          \"integrity\": \"sha512-WhB9zCku7EGTj/HQQRz5aUQEUeoQZH2bWcltRErOpymJ4boYE6wL9Tbr23krRPSZ+C5zqNSrSw+Cc7sZZ4b7vg==\",\n          \"dev\": true,\n          \"optional\": true\n        }\n      }\n    },\n    \"object.omit\": {\n      \"version\": \"2.0.1\",\n      \"resolved\": \"https://registry.npmmirror.com/object.omit/-/object.omit-2.0.1.tgz\",\n      \"integrity\": \"sha512-UiAM5mhmIuKLsOvrL+B0U2d1hXHF3bFYWIuH1LMpuV2EJEHG1Ntz06PgLEHjm6VFd87NpH8rastvPoyv6UW2fA==\",\n      \"dev\": true,\n      \"optional\": true,\n      \"requires\": {\n        \"for-own\": \"^0.1.4\",\n        \"is-extendable\": \"^0.1.1\"\n      }\n    },\n    \"object.pick\": {\n      \"version\": \"1.3.0\",\n      \"resolved\": \"https://registry.npmmirror.com/object.pick/-/object.pick-1.3.0.tgz\",\n      \"integrity\": \"sha512-tqa/UMy/CCoYmj+H5qc07qvSL9dqcs/WZENZ1JbtWBlATP+iVOe778gE6MSijnyCnORzDuX6hU+LA4SZ09YjFQ==\",\n      \"dev\": true,\n      \"optional\": true,\n      \"requires\": {\n        \"isobject\": \"^3.0.1\"\n      },\n      \"dependencies\": {\n        \"isobject\": {\n          \"version\": \"3.0.1\",\n          \"resolved\": \"https://registry.npmmirror.com/isobject/-/isobject-3.0.1.tgz\",\n          \"integrity\": \"sha512-WhB9zCku7EGTj/HQQRz5aUQEUeoQZH2bWcltRErOpymJ4boYE6wL9Tbr23krRPSZ+C5zqNSrSw+Cc7sZZ4b7vg==\",\n          \"dev\": true,\n          \"optional\": true\n        }\n      }\n    },\n    \"once\": {\n      \"version\": \"1.4.0\",\n      \"resolved\": \"https://registry.npmmirror.com/once/-/once-1.4.0.tgz\",\n      \"integrity\": \"sha512-lNaJgI+2Q5URQBkccEKHTQOPaXdUxnZZElQTZY0MFUAuaEqe1E+Nyvgdz/aIyNi6Z9MzO5dv1H8n58/GELp3+w==\",\n      \"dev\": true,\n      \"requires\": {\n        \"wrappy\": \"1\"\n      }\n    },\n    \"os-homedir\": {\n      \"version\": \"1.0.2\",\n      \"resolved\": \"https://registry.npmmirror.com/os-homedir/-/os-homedir-1.0.2.tgz\",\n      \"integrity\": \"sha512-B5JU3cabzk8c67mRRd3ECmROafjYMXbuzlwtqdM8IbS8ktlTix8aFGb2bAGKrSRIlnfKwovGUUr72JUPyOb6kQ==\",\n      \"dev\": true\n    },\n    \"os-tmpdir\": {\n      \"version\": \"1.0.2\",\n      \"resolved\": \"https://registry.npmmirror.com/os-tmpdir/-/os-tmpdir-1.0.2.tgz\",\n      \"integrity\": \"sha512-D2FR03Vir7FIu45XBY20mTb+/ZSWB00sjU9jdQXt83gDrI4Ztz5Fs7/yy74g2N5SVQY4xY1qDr4rNddwYRVX0g==\",\n      \"dev\": true\n    },\n    \"output-file-sync\": {\n      \"version\": \"1.1.2\",\n      \"resolved\": \"https://registry.npmmirror.com/output-file-sync/-/output-file-sync-1.1.2.tgz\",\n      \"integrity\": \"sha512-uQLlclru4xpCi+tfs80l3QF24KL81X57ELNMy7W/dox+JTtxUf1bLyQ8968fFCmSqqbokjW0kn+WBIlO+rSkNg==\",\n      \"dev\": true,\n      \"requires\": {\n        \"graceful-fs\": \"^4.1.4\",\n        \"mkdirp\": \"^0.5.1\",\n        \"object-assign\": \"^4.1.0\"\n      }\n    },\n    \"parse-glob\": {\n      \"version\": \"3.0.4\",\n      \"resolved\": \"https://registry.npmmirror.com/parse-glob/-/parse-glob-3.0.4.tgz\",\n      \"integrity\": \"sha512-FC5TeK0AwXzq3tUBFtH74naWkPQCEWs4K+xMxWZBlKDWu0bVHXGZa+KKqxKidd7xwhdZ19ZNuF2uO1M/r196HA==\",\n      \"dev\": true,\n      \"optional\": true,\n      \"requires\": {\n        \"glob-base\": \"^0.3.0\",\n        \"is-dotfile\": \"^1.0.0\",\n        \"is-extglob\": \"^1.0.0\",\n        \"is-glob\": \"^2.0.0\"\n      }\n    },\n    \"pascalcase\": {\n      \"version\": \"0.1.1\",\n      \"resolved\": \"https://registry.npmmirror.com/pascalcase/-/pascalcase-0.1.1.tgz\",\n      \"integrity\": \"sha512-XHXfu/yOQRy9vYOtUDVMN60OEJjW013GoObG1o+xwQTpB9eYJX/BjXMsdW13ZDPruFhYYn0AG22w0xgQMwl3Nw==\",\n      \"dev\": true,\n      \"optional\": true\n    },\n    \"path-is-absolute\": {\n      \"version\": \"1.0.1\",\n      \"resolved\": \"https://registry.npmmirror.com/path-is-absolute/-/path-is-absolute-1.0.1.tgz\",\n      \"integrity\": \"sha512-AVbw3UJ2e9bq64vSaS9Am0fje1Pa8pbGqTTsmXfaIiMpnr5DlDhfJOuLj9Sf95ZPVDAUerDfEk88MPmPe7UCQg==\",\n      \"dev\": true\n    },\n    \"posix-character-classes\": {\n      \"version\": \"0.1.1\",\n      \"resolved\": \"https://registry.npmmirror.com/posix-character-classes/-/posix-character-classes-0.1.1.tgz\",\n      \"integrity\": \"sha512-xTgYBc3fuo7Yt7JbiuFxSYGToMoz8fLoE6TC9Wx1P/u+LfeThMOAqmuyECnlBaaJb+u1m9hHiXUEtwW4OzfUJg==\",\n      \"dev\": true,\n      \"optional\": true\n    },\n    \"preserve\": {\n      \"version\": \"0.2.0\",\n      \"resolved\": \"https://registry.npmmirror.com/preserve/-/preserve-0.2.0.tgz\",\n      \"integrity\": \"sha512-s/46sYeylUfHNjI+sA/78FAHlmIuKqI9wNnzEOGehAlUUYeObv5C2mOinXBjyUyWmJ2SfcS2/ydApH4hTF4WXQ==\",\n      \"dev\": true,\n      \"optional\": true\n    },\n    \"private\": {\n      \"version\": \"0.1.8\",\n      \"resolved\": \"https://registry.npmmirror.com/private/-/private-0.1.8.tgz\",\n      \"integrity\": \"sha512-VvivMrbvd2nKkiG38qjULzlc+4Vx4wm/whI9pQD35YrARNnhxeiRktSOhSukRLFNlzg6Br/cJPet5J/u19r/mg==\",\n      \"dev\": true\n    },\n    \"process-nextick-args\": {\n      \"version\": \"2.0.1\",\n      \"resolved\": \"https://registry.npmmirror.com/process-nextick-args/-/process-nextick-args-2.0.1.tgz\",\n      \"integrity\": \"sha512-3ouUOpQhtgrbOa17J7+uxOTpITYWaGP7/AhoR3+A+/1e9skrzelGi/dXzEYyvbxubEF6Wn2ypscTKiKJFFn1ag==\",\n      \"dev\": true,\n      \"optional\": true\n    },\n    \"randomatic\": {\n      \"version\": \"3.1.1\",\n      \"resolved\": \"https://registry.npmmirror.com/randomatic/-/randomatic-3.1.1.tgz\",\n      \"integrity\": \"sha512-TuDE5KxZ0J461RVjrJZCJc+J+zCkTb1MbH9AQUq68sMhOMcy9jLcb3BrZKgp9q9Ncltdg4QVqWrH02W2EFFVYw==\",\n      \"dev\": true,\n      \"optional\": true,\n      \"requires\": {\n        \"is-number\": \"^4.0.0\",\n        \"kind-of\": \"^6.0.0\",\n        \"math-random\": \"^1.0.1\"\n      },\n      \"dependencies\": {\n        \"is-number\": {\n          \"version\": \"4.0.0\",\n          \"resolved\": \"https://registry.npmmirror.com/is-number/-/is-number-4.0.0.tgz\",\n          \"integrity\": \"sha512-rSklcAIlf1OmFdyAqbnWTLVelsQ58uvZ66S/ZyawjWqIviTWCjg2PzVGw8WUA+nNuPTqb4wgA+NszrJ+08LlgQ==\",\n          \"dev\": true,\n          \"optional\": true\n        },\n        \"kind-of\": {\n          \"version\": \"6.0.3\",\n          \"resolved\": \"https://registry.npmmirror.com/kind-of/-/kind-of-6.0.3.tgz\",\n          \"integrity\": \"sha512-dcS1ul+9tmeD95T+x28/ehLgd9mENa3LsvDTtzm3vyBEO7RPptvAD+t44WVXaUjTBRcrpFeFlC8WCruUR456hw==\",\n          \"dev\": true,\n          \"optional\": true\n        }\n      }\n    },\n    \"readable-stream\": {\n      \"version\": \"2.3.8\",\n      \"resolved\": \"https://registry.npmmirror.com/readable-stream/-/readable-stream-2.3.8.tgz\",\n      \"integrity\": \"sha512-8p0AUk4XODgIewSi0l8Epjs+EVnWiK7NoDIEGU0HhE7+ZyY8D1IMY7odu5lRrFXGg71L15KG8QrPmum45RTtdA==\",\n      \"dev\": true,\n      \"optional\": true,\n      \"requires\": {\n        \"core-util-is\": \"~1.0.0\",\n        \"inherits\": \"~2.0.3\",\n        \"isarray\": \"~1.0.0\",\n        \"process-nextick-args\": \"~2.0.0\",\n        \"safe-buffer\": \"~5.1.1\",\n        \"string_decoder\": \"~1.1.1\",\n        \"util-deprecate\": \"~1.0.1\"\n      }\n    },\n    \"readdirp\": {\n      \"version\": \"2.2.1\",\n      \"resolved\": \"https://registry.npmmirror.com/readdirp/-/readdirp-2.2.1.tgz\",\n      \"integrity\": \"sha512-1JU/8q+VgFZyxwrJ+SVIOsh+KywWGpds3NTqikiKpDMZWScmAYyKIgqkO+ARvNWJfXeXR1zxz7aHF4u4CyH6vQ==\",\n      \"dev\": true,\n      \"optional\": true,\n      \"requires\": {\n        \"graceful-fs\": \"^4.1.11\",\n        \"micromatch\": \"^3.1.10\",\n        \"readable-stream\": \"^2.0.2\"\n      },\n      \"dependencies\": {\n        \"arr-diff\": {\n          \"version\": \"4.0.0\",\n          \"resolved\": \"https://registry.npmmirror.com/arr-diff/-/arr-diff-4.0.0.tgz\",\n          \"integrity\": \"sha512-YVIQ82gZPGBebQV/a8dar4AitzCQs0jjXwMPZllpXMaGjXPYVUawSxQrRsjhjupyVxEvbHgUmIhKVlND+j02kA==\",\n          \"dev\": true,\n          \"optional\": true\n        },\n        \"array-unique\": {\n          \"version\": \"0.3.2\",\n          \"resolved\": \"https://registry.npmmirror.com/array-unique/-/array-unique-0.3.2.tgz\",\n          \"integrity\": \"sha512-SleRWjh9JUud2wH1hPs9rZBZ33H6T9HOiL0uwGnGx9FpE6wKGyfWugmbkEOIs6qWrZhg0LWeLziLrEwQJhs5mQ==\",\n          \"dev\": true,\n          \"optional\": true\n        },\n        \"braces\": {\n          \"version\": \"2.3.2\",\n          \"resolved\": \"https://registry.npmmirror.com/braces/-/braces-2.3.2.tgz\",\n          \"integrity\": \"sha512-aNdbnj9P8PjdXU4ybaWLK2IF3jc/EoDYbC7AazW6to3TRsfXxscC9UXOB5iDiEQrkyIbWp2SLQda4+QAa7nc3w==\",\n          \"dev\": true,\n          \"optional\": true,\n          \"requires\": {\n            \"arr-flatten\": \"^1.1.0\",\n            \"array-unique\": \"^0.3.2\",\n            \"extend-shallow\": \"^2.0.1\",\n            \"fill-range\": \"^4.0.0\",\n            \"isobject\": \"^3.0.1\",\n            \"repeat-element\": \"^1.1.2\",\n            \"snapdragon\": \"^0.8.1\",\n            \"snapdragon-node\": \"^2.0.1\",\n            \"split-string\": \"^3.0.2\",\n            \"to-regex\": \"^3.0.1\"\n          },\n          \"dependencies\": {\n            \"extend-shallow\": {\n              \"version\": \"2.0.1\",\n              \"resolved\": \"https://registry.npmmirror.com/extend-shallow/-/extend-shallow-2.0.1.tgz\",\n              \"integrity\": \"sha512-zCnTtlxNoAiDc3gqY2aYAWFx7XWWiasuF2K8Me5WbN8otHKTUKBwjPtNpRs/rbUZm7KxWAaNj7P1a/p52GbVug==\",\n              \"dev\": true,\n              \"optional\": true,\n              \"requires\": {\n                \"is-extendable\": \"^0.1.0\"\n              }\n            }\n          }\n        },\n        \"expand-brackets\": {\n          \"version\": \"2.1.4\",\n          \"resolved\": \"https://registry.npmmirror.com/expand-brackets/-/expand-brackets-2.1.4.tgz\",\n          \"integrity\": \"sha512-w/ozOKR9Obk3qoWeY/WDi6MFta9AoMR+zud60mdnbniMcBxRuFJyDt2LdX/14A1UABeqk+Uk+LDfUpvoGKppZA==\",\n          \"dev\": true,\n          \"optional\": true,\n          \"requires\": {\n            \"debug\": \"^2.3.3\",\n            \"define-property\": \"^0.2.5\",\n            \"extend-shallow\": \"^2.0.1\",\n            \"posix-character-classes\": \"^0.1.0\",\n            \"regex-not\": \"^1.0.0\",\n            \"snapdragon\": \"^0.8.1\",\n            \"to-regex\": \"^3.0.1\"\n          },\n          \"dependencies\": {\n            \"define-property\": {\n              \"version\": \"0.2.5\",\n              \"resolved\": \"https://registry.npmmirror.com/define-property/-/define-property-0.2.5.tgz\",\n              \"integrity\": \"sha512-Rr7ADjQZenceVOAKop6ALkkRAmH1A4Gx9hV/7ZujPUN2rkATqFO0JZLZInbAjpZYoJ1gUx8MRMQVkYemcbMSTA==\",\n              \"dev\": true,\n              \"optional\": true,\n              \"requires\": {\n                \"is-descriptor\": \"^0.1.0\"\n              }\n            },\n            \"extend-shallow\": {\n              \"version\": \"2.0.1\",\n              \"resolved\": \"https://registry.npmmirror.com/extend-shallow/-/extend-shallow-2.0.1.tgz\",\n              \"integrity\": \"sha512-zCnTtlxNoAiDc3gqY2aYAWFx7XWWiasuF2K8Me5WbN8otHKTUKBwjPtNpRs/rbUZm7KxWAaNj7P1a/p52GbVug==\",\n              \"dev\": true,\n              \"optional\": true,\n              \"requires\": {\n                \"is-extendable\": \"^0.1.0\"\n              }\n            },\n            \"is-accessor-descriptor\": {\n              \"version\": \"0.1.6\",\n              \"resolved\": \"https://registry.npmmirror.com/is-accessor-descriptor/-/is-accessor-descriptor-0.1.6.tgz\",\n              \"integrity\": \"sha512-e1BM1qnDbMRG3ll2U9dSK0UMHuWOs3pY3AtcFsmvwPtKL3MML/Q86i+GilLfvqEs4GW+ExB91tQ3Ig9noDIZ+A==\",\n              \"dev\": true,\n              \"optional\": true,\n              \"requires\": {\n                \"kind-of\": \"^3.0.2\"\n              },\n              \"dependencies\": {\n                \"kind-of\": {\n                  \"version\": \"3.2.2\",\n                  \"resolved\": \"https://registry.npmmirror.com/kind-of/-/kind-of-3.2.2.tgz\",\n                  \"integrity\": \"sha512-NOW9QQXMoZGg/oqnVNoNTTIFEIid1627WCffUBJEdMxYApq7mNE7CpzucIPc+ZQg25Phej7IJSmX3hO+oblOtQ==\",\n                  \"dev\": true,\n                  \"optional\": true,\n                  \"requires\": {\n                    \"is-buffer\": \"^1.1.5\"\n                  }\n                }\n              }\n            },\n            \"is-data-descriptor\": {\n              \"version\": \"0.1.4\",\n              \"resolved\": \"https://registry.npmmirror.com/is-data-descriptor/-/is-data-descriptor-0.1.4.tgz\",\n              \"integrity\": \"sha512-+w9D5ulSoBNlmw9OHn3U2v51SyoCd0he+bB3xMl62oijhrspxowjU+AIcDY0N3iEJbUEkB15IlMASQsxYigvXg==\",\n              \"dev\": true,\n              \"optional\": true,\n              \"requires\": {\n                \"kind-of\": \"^3.0.2\"\n              },\n              \"dependencies\": {\n                \"kind-of\": {\n                  \"version\": \"3.2.2\",\n                  \"resolved\": \"https://registry.npmmirror.com/kind-of/-/kind-of-3.2.2.tgz\",\n                  \"integrity\": \"sha512-NOW9QQXMoZGg/oqnVNoNTTIFEIid1627WCffUBJEdMxYApq7mNE7CpzucIPc+ZQg25Phej7IJSmX3hO+oblOtQ==\",\n                  \"dev\": true,\n                  \"optional\": true,\n                  \"requires\": {\n                    \"is-buffer\": \"^1.1.5\"\n                  }\n                }\n              }\n            },\n            \"is-descriptor\": {\n              \"version\": \"0.1.6\",\n              \"resolved\": \"https://registry.npmmirror.com/is-descriptor/-/is-descriptor-0.1.6.tgz\",\n              \"integrity\": \"sha512-avDYr0SB3DwO9zsMov0gKCESFYqCnE4hq/4z3TdUlukEy5t9C0YRq7HLrsN52NAcqXKaepeCD0n+B0arnVG3Hg==\",\n              \"dev\": true,\n              \"optional\": true,\n              \"requires\": {\n                \"is-accessor-descriptor\": \"^0.1.6\",\n                \"is-data-descriptor\": \"^0.1.4\",\n                \"kind-of\": \"^5.0.0\"\n              }\n            },\n            \"kind-of\": {\n              \"version\": \"5.1.0\",\n              \"resolved\": \"https://registry.npmmirror.com/kind-of/-/kind-of-5.1.0.tgz\",\n              \"integrity\": \"sha512-NGEErnH6F2vUuXDh+OlbcKW7/wOcfdRHaZ7VWtqCztfHri/++YKmP51OdWeGPuqCOba6kk2OTe5d02VmTB80Pw==\",\n              \"dev\": true,\n              \"optional\": true\n            }\n          }\n        },\n        \"extglob\": {\n          \"version\": \"2.0.4\",\n          \"resolved\": \"https://registry.npmmirror.com/extglob/-/extglob-2.0.4.tgz\",\n          \"integrity\": \"sha512-Nmb6QXkELsuBr24CJSkilo6UHHgbekK5UiZgfE6UHD3Eb27YC6oD+bhcT+tJ6cl8dmsgdQxnWlcry8ksBIBLpw==\",\n          \"dev\": true,\n          \"optional\": true,\n          \"requires\": {\n            \"array-unique\": \"^0.3.2\",\n            \"define-property\": \"^1.0.0\",\n            \"expand-brackets\": \"^2.1.4\",\n            \"extend-shallow\": \"^2.0.1\",\n            \"fragment-cache\": \"^0.2.1\",\n            \"regex-not\": \"^1.0.0\",\n            \"snapdragon\": \"^0.8.1\",\n            \"to-regex\": \"^3.0.1\"\n          },\n          \"dependencies\": {\n            \"define-property\": {\n              \"version\": \"1.0.0\",\n              \"resolved\": \"https://registry.npmmirror.com/define-property/-/define-property-1.0.0.tgz\",\n              \"integrity\": \"sha512-cZTYKFWspt9jZsMscWo8sc/5lbPC9Q0N5nBLgb+Yd915iL3udB1uFgS3B8YCx66UVHq018DAVFoee7x+gxggeA==\",\n              \"dev\": true,\n              \"optional\": true,\n              \"requires\": {\n                \"is-descriptor\": \"^1.0.0\"\n              }\n            },\n            \"extend-shallow\": {\n              \"version\": \"2.0.1\",\n              \"resolved\": \"https://registry.npmmirror.com/extend-shallow/-/extend-shallow-2.0.1.tgz\",\n              \"integrity\": \"sha512-zCnTtlxNoAiDc3gqY2aYAWFx7XWWiasuF2K8Me5WbN8otHKTUKBwjPtNpRs/rbUZm7KxWAaNj7P1a/p52GbVug==\",\n              \"dev\": true,\n              \"optional\": true,\n              \"requires\": {\n                \"is-extendable\": \"^0.1.0\"\n              }\n            }\n          }\n        },\n        \"fill-range\": {\n          \"version\": \"4.0.0\",\n          \"resolved\": \"https://registry.npmmirror.com/fill-range/-/fill-range-4.0.0.tgz\",\n          \"integrity\": \"sha512-VcpLTWqWDiTerugjj8e3+esbg+skS3M9e54UuR3iCeIDMXCLTsAH8hTSzDQU/X6/6t3eYkOKoZSef2PlU6U1XQ==\",\n          \"dev\": true,\n          \"optional\": true,\n          \"requires\": {\n            \"extend-shallow\": \"^2.0.1\",\n            \"is-number\": \"^3.0.0\",\n            \"repeat-string\": \"^1.6.1\",\n            \"to-regex-range\": \"^2.1.0\"\n          },\n          \"dependencies\": {\n            \"extend-shallow\": {\n              \"version\": \"2.0.1\",\n              \"resolved\": \"https://registry.npmmirror.com/extend-shallow/-/extend-shallow-2.0.1.tgz\",\n              \"integrity\": \"sha512-zCnTtlxNoAiDc3gqY2aYAWFx7XWWiasuF2K8Me5WbN8otHKTUKBwjPtNpRs/rbUZm7KxWAaNj7P1a/p52GbVug==\",\n              \"dev\": true,\n              \"optional\": true,\n              \"requires\": {\n                \"is-extendable\": \"^0.1.0\"\n              }\n            }\n          }\n        },\n        \"is-accessor-descriptor\": {\n          \"version\": \"1.0.0\",\n          \"resolved\": \"https://registry.npmmirror.com/is-accessor-descriptor/-/is-accessor-descriptor-1.0.0.tgz\",\n          \"integrity\": \"sha512-m5hnHTkcVsPfqx3AKlyttIPb7J+XykHvJP2B9bZDjlhLIoEq4XoK64Vg7boZlVWYK6LUY94dYPEE7Lh0ZkZKcQ==\",\n          \"dev\": true,\n          \"optional\": true,\n          \"requires\": {\n            \"kind-of\": \"^6.0.0\"\n          }\n        },\n        \"is-data-descriptor\": {\n          \"version\": \"1.0.0\",\n          \"resolved\": \"https://registry.npmmirror.com/is-data-descriptor/-/is-data-descriptor-1.0.0.tgz\",\n          \"integrity\": \"sha512-jbRXy1FmtAoCjQkVmIVYwuuqDFUbaOeDjmed1tOGPrsMhtJA4rD9tkgA0F1qJ3gRFRXcHYVkdeaP50Q5rE/jLQ==\",\n          \"dev\": true,\n          \"optional\": true,\n          \"requires\": {\n            \"kind-of\": \"^6.0.0\"\n          }\n        },\n        \"is-descriptor\": {\n          \"version\": \"1.0.2\",\n          \"resolved\": \"https://registry.npmmirror.com/is-descriptor/-/is-descriptor-1.0.2.tgz\",\n          \"integrity\": \"sha512-2eis5WqQGV7peooDyLmNEPUrps9+SXX5c9pL3xEB+4e9HnGuDa7mB7kHxHw4CbqS9k1T2hOH3miL8n8WtiYVtg==\",\n          \"dev\": true,\n          \"optional\": true,\n          \"requires\": {\n            \"is-accessor-descriptor\": \"^1.0.0\",\n            \"is-data-descriptor\": \"^1.0.0\",\n            \"kind-of\": \"^6.0.2\"\n          }\n        },\n        \"is-number\": {\n          \"version\": \"3.0.0\",\n          \"resolved\": \"https://registry.npmmirror.com/is-number/-/is-number-3.0.0.tgz\",\n          \"integrity\": \"sha512-4cboCqIpliH+mAvFNegjZQ4kgKc3ZUhQVr3HvWbSh5q3WH2v82ct+T2Y1hdU5Gdtorx/cLifQjqCbL7bpznLTg==\",\n          \"dev\": true,\n          \"optional\": true,\n          \"requires\": {\n            \"kind-of\": \"^3.0.2\"\n          },\n          \"dependencies\": {\n            \"kind-of\": {\n              \"version\": \"3.2.2\",\n              \"resolved\": \"https://registry.npmmirror.com/kind-of/-/kind-of-3.2.2.tgz\",\n              \"integrity\": \"sha512-NOW9QQXMoZGg/oqnVNoNTTIFEIid1627WCffUBJEdMxYApq7mNE7CpzucIPc+ZQg25Phej7IJSmX3hO+oblOtQ==\",\n              \"dev\": true,\n              \"optional\": true,\n              \"requires\": {\n                \"is-buffer\": \"^1.1.5\"\n              }\n            }\n          }\n        },\n        \"isobject\": {\n          \"version\": \"3.0.1\",\n          \"resolved\": \"https://registry.npmmirror.com/isobject/-/isobject-3.0.1.tgz\",\n          \"integrity\": \"sha512-WhB9zCku7EGTj/HQQRz5aUQEUeoQZH2bWcltRErOpymJ4boYE6wL9Tbr23krRPSZ+C5zqNSrSw+Cc7sZZ4b7vg==\",\n          \"dev\": true,\n          \"optional\": true\n        },\n        \"kind-of\": {\n          \"version\": \"6.0.3\",\n          \"resolved\": \"https://registry.npmmirror.com/kind-of/-/kind-of-6.0.3.tgz\",\n          \"integrity\": \"sha512-dcS1ul+9tmeD95T+x28/ehLgd9mENa3LsvDTtzm3vyBEO7RPptvAD+t44WVXaUjTBRcrpFeFlC8WCruUR456hw==\",\n          \"dev\": true,\n          \"optional\": true\n        },\n        \"micromatch\": {\n          \"version\": \"3.1.10\",\n          \"resolved\": \"https://registry.npmmirror.com/micromatch/-/micromatch-3.1.10.tgz\",\n          \"integrity\": \"sha512-MWikgl9n9M3w+bpsY3He8L+w9eF9338xRl8IAO5viDizwSzziFEyUzo2xrrloB64ADbTf8uA8vRqqttDTOmccg==\",\n          \"dev\": true,\n          \"optional\": true,\n          \"requires\": {\n            \"arr-diff\": \"^4.0.0\",\n            \"array-unique\": \"^0.3.2\",\n            \"braces\": \"^2.3.1\",\n            \"define-property\": \"^2.0.2\",\n            \"extend-shallow\": \"^3.0.2\",\n            \"extglob\": \"^2.0.4\",\n            \"fragment-cache\": \"^0.2.1\",\n            \"kind-of\": \"^6.0.2\",\n            \"nanomatch\": \"^1.2.9\",\n            \"object.pick\": \"^1.3.0\",\n            \"regex-not\": \"^1.0.0\",\n            \"snapdragon\": \"^0.8.1\",\n            \"to-regex\": \"^3.0.2\"\n          }\n        }\n      }\n    },\n    \"regenerate\": {\n      \"version\": \"1.4.2\",\n      \"resolved\": \"https://registry.npmmirror.com/regenerate/-/regenerate-1.4.2.tgz\",\n      \"integrity\": \"sha512-zrceR/XhGYU/d/opr2EKO7aRHUeiBI8qjtfHqADTwZd6Szfy16la6kqD0MIUs5z5hx6AaKa+PixpPrR289+I0A==\",\n      \"dev\": true\n    },\n    \"regenerator-runtime\": {\n      \"version\": \"0.11.1\",\n      \"resolved\": \"https://registry.npmmirror.com/regenerator-runtime/-/regenerator-runtime-0.11.1.tgz\",\n      \"integrity\": \"sha512-MguG95oij0fC3QV3URf4V2SDYGJhJnJGqvIIgdECeODCT98wSWDAJ94SSuVpYQUoTcGUIL6L4yNB7j1DFFHSBg==\",\n      \"dev\": true\n    },\n    \"regenerator-transform\": {\n      \"version\": \"0.10.1\",\n      \"resolved\": \"https://registry.npmmirror.com/regenerator-transform/-/regenerator-transform-0.10.1.tgz\",\n      \"integrity\": \"sha512-PJepbvDbuK1xgIgnau7Y90cwaAmO/LCLMI2mPvaXq2heGMR3aWW5/BQvYrhJ8jgmQjXewXvBjzfqKcVOmhjZ6Q==\",\n      \"dev\": true,\n      \"requires\": {\n        \"babel-runtime\": \"^6.18.0\",\n        \"babel-types\": \"^6.19.0\",\n        \"private\": \"^0.1.6\"\n      }\n    },\n    \"regex-cache\": {\n      \"version\": \"0.4.4\",\n      \"resolved\": \"https://registry.npmmirror.com/regex-cache/-/regex-cache-0.4.4.tgz\",\n      \"integrity\": \"sha512-nVIZwtCjkC9YgvWkpM55B5rBhBYRZhAaJbgcFYXXsHnbZ9UZI9nnVWYZpBlCqv9ho2eZryPnWrZGsOdPwVWXWQ==\",\n      \"dev\": true,\n      \"optional\": true,\n      \"requires\": {\n        \"is-equal-shallow\": \"^0.1.3\"\n      }\n    },\n    \"regex-not\": {\n      \"version\": \"1.0.2\",\n      \"resolved\": \"https://registry.npmmirror.com/regex-not/-/regex-not-1.0.2.tgz\",\n      \"integrity\": \"sha512-J6SDjUgDxQj5NusnOtdFxDwN/+HWykR8GELwctJ7mdqhcyy1xEc4SRFHUXvxTp661YaVKAjfRLZ9cCqS6tn32A==\",\n      \"dev\": true,\n      \"optional\": true,\n      \"requires\": {\n        \"extend-shallow\": \"^3.0.2\",\n        \"safe-regex\": \"^1.1.0\"\n      }\n    },\n    \"regexpu-core\": {\n      \"version\": \"2.0.0\",\n      \"resolved\": \"https://registry.npmmirror.com/regexpu-core/-/regexpu-core-2.0.0.tgz\",\n      \"integrity\": \"sha512-tJ9+S4oKjxY8IZ9jmjnp/mtytu1u3iyIQAfmI51IKWH6bFf7XR1ybtaO6j7INhZKXOTYADk7V5qxaqLkmNxiZQ==\",\n      \"dev\": true,\n      \"requires\": {\n        \"regenerate\": \"^1.2.1\",\n        \"regjsgen\": \"^0.2.0\",\n        \"regjsparser\": \"^0.1.4\"\n      }\n    },\n    \"regjsgen\": {\n      \"version\": \"0.2.0\",\n      \"resolved\": \"https://registry.npmmirror.com/regjsgen/-/regjsgen-0.2.0.tgz\",\n      \"integrity\": \"sha512-x+Y3yA24uF68m5GA+tBjbGYo64xXVJpbToBaWCoSNSc1hdk6dfctaRWrNFTVJZIIhL5GxW8zwjoixbnifnK59g==\",\n      \"dev\": true\n    },\n    \"regjsparser\": {\n      \"version\": \"0.1.5\",\n      \"resolved\": \"https://registry.npmmirror.com/regjsparser/-/regjsparser-0.1.5.tgz\",\n      \"integrity\": \"sha512-jlQ9gYLfk2p3V5Ag5fYhA7fv7OHzd1KUH0PRP46xc3TgwjwgROIW572AfYg/X9kaNq/LJnu6oJcFRXlIrGoTRw==\",\n      \"dev\": true,\n      \"requires\": {\n        \"jsesc\": \"~0.5.0\"\n      },\n      \"dependencies\": {\n        \"jsesc\": {\n          \"version\": \"0.5.0\",\n          \"resolved\": \"https://registry.npmmirror.com/jsesc/-/jsesc-0.5.0.tgz\",\n          \"integrity\": \"sha512-uZz5UnB7u4T9LvwmFqXii7pZSouaRPorGs5who1Ip7VO0wxanFvBL7GkM6dTHlgX+jhBApRetaWpnDabOeTcnA==\",\n          \"dev\": true\n        }\n      }\n    },\n    \"remove-trailing-separator\": {\n      \"version\": \"1.1.0\",\n      \"resolved\": \"https://registry.npmmirror.com/remove-trailing-separator/-/remove-trailing-separator-1.1.0.tgz\",\n      \"integrity\": \"sha512-/hS+Y0u3aOfIETiaiirUFwDBDzmXPvO+jAfKTitUngIPzdKc6Z0LoFjM/CK5PL4C+eKwHohlHAb6H0VFfmmUsw==\",\n      \"dev\": true,\n      \"optional\": true\n    },\n    \"repeat-element\": {\n      \"version\": \"1.1.4\",\n      \"resolved\": \"https://registry.npmmirror.com/repeat-element/-/repeat-element-1.1.4.tgz\",\n      \"integrity\": \"sha512-LFiNfRcSu7KK3evMyYOuCzv3L10TW7yC1G2/+StMjK8Y6Vqd2MG7r/Qjw4ghtuCOjFvlnms/iMmLqpvW/ES/WQ==\",\n      \"dev\": true,\n      \"optional\": true\n    },\n    \"repeat-string\": {\n      \"version\": \"1.6.1\",\n      \"resolved\": \"https://registry.npmmirror.com/repeat-string/-/repeat-string-1.6.1.tgz\",\n      \"integrity\": \"sha512-PV0dzCYDNfRi1jCDbJzpW7jNNDRuCOG/jI5ctQcGKt/clZD+YcPS3yIlWuTJMmESC8aevCFmWJy5wjAFgNqN6w==\",\n      \"dev\": true,\n      \"optional\": true\n    },\n    \"repeating\": {\n      \"version\": \"2.0.1\",\n      \"resolved\": \"https://registry.npmmirror.com/repeating/-/repeating-2.0.1.tgz\",\n      \"integrity\": \"sha512-ZqtSMuVybkISo2OWvqvm7iHSWngvdaW3IpsT9/uP8v4gMi591LY6h35wdOfvQdWCKFWZWm2Y1Opp4kV7vQKT6A==\",\n      \"dev\": true,\n      \"requires\": {\n        \"is-finite\": \"^1.0.0\"\n      }\n    },\n    \"resolve-url\": {\n      \"version\": \"0.2.1\",\n      \"resolved\": \"https://registry.npmmirror.com/resolve-url/-/resolve-url-0.2.1.tgz\",\n      \"integrity\": \"sha512-ZuF55hVUQaaczgOIwqWzkEcEidmlD/xl44x1UZnhOXcYuFN2S6+rcxpG+C1N3So0wvNI3DmJICUFfu2SxhBmvg==\",\n      \"dev\": true,\n      \"optional\": true\n    },\n    \"ret\": {\n      \"version\": \"0.1.15\",\n      \"resolved\": \"https://registry.npmmirror.com/ret/-/ret-0.1.15.tgz\",\n      \"integrity\": \"sha512-TTlYpa+OL+vMMNG24xSlQGEJ3B/RzEfUlLct7b5G/ytav+wPrplCpVMFuwzXbkecJrb6IYo1iFb0S9v37754mg==\",\n      \"dev\": true,\n      \"optional\": true\n    },\n    \"safe-buffer\": {\n      \"version\": \"5.1.2\",\n      \"resolved\": \"https://registry.npmmirror.com/safe-buffer/-/safe-buffer-5.1.2.tgz\",\n      \"integrity\": \"sha512-Gd2UZBJDkXlY7GbJxfsE8/nvKkUEU1G38c1siN6QP6a9PT9MmHB8GnpscSmMJSoF8LOIrt8ud/wPtojys4G6+g==\",\n      \"dev\": true,\n      \"optional\": true\n    },\n    \"safe-regex\": {\n      \"version\": \"1.1.0\",\n      \"resolved\": \"https://registry.npmmirror.com/safe-regex/-/safe-regex-1.1.0.tgz\",\n      \"integrity\": \"sha512-aJXcif4xnaNUzvUuC5gcb46oTS7zvg4jpMTnuqtrEPlR3vFr4pxtdTwaF1Qs3Enjn9HK+ZlwQui+a7z0SywIzg==\",\n      \"dev\": true,\n      \"optional\": true,\n      \"requires\": {\n        \"ret\": \"~0.1.10\"\n      }\n    },\n    \"semver\": {\n      \"version\": \"5.7.1\",\n      \"resolved\": \"https://registry.npmmirror.com/semver/-/semver-5.7.1.tgz\",\n      \"integrity\": \"sha512-sauaDf/PZdVgrLTNYHRtpXa1iRiKcaebiKQ1BJdpQlWH2lCvexQdX55snPFyK7QzpudqbCI0qXFfOasHdyNDGQ==\",\n      \"dev\": true\n    },\n    \"set-value\": {\n      \"version\": \"2.0.1\",\n      \"resolved\": \"https://registry.npmmirror.com/set-value/-/set-value-2.0.1.tgz\",\n      \"integrity\": \"sha512-JxHc1weCN68wRY0fhCoXpyK55m/XPHafOmK4UWD7m2CI14GMcFypt4w/0+NV5f/ZMby2F6S2wwA7fgynh9gWSw==\",\n      \"dev\": true,\n      \"optional\": true,\n      \"requires\": {\n        \"extend-shallow\": \"^2.0.1\",\n        \"is-extendable\": \"^0.1.1\",\n        \"is-plain-object\": \"^2.0.3\",\n        \"split-string\": \"^3.0.1\"\n      },\n      \"dependencies\": {\n        \"extend-shallow\": {\n          \"version\": \"2.0.1\",\n          \"resolved\": \"https://registry.npmmirror.com/extend-shallow/-/extend-shallow-2.0.1.tgz\",\n          \"integrity\": \"sha512-zCnTtlxNoAiDc3gqY2aYAWFx7XWWiasuF2K8Me5WbN8otHKTUKBwjPtNpRs/rbUZm7KxWAaNj7P1a/p52GbVug==\",\n          \"dev\": true,\n          \"optional\": true,\n          \"requires\": {\n            \"is-extendable\": \"^0.1.0\"\n          }\n        }\n      }\n    },\n    \"slash\": {\n      \"version\": \"1.0.0\",\n      \"resolved\": \"https://registry.npmmirror.com/slash/-/slash-1.0.0.tgz\",\n      \"integrity\": \"sha512-3TYDR7xWt4dIqV2JauJr+EJeW356RXijHeUlO+8djJ+uBXPn8/2dpzBc8yQhh583sVvc9CvFAeQVgijsH+PNNg==\",\n      \"dev\": true\n    },\n    \"snapdragon\": {\n      \"version\": \"0.8.2\",\n      \"resolved\": \"https://registry.npmmirror.com/snapdragon/-/snapdragon-0.8.2.tgz\",\n      \"integrity\": \"sha512-FtyOnWN/wCHTVXOMwvSv26d+ko5vWlIDD6zoUJ7LW8vh+ZBC8QdljveRP+crNrtBwioEUWy/4dMtbBjA4ioNlg==\",\n      \"dev\": true,\n      \"optional\": true,\n      \"requires\": {\n        \"base\": \"^0.11.1\",\n        \"debug\": \"^2.2.0\",\n        \"define-property\": \"^0.2.5\",\n        \"extend-shallow\": \"^2.0.1\",\n        \"map-cache\": \"^0.2.2\",\n        \"source-map\": \"^0.5.6\",\n        \"source-map-resolve\": \"^0.5.0\",\n        \"use\": \"^3.1.0\"\n      },\n      \"dependencies\": {\n        \"define-property\": {\n          \"version\": \"0.2.5\",\n          \"resolved\": \"https://registry.npmmirror.com/define-property/-/define-property-0.2.5.tgz\",\n          \"integrity\": \"sha512-Rr7ADjQZenceVOAKop6ALkkRAmH1A4Gx9hV/7ZujPUN2rkATqFO0JZLZInbAjpZYoJ1gUx8MRMQVkYemcbMSTA==\",\n          \"dev\": true,\n          \"optional\": true,\n          \"requires\": {\n            \"is-descriptor\": \"^0.1.0\"\n          }\n        },\n        \"extend-shallow\": {\n          \"version\": \"2.0.1\",\n          \"resolved\": \"https://registry.npmmirror.com/extend-shallow/-/extend-shallow-2.0.1.tgz\",\n          \"integrity\": \"sha512-zCnTtlxNoAiDc3gqY2aYAWFx7XWWiasuF2K8Me5WbN8otHKTUKBwjPtNpRs/rbUZm7KxWAaNj7P1a/p52GbVug==\",\n          \"dev\": true,\n          \"optional\": true,\n          \"requires\": {\n            \"is-extendable\": \"^0.1.0\"\n          }\n        }\n      }\n    },\n    \"snapdragon-node\": {\n      \"version\": \"2.1.1\",\n      \"resolved\": \"https://registry.npmmirror.com/snapdragon-node/-/snapdragon-node-2.1.1.tgz\",\n      \"integrity\": \"sha512-O27l4xaMYt/RSQ5TR3vpWCAB5Kb/czIcqUFOM/C4fYcLnbZUc1PkjTAMjof2pBWaSTwOUd6qUHcFGVGj7aIwnw==\",\n      \"dev\": true,\n      \"optional\": true,\n      \"requires\": {\n        \"define-property\": \"^1.0.0\",\n        \"isobject\": \"^3.0.0\",\n        \"snapdragon-util\": \"^3.0.1\"\n      },\n      \"dependencies\": {\n        \"define-property\": {\n          \"version\": \"1.0.0\",\n          \"resolved\": \"https://registry.npmmirror.com/define-property/-/define-property-1.0.0.tgz\",\n          \"integrity\": \"sha512-cZTYKFWspt9jZsMscWo8sc/5lbPC9Q0N5nBLgb+Yd915iL3udB1uFgS3B8YCx66UVHq018DAVFoee7x+gxggeA==\",\n          \"dev\": true,\n          \"optional\": true,\n          \"requires\": {\n            \"is-descriptor\": \"^1.0.0\"\n          }\n        },\n        \"is-accessor-descriptor\": {\n          \"version\": \"1.0.0\",\n          \"resolved\": \"https://registry.npmmirror.com/is-accessor-descriptor/-/is-accessor-descriptor-1.0.0.tgz\",\n          \"integrity\": \"sha512-m5hnHTkcVsPfqx3AKlyttIPb7J+XykHvJP2B9bZDjlhLIoEq4XoK64Vg7boZlVWYK6LUY94dYPEE7Lh0ZkZKcQ==\",\n          \"dev\": true,\n          \"optional\": true,\n          \"requires\": {\n            \"kind-of\": \"^6.0.0\"\n          }\n        },\n        \"is-data-descriptor\": {\n          \"version\": \"1.0.0\",\n          \"resolved\": \"https://registry.npmmirror.com/is-data-descriptor/-/is-data-descriptor-1.0.0.tgz\",\n          \"integrity\": \"sha512-jbRXy1FmtAoCjQkVmIVYwuuqDFUbaOeDjmed1tOGPrsMhtJA4rD9tkgA0F1qJ3gRFRXcHYVkdeaP50Q5rE/jLQ==\",\n          \"dev\": true,\n          \"optional\": true,\n          \"requires\": {\n            \"kind-of\": \"^6.0.0\"\n          }\n        },\n        \"is-descriptor\": {\n          \"version\": \"1.0.2\",\n          \"resolved\": \"https://registry.npmmirror.com/is-descriptor/-/is-descriptor-1.0.2.tgz\",\n          \"integrity\": \"sha512-2eis5WqQGV7peooDyLmNEPUrps9+SXX5c9pL3xEB+4e9HnGuDa7mB7kHxHw4CbqS9k1T2hOH3miL8n8WtiYVtg==\",\n          \"dev\": true,\n          \"optional\": true,\n          \"requires\": {\n            \"is-accessor-descriptor\": \"^1.0.0\",\n            \"is-data-descriptor\": \"^1.0.0\",\n            \"kind-of\": \"^6.0.2\"\n          }\n        },\n        \"isobject\": {\n          \"version\": \"3.0.1\",\n          \"resolved\": \"https://registry.npmmirror.com/isobject/-/isobject-3.0.1.tgz\",\n          \"integrity\": \"sha512-WhB9zCku7EGTj/HQQRz5aUQEUeoQZH2bWcltRErOpymJ4boYE6wL9Tbr23krRPSZ+C5zqNSrSw+Cc7sZZ4b7vg==\",\n          \"dev\": true,\n          \"optional\": true\n        },\n        \"kind-of\": {\n          \"version\": \"6.0.3\",\n          \"resolved\": \"https://registry.npmmirror.com/kind-of/-/kind-of-6.0.3.tgz\",\n          \"integrity\": \"sha512-dcS1ul+9tmeD95T+x28/ehLgd9mENa3LsvDTtzm3vyBEO7RPptvAD+t44WVXaUjTBRcrpFeFlC8WCruUR456hw==\",\n          \"dev\": true,\n          \"optional\": true\n        }\n      }\n    },\n    \"snapdragon-util\": {\n      \"version\": \"3.0.1\",\n      \"resolved\": \"https://registry.npmmirror.com/snapdragon-util/-/snapdragon-util-3.0.1.tgz\",\n      \"integrity\": \"sha512-mbKkMdQKsjX4BAL4bRYTj21edOf8cN7XHdYUJEe+Zn99hVEYcMvKPct1IqNe7+AZPirn8BCDOQBHQZknqmKlZQ==\",\n      \"dev\": true,\n      \"optional\": true,\n      \"requires\": {\n        \"kind-of\": \"^3.2.0\"\n      }\n    },\n    \"source-map\": {\n      \"version\": \"0.5.7\",\n      \"resolved\": \"https://registry.npmmirror.com/source-map/-/source-map-0.5.7.tgz\",\n      \"integrity\": \"sha512-LbrmJOMUSdEVxIKvdcJzQC+nQhe8FUZQTXQy6+I75skNgn3OoQ0DZA8YnFa7gp8tqtL3KPf1kmo0R5DoApeSGQ==\",\n      \"dev\": true\n    },\n    \"source-map-resolve\": {\n      \"version\": \"0.5.3\",\n      \"resolved\": \"https://registry.npmmirror.com/source-map-resolve/-/source-map-resolve-0.5.3.tgz\",\n      \"integrity\": \"sha512-Htz+RnsXWk5+P2slx5Jh3Q66vhQj1Cllm0zvnaY98+NFx+Dv2CF/f5O/t8x+KaNdrdIAsruNzoh/KpialbqAnw==\",\n      \"dev\": true,\n      \"optional\": true,\n      \"requires\": {\n        \"atob\": \"^2.1.2\",\n        \"decode-uri-component\": \"^0.2.0\",\n        \"resolve-url\": \"^0.2.1\",\n        \"source-map-url\": \"^0.4.0\",\n        \"urix\": \"^0.1.0\"\n      }\n    },\n    \"source-map-support\": {\n      \"version\": \"0.4.18\",\n      \"resolved\": \"https://registry.npmmirror.com/source-map-support/-/source-map-support-0.4.18.tgz\",\n      \"integrity\": \"sha512-try0/JqxPLF9nOjvSta7tVondkP5dwgyLDjVoyMDlmjugT2lRZ1OfsrYTkCd2hkDnJTKRbO/Rl3orm8vlsUzbA==\",\n      \"dev\": true,\n      \"requires\": {\n        \"source-map\": \"^0.5.6\"\n      }\n    },\n    \"source-map-url\": {\n      \"version\": \"0.4.1\",\n      \"resolved\": \"https://registry.npmmirror.com/source-map-url/-/source-map-url-0.4.1.tgz\",\n      \"integrity\": \"sha512-cPiFOTLUKvJFIg4SKVScy4ilPPW6rFgMgfuZJPNoDuMs3nC1HbMUycBoJw77xFIp6z1UJQJOfx6C9GMH80DiTw==\",\n      \"dev\": true,\n      \"optional\": true\n    },\n    \"split-string\": {\n      \"version\": \"3.1.0\",\n      \"resolved\": \"https://registry.npmmirror.com/split-string/-/split-string-3.1.0.tgz\",\n      \"integrity\": \"sha512-NzNVhJDYpwceVVii8/Hu6DKfD2G+NrQHlS/V/qgv763EYudVwEcMQNxd2lh+0VrUByXN/oJkl5grOhYWvQUYiw==\",\n      \"dev\": true,\n      \"optional\": true,\n      \"requires\": {\n        \"extend-shallow\": \"^3.0.0\"\n      }\n    },\n    \"static-extend\": {\n      \"version\": \"0.1.2\",\n      \"resolved\": \"https://registry.npmmirror.com/static-extend/-/static-extend-0.1.2.tgz\",\n      \"integrity\": \"sha512-72E9+uLc27Mt718pMHt9VMNiAL4LMsmDbBva8mxWUCkT07fSzEGMYUCk0XWY6lp0j6RBAG4cJ3mWuZv2OE3s0g==\",\n      \"dev\": true,\n      \"optional\": true,\n      \"requires\": {\n        \"define-property\": \"^0.2.5\",\n        \"object-copy\": \"^0.1.0\"\n      },\n      \"dependencies\": {\n        \"define-property\": {\n          \"version\": \"0.2.5\",\n          \"resolved\": \"https://registry.npmmirror.com/define-property/-/define-property-0.2.5.tgz\",\n          \"integrity\": \"sha512-Rr7ADjQZenceVOAKop6ALkkRAmH1A4Gx9hV/7ZujPUN2rkATqFO0JZLZInbAjpZYoJ1gUx8MRMQVkYemcbMSTA==\",\n          \"dev\": true,\n          \"optional\": true,\n          \"requires\": {\n            \"is-descriptor\": \"^0.1.0\"\n          }\n        }\n      }\n    },\n    \"string_decoder\": {\n      \"version\": \"1.1.1\",\n      \"resolved\": \"https://registry.npmmirror.com/string_decoder/-/string_decoder-1.1.1.tgz\",\n      \"integrity\": \"sha512-n/ShnvDi6FHbbVfviro+WojiFzv+s8MPMHBczVePfUpDJLwoLT0ht1l4YwBCbi8pJAveEEdnkHyPyTP/mzRfwg==\",\n      \"dev\": true,\n      \"optional\": true,\n      \"requires\": {\n        \"safe-buffer\": \"~5.1.0\"\n      }\n    },\n    \"strip-ansi\": {\n      \"version\": \"3.0.1\",\n      \"resolved\": \"https://registry.npmmirror.com/strip-ansi/-/strip-ansi-3.0.1.tgz\",\n      \"integrity\": \"sha512-VhumSSbBqDTP8p2ZLKj40UjBCV4+v8bUSEpUb4KjRgWk9pbqGF4REFj6KEagidb2f/M6AzC0EmFyDNGaw9OCzg==\",\n      \"dev\": true,\n      \"requires\": {\n        \"ansi-regex\": \"^2.0.0\"\n      }\n    },\n    \"supports-color\": {\n      \"version\": \"2.0.0\",\n      \"resolved\": \"https://registry.npmmirror.com/supports-color/-/supports-color-2.0.0.tgz\",\n      \"integrity\": \"sha512-KKNVtd6pCYgPIKU4cp2733HWYCpplQhddZLBUryaAHou723x+FRzQ5Df824Fj+IyyuiQTRoub4SnIFfIcrp70g==\",\n      \"dev\": true\n    },\n    \"to-fast-properties\": {\n      \"version\": \"1.0.3\",\n      \"resolved\": \"https://registry.npmmirror.com/to-fast-properties/-/to-fast-properties-1.0.3.tgz\",\n      \"integrity\": \"sha512-lxrWP8ejsq+7E3nNjwYmUBMAgjMTZoTI+sdBOpvNyijeDLa29LUn9QaoXAHv4+Z578hbmHHJKZknzxVtvo77og==\",\n      \"dev\": true\n    },\n    \"to-object-path\": {\n      \"version\": \"0.3.0\",\n      \"resolved\": \"https://registry.npmmirror.com/to-object-path/-/to-object-path-0.3.0.tgz\",\n      \"integrity\": \"sha512-9mWHdnGRuh3onocaHzukyvCZhzvr6tiflAy/JRFXcJX0TjgfWA9pk9t8CMbzmBE4Jfw58pXbkngtBtqYxzNEyg==\",\n      \"dev\": true,\n      \"optional\": true,\n      \"requires\": {\n        \"kind-of\": \"^3.0.2\"\n      }\n    },\n    \"to-regex\": {\n      \"version\": \"3.0.2\",\n      \"resolved\": \"https://registry.npmmirror.com/to-regex/-/to-regex-3.0.2.tgz\",\n      \"integrity\": \"sha512-FWtleNAtZ/Ki2qtqej2CXTOayOH9bHDQF+Q48VpWyDXjbYxA4Yz8iDB31zXOBUlOHHKidDbqGVrTUvQMPmBGBw==\",\n      \"dev\": true,\n      \"optional\": true,\n      \"requires\": {\n        \"define-property\": \"^2.0.2\",\n        \"extend-shallow\": \"^3.0.2\",\n        \"regex-not\": \"^1.0.2\",\n        \"safe-regex\": \"^1.1.0\"\n      }\n    },\n    \"to-regex-range\": {\n      \"version\": \"2.1.1\",\n      \"resolved\": \"https://registry.npmmirror.com/to-regex-range/-/to-regex-range-2.1.1.tgz\",\n      \"integrity\": \"sha512-ZZWNfCjUokXXDGXFpZehJIkZqq91BcULFq/Pi7M5i4JnxXdhMKAK682z8bCW3o8Hj1wuuzoKcW3DfVzaP6VuNg==\",\n      \"dev\": true,\n      \"optional\": true,\n      \"requires\": {\n        \"is-number\": \"^3.0.0\",\n        \"repeat-string\": \"^1.6.1\"\n      },\n      \"dependencies\": {\n        \"is-number\": {\n          \"version\": \"3.0.0\",\n          \"resolved\": \"https://registry.npmmirror.com/is-number/-/is-number-3.0.0.tgz\",\n          \"integrity\": \"sha512-4cboCqIpliH+mAvFNegjZQ4kgKc3ZUhQVr3HvWbSh5q3WH2v82ct+T2Y1hdU5Gdtorx/cLifQjqCbL7bpznLTg==\",\n          \"dev\": true,\n          \"optional\": true,\n          \"requires\": {\n            \"kind-of\": \"^3.0.2\"\n          }\n        }\n      }\n    },\n    \"trim-right\": {\n      \"version\": \"1.0.1\",\n      \"resolved\": \"https://registry.npmmirror.com/trim-right/-/trim-right-1.0.1.tgz\",\n      \"integrity\": \"sha512-WZGXGstmCWgeevgTL54hrCuw1dyMQIzWy7ZfqRJfSmJZBwklI15egmQytFP6bPidmw3M8d5yEowl1niq4vmqZw==\",\n      \"dev\": true\n    },\n    \"union-value\": {\n      \"version\": \"1.0.1\",\n      \"resolved\": \"https://registry.npmmirror.com/union-value/-/union-value-1.0.1.tgz\",\n      \"integrity\": \"sha512-tJfXmxMeWYnczCVs7XAEvIV7ieppALdyepWMkHkwciRpZraG/xwT+s2JN8+pr1+8jCRf80FFzvr+MpQeeoF4Xg==\",\n      \"dev\": true,\n      \"optional\": true,\n      \"requires\": {\n        \"arr-union\": \"^3.1.0\",\n        \"get-value\": \"^2.0.6\",\n        \"is-extendable\": \"^0.1.1\",\n        \"set-value\": \"^2.0.1\"\n      }\n    },\n    \"unset-value\": {\n      \"version\": \"1.0.0\",\n      \"resolved\": \"https://registry.npmmirror.com/unset-value/-/unset-value-1.0.0.tgz\",\n      \"integrity\": \"sha512-PcA2tsuGSF9cnySLHTLSh2qrQiJ70mn+r+Glzxv2TWZblxsxCC52BDlZoPCsz7STd9pN7EZetkWZBAvk4cgZdQ==\",\n      \"dev\": true,\n      \"optional\": true,\n      \"requires\": {\n        \"has-value\": \"^0.3.1\",\n        \"isobject\": \"^3.0.0\"\n      },\n      \"dependencies\": {\n        \"has-value\": {\n          \"version\": \"0.3.1\",\n          \"resolved\": \"https://registry.npmmirror.com/has-value/-/has-value-0.3.1.tgz\",\n          \"integrity\": \"sha512-gpG936j8/MzaeID5Yif+577c17TxaDmhuyVgSwtnL/q8UUTySg8Mecb+8Cf1otgLoD7DDH75axp86ER7LFsf3Q==\",\n          \"dev\": true,\n          \"optional\": true,\n          \"requires\": {\n            \"get-value\": \"^2.0.3\",\n            \"has-values\": \"^0.1.4\",\n            \"isobject\": \"^2.0.0\"\n          },\n          \"dependencies\": {\n            \"isobject\": {\n              \"version\": \"2.1.0\",\n              \"resolved\": \"https://registry.npmmirror.com/isobject/-/isobject-2.1.0.tgz\",\n              \"integrity\": \"sha512-+OUdGJlgjOBZDfxnDjYYG6zp487z0JGNQq3cYQYg5f5hKR+syHMsaztzGeml/4kGG55CSpKSpWTY+jYGgsHLgA==\",\n              \"dev\": true,\n              \"optional\": true,\n              \"requires\": {\n                \"isarray\": \"1.0.0\"\n              }\n            }\n          }\n        },\n        \"has-values\": {\n          \"version\": \"0.1.4\",\n          \"resolved\": \"https://registry.npmmirror.com/has-values/-/has-values-0.1.4.tgz\",\n          \"integrity\": \"sha512-J8S0cEdWuQbqD9//tlZxiMuMNmxB8PlEwvYwuxsTmR1G5RXUePEX/SJn7aD0GMLieuZYSwNH0cQuJGwnYunXRQ==\",\n          \"dev\": true,\n          \"optional\": true\n        },\n        \"isobject\": {\n          \"version\": \"3.0.1\",\n          \"resolved\": \"https://registry.npmmirror.com/isobject/-/isobject-3.0.1.tgz\",\n          \"integrity\": \"sha512-WhB9zCku7EGTj/HQQRz5aUQEUeoQZH2bWcltRErOpymJ4boYE6wL9Tbr23krRPSZ+C5zqNSrSw+Cc7sZZ4b7vg==\",\n          \"dev\": true,\n          \"optional\": true\n        }\n      }\n    },\n    \"urix\": {\n      \"version\": \"0.1.0\",\n      \"resolved\": \"https://registry.npmmirror.com/urix/-/urix-0.1.0.tgz\",\n      \"integrity\": \"sha512-Am1ousAhSLBeB9cG/7k7r2R0zj50uDRlZHPGbazid5s9rlF1F/QKYObEKSIunSjIOkJZqwRRLpvewjEkM7pSqg==\",\n      \"dev\": true,\n      \"optional\": true\n    },\n    \"use\": {\n      \"version\": \"3.1.1\",\n      \"resolved\": \"https://registry.npmmirror.com/use/-/use-3.1.1.tgz\",\n      \"integrity\": \"sha512-cwESVXlO3url9YWlFW/TA9cshCEhtu7IKJ/p5soJ/gGpj7vbvFrAY/eIioQ6Dw23KjZhYgiIo8HOs1nQ2vr/oQ==\",\n      \"dev\": true,\n      \"optional\": true\n    },\n    \"user-home\": {\n      \"version\": \"1.1.1\",\n      \"resolved\": \"https://registry.npmmirror.com/user-home/-/user-home-1.1.1.tgz\",\n      \"integrity\": \"sha512-aggiKfEEubv3UwRNqTzLInZpAOmKzwdHqEBmW/hBA/mt99eg+b4VrX6i+IRLxU8+WJYfa33rGwRseg4eElUgsQ==\",\n      \"dev\": true\n    },\n    \"util-deprecate\": {\n      \"version\": \"1.0.2\",\n      \"resolved\": \"https://registry.npmmirror.com/util-deprecate/-/util-deprecate-1.0.2.tgz\",\n      \"integrity\": \"sha512-EPD5q1uXyFxJpCrLnCc1nHnq3gOa6DZBocAIiI2TaSCA7VCJ1UJDMagCzIkXNsUYfD1daK//LTEQ8xiIbrHtcw==\",\n      \"dev\": true,\n      \"optional\": true\n    },\n    \"v8flags\": {\n      \"version\": \"2.1.1\",\n      \"resolved\": \"https://registry.npmmirror.com/v8flags/-/v8flags-2.1.1.tgz\",\n      \"integrity\": \"sha512-SKfhk/LlaXzvtowJabLZwD4K6SGRYeoxA7KJeISlUMAB/NT4CBkZjMq3WceX2Ckm4llwqYVo8TICgsDYCBU2tA==\",\n      \"dev\": true,\n      \"requires\": {\n        \"user-home\": \"^1.1.1\"\n      }\n    },\n    \"wrappy\": {\n      \"version\": \"1.0.2\",\n      \"resolved\": \"https://registry.npmmirror.com/wrappy/-/wrappy-1.0.2.tgz\",\n      \"integrity\": \"sha512-l4Sp/DRseor9wL6EvV2+TuQn63dMkPjZ/sp9XkghTEbV9KlPS1xUsZ3u7/IQO4wxtcFB4bgpQPRcR3QCvezPcQ==\",\n      \"dev\": true\n    }\n  }\n}\n","date":"2023-05-12T10:49:20.023Z","updated":"2023-05-12T10:49:20.023Z","path":"demo/2023面试准备/demo/module/package-lock.json","layout":"false","title":"","comments":1,"_id":"clhkizgyr003f3y0q6msw87jo","content":"{\"name\":\"module\",\"version\":\"1.0.0\",\"lockfileVersion\":1,\"requires\":true,\"dependencies\":{\"ansi-regex\":{\"version\":\"2.1.1\",\"resolved\":\"https://registry.npmmirror.com/ansi-regex/-/ansi-regex-2.1.1.tgz\",\"integrity\":\"sha512-TIGnTpdo+E3+pCyAluZvtED5p5wCqLdezCyhPZzKPcxvFplEt4i+W7OONCKgeZFT3+y5NZZfOOS/Bdcanm1MYA==\",\"dev\":true},\"ansi-styles\":{\"version\":\"2.2.1\",\"resolved\":\"https://registry.npmmirror.com/ansi-styles/-/ansi-styles-2.2.1.tgz\",\"integrity\":\"sha512-kmCevFghRiWM7HB5zTPULl4r9bVFSWjz62MhqizDGUrq2NWuNMQyuv4tHHoKJHs69M/MF64lEcHdYIocrdWQYA==\",\"dev\":true},\"anymatch\":{\"version\":\"1.3.2\",\"resolved\":\"https://registry.npmmirror.com/anymatch/-/anymatch-1.3.2.tgz\",\"integrity\":\"sha512-0XNayC8lTHQ2OI8aljNCN3sSx6hsr/1+rlcDAotXJR7C1oZZHCNsfpbKwMjRA3Uqb5tF1Rae2oloTr4xpq+WjA==\",\"dev\":true,\"optional\":true,\"requires\":{\"micromatch\":\"^2.1.5\",\"normalize-path\":\"^2.0.0\"}},\"arr-diff\":{\"version\":\"2.0.0\",\"resolved\":\"https://registry.npmmirror.com/arr-diff/-/arr-diff-2.0.0.tgz\",\"integrity\":\"sha512-dtXTVMkh6VkEEA7OhXnN1Ecb8aAGFdZ1LFxtOCoqj4qkyOJMt7+qs6Ahdy6p/NQCPYsRSXXivhSB/J5E9jmYKA==\",\"dev\":true,\"optional\":true,\"requires\":{\"arr-flatten\":\"^1.0.1\"}},\"arr-flatten\":{\"version\":\"1.1.0\",\"resolved\":\"https://registry.npmmirror.com/arr-flatten/-/arr-flatten-1.1.0.tgz\",\"integrity\":\"sha512-L3hKV5R/p5o81R7O02IGnwpDmkp6E982XhtbuwSe3O4qOtMMMtodicASA1Cny2U+aCXcNpml+m4dPsvsJ3jatg==\",\"dev\":true,\"optional\":true},\"arr-union\":{\"version\":\"3.1.0\",\"resolved\":\"https://registry.npmmirror.com/arr-union/-/arr-union-3.1.0.tgz\",\"integrity\":\"sha512-sKpyeERZ02v1FeCZT8lrfJq5u6goHCtpTAzPwJYe7c8SPFOboNjNg1vz2L4VTn9T4PQxEx13TbXLmYUcS6Ug7Q==\",\"dev\":true,\"optional\":true},\"array-unique\":{\"version\":\"0.2.1\",\"resolved\":\"https://registry.npmmirror.com/array-unique/-/array-unique-0.2.1.tgz\",\"integrity\":\"sha512-G2n5bG5fSUCpnsXz4+8FUkYsGPkNfLn9YvS66U5qbTIXI2Ynnlo4Bi42bWv+omKUCqz+ejzfClwne0alJWJPhg==\",\"dev\":true,\"optional\":true},\"assign-symbols\":{\"version\":\"1.0.0\",\"resolved\":\"https://registry.npmmirror.com/assign-symbols/-/assign-symbols-1.0.0.tgz\",\"integrity\":\"sha512-Q+JC7Whu8HhmTdBph/Tq59IoRtoy6KAm5zzPv00WdujX82lbAL8K7WVjne7vdCsAmbF4AYaDOPyO3k0kl8qIrw==\",\"dev\":true,\"optional\":true},\"async-each\":{\"version\":\"1.0.6\",\"resolved\":\"https://registry.npmmirror.com/async-each/-/async-each-1.0.6.tgz\",\"integrity\":\"sha512-c646jH1avxr+aVpndVMeAfYw7wAa6idufrlN3LPA4PmKS0QEGp6PIC9nwz0WQkkvBGAMEki3pFdtxaF39J9vvg==\",\"dev\":true,\"optional\":true},\"atob\":{\"version\":\"2.1.2\",\"resolved\":\"https://registry.npmmirror.com/atob/-/atob-2.1.2.tgz\",\"integrity\":\"sha512-Wm6ukoaOGJi/73p/cl2GvLjTI5JM1k/O14isD73YML8StrH/7/lRFgmg8nICZgD3bZZvjwCGxtMOD3wWNAu8cg==\",\"dev\":true,\"optional\":true},\"babel-cli\":{\"version\":\"6.26.0\",\"resolved\":\"https://registry.npmmirror.com/babel-cli/-/babel-cli-6.26.0.tgz\",\"integrity\":\"sha512-wau+BDtQfuSBGQ9PzzFL3REvR9Sxnd4LKwtcHAiPjhugA7K/80vpHXafj+O5bAqJOuSefjOx5ZJnNSR2J1Qw6Q==\",\"dev\":true,\"requires\":{\"babel-core\":\"^6.26.0\",\"babel-polyfill\":\"^6.26.0\",\"babel-register\":\"^6.26.0\",\"babel-runtime\":\"^6.26.0\",\"chokidar\":\"^1.6.1\",\"commander\":\"^2.11.0\",\"convert-source-map\":\"^1.5.0\",\"fs-readdir-recursive\":\"^1.0.0\",\"glob\":\"^7.1.2\",\"lodash\":\"^4.17.4\",\"output-file-sync\":\"^1.1.2\",\"path-is-absolute\":\"^1.0.1\",\"slash\":\"^1.0.0\",\"source-map\":\"^0.5.6\",\"v8flags\":\"^2.1.1\"}},\"babel-code-frame\":{\"version\":\"6.26.0\",\"resolved\":\"https://registry.npmmirror.com/babel-code-frame/-/babel-code-frame-6.26.0.tgz\",\"integrity\":\"sha512-XqYMR2dfdGMW+hd0IUZ2PwK+fGeFkOxZJ0wY+JaQAHzt1Zx8LcvpiZD2NiGkEG8qx0CfkAOr5xt76d1e8vG90g==\",\"dev\":true,\"requires\":{\"chalk\":\"^1.1.3\",\"esutils\":\"^2.0.2\",\"js-tokens\":\"^3.0.2\"}},\"babel-core\":{\"version\":\"6.26.3\",\"resolved\":\"https://registry.npmmirror.com/babel-core/-/babel-core-6.26.3.tgz\",\"integrity\":\"sha512-6jyFLuDmeidKmUEb3NM+/yawG0M2bDZ9Z1qbZP59cyHLz8kYGKYwpJP0UwUKKUiTRNvxfLesJnTedqczP7cTDA==\",\"dev\":true,\"requires\":{\"babel-code-frame\":\"^6.26.0\",\"babel-generator\":\"^6.26.0\",\"babel-helpers\":\"^6.24.1\",\"babel-messages\":\"^6.23.0\",\"babel-register\":\"^6.26.0\",\"babel-runtime\":\"^6.26.0\",\"babel-template\":\"^6.26.0\",\"babel-traverse\":\"^6.26.0\",\"babel-types\":\"^6.26.0\",\"babylon\":\"^6.18.0\",\"convert-source-map\":\"^1.5.1\",\"debug\":\"^2.6.9\",\"json5\":\"^0.5.1\",\"lodash\":\"^4.17.4\",\"minimatch\":\"^3.0.4\",\"path-is-absolute\":\"^1.0.1\",\"private\":\"^0.1.8\",\"slash\":\"^1.0.0\",\"source-map\":\"^0.5.7\"}},\"babel-generator\":{\"version\":\"6.26.1\",\"resolved\":\"https://registry.npmmirror.com/babel-generator/-/babel-generator-6.26.1.tgz\",\"integrity\":\"sha512-HyfwY6ApZj7BYTcJURpM5tznulaBvyio7/0d4zFOeMPUmfxkCjHocCuoLa2SAGzBI8AREcH3eP3758F672DppA==\",\"dev\":true,\"requires\":{\"babel-messages\":\"^6.23.0\",\"babel-runtime\":\"^6.26.0\",\"babel-types\":\"^6.26.0\",\"detect-indent\":\"^4.0.0\",\"jsesc\":\"^1.3.0\",\"lodash\":\"^4.17.4\",\"source-map\":\"^0.5.7\",\"trim-right\":\"^1.0.1\"}},\"babel-helper-builder-binary-assignment-operator-visitor\":{\"version\":\"6.24.1\",\"resolved\":\"https://registry.npmmirror.com/babel-helper-builder-binary-assignment-operator-visitor/-/babel-helper-builder-binary-assignment-operator-visitor-6.24.1.tgz\",\"integrity\":\"sha512-gCtfYORSG1fUMX4kKraymq607FWgMWg+j42IFPc18kFQEsmtaibP4UrqsXt8FlEJle25HUd4tsoDR7H2wDhe9Q==\",\"dev\":true,\"requires\":{\"babel-helper-explode-assignable-expression\":\"^6.24.1\",\"babel-runtime\":\"^6.22.0\",\"babel-types\":\"^6.24.1\"}},\"babel-helper-call-delegate\":{\"version\":\"6.24.1\",\"resolved\":\"https://registry.npmmirror.com/babel-helper-call-delegate/-/babel-helper-call-delegate-6.24.1.tgz\",\"integrity\":\"sha512-RL8n2NiEj+kKztlrVJM9JT1cXzzAdvWFh76xh/H1I4nKwunzE4INBXn8ieCZ+wh4zWszZk7NBS1s/8HR5jDkzQ==\",\"dev\":true,\"requires\":{\"babel-helper-hoist-variables\":\"^6.24.1\",\"babel-runtime\":\"^6.22.0\",\"babel-traverse\":\"^6.24.1\",\"babel-types\":\"^6.24.1\"}},\"babel-helper-define-map\":{\"version\":\"6.26.0\",\"resolved\":\"https://registry.npmmirror.com/babel-helper-define-map/-/babel-helper-define-map-6.26.0.tgz\",\"integrity\":\"sha512-bHkmjcC9lM1kmZcVpA5t2om2nzT/xiZpo6TJq7UlZ3wqKfzia4veeXbIhKvJXAMzhhEBd3cR1IElL5AenWEUpA==\",\"dev\":true,\"requires\":{\"babel-helper-function-name\":\"^6.24.1\",\"babel-runtime\":\"^6.26.0\",\"babel-types\":\"^6.26.0\",\"lodash\":\"^4.17.4\"}},\"babel-helper-explode-assignable-expression\":{\"version\":\"6.24.1\",\"resolved\":\"https://registry.npmmirror.com/babel-helper-explode-assignable-expression/-/babel-helper-explode-assignable-expression-6.24.1.tgz\",\"integrity\":\"sha512-qe5csbhbvq6ccry9G7tkXbzNtcDiH4r51rrPUbwwoTzZ18AqxWYRZT6AOmxrpxKnQBW0pYlBI/8vh73Z//78nQ==\",\"dev\":true,\"requires\":{\"babel-runtime\":\"^6.22.0\",\"babel-traverse\":\"^6.24.1\",\"babel-types\":\"^6.24.1\"}},\"babel-helper-function-name\":{\"version\":\"6.24.1\",\"resolved\":\"https://registry.npmmirror.com/babel-helper-function-name/-/babel-helper-function-name-6.24.1.tgz\",\"integrity\":\"sha512-Oo6+e2iX+o9eVvJ9Y5eKL5iryeRdsIkwRYheCuhYdVHsdEQysbc2z2QkqCLIYnNxkT5Ss3ggrHdXiDI7Dhrn4Q==\",\"dev\":true,\"requires\":{\"babel-helper-get-function-arity\":\"^6.24.1\",\"babel-runtime\":\"^6.22.0\",\"babel-template\":\"^6.24.1\",\"babel-traverse\":\"^6.24.1\",\"babel-types\":\"^6.24.1\"}},\"babel-helper-get-function-arity\":{\"version\":\"6.24.1\",\"resolved\":\"https://registry.npmmirror.com/babel-helper-get-function-arity/-/babel-helper-get-function-arity-6.24.1.tgz\",\"integrity\":\"sha512-WfgKFX6swFB1jS2vo+DwivRN4NB8XUdM3ij0Y1gnC21y1tdBoe6xjVnd7NSI6alv+gZXCtJqvrTeMW3fR/c0ng==\",\"dev\":true,\"requires\":{\"babel-runtime\":\"^6.22.0\",\"babel-types\":\"^6.24.1\"}},\"babel-helper-hoist-variables\":{\"version\":\"6.24.1\",\"resolved\":\"https://registry.npmmirror.com/babel-helper-hoist-variables/-/babel-helper-hoist-variables-6.24.1.tgz\",\"integrity\":\"sha512-zAYl3tqerLItvG5cKYw7f1SpvIxS9zi7ohyGHaI9cgDUjAT6YcY9jIEH5CstetP5wHIVSceXwNS7Z5BpJg+rOw==\",\"dev\":true,\"requires\":{\"babel-runtime\":\"^6.22.0\",\"babel-types\":\"^6.24.1\"}},\"babel-helper-optimise-call-expression\":{\"version\":\"6.24.1\",\"resolved\":\"https://registry.npmmirror.com/babel-helper-optimise-call-expression/-/babel-helper-optimise-call-expression-6.24.1.tgz\",\"integrity\":\"sha512-Op9IhEaxhbRT8MDXx2iNuMgciu2V8lDvYCNQbDGjdBNCjaMvyLf4wl4A3b8IgndCyQF8TwfgsQ8T3VD8aX1/pA==\",\"dev\":true,\"requires\":{\"babel-runtime\":\"^6.22.0\",\"babel-types\":\"^6.24.1\"}},\"babel-helper-regex\":{\"version\":\"6.26.0\",\"resolved\":\"https://registry.npmmirror.com/babel-helper-regex/-/babel-helper-regex-6.26.0.tgz\",\"integrity\":\"sha512-VlPiWmqmGJp0x0oK27Out1D+71nVVCTSdlbhIVoaBAj2lUgrNjBCRR9+llO4lTSb2O4r7PJg+RobRkhBrf6ofg==\",\"dev\":true,\"requires\":{\"babel-runtime\":\"^6.26.0\",\"babel-types\":\"^6.26.0\",\"lodash\":\"^4.17.4\"}},\"babel-helper-remap-async-to-generator\":{\"version\":\"6.24.1\",\"resolved\":\"https://registry.npmmirror.com/babel-helper-remap-async-to-generator/-/babel-helper-remap-async-to-generator-6.24.1.tgz\",\"integrity\":\"sha512-RYqaPD0mQyQIFRu7Ho5wE2yvA/5jxqCIj/Lv4BXNq23mHYu/vxikOy2JueLiBxQknwapwrJeNCesvY0ZcfnlHg==\",\"dev\":true,\"requires\":{\"babel-helper-function-name\":\"^6.24.1\",\"babel-runtime\":\"^6.22.0\",\"babel-template\":\"^6.24.1\",\"babel-traverse\":\"^6.24.1\",\"babel-types\":\"^6.24.1\"}},\"babel-helper-replace-supers\":{\"version\":\"6.24.1\",\"resolved\":\"https://registry.npmmirror.com/babel-helper-replace-supers/-/babel-helper-replace-supers-6.24.1.tgz\",\"integrity\":\"sha512-sLI+u7sXJh6+ToqDr57Bv973kCepItDhMou0xCP2YPVmR1jkHSCY+p1no8xErbV1Siz5QE8qKT1WIwybSWlqjw==\",\"dev\":true,\"requires\":{\"babel-helper-optimise-call-expression\":\"^6.24.1\",\"babel-messages\":\"^6.23.0\",\"babel-runtime\":\"^6.22.0\",\"babel-template\":\"^6.24.1\",\"babel-traverse\":\"^6.24.1\",\"babel-types\":\"^6.24.1\"}},\"babel-helpers\":{\"version\":\"6.24.1\",\"resolved\":\"https://registry.npmmirror.com/babel-helpers/-/babel-helpers-6.24.1.tgz\",\"integrity\":\"sha512-n7pFrqQm44TCYvrCDb0MqabAF+JUBq+ijBvNMUxpkLjJaAu32faIexewMumrH5KLLJ1HDyT0PTEqRyAe/GwwuQ==\",\"dev\":true,\"requires\":{\"babel-runtime\":\"^6.22.0\",\"babel-template\":\"^6.24.1\"}},\"babel-messages\":{\"version\":\"6.23.0\",\"resolved\":\"https://registry.npmmirror.com/babel-messages/-/babel-messages-6.23.0.tgz\",\"integrity\":\"sha512-Bl3ZiA+LjqaMtNYopA9TYE9HP1tQ+E5dLxE0XrAzcIJeK2UqF0/EaqXwBn9esd4UmTfEab+P+UYQ1GnioFIb/w==\",\"dev\":true,\"requires\":{\"babel-runtime\":\"^6.22.0\"}},\"babel-plugin-check-es2015-constants\":{\"version\":\"6.22.0\",\"resolved\":\"https://registry.npmmirror.com/babel-plugin-check-es2015-constants/-/babel-plugin-check-es2015-constants-6.22.0.tgz\",\"integrity\":\"sha512-B1M5KBP29248dViEo1owyY32lk1ZSH2DaNNrXLGt8lyjjHm7pBqAdQ7VKUPR6EEDO323+OvT3MQXbCin8ooWdA==\",\"dev\":true,\"requires\":{\"babel-runtime\":\"^6.22.0\"}},\"babel-plugin-syntax-async-functions\":{\"version\":\"6.13.0\",\"resolved\":\"https://registry.npmmirror.com/babel-plugin-syntax-async-functions/-/babel-plugin-syntax-async-functions-6.13.0.tgz\",\"integrity\":\"sha512-4Zp4unmHgw30A1eWI5EpACji2qMocisdXhAftfhXoSV9j0Tvj6nRFE3tOmRY912E0FMRm/L5xWE7MGVT2FoLnw==\",\"dev\":true},\"babel-plugin-syntax-exponentiation-operator\":{\"version\":\"6.13.0\",\"resolved\":\"https://registry.npmmirror.com/babel-plugin-syntax-exponentiation-operator/-/babel-plugin-syntax-exponentiation-operator-6.13.0.tgz\",\"integrity\":\"sha512-Z/flU+T9ta0aIEKl1tGEmN/pZiI1uXmCiGFRegKacQfEJzp7iNsKloZmyJlQr+75FCJtiFfGIK03SiCvCt9cPQ==\",\"dev\":true},\"babel-plugin-syntax-trailing-function-commas\":{\"version\":\"6.22.0\",\"resolved\":\"https://registry.npmmirror.com/babel-plugin-syntax-trailing-function-commas/-/babel-plugin-syntax-trailing-function-commas-6.22.0.tgz\",\"integrity\":\"sha512-Gx9CH3Q/3GKbhs07Bszw5fPTlU+ygrOGfAhEt7W2JICwufpC4SuO0mG0+4NykPBSYPMJhqvVlDBU17qB1D+hMQ==\",\"dev\":true},\"babel-plugin-transform-async-to-generator\":{\"version\":\"6.24.1\",\"resolved\":\"https://registry.npmmirror.com/babel-plugin-transform-async-to-generator/-/babel-plugin-transform-async-to-generator-6.24.1.tgz\",\"integrity\":\"sha512-7BgYJujNCg0Ti3x0c/DL3tStvnKS6ktIYOmo9wginv/dfZOrbSZ+qG4IRRHMBOzZ5Awb1skTiAsQXg/+IWkZYw==\",\"dev\":true,\"requires\":{\"babel-helper-remap-async-to-generator\":\"^6.24.1\",\"babel-plugin-syntax-async-functions\":\"^6.8.0\",\"babel-runtime\":\"^6.22.0\"}},\"babel-plugin-transform-es2015-arrow-functions\":{\"version\":\"6.22.0\",\"resolved\":\"https://registry.npmmirror.com/babel-plugin-transform-es2015-arrow-functions/-/babel-plugin-transform-es2015-arrow-functions-6.22.0.tgz\",\"integrity\":\"sha512-PCqwwzODXW7JMrzu+yZIaYbPQSKjDTAsNNlK2l5Gg9g4rz2VzLnZsStvp/3c46GfXpwkyufb3NCyG9+50FF1Vg==\",\"dev\":true,\"requires\":{\"babel-runtime\":\"^6.22.0\"}},\"babel-plugin-transform-es2015-block-scoped-functions\":{\"version\":\"6.22.0\",\"resolved\":\"https://registry.npmmirror.com/babel-plugin-transform-es2015-block-scoped-functions/-/babel-plugin-transform-es2015-block-scoped-functions-6.22.0.tgz\",\"integrity\":\"sha512-2+ujAT2UMBzYFm7tidUsYh+ZoIutxJ3pN9IYrF1/H6dCKtECfhmB8UkHVpyxDwkj0CYbQG35ykoz925TUnBc3A==\",\"dev\":true,\"requires\":{\"babel-runtime\":\"^6.22.0\"}},\"babel-plugin-transform-es2015-block-scoping\":{\"version\":\"6.26.0\",\"resolved\":\"https://registry.npmmirror.com/babel-plugin-transform-es2015-block-scoping/-/babel-plugin-transform-es2015-block-scoping-6.26.0.tgz\",\"integrity\":\"sha512-YiN6sFAQ5lML8JjCmr7uerS5Yc/EMbgg9G8ZNmk2E3nYX4ckHR01wrkeeMijEf5WHNK5TW0Sl0Uu3pv3EdOJWw==\",\"dev\":true,\"requires\":{\"babel-runtime\":\"^6.26.0\",\"babel-template\":\"^6.26.0\",\"babel-traverse\":\"^6.26.0\",\"babel-types\":\"^6.26.0\",\"lodash\":\"^4.17.4\"}},\"babel-plugin-transform-es2015-classes\":{\"version\":\"6.24.1\",\"resolved\":\"https://registry.npmmirror.com/babel-plugin-transform-es2015-classes/-/babel-plugin-transform-es2015-classes-6.24.1.tgz\",\"integrity\":\"sha512-5Dy7ZbRinGrNtmWpquZKZ3EGY8sDgIVB4CU8Om8q8tnMLrD/m94cKglVcHps0BCTdZ0TJeeAWOq2TK9MIY6cag==\",\"dev\":true,\"requires\":{\"babel-helper-define-map\":\"^6.24.1\",\"babel-helper-function-name\":\"^6.24.1\",\"babel-helper-optimise-call-expression\":\"^6.24.1\",\"babel-helper-replace-supers\":\"^6.24.1\",\"babel-messages\":\"^6.23.0\",\"babel-runtime\":\"^6.22.0\",\"babel-template\":\"^6.24.1\",\"babel-traverse\":\"^6.24.1\",\"babel-types\":\"^6.24.1\"}},\"babel-plugin-transform-es2015-computed-properties\":{\"version\":\"6.24.1\",\"resolved\":\"https://registry.npmmirror.com/babel-plugin-transform-es2015-computed-properties/-/babel-plugin-transform-es2015-computed-properties-6.24.1.tgz\",\"integrity\":\"sha512-C/uAv4ktFP/Hmh01gMTvYvICrKze0XVX9f2PdIXuriCSvUmV9j+u+BB9f5fJK3+878yMK6dkdcq+Ymr9mrcLzw==\",\"dev\":true,\"requires\":{\"babel-runtime\":\"^6.22.0\",\"babel-template\":\"^6.24.1\"}},\"babel-plugin-transform-es2015-destructuring\":{\"version\":\"6.23.0\",\"resolved\":\"https://registry.npmmirror.com/babel-plugin-transform-es2015-destructuring/-/babel-plugin-transform-es2015-destructuring-6.23.0.tgz\",\"integrity\":\"sha512-aNv/GDAW0j/f4Uy1OEPZn1mqD+Nfy9viFGBfQ5bZyT35YqOiqx7/tXdyfZkJ1sC21NyEsBdfDY6PYmLHF4r5iA==\",\"dev\":true,\"requires\":{\"babel-runtime\":\"^6.22.0\"}},\"babel-plugin-transform-es2015-duplicate-keys\":{\"version\":\"6.24.1\",\"resolved\":\"https://registry.npmmirror.com/babel-plugin-transform-es2015-duplicate-keys/-/babel-plugin-transform-es2015-duplicate-keys-6.24.1.tgz\",\"integrity\":\"sha512-ossocTuPOssfxO2h+Z3/Ea1Vo1wWx31Uqy9vIiJusOP4TbF7tPs9U0sJ9pX9OJPf4lXRGj5+6Gkl/HHKiAP5ug==\",\"dev\":true,\"requires\":{\"babel-runtime\":\"^6.22.0\",\"babel-types\":\"^6.24.1\"}},\"babel-plugin-transform-es2015-for-of\":{\"version\":\"6.23.0\",\"resolved\":\"https://registry.npmmirror.com/babel-plugin-transform-es2015-for-of/-/babel-plugin-transform-es2015-for-of-6.23.0.tgz\",\"integrity\":\"sha512-DLuRwoygCoXx+YfxHLkVx5/NpeSbVwfoTeBykpJK7JhYWlL/O8hgAK/reforUnZDlxasOrVPPJVI/guE3dCwkw==\",\"dev\":true,\"requires\":{\"babel-runtime\":\"^6.22.0\"}},\"babel-plugin-transform-es2015-function-name\":{\"version\":\"6.24.1\",\"resolved\":\"https://registry.npmmirror.com/babel-plugin-transform-es2015-function-name/-/babel-plugin-transform-es2015-function-name-6.24.1.tgz\",\"integrity\":\"sha512-iFp5KIcorf11iBqu/y/a7DK3MN5di3pNCzto61FqCNnUX4qeBwcV1SLqe10oXNnCaxBUImX3SckX2/o1nsrTcg==\",\"dev\":true,\"requires\":{\"babel-helper-function-name\":\"^6.24.1\",\"babel-runtime\":\"^6.22.0\",\"babel-types\":\"^6.24.1\"}},\"babel-plugin-transform-es2015-literals\":{\"version\":\"6.22.0\",\"resolved\":\"https://registry.npmmirror.com/babel-plugin-transform-es2015-literals/-/babel-plugin-transform-es2015-literals-6.22.0.tgz\",\"integrity\":\"sha512-tjFl0cwMPpDYyoqYA9li1/7mGFit39XiNX5DKC/uCNjBctMxyL1/PT/l4rSlbvBG1pOKI88STRdUsWXB3/Q9hQ==\",\"dev\":true,\"requires\":{\"babel-runtime\":\"^6.22.0\"}},\"babel-plugin-transform-es2015-modules-amd\":{\"version\":\"6.24.1\",\"resolved\":\"https://registry.npmmirror.com/babel-plugin-transform-es2015-modules-amd/-/babel-plugin-transform-es2015-modules-amd-6.24.1.tgz\",\"integrity\":\"sha512-LnIIdGWIKdw7zwckqx+eGjcS8/cl8D74A3BpJbGjKTFFNJSMrjN4bIh22HY1AlkUbeLG6X6OZj56BDvWD+OeFA==\",\"dev\":true,\"requires\":{\"babel-plugin-transform-es2015-modules-commonjs\":\"^6.24.1\",\"babel-runtime\":\"^6.22.0\",\"babel-template\":\"^6.24.1\"}},\"babel-plugin-transform-es2015-modules-commonjs\":{\"version\":\"6.26.2\",\"resolved\":\"https://registry.npmmirror.com/babel-plugin-transform-es2015-modules-commonjs/-/babel-plugin-transform-es2015-modules-commonjs-6.26.2.tgz\",\"integrity\":\"sha512-CV9ROOHEdrjcwhIaJNBGMBCodN+1cfkwtM1SbUHmvyy35KGT7fohbpOxkE2uLz1o6odKK2Ck/tz47z+VqQfi9Q==\",\"dev\":true,\"requires\":{\"babel-plugin-transform-strict-mode\":\"^6.24.1\",\"babel-runtime\":\"^6.26.0\",\"babel-template\":\"^6.26.0\",\"babel-types\":\"^6.26.0\"}},\"babel-plugin-transform-es2015-modules-systemjs\":{\"version\":\"6.24.1\",\"resolved\":\"https://registry.npmmirror.com/babel-plugin-transform-es2015-modules-systemjs/-/babel-plugin-transform-es2015-modules-systemjs-6.24.1.tgz\",\"integrity\":\"sha512-ONFIPsq8y4bls5PPsAWYXH/21Hqv64TBxdje0FvU3MhIV6QM2j5YS7KvAzg/nTIVLot2D2fmFQrFWCbgHlFEjg==\",\"dev\":true,\"requires\":{\"babel-helper-hoist-variables\":\"^6.24.1\",\"babel-runtime\":\"^6.22.0\",\"babel-template\":\"^6.24.1\"}},\"babel-plugin-transform-es2015-modules-umd\":{\"version\":\"6.24.1\",\"resolved\":\"https://registry.npmmirror.com/babel-plugin-transform-es2015-modules-umd/-/babel-plugin-transform-es2015-modules-umd-6.24.1.tgz\",\"integrity\":\"sha512-LpVbiT9CLsuAIp3IG0tfbVo81QIhn6pE8xBJ7XSeCtFlMltuar5VuBV6y6Q45tpui9QWcy5i0vLQfCfrnF7Kiw==\",\"dev\":true,\"requires\":{\"babel-plugin-transform-es2015-modules-amd\":\"^6.24.1\",\"babel-runtime\":\"^6.22.0\",\"babel-template\":\"^6.24.1\"}},\"babel-plugin-transform-es2015-object-super\":{\"version\":\"6.24.1\",\"resolved\":\"https://registry.npmmirror.com/babel-plugin-transform-es2015-object-super/-/babel-plugin-transform-es2015-object-super-6.24.1.tgz\",\"integrity\":\"sha512-8G5hpZMecb53vpD3mjs64NhI1au24TAmokQ4B+TBFBjN9cVoGoOvotdrMMRmHvVZUEvqGUPWL514woru1ChZMA==\",\"dev\":true,\"requires\":{\"babel-helper-replace-supers\":\"^6.24.1\",\"babel-runtime\":\"^6.22.0\"}},\"babel-plugin-transform-es2015-parameters\":{\"version\":\"6.24.1\",\"resolved\":\"https://registry.npmmirror.com/babel-plugin-transform-es2015-parameters/-/babel-plugin-transform-es2015-parameters-6.24.1.tgz\",\"integrity\":\"sha512-8HxlW+BB5HqniD+nLkQ4xSAVq3bR/pcYW9IigY+2y0dI+Y7INFeTbfAQr+63T3E4UDsZGjyb+l9txUnABWxlOQ==\",\"dev\":true,\"requires\":{\"babel-helper-call-delegate\":\"^6.24.1\",\"babel-helper-get-function-arity\":\"^6.24.1\",\"babel-runtime\":\"^6.22.0\",\"babel-template\":\"^6.24.1\",\"babel-traverse\":\"^6.24.1\",\"babel-types\":\"^6.24.1\"}},\"babel-plugin-transform-es2015-shorthand-properties\":{\"version\":\"6.24.1\",\"resolved\":\"https://registry.npmmirror.com/babel-plugin-transform-es2015-shorthand-properties/-/babel-plugin-transform-es2015-shorthand-properties-6.24.1.tgz\",\"integrity\":\"sha512-mDdocSfUVm1/7Jw/FIRNw9vPrBQNePy6wZJlR8HAUBLybNp1w/6lr6zZ2pjMShee65t/ybR5pT8ulkLzD1xwiw==\",\"dev\":true,\"requires\":{\"babel-runtime\":\"^6.22.0\",\"babel-types\":\"^6.24.1\"}},\"babel-plugin-transform-es2015-spread\":{\"version\":\"6.22.0\",\"resolved\":\"https://registry.npmmirror.com/babel-plugin-transform-es2015-spread/-/babel-plugin-transform-es2015-spread-6.22.0.tgz\",\"integrity\":\"sha512-3Ghhi26r4l3d0Js933E5+IhHwk0A1yiutj9gwvzmFbVV0sPMYk2lekhOufHBswX7NCoSeF4Xrl3sCIuSIa+zOg==\",\"dev\":true,\"requires\":{\"babel-runtime\":\"^6.22.0\"}},\"babel-plugin-transform-es2015-sticky-regex\":{\"version\":\"6.24.1\",\"resolved\":\"https://registry.npmmirror.com/babel-plugin-transform-es2015-sticky-regex/-/babel-plugin-transform-es2015-sticky-regex-6.24.1.tgz\",\"integrity\":\"sha512-CYP359ADryTo3pCsH0oxRo/0yn6UsEZLqYohHmvLQdfS9xkf+MbCzE3/Kolw9OYIY4ZMilH25z/5CbQbwDD+lQ==\",\"dev\":true,\"requires\":{\"babel-helper-regex\":\"^6.24.1\",\"babel-runtime\":\"^6.22.0\",\"babel-types\":\"^6.24.1\"}},\"babel-plugin-transform-es2015-template-literals\":{\"version\":\"6.22.0\",\"resolved\":\"https://registry.npmmirror.com/babel-plugin-transform-es2015-template-literals/-/babel-plugin-transform-es2015-template-literals-6.22.0.tgz\",\"integrity\":\"sha512-x8b9W0ngnKzDMHimVtTfn5ryimars1ByTqsfBDwAqLibmuuQY6pgBQi5z1ErIsUOWBdw1bW9FSz5RZUojM4apg==\",\"dev\":true,\"requires\":{\"babel-runtime\":\"^6.22.0\"}},\"babel-plugin-transform-es2015-typeof-symbol\":{\"version\":\"6.23.0\",\"resolved\":\"https://registry.npmmirror.com/babel-plugin-transform-es2015-typeof-symbol/-/babel-plugin-transform-es2015-typeof-symbol-6.23.0.tgz\",\"integrity\":\"sha512-fz6J2Sf4gYN6gWgRZaoFXmq93X+Li/8vf+fb0sGDVtdeWvxC9y5/bTD7bvfWMEq6zetGEHpWjtzRGSugt5kNqw==\",\"dev\":true,\"requires\":{\"babel-runtime\":\"^6.22.0\"}},\"babel-plugin-transform-es2015-unicode-regex\":{\"version\":\"6.24.1\",\"resolved\":\"https://registry.npmmirror.com/babel-plugin-transform-es2015-unicode-regex/-/babel-plugin-transform-es2015-unicode-regex-6.24.1.tgz\",\"integrity\":\"sha512-v61Dbbihf5XxnYjtBN04B/JBvsScY37R1cZT5r9permN1cp+b70DY3Ib3fIkgn1DI9U3tGgBJZVD8p/mE/4JbQ==\",\"dev\":true,\"requires\":{\"babel-helper-regex\":\"^6.24.1\",\"babel-runtime\":\"^6.22.0\",\"regexpu-core\":\"^2.0.0\"}},\"babel-plugin-transform-exponentiation-operator\":{\"version\":\"6.24.1\",\"resolved\":\"https://registry.npmmirror.com/babel-plugin-transform-exponentiation-operator/-/babel-plugin-transform-exponentiation-operator-6.24.1.tgz\",\"integrity\":\"sha512-LzXDmbMkklvNhprr20//RStKVcT8Cu+SQtX18eMHLhjHf2yFzwtQ0S2f0jQ+89rokoNdmwoSqYzAhq86FxlLSQ==\",\"dev\":true,\"requires\":{\"babel-helper-builder-binary-assignment-operator-visitor\":\"^6.24.1\",\"babel-plugin-syntax-exponentiation-operator\":\"^6.8.0\",\"babel-runtime\":\"^6.22.0\"}},\"babel-plugin-transform-regenerator\":{\"version\":\"6.26.0\",\"resolved\":\"https://registry.npmmirror.com/babel-plugin-transform-regenerator/-/babel-plugin-transform-regenerator-6.26.0.tgz\",\"integrity\":\"sha512-LS+dBkUGlNR15/5WHKe/8Neawx663qttS6AGqoOUhICc9d1KciBvtrQSuc0PI+CxQ2Q/S1aKuJ+u64GtLdcEZg==\",\"dev\":true,\"requires\":{\"regenerator-transform\":\"^0.10.0\"}},\"babel-plugin-transform-runtime\":{\"version\":\"6.23.0\",\"resolved\":\"https://registry.npmmirror.com/babel-plugin-transform-runtime/-/babel-plugin-transform-runtime-6.23.0.tgz\",\"integrity\":\"sha512-cpGMVC1vt/772y3jx1gwSaTitQVZuFDlllgreMsZ+rTYC6jlYXRyf5FQOgSnckOiA5QmzbXTyBY2A5AmZXF1fA==\",\"dev\":true,\"requires\":{\"babel-runtime\":\"^6.22.0\"}},\"babel-plugin-transform-strict-mode\":{\"version\":\"6.24.1\",\"resolved\":\"https://registry.npmmirror.com/babel-plugin-transform-strict-mode/-/babel-plugin-transform-strict-mode-6.24.1.tgz\",\"integrity\":\"sha512-j3KtSpjyLSJxNoCDrhwiJad8kw0gJ9REGj8/CqL0HeRyLnvUNYV9zcqluL6QJSXh3nfsLEmSLvwRfGzrgR96Pw==\",\"dev\":true,\"requires\":{\"babel-runtime\":\"^6.22.0\",\"babel-types\":\"^6.24.1\"}},\"babel-polyfill\":{\"version\":\"6.26.0\",\"resolved\":\"https://registry.npmmirror.com/babel-polyfill/-/babel-polyfill-6.26.0.tgz\",\"integrity\":\"sha512-F2rZGQnAdaHWQ8YAoeRbukc7HS9QgdgeyJ0rQDd485v9opwuPvjpPFcOOT/WmkKTdgy9ESgSPXDcTNpzrGr6iQ==\",\"dev\":true,\"requires\":{\"babel-runtime\":\"^6.26.0\",\"core-js\":\"^2.5.0\",\"regenerator-runtime\":\"^0.10.5\"},\"dependencies\":{\"regenerator-runtime\":{\"version\":\"0.10.5\",\"resolved\":\"https://registry.npmmirror.com/regenerator-runtime/-/regenerator-runtime-0.10.5.tgz\",\"integrity\":\"sha512-02YopEIhAgiBHWeoTiA8aitHDt8z6w+rQqNuIftlM+ZtvSl/brTouaU7DW6GO/cHtvxJvS4Hwv2ibKdxIRi24w==\",\"dev\":true}}},\"babel-preset-env\":{\"version\":\"1.7.0\",\"resolved\":\"https://registry.npmmirror.com/babel-preset-env/-/babel-preset-env-1.7.0.tgz\",\"integrity\":\"sha512-9OR2afuKDneX2/q2EurSftUYM0xGu4O2D9adAhVfADDhrYDaxXV0rBbevVYoY9n6nyX1PmQW/0jtpJvUNr9CHg==\",\"dev\":true,\"requires\":{\"babel-plugin-check-es2015-constants\":\"^6.22.0\",\"babel-plugin-syntax-trailing-function-commas\":\"^6.22.0\",\"babel-plugin-transform-async-to-generator\":\"^6.22.0\",\"babel-plugin-transform-es2015-arrow-functions\":\"^6.22.0\",\"babel-plugin-transform-es2015-block-scoped-functions\":\"^6.22.0\",\"babel-plugin-transform-es2015-block-scoping\":\"^6.23.0\",\"babel-plugin-transform-es2015-classes\":\"^6.23.0\",\"babel-plugin-transform-es2015-computed-properties\":\"^6.22.0\",\"babel-plugin-transform-es2015-destructuring\":\"^6.23.0\",\"babel-plugin-transform-es2015-duplicate-keys\":\"^6.22.0\",\"babel-plugin-transform-es2015-for-of\":\"^6.23.0\",\"babel-plugin-transform-es2015-function-name\":\"^6.22.0\",\"babel-plugin-transform-es2015-literals\":\"^6.22.0\",\"babel-plugin-transform-es2015-modules-amd\":\"^6.22.0\",\"babel-plugin-transform-es2015-modules-commonjs\":\"^6.23.0\",\"babel-plugin-transform-es2015-modules-systemjs\":\"^6.23.0\",\"babel-plugin-transform-es2015-modules-umd\":\"^6.23.0\",\"babel-plugin-transform-es2015-object-super\":\"^6.22.0\",\"babel-plugin-transform-es2015-parameters\":\"^6.23.0\",\"babel-plugin-transform-es2015-shorthand-properties\":\"^6.22.0\",\"babel-plugin-transform-es2015-spread\":\"^6.22.0\",\"babel-plugin-transform-es2015-sticky-regex\":\"^6.22.0\",\"babel-plugin-transform-es2015-template-literals\":\"^6.22.0\",\"babel-plugin-transform-es2015-typeof-symbol\":\"^6.23.0\",\"babel-plugin-transform-es2015-unicode-regex\":\"^6.22.0\",\"babel-plugin-transform-exponentiation-operator\":\"^6.22.0\",\"babel-plugin-transform-regenerator\":\"^6.22.0\",\"browserslist\":\"^3.2.6\",\"invariant\":\"^2.2.2\",\"semver\":\"^5.3.0\"}},\"babel-register\":{\"version\":\"6.26.0\",\"resolved\":\"https://registry.npmmirror.com/babel-register/-/babel-register-6.26.0.tgz\",\"integrity\":\"sha512-veliHlHX06wjaeY8xNITbveXSiI+ASFnOqvne/LaIJIqOWi2Ogmj91KOugEz/hoh/fwMhXNBJPCv8Xaz5CyM4A==\",\"dev\":true,\"requires\":{\"babel-core\":\"^6.26.0\",\"babel-runtime\":\"^6.26.0\",\"core-js\":\"^2.5.0\",\"home-or-tmp\":\"^2.0.0\",\"lodash\":\"^4.17.4\",\"mkdirp\":\"^0.5.1\",\"source-map-support\":\"^0.4.15\"}},\"babel-runtime\":{\"version\":\"6.26.0\",\"resolved\":\"https://registry.npmmirror.com/babel-runtime/-/babel-runtime-6.26.0.tgz\",\"integrity\":\"sha512-ITKNuq2wKlW1fJg9sSW52eepoYgZBggvOAHC0u/CYu/qxQ9EVzThCgR69BnSXLHjy2f7SY5zaQ4yt7H9ZVxY2g==\",\"dev\":true,\"requires\":{\"core-js\":\"^2.4.0\",\"regenerator-runtime\":\"^0.11.0\"}},\"babel-template\":{\"version\":\"6.26.0\",\"resolved\":\"https://registry.npmmirror.com/babel-template/-/babel-template-6.26.0.tgz\",\"integrity\":\"sha512-PCOcLFW7/eazGUKIoqH97sO9A2UYMahsn/yRQ7uOk37iutwjq7ODtcTNF+iFDSHNfkctqsLRjLP7URnOx0T1fg==\",\"dev\":true,\"requires\":{\"babel-runtime\":\"^6.26.0\",\"babel-traverse\":\"^6.26.0\",\"babel-types\":\"^6.26.0\",\"babylon\":\"^6.18.0\",\"lodash\":\"^4.17.4\"}},\"babel-traverse\":{\"version\":\"6.26.0\",\"resolved\":\"https://registry.npmmirror.com/babel-traverse/-/babel-traverse-6.26.0.tgz\",\"integrity\":\"sha512-iSxeXx7apsjCHe9c7n8VtRXGzI2Bk1rBSOJgCCjfyXb6v1aCqE1KSEpq/8SXuVN8Ka/Rh1WDTF0MDzkvTA4MIA==\",\"dev\":true,\"requires\":{\"babel-code-frame\":\"^6.26.0\",\"babel-messages\":\"^6.23.0\",\"babel-runtime\":\"^6.26.0\",\"babel-types\":\"^6.26.0\",\"babylon\":\"^6.18.0\",\"debug\":\"^2.6.8\",\"globals\":\"^9.18.0\",\"invariant\":\"^2.2.2\",\"lodash\":\"^4.17.4\"}},\"babel-types\":{\"version\":\"6.26.0\",\"resolved\":\"https://registry.npmmirror.com/babel-types/-/babel-types-6.26.0.tgz\",\"integrity\":\"sha512-zhe3V/26rCWsEZK8kZN+HaQj5yQ1CilTObixFzKW1UWjqG7618Twz6YEsCnjfg5gBcJh02DrpCkS9h98ZqDY+g==\",\"dev\":true,\"requires\":{\"babel-runtime\":\"^6.26.0\",\"esutils\":\"^2.0.2\",\"lodash\":\"^4.17.4\",\"to-fast-properties\":\"^1.0.3\"}},\"babylon\":{\"version\":\"6.18.0\",\"resolved\":\"https://registry.npmmirror.com/babylon/-/babylon-6.18.0.tgz\",\"integrity\":\"sha512-q/UEjfGJ2Cm3oKV71DJz9d25TPnq5rhBVL2Q4fA5wcC3jcrdn7+SssEybFIxwAvvP+YCsCYNKughoF33GxgycQ==\",\"dev\":true},\"balanced-match\":{\"version\":\"1.0.2\",\"resolved\":\"https://registry.npmmirror.com/balanced-match/-/balanced-match-1.0.2.tgz\",\"integrity\":\"sha512-3oSeUO0TMV67hN1AmbXsK4yaqU7tjiHlbxRDZOpH0KW9+CeX4bRAaX0Anxt0tx2MrpRpWwQaPwIlISEJhYU5Pw==\",\"dev\":true},\"base\":{\"version\":\"0.11.2\",\"resolved\":\"https://registry.npmmirror.com/base/-/base-0.11.2.tgz\",\"integrity\":\"sha512-5T6P4xPgpp0YDFvSWwEZ4NoE3aM4QBQXDzmVbraCkFj8zHM+mba8SyqB5DbZWyR7mYHo6Y7BdQo3MoA4m0TeQg==\",\"dev\":true,\"optional\":true,\"requires\":{\"cache-base\":\"^1.0.1\",\"class-utils\":\"^0.3.5\",\"component-emitter\":\"^1.2.1\",\"define-property\":\"^1.0.0\",\"isobject\":\"^3.0.1\",\"mixin-deep\":\"^1.2.0\",\"pascalcase\":\"^0.1.1\"},\"dependencies\":{\"define-property\":{\"version\":\"1.0.0\",\"resolved\":\"https://registry.npmmirror.com/define-property/-/define-property-1.0.0.tgz\",\"integrity\":\"sha512-cZTYKFWspt9jZsMscWo8sc/5lbPC9Q0N5nBLgb+Yd915iL3udB1uFgS3B8YCx66UVHq018DAVFoee7x+gxggeA==\",\"dev\":true,\"optional\":true,\"requires\":{\"is-descriptor\":\"^1.0.0\"}},\"is-accessor-descriptor\":{\"version\":\"1.0.0\",\"resolved\":\"https://registry.npmmirror.com/is-accessor-descriptor/-/is-accessor-descriptor-1.0.0.tgz\",\"integrity\":\"sha512-m5hnHTkcVsPfqx3AKlyttIPb7J+XykHvJP2B9bZDjlhLIoEq4XoK64Vg7boZlVWYK6LUY94dYPEE7Lh0ZkZKcQ==\",\"dev\":true,\"optional\":true,\"requires\":{\"kind-of\":\"^6.0.0\"}},\"is-data-descriptor\":{\"version\":\"1.0.0\",\"resolved\":\"https://registry.npmmirror.com/is-data-descriptor/-/is-data-descriptor-1.0.0.tgz\",\"integrity\":\"sha512-jbRXy1FmtAoCjQkVmIVYwuuqDFUbaOeDjmed1tOGPrsMhtJA4rD9tkgA0F1qJ3gRFRXcHYVkdeaP50Q5rE/jLQ==\",\"dev\":true,\"optional\":true,\"requires\":{\"kind-of\":\"^6.0.0\"}},\"is-descriptor\":{\"version\":\"1.0.2\",\"resolved\":\"https://registry.npmmirror.com/is-descriptor/-/is-descriptor-1.0.2.tgz\",\"integrity\":\"sha512-2eis5WqQGV7peooDyLmNEPUrps9+SXX5c9pL3xEB+4e9HnGuDa7mB7kHxHw4CbqS9k1T2hOH3miL8n8WtiYVtg==\",\"dev\":true,\"optional\":true,\"requires\":{\"is-accessor-descriptor\":\"^1.0.0\",\"is-data-descriptor\":\"^1.0.0\",\"kind-of\":\"^6.0.2\"}},\"isobject\":{\"version\":\"3.0.1\",\"resolved\":\"https://registry.npmmirror.com/isobject/-/isobject-3.0.1.tgz\",\"integrity\":\"sha512-WhB9zCku7EGTj/HQQRz5aUQEUeoQZH2bWcltRErOpymJ4boYE6wL9Tbr23krRPSZ+C5zqNSrSw+Cc7sZZ4b7vg==\",\"dev\":true,\"optional\":true},\"kind-of\":{\"version\":\"6.0.3\",\"resolved\":\"https://registry.npmmirror.com/kind-of/-/kind-of-6.0.3.tgz\",\"integrity\":\"sha512-dcS1ul+9tmeD95T+x28/ehLgd9mENa3LsvDTtzm3vyBEO7RPptvAD+t44WVXaUjTBRcrpFeFlC8WCruUR456hw==\",\"dev\":true,\"optional\":true}}},\"binary-extensions\":{\"version\":\"1.13.1\",\"resolved\":\"https://registry.npmmirror.com/binary-extensions/-/binary-extensions-1.13.1.tgz\",\"integrity\":\"sha512-Un7MIEDdUC5gNpcGDV97op1Ywk748MpHcFTHoYs6qnj1Z3j7I53VG3nwZhKzoBZmbdRNnb6WRdFlwl7tSDuZGw==\",\"dev\":true,\"optional\":true},\"bindings\":{\"version\":\"1.5.0\",\"resolved\":\"https://registry.npmmirror.com/bindings/-/bindings-1.5.0.tgz\",\"integrity\":\"sha512-p2q/t/mhvuOj/UeLlV6566GD/guowlr0hHxClI0W9m7MWYkL1F0hLo+0Aexs9HSPCtR1SXQ0TD3MMKrXZajbiQ==\",\"dev\":true,\"optional\":true,\"requires\":{\"file-uri-to-path\":\"1.0.0\"}},\"brace-expansion\":{\"version\":\"1.1.11\",\"resolved\":\"https://registry.npmmirror.com/brace-expansion/-/brace-expansion-1.1.11.tgz\",\"integrity\":\"sha512-iCuPHDFgrHX7H2vEI/5xpz07zSHB00TpugqhmYtVmMO6518mCuRMoOYFldEBl0g187ufozdaHgWKcYFb61qGiA==\",\"dev\":true,\"requires\":{\"balanced-match\":\"^1.0.0\",\"concat-map\":\"0.0.1\"}},\"braces\":{\"version\":\"1.8.5\",\"resolved\":\"https://registry.npmmirror.com/braces/-/braces-1.8.5.tgz\",\"integrity\":\"sha512-xU7bpz2ytJl1bH9cgIurjpg/n8Gohy9GTw81heDYLJQ4RU60dlyJsa+atVF2pI0yMMvKxI9HkKwjePCj5XI1hw==\",\"dev\":true,\"optional\":true,\"requires\":{\"expand-range\":\"^1.8.1\",\"preserve\":\"^0.2.0\",\"repeat-element\":\"^1.1.2\"}},\"browserslist\":{\"version\":\"3.2.8\",\"resolved\":\"https://registry.npmmirror.com/browserslist/-/browserslist-3.2.8.tgz\",\"integrity\":\"sha512-WHVocJYavUwVgVViC0ORikPHQquXwVh939TaelZ4WDqpWgTX/FsGhl/+P4qBUAGcRvtOgDgC+xftNWWp2RUTAQ==\",\"dev\":true,\"requires\":{\"caniuse-lite\":\"^1.0.30000844\",\"electron-to-chromium\":\"^1.3.47\"}},\"cache-base\":{\"version\":\"1.0.1\",\"resolved\":\"https://registry.npmmirror.com/cache-base/-/cache-base-1.0.1.tgz\",\"integrity\":\"sha512-AKcdTnFSWATd5/GCPRxr2ChwIJ85CeyrEyjRHlKxQ56d4XJMGym0uAiKn0xbLOGOl3+yRpOTi484dVCEc5AUzQ==\",\"dev\":true,\"optional\":true,\"requires\":{\"collection-visit\":\"^1.0.0\",\"component-emitter\":\"^1.2.1\",\"get-value\":\"^2.0.6\",\"has-value\":\"^1.0.0\",\"isobject\":\"^3.0.1\",\"set-value\":\"^2.0.0\",\"to-object-path\":\"^0.3.0\",\"union-value\":\"^1.0.0\",\"unset-value\":\"^1.0.0\"},\"dependencies\":{\"isobject\":{\"version\":\"3.0.1\",\"resolved\":\"https://registry.npmmirror.com/isobject/-/isobject-3.0.1.tgz\",\"integrity\":\"sha512-WhB9zCku7EGTj/HQQRz5aUQEUeoQZH2bWcltRErOpymJ4boYE6wL9Tbr23krRPSZ+C5zqNSrSw+Cc7sZZ4b7vg==\",\"dev\":true,\"optional\":true}}},\"caniuse-lite\":{\"version\":\"1.0.30001486\",\"resolved\":\"https://registry.npmmirror.com/caniuse-lite/-/caniuse-lite-1.0.30001486.tgz\",\"integrity\":\"sha512-uv7/gXuHi10Whlj0pp5q/tsK/32J2QSqVRKQhs2j8VsDCjgyruAh/eEXHF822VqO9yT6iZKw3nRwZRSPBE9OQg==\",\"dev\":true},\"chalk\":{\"version\":\"1.1.3\",\"resolved\":\"https://registry.npmmirror.com/chalk/-/chalk-1.1.3.tgz\",\"integrity\":\"sha512-U3lRVLMSlsCfjqYPbLyVv11M9CPW4I728d6TCKMAOJueEeB9/8o+eSsMnxPJD+Q+K909sdESg7C+tIkoH6on1A==\",\"dev\":true,\"requires\":{\"ansi-styles\":\"^2.2.1\",\"escape-string-regexp\":\"^1.0.2\",\"has-ansi\":\"^2.0.0\",\"strip-ansi\":\"^3.0.0\",\"supports-color\":\"^2.0.0\"}},\"chokidar\":{\"version\":\"1.7.0\",\"resolved\":\"https://registry.npmmirror.com/chokidar/-/chokidar-1.7.0.tgz\",\"integrity\":\"sha512-mk8fAWcRUOxY7btlLtitj3A45jOwSAxH4tOFOoEGbVsl6cL6pPMWUy7dwZ/canfj3QEdP6FHSnf/l1c6/WkzVg==\",\"dev\":true,\"optional\":true,\"requires\":{\"anymatch\":\"^1.3.0\",\"async-each\":\"^1.0.0\",\"fsevents\":\"^1.0.0\",\"glob-parent\":\"^2.0.0\",\"inherits\":\"^2.0.1\",\"is-binary-path\":\"^1.0.0\",\"is-glob\":\"^2.0.0\",\"path-is-absolute\":\"^1.0.0\",\"readdirp\":\"^2.0.0\"}},\"class-utils\":{\"version\":\"0.3.6\",\"resolved\":\"https://registry.npmmirror.com/class-utils/-/class-utils-0.3.6.tgz\",\"integrity\":\"sha512-qOhPa/Fj7s6TY8H8esGu5QNpMMQxz79h+urzrNYN6mn+9BnxlDGf5QZ+XeCDsxSjPqsSR56XOZOJmpeurnLMeg==\",\"dev\":true,\"optional\":true,\"requires\":{\"arr-union\":\"^3.1.0\",\"define-property\":\"^0.2.5\",\"isobject\":\"^3.0.0\",\"static-extend\":\"^0.1.1\"},\"dependencies\":{\"define-property\":{\"version\":\"0.2.5\",\"resolved\":\"https://registry.npmmirror.com/define-property/-/define-property-0.2.5.tgz\",\"integrity\":\"sha512-Rr7ADjQZenceVOAKop6ALkkRAmH1A4Gx9hV/7ZujPUN2rkATqFO0JZLZInbAjpZYoJ1gUx8MRMQVkYemcbMSTA==\",\"dev\":true,\"optional\":true,\"requires\":{\"is-descriptor\":\"^0.1.0\"}},\"isobject\":{\"version\":\"3.0.1\",\"resolved\":\"https://registry.npmmirror.com/isobject/-/isobject-3.0.1.tgz\",\"integrity\":\"sha512-WhB9zCku7EGTj/HQQRz5aUQEUeoQZH2bWcltRErOpymJ4boYE6wL9Tbr23krRPSZ+C5zqNSrSw+Cc7sZZ4b7vg==\",\"dev\":true,\"optional\":true}}},\"collection-visit\":{\"version\":\"1.0.0\",\"resolved\":\"https://registry.npmmirror.com/collection-visit/-/collection-visit-1.0.0.tgz\",\"integrity\":\"sha512-lNkKvzEeMBBjUGHZ+q6z9pSJla0KWAQPvtzhEV9+iGyQYG+pBpl7xKDhxoNSOZH2hhv0v5k0y2yAM4o4SjoSkw==\",\"dev\":true,\"optional\":true,\"requires\":{\"map-visit\":\"^1.0.0\",\"object-visit\":\"^1.0.0\"}},\"commander\":{\"version\":\"2.20.3\",\"resolved\":\"https://registry.npmmirror.com/commander/-/commander-2.20.3.tgz\",\"integrity\":\"sha512-GpVkmM8vF2vQUkj2LvZmD35JxeJOLCwJ9cUkugyk2nuhbv3+mJvpLYYt+0+USMxE+oj+ey/lJEnhZw75x/OMcQ==\",\"dev\":true},\"component-emitter\":{\"version\":\"1.3.0\",\"resolved\":\"https://registry.npmmirror.com/component-emitter/-/component-emitter-1.3.0.tgz\",\"integrity\":\"sha512-Rd3se6QB+sO1TwqZjscQrurpEPIfO0/yYnSin6Q/rD3mOutHvUrCAhJub3r90uNb+SESBuE0QYoB90YdfatsRg==\",\"dev\":true,\"optional\":true},\"concat-map\":{\"version\":\"0.0.1\",\"resolved\":\"https://registry.npmmirror.com/concat-map/-/concat-map-0.0.1.tgz\",\"integrity\":\"sha512-/Srv4dswyQNBfohGpz9o6Yb3Gz3SrUDqBH5rTuhGR7ahtlbYKnVxw2bCFMRljaA7EXHaXZ8wsHdodFvbkhKmqg==\",\"dev\":true},\"convert-source-map\":{\"version\":\"1.9.0\",\"resolved\":\"https://registry.npmmirror.com/convert-source-map/-/convert-source-map-1.9.0.tgz\",\"integrity\":\"sha512-ASFBup0Mz1uyiIjANan1jzLQami9z1PoYSZCiiYW2FczPbenXc45FZdBZLzOT+r6+iciuEModtmCti+hjaAk0A==\",\"dev\":true},\"copy-descriptor\":{\"version\":\"0.1.1\",\"resolved\":\"https://registry.npmmirror.com/copy-descriptor/-/copy-descriptor-0.1.1.tgz\",\"integrity\":\"sha512-XgZ0pFcakEUlbwQEVNg3+QAis1FyTL3Qel9FYy8pSkQqoG3PNoT0bOCQtOXcOkur21r2Eq2kI+IE+gsmAEVlYw==\",\"dev\":true,\"optional\":true},\"core-js\":{\"version\":\"2.6.12\",\"resolved\":\"https://registry.npmmirror.com/core-js/-/core-js-2.6.12.tgz\",\"integrity\":\"sha512-Kb2wC0fvsWfQrgk8HU5lW6U/Lcs8+9aaYcy4ZFc6DDlo4nZ7n70dEgE5rtR0oG6ufKDUnrwfWL1mXR5ljDatrQ==\",\"dev\":true},\"core-util-is\":{\"version\":\"1.0.3\",\"resolved\":\"https://registry.npmmirror.com/core-util-is/-/core-util-is-1.0.3.tgz\",\"integrity\":\"sha512-ZQBvi1DcpJ4GDqanjucZ2Hj3wEO5pZDS89BWbkcrvdxksJorwUDDZamX9ldFkp9aw2lmBDLgkObEA4DWNJ9FYQ==\",\"dev\":true,\"optional\":true},\"debug\":{\"version\":\"2.6.9\",\"resolved\":\"https://registry.npmmirror.com/debug/-/debug-2.6.9.tgz\",\"integrity\":\"sha512-bC7ElrdJaJnPbAP+1EotYvqZsb3ecl5wi6Bfi6BJTUcNowp6cvspg0jXznRTKDjm/E7AdgFBVeAPVMNcKGsHMA==\",\"dev\":true,\"requires\":{\"ms\":\"2.0.0\"}},\"decode-uri-component\":{\"version\":\"0.2.2\",\"resolved\":\"https://registry.npmmirror.com/decode-uri-component/-/decode-uri-component-0.2.2.tgz\",\"integrity\":\"sha512-FqUYQ+8o158GyGTrMFJms9qh3CqTKvAqgqsTnkLI8sKu0028orqBhxNMFkFen0zGyg6epACD32pjVk58ngIErQ==\",\"dev\":true,\"optional\":true},\"define-property\":{\"version\":\"2.0.2\",\"resolved\":\"https://registry.npmmirror.com/define-property/-/define-property-2.0.2.tgz\",\"integrity\":\"sha512-jwK2UV4cnPpbcG7+VRARKTZPUWowwXA8bzH5NP6ud0oeAxyYPuGZUAC7hMugpCdz4BeSZl2Dl9k66CHJ/46ZYQ==\",\"dev\":true,\"optional\":true,\"requires\":{\"is-descriptor\":\"^1.0.2\",\"isobject\":\"^3.0.1\"},\"dependencies\":{\"is-accessor-descriptor\":{\"version\":\"1.0.0\",\"resolved\":\"https://registry.npmmirror.com/is-accessor-descriptor/-/is-accessor-descriptor-1.0.0.tgz\",\"integrity\":\"sha512-m5hnHTkcVsPfqx3AKlyttIPb7J+XykHvJP2B9bZDjlhLIoEq4XoK64Vg7boZlVWYK6LUY94dYPEE7Lh0ZkZKcQ==\",\"dev\":true,\"optional\":true,\"requires\":{\"kind-of\":\"^6.0.0\"}},\"is-data-descriptor\":{\"version\":\"1.0.0\",\"resolved\":\"https://registry.npmmirror.com/is-data-descriptor/-/is-data-descriptor-1.0.0.tgz\",\"integrity\":\"sha512-jbRXy1FmtAoCjQkVmIVYwuuqDFUbaOeDjmed1tOGPrsMhtJA4rD9tkgA0F1qJ3gRFRXcHYVkdeaP50Q5rE/jLQ==\",\"dev\":true,\"optional\":true,\"requires\":{\"kind-of\":\"^6.0.0\"}},\"is-descriptor\":{\"version\":\"1.0.2\",\"resolved\":\"https://registry.npmmirror.com/is-descriptor/-/is-descriptor-1.0.2.tgz\",\"integrity\":\"sha512-2eis5WqQGV7peooDyLmNEPUrps9+SXX5c9pL3xEB+4e9HnGuDa7mB7kHxHw4CbqS9k1T2hOH3miL8n8WtiYVtg==\",\"dev\":true,\"optional\":true,\"requires\":{\"is-accessor-descriptor\":\"^1.0.0\",\"is-data-descriptor\":\"^1.0.0\",\"kind-of\":\"^6.0.2\"}},\"isobject\":{\"version\":\"3.0.1\",\"resolved\":\"https://registry.npmmirror.com/isobject/-/isobject-3.0.1.tgz\",\"integrity\":\"sha512-WhB9zCku7EGTj/HQQRz5aUQEUeoQZH2bWcltRErOpymJ4boYE6wL9Tbr23krRPSZ+C5zqNSrSw+Cc7sZZ4b7vg==\",\"dev\":true,\"optional\":true},\"kind-of\":{\"version\":\"6.0.3\",\"resolved\":\"https://registry.npmmirror.com/kind-of/-/kind-of-6.0.3.tgz\",\"integrity\":\"sha512-dcS1ul+9tmeD95T+x28/ehLgd9mENa3LsvDTtzm3vyBEO7RPptvAD+t44WVXaUjTBRcrpFeFlC8WCruUR456hw==\",\"dev\":true,\"optional\":true}}},\"detect-indent\":{\"version\":\"4.0.0\",\"resolved\":\"https://registry.npmmirror.com/detect-indent/-/detect-indent-4.0.0.tgz\",\"integrity\":\"sha512-BDKtmHlOzwI7iRuEkhzsnPoi5ypEhWAJB5RvHWe1kMr06js3uK5B3734i3ui5Yd+wOJV1cpE4JnivPD283GU/A==\",\"dev\":true,\"requires\":{\"repeating\":\"^2.0.0\"}},\"electron-to-chromium\":{\"version\":\"1.4.392\",\"resolved\":\"https://registry.npmmirror.com/electron-to-chromium/-/electron-to-chromium-1.4.392.tgz\",\"integrity\":\"sha512-TXQOMW9tnhIms3jGy/lJctLjICOgyueZFJ1KUtm6DTQ+QpxX3p7ZBwB6syuZ9KBuT5S4XX7bgY1ECPgfxKUdOg==\",\"dev\":true},\"escape-string-regexp\":{\"version\":\"1.0.5\",\"resolved\":\"https://registry.npmmirror.com/escape-string-regexp/-/escape-string-regexp-1.0.5.tgz\",\"integrity\":\"sha512-vbRorB5FUQWvla16U8R/qgaFIya2qGzwDrNmCZuYKrbdSUMG6I1ZCGQRefkRVhuOkIGVne7BQ35DSfo1qvJqFg==\",\"dev\":true},\"esutils\":{\"version\":\"2.0.3\",\"resolved\":\"https://registry.npmmirror.com/esutils/-/esutils-2.0.3.tgz\",\"integrity\":\"sha512-kVscqXk4OCp68SZ0dkgEKVi6/8ij300KBWTJq32P/dYeWTSwK41WyTxalN1eRmA5Z9UU/LX9D7FWSmV9SAYx6g==\",\"dev\":true},\"expand-brackets\":{\"version\":\"0.1.5\",\"resolved\":\"https://registry.npmmirror.com/expand-brackets/-/expand-brackets-0.1.5.tgz\",\"integrity\":\"sha512-hxx03P2dJxss6ceIeri9cmYOT4SRs3Zk3afZwWpOsRqLqprhTR8u++SlC+sFGsQr7WGFPdMF7Gjc1njDLDK6UA==\",\"dev\":true,\"optional\":true,\"requires\":{\"is-posix-bracket\":\"^0.1.0\"}},\"expand-range\":{\"version\":\"1.8.2\",\"resolved\":\"https://registry.npmmirror.com/expand-range/-/expand-range-1.8.2.tgz\",\"integrity\":\"sha512-AFASGfIlnIbkKPQwX1yHaDjFvh/1gyKJODme52V6IORh69uEYgZp0o9C+qsIGNVEiuuhQU0CSSl++Rlegg1qvA==\",\"dev\":true,\"optional\":true,\"requires\":{\"fill-range\":\"^2.1.0\"}},\"extend-shallow\":{\"version\":\"3.0.2\",\"resolved\":\"https://registry.npmmirror.com/extend-shallow/-/extend-shallow-3.0.2.tgz\",\"integrity\":\"sha512-BwY5b5Ql4+qZoefgMj2NUmx+tehVTH/Kf4k1ZEtOHNFcm2wSxMRo992l6X3TIgni2eZVTZ85xMOjF31fwZAj6Q==\",\"dev\":true,\"optional\":true,\"requires\":{\"assign-symbols\":\"^1.0.0\",\"is-extendable\":\"^1.0.1\"},\"dependencies\":{\"is-extendable\":{\"version\":\"1.0.1\",\"resolved\":\"https://registry.npmmirror.com/is-extendable/-/is-extendable-1.0.1.tgz\",\"integrity\":\"sha512-arnXMxT1hhoKo9k1LZdmlNyJdDDfy2v0fXjFlmok4+i8ul/6WlbVge9bhM74OpNPQPMGUToDtz+KXa1PneJxOA==\",\"dev\":true,\"optional\":true,\"requires\":{\"is-plain-object\":\"^2.0.4\"}}}},\"extglob\":{\"version\":\"0.3.2\",\"resolved\":\"https://registry.npmmirror.com/extglob/-/extglob-0.3.2.tgz\",\"integrity\":\"sha512-1FOj1LOwn42TMrruOHGt18HemVnbwAmAak7krWk+wa93KXxGbK+2jpezm+ytJYDaBX0/SPLZFHKM7m+tKobWGg==\",\"dev\":true,\"optional\":true,\"requires\":{\"is-extglob\":\"^1.0.0\"}},\"file-uri-to-path\":{\"version\":\"1.0.0\",\"resolved\":\"https://registry.npmmirror.com/file-uri-to-path/-/file-uri-to-path-1.0.0.tgz\",\"integrity\":\"sha512-0Zt+s3L7Vf1biwWZ29aARiVYLx7iMGnEUl9x33fbB/j3jR81u/O2LbqK+Bm1CDSNDKVtJ/YjwY7TUd5SkeLQLw==\",\"dev\":true,\"optional\":true},\"filename-regex\":{\"version\":\"2.0.1\",\"resolved\":\"https://registry.npmmirror.com/filename-regex/-/filename-regex-2.0.1.tgz\",\"integrity\":\"sha512-BTCqyBaWBTsauvnHiE8i562+EdJj+oUpkqWp2R1iCoR8f6oo8STRu3of7WJJ0TqWtxN50a5YFpzYK4Jj9esYfQ==\",\"dev\":true,\"optional\":true},\"fill-range\":{\"version\":\"2.2.4\",\"resolved\":\"https://registry.npmmirror.com/fill-range/-/fill-range-2.2.4.tgz\",\"integrity\":\"sha512-cnrcCbj01+j2gTG921VZPnHbjmdAf8oQV/iGeV2kZxGSyfYjjTyY79ErsK1WJWMpw6DaApEX72binqJE+/d+5Q==\",\"dev\":true,\"optional\":true,\"requires\":{\"is-number\":\"^2.1.0\",\"isobject\":\"^2.0.0\",\"randomatic\":\"^3.0.0\",\"repeat-element\":\"^1.1.2\",\"repeat-string\":\"^1.5.2\"}},\"for-in\":{\"version\":\"1.0.2\",\"resolved\":\"https://registry.npmmirror.com/for-in/-/for-in-1.0.2.tgz\",\"integrity\":\"sha512-7EwmXrOjyL+ChxMhmG5lnW9MPt1aIeZEwKhQzoBUdTV0N3zuwWDZYVJatDvZ2OyzPUvdIAZDsCetk3coyMfcnQ==\",\"dev\":true,\"optional\":true},\"for-own\":{\"version\":\"0.1.5\",\"resolved\":\"https://registry.npmmirror.com/for-own/-/for-own-0.1.5.tgz\",\"integrity\":\"sha512-SKmowqGTJoPzLO1T0BBJpkfp3EMacCMOuH40hOUbrbzElVktk4DioXVM99QkLCyKoiuOmyjgcWMpVz2xjE7LZw==\",\"dev\":true,\"optional\":true,\"requires\":{\"for-in\":\"^1.0.1\"}},\"fragment-cache\":{\"version\":\"0.2.1\",\"resolved\":\"https://registry.npmmirror.com/fragment-cache/-/fragment-cache-0.2.1.tgz\",\"integrity\":\"sha512-GMBAbW9antB8iZRHLoGw0b3HANt57diZYFO/HL1JGIC1MjKrdmhxvrJbupnVvpys0zsz7yBApXdQyfepKly2kA==\",\"dev\":true,\"optional\":true,\"requires\":{\"map-cache\":\"^0.2.2\"}},\"fs-readdir-recursive\":{\"version\":\"1.1.0\",\"resolved\":\"https://registry.npmmirror.com/fs-readdir-recursive/-/fs-readdir-recursive-1.1.0.tgz\",\"integrity\":\"sha512-GNanXlVr2pf02+sPN40XN8HG+ePaNcvM0q5mZBd668Obwb0yD5GiUbZOFgwn8kGMY6I3mdyDJzieUy3PTYyTRA==\",\"dev\":true},\"fs.realpath\":{\"version\":\"1.0.0\",\"resolved\":\"https://registry.npmmirror.com/fs.realpath/-/fs.realpath-1.0.0.tgz\",\"integrity\":\"sha512-OO0pH2lK6a0hZnAdau5ItzHPI6pUlvI7jMVnxUQRtw4owF2wk8lOSabtGDCTP4Ggrg2MbGnWO9X8K1t4+fGMDw==\",\"dev\":true},\"fsevents\":{\"version\":\"1.2.13\",\"resolved\":\"https://registry.npmmirror.com/fsevents/-/fsevents-1.2.13.tgz\",\"integrity\":\"sha512-oWb1Z6mkHIskLzEJ/XWX0srkpkTQ7vaopMQkyaEIoq0fmtFVxOthb8cCxeT+p3ynTdkk/RZwbgG4brR5BeWECw==\",\"dev\":true,\"optional\":true,\"requires\":{\"bindings\":\"^1.5.0\",\"nan\":\"^2.12.1\"}},\"get-value\":{\"version\":\"2.0.6\",\"resolved\":\"https://registry.npmmirror.com/get-value/-/get-value-2.0.6.tgz\",\"integrity\":\"sha512-Ln0UQDlxH1BapMu3GPtf7CuYNwRZf2gwCuPqbyG6pB8WfmFpzqcy4xtAaAMUhnNqjMKTiCPZG2oMT3YSx8U2NA==\",\"dev\":true,\"optional\":true},\"glob\":{\"version\":\"7.2.3\",\"resolved\":\"https://registry.npmmirror.com/glob/-/glob-7.2.3.tgz\",\"integrity\":\"sha512-nFR0zLpU2YCaRxwoCJvL6UvCH2JFyFVIvwTLsIf21AuHlMskA1hhTdk+LlYJtOlYt9v6dvszD2BGRqBL+iQK9Q==\",\"dev\":true,\"requires\":{\"fs.realpath\":\"^1.0.0\",\"inflight\":\"^1.0.4\",\"inherits\":\"2\",\"minimatch\":\"^3.1.1\",\"once\":\"^1.3.0\",\"path-is-absolute\":\"^1.0.0\"}},\"glob-base\":{\"version\":\"0.3.0\",\"resolved\":\"https://registry.npmmirror.com/glob-base/-/glob-base-0.3.0.tgz\",\"integrity\":\"sha512-ab1S1g1EbO7YzauaJLkgLp7DZVAqj9M/dvKlTt8DkXA2tiOIcSMrlVI2J1RZyB5iJVccEscjGn+kpOG9788MHA==\",\"dev\":true,\"optional\":true,\"requires\":{\"glob-parent\":\"^2.0.0\",\"is-glob\":\"^2.0.0\"}},\"glob-parent\":{\"version\":\"2.0.0\",\"resolved\":\"https://registry.npmmirror.com/glob-parent/-/glob-parent-2.0.0.tgz\",\"integrity\":\"sha512-JDYOvfxio/t42HKdxkAYaCiBN7oYiuxykOxKxdaUW5Qn0zaYN3gRQWolrwdnf0shM9/EP0ebuuTmyoXNr1cC5w==\",\"dev\":true,\"optional\":true,\"requires\":{\"is-glob\":\"^2.0.0\"}},\"globals\":{\"version\":\"9.18.0\",\"resolved\":\"https://registry.npmmirror.com/globals/-/globals-9.18.0.tgz\",\"integrity\":\"sha512-S0nG3CLEQiY/ILxqtztTWH/3iRRdyBLw6KMDxnKMchrtbj2OFmehVh0WUCfW3DUrIgx/qFrJPICrq4Z4sTR9UQ==\",\"dev\":true},\"graceful-fs\":{\"version\":\"4.2.11\",\"resolved\":\"https://registry.npmmirror.com/graceful-fs/-/graceful-fs-4.2.11.tgz\",\"integrity\":\"sha512-RbJ5/jmFcNNCcDV5o9eTnBLJ/HszWV0P73bc+Ff4nS/rJj+YaS6IGyiOL0VoBYX+l1Wrl3k63h/KrH+nhJ0XvQ==\",\"dev\":true},\"has-ansi\":{\"version\":\"2.0.0\",\"resolved\":\"https://registry.npmmirror.com/has-ansi/-/has-ansi-2.0.0.tgz\",\"integrity\":\"sha512-C8vBJ8DwUCx19vhm7urhTuUsr4/IyP6l4VzNQDv+ryHQObW3TTTp9yB68WpYgRe2bbaGuZ/se74IqFeVnMnLZg==\",\"dev\":true,\"requires\":{\"ansi-regex\":\"^2.0.0\"}},\"has-value\":{\"version\":\"1.0.0\",\"resolved\":\"https://registry.npmmirror.com/has-value/-/has-value-1.0.0.tgz\",\"integrity\":\"sha512-IBXk4GTsLYdQ7Rvt+GRBrFSVEkmuOUy4re0Xjd9kJSUQpnTrWR4/y9RpfexN9vkAPMFuQoeWKwqzPozRTlasGw==\",\"dev\":true,\"optional\":true,\"requires\":{\"get-value\":\"^2.0.6\",\"has-values\":\"^1.0.0\",\"isobject\":\"^3.0.0\"},\"dependencies\":{\"isobject\":{\"version\":\"3.0.1\",\"resolved\":\"https://registry.npmmirror.com/isobject/-/isobject-3.0.1.tgz\",\"integrity\":\"sha512-WhB9zCku7EGTj/HQQRz5aUQEUeoQZH2bWcltRErOpymJ4boYE6wL9Tbr23krRPSZ+C5zqNSrSw+Cc7sZZ4b7vg==\",\"dev\":true,\"optional\":true}}},\"has-values\":{\"version\":\"1.0.0\",\"resolved\":\"https://registry.npmmirror.com/has-values/-/has-values-1.0.0.tgz\",\"integrity\":\"sha512-ODYZC64uqzmtfGMEAX/FvZiRyWLpAC3vYnNunURUnkGVTS+mI0smVsWaPydRBsE3g+ok7h960jChO8mFcWlHaQ==\",\"dev\":true,\"optional\":true,\"requires\":{\"is-number\":\"^3.0.0\",\"kind-of\":\"^4.0.0\"},\"dependencies\":{\"is-number\":{\"version\":\"3.0.0\",\"resolved\":\"https://registry.npmmirror.com/is-number/-/is-number-3.0.0.tgz\",\"integrity\":\"sha512-4cboCqIpliH+mAvFNegjZQ4kgKc3ZUhQVr3HvWbSh5q3WH2v82ct+T2Y1hdU5Gdtorx/cLifQjqCbL7bpznLTg==\",\"dev\":true,\"optional\":true,\"requires\":{\"kind-of\":\"^3.0.2\"},\"dependencies\":{\"kind-of\":{\"version\":\"3.2.2\",\"resolved\":\"https://registry.npmmirror.com/kind-of/-/kind-of-3.2.2.tgz\",\"integrity\":\"sha512-NOW9QQXMoZGg/oqnVNoNTTIFEIid1627WCffUBJEdMxYApq7mNE7CpzucIPc+ZQg25Phej7IJSmX3hO+oblOtQ==\",\"dev\":true,\"optional\":true,\"requires\":{\"is-buffer\":\"^1.1.5\"}}}},\"kind-of\":{\"version\":\"4.0.0\",\"resolved\":\"https://registry.npmmirror.com/kind-of/-/kind-of-4.0.0.tgz\",\"integrity\":\"sha512-24XsCxmEbRwEDbz/qz3stgin8TTzZ1ESR56OMCN0ujYg+vRutNSiOj9bHH9u85DKgXguraugV5sFuvbD4FW/hw==\",\"dev\":true,\"optional\":true,\"requires\":{\"is-buffer\":\"^1.1.5\"}}}},\"home-or-tmp\":{\"version\":\"2.0.0\",\"resolved\":\"https://registry.npmmirror.com/home-or-tmp/-/home-or-tmp-2.0.0.tgz\",\"integrity\":\"sha512-ycURW7oUxE2sNiPVw1HVEFsW+ecOpJ5zaj7eC0RlwhibhRBod20muUN8qu/gzx956YrLolVvs1MTXwKgC2rVEg==\",\"dev\":true,\"requires\":{\"os-homedir\":\"^1.0.0\",\"os-tmpdir\":\"^1.0.1\"}},\"inflight\":{\"version\":\"1.0.6\",\"resolved\":\"https://registry.npmmirror.com/inflight/-/inflight-1.0.6.tgz\",\"integrity\":\"sha512-k92I/b08q4wvFscXCLvqfsHCrjrF7yiXsQuIVvVE7N82W3+aqpzuUdBbfhWcy/FZR3/4IgflMgKLOsvPDrGCJA==\",\"dev\":true,\"requires\":{\"once\":\"^1.3.0\",\"wrappy\":\"1\"}},\"inherits\":{\"version\":\"2.0.4\",\"resolved\":\"https://registry.npmmirror.com/inherits/-/inherits-2.0.4.tgz\",\"integrity\":\"sha512-k/vGaX4/Yla3WzyMCvTQOXYeIHvqOKtnqBduzTHpzpQZzAskKMhZ2K+EnBiSM9zGSoIFeMpXKxa4dYeZIQqewQ==\",\"dev\":true},\"invariant\":{\"version\":\"2.2.4\",\"resolved\":\"https://registry.npmmirror.com/invariant/-/invariant-2.2.4.tgz\",\"integrity\":\"sha512-phJfQVBuaJM5raOpJjSfkiD6BpbCE4Ns//LaXl6wGYtUBY83nWS6Rf9tXm2e8VaK60JEjYldbPif/A2B1C2gNA==\",\"dev\":true,\"requires\":{\"loose-envify\":\"^1.0.0\"}},\"is-accessor-descriptor\":{\"version\":\"0.1.6\",\"resolved\":\"https://registry.npmmirror.com/is-accessor-descriptor/-/is-accessor-descriptor-0.1.6.tgz\",\"integrity\":\"sha512-e1BM1qnDbMRG3ll2U9dSK0UMHuWOs3pY3AtcFsmvwPtKL3MML/Q86i+GilLfvqEs4GW+ExB91tQ3Ig9noDIZ+A==\",\"dev\":true,\"optional\":true,\"requires\":{\"kind-of\":\"^3.0.2\"}},\"is-binary-path\":{\"version\":\"1.0.1\",\"resolved\":\"https://registry.npmmirror.com/is-binary-path/-/is-binary-path-1.0.1.tgz\",\"integrity\":\"sha512-9fRVlXc0uCxEDj1nQzaWONSpbTfx0FmJfzHF7pwlI8DkWGoHBBea4Pg5Ky0ojwwxQmnSifgbKkI06Qv0Ljgj+Q==\",\"dev\":true,\"optional\":true,\"requires\":{\"binary-extensions\":\"^1.0.0\"}},\"is-buffer\":{\"version\":\"1.1.6\",\"resolved\":\"https://registry.npmmirror.com/is-buffer/-/is-buffer-1.1.6.tgz\",\"integrity\":\"sha512-NcdALwpXkTm5Zvvbk7owOUSvVvBKDgKP5/ewfXEznmQFfs4ZRmanOeKBTjRVjka3QFoN6XJ+9F3USqfHqTaU5w==\",\"dev\":true,\"optional\":true},\"is-data-descriptor\":{\"version\":\"0.1.4\",\"resolved\":\"https://registry.npmmirror.com/is-data-descriptor/-/is-data-descriptor-0.1.4.tgz\",\"integrity\":\"sha512-+w9D5ulSoBNlmw9OHn3U2v51SyoCd0he+bB3xMl62oijhrspxowjU+AIcDY0N3iEJbUEkB15IlMASQsxYigvXg==\",\"dev\":true,\"optional\":true,\"requires\":{\"kind-of\":\"^3.0.2\"}},\"is-descriptor\":{\"version\":\"0.1.6\",\"resolved\":\"https://registry.npmmirror.com/is-descriptor/-/is-descriptor-0.1.6.tgz\",\"integrity\":\"sha512-avDYr0SB3DwO9zsMov0gKCESFYqCnE4hq/4z3TdUlukEy5t9C0YRq7HLrsN52NAcqXKaepeCD0n+B0arnVG3Hg==\",\"dev\":true,\"optional\":true,\"requires\":{\"is-accessor-descriptor\":\"^0.1.6\",\"is-data-descriptor\":\"^0.1.4\",\"kind-of\":\"^5.0.0\"},\"dependencies\":{\"kind-of\":{\"version\":\"5.1.0\",\"resolved\":\"https://registry.npmmirror.com/kind-of/-/kind-of-5.1.0.tgz\",\"integrity\":\"sha512-NGEErnH6F2vUuXDh+OlbcKW7/wOcfdRHaZ7VWtqCztfHri/++YKmP51OdWeGPuqCOba6kk2OTe5d02VmTB80Pw==\",\"dev\":true,\"optional\":true}}},\"is-dotfile\":{\"version\":\"1.0.3\",\"resolved\":\"https://registry.npmmirror.com/is-dotfile/-/is-dotfile-1.0.3.tgz\",\"integrity\":\"sha512-9YclgOGtN/f8zx0Pr4FQYMdibBiTaH3sn52vjYip4ZSf6C4/6RfTEZ+MR4GvKhCxdPh21Bg42/WL55f6KSnKpg==\",\"dev\":true,\"optional\":true},\"is-equal-shallow\":{\"version\":\"0.1.3\",\"resolved\":\"https://registry.npmmirror.com/is-equal-shallow/-/is-equal-shallow-0.1.3.tgz\",\"integrity\":\"sha512-0EygVC5qPvIyb+gSz7zdD5/AAoS6Qrx1e//6N4yv4oNm30kqvdmG66oZFWVlQHUWe5OjP08FuTw2IdT0EOTcYA==\",\"dev\":true,\"optional\":true,\"requires\":{\"is-primitive\":\"^2.0.0\"}},\"is-extendable\":{\"version\":\"0.1.1\",\"resolved\":\"https://registry.npmmirror.com/is-extendable/-/is-extendable-0.1.1.tgz\",\"integrity\":\"sha512-5BMULNob1vgFX6EjQw5izWDxrecWK9AM72rugNr0TFldMOi0fj6Jk+zeKIt0xGj4cEfQIJth4w3OKWOJ4f+AFw==\",\"dev\":true,\"optional\":true},\"is-extglob\":{\"version\":\"1.0.0\",\"resolved\":\"https://registry.npmmirror.com/is-extglob/-/is-extglob-1.0.0.tgz\",\"integrity\":\"sha512-7Q+VbVafe6x2T+Tu6NcOf6sRklazEPmBoB3IWk3WdGZM2iGUwU/Oe3Wtq5lSEkDTTlpp8yx+5t4pzO/i9Ty1ww==\",\"dev\":true,\"optional\":true},\"is-finite\":{\"version\":\"1.1.0\",\"resolved\":\"https://registry.npmmirror.com/is-finite/-/is-finite-1.1.0.tgz\",\"integrity\":\"sha512-cdyMtqX/BOqqNBBiKlIVkytNHm49MtMlYyn1zxzvJKWmFMlGzm+ry5BBfYyeY9YmNKbRSo/o7OX9w9ale0wg3w==\",\"dev\":true},\"is-glob\":{\"version\":\"2.0.1\",\"resolved\":\"https://registry.npmmirror.com/is-glob/-/is-glob-2.0.1.tgz\",\"integrity\":\"sha512-a1dBeB19NXsf/E0+FHqkagizel/LQw2DjSQpvQrj3zT+jYPpaUCryPnrQajXKFLCMuf4I6FhRpaGtw4lPrG6Eg==\",\"dev\":true,\"optional\":true,\"requires\":{\"is-extglob\":\"^1.0.0\"}},\"is-number\":{\"version\":\"2.1.0\",\"resolved\":\"https://registry.npmmirror.com/is-number/-/is-number-2.1.0.tgz\",\"integrity\":\"sha512-QUzH43Gfb9+5yckcrSA0VBDwEtDUchrk4F6tfJZQuNzDJbEDB9cZNzSfXGQ1jqmdDY/kl41lUOWM9syA8z8jlg==\",\"dev\":true,\"optional\":true,\"requires\":{\"kind-of\":\"^3.0.2\"}},\"is-plain-object\":{\"version\":\"2.0.4\",\"resolved\":\"https://registry.npmmirror.com/is-plain-object/-/is-plain-object-2.0.4.tgz\",\"integrity\":\"sha512-h5PpgXkWitc38BBMYawTYMWJHFZJVnBquFE57xFpjB8pJFiF6gZ+bU+WyI/yqXiFR5mdLsgYNaPe8uao6Uv9Og==\",\"dev\":true,\"optional\":true,\"requires\":{\"isobject\":\"^3.0.1\"},\"dependencies\":{\"isobject\":{\"version\":\"3.0.1\",\"resolved\":\"https://registry.npmmirror.com/isobject/-/isobject-3.0.1.tgz\",\"integrity\":\"sha512-WhB9zCku7EGTj/HQQRz5aUQEUeoQZH2bWcltRErOpymJ4boYE6wL9Tbr23krRPSZ+C5zqNSrSw+Cc7sZZ4b7vg==\",\"dev\":true,\"optional\":true}}},\"is-posix-bracket\":{\"version\":\"0.1.1\",\"resolved\":\"https://registry.npmmirror.com/is-posix-bracket/-/is-posix-bracket-0.1.1.tgz\",\"integrity\":\"sha512-Yu68oeXJ7LeWNmZ3Zov/xg/oDBnBK2RNxwYY1ilNJX+tKKZqgPK+qOn/Gs9jEu66KDY9Netf5XLKNGzas/vPfQ==\",\"dev\":true,\"optional\":true},\"is-primitive\":{\"version\":\"2.0.0\",\"resolved\":\"https://registry.npmmirror.com/is-primitive/-/is-primitive-2.0.0.tgz\",\"integrity\":\"sha512-N3w1tFaRfk3UrPfqeRyD+GYDASU3W5VinKhlORy8EWVf/sIdDL9GAcew85XmktCfH+ngG7SRXEVDoO18WMdB/Q==\",\"dev\":true,\"optional\":true},\"is-windows\":{\"version\":\"1.0.2\",\"resolved\":\"https://registry.npmmirror.com/is-windows/-/is-windows-1.0.2.tgz\",\"integrity\":\"sha512-eXK1UInq2bPmjyX6e3VHIzMLobc4J94i4AWn+Hpq3OU5KkrRC96OAcR3PRJ/pGu6m8TRnBHP9dkXQVsT/COVIA==\",\"dev\":true,\"optional\":true},\"isarray\":{\"version\":\"1.0.0\",\"resolved\":\"https://registry.npmmirror.com/isarray/-/isarray-1.0.0.tgz\",\"integrity\":\"sha512-VLghIWNM6ELQzo7zwmcg0NmTVyWKYjvIeM83yjp0wRDTmUnrM678fQbcKBo6n2CJEF0szoG//ytg+TKla89ALQ==\",\"dev\":true,\"optional\":true},\"isobject\":{\"version\":\"2.1.0\",\"resolved\":\"https://registry.npmmirror.com/isobject/-/isobject-2.1.0.tgz\",\"integrity\":\"sha512-+OUdGJlgjOBZDfxnDjYYG6zp487z0JGNQq3cYQYg5f5hKR+syHMsaztzGeml/4kGG55CSpKSpWTY+jYGgsHLgA==\",\"dev\":true,\"optional\":true,\"requires\":{\"isarray\":\"1.0.0\"}},\"js-tokens\":{\"version\":\"3.0.2\",\"resolved\":\"https://registry.npmmirror.com/js-tokens/-/js-tokens-3.0.2.tgz\",\"integrity\":\"sha512-RjTcuD4xjtthQkaWH7dFlH85L+QaVtSoOyGdZ3g6HFhS9dFNDfLyqgm2NFe2X6cQpeFmt0452FJjFG5UameExg==\",\"dev\":true},\"jsesc\":{\"version\":\"1.3.0\",\"resolved\":\"https://registry.npmmirror.com/jsesc/-/jsesc-1.3.0.tgz\",\"integrity\":\"sha512-Mke0DA0QjUWuJlhsE0ZPPhYiJkRap642SmI/4ztCFaUs6V2AiH1sfecc+57NgaryfAA2VR3v6O+CSjC1jZJKOA==\",\"dev\":true},\"json5\":{\"version\":\"0.5.1\",\"resolved\":\"https://registry.npmmirror.com/json5/-/json5-0.5.1.tgz\",\"integrity\":\"sha512-4xrs1aW+6N5DalkqSVA8fxh458CXvR99WU8WLKmq4v8eWAL86Xo3BVqyd3SkA9wEVjCMqyvvRRkshAdOnBp5rw==\",\"dev\":true},\"kind-of\":{\"version\":\"3.2.2\",\"resolved\":\"https://registry.npmmirror.com/kind-of/-/kind-of-3.2.2.tgz\",\"integrity\":\"sha512-NOW9QQXMoZGg/oqnVNoNTTIFEIid1627WCffUBJEdMxYApq7mNE7CpzucIPc+ZQg25Phej7IJSmX3hO+oblOtQ==\",\"dev\":true,\"optional\":true,\"requires\":{\"is-buffer\":\"^1.1.5\"}},\"lodash\":{\"version\":\"4.17.21\",\"resolved\":\"https://registry.npmmirror.com/lodash/-/lodash-4.17.21.tgz\",\"integrity\":\"sha512-v2kDEe57lecTulaDIuNTPy3Ry4gLGJ6Z1O3vE1krgXZNrsQ+LFTGHVxVjcXPs17LhbZVGedAJv8XZ1tvj5FvSg==\",\"dev\":true},\"loose-envify\":{\"version\":\"1.4.0\",\"resolved\":\"https://registry.npmmirror.com/loose-envify/-/loose-envify-1.4.0.tgz\",\"integrity\":\"sha512-lyuxPGr/Wfhrlem2CL/UcnUc1zcqKAImBDzukY7Y5F/yQiNdko6+fRLevlw1HgMySw7f611UIY408EtxRSoK3Q==\",\"dev\":true,\"requires\":{\"js-tokens\":\"^3.0.0 || ^4.0.0\"}},\"map-cache\":{\"version\":\"0.2.2\",\"resolved\":\"https://registry.npmmirror.com/map-cache/-/map-cache-0.2.2.tgz\",\"integrity\":\"sha512-8y/eV9QQZCiyn1SprXSrCmqJN0yNRATe+PO8ztwqrvrbdRLA3eYJF0yaR0YayLWkMbsQSKWS9N2gPcGEc4UsZg==\",\"dev\":true,\"optional\":true},\"map-visit\":{\"version\":\"1.0.0\",\"resolved\":\"https://registry.npmmirror.com/map-visit/-/map-visit-1.0.0.tgz\",\"integrity\":\"sha512-4y7uGv8bd2WdM9vpQsiQNo41Ln1NvhvDRuVt0k2JZQ+ezN2uaQes7lZeZ+QQUHOLQAtDaBJ+7wCbi+ab/KFs+w==\",\"dev\":true,\"optional\":true,\"requires\":{\"object-visit\":\"^1.0.0\"}},\"math-random\":{\"version\":\"1.0.4\",\"resolved\":\"https://registry.npmmirror.com/math-random/-/math-random-1.0.4.tgz\",\"integrity\":\"sha512-rUxjysqif/BZQH2yhd5Aaq7vXMSx9NdEsQcyA07uEzIvxgI7zIr33gGsh+RU0/XjmQpCW7RsVof1vlkvQVCK5A==\",\"dev\":true,\"optional\":true},\"micromatch\":{\"version\":\"2.3.11\",\"resolved\":\"https://registry.npmmirror.com/micromatch/-/micromatch-2.3.11.tgz\",\"integrity\":\"sha512-LnU2XFEk9xxSJ6rfgAry/ty5qwUTyHYOBU0g4R6tIw5ljwgGIBmiKhRWLw5NpMOnrgUNcDJ4WMp8rl3sYVHLNA==\",\"dev\":true,\"optional\":true,\"requires\":{\"arr-diff\":\"^2.0.0\",\"array-unique\":\"^0.2.1\",\"braces\":\"^1.8.2\",\"expand-brackets\":\"^0.1.4\",\"extglob\":\"^0.3.1\",\"filename-regex\":\"^2.0.0\",\"is-extglob\":\"^1.0.0\",\"is-glob\":\"^2.0.1\",\"kind-of\":\"^3.0.2\",\"normalize-path\":\"^2.0.1\",\"object.omit\":\"^2.0.0\",\"parse-glob\":\"^3.0.4\",\"regex-cache\":\"^0.4.2\"}},\"minimatch\":{\"version\":\"3.1.2\",\"resolved\":\"https://registry.npmmirror.com/minimatch/-/minimatch-3.1.2.tgz\",\"integrity\":\"sha512-J7p63hRiAjw1NDEww1W7i37+ByIrOWO5XQQAzZ3VOcL0PNybwpfmV/N05zFAzwQ9USyEcX6t3UO+K5aqBQOIHw==\",\"dev\":true,\"requires\":{\"brace-expansion\":\"^1.1.7\"}},\"minimist\":{\"version\":\"1.2.8\",\"resolved\":\"https://registry.npmmirror.com/minimist/-/minimist-1.2.8.tgz\",\"integrity\":\"sha512-2yyAR8qBkN3YuheJanUpWC5U3bb5osDywNB8RzDVlDwDHbocAJveqqj1u8+SVD7jkWT4yvsHCpWqqWqAxb0zCA==\",\"dev\":true},\"mixin-deep\":{\"version\":\"1.3.2\",\"resolved\":\"https://registry.npmmirror.com/mixin-deep/-/mixin-deep-1.3.2.tgz\",\"integrity\":\"sha512-WRoDn//mXBiJ1H40rqa3vH0toePwSsGb45iInWlTySa+Uu4k3tYUSxa2v1KqAiLtvlrSzaExqS1gtk96A9zvEA==\",\"dev\":true,\"optional\":true,\"requires\":{\"for-in\":\"^1.0.2\",\"is-extendable\":\"^1.0.1\"},\"dependencies\":{\"is-extendable\":{\"version\":\"1.0.1\",\"resolved\":\"https://registry.npmmirror.com/is-extendable/-/is-extendable-1.0.1.tgz\",\"integrity\":\"sha512-arnXMxT1hhoKo9k1LZdmlNyJdDDfy2v0fXjFlmok4+i8ul/6WlbVge9bhM74OpNPQPMGUToDtz+KXa1PneJxOA==\",\"dev\":true,\"optional\":true,\"requires\":{\"is-plain-object\":\"^2.0.4\"}}}},\"mkdirp\":{\"version\":\"0.5.6\",\"resolved\":\"https://registry.npmmirror.com/mkdirp/-/mkdirp-0.5.6.tgz\",\"integrity\":\"sha512-FP+p8RB8OWpF3YZBCrP5gtADmtXApB5AMLn+vdyA+PyxCjrCs00mjyUozssO33cwDeT3wNGdLxJ5M//YqtHAJw==\",\"dev\":true,\"requires\":{\"minimist\":\"^1.2.6\"}},\"ms\":{\"version\":\"2.0.0\",\"resolved\":\"https://registry.npmmirror.com/ms/-/ms-2.0.0.tgz\",\"integrity\":\"sha512-Tpp60P6IUJDTuOq/5Z8cdskzJujfwqfOTkrwIwj7IRISpnkJnT6SyJ4PCPnGMoFjC9ddhal5KVIYtAt97ix05A==\",\"dev\":true},\"nan\":{\"version\":\"2.17.0\",\"resolved\":\"https://registry.npmmirror.com/nan/-/nan-2.17.0.tgz\",\"integrity\":\"sha512-2ZTgtl0nJsO0KQCjEpxcIr5D+Yv90plTitZt9JBfQvVJDS5seMl3FOvsh3+9CoYWXf/1l5OaZzzF6nDm4cagaQ==\",\"dev\":true,\"optional\":true},\"nanomatch\":{\"version\":\"1.2.13\",\"resolved\":\"https://registry.npmmirror.com/nanomatch/-/nanomatch-1.2.13.tgz\",\"integrity\":\"sha512-fpoe2T0RbHwBTBUOftAfBPaDEi06ufaUai0mE6Yn1kacc3SnTErfb/h+X94VXzI64rKFHYImXSvdwGGCmwOqCA==\",\"dev\":true,\"optional\":true,\"requires\":{\"arr-diff\":\"^4.0.0\",\"array-unique\":\"^0.3.2\",\"define-property\":\"^2.0.2\",\"extend-shallow\":\"^3.0.2\",\"fragment-cache\":\"^0.2.1\",\"is-windows\":\"^1.0.2\",\"kind-of\":\"^6.0.2\",\"object.pick\":\"^1.3.0\",\"regex-not\":\"^1.0.0\",\"snapdragon\":\"^0.8.1\",\"to-regex\":\"^3.0.1\"},\"dependencies\":{\"arr-diff\":{\"version\":\"4.0.0\",\"resolved\":\"https://registry.npmmirror.com/arr-diff/-/arr-diff-4.0.0.tgz\",\"integrity\":\"sha512-YVIQ82gZPGBebQV/a8dar4AitzCQs0jjXwMPZllpXMaGjXPYVUawSxQrRsjhjupyVxEvbHgUmIhKVlND+j02kA==\",\"dev\":true,\"optional\":true},\"array-unique\":{\"version\":\"0.3.2\",\"resolved\":\"https://registry.npmmirror.com/array-unique/-/array-unique-0.3.2.tgz\",\"integrity\":\"sha512-SleRWjh9JUud2wH1hPs9rZBZ33H6T9HOiL0uwGnGx9FpE6wKGyfWugmbkEOIs6qWrZhg0LWeLziLrEwQJhs5mQ==\",\"dev\":true,\"optional\":true},\"kind-of\":{\"version\":\"6.0.3\",\"resolved\":\"https://registry.npmmirror.com/kind-of/-/kind-of-6.0.3.tgz\",\"integrity\":\"sha512-dcS1ul+9tmeD95T+x28/ehLgd9mENa3LsvDTtzm3vyBEO7RPptvAD+t44WVXaUjTBRcrpFeFlC8WCruUR456hw==\",\"dev\":true,\"optional\":true}}},\"normalize-path\":{\"version\":\"2.1.1\",\"resolved\":\"https://registry.npmmirror.com/normalize-path/-/normalize-path-2.1.1.tgz\",\"integrity\":\"sha512-3pKJwH184Xo/lnH6oyP1q2pMd7HcypqqmRs91/6/i2CGtWwIKGCkOOMTm/zXbgTEWHw1uNpNi/igc3ePOYHb6w==\",\"dev\":true,\"optional\":true,\"requires\":{\"remove-trailing-separator\":\"^1.0.1\"}},\"object-assign\":{\"version\":\"4.1.1\",\"resolved\":\"https://registry.npmmirror.com/object-assign/-/object-assign-4.1.1.tgz\",\"integrity\":\"sha512-rJgTQnkUnH1sFw8yT6VSU3zD3sWmu6sZhIseY8VX+GRu3P6F7Fu+JNDoXfklElbLJSnc3FUQHVe4cU5hj+BcUg==\",\"dev\":true},\"object-copy\":{\"version\":\"0.1.0\",\"resolved\":\"https://registry.npmmirror.com/object-copy/-/object-copy-0.1.0.tgz\",\"integrity\":\"sha512-79LYn6VAb63zgtmAteVOWo9Vdj71ZVBy3Pbse+VqxDpEP83XuujMrGqHIwAXJ5I/aM0zU7dIyIAhifVTPrNItQ==\",\"dev\":true,\"optional\":true,\"requires\":{\"copy-descriptor\":\"^0.1.0\",\"define-property\":\"^0.2.5\",\"kind-of\":\"^3.0.3\"},\"dependencies\":{\"define-property\":{\"version\":\"0.2.5\",\"resolved\":\"https://registry.npmmirror.com/define-property/-/define-property-0.2.5.tgz\",\"integrity\":\"sha512-Rr7ADjQZenceVOAKop6ALkkRAmH1A4Gx9hV/7ZujPUN2rkATqFO0JZLZInbAjpZYoJ1gUx8MRMQVkYemcbMSTA==\",\"dev\":true,\"optional\":true,\"requires\":{\"is-descriptor\":\"^0.1.0\"}}}},\"object-visit\":{\"version\":\"1.0.1\",\"resolved\":\"https://registry.npmmirror.com/object-visit/-/object-visit-1.0.1.tgz\",\"integrity\":\"sha512-GBaMwwAVK9qbQN3Scdo0OyvgPW7l3lnaVMj84uTOZlswkX0KpF6fyDBJhtTthf7pymztoN36/KEr1DyhF96zEA==\",\"dev\":true,\"optional\":true,\"requires\":{\"isobject\":\"^3.0.0\"},\"dependencies\":{\"isobject\":{\"version\":\"3.0.1\",\"resolved\":\"https://registry.npmmirror.com/isobject/-/isobject-3.0.1.tgz\",\"integrity\":\"sha512-WhB9zCku7EGTj/HQQRz5aUQEUeoQZH2bWcltRErOpymJ4boYE6wL9Tbr23krRPSZ+C5zqNSrSw+Cc7sZZ4b7vg==\",\"dev\":true,\"optional\":true}}},\"object.omit\":{\"version\":\"2.0.1\",\"resolved\":\"https://registry.npmmirror.com/object.omit/-/object.omit-2.0.1.tgz\",\"integrity\":\"sha512-UiAM5mhmIuKLsOvrL+B0U2d1hXHF3bFYWIuH1LMpuV2EJEHG1Ntz06PgLEHjm6VFd87NpH8rastvPoyv6UW2fA==\",\"dev\":true,\"optional\":true,\"requires\":{\"for-own\":\"^0.1.4\",\"is-extendable\":\"^0.1.1\"}},\"object.pick\":{\"version\":\"1.3.0\",\"resolved\":\"https://registry.npmmirror.com/object.pick/-/object.pick-1.3.0.tgz\",\"integrity\":\"sha512-tqa/UMy/CCoYmj+H5qc07qvSL9dqcs/WZENZ1JbtWBlATP+iVOe778gE6MSijnyCnORzDuX6hU+LA4SZ09YjFQ==\",\"dev\":true,\"optional\":true,\"requires\":{\"isobject\":\"^3.0.1\"},\"dependencies\":{\"isobject\":{\"version\":\"3.0.1\",\"resolved\":\"https://registry.npmmirror.com/isobject/-/isobject-3.0.1.tgz\",\"integrity\":\"sha512-WhB9zCku7EGTj/HQQRz5aUQEUeoQZH2bWcltRErOpymJ4boYE6wL9Tbr23krRPSZ+C5zqNSrSw+Cc7sZZ4b7vg==\",\"dev\":true,\"optional\":true}}},\"once\":{\"version\":\"1.4.0\",\"resolved\":\"https://registry.npmmirror.com/once/-/once-1.4.0.tgz\",\"integrity\":\"sha512-lNaJgI+2Q5URQBkccEKHTQOPaXdUxnZZElQTZY0MFUAuaEqe1E+Nyvgdz/aIyNi6Z9MzO5dv1H8n58/GELp3+w==\",\"dev\":true,\"requires\":{\"wrappy\":\"1\"}},\"os-homedir\":{\"version\":\"1.0.2\",\"resolved\":\"https://registry.npmmirror.com/os-homedir/-/os-homedir-1.0.2.tgz\",\"integrity\":\"sha512-B5JU3cabzk8c67mRRd3ECmROafjYMXbuzlwtqdM8IbS8ktlTix8aFGb2bAGKrSRIlnfKwovGUUr72JUPyOb6kQ==\",\"dev\":true},\"os-tmpdir\":{\"version\":\"1.0.2\",\"resolved\":\"https://registry.npmmirror.com/os-tmpdir/-/os-tmpdir-1.0.2.tgz\",\"integrity\":\"sha512-D2FR03Vir7FIu45XBY20mTb+/ZSWB00sjU9jdQXt83gDrI4Ztz5Fs7/yy74g2N5SVQY4xY1qDr4rNddwYRVX0g==\",\"dev\":true},\"output-file-sync\":{\"version\":\"1.1.2\",\"resolved\":\"https://registry.npmmirror.com/output-file-sync/-/output-file-sync-1.1.2.tgz\",\"integrity\":\"sha512-uQLlclru4xpCi+tfs80l3QF24KL81X57ELNMy7W/dox+JTtxUf1bLyQ8968fFCmSqqbokjW0kn+WBIlO+rSkNg==\",\"dev\":true,\"requires\":{\"graceful-fs\":\"^4.1.4\",\"mkdirp\":\"^0.5.1\",\"object-assign\":\"^4.1.0\"}},\"parse-glob\":{\"version\":\"3.0.4\",\"resolved\":\"https://registry.npmmirror.com/parse-glob/-/parse-glob-3.0.4.tgz\",\"integrity\":\"sha512-FC5TeK0AwXzq3tUBFtH74naWkPQCEWs4K+xMxWZBlKDWu0bVHXGZa+KKqxKidd7xwhdZ19ZNuF2uO1M/r196HA==\",\"dev\":true,\"optional\":true,\"requires\":{\"glob-base\":\"^0.3.0\",\"is-dotfile\":\"^1.0.0\",\"is-extglob\":\"^1.0.0\",\"is-glob\":\"^2.0.0\"}},\"pascalcase\":{\"version\":\"0.1.1\",\"resolved\":\"https://registry.npmmirror.com/pascalcase/-/pascalcase-0.1.1.tgz\",\"integrity\":\"sha512-XHXfu/yOQRy9vYOtUDVMN60OEJjW013GoObG1o+xwQTpB9eYJX/BjXMsdW13ZDPruFhYYn0AG22w0xgQMwl3Nw==\",\"dev\":true,\"optional\":true},\"path-is-absolute\":{\"version\":\"1.0.1\",\"resolved\":\"https://registry.npmmirror.com/path-is-absolute/-/path-is-absolute-1.0.1.tgz\",\"integrity\":\"sha512-AVbw3UJ2e9bq64vSaS9Am0fje1Pa8pbGqTTsmXfaIiMpnr5DlDhfJOuLj9Sf95ZPVDAUerDfEk88MPmPe7UCQg==\",\"dev\":true},\"posix-character-classes\":{\"version\":\"0.1.1\",\"resolved\":\"https://registry.npmmirror.com/posix-character-classes/-/posix-character-classes-0.1.1.tgz\",\"integrity\":\"sha512-xTgYBc3fuo7Yt7JbiuFxSYGToMoz8fLoE6TC9Wx1P/u+LfeThMOAqmuyECnlBaaJb+u1m9hHiXUEtwW4OzfUJg==\",\"dev\":true,\"optional\":true},\"preserve\":{\"version\":\"0.2.0\",\"resolved\":\"https://registry.npmmirror.com/preserve/-/preserve-0.2.0.tgz\",\"integrity\":\"sha512-s/46sYeylUfHNjI+sA/78FAHlmIuKqI9wNnzEOGehAlUUYeObv5C2mOinXBjyUyWmJ2SfcS2/ydApH4hTF4WXQ==\",\"dev\":true,\"optional\":true},\"private\":{\"version\":\"0.1.8\",\"resolved\":\"https://registry.npmmirror.com/private/-/private-0.1.8.tgz\",\"integrity\":\"sha512-VvivMrbvd2nKkiG38qjULzlc+4Vx4wm/whI9pQD35YrARNnhxeiRktSOhSukRLFNlzg6Br/cJPet5J/u19r/mg==\",\"dev\":true},\"process-nextick-args\":{\"version\":\"2.0.1\",\"resolved\":\"https://registry.npmmirror.com/process-nextick-args/-/process-nextick-args-2.0.1.tgz\",\"integrity\":\"sha512-3ouUOpQhtgrbOa17J7+uxOTpITYWaGP7/AhoR3+A+/1e9skrzelGi/dXzEYyvbxubEF6Wn2ypscTKiKJFFn1ag==\",\"dev\":true,\"optional\":true},\"randomatic\":{\"version\":\"3.1.1\",\"resolved\":\"https://registry.npmmirror.com/randomatic/-/randomatic-3.1.1.tgz\",\"integrity\":\"sha512-TuDE5KxZ0J461RVjrJZCJc+J+zCkTb1MbH9AQUq68sMhOMcy9jLcb3BrZKgp9q9Ncltdg4QVqWrH02W2EFFVYw==\",\"dev\":true,\"optional\":true,\"requires\":{\"is-number\":\"^4.0.0\",\"kind-of\":\"^6.0.0\",\"math-random\":\"^1.0.1\"},\"dependencies\":{\"is-number\":{\"version\":\"4.0.0\",\"resolved\":\"https://registry.npmmirror.com/is-number/-/is-number-4.0.0.tgz\",\"integrity\":\"sha512-rSklcAIlf1OmFdyAqbnWTLVelsQ58uvZ66S/ZyawjWqIviTWCjg2PzVGw8WUA+nNuPTqb4wgA+NszrJ+08LlgQ==\",\"dev\":true,\"optional\":true},\"kind-of\":{\"version\":\"6.0.3\",\"resolved\":\"https://registry.npmmirror.com/kind-of/-/kind-of-6.0.3.tgz\",\"integrity\":\"sha512-dcS1ul+9tmeD95T+x28/ehLgd9mENa3LsvDTtzm3vyBEO7RPptvAD+t44WVXaUjTBRcrpFeFlC8WCruUR456hw==\",\"dev\":true,\"optional\":true}}},\"readable-stream\":{\"version\":\"2.3.8\",\"resolved\":\"https://registry.npmmirror.com/readable-stream/-/readable-stream-2.3.8.tgz\",\"integrity\":\"sha512-8p0AUk4XODgIewSi0l8Epjs+EVnWiK7NoDIEGU0HhE7+ZyY8D1IMY7odu5lRrFXGg71L15KG8QrPmum45RTtdA==\",\"dev\":true,\"optional\":true,\"requires\":{\"core-util-is\":\"~1.0.0\",\"inherits\":\"~2.0.3\",\"isarray\":\"~1.0.0\",\"process-nextick-args\":\"~2.0.0\",\"safe-buffer\":\"~5.1.1\",\"string_decoder\":\"~1.1.1\",\"util-deprecate\":\"~1.0.1\"}},\"readdirp\":{\"version\":\"2.2.1\",\"resolved\":\"https://registry.npmmirror.com/readdirp/-/readdirp-2.2.1.tgz\",\"integrity\":\"sha512-1JU/8q+VgFZyxwrJ+SVIOsh+KywWGpds3NTqikiKpDMZWScmAYyKIgqkO+ARvNWJfXeXR1zxz7aHF4u4CyH6vQ==\",\"dev\":true,\"optional\":true,\"requires\":{\"graceful-fs\":\"^4.1.11\",\"micromatch\":\"^3.1.10\",\"readable-stream\":\"^2.0.2\"},\"dependencies\":{\"arr-diff\":{\"version\":\"4.0.0\",\"resolved\":\"https://registry.npmmirror.com/arr-diff/-/arr-diff-4.0.0.tgz\",\"integrity\":\"sha512-YVIQ82gZPGBebQV/a8dar4AitzCQs0jjXwMPZllpXMaGjXPYVUawSxQrRsjhjupyVxEvbHgUmIhKVlND+j02kA==\",\"dev\":true,\"optional\":true},\"array-unique\":{\"version\":\"0.3.2\",\"resolved\":\"https://registry.npmmirror.com/array-unique/-/array-unique-0.3.2.tgz\",\"integrity\":\"sha512-SleRWjh9JUud2wH1hPs9rZBZ33H6T9HOiL0uwGnGx9FpE6wKGyfWugmbkEOIs6qWrZhg0LWeLziLrEwQJhs5mQ==\",\"dev\":true,\"optional\":true},\"braces\":{\"version\":\"2.3.2\",\"resolved\":\"https://registry.npmmirror.com/braces/-/braces-2.3.2.tgz\",\"integrity\":\"sha512-aNdbnj9P8PjdXU4ybaWLK2IF3jc/EoDYbC7AazW6to3TRsfXxscC9UXOB5iDiEQrkyIbWp2SLQda4+QAa7nc3w==\",\"dev\":true,\"optional\":true,\"requires\":{\"arr-flatten\":\"^1.1.0\",\"array-unique\":\"^0.3.2\",\"extend-shallow\":\"^2.0.1\",\"fill-range\":\"^4.0.0\",\"isobject\":\"^3.0.1\",\"repeat-element\":\"^1.1.2\",\"snapdragon\":\"^0.8.1\",\"snapdragon-node\":\"^2.0.1\",\"split-string\":\"^3.0.2\",\"to-regex\":\"^3.0.1\"},\"dependencies\":{\"extend-shallow\":{\"version\":\"2.0.1\",\"resolved\":\"https://registry.npmmirror.com/extend-shallow/-/extend-shallow-2.0.1.tgz\",\"integrity\":\"sha512-zCnTtlxNoAiDc3gqY2aYAWFx7XWWiasuF2K8Me5WbN8otHKTUKBwjPtNpRs/rbUZm7KxWAaNj7P1a/p52GbVug==\",\"dev\":true,\"optional\":true,\"requires\":{\"is-extendable\":\"^0.1.0\"}}}},\"expand-brackets\":{\"version\":\"2.1.4\",\"resolved\":\"https://registry.npmmirror.com/expand-brackets/-/expand-brackets-2.1.4.tgz\",\"integrity\":\"sha512-w/ozOKR9Obk3qoWeY/WDi6MFta9AoMR+zud60mdnbniMcBxRuFJyDt2LdX/14A1UABeqk+Uk+LDfUpvoGKppZA==\",\"dev\":true,\"optional\":true,\"requires\":{\"debug\":\"^2.3.3\",\"define-property\":\"^0.2.5\",\"extend-shallow\":\"^2.0.1\",\"posix-character-classes\":\"^0.1.0\",\"regex-not\":\"^1.0.0\",\"snapdragon\":\"^0.8.1\",\"to-regex\":\"^3.0.1\"},\"dependencies\":{\"define-property\":{\"version\":\"0.2.5\",\"resolved\":\"https://registry.npmmirror.com/define-property/-/define-property-0.2.5.tgz\",\"integrity\":\"sha512-Rr7ADjQZenceVOAKop6ALkkRAmH1A4Gx9hV/7ZujPUN2rkATqFO0JZLZInbAjpZYoJ1gUx8MRMQVkYemcbMSTA==\",\"dev\":true,\"optional\":true,\"requires\":{\"is-descriptor\":\"^0.1.0\"}},\"extend-shallow\":{\"version\":\"2.0.1\",\"resolved\":\"https://registry.npmmirror.com/extend-shallow/-/extend-shallow-2.0.1.tgz\",\"integrity\":\"sha512-zCnTtlxNoAiDc3gqY2aYAWFx7XWWiasuF2K8Me5WbN8otHKTUKBwjPtNpRs/rbUZm7KxWAaNj7P1a/p52GbVug==\",\"dev\":true,\"optional\":true,\"requires\":{\"is-extendable\":\"^0.1.0\"}},\"is-accessor-descriptor\":{\"version\":\"0.1.6\",\"resolved\":\"https://registry.npmmirror.com/is-accessor-descriptor/-/is-accessor-descriptor-0.1.6.tgz\",\"integrity\":\"sha512-e1BM1qnDbMRG3ll2U9dSK0UMHuWOs3pY3AtcFsmvwPtKL3MML/Q86i+GilLfvqEs4GW+ExB91tQ3Ig9noDIZ+A==\",\"dev\":true,\"optional\":true,\"requires\":{\"kind-of\":\"^3.0.2\"},\"dependencies\":{\"kind-of\":{\"version\":\"3.2.2\",\"resolved\":\"https://registry.npmmirror.com/kind-of/-/kind-of-3.2.2.tgz\",\"integrity\":\"sha512-NOW9QQXMoZGg/oqnVNoNTTIFEIid1627WCffUBJEdMxYApq7mNE7CpzucIPc+ZQg25Phej7IJSmX3hO+oblOtQ==\",\"dev\":true,\"optional\":true,\"requires\":{\"is-buffer\":\"^1.1.5\"}}}},\"is-data-descriptor\":{\"version\":\"0.1.4\",\"resolved\":\"https://registry.npmmirror.com/is-data-descriptor/-/is-data-descriptor-0.1.4.tgz\",\"integrity\":\"sha512-+w9D5ulSoBNlmw9OHn3U2v51SyoCd0he+bB3xMl62oijhrspxowjU+AIcDY0N3iEJbUEkB15IlMASQsxYigvXg==\",\"dev\":true,\"optional\":true,\"requires\":{\"kind-of\":\"^3.0.2\"},\"dependencies\":{\"kind-of\":{\"version\":\"3.2.2\",\"resolved\":\"https://registry.npmmirror.com/kind-of/-/kind-of-3.2.2.tgz\",\"integrity\":\"sha512-NOW9QQXMoZGg/oqnVNoNTTIFEIid1627WCffUBJEdMxYApq7mNE7CpzucIPc+ZQg25Phej7IJSmX3hO+oblOtQ==\",\"dev\":true,\"optional\":true,\"requires\":{\"is-buffer\":\"^1.1.5\"}}}},\"is-descriptor\":{\"version\":\"0.1.6\",\"resolved\":\"https://registry.npmmirror.com/is-descriptor/-/is-descriptor-0.1.6.tgz\",\"integrity\":\"sha512-avDYr0SB3DwO9zsMov0gKCESFYqCnE4hq/4z3TdUlukEy5t9C0YRq7HLrsN52NAcqXKaepeCD0n+B0arnVG3Hg==\",\"dev\":true,\"optional\":true,\"requires\":{\"is-accessor-descriptor\":\"^0.1.6\",\"is-data-descriptor\":\"^0.1.4\",\"kind-of\":\"^5.0.0\"}},\"kind-of\":{\"version\":\"5.1.0\",\"resolved\":\"https://registry.npmmirror.com/kind-of/-/kind-of-5.1.0.tgz\",\"integrity\":\"sha512-NGEErnH6F2vUuXDh+OlbcKW7/wOcfdRHaZ7VWtqCztfHri/++YKmP51OdWeGPuqCOba6kk2OTe5d02VmTB80Pw==\",\"dev\":true,\"optional\":true}}},\"extglob\":{\"version\":\"2.0.4\",\"resolved\":\"https://registry.npmmirror.com/extglob/-/extglob-2.0.4.tgz\",\"integrity\":\"sha512-Nmb6QXkELsuBr24CJSkilo6UHHgbekK5UiZgfE6UHD3Eb27YC6oD+bhcT+tJ6cl8dmsgdQxnWlcry8ksBIBLpw==\",\"dev\":true,\"optional\":true,\"requires\":{\"array-unique\":\"^0.3.2\",\"define-property\":\"^1.0.0\",\"expand-brackets\":\"^2.1.4\",\"extend-shallow\":\"^2.0.1\",\"fragment-cache\":\"^0.2.1\",\"regex-not\":\"^1.0.0\",\"snapdragon\":\"^0.8.1\",\"to-regex\":\"^3.0.1\"},\"dependencies\":{\"define-property\":{\"version\":\"1.0.0\",\"resolved\":\"https://registry.npmmirror.com/define-property/-/define-property-1.0.0.tgz\",\"integrity\":\"sha512-cZTYKFWspt9jZsMscWo8sc/5lbPC9Q0N5nBLgb+Yd915iL3udB1uFgS3B8YCx66UVHq018DAVFoee7x+gxggeA==\",\"dev\":true,\"optional\":true,\"requires\":{\"is-descriptor\":\"^1.0.0\"}},\"extend-shallow\":{\"version\":\"2.0.1\",\"resolved\":\"https://registry.npmmirror.com/extend-shallow/-/extend-shallow-2.0.1.tgz\",\"integrity\":\"sha512-zCnTtlxNoAiDc3gqY2aYAWFx7XWWiasuF2K8Me5WbN8otHKTUKBwjPtNpRs/rbUZm7KxWAaNj7P1a/p52GbVug==\",\"dev\":true,\"optional\":true,\"requires\":{\"is-extendable\":\"^0.1.0\"}}}},\"fill-range\":{\"version\":\"4.0.0\",\"resolved\":\"https://registry.npmmirror.com/fill-range/-/fill-range-4.0.0.tgz\",\"integrity\":\"sha512-VcpLTWqWDiTerugjj8e3+esbg+skS3M9e54UuR3iCeIDMXCLTsAH8hTSzDQU/X6/6t3eYkOKoZSef2PlU6U1XQ==\",\"dev\":true,\"optional\":true,\"requires\":{\"extend-shallow\":\"^2.0.1\",\"is-number\":\"^3.0.0\",\"repeat-string\":\"^1.6.1\",\"to-regex-range\":\"^2.1.0\"},\"dependencies\":{\"extend-shallow\":{\"version\":\"2.0.1\",\"resolved\":\"https://registry.npmmirror.com/extend-shallow/-/extend-shallow-2.0.1.tgz\",\"integrity\":\"sha512-zCnTtlxNoAiDc3gqY2aYAWFx7XWWiasuF2K8Me5WbN8otHKTUKBwjPtNpRs/rbUZm7KxWAaNj7P1a/p52GbVug==\",\"dev\":true,\"optional\":true,\"requires\":{\"is-extendable\":\"^0.1.0\"}}}},\"is-accessor-descriptor\":{\"version\":\"1.0.0\",\"resolved\":\"https://registry.npmmirror.com/is-accessor-descriptor/-/is-accessor-descriptor-1.0.0.tgz\",\"integrity\":\"sha512-m5hnHTkcVsPfqx3AKlyttIPb7J+XykHvJP2B9bZDjlhLIoEq4XoK64Vg7boZlVWYK6LUY94dYPEE7Lh0ZkZKcQ==\",\"dev\":true,\"optional\":true,\"requires\":{\"kind-of\":\"^6.0.0\"}},\"is-data-descriptor\":{\"version\":\"1.0.0\",\"resolved\":\"https://registry.npmmirror.com/is-data-descriptor/-/is-data-descriptor-1.0.0.tgz\",\"integrity\":\"sha512-jbRXy1FmtAoCjQkVmIVYwuuqDFUbaOeDjmed1tOGPrsMhtJA4rD9tkgA0F1qJ3gRFRXcHYVkdeaP50Q5rE/jLQ==\",\"dev\":true,\"optional\":true,\"requires\":{\"kind-of\":\"^6.0.0\"}},\"is-descriptor\":{\"version\":\"1.0.2\",\"resolved\":\"https://registry.npmmirror.com/is-descriptor/-/is-descriptor-1.0.2.tgz\",\"integrity\":\"sha512-2eis5WqQGV7peooDyLmNEPUrps9+SXX5c9pL3xEB+4e9HnGuDa7mB7kHxHw4CbqS9k1T2hOH3miL8n8WtiYVtg==\",\"dev\":true,\"optional\":true,\"requires\":{\"is-accessor-descriptor\":\"^1.0.0\",\"is-data-descriptor\":\"^1.0.0\",\"kind-of\":\"^6.0.2\"}},\"is-number\":{\"version\":\"3.0.0\",\"resolved\":\"https://registry.npmmirror.com/is-number/-/is-number-3.0.0.tgz\",\"integrity\":\"sha512-4cboCqIpliH+mAvFNegjZQ4kgKc3ZUhQVr3HvWbSh5q3WH2v82ct+T2Y1hdU5Gdtorx/cLifQjqCbL7bpznLTg==\",\"dev\":true,\"optional\":true,\"requires\":{\"kind-of\":\"^3.0.2\"},\"dependencies\":{\"kind-of\":{\"version\":\"3.2.2\",\"resolved\":\"https://registry.npmmirror.com/kind-of/-/kind-of-3.2.2.tgz\",\"integrity\":\"sha512-NOW9QQXMoZGg/oqnVNoNTTIFEIid1627WCffUBJEdMxYApq7mNE7CpzucIPc+ZQg25Phej7IJSmX3hO+oblOtQ==\",\"dev\":true,\"optional\":true,\"requires\":{\"is-buffer\":\"^1.1.5\"}}}},\"isobject\":{\"version\":\"3.0.1\",\"resolved\":\"https://registry.npmmirror.com/isobject/-/isobject-3.0.1.tgz\",\"integrity\":\"sha512-WhB9zCku7EGTj/HQQRz5aUQEUeoQZH2bWcltRErOpymJ4boYE6wL9Tbr23krRPSZ+C5zqNSrSw+Cc7sZZ4b7vg==\",\"dev\":true,\"optional\":true},\"kind-of\":{\"version\":\"6.0.3\",\"resolved\":\"https://registry.npmmirror.com/kind-of/-/kind-of-6.0.3.tgz\",\"integrity\":\"sha512-dcS1ul+9tmeD95T+x28/ehLgd9mENa3LsvDTtzm3vyBEO7RPptvAD+t44WVXaUjTBRcrpFeFlC8WCruUR456hw==\",\"dev\":true,\"optional\":true},\"micromatch\":{\"version\":\"3.1.10\",\"resolved\":\"https://registry.npmmirror.com/micromatch/-/micromatch-3.1.10.tgz\",\"integrity\":\"sha512-MWikgl9n9M3w+bpsY3He8L+w9eF9338xRl8IAO5viDizwSzziFEyUzo2xrrloB64ADbTf8uA8vRqqttDTOmccg==\",\"dev\":true,\"optional\":true,\"requires\":{\"arr-diff\":\"^4.0.0\",\"array-unique\":\"^0.3.2\",\"braces\":\"^2.3.1\",\"define-property\":\"^2.0.2\",\"extend-shallow\":\"^3.0.2\",\"extglob\":\"^2.0.4\",\"fragment-cache\":\"^0.2.1\",\"kind-of\":\"^6.0.2\",\"nanomatch\":\"^1.2.9\",\"object.pick\":\"^1.3.0\",\"regex-not\":\"^1.0.0\",\"snapdragon\":\"^0.8.1\",\"to-regex\":\"^3.0.2\"}}}},\"regenerate\":{\"version\":\"1.4.2\",\"resolved\":\"https://registry.npmmirror.com/regenerate/-/regenerate-1.4.2.tgz\",\"integrity\":\"sha512-zrceR/XhGYU/d/opr2EKO7aRHUeiBI8qjtfHqADTwZd6Szfy16la6kqD0MIUs5z5hx6AaKa+PixpPrR289+I0A==\",\"dev\":true},\"regenerator-runtime\":{\"version\":\"0.11.1\",\"resolved\":\"https://registry.npmmirror.com/regenerator-runtime/-/regenerator-runtime-0.11.1.tgz\",\"integrity\":\"sha512-MguG95oij0fC3QV3URf4V2SDYGJhJnJGqvIIgdECeODCT98wSWDAJ94SSuVpYQUoTcGUIL6L4yNB7j1DFFHSBg==\",\"dev\":true},\"regenerator-transform\":{\"version\":\"0.10.1\",\"resolved\":\"https://registry.npmmirror.com/regenerator-transform/-/regenerator-transform-0.10.1.tgz\",\"integrity\":\"sha512-PJepbvDbuK1xgIgnau7Y90cwaAmO/LCLMI2mPvaXq2heGMR3aWW5/BQvYrhJ8jgmQjXewXvBjzfqKcVOmhjZ6Q==\",\"dev\":true,\"requires\":{\"babel-runtime\":\"^6.18.0\",\"babel-types\":\"^6.19.0\",\"private\":\"^0.1.6\"}},\"regex-cache\":{\"version\":\"0.4.4\",\"resolved\":\"https://registry.npmmirror.com/regex-cache/-/regex-cache-0.4.4.tgz\",\"integrity\":\"sha512-nVIZwtCjkC9YgvWkpM55B5rBhBYRZhAaJbgcFYXXsHnbZ9UZI9nnVWYZpBlCqv9ho2eZryPnWrZGsOdPwVWXWQ==\",\"dev\":true,\"optional\":true,\"requires\":{\"is-equal-shallow\":\"^0.1.3\"}},\"regex-not\":{\"version\":\"1.0.2\",\"resolved\":\"https://registry.npmmirror.com/regex-not/-/regex-not-1.0.2.tgz\",\"integrity\":\"sha512-J6SDjUgDxQj5NusnOtdFxDwN/+HWykR8GELwctJ7mdqhcyy1xEc4SRFHUXvxTp661YaVKAjfRLZ9cCqS6tn32A==\",\"dev\":true,\"optional\":true,\"requires\":{\"extend-shallow\":\"^3.0.2\",\"safe-regex\":\"^1.1.0\"}},\"regexpu-core\":{\"version\":\"2.0.0\",\"resolved\":\"https://registry.npmmirror.com/regexpu-core/-/regexpu-core-2.0.0.tgz\",\"integrity\":\"sha512-tJ9+S4oKjxY8IZ9jmjnp/mtytu1u3iyIQAfmI51IKWH6bFf7XR1ybtaO6j7INhZKXOTYADk7V5qxaqLkmNxiZQ==\",\"dev\":true,\"requires\":{\"regenerate\":\"^1.2.1\",\"regjsgen\":\"^0.2.0\",\"regjsparser\":\"^0.1.4\"}},\"regjsgen\":{\"version\":\"0.2.0\",\"resolved\":\"https://registry.npmmirror.com/regjsgen/-/regjsgen-0.2.0.tgz\",\"integrity\":\"sha512-x+Y3yA24uF68m5GA+tBjbGYo64xXVJpbToBaWCoSNSc1hdk6dfctaRWrNFTVJZIIhL5GxW8zwjoixbnifnK59g==\",\"dev\":true},\"regjsparser\":{\"version\":\"0.1.5\",\"resolved\":\"https://registry.npmmirror.com/regjsparser/-/regjsparser-0.1.5.tgz\",\"integrity\":\"sha512-jlQ9gYLfk2p3V5Ag5fYhA7fv7OHzd1KUH0PRP46xc3TgwjwgROIW572AfYg/X9kaNq/LJnu6oJcFRXlIrGoTRw==\",\"dev\":true,\"requires\":{\"jsesc\":\"~0.5.0\"},\"dependencies\":{\"jsesc\":{\"version\":\"0.5.0\",\"resolved\":\"https://registry.npmmirror.com/jsesc/-/jsesc-0.5.0.tgz\",\"integrity\":\"sha512-uZz5UnB7u4T9LvwmFqXii7pZSouaRPorGs5who1Ip7VO0wxanFvBL7GkM6dTHlgX+jhBApRetaWpnDabOeTcnA==\",\"dev\":true}}},\"remove-trailing-separator\":{\"version\":\"1.1.0\",\"resolved\":\"https://registry.npmmirror.com/remove-trailing-separator/-/remove-trailing-separator-1.1.0.tgz\",\"integrity\":\"sha512-/hS+Y0u3aOfIETiaiirUFwDBDzmXPvO+jAfKTitUngIPzdKc6Z0LoFjM/CK5PL4C+eKwHohlHAb6H0VFfmmUsw==\",\"dev\":true,\"optional\":true},\"repeat-element\":{\"version\":\"1.1.4\",\"resolved\":\"https://registry.npmmirror.com/repeat-element/-/repeat-element-1.1.4.tgz\",\"integrity\":\"sha512-LFiNfRcSu7KK3evMyYOuCzv3L10TW7yC1G2/+StMjK8Y6Vqd2MG7r/Qjw4ghtuCOjFvlnms/iMmLqpvW/ES/WQ==\",\"dev\":true,\"optional\":true},\"repeat-string\":{\"version\":\"1.6.1\",\"resolved\":\"https://registry.npmmirror.com/repeat-string/-/repeat-string-1.6.1.tgz\",\"integrity\":\"sha512-PV0dzCYDNfRi1jCDbJzpW7jNNDRuCOG/jI5ctQcGKt/clZD+YcPS3yIlWuTJMmESC8aevCFmWJy5wjAFgNqN6w==\",\"dev\":true,\"optional\":true},\"repeating\":{\"version\":\"2.0.1\",\"resolved\":\"https://registry.npmmirror.com/repeating/-/repeating-2.0.1.tgz\",\"integrity\":\"sha512-ZqtSMuVybkISo2OWvqvm7iHSWngvdaW3IpsT9/uP8v4gMi591LY6h35wdOfvQdWCKFWZWm2Y1Opp4kV7vQKT6A==\",\"dev\":true,\"requires\":{\"is-finite\":\"^1.0.0\"}},\"resolve-url\":{\"version\":\"0.2.1\",\"resolved\":\"https://registry.npmmirror.com/resolve-url/-/resolve-url-0.2.1.tgz\",\"integrity\":\"sha512-ZuF55hVUQaaczgOIwqWzkEcEidmlD/xl44x1UZnhOXcYuFN2S6+rcxpG+C1N3So0wvNI3DmJICUFfu2SxhBmvg==\",\"dev\":true,\"optional\":true},\"ret\":{\"version\":\"0.1.15\",\"resolved\":\"https://registry.npmmirror.com/ret/-/ret-0.1.15.tgz\",\"integrity\":\"sha512-TTlYpa+OL+vMMNG24xSlQGEJ3B/RzEfUlLct7b5G/ytav+wPrplCpVMFuwzXbkecJrb6IYo1iFb0S9v37754mg==\",\"dev\":true,\"optional\":true},\"safe-buffer\":{\"version\":\"5.1.2\",\"resolved\":\"https://registry.npmmirror.com/safe-buffer/-/safe-buffer-5.1.2.tgz\",\"integrity\":\"sha512-Gd2UZBJDkXlY7GbJxfsE8/nvKkUEU1G38c1siN6QP6a9PT9MmHB8GnpscSmMJSoF8LOIrt8ud/wPtojys4G6+g==\",\"dev\":true,\"optional\":true},\"safe-regex\":{\"version\":\"1.1.0\",\"resolved\":\"https://registry.npmmirror.com/safe-regex/-/safe-regex-1.1.0.tgz\",\"integrity\":\"sha512-aJXcif4xnaNUzvUuC5gcb46oTS7zvg4jpMTnuqtrEPlR3vFr4pxtdTwaF1Qs3Enjn9HK+ZlwQui+a7z0SywIzg==\",\"dev\":true,\"optional\":true,\"requires\":{\"ret\":\"~0.1.10\"}},\"semver\":{\"version\":\"5.7.1\",\"resolved\":\"https://registry.npmmirror.com/semver/-/semver-5.7.1.tgz\",\"integrity\":\"sha512-sauaDf/PZdVgrLTNYHRtpXa1iRiKcaebiKQ1BJdpQlWH2lCvexQdX55snPFyK7QzpudqbCI0qXFfOasHdyNDGQ==\",\"dev\":true},\"set-value\":{\"version\":\"2.0.1\",\"resolved\":\"https://registry.npmmirror.com/set-value/-/set-value-2.0.1.tgz\",\"integrity\":\"sha512-JxHc1weCN68wRY0fhCoXpyK55m/XPHafOmK4UWD7m2CI14GMcFypt4w/0+NV5f/ZMby2F6S2wwA7fgynh9gWSw==\",\"dev\":true,\"optional\":true,\"requires\":{\"extend-shallow\":\"^2.0.1\",\"is-extendable\":\"^0.1.1\",\"is-plain-object\":\"^2.0.3\",\"split-string\":\"^3.0.1\"},\"dependencies\":{\"extend-shallow\":{\"version\":\"2.0.1\",\"resolved\":\"https://registry.npmmirror.com/extend-shallow/-/extend-shallow-2.0.1.tgz\",\"integrity\":\"sha512-zCnTtlxNoAiDc3gqY2aYAWFx7XWWiasuF2K8Me5WbN8otHKTUKBwjPtNpRs/rbUZm7KxWAaNj7P1a/p52GbVug==\",\"dev\":true,\"optional\":true,\"requires\":{\"is-extendable\":\"^0.1.0\"}}}},\"slash\":{\"version\":\"1.0.0\",\"resolved\":\"https://registry.npmmirror.com/slash/-/slash-1.0.0.tgz\",\"integrity\":\"sha512-3TYDR7xWt4dIqV2JauJr+EJeW356RXijHeUlO+8djJ+uBXPn8/2dpzBc8yQhh583sVvc9CvFAeQVgijsH+PNNg==\",\"dev\":true},\"snapdragon\":{\"version\":\"0.8.2\",\"resolved\":\"https://registry.npmmirror.com/snapdragon/-/snapdragon-0.8.2.tgz\",\"integrity\":\"sha512-FtyOnWN/wCHTVXOMwvSv26d+ko5vWlIDD6zoUJ7LW8vh+ZBC8QdljveRP+crNrtBwioEUWy/4dMtbBjA4ioNlg==\",\"dev\":true,\"optional\":true,\"requires\":{\"base\":\"^0.11.1\",\"debug\":\"^2.2.0\",\"define-property\":\"^0.2.5\",\"extend-shallow\":\"^2.0.1\",\"map-cache\":\"^0.2.2\",\"source-map\":\"^0.5.6\",\"source-map-resolve\":\"^0.5.0\",\"use\":\"^3.1.0\"},\"dependencies\":{\"define-property\":{\"version\":\"0.2.5\",\"resolved\":\"https://registry.npmmirror.com/define-property/-/define-property-0.2.5.tgz\",\"integrity\":\"sha512-Rr7ADjQZenceVOAKop6ALkkRAmH1A4Gx9hV/7ZujPUN2rkATqFO0JZLZInbAjpZYoJ1gUx8MRMQVkYemcbMSTA==\",\"dev\":true,\"optional\":true,\"requires\":{\"is-descriptor\":\"^0.1.0\"}},\"extend-shallow\":{\"version\":\"2.0.1\",\"resolved\":\"https://registry.npmmirror.com/extend-shallow/-/extend-shallow-2.0.1.tgz\",\"integrity\":\"sha512-zCnTtlxNoAiDc3gqY2aYAWFx7XWWiasuF2K8Me5WbN8otHKTUKBwjPtNpRs/rbUZm7KxWAaNj7P1a/p52GbVug==\",\"dev\":true,\"optional\":true,\"requires\":{\"is-extendable\":\"^0.1.0\"}}}},\"snapdragon-node\":{\"version\":\"2.1.1\",\"resolved\":\"https://registry.npmmirror.com/snapdragon-node/-/snapdragon-node-2.1.1.tgz\",\"integrity\":\"sha512-O27l4xaMYt/RSQ5TR3vpWCAB5Kb/czIcqUFOM/C4fYcLnbZUc1PkjTAMjof2pBWaSTwOUd6qUHcFGVGj7aIwnw==\",\"dev\":true,\"optional\":true,\"requires\":{\"define-property\":\"^1.0.0\",\"isobject\":\"^3.0.0\",\"snapdragon-util\":\"^3.0.1\"},\"dependencies\":{\"define-property\":{\"version\":\"1.0.0\",\"resolved\":\"https://registry.npmmirror.com/define-property/-/define-property-1.0.0.tgz\",\"integrity\":\"sha512-cZTYKFWspt9jZsMscWo8sc/5lbPC9Q0N5nBLgb+Yd915iL3udB1uFgS3B8YCx66UVHq018DAVFoee7x+gxggeA==\",\"dev\":true,\"optional\":true,\"requires\":{\"is-descriptor\":\"^1.0.0\"}},\"is-accessor-descriptor\":{\"version\":\"1.0.0\",\"resolved\":\"https://registry.npmmirror.com/is-accessor-descriptor/-/is-accessor-descriptor-1.0.0.tgz\",\"integrity\":\"sha512-m5hnHTkcVsPfqx3AKlyttIPb7J+XykHvJP2B9bZDjlhLIoEq4XoK64Vg7boZlVWYK6LUY94dYPEE7Lh0ZkZKcQ==\",\"dev\":true,\"optional\":true,\"requires\":{\"kind-of\":\"^6.0.0\"}},\"is-data-descriptor\":{\"version\":\"1.0.0\",\"resolved\":\"https://registry.npmmirror.com/is-data-descriptor/-/is-data-descriptor-1.0.0.tgz\",\"integrity\":\"sha512-jbRXy1FmtAoCjQkVmIVYwuuqDFUbaOeDjmed1tOGPrsMhtJA4rD9tkgA0F1qJ3gRFRXcHYVkdeaP50Q5rE/jLQ==\",\"dev\":true,\"optional\":true,\"requires\":{\"kind-of\":\"^6.0.0\"}},\"is-descriptor\":{\"version\":\"1.0.2\",\"resolved\":\"https://registry.npmmirror.com/is-descriptor/-/is-descriptor-1.0.2.tgz\",\"integrity\":\"sha512-2eis5WqQGV7peooDyLmNEPUrps9+SXX5c9pL3xEB+4e9HnGuDa7mB7kHxHw4CbqS9k1T2hOH3miL8n8WtiYVtg==\",\"dev\":true,\"optional\":true,\"requires\":{\"is-accessor-descriptor\":\"^1.0.0\",\"is-data-descriptor\":\"^1.0.0\",\"kind-of\":\"^6.0.2\"}},\"isobject\":{\"version\":\"3.0.1\",\"resolved\":\"https://registry.npmmirror.com/isobject/-/isobject-3.0.1.tgz\",\"integrity\":\"sha512-WhB9zCku7EGTj/HQQRz5aUQEUeoQZH2bWcltRErOpymJ4boYE6wL9Tbr23krRPSZ+C5zqNSrSw+Cc7sZZ4b7vg==\",\"dev\":true,\"optional\":true},\"kind-of\":{\"version\":\"6.0.3\",\"resolved\":\"https://registry.npmmirror.com/kind-of/-/kind-of-6.0.3.tgz\",\"integrity\":\"sha512-dcS1ul+9tmeD95T+x28/ehLgd9mENa3LsvDTtzm3vyBEO7RPptvAD+t44WVXaUjTBRcrpFeFlC8WCruUR456hw==\",\"dev\":true,\"optional\":true}}},\"snapdragon-util\":{\"version\":\"3.0.1\",\"resolved\":\"https://registry.npmmirror.com/snapdragon-util/-/snapdragon-util-3.0.1.tgz\",\"integrity\":\"sha512-mbKkMdQKsjX4BAL4bRYTj21edOf8cN7XHdYUJEe+Zn99hVEYcMvKPct1IqNe7+AZPirn8BCDOQBHQZknqmKlZQ==\",\"dev\":true,\"optional\":true,\"requires\":{\"kind-of\":\"^3.2.0\"}},\"source-map\":{\"version\":\"0.5.7\",\"resolved\":\"https://registry.npmmirror.com/source-map/-/source-map-0.5.7.tgz\",\"integrity\":\"sha512-LbrmJOMUSdEVxIKvdcJzQC+nQhe8FUZQTXQy6+I75skNgn3OoQ0DZA8YnFa7gp8tqtL3KPf1kmo0R5DoApeSGQ==\",\"dev\":true},\"source-map-resolve\":{\"version\":\"0.5.3\",\"resolved\":\"https://registry.npmmirror.com/source-map-resolve/-/source-map-resolve-0.5.3.tgz\",\"integrity\":\"sha512-Htz+RnsXWk5+P2slx5Jh3Q66vhQj1Cllm0zvnaY98+NFx+Dv2CF/f5O/t8x+KaNdrdIAsruNzoh/KpialbqAnw==\",\"dev\":true,\"optional\":true,\"requires\":{\"atob\":\"^2.1.2\",\"decode-uri-component\":\"^0.2.0\",\"resolve-url\":\"^0.2.1\",\"source-map-url\":\"^0.4.0\",\"urix\":\"^0.1.0\"}},\"source-map-support\":{\"version\":\"0.4.18\",\"resolved\":\"https://registry.npmmirror.com/source-map-support/-/source-map-support-0.4.18.tgz\",\"integrity\":\"sha512-try0/JqxPLF9nOjvSta7tVondkP5dwgyLDjVoyMDlmjugT2lRZ1OfsrYTkCd2hkDnJTKRbO/Rl3orm8vlsUzbA==\",\"dev\":true,\"requires\":{\"source-map\":\"^0.5.6\"}},\"source-map-url\":{\"version\":\"0.4.1\",\"resolved\":\"https://registry.npmmirror.com/source-map-url/-/source-map-url-0.4.1.tgz\",\"integrity\":\"sha512-cPiFOTLUKvJFIg4SKVScy4ilPPW6rFgMgfuZJPNoDuMs3nC1HbMUycBoJw77xFIp6z1UJQJOfx6C9GMH80DiTw==\",\"dev\":true,\"optional\":true},\"split-string\":{\"version\":\"3.1.0\",\"resolved\":\"https://registry.npmmirror.com/split-string/-/split-string-3.1.0.tgz\",\"integrity\":\"sha512-NzNVhJDYpwceVVii8/Hu6DKfD2G+NrQHlS/V/qgv763EYudVwEcMQNxd2lh+0VrUByXN/oJkl5grOhYWvQUYiw==\",\"dev\":true,\"optional\":true,\"requires\":{\"extend-shallow\":\"^3.0.0\"}},\"static-extend\":{\"version\":\"0.1.2\",\"resolved\":\"https://registry.npmmirror.com/static-extend/-/static-extend-0.1.2.tgz\",\"integrity\":\"sha512-72E9+uLc27Mt718pMHt9VMNiAL4LMsmDbBva8mxWUCkT07fSzEGMYUCk0XWY6lp0j6RBAG4cJ3mWuZv2OE3s0g==\",\"dev\":true,\"optional\":true,\"requires\":{\"define-property\":\"^0.2.5\",\"object-copy\":\"^0.1.0\"},\"dependencies\":{\"define-property\":{\"version\":\"0.2.5\",\"resolved\":\"https://registry.npmmirror.com/define-property/-/define-property-0.2.5.tgz\",\"integrity\":\"sha512-Rr7ADjQZenceVOAKop6ALkkRAmH1A4Gx9hV/7ZujPUN2rkATqFO0JZLZInbAjpZYoJ1gUx8MRMQVkYemcbMSTA==\",\"dev\":true,\"optional\":true,\"requires\":{\"is-descriptor\":\"^0.1.0\"}}}},\"string_decoder\":{\"version\":\"1.1.1\",\"resolved\":\"https://registry.npmmirror.com/string_decoder/-/string_decoder-1.1.1.tgz\",\"integrity\":\"sha512-n/ShnvDi6FHbbVfviro+WojiFzv+s8MPMHBczVePfUpDJLwoLT0ht1l4YwBCbi8pJAveEEdnkHyPyTP/mzRfwg==\",\"dev\":true,\"optional\":true,\"requires\":{\"safe-buffer\":\"~5.1.0\"}},\"strip-ansi\":{\"version\":\"3.0.1\",\"resolved\":\"https://registry.npmmirror.com/strip-ansi/-/strip-ansi-3.0.1.tgz\",\"integrity\":\"sha512-VhumSSbBqDTP8p2ZLKj40UjBCV4+v8bUSEpUb4KjRgWk9pbqGF4REFj6KEagidb2f/M6AzC0EmFyDNGaw9OCzg==\",\"dev\":true,\"requires\":{\"ansi-regex\":\"^2.0.0\"}},\"supports-color\":{\"version\":\"2.0.0\",\"resolved\":\"https://registry.npmmirror.com/supports-color/-/supports-color-2.0.0.tgz\",\"integrity\":\"sha512-KKNVtd6pCYgPIKU4cp2733HWYCpplQhddZLBUryaAHou723x+FRzQ5Df824Fj+IyyuiQTRoub4SnIFfIcrp70g==\",\"dev\":true},\"to-fast-properties\":{\"version\":\"1.0.3\",\"resolved\":\"https://registry.npmmirror.com/to-fast-properties/-/to-fast-properties-1.0.3.tgz\",\"integrity\":\"sha512-lxrWP8ejsq+7E3nNjwYmUBMAgjMTZoTI+sdBOpvNyijeDLa29LUn9QaoXAHv4+Z578hbmHHJKZknzxVtvo77og==\",\"dev\":true},\"to-object-path\":{\"version\":\"0.3.0\",\"resolved\":\"https://registry.npmmirror.com/to-object-path/-/to-object-path-0.3.0.tgz\",\"integrity\":\"sha512-9mWHdnGRuh3onocaHzukyvCZhzvr6tiflAy/JRFXcJX0TjgfWA9pk9t8CMbzmBE4Jfw58pXbkngtBtqYxzNEyg==\",\"dev\":true,\"optional\":true,\"requires\":{\"kind-of\":\"^3.0.2\"}},\"to-regex\":{\"version\":\"3.0.2\",\"resolved\":\"https://registry.npmmirror.com/to-regex/-/to-regex-3.0.2.tgz\",\"integrity\":\"sha512-FWtleNAtZ/Ki2qtqej2CXTOayOH9bHDQF+Q48VpWyDXjbYxA4Yz8iDB31zXOBUlOHHKidDbqGVrTUvQMPmBGBw==\",\"dev\":true,\"optional\":true,\"requires\":{\"define-property\":\"^2.0.2\",\"extend-shallow\":\"^3.0.2\",\"regex-not\":\"^1.0.2\",\"safe-regex\":\"^1.1.0\"}},\"to-regex-range\":{\"version\":\"2.1.1\",\"resolved\":\"https://registry.npmmirror.com/to-regex-range/-/to-regex-range-2.1.1.tgz\",\"integrity\":\"sha512-ZZWNfCjUokXXDGXFpZehJIkZqq91BcULFq/Pi7M5i4JnxXdhMKAK682z8bCW3o8Hj1wuuzoKcW3DfVzaP6VuNg==\",\"dev\":true,\"optional\":true,\"requires\":{\"is-number\":\"^3.0.0\",\"repeat-string\":\"^1.6.1\"},\"dependencies\":{\"is-number\":{\"version\":\"3.0.0\",\"resolved\":\"https://registry.npmmirror.com/is-number/-/is-number-3.0.0.tgz\",\"integrity\":\"sha512-4cboCqIpliH+mAvFNegjZQ4kgKc3ZUhQVr3HvWbSh5q3WH2v82ct+T2Y1hdU5Gdtorx/cLifQjqCbL7bpznLTg==\",\"dev\":true,\"optional\":true,\"requires\":{\"kind-of\":\"^3.0.2\"}}}},\"trim-right\":{\"version\":\"1.0.1\",\"resolved\":\"https://registry.npmmirror.com/trim-right/-/trim-right-1.0.1.tgz\",\"integrity\":\"sha512-WZGXGstmCWgeevgTL54hrCuw1dyMQIzWy7ZfqRJfSmJZBwklI15egmQytFP6bPidmw3M8d5yEowl1niq4vmqZw==\",\"dev\":true},\"union-value\":{\"version\":\"1.0.1\",\"resolved\":\"https://registry.npmmirror.com/union-value/-/union-value-1.0.1.tgz\",\"integrity\":\"sha512-tJfXmxMeWYnczCVs7XAEvIV7ieppALdyepWMkHkwciRpZraG/xwT+s2JN8+pr1+8jCRf80FFzvr+MpQeeoF4Xg==\",\"dev\":true,\"optional\":true,\"requires\":{\"arr-union\":\"^3.1.0\",\"get-value\":\"^2.0.6\",\"is-extendable\":\"^0.1.1\",\"set-value\":\"^2.0.1\"}},\"unset-value\":{\"version\":\"1.0.0\",\"resolved\":\"https://registry.npmmirror.com/unset-value/-/unset-value-1.0.0.tgz\",\"integrity\":\"sha512-PcA2tsuGSF9cnySLHTLSh2qrQiJ70mn+r+Glzxv2TWZblxsxCC52BDlZoPCsz7STd9pN7EZetkWZBAvk4cgZdQ==\",\"dev\":true,\"optional\":true,\"requires\":{\"has-value\":\"^0.3.1\",\"isobject\":\"^3.0.0\"},\"dependencies\":{\"has-value\":{\"version\":\"0.3.1\",\"resolved\":\"https://registry.npmmirror.com/has-value/-/has-value-0.3.1.tgz\",\"integrity\":\"sha512-gpG936j8/MzaeID5Yif+577c17TxaDmhuyVgSwtnL/q8UUTySg8Mecb+8Cf1otgLoD7DDH75axp86ER7LFsf3Q==\",\"dev\":true,\"optional\":true,\"requires\":{\"get-value\":\"^2.0.3\",\"has-values\":\"^0.1.4\",\"isobject\":\"^2.0.0\"},\"dependencies\":{\"isobject\":{\"version\":\"2.1.0\",\"resolved\":\"https://registry.npmmirror.com/isobject/-/isobject-2.1.0.tgz\",\"integrity\":\"sha512-+OUdGJlgjOBZDfxnDjYYG6zp487z0JGNQq3cYQYg5f5hKR+syHMsaztzGeml/4kGG55CSpKSpWTY+jYGgsHLgA==\",\"dev\":true,\"optional\":true,\"requires\":{\"isarray\":\"1.0.0\"}}}},\"has-values\":{\"version\":\"0.1.4\",\"resolved\":\"https://registry.npmmirror.com/has-values/-/has-values-0.1.4.tgz\",\"integrity\":\"sha512-J8S0cEdWuQbqD9//tlZxiMuMNmxB8PlEwvYwuxsTmR1G5RXUePEX/SJn7aD0GMLieuZYSwNH0cQuJGwnYunXRQ==\",\"dev\":true,\"optional\":true},\"isobject\":{\"version\":\"3.0.1\",\"resolved\":\"https://registry.npmmirror.com/isobject/-/isobject-3.0.1.tgz\",\"integrity\":\"sha512-WhB9zCku7EGTj/HQQRz5aUQEUeoQZH2bWcltRErOpymJ4boYE6wL9Tbr23krRPSZ+C5zqNSrSw+Cc7sZZ4b7vg==\",\"dev\":true,\"optional\":true}}},\"urix\":{\"version\":\"0.1.0\",\"resolved\":\"https://registry.npmmirror.com/urix/-/urix-0.1.0.tgz\",\"integrity\":\"sha512-Am1ousAhSLBeB9cG/7k7r2R0zj50uDRlZHPGbazid5s9rlF1F/QKYObEKSIunSjIOkJZqwRRLpvewjEkM7pSqg==\",\"dev\":true,\"optional\":true},\"use\":{\"version\":\"3.1.1\",\"resolved\":\"https://registry.npmmirror.com/use/-/use-3.1.1.tgz\",\"integrity\":\"sha512-cwESVXlO3url9YWlFW/TA9cshCEhtu7IKJ/p5soJ/gGpj7vbvFrAY/eIioQ6Dw23KjZhYgiIo8HOs1nQ2vr/oQ==\",\"dev\":true,\"optional\":true},\"user-home\":{\"version\":\"1.1.1\",\"resolved\":\"https://registry.npmmirror.com/user-home/-/user-home-1.1.1.tgz\",\"integrity\":\"sha512-aggiKfEEubv3UwRNqTzLInZpAOmKzwdHqEBmW/hBA/mt99eg+b4VrX6i+IRLxU8+WJYfa33rGwRseg4eElUgsQ==\",\"dev\":true},\"util-deprecate\":{\"version\":\"1.0.2\",\"resolved\":\"https://registry.npmmirror.com/util-deprecate/-/util-deprecate-1.0.2.tgz\",\"integrity\":\"sha512-EPD5q1uXyFxJpCrLnCc1nHnq3gOa6DZBocAIiI2TaSCA7VCJ1UJDMagCzIkXNsUYfD1daK//LTEQ8xiIbrHtcw==\",\"dev\":true,\"optional\":true},\"v8flags\":{\"version\":\"2.1.1\",\"resolved\":\"https://registry.npmmirror.com/v8flags/-/v8flags-2.1.1.tgz\",\"integrity\":\"sha512-SKfhk/LlaXzvtowJabLZwD4K6SGRYeoxA7KJeISlUMAB/NT4CBkZjMq3WceX2Ckm4llwqYVo8TICgsDYCBU2tA==\",\"dev\":true,\"requires\":{\"user-home\":\"^1.1.1\"}},\"wrappy\":{\"version\":\"1.0.2\",\"resolved\":\"https://registry.npmmirror.com/wrappy/-/wrappy-1.0.2.tgz\",\"integrity\":\"sha512-l4Sp/DRseor9wL6EvV2+TuQn63dMkPjZ/sp9XkghTEbV9KlPS1xUsZ3u7/IQO4wxtcFB4bgpQPRcR3QCvezPcQ==\",\"dev\":true}}}","site":{"data":{}},"wordcount":91640,"excerpt":"","more":"{\"name\":\"module\",\"version\":\"1.0.0\",\"lockfileVersion\":1,\"requires\":true,\"dependencies\":{\"ansi-regex\":{\"version\":\"2.1.1\",\"resolved\":\"https://registry.npmmirror.com/ansi-regex/-/ansi-regex-2.1.1.tgz\",\"integrity\":\"sha512-TIGnTpdo+E3+pCyAluZvtED5p5wCqLdezCyhPZzKPcxvFplEt4i+W7OONCKgeZFT3+y5NZZfOOS/Bdcanm1MYA==\",\"dev\":true},\"ansi-styles\":{\"version\":\"2.2.1\",\"resolved\":\"https://registry.npmmirror.com/ansi-styles/-/ansi-styles-2.2.1.tgz\",\"integrity\":\"sha512-kmCevFghRiWM7HB5zTPULl4r9bVFSWjz62MhqizDGUrq2NWuNMQyuv4tHHoKJHs69M/MF64lEcHdYIocrdWQYA==\",\"dev\":true},\"anymatch\":{\"version\":\"1.3.2\",\"resolved\":\"https://registry.npmmirror.com/anymatch/-/anymatch-1.3.2.tgz\",\"integrity\":\"sha512-0XNayC8lTHQ2OI8aljNCN3sSx6hsr/1+rlcDAotXJR7C1oZZHCNsfpbKwMjRA3Uqb5tF1Rae2oloTr4xpq+WjA==\",\"dev\":true,\"optional\":true,\"requires\":{\"micromatch\":\"^2.1.5\",\"normalize-path\":\"^2.0.0\"}},\"arr-diff\":{\"version\":\"2.0.0\",\"resolved\":\"https://registry.npmmirror.com/arr-diff/-/arr-diff-2.0.0.tgz\",\"integrity\":\"sha512-dtXTVMkh6VkEEA7OhXnN1Ecb8aAGFdZ1LFxtOCoqj4qkyOJMt7+qs6Ahdy6p/NQCPYsRSXXivhSB/J5E9jmYKA==\",\"dev\":true,\"optional\":true,\"requires\":{\"arr-flatten\":\"^1.0.1\"}},\"arr-flatten\":{\"version\":\"1.1.0\",\"resolved\":\"https://registry.npmmirror.com/arr-flatten/-/arr-flatten-1.1.0.tgz\",\"integrity\":\"sha512-L3hKV5R/p5o81R7O02IGnwpDmkp6E982XhtbuwSe3O4qOtMMMtodicASA1Cny2U+aCXcNpml+m4dPsvsJ3jatg==\",\"dev\":true,\"optional\":true},\"arr-union\":{\"version\":\"3.1.0\",\"resolved\":\"https://registry.npmmirror.com/arr-union/-/arr-union-3.1.0.tgz\",\"integrity\":\"sha512-sKpyeERZ02v1FeCZT8lrfJq5u6goHCtpTAzPwJYe7c8SPFOboNjNg1vz2L4VTn9T4PQxEx13TbXLmYUcS6Ug7Q==\",\"dev\":true,\"optional\":true},\"array-unique\":{\"version\":\"0.2.1\",\"resolved\":\"https://registry.npmmirror.com/array-unique/-/array-unique-0.2.1.tgz\",\"integrity\":\"sha512-G2n5bG5fSUCpnsXz4+8FUkYsGPkNfLn9YvS66U5qbTIXI2Ynnlo4Bi42bWv+omKUCqz+ejzfClwne0alJWJPhg==\",\"dev\":true,\"optional\":true},\"assign-symbols\":{\"version\":\"1.0.0\",\"resolved\":\"https://registry.npmmirror.com/assign-symbols/-/assign-symbols-1.0.0.tgz\",\"integrity\":\"sha512-Q+JC7Whu8HhmTdBph/Tq59IoRtoy6KAm5zzPv00WdujX82lbAL8K7WVjne7vdCsAmbF4AYaDOPyO3k0kl8qIrw==\",\"dev\":true,\"optional\":true},\"async-each\":{\"version\":\"1.0.6\",\"resolved\":\"https://registry.npmmirror.com/async-each/-/async-each-1.0.6.tgz\",\"integrity\":\"sha512-c646jH1avxr+aVpndVMeAfYw7wAa6idufrlN3LPA4PmKS0QEGp6PIC9nwz0WQkkvBGAMEki3pFdtxaF39J9vvg==\",\"dev\":true,\"optional\":true},\"atob\":{\"version\":\"2.1.2\",\"resolved\":\"https://registry.npmmirror.com/atob/-/atob-2.1.2.tgz\",\"integrity\":\"sha512-Wm6ukoaOGJi/73p/cl2GvLjTI5JM1k/O14isD73YML8StrH/7/lRFgmg8nICZgD3bZZvjwCGxtMOD3wWNAu8cg==\",\"dev\":true,\"optional\":true},\"babel-cli\":{\"version\":\"6.26.0\",\"resolved\":\"https://registry.npmmirror.com/babel-cli/-/babel-cli-6.26.0.tgz\",\"integrity\":\"sha512-wau+BDtQfuSBGQ9PzzFL3REvR9Sxnd4LKwtcHAiPjhugA7K/80vpHXafj+O5bAqJOuSefjOx5ZJnNSR2J1Qw6Q==\",\"dev\":true,\"requires\":{\"babel-core\":\"^6.26.0\",\"babel-polyfill\":\"^6.26.0\",\"babel-register\":\"^6.26.0\",\"babel-runtime\":\"^6.26.0\",\"chokidar\":\"^1.6.1\",\"commander\":\"^2.11.0\",\"convert-source-map\":\"^1.5.0\",\"fs-readdir-recursive\":\"^1.0.0\",\"glob\":\"^7.1.2\",\"lodash\":\"^4.17.4\",\"output-file-sync\":\"^1.1.2\",\"path-is-absolute\":\"^1.0.1\",\"slash\":\"^1.0.0\",\"source-map\":\"^0.5.6\",\"v8flags\":\"^2.1.1\"}},\"babel-code-frame\":{\"version\":\"6.26.0\",\"resolved\":\"https://registry.npmmirror.com/babel-code-frame/-/babel-code-frame-6.26.0.tgz\",\"integrity\":\"sha512-XqYMR2dfdGMW+hd0IUZ2PwK+fGeFkOxZJ0wY+JaQAHzt1Zx8LcvpiZD2NiGkEG8qx0CfkAOr5xt76d1e8vG90g==\",\"dev\":true,\"requires\":{\"chalk\":\"^1.1.3\",\"esutils\":\"^2.0.2\",\"js-tokens\":\"^3.0.2\"}},\"babel-core\":{\"version\":\"6.26.3\",\"resolved\":\"https://registry.npmmirror.com/babel-core/-/babel-core-6.26.3.tgz\",\"integrity\":\"sha512-6jyFLuDmeidKmUEb3NM+/yawG0M2bDZ9Z1qbZP59cyHLz8kYGKYwpJP0UwUKKUiTRNvxfLesJnTedqczP7cTDA==\",\"dev\":true,\"requires\":{\"babel-code-frame\":\"^6.26.0\",\"babel-generator\":\"^6.26.0\",\"babel-helpers\":\"^6.24.1\",\"babel-messages\":\"^6.23.0\",\"babel-register\":\"^6.26.0\",\"babel-runtime\":\"^6.26.0\",\"babel-template\":\"^6.26.0\",\"babel-traverse\":\"^6.26.0\",\"babel-types\":\"^6.26.0\",\"babylon\":\"^6.18.0\",\"convert-source-map\":\"^1.5.1\",\"debug\":\"^2.6.9\",\"json5\":\"^0.5.1\",\"lodash\":\"^4.17.4\",\"minimatch\":\"^3.0.4\",\"path-is-absolute\":\"^1.0.1\",\"private\":\"^0.1.8\",\"slash\":\"^1.0.0\",\"source-map\":\"^0.5.7\"}},\"babel-generator\":{\"version\":\"6.26.1\",\"resolved\":\"https://registry.npmmirror.com/babel-generator/-/babel-generator-6.26.1.tgz\",\"integrity\":\"sha512-HyfwY6ApZj7BYTcJURpM5tznulaBvyio7/0d4zFOeMPUmfxkCjHocCuoLa2SAGzBI8AREcH3eP3758F672DppA==\",\"dev\":true,\"requires\":{\"babel-messages\":\"^6.23.0\",\"babel-runtime\":\"^6.26.0\",\"babel-types\":\"^6.26.0\",\"detect-indent\":\"^4.0.0\",\"jsesc\":\"^1.3.0\",\"lodash\":\"^4.17.4\",\"source-map\":\"^0.5.7\",\"trim-right\":\"^1.0.1\"}},\"babel-helper-builder-binary-assignment-operator-visitor\":{\"version\":\"6.24.1\",\"resolved\":\"https://registry.npmmirror.com/babel-helper-builder-binary-assignment-operator-visitor/-/babel-helper-builder-binary-assignment-operator-visitor-6.24.1.tgz\",\"integrity\":\"sha512-gCtfYORSG1fUMX4kKraymq607FWgMWg+j42IFPc18kFQEsmtaibP4UrqsXt8FlEJle25HUd4tsoDR7H2wDhe9Q==\",\"dev\":true,\"requires\":{\"babel-helper-explode-assignable-expression\":\"^6.24.1\",\"babel-runtime\":\"^6.22.0\",\"babel-types\":\"^6.24.1\"}},\"babel-helper-call-delegate\":{\"version\":\"6.24.1\",\"resolved\":\"https://registry.npmmirror.com/babel-helper-call-delegate/-/babel-helper-call-delegate-6.24.1.tgz\",\"integrity\":\"sha512-RL8n2NiEj+kKztlrVJM9JT1cXzzAdvWFh76xh/H1I4nKwunzE4INBXn8ieCZ+wh4zWszZk7NBS1s/8HR5jDkzQ==\",\"dev\":true,\"requires\":{\"babel-helper-hoist-variables\":\"^6.24.1\",\"babel-runtime\":\"^6.22.0\",\"babel-traverse\":\"^6.24.1\",\"babel-types\":\"^6.24.1\"}},\"babel-helper-define-map\":{\"version\":\"6.26.0\",\"resolved\":\"https://registry.npmmirror.com/babel-helper-define-map/-/babel-helper-define-map-6.26.0.tgz\",\"integrity\":\"sha512-bHkmjcC9lM1kmZcVpA5t2om2nzT/xiZpo6TJq7UlZ3wqKfzia4veeXbIhKvJXAMzhhEBd3cR1IElL5AenWEUpA==\",\"dev\":true,\"requires\":{\"babel-helper-function-name\":\"^6.24.1\",\"babel-runtime\":\"^6.26.0\",\"babel-types\":\"^6.26.0\",\"lodash\":\"^4.17.4\"}},\"babel-helper-explode-assignable-expression\":{\"version\":\"6.24.1\",\"resolved\":\"https://registry.npmmirror.com/babel-helper-explode-assignable-expression/-/babel-helper-explode-assignable-expression-6.24.1.tgz\",\"integrity\":\"sha512-qe5csbhbvq6ccry9G7tkXbzNtcDiH4r51rrPUbwwoTzZ18AqxWYRZT6AOmxrpxKnQBW0pYlBI/8vh73Z//78nQ==\",\"dev\":true,\"requires\":{\"babel-runtime\":\"^6.22.0\",\"babel-traverse\":\"^6.24.1\",\"babel-types\":\"^6.24.1\"}},\"babel-helper-function-name\":{\"version\":\"6.24.1\",\"resolved\":\"https://registry.npmmirror.com/babel-helper-function-name/-/babel-helper-function-name-6.24.1.tgz\",\"integrity\":\"sha512-Oo6+e2iX+o9eVvJ9Y5eKL5iryeRdsIkwRYheCuhYdVHsdEQysbc2z2QkqCLIYnNxkT5Ss3ggrHdXiDI7Dhrn4Q==\",\"dev\":true,\"requires\":{\"babel-helper-get-function-arity\":\"^6.24.1\",\"babel-runtime\":\"^6.22.0\",\"babel-template\":\"^6.24.1\",\"babel-traverse\":\"^6.24.1\",\"babel-types\":\"^6.24.1\"}},\"babel-helper-get-function-arity\":{\"version\":\"6.24.1\",\"resolved\":\"https://registry.npmmirror.com/babel-helper-get-function-arity/-/babel-helper-get-function-arity-6.24.1.tgz\",\"integrity\":\"sha512-WfgKFX6swFB1jS2vo+DwivRN4NB8XUdM3ij0Y1gnC21y1tdBoe6xjVnd7NSI6alv+gZXCtJqvrTeMW3fR/c0ng==\",\"dev\":true,\"requires\":{\"babel-runtime\":\"^6.22.0\",\"babel-types\":\"^6.24.1\"}},\"babel-helper-hoist-variables\":{\"version\":\"6.24.1\",\"resolved\":\"https://registry.npmmirror.com/babel-helper-hoist-variables/-/babel-helper-hoist-variables-6.24.1.tgz\",\"integrity\":\"sha512-zAYl3tqerLItvG5cKYw7f1SpvIxS9zi7ohyGHaI9cgDUjAT6YcY9jIEH5CstetP5wHIVSceXwNS7Z5BpJg+rOw==\",\"dev\":true,\"requires\":{\"babel-runtime\":\"^6.22.0\",\"babel-types\":\"^6.24.1\"}},\"babel-helper-optimise-call-expression\":{\"version\":\"6.24.1\",\"resolved\":\"https://registry.npmmirror.com/babel-helper-optimise-call-expression/-/babel-helper-optimise-call-expression-6.24.1.tgz\",\"integrity\":\"sha512-Op9IhEaxhbRT8MDXx2iNuMgciu2V8lDvYCNQbDGjdBNCjaMvyLf4wl4A3b8IgndCyQF8TwfgsQ8T3VD8aX1/pA==\",\"dev\":true,\"requires\":{\"babel-runtime\":\"^6.22.0\",\"babel-types\":\"^6.24.1\"}},\"babel-helper-regex\":{\"version\":\"6.26.0\",\"resolved\":\"https://registry.npmmirror.com/babel-helper-regex/-/babel-helper-regex-6.26.0.tgz\",\"integrity\":\"sha512-VlPiWmqmGJp0x0oK27Out1D+71nVVCTSdlbhIVoaBAj2lUgrNjBCRR9+llO4lTSb2O4r7PJg+RobRkhBrf6ofg==\",\"dev\":true,\"requires\":{\"babel-runtime\":\"^6.26.0\",\"babel-types\":\"^6.26.0\",\"lodash\":\"^4.17.4\"}},\"babel-helper-remap-async-to-generator\":{\"version\":\"6.24.1\",\"resolved\":\"https://registry.npmmirror.com/babel-helper-remap-async-to-generator/-/babel-helper-remap-async-to-generator-6.24.1.tgz\",\"integrity\":\"sha512-RYqaPD0mQyQIFRu7Ho5wE2yvA/5jxqCIj/Lv4BXNq23mHYu/vxikOy2JueLiBxQknwapwrJeNCesvY0ZcfnlHg==\",\"dev\":true,\"requires\":{\"babel-helper-function-name\":\"^6.24.1\",\"babel-runtime\":\"^6.22.0\",\"babel-template\":\"^6.24.1\",\"babel-traverse\":\"^6.24.1\",\"babel-types\":\"^6.24.1\"}},\"babel-helper-replace-supers\":{\"version\":\"6.24.1\",\"resolved\":\"https://registry.npmmirror.com/babel-helper-replace-supers/-/babel-helper-replace-supers-6.24.1.tgz\",\"integrity\":\"sha512-sLI+u7sXJh6+ToqDr57Bv973kCepItDhMou0xCP2YPVmR1jkHSCY+p1no8xErbV1Siz5QE8qKT1WIwybSWlqjw==\",\"dev\":true,\"requires\":{\"babel-helper-optimise-call-expression\":\"^6.24.1\",\"babel-messages\":\"^6.23.0\",\"babel-runtime\":\"^6.22.0\",\"babel-template\":\"^6.24.1\",\"babel-traverse\":\"^6.24.1\",\"babel-types\":\"^6.24.1\"}},\"babel-helpers\":{\"version\":\"6.24.1\",\"resolved\":\"https://registry.npmmirror.com/babel-helpers/-/babel-helpers-6.24.1.tgz\",\"integrity\":\"sha512-n7pFrqQm44TCYvrCDb0MqabAF+JUBq+ijBvNMUxpkLjJaAu32faIexewMumrH5KLLJ1HDyT0PTEqRyAe/GwwuQ==\",\"dev\":true,\"requires\":{\"babel-runtime\":\"^6.22.0\",\"babel-template\":\"^6.24.1\"}},\"babel-messages\":{\"version\":\"6.23.0\",\"resolved\":\"https://registry.npmmirror.com/babel-messages/-/babel-messages-6.23.0.tgz\",\"integrity\":\"sha512-Bl3ZiA+LjqaMtNYopA9TYE9HP1tQ+E5dLxE0XrAzcIJeK2UqF0/EaqXwBn9esd4UmTfEab+P+UYQ1GnioFIb/w==\",\"dev\":true,\"requires\":{\"babel-runtime\":\"^6.22.0\"}},\"babel-plugin-check-es2015-constants\":{\"version\":\"6.22.0\",\"resolved\":\"https://registry.npmmirror.com/babel-plugin-check-es2015-constants/-/babel-plugin-check-es2015-constants-6.22.0.tgz\",\"integrity\":\"sha512-B1M5KBP29248dViEo1owyY32lk1ZSH2DaNNrXLGt8lyjjHm7pBqAdQ7VKUPR6EEDO323+OvT3MQXbCin8ooWdA==\",\"dev\":true,\"requires\":{\"babel-runtime\":\"^6.22.0\"}},\"babel-plugin-syntax-async-functions\":{\"version\":\"6.13.0\",\"resolved\":\"https://registry.npmmirror.com/babel-plugin-syntax-async-functions/-/babel-plugin-syntax-async-functions-6.13.0.tgz\",\"integrity\":\"sha512-4Zp4unmHgw30A1eWI5EpACji2qMocisdXhAftfhXoSV9j0Tvj6nRFE3tOmRY912E0FMRm/L5xWE7MGVT2FoLnw==\",\"dev\":true},\"babel-plugin-syntax-exponentiation-operator\":{\"version\":\"6.13.0\",\"resolved\":\"https://registry.npmmirror.com/babel-plugin-syntax-exponentiation-operator/-/babel-plugin-syntax-exponentiation-operator-6.13.0.tgz\",\"integrity\":\"sha512-Z/flU+T9ta0aIEKl1tGEmN/pZiI1uXmCiGFRegKacQfEJzp7iNsKloZmyJlQr+75FCJtiFfGIK03SiCvCt9cPQ==\",\"dev\":true},\"babel-plugin-syntax-trailing-function-commas\":{\"version\":\"6.22.0\",\"resolved\":\"https://registry.npmmirror.com/babel-plugin-syntax-trailing-function-commas/-/babel-plugin-syntax-trailing-function-commas-6.22.0.tgz\",\"integrity\":\"sha512-Gx9CH3Q/3GKbhs07Bszw5fPTlU+ygrOGfAhEt7W2JICwufpC4SuO0mG0+4NykPBSYPMJhqvVlDBU17qB1D+hMQ==\",\"dev\":true},\"babel-plugin-transform-async-to-generator\":{\"version\":\"6.24.1\",\"resolved\":\"https://registry.npmmirror.com/babel-plugin-transform-async-to-generator/-/babel-plugin-transform-async-to-generator-6.24.1.tgz\",\"integrity\":\"sha512-7BgYJujNCg0Ti3x0c/DL3tStvnKS6ktIYOmo9wginv/dfZOrbSZ+qG4IRRHMBOzZ5Awb1skTiAsQXg/+IWkZYw==\",\"dev\":true,\"requires\":{\"babel-helper-remap-async-to-generator\":\"^6.24.1\",\"babel-plugin-syntax-async-functions\":\"^6.8.0\",\"babel-runtime\":\"^6.22.0\"}},\"babel-plugin-transform-es2015-arrow-functions\":{\"version\":\"6.22.0\",\"resolved\":\"https://registry.npmmirror.com/babel-plugin-transform-es2015-arrow-functions/-/babel-plugin-transform-es2015-arrow-functions-6.22.0.tgz\",\"integrity\":\"sha512-PCqwwzODXW7JMrzu+yZIaYbPQSKjDTAsNNlK2l5Gg9g4rz2VzLnZsStvp/3c46GfXpwkyufb3NCyG9+50FF1Vg==\",\"dev\":true,\"requires\":{\"babel-runtime\":\"^6.22.0\"}},\"babel-plugin-transform-es2015-block-scoped-functions\":{\"version\":\"6.22.0\",\"resolved\":\"https://registry.npmmirror.com/babel-plugin-transform-es2015-block-scoped-functions/-/babel-plugin-transform-es2015-block-scoped-functions-6.22.0.tgz\",\"integrity\":\"sha512-2+ujAT2UMBzYFm7tidUsYh+ZoIutxJ3pN9IYrF1/H6dCKtECfhmB8UkHVpyxDwkj0CYbQG35ykoz925TUnBc3A==\",\"dev\":true,\"requires\":{\"babel-runtime\":\"^6.22.0\"}},\"babel-plugin-transform-es2015-block-scoping\":{\"version\":\"6.26.0\",\"resolved\":\"https://registry.npmmirror.com/babel-plugin-transform-es2015-block-scoping/-/babel-plugin-transform-es2015-block-scoping-6.26.0.tgz\",\"integrity\":\"sha512-YiN6sFAQ5lML8JjCmr7uerS5Yc/EMbgg9G8ZNmk2E3nYX4ckHR01wrkeeMijEf5WHNK5TW0Sl0Uu3pv3EdOJWw==\",\"dev\":true,\"requires\":{\"babel-runtime\":\"^6.26.0\",\"babel-template\":\"^6.26.0\",\"babel-traverse\":\"^6.26.0\",\"babel-types\":\"^6.26.0\",\"lodash\":\"^4.17.4\"}},\"babel-plugin-transform-es2015-classes\":{\"version\":\"6.24.1\",\"resolved\":\"https://registry.npmmirror.com/babel-plugin-transform-es2015-classes/-/babel-plugin-transform-es2015-classes-6.24.1.tgz\",\"integrity\":\"sha512-5Dy7ZbRinGrNtmWpquZKZ3EGY8sDgIVB4CU8Om8q8tnMLrD/m94cKglVcHps0BCTdZ0TJeeAWOq2TK9MIY6cag==\",\"dev\":true,\"requires\":{\"babel-helper-define-map\":\"^6.24.1\",\"babel-helper-function-name\":\"^6.24.1\",\"babel-helper-optimise-call-expression\":\"^6.24.1\",\"babel-helper-replace-supers\":\"^6.24.1\",\"babel-messages\":\"^6.23.0\",\"babel-runtime\":\"^6.22.0\",\"babel-template\":\"^6.24.1\",\"babel-traverse\":\"^6.24.1\",\"babel-types\":\"^6.24.1\"}},\"babel-plugin-transform-es2015-computed-properties\":{\"version\":\"6.24.1\",\"resolved\":\"https://registry.npmmirror.com/babel-plugin-transform-es2015-computed-properties/-/babel-plugin-transform-es2015-computed-properties-6.24.1.tgz\",\"integrity\":\"sha512-C/uAv4ktFP/Hmh01gMTvYvICrKze0XVX9f2PdIXuriCSvUmV9j+u+BB9f5fJK3+878yMK6dkdcq+Ymr9mrcLzw==\",\"dev\":true,\"requires\":{\"babel-runtime\":\"^6.22.0\",\"babel-template\":\"^6.24.1\"}},\"babel-plugin-transform-es2015-destructuring\":{\"version\":\"6.23.0\",\"resolved\":\"https://registry.npmmirror.com/babel-plugin-transform-es2015-destructuring/-/babel-plugin-transform-es2015-destructuring-6.23.0.tgz\",\"integrity\":\"sha512-aNv/GDAW0j/f4Uy1OEPZn1mqD+Nfy9viFGBfQ5bZyT35YqOiqx7/tXdyfZkJ1sC21NyEsBdfDY6PYmLHF4r5iA==\",\"dev\":true,\"requires\":{\"babel-runtime\":\"^6.22.0\"}},\"babel-plugin-transform-es2015-duplicate-keys\":{\"version\":\"6.24.1\",\"resolved\":\"https://registry.npmmirror.com/babel-plugin-transform-es2015-duplicate-keys/-/babel-plugin-transform-es2015-duplicate-keys-6.24.1.tgz\",\"integrity\":\"sha512-ossocTuPOssfxO2h+Z3/Ea1Vo1wWx31Uqy9vIiJusOP4TbF7tPs9U0sJ9pX9OJPf4lXRGj5+6Gkl/HHKiAP5ug==\",\"dev\":true,\"requires\":{\"babel-runtime\":\"^6.22.0\",\"babel-types\":\"^6.24.1\"}},\"babel-plugin-transform-es2015-for-of\":{\"version\":\"6.23.0\",\"resolved\":\"https://registry.npmmirror.com/babel-plugin-transform-es2015-for-of/-/babel-plugin-transform-es2015-for-of-6.23.0.tgz\",\"integrity\":\"sha512-DLuRwoygCoXx+YfxHLkVx5/NpeSbVwfoTeBykpJK7JhYWlL/O8hgAK/reforUnZDlxasOrVPPJVI/guE3dCwkw==\",\"dev\":true,\"requires\":{\"babel-runtime\":\"^6.22.0\"}},\"babel-plugin-transform-es2015-function-name\":{\"version\":\"6.24.1\",\"resolved\":\"https://registry.npmmirror.com/babel-plugin-transform-es2015-function-name/-/babel-plugin-transform-es2015-function-name-6.24.1.tgz\",\"integrity\":\"sha512-iFp5KIcorf11iBqu/y/a7DK3MN5di3pNCzto61FqCNnUX4qeBwcV1SLqe10oXNnCaxBUImX3SckX2/o1nsrTcg==\",\"dev\":true,\"requires\":{\"babel-helper-function-name\":\"^6.24.1\",\"babel-runtime\":\"^6.22.0\",\"babel-types\":\"^6.24.1\"}},\"babel-plugin-transform-es2015-literals\":{\"version\":\"6.22.0\",\"resolved\":\"https://registry.npmmirror.com/babel-plugin-transform-es2015-literals/-/babel-plugin-transform-es2015-literals-6.22.0.tgz\",\"integrity\":\"sha512-tjFl0cwMPpDYyoqYA9li1/7mGFit39XiNX5DKC/uCNjBctMxyL1/PT/l4rSlbvBG1pOKI88STRdUsWXB3/Q9hQ==\",\"dev\":true,\"requires\":{\"babel-runtime\":\"^6.22.0\"}},\"babel-plugin-transform-es2015-modules-amd\":{\"version\":\"6.24.1\",\"resolved\":\"https://registry.npmmirror.com/babel-plugin-transform-es2015-modules-amd/-/babel-plugin-transform-es2015-modules-amd-6.24.1.tgz\",\"integrity\":\"sha512-LnIIdGWIKdw7zwckqx+eGjcS8/cl8D74A3BpJbGjKTFFNJSMrjN4bIh22HY1AlkUbeLG6X6OZj56BDvWD+OeFA==\",\"dev\":true,\"requires\":{\"babel-plugin-transform-es2015-modules-commonjs\":\"^6.24.1\",\"babel-runtime\":\"^6.22.0\",\"babel-template\":\"^6.24.1\"}},\"babel-plugin-transform-es2015-modules-commonjs\":{\"version\":\"6.26.2\",\"resolved\":\"https://registry.npmmirror.com/babel-plugin-transform-es2015-modules-commonjs/-/babel-plugin-transform-es2015-modules-commonjs-6.26.2.tgz\",\"integrity\":\"sha512-CV9ROOHEdrjcwhIaJNBGMBCodN+1cfkwtM1SbUHmvyy35KGT7fohbpOxkE2uLz1o6odKK2Ck/tz47z+VqQfi9Q==\",\"dev\":true,\"requires\":{\"babel-plugin-transform-strict-mode\":\"^6.24.1\",\"babel-runtime\":\"^6.26.0\",\"babel-template\":\"^6.26.0\",\"babel-types\":\"^6.26.0\"}},\"babel-plugin-transform-es2015-modules-systemjs\":{\"version\":\"6.24.1\",\"resolved\":\"https://registry.npmmirror.com/babel-plugin-transform-es2015-modules-systemjs/-/babel-plugin-transform-es2015-modules-systemjs-6.24.1.tgz\",\"integrity\":\"sha512-ONFIPsq8y4bls5PPsAWYXH/21Hqv64TBxdje0FvU3MhIV6QM2j5YS7KvAzg/nTIVLot2D2fmFQrFWCbgHlFEjg==\",\"dev\":true,\"requires\":{\"babel-helper-hoist-variables\":\"^6.24.1\",\"babel-runtime\":\"^6.22.0\",\"babel-template\":\"^6.24.1\"}},\"babel-plugin-transform-es2015-modules-umd\":{\"version\":\"6.24.1\",\"resolved\":\"https://registry.npmmirror.com/babel-plugin-transform-es2015-modules-umd/-/babel-plugin-transform-es2015-modules-umd-6.24.1.tgz\",\"integrity\":\"sha512-LpVbiT9CLsuAIp3IG0tfbVo81QIhn6pE8xBJ7XSeCtFlMltuar5VuBV6y6Q45tpui9QWcy5i0vLQfCfrnF7Kiw==\",\"dev\":true,\"requires\":{\"babel-plugin-transform-es2015-modules-amd\":\"^6.24.1\",\"babel-runtime\":\"^6.22.0\",\"babel-template\":\"^6.24.1\"}},\"babel-plugin-transform-es2015-object-super\":{\"version\":\"6.24.1\",\"resolved\":\"https://registry.npmmirror.com/babel-plugin-transform-es2015-object-super/-/babel-plugin-transform-es2015-object-super-6.24.1.tgz\",\"integrity\":\"sha512-8G5hpZMecb53vpD3mjs64NhI1au24TAmokQ4B+TBFBjN9cVoGoOvotdrMMRmHvVZUEvqGUPWL514woru1ChZMA==\",\"dev\":true,\"requires\":{\"babel-helper-replace-supers\":\"^6.24.1\",\"babel-runtime\":\"^6.22.0\"}},\"babel-plugin-transform-es2015-parameters\":{\"version\":\"6.24.1\",\"resolved\":\"https://registry.npmmirror.com/babel-plugin-transform-es2015-parameters/-/babel-plugin-transform-es2015-parameters-6.24.1.tgz\",\"integrity\":\"sha512-8HxlW+BB5HqniD+nLkQ4xSAVq3bR/pcYW9IigY+2y0dI+Y7INFeTbfAQr+63T3E4UDsZGjyb+l9txUnABWxlOQ==\",\"dev\":true,\"requires\":{\"babel-helper-call-delegate\":\"^6.24.1\",\"babel-helper-get-function-arity\":\"^6.24.1\",\"babel-runtime\":\"^6.22.0\",\"babel-template\":\"^6.24.1\",\"babel-traverse\":\"^6.24.1\",\"babel-types\":\"^6.24.1\"}},\"babel-plugin-transform-es2015-shorthand-properties\":{\"version\":\"6.24.1\",\"resolved\":\"https://registry.npmmirror.com/babel-plugin-transform-es2015-shorthand-properties/-/babel-plugin-transform-es2015-shorthand-properties-6.24.1.tgz\",\"integrity\":\"sha512-mDdocSfUVm1/7Jw/FIRNw9vPrBQNePy6wZJlR8HAUBLybNp1w/6lr6zZ2pjMShee65t/ybR5pT8ulkLzD1xwiw==\",\"dev\":true,\"requires\":{\"babel-runtime\":\"^6.22.0\",\"babel-types\":\"^6.24.1\"}},\"babel-plugin-transform-es2015-spread\":{\"version\":\"6.22.0\",\"resolved\":\"https://registry.npmmirror.com/babel-plugin-transform-es2015-spread/-/babel-plugin-transform-es2015-spread-6.22.0.tgz\",\"integrity\":\"sha512-3Ghhi26r4l3d0Js933E5+IhHwk0A1yiutj9gwvzmFbVV0sPMYk2lekhOufHBswX7NCoSeF4Xrl3sCIuSIa+zOg==\",\"dev\":true,\"requires\":{\"babel-runtime\":\"^6.22.0\"}},\"babel-plugin-transform-es2015-sticky-regex\":{\"version\":\"6.24.1\",\"resolved\":\"https://registry.npmmirror.com/babel-plugin-transform-es2015-sticky-regex/-/babel-plugin-transform-es2015-sticky-regex-6.24.1.tgz\",\"integrity\":\"sha512-CYP359ADryTo3pCsH0oxRo/0yn6UsEZLqYohHmvLQdfS9xkf+MbCzE3/Kolw9OYIY4ZMilH25z/5CbQbwDD+lQ==\",\"dev\":true,\"requires\":{\"babel-helper-regex\":\"^6.24.1\",\"babel-runtime\":\"^6.22.0\",\"babel-types\":\"^6.24.1\"}},\"babel-plugin-transform-es2015-template-literals\":{\"version\":\"6.22.0\",\"resolved\":\"https://registry.npmmirror.com/babel-plugin-transform-es2015-template-literals/-/babel-plugin-transform-es2015-template-literals-6.22.0.tgz\",\"integrity\":\"sha512-x8b9W0ngnKzDMHimVtTfn5ryimars1ByTqsfBDwAqLibmuuQY6pgBQi5z1ErIsUOWBdw1bW9FSz5RZUojM4apg==\",\"dev\":true,\"requires\":{\"babel-runtime\":\"^6.22.0\"}},\"babel-plugin-transform-es2015-typeof-symbol\":{\"version\":\"6.23.0\",\"resolved\":\"https://registry.npmmirror.com/babel-plugin-transform-es2015-typeof-symbol/-/babel-plugin-transform-es2015-typeof-symbol-6.23.0.tgz\",\"integrity\":\"sha512-fz6J2Sf4gYN6gWgRZaoFXmq93X+Li/8vf+fb0sGDVtdeWvxC9y5/bTD7bvfWMEq6zetGEHpWjtzRGSugt5kNqw==\",\"dev\":true,\"requires\":{\"babel-runtime\":\"^6.22.0\"}},\"babel-plugin-transform-es2015-unicode-regex\":{\"version\":\"6.24.1\",\"resolved\":\"https://registry.npmmirror.com/babel-plugin-transform-es2015-unicode-regex/-/babel-plugin-transform-es2015-unicode-regex-6.24.1.tgz\",\"integrity\":\"sha512-v61Dbbihf5XxnYjtBN04B/JBvsScY37R1cZT5r9permN1cp+b70DY3Ib3fIkgn1DI9U3tGgBJZVD8p/mE/4JbQ==\",\"dev\":true,\"requires\":{\"babel-helper-regex\":\"^6.24.1\",\"babel-runtime\":\"^6.22.0\",\"regexpu-core\":\"^2.0.0\"}},\"babel-plugin-transform-exponentiation-operator\":{\"version\":\"6.24.1\",\"resolved\":\"https://registry.npmmirror.com/babel-plugin-transform-exponentiation-operator/-/babel-plugin-transform-exponentiation-operator-6.24.1.tgz\",\"integrity\":\"sha512-LzXDmbMkklvNhprr20//RStKVcT8Cu+SQtX18eMHLhjHf2yFzwtQ0S2f0jQ+89rokoNdmwoSqYzAhq86FxlLSQ==\",\"dev\":true,\"requires\":{\"babel-helper-builder-binary-assignment-operator-visitor\":\"^6.24.1\",\"babel-plugin-syntax-exponentiation-operator\":\"^6.8.0\",\"babel-runtime\":\"^6.22.0\"}},\"babel-plugin-transform-regenerator\":{\"version\":\"6.26.0\",\"resolved\":\"https://registry.npmmirror.com/babel-plugin-transform-regenerator/-/babel-plugin-transform-regenerator-6.26.0.tgz\",\"integrity\":\"sha512-LS+dBkUGlNR15/5WHKe/8Neawx663qttS6AGqoOUhICc9d1KciBvtrQSuc0PI+CxQ2Q/S1aKuJ+u64GtLdcEZg==\",\"dev\":true,\"requires\":{\"regenerator-transform\":\"^0.10.0\"}},\"babel-plugin-transform-runtime\":{\"version\":\"6.23.0\",\"resolved\":\"https://registry.npmmirror.com/babel-plugin-transform-runtime/-/babel-plugin-transform-runtime-6.23.0.tgz\",\"integrity\":\"sha512-cpGMVC1vt/772y3jx1gwSaTitQVZuFDlllgreMsZ+rTYC6jlYXRyf5FQOgSnckOiA5QmzbXTyBY2A5AmZXF1fA==\",\"dev\":true,\"requires\":{\"babel-runtime\":\"^6.22.0\"}},\"babel-plugin-transform-strict-mode\":{\"version\":\"6.24.1\",\"resolved\":\"https://registry.npmmirror.com/babel-plugin-transform-strict-mode/-/babel-plugin-transform-strict-mode-6.24.1.tgz\",\"integrity\":\"sha512-j3KtSpjyLSJxNoCDrhwiJad8kw0gJ9REGj8/CqL0HeRyLnvUNYV9zcqluL6QJSXh3nfsLEmSLvwRfGzrgR96Pw==\",\"dev\":true,\"requires\":{\"babel-runtime\":\"^6.22.0\",\"babel-types\":\"^6.24.1\"}},\"babel-polyfill\":{\"version\":\"6.26.0\",\"resolved\":\"https://registry.npmmirror.com/babel-polyfill/-/babel-polyfill-6.26.0.tgz\",\"integrity\":\"sha512-F2rZGQnAdaHWQ8YAoeRbukc7HS9QgdgeyJ0rQDd485v9opwuPvjpPFcOOT/WmkKTdgy9ESgSPXDcTNpzrGr6iQ==\",\"dev\":true,\"requires\":{\"babel-runtime\":\"^6.26.0\",\"core-js\":\"^2.5.0\",\"regenerator-runtime\":\"^0.10.5\"},\"dependencies\":{\"regenerator-runtime\":{\"version\":\"0.10.5\",\"resolved\":\"https://registry.npmmirror.com/regenerator-runtime/-/regenerator-runtime-0.10.5.tgz\",\"integrity\":\"sha512-02YopEIhAgiBHWeoTiA8aitHDt8z6w+rQqNuIftlM+ZtvSl/brTouaU7DW6GO/cHtvxJvS4Hwv2ibKdxIRi24w==\",\"dev\":true}}},\"babel-preset-env\":{\"version\":\"1.7.0\",\"resolved\":\"https://registry.npmmirror.com/babel-preset-env/-/babel-preset-env-1.7.0.tgz\",\"integrity\":\"sha512-9OR2afuKDneX2/q2EurSftUYM0xGu4O2D9adAhVfADDhrYDaxXV0rBbevVYoY9n6nyX1PmQW/0jtpJvUNr9CHg==\",\"dev\":true,\"requires\":{\"babel-plugin-check-es2015-constants\":\"^6.22.0\",\"babel-plugin-syntax-trailing-function-commas\":\"^6.22.0\",\"babel-plugin-transform-async-to-generator\":\"^6.22.0\",\"babel-plugin-transform-es2015-arrow-functions\":\"^6.22.0\",\"babel-plugin-transform-es2015-block-scoped-functions\":\"^6.22.0\",\"babel-plugin-transform-es2015-block-scoping\":\"^6.23.0\",\"babel-plugin-transform-es2015-classes\":\"^6.23.0\",\"babel-plugin-transform-es2015-computed-properties\":\"^6.22.0\",\"babel-plugin-transform-es2015-destructuring\":\"^6.23.0\",\"babel-plugin-transform-es2015-duplicate-keys\":\"^6.22.0\",\"babel-plugin-transform-es2015-for-of\":\"^6.23.0\",\"babel-plugin-transform-es2015-function-name\":\"^6.22.0\",\"babel-plugin-transform-es2015-literals\":\"^6.22.0\",\"babel-plugin-transform-es2015-modules-amd\":\"^6.22.0\",\"babel-plugin-transform-es2015-modules-commonjs\":\"^6.23.0\",\"babel-plugin-transform-es2015-modules-systemjs\":\"^6.23.0\",\"babel-plugin-transform-es2015-modules-umd\":\"^6.23.0\",\"babel-plugin-transform-es2015-object-super\":\"^6.22.0\",\"babel-plugin-transform-es2015-parameters\":\"^6.23.0\",\"babel-plugin-transform-es2015-shorthand-properties\":\"^6.22.0\",\"babel-plugin-transform-es2015-spread\":\"^6.22.0\",\"babel-plugin-transform-es2015-sticky-regex\":\"^6.22.0\",\"babel-plugin-transform-es2015-template-literals\":\"^6.22.0\",\"babel-plugin-transform-es2015-typeof-symbol\":\"^6.23.0\",\"babel-plugin-transform-es2015-unicode-regex\":\"^6.22.0\",\"babel-plugin-transform-exponentiation-operator\":\"^6.22.0\",\"babel-plugin-transform-regenerator\":\"^6.22.0\",\"browserslist\":\"^3.2.6\",\"invariant\":\"^2.2.2\",\"semver\":\"^5.3.0\"}},\"babel-register\":{\"version\":\"6.26.0\",\"resolved\":\"https://registry.npmmirror.com/babel-register/-/babel-register-6.26.0.tgz\",\"integrity\":\"sha512-veliHlHX06wjaeY8xNITbveXSiI+ASFnOqvne/LaIJIqOWi2Ogmj91KOugEz/hoh/fwMhXNBJPCv8Xaz5CyM4A==\",\"dev\":true,\"requires\":{\"babel-core\":\"^6.26.0\",\"babel-runtime\":\"^6.26.0\",\"core-js\":\"^2.5.0\",\"home-or-tmp\":\"^2.0.0\",\"lodash\":\"^4.17.4\",\"mkdirp\":\"^0.5.1\",\"source-map-support\":\"^0.4.15\"}},\"babel-runtime\":{\"version\":\"6.26.0\",\"resolved\":\"https://registry.npmmirror.com/babel-runtime/-/babel-runtime-6.26.0.tgz\",\"integrity\":\"sha512-ITKNuq2wKlW1fJg9sSW52eepoYgZBggvOAHC0u/CYu/qxQ9EVzThCgR69BnSXLHjy2f7SY5zaQ4yt7H9ZVxY2g==\",\"dev\":true,\"requires\":{\"core-js\":\"^2.4.0\",\"regenerator-runtime\":\"^0.11.0\"}},\"babel-template\":{\"version\":\"6.26.0\",\"resolved\":\"https://registry.npmmirror.com/babel-template/-/babel-template-6.26.0.tgz\",\"integrity\":\"sha512-PCOcLFW7/eazGUKIoqH97sO9A2UYMahsn/yRQ7uOk37iutwjq7ODtcTNF+iFDSHNfkctqsLRjLP7URnOx0T1fg==\",\"dev\":true,\"requires\":{\"babel-runtime\":\"^6.26.0\",\"babel-traverse\":\"^6.26.0\",\"babel-types\":\"^6.26.0\",\"babylon\":\"^6.18.0\",\"lodash\":\"^4.17.4\"}},\"babel-traverse\":{\"version\":\"6.26.0\",\"resolved\":\"https://registry.npmmirror.com/babel-traverse/-/babel-traverse-6.26.0.tgz\",\"integrity\":\"sha512-iSxeXx7apsjCHe9c7n8VtRXGzI2Bk1rBSOJgCCjfyXb6v1aCqE1KSEpq/8SXuVN8Ka/Rh1WDTF0MDzkvTA4MIA==\",\"dev\":true,\"requires\":{\"babel-code-frame\":\"^6.26.0\",\"babel-messages\":\"^6.23.0\",\"babel-runtime\":\"^6.26.0\",\"babel-types\":\"^6.26.0\",\"babylon\":\"^6.18.0\",\"debug\":\"^2.6.8\",\"globals\":\"^9.18.0\",\"invariant\":\"^2.2.2\",\"lodash\":\"^4.17.4\"}},\"babel-types\":{\"version\":\"6.26.0\",\"resolved\":\"https://registry.npmmirror.com/babel-types/-/babel-types-6.26.0.tgz\",\"integrity\":\"sha512-zhe3V/26rCWsEZK8kZN+HaQj5yQ1CilTObixFzKW1UWjqG7618Twz6YEsCnjfg5gBcJh02DrpCkS9h98ZqDY+g==\",\"dev\":true,\"requires\":{\"babel-runtime\":\"^6.26.0\",\"esutils\":\"^2.0.2\",\"lodash\":\"^4.17.4\",\"to-fast-properties\":\"^1.0.3\"}},\"babylon\":{\"version\":\"6.18.0\",\"resolved\":\"https://registry.npmmirror.com/babylon/-/babylon-6.18.0.tgz\",\"integrity\":\"sha512-q/UEjfGJ2Cm3oKV71DJz9d25TPnq5rhBVL2Q4fA5wcC3jcrdn7+SssEybFIxwAvvP+YCsCYNKughoF33GxgycQ==\",\"dev\":true},\"balanced-match\":{\"version\":\"1.0.2\",\"resolved\":\"https://registry.npmmirror.com/balanced-match/-/balanced-match-1.0.2.tgz\",\"integrity\":\"sha512-3oSeUO0TMV67hN1AmbXsK4yaqU7tjiHlbxRDZOpH0KW9+CeX4bRAaX0Anxt0tx2MrpRpWwQaPwIlISEJhYU5Pw==\",\"dev\":true},\"base\":{\"version\":\"0.11.2\",\"resolved\":\"https://registry.npmmirror.com/base/-/base-0.11.2.tgz\",\"integrity\":\"sha512-5T6P4xPgpp0YDFvSWwEZ4NoE3aM4QBQXDzmVbraCkFj8zHM+mba8SyqB5DbZWyR7mYHo6Y7BdQo3MoA4m0TeQg==\",\"dev\":true,\"optional\":true,\"requires\":{\"cache-base\":\"^1.0.1\",\"class-utils\":\"^0.3.5\",\"component-emitter\":\"^1.2.1\",\"define-property\":\"^1.0.0\",\"isobject\":\"^3.0.1\",\"mixin-deep\":\"^1.2.0\",\"pascalcase\":\"^0.1.1\"},\"dependencies\":{\"define-property\":{\"version\":\"1.0.0\",\"resolved\":\"https://registry.npmmirror.com/define-property/-/define-property-1.0.0.tgz\",\"integrity\":\"sha512-cZTYKFWspt9jZsMscWo8sc/5lbPC9Q0N5nBLgb+Yd915iL3udB1uFgS3B8YCx66UVHq018DAVFoee7x+gxggeA==\",\"dev\":true,\"optional\":true,\"requires\":{\"is-descriptor\":\"^1.0.0\"}},\"is-accessor-descriptor\":{\"version\":\"1.0.0\",\"resolved\":\"https://registry.npmmirror.com/is-accessor-descriptor/-/is-accessor-descriptor-1.0.0.tgz\",\"integrity\":\"sha512-m5hnHTkcVsPfqx3AKlyttIPb7J+XykHvJP2B9bZDjlhLIoEq4XoK64Vg7boZlVWYK6LUY94dYPEE7Lh0ZkZKcQ==\",\"dev\":true,\"optional\":true,\"requires\":{\"kind-of\":\"^6.0.0\"}},\"is-data-descriptor\":{\"version\":\"1.0.0\",\"resolved\":\"https://registry.npmmirror.com/is-data-descriptor/-/is-data-descriptor-1.0.0.tgz\",\"integrity\":\"sha512-jbRXy1FmtAoCjQkVmIVYwuuqDFUbaOeDjmed1tOGPrsMhtJA4rD9tkgA0F1qJ3gRFRXcHYVkdeaP50Q5rE/jLQ==\",\"dev\":true,\"optional\":true,\"requires\":{\"kind-of\":\"^6.0.0\"}},\"is-descriptor\":{\"version\":\"1.0.2\",\"resolved\":\"https://registry.npmmirror.com/is-descriptor/-/is-descriptor-1.0.2.tgz\",\"integrity\":\"sha512-2eis5WqQGV7peooDyLmNEPUrps9+SXX5c9pL3xEB+4e9HnGuDa7mB7kHxHw4CbqS9k1T2hOH3miL8n8WtiYVtg==\",\"dev\":true,\"optional\":true,\"requires\":{\"is-accessor-descriptor\":\"^1.0.0\",\"is-data-descriptor\":\"^1.0.0\",\"kind-of\":\"^6.0.2\"}},\"isobject\":{\"version\":\"3.0.1\",\"resolved\":\"https://registry.npmmirror.com/isobject/-/isobject-3.0.1.tgz\",\"integrity\":\"sha512-WhB9zCku7EGTj/HQQRz5aUQEUeoQZH2bWcltRErOpymJ4boYE6wL9Tbr23krRPSZ+C5zqNSrSw+Cc7sZZ4b7vg==\",\"dev\":true,\"optional\":true},\"kind-of\":{\"version\":\"6.0.3\",\"resolved\":\"https://registry.npmmirror.com/kind-of/-/kind-of-6.0.3.tgz\",\"integrity\":\"sha512-dcS1ul+9tmeD95T+x28/ehLgd9mENa3LsvDTtzm3vyBEO7RPptvAD+t44WVXaUjTBRcrpFeFlC8WCruUR456hw==\",\"dev\":true,\"optional\":true}}},\"binary-extensions\":{\"version\":\"1.13.1\",\"resolved\":\"https://registry.npmmirror.com/binary-extensions/-/binary-extensions-1.13.1.tgz\",\"integrity\":\"sha512-Un7MIEDdUC5gNpcGDV97op1Ywk748MpHcFTHoYs6qnj1Z3j7I53VG3nwZhKzoBZmbdRNnb6WRdFlwl7tSDuZGw==\",\"dev\":true,\"optional\":true},\"bindings\":{\"version\":\"1.5.0\",\"resolved\":\"https://registry.npmmirror.com/bindings/-/bindings-1.5.0.tgz\",\"integrity\":\"sha512-p2q/t/mhvuOj/UeLlV6566GD/guowlr0hHxClI0W9m7MWYkL1F0hLo+0Aexs9HSPCtR1SXQ0TD3MMKrXZajbiQ==\",\"dev\":true,\"optional\":true,\"requires\":{\"file-uri-to-path\":\"1.0.0\"}},\"brace-expansion\":{\"version\":\"1.1.11\",\"resolved\":\"https://registry.npmmirror.com/brace-expansion/-/brace-expansion-1.1.11.tgz\",\"integrity\":\"sha512-iCuPHDFgrHX7H2vEI/5xpz07zSHB00TpugqhmYtVmMO6518mCuRMoOYFldEBl0g187ufozdaHgWKcYFb61qGiA==\",\"dev\":true,\"requires\":{\"balanced-match\":\"^1.0.0\",\"concat-map\":\"0.0.1\"}},\"braces\":{\"version\":\"1.8.5\",\"resolved\":\"https://registry.npmmirror.com/braces/-/braces-1.8.5.tgz\",\"integrity\":\"sha512-xU7bpz2ytJl1bH9cgIurjpg/n8Gohy9GTw81heDYLJQ4RU60dlyJsa+atVF2pI0yMMvKxI9HkKwjePCj5XI1hw==\",\"dev\":true,\"optional\":true,\"requires\":{\"expand-range\":\"^1.8.1\",\"preserve\":\"^0.2.0\",\"repeat-element\":\"^1.1.2\"}},\"browserslist\":{\"version\":\"3.2.8\",\"resolved\":\"https://registry.npmmirror.com/browserslist/-/browserslist-3.2.8.tgz\",\"integrity\":\"sha512-WHVocJYavUwVgVViC0ORikPHQquXwVh939TaelZ4WDqpWgTX/FsGhl/+P4qBUAGcRvtOgDgC+xftNWWp2RUTAQ==\",\"dev\":true,\"requires\":{\"caniuse-lite\":\"^1.0.30000844\",\"electron-to-chromium\":\"^1.3.47\"}},\"cache-base\":{\"version\":\"1.0.1\",\"resolved\":\"https://registry.npmmirror.com/cache-base/-/cache-base-1.0.1.tgz\",\"integrity\":\"sha512-AKcdTnFSWATd5/GCPRxr2ChwIJ85CeyrEyjRHlKxQ56d4XJMGym0uAiKn0xbLOGOl3+yRpOTi484dVCEc5AUzQ==\",\"dev\":true,\"optional\":true,\"requires\":{\"collection-visit\":\"^1.0.0\",\"component-emitter\":\"^1.2.1\",\"get-value\":\"^2.0.6\",\"has-value\":\"^1.0.0\",\"isobject\":\"^3.0.1\",\"set-value\":\"^2.0.0\",\"to-object-path\":\"^0.3.0\",\"union-value\":\"^1.0.0\",\"unset-value\":\"^1.0.0\"},\"dependencies\":{\"isobject\":{\"version\":\"3.0.1\",\"resolved\":\"https://registry.npmmirror.com/isobject/-/isobject-3.0.1.tgz\",\"integrity\":\"sha512-WhB9zCku7EGTj/HQQRz5aUQEUeoQZH2bWcltRErOpymJ4boYE6wL9Tbr23krRPSZ+C5zqNSrSw+Cc7sZZ4b7vg==\",\"dev\":true,\"optional\":true}}},\"caniuse-lite\":{\"version\":\"1.0.30001486\",\"resolved\":\"https://registry.npmmirror.com/caniuse-lite/-/caniuse-lite-1.0.30001486.tgz\",\"integrity\":\"sha512-uv7/gXuHi10Whlj0pp5q/tsK/32J2QSqVRKQhs2j8VsDCjgyruAh/eEXHF822VqO9yT6iZKw3nRwZRSPBE9OQg==\",\"dev\":true},\"chalk\":{\"version\":\"1.1.3\",\"resolved\":\"https://registry.npmmirror.com/chalk/-/chalk-1.1.3.tgz\",\"integrity\":\"sha512-U3lRVLMSlsCfjqYPbLyVv11M9CPW4I728d6TCKMAOJueEeB9/8o+eSsMnxPJD+Q+K909sdESg7C+tIkoH6on1A==\",\"dev\":true,\"requires\":{\"ansi-styles\":\"^2.2.1\",\"escape-string-regexp\":\"^1.0.2\",\"has-ansi\":\"^2.0.0\",\"strip-ansi\":\"^3.0.0\",\"supports-color\":\"^2.0.0\"}},\"chokidar\":{\"version\":\"1.7.0\",\"resolved\":\"https://registry.npmmirror.com/chokidar/-/chokidar-1.7.0.tgz\",\"integrity\":\"sha512-mk8fAWcRUOxY7btlLtitj3A45jOwSAxH4tOFOoEGbVsl6cL6pPMWUy7dwZ/canfj3QEdP6FHSnf/l1c6/WkzVg==\",\"dev\":true,\"optional\":true,\"requires\":{\"anymatch\":\"^1.3.0\",\"async-each\":\"^1.0.0\",\"fsevents\":\"^1.0.0\",\"glob-parent\":\"^2.0.0\",\"inherits\":\"^2.0.1\",\"is-binary-path\":\"^1.0.0\",\"is-glob\":\"^2.0.0\",\"path-is-absolute\":\"^1.0.0\",\"readdirp\":\"^2.0.0\"}},\"class-utils\":{\"version\":\"0.3.6\",\"resolved\":\"https://registry.npmmirror.com/class-utils/-/class-utils-0.3.6.tgz\",\"integrity\":\"sha512-qOhPa/Fj7s6TY8H8esGu5QNpMMQxz79h+urzrNYN6mn+9BnxlDGf5QZ+XeCDsxSjPqsSR56XOZOJmpeurnLMeg==\",\"dev\":true,\"optional\":true,\"requires\":{\"arr-union\":\"^3.1.0\",\"define-property\":\"^0.2.5\",\"isobject\":\"^3.0.0\",\"static-extend\":\"^0.1.1\"},\"dependencies\":{\"define-property\":{\"version\":\"0.2.5\",\"resolved\":\"https://registry.npmmirror.com/define-property/-/define-property-0.2.5.tgz\",\"integrity\":\"sha512-Rr7ADjQZenceVOAKop6ALkkRAmH1A4Gx9hV/7ZujPUN2rkATqFO0JZLZInbAjpZYoJ1gUx8MRMQVkYemcbMSTA==\",\"dev\":true,\"optional\":true,\"requires\":{\"is-descriptor\":\"^0.1.0\"}},\"isobject\":{\"version\":\"3.0.1\",\"resolved\":\"https://registry.npmmirror.com/isobject/-/isobject-3.0.1.tgz\",\"integrity\":\"sha512-WhB9zCku7EGTj/HQQRz5aUQEUeoQZH2bWcltRErOpymJ4boYE6wL9Tbr23krRPSZ+C5zqNSrSw+Cc7sZZ4b7vg==\",\"dev\":true,\"optional\":true}}},\"collection-visit\":{\"version\":\"1.0.0\",\"resolved\":\"https://registry.npmmirror.com/collection-visit/-/collection-visit-1.0.0.tgz\",\"integrity\":\"sha512-lNkKvzEeMBBjUGHZ+q6z9pSJla0KWAQPvtzhEV9+iGyQYG+pBpl7xKDhxoNSOZH2hhv0v5k0y2yAM4o4SjoSkw==\",\"dev\":true,\"optional\":true,\"requires\":{\"map-visit\":\"^1.0.0\",\"object-visit\":\"^1.0.0\"}},\"commander\":{\"version\":\"2.20.3\",\"resolved\":\"https://registry.npmmirror.com/commander/-/commander-2.20.3.tgz\",\"integrity\":\"sha512-GpVkmM8vF2vQUkj2LvZmD35JxeJOLCwJ9cUkugyk2nuhbv3+mJvpLYYt+0+USMxE+oj+ey/lJEnhZw75x/OMcQ==\",\"dev\":true},\"component-emitter\":{\"version\":\"1.3.0\",\"resolved\":\"https://registry.npmmirror.com/component-emitter/-/component-emitter-1.3.0.tgz\",\"integrity\":\"sha512-Rd3se6QB+sO1TwqZjscQrurpEPIfO0/yYnSin6Q/rD3mOutHvUrCAhJub3r90uNb+SESBuE0QYoB90YdfatsRg==\",\"dev\":true,\"optional\":true},\"concat-map\":{\"version\":\"0.0.1\",\"resolved\":\"https://registry.npmmirror.com/concat-map/-/concat-map-0.0.1.tgz\",\"integrity\":\"sha512-/Srv4dswyQNBfohGpz9o6Yb3Gz3SrUDqBH5rTuhGR7ahtlbYKnVxw2bCFMRljaA7EXHaXZ8wsHdodFvbkhKmqg==\",\"dev\":true},\"convert-source-map\":{\"version\":\"1.9.0\",\"resolved\":\"https://registry.npmmirror.com/convert-source-map/-/convert-source-map-1.9.0.tgz\",\"integrity\":\"sha512-ASFBup0Mz1uyiIjANan1jzLQami9z1PoYSZCiiYW2FczPbenXc45FZdBZLzOT+r6+iciuEModtmCti+hjaAk0A==\",\"dev\":true},\"copy-descriptor\":{\"version\":\"0.1.1\",\"resolved\":\"https://registry.npmmirror.com/copy-descriptor/-/copy-descriptor-0.1.1.tgz\",\"integrity\":\"sha512-XgZ0pFcakEUlbwQEVNg3+QAis1FyTL3Qel9FYy8pSkQqoG3PNoT0bOCQtOXcOkur21r2Eq2kI+IE+gsmAEVlYw==\",\"dev\":true,\"optional\":true},\"core-js\":{\"version\":\"2.6.12\",\"resolved\":\"https://registry.npmmirror.com/core-js/-/core-js-2.6.12.tgz\",\"integrity\":\"sha512-Kb2wC0fvsWfQrgk8HU5lW6U/Lcs8+9aaYcy4ZFc6DDlo4nZ7n70dEgE5rtR0oG6ufKDUnrwfWL1mXR5ljDatrQ==\",\"dev\":true},\"core-util-is\":{\"version\":\"1.0.3\",\"resolved\":\"https://registry.npmmirror.com/core-util-is/-/core-util-is-1.0.3.tgz\",\"integrity\":\"sha512-ZQBvi1DcpJ4GDqanjucZ2Hj3wEO5pZDS89BWbkcrvdxksJorwUDDZamX9ldFkp9aw2lmBDLgkObEA4DWNJ9FYQ==\",\"dev\":true,\"optional\":true},\"debug\":{\"version\":\"2.6.9\",\"resolved\":\"https://registry.npmmirror.com/debug/-/debug-2.6.9.tgz\",\"integrity\":\"sha512-bC7ElrdJaJnPbAP+1EotYvqZsb3ecl5wi6Bfi6BJTUcNowp6cvspg0jXznRTKDjm/E7AdgFBVeAPVMNcKGsHMA==\",\"dev\":true,\"requires\":{\"ms\":\"2.0.0\"}},\"decode-uri-component\":{\"version\":\"0.2.2\",\"resolved\":\"https://registry.npmmirror.com/decode-uri-component/-/decode-uri-component-0.2.2.tgz\",\"integrity\":\"sha512-FqUYQ+8o158GyGTrMFJms9qh3CqTKvAqgqsTnkLI8sKu0028orqBhxNMFkFen0zGyg6epACD32pjVk58ngIErQ==\",\"dev\":true,\"optional\":true},\"define-property\":{\"version\":\"2.0.2\",\"resolved\":\"https://registry.npmmirror.com/define-property/-/define-property-2.0.2.tgz\",\"integrity\":\"sha512-jwK2UV4cnPpbcG7+VRARKTZPUWowwXA8bzH5NP6ud0oeAxyYPuGZUAC7hMugpCdz4BeSZl2Dl9k66CHJ/46ZYQ==\",\"dev\":true,\"optional\":true,\"requires\":{\"is-descriptor\":\"^1.0.2\",\"isobject\":\"^3.0.1\"},\"dependencies\":{\"is-accessor-descriptor\":{\"version\":\"1.0.0\",\"resolved\":\"https://registry.npmmirror.com/is-accessor-descriptor/-/is-accessor-descriptor-1.0.0.tgz\",\"integrity\":\"sha512-m5hnHTkcVsPfqx3AKlyttIPb7J+XykHvJP2B9bZDjlhLIoEq4XoK64Vg7boZlVWYK6LUY94dYPEE7Lh0ZkZKcQ==\",\"dev\":true,\"optional\":true,\"requires\":{\"kind-of\":\"^6.0.0\"}},\"is-data-descriptor\":{\"version\":\"1.0.0\",\"resolved\":\"https://registry.npmmirror.com/is-data-descriptor/-/is-data-descriptor-1.0.0.tgz\",\"integrity\":\"sha512-jbRXy1FmtAoCjQkVmIVYwuuqDFUbaOeDjmed1tOGPrsMhtJA4rD9tkgA0F1qJ3gRFRXcHYVkdeaP50Q5rE/jLQ==\",\"dev\":true,\"optional\":true,\"requires\":{\"kind-of\":\"^6.0.0\"}},\"is-descriptor\":{\"version\":\"1.0.2\",\"resolved\":\"https://registry.npmmirror.com/is-descriptor/-/is-descriptor-1.0.2.tgz\",\"integrity\":\"sha512-2eis5WqQGV7peooDyLmNEPUrps9+SXX5c9pL3xEB+4e9HnGuDa7mB7kHxHw4CbqS9k1T2hOH3miL8n8WtiYVtg==\",\"dev\":true,\"optional\":true,\"requires\":{\"is-accessor-descriptor\":\"^1.0.0\",\"is-data-descriptor\":\"^1.0.0\",\"kind-of\":\"^6.0.2\"}},\"isobject\":{\"version\":\"3.0.1\",\"resolved\":\"https://registry.npmmirror.com/isobject/-/isobject-3.0.1.tgz\",\"integrity\":\"sha512-WhB9zCku7EGTj/HQQRz5aUQEUeoQZH2bWcltRErOpymJ4boYE6wL9Tbr23krRPSZ+C5zqNSrSw+Cc7sZZ4b7vg==\",\"dev\":true,\"optional\":true},\"kind-of\":{\"version\":\"6.0.3\",\"resolved\":\"https://registry.npmmirror.com/kind-of/-/kind-of-6.0.3.tgz\",\"integrity\":\"sha512-dcS1ul+9tmeD95T+x28/ehLgd9mENa3LsvDTtzm3vyBEO7RPptvAD+t44WVXaUjTBRcrpFeFlC8WCruUR456hw==\",\"dev\":true,\"optional\":true}}},\"detect-indent\":{\"version\":\"4.0.0\",\"resolved\":\"https://registry.npmmirror.com/detect-indent/-/detect-indent-4.0.0.tgz\",\"integrity\":\"sha512-BDKtmHlOzwI7iRuEkhzsnPoi5ypEhWAJB5RvHWe1kMr06js3uK5B3734i3ui5Yd+wOJV1cpE4JnivPD283GU/A==\",\"dev\":true,\"requires\":{\"repeating\":\"^2.0.0\"}},\"electron-to-chromium\":{\"version\":\"1.4.392\",\"resolved\":\"https://registry.npmmirror.com/electron-to-chromium/-/electron-to-chromium-1.4.392.tgz\",\"integrity\":\"sha512-TXQOMW9tnhIms3jGy/lJctLjICOgyueZFJ1KUtm6DTQ+QpxX3p7ZBwB6syuZ9KBuT5S4XX7bgY1ECPgfxKUdOg==\",\"dev\":true},\"escape-string-regexp\":{\"version\":\"1.0.5\",\"resolved\":\"https://registry.npmmirror.com/escape-string-regexp/-/escape-string-regexp-1.0.5.tgz\",\"integrity\":\"sha512-vbRorB5FUQWvla16U8R/qgaFIya2qGzwDrNmCZuYKrbdSUMG6I1ZCGQRefkRVhuOkIGVne7BQ35DSfo1qvJqFg==\",\"dev\":true},\"esutils\":{\"version\":\"2.0.3\",\"resolved\":\"https://registry.npmmirror.com/esutils/-/esutils-2.0.3.tgz\",\"integrity\":\"sha512-kVscqXk4OCp68SZ0dkgEKVi6/8ij300KBWTJq32P/dYeWTSwK41WyTxalN1eRmA5Z9UU/LX9D7FWSmV9SAYx6g==\",\"dev\":true},\"expand-brackets\":{\"version\":\"0.1.5\",\"resolved\":\"https://registry.npmmirror.com/expand-brackets/-/expand-brackets-0.1.5.tgz\",\"integrity\":\"sha512-hxx03P2dJxss6ceIeri9cmYOT4SRs3Zk3afZwWpOsRqLqprhTR8u++SlC+sFGsQr7WGFPdMF7Gjc1njDLDK6UA==\",\"dev\":true,\"optional\":true,\"requires\":{\"is-posix-bracket\":\"^0.1.0\"}},\"expand-range\":{\"version\":\"1.8.2\",\"resolved\":\"https://registry.npmmirror.com/expand-range/-/expand-range-1.8.2.tgz\",\"integrity\":\"sha512-AFASGfIlnIbkKPQwX1yHaDjFvh/1gyKJODme52V6IORh69uEYgZp0o9C+qsIGNVEiuuhQU0CSSl++Rlegg1qvA==\",\"dev\":true,\"optional\":true,\"requires\":{\"fill-range\":\"^2.1.0\"}},\"extend-shallow\":{\"version\":\"3.0.2\",\"resolved\":\"https://registry.npmmirror.com/extend-shallow/-/extend-shallow-3.0.2.tgz\",\"integrity\":\"sha512-BwY5b5Ql4+qZoefgMj2NUmx+tehVTH/Kf4k1ZEtOHNFcm2wSxMRo992l6X3TIgni2eZVTZ85xMOjF31fwZAj6Q==\",\"dev\":true,\"optional\":true,\"requires\":{\"assign-symbols\":\"^1.0.0\",\"is-extendable\":\"^1.0.1\"},\"dependencies\":{\"is-extendable\":{\"version\":\"1.0.1\",\"resolved\":\"https://registry.npmmirror.com/is-extendable/-/is-extendable-1.0.1.tgz\",\"integrity\":\"sha512-arnXMxT1hhoKo9k1LZdmlNyJdDDfy2v0fXjFlmok4+i8ul/6WlbVge9bhM74OpNPQPMGUToDtz+KXa1PneJxOA==\",\"dev\":true,\"optional\":true,\"requires\":{\"is-plain-object\":\"^2.0.4\"}}}},\"extglob\":{\"version\":\"0.3.2\",\"resolved\":\"https://registry.npmmirror.com/extglob/-/extglob-0.3.2.tgz\",\"integrity\":\"sha512-1FOj1LOwn42TMrruOHGt18HemVnbwAmAak7krWk+wa93KXxGbK+2jpezm+ytJYDaBX0/SPLZFHKM7m+tKobWGg==\",\"dev\":true,\"optional\":true,\"requires\":{\"is-extglob\":\"^1.0.0\"}},\"file-uri-to-path\":{\"version\":\"1.0.0\",\"resolved\":\"https://registry.npmmirror.com/file-uri-to-path/-/file-uri-to-path-1.0.0.tgz\",\"integrity\":\"sha512-0Zt+s3L7Vf1biwWZ29aARiVYLx7iMGnEUl9x33fbB/j3jR81u/O2LbqK+Bm1CDSNDKVtJ/YjwY7TUd5SkeLQLw==\",\"dev\":true,\"optional\":true},\"filename-regex\":{\"version\":\"2.0.1\",\"resolved\":\"https://registry.npmmirror.com/filename-regex/-/filename-regex-2.0.1.tgz\",\"integrity\":\"sha512-BTCqyBaWBTsauvnHiE8i562+EdJj+oUpkqWp2R1iCoR8f6oo8STRu3of7WJJ0TqWtxN50a5YFpzYK4Jj9esYfQ==\",\"dev\":true,\"optional\":true},\"fill-range\":{\"version\":\"2.2.4\",\"resolved\":\"https://registry.npmmirror.com/fill-range/-/fill-range-2.2.4.tgz\",\"integrity\":\"sha512-cnrcCbj01+j2gTG921VZPnHbjmdAf8oQV/iGeV2kZxGSyfYjjTyY79ErsK1WJWMpw6DaApEX72binqJE+/d+5Q==\",\"dev\":true,\"optional\":true,\"requires\":{\"is-number\":\"^2.1.0\",\"isobject\":\"^2.0.0\",\"randomatic\":\"^3.0.0\",\"repeat-element\":\"^1.1.2\",\"repeat-string\":\"^1.5.2\"}},\"for-in\":{\"version\":\"1.0.2\",\"resolved\":\"https://registry.npmmirror.com/for-in/-/for-in-1.0.2.tgz\",\"integrity\":\"sha512-7EwmXrOjyL+ChxMhmG5lnW9MPt1aIeZEwKhQzoBUdTV0N3zuwWDZYVJatDvZ2OyzPUvdIAZDsCetk3coyMfcnQ==\",\"dev\":true,\"optional\":true},\"for-own\":{\"version\":\"0.1.5\",\"resolved\":\"https://registry.npmmirror.com/for-own/-/for-own-0.1.5.tgz\",\"integrity\":\"sha512-SKmowqGTJoPzLO1T0BBJpkfp3EMacCMOuH40hOUbrbzElVktk4DioXVM99QkLCyKoiuOmyjgcWMpVz2xjE7LZw==\",\"dev\":true,\"optional\":true,\"requires\":{\"for-in\":\"^1.0.1\"}},\"fragment-cache\":{\"version\":\"0.2.1\",\"resolved\":\"https://registry.npmmirror.com/fragment-cache/-/fragment-cache-0.2.1.tgz\",\"integrity\":\"sha512-GMBAbW9antB8iZRHLoGw0b3HANt57diZYFO/HL1JGIC1MjKrdmhxvrJbupnVvpys0zsz7yBApXdQyfepKly2kA==\",\"dev\":true,\"optional\":true,\"requires\":{\"map-cache\":\"^0.2.2\"}},\"fs-readdir-recursive\":{\"version\":\"1.1.0\",\"resolved\":\"https://registry.npmmirror.com/fs-readdir-recursive/-/fs-readdir-recursive-1.1.0.tgz\",\"integrity\":\"sha512-GNanXlVr2pf02+sPN40XN8HG+ePaNcvM0q5mZBd668Obwb0yD5GiUbZOFgwn8kGMY6I3mdyDJzieUy3PTYyTRA==\",\"dev\":true},\"fs.realpath\":{\"version\":\"1.0.0\",\"resolved\":\"https://registry.npmmirror.com/fs.realpath/-/fs.realpath-1.0.0.tgz\",\"integrity\":\"sha512-OO0pH2lK6a0hZnAdau5ItzHPI6pUlvI7jMVnxUQRtw4owF2wk8lOSabtGDCTP4Ggrg2MbGnWO9X8K1t4+fGMDw==\",\"dev\":true},\"fsevents\":{\"version\":\"1.2.13\",\"resolved\":\"https://registry.npmmirror.com/fsevents/-/fsevents-1.2.13.tgz\",\"integrity\":\"sha512-oWb1Z6mkHIskLzEJ/XWX0srkpkTQ7vaopMQkyaEIoq0fmtFVxOthb8cCxeT+p3ynTdkk/RZwbgG4brR5BeWECw==\",\"dev\":true,\"optional\":true,\"requires\":{\"bindings\":\"^1.5.0\",\"nan\":\"^2.12.1\"}},\"get-value\":{\"version\":\"2.0.6\",\"resolved\":\"https://registry.npmmirror.com/get-value/-/get-value-2.0.6.tgz\",\"integrity\":\"sha512-Ln0UQDlxH1BapMu3GPtf7CuYNwRZf2gwCuPqbyG6pB8WfmFpzqcy4xtAaAMUhnNqjMKTiCPZG2oMT3YSx8U2NA==\",\"dev\":true,\"optional\":true},\"glob\":{\"version\":\"7.2.3\",\"resolved\":\"https://registry.npmmirror.com/glob/-/glob-7.2.3.tgz\",\"integrity\":\"sha512-nFR0zLpU2YCaRxwoCJvL6UvCH2JFyFVIvwTLsIf21AuHlMskA1hhTdk+LlYJtOlYt9v6dvszD2BGRqBL+iQK9Q==\",\"dev\":true,\"requires\":{\"fs.realpath\":\"^1.0.0\",\"inflight\":\"^1.0.4\",\"inherits\":\"2\",\"minimatch\":\"^3.1.1\",\"once\":\"^1.3.0\",\"path-is-absolute\":\"^1.0.0\"}},\"glob-base\":{\"version\":\"0.3.0\",\"resolved\":\"https://registry.npmmirror.com/glob-base/-/glob-base-0.3.0.tgz\",\"integrity\":\"sha512-ab1S1g1EbO7YzauaJLkgLp7DZVAqj9M/dvKlTt8DkXA2tiOIcSMrlVI2J1RZyB5iJVccEscjGn+kpOG9788MHA==\",\"dev\":true,\"optional\":true,\"requires\":{\"glob-parent\":\"^2.0.0\",\"is-glob\":\"^2.0.0\"}},\"glob-parent\":{\"version\":\"2.0.0\",\"resolved\":\"https://registry.npmmirror.com/glob-parent/-/glob-parent-2.0.0.tgz\",\"integrity\":\"sha512-JDYOvfxio/t42HKdxkAYaCiBN7oYiuxykOxKxdaUW5Qn0zaYN3gRQWolrwdnf0shM9/EP0ebuuTmyoXNr1cC5w==\",\"dev\":true,\"optional\":true,\"requires\":{\"is-glob\":\"^2.0.0\"}},\"globals\":{\"version\":\"9.18.0\",\"resolved\":\"https://registry.npmmirror.com/globals/-/globals-9.18.0.tgz\",\"integrity\":\"sha512-S0nG3CLEQiY/ILxqtztTWH/3iRRdyBLw6KMDxnKMchrtbj2OFmehVh0WUCfW3DUrIgx/qFrJPICrq4Z4sTR9UQ==\",\"dev\":true},\"graceful-fs\":{\"version\":\"4.2.11\",\"resolved\":\"https://registry.npmmirror.com/graceful-fs/-/graceful-fs-4.2.11.tgz\",\"integrity\":\"sha512-RbJ5/jmFcNNCcDV5o9eTnBLJ/HszWV0P73bc+Ff4nS/rJj+YaS6IGyiOL0VoBYX+l1Wrl3k63h/KrH+nhJ0XvQ==\",\"dev\":true},\"has-ansi\":{\"version\":\"2.0.0\",\"resolved\":\"https://registry.npmmirror.com/has-ansi/-/has-ansi-2.0.0.tgz\",\"integrity\":\"sha512-C8vBJ8DwUCx19vhm7urhTuUsr4/IyP6l4VzNQDv+ryHQObW3TTTp9yB68WpYgRe2bbaGuZ/se74IqFeVnMnLZg==\",\"dev\":true,\"requires\":{\"ansi-regex\":\"^2.0.0\"}},\"has-value\":{\"version\":\"1.0.0\",\"resolved\":\"https://registry.npmmirror.com/has-value/-/has-value-1.0.0.tgz\",\"integrity\":\"sha512-IBXk4GTsLYdQ7Rvt+GRBrFSVEkmuOUy4re0Xjd9kJSUQpnTrWR4/y9RpfexN9vkAPMFuQoeWKwqzPozRTlasGw==\",\"dev\":true,\"optional\":true,\"requires\":{\"get-value\":\"^2.0.6\",\"has-values\":\"^1.0.0\",\"isobject\":\"^3.0.0\"},\"dependencies\":{\"isobject\":{\"version\":\"3.0.1\",\"resolved\":\"https://registry.npmmirror.com/isobject/-/isobject-3.0.1.tgz\",\"integrity\":\"sha512-WhB9zCku7EGTj/HQQRz5aUQEUeoQZH2bWcltRErOpymJ4boYE6wL9Tbr23krRPSZ+C5zqNSrSw+Cc7sZZ4b7vg==\",\"dev\":true,\"optional\":true}}},\"has-values\":{\"version\":\"1.0.0\",\"resolved\":\"https://registry.npmmirror.com/has-values/-/has-values-1.0.0.tgz\",\"integrity\":\"sha512-ODYZC64uqzmtfGMEAX/FvZiRyWLpAC3vYnNunURUnkGVTS+mI0smVsWaPydRBsE3g+ok7h960jChO8mFcWlHaQ==\",\"dev\":true,\"optional\":true,\"requires\":{\"is-number\":\"^3.0.0\",\"kind-of\":\"^4.0.0\"},\"dependencies\":{\"is-number\":{\"version\":\"3.0.0\",\"resolved\":\"https://registry.npmmirror.com/is-number/-/is-number-3.0.0.tgz\",\"integrity\":\"sha512-4cboCqIpliH+mAvFNegjZQ4kgKc3ZUhQVr3HvWbSh5q3WH2v82ct+T2Y1hdU5Gdtorx/cLifQjqCbL7bpznLTg==\",\"dev\":true,\"optional\":true,\"requires\":{\"kind-of\":\"^3.0.2\"},\"dependencies\":{\"kind-of\":{\"version\":\"3.2.2\",\"resolved\":\"https://registry.npmmirror.com/kind-of/-/kind-of-3.2.2.tgz\",\"integrity\":\"sha512-NOW9QQXMoZGg/oqnVNoNTTIFEIid1627WCffUBJEdMxYApq7mNE7CpzucIPc+ZQg25Phej7IJSmX3hO+oblOtQ==\",\"dev\":true,\"optional\":true,\"requires\":{\"is-buffer\":\"^1.1.5\"}}}},\"kind-of\":{\"version\":\"4.0.0\",\"resolved\":\"https://registry.npmmirror.com/kind-of/-/kind-of-4.0.0.tgz\",\"integrity\":\"sha512-24XsCxmEbRwEDbz/qz3stgin8TTzZ1ESR56OMCN0ujYg+vRutNSiOj9bHH9u85DKgXguraugV5sFuvbD4FW/hw==\",\"dev\":true,\"optional\":true,\"requires\":{\"is-buffer\":\"^1.1.5\"}}}},\"home-or-tmp\":{\"version\":\"2.0.0\",\"resolved\":\"https://registry.npmmirror.com/home-or-tmp/-/home-or-tmp-2.0.0.tgz\",\"integrity\":\"sha512-ycURW7oUxE2sNiPVw1HVEFsW+ecOpJ5zaj7eC0RlwhibhRBod20muUN8qu/gzx956YrLolVvs1MTXwKgC2rVEg==\",\"dev\":true,\"requires\":{\"os-homedir\":\"^1.0.0\",\"os-tmpdir\":\"^1.0.1\"}},\"inflight\":{\"version\":\"1.0.6\",\"resolved\":\"https://registry.npmmirror.com/inflight/-/inflight-1.0.6.tgz\",\"integrity\":\"sha512-k92I/b08q4wvFscXCLvqfsHCrjrF7yiXsQuIVvVE7N82W3+aqpzuUdBbfhWcy/FZR3/4IgflMgKLOsvPDrGCJA==\",\"dev\":true,\"requires\":{\"once\":\"^1.3.0\",\"wrappy\":\"1\"}},\"inherits\":{\"version\":\"2.0.4\",\"resolved\":\"https://registry.npmmirror.com/inherits/-/inherits-2.0.4.tgz\",\"integrity\":\"sha512-k/vGaX4/Yla3WzyMCvTQOXYeIHvqOKtnqBduzTHpzpQZzAskKMhZ2K+EnBiSM9zGSoIFeMpXKxa4dYeZIQqewQ==\",\"dev\":true},\"invariant\":{\"version\":\"2.2.4\",\"resolved\":\"https://registry.npmmirror.com/invariant/-/invariant-2.2.4.tgz\",\"integrity\":\"sha512-phJfQVBuaJM5raOpJjSfkiD6BpbCE4Ns//LaXl6wGYtUBY83nWS6Rf9tXm2e8VaK60JEjYldbPif/A2B1C2gNA==\",\"dev\":true,\"requires\":{\"loose-envify\":\"^1.0.0\"}},\"is-accessor-descriptor\":{\"version\":\"0.1.6\",\"resolved\":\"https://registry.npmmirror.com/is-accessor-descriptor/-/is-accessor-descriptor-0.1.6.tgz\",\"integrity\":\"sha512-e1BM1qnDbMRG3ll2U9dSK0UMHuWOs3pY3AtcFsmvwPtKL3MML/Q86i+GilLfvqEs4GW+ExB91tQ3Ig9noDIZ+A==\",\"dev\":true,\"optional\":true,\"requires\":{\"kind-of\":\"^3.0.2\"}},\"is-binary-path\":{\"version\":\"1.0.1\",\"resolved\":\"https://registry.npmmirror.com/is-binary-path/-/is-binary-path-1.0.1.tgz\",\"integrity\":\"sha512-9fRVlXc0uCxEDj1nQzaWONSpbTfx0FmJfzHF7pwlI8DkWGoHBBea4Pg5Ky0ojwwxQmnSifgbKkI06Qv0Ljgj+Q==\",\"dev\":true,\"optional\":true,\"requires\":{\"binary-extensions\":\"^1.0.0\"}},\"is-buffer\":{\"version\":\"1.1.6\",\"resolved\":\"https://registry.npmmirror.com/is-buffer/-/is-buffer-1.1.6.tgz\",\"integrity\":\"sha512-NcdALwpXkTm5Zvvbk7owOUSvVvBKDgKP5/ewfXEznmQFfs4ZRmanOeKBTjRVjka3QFoN6XJ+9F3USqfHqTaU5w==\",\"dev\":true,\"optional\":true},\"is-data-descriptor\":{\"version\":\"0.1.4\",\"resolved\":\"https://registry.npmmirror.com/is-data-descriptor/-/is-data-descriptor-0.1.4.tgz\",\"integrity\":\"sha512-+w9D5ulSoBNlmw9OHn3U2v51SyoCd0he+bB3xMl62oijhrspxowjU+AIcDY0N3iEJbUEkB15IlMASQsxYigvXg==\",\"dev\":true,\"optional\":true,\"requires\":{\"kind-of\":\"^3.0.2\"}},\"is-descriptor\":{\"version\":\"0.1.6\",\"resolved\":\"https://registry.npmmirror.com/is-descriptor/-/is-descriptor-0.1.6.tgz\",\"integrity\":\"sha512-avDYr0SB3DwO9zsMov0gKCESFYqCnE4hq/4z3TdUlukEy5t9C0YRq7HLrsN52NAcqXKaepeCD0n+B0arnVG3Hg==\",\"dev\":true,\"optional\":true,\"requires\":{\"is-accessor-descriptor\":\"^0.1.6\",\"is-data-descriptor\":\"^0.1.4\",\"kind-of\":\"^5.0.0\"},\"dependencies\":{\"kind-of\":{\"version\":\"5.1.0\",\"resolved\":\"https://registry.npmmirror.com/kind-of/-/kind-of-5.1.0.tgz\",\"integrity\":\"sha512-NGEErnH6F2vUuXDh+OlbcKW7/wOcfdRHaZ7VWtqCztfHri/++YKmP51OdWeGPuqCOba6kk2OTe5d02VmTB80Pw==\",\"dev\":true,\"optional\":true}}},\"is-dotfile\":{\"version\":\"1.0.3\",\"resolved\":\"https://registry.npmmirror.com/is-dotfile/-/is-dotfile-1.0.3.tgz\",\"integrity\":\"sha512-9YclgOGtN/f8zx0Pr4FQYMdibBiTaH3sn52vjYip4ZSf6C4/6RfTEZ+MR4GvKhCxdPh21Bg42/WL55f6KSnKpg==\",\"dev\":true,\"optional\":true},\"is-equal-shallow\":{\"version\":\"0.1.3\",\"resolved\":\"https://registry.npmmirror.com/is-equal-shallow/-/is-equal-shallow-0.1.3.tgz\",\"integrity\":\"sha512-0EygVC5qPvIyb+gSz7zdD5/AAoS6Qrx1e//6N4yv4oNm30kqvdmG66oZFWVlQHUWe5OjP08FuTw2IdT0EOTcYA==\",\"dev\":true,\"optional\":true,\"requires\":{\"is-primitive\":\"^2.0.0\"}},\"is-extendable\":{\"version\":\"0.1.1\",\"resolved\":\"https://registry.npmmirror.com/is-extendable/-/is-extendable-0.1.1.tgz\",\"integrity\":\"sha512-5BMULNob1vgFX6EjQw5izWDxrecWK9AM72rugNr0TFldMOi0fj6Jk+zeKIt0xGj4cEfQIJth4w3OKWOJ4f+AFw==\",\"dev\":true,\"optional\":true},\"is-extglob\":{\"version\":\"1.0.0\",\"resolved\":\"https://registry.npmmirror.com/is-extglob/-/is-extglob-1.0.0.tgz\",\"integrity\":\"sha512-7Q+VbVafe6x2T+Tu6NcOf6sRklazEPmBoB3IWk3WdGZM2iGUwU/Oe3Wtq5lSEkDTTlpp8yx+5t4pzO/i9Ty1ww==\",\"dev\":true,\"optional\":true},\"is-finite\":{\"version\":\"1.1.0\",\"resolved\":\"https://registry.npmmirror.com/is-finite/-/is-finite-1.1.0.tgz\",\"integrity\":\"sha512-cdyMtqX/BOqqNBBiKlIVkytNHm49MtMlYyn1zxzvJKWmFMlGzm+ry5BBfYyeY9YmNKbRSo/o7OX9w9ale0wg3w==\",\"dev\":true},\"is-glob\":{\"version\":\"2.0.1\",\"resolved\":\"https://registry.npmmirror.com/is-glob/-/is-glob-2.0.1.tgz\",\"integrity\":\"sha512-a1dBeB19NXsf/E0+FHqkagizel/LQw2DjSQpvQrj3zT+jYPpaUCryPnrQajXKFLCMuf4I6FhRpaGtw4lPrG6Eg==\",\"dev\":true,\"optional\":true,\"requires\":{\"is-extglob\":\"^1.0.0\"}},\"is-number\":{\"version\":\"2.1.0\",\"resolved\":\"https://registry.npmmirror.com/is-number/-/is-number-2.1.0.tgz\",\"integrity\":\"sha512-QUzH43Gfb9+5yckcrSA0VBDwEtDUchrk4F6tfJZQuNzDJbEDB9cZNzSfXGQ1jqmdDY/kl41lUOWM9syA8z8jlg==\",\"dev\":true,\"optional\":true,\"requires\":{\"kind-of\":\"^3.0.2\"}},\"is-plain-object\":{\"version\":\"2.0.4\",\"resolved\":\"https://registry.npmmirror.com/is-plain-object/-/is-plain-object-2.0.4.tgz\",\"integrity\":\"sha512-h5PpgXkWitc38BBMYawTYMWJHFZJVnBquFE57xFpjB8pJFiF6gZ+bU+WyI/yqXiFR5mdLsgYNaPe8uao6Uv9Og==\",\"dev\":true,\"optional\":true,\"requires\":{\"isobject\":\"^3.0.1\"},\"dependencies\":{\"isobject\":{\"version\":\"3.0.1\",\"resolved\":\"https://registry.npmmirror.com/isobject/-/isobject-3.0.1.tgz\",\"integrity\":\"sha512-WhB9zCku7EGTj/HQQRz5aUQEUeoQZH2bWcltRErOpymJ4boYE6wL9Tbr23krRPSZ+C5zqNSrSw+Cc7sZZ4b7vg==\",\"dev\":true,\"optional\":true}}},\"is-posix-bracket\":{\"version\":\"0.1.1\",\"resolved\":\"https://registry.npmmirror.com/is-posix-bracket/-/is-posix-bracket-0.1.1.tgz\",\"integrity\":\"sha512-Yu68oeXJ7LeWNmZ3Zov/xg/oDBnBK2RNxwYY1ilNJX+tKKZqgPK+qOn/Gs9jEu66KDY9Netf5XLKNGzas/vPfQ==\",\"dev\":true,\"optional\":true},\"is-primitive\":{\"version\":\"2.0.0\",\"resolved\":\"https://registry.npmmirror.com/is-primitive/-/is-primitive-2.0.0.tgz\",\"integrity\":\"sha512-N3w1tFaRfk3UrPfqeRyD+GYDASU3W5VinKhlORy8EWVf/sIdDL9GAcew85XmktCfH+ngG7SRXEVDoO18WMdB/Q==\",\"dev\":true,\"optional\":true},\"is-windows\":{\"version\":\"1.0.2\",\"resolved\":\"https://registry.npmmirror.com/is-windows/-/is-windows-1.0.2.tgz\",\"integrity\":\"sha512-eXK1UInq2bPmjyX6e3VHIzMLobc4J94i4AWn+Hpq3OU5KkrRC96OAcR3PRJ/pGu6m8TRnBHP9dkXQVsT/COVIA==\",\"dev\":true,\"optional\":true},\"isarray\":{\"version\":\"1.0.0\",\"resolved\":\"https://registry.npmmirror.com/isarray/-/isarray-1.0.0.tgz\",\"integrity\":\"sha512-VLghIWNM6ELQzo7zwmcg0NmTVyWKYjvIeM83yjp0wRDTmUnrM678fQbcKBo6n2CJEF0szoG//ytg+TKla89ALQ==\",\"dev\":true,\"optional\":true},\"isobject\":{\"version\":\"2.1.0\",\"resolved\":\"https://registry.npmmirror.com/isobject/-/isobject-2.1.0.tgz\",\"integrity\":\"sha512-+OUdGJlgjOBZDfxnDjYYG6zp487z0JGNQq3cYQYg5f5hKR+syHMsaztzGeml/4kGG55CSpKSpWTY+jYGgsHLgA==\",\"dev\":true,\"optional\":true,\"requires\":{\"isarray\":\"1.0.0\"}},\"js-tokens\":{\"version\":\"3.0.2\",\"resolved\":\"https://registry.npmmirror.com/js-tokens/-/js-tokens-3.0.2.tgz\",\"integrity\":\"sha512-RjTcuD4xjtthQkaWH7dFlH85L+QaVtSoOyGdZ3g6HFhS9dFNDfLyqgm2NFe2X6cQpeFmt0452FJjFG5UameExg==\",\"dev\":true},\"jsesc\":{\"version\":\"1.3.0\",\"resolved\":\"https://registry.npmmirror.com/jsesc/-/jsesc-1.3.0.tgz\",\"integrity\":\"sha512-Mke0DA0QjUWuJlhsE0ZPPhYiJkRap642SmI/4ztCFaUs6V2AiH1sfecc+57NgaryfAA2VR3v6O+CSjC1jZJKOA==\",\"dev\":true},\"json5\":{\"version\":\"0.5.1\",\"resolved\":\"https://registry.npmmirror.com/json5/-/json5-0.5.1.tgz\",\"integrity\":\"sha512-4xrs1aW+6N5DalkqSVA8fxh458CXvR99WU8WLKmq4v8eWAL86Xo3BVqyd3SkA9wEVjCMqyvvRRkshAdOnBp5rw==\",\"dev\":true},\"kind-of\":{\"version\":\"3.2.2\",\"resolved\":\"https://registry.npmmirror.com/kind-of/-/kind-of-3.2.2.tgz\",\"integrity\":\"sha512-NOW9QQXMoZGg/oqnVNoNTTIFEIid1627WCffUBJEdMxYApq7mNE7CpzucIPc+ZQg25Phej7IJSmX3hO+oblOtQ==\",\"dev\":true,\"optional\":true,\"requires\":{\"is-buffer\":\"^1.1.5\"}},\"lodash\":{\"version\":\"4.17.21\",\"resolved\":\"https://registry.npmmirror.com/lodash/-/lodash-4.17.21.tgz\",\"integrity\":\"sha512-v2kDEe57lecTulaDIuNTPy3Ry4gLGJ6Z1O3vE1krgXZNrsQ+LFTGHVxVjcXPs17LhbZVGedAJv8XZ1tvj5FvSg==\",\"dev\":true},\"loose-envify\":{\"version\":\"1.4.0\",\"resolved\":\"https://registry.npmmirror.com/loose-envify/-/loose-envify-1.4.0.tgz\",\"integrity\":\"sha512-lyuxPGr/Wfhrlem2CL/UcnUc1zcqKAImBDzukY7Y5F/yQiNdko6+fRLevlw1HgMySw7f611UIY408EtxRSoK3Q==\",\"dev\":true,\"requires\":{\"js-tokens\":\"^3.0.0 || ^4.0.0\"}},\"map-cache\":{\"version\":\"0.2.2\",\"resolved\":\"https://registry.npmmirror.com/map-cache/-/map-cache-0.2.2.tgz\",\"integrity\":\"sha512-8y/eV9QQZCiyn1SprXSrCmqJN0yNRATe+PO8ztwqrvrbdRLA3eYJF0yaR0YayLWkMbsQSKWS9N2gPcGEc4UsZg==\",\"dev\":true,\"optional\":true},\"map-visit\":{\"version\":\"1.0.0\",\"resolved\":\"https://registry.npmmirror.com/map-visit/-/map-visit-1.0.0.tgz\",\"integrity\":\"sha512-4y7uGv8bd2WdM9vpQsiQNo41Ln1NvhvDRuVt0k2JZQ+ezN2uaQes7lZeZ+QQUHOLQAtDaBJ+7wCbi+ab/KFs+w==\",\"dev\":true,\"optional\":true,\"requires\":{\"object-visit\":\"^1.0.0\"}},\"math-random\":{\"version\":\"1.0.4\",\"resolved\":\"https://registry.npmmirror.com/math-random/-/math-random-1.0.4.tgz\",\"integrity\":\"sha512-rUxjysqif/BZQH2yhd5Aaq7vXMSx9NdEsQcyA07uEzIvxgI7zIr33gGsh+RU0/XjmQpCW7RsVof1vlkvQVCK5A==\",\"dev\":true,\"optional\":true},\"micromatch\":{\"version\":\"2.3.11\",\"resolved\":\"https://registry.npmmirror.com/micromatch/-/micromatch-2.3.11.tgz\",\"integrity\":\"sha512-LnU2XFEk9xxSJ6rfgAry/ty5qwUTyHYOBU0g4R6tIw5ljwgGIBmiKhRWLw5NpMOnrgUNcDJ4WMp8rl3sYVHLNA==\",\"dev\":true,\"optional\":true,\"requires\":{\"arr-diff\":\"^2.0.0\",\"array-unique\":\"^0.2.1\",\"braces\":\"^1.8.2\",\"expand-brackets\":\"^0.1.4\",\"extglob\":\"^0.3.1\",\"filename-regex\":\"^2.0.0\",\"is-extglob\":\"^1.0.0\",\"is-glob\":\"^2.0.1\",\"kind-of\":\"^3.0.2\",\"normalize-path\":\"^2.0.1\",\"object.omit\":\"^2.0.0\",\"parse-glob\":\"^3.0.4\",\"regex-cache\":\"^0.4.2\"}},\"minimatch\":{\"version\":\"3.1.2\",\"resolved\":\"https://registry.npmmirror.com/minimatch/-/minimatch-3.1.2.tgz\",\"integrity\":\"sha512-J7p63hRiAjw1NDEww1W7i37+ByIrOWO5XQQAzZ3VOcL0PNybwpfmV/N05zFAzwQ9USyEcX6t3UO+K5aqBQOIHw==\",\"dev\":true,\"requires\":{\"brace-expansion\":\"^1.1.7\"}},\"minimist\":{\"version\":\"1.2.8\",\"resolved\":\"https://registry.npmmirror.com/minimist/-/minimist-1.2.8.tgz\",\"integrity\":\"sha512-2yyAR8qBkN3YuheJanUpWC5U3bb5osDywNB8RzDVlDwDHbocAJveqqj1u8+SVD7jkWT4yvsHCpWqqWqAxb0zCA==\",\"dev\":true},\"mixin-deep\":{\"version\":\"1.3.2\",\"resolved\":\"https://registry.npmmirror.com/mixin-deep/-/mixin-deep-1.3.2.tgz\",\"integrity\":\"sha512-WRoDn//mXBiJ1H40rqa3vH0toePwSsGb45iInWlTySa+Uu4k3tYUSxa2v1KqAiLtvlrSzaExqS1gtk96A9zvEA==\",\"dev\":true,\"optional\":true,\"requires\":{\"for-in\":\"^1.0.2\",\"is-extendable\":\"^1.0.1\"},\"dependencies\":{\"is-extendable\":{\"version\":\"1.0.1\",\"resolved\":\"https://registry.npmmirror.com/is-extendable/-/is-extendable-1.0.1.tgz\",\"integrity\":\"sha512-arnXMxT1hhoKo9k1LZdmlNyJdDDfy2v0fXjFlmok4+i8ul/6WlbVge9bhM74OpNPQPMGUToDtz+KXa1PneJxOA==\",\"dev\":true,\"optional\":true,\"requires\":{\"is-plain-object\":\"^2.0.4\"}}}},\"mkdirp\":{\"version\":\"0.5.6\",\"resolved\":\"https://registry.npmmirror.com/mkdirp/-/mkdirp-0.5.6.tgz\",\"integrity\":\"sha512-FP+p8RB8OWpF3YZBCrP5gtADmtXApB5AMLn+vdyA+PyxCjrCs00mjyUozssO33cwDeT3wNGdLxJ5M//YqtHAJw==\",\"dev\":true,\"requires\":{\"minimist\":\"^1.2.6\"}},\"ms\":{\"version\":\"2.0.0\",\"resolved\":\"https://registry.npmmirror.com/ms/-/ms-2.0.0.tgz\",\"integrity\":\"sha512-Tpp60P6IUJDTuOq/5Z8cdskzJujfwqfOTkrwIwj7IRISpnkJnT6SyJ4PCPnGMoFjC9ddhal5KVIYtAt97ix05A==\",\"dev\":true},\"nan\":{\"version\":\"2.17.0\",\"resolved\":\"https://registry.npmmirror.com/nan/-/nan-2.17.0.tgz\",\"integrity\":\"sha512-2ZTgtl0nJsO0KQCjEpxcIr5D+Yv90plTitZt9JBfQvVJDS5seMl3FOvsh3+9CoYWXf/1l5OaZzzF6nDm4cagaQ==\",\"dev\":true,\"optional\":true},\"nanomatch\":{\"version\":\"1.2.13\",\"resolved\":\"https://registry.npmmirror.com/nanomatch/-/nanomatch-1.2.13.tgz\",\"integrity\":\"sha512-fpoe2T0RbHwBTBUOftAfBPaDEi06ufaUai0mE6Yn1kacc3SnTErfb/h+X94VXzI64rKFHYImXSvdwGGCmwOqCA==\",\"dev\":true,\"optional\":true,\"requires\":{\"arr-diff\":\"^4.0.0\",\"array-unique\":\"^0.3.2\",\"define-property\":\"^2.0.2\",\"extend-shallow\":\"^3.0.2\",\"fragment-cache\":\"^0.2.1\",\"is-windows\":\"^1.0.2\",\"kind-of\":\"^6.0.2\",\"object.pick\":\"^1.3.0\",\"regex-not\":\"^1.0.0\",\"snapdragon\":\"^0.8.1\",\"to-regex\":\"^3.0.1\"},\"dependencies\":{\"arr-diff\":{\"version\":\"4.0.0\",\"resolved\":\"https://registry.npmmirror.com/arr-diff/-/arr-diff-4.0.0.tgz\",\"integrity\":\"sha512-YVIQ82gZPGBebQV/a8dar4AitzCQs0jjXwMPZllpXMaGjXPYVUawSxQrRsjhjupyVxEvbHgUmIhKVlND+j02kA==\",\"dev\":true,\"optional\":true},\"array-unique\":{\"version\":\"0.3.2\",\"resolved\":\"https://registry.npmmirror.com/array-unique/-/array-unique-0.3.2.tgz\",\"integrity\":\"sha512-SleRWjh9JUud2wH1hPs9rZBZ33H6T9HOiL0uwGnGx9FpE6wKGyfWugmbkEOIs6qWrZhg0LWeLziLrEwQJhs5mQ==\",\"dev\":true,\"optional\":true},\"kind-of\":{\"version\":\"6.0.3\",\"resolved\":\"https://registry.npmmirror.com/kind-of/-/kind-of-6.0.3.tgz\",\"integrity\":\"sha512-dcS1ul+9tmeD95T+x28/ehLgd9mENa3LsvDTtzm3vyBEO7RPptvAD+t44WVXaUjTBRcrpFeFlC8WCruUR456hw==\",\"dev\":true,\"optional\":true}}},\"normalize-path\":{\"version\":\"2.1.1\",\"resolved\":\"https://registry.npmmirror.com/normalize-path/-/normalize-path-2.1.1.tgz\",\"integrity\":\"sha512-3pKJwH184Xo/lnH6oyP1q2pMd7HcypqqmRs91/6/i2CGtWwIKGCkOOMTm/zXbgTEWHw1uNpNi/igc3ePOYHb6w==\",\"dev\":true,\"optional\":true,\"requires\":{\"remove-trailing-separator\":\"^1.0.1\"}},\"object-assign\":{\"version\":\"4.1.1\",\"resolved\":\"https://registry.npmmirror.com/object-assign/-/object-assign-4.1.1.tgz\",\"integrity\":\"sha512-rJgTQnkUnH1sFw8yT6VSU3zD3sWmu6sZhIseY8VX+GRu3P6F7Fu+JNDoXfklElbLJSnc3FUQHVe4cU5hj+BcUg==\",\"dev\":true},\"object-copy\":{\"version\":\"0.1.0\",\"resolved\":\"https://registry.npmmirror.com/object-copy/-/object-copy-0.1.0.tgz\",\"integrity\":\"sha512-79LYn6VAb63zgtmAteVOWo9Vdj71ZVBy3Pbse+VqxDpEP83XuujMrGqHIwAXJ5I/aM0zU7dIyIAhifVTPrNItQ==\",\"dev\":true,\"optional\":true,\"requires\":{\"copy-descriptor\":\"^0.1.0\",\"define-property\":\"^0.2.5\",\"kind-of\":\"^3.0.3\"},\"dependencies\":{\"define-property\":{\"version\":\"0.2.5\",\"resolved\":\"https://registry.npmmirror.com/define-property/-/define-property-0.2.5.tgz\",\"integrity\":\"sha512-Rr7ADjQZenceVOAKop6ALkkRAmH1A4Gx9hV/7ZujPUN2rkATqFO0JZLZInbAjpZYoJ1gUx8MRMQVkYemcbMSTA==\",\"dev\":true,\"optional\":true,\"requires\":{\"is-descriptor\":\"^0.1.0\"}}}},\"object-visit\":{\"version\":\"1.0.1\",\"resolved\":\"https://registry.npmmirror.com/object-visit/-/object-visit-1.0.1.tgz\",\"integrity\":\"sha512-GBaMwwAVK9qbQN3Scdo0OyvgPW7l3lnaVMj84uTOZlswkX0KpF6fyDBJhtTthf7pymztoN36/KEr1DyhF96zEA==\",\"dev\":true,\"optional\":true,\"requires\":{\"isobject\":\"^3.0.0\"},\"dependencies\":{\"isobject\":{\"version\":\"3.0.1\",\"resolved\":\"https://registry.npmmirror.com/isobject/-/isobject-3.0.1.tgz\",\"integrity\":\"sha512-WhB9zCku7EGTj/HQQRz5aUQEUeoQZH2bWcltRErOpymJ4boYE6wL9Tbr23krRPSZ+C5zqNSrSw+Cc7sZZ4b7vg==\",\"dev\":true,\"optional\":true}}},\"object.omit\":{\"version\":\"2.0.1\",\"resolved\":\"https://registry.npmmirror.com/object.omit/-/object.omit-2.0.1.tgz\",\"integrity\":\"sha512-UiAM5mhmIuKLsOvrL+B0U2d1hXHF3bFYWIuH1LMpuV2EJEHG1Ntz06PgLEHjm6VFd87NpH8rastvPoyv6UW2fA==\",\"dev\":true,\"optional\":true,\"requires\":{\"for-own\":\"^0.1.4\",\"is-extendable\":\"^0.1.1\"}},\"object.pick\":{\"version\":\"1.3.0\",\"resolved\":\"https://registry.npmmirror.com/object.pick/-/object.pick-1.3.0.tgz\",\"integrity\":\"sha512-tqa/UMy/CCoYmj+H5qc07qvSL9dqcs/WZENZ1JbtWBlATP+iVOe778gE6MSijnyCnORzDuX6hU+LA4SZ09YjFQ==\",\"dev\":true,\"optional\":true,\"requires\":{\"isobject\":\"^3.0.1\"},\"dependencies\":{\"isobject\":{\"version\":\"3.0.1\",\"resolved\":\"https://registry.npmmirror.com/isobject/-/isobject-3.0.1.tgz\",\"integrity\":\"sha512-WhB9zCku7EGTj/HQQRz5aUQEUeoQZH2bWcltRErOpymJ4boYE6wL9Tbr23krRPSZ+C5zqNSrSw+Cc7sZZ4b7vg==\",\"dev\":true,\"optional\":true}}},\"once\":{\"version\":\"1.4.0\",\"resolved\":\"https://registry.npmmirror.com/once/-/once-1.4.0.tgz\",\"integrity\":\"sha512-lNaJgI+2Q5URQBkccEKHTQOPaXdUxnZZElQTZY0MFUAuaEqe1E+Nyvgdz/aIyNi6Z9MzO5dv1H8n58/GELp3+w==\",\"dev\":true,\"requires\":{\"wrappy\":\"1\"}},\"os-homedir\":{\"version\":\"1.0.2\",\"resolved\":\"https://registry.npmmirror.com/os-homedir/-/os-homedir-1.0.2.tgz\",\"integrity\":\"sha512-B5JU3cabzk8c67mRRd3ECmROafjYMXbuzlwtqdM8IbS8ktlTix8aFGb2bAGKrSRIlnfKwovGUUr72JUPyOb6kQ==\",\"dev\":true},\"os-tmpdir\":{\"version\":\"1.0.2\",\"resolved\":\"https://registry.npmmirror.com/os-tmpdir/-/os-tmpdir-1.0.2.tgz\",\"integrity\":\"sha512-D2FR03Vir7FIu45XBY20mTb+/ZSWB00sjU9jdQXt83gDrI4Ztz5Fs7/yy74g2N5SVQY4xY1qDr4rNddwYRVX0g==\",\"dev\":true},\"output-file-sync\":{\"version\":\"1.1.2\",\"resolved\":\"https://registry.npmmirror.com/output-file-sync/-/output-file-sync-1.1.2.tgz\",\"integrity\":\"sha512-uQLlclru4xpCi+tfs80l3QF24KL81X57ELNMy7W/dox+JTtxUf1bLyQ8968fFCmSqqbokjW0kn+WBIlO+rSkNg==\",\"dev\":true,\"requires\":{\"graceful-fs\":\"^4.1.4\",\"mkdirp\":\"^0.5.1\",\"object-assign\":\"^4.1.0\"}},\"parse-glob\":{\"version\":\"3.0.4\",\"resolved\":\"https://registry.npmmirror.com/parse-glob/-/parse-glob-3.0.4.tgz\",\"integrity\":\"sha512-FC5TeK0AwXzq3tUBFtH74naWkPQCEWs4K+xMxWZBlKDWu0bVHXGZa+KKqxKidd7xwhdZ19ZNuF2uO1M/r196HA==\",\"dev\":true,\"optional\":true,\"requires\":{\"glob-base\":\"^0.3.0\",\"is-dotfile\":\"^1.0.0\",\"is-extglob\":\"^1.0.0\",\"is-glob\":\"^2.0.0\"}},\"pascalcase\":{\"version\":\"0.1.1\",\"resolved\":\"https://registry.npmmirror.com/pascalcase/-/pascalcase-0.1.1.tgz\",\"integrity\":\"sha512-XHXfu/yOQRy9vYOtUDVMN60OEJjW013GoObG1o+xwQTpB9eYJX/BjXMsdW13ZDPruFhYYn0AG22w0xgQMwl3Nw==\",\"dev\":true,\"optional\":true},\"path-is-absolute\":{\"version\":\"1.0.1\",\"resolved\":\"https://registry.npmmirror.com/path-is-absolute/-/path-is-absolute-1.0.1.tgz\",\"integrity\":\"sha512-AVbw3UJ2e9bq64vSaS9Am0fje1Pa8pbGqTTsmXfaIiMpnr5DlDhfJOuLj9Sf95ZPVDAUerDfEk88MPmPe7UCQg==\",\"dev\":true},\"posix-character-classes\":{\"version\":\"0.1.1\",\"resolved\":\"https://registry.npmmirror.com/posix-character-classes/-/posix-character-classes-0.1.1.tgz\",\"integrity\":\"sha512-xTgYBc3fuo7Yt7JbiuFxSYGToMoz8fLoE6TC9Wx1P/u+LfeThMOAqmuyECnlBaaJb+u1m9hHiXUEtwW4OzfUJg==\",\"dev\":true,\"optional\":true},\"preserve\":{\"version\":\"0.2.0\",\"resolved\":\"https://registry.npmmirror.com/preserve/-/preserve-0.2.0.tgz\",\"integrity\":\"sha512-s/46sYeylUfHNjI+sA/78FAHlmIuKqI9wNnzEOGehAlUUYeObv5C2mOinXBjyUyWmJ2SfcS2/ydApH4hTF4WXQ==\",\"dev\":true,\"optional\":true},\"private\":{\"version\":\"0.1.8\",\"resolved\":\"https://registry.npmmirror.com/private/-/private-0.1.8.tgz\",\"integrity\":\"sha512-VvivMrbvd2nKkiG38qjULzlc+4Vx4wm/whI9pQD35YrARNnhxeiRktSOhSukRLFNlzg6Br/cJPet5J/u19r/mg==\",\"dev\":true},\"process-nextick-args\":{\"version\":\"2.0.1\",\"resolved\":\"https://registry.npmmirror.com/process-nextick-args/-/process-nextick-args-2.0.1.tgz\",\"integrity\":\"sha512-3ouUOpQhtgrbOa17J7+uxOTpITYWaGP7/AhoR3+A+/1e9skrzelGi/dXzEYyvbxubEF6Wn2ypscTKiKJFFn1ag==\",\"dev\":true,\"optional\":true},\"randomatic\":{\"version\":\"3.1.1\",\"resolved\":\"https://registry.npmmirror.com/randomatic/-/randomatic-3.1.1.tgz\",\"integrity\":\"sha512-TuDE5KxZ0J461RVjrJZCJc+J+zCkTb1MbH9AQUq68sMhOMcy9jLcb3BrZKgp9q9Ncltdg4QVqWrH02W2EFFVYw==\",\"dev\":true,\"optional\":true,\"requires\":{\"is-number\":\"^4.0.0\",\"kind-of\":\"^6.0.0\",\"math-random\":\"^1.0.1\"},\"dependencies\":{\"is-number\":{\"version\":\"4.0.0\",\"resolved\":\"https://registry.npmmirror.com/is-number/-/is-number-4.0.0.tgz\",\"integrity\":\"sha512-rSklcAIlf1OmFdyAqbnWTLVelsQ58uvZ66S/ZyawjWqIviTWCjg2PzVGw8WUA+nNuPTqb4wgA+NszrJ+08LlgQ==\",\"dev\":true,\"optional\":true},\"kind-of\":{\"version\":\"6.0.3\",\"resolved\":\"https://registry.npmmirror.com/kind-of/-/kind-of-6.0.3.tgz\",\"integrity\":\"sha512-dcS1ul+9tmeD95T+x28/ehLgd9mENa3LsvDTtzm3vyBEO7RPptvAD+t44WVXaUjTBRcrpFeFlC8WCruUR456hw==\",\"dev\":true,\"optional\":true}}},\"readable-stream\":{\"version\":\"2.3.8\",\"resolved\":\"https://registry.npmmirror.com/readable-stream/-/readable-stream-2.3.8.tgz\",\"integrity\":\"sha512-8p0AUk4XODgIewSi0l8Epjs+EVnWiK7NoDIEGU0HhE7+ZyY8D1IMY7odu5lRrFXGg71L15KG8QrPmum45RTtdA==\",\"dev\":true,\"optional\":true,\"requires\":{\"core-util-is\":\"~1.0.0\",\"inherits\":\"~2.0.3\",\"isarray\":\"~1.0.0\",\"process-nextick-args\":\"~2.0.0\",\"safe-buffer\":\"~5.1.1\",\"string_decoder\":\"~1.1.1\",\"util-deprecate\":\"~1.0.1\"}},\"readdirp\":{\"version\":\"2.2.1\",\"resolved\":\"https://registry.npmmirror.com/readdirp/-/readdirp-2.2.1.tgz\",\"integrity\":\"sha512-1JU/8q+VgFZyxwrJ+SVIOsh+KywWGpds3NTqikiKpDMZWScmAYyKIgqkO+ARvNWJfXeXR1zxz7aHF4u4CyH6vQ==\",\"dev\":true,\"optional\":true,\"requires\":{\"graceful-fs\":\"^4.1.11\",\"micromatch\":\"^3.1.10\",\"readable-stream\":\"^2.0.2\"},\"dependencies\":{\"arr-diff\":{\"version\":\"4.0.0\",\"resolved\":\"https://registry.npmmirror.com/arr-diff/-/arr-diff-4.0.0.tgz\",\"integrity\":\"sha512-YVIQ82gZPGBebQV/a8dar4AitzCQs0jjXwMPZllpXMaGjXPYVUawSxQrRsjhjupyVxEvbHgUmIhKVlND+j02kA==\",\"dev\":true,\"optional\":true},\"array-unique\":{\"version\":\"0.3.2\",\"resolved\":\"https://registry.npmmirror.com/array-unique/-/array-unique-0.3.2.tgz\",\"integrity\":\"sha512-SleRWjh9JUud2wH1hPs9rZBZ33H6T9HOiL0uwGnGx9FpE6wKGyfWugmbkEOIs6qWrZhg0LWeLziLrEwQJhs5mQ==\",\"dev\":true,\"optional\":true},\"braces\":{\"version\":\"2.3.2\",\"resolved\":\"https://registry.npmmirror.com/braces/-/braces-2.3.2.tgz\",\"integrity\":\"sha512-aNdbnj9P8PjdXU4ybaWLK2IF3jc/EoDYbC7AazW6to3TRsfXxscC9UXOB5iDiEQrkyIbWp2SLQda4+QAa7nc3w==\",\"dev\":true,\"optional\":true,\"requires\":{\"arr-flatten\":\"^1.1.0\",\"array-unique\":\"^0.3.2\",\"extend-shallow\":\"^2.0.1\",\"fill-range\":\"^4.0.0\",\"isobject\":\"^3.0.1\",\"repeat-element\":\"^1.1.2\",\"snapdragon\":\"^0.8.1\",\"snapdragon-node\":\"^2.0.1\",\"split-string\":\"^3.0.2\",\"to-regex\":\"^3.0.1\"},\"dependencies\":{\"extend-shallow\":{\"version\":\"2.0.1\",\"resolved\":\"https://registry.npmmirror.com/extend-shallow/-/extend-shallow-2.0.1.tgz\",\"integrity\":\"sha512-zCnTtlxNoAiDc3gqY2aYAWFx7XWWiasuF2K8Me5WbN8otHKTUKBwjPtNpRs/rbUZm7KxWAaNj7P1a/p52GbVug==\",\"dev\":true,\"optional\":true,\"requires\":{\"is-extendable\":\"^0.1.0\"}}}},\"expand-brackets\":{\"version\":\"2.1.4\",\"resolved\":\"https://registry.npmmirror.com/expand-brackets/-/expand-brackets-2.1.4.tgz\",\"integrity\":\"sha512-w/ozOKR9Obk3qoWeY/WDi6MFta9AoMR+zud60mdnbniMcBxRuFJyDt2LdX/14A1UABeqk+Uk+LDfUpvoGKppZA==\",\"dev\":true,\"optional\":true,\"requires\":{\"debug\":\"^2.3.3\",\"define-property\":\"^0.2.5\",\"extend-shallow\":\"^2.0.1\",\"posix-character-classes\":\"^0.1.0\",\"regex-not\":\"^1.0.0\",\"snapdragon\":\"^0.8.1\",\"to-regex\":\"^3.0.1\"},\"dependencies\":{\"define-property\":{\"version\":\"0.2.5\",\"resolved\":\"https://registry.npmmirror.com/define-property/-/define-property-0.2.5.tgz\",\"integrity\":\"sha512-Rr7ADjQZenceVOAKop6ALkkRAmH1A4Gx9hV/7ZujPUN2rkATqFO0JZLZInbAjpZYoJ1gUx8MRMQVkYemcbMSTA==\",\"dev\":true,\"optional\":true,\"requires\":{\"is-descriptor\":\"^0.1.0\"}},\"extend-shallow\":{\"version\":\"2.0.1\",\"resolved\":\"https://registry.npmmirror.com/extend-shallow/-/extend-shallow-2.0.1.tgz\",\"integrity\":\"sha512-zCnTtlxNoAiDc3gqY2aYAWFx7XWWiasuF2K8Me5WbN8otHKTUKBwjPtNpRs/rbUZm7KxWAaNj7P1a/p52GbVug==\",\"dev\":true,\"optional\":true,\"requires\":{\"is-extendable\":\"^0.1.0\"}},\"is-accessor-descriptor\":{\"version\":\"0.1.6\",\"resolved\":\"https://registry.npmmirror.com/is-accessor-descriptor/-/is-accessor-descriptor-0.1.6.tgz\",\"integrity\":\"sha512-e1BM1qnDbMRG3ll2U9dSK0UMHuWOs3pY3AtcFsmvwPtKL3MML/Q86i+GilLfvqEs4GW+ExB91tQ3Ig9noDIZ+A==\",\"dev\":true,\"optional\":true,\"requires\":{\"kind-of\":\"^3.0.2\"},\"dependencies\":{\"kind-of\":{\"version\":\"3.2.2\",\"resolved\":\"https://registry.npmmirror.com/kind-of/-/kind-of-3.2.2.tgz\",\"integrity\":\"sha512-NOW9QQXMoZGg/oqnVNoNTTIFEIid1627WCffUBJEdMxYApq7mNE7CpzucIPc+ZQg25Phej7IJSmX3hO+oblOtQ==\",\"dev\":true,\"optional\":true,\"requires\":{\"is-buffer\":\"^1.1.5\"}}}},\"is-data-descriptor\":{\"version\":\"0.1.4\",\"resolved\":\"https://registry.npmmirror.com/is-data-descriptor/-/is-data-descriptor-0.1.4.tgz\",\"integrity\":\"sha512-+w9D5ulSoBNlmw9OHn3U2v51SyoCd0he+bB3xMl62oijhrspxowjU+AIcDY0N3iEJbUEkB15IlMASQsxYigvXg==\",\"dev\":true,\"optional\":true,\"requires\":{\"kind-of\":\"^3.0.2\"},\"dependencies\":{\"kind-of\":{\"version\":\"3.2.2\",\"resolved\":\"https://registry.npmmirror.com/kind-of/-/kind-of-3.2.2.tgz\",\"integrity\":\"sha512-NOW9QQXMoZGg/oqnVNoNTTIFEIid1627WCffUBJEdMxYApq7mNE7CpzucIPc+ZQg25Phej7IJSmX3hO+oblOtQ==\",\"dev\":true,\"optional\":true,\"requires\":{\"is-buffer\":\"^1.1.5\"}}}},\"is-descriptor\":{\"version\":\"0.1.6\",\"resolved\":\"https://registry.npmmirror.com/is-descriptor/-/is-descriptor-0.1.6.tgz\",\"integrity\":\"sha512-avDYr0SB3DwO9zsMov0gKCESFYqCnE4hq/4z3TdUlukEy5t9C0YRq7HLrsN52NAcqXKaepeCD0n+B0arnVG3Hg==\",\"dev\":true,\"optional\":true,\"requires\":{\"is-accessor-descriptor\":\"^0.1.6\",\"is-data-descriptor\":\"^0.1.4\",\"kind-of\":\"^5.0.0\"}},\"kind-of\":{\"version\":\"5.1.0\",\"resolved\":\"https://registry.npmmirror.com/kind-of/-/kind-of-5.1.0.tgz\",\"integrity\":\"sha512-NGEErnH6F2vUuXDh+OlbcKW7/wOcfdRHaZ7VWtqCztfHri/++YKmP51OdWeGPuqCOba6kk2OTe5d02VmTB80Pw==\",\"dev\":true,\"optional\":true}}},\"extglob\":{\"version\":\"2.0.4\",\"resolved\":\"https://registry.npmmirror.com/extglob/-/extglob-2.0.4.tgz\",\"integrity\":\"sha512-Nmb6QXkELsuBr24CJSkilo6UHHgbekK5UiZgfE6UHD3Eb27YC6oD+bhcT+tJ6cl8dmsgdQxnWlcry8ksBIBLpw==\",\"dev\":true,\"optional\":true,\"requires\":{\"array-unique\":\"^0.3.2\",\"define-property\":\"^1.0.0\",\"expand-brackets\":\"^2.1.4\",\"extend-shallow\":\"^2.0.1\",\"fragment-cache\":\"^0.2.1\",\"regex-not\":\"^1.0.0\",\"snapdragon\":\"^0.8.1\",\"to-regex\":\"^3.0.1\"},\"dependencies\":{\"define-property\":{\"version\":\"1.0.0\",\"resolved\":\"https://registry.npmmirror.com/define-property/-/define-property-1.0.0.tgz\",\"integrity\":\"sha512-cZTYKFWspt9jZsMscWo8sc/5lbPC9Q0N5nBLgb+Yd915iL3udB1uFgS3B8YCx66UVHq018DAVFoee7x+gxggeA==\",\"dev\":true,\"optional\":true,\"requires\":{\"is-descriptor\":\"^1.0.0\"}},\"extend-shallow\":{\"version\":\"2.0.1\",\"resolved\":\"https://registry.npmmirror.com/extend-shallow/-/extend-shallow-2.0.1.tgz\",\"integrity\":\"sha512-zCnTtlxNoAiDc3gqY2aYAWFx7XWWiasuF2K8Me5WbN8otHKTUKBwjPtNpRs/rbUZm7KxWAaNj7P1a/p52GbVug==\",\"dev\":true,\"optional\":true,\"requires\":{\"is-extendable\":\"^0.1.0\"}}}},\"fill-range\":{\"version\":\"4.0.0\",\"resolved\":\"https://registry.npmmirror.com/fill-range/-/fill-range-4.0.0.tgz\",\"integrity\":\"sha512-VcpLTWqWDiTerugjj8e3+esbg+skS3M9e54UuR3iCeIDMXCLTsAH8hTSzDQU/X6/6t3eYkOKoZSef2PlU6U1XQ==\",\"dev\":true,\"optional\":true,\"requires\":{\"extend-shallow\":\"^2.0.1\",\"is-number\":\"^3.0.0\",\"repeat-string\":\"^1.6.1\",\"to-regex-range\":\"^2.1.0\"},\"dependencies\":{\"extend-shallow\":{\"version\":\"2.0.1\",\"resolved\":\"https://registry.npmmirror.com/extend-shallow/-/extend-shallow-2.0.1.tgz\",\"integrity\":\"sha512-zCnTtlxNoAiDc3gqY2aYAWFx7XWWiasuF2K8Me5WbN8otHKTUKBwjPtNpRs/rbUZm7KxWAaNj7P1a/p52GbVug==\",\"dev\":true,\"optional\":true,\"requires\":{\"is-extendable\":\"^0.1.0\"}}}},\"is-accessor-descriptor\":{\"version\":\"1.0.0\",\"resolved\":\"https://registry.npmmirror.com/is-accessor-descriptor/-/is-accessor-descriptor-1.0.0.tgz\",\"integrity\":\"sha512-m5hnHTkcVsPfqx3AKlyttIPb7J+XykHvJP2B9bZDjlhLIoEq4XoK64Vg7boZlVWYK6LUY94dYPEE7Lh0ZkZKcQ==\",\"dev\":true,\"optional\":true,\"requires\":{\"kind-of\":\"^6.0.0\"}},\"is-data-descriptor\":{\"version\":\"1.0.0\",\"resolved\":\"https://registry.npmmirror.com/is-data-descriptor/-/is-data-descriptor-1.0.0.tgz\",\"integrity\":\"sha512-jbRXy1FmtAoCjQkVmIVYwuuqDFUbaOeDjmed1tOGPrsMhtJA4rD9tkgA0F1qJ3gRFRXcHYVkdeaP50Q5rE/jLQ==\",\"dev\":true,\"optional\":true,\"requires\":{\"kind-of\":\"^6.0.0\"}},\"is-descriptor\":{\"version\":\"1.0.2\",\"resolved\":\"https://registry.npmmirror.com/is-descriptor/-/is-descriptor-1.0.2.tgz\",\"integrity\":\"sha512-2eis5WqQGV7peooDyLmNEPUrps9+SXX5c9pL3xEB+4e9HnGuDa7mB7kHxHw4CbqS9k1T2hOH3miL8n8WtiYVtg==\",\"dev\":true,\"optional\":true,\"requires\":{\"is-accessor-descriptor\":\"^1.0.0\",\"is-data-descriptor\":\"^1.0.0\",\"kind-of\":\"^6.0.2\"}},\"is-number\":{\"version\":\"3.0.0\",\"resolved\":\"https://registry.npmmirror.com/is-number/-/is-number-3.0.0.tgz\",\"integrity\":\"sha512-4cboCqIpliH+mAvFNegjZQ4kgKc3ZUhQVr3HvWbSh5q3WH2v82ct+T2Y1hdU5Gdtorx/cLifQjqCbL7bpznLTg==\",\"dev\":true,\"optional\":true,\"requires\":{\"kind-of\":\"^3.0.2\"},\"dependencies\":{\"kind-of\":{\"version\":\"3.2.2\",\"resolved\":\"https://registry.npmmirror.com/kind-of/-/kind-of-3.2.2.tgz\",\"integrity\":\"sha512-NOW9QQXMoZGg/oqnVNoNTTIFEIid1627WCffUBJEdMxYApq7mNE7CpzucIPc+ZQg25Phej7IJSmX3hO+oblOtQ==\",\"dev\":true,\"optional\":true,\"requires\":{\"is-buffer\":\"^1.1.5\"}}}},\"isobject\":{\"version\":\"3.0.1\",\"resolved\":\"https://registry.npmmirror.com/isobject/-/isobject-3.0.1.tgz\",\"integrity\":\"sha512-WhB9zCku7EGTj/HQQRz5aUQEUeoQZH2bWcltRErOpymJ4boYE6wL9Tbr23krRPSZ+C5zqNSrSw+Cc7sZZ4b7vg==\",\"dev\":true,\"optional\":true},\"kind-of\":{\"version\":\"6.0.3\",\"resolved\":\"https://registry.npmmirror.com/kind-of/-/kind-of-6.0.3.tgz\",\"integrity\":\"sha512-dcS1ul+9tmeD95T+x28/ehLgd9mENa3LsvDTtzm3vyBEO7RPptvAD+t44WVXaUjTBRcrpFeFlC8WCruUR456hw==\",\"dev\":true,\"optional\":true},\"micromatch\":{\"version\":\"3.1.10\",\"resolved\":\"https://registry.npmmirror.com/micromatch/-/micromatch-3.1.10.tgz\",\"integrity\":\"sha512-MWikgl9n9M3w+bpsY3He8L+w9eF9338xRl8IAO5viDizwSzziFEyUzo2xrrloB64ADbTf8uA8vRqqttDTOmccg==\",\"dev\":true,\"optional\":true,\"requires\":{\"arr-diff\":\"^4.0.0\",\"array-unique\":\"^0.3.2\",\"braces\":\"^2.3.1\",\"define-property\":\"^2.0.2\",\"extend-shallow\":\"^3.0.2\",\"extglob\":\"^2.0.4\",\"fragment-cache\":\"^0.2.1\",\"kind-of\":\"^6.0.2\",\"nanomatch\":\"^1.2.9\",\"object.pick\":\"^1.3.0\",\"regex-not\":\"^1.0.0\",\"snapdragon\":\"^0.8.1\",\"to-regex\":\"^3.0.2\"}}}},\"regenerate\":{\"version\":\"1.4.2\",\"resolved\":\"https://registry.npmmirror.com/regenerate/-/regenerate-1.4.2.tgz\",\"integrity\":\"sha512-zrceR/XhGYU/d/opr2EKO7aRHUeiBI8qjtfHqADTwZd6Szfy16la6kqD0MIUs5z5hx6AaKa+PixpPrR289+I0A==\",\"dev\":true},\"regenerator-runtime\":{\"version\":\"0.11.1\",\"resolved\":\"https://registry.npmmirror.com/regenerator-runtime/-/regenerator-runtime-0.11.1.tgz\",\"integrity\":\"sha512-MguG95oij0fC3QV3URf4V2SDYGJhJnJGqvIIgdECeODCT98wSWDAJ94SSuVpYQUoTcGUIL6L4yNB7j1DFFHSBg==\",\"dev\":true},\"regenerator-transform\":{\"version\":\"0.10.1\",\"resolved\":\"https://registry.npmmirror.com/regenerator-transform/-/regenerator-transform-0.10.1.tgz\",\"integrity\":\"sha512-PJepbvDbuK1xgIgnau7Y90cwaAmO/LCLMI2mPvaXq2heGMR3aWW5/BQvYrhJ8jgmQjXewXvBjzfqKcVOmhjZ6Q==\",\"dev\":true,\"requires\":{\"babel-runtime\":\"^6.18.0\",\"babel-types\":\"^6.19.0\",\"private\":\"^0.1.6\"}},\"regex-cache\":{\"version\":\"0.4.4\",\"resolved\":\"https://registry.npmmirror.com/regex-cache/-/regex-cache-0.4.4.tgz\",\"integrity\":\"sha512-nVIZwtCjkC9YgvWkpM55B5rBhBYRZhAaJbgcFYXXsHnbZ9UZI9nnVWYZpBlCqv9ho2eZryPnWrZGsOdPwVWXWQ==\",\"dev\":true,\"optional\":true,\"requires\":{\"is-equal-shallow\":\"^0.1.3\"}},\"regex-not\":{\"version\":\"1.0.2\",\"resolved\":\"https://registry.npmmirror.com/regex-not/-/regex-not-1.0.2.tgz\",\"integrity\":\"sha512-J6SDjUgDxQj5NusnOtdFxDwN/+HWykR8GELwctJ7mdqhcyy1xEc4SRFHUXvxTp661YaVKAjfRLZ9cCqS6tn32A==\",\"dev\":true,\"optional\":true,\"requires\":{\"extend-shallow\":\"^3.0.2\",\"safe-regex\":\"^1.1.0\"}},\"regexpu-core\":{\"version\":\"2.0.0\",\"resolved\":\"https://registry.npmmirror.com/regexpu-core/-/regexpu-core-2.0.0.tgz\",\"integrity\":\"sha512-tJ9+S4oKjxY8IZ9jmjnp/mtytu1u3iyIQAfmI51IKWH6bFf7XR1ybtaO6j7INhZKXOTYADk7V5qxaqLkmNxiZQ==\",\"dev\":true,\"requires\":{\"regenerate\":\"^1.2.1\",\"regjsgen\":\"^0.2.0\",\"regjsparser\":\"^0.1.4\"}},\"regjsgen\":{\"version\":\"0.2.0\",\"resolved\":\"https://registry.npmmirror.com/regjsgen/-/regjsgen-0.2.0.tgz\",\"integrity\":\"sha512-x+Y3yA24uF68m5GA+tBjbGYo64xXVJpbToBaWCoSNSc1hdk6dfctaRWrNFTVJZIIhL5GxW8zwjoixbnifnK59g==\",\"dev\":true},\"regjsparser\":{\"version\":\"0.1.5\",\"resolved\":\"https://registry.npmmirror.com/regjsparser/-/regjsparser-0.1.5.tgz\",\"integrity\":\"sha512-jlQ9gYLfk2p3V5Ag5fYhA7fv7OHzd1KUH0PRP46xc3TgwjwgROIW572AfYg/X9kaNq/LJnu6oJcFRXlIrGoTRw==\",\"dev\":true,\"requires\":{\"jsesc\":\"~0.5.0\"},\"dependencies\":{\"jsesc\":{\"version\":\"0.5.0\",\"resolved\":\"https://registry.npmmirror.com/jsesc/-/jsesc-0.5.0.tgz\",\"integrity\":\"sha512-uZz5UnB7u4T9LvwmFqXii7pZSouaRPorGs5who1Ip7VO0wxanFvBL7GkM6dTHlgX+jhBApRetaWpnDabOeTcnA==\",\"dev\":true}}},\"remove-trailing-separator\":{\"version\":\"1.1.0\",\"resolved\":\"https://registry.npmmirror.com/remove-trailing-separator/-/remove-trailing-separator-1.1.0.tgz\",\"integrity\":\"sha512-/hS+Y0u3aOfIETiaiirUFwDBDzmXPvO+jAfKTitUngIPzdKc6Z0LoFjM/CK5PL4C+eKwHohlHAb6H0VFfmmUsw==\",\"dev\":true,\"optional\":true},\"repeat-element\":{\"version\":\"1.1.4\",\"resolved\":\"https://registry.npmmirror.com/repeat-element/-/repeat-element-1.1.4.tgz\",\"integrity\":\"sha512-LFiNfRcSu7KK3evMyYOuCzv3L10TW7yC1G2/+StMjK8Y6Vqd2MG7r/Qjw4ghtuCOjFvlnms/iMmLqpvW/ES/WQ==\",\"dev\":true,\"optional\":true},\"repeat-string\":{\"version\":\"1.6.1\",\"resolved\":\"https://registry.npmmirror.com/repeat-string/-/repeat-string-1.6.1.tgz\",\"integrity\":\"sha512-PV0dzCYDNfRi1jCDbJzpW7jNNDRuCOG/jI5ctQcGKt/clZD+YcPS3yIlWuTJMmESC8aevCFmWJy5wjAFgNqN6w==\",\"dev\":true,\"optional\":true},\"repeating\":{\"version\":\"2.0.1\",\"resolved\":\"https://registry.npmmirror.com/repeating/-/repeating-2.0.1.tgz\",\"integrity\":\"sha512-ZqtSMuVybkISo2OWvqvm7iHSWngvdaW3IpsT9/uP8v4gMi591LY6h35wdOfvQdWCKFWZWm2Y1Opp4kV7vQKT6A==\",\"dev\":true,\"requires\":{\"is-finite\":\"^1.0.0\"}},\"resolve-url\":{\"version\":\"0.2.1\",\"resolved\":\"https://registry.npmmirror.com/resolve-url/-/resolve-url-0.2.1.tgz\",\"integrity\":\"sha512-ZuF55hVUQaaczgOIwqWzkEcEidmlD/xl44x1UZnhOXcYuFN2S6+rcxpG+C1N3So0wvNI3DmJICUFfu2SxhBmvg==\",\"dev\":true,\"optional\":true},\"ret\":{\"version\":\"0.1.15\",\"resolved\":\"https://registry.npmmirror.com/ret/-/ret-0.1.15.tgz\",\"integrity\":\"sha512-TTlYpa+OL+vMMNG24xSlQGEJ3B/RzEfUlLct7b5G/ytav+wPrplCpVMFuwzXbkecJrb6IYo1iFb0S9v37754mg==\",\"dev\":true,\"optional\":true},\"safe-buffer\":{\"version\":\"5.1.2\",\"resolved\":\"https://registry.npmmirror.com/safe-buffer/-/safe-buffer-5.1.2.tgz\",\"integrity\":\"sha512-Gd2UZBJDkXlY7GbJxfsE8/nvKkUEU1G38c1siN6QP6a9PT9MmHB8GnpscSmMJSoF8LOIrt8ud/wPtojys4G6+g==\",\"dev\":true,\"optional\":true},\"safe-regex\":{\"version\":\"1.1.0\",\"resolved\":\"https://registry.npmmirror.com/safe-regex/-/safe-regex-1.1.0.tgz\",\"integrity\":\"sha512-aJXcif4xnaNUzvUuC5gcb46oTS7zvg4jpMTnuqtrEPlR3vFr4pxtdTwaF1Qs3Enjn9HK+ZlwQui+a7z0SywIzg==\",\"dev\":true,\"optional\":true,\"requires\":{\"ret\":\"~0.1.10\"}},\"semver\":{\"version\":\"5.7.1\",\"resolved\":\"https://registry.npmmirror.com/semver/-/semver-5.7.1.tgz\",\"integrity\":\"sha512-sauaDf/PZdVgrLTNYHRtpXa1iRiKcaebiKQ1BJdpQlWH2lCvexQdX55snPFyK7QzpudqbCI0qXFfOasHdyNDGQ==\",\"dev\":true},\"set-value\":{\"version\":\"2.0.1\",\"resolved\":\"https://registry.npmmirror.com/set-value/-/set-value-2.0.1.tgz\",\"integrity\":\"sha512-JxHc1weCN68wRY0fhCoXpyK55m/XPHafOmK4UWD7m2CI14GMcFypt4w/0+NV5f/ZMby2F6S2wwA7fgynh9gWSw==\",\"dev\":true,\"optional\":true,\"requires\":{\"extend-shallow\":\"^2.0.1\",\"is-extendable\":\"^0.1.1\",\"is-plain-object\":\"^2.0.3\",\"split-string\":\"^3.0.1\"},\"dependencies\":{\"extend-shallow\":{\"version\":\"2.0.1\",\"resolved\":\"https://registry.npmmirror.com/extend-shallow/-/extend-shallow-2.0.1.tgz\",\"integrity\":\"sha512-zCnTtlxNoAiDc3gqY2aYAWFx7XWWiasuF2K8Me5WbN8otHKTUKBwjPtNpRs/rbUZm7KxWAaNj7P1a/p52GbVug==\",\"dev\":true,\"optional\":true,\"requires\":{\"is-extendable\":\"^0.1.0\"}}}},\"slash\":{\"version\":\"1.0.0\",\"resolved\":\"https://registry.npmmirror.com/slash/-/slash-1.0.0.tgz\",\"integrity\":\"sha512-3TYDR7xWt4dIqV2JauJr+EJeW356RXijHeUlO+8djJ+uBXPn8/2dpzBc8yQhh583sVvc9CvFAeQVgijsH+PNNg==\",\"dev\":true},\"snapdragon\":{\"version\":\"0.8.2\",\"resolved\":\"https://registry.npmmirror.com/snapdragon/-/snapdragon-0.8.2.tgz\",\"integrity\":\"sha512-FtyOnWN/wCHTVXOMwvSv26d+ko5vWlIDD6zoUJ7LW8vh+ZBC8QdljveRP+crNrtBwioEUWy/4dMtbBjA4ioNlg==\",\"dev\":true,\"optional\":true,\"requires\":{\"base\":\"^0.11.1\",\"debug\":\"^2.2.0\",\"define-property\":\"^0.2.5\",\"extend-shallow\":\"^2.0.1\",\"map-cache\":\"^0.2.2\",\"source-map\":\"^0.5.6\",\"source-map-resolve\":\"^0.5.0\",\"use\":\"^3.1.0\"},\"dependencies\":{\"define-property\":{\"version\":\"0.2.5\",\"resolved\":\"https://registry.npmmirror.com/define-property/-/define-property-0.2.5.tgz\",\"integrity\":\"sha512-Rr7ADjQZenceVOAKop6ALkkRAmH1A4Gx9hV/7ZujPUN2rkATqFO0JZLZInbAjpZYoJ1gUx8MRMQVkYemcbMSTA==\",\"dev\":true,\"optional\":true,\"requires\":{\"is-descriptor\":\"^0.1.0\"}},\"extend-shallow\":{\"version\":\"2.0.1\",\"resolved\":\"https://registry.npmmirror.com/extend-shallow/-/extend-shallow-2.0.1.tgz\",\"integrity\":\"sha512-zCnTtlxNoAiDc3gqY2aYAWFx7XWWiasuF2K8Me5WbN8otHKTUKBwjPtNpRs/rbUZm7KxWAaNj7P1a/p52GbVug==\",\"dev\":true,\"optional\":true,\"requires\":{\"is-extendable\":\"^0.1.0\"}}}},\"snapdragon-node\":{\"version\":\"2.1.1\",\"resolved\":\"https://registry.npmmirror.com/snapdragon-node/-/snapdragon-node-2.1.1.tgz\",\"integrity\":\"sha512-O27l4xaMYt/RSQ5TR3vpWCAB5Kb/czIcqUFOM/C4fYcLnbZUc1PkjTAMjof2pBWaSTwOUd6qUHcFGVGj7aIwnw==\",\"dev\":true,\"optional\":true,\"requires\":{\"define-property\":\"^1.0.0\",\"isobject\":\"^3.0.0\",\"snapdragon-util\":\"^3.0.1\"},\"dependencies\":{\"define-property\":{\"version\":\"1.0.0\",\"resolved\":\"https://registry.npmmirror.com/define-property/-/define-property-1.0.0.tgz\",\"integrity\":\"sha512-cZTYKFWspt9jZsMscWo8sc/5lbPC9Q0N5nBLgb+Yd915iL3udB1uFgS3B8YCx66UVHq018DAVFoee7x+gxggeA==\",\"dev\":true,\"optional\":true,\"requires\":{\"is-descriptor\":\"^1.0.0\"}},\"is-accessor-descriptor\":{\"version\":\"1.0.0\",\"resolved\":\"https://registry.npmmirror.com/is-accessor-descriptor/-/is-accessor-descriptor-1.0.0.tgz\",\"integrity\":\"sha512-m5hnHTkcVsPfqx3AKlyttIPb7J+XykHvJP2B9bZDjlhLIoEq4XoK64Vg7boZlVWYK6LUY94dYPEE7Lh0ZkZKcQ==\",\"dev\":true,\"optional\":true,\"requires\":{\"kind-of\":\"^6.0.0\"}},\"is-data-descriptor\":{\"version\":\"1.0.0\",\"resolved\":\"https://registry.npmmirror.com/is-data-descriptor/-/is-data-descriptor-1.0.0.tgz\",\"integrity\":\"sha512-jbRXy1FmtAoCjQkVmIVYwuuqDFUbaOeDjmed1tOGPrsMhtJA4rD9tkgA0F1qJ3gRFRXcHYVkdeaP50Q5rE/jLQ==\",\"dev\":true,\"optional\":true,\"requires\":{\"kind-of\":\"^6.0.0\"}},\"is-descriptor\":{\"version\":\"1.0.2\",\"resolved\":\"https://registry.npmmirror.com/is-descriptor/-/is-descriptor-1.0.2.tgz\",\"integrity\":\"sha512-2eis5WqQGV7peooDyLmNEPUrps9+SXX5c9pL3xEB+4e9HnGuDa7mB7kHxHw4CbqS9k1T2hOH3miL8n8WtiYVtg==\",\"dev\":true,\"optional\":true,\"requires\":{\"is-accessor-descriptor\":\"^1.0.0\",\"is-data-descriptor\":\"^1.0.0\",\"kind-of\":\"^6.0.2\"}},\"isobject\":{\"version\":\"3.0.1\",\"resolved\":\"https://registry.npmmirror.com/isobject/-/isobject-3.0.1.tgz\",\"integrity\":\"sha512-WhB9zCku7EGTj/HQQRz5aUQEUeoQZH2bWcltRErOpymJ4boYE6wL9Tbr23krRPSZ+C5zqNSrSw+Cc7sZZ4b7vg==\",\"dev\":true,\"optional\":true},\"kind-of\":{\"version\":\"6.0.3\",\"resolved\":\"https://registry.npmmirror.com/kind-of/-/kind-of-6.0.3.tgz\",\"integrity\":\"sha512-dcS1ul+9tmeD95T+x28/ehLgd9mENa3LsvDTtzm3vyBEO7RPptvAD+t44WVXaUjTBRcrpFeFlC8WCruUR456hw==\",\"dev\":true,\"optional\":true}}},\"snapdragon-util\":{\"version\":\"3.0.1\",\"resolved\":\"https://registry.npmmirror.com/snapdragon-util/-/snapdragon-util-3.0.1.tgz\",\"integrity\":\"sha512-mbKkMdQKsjX4BAL4bRYTj21edOf8cN7XHdYUJEe+Zn99hVEYcMvKPct1IqNe7+AZPirn8BCDOQBHQZknqmKlZQ==\",\"dev\":true,\"optional\":true,\"requires\":{\"kind-of\":\"^3.2.0\"}},\"source-map\":{\"version\":\"0.5.7\",\"resolved\":\"https://registry.npmmirror.com/source-map/-/source-map-0.5.7.tgz\",\"integrity\":\"sha512-LbrmJOMUSdEVxIKvdcJzQC+nQhe8FUZQTXQy6+I75skNgn3OoQ0DZA8YnFa7gp8tqtL3KPf1kmo0R5DoApeSGQ==\",\"dev\":true},\"source-map-resolve\":{\"version\":\"0.5.3\",\"resolved\":\"https://registry.npmmirror.com/source-map-resolve/-/source-map-resolve-0.5.3.tgz\",\"integrity\":\"sha512-Htz+RnsXWk5+P2slx5Jh3Q66vhQj1Cllm0zvnaY98+NFx+Dv2CF/f5O/t8x+KaNdrdIAsruNzoh/KpialbqAnw==\",\"dev\":true,\"optional\":true,\"requires\":{\"atob\":\"^2.1.2\",\"decode-uri-component\":\"^0.2.0\",\"resolve-url\":\"^0.2.1\",\"source-map-url\":\"^0.4.0\",\"urix\":\"^0.1.0\"}},\"source-map-support\":{\"version\":\"0.4.18\",\"resolved\":\"https://registry.npmmirror.com/source-map-support/-/source-map-support-0.4.18.tgz\",\"integrity\":\"sha512-try0/JqxPLF9nOjvSta7tVondkP5dwgyLDjVoyMDlmjugT2lRZ1OfsrYTkCd2hkDnJTKRbO/Rl3orm8vlsUzbA==\",\"dev\":true,\"requires\":{\"source-map\":\"^0.5.6\"}},\"source-map-url\":{\"version\":\"0.4.1\",\"resolved\":\"https://registry.npmmirror.com/source-map-url/-/source-map-url-0.4.1.tgz\",\"integrity\":\"sha512-cPiFOTLUKvJFIg4SKVScy4ilPPW6rFgMgfuZJPNoDuMs3nC1HbMUycBoJw77xFIp6z1UJQJOfx6C9GMH80DiTw==\",\"dev\":true,\"optional\":true},\"split-string\":{\"version\":\"3.1.0\",\"resolved\":\"https://registry.npmmirror.com/split-string/-/split-string-3.1.0.tgz\",\"integrity\":\"sha512-NzNVhJDYpwceVVii8/Hu6DKfD2G+NrQHlS/V/qgv763EYudVwEcMQNxd2lh+0VrUByXN/oJkl5grOhYWvQUYiw==\",\"dev\":true,\"optional\":true,\"requires\":{\"extend-shallow\":\"^3.0.0\"}},\"static-extend\":{\"version\":\"0.1.2\",\"resolved\":\"https://registry.npmmirror.com/static-extend/-/static-extend-0.1.2.tgz\",\"integrity\":\"sha512-72E9+uLc27Mt718pMHt9VMNiAL4LMsmDbBva8mxWUCkT07fSzEGMYUCk0XWY6lp0j6RBAG4cJ3mWuZv2OE3s0g==\",\"dev\":true,\"optional\":true,\"requires\":{\"define-property\":\"^0.2.5\",\"object-copy\":\"^0.1.0\"},\"dependencies\":{\"define-property\":{\"version\":\"0.2.5\",\"resolved\":\"https://registry.npmmirror.com/define-property/-/define-property-0.2.5.tgz\",\"integrity\":\"sha512-Rr7ADjQZenceVOAKop6ALkkRAmH1A4Gx9hV/7ZujPUN2rkATqFO0JZLZInbAjpZYoJ1gUx8MRMQVkYemcbMSTA==\",\"dev\":true,\"optional\":true,\"requires\":{\"is-descriptor\":\"^0.1.0\"}}}},\"string_decoder\":{\"version\":\"1.1.1\",\"resolved\":\"https://registry.npmmirror.com/string_decoder/-/string_decoder-1.1.1.tgz\",\"integrity\":\"sha512-n/ShnvDi6FHbbVfviro+WojiFzv+s8MPMHBczVePfUpDJLwoLT0ht1l4YwBCbi8pJAveEEdnkHyPyTP/mzRfwg==\",\"dev\":true,\"optional\":true,\"requires\":{\"safe-buffer\":\"~5.1.0\"}},\"strip-ansi\":{\"version\":\"3.0.1\",\"resolved\":\"https://registry.npmmirror.com/strip-ansi/-/strip-ansi-3.0.1.tgz\",\"integrity\":\"sha512-VhumSSbBqDTP8p2ZLKj40UjBCV4+v8bUSEpUb4KjRgWk9pbqGF4REFj6KEagidb2f/M6AzC0EmFyDNGaw9OCzg==\",\"dev\":true,\"requires\":{\"ansi-regex\":\"^2.0.0\"}},\"supports-color\":{\"version\":\"2.0.0\",\"resolved\":\"https://registry.npmmirror.com/supports-color/-/supports-color-2.0.0.tgz\",\"integrity\":\"sha512-KKNVtd6pCYgPIKU4cp2733HWYCpplQhddZLBUryaAHou723x+FRzQ5Df824Fj+IyyuiQTRoub4SnIFfIcrp70g==\",\"dev\":true},\"to-fast-properties\":{\"version\":\"1.0.3\",\"resolved\":\"https://registry.npmmirror.com/to-fast-properties/-/to-fast-properties-1.0.3.tgz\",\"integrity\":\"sha512-lxrWP8ejsq+7E3nNjwYmUBMAgjMTZoTI+sdBOpvNyijeDLa29LUn9QaoXAHv4+Z578hbmHHJKZknzxVtvo77og==\",\"dev\":true},\"to-object-path\":{\"version\":\"0.3.0\",\"resolved\":\"https://registry.npmmirror.com/to-object-path/-/to-object-path-0.3.0.tgz\",\"integrity\":\"sha512-9mWHdnGRuh3onocaHzukyvCZhzvr6tiflAy/JRFXcJX0TjgfWA9pk9t8CMbzmBE4Jfw58pXbkngtBtqYxzNEyg==\",\"dev\":true,\"optional\":true,\"requires\":{\"kind-of\":\"^3.0.2\"}},\"to-regex\":{\"version\":\"3.0.2\",\"resolved\":\"https://registry.npmmirror.com/to-regex/-/to-regex-3.0.2.tgz\",\"integrity\":\"sha512-FWtleNAtZ/Ki2qtqej2CXTOayOH9bHDQF+Q48VpWyDXjbYxA4Yz8iDB31zXOBUlOHHKidDbqGVrTUvQMPmBGBw==\",\"dev\":true,\"optional\":true,\"requires\":{\"define-property\":\"^2.0.2\",\"extend-shallow\":\"^3.0.2\",\"regex-not\":\"^1.0.2\",\"safe-regex\":\"^1.1.0\"}},\"to-regex-range\":{\"version\":\"2.1.1\",\"resolved\":\"https://registry.npmmirror.com/to-regex-range/-/to-regex-range-2.1.1.tgz\",\"integrity\":\"sha512-ZZWNfCjUokXXDGXFpZehJIkZqq91BcULFq/Pi7M5i4JnxXdhMKAK682z8bCW3o8Hj1wuuzoKcW3DfVzaP6VuNg==\",\"dev\":true,\"optional\":true,\"requires\":{\"is-number\":\"^3.0.0\",\"repeat-string\":\"^1.6.1\"},\"dependencies\":{\"is-number\":{\"version\":\"3.0.0\",\"resolved\":\"https://registry.npmmirror.com/is-number/-/is-number-3.0.0.tgz\",\"integrity\":\"sha512-4cboCqIpliH+mAvFNegjZQ4kgKc3ZUhQVr3HvWbSh5q3WH2v82ct+T2Y1hdU5Gdtorx/cLifQjqCbL7bpznLTg==\",\"dev\":true,\"optional\":true,\"requires\":{\"kind-of\":\"^3.0.2\"}}}},\"trim-right\":{\"version\":\"1.0.1\",\"resolved\":\"https://registry.npmmirror.com/trim-right/-/trim-right-1.0.1.tgz\",\"integrity\":\"sha512-WZGXGstmCWgeevgTL54hrCuw1dyMQIzWy7ZfqRJfSmJZBwklI15egmQytFP6bPidmw3M8d5yEowl1niq4vmqZw==\",\"dev\":true},\"union-value\":{\"version\":\"1.0.1\",\"resolved\":\"https://registry.npmmirror.com/union-value/-/union-value-1.0.1.tgz\",\"integrity\":\"sha512-tJfXmxMeWYnczCVs7XAEvIV7ieppALdyepWMkHkwciRpZraG/xwT+s2JN8+pr1+8jCRf80FFzvr+MpQeeoF4Xg==\",\"dev\":true,\"optional\":true,\"requires\":{\"arr-union\":\"^3.1.0\",\"get-value\":\"^2.0.6\",\"is-extendable\":\"^0.1.1\",\"set-value\":\"^2.0.1\"}},\"unset-value\":{\"version\":\"1.0.0\",\"resolved\":\"https://registry.npmmirror.com/unset-value/-/unset-value-1.0.0.tgz\",\"integrity\":\"sha512-PcA2tsuGSF9cnySLHTLSh2qrQiJ70mn+r+Glzxv2TWZblxsxCC52BDlZoPCsz7STd9pN7EZetkWZBAvk4cgZdQ==\",\"dev\":true,\"optional\":true,\"requires\":{\"has-value\":\"^0.3.1\",\"isobject\":\"^3.0.0\"},\"dependencies\":{\"has-value\":{\"version\":\"0.3.1\",\"resolved\":\"https://registry.npmmirror.com/has-value/-/has-value-0.3.1.tgz\",\"integrity\":\"sha512-gpG936j8/MzaeID5Yif+577c17TxaDmhuyVgSwtnL/q8UUTySg8Mecb+8Cf1otgLoD7DDH75axp86ER7LFsf3Q==\",\"dev\":true,\"optional\":true,\"requires\":{\"get-value\":\"^2.0.3\",\"has-values\":\"^0.1.4\",\"isobject\":\"^2.0.0\"},\"dependencies\":{\"isobject\":{\"version\":\"2.1.0\",\"resolved\":\"https://registry.npmmirror.com/isobject/-/isobject-2.1.0.tgz\",\"integrity\":\"sha512-+OUdGJlgjOBZDfxnDjYYG6zp487z0JGNQq3cYQYg5f5hKR+syHMsaztzGeml/4kGG55CSpKSpWTY+jYGgsHLgA==\",\"dev\":true,\"optional\":true,\"requires\":{\"isarray\":\"1.0.0\"}}}},\"has-values\":{\"version\":\"0.1.4\",\"resolved\":\"https://registry.npmmirror.com/has-values/-/has-values-0.1.4.tgz\",\"integrity\":\"sha512-J8S0cEdWuQbqD9//tlZxiMuMNmxB8PlEwvYwuxsTmR1G5RXUePEX/SJn7aD0GMLieuZYSwNH0cQuJGwnYunXRQ==\",\"dev\":true,\"optional\":true},\"isobject\":{\"version\":\"3.0.1\",\"resolved\":\"https://registry.npmmirror.com/isobject/-/isobject-3.0.1.tgz\",\"integrity\":\"sha512-WhB9zCku7EGTj/HQQRz5aUQEUeoQZH2bWcltRErOpymJ4boYE6wL9Tbr23krRPSZ+C5zqNSrSw+Cc7sZZ4b7vg==\",\"dev\":true,\"optional\":true}}},\"urix\":{\"version\":\"0.1.0\",\"resolved\":\"https://registry.npmmirror.com/urix/-/urix-0.1.0.tgz\",\"integrity\":\"sha512-Am1ousAhSLBeB9cG/7k7r2R0zj50uDRlZHPGbazid5s9rlF1F/QKYObEKSIunSjIOkJZqwRRLpvewjEkM7pSqg==\",\"dev\":true,\"optional\":true},\"use\":{\"version\":\"3.1.1\",\"resolved\":\"https://registry.npmmirror.com/use/-/use-3.1.1.tgz\",\"integrity\":\"sha512-cwESVXlO3url9YWlFW/TA9cshCEhtu7IKJ/p5soJ/gGpj7vbvFrAY/eIioQ6Dw23KjZhYgiIo8HOs1nQ2vr/oQ==\",\"dev\":true,\"optional\":true},\"user-home\":{\"version\":\"1.1.1\",\"resolved\":\"https://registry.npmmirror.com/user-home/-/user-home-1.1.1.tgz\",\"integrity\":\"sha512-aggiKfEEubv3UwRNqTzLInZpAOmKzwdHqEBmW/hBA/mt99eg+b4VrX6i+IRLxU8+WJYfa33rGwRseg4eElUgsQ==\",\"dev\":true},\"util-deprecate\":{\"version\":\"1.0.2\",\"resolved\":\"https://registry.npmmirror.com/util-deprecate/-/util-deprecate-1.0.2.tgz\",\"integrity\":\"sha512-EPD5q1uXyFxJpCrLnCc1nHnq3gOa6DZBocAIiI2TaSCA7VCJ1UJDMagCzIkXNsUYfD1daK//LTEQ8xiIbrHtcw==\",\"dev\":true,\"optional\":true},\"v8flags\":{\"version\":\"2.1.1\",\"resolved\":\"https://registry.npmmirror.com/v8flags/-/v8flags-2.1.1.tgz\",\"integrity\":\"sha512-SKfhk/LlaXzvtowJabLZwD4K6SGRYeoxA7KJeISlUMAB/NT4CBkZjMq3WceX2Ckm4llwqYVo8TICgsDYCBU2tA==\",\"dev\":true,\"requires\":{\"user-home\":\"^1.1.1\"}},\"wrappy\":{\"version\":\"1.0.2\",\"resolved\":\"https://registry.npmmirror.com/wrappy/-/wrappy-1.0.2.tgz\",\"integrity\":\"sha512-l4Sp/DRseor9wL6EvV2+TuQn63dMkPjZ/sp9XkghTEbV9KlPS1xUsZ3u7/IQO4wxtcFB4bgpQPRcR3QCvezPcQ==\",\"dev\":true}}}"}],"Post":[{"title":"在Linux上部署 Node 接口","date":"2022-12-16T06:00:00.000Z","banner_img":"/img/nodejs.png","index_img":"/img/nodejs.png","excerpt":"Never too old to learn.","_content":"\n# 连接远程服务器\n\n打开 mac 终端:\n\n```js\nssh root@124.221.230.105 (公网IP)\n\n// 接着输入密码，即可登录远程服务器\n```\n\n登录进去，输入 pwd，会输出 `/root`，这时我们切到 '/' 目录下: `cd ..`\n\n# 在远程安装 nodejs\n\n```js\nwget https://cdn.npmmirror.com/binaries/node/v14.19.1/node-v14.19.1-linux-x64.tar.xz\n```\n\n# 解压压缩包\n\n使用 tar 命令\n\n- -c 压缩\n- -x 解压\n- -t 查看内容\n- -r 想压缩归档文件末尾追加文件\n- -v 显示所有过程\n- -f 使用档案名字，切记，这是最后一个参数，最后只能接档案名\n\n```js\ntar -xvf node-v14.19.1-linux-x64.tar.xz\n```\n\n# 配置环境变量\n\n找到根目录 '/' 下的 etc文件夹，进去里面，打开 profile 文件，打开，执行命令：\n\n```js\n// '/'\n\ncd etc\n\nvim profile\n```\n\n在最后一行加上如下这句：\n```js\nexport PATH=$PATH:/node-v14.19.1-linux-x64/bin\n```\n\n最后，使文件生效\n\n```js\n// /etc\nsource profile\n```\n\n查看 node 版本\n```\nnode -v\n\nnpm -v\n```\n\n# 安装 pm2\n\n```\nnpm install -g pm2\n```\n\n# 部署 node 接口\n\n在根目录下 `/`，创建 `node-server` 文件夹\n\n可以通过 express 建立一个 node 服务\n\n```js\nconst express = require(\"express\");\n\nconst app = express()\n\napp.get('/list', (req, res) => {\n  console.log('current IP', req.ip)\n  res.json({\n    code: 200,\n    msg: 'linux node server'\n  })\n})\n\napp.listen(9999, () => {\n  console.log('node server at port 9999...')\n})\n```\n\n# 通过 pm2 启动node服务\n\n```js\n// node-server\npm2 start index.js --watch\n```\n\n通过 `pm2 monit` 查看 node 服务的打印日志\n\n# 注意\n\n访问接口，如果打不开，大概率是因为没有放开防火墙。\n\n> http://124.221.230.105:9999/list\n\n1. 找到服务器地址，放开 node 服务对应的端口号\n\n![](/img/firewall.png)\n\n此时依然无法打开对应的接口\n\n2. 登录服务器，查看防火墙所有的端口\n\n> firewall-cmd --zone=public --list-ports\n\n3. 添加新的端口\n\n> firewall-cmd --zone=public --add-port=9999/tcp --permanent\n\n--permanent 表示永久有效\n\n4. 重启防火墙\n\n> firewall-cmd --reload\n\n至此，就可以访问服务器上 node 服务的接口了。\n\n![](/img/node-res.png)\n\n\n\n","source":"_drafts/linux.md","raw":"---\ntitle: 在Linux上部署 Node 接口\ndate: 2022-12-16 14:00:00\ntags: Nodejs\nbanner_img: /img/nodejs.png\nindex_img: /img/nodejs.png\nexcerpt: Never too old to learn.\n---\n\n# 连接远程服务器\n\n打开 mac 终端:\n\n```js\nssh root@124.221.230.105 (公网IP)\n\n// 接着输入密码，即可登录远程服务器\n```\n\n登录进去，输入 pwd，会输出 `/root`，这时我们切到 '/' 目录下: `cd ..`\n\n# 在远程安装 nodejs\n\n```js\nwget https://cdn.npmmirror.com/binaries/node/v14.19.1/node-v14.19.1-linux-x64.tar.xz\n```\n\n# 解压压缩包\n\n使用 tar 命令\n\n- -c 压缩\n- -x 解压\n- -t 查看内容\n- -r 想压缩归档文件末尾追加文件\n- -v 显示所有过程\n- -f 使用档案名字，切记，这是最后一个参数，最后只能接档案名\n\n```js\ntar -xvf node-v14.19.1-linux-x64.tar.xz\n```\n\n# 配置环境变量\n\n找到根目录 '/' 下的 etc文件夹，进去里面，打开 profile 文件，打开，执行命令：\n\n```js\n// '/'\n\ncd etc\n\nvim profile\n```\n\n在最后一行加上如下这句：\n```js\nexport PATH=$PATH:/node-v14.19.1-linux-x64/bin\n```\n\n最后，使文件生效\n\n```js\n// /etc\nsource profile\n```\n\n查看 node 版本\n```\nnode -v\n\nnpm -v\n```\n\n# 安装 pm2\n\n```\nnpm install -g pm2\n```\n\n# 部署 node 接口\n\n在根目录下 `/`，创建 `node-server` 文件夹\n\n可以通过 express 建立一个 node 服务\n\n```js\nconst express = require(\"express\");\n\nconst app = express()\n\napp.get('/list', (req, res) => {\n  console.log('current IP', req.ip)\n  res.json({\n    code: 200,\n    msg: 'linux node server'\n  })\n})\n\napp.listen(9999, () => {\n  console.log('node server at port 9999...')\n})\n```\n\n# 通过 pm2 启动node服务\n\n```js\n// node-server\npm2 start index.js --watch\n```\n\n通过 `pm2 monit` 查看 node 服务的打印日志\n\n# 注意\n\n访问接口，如果打不开，大概率是因为没有放开防火墙。\n\n> http://124.221.230.105:9999/list\n\n1. 找到服务器地址，放开 node 服务对应的端口号\n\n![](/img/firewall.png)\n\n此时依然无法打开对应的接口\n\n2. 登录服务器，查看防火墙所有的端口\n\n> firewall-cmd --zone=public --list-ports\n\n3. 添加新的端口\n\n> firewall-cmd --zone=public --add-port=9999/tcp --permanent\n\n--permanent 表示永久有效\n\n4. 重启防火墙\n\n> firewall-cmd --reload\n\n至此，就可以访问服务器上 node 服务的接口了。\n\n![](/img/node-res.png)\n\n\n\n","slug":"linux","published":0,"updated":"2023-05-12T10:49:20.011Z","comments":1,"layout":"post","photos":[],"link":"","_id":"clhkizgx900033y0q1xqa2rjz","content":"<h1 id=\"连接远程服务器\"><a href=\"#连接远程服务器\" class=\"headerlink\" title=\"连接远程服务器\"></a>连接远程服务器</h1><p>打开 mac 终端:</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><div class=\"code-wrapper\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></div></td><td class=\"code\"><pre><code class=\"hljs js\">ssh root@<span class=\"hljs-number\">124.221</span><span class=\"hljs-number\">.230</span><span class=\"hljs-number\">.105</span> (公网<span class=\"hljs-variable constant_\">IP</span>)<br><br><span class=\"hljs-comment\">// 接着输入密码，即可登录远程服务器</span><br></code></pre></td></tr></table></figure>\n\n<p>登录进去，输入 pwd，会输出 <code>/root</code>，这时我们切到 ‘/‘ 目录下: <code>cd ..</code></p>\n<h1 id=\"在远程安装-nodejs\"><a href=\"#在远程安装-nodejs\" class=\"headerlink\" title=\"在远程安装 nodejs\"></a>在远程安装 nodejs</h1><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\">wget <span class=\"hljs-attr\">https</span>:<span class=\"hljs-comment\">//cdn.npmmirror.com/binaries/node/v14.19.1/node-v14.19.1-linux-x64.tar.xz</span><br></code></pre></td></tr></table></figure>\n\n<h1 id=\"解压压缩包\"><a href=\"#解压压缩包\" class=\"headerlink\" title=\"解压压缩包\"></a>解压压缩包</h1><p>使用 tar 命令</p>\n<ul>\n<li>-c 压缩</li>\n<li>-x 解压</li>\n<li>-t 查看内容</li>\n<li>-r 想压缩归档文件末尾追加文件</li>\n<li>-v 显示所有过程</li>\n<li>-f 使用档案名字，切记，这是最后一个参数，最后只能接档案名</li>\n</ul>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\">tar -xvf node-v14<span class=\"hljs-number\">.19</span><span class=\"hljs-number\">.1</span>-linux-x64.<span class=\"hljs-property\">tar</span>.<span class=\"hljs-property\">xz</span><br></code></pre></td></tr></table></figure>\n\n<h1 id=\"配置环境变量\"><a href=\"#配置环境变量\" class=\"headerlink\" title=\"配置环境变量\"></a>配置环境变量</h1><p>找到根目录 ‘/‘ 下的 etc文件夹，进去里面，打开 profile 文件，打开，执行命令：</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\"><span class=\"hljs-comment\">// &#x27;/&#x27;</span><br><br>cd etc<br><br>vim profile<br></code></pre></td></tr></table></figure>\n\n<p>在最后一行加上如下这句：</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\"><span class=\"hljs-keyword\">export</span> <span class=\"hljs-variable constant_\">PATH</span>=<span class=\"hljs-attr\">$PATH</span>:<span class=\"hljs-regexp\">/node-v14.19.1-linux-x64/</span>bin<br></code></pre></td></tr></table></figure>\n\n<p>最后，使文件生效</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\"><span class=\"hljs-comment\">// /etc</span><br>source profile<br></code></pre></td></tr></table></figure>\n\n<p>查看 node 版本</p>\n<figure class=\"highlight crmsh\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs crmsh\"><span class=\"hljs-keyword\">node</span> <span class=\"hljs-title\">-v</span><br><br>npm -v<br></code></pre></td></tr></table></figure>\n\n<h1 id=\"安装-pm2\"><a href=\"#安装-pm2\" class=\"headerlink\" title=\"安装 pm2\"></a>安装 pm2</h1><figure class=\"highlight cmake\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs cmake\">npm <span class=\"hljs-keyword\">install</span> -g pm2<br></code></pre></td></tr></table></figure>\n\n<h1 id=\"部署-node-接口\"><a href=\"#部署-node-接口\" class=\"headerlink\" title=\"部署 node 接口\"></a>部署 node 接口</h1><p>在根目录下 <code>/</code>，创建 <code>node-server</code> 文件夹</p>\n<p>可以通过 express 建立一个 node 服务</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\"><span class=\"hljs-keyword\">const</span> express = <span class=\"hljs-built_in\">require</span>(<span class=\"hljs-string\">&quot;express&quot;</span>);<br><br><span class=\"hljs-keyword\">const</span> app = <span class=\"hljs-title function_\">express</span>()<br><br>app.<span class=\"hljs-title function_\">get</span>(<span class=\"hljs-string\">&#x27;/list&#x27;</span>, <span class=\"hljs-function\">(<span class=\"hljs-params\">req, res</span>) =&gt;</span> &#123;<br>  <span class=\"hljs-variable language_\">console</span>.<span class=\"hljs-title function_\">log</span>(<span class=\"hljs-string\">&#x27;current IP&#x27;</span>, req.<span class=\"hljs-property\">ip</span>)<br>  res.<span class=\"hljs-title function_\">json</span>(&#123;<br>    <span class=\"hljs-attr\">code</span>: <span class=\"hljs-number\">200</span>,<br>    <span class=\"hljs-attr\">msg</span>: <span class=\"hljs-string\">&#x27;linux node server&#x27;</span><br>  &#125;)<br>&#125;)<br><br>app.<span class=\"hljs-title function_\">listen</span>(<span class=\"hljs-number\">9999</span>, <span class=\"hljs-function\">() =&gt;</span> &#123;<br>  <span class=\"hljs-variable language_\">console</span>.<span class=\"hljs-title function_\">log</span>(<span class=\"hljs-string\">&#x27;node server at port 9999...&#x27;</span>)<br>&#125;)<br></code></pre></td></tr></table></figure>\n\n<h1 id=\"通过-pm2-启动node服务\"><a href=\"#通过-pm2-启动node服务\" class=\"headerlink\" title=\"通过 pm2 启动node服务\"></a>通过 pm2 启动node服务</h1><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\"><span class=\"hljs-comment\">// node-server</span><br>pm2 start index.<span class=\"hljs-property\">js</span> --watch<br></code></pre></td></tr></table></figure>\n\n<p>通过 <code>pm2 monit</code> 查看 node 服务的打印日志</p>\n<h1 id=\"注意\"><a href=\"#注意\" class=\"headerlink\" title=\"注意\"></a>注意</h1><p>访问接口，如果打不开，大概率是因为没有放开防火墙。</p>\n<blockquote>\n<p><a href=\"http://124.221.230.105:9999/list\">http://124.221.230.105:9999/list</a></p>\n</blockquote>\n<ol>\n<li>找到服务器地址，放开 node 服务对应的端口号</li>\n</ol>\n<p><img src=\"/img/firewall.png\" alt=\"\"></p>\n<p>此时依然无法打开对应的接口</p>\n<ol start=\"2\">\n<li>登录服务器，查看防火墙所有的端口</li>\n</ol>\n<blockquote>\n<p>firewall-cmd –zone=public –list-ports</p>\n</blockquote>\n<ol start=\"3\">\n<li>添加新的端口</li>\n</ol>\n<blockquote>\n<p>firewall-cmd –zone=public –add-port=9999/tcp –permanent</p>\n</blockquote>\n<p>–permanent 表示永久有效</p>\n<ol start=\"4\">\n<li>重启防火墙</li>\n</ol>\n<blockquote>\n<p>firewall-cmd –reload</p>\n</blockquote>\n<p>至此，就可以访问服务器上 node 服务的接口了。</p>\n<p><img src=\"/img/node-res.png\" alt=\"\"></p>\n","site":{"data":{}},"wordcount":1239,"more":"<h1 id=\"连接远程服务器\"><a href=\"#连接远程服务器\" class=\"headerlink\" title=\"连接远程服务器\"></a>连接远程服务器</h1><p>打开 mac 终端:</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\">ssh root@<span class=\"hljs-number\">124.221</span><span class=\"hljs-number\">.230</span><span class=\"hljs-number\">.105</span> (公网<span class=\"hljs-variable constant_\">IP</span>)<br><br><span class=\"hljs-comment\">// 接着输入密码，即可登录远程服务器</span><br></code></pre></td></tr></table></figure>\n\n<p>登录进去，输入 pwd，会输出 <code>/root</code>，这时我们切到 ‘/‘ 目录下: <code>cd ..</code></p>\n<h1 id=\"在远程安装-nodejs\"><a href=\"#在远程安装-nodejs\" class=\"headerlink\" title=\"在远程安装 nodejs\"></a>在远程安装 nodejs</h1><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\">wget <span class=\"hljs-attr\">https</span>:<span class=\"hljs-comment\">//cdn.npmmirror.com/binaries/node/v14.19.1/node-v14.19.1-linux-x64.tar.xz</span><br></code></pre></td></tr></table></figure>\n\n<h1 id=\"解压压缩包\"><a href=\"#解压压缩包\" class=\"headerlink\" title=\"解压压缩包\"></a>解压压缩包</h1><p>使用 tar 命令</p>\n<ul>\n<li>-c 压缩</li>\n<li>-x 解压</li>\n<li>-t 查看内容</li>\n<li>-r 想压缩归档文件末尾追加文件</li>\n<li>-v 显示所有过程</li>\n<li>-f 使用档案名字，切记，这是最后一个参数，最后只能接档案名</li>\n</ul>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\">tar -xvf node-v14<span class=\"hljs-number\">.19</span><span class=\"hljs-number\">.1</span>-linux-x64.<span class=\"hljs-property\">tar</span>.<span class=\"hljs-property\">xz</span><br></code></pre></td></tr></table></figure>\n\n<h1 id=\"配置环境变量\"><a href=\"#配置环境变量\" class=\"headerlink\" title=\"配置环境变量\"></a>配置环境变量</h1><p>找到根目录 ‘/‘ 下的 etc文件夹，进去里面，打开 profile 文件，打开，执行命令：</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\"><span class=\"hljs-comment\">// &#x27;/&#x27;</span><br><br>cd etc<br><br>vim profile<br></code></pre></td></tr></table></figure>\n\n<p>在最后一行加上如下这句：</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\"><span class=\"hljs-keyword\">export</span> <span class=\"hljs-variable constant_\">PATH</span>=<span class=\"hljs-attr\">$PATH</span>:<span class=\"hljs-regexp\">/node-v14.19.1-linux-x64/</span>bin<br></code></pre></td></tr></table></figure>\n\n<p>最后，使文件生效</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\"><span class=\"hljs-comment\">// /etc</span><br>source profile<br></code></pre></td></tr></table></figure>\n\n<p>查看 node 版本</p>\n<figure class=\"highlight crmsh\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs crmsh\"><span class=\"hljs-keyword\">node</span> <span class=\"hljs-title\">-v</span><br><br>npm -v<br></code></pre></td></tr></table></figure>\n\n<h1 id=\"安装-pm2\"><a href=\"#安装-pm2\" class=\"headerlink\" title=\"安装 pm2\"></a>安装 pm2</h1><figure class=\"highlight cmake\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs cmake\">npm <span class=\"hljs-keyword\">install</span> -g pm2<br></code></pre></td></tr></table></figure>\n\n<h1 id=\"部署-node-接口\"><a href=\"#部署-node-接口\" class=\"headerlink\" title=\"部署 node 接口\"></a>部署 node 接口</h1><p>在根目录下 <code>/</code>，创建 <code>node-server</code> 文件夹</p>\n<p>可以通过 express 建立一个 node 服务</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\"><span class=\"hljs-keyword\">const</span> express = <span class=\"hljs-built_in\">require</span>(<span class=\"hljs-string\">&quot;express&quot;</span>);<br><br><span class=\"hljs-keyword\">const</span> app = <span class=\"hljs-title function_\">express</span>()<br><br>app.<span class=\"hljs-title function_\">get</span>(<span class=\"hljs-string\">&#x27;/list&#x27;</span>, <span class=\"hljs-function\">(<span class=\"hljs-params\">req, res</span>) =&gt;</span> &#123;<br>  <span class=\"hljs-variable language_\">console</span>.<span class=\"hljs-title function_\">log</span>(<span class=\"hljs-string\">&#x27;current IP&#x27;</span>, req.<span class=\"hljs-property\">ip</span>)<br>  res.<span class=\"hljs-title function_\">json</span>(&#123;<br>    <span class=\"hljs-attr\">code</span>: <span class=\"hljs-number\">200</span>,<br>    <span class=\"hljs-attr\">msg</span>: <span class=\"hljs-string\">&#x27;linux node server&#x27;</span><br>  &#125;)<br>&#125;)<br><br>app.<span class=\"hljs-title function_\">listen</span>(<span class=\"hljs-number\">9999</span>, <span class=\"hljs-function\">() =&gt;</span> &#123;<br>  <span class=\"hljs-variable language_\">console</span>.<span class=\"hljs-title function_\">log</span>(<span class=\"hljs-string\">&#x27;node server at port 9999...&#x27;</span>)<br>&#125;)<br></code></pre></td></tr></table></figure>\n\n<h1 id=\"通过-pm2-启动node服务\"><a href=\"#通过-pm2-启动node服务\" class=\"headerlink\" title=\"通过 pm2 启动node服务\"></a>通过 pm2 启动node服务</h1><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\"><span class=\"hljs-comment\">// node-server</span><br>pm2 start index.<span class=\"hljs-property\">js</span> --watch<br></code></pre></td></tr></table></figure>\n\n<p>通过 <code>pm2 monit</code> 查看 node 服务的打印日志</p>\n<h1 id=\"注意\"><a href=\"#注意\" class=\"headerlink\" title=\"注意\"></a>注意</h1><p>访问接口，如果打不开，大概率是因为没有放开防火墙。</p>\n<blockquote>\n<p><a href=\"http://124.221.230.105:9999/list\">http://124.221.230.105:9999/list</a></p>\n</blockquote>\n<ol>\n<li>找到服务器地址，放开 node 服务对应的端口号</li>\n</ol>\n<p><img src=\"/img/firewall.png\" alt=\"\"></p>\n<p>此时依然无法打开对应的接口</p>\n<ol start=\"2\">\n<li>登录服务器，查看防火墙所有的端口</li>\n</ol>\n<blockquote>\n<p>firewall-cmd –zone=public –list-ports</p>\n</blockquote>\n<ol start=\"3\">\n<li>添加新的端口</li>\n</ol>\n<blockquote>\n<p>firewall-cmd –zone=public –add-port=9999/tcp –permanent</p>\n</blockquote>\n<p>–permanent 表示永久有效</p>\n<ol start=\"4\">\n<li>重启防火墙</li>\n</ol>\n<blockquote>\n<p>firewall-cmd –reload</p>\n</blockquote>\n<p>至此，就可以访问服务器上 node 服务的接口了。</p>\n<p><img src=\"/img/node-res.png\" alt=\"\"></p>\n"},{"layout":"Web3","title":"Web3学习路线 & 学习记录","date":"2022-12-30T06:00:00.000Z","banner_img":"/img/theme.png","index_img":"/img/theme.png","excerpt":"Web3学习计划、资源整合、学习记录","_content":"\n\n# Web3学习计划\n\n![](/img/web3-week1.jpg)\n![](/img/web3-week2.jpg)\n![](/img/web3-week3.jpg)\n![](/img/web3-week4.jpg)\n![](/img/web3-week5.jpg)\n\n# 后端\n\n![](/img/backend.jpg)\n\n","source":"_drafts/web3.md","raw":"---\nlayout: Web3\ntitle: Web3学习路线 & 学习记录\ndate: 2022-12-30 14:00:00\ntags: Web3\nbanner_img: /img/theme.png\nindex_img: /img/theme.png\nexcerpt: Web3学习计划、资源整合、学习记录\n---\n\n\n# Web3学习计划\n\n![](/img/web3-week1.jpg)\n![](/img/web3-week2.jpg)\n![](/img/web3-week3.jpg)\n![](/img/web3-week4.jpg)\n![](/img/web3-week5.jpg)\n\n# 后端\n\n![](/img/backend.jpg)\n\n","slug":"web3","published":0,"updated":"2023-05-12T10:49:20.011Z","comments":1,"photos":[],"link":"","_id":"clhkizgxb00053y0qdbo8htvg","content":"<h1 id=\"Web3学习计划\"><a href=\"#Web3学习计划\" class=\"headerlink\" title=\"Web3学习计划\"></a>Web3学习计划</h1><p><img src=\"/img/web3-week1.jpg\" alt=\"\"><br><img src=\"/img/web3-week2.jpg\" alt=\"\"><br><img src=\"/img/web3-week3.jpg\" alt=\"\"><br><img src=\"/img/web3-week4.jpg\" alt=\"\"><br><img src=\"/img/web3-week5.jpg\" alt=\"\"></p>\n<h1 id=\"后端\"><a href=\"#后端\" class=\"headerlink\" title=\"后端\"></a>后端</h1><p><img src=\"/img/backend.jpg\" alt=\"\"></p>\n","site":{"data":{}},"wordcount":10,"more":"<h1 id=\"Web3学习计划\"><a href=\"#Web3学习计划\" class=\"headerlink\" title=\"Web3学习计划\"></a>Web3学习计划</h1><p><img src=\"/img/web3-week1.jpg\" alt=\"\"><br><img src=\"/img/web3-week2.jpg\" alt=\"\"><br><img src=\"/img/web3-week3.jpg\" alt=\"\"><br><img src=\"/img/web3-week4.jpg\" alt=\"\"><br><img src=\"/img/web3-week5.jpg\" alt=\"\"></p>\n<h1 id=\"后端\"><a href=\"#后端\" class=\"headerlink\" title=\"后端\"></a>后端</h1><p><img src=\"/img/backend.jpg\" alt=\"\"></p>\n"},{"title":"移动端开发实践","date":"2022-06-09T06:26:40.000Z","banner_img":"/img/chicken.jpg","index_img":"/img/chicken.jpg","excerpt":"React Native 、H5移动端开发实践","_content":"\n### WebView\n现在 Android App大多嵌入了 Android Webview 组件进行 Hybrid 开发，它具备开发周期短、灵活性好的优点，但是缺点也很明显，加载速度慢 & 消耗流量。引起缺点的主要原因如下：\n  1. js解析效率，以及手机硬件设备的性能\n  2. 页面资源的下载（图片、js文件、css文件）\n\n\n## 参考资料\n[^1]: [Android Webview H5 秒开方案实现](https://juejin.cn/post/6844903673697402887)\n\n","source":"_posts/app-h5.md","raw":"---\ntitle: 移动端开发实践\ndate: 2022-06-09 14:26:40\ntags: RN H5\nbanner_img: /img/chicken.jpg\nindex_img: /img/chicken.jpg\nexcerpt: React Native 、H5移动端开发实践\n---\n\n### WebView\n现在 Android App大多嵌入了 Android Webview 组件进行 Hybrid 开发，它具备开发周期短、灵活性好的优点，但是缺点也很明显，加载速度慢 & 消耗流量。引起缺点的主要原因如下：\n  1. js解析效率，以及手机硬件设备的性能\n  2. 页面资源的下载（图片、js文件、css文件）\n\n\n## 参考资料\n[^1]: [Android Webview H5 秒开方案实现](https://juejin.cn/post/6844903673697402887)\n\n","slug":"app-h5","published":1,"updated":"2023-05-12T10:49:20.012Z","comments":1,"layout":"post","photos":[],"link":"","_id":"clhkizgxd00083y0q0vmy1uay","content":"<h3 id=\"WebView\"><a href=\"#WebView\" class=\"headerlink\" title=\"WebView\"></a>WebView</h3><p>现在 Android App大多嵌入了 Android Webview 组件进行 Hybrid 开发，它具备开发周期短、灵活性好的优点，但是缺点也很明显，加载速度慢 &amp; 消耗流量。引起缺点的主要原因如下：</p>\n<ol>\n<li>js解析效率，以及手机硬件设备的性能</li>\n<li>页面资源的下载（图片、js文件、css文件）</li>\n</ol>\n<h2 id=\"参考资料\"><a href=\"#参考资料\" class=\"headerlink\" title=\"参考资料\"></a>参考资料</h2><section class=\"footnotes\"><div class=\"footnote-list\"><ol><li><span id=\"fn:1\" class=\"footnote-text\"><span><a href=\"https://juejin.cn/post/6844903673697402887\">Android Webview H5 秒开方案实现</a>\n<a href=\"#fnref:1\" rev=\"footnote\" class=\"footnote-backref\"> ↩</a></span></span></li></ol></div></section>","site":{"data":{}},"wordcount":171,"more":"<h3 id=\"WebView\"><a href=\"#WebView\" class=\"headerlink\" title=\"WebView\"></a>WebView</h3><p>现在 Android App大多嵌入了 Android Webview 组件进行 Hybrid 开发，它具备开发周期短、灵活性好的优点，但是缺点也很明显，加载速度慢 &amp; 消耗流量。引起缺点的主要原因如下：</p>\n<ol>\n<li>js解析效率，以及手机硬件设备的性能</li>\n<li>页面资源的下载（图片、js文件、css文件）</li>\n</ol>\n<h2 id=\"参考资料\"><a href=\"#参考资料\" class=\"headerlink\" title=\"参考资料\"></a>参考资料</h2><section class=\"footnotes\"><div class=\"footnote-list\"><ol><li><span id=\"fn:1\" class=\"footnote-text\"><span><a href=\"https://juejin.cn/post/6844903673697402887\">Android Webview H5 秒开方案实现</a>\n<a href=\"#fnref:1\" rev=\"footnote\" class=\"footnote-backref\"> ↩</a></span></span></li></ol></div></section>"},{"title":"Hello_AlexCc","date":"2019-07-29T15:37:50.000Z","banner_img":"/img/chicken.jpg","index_img":"/img/chicken.jpg","excerpt":"First Article","_content":"\n### What\n> This is my first Blog.\n\n### No.2\n```js\nif (true) {\n    console.log(\"Hello_AlexCc!\")\n}\n\nreturn \"ヾ(◍°∇°◍)ﾉﾞ\"\n```\n","source":"_posts/first-article.md","raw":"---\ntitle: Hello_AlexCc\ndate: 2019-07-29 23:37:50\ntags: One\nbanner_img: /img/chicken.jpg\nindex_img: /img/chicken.jpg\nexcerpt: First Article\n---\n\n### What\n> This is my first Blog.\n\n### No.2\n```js\nif (true) {\n    console.log(\"Hello_AlexCc!\")\n}\n\nreturn \"ヾ(◍°∇°◍)ﾉﾞ\"\n```\n","slug":"first-article","published":1,"updated":"2023-05-12T10:49:20.012Z","comments":1,"layout":"post","photos":[],"link":"","_id":"clhkizgxe000a3y0qgva8ec1w","content":"<h3 id=\"What\"><a href=\"#What\" class=\"headerlink\" title=\"What\"></a>What</h3><blockquote>\n<p>This is my first Blog.</p>\n</blockquote>\n<h3 id=\"No-2\"><a href=\"#No-2\" class=\"headerlink\" title=\"No.2\"></a>No.2</h3><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><div class=\"code-wrapper\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></div></td><td class=\"code\"><pre><code class=\"hljs js\"><span class=\"hljs-keyword\">if</span> (<span class=\"hljs-literal\">true</span>) &#123;<br>    <span class=\"hljs-variable language_\">console</span>.<span class=\"hljs-title function_\">log</span>(<span class=\"hljs-string\">&quot;Hello_AlexCc!&quot;</span>)<br>&#125;<br><br><span class=\"hljs-keyword\">return</span> <span class=\"hljs-string\">&quot;ヾ(◍°∇°◍)ﾉﾞ&quot;</span><br></code></pre></td></tr></table></figure>\n","site":{"data":{}},"wordcount":117,"more":"<h3 id=\"What\"><a href=\"#What\" class=\"headerlink\" title=\"What\"></a>What</h3><blockquote>\n<p>This is my first Blog.</p>\n</blockquote>\n<h3 id=\"No-2\"><a href=\"#No-2\" class=\"headerlink\" title=\"No.2\"></a>No.2</h3><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\"><span class=\"hljs-keyword\">if</span> (<span class=\"hljs-literal\">true</span>) &#123;<br>    <span class=\"hljs-variable language_\">console</span>.<span class=\"hljs-title function_\">log</span>(<span class=\"hljs-string\">&quot;Hello_AlexCc!&quot;</span>)<br>&#125;<br><br><span class=\"hljs-keyword\">return</span> <span class=\"hljs-string\">&quot;ヾ(◍°∇°◍)ﾉﾞ&quot;</span><br></code></pre></td></tr></table></figure>\n"},{"title":"如何编写高标准的 JavaScript 代码","date":"2022-03-31T02:12:23.000Z","banner_img":"/img/god.jpg","index_img":"/img/god.jpg","excerpt":"代码量少，运行速度不一定快；代码量多，运行速度也不一定慢。","comment":true,"_content":"\n# 概述\n\n你是否曾经为了提供一个简单的应用解决方案而彻夜地查看源代码？\n你是否曾经为了理解某个框架而冥思苦想、阅览群书？\n你是否曾经为了提升0.1s的DOM性能而对多种实现方案进行严格测试和对比？\n你是否曾经为了避免兼容问题而遍寻高手共同“诊治”？\n\n跟我一起，专注高质量 `JavaScript` 代码，少出 `Bug🐛`，早下班 !\n\n> 期望为读者带来如下帮助 📚：\n\n  ❑ 能写出简单、清晰、高效的代码。\n  ❑ 能搭建一个稳定、健壮、快捷的应用框架。\n  ❑ 能回答一个困扰很多人的技术问题。\n  ❑ 能修复一个应用开发中遇到的大的Bug。\n  ❑ 能非常熟悉某个开源产品。\n  ❑ 能提升客户端应用性能。\n\n## JavaScript 基础\n\n代码量少，运行速度不一定快；代码量多，运行速度也不一定慢。\n\n### 减少全局变量\n1. 多个全局变量都追加在一个名称空间下，将显著降低与其他应用程序产生冲突的概率\n    ```js\n      const namespace = {}\n\n      namespace.name = 'my namespace'\n    ```\n2. 使用闭包体将信息隐藏，它是另一种有效减少“全局污染”的方法。\n    ```js\n      const sayName = function() {\n        const name = 'closure'\n\n        return function() {\n          alert(name)\n        }\n      }()\n    ```\n3. 作用域控制着变量与参数的可见性及生命周期。\n\n    JavaScript支持函数作用域，定义在函数中的参数和变量在函数外部是不可见的，并且在一个函数中的任何位置定义的变量在该函数中的任何地方都可见。它不仅减少了名称冲突，并且提供了自动内存管理。\n4. ES6 模块化编程中每个 js 文件内部定义的变量，外部无法获取。如果外部需要模块内部变量，通过 export 导出。\n    ```js\n      <script>\n        var windowA = 'window a'\n\n        console.log(window.windowA) // 输出 'window a'\n      </script>\n\n      <script type=\"module\">\n        var moduleA = 'module a'\n\n        console.log(window.moduleA) // 输出 undefined\n      </script>\n    ```\n\n    \n\n### 谨慎JS数据类型\n\n在自动转换数据类型时，JavaScript一般遵循：如果某个类型的值被用于需要其他类型的值的环境中，JavaScript就自动将这个值转换成所需要的类型。\n\n#### 类型转换\n\n慎用JavaScript类型自动转换，注意`自动转换规则`:\n\n1. 如果把非空对象用在逻辑运算环境中，则对象被转换为true。此时的对象包括所有类型的对象，即使是值为false的包装对象也被转换为true。\n2. 果把对象用在数值运算环境中，则对象会被自动转换为数字，如果转换失败，则返回值为NaN。\n3. 当数组被用在数值运算环境中时，数组将根据包含的元素来决定转换的值。如果数组为空数组，则被转换为数值0。如果数组仅包含一个数字元素，则被转换为该数字的数值。如果数组包含多个元素，或者仅包含一个非数字元素，则返回NaN。\n\n  🌰\n  ```js\n  // 对象\n  const obj = {}\n  obj && 1 >> 1\n  obj + 1 >> '[object Object]1'\n\n  obj.valueOf = function() { return 99 }\n  obj + 1 >> 100\n\n  // 数组自动转换规则\n  +[] >> 0\n  +[1] >> 1\n  +[1,2] >> NaN\n  ```\n\n#### 类型判断\n1. `typeof`\n对于任何变量来说，使用typeof运算符总是以字符串的形式返回以下6种类型之一：\n  ❑ \"number\"\n  ❑ \"string\"\n  ❑ \"boolean\"\n  ❑ \"object\"\n  ❑ \"function\"\n  ❑ \"undefined\"\n\n  令人疑惑的是，在使用 `typeof` 检测null值时，返回的是“object”，而不是“null”。\n  ```js\n  typeof null >> 'object'\n\n  typeof [] >> 'object'\n\n  typeof {} >> 'object'\n  ```\n\n2. `instanceof`\n\n  instanceof 运算符用于检测构造函数的 prototype 属性是否出现在某个实例对象的`原型链`上。\n\n  这个在判断对象时存在一些不确定性，来看下例子：\n\n  🌰\n\n  ```js\n  function Person(name) {\n    this.name = name\n  }\n  const p = new Person('hello')\n  p instanceof Person >> true\n  p instanceof Object >> true\n  ```\n\n  再看一个🌰:\n  ```js\n  function Person(name) {\n    this.name = name\n  }\n\n  function Child(name) {\n    this.name = name\n  }\n\n  Child.prototype = Person.prototype\n  Child.prototype.constructor = Child\n\n  const p = new Child('hello child')\n\n  p instanceof Person >> true\n  p instanceof Object >> true\n  ```\n\n  如果是判断数组呢?\n  ```js\n  [] instanceof Array >> true\n\n  [] instanceof Object >> true\n\n  // 当然这种方式存在不确定性，我们可以使用 Array.isArray() 方法来判断\n  Array.isArray([]) >> true\n  Array.isArray({}) >> false\n  ```\n\n  从上面例子可以看出，使用 `instanceof` 来判断时存在种种不确定性，只要出现在原型链上的对象都会返回 `true`，使用的时候还需要着重注意！\n\n  为什么会这样，想必大家应该想起来了！\n\n  **Object类是所有对象类型的的父类!**\n\n3. `toString() 方法`\n\n  > 每个对象都有一个 toString() 方法，当该对象被表示为一个文本值时，或者一个对象以预期的字符串方式引用时自动调用。默认情况下，toString() 方法被每个 Object 对象继承。如果此方法在自定义对象中未被覆盖，toString() 返回 \"[object type]\"，其中 type 是对象的类型。\n\n  toString() 方法，它定义在 Object 的原型对象上，对象在调用时会返回一个表示该对象的字符串。\n\n  使用 `toString()` 方法检测对象类型是最安全、最准确的。调用toString()方法把对象转换为字符串，然后通过检测字符串中是否包含数组所特有的标志字符可以确定对象的类型。\n\n  为什么说 `toString` 方法用来检测对象类型是最安全、最准确的，我们慢慢来看吧~\n\n  先看看在对象上直接使用 `toString`会是什么结果：\n\n  ```js\n  const obj = { a: 1 }\n  const arr = [1, 2]\n\n  obj.toString() >> '[object Object]'\n\n  // 如果是数组的话，则输出字符串\n  arr.toString() >> '1,2'\n\n\n  // 当然我们可以重写/覆盖原型链上的 toString 方法\n  obj.toString = function() {\n    return 'overwrite'\n  }\n  obj.toString() >> 'overwrite'\n  ```\n\n  既然 toString 方法定义在原型对象上，我们看看如果单独调用它，会是什么结果呢?\n  ```js\n  Object.prototype.toString() >> '[object Object]'\n  ```\n\n  如果通过 `call/apply` 方法，改变 `toString` 方法内部的 `this` 执行，又会是什么结果呢?\n\n  看到如下结果，我相信这绝对可以完美 cover 住项目里面所有的类型判断了！所以说它是最安全、最准确的类型判断，没有异议吧😏\n  ```js\n  Object.prototype.toString.call({}) >> '[object Object]'\n  \n  Object.prototype.toString.call([]) >> '[object Array]'\n  \n  Object.prototype.toString.call(function(){}) >> '[object Function]'\n  \n  Object.prototype.toString.call('') >> '[object String]'\n  \n  Object.prototype.toString.call(1) >> '[object Number]'\n  \n  Object.prototype.toString.call(true) >> '[object Boolean]'\n  \n  Object.prototype.toString.call(null) >> '[object Null]'\n  \n  Object.prototype.toString.call(undefined) >> '[object Undefined]'\n  \n  Object.prototype.toString.call() >> '[object Undefined]'\n  \n  Object.prototype.toString.call(new Date()) >> '[object Date]'\n  \n  Object.prototype.toString.call(/at/) >> '[object RegExp]'\n  \n  ```\n\n  那么它是如何做到的呢，我们来扒一扒它的原理！在 `toString` 方法被调用时，会执行以下几个操作步骤:\n\n  1. 获取this指向的那个对象的`[[Class]]`属性的值。（`call/apply` 改变 this 指向）\n  2. 计算出三个字符串\"[object \"、 第一步的操作结果、 以及 \"]\" 连接后的新字符串。\n  3. 返回第二步的操作结果，也就是类似 `'[object Type]'` 这种格式字符串。\n\n  需要注意的是，对象的`[[Class]]`属性是无法直接访问的，它一个内部属性，所有的对象(原生对象和宿主对象)都拥有该属性，且不能被任何人修改。在规范中，`[[Class]]`是这么定义的：`内部属性`描述。\n\n  如果要单独或者对象的 `[[Class]]`，我们可以这样做:\n  ```js\n  const targetObj = []\n  Object.prototype.toString.call(targetObj).slice(8, -1) >> 'Array'\n  ```\n\n  既然它如此好用，难道就没有缺点吗？\n\n  答案是当然有的，毕竟凡事都不可能那么绝对的嘛！\n\n  那么缺点是什么呢？\n  第一，`toString()` 会进行装箱操作，产生很多临时对象。（装箱就是将基本类型的数据，通过引用类型包装起来，从而可以使用引用类上的方法）\n```js\n// 你肯定不能这样用\n1.toString() >> SyntaxError: Invalid or unexpected token\n\n// 你必须这样用\n(1).toString() >> '1'\n```\n  第二，无法区分自定义对象类型，用来判断这类对象时，返回的都是`Object`，这样我们就需要通过 `instanceof` 来判断了。\n  ```js\n  function Person(){}\n  const p = new Person()\n\n  Object.prototype.toString.call(p) >> '[object Object]'\n  ```\n\n\n\n### 字符串\nJavaScript解释器强制约定字符串在堆区存储的数据是不可变的，也就是说，JavaScript解释器强制约定字符串在堆区存储的数据是不可变的。\n\n\n\n\n## 参考资料\n[^1]: 参考资料\n[^2]: 参考资料2\n","source":"_posts/js-advice.md","raw":"---\ntitle: 如何编写高标准的 JavaScript 代码\ndate: 2022-03-31 10:12:23\ntags: JavaScript, ES6\nbanner_img: /img/god.jpg\nindex_img: /img/god.jpg\nexcerpt: 代码量少，运行速度不一定快；代码量多，运行速度也不一定慢。\ncomment: true\n---\n\n# 概述\n\n你是否曾经为了提供一个简单的应用解决方案而彻夜地查看源代码？\n你是否曾经为了理解某个框架而冥思苦想、阅览群书？\n你是否曾经为了提升0.1s的DOM性能而对多种实现方案进行严格测试和对比？\n你是否曾经为了避免兼容问题而遍寻高手共同“诊治”？\n\n跟我一起，专注高质量 `JavaScript` 代码，少出 `Bug🐛`，早下班 !\n\n> 期望为读者带来如下帮助 📚：\n\n  ❑ 能写出简单、清晰、高效的代码。\n  ❑ 能搭建一个稳定、健壮、快捷的应用框架。\n  ❑ 能回答一个困扰很多人的技术问题。\n  ❑ 能修复一个应用开发中遇到的大的Bug。\n  ❑ 能非常熟悉某个开源产品。\n  ❑ 能提升客户端应用性能。\n\n## JavaScript 基础\n\n代码量少，运行速度不一定快；代码量多，运行速度也不一定慢。\n\n### 减少全局变量\n1. 多个全局变量都追加在一个名称空间下，将显著降低与其他应用程序产生冲突的概率\n    ```js\n      const namespace = {}\n\n      namespace.name = 'my namespace'\n    ```\n2. 使用闭包体将信息隐藏，它是另一种有效减少“全局污染”的方法。\n    ```js\n      const sayName = function() {\n        const name = 'closure'\n\n        return function() {\n          alert(name)\n        }\n      }()\n    ```\n3. 作用域控制着变量与参数的可见性及生命周期。\n\n    JavaScript支持函数作用域，定义在函数中的参数和变量在函数外部是不可见的，并且在一个函数中的任何位置定义的变量在该函数中的任何地方都可见。它不仅减少了名称冲突，并且提供了自动内存管理。\n4. ES6 模块化编程中每个 js 文件内部定义的变量，外部无法获取。如果外部需要模块内部变量，通过 export 导出。\n    ```js\n      <script>\n        var windowA = 'window a'\n\n        console.log(window.windowA) // 输出 'window a'\n      </script>\n\n      <script type=\"module\">\n        var moduleA = 'module a'\n\n        console.log(window.moduleA) // 输出 undefined\n      </script>\n    ```\n\n    \n\n### 谨慎JS数据类型\n\n在自动转换数据类型时，JavaScript一般遵循：如果某个类型的值被用于需要其他类型的值的环境中，JavaScript就自动将这个值转换成所需要的类型。\n\n#### 类型转换\n\n慎用JavaScript类型自动转换，注意`自动转换规则`:\n\n1. 如果把非空对象用在逻辑运算环境中，则对象被转换为true。此时的对象包括所有类型的对象，即使是值为false的包装对象也被转换为true。\n2. 果把对象用在数值运算环境中，则对象会被自动转换为数字，如果转换失败，则返回值为NaN。\n3. 当数组被用在数值运算环境中时，数组将根据包含的元素来决定转换的值。如果数组为空数组，则被转换为数值0。如果数组仅包含一个数字元素，则被转换为该数字的数值。如果数组包含多个元素，或者仅包含一个非数字元素，则返回NaN。\n\n  🌰\n  ```js\n  // 对象\n  const obj = {}\n  obj && 1 >> 1\n  obj + 1 >> '[object Object]1'\n\n  obj.valueOf = function() { return 99 }\n  obj + 1 >> 100\n\n  // 数组自动转换规则\n  +[] >> 0\n  +[1] >> 1\n  +[1,2] >> NaN\n  ```\n\n#### 类型判断\n1. `typeof`\n对于任何变量来说，使用typeof运算符总是以字符串的形式返回以下6种类型之一：\n  ❑ \"number\"\n  ❑ \"string\"\n  ❑ \"boolean\"\n  ❑ \"object\"\n  ❑ \"function\"\n  ❑ \"undefined\"\n\n  令人疑惑的是，在使用 `typeof` 检测null值时，返回的是“object”，而不是“null”。\n  ```js\n  typeof null >> 'object'\n\n  typeof [] >> 'object'\n\n  typeof {} >> 'object'\n  ```\n\n2. `instanceof`\n\n  instanceof 运算符用于检测构造函数的 prototype 属性是否出现在某个实例对象的`原型链`上。\n\n  这个在判断对象时存在一些不确定性，来看下例子：\n\n  🌰\n\n  ```js\n  function Person(name) {\n    this.name = name\n  }\n  const p = new Person('hello')\n  p instanceof Person >> true\n  p instanceof Object >> true\n  ```\n\n  再看一个🌰:\n  ```js\n  function Person(name) {\n    this.name = name\n  }\n\n  function Child(name) {\n    this.name = name\n  }\n\n  Child.prototype = Person.prototype\n  Child.prototype.constructor = Child\n\n  const p = new Child('hello child')\n\n  p instanceof Person >> true\n  p instanceof Object >> true\n  ```\n\n  如果是判断数组呢?\n  ```js\n  [] instanceof Array >> true\n\n  [] instanceof Object >> true\n\n  // 当然这种方式存在不确定性，我们可以使用 Array.isArray() 方法来判断\n  Array.isArray([]) >> true\n  Array.isArray({}) >> false\n  ```\n\n  从上面例子可以看出，使用 `instanceof` 来判断时存在种种不确定性，只要出现在原型链上的对象都会返回 `true`，使用的时候还需要着重注意！\n\n  为什么会这样，想必大家应该想起来了！\n\n  **Object类是所有对象类型的的父类!**\n\n3. `toString() 方法`\n\n  > 每个对象都有一个 toString() 方法，当该对象被表示为一个文本值时，或者一个对象以预期的字符串方式引用时自动调用。默认情况下，toString() 方法被每个 Object 对象继承。如果此方法在自定义对象中未被覆盖，toString() 返回 \"[object type]\"，其中 type 是对象的类型。\n\n  toString() 方法，它定义在 Object 的原型对象上，对象在调用时会返回一个表示该对象的字符串。\n\n  使用 `toString()` 方法检测对象类型是最安全、最准确的。调用toString()方法把对象转换为字符串，然后通过检测字符串中是否包含数组所特有的标志字符可以确定对象的类型。\n\n  为什么说 `toString` 方法用来检测对象类型是最安全、最准确的，我们慢慢来看吧~\n\n  先看看在对象上直接使用 `toString`会是什么结果：\n\n  ```js\n  const obj = { a: 1 }\n  const arr = [1, 2]\n\n  obj.toString() >> '[object Object]'\n\n  // 如果是数组的话，则输出字符串\n  arr.toString() >> '1,2'\n\n\n  // 当然我们可以重写/覆盖原型链上的 toString 方法\n  obj.toString = function() {\n    return 'overwrite'\n  }\n  obj.toString() >> 'overwrite'\n  ```\n\n  既然 toString 方法定义在原型对象上，我们看看如果单独调用它，会是什么结果呢?\n  ```js\n  Object.prototype.toString() >> '[object Object]'\n  ```\n\n  如果通过 `call/apply` 方法，改变 `toString` 方法内部的 `this` 执行，又会是什么结果呢?\n\n  看到如下结果，我相信这绝对可以完美 cover 住项目里面所有的类型判断了！所以说它是最安全、最准确的类型判断，没有异议吧😏\n  ```js\n  Object.prototype.toString.call({}) >> '[object Object]'\n  \n  Object.prototype.toString.call([]) >> '[object Array]'\n  \n  Object.prototype.toString.call(function(){}) >> '[object Function]'\n  \n  Object.prototype.toString.call('') >> '[object String]'\n  \n  Object.prototype.toString.call(1) >> '[object Number]'\n  \n  Object.prototype.toString.call(true) >> '[object Boolean]'\n  \n  Object.prototype.toString.call(null) >> '[object Null]'\n  \n  Object.prototype.toString.call(undefined) >> '[object Undefined]'\n  \n  Object.prototype.toString.call() >> '[object Undefined]'\n  \n  Object.prototype.toString.call(new Date()) >> '[object Date]'\n  \n  Object.prototype.toString.call(/at/) >> '[object RegExp]'\n  \n  ```\n\n  那么它是如何做到的呢，我们来扒一扒它的原理！在 `toString` 方法被调用时，会执行以下几个操作步骤:\n\n  1. 获取this指向的那个对象的`[[Class]]`属性的值。（`call/apply` 改变 this 指向）\n  2. 计算出三个字符串\"[object \"、 第一步的操作结果、 以及 \"]\" 连接后的新字符串。\n  3. 返回第二步的操作结果，也就是类似 `'[object Type]'` 这种格式字符串。\n\n  需要注意的是，对象的`[[Class]]`属性是无法直接访问的，它一个内部属性，所有的对象(原生对象和宿主对象)都拥有该属性，且不能被任何人修改。在规范中，`[[Class]]`是这么定义的：`内部属性`描述。\n\n  如果要单独或者对象的 `[[Class]]`，我们可以这样做:\n  ```js\n  const targetObj = []\n  Object.prototype.toString.call(targetObj).slice(8, -1) >> 'Array'\n  ```\n\n  既然它如此好用，难道就没有缺点吗？\n\n  答案是当然有的，毕竟凡事都不可能那么绝对的嘛！\n\n  那么缺点是什么呢？\n  第一，`toString()` 会进行装箱操作，产生很多临时对象。（装箱就是将基本类型的数据，通过引用类型包装起来，从而可以使用引用类上的方法）\n```js\n// 你肯定不能这样用\n1.toString() >> SyntaxError: Invalid or unexpected token\n\n// 你必须这样用\n(1).toString() >> '1'\n```\n  第二，无法区分自定义对象类型，用来判断这类对象时，返回的都是`Object`，这样我们就需要通过 `instanceof` 来判断了。\n  ```js\n  function Person(){}\n  const p = new Person()\n\n  Object.prototype.toString.call(p) >> '[object Object]'\n  ```\n\n\n\n### 字符串\nJavaScript解释器强制约定字符串在堆区存储的数据是不可变的，也就是说，JavaScript解释器强制约定字符串在堆区存储的数据是不可变的。\n\n\n\n\n## 参考资料\n[^1]: 参考资料\n[^2]: 参考资料2\n","slug":"js-advice","published":1,"updated":"2023-05-12T10:49:20.013Z","comments":1,"layout":"post","photos":[],"link":"","_id":"clhkizgxg000c3y0qdeaj9tgs","content":"<h1 id=\"概述\"><a href=\"#概述\" class=\"headerlink\" title=\"概述\"></a>概述</h1><p>你是否曾经为了提供一个简单的应用解决方案而彻夜地查看源代码？<br>你是否曾经为了理解某个框架而冥思苦想、阅览群书？<br>你是否曾经为了提升0.1s的DOM性能而对多种实现方案进行严格测试和对比？<br>你是否曾经为了避免兼容问题而遍寻高手共同“诊治”？</p>\n<p>跟我一起，专注高质量 <code>JavaScript</code> 代码，少出 <code>Bug🐛</code>，早下班 !</p>\n<blockquote>\n<p>期望为读者带来如下帮助 📚：</p>\n</blockquote>\n<p>  ❑ 能写出简单、清晰、高效的代码。<br>  ❑ 能搭建一个稳定、健壮、快捷的应用框架。<br>  ❑ 能回答一个困扰很多人的技术问题。<br>  ❑ 能修复一个应用开发中遇到的大的Bug。<br>  ❑ 能非常熟悉某个开源产品。<br>  ❑ 能提升客户端应用性能。</p>\n<h2 id=\"JavaScript-基础\"><a href=\"#JavaScript-基础\" class=\"headerlink\" title=\"JavaScript 基础\"></a>JavaScript 基础</h2><p>代码量少，运行速度不一定快；代码量多，运行速度也不一定慢。</p>\n<h3 id=\"减少全局变量\"><a href=\"#减少全局变量\" class=\"headerlink\" title=\"减少全局变量\"></a>减少全局变量</h3><ol>\n<li><p>多个全局变量都追加在一个名称空间下，将显著降低与其他应用程序产生冲突的概率</p>\n <figure class=\"highlight js\"><table><tr><td class=\"gutter\"><div class=\"code-wrapper\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></div></td><td class=\"code\"><pre><code class=\"hljs js\"><span class=\"hljs-keyword\">const</span> namespace = &#123;&#125;<br><br>namespace.<span class=\"hljs-property\">name</span> = <span class=\"hljs-string\">&#x27;my namespace&#x27;</span><br></code></pre></td></tr></table></figure></li>\n<li><p>使用闭包体将信息隐藏，它是另一种有效减少“全局污染”的方法。</p>\n <figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\"><span class=\"hljs-keyword\">const</span> sayName = <span class=\"hljs-keyword\">function</span>(<span class=\"hljs-params\"></span>) &#123;<br>  <span class=\"hljs-keyword\">const</span> name = <span class=\"hljs-string\">&#x27;closure&#x27;</span><br><br>  <span class=\"hljs-keyword\">return</span> <span class=\"hljs-keyword\">function</span>(<span class=\"hljs-params\"></span>) &#123;<br>    <span class=\"hljs-title function_\">alert</span>(name)<br>  &#125;<br>&#125;()<br></code></pre></td></tr></table></figure></li>\n<li><p>作用域控制着变量与参数的可见性及生命周期。</p>\n<p> JavaScript支持函数作用域，定义在函数中的参数和变量在函数外部是不可见的，并且在一个函数中的任何位置定义的变量在该函数中的任何地方都可见。它不仅减少了名称冲突，并且提供了自动内存管理。</p>\n</li>\n<li><p>ES6 模块化编程中每个 js 文件内部定义的变量，外部无法获取。如果外部需要模块内部变量，通过 export 导出。</p>\n <figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\">&lt;script&gt;<br>  <span class=\"hljs-keyword\">var</span> windowA = <span class=\"hljs-string\">&#x27;window a&#x27;</span><br><br>  <span class=\"hljs-variable language_\">console</span>.<span class=\"hljs-title function_\">log</span>(<span class=\"hljs-variable language_\">window</span>.<span class=\"hljs-property\">windowA</span>) <span class=\"hljs-comment\">// 输出 &#x27;window a&#x27;</span><br>&lt;/script&gt;<br><br><span class=\"language-xml\"><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">script</span> <span class=\"hljs-attr\">type</span>=<span class=\"hljs-string\">&quot;module&quot;</span>&gt;</span><span class=\"language-javascript\"></span></span><br><span class=\"language-javascript\"><span class=\"language-xml\">  <span class=\"hljs-keyword\">var</span> moduleA = <span class=\"hljs-string\">&#x27;module a&#x27;</span></span></span><br><span class=\"language-javascript\"><span class=\"language-xml\"></span></span><br><span class=\"language-javascript\"><span class=\"language-xml\">  <span class=\"hljs-variable language_\">console</span>.<span class=\"hljs-title function_\">log</span>(<span class=\"hljs-variable language_\">window</span>.<span class=\"hljs-property\">moduleA</span>) <span class=\"hljs-comment\">// 输出 undefined</span></span></span><br><span class=\"language-javascript\"><span class=\"language-xml\"></span><span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">script</span>&gt;</span></span><br></code></pre></td></tr></table></figure>\n\n\n\n</li>\n</ol>\n<h3 id=\"谨慎JS数据类型\"><a href=\"#谨慎JS数据类型\" class=\"headerlink\" title=\"谨慎JS数据类型\"></a>谨慎JS数据类型</h3><p>在自动转换数据类型时，JavaScript一般遵循：如果某个类型的值被用于需要其他类型的值的环境中，JavaScript就自动将这个值转换成所需要的类型。</p>\n<h4 id=\"类型转换\"><a href=\"#类型转换\" class=\"headerlink\" title=\"类型转换\"></a>类型转换</h4><p>慎用JavaScript类型自动转换，注意<code>自动转换规则</code>:</p>\n<ol>\n<li><p>如果把非空对象用在逻辑运算环境中，则对象被转换为true。此时的对象包括所有类型的对象，即使是值为false的包装对象也被转换为true。</p>\n</li>\n<li><p>果把对象用在数值运算环境中，则对象会被自动转换为数字，如果转换失败，则返回值为NaN。</p>\n</li>\n<li><p>当数组被用在数值运算环境中时，数组将根据包含的元素来决定转换的值。如果数组为空数组，则被转换为数值0。如果数组仅包含一个数字元素，则被转换为该数字的数值。如果数组包含多个元素，或者仅包含一个非数字元素，则返回NaN。</p>\n<p>🌰</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\"><span class=\"hljs-comment\">// 对象</span><br><span class=\"hljs-keyword\">const</span> obj = &#123;&#125;<br>obj &amp;&amp; <span class=\"hljs-number\">1</span> &gt;&gt; <span class=\"hljs-number\">1</span><br>obj + <span class=\"hljs-number\">1</span> &gt;&gt; <span class=\"hljs-string\">&#x27;[object Object]1&#x27;</span><br><br>obj.<span class=\"hljs-property\">valueOf</span> = <span class=\"hljs-keyword\">function</span>(<span class=\"hljs-params\"></span>) &#123; <span class=\"hljs-keyword\">return</span> <span class=\"hljs-number\">99</span> &#125;<br>obj + <span class=\"hljs-number\">1</span> &gt;&gt; <span class=\"hljs-number\">100</span><br><br><span class=\"hljs-comment\">// 数组自动转换规则</span><br>+[] &gt;&gt; <span class=\"hljs-number\">0</span><br>+[<span class=\"hljs-number\">1</span>] &gt;&gt; <span class=\"hljs-number\">1</span><br>+[<span class=\"hljs-number\">1</span>,<span class=\"hljs-number\">2</span>] &gt;&gt; <span class=\"hljs-title class_\">NaN</span><br></code></pre></td></tr></table></figure>\n\n</li>\n</ol>\n<h4 id=\"类型判断\"><a href=\"#类型判断\" class=\"headerlink\" title=\"类型判断\"></a>类型判断</h4><ol>\n<li><p><code>typeof</code><br>对于任何变量来说，使用typeof运算符总是以字符串的形式返回以下6种类型之一：<br>❑ “number”<br>❑ “string”<br>❑ “boolean”<br>❑ “object”<br>❑ “function”<br>❑ “undefined”</p>\n<p>令人疑惑的是，在使用 <code>typeof</code> 检测null值时，返回的是“object”，而不是“null”。</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\"><span class=\"hljs-keyword\">typeof</span> <span class=\"hljs-literal\">null</span> &gt;&gt; <span class=\"hljs-string\">&#x27;object&#x27;</span><br><br><span class=\"hljs-keyword\">typeof</span> [] &gt;&gt; <span class=\"hljs-string\">&#x27;object&#x27;</span><br><br><span class=\"hljs-keyword\">typeof</span> &#123;&#125; &gt;&gt; <span class=\"hljs-string\">&#x27;object&#x27;</span><br></code></pre></td></tr></table></figure>\n</li>\n<li><p><code>instanceof</code></p>\n<p>instanceof 运算符用于检测构造函数的 prototype 属性是否出现在某个实例对象的<code>原型链</code>上。</p>\n<p>这个在判断对象时存在一些不确定性，来看下例子：</p>\n<p>🌰</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\"><span class=\"hljs-keyword\">function</span> <span class=\"hljs-title function_\">Person</span>(<span class=\"hljs-params\">name</span>) &#123;<br>  <span class=\"hljs-variable language_\">this</span>.<span class=\"hljs-property\">name</span> = name<br>&#125;<br><span class=\"hljs-keyword\">const</span> p = <span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">Person</span>(<span class=\"hljs-string\">&#x27;hello&#x27;</span>)<br>p <span class=\"hljs-keyword\">instanceof</span> <span class=\"hljs-title class_\">Person</span> &gt;&gt; <span class=\"hljs-literal\">true</span><br>p <span class=\"hljs-keyword\">instanceof</span> <span class=\"hljs-title class_\">Object</span> &gt;&gt; <span class=\"hljs-literal\">true</span><br></code></pre></td></tr></table></figure>\n\n<p>再看一个🌰:</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\"><span class=\"hljs-keyword\">function</span> <span class=\"hljs-title function_\">Person</span>(<span class=\"hljs-params\">name</span>) &#123;<br>  <span class=\"hljs-variable language_\">this</span>.<span class=\"hljs-property\">name</span> = name<br>&#125;<br><br><span class=\"hljs-keyword\">function</span> <span class=\"hljs-title function_\">Child</span>(<span class=\"hljs-params\">name</span>) &#123;<br>  <span class=\"hljs-variable language_\">this</span>.<span class=\"hljs-property\">name</span> = name<br>&#125;<br><br><span class=\"hljs-title class_\">Child</span>.<span class=\"hljs-property\"><span class=\"hljs-keyword\">prototype</span></span> = <span class=\"hljs-title class_\">Person</span>.<span class=\"hljs-property\"><span class=\"hljs-keyword\">prototype</span></span><br><span class=\"hljs-title class_\">Child</span>.<span class=\"hljs-property\"><span class=\"hljs-keyword\">prototype</span></span>.<span class=\"hljs-property\">constructor</span> = <span class=\"hljs-title class_\">Child</span><br><br><span class=\"hljs-keyword\">const</span> p = <span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">Child</span>(<span class=\"hljs-string\">&#x27;hello child&#x27;</span>)<br><br>p <span class=\"hljs-keyword\">instanceof</span> <span class=\"hljs-title class_\">Person</span> &gt;&gt; <span class=\"hljs-literal\">true</span><br>p <span class=\"hljs-keyword\">instanceof</span> <span class=\"hljs-title class_\">Object</span> &gt;&gt; <span class=\"hljs-literal\">true</span><br></code></pre></td></tr></table></figure>\n\n<p>如果是判断数组呢?</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\">[] <span class=\"hljs-keyword\">instanceof</span> <span class=\"hljs-title class_\">Array</span> &gt;&gt; <span class=\"hljs-literal\">true</span><br><br>[] <span class=\"hljs-keyword\">instanceof</span> <span class=\"hljs-title class_\">Object</span> &gt;&gt; <span class=\"hljs-literal\">true</span><br><br><span class=\"hljs-comment\">// 当然这种方式存在不确定性，我们可以使用 Array.isArray() 方法来判断</span><br><span class=\"hljs-title class_\">Array</span>.<span class=\"hljs-title function_\">isArray</span>([]) &gt;&gt; <span class=\"hljs-literal\">true</span><br><span class=\"hljs-title class_\">Array</span>.<span class=\"hljs-title function_\">isArray</span>(&#123;&#125;) &gt;&gt; <span class=\"hljs-literal\">false</span><br></code></pre></td></tr></table></figure>\n\n<p>从上面例子可以看出，使用 <code>instanceof</code> 来判断时存在种种不确定性，只要出现在原型链上的对象都会返回 <code>true</code>，使用的时候还需要着重注意！</p>\n<p>为什么会这样，想必大家应该想起来了！</p>\n<p><strong>Object类是所有对象类型的的父类!</strong></p>\n</li>\n<li><p><code>toString() 方法</code></p>\n<blockquote>\n<p>每个对象都有一个 toString() 方法，当该对象被表示为一个文本值时，或者一个对象以预期的字符串方式引用时自动调用。默认情况下，toString() 方法被每个 Object 对象继承。如果此方法在自定义对象中未被覆盖，toString() 返回 “[object type]”，其中 type 是对象的类型。</p>\n</blockquote>\n<p>toString() 方法，它定义在 Object 的原型对象上，对象在调用时会返回一个表示该对象的字符串。</p>\n<p>使用 <code>toString()</code> 方法检测对象类型是最安全、最准确的。调用toString()方法把对象转换为字符串，然后通过检测字符串中是否包含数组所特有的标志字符可以确定对象的类型。</p>\n<p>为什么说 <code>toString</code> 方法用来检测对象类型是最安全、最准确的，我们慢慢来看吧~</p>\n<p>先看看在对象上直接使用 <code>toString</code>会是什么结果：</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\"><span class=\"hljs-keyword\">const</span> obj = &#123; <span class=\"hljs-attr\">a</span>: <span class=\"hljs-number\">1</span> &#125;<br><span class=\"hljs-keyword\">const</span> arr = [<span class=\"hljs-number\">1</span>, <span class=\"hljs-number\">2</span>]<br><br>obj.<span class=\"hljs-title function_\">toString</span>() &gt;&gt; <span class=\"hljs-string\">&#x27;[object Object]&#x27;</span><br><br><span class=\"hljs-comment\">// 如果是数组的话，则输出字符串</span><br>arr.<span class=\"hljs-title function_\">toString</span>() &gt;&gt; <span class=\"hljs-string\">&#x27;1,2&#x27;</span><br><br><br><span class=\"hljs-comment\">// 当然我们可以重写/覆盖原型链上的 toString 方法</span><br>obj.<span class=\"hljs-property\">toString</span> = <span class=\"hljs-keyword\">function</span>(<span class=\"hljs-params\"></span>) &#123;<br>  <span class=\"hljs-keyword\">return</span> <span class=\"hljs-string\">&#x27;overwrite&#x27;</span><br>&#125;<br>obj.<span class=\"hljs-title function_\">toString</span>() &gt;&gt; <span class=\"hljs-string\">&#x27;overwrite&#x27;</span><br></code></pre></td></tr></table></figure>\n\n<p>既然 toString 方法定义在原型对象上，我们看看如果单独调用它，会是什么结果呢?</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\"><span class=\"hljs-title class_\">Object</span>.<span class=\"hljs-property\"><span class=\"hljs-keyword\">prototype</span></span>.<span class=\"hljs-title function_\">toString</span>() &gt;&gt; <span class=\"hljs-string\">&#x27;[object Object]&#x27;</span><br></code></pre></td></tr></table></figure>\n\n<p>如果通过 <code>call/apply</code> 方法，改变 <code>toString</code> 方法内部的 <code>this</code> 执行，又会是什么结果呢?</p>\n<p>看到如下结果，我相信这绝对可以完美 cover 住项目里面所有的类型判断了！所以说它是最安全、最准确的类型判断，没有异议吧😏</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\"><span class=\"hljs-title class_\">Object</span>.<span class=\"hljs-property\"><span class=\"hljs-keyword\">prototype</span></span>.<span class=\"hljs-property\">toString</span>.<span class=\"hljs-title function_\">call</span>(&#123;&#125;) &gt;&gt; <span class=\"hljs-string\">&#x27;[object Object]&#x27;</span><br><br><span class=\"hljs-title class_\">Object</span>.<span class=\"hljs-property\"><span class=\"hljs-keyword\">prototype</span></span>.<span class=\"hljs-property\">toString</span>.<span class=\"hljs-title function_\">call</span>([]) &gt;&gt; <span class=\"hljs-string\">&#x27;[object Array]&#x27;</span><br><br><span class=\"hljs-title class_\">Object</span>.<span class=\"hljs-property\"><span class=\"hljs-keyword\">prototype</span></span>.<span class=\"hljs-property\">toString</span>.<span class=\"hljs-title function_\">call</span>(<span class=\"hljs-keyword\">function</span>(<span class=\"hljs-params\"></span>)&#123;&#125;) &gt;&gt; <span class=\"hljs-string\">&#x27;[object Function]&#x27;</span><br><br><span class=\"hljs-title class_\">Object</span>.<span class=\"hljs-property\"><span class=\"hljs-keyword\">prototype</span></span>.<span class=\"hljs-property\">toString</span>.<span class=\"hljs-title function_\">call</span>(<span class=\"hljs-string\">&#x27;&#x27;</span>) &gt;&gt; <span class=\"hljs-string\">&#x27;[object String]&#x27;</span><br><br><span class=\"hljs-title class_\">Object</span>.<span class=\"hljs-property\"><span class=\"hljs-keyword\">prototype</span></span>.<span class=\"hljs-property\">toString</span>.<span class=\"hljs-title function_\">call</span>(<span class=\"hljs-number\">1</span>) &gt;&gt; <span class=\"hljs-string\">&#x27;[object Number]&#x27;</span><br><br><span class=\"hljs-title class_\">Object</span>.<span class=\"hljs-property\"><span class=\"hljs-keyword\">prototype</span></span>.<span class=\"hljs-property\">toString</span>.<span class=\"hljs-title function_\">call</span>(<span class=\"hljs-literal\">true</span>) &gt;&gt; <span class=\"hljs-string\">&#x27;[object Boolean]&#x27;</span><br><br><span class=\"hljs-title class_\">Object</span>.<span class=\"hljs-property\"><span class=\"hljs-keyword\">prototype</span></span>.<span class=\"hljs-property\">toString</span>.<span class=\"hljs-title function_\">call</span>(<span class=\"hljs-literal\">null</span>) &gt;&gt; <span class=\"hljs-string\">&#x27;[object Null]&#x27;</span><br><br><span class=\"hljs-title class_\">Object</span>.<span class=\"hljs-property\"><span class=\"hljs-keyword\">prototype</span></span>.<span class=\"hljs-property\">toString</span>.<span class=\"hljs-title function_\">call</span>(<span class=\"hljs-literal\">undefined</span>) &gt;&gt; <span class=\"hljs-string\">&#x27;[object Undefined]&#x27;</span><br><br><span class=\"hljs-title class_\">Object</span>.<span class=\"hljs-property\"><span class=\"hljs-keyword\">prototype</span></span>.<span class=\"hljs-property\">toString</span>.<span class=\"hljs-title function_\">call</span>() &gt;&gt; <span class=\"hljs-string\">&#x27;[object Undefined]&#x27;</span><br><br><span class=\"hljs-title class_\">Object</span>.<span class=\"hljs-property\"><span class=\"hljs-keyword\">prototype</span></span>.<span class=\"hljs-property\">toString</span>.<span class=\"hljs-title function_\">call</span>(<span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">Date</span>()) &gt;&gt; <span class=\"hljs-string\">&#x27;[object Date]&#x27;</span><br><br><span class=\"hljs-title class_\">Object</span>.<span class=\"hljs-property\"><span class=\"hljs-keyword\">prototype</span></span>.<span class=\"hljs-property\">toString</span>.<span class=\"hljs-title function_\">call</span>(<span class=\"hljs-regexp\">/at/</span>) &gt;&gt; <span class=\"hljs-string\">&#x27;[object RegExp]&#x27;</span><br><br></code></pre></td></tr></table></figure>\n\n<p>那么它是如何做到的呢，我们来扒一扒它的原理！在 <code>toString</code> 方法被调用时，会执行以下几个操作步骤:</p>\n<ol>\n<li>获取this指向的那个对象的<code>[[Class]]</code>属性的值。（<code>call/apply</code> 改变 this 指向）</li>\n<li>计算出三个字符串”[object “、 第一步的操作结果、 以及 “]” 连接后的新字符串。</li>\n<li>返回第二步的操作结果，也就是类似 <code>&#39;[object Type]&#39;</code> 这种格式字符串。</li>\n</ol>\n<p>需要注意的是，对象的<code>[[Class]]</code>属性是无法直接访问的，它一个内部属性，所有的对象(原生对象和宿主对象)都拥有该属性，且不能被任何人修改。在规范中，<code>[[Class]]</code>是这么定义的：<code>内部属性</code>描述。</p>\n<p>如果要单独或者对象的 <code>[[Class]]</code>，我们可以这样做:</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\"><span class=\"hljs-keyword\">const</span> targetObj = []<br><span class=\"hljs-title class_\">Object</span>.<span class=\"hljs-property\"><span class=\"hljs-keyword\">prototype</span></span>.<span class=\"hljs-property\">toString</span>.<span class=\"hljs-title function_\">call</span>(targetObj).<span class=\"hljs-title function_\">slice</span>(<span class=\"hljs-number\">8</span>, -<span class=\"hljs-number\">1</span>) &gt;&gt; <span class=\"hljs-string\">&#x27;Array&#x27;</span><br></code></pre></td></tr></table></figure>\n\n<p>既然它如此好用，难道就没有缺点吗？</p>\n<p>答案是当然有的，毕竟凡事都不可能那么绝对的嘛！</p>\n<p>那么缺点是什么呢？<br>第一，<code>toString()</code> 会进行装箱操作，产生很多临时对象。（装箱就是将基本类型的数据，通过引用类型包装起来，从而可以使用引用类上的方法）</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\"><span class=\"hljs-comment\">// 你肯定不能这样用</span><br><span class=\"hljs-number\">1.</span><span class=\"hljs-title function_\">toString</span>() &gt;&gt; <span class=\"hljs-title class_\">SyntaxError</span>: <span class=\"hljs-title class_\">Invalid</span> or unexpected token<br><br><span class=\"hljs-comment\">// 你必须这样用</span><br>(<span class=\"hljs-number\">1</span>).<span class=\"hljs-title function_\">toString</span>() &gt;&gt; <span class=\"hljs-string\">&#x27;1&#x27;</span><br></code></pre></td></tr></table></figure>\n<p>第二，无法区分自定义对象类型，用来判断这类对象时，返回的都是<code>Object</code>，这样我们就需要通过 <code>instanceof</code> 来判断了。</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\"><span class=\"hljs-keyword\">function</span> <span class=\"hljs-title function_\">Person</span>(<span class=\"hljs-params\"></span>)&#123;&#125;<br><span class=\"hljs-keyword\">const</span> p = <span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">Person</span>()<br><br><span class=\"hljs-title class_\">Object</span>.<span class=\"hljs-property\"><span class=\"hljs-keyword\">prototype</span></span>.<span class=\"hljs-property\">toString</span>.<span class=\"hljs-title function_\">call</span>(p) &gt;&gt; <span class=\"hljs-string\">&#x27;[object Object]&#x27;</span><br></code></pre></td></tr></table></figure>\n\n\n\n</li>\n</ol>\n<h3 id=\"字符串\"><a href=\"#字符串\" class=\"headerlink\" title=\"字符串\"></a>字符串</h3><p>JavaScript解释器强制约定字符串在堆区存储的数据是不可变的，也就是说，JavaScript解释器强制约定字符串在堆区存储的数据是不可变的。</p>\n<h2 id=\"参考资料\"><a href=\"#参考资料\" class=\"headerlink\" title=\"参考资料\"></a>参考资料</h2><section class=\"footnotes\"><div class=\"footnote-list\"><ol><li><span id=\"fn:1\" class=\"footnote-text\"><span>参考资料\n<a href=\"#fnref:1\" rev=\"footnote\" class=\"footnote-backref\"> ↩</a></span></span></li><li><span id=\"fn:2\" class=\"footnote-text\"><span>参考资料2\n<a href=\"#fnref:2\" rev=\"footnote\" class=\"footnote-backref\"> ↩</a></span></span></li></ol></div></section>","site":{"data":{}},"wordcount":5227,"more":"<h1 id=\"概述\"><a href=\"#概述\" class=\"headerlink\" title=\"概述\"></a>概述</h1><p>你是否曾经为了提供一个简单的应用解决方案而彻夜地查看源代码？<br>你是否曾经为了理解某个框架而冥思苦想、阅览群书？<br>你是否曾经为了提升0.1s的DOM性能而对多种实现方案进行严格测试和对比？<br>你是否曾经为了避免兼容问题而遍寻高手共同“诊治”？</p>\n<p>跟我一起，专注高质量 <code>JavaScript</code> 代码，少出 <code>Bug🐛</code>，早下班 !</p>\n<blockquote>\n<p>期望为读者带来如下帮助 📚：</p>\n</blockquote>\n<p>  ❑ 能写出简单、清晰、高效的代码。<br>  ❑ 能搭建一个稳定、健壮、快捷的应用框架。<br>  ❑ 能回答一个困扰很多人的技术问题。<br>  ❑ 能修复一个应用开发中遇到的大的Bug。<br>  ❑ 能非常熟悉某个开源产品。<br>  ❑ 能提升客户端应用性能。</p>\n<h2 id=\"JavaScript-基础\"><a href=\"#JavaScript-基础\" class=\"headerlink\" title=\"JavaScript 基础\"></a>JavaScript 基础</h2><p>代码量少，运行速度不一定快；代码量多，运行速度也不一定慢。</p>\n<h3 id=\"减少全局变量\"><a href=\"#减少全局变量\" class=\"headerlink\" title=\"减少全局变量\"></a>减少全局变量</h3><ol>\n<li><p>多个全局变量都追加在一个名称空间下，将显著降低与其他应用程序产生冲突的概率</p>\n <figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\"><span class=\"hljs-keyword\">const</span> namespace = &#123;&#125;<br><br>namespace.<span class=\"hljs-property\">name</span> = <span class=\"hljs-string\">&#x27;my namespace&#x27;</span><br></code></pre></td></tr></table></figure></li>\n<li><p>使用闭包体将信息隐藏，它是另一种有效减少“全局污染”的方法。</p>\n <figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\"><span class=\"hljs-keyword\">const</span> sayName = <span class=\"hljs-keyword\">function</span>(<span class=\"hljs-params\"></span>) &#123;<br>  <span class=\"hljs-keyword\">const</span> name = <span class=\"hljs-string\">&#x27;closure&#x27;</span><br><br>  <span class=\"hljs-keyword\">return</span> <span class=\"hljs-keyword\">function</span>(<span class=\"hljs-params\"></span>) &#123;<br>    <span class=\"hljs-title function_\">alert</span>(name)<br>  &#125;<br>&#125;()<br></code></pre></td></tr></table></figure></li>\n<li><p>作用域控制着变量与参数的可见性及生命周期。</p>\n<p> JavaScript支持函数作用域，定义在函数中的参数和变量在函数外部是不可见的，并且在一个函数中的任何位置定义的变量在该函数中的任何地方都可见。它不仅减少了名称冲突，并且提供了自动内存管理。</p>\n</li>\n<li><p>ES6 模块化编程中每个 js 文件内部定义的变量，外部无法获取。如果外部需要模块内部变量，通过 export 导出。</p>\n <figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\">&lt;script&gt;<br>  <span class=\"hljs-keyword\">var</span> windowA = <span class=\"hljs-string\">&#x27;window a&#x27;</span><br><br>  <span class=\"hljs-variable language_\">console</span>.<span class=\"hljs-title function_\">log</span>(<span class=\"hljs-variable language_\">window</span>.<span class=\"hljs-property\">windowA</span>) <span class=\"hljs-comment\">// 输出 &#x27;window a&#x27;</span><br>&lt;/script&gt;<br><br><span class=\"language-xml\"><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">script</span> <span class=\"hljs-attr\">type</span>=<span class=\"hljs-string\">&quot;module&quot;</span>&gt;</span><span class=\"language-javascript\"></span></span><br><span class=\"language-javascript\"><span class=\"language-xml\">  <span class=\"hljs-keyword\">var</span> moduleA = <span class=\"hljs-string\">&#x27;module a&#x27;</span></span></span><br><span class=\"language-javascript\"><span class=\"language-xml\"></span></span><br><span class=\"language-javascript\"><span class=\"language-xml\">  <span class=\"hljs-variable language_\">console</span>.<span class=\"hljs-title function_\">log</span>(<span class=\"hljs-variable language_\">window</span>.<span class=\"hljs-property\">moduleA</span>) <span class=\"hljs-comment\">// 输出 undefined</span></span></span><br><span class=\"language-javascript\"><span class=\"language-xml\"></span><span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">script</span>&gt;</span></span><br></code></pre></td></tr></table></figure>\n\n\n\n</li>\n</ol>\n<h3 id=\"谨慎JS数据类型\"><a href=\"#谨慎JS数据类型\" class=\"headerlink\" title=\"谨慎JS数据类型\"></a>谨慎JS数据类型</h3><p>在自动转换数据类型时，JavaScript一般遵循：如果某个类型的值被用于需要其他类型的值的环境中，JavaScript就自动将这个值转换成所需要的类型。</p>\n<h4 id=\"类型转换\"><a href=\"#类型转换\" class=\"headerlink\" title=\"类型转换\"></a>类型转换</h4><p>慎用JavaScript类型自动转换，注意<code>自动转换规则</code>:</p>\n<ol>\n<li><p>如果把非空对象用在逻辑运算环境中，则对象被转换为true。此时的对象包括所有类型的对象，即使是值为false的包装对象也被转换为true。</p>\n</li>\n<li><p>果把对象用在数值运算环境中，则对象会被自动转换为数字，如果转换失败，则返回值为NaN。</p>\n</li>\n<li><p>当数组被用在数值运算环境中时，数组将根据包含的元素来决定转换的值。如果数组为空数组，则被转换为数值0。如果数组仅包含一个数字元素，则被转换为该数字的数值。如果数组包含多个元素，或者仅包含一个非数字元素，则返回NaN。</p>\n<p>🌰</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\"><span class=\"hljs-comment\">// 对象</span><br><span class=\"hljs-keyword\">const</span> obj = &#123;&#125;<br>obj &amp;&amp; <span class=\"hljs-number\">1</span> &gt;&gt; <span class=\"hljs-number\">1</span><br>obj + <span class=\"hljs-number\">1</span> &gt;&gt; <span class=\"hljs-string\">&#x27;[object Object]1&#x27;</span><br><br>obj.<span class=\"hljs-property\">valueOf</span> = <span class=\"hljs-keyword\">function</span>(<span class=\"hljs-params\"></span>) &#123; <span class=\"hljs-keyword\">return</span> <span class=\"hljs-number\">99</span> &#125;<br>obj + <span class=\"hljs-number\">1</span> &gt;&gt; <span class=\"hljs-number\">100</span><br><br><span class=\"hljs-comment\">// 数组自动转换规则</span><br>+[] &gt;&gt; <span class=\"hljs-number\">0</span><br>+[<span class=\"hljs-number\">1</span>] &gt;&gt; <span class=\"hljs-number\">1</span><br>+[<span class=\"hljs-number\">1</span>,<span class=\"hljs-number\">2</span>] &gt;&gt; <span class=\"hljs-title class_\">NaN</span><br></code></pre></td></tr></table></figure>\n\n</li>\n</ol>\n<h4 id=\"类型判断\"><a href=\"#类型判断\" class=\"headerlink\" title=\"类型判断\"></a>类型判断</h4><ol>\n<li><p><code>typeof</code><br>对于任何变量来说，使用typeof运算符总是以字符串的形式返回以下6种类型之一：<br>❑ “number”<br>❑ “string”<br>❑ “boolean”<br>❑ “object”<br>❑ “function”<br>❑ “undefined”</p>\n<p>令人疑惑的是，在使用 <code>typeof</code> 检测null值时，返回的是“object”，而不是“null”。</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\"><span class=\"hljs-keyword\">typeof</span> <span class=\"hljs-literal\">null</span> &gt;&gt; <span class=\"hljs-string\">&#x27;object&#x27;</span><br><br><span class=\"hljs-keyword\">typeof</span> [] &gt;&gt; <span class=\"hljs-string\">&#x27;object&#x27;</span><br><br><span class=\"hljs-keyword\">typeof</span> &#123;&#125; &gt;&gt; <span class=\"hljs-string\">&#x27;object&#x27;</span><br></code></pre></td></tr></table></figure>\n</li>\n<li><p><code>instanceof</code></p>\n<p>instanceof 运算符用于检测构造函数的 prototype 属性是否出现在某个实例对象的<code>原型链</code>上。</p>\n<p>这个在判断对象时存在一些不确定性，来看下例子：</p>\n<p>🌰</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\"><span class=\"hljs-keyword\">function</span> <span class=\"hljs-title function_\">Person</span>(<span class=\"hljs-params\">name</span>) &#123;<br>  <span class=\"hljs-variable language_\">this</span>.<span class=\"hljs-property\">name</span> = name<br>&#125;<br><span class=\"hljs-keyword\">const</span> p = <span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">Person</span>(<span class=\"hljs-string\">&#x27;hello&#x27;</span>)<br>p <span class=\"hljs-keyword\">instanceof</span> <span class=\"hljs-title class_\">Person</span> &gt;&gt; <span class=\"hljs-literal\">true</span><br>p <span class=\"hljs-keyword\">instanceof</span> <span class=\"hljs-title class_\">Object</span> &gt;&gt; <span class=\"hljs-literal\">true</span><br></code></pre></td></tr></table></figure>\n\n<p>再看一个🌰:</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\"><span class=\"hljs-keyword\">function</span> <span class=\"hljs-title function_\">Person</span>(<span class=\"hljs-params\">name</span>) &#123;<br>  <span class=\"hljs-variable language_\">this</span>.<span class=\"hljs-property\">name</span> = name<br>&#125;<br><br><span class=\"hljs-keyword\">function</span> <span class=\"hljs-title function_\">Child</span>(<span class=\"hljs-params\">name</span>) &#123;<br>  <span class=\"hljs-variable language_\">this</span>.<span class=\"hljs-property\">name</span> = name<br>&#125;<br><br><span class=\"hljs-title class_\">Child</span>.<span class=\"hljs-property\"><span class=\"hljs-keyword\">prototype</span></span> = <span class=\"hljs-title class_\">Person</span>.<span class=\"hljs-property\"><span class=\"hljs-keyword\">prototype</span></span><br><span class=\"hljs-title class_\">Child</span>.<span class=\"hljs-property\"><span class=\"hljs-keyword\">prototype</span></span>.<span class=\"hljs-property\">constructor</span> = <span class=\"hljs-title class_\">Child</span><br><br><span class=\"hljs-keyword\">const</span> p = <span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">Child</span>(<span class=\"hljs-string\">&#x27;hello child&#x27;</span>)<br><br>p <span class=\"hljs-keyword\">instanceof</span> <span class=\"hljs-title class_\">Person</span> &gt;&gt; <span class=\"hljs-literal\">true</span><br>p <span class=\"hljs-keyword\">instanceof</span> <span class=\"hljs-title class_\">Object</span> &gt;&gt; <span class=\"hljs-literal\">true</span><br></code></pre></td></tr></table></figure>\n\n<p>如果是判断数组呢?</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\">[] <span class=\"hljs-keyword\">instanceof</span> <span class=\"hljs-title class_\">Array</span> &gt;&gt; <span class=\"hljs-literal\">true</span><br><br>[] <span class=\"hljs-keyword\">instanceof</span> <span class=\"hljs-title class_\">Object</span> &gt;&gt; <span class=\"hljs-literal\">true</span><br><br><span class=\"hljs-comment\">// 当然这种方式存在不确定性，我们可以使用 Array.isArray() 方法来判断</span><br><span class=\"hljs-title class_\">Array</span>.<span class=\"hljs-title function_\">isArray</span>([]) &gt;&gt; <span class=\"hljs-literal\">true</span><br><span class=\"hljs-title class_\">Array</span>.<span class=\"hljs-title function_\">isArray</span>(&#123;&#125;) &gt;&gt; <span class=\"hljs-literal\">false</span><br></code></pre></td></tr></table></figure>\n\n<p>从上面例子可以看出，使用 <code>instanceof</code> 来判断时存在种种不确定性，只要出现在原型链上的对象都会返回 <code>true</code>，使用的时候还需要着重注意！</p>\n<p>为什么会这样，想必大家应该想起来了！</p>\n<p><strong>Object类是所有对象类型的的父类!</strong></p>\n</li>\n<li><p><code>toString() 方法</code></p>\n<blockquote>\n<p>每个对象都有一个 toString() 方法，当该对象被表示为一个文本值时，或者一个对象以预期的字符串方式引用时自动调用。默认情况下，toString() 方法被每个 Object 对象继承。如果此方法在自定义对象中未被覆盖，toString() 返回 “[object type]”，其中 type 是对象的类型。</p>\n</blockquote>\n<p>toString() 方法，它定义在 Object 的原型对象上，对象在调用时会返回一个表示该对象的字符串。</p>\n<p>使用 <code>toString()</code> 方法检测对象类型是最安全、最准确的。调用toString()方法把对象转换为字符串，然后通过检测字符串中是否包含数组所特有的标志字符可以确定对象的类型。</p>\n<p>为什么说 <code>toString</code> 方法用来检测对象类型是最安全、最准确的，我们慢慢来看吧~</p>\n<p>先看看在对象上直接使用 <code>toString</code>会是什么结果：</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\"><span class=\"hljs-keyword\">const</span> obj = &#123; <span class=\"hljs-attr\">a</span>: <span class=\"hljs-number\">1</span> &#125;<br><span class=\"hljs-keyword\">const</span> arr = [<span class=\"hljs-number\">1</span>, <span class=\"hljs-number\">2</span>]<br><br>obj.<span class=\"hljs-title function_\">toString</span>() &gt;&gt; <span class=\"hljs-string\">&#x27;[object Object]&#x27;</span><br><br><span class=\"hljs-comment\">// 如果是数组的话，则输出字符串</span><br>arr.<span class=\"hljs-title function_\">toString</span>() &gt;&gt; <span class=\"hljs-string\">&#x27;1,2&#x27;</span><br><br><br><span class=\"hljs-comment\">// 当然我们可以重写/覆盖原型链上的 toString 方法</span><br>obj.<span class=\"hljs-property\">toString</span> = <span class=\"hljs-keyword\">function</span>(<span class=\"hljs-params\"></span>) &#123;<br>  <span class=\"hljs-keyword\">return</span> <span class=\"hljs-string\">&#x27;overwrite&#x27;</span><br>&#125;<br>obj.<span class=\"hljs-title function_\">toString</span>() &gt;&gt; <span class=\"hljs-string\">&#x27;overwrite&#x27;</span><br></code></pre></td></tr></table></figure>\n\n<p>既然 toString 方法定义在原型对象上，我们看看如果单独调用它，会是什么结果呢?</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\"><span class=\"hljs-title class_\">Object</span>.<span class=\"hljs-property\"><span class=\"hljs-keyword\">prototype</span></span>.<span class=\"hljs-title function_\">toString</span>() &gt;&gt; <span class=\"hljs-string\">&#x27;[object Object]&#x27;</span><br></code></pre></td></tr></table></figure>\n\n<p>如果通过 <code>call/apply</code> 方法，改变 <code>toString</code> 方法内部的 <code>this</code> 执行，又会是什么结果呢?</p>\n<p>看到如下结果，我相信这绝对可以完美 cover 住项目里面所有的类型判断了！所以说它是最安全、最准确的类型判断，没有异议吧😏</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\"><span class=\"hljs-title class_\">Object</span>.<span class=\"hljs-property\"><span class=\"hljs-keyword\">prototype</span></span>.<span class=\"hljs-property\">toString</span>.<span class=\"hljs-title function_\">call</span>(&#123;&#125;) &gt;&gt; <span class=\"hljs-string\">&#x27;[object Object]&#x27;</span><br><br><span class=\"hljs-title class_\">Object</span>.<span class=\"hljs-property\"><span class=\"hljs-keyword\">prototype</span></span>.<span class=\"hljs-property\">toString</span>.<span class=\"hljs-title function_\">call</span>([]) &gt;&gt; <span class=\"hljs-string\">&#x27;[object Array]&#x27;</span><br><br><span class=\"hljs-title class_\">Object</span>.<span class=\"hljs-property\"><span class=\"hljs-keyword\">prototype</span></span>.<span class=\"hljs-property\">toString</span>.<span class=\"hljs-title function_\">call</span>(<span class=\"hljs-keyword\">function</span>(<span class=\"hljs-params\"></span>)&#123;&#125;) &gt;&gt; <span class=\"hljs-string\">&#x27;[object Function]&#x27;</span><br><br><span class=\"hljs-title class_\">Object</span>.<span class=\"hljs-property\"><span class=\"hljs-keyword\">prototype</span></span>.<span class=\"hljs-property\">toString</span>.<span class=\"hljs-title function_\">call</span>(<span class=\"hljs-string\">&#x27;&#x27;</span>) &gt;&gt; <span class=\"hljs-string\">&#x27;[object String]&#x27;</span><br><br><span class=\"hljs-title class_\">Object</span>.<span class=\"hljs-property\"><span class=\"hljs-keyword\">prototype</span></span>.<span class=\"hljs-property\">toString</span>.<span class=\"hljs-title function_\">call</span>(<span class=\"hljs-number\">1</span>) &gt;&gt; <span class=\"hljs-string\">&#x27;[object Number]&#x27;</span><br><br><span class=\"hljs-title class_\">Object</span>.<span class=\"hljs-property\"><span class=\"hljs-keyword\">prototype</span></span>.<span class=\"hljs-property\">toString</span>.<span class=\"hljs-title function_\">call</span>(<span class=\"hljs-literal\">true</span>) &gt;&gt; <span class=\"hljs-string\">&#x27;[object Boolean]&#x27;</span><br><br><span class=\"hljs-title class_\">Object</span>.<span class=\"hljs-property\"><span class=\"hljs-keyword\">prototype</span></span>.<span class=\"hljs-property\">toString</span>.<span class=\"hljs-title function_\">call</span>(<span class=\"hljs-literal\">null</span>) &gt;&gt; <span class=\"hljs-string\">&#x27;[object Null]&#x27;</span><br><br><span class=\"hljs-title class_\">Object</span>.<span class=\"hljs-property\"><span class=\"hljs-keyword\">prototype</span></span>.<span class=\"hljs-property\">toString</span>.<span class=\"hljs-title function_\">call</span>(<span class=\"hljs-literal\">undefined</span>) &gt;&gt; <span class=\"hljs-string\">&#x27;[object Undefined]&#x27;</span><br><br><span class=\"hljs-title class_\">Object</span>.<span class=\"hljs-property\"><span class=\"hljs-keyword\">prototype</span></span>.<span class=\"hljs-property\">toString</span>.<span class=\"hljs-title function_\">call</span>() &gt;&gt; <span class=\"hljs-string\">&#x27;[object Undefined]&#x27;</span><br><br><span class=\"hljs-title class_\">Object</span>.<span class=\"hljs-property\"><span class=\"hljs-keyword\">prototype</span></span>.<span class=\"hljs-property\">toString</span>.<span class=\"hljs-title function_\">call</span>(<span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">Date</span>()) &gt;&gt; <span class=\"hljs-string\">&#x27;[object Date]&#x27;</span><br><br><span class=\"hljs-title class_\">Object</span>.<span class=\"hljs-property\"><span class=\"hljs-keyword\">prototype</span></span>.<span class=\"hljs-property\">toString</span>.<span class=\"hljs-title function_\">call</span>(<span class=\"hljs-regexp\">/at/</span>) &gt;&gt; <span class=\"hljs-string\">&#x27;[object RegExp]&#x27;</span><br><br></code></pre></td></tr></table></figure>\n\n<p>那么它是如何做到的呢，我们来扒一扒它的原理！在 <code>toString</code> 方法被调用时，会执行以下几个操作步骤:</p>\n<ol>\n<li>获取this指向的那个对象的<code>[[Class]]</code>属性的值。（<code>call/apply</code> 改变 this 指向）</li>\n<li>计算出三个字符串”[object “、 第一步的操作结果、 以及 “]” 连接后的新字符串。</li>\n<li>返回第二步的操作结果，也就是类似 <code>&#39;[object Type]&#39;</code> 这种格式字符串。</li>\n</ol>\n<p>需要注意的是，对象的<code>[[Class]]</code>属性是无法直接访问的，它一个内部属性，所有的对象(原生对象和宿主对象)都拥有该属性，且不能被任何人修改。在规范中，<code>[[Class]]</code>是这么定义的：<code>内部属性</code>描述。</p>\n<p>如果要单独或者对象的 <code>[[Class]]</code>，我们可以这样做:</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\"><span class=\"hljs-keyword\">const</span> targetObj = []<br><span class=\"hljs-title class_\">Object</span>.<span class=\"hljs-property\"><span class=\"hljs-keyword\">prototype</span></span>.<span class=\"hljs-property\">toString</span>.<span class=\"hljs-title function_\">call</span>(targetObj).<span class=\"hljs-title function_\">slice</span>(<span class=\"hljs-number\">8</span>, -<span class=\"hljs-number\">1</span>) &gt;&gt; <span class=\"hljs-string\">&#x27;Array&#x27;</span><br></code></pre></td></tr></table></figure>\n\n<p>既然它如此好用，难道就没有缺点吗？</p>\n<p>答案是当然有的，毕竟凡事都不可能那么绝对的嘛！</p>\n<p>那么缺点是什么呢？<br>第一，<code>toString()</code> 会进行装箱操作，产生很多临时对象。（装箱就是将基本类型的数据，通过引用类型包装起来，从而可以使用引用类上的方法）</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\"><span class=\"hljs-comment\">// 你肯定不能这样用</span><br><span class=\"hljs-number\">1.</span><span class=\"hljs-title function_\">toString</span>() &gt;&gt; <span class=\"hljs-title class_\">SyntaxError</span>: <span class=\"hljs-title class_\">Invalid</span> or unexpected token<br><br><span class=\"hljs-comment\">// 你必须这样用</span><br>(<span class=\"hljs-number\">1</span>).<span class=\"hljs-title function_\">toString</span>() &gt;&gt; <span class=\"hljs-string\">&#x27;1&#x27;</span><br></code></pre></td></tr></table></figure>\n<p>第二，无法区分自定义对象类型，用来判断这类对象时，返回的都是<code>Object</code>，这样我们就需要通过 <code>instanceof</code> 来判断了。</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\"><span class=\"hljs-keyword\">function</span> <span class=\"hljs-title function_\">Person</span>(<span class=\"hljs-params\"></span>)&#123;&#125;<br><span class=\"hljs-keyword\">const</span> p = <span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">Person</span>()<br><br><span class=\"hljs-title class_\">Object</span>.<span class=\"hljs-property\"><span class=\"hljs-keyword\">prototype</span></span>.<span class=\"hljs-property\">toString</span>.<span class=\"hljs-title function_\">call</span>(p) &gt;&gt; <span class=\"hljs-string\">&#x27;[object Object]&#x27;</span><br></code></pre></td></tr></table></figure>\n\n\n\n</li>\n</ol>\n<h3 id=\"字符串\"><a href=\"#字符串\" class=\"headerlink\" title=\"字符串\"></a>字符串</h3><p>JavaScript解释器强制约定字符串在堆区存储的数据是不可变的，也就是说，JavaScript解释器强制约定字符串在堆区存储的数据是不可变的。</p>\n<h2 id=\"参考资料\"><a href=\"#参考资料\" class=\"headerlink\" title=\"参考资料\"></a>参考资料</h2><section class=\"footnotes\"><div class=\"footnote-list\"><ol><li><span id=\"fn:1\" class=\"footnote-text\"><span>参考资料\n<a href=\"#fnref:1\" rev=\"footnote\" class=\"footnote-backref\"> ↩</a></span></span></li><li><span id=\"fn:2\" class=\"footnote-text\"><span>参考资料2\n<a href=\"#fnref:2\" rev=\"footnote\" class=\"footnote-backref\"> ↩</a></span></span></li></ol></div></section>"},{"layout":"micro","title":"微前端","date":"2023-01-05T13:24:21.000Z","banner_img":"/img/micro-app.png","index_img":"/img/micro-app.png","excerpt":"shadow dom、样式隔离方案","_content":"\n# qiankun\n\n> https://qiankun.umijs.org/zh\n\n\n# 参考链接\n- [样式隔离问题](https://zhuanlan.zhihu.com/p/596349482?utm_medium=social&utm_oi=762241709898739712&utm_psn=1593891522373799936&utm_source=wechat_session)","source":"_posts/micro-qiankun.md","raw":"---\nlayout: micro\ntitle: 微前端\ndate: 2023-01-05 21:24:21\ntags: 微前端\nbanner_img: /img/micro-app.png\nindex_img: /img/micro-app.png\nexcerpt: shadow dom、样式隔离方案\n---\n\n# qiankun\n\n> https://qiankun.umijs.org/zh\n\n\n# 参考链接\n- [样式隔离问题](https://zhuanlan.zhihu.com/p/596349482?utm_medium=social&utm_oi=762241709898739712&utm_psn=1593891522373799936&utm_source=wechat_session)","slug":"micro-qiankun","published":1,"updated":"2023-05-12T10:49:20.013Z","comments":1,"photos":[],"link":"","_id":"clhkizgxh000g3y0qha7cctjq","content":"<h1 id=\"qiankun\"><a href=\"#qiankun\" class=\"headerlink\" title=\"qiankun\"></a>qiankun</h1><blockquote>\n<p><a href=\"https://qiankun.umijs.org/zh\">https://qiankun.umijs.org/zh</a></p>\n</blockquote>\n<h1 id=\"参考链接\"><a href=\"#参考链接\" class=\"headerlink\" title=\"参考链接\"></a>参考链接</h1><ul>\n<li><a href=\"https://zhuanlan.zhihu.com/p/596349482?utm_medium=social&utm_oi=762241709898739712&utm_psn=1593891522373799936&utm_source=wechat_session\">样式隔离问题</a></li>\n</ul>\n","site":{"data":{}},"wordcount":45,"more":"<h1 id=\"qiankun\"><a href=\"#qiankun\" class=\"headerlink\" title=\"qiankun\"></a>qiankun</h1><blockquote>\n<p><a href=\"https://qiankun.umijs.org/zh\">https://qiankun.umijs.org/zh</a></p>\n</blockquote>\n<h1 id=\"参考链接\"><a href=\"#参考链接\" class=\"headerlink\" title=\"参考链接\"></a>参考链接</h1><ul>\n<li><a href=\"https://zhuanlan.zhihu.com/p/596349482?utm_medium=social&utm_oi=762241709898739712&utm_psn=1593891522373799936&utm_source=wechat_session\">样式隔离问题</a></li>\n</ul>\n"},{"title":"Nginx 实战","date":"2022-12-17T03:30:00.000Z","banner_img":"/img/nginx.png","index_img":"/img/nginx.png","excerpt":"Never too old to learn.","_content":"\n# 查看 Nginx 命令\n\n## 查看安装目录\n> whereis nginx\n\nnginx: /usr/bin/nginx\n\n## 查看 nginx 进程\n\n> ps -ef | grep nginx\n\n## 查看 nginx 可执行文件\n\n> ps -ef | grep nginx\n\n/www/server/nginx/conf/nginx.conf 表示配置文件\n\n或者也可以通过 `nginx -t` 来查看配置文件在哪，虽然这个命令是检测 nginx 配置文件是否有语法错误：\n```js\nnginx: the configuration file /www/server/nginx/conf/nginx.conf syntax is ok\nnginx: configuration file /www/server/nginx/conf/nginx.conf test is successful\n```\n\n# 配置文件\n\n> nginx.conf\n\n## 全局模块\n\nworker_processes auto; // 进程数量\nerror_log  /www/wwwlogs/nginx_error.log  crit; // 错误日志存放路径\npid        /www/server/nginx/logs/nginx.pid; // 存放 pid 文件\n\n## events\n\nworker_connections 51200; // 单个进程最大的连接数（最大连接数：连接数+进程数）\n\n## http 块\n\n- include 引入其他的配置文件\n- default_type 文件类型\n\n\n# 解决跨域问题\n\n首先启动 nginx 服务，输入命令 `nginx`，修改根路径下的 index.html 文件\n\n\n```js\n// nginx 配置，访问 localhost:8080/ 时，会打开 index.html\nlocation / {\n  root   html;\n  index  index.html index.htm;\n}\n\n// 修改index.html\n<body>\n<h1>Welcome to nginx!</h1>\n<button id=\"btn\">send</button>\n\n<script>\n  btn.onclick = () => {\n    const xhr = new XMLHttpRequest()\n    xhr.open('GET', 'http://localhost:9999/list')\n\n    xhr.onreadystatechange = () => {\n      if (xhr.readyState == 4 && xhr.status == 200) {\n        console.log('返回结果', xhr.responseText)\n      }\n    }\n\n    xhr.send(null)\n  }\n</script>\n</body>\n```\n\n起一个本地 node 服务 `9999`\n```js\nconst express = require('express');\nconst app = express()\n\napp.get('/list', (req, res) => {\n  res.json({\n    code: 0,\n    msg: \"hello server\"\n  })\n\napp.listen(9999, () => {\n  console.log('server site an port 9999 ...')\n})\n```\n\n当我们点击`发送`按钮时，会出现跨域问题，这是因为浏览器 `同源策略`限制，`协议、域名、端口号`不同，会形成跨域。\n\n这里是端口不同。\n\n我们可以利用 `nginx` 来解决。\n\n打开 `nginx.conf`，新增一条转发规则，表示遇到 `api` 开头的，都将转发到某个服务下\n\n比如 `xhr.open('GET', '/api/list')`, 会将 `api` 替换成 `http://localhost:9999/`\n\n```js\n// 添加\n\nlocation /api/ {\n    proxy_pass http://localhost:9999/;\n}\n```\n\n修改调用接口的地方:\n\n```js\nxhr.open('GET', '/api/list')\n```\n\n此时，再次点击 `发送`,不会再出现跨域了。\n\n\n# Vue Router History 模式 404 问题\n\nVue 项目，采用 history 的路由模式，打包后放到 nginx 上部署，切换路由时出现 `404` 现象。\n\n解决方案：`try_files $uri $uri/ /index.html;`\n\n```js\n\nlocation / {\n    root   html;\n    index  index.html index.htm;\n    try_files $uri $uri/ /index.html;\n}\n```\n\n\n# 负载均衡\n\n我们可以建 3 个（或者更多）node 服务来模拟实现，**可以通过 count 计数，来查看每个服务被分配到的请求数**\n\n1. server1\n\n```js\nconst express = require('express');\n\nconst app = express()\n\nlet count = 1\n\napp.get('/list', (req, res) => {\n  res.json({\n    code: 0,\n    msg: \"hello server 9999\"\n  })\n\n  console.log(`server 9999 ------ ${count}`)\n  count++\n})\n\napp.listen(9999, () => {\n  console.log('server site an port 9999 ...')\n})\n\n```\n\n通过 pm2 log 查看日志\n\n```js\n  // package.json\n\n  \"start\": \"pm2 start index.js index2.js index3.js --watch\",\n  \"stop\": \"pm2 stop index.js\",\n  \"allList\": \"pm2 list\",\n  \"monit\": \"pm2 monit\",\n  \"log\": \"pm2 log\"\n```\n\n2. server2、server3 只是端口不一样\n\n## 修改 nginx 配置\n\n配置根路径，代理到本地服务，当我们启动 nginx，访问 `http://localhost:8080/` 时，服务会代理到我们配置的 `upstream node` 服务上，访问 `http://localhost:8080/list` 即可调用咱们写好的 node 接口。\n\n```js\nupstream node {\nserver 127.0.0.1:9997;\nserver 127.0.0.1:9998;\nserver 127.0.0.1:9999;\n}\n\nserver {\n  location / {\n    proxy_pass http://node; // node 是 upstream 指定的 name\n  }\n}\n```\n\n最后我们可以通过 postman 或 apifox 来进行压测了。\n\n```js\n接口：http://localhost:8080/list\n```\n![](/img/压测配置.jpg)\n![](/img/压测结果.png)\n\n这里设置的`接口循环次数`是 `33`，意味着我们将要调用 33 次接口，运行之后，33次均可以成功跑通。\n\n来看下结果：\n\n![](/img/压测log.png)\n\n每个 server 分配均匀，33次，每个服务分配了 `11` 次请求。\n\n\n## 权重\n\n还可以给服务设置权重 `weight`，数值越大，权重越高，请求数越多。\n\n```js\nserver 127.0.0.1:9997 weight=3;\nserver 127.0.0.1:9998 weight=2;\nserver 127.0.0.1:9999 weight=1;\n```\n\n修改完配置后，重启 nginx `nginx -s reload`，继续运行 `apifox` 压测接口：\n\n![](/img/weight.png)\n\n权重最高的 `9997` 请求被分配了 17 次，权重最低的 `9999` 只分配了 5 次请求。\n\n\n## 超时\n设置超时备用模式，如果存在超时，就会选用备用的服务 `9003`，如果不存在超时请求，则不会有请求打到 `9999` 服务上。\n\n```js\nupstream node {\n  server 127.0.0.1:9997 fail_timeout=60;\n  server 127.0.0.1:9998 fail_timeout=20;\n  server 127.0.0.1:9999 backup;\n}\n```\n\n\n# 参考资料\n[^1]: [小满介绍Nginx](https://xiaoman.blog.csdn.net/article/details/123958967)\n[^2]: [安装Nginx](https://xiaoman.blog.csdn.net/article/details/123965492)\n[^3]: [Nginx相关](https://blog.csdn.net/qq1195566313/category_11727192.html)\n","source":"_posts/nginx.md","raw":"---\ntitle: Nginx 实战\ndate: 2022-12-17 11:30:00\ntags: Nginx\nbanner_img: /img/nginx.png\nindex_img: /img/nginx.png\nexcerpt: Never too old to learn.\n---\n\n# 查看 Nginx 命令\n\n## 查看安装目录\n> whereis nginx\n\nnginx: /usr/bin/nginx\n\n## 查看 nginx 进程\n\n> ps -ef | grep nginx\n\n## 查看 nginx 可执行文件\n\n> ps -ef | grep nginx\n\n/www/server/nginx/conf/nginx.conf 表示配置文件\n\n或者也可以通过 `nginx -t` 来查看配置文件在哪，虽然这个命令是检测 nginx 配置文件是否有语法错误：\n```js\nnginx: the configuration file /www/server/nginx/conf/nginx.conf syntax is ok\nnginx: configuration file /www/server/nginx/conf/nginx.conf test is successful\n```\n\n# 配置文件\n\n> nginx.conf\n\n## 全局模块\n\nworker_processes auto; // 进程数量\nerror_log  /www/wwwlogs/nginx_error.log  crit; // 错误日志存放路径\npid        /www/server/nginx/logs/nginx.pid; // 存放 pid 文件\n\n## events\n\nworker_connections 51200; // 单个进程最大的连接数（最大连接数：连接数+进程数）\n\n## http 块\n\n- include 引入其他的配置文件\n- default_type 文件类型\n\n\n# 解决跨域问题\n\n首先启动 nginx 服务，输入命令 `nginx`，修改根路径下的 index.html 文件\n\n\n```js\n// nginx 配置，访问 localhost:8080/ 时，会打开 index.html\nlocation / {\n  root   html;\n  index  index.html index.htm;\n}\n\n// 修改index.html\n<body>\n<h1>Welcome to nginx!</h1>\n<button id=\"btn\">send</button>\n\n<script>\n  btn.onclick = () => {\n    const xhr = new XMLHttpRequest()\n    xhr.open('GET', 'http://localhost:9999/list')\n\n    xhr.onreadystatechange = () => {\n      if (xhr.readyState == 4 && xhr.status == 200) {\n        console.log('返回结果', xhr.responseText)\n      }\n    }\n\n    xhr.send(null)\n  }\n</script>\n</body>\n```\n\n起一个本地 node 服务 `9999`\n```js\nconst express = require('express');\nconst app = express()\n\napp.get('/list', (req, res) => {\n  res.json({\n    code: 0,\n    msg: \"hello server\"\n  })\n\napp.listen(9999, () => {\n  console.log('server site an port 9999 ...')\n})\n```\n\n当我们点击`发送`按钮时，会出现跨域问题，这是因为浏览器 `同源策略`限制，`协议、域名、端口号`不同，会形成跨域。\n\n这里是端口不同。\n\n我们可以利用 `nginx` 来解决。\n\n打开 `nginx.conf`，新增一条转发规则，表示遇到 `api` 开头的，都将转发到某个服务下\n\n比如 `xhr.open('GET', '/api/list')`, 会将 `api` 替换成 `http://localhost:9999/`\n\n```js\n// 添加\n\nlocation /api/ {\n    proxy_pass http://localhost:9999/;\n}\n```\n\n修改调用接口的地方:\n\n```js\nxhr.open('GET', '/api/list')\n```\n\n此时，再次点击 `发送`,不会再出现跨域了。\n\n\n# Vue Router History 模式 404 问题\n\nVue 项目，采用 history 的路由模式，打包后放到 nginx 上部署，切换路由时出现 `404` 现象。\n\n解决方案：`try_files $uri $uri/ /index.html;`\n\n```js\n\nlocation / {\n    root   html;\n    index  index.html index.htm;\n    try_files $uri $uri/ /index.html;\n}\n```\n\n\n# 负载均衡\n\n我们可以建 3 个（或者更多）node 服务来模拟实现，**可以通过 count 计数，来查看每个服务被分配到的请求数**\n\n1. server1\n\n```js\nconst express = require('express');\n\nconst app = express()\n\nlet count = 1\n\napp.get('/list', (req, res) => {\n  res.json({\n    code: 0,\n    msg: \"hello server 9999\"\n  })\n\n  console.log(`server 9999 ------ ${count}`)\n  count++\n})\n\napp.listen(9999, () => {\n  console.log('server site an port 9999 ...')\n})\n\n```\n\n通过 pm2 log 查看日志\n\n```js\n  // package.json\n\n  \"start\": \"pm2 start index.js index2.js index3.js --watch\",\n  \"stop\": \"pm2 stop index.js\",\n  \"allList\": \"pm2 list\",\n  \"monit\": \"pm2 monit\",\n  \"log\": \"pm2 log\"\n```\n\n2. server2、server3 只是端口不一样\n\n## 修改 nginx 配置\n\n配置根路径，代理到本地服务，当我们启动 nginx，访问 `http://localhost:8080/` 时，服务会代理到我们配置的 `upstream node` 服务上，访问 `http://localhost:8080/list` 即可调用咱们写好的 node 接口。\n\n```js\nupstream node {\nserver 127.0.0.1:9997;\nserver 127.0.0.1:9998;\nserver 127.0.0.1:9999;\n}\n\nserver {\n  location / {\n    proxy_pass http://node; // node 是 upstream 指定的 name\n  }\n}\n```\n\n最后我们可以通过 postman 或 apifox 来进行压测了。\n\n```js\n接口：http://localhost:8080/list\n```\n![](/img/压测配置.jpg)\n![](/img/压测结果.png)\n\n这里设置的`接口循环次数`是 `33`，意味着我们将要调用 33 次接口，运行之后，33次均可以成功跑通。\n\n来看下结果：\n\n![](/img/压测log.png)\n\n每个 server 分配均匀，33次，每个服务分配了 `11` 次请求。\n\n\n## 权重\n\n还可以给服务设置权重 `weight`，数值越大，权重越高，请求数越多。\n\n```js\nserver 127.0.0.1:9997 weight=3;\nserver 127.0.0.1:9998 weight=2;\nserver 127.0.0.1:9999 weight=1;\n```\n\n修改完配置后，重启 nginx `nginx -s reload`，继续运行 `apifox` 压测接口：\n\n![](/img/weight.png)\n\n权重最高的 `9997` 请求被分配了 17 次，权重最低的 `9999` 只分配了 5 次请求。\n\n\n## 超时\n设置超时备用模式，如果存在超时，就会选用备用的服务 `9003`，如果不存在超时请求，则不会有请求打到 `9999` 服务上。\n\n```js\nupstream node {\n  server 127.0.0.1:9997 fail_timeout=60;\n  server 127.0.0.1:9998 fail_timeout=20;\n  server 127.0.0.1:9999 backup;\n}\n```\n\n\n# 参考资料\n[^1]: [小满介绍Nginx](https://xiaoman.blog.csdn.net/article/details/123958967)\n[^2]: [安装Nginx](https://xiaoman.blog.csdn.net/article/details/123965492)\n[^3]: [Nginx相关](https://blog.csdn.net/qq1195566313/category_11727192.html)\n","slug":"nginx","published":1,"updated":"2023-05-12T10:49:20.013Z","comments":1,"layout":"post","photos":[],"link":"","_id":"clhkizgxi000i3y0q0xatdvk6","content":"<h1 id=\"查看-Nginx-命令\"><a href=\"#查看-Nginx-命令\" class=\"headerlink\" title=\"查看 Nginx 命令\"></a>查看 Nginx 命令</h1><h2 id=\"查看安装目录\"><a href=\"#查看安装目录\" class=\"headerlink\" title=\"查看安装目录\"></a>查看安装目录</h2><blockquote>\n<p>whereis nginx</p>\n</blockquote>\n<p>nginx: /usr/bin/nginx</p>\n<h2 id=\"查看-nginx-进程\"><a href=\"#查看-nginx-进程\" class=\"headerlink\" title=\"查看 nginx 进程\"></a>查看 nginx 进程</h2><blockquote>\n<p>ps -ef | grep nginx</p>\n</blockquote>\n<h2 id=\"查看-nginx-可执行文件\"><a href=\"#查看-nginx-可执行文件\" class=\"headerlink\" title=\"查看 nginx 可执行文件\"></a>查看 nginx 可执行文件</h2><blockquote>\n<p>ps -ef | grep nginx</p>\n</blockquote>\n<p>/www/server/nginx/conf/nginx.conf 表示配置文件</p>\n<p>或者也可以通过 <code>nginx -t</code> 来查看配置文件在哪，虽然这个命令是检测 nginx 配置文件是否有语法错误：</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><div class=\"code-wrapper\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></div></td><td class=\"code\"><pre><code class=\"hljs js\"><span class=\"hljs-attr\">nginx</span>: the configuration file /www/server/nginx/conf/nginx.<span class=\"hljs-property\">conf</span> syntax is ok<br><span class=\"hljs-attr\">nginx</span>: configuration file /www/server/nginx/conf/nginx.<span class=\"hljs-property\">conf</span> test is successful<br></code></pre></td></tr></table></figure>\n\n<h1 id=\"配置文件\"><a href=\"#配置文件\" class=\"headerlink\" title=\"配置文件\"></a>配置文件</h1><blockquote>\n<p>nginx.conf</p>\n</blockquote>\n<h2 id=\"全局模块\"><a href=\"#全局模块\" class=\"headerlink\" title=\"全局模块\"></a>全局模块</h2><p>worker_processes auto; // 进程数量<br>error_log  /www/wwwlogs/nginx_error.log  crit; // 错误日志存放路径<br>pid        /www/server/nginx/logs/nginx.pid; // 存放 pid 文件</p>\n<h2 id=\"events\"><a href=\"#events\" class=\"headerlink\" title=\"events\"></a>events</h2><p>worker_connections 51200; // 单个进程最大的连接数（最大连接数：连接数+进程数）</p>\n<h2 id=\"http-块\"><a href=\"#http-块\" class=\"headerlink\" title=\"http 块\"></a>http 块</h2><ul>\n<li>include 引入其他的配置文件</li>\n<li>default_type 文件类型</li>\n</ul>\n<h1 id=\"解决跨域问题\"><a href=\"#解决跨域问题\" class=\"headerlink\" title=\"解决跨域问题\"></a>解决跨域问题</h1><p>首先启动 nginx 服务，输入命令 <code>nginx</code>，修改根路径下的 index.html 文件</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\"><span class=\"hljs-comment\">// nginx 配置，访问 localhost:8080/ 时，会打开 index.html</span><br>location / &#123;<br>  root   html;<br>  index  index.<span class=\"hljs-property\">html</span> index.<span class=\"hljs-property\">htm</span>;<br>&#125;<br><br><span class=\"hljs-comment\">// 修改index.html</span><br>&lt;body&gt;<br><span class=\"language-xml\"><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">h1</span>&gt;</span>Welcome to nginx!<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">h1</span>&gt;</span></span><br><span class=\"language-xml\"><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">button</span> <span class=\"hljs-attr\">id</span>=<span class=\"hljs-string\">&quot;btn&quot;</span>&gt;</span>send<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">button</span>&gt;</span></span><br><br><span class=\"language-xml\"><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">script</span>&gt;</span><span class=\"language-javascript\"></span></span><br><span class=\"language-javascript\"><span class=\"language-xml\">  btn.<span class=\"hljs-property\">onclick</span> = <span class=\"hljs-function\">() =&gt;</span> &#123;</span></span><br><span class=\"language-javascript\"><span class=\"language-xml\">    <span class=\"hljs-keyword\">const</span> xhr = <span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">XMLHttpRequest</span>()</span></span><br><span class=\"language-javascript\"><span class=\"language-xml\">    xhr.<span class=\"hljs-title function_\">open</span>(<span class=\"hljs-string\">&#x27;GET&#x27;</span>, <span class=\"hljs-string\">&#x27;http://localhost:9999/list&#x27;</span>)</span></span><br><span class=\"language-javascript\"><span class=\"language-xml\"></span></span><br><span class=\"language-javascript\"><span class=\"language-xml\">    xhr.<span class=\"hljs-property\">onreadystatechange</span> = <span class=\"hljs-function\">() =&gt;</span> &#123;</span></span><br><span class=\"language-javascript\"><span class=\"language-xml\">      <span class=\"hljs-keyword\">if</span> (xhr.<span class=\"hljs-property\">readyState</span> == <span class=\"hljs-number\">4</span> &amp;&amp; xhr.<span class=\"hljs-property\">status</span> == <span class=\"hljs-number\">200</span>) &#123;</span></span><br><span class=\"language-javascript\"><span class=\"language-xml\">        <span class=\"hljs-variable language_\">console</span>.<span class=\"hljs-title function_\">log</span>(<span class=\"hljs-string\">&#x27;返回结果&#x27;</span>, xhr.<span class=\"hljs-property\">responseText</span>)</span></span><br><span class=\"language-javascript\"><span class=\"language-xml\">      &#125;</span></span><br><span class=\"language-javascript\"><span class=\"language-xml\">    &#125;</span></span><br><span class=\"language-javascript\"><span class=\"language-xml\"></span></span><br><span class=\"language-javascript\"><span class=\"language-xml\">    xhr.<span class=\"hljs-title function_\">send</span>(<span class=\"hljs-literal\">null</span>)</span></span><br><span class=\"language-javascript\"><span class=\"language-xml\">  &#125;</span></span><br><span class=\"language-javascript\"><span class=\"language-xml\"></span><span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">script</span>&gt;</span></span><br>&lt;/body&gt;<br></code></pre></td></tr></table></figure>\n\n<p>起一个本地 node 服务 <code>9999</code></p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\"><span class=\"hljs-keyword\">const</span> express = <span class=\"hljs-built_in\">require</span>(<span class=\"hljs-string\">&#x27;express&#x27;</span>);<br><span class=\"hljs-keyword\">const</span> app = <span class=\"hljs-title function_\">express</span>()<br><br>app.<span class=\"hljs-title function_\">get</span>(<span class=\"hljs-string\">&#x27;/list&#x27;</span>, <span class=\"hljs-function\">(<span class=\"hljs-params\">req, res</span>) =&gt;</span> &#123;<br>  res.<span class=\"hljs-title function_\">json</span>(&#123;<br>    <span class=\"hljs-attr\">code</span>: <span class=\"hljs-number\">0</span>,<br>    <span class=\"hljs-attr\">msg</span>: <span class=\"hljs-string\">&quot;hello server&quot;</span><br>  &#125;)<br><br>app.<span class=\"hljs-title function_\">listen</span>(<span class=\"hljs-number\">9999</span>, <span class=\"hljs-function\">() =&gt;</span> &#123;<br>  <span class=\"hljs-variable language_\">console</span>.<span class=\"hljs-title function_\">log</span>(<span class=\"hljs-string\">&#x27;server site an port 9999 ...&#x27;</span>)<br>&#125;)<br></code></pre></td></tr></table></figure>\n\n<p>当我们点击<code>发送</code>按钮时，会出现跨域问题，这是因为浏览器 <code>同源策略</code>限制，<code>协议、域名、端口号</code>不同，会形成跨域。</p>\n<p>这里是端口不同。</p>\n<p>我们可以利用 <code>nginx</code> 来解决。</p>\n<p>打开 <code>nginx.conf</code>，新增一条转发规则，表示遇到 <code>api</code> 开头的，都将转发到某个服务下</p>\n<p>比如 <code>xhr.open(&#39;GET&#39;, &#39;/api/list&#39;)</code>, 会将 <code>api</code> 替换成 <code>http://localhost:9999/</code></p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\"><span class=\"hljs-comment\">// 添加</span><br><br>location /api/ &#123;<br>    proxy_pass <span class=\"hljs-attr\">http</span>:<span class=\"hljs-comment\">//localhost:9999/;</span><br>&#125;<br></code></pre></td></tr></table></figure>\n\n<p>修改调用接口的地方:</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\">xhr.<span class=\"hljs-title function_\">open</span>(<span class=\"hljs-string\">&#x27;GET&#x27;</span>, <span class=\"hljs-string\">&#x27;/api/list&#x27;</span>)<br></code></pre></td></tr></table></figure>\n\n<p>此时，再次点击 <code>发送</code>,不会再出现跨域了。</p>\n<h1 id=\"Vue-Router-History-模式-404-问题\"><a href=\"#Vue-Router-History-模式-404-问题\" class=\"headerlink\" title=\"Vue Router History 模式 404 问题\"></a>Vue Router History 模式 404 问题</h1><p>Vue 项目，采用 history 的路由模式，打包后放到 nginx 上部署，切换路由时出现 <code>404</code> 现象。</p>\n<p>解决方案：<code>try_files $uri $uri/ /index.html;</code></p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\"><br>location / &#123;<br>    root   html;<br>    index  index.<span class=\"hljs-property\">html</span> index.<span class=\"hljs-property\">htm</span>;<br>    try_files $uri $uri/ /index.<span class=\"hljs-property\">html</span>;<br>&#125;<br></code></pre></td></tr></table></figure>\n\n\n<h1 id=\"负载均衡\"><a href=\"#负载均衡\" class=\"headerlink\" title=\"负载均衡\"></a>负载均衡</h1><p>我们可以建 3 个（或者更多）node 服务来模拟实现，<strong>可以通过 count 计数，来查看每个服务被分配到的请求数</strong></p>\n<ol>\n<li>server1</li>\n</ol>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\"><span class=\"hljs-keyword\">const</span> express = <span class=\"hljs-built_in\">require</span>(<span class=\"hljs-string\">&#x27;express&#x27;</span>);<br><br><span class=\"hljs-keyword\">const</span> app = <span class=\"hljs-title function_\">express</span>()<br><br><span class=\"hljs-keyword\">let</span> count = <span class=\"hljs-number\">1</span><br><br>app.<span class=\"hljs-title function_\">get</span>(<span class=\"hljs-string\">&#x27;/list&#x27;</span>, <span class=\"hljs-function\">(<span class=\"hljs-params\">req, res</span>) =&gt;</span> &#123;<br>  res.<span class=\"hljs-title function_\">json</span>(&#123;<br>    <span class=\"hljs-attr\">code</span>: <span class=\"hljs-number\">0</span>,<br>    <span class=\"hljs-attr\">msg</span>: <span class=\"hljs-string\">&quot;hello server 9999&quot;</span><br>  &#125;)<br><br>  <span class=\"hljs-variable language_\">console</span>.<span class=\"hljs-title function_\">log</span>(<span class=\"hljs-string\">`server 9999 ------ <span class=\"hljs-subst\">$&#123;count&#125;</span>`</span>)<br>  count++<br>&#125;)<br><br>app.<span class=\"hljs-title function_\">listen</span>(<span class=\"hljs-number\">9999</span>, <span class=\"hljs-function\">() =&gt;</span> &#123;<br>  <span class=\"hljs-variable language_\">console</span>.<span class=\"hljs-title function_\">log</span>(<span class=\"hljs-string\">&#x27;server site an port 9999 ...&#x27;</span>)<br>&#125;)<br><br></code></pre></td></tr></table></figure>\n\n<p>通过 pm2 log 查看日志</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\"><span class=\"hljs-comment\">// package.json</span><br><br><span class=\"hljs-string\">&quot;start&quot;</span>: <span class=\"hljs-string\">&quot;pm2 start index.js index2.js index3.js --watch&quot;</span>,<br><span class=\"hljs-string\">&quot;stop&quot;</span>: <span class=\"hljs-string\">&quot;pm2 stop index.js&quot;</span>,<br><span class=\"hljs-string\">&quot;allList&quot;</span>: <span class=\"hljs-string\">&quot;pm2 list&quot;</span>,<br><span class=\"hljs-string\">&quot;monit&quot;</span>: <span class=\"hljs-string\">&quot;pm2 monit&quot;</span>,<br><span class=\"hljs-string\">&quot;log&quot;</span>: <span class=\"hljs-string\">&quot;pm2 log&quot;</span><br></code></pre></td></tr></table></figure>\n\n<ol start=\"2\">\n<li>server2、server3 只是端口不一样</li>\n</ol>\n<h2 id=\"修改-nginx-配置\"><a href=\"#修改-nginx-配置\" class=\"headerlink\" title=\"修改 nginx 配置\"></a>修改 nginx 配置</h2><p>配置根路径，代理到本地服务，当我们启动 nginx，访问 <code>http://localhost:8080/</code> 时，服务会代理到我们配置的 <code>upstream node</code> 服务上，访问 <code>http://localhost:8080/list</code> 即可调用咱们写好的 node 接口。</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\">upstream node &#123;<br>server <span class=\"hljs-number\">127.0</span><span class=\"hljs-number\">.0</span><span class=\"hljs-number\">.1</span>:<span class=\"hljs-number\">9997</span>;<br>server <span class=\"hljs-number\">127.0</span><span class=\"hljs-number\">.0</span><span class=\"hljs-number\">.1</span>:<span class=\"hljs-number\">9998</span>;<br>server <span class=\"hljs-number\">127.0</span><span class=\"hljs-number\">.0</span><span class=\"hljs-number\">.1</span>:<span class=\"hljs-number\">9999</span>;<br>&#125;<br><br>server &#123;<br>  location / &#123;<br>    proxy_pass <span class=\"hljs-attr\">http</span>:<span class=\"hljs-comment\">//node; // node 是 upstream 指定的 name</span><br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure>\n\n<p>最后我们可以通过 postman 或 apifox 来进行压测了。</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\">接口：<span class=\"hljs-attr\">http</span>:<span class=\"hljs-comment\">//localhost:8080/list</span><br></code></pre></td></tr></table></figure>\n<p><img src=\"/img/%E5%8E%8B%E6%B5%8B%E9%85%8D%E7%BD%AE.jpg\" alt=\"\"><br><img src=\"/img/%E5%8E%8B%E6%B5%8B%E7%BB%93%E6%9E%9C.png\" alt=\"\"></p>\n<p>这里设置的<code>接口循环次数</code>是 <code>33</code>，意味着我们将要调用 33 次接口，运行之后，33次均可以成功跑通。</p>\n<p>来看下结果：</p>\n<p><img src=\"/img/%E5%8E%8B%E6%B5%8Blog.png\" alt=\"\"></p>\n<p>每个 server 分配均匀，33次，每个服务分配了 <code>11</code> 次请求。</p>\n<h2 id=\"权重\"><a href=\"#权重\" class=\"headerlink\" title=\"权重\"></a>权重</h2><p>还可以给服务设置权重 <code>weight</code>，数值越大，权重越高，请求数越多。</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\">server <span class=\"hljs-number\">127.0</span><span class=\"hljs-number\">.0</span><span class=\"hljs-number\">.1</span>:<span class=\"hljs-number\">9997</span> weight=<span class=\"hljs-number\">3</span>;<br>server <span class=\"hljs-number\">127.0</span><span class=\"hljs-number\">.0</span><span class=\"hljs-number\">.1</span>:<span class=\"hljs-number\">9998</span> weight=<span class=\"hljs-number\">2</span>;<br>server <span class=\"hljs-number\">127.0</span><span class=\"hljs-number\">.0</span><span class=\"hljs-number\">.1</span>:<span class=\"hljs-number\">9999</span> weight=<span class=\"hljs-number\">1</span>;<br></code></pre></td></tr></table></figure>\n\n<p>修改完配置后，重启 nginx <code>nginx -s reload</code>，继续运行 <code>apifox</code> 压测接口：</p>\n<p><img src=\"/img/weight.png\" alt=\"\"></p>\n<p>权重最高的 <code>9997</code> 请求被分配了 17 次，权重最低的 <code>9999</code> 只分配了 5 次请求。</p>\n<h2 id=\"超时\"><a href=\"#超时\" class=\"headerlink\" title=\"超时\"></a>超时</h2><p>设置超时备用模式，如果存在超时，就会选用备用的服务 <code>9003</code>，如果不存在超时请求，则不会有请求打到 <code>9999</code> 服务上。</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\">upstream node &#123;<br>  server <span class=\"hljs-number\">127.0</span><span class=\"hljs-number\">.0</span><span class=\"hljs-number\">.1</span>:<span class=\"hljs-number\">9997</span> fail_timeout=<span class=\"hljs-number\">60</span>;<br>  server <span class=\"hljs-number\">127.0</span><span class=\"hljs-number\">.0</span><span class=\"hljs-number\">.1</span>:<span class=\"hljs-number\">9998</span> fail_timeout=<span class=\"hljs-number\">20</span>;<br>  server <span class=\"hljs-number\">127.0</span><span class=\"hljs-number\">.0</span><span class=\"hljs-number\">.1</span>:<span class=\"hljs-number\">9999</span> backup;<br>&#125;<br></code></pre></td></tr></table></figure>\n\n\n<h1 id=\"参考资料\"><a href=\"#参考资料\" class=\"headerlink\" title=\"参考资料\"></a>参考资料</h1><section class=\"footnotes\"><div class=\"footnote-list\"><ol><li><span id=\"fn:1\" class=\"footnote-text\"><span><a href=\"https://xiaoman.blog.csdn.net/article/details/123958967\">小满介绍Nginx</a>\n<a href=\"#fnref:1\" rev=\"footnote\" class=\"footnote-backref\"> ↩</a></span></span></li><li><span id=\"fn:2\" class=\"footnote-text\"><span><a href=\"https://xiaoman.blog.csdn.net/article/details/123965492\">安装Nginx</a>\n<a href=\"#fnref:2\" rev=\"footnote\" class=\"footnote-backref\"> ↩</a></span></span></li><li><span id=\"fn:3\" class=\"footnote-text\"><span><a href=\"https://blog.csdn.net/qq1195566313/category_11727192.html\">Nginx相关</a>\n<a href=\"#fnref:3\" rev=\"footnote\" class=\"footnote-backref\"> ↩</a></span></span></li></ol></div></section>","site":{"data":{}},"wordcount":3579,"more":"<h1 id=\"查看-Nginx-命令\"><a href=\"#查看-Nginx-命令\" class=\"headerlink\" title=\"查看 Nginx 命令\"></a>查看 Nginx 命令</h1><h2 id=\"查看安装目录\"><a href=\"#查看安装目录\" class=\"headerlink\" title=\"查看安装目录\"></a>查看安装目录</h2><blockquote>\n<p>whereis nginx</p>\n</blockquote>\n<p>nginx: /usr/bin/nginx</p>\n<h2 id=\"查看-nginx-进程\"><a href=\"#查看-nginx-进程\" class=\"headerlink\" title=\"查看 nginx 进程\"></a>查看 nginx 进程</h2><blockquote>\n<p>ps -ef | grep nginx</p>\n</blockquote>\n<h2 id=\"查看-nginx-可执行文件\"><a href=\"#查看-nginx-可执行文件\" class=\"headerlink\" title=\"查看 nginx 可执行文件\"></a>查看 nginx 可执行文件</h2><blockquote>\n<p>ps -ef | grep nginx</p>\n</blockquote>\n<p>/www/server/nginx/conf/nginx.conf 表示配置文件</p>\n<p>或者也可以通过 <code>nginx -t</code> 来查看配置文件在哪，虽然这个命令是检测 nginx 配置文件是否有语法错误：</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\"><span class=\"hljs-attr\">nginx</span>: the configuration file /www/server/nginx/conf/nginx.<span class=\"hljs-property\">conf</span> syntax is ok<br><span class=\"hljs-attr\">nginx</span>: configuration file /www/server/nginx/conf/nginx.<span class=\"hljs-property\">conf</span> test is successful<br></code></pre></td></tr></table></figure>\n\n<h1 id=\"配置文件\"><a href=\"#配置文件\" class=\"headerlink\" title=\"配置文件\"></a>配置文件</h1><blockquote>\n<p>nginx.conf</p>\n</blockquote>\n<h2 id=\"全局模块\"><a href=\"#全局模块\" class=\"headerlink\" title=\"全局模块\"></a>全局模块</h2><p>worker_processes auto; // 进程数量<br>error_log  /www/wwwlogs/nginx_error.log  crit; // 错误日志存放路径<br>pid        /www/server/nginx/logs/nginx.pid; // 存放 pid 文件</p>\n<h2 id=\"events\"><a href=\"#events\" class=\"headerlink\" title=\"events\"></a>events</h2><p>worker_connections 51200; // 单个进程最大的连接数（最大连接数：连接数+进程数）</p>\n<h2 id=\"http-块\"><a href=\"#http-块\" class=\"headerlink\" title=\"http 块\"></a>http 块</h2><ul>\n<li>include 引入其他的配置文件</li>\n<li>default_type 文件类型</li>\n</ul>\n<h1 id=\"解决跨域问题\"><a href=\"#解决跨域问题\" class=\"headerlink\" title=\"解决跨域问题\"></a>解决跨域问题</h1><p>首先启动 nginx 服务，输入命令 <code>nginx</code>，修改根路径下的 index.html 文件</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\"><span class=\"hljs-comment\">// nginx 配置，访问 localhost:8080/ 时，会打开 index.html</span><br>location / &#123;<br>  root   html;<br>  index  index.<span class=\"hljs-property\">html</span> index.<span class=\"hljs-property\">htm</span>;<br>&#125;<br><br><span class=\"hljs-comment\">// 修改index.html</span><br>&lt;body&gt;<br><span class=\"language-xml\"><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">h1</span>&gt;</span>Welcome to nginx!<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">h1</span>&gt;</span></span><br><span class=\"language-xml\"><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">button</span> <span class=\"hljs-attr\">id</span>=<span class=\"hljs-string\">&quot;btn&quot;</span>&gt;</span>send<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">button</span>&gt;</span></span><br><br><span class=\"language-xml\"><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">script</span>&gt;</span><span class=\"language-javascript\"></span></span><br><span class=\"language-javascript\"><span class=\"language-xml\">  btn.<span class=\"hljs-property\">onclick</span> = <span class=\"hljs-function\">() =&gt;</span> &#123;</span></span><br><span class=\"language-javascript\"><span class=\"language-xml\">    <span class=\"hljs-keyword\">const</span> xhr = <span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">XMLHttpRequest</span>()</span></span><br><span class=\"language-javascript\"><span class=\"language-xml\">    xhr.<span class=\"hljs-title function_\">open</span>(<span class=\"hljs-string\">&#x27;GET&#x27;</span>, <span class=\"hljs-string\">&#x27;http://localhost:9999/list&#x27;</span>)</span></span><br><span class=\"language-javascript\"><span class=\"language-xml\"></span></span><br><span class=\"language-javascript\"><span class=\"language-xml\">    xhr.<span class=\"hljs-property\">onreadystatechange</span> = <span class=\"hljs-function\">() =&gt;</span> &#123;</span></span><br><span class=\"language-javascript\"><span class=\"language-xml\">      <span class=\"hljs-keyword\">if</span> (xhr.<span class=\"hljs-property\">readyState</span> == <span class=\"hljs-number\">4</span> &amp;&amp; xhr.<span class=\"hljs-property\">status</span> == <span class=\"hljs-number\">200</span>) &#123;</span></span><br><span class=\"language-javascript\"><span class=\"language-xml\">        <span class=\"hljs-variable language_\">console</span>.<span class=\"hljs-title function_\">log</span>(<span class=\"hljs-string\">&#x27;返回结果&#x27;</span>, xhr.<span class=\"hljs-property\">responseText</span>)</span></span><br><span class=\"language-javascript\"><span class=\"language-xml\">      &#125;</span></span><br><span class=\"language-javascript\"><span class=\"language-xml\">    &#125;</span></span><br><span class=\"language-javascript\"><span class=\"language-xml\"></span></span><br><span class=\"language-javascript\"><span class=\"language-xml\">    xhr.<span class=\"hljs-title function_\">send</span>(<span class=\"hljs-literal\">null</span>)</span></span><br><span class=\"language-javascript\"><span class=\"language-xml\">  &#125;</span></span><br><span class=\"language-javascript\"><span class=\"language-xml\"></span><span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">script</span>&gt;</span></span><br>&lt;/body&gt;<br></code></pre></td></tr></table></figure>\n\n<p>起一个本地 node 服务 <code>9999</code></p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\"><span class=\"hljs-keyword\">const</span> express = <span class=\"hljs-built_in\">require</span>(<span class=\"hljs-string\">&#x27;express&#x27;</span>);<br><span class=\"hljs-keyword\">const</span> app = <span class=\"hljs-title function_\">express</span>()<br><br>app.<span class=\"hljs-title function_\">get</span>(<span class=\"hljs-string\">&#x27;/list&#x27;</span>, <span class=\"hljs-function\">(<span class=\"hljs-params\">req, res</span>) =&gt;</span> &#123;<br>  res.<span class=\"hljs-title function_\">json</span>(&#123;<br>    <span class=\"hljs-attr\">code</span>: <span class=\"hljs-number\">0</span>,<br>    <span class=\"hljs-attr\">msg</span>: <span class=\"hljs-string\">&quot;hello server&quot;</span><br>  &#125;)<br><br>app.<span class=\"hljs-title function_\">listen</span>(<span class=\"hljs-number\">9999</span>, <span class=\"hljs-function\">() =&gt;</span> &#123;<br>  <span class=\"hljs-variable language_\">console</span>.<span class=\"hljs-title function_\">log</span>(<span class=\"hljs-string\">&#x27;server site an port 9999 ...&#x27;</span>)<br>&#125;)<br></code></pre></td></tr></table></figure>\n\n<p>当我们点击<code>发送</code>按钮时，会出现跨域问题，这是因为浏览器 <code>同源策略</code>限制，<code>协议、域名、端口号</code>不同，会形成跨域。</p>\n<p>这里是端口不同。</p>\n<p>我们可以利用 <code>nginx</code> 来解决。</p>\n<p>打开 <code>nginx.conf</code>，新增一条转发规则，表示遇到 <code>api</code> 开头的，都将转发到某个服务下</p>\n<p>比如 <code>xhr.open(&#39;GET&#39;, &#39;/api/list&#39;)</code>, 会将 <code>api</code> 替换成 <code>http://localhost:9999/</code></p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\"><span class=\"hljs-comment\">// 添加</span><br><br>location /api/ &#123;<br>    proxy_pass <span class=\"hljs-attr\">http</span>:<span class=\"hljs-comment\">//localhost:9999/;</span><br>&#125;<br></code></pre></td></tr></table></figure>\n\n<p>修改调用接口的地方:</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\">xhr.<span class=\"hljs-title function_\">open</span>(<span class=\"hljs-string\">&#x27;GET&#x27;</span>, <span class=\"hljs-string\">&#x27;/api/list&#x27;</span>)<br></code></pre></td></tr></table></figure>\n\n<p>此时，再次点击 <code>发送</code>,不会再出现跨域了。</p>\n<h1 id=\"Vue-Router-History-模式-404-问题\"><a href=\"#Vue-Router-History-模式-404-问题\" class=\"headerlink\" title=\"Vue Router History 模式 404 问题\"></a>Vue Router History 模式 404 问题</h1><p>Vue 项目，采用 history 的路由模式，打包后放到 nginx 上部署，切换路由时出现 <code>404</code> 现象。</p>\n<p>解决方案：<code>try_files $uri $uri/ /index.html;</code></p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\"><br>location / &#123;<br>    root   html;<br>    index  index.<span class=\"hljs-property\">html</span> index.<span class=\"hljs-property\">htm</span>;<br>    try_files $uri $uri/ /index.<span class=\"hljs-property\">html</span>;<br>&#125;<br></code></pre></td></tr></table></figure>\n\n\n<h1 id=\"负载均衡\"><a href=\"#负载均衡\" class=\"headerlink\" title=\"负载均衡\"></a>负载均衡</h1><p>我们可以建 3 个（或者更多）node 服务来模拟实现，<strong>可以通过 count 计数，来查看每个服务被分配到的请求数</strong></p>\n<ol>\n<li>server1</li>\n</ol>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\"><span class=\"hljs-keyword\">const</span> express = <span class=\"hljs-built_in\">require</span>(<span class=\"hljs-string\">&#x27;express&#x27;</span>);<br><br><span class=\"hljs-keyword\">const</span> app = <span class=\"hljs-title function_\">express</span>()<br><br><span class=\"hljs-keyword\">let</span> count = <span class=\"hljs-number\">1</span><br><br>app.<span class=\"hljs-title function_\">get</span>(<span class=\"hljs-string\">&#x27;/list&#x27;</span>, <span class=\"hljs-function\">(<span class=\"hljs-params\">req, res</span>) =&gt;</span> &#123;<br>  res.<span class=\"hljs-title function_\">json</span>(&#123;<br>    <span class=\"hljs-attr\">code</span>: <span class=\"hljs-number\">0</span>,<br>    <span class=\"hljs-attr\">msg</span>: <span class=\"hljs-string\">&quot;hello server 9999&quot;</span><br>  &#125;)<br><br>  <span class=\"hljs-variable language_\">console</span>.<span class=\"hljs-title function_\">log</span>(<span class=\"hljs-string\">`server 9999 ------ <span class=\"hljs-subst\">$&#123;count&#125;</span>`</span>)<br>  count++<br>&#125;)<br><br>app.<span class=\"hljs-title function_\">listen</span>(<span class=\"hljs-number\">9999</span>, <span class=\"hljs-function\">() =&gt;</span> &#123;<br>  <span class=\"hljs-variable language_\">console</span>.<span class=\"hljs-title function_\">log</span>(<span class=\"hljs-string\">&#x27;server site an port 9999 ...&#x27;</span>)<br>&#125;)<br><br></code></pre></td></tr></table></figure>\n\n<p>通过 pm2 log 查看日志</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\"><span class=\"hljs-comment\">// package.json</span><br><br><span class=\"hljs-string\">&quot;start&quot;</span>: <span class=\"hljs-string\">&quot;pm2 start index.js index2.js index3.js --watch&quot;</span>,<br><span class=\"hljs-string\">&quot;stop&quot;</span>: <span class=\"hljs-string\">&quot;pm2 stop index.js&quot;</span>,<br><span class=\"hljs-string\">&quot;allList&quot;</span>: <span class=\"hljs-string\">&quot;pm2 list&quot;</span>,<br><span class=\"hljs-string\">&quot;monit&quot;</span>: <span class=\"hljs-string\">&quot;pm2 monit&quot;</span>,<br><span class=\"hljs-string\">&quot;log&quot;</span>: <span class=\"hljs-string\">&quot;pm2 log&quot;</span><br></code></pre></td></tr></table></figure>\n\n<ol start=\"2\">\n<li>server2、server3 只是端口不一样</li>\n</ol>\n<h2 id=\"修改-nginx-配置\"><a href=\"#修改-nginx-配置\" class=\"headerlink\" title=\"修改 nginx 配置\"></a>修改 nginx 配置</h2><p>配置根路径，代理到本地服务，当我们启动 nginx，访问 <code>http://localhost:8080/</code> 时，服务会代理到我们配置的 <code>upstream node</code> 服务上，访问 <code>http://localhost:8080/list</code> 即可调用咱们写好的 node 接口。</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\">upstream node &#123;<br>server <span class=\"hljs-number\">127.0</span><span class=\"hljs-number\">.0</span><span class=\"hljs-number\">.1</span>:<span class=\"hljs-number\">9997</span>;<br>server <span class=\"hljs-number\">127.0</span><span class=\"hljs-number\">.0</span><span class=\"hljs-number\">.1</span>:<span class=\"hljs-number\">9998</span>;<br>server <span class=\"hljs-number\">127.0</span><span class=\"hljs-number\">.0</span><span class=\"hljs-number\">.1</span>:<span class=\"hljs-number\">9999</span>;<br>&#125;<br><br>server &#123;<br>  location / &#123;<br>    proxy_pass <span class=\"hljs-attr\">http</span>:<span class=\"hljs-comment\">//node; // node 是 upstream 指定的 name</span><br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure>\n\n<p>最后我们可以通过 postman 或 apifox 来进行压测了。</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\">接口：<span class=\"hljs-attr\">http</span>:<span class=\"hljs-comment\">//localhost:8080/list</span><br></code></pre></td></tr></table></figure>\n<p><img src=\"/img/%E5%8E%8B%E6%B5%8B%E9%85%8D%E7%BD%AE.jpg\" alt=\"\"><br><img src=\"/img/%E5%8E%8B%E6%B5%8B%E7%BB%93%E6%9E%9C.png\" alt=\"\"></p>\n<p>这里设置的<code>接口循环次数</code>是 <code>33</code>，意味着我们将要调用 33 次接口，运行之后，33次均可以成功跑通。</p>\n<p>来看下结果：</p>\n<p><img src=\"/img/%E5%8E%8B%E6%B5%8Blog.png\" alt=\"\"></p>\n<p>每个 server 分配均匀，33次，每个服务分配了 <code>11</code> 次请求。</p>\n<h2 id=\"权重\"><a href=\"#权重\" class=\"headerlink\" title=\"权重\"></a>权重</h2><p>还可以给服务设置权重 <code>weight</code>，数值越大，权重越高，请求数越多。</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\">server <span class=\"hljs-number\">127.0</span><span class=\"hljs-number\">.0</span><span class=\"hljs-number\">.1</span>:<span class=\"hljs-number\">9997</span> weight=<span class=\"hljs-number\">3</span>;<br>server <span class=\"hljs-number\">127.0</span><span class=\"hljs-number\">.0</span><span class=\"hljs-number\">.1</span>:<span class=\"hljs-number\">9998</span> weight=<span class=\"hljs-number\">2</span>;<br>server <span class=\"hljs-number\">127.0</span><span class=\"hljs-number\">.0</span><span class=\"hljs-number\">.1</span>:<span class=\"hljs-number\">9999</span> weight=<span class=\"hljs-number\">1</span>;<br></code></pre></td></tr></table></figure>\n\n<p>修改完配置后，重启 nginx <code>nginx -s reload</code>，继续运行 <code>apifox</code> 压测接口：</p>\n<p><img src=\"/img/weight.png\" alt=\"\"></p>\n<p>权重最高的 <code>9997</code> 请求被分配了 17 次，权重最低的 <code>9999</code> 只分配了 5 次请求。</p>\n<h2 id=\"超时\"><a href=\"#超时\" class=\"headerlink\" title=\"超时\"></a>超时</h2><p>设置超时备用模式，如果存在超时，就会选用备用的服务 <code>9003</code>，如果不存在超时请求，则不会有请求打到 <code>9999</code> 服务上。</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\">upstream node &#123;<br>  server <span class=\"hljs-number\">127.0</span><span class=\"hljs-number\">.0</span><span class=\"hljs-number\">.1</span>:<span class=\"hljs-number\">9997</span> fail_timeout=<span class=\"hljs-number\">60</span>;<br>  server <span class=\"hljs-number\">127.0</span><span class=\"hljs-number\">.0</span><span class=\"hljs-number\">.1</span>:<span class=\"hljs-number\">9998</span> fail_timeout=<span class=\"hljs-number\">20</span>;<br>  server <span class=\"hljs-number\">127.0</span><span class=\"hljs-number\">.0</span><span class=\"hljs-number\">.1</span>:<span class=\"hljs-number\">9999</span> backup;<br>&#125;<br></code></pre></td></tr></table></figure>\n\n\n<h1 id=\"参考资料\"><a href=\"#参考资料\" class=\"headerlink\" title=\"参考资料\"></a>参考资料</h1><section class=\"footnotes\"><div class=\"footnote-list\"><ol><li><span id=\"fn:1\" class=\"footnote-text\"><span><a href=\"https://xiaoman.blog.csdn.net/article/details/123958967\">小满介绍Nginx</a>\n<a href=\"#fnref:1\" rev=\"footnote\" class=\"footnote-backref\"> ↩</a></span></span></li><li><span id=\"fn:2\" class=\"footnote-text\"><span><a href=\"https://xiaoman.blog.csdn.net/article/details/123965492\">安装Nginx</a>\n<a href=\"#fnref:2\" rev=\"footnote\" class=\"footnote-backref\"> ↩</a></span></span></li><li><span id=\"fn:3\" class=\"footnote-text\"><span><a href=\"https://blog.csdn.net/qq1195566313/category_11727192.html\">Nginx相关</a>\n<a href=\"#fnref:3\" rev=\"footnote\" class=\"footnote-backref\"> ↩</a></span></span></li></ol></div></section>"},{"title":"React Hooks","date":"2022-03-26T10:41:01.000Z","banner_img":"/img/home.jpg","index_img":"/img/home.jpg","excerpt":"什么是React Hooks，为什么需要它？如何高效的使用React Hooks？如何自定义 Hooks ？如何通过 Hooks 做性能优化？","comment":true,"_content":"\n> Hook 是 React 16.8 的新增特性。它可以让你在不编写 class 的情况下使用 state 以及其他的 React 特性。\n\n\n# 动机\n\n# Hook 规则\n1. 只在最顶层使用 Hook\n2. 只在 React 函数中调用 Hook。（或：在自定义 Hook 中调用其他 Hook）\n\n\n# 使用 useCallback、useMemo、memo 做性能优化\n\n尽可能的保证组件不去发生变化，发生变化的因素有：`state、props、context`。\n\n那么 `React` 是如何比较这三者的呢？ 答案是 `内存地址`。\n\n比如说，对比一个 `function`，对比的就是这个函数在内存中的地址，通过地址的判断，从而判断 props 是否发生了改变。\n\n## React.memo\n> https://react.docschina.org/docs/hooks-faq.html#how-do-i-implement-shouldcomponentupdate\n\nReact.memo 包裹一个组件，来对它的 props 进行浅比较。等效于 PureComponent，但它只比较 props。（也可以通过第二个参数指定一个`自定义的比较函数`来比较新旧 props。如果函数返回 true，就会跳过更新。）\n\n```js\n// 不使用 memo，每一次 setCount，都会造成 Child 组件重新 render\nconst Child = () => {\n  console.log('Child')\n  return (\n    <>Child component</>\n  )\n}\nconst Demo = () => {\n  const [count, setCount] = useState(0)\n  return (\n    <>\n      <button onClick={() => setCount(count => count + 1)}>+</button>\n      <Child />\n    </>\n  )\n}\n\n// 通过 memo 包裹后，Child 组件不会再重新 render了。\nconst Child = memo(() => {\n  console.log('Child')\n  return (\n    <>Child component</>\n  )\n})\n```\n\n当 memo 感知 props 没有发生改变时，不会重新 render 组件。如果传入 count 进来，Child组件就会重新 render。\n\n总结：\n\n1. 如果我们将 setCount 当做 prop 传入进来，Child 不会重新render（`因为 setCount 在内存中的地址没有发生改变`）\n2. 如果传入我们自己定义的方法 (fn)进来，Child会重新 render，因为 Demo 组件每次更新 count 后，重新生成了 fn 函数。\n3. 只是传了个 fn ，不想让 Child 组件更新怎么办？那就要用到 `useCallback` 钩子了\n\n## useMemo\n\n把“创建”函数和依赖项数组作为参数传入 useMemo，它仅会在某个依赖项改变时才重新计算。\n\n```js\n  // 只有当 count 发生变化时，才会重新计算\n  const computedCount = useMemo(() => {\n    return count * 2\n  }, [count])\n```\n\n`useMemo` 也允许你跳过一次子节点的昂贵的重新渲染，比如组件初始化时，需要一次大量的计算，后续就不会再改变了：\n\n```js\nfunction Parent({ a, b }) {\n  // Only re-rendered if `a` changes:\n  const child1 = useMemo(() => <Child1 a={a} />, [a]);\n  // Only re-rendered if `b` changes:\n  const child2 = useMemo(() => <Child2 b={b} />, [b]);\n  return (\n    <>\n      {child1}\n      {child2}\n    </>\n  )\n}\n```\n\n## useCallback\n\n把内联回调函数及依赖项数组作为参数传入 useCallback，它将返回该回调函数的 memoized 版本，该回调函数仅在某个依赖项改变时才会更新。\n\n下面这个例子，即使我们用 `memo` 包裹了组件，因为 `setCount` 每次会引起 Demo 组件重新 render，`生成了新的 fn 函数`(内存地址发生了变化)，导致 Child 也会重新 render。\n\n```js\ninterface IChild {\n  fn: React.Dispatch<React.SetStateAction<number>>\n}\nconst Child = memo((props: IChild) => {\n  console.log('Child')\n  return (\n    <>Child component</>\n  )\n})\n\nconst Demo = () => {\n  const [count, setCount] = useState(0)\n  const fn = () => console.log('is fn')\n\n  return (\n    <>\n      <button onClick={() => setCount(count => count + 1)}>+</button>\n      <Child fn={fn} />\n    </>\n  )\n}\n```\n\n我们不想让 fn 函数的 `内存地址` 发生变化，怎么办呢？使用 `useCallback` 钩子将其包裹起来即可。\n\n`注意：useMemo 也可以这样用，缓存 fn，从而使得 Child 组件不会重复 render。`\n\n```js\n// 省略...\n\nconst fn = useCallback(() => {\n  console.log('is fn')\n}, [])\n\n// 省略...\n```\n\n这样 `fn` 函数就是一个缓存函数了，即使 count 不停的发生变化，也不会造成 Child 组件重复 render。\n\n*总结:*\n\n1. 当 Demo 组件内部 state 发生了改变引起 Demo 和 Child 组件重新 render\n2. 并且 Child 组件接受了一个来自 Demo 组件自定义的方法（fn）\n3. 如果不希望 Child 组件重新 render，那么就需要用 useCallback 钩子将自定义方法 `fn` 包裹起来\n4. 因为 Child 组件 props 里面的 fn 和 useCallback 返回的 fn 指向的是内存中的同一个地址，那么 Child 组件就不会更新\n5. useCallback 返回新函数的条件是：依赖项（第二个参数）发生了改变。\n6. 如果说我们的 Child 组件，本身就是需要根据 count 变化而变化，那么就不需要加这个缓存 API了，反而增加其计算负担。\n\n## 设计组件\n\n不要为了使用钩子，过渡的使用钩子，好的页面设计，也许用不上这些钩子。\n\n`把不变的组件和变化的组件抽离出来！`\n\n比如可以把 count 相关部分抽离成一个 Count 组件，使其和 Child 组件同层级排列，Count 组件和 Child 组件分开了，也不会引起 Child 组件做多余的 render。\n\n```js\n<Count />\n<Child prop={fn} />\n```\n\n或者是通过 props.children 渲染 Child，也不会造成 Child 重新 render。\n\n```js\nconst Count = (props: any) => {\n  const [count, setCount] = useState(0)\n\n  return (\n    <>\n      <button onClick={() => setCount(count => count + 1)}>+</button>\n      {/* children 不会重新 render */}\n      {props.children}\n    </>\n  )\n}\nconst Demo = () => {\n  // fn 永远不会变化\n  const fn = () => {}\n  return (\n    <>\n      <Count>\n        <Child fn={fn} />\n      </Count>\n    </>\n  )\n}\n```\n\n## useRef / createRef\n\n> 访问 DOM 节点\n\n```js\n\nconst inputEle = useRef(null)\nconst inputEle = React.createRef()\n\ninputEle.current.focus()\n\n```\n\n### 测量 DOM节点？\n\n```js\n\nconst getHeight = useMemo(() => {\n  return (node: HTMLObjectElement) => {\n    if (node) {\n      setHeight(node.getBoundingClientRect().height)\n    }\n  }\n}, [])\n\n// 或者\n\nconst getHeight = useCallback((node: HTMLObjectElement) => {\n  if (node) {\n    setHeight(node.getBoundingClientRect().height)\n  }\n}, [])\n\n```\n\n`将 ref 逻辑抽离成一个 Hook`\n\n```js\n// hook\nconst useClientRect = () => {\n  const [rect, setRect] = useState(null)\n  const ref = useCallback(node => {\n    if (node) {\n      setRect(node.getBoundingClientRect())\n    }\n  }, [])\n\n  return [rect, ref]\n}\n\n// 使用\n\nconst [rect, ref] = useClientRect()\n\n<h1 ref={ref}>是 H1 标签 {count}</h1>\n{\n  rect && <span>{rect.height}</span>\n}\n```\n\n### React.forwardRef\n\n> React.forwardRef 会创建一个React组件，这个组件能够将其接受的 ref 属性转发到其组件树下的另一个组件中。\n\n```js\n\nconst FancyInput = forwardRef((props, ref) => (\n  <input ref={inputRef} {...props} />\n))\n\n// 这样可以拿到 input 元素了\nconst inputEle = React.createRef()\n<FancyInput ref={inputEle} />\n\n```\n\n### useImperativeHandle\n\n> useImperativeHandle 可以让你在使用 ref 时自定义暴露给父组件的实例值。\n\n```js\n\nconst FancyInput = forwardRef((props, ref) => {\n  const inputRef = useRef();\n\n  useImperativeHandle(ref, () => ({\n    focus: () => {\n      inputRef.current.focus();\n    },\n    alert () {\n      alert(1)\n    }\n  }));\n  return <input ref={inputRef} {...props} />;\n})\n\n\nconst inputEle = React.createRef()\n<FancyInput ref={inputEle} />\n\n\n// 通过 inputEle 获取到 useImperativeHandle 定义的方法\ninputEle.current.focus()\n\ninputEle.current.alert()\n\n```\n\n# 参考资料\n[^1]: [ahooks 官网](https://ahooks.js.org/zh-CN/)\n","source":"_posts/react-hooks.md","raw":"---\ntitle: React Hooks\ndate: 2022-03-26 18:41:01\ntags: React，Hooks\nbanner_img: /img/home.jpg\nindex_img: /img/home.jpg\nexcerpt: 什么是React Hooks，为什么需要它？如何高效的使用React Hooks？如何自定义 Hooks ？如何通过 Hooks 做性能优化？\ncomment: true\n---\n\n> Hook 是 React 16.8 的新增特性。它可以让你在不编写 class 的情况下使用 state 以及其他的 React 特性。\n\n\n# 动机\n\n# Hook 规则\n1. 只在最顶层使用 Hook\n2. 只在 React 函数中调用 Hook。（或：在自定义 Hook 中调用其他 Hook）\n\n\n# 使用 useCallback、useMemo、memo 做性能优化\n\n尽可能的保证组件不去发生变化，发生变化的因素有：`state、props、context`。\n\n那么 `React` 是如何比较这三者的呢？ 答案是 `内存地址`。\n\n比如说，对比一个 `function`，对比的就是这个函数在内存中的地址，通过地址的判断，从而判断 props 是否发生了改变。\n\n## React.memo\n> https://react.docschina.org/docs/hooks-faq.html#how-do-i-implement-shouldcomponentupdate\n\nReact.memo 包裹一个组件，来对它的 props 进行浅比较。等效于 PureComponent，但它只比较 props。（也可以通过第二个参数指定一个`自定义的比较函数`来比较新旧 props。如果函数返回 true，就会跳过更新。）\n\n```js\n// 不使用 memo，每一次 setCount，都会造成 Child 组件重新 render\nconst Child = () => {\n  console.log('Child')\n  return (\n    <>Child component</>\n  )\n}\nconst Demo = () => {\n  const [count, setCount] = useState(0)\n  return (\n    <>\n      <button onClick={() => setCount(count => count + 1)}>+</button>\n      <Child />\n    </>\n  )\n}\n\n// 通过 memo 包裹后，Child 组件不会再重新 render了。\nconst Child = memo(() => {\n  console.log('Child')\n  return (\n    <>Child component</>\n  )\n})\n```\n\n当 memo 感知 props 没有发生改变时，不会重新 render 组件。如果传入 count 进来，Child组件就会重新 render。\n\n总结：\n\n1. 如果我们将 setCount 当做 prop 传入进来，Child 不会重新render（`因为 setCount 在内存中的地址没有发生改变`）\n2. 如果传入我们自己定义的方法 (fn)进来，Child会重新 render，因为 Demo 组件每次更新 count 后，重新生成了 fn 函数。\n3. 只是传了个 fn ，不想让 Child 组件更新怎么办？那就要用到 `useCallback` 钩子了\n\n## useMemo\n\n把“创建”函数和依赖项数组作为参数传入 useMemo，它仅会在某个依赖项改变时才重新计算。\n\n```js\n  // 只有当 count 发生变化时，才会重新计算\n  const computedCount = useMemo(() => {\n    return count * 2\n  }, [count])\n```\n\n`useMemo` 也允许你跳过一次子节点的昂贵的重新渲染，比如组件初始化时，需要一次大量的计算，后续就不会再改变了：\n\n```js\nfunction Parent({ a, b }) {\n  // Only re-rendered if `a` changes:\n  const child1 = useMemo(() => <Child1 a={a} />, [a]);\n  // Only re-rendered if `b` changes:\n  const child2 = useMemo(() => <Child2 b={b} />, [b]);\n  return (\n    <>\n      {child1}\n      {child2}\n    </>\n  )\n}\n```\n\n## useCallback\n\n把内联回调函数及依赖项数组作为参数传入 useCallback，它将返回该回调函数的 memoized 版本，该回调函数仅在某个依赖项改变时才会更新。\n\n下面这个例子，即使我们用 `memo` 包裹了组件，因为 `setCount` 每次会引起 Demo 组件重新 render，`生成了新的 fn 函数`(内存地址发生了变化)，导致 Child 也会重新 render。\n\n```js\ninterface IChild {\n  fn: React.Dispatch<React.SetStateAction<number>>\n}\nconst Child = memo((props: IChild) => {\n  console.log('Child')\n  return (\n    <>Child component</>\n  )\n})\n\nconst Demo = () => {\n  const [count, setCount] = useState(0)\n  const fn = () => console.log('is fn')\n\n  return (\n    <>\n      <button onClick={() => setCount(count => count + 1)}>+</button>\n      <Child fn={fn} />\n    </>\n  )\n}\n```\n\n我们不想让 fn 函数的 `内存地址` 发生变化，怎么办呢？使用 `useCallback` 钩子将其包裹起来即可。\n\n`注意：useMemo 也可以这样用，缓存 fn，从而使得 Child 组件不会重复 render。`\n\n```js\n// 省略...\n\nconst fn = useCallback(() => {\n  console.log('is fn')\n}, [])\n\n// 省略...\n```\n\n这样 `fn` 函数就是一个缓存函数了，即使 count 不停的发生变化，也不会造成 Child 组件重复 render。\n\n*总结:*\n\n1. 当 Demo 组件内部 state 发生了改变引起 Demo 和 Child 组件重新 render\n2. 并且 Child 组件接受了一个来自 Demo 组件自定义的方法（fn）\n3. 如果不希望 Child 组件重新 render，那么就需要用 useCallback 钩子将自定义方法 `fn` 包裹起来\n4. 因为 Child 组件 props 里面的 fn 和 useCallback 返回的 fn 指向的是内存中的同一个地址，那么 Child 组件就不会更新\n5. useCallback 返回新函数的条件是：依赖项（第二个参数）发生了改变。\n6. 如果说我们的 Child 组件，本身就是需要根据 count 变化而变化，那么就不需要加这个缓存 API了，反而增加其计算负担。\n\n## 设计组件\n\n不要为了使用钩子，过渡的使用钩子，好的页面设计，也许用不上这些钩子。\n\n`把不变的组件和变化的组件抽离出来！`\n\n比如可以把 count 相关部分抽离成一个 Count 组件，使其和 Child 组件同层级排列，Count 组件和 Child 组件分开了，也不会引起 Child 组件做多余的 render。\n\n```js\n<Count />\n<Child prop={fn} />\n```\n\n或者是通过 props.children 渲染 Child，也不会造成 Child 重新 render。\n\n```js\nconst Count = (props: any) => {\n  const [count, setCount] = useState(0)\n\n  return (\n    <>\n      <button onClick={() => setCount(count => count + 1)}>+</button>\n      {/* children 不会重新 render */}\n      {props.children}\n    </>\n  )\n}\nconst Demo = () => {\n  // fn 永远不会变化\n  const fn = () => {}\n  return (\n    <>\n      <Count>\n        <Child fn={fn} />\n      </Count>\n    </>\n  )\n}\n```\n\n## useRef / createRef\n\n> 访问 DOM 节点\n\n```js\n\nconst inputEle = useRef(null)\nconst inputEle = React.createRef()\n\ninputEle.current.focus()\n\n```\n\n### 测量 DOM节点？\n\n```js\n\nconst getHeight = useMemo(() => {\n  return (node: HTMLObjectElement) => {\n    if (node) {\n      setHeight(node.getBoundingClientRect().height)\n    }\n  }\n}, [])\n\n// 或者\n\nconst getHeight = useCallback((node: HTMLObjectElement) => {\n  if (node) {\n    setHeight(node.getBoundingClientRect().height)\n  }\n}, [])\n\n```\n\n`将 ref 逻辑抽离成一个 Hook`\n\n```js\n// hook\nconst useClientRect = () => {\n  const [rect, setRect] = useState(null)\n  const ref = useCallback(node => {\n    if (node) {\n      setRect(node.getBoundingClientRect())\n    }\n  }, [])\n\n  return [rect, ref]\n}\n\n// 使用\n\nconst [rect, ref] = useClientRect()\n\n<h1 ref={ref}>是 H1 标签 {count}</h1>\n{\n  rect && <span>{rect.height}</span>\n}\n```\n\n### React.forwardRef\n\n> React.forwardRef 会创建一个React组件，这个组件能够将其接受的 ref 属性转发到其组件树下的另一个组件中。\n\n```js\n\nconst FancyInput = forwardRef((props, ref) => (\n  <input ref={inputRef} {...props} />\n))\n\n// 这样可以拿到 input 元素了\nconst inputEle = React.createRef()\n<FancyInput ref={inputEle} />\n\n```\n\n### useImperativeHandle\n\n> useImperativeHandle 可以让你在使用 ref 时自定义暴露给父组件的实例值。\n\n```js\n\nconst FancyInput = forwardRef((props, ref) => {\n  const inputRef = useRef();\n\n  useImperativeHandle(ref, () => ({\n    focus: () => {\n      inputRef.current.focus();\n    },\n    alert () {\n      alert(1)\n    }\n  }));\n  return <input ref={inputRef} {...props} />;\n})\n\n\nconst inputEle = React.createRef()\n<FancyInput ref={inputEle} />\n\n\n// 通过 inputEle 获取到 useImperativeHandle 定义的方法\ninputEle.current.focus()\n\ninputEle.current.alert()\n\n```\n\n# 参考资料\n[^1]: [ahooks 官网](https://ahooks.js.org/zh-CN/)\n","slug":"react-hooks","published":1,"updated":"2023-05-12T10:53:24.159Z","comments":1,"layout":"post","photos":[],"link":"","_id":"clhkizgxj000l3y0q30u488vj","content":"<blockquote>\n<p>Hook 是 React 16.8 的新增特性。它可以让你在不编写 class 的情况下使用 state 以及其他的 React 特性。</p>\n</blockquote>\n<h1 id=\"动机\"><a href=\"#动机\" class=\"headerlink\" title=\"动机\"></a>动机</h1><h1 id=\"Hook-规则\"><a href=\"#Hook-规则\" class=\"headerlink\" title=\"Hook 规则\"></a>Hook 规则</h1><ol>\n<li>只在最顶层使用 Hook</li>\n<li>只在 React 函数中调用 Hook。（或：在自定义 Hook 中调用其他 Hook）</li>\n</ol>\n<h1 id=\"使用-useCallback、useMemo、memo-做性能优化\"><a href=\"#使用-useCallback、useMemo、memo-做性能优化\" class=\"headerlink\" title=\"使用 useCallback、useMemo、memo 做性能优化\"></a>使用 useCallback、useMemo、memo 做性能优化</h1><p>尽可能的保证组件不去发生变化，发生变化的因素有：<code>state、props、context</code>。</p>\n<p>那么 <code>React</code> 是如何比较这三者的呢？ 答案是 <code>内存地址</code>。</p>\n<p>比如说，对比一个 <code>function</code>，对比的就是这个函数在内存中的地址，通过地址的判断，从而判断 props 是否发生了改变。</p>\n<h2 id=\"React-memo\"><a href=\"#React-memo\" class=\"headerlink\" title=\"React.memo\"></a>React.memo</h2><blockquote>\n<p><a href=\"https://react.docschina.org/docs/hooks-faq.html#how-do-i-implement-shouldcomponentupdate\">https://react.docschina.org/docs/hooks-faq.html#how-do-i-implement-shouldcomponentupdate</a></p>\n</blockquote>\n<p>React.memo 包裹一个组件，来对它的 props 进行浅比较。等效于 PureComponent，但它只比较 props。（也可以通过第二个参数指定一个<code>自定义的比较函数</code>来比较新旧 props。如果函数返回 true，就会跳过更新。）</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><div class=\"code-wrapper\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br></pre></div></td><td class=\"code\"><pre><code class=\"hljs js\"><span class=\"hljs-comment\">// 不使用 memo，每一次 setCount，都会造成 Child 组件重新 render</span><br><span class=\"hljs-keyword\">const</span> <span class=\"hljs-title function_\">Child</span> = (<span class=\"hljs-params\"></span>) =&gt; &#123;<br>  <span class=\"hljs-variable language_\">console</span>.<span class=\"hljs-title function_\">log</span>(<span class=\"hljs-string\">&#x27;Child&#x27;</span>)<br>  <span class=\"hljs-keyword\">return</span> (<br>    <span class=\"language-xml\"><span class=\"hljs-tag\">&lt;&gt;</span>Child component<span class=\"hljs-tag\">&lt;/&gt;</span></span><br>  )<br>&#125;<br><span class=\"hljs-keyword\">const</span> <span class=\"hljs-title function_\">Demo</span> = (<span class=\"hljs-params\"></span>) =&gt; &#123;<br>  <span class=\"hljs-keyword\">const</span> [count, setCount] = <span class=\"hljs-title function_\">useState</span>(<span class=\"hljs-number\">0</span>)<br>  <span class=\"hljs-keyword\">return</span> (<br>    <span class=\"language-xml\"><span class=\"hljs-tag\">&lt;&gt;</span></span><br><span class=\"language-xml\">      <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">button</span> <span class=\"hljs-attr\">onClick</span>=<span class=\"hljs-string\">&#123;()</span> =&gt;</span> setCount(count =&gt; count + 1)&#125;&gt;+<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">button</span>&gt;</span></span><br><span class=\"language-xml\">      <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">Child</span> /&gt;</span></span><br><span class=\"language-xml\">    <span class=\"hljs-tag\">&lt;/&gt;</span></span><br>  )<br>&#125;<br><br><span class=\"hljs-comment\">// 通过 memo 包裹后，Child 组件不会再重新 render了。</span><br><span class=\"hljs-keyword\">const</span> <span class=\"hljs-title class_\">Child</span> = <span class=\"hljs-title function_\">memo</span>(<span class=\"hljs-function\">() =&gt;</span> &#123;<br>  <span class=\"hljs-variable language_\">console</span>.<span class=\"hljs-title function_\">log</span>(<span class=\"hljs-string\">&#x27;Child&#x27;</span>)<br>  <span class=\"hljs-keyword\">return</span> (<br>    <span class=\"language-xml\"><span class=\"hljs-tag\">&lt;&gt;</span>Child component<span class=\"hljs-tag\">&lt;/&gt;</span></span><br>  )<br>&#125;)<br></code></pre></td></tr></table></figure>\n\n<p>当 memo 感知 props 没有发生改变时，不会重新 render 组件。如果传入 count 进来，Child组件就会重新 render。</p>\n<p>总结：</p>\n<ol>\n<li>如果我们将 setCount 当做 prop 传入进来，Child 不会重新render（<code>因为 setCount 在内存中的地址没有发生改变</code>）</li>\n<li>如果传入我们自己定义的方法 (fn)进来，Child会重新 render，因为 Demo 组件每次更新 count 后，重新生成了 fn 函数。</li>\n<li>只是传了个 fn ，不想让 Child 组件更新怎么办？那就要用到 <code>useCallback</code> 钩子了</li>\n</ol>\n<h2 id=\"useMemo\"><a href=\"#useMemo\" class=\"headerlink\" title=\"useMemo\"></a>useMemo</h2><p>把“创建”函数和依赖项数组作为参数传入 useMemo，它仅会在某个依赖项改变时才重新计算。</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\"><span class=\"hljs-comment\">// 只有当 count 发生变化时，才会重新计算</span><br><span class=\"hljs-keyword\">const</span> computedCount = <span class=\"hljs-title function_\">useMemo</span>(<span class=\"hljs-function\">() =&gt;</span> &#123;<br>  <span class=\"hljs-keyword\">return</span> count * <span class=\"hljs-number\">2</span><br>&#125;, [count])<br></code></pre></td></tr></table></figure>\n\n<p><code>useMemo</code> 也允许你跳过一次子节点的昂贵的重新渲染，比如组件初始化时，需要一次大量的计算，后续就不会再改变了：</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\"><span class=\"hljs-keyword\">function</span> <span class=\"hljs-title function_\">Parent</span>(<span class=\"hljs-params\">&#123; a, b &#125;</span>) &#123;<br>  <span class=\"hljs-comment\">// Only re-rendered if `a` changes:</span><br>  <span class=\"hljs-keyword\">const</span> child1 = <span class=\"hljs-title function_\">useMemo</span>(<span class=\"hljs-function\">() =&gt;</span> <span class=\"language-xml\"><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">Child1</span> <span class=\"hljs-attr\">a</span>=<span class=\"hljs-string\">&#123;a&#125;</span> /&gt;</span></span>, [a]);<br>  <span class=\"hljs-comment\">// Only re-rendered if `b` changes:</span><br>  <span class=\"hljs-keyword\">const</span> child2 = <span class=\"hljs-title function_\">useMemo</span>(<span class=\"hljs-function\">() =&gt;</span> <span class=\"language-xml\"><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">Child2</span> <span class=\"hljs-attr\">b</span>=<span class=\"hljs-string\">&#123;b&#125;</span> /&gt;</span></span>, [b]);<br>  <span class=\"hljs-keyword\">return</span> (<br>    <span class=\"language-xml\"><span class=\"hljs-tag\">&lt;&gt;</span></span><br><span class=\"language-xml\">      &#123;child1&#125;</span><br><span class=\"language-xml\">      &#123;child2&#125;</span><br><span class=\"language-xml\">    <span class=\"hljs-tag\">&lt;/&gt;</span></span><br>  )<br>&#125;<br></code></pre></td></tr></table></figure>\n\n<h2 id=\"useCallback\"><a href=\"#useCallback\" class=\"headerlink\" title=\"useCallback\"></a>useCallback</h2><p>把内联回调函数及依赖项数组作为参数传入 useCallback，它将返回该回调函数的 memoized 版本，该回调函数仅在某个依赖项改变时才会更新。</p>\n<p>下面这个例子，即使我们用 <code>memo</code> 包裹了组件，因为 <code>setCount</code> 每次会引起 Demo 组件重新 render，<code>生成了新的 fn 函数</code>(内存地址发生了变化)，导致 Child 也会重新 render。</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\">interface <span class=\"hljs-title class_\">IChild</span> &#123;<br>  <span class=\"hljs-attr\">fn</span>: <span class=\"hljs-title class_\">React</span>.<span class=\"hljs-property\">Dispatch</span>&lt;<span class=\"hljs-title class_\">React</span>.<span class=\"hljs-property\">SetStateAction</span>&lt;number&gt;&gt;<br>&#125;<br><span class=\"hljs-keyword\">const</span> <span class=\"hljs-title class_\">Child</span> = <span class=\"hljs-title function_\">memo</span>(<span class=\"hljs-function\">(<span class=\"hljs-params\">props: IChild</span>) =&gt;</span> &#123;<br>  <span class=\"hljs-variable language_\">console</span>.<span class=\"hljs-title function_\">log</span>(<span class=\"hljs-string\">&#x27;Child&#x27;</span>)<br>  <span class=\"hljs-keyword\">return</span> (<br>    <span class=\"language-xml\"><span class=\"hljs-tag\">&lt;&gt;</span>Child component<span class=\"hljs-tag\">&lt;/&gt;</span></span><br>  )<br>&#125;)<br><br><span class=\"hljs-keyword\">const</span> <span class=\"hljs-title function_\">Demo</span> = (<span class=\"hljs-params\"></span>) =&gt; &#123;<br>  <span class=\"hljs-keyword\">const</span> [count, setCount] = <span class=\"hljs-title function_\">useState</span>(<span class=\"hljs-number\">0</span>)<br>  <span class=\"hljs-keyword\">const</span> <span class=\"hljs-title function_\">fn</span> = (<span class=\"hljs-params\"></span>) =&gt; <span class=\"hljs-variable language_\">console</span>.<span class=\"hljs-title function_\">log</span>(<span class=\"hljs-string\">&#x27;is fn&#x27;</span>)<br><br>  <span class=\"hljs-keyword\">return</span> (<br>    <span class=\"language-xml\"><span class=\"hljs-tag\">&lt;&gt;</span></span><br><span class=\"language-xml\">      <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">button</span> <span class=\"hljs-attr\">onClick</span>=<span class=\"hljs-string\">&#123;()</span> =&gt;</span> setCount(count =&gt; count + 1)&#125;&gt;+<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">button</span>&gt;</span></span><br><span class=\"language-xml\">      <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">Child</span> <span class=\"hljs-attr\">fn</span>=<span class=\"hljs-string\">&#123;fn&#125;</span> /&gt;</span></span><br><span class=\"language-xml\">    <span class=\"hljs-tag\">&lt;/&gt;</span></span><br>  )<br>&#125;<br></code></pre></td></tr></table></figure>\n\n<p>我们不想让 fn 函数的 <code>内存地址</code> 发生变化，怎么办呢？使用 <code>useCallback</code> 钩子将其包裹起来即可。</p>\n<p><code>注意：useMemo 也可以这样用，缓存 fn，从而使得 Child 组件不会重复 render。</code></p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\"><span class=\"hljs-comment\">// 省略...</span><br><br><span class=\"hljs-keyword\">const</span> fn = <span class=\"hljs-title function_\">useCallback</span>(<span class=\"hljs-function\">() =&gt;</span> &#123;<br>  <span class=\"hljs-variable language_\">console</span>.<span class=\"hljs-title function_\">log</span>(<span class=\"hljs-string\">&#x27;is fn&#x27;</span>)<br>&#125;, [])<br><br><span class=\"hljs-comment\">// 省略...</span><br></code></pre></td></tr></table></figure>\n\n<p>这样 <code>fn</code> 函数就是一个缓存函数了，即使 count 不停的发生变化，也不会造成 Child 组件重复 render。</p>\n<p><em>总结:</em></p>\n<ol>\n<li>当 Demo 组件内部 state 发生了改变引起 Demo 和 Child 组件重新 render</li>\n<li>并且 Child 组件接受了一个来自 Demo 组件自定义的方法（fn）</li>\n<li>如果不希望 Child 组件重新 render，那么就需要用 useCallback 钩子将自定义方法 <code>fn</code> 包裹起来</li>\n<li>因为 Child 组件 props 里面的 fn 和 useCallback 返回的 fn 指向的是内存中的同一个地址，那么 Child 组件就不会更新</li>\n<li>useCallback 返回新函数的条件是：依赖项（第二个参数）发生了改变。</li>\n<li>如果说我们的 Child 组件，本身就是需要根据 count 变化而变化，那么就不需要加这个缓存 API了，反而增加其计算负担。</li>\n</ol>\n<h2 id=\"设计组件\"><a href=\"#设计组件\" class=\"headerlink\" title=\"设计组件\"></a>设计组件</h2><p>不要为了使用钩子，过渡的使用钩子，好的页面设计，也许用不上这些钩子。</p>\n<p><code>把不变的组件和变化的组件抽离出来！</code></p>\n<p>比如可以把 count 相关部分抽离成一个 Count 组件，使其和 Child 组件同层级排列，Count 组件和 Child 组件分开了，也不会引起 Child 组件做多余的 render。</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\">&lt;<span class=\"hljs-title class_\">Count</span> /&gt;<br><span class=\"language-xml\"><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">Child</span> <span class=\"hljs-attr\">prop</span>=<span class=\"hljs-string\">&#123;fn&#125;</span> /&gt;</span></span><br></code></pre></td></tr></table></figure>\n\n<p>或者是通过 props.children 渲染 Child，也不会造成 Child 重新 render。</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\"><span class=\"hljs-keyword\">const</span> <span class=\"hljs-title function_\">Count</span> = (<span class=\"hljs-params\">props: any</span>) =&gt; &#123;<br>  <span class=\"hljs-keyword\">const</span> [count, setCount] = <span class=\"hljs-title function_\">useState</span>(<span class=\"hljs-number\">0</span>)<br><br>  <span class=\"hljs-keyword\">return</span> (<br>    <span class=\"language-xml\"><span class=\"hljs-tag\">&lt;&gt;</span></span><br><span class=\"language-xml\">      <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">button</span> <span class=\"hljs-attr\">onClick</span>=<span class=\"hljs-string\">&#123;()</span> =&gt;</span> setCount(count =&gt; count + 1)&#125;&gt;+<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">button</span>&gt;</span></span><br><span class=\"language-xml\">      &#123;/* children 不会重新 render */&#125;</span><br><span class=\"language-xml\">      &#123;props.children&#125;</span><br><span class=\"language-xml\">    <span class=\"hljs-tag\">&lt;/&gt;</span></span><br>  )<br>&#125;<br><span class=\"hljs-keyword\">const</span> <span class=\"hljs-title function_\">Demo</span> = (<span class=\"hljs-params\"></span>) =&gt; &#123;<br>  <span class=\"hljs-comment\">// fn 永远不会变化</span><br>  <span class=\"hljs-keyword\">const</span> <span class=\"hljs-title function_\">fn</span> = (<span class=\"hljs-params\"></span>) =&gt; &#123;&#125;<br>  <span class=\"hljs-keyword\">return</span> (<br>    <span class=\"language-xml\"><span class=\"hljs-tag\">&lt;&gt;</span></span><br><span class=\"language-xml\">      <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">Count</span>&gt;</span></span><br><span class=\"language-xml\">        <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">Child</span> <span class=\"hljs-attr\">fn</span>=<span class=\"hljs-string\">&#123;fn&#125;</span> /&gt;</span></span><br><span class=\"language-xml\">      <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">Count</span>&gt;</span></span><br><span class=\"language-xml\">    <span class=\"hljs-tag\">&lt;/&gt;</span></span><br>  )<br>&#125;<br></code></pre></td></tr></table></figure>\n\n<h2 id=\"useRef-createRef\"><a href=\"#useRef-createRef\" class=\"headerlink\" title=\"useRef / createRef\"></a>useRef / createRef</h2><blockquote>\n<p>访问 DOM 节点</p>\n</blockquote>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\"><br><span class=\"hljs-keyword\">const</span> inputEle = <span class=\"hljs-title function_\">useRef</span>(<span class=\"hljs-literal\">null</span>)<br><span class=\"hljs-keyword\">const</span> inputEle = <span class=\"hljs-title class_\">React</span>.<span class=\"hljs-title function_\">createRef</span>()<br><br>inputEle.<span class=\"hljs-property\">current</span>.<span class=\"hljs-title function_\">focus</span>()<br><br></code></pre></td></tr></table></figure>\n\n<h3 id=\"测量-DOM节点？\"><a href=\"#测量-DOM节点？\" class=\"headerlink\" title=\"测量 DOM节点？\"></a>测量 DOM节点？</h3><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\"><br><span class=\"hljs-keyword\">const</span> getHeight = <span class=\"hljs-title function_\">useMemo</span>(<span class=\"hljs-function\">() =&gt;</span> &#123;<br>  <span class=\"hljs-keyword\">return</span> <span class=\"hljs-function\">(<span class=\"hljs-params\">node: HTMLObjectElement</span>) =&gt;</span> &#123;<br>    <span class=\"hljs-keyword\">if</span> (node) &#123;<br>      <span class=\"hljs-title function_\">setHeight</span>(node.<span class=\"hljs-title function_\">getBoundingClientRect</span>().<span class=\"hljs-property\">height</span>)<br>    &#125;<br>  &#125;<br>&#125;, [])<br><br><span class=\"hljs-comment\">// 或者</span><br><br><span class=\"hljs-keyword\">const</span> getHeight = <span class=\"hljs-title function_\">useCallback</span>(<span class=\"hljs-function\">(<span class=\"hljs-params\">node: HTMLObjectElement</span>) =&gt;</span> &#123;<br>  <span class=\"hljs-keyword\">if</span> (node) &#123;<br>    <span class=\"hljs-title function_\">setHeight</span>(node.<span class=\"hljs-title function_\">getBoundingClientRect</span>().<span class=\"hljs-property\">height</span>)<br>  &#125;<br>&#125;, [])<br><br></code></pre></td></tr></table></figure>\n\n<p><code>将 ref 逻辑抽离成一个 Hook</code></p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\"><span class=\"hljs-comment\">// hook</span><br><span class=\"hljs-keyword\">const</span> <span class=\"hljs-title function_\">useClientRect</span> = (<span class=\"hljs-params\"></span>) =&gt; &#123;<br>  <span class=\"hljs-keyword\">const</span> [rect, setRect] = <span class=\"hljs-title function_\">useState</span>(<span class=\"hljs-literal\">null</span>)<br>  <span class=\"hljs-keyword\">const</span> ref = <span class=\"hljs-title function_\">useCallback</span>(<span class=\"hljs-function\"><span class=\"hljs-params\">node</span> =&gt;</span> &#123;<br>    <span class=\"hljs-keyword\">if</span> (node) &#123;<br>      <span class=\"hljs-title function_\">setRect</span>(node.<span class=\"hljs-title function_\">getBoundingClientRect</span>())<br>    &#125;<br>  &#125;, [])<br><br>  <span class=\"hljs-keyword\">return</span> [rect, ref]<br>&#125;<br><br><span class=\"hljs-comment\">// 使用</span><br><br><span class=\"hljs-keyword\">const</span> [rect, ref] = <span class=\"hljs-title function_\">useClientRect</span>()<br><br>&lt;h1 ref=&#123;ref&#125;&gt;是 <span class=\"hljs-variable constant_\">H1</span> 标签 &#123;count&#125;&lt;/h1&gt;<br>&#123;<br>  rect &amp;&amp; <span class=\"language-xml\"><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">span</span>&gt;</span>&#123;rect.height&#125;<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">span</span>&gt;</span></span><br>&#125;<br></code></pre></td></tr></table></figure>\n\n<h3 id=\"React-forwardRef\"><a href=\"#React-forwardRef\" class=\"headerlink\" title=\"React.forwardRef\"></a>React.forwardRef</h3><blockquote>\n<p>React.forwardRef 会创建一个React组件，这个组件能够将其接受的 ref 属性转发到其组件树下的另一个组件中。</p>\n</blockquote>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\"><br><span class=\"hljs-keyword\">const</span> <span class=\"hljs-title class_\">FancyInput</span> = <span class=\"hljs-title function_\">forwardRef</span>(<span class=\"hljs-function\">(<span class=\"hljs-params\">props, ref</span>) =&gt;</span> (<br>  <span class=\"language-xml\"><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">input</span> <span class=\"hljs-attr\">ref</span>=<span class=\"hljs-string\">&#123;inputRef&#125;</span> &#123;<span class=\"hljs-attr\">...props</span>&#125; /&gt;</span></span><br>))<br><br><span class=\"hljs-comment\">// 这样可以拿到 input 元素了</span><br><span class=\"hljs-keyword\">const</span> inputEle = <span class=\"hljs-title class_\">React</span>.<span class=\"hljs-title function_\">createRef</span>()<br>&lt;<span class=\"hljs-title class_\">FancyInput</span> ref=&#123;inputEle&#125; /&gt;<br><br></code></pre></td></tr></table></figure>\n\n<h3 id=\"useImperativeHandle\"><a href=\"#useImperativeHandle\" class=\"headerlink\" title=\"useImperativeHandle\"></a>useImperativeHandle</h3><blockquote>\n<p>useImperativeHandle 可以让你在使用 ref 时自定义暴露给父组件的实例值。</p>\n</blockquote>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\"><br><span class=\"hljs-keyword\">const</span> <span class=\"hljs-title class_\">FancyInput</span> = <span class=\"hljs-title function_\">forwardRef</span>(<span class=\"hljs-function\">(<span class=\"hljs-params\">props, ref</span>) =&gt;</span> &#123;<br>  <span class=\"hljs-keyword\">const</span> inputRef = <span class=\"hljs-title function_\">useRef</span>();<br><br>  <span class=\"hljs-title function_\">useImperativeHandle</span>(ref, <span class=\"hljs-function\">() =&gt;</span> (&#123;<br>    <span class=\"hljs-attr\">focus</span>: <span class=\"hljs-function\">() =&gt;</span> &#123;<br>      inputRef.<span class=\"hljs-property\">current</span>.<span class=\"hljs-title function_\">focus</span>();<br>    &#125;,<br>    alert () &#123;<br>      <span class=\"hljs-title function_\">alert</span>(<span class=\"hljs-number\">1</span>)<br>    &#125;<br>  &#125;));<br>  <span class=\"hljs-keyword\">return</span> <span class=\"language-xml\"><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">input</span> <span class=\"hljs-attr\">ref</span>=<span class=\"hljs-string\">&#123;inputRef&#125;</span> &#123;<span class=\"hljs-attr\">...props</span>&#125; /&gt;</span></span>;<br>&#125;)<br><br><br><span class=\"hljs-keyword\">const</span> inputEle = <span class=\"hljs-title class_\">React</span>.<span class=\"hljs-title function_\">createRef</span>()<br>&lt;<span class=\"hljs-title class_\">FancyInput</span> ref=&#123;inputEle&#125; /&gt;<br><br><br><span class=\"hljs-comment\">// 通过 inputEle 获取到 useImperativeHandle 定义的方法</span><br>inputEle.<span class=\"hljs-property\">current</span>.<span class=\"hljs-title function_\">focus</span>()<br><br>inputEle.<span class=\"hljs-property\">current</span>.<span class=\"hljs-title function_\">alert</span>()<br><br></code></pre></td></tr></table></figure>\n\n<h1 id=\"参考资料\"><a href=\"#参考资料\" class=\"headerlink\" title=\"参考资料\"></a>参考资料</h1><section class=\"footnotes\"><div class=\"footnote-list\"><ol><li><span id=\"fn:1\" class=\"footnote-text\"><span><a href=\"https://ahooks.js.org/zh-CN/\">ahooks 官网</a>\n<a href=\"#fnref:1\" rev=\"footnote\" class=\"footnote-backref\"> ↩</a></span></span></li></ol></div></section>","site":{"data":{}},"wordcount":5257,"more":"<blockquote>\n<p>Hook 是 React 16.8 的新增特性。它可以让你在不编写 class 的情况下使用 state 以及其他的 React 特性。</p>\n</blockquote>\n<h1 id=\"动机\"><a href=\"#动机\" class=\"headerlink\" title=\"动机\"></a>动机</h1><h1 id=\"Hook-规则\"><a href=\"#Hook-规则\" class=\"headerlink\" title=\"Hook 规则\"></a>Hook 规则</h1><ol>\n<li>只在最顶层使用 Hook</li>\n<li>只在 React 函数中调用 Hook。（或：在自定义 Hook 中调用其他 Hook）</li>\n</ol>\n<h1 id=\"使用-useCallback、useMemo、memo-做性能优化\"><a href=\"#使用-useCallback、useMemo、memo-做性能优化\" class=\"headerlink\" title=\"使用 useCallback、useMemo、memo 做性能优化\"></a>使用 useCallback、useMemo、memo 做性能优化</h1><p>尽可能的保证组件不去发生变化，发生变化的因素有：<code>state、props、context</code>。</p>\n<p>那么 <code>React</code> 是如何比较这三者的呢？ 答案是 <code>内存地址</code>。</p>\n<p>比如说，对比一个 <code>function</code>，对比的就是这个函数在内存中的地址，通过地址的判断，从而判断 props 是否发生了改变。</p>\n<h2 id=\"React-memo\"><a href=\"#React-memo\" class=\"headerlink\" title=\"React.memo\"></a>React.memo</h2><blockquote>\n<p><a href=\"https://react.docschina.org/docs/hooks-faq.html#how-do-i-implement-shouldcomponentupdate\">https://react.docschina.org/docs/hooks-faq.html#how-do-i-implement-shouldcomponentupdate</a></p>\n</blockquote>\n<p>React.memo 包裹一个组件，来对它的 props 进行浅比较。等效于 PureComponent，但它只比较 props。（也可以通过第二个参数指定一个<code>自定义的比较函数</code>来比较新旧 props。如果函数返回 true，就会跳过更新。）</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\"><span class=\"hljs-comment\">// 不使用 memo，每一次 setCount，都会造成 Child 组件重新 render</span><br><span class=\"hljs-keyword\">const</span> <span class=\"hljs-title function_\">Child</span> = (<span class=\"hljs-params\"></span>) =&gt; &#123;<br>  <span class=\"hljs-variable language_\">console</span>.<span class=\"hljs-title function_\">log</span>(<span class=\"hljs-string\">&#x27;Child&#x27;</span>)<br>  <span class=\"hljs-keyword\">return</span> (<br>    <span class=\"language-xml\"><span class=\"hljs-tag\">&lt;&gt;</span>Child component<span class=\"hljs-tag\">&lt;/&gt;</span></span><br>  )<br>&#125;<br><span class=\"hljs-keyword\">const</span> <span class=\"hljs-title function_\">Demo</span> = (<span class=\"hljs-params\"></span>) =&gt; &#123;<br>  <span class=\"hljs-keyword\">const</span> [count, setCount] = <span class=\"hljs-title function_\">useState</span>(<span class=\"hljs-number\">0</span>)<br>  <span class=\"hljs-keyword\">return</span> (<br>    <span class=\"language-xml\"><span class=\"hljs-tag\">&lt;&gt;</span></span><br><span class=\"language-xml\">      <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">button</span> <span class=\"hljs-attr\">onClick</span>=<span class=\"hljs-string\">&#123;()</span> =&gt;</span> setCount(count =&gt; count + 1)&#125;&gt;+<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">button</span>&gt;</span></span><br><span class=\"language-xml\">      <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">Child</span> /&gt;</span></span><br><span class=\"language-xml\">    <span class=\"hljs-tag\">&lt;/&gt;</span></span><br>  )<br>&#125;<br><br><span class=\"hljs-comment\">// 通过 memo 包裹后，Child 组件不会再重新 render了。</span><br><span class=\"hljs-keyword\">const</span> <span class=\"hljs-title class_\">Child</span> = <span class=\"hljs-title function_\">memo</span>(<span class=\"hljs-function\">() =&gt;</span> &#123;<br>  <span class=\"hljs-variable language_\">console</span>.<span class=\"hljs-title function_\">log</span>(<span class=\"hljs-string\">&#x27;Child&#x27;</span>)<br>  <span class=\"hljs-keyword\">return</span> (<br>    <span class=\"language-xml\"><span class=\"hljs-tag\">&lt;&gt;</span>Child component<span class=\"hljs-tag\">&lt;/&gt;</span></span><br>  )<br>&#125;)<br></code></pre></td></tr></table></figure>\n\n<p>当 memo 感知 props 没有发生改变时，不会重新 render 组件。如果传入 count 进来，Child组件就会重新 render。</p>\n<p>总结：</p>\n<ol>\n<li>如果我们将 setCount 当做 prop 传入进来，Child 不会重新render（<code>因为 setCount 在内存中的地址没有发生改变</code>）</li>\n<li>如果传入我们自己定义的方法 (fn)进来，Child会重新 render，因为 Demo 组件每次更新 count 后，重新生成了 fn 函数。</li>\n<li>只是传了个 fn ，不想让 Child 组件更新怎么办？那就要用到 <code>useCallback</code> 钩子了</li>\n</ol>\n<h2 id=\"useMemo\"><a href=\"#useMemo\" class=\"headerlink\" title=\"useMemo\"></a>useMemo</h2><p>把“创建”函数和依赖项数组作为参数传入 useMemo，它仅会在某个依赖项改变时才重新计算。</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\"><span class=\"hljs-comment\">// 只有当 count 发生变化时，才会重新计算</span><br><span class=\"hljs-keyword\">const</span> computedCount = <span class=\"hljs-title function_\">useMemo</span>(<span class=\"hljs-function\">() =&gt;</span> &#123;<br>  <span class=\"hljs-keyword\">return</span> count * <span class=\"hljs-number\">2</span><br>&#125;, [count])<br></code></pre></td></tr></table></figure>\n\n<p><code>useMemo</code> 也允许你跳过一次子节点的昂贵的重新渲染，比如组件初始化时，需要一次大量的计算，后续就不会再改变了：</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\"><span class=\"hljs-keyword\">function</span> <span class=\"hljs-title function_\">Parent</span>(<span class=\"hljs-params\">&#123; a, b &#125;</span>) &#123;<br>  <span class=\"hljs-comment\">// Only re-rendered if `a` changes:</span><br>  <span class=\"hljs-keyword\">const</span> child1 = <span class=\"hljs-title function_\">useMemo</span>(<span class=\"hljs-function\">() =&gt;</span> <span class=\"language-xml\"><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">Child1</span> <span class=\"hljs-attr\">a</span>=<span class=\"hljs-string\">&#123;a&#125;</span> /&gt;</span></span>, [a]);<br>  <span class=\"hljs-comment\">// Only re-rendered if `b` changes:</span><br>  <span class=\"hljs-keyword\">const</span> child2 = <span class=\"hljs-title function_\">useMemo</span>(<span class=\"hljs-function\">() =&gt;</span> <span class=\"language-xml\"><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">Child2</span> <span class=\"hljs-attr\">b</span>=<span class=\"hljs-string\">&#123;b&#125;</span> /&gt;</span></span>, [b]);<br>  <span class=\"hljs-keyword\">return</span> (<br>    <span class=\"language-xml\"><span class=\"hljs-tag\">&lt;&gt;</span></span><br><span class=\"language-xml\">      &#123;child1&#125;</span><br><span class=\"language-xml\">      &#123;child2&#125;</span><br><span class=\"language-xml\">    <span class=\"hljs-tag\">&lt;/&gt;</span></span><br>  )<br>&#125;<br></code></pre></td></tr></table></figure>\n\n<h2 id=\"useCallback\"><a href=\"#useCallback\" class=\"headerlink\" title=\"useCallback\"></a>useCallback</h2><p>把内联回调函数及依赖项数组作为参数传入 useCallback，它将返回该回调函数的 memoized 版本，该回调函数仅在某个依赖项改变时才会更新。</p>\n<p>下面这个例子，即使我们用 <code>memo</code> 包裹了组件，因为 <code>setCount</code> 每次会引起 Demo 组件重新 render，<code>生成了新的 fn 函数</code>(内存地址发生了变化)，导致 Child 也会重新 render。</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\">interface <span class=\"hljs-title class_\">IChild</span> &#123;<br>  <span class=\"hljs-attr\">fn</span>: <span class=\"hljs-title class_\">React</span>.<span class=\"hljs-property\">Dispatch</span>&lt;<span class=\"hljs-title class_\">React</span>.<span class=\"hljs-property\">SetStateAction</span>&lt;number&gt;&gt;<br>&#125;<br><span class=\"hljs-keyword\">const</span> <span class=\"hljs-title class_\">Child</span> = <span class=\"hljs-title function_\">memo</span>(<span class=\"hljs-function\">(<span class=\"hljs-params\">props: IChild</span>) =&gt;</span> &#123;<br>  <span class=\"hljs-variable language_\">console</span>.<span class=\"hljs-title function_\">log</span>(<span class=\"hljs-string\">&#x27;Child&#x27;</span>)<br>  <span class=\"hljs-keyword\">return</span> (<br>    <span class=\"language-xml\"><span class=\"hljs-tag\">&lt;&gt;</span>Child component<span class=\"hljs-tag\">&lt;/&gt;</span></span><br>  )<br>&#125;)<br><br><span class=\"hljs-keyword\">const</span> <span class=\"hljs-title function_\">Demo</span> = (<span class=\"hljs-params\"></span>) =&gt; &#123;<br>  <span class=\"hljs-keyword\">const</span> [count, setCount] = <span class=\"hljs-title function_\">useState</span>(<span class=\"hljs-number\">0</span>)<br>  <span class=\"hljs-keyword\">const</span> <span class=\"hljs-title function_\">fn</span> = (<span class=\"hljs-params\"></span>) =&gt; <span class=\"hljs-variable language_\">console</span>.<span class=\"hljs-title function_\">log</span>(<span class=\"hljs-string\">&#x27;is fn&#x27;</span>)<br><br>  <span class=\"hljs-keyword\">return</span> (<br>    <span class=\"language-xml\"><span class=\"hljs-tag\">&lt;&gt;</span></span><br><span class=\"language-xml\">      <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">button</span> <span class=\"hljs-attr\">onClick</span>=<span class=\"hljs-string\">&#123;()</span> =&gt;</span> setCount(count =&gt; count + 1)&#125;&gt;+<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">button</span>&gt;</span></span><br><span class=\"language-xml\">      <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">Child</span> <span class=\"hljs-attr\">fn</span>=<span class=\"hljs-string\">&#123;fn&#125;</span> /&gt;</span></span><br><span class=\"language-xml\">    <span class=\"hljs-tag\">&lt;/&gt;</span></span><br>  )<br>&#125;<br></code></pre></td></tr></table></figure>\n\n<p>我们不想让 fn 函数的 <code>内存地址</code> 发生变化，怎么办呢？使用 <code>useCallback</code> 钩子将其包裹起来即可。</p>\n<p><code>注意：useMemo 也可以这样用，缓存 fn，从而使得 Child 组件不会重复 render。</code></p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\"><span class=\"hljs-comment\">// 省略...</span><br><br><span class=\"hljs-keyword\">const</span> fn = <span class=\"hljs-title function_\">useCallback</span>(<span class=\"hljs-function\">() =&gt;</span> &#123;<br>  <span class=\"hljs-variable language_\">console</span>.<span class=\"hljs-title function_\">log</span>(<span class=\"hljs-string\">&#x27;is fn&#x27;</span>)<br>&#125;, [])<br><br><span class=\"hljs-comment\">// 省略...</span><br></code></pre></td></tr></table></figure>\n\n<p>这样 <code>fn</code> 函数就是一个缓存函数了，即使 count 不停的发生变化，也不会造成 Child 组件重复 render。</p>\n<p><em>总结:</em></p>\n<ol>\n<li>当 Demo 组件内部 state 发生了改变引起 Demo 和 Child 组件重新 render</li>\n<li>并且 Child 组件接受了一个来自 Demo 组件自定义的方法（fn）</li>\n<li>如果不希望 Child 组件重新 render，那么就需要用 useCallback 钩子将自定义方法 <code>fn</code> 包裹起来</li>\n<li>因为 Child 组件 props 里面的 fn 和 useCallback 返回的 fn 指向的是内存中的同一个地址，那么 Child 组件就不会更新</li>\n<li>useCallback 返回新函数的条件是：依赖项（第二个参数）发生了改变。</li>\n<li>如果说我们的 Child 组件，本身就是需要根据 count 变化而变化，那么就不需要加这个缓存 API了，反而增加其计算负担。</li>\n</ol>\n<h2 id=\"设计组件\"><a href=\"#设计组件\" class=\"headerlink\" title=\"设计组件\"></a>设计组件</h2><p>不要为了使用钩子，过渡的使用钩子，好的页面设计，也许用不上这些钩子。</p>\n<p><code>把不变的组件和变化的组件抽离出来！</code></p>\n<p>比如可以把 count 相关部分抽离成一个 Count 组件，使其和 Child 组件同层级排列，Count 组件和 Child 组件分开了，也不会引起 Child 组件做多余的 render。</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\">&lt;<span class=\"hljs-title class_\">Count</span> /&gt;<br><span class=\"language-xml\"><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">Child</span> <span class=\"hljs-attr\">prop</span>=<span class=\"hljs-string\">&#123;fn&#125;</span> /&gt;</span></span><br></code></pre></td></tr></table></figure>\n\n<p>或者是通过 props.children 渲染 Child，也不会造成 Child 重新 render。</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\"><span class=\"hljs-keyword\">const</span> <span class=\"hljs-title function_\">Count</span> = (<span class=\"hljs-params\">props: any</span>) =&gt; &#123;<br>  <span class=\"hljs-keyword\">const</span> [count, setCount] = <span class=\"hljs-title function_\">useState</span>(<span class=\"hljs-number\">0</span>)<br><br>  <span class=\"hljs-keyword\">return</span> (<br>    <span class=\"language-xml\"><span class=\"hljs-tag\">&lt;&gt;</span></span><br><span class=\"language-xml\">      <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">button</span> <span class=\"hljs-attr\">onClick</span>=<span class=\"hljs-string\">&#123;()</span> =&gt;</span> setCount(count =&gt; count + 1)&#125;&gt;+<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">button</span>&gt;</span></span><br><span class=\"language-xml\">      &#123;/* children 不会重新 render */&#125;</span><br><span class=\"language-xml\">      &#123;props.children&#125;</span><br><span class=\"language-xml\">    <span class=\"hljs-tag\">&lt;/&gt;</span></span><br>  )<br>&#125;<br><span class=\"hljs-keyword\">const</span> <span class=\"hljs-title function_\">Demo</span> = (<span class=\"hljs-params\"></span>) =&gt; &#123;<br>  <span class=\"hljs-comment\">// fn 永远不会变化</span><br>  <span class=\"hljs-keyword\">const</span> <span class=\"hljs-title function_\">fn</span> = (<span class=\"hljs-params\"></span>) =&gt; &#123;&#125;<br>  <span class=\"hljs-keyword\">return</span> (<br>    <span class=\"language-xml\"><span class=\"hljs-tag\">&lt;&gt;</span></span><br><span class=\"language-xml\">      <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">Count</span>&gt;</span></span><br><span class=\"language-xml\">        <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">Child</span> <span class=\"hljs-attr\">fn</span>=<span class=\"hljs-string\">&#123;fn&#125;</span> /&gt;</span></span><br><span class=\"language-xml\">      <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">Count</span>&gt;</span></span><br><span class=\"language-xml\">    <span class=\"hljs-tag\">&lt;/&gt;</span></span><br>  )<br>&#125;<br></code></pre></td></tr></table></figure>\n\n<h2 id=\"useRef-createRef\"><a href=\"#useRef-createRef\" class=\"headerlink\" title=\"useRef / createRef\"></a>useRef / createRef</h2><blockquote>\n<p>访问 DOM 节点</p>\n</blockquote>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\"><br><span class=\"hljs-keyword\">const</span> inputEle = <span class=\"hljs-title function_\">useRef</span>(<span class=\"hljs-literal\">null</span>)<br><span class=\"hljs-keyword\">const</span> inputEle = <span class=\"hljs-title class_\">React</span>.<span class=\"hljs-title function_\">createRef</span>()<br><br>inputEle.<span class=\"hljs-property\">current</span>.<span class=\"hljs-title function_\">focus</span>()<br><br></code></pre></td></tr></table></figure>\n\n<h3 id=\"测量-DOM节点？\"><a href=\"#测量-DOM节点？\" class=\"headerlink\" title=\"测量 DOM节点？\"></a>测量 DOM节点？</h3><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\"><br><span class=\"hljs-keyword\">const</span> getHeight = <span class=\"hljs-title function_\">useMemo</span>(<span class=\"hljs-function\">() =&gt;</span> &#123;<br>  <span class=\"hljs-keyword\">return</span> <span class=\"hljs-function\">(<span class=\"hljs-params\">node: HTMLObjectElement</span>) =&gt;</span> &#123;<br>    <span class=\"hljs-keyword\">if</span> (node) &#123;<br>      <span class=\"hljs-title function_\">setHeight</span>(node.<span class=\"hljs-title function_\">getBoundingClientRect</span>().<span class=\"hljs-property\">height</span>)<br>    &#125;<br>  &#125;<br>&#125;, [])<br><br><span class=\"hljs-comment\">// 或者</span><br><br><span class=\"hljs-keyword\">const</span> getHeight = <span class=\"hljs-title function_\">useCallback</span>(<span class=\"hljs-function\">(<span class=\"hljs-params\">node: HTMLObjectElement</span>) =&gt;</span> &#123;<br>  <span class=\"hljs-keyword\">if</span> (node) &#123;<br>    <span class=\"hljs-title function_\">setHeight</span>(node.<span class=\"hljs-title function_\">getBoundingClientRect</span>().<span class=\"hljs-property\">height</span>)<br>  &#125;<br>&#125;, [])<br><br></code></pre></td></tr></table></figure>\n\n<p><code>将 ref 逻辑抽离成一个 Hook</code></p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\"><span class=\"hljs-comment\">// hook</span><br><span class=\"hljs-keyword\">const</span> <span class=\"hljs-title function_\">useClientRect</span> = (<span class=\"hljs-params\"></span>) =&gt; &#123;<br>  <span class=\"hljs-keyword\">const</span> [rect, setRect] = <span class=\"hljs-title function_\">useState</span>(<span class=\"hljs-literal\">null</span>)<br>  <span class=\"hljs-keyword\">const</span> ref = <span class=\"hljs-title function_\">useCallback</span>(<span class=\"hljs-function\"><span class=\"hljs-params\">node</span> =&gt;</span> &#123;<br>    <span class=\"hljs-keyword\">if</span> (node) &#123;<br>      <span class=\"hljs-title function_\">setRect</span>(node.<span class=\"hljs-title function_\">getBoundingClientRect</span>())<br>    &#125;<br>  &#125;, [])<br><br>  <span class=\"hljs-keyword\">return</span> [rect, ref]<br>&#125;<br><br><span class=\"hljs-comment\">// 使用</span><br><br><span class=\"hljs-keyword\">const</span> [rect, ref] = <span class=\"hljs-title function_\">useClientRect</span>()<br><br>&lt;h1 ref=&#123;ref&#125;&gt;是 <span class=\"hljs-variable constant_\">H1</span> 标签 &#123;count&#125;&lt;/h1&gt;<br>&#123;<br>  rect &amp;&amp; <span class=\"language-xml\"><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">span</span>&gt;</span>&#123;rect.height&#125;<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">span</span>&gt;</span></span><br>&#125;<br></code></pre></td></tr></table></figure>\n\n<h3 id=\"React-forwardRef\"><a href=\"#React-forwardRef\" class=\"headerlink\" title=\"React.forwardRef\"></a>React.forwardRef</h3><blockquote>\n<p>React.forwardRef 会创建一个React组件，这个组件能够将其接受的 ref 属性转发到其组件树下的另一个组件中。</p>\n</blockquote>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\"><br><span class=\"hljs-keyword\">const</span> <span class=\"hljs-title class_\">FancyInput</span> = <span class=\"hljs-title function_\">forwardRef</span>(<span class=\"hljs-function\">(<span class=\"hljs-params\">props, ref</span>) =&gt;</span> (<br>  <span class=\"language-xml\"><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">input</span> <span class=\"hljs-attr\">ref</span>=<span class=\"hljs-string\">&#123;inputRef&#125;</span> &#123;<span class=\"hljs-attr\">...props</span>&#125; /&gt;</span></span><br>))<br><br><span class=\"hljs-comment\">// 这样可以拿到 input 元素了</span><br><span class=\"hljs-keyword\">const</span> inputEle = <span class=\"hljs-title class_\">React</span>.<span class=\"hljs-title function_\">createRef</span>()<br>&lt;<span class=\"hljs-title class_\">FancyInput</span> ref=&#123;inputEle&#125; /&gt;<br><br></code></pre></td></tr></table></figure>\n\n<h3 id=\"useImperativeHandle\"><a href=\"#useImperativeHandle\" class=\"headerlink\" title=\"useImperativeHandle\"></a>useImperativeHandle</h3><blockquote>\n<p>useImperativeHandle 可以让你在使用 ref 时自定义暴露给父组件的实例值。</p>\n</blockquote>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\"><br><span class=\"hljs-keyword\">const</span> <span class=\"hljs-title class_\">FancyInput</span> = <span class=\"hljs-title function_\">forwardRef</span>(<span class=\"hljs-function\">(<span class=\"hljs-params\">props, ref</span>) =&gt;</span> &#123;<br>  <span class=\"hljs-keyword\">const</span> inputRef = <span class=\"hljs-title function_\">useRef</span>();<br><br>  <span class=\"hljs-title function_\">useImperativeHandle</span>(ref, <span class=\"hljs-function\">() =&gt;</span> (&#123;<br>    <span class=\"hljs-attr\">focus</span>: <span class=\"hljs-function\">() =&gt;</span> &#123;<br>      inputRef.<span class=\"hljs-property\">current</span>.<span class=\"hljs-title function_\">focus</span>();<br>    &#125;,<br>    alert () &#123;<br>      <span class=\"hljs-title function_\">alert</span>(<span class=\"hljs-number\">1</span>)<br>    &#125;<br>  &#125;));<br>  <span class=\"hljs-keyword\">return</span> <span class=\"language-xml\"><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">input</span> <span class=\"hljs-attr\">ref</span>=<span class=\"hljs-string\">&#123;inputRef&#125;</span> &#123;<span class=\"hljs-attr\">...props</span>&#125; /&gt;</span></span>;<br>&#125;)<br><br><br><span class=\"hljs-keyword\">const</span> inputEle = <span class=\"hljs-title class_\">React</span>.<span class=\"hljs-title function_\">createRef</span>()<br>&lt;<span class=\"hljs-title class_\">FancyInput</span> ref=&#123;inputEle&#125; /&gt;<br><br><br><span class=\"hljs-comment\">// 通过 inputEle 获取到 useImperativeHandle 定义的方法</span><br>inputEle.<span class=\"hljs-property\">current</span>.<span class=\"hljs-title function_\">focus</span>()<br><br>inputEle.<span class=\"hljs-property\">current</span>.<span class=\"hljs-title function_\">alert</span>()<br><br></code></pre></td></tr></table></figure>\n\n<h1 id=\"参考资料\"><a href=\"#参考资料\" class=\"headerlink\" title=\"参考资料\"></a>参考资料</h1><section class=\"footnotes\"><div class=\"footnote-list\"><ol><li><span id=\"fn:1\" class=\"footnote-text\"><span><a href=\"https://ahooks.js.org/zh-CN/\">ahooks 官网</a>\n<a href=\"#fnref:1\" rev=\"footnote\" class=\"footnote-backref\"> ↩</a></span></span></li></ol></div></section>"},{"layout":"JavaScript","title":"高性能渲染十万条数据(时间分片)","date":"2022-11-23T11:53:52.000Z","banner_img":"/img/render-10w-data.jpg","index_img":"/img/render-10w-data.jpg","excerpt":"渲染大量数据。","_content":"\n# 最粗暴的做法（一次性渲染\n\nJS的运行时间为`187ms`，还是蛮快的，但是最终渲染完成后的总时间确是`2844ms`，中间会白屏一段时间。\n\n```js\n  // 记录任务开始时间\n  let now = Date.now();\n  // 插入十万条数据\n  const total = 100000;\n  // 获取容器\n  let ul = document.getElementById('container');\n  // 将数据插入容器中\n  for (let i = 0; i < total; i++) {\n    let li = document.createElement('li');\n    li.innerText = i\n    ul.appendChild(li);\n  }\n\n  console.log('JS运行时间：', Date.now() - now);\n  setTimeout(() => {\n    console.log('总运行时间：', Date.now() - now);\n  }, 0)\n```\n\n# 使用定时器\n页面的卡顿是由于同时渲染大量DOM所引起的，所以考虑将渲染过程分批进行，这里用到的就是 `setTimeout`。\n\n```js\n  let ul = document.getElementById('container');\n  // 插入十万条数据\n  let total = 100000;\n  // 一次插入 20 条\n  let once = 20;\n  //总页数\n  let page = total / once\n  //每条记录的索引\n  let index = 0;\n  //循环加载数据\n  function loop(curTotal, curIndex) {\n    if (curTotal <= 0) {\n      return false;\n    }\n    //每页多少条\n    let pageCount = Math.min(curTotal, once);\n    setTimeout(() => {\n      for (let i = 0; i < pageCount; i++) {\n        let li = document.createElement('li');\n        li.innerText = curIndex + i + ' : ' + ~~(Math.random() * total)\n        ul.appendChild(li)\n      }\n      loop(curTotal - pageCount, curIndex + pageCount)\n    }, 0)\n  }\n  loop(total, index);\n```\n\n![](https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-user-assets/2019/9/10/16d18aa76affbeb0~tplv-t2oaga2asx-zoom-in-crop-mark:4536:0:0:0.image)\n\n页面加载的时间已经非常快了，每次刷新时可以很快的看到第一屏的所有数据，但是当我们快速滚动页面的时候，会发现页面出现闪屏或白屏的现象。\n\n## 为什么会出现闪屏现象呢\n\n首先，理清一些概念。FPS表示的是每秒钟画面更新次数。我们平时所看到的连续画面都是由一幅幅静止画面组成的，每幅画面称为一帧，FPS是描述帧变化速度的物理量。\n\n大多数电脑显示器的刷新频率是60Hz，大概相当于每秒钟重绘60次，FPS为60frame/s，为这个值的设定受屏幕分辨率、屏幕尺寸和显卡的影响。\n\n因此，当你对着电脑屏幕什么也不做的情况下，大多显示器也会以每秒60次的频率正在不断的更新屏幕上的图像。\n\n为什么你感觉不到这个变化？\n\n那是因为人的眼睛有视觉停留效应，即前一副画面留在大脑的印象还没消失，紧接着后一副画面就跟上来了，这中间只间隔了16.7ms(1000/60≈16.7)，所以会让你误以为屏幕上的图像是静止不动的。\n\n而屏幕给你的这种感觉是对的，试想一下，如果刷新频率变成1次/秒，屏幕上的图像就会出现严重的闪烁，\n这样就很容易引起眼睛疲劳、酸痛和头晕目眩等症状。\n\n大多数浏览器都会对重绘操作加以限制，不超过显示器的重绘频率，因为即使超过那个频率用户体验也不会有提升。\n因此，最平滑动画的最佳循环间隔是1000ms/60，约等于16.6ms。\n\n直观感受，不同帧率的体验：\n\n- 帧率能够达到 50 ～ 60 FPS 的动画将会相当流畅，让人倍感舒适；\n- 帧率在 30 ～ 50 FPS 之间的动画，因各人敏感程度不同，舒适度因人而异；\n- 帧率在 30 FPS 以下的动画，让人感觉到明显的卡顿和不适感；\n- 帧率波动很大的动画，亦会使人感觉到卡顿。\n\n## 简单聊一下 setTimeout 和闪屏现象\n\n- setTimeout的执行时间并不是确定的。在JS中，setTimeout任务被放进事件队列中，只有主线程执行完才会去检查事件队列中的任务是否需要执行，因此setTimeout的实际执行时间可能会比其设定的时间晚一些。\n\n- 刷新频率受屏幕分辨率和屏幕尺寸的影响，因此不同设备的刷新频率可能会不同，而setTimeout只能设置一个固定时间间隔，这个时间不一定和屏幕的刷新时间相同。\n\n以上两种情况都会导致setTimeout的执行步调和屏幕的刷新步调不一致。\n\n在setTimeout中对dom进行操作，必须要等到屏幕下次绘制时才能更新到屏幕上，如果两者步调不一致，就可能导致中间某一帧的操作被跨越过去，而直接更新下一帧的元素，从而导致丢帧现象。\n\n# 使用 requestAnimationFrame\n\n与setTimeout相比，requestAnimationFrame最大的优势是由系统来决定回调函数的执行时机。\n\n如果屏幕刷新率是60Hz,那么回调函数就每16.7ms被执行一次，如果刷新率是75Hz，那么这个时间间隔就变成了`1000/75=13.3ms`，换句话说就是，`requestAnimationFrame` 的步伐跟着系统的刷新步伐走。它能保证回调函数在屏幕每一次的刷新间隔中只被执行一次，这样就不会引起丢帧现象。\n\n将 setTimeout 替换成 requestAnimationFrame:\n\n```js\n// 其他 ...\n\nwindow.requestAnimationFrame(function(){\n  for(let i = 0; i < pageCount; i++){\n    let li = document.createElement('li');\n    li.innerText = curIndex + i + ' : ' + ~~(Math.random() * total)\n    ul.appendChild(li)\n  }\n  loop(curTotal - pageCount,curIndex + pageCount)\n})\n\n// ...\n```\n\n![](https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-user-assets/2019/9/10/16d18aa76abe9fe3~tplv-t2oaga2asx-zoom-in-crop-mark:4536:0:0:0.image)\n\n# 使用 DocumentFragment\n\n> DocumentFragment，文档片段接口，表示一个没有父级文件的最小文档对象。它被作为一个轻量版的Document使用，用于存储已排好版的或尚未打理好格式的XML片段。最大的区别是因为DocumentFragment不是真实DOM树的一部分，它的变化不会触发DOM树的（重新渲染) ，且不会导致性能等问题。可以使用document.createDocumentFragment方法或者构造函数来创建一个空的DocumentFragment\n\n从MDN的说明中，我们得知DocumentFragments是DOM节点，但并不是DOM树的一部分，可以认为是存在内存中的，所以将子元素插入到文档片段时不会引起页面回流（什么是回流? 回流是会导致页面重新渲染的一些元素,从而影响性能）。\n\n当append元素到document中时，被append进去的元素的样式表的计算是同步发生的，此时调用 getComputedStyle 可以得到样式的计算值。\n\n而append元素到 documentFragment 中时，是不会计算元素的样式表，所以documentFragment 性能更优。当然现在浏览器的优化已经做的很好了，\n\n当append元素到document中后，没有访问 getComputedStyle 之类的方法时，现代浏览器也可以把样式表的计算推迟到脚本执行之后。\n\n```js\n// 其他 ...\n\nwindow.requestAnimationFrame(function(){\n  const fragment = document.createDocumentFragment()\n  for(let i = 0; i < pageCount; i++){\n    let li = document.createElement('li');\n    li.innerText = curIndex + i + ' : ' + ~~(Math.random() * total)\n    fragment.appendChild(li)\n  }\n  ul.appendChild(fragment)\n  loop(curTotal - pageCount,curIndex + pageCount)\n})\n\n// ...\n```\n\n","source":"_posts/time-fragment.md","raw":"---\nlayout: JavaScript\ntitle: 高性能渲染十万条数据(时间分片)\ndate: 2022-11-23 19:53:52\ntags: JS\nbanner_img: /img/render-10w-data.jpg\nindex_img: /img/render-10w-data.jpg\nexcerpt: 渲染大量数据。\n---\n\n# 最粗暴的做法（一次性渲染\n\nJS的运行时间为`187ms`，还是蛮快的，但是最终渲染完成后的总时间确是`2844ms`，中间会白屏一段时间。\n\n```js\n  // 记录任务开始时间\n  let now = Date.now();\n  // 插入十万条数据\n  const total = 100000;\n  // 获取容器\n  let ul = document.getElementById('container');\n  // 将数据插入容器中\n  for (let i = 0; i < total; i++) {\n    let li = document.createElement('li');\n    li.innerText = i\n    ul.appendChild(li);\n  }\n\n  console.log('JS运行时间：', Date.now() - now);\n  setTimeout(() => {\n    console.log('总运行时间：', Date.now() - now);\n  }, 0)\n```\n\n# 使用定时器\n页面的卡顿是由于同时渲染大量DOM所引起的，所以考虑将渲染过程分批进行，这里用到的就是 `setTimeout`。\n\n```js\n  let ul = document.getElementById('container');\n  // 插入十万条数据\n  let total = 100000;\n  // 一次插入 20 条\n  let once = 20;\n  //总页数\n  let page = total / once\n  //每条记录的索引\n  let index = 0;\n  //循环加载数据\n  function loop(curTotal, curIndex) {\n    if (curTotal <= 0) {\n      return false;\n    }\n    //每页多少条\n    let pageCount = Math.min(curTotal, once);\n    setTimeout(() => {\n      for (let i = 0; i < pageCount; i++) {\n        let li = document.createElement('li');\n        li.innerText = curIndex + i + ' : ' + ~~(Math.random() * total)\n        ul.appendChild(li)\n      }\n      loop(curTotal - pageCount, curIndex + pageCount)\n    }, 0)\n  }\n  loop(total, index);\n```\n\n![](https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-user-assets/2019/9/10/16d18aa76affbeb0~tplv-t2oaga2asx-zoom-in-crop-mark:4536:0:0:0.image)\n\n页面加载的时间已经非常快了，每次刷新时可以很快的看到第一屏的所有数据，但是当我们快速滚动页面的时候，会发现页面出现闪屏或白屏的现象。\n\n## 为什么会出现闪屏现象呢\n\n首先，理清一些概念。FPS表示的是每秒钟画面更新次数。我们平时所看到的连续画面都是由一幅幅静止画面组成的，每幅画面称为一帧，FPS是描述帧变化速度的物理量。\n\n大多数电脑显示器的刷新频率是60Hz，大概相当于每秒钟重绘60次，FPS为60frame/s，为这个值的设定受屏幕分辨率、屏幕尺寸和显卡的影响。\n\n因此，当你对着电脑屏幕什么也不做的情况下，大多显示器也会以每秒60次的频率正在不断的更新屏幕上的图像。\n\n为什么你感觉不到这个变化？\n\n那是因为人的眼睛有视觉停留效应，即前一副画面留在大脑的印象还没消失，紧接着后一副画面就跟上来了，这中间只间隔了16.7ms(1000/60≈16.7)，所以会让你误以为屏幕上的图像是静止不动的。\n\n而屏幕给你的这种感觉是对的，试想一下，如果刷新频率变成1次/秒，屏幕上的图像就会出现严重的闪烁，\n这样就很容易引起眼睛疲劳、酸痛和头晕目眩等症状。\n\n大多数浏览器都会对重绘操作加以限制，不超过显示器的重绘频率，因为即使超过那个频率用户体验也不会有提升。\n因此，最平滑动画的最佳循环间隔是1000ms/60，约等于16.6ms。\n\n直观感受，不同帧率的体验：\n\n- 帧率能够达到 50 ～ 60 FPS 的动画将会相当流畅，让人倍感舒适；\n- 帧率在 30 ～ 50 FPS 之间的动画，因各人敏感程度不同，舒适度因人而异；\n- 帧率在 30 FPS 以下的动画，让人感觉到明显的卡顿和不适感；\n- 帧率波动很大的动画，亦会使人感觉到卡顿。\n\n## 简单聊一下 setTimeout 和闪屏现象\n\n- setTimeout的执行时间并不是确定的。在JS中，setTimeout任务被放进事件队列中，只有主线程执行完才会去检查事件队列中的任务是否需要执行，因此setTimeout的实际执行时间可能会比其设定的时间晚一些。\n\n- 刷新频率受屏幕分辨率和屏幕尺寸的影响，因此不同设备的刷新频率可能会不同，而setTimeout只能设置一个固定时间间隔，这个时间不一定和屏幕的刷新时间相同。\n\n以上两种情况都会导致setTimeout的执行步调和屏幕的刷新步调不一致。\n\n在setTimeout中对dom进行操作，必须要等到屏幕下次绘制时才能更新到屏幕上，如果两者步调不一致，就可能导致中间某一帧的操作被跨越过去，而直接更新下一帧的元素，从而导致丢帧现象。\n\n# 使用 requestAnimationFrame\n\n与setTimeout相比，requestAnimationFrame最大的优势是由系统来决定回调函数的执行时机。\n\n如果屏幕刷新率是60Hz,那么回调函数就每16.7ms被执行一次，如果刷新率是75Hz，那么这个时间间隔就变成了`1000/75=13.3ms`，换句话说就是，`requestAnimationFrame` 的步伐跟着系统的刷新步伐走。它能保证回调函数在屏幕每一次的刷新间隔中只被执行一次，这样就不会引起丢帧现象。\n\n将 setTimeout 替换成 requestAnimationFrame:\n\n```js\n// 其他 ...\n\nwindow.requestAnimationFrame(function(){\n  for(let i = 0; i < pageCount; i++){\n    let li = document.createElement('li');\n    li.innerText = curIndex + i + ' : ' + ~~(Math.random() * total)\n    ul.appendChild(li)\n  }\n  loop(curTotal - pageCount,curIndex + pageCount)\n})\n\n// ...\n```\n\n![](https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-user-assets/2019/9/10/16d18aa76abe9fe3~tplv-t2oaga2asx-zoom-in-crop-mark:4536:0:0:0.image)\n\n# 使用 DocumentFragment\n\n> DocumentFragment，文档片段接口，表示一个没有父级文件的最小文档对象。它被作为一个轻量版的Document使用，用于存储已排好版的或尚未打理好格式的XML片段。最大的区别是因为DocumentFragment不是真实DOM树的一部分，它的变化不会触发DOM树的（重新渲染) ，且不会导致性能等问题。可以使用document.createDocumentFragment方法或者构造函数来创建一个空的DocumentFragment\n\n从MDN的说明中，我们得知DocumentFragments是DOM节点，但并不是DOM树的一部分，可以认为是存在内存中的，所以将子元素插入到文档片段时不会引起页面回流（什么是回流? 回流是会导致页面重新渲染的一些元素,从而影响性能）。\n\n当append元素到document中时，被append进去的元素的样式表的计算是同步发生的，此时调用 getComputedStyle 可以得到样式的计算值。\n\n而append元素到 documentFragment 中时，是不会计算元素的样式表，所以documentFragment 性能更优。当然现在浏览器的优化已经做的很好了，\n\n当append元素到document中后，没有访问 getComputedStyle 之类的方法时，现代浏览器也可以把样式表的计算推迟到脚本执行之后。\n\n```js\n// 其他 ...\n\nwindow.requestAnimationFrame(function(){\n  const fragment = document.createDocumentFragment()\n  for(let i = 0; i < pageCount; i++){\n    let li = document.createElement('li');\n    li.innerText = curIndex + i + ' : ' + ~~(Math.random() * total)\n    fragment.appendChild(li)\n  }\n  ul.appendChild(fragment)\n  loop(curTotal - pageCount,curIndex + pageCount)\n})\n\n// ...\n```\n\n","slug":"time-fragment","published":1,"updated":"2023-05-12T10:49:20.014Z","comments":1,"photos":[],"link":"","_id":"clhkizgxk000o3y0qase5ho29","content":"<h1 id=\"最粗暴的做法（一次性渲染\"><a href=\"#最粗暴的做法（一次性渲染\" class=\"headerlink\" title=\"最粗暴的做法（一次性渲染\"></a>最粗暴的做法（一次性渲染</h1><p>JS的运行时间为<code>187ms</code>，还是蛮快的，但是最终渲染完成后的总时间确是<code>2844ms</code>，中间会白屏一段时间。</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><div class=\"code-wrapper\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br></pre></div></td><td class=\"code\"><pre><code class=\"hljs js\"><span class=\"hljs-comment\">// 记录任务开始时间</span><br><span class=\"hljs-keyword\">let</span> now = <span class=\"hljs-title class_\">Date</span>.<span class=\"hljs-title function_\">now</span>();<br><span class=\"hljs-comment\">// 插入十万条数据</span><br><span class=\"hljs-keyword\">const</span> total = <span class=\"hljs-number\">100000</span>;<br><span class=\"hljs-comment\">// 获取容器</span><br><span class=\"hljs-keyword\">let</span> ul = <span class=\"hljs-variable language_\">document</span>.<span class=\"hljs-title function_\">getElementById</span>(<span class=\"hljs-string\">&#x27;container&#x27;</span>);<br><span class=\"hljs-comment\">// 将数据插入容器中</span><br><span class=\"hljs-keyword\">for</span> (<span class=\"hljs-keyword\">let</span> i = <span class=\"hljs-number\">0</span>; i &lt; total; i++) &#123;<br>  <span class=\"hljs-keyword\">let</span> li = <span class=\"hljs-variable language_\">document</span>.<span class=\"hljs-title function_\">createElement</span>(<span class=\"hljs-string\">&#x27;li&#x27;</span>);<br>  li.<span class=\"hljs-property\">innerText</span> = i<br>  ul.<span class=\"hljs-title function_\">appendChild</span>(li);<br>&#125;<br><br><span class=\"hljs-variable language_\">console</span>.<span class=\"hljs-title function_\">log</span>(<span class=\"hljs-string\">&#x27;JS运行时间：&#x27;</span>, <span class=\"hljs-title class_\">Date</span>.<span class=\"hljs-title function_\">now</span>() - now);<br><span class=\"hljs-built_in\">setTimeout</span>(<span class=\"hljs-function\">() =&gt;</span> &#123;<br>  <span class=\"hljs-variable language_\">console</span>.<span class=\"hljs-title function_\">log</span>(<span class=\"hljs-string\">&#x27;总运行时间：&#x27;</span>, <span class=\"hljs-title class_\">Date</span>.<span class=\"hljs-title function_\">now</span>() - now);<br>&#125;, <span class=\"hljs-number\">0</span>)<br></code></pre></td></tr></table></figure>\n\n<h1 id=\"使用定时器\"><a href=\"#使用定时器\" class=\"headerlink\" title=\"使用定时器\"></a>使用定时器</h1><p>页面的卡顿是由于同时渲染大量DOM所引起的，所以考虑将渲染过程分批进行，这里用到的就是 <code>setTimeout</code>。</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\"><span class=\"hljs-keyword\">let</span> ul = <span class=\"hljs-variable language_\">document</span>.<span class=\"hljs-title function_\">getElementById</span>(<span class=\"hljs-string\">&#x27;container&#x27;</span>);<br><span class=\"hljs-comment\">// 插入十万条数据</span><br><span class=\"hljs-keyword\">let</span> total = <span class=\"hljs-number\">100000</span>;<br><span class=\"hljs-comment\">// 一次插入 20 条</span><br><span class=\"hljs-keyword\">let</span> once = <span class=\"hljs-number\">20</span>;<br><span class=\"hljs-comment\">//总页数</span><br><span class=\"hljs-keyword\">let</span> page = total / once<br><span class=\"hljs-comment\">//每条记录的索引</span><br><span class=\"hljs-keyword\">let</span> index = <span class=\"hljs-number\">0</span>;<br><span class=\"hljs-comment\">//循环加载数据</span><br><span class=\"hljs-keyword\">function</span> <span class=\"hljs-title function_\">loop</span>(<span class=\"hljs-params\">curTotal, curIndex</span>) &#123;<br>  <span class=\"hljs-keyword\">if</span> (curTotal &lt;= <span class=\"hljs-number\">0</span>) &#123;<br>    <span class=\"hljs-keyword\">return</span> <span class=\"hljs-literal\">false</span>;<br>  &#125;<br>  <span class=\"hljs-comment\">//每页多少条</span><br>  <span class=\"hljs-keyword\">let</span> pageCount = <span class=\"hljs-title class_\">Math</span>.<span class=\"hljs-title function_\">min</span>(curTotal, once);<br>  <span class=\"hljs-built_in\">setTimeout</span>(<span class=\"hljs-function\">() =&gt;</span> &#123;<br>    <span class=\"hljs-keyword\">for</span> (<span class=\"hljs-keyword\">let</span> i = <span class=\"hljs-number\">0</span>; i &lt; pageCount; i++) &#123;<br>      <span class=\"hljs-keyword\">let</span> li = <span class=\"hljs-variable language_\">document</span>.<span class=\"hljs-title function_\">createElement</span>(<span class=\"hljs-string\">&#x27;li&#x27;</span>);<br>      li.<span class=\"hljs-property\">innerText</span> = curIndex + i + <span class=\"hljs-string\">&#x27; : &#x27;</span> + ~~(<span class=\"hljs-title class_\">Math</span>.<span class=\"hljs-title function_\">random</span>() * total)<br>      ul.<span class=\"hljs-title function_\">appendChild</span>(li)<br>    &#125;<br>    <span class=\"hljs-title function_\">loop</span>(curTotal - pageCount, curIndex + pageCount)<br>  &#125;, <span class=\"hljs-number\">0</span>)<br>&#125;<br><span class=\"hljs-title function_\">loop</span>(total, index);<br></code></pre></td></tr></table></figure>\n\n<p><img src=\"https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-user-assets/2019/9/10/16d18aa76affbeb0~tplv-t2oaga2asx-zoom-in-crop-mark:4536:0:0:0.image\" alt=\"\"></p>\n<p>页面加载的时间已经非常快了，每次刷新时可以很快的看到第一屏的所有数据，但是当我们快速滚动页面的时候，会发现页面出现闪屏或白屏的现象。</p>\n<h2 id=\"为什么会出现闪屏现象呢\"><a href=\"#为什么会出现闪屏现象呢\" class=\"headerlink\" title=\"为什么会出现闪屏现象呢\"></a>为什么会出现闪屏现象呢</h2><p>首先，理清一些概念。FPS表示的是每秒钟画面更新次数。我们平时所看到的连续画面都是由一幅幅静止画面组成的，每幅画面称为一帧，FPS是描述帧变化速度的物理量。</p>\n<p>大多数电脑显示器的刷新频率是60Hz，大概相当于每秒钟重绘60次，FPS为60frame/s，为这个值的设定受屏幕分辨率、屏幕尺寸和显卡的影响。</p>\n<p>因此，当你对着电脑屏幕什么也不做的情况下，大多显示器也会以每秒60次的频率正在不断的更新屏幕上的图像。</p>\n<p>为什么你感觉不到这个变化？</p>\n<p>那是因为人的眼睛有视觉停留效应，即前一副画面留在大脑的印象还没消失，紧接着后一副画面就跟上来了，这中间只间隔了16.7ms(1000/60≈16.7)，所以会让你误以为屏幕上的图像是静止不动的。</p>\n<p>而屏幕给你的这种感觉是对的，试想一下，如果刷新频率变成1次/秒，屏幕上的图像就会出现严重的闪烁，<br>这样就很容易引起眼睛疲劳、酸痛和头晕目眩等症状。</p>\n<p>大多数浏览器都会对重绘操作加以限制，不超过显示器的重绘频率，因为即使超过那个频率用户体验也不会有提升。<br>因此，最平滑动画的最佳循环间隔是1000ms/60，约等于16.6ms。</p>\n<p>直观感受，不同帧率的体验：</p>\n<ul>\n<li>帧率能够达到 50 ～ 60 FPS 的动画将会相当流畅，让人倍感舒适；</li>\n<li>帧率在 30 ～ 50 FPS 之间的动画，因各人敏感程度不同，舒适度因人而异；</li>\n<li>帧率在 30 FPS 以下的动画，让人感觉到明显的卡顿和不适感；</li>\n<li>帧率波动很大的动画，亦会使人感觉到卡顿。</li>\n</ul>\n<h2 id=\"简单聊一下-setTimeout-和闪屏现象\"><a href=\"#简单聊一下-setTimeout-和闪屏现象\" class=\"headerlink\" title=\"简单聊一下 setTimeout 和闪屏现象\"></a>简单聊一下 setTimeout 和闪屏现象</h2><ul>\n<li><p>setTimeout的执行时间并不是确定的。在JS中，setTimeout任务被放进事件队列中，只有主线程执行完才会去检查事件队列中的任务是否需要执行，因此setTimeout的实际执行时间可能会比其设定的时间晚一些。</p>\n</li>\n<li><p>刷新频率受屏幕分辨率和屏幕尺寸的影响，因此不同设备的刷新频率可能会不同，而setTimeout只能设置一个固定时间间隔，这个时间不一定和屏幕的刷新时间相同。</p>\n</li>\n</ul>\n<p>以上两种情况都会导致setTimeout的执行步调和屏幕的刷新步调不一致。</p>\n<p>在setTimeout中对dom进行操作，必须要等到屏幕下次绘制时才能更新到屏幕上，如果两者步调不一致，就可能导致中间某一帧的操作被跨越过去，而直接更新下一帧的元素，从而导致丢帧现象。</p>\n<h1 id=\"使用-requestAnimationFrame\"><a href=\"#使用-requestAnimationFrame\" class=\"headerlink\" title=\"使用 requestAnimationFrame\"></a>使用 requestAnimationFrame</h1><p>与setTimeout相比，requestAnimationFrame最大的优势是由系统来决定回调函数的执行时机。</p>\n<p>如果屏幕刷新率是60Hz,那么回调函数就每16.7ms被执行一次，如果刷新率是75Hz，那么这个时间间隔就变成了<code>1000/75=13.3ms</code>，换句话说就是，<code>requestAnimationFrame</code> 的步伐跟着系统的刷新步伐走。它能保证回调函数在屏幕每一次的刷新间隔中只被执行一次，这样就不会引起丢帧现象。</p>\n<p>将 setTimeout 替换成 requestAnimationFrame:</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\"><span class=\"hljs-comment\">// 其他 ...</span><br><br><span class=\"hljs-variable language_\">window</span>.<span class=\"hljs-title function_\">requestAnimationFrame</span>(<span class=\"hljs-keyword\">function</span>(<span class=\"hljs-params\"></span>)&#123;<br>  <span class=\"hljs-keyword\">for</span>(<span class=\"hljs-keyword\">let</span> i = <span class=\"hljs-number\">0</span>; i &lt; pageCount; i++)&#123;<br>    <span class=\"hljs-keyword\">let</span> li = <span class=\"hljs-variable language_\">document</span>.<span class=\"hljs-title function_\">createElement</span>(<span class=\"hljs-string\">&#x27;li&#x27;</span>);<br>    li.<span class=\"hljs-property\">innerText</span> = curIndex + i + <span class=\"hljs-string\">&#x27; : &#x27;</span> + ~~(<span class=\"hljs-title class_\">Math</span>.<span class=\"hljs-title function_\">random</span>() * total)<br>    ul.<span class=\"hljs-title function_\">appendChild</span>(li)<br>  &#125;<br>  <span class=\"hljs-title function_\">loop</span>(curTotal - pageCount,curIndex + pageCount)<br>&#125;)<br><br><span class=\"hljs-comment\">// ...</span><br></code></pre></td></tr></table></figure>\n\n<p><img src=\"https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-user-assets/2019/9/10/16d18aa76abe9fe3~tplv-t2oaga2asx-zoom-in-crop-mark:4536:0:0:0.image\" alt=\"\"></p>\n<h1 id=\"使用-DocumentFragment\"><a href=\"#使用-DocumentFragment\" class=\"headerlink\" title=\"使用 DocumentFragment\"></a>使用 DocumentFragment</h1><blockquote>\n<p>DocumentFragment，文档片段接口，表示一个没有父级文件的最小文档对象。它被作为一个轻量版的Document使用，用于存储已排好版的或尚未打理好格式的XML片段。最大的区别是因为DocumentFragment不是真实DOM树的一部分，它的变化不会触发DOM树的（重新渲染) ，且不会导致性能等问题。可以使用document.createDocumentFragment方法或者构造函数来创建一个空的DocumentFragment</p>\n</blockquote>\n<p>从MDN的说明中，我们得知DocumentFragments是DOM节点，但并不是DOM树的一部分，可以认为是存在内存中的，所以将子元素插入到文档片段时不会引起页面回流（什么是回流? 回流是会导致页面重新渲染的一些元素,从而影响性能）。</p>\n<p>当append元素到document中时，被append进去的元素的样式表的计算是同步发生的，此时调用 getComputedStyle 可以得到样式的计算值。</p>\n<p>而append元素到 documentFragment 中时，是不会计算元素的样式表，所以documentFragment 性能更优。当然现在浏览器的优化已经做的很好了，</p>\n<p>当append元素到document中后，没有访问 getComputedStyle 之类的方法时，现代浏览器也可以把样式表的计算推迟到脚本执行之后。</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\"><span class=\"hljs-comment\">// 其他 ...</span><br><br><span class=\"hljs-variable language_\">window</span>.<span class=\"hljs-title function_\">requestAnimationFrame</span>(<span class=\"hljs-keyword\">function</span>(<span class=\"hljs-params\"></span>)&#123;<br>  <span class=\"hljs-keyword\">const</span> fragment = <span class=\"hljs-variable language_\">document</span>.<span class=\"hljs-title function_\">createDocumentFragment</span>()<br>  <span class=\"hljs-keyword\">for</span>(<span class=\"hljs-keyword\">let</span> i = <span class=\"hljs-number\">0</span>; i &lt; pageCount; i++)&#123;<br>    <span class=\"hljs-keyword\">let</span> li = <span class=\"hljs-variable language_\">document</span>.<span class=\"hljs-title function_\">createElement</span>(<span class=\"hljs-string\">&#x27;li&#x27;</span>);<br>    li.<span class=\"hljs-property\">innerText</span> = curIndex + i + <span class=\"hljs-string\">&#x27; : &#x27;</span> + ~~(<span class=\"hljs-title class_\">Math</span>.<span class=\"hljs-title function_\">random</span>() * total)<br>    fragment.<span class=\"hljs-title function_\">appendChild</span>(li)<br>  &#125;<br>  ul.<span class=\"hljs-title function_\">appendChild</span>(fragment)<br>  <span class=\"hljs-title function_\">loop</span>(curTotal - pageCount,curIndex + pageCount)<br>&#125;)<br><br><span class=\"hljs-comment\">// ...</span><br></code></pre></td></tr></table></figure>\n\n","site":{"data":{}},"wordcount":3622,"more":"<h1 id=\"最粗暴的做法（一次性渲染\"><a href=\"#最粗暴的做法（一次性渲染\" class=\"headerlink\" title=\"最粗暴的做法（一次性渲染\"></a>最粗暴的做法（一次性渲染</h1><p>JS的运行时间为<code>187ms</code>，还是蛮快的，但是最终渲染完成后的总时间确是<code>2844ms</code>，中间会白屏一段时间。</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\"><span class=\"hljs-comment\">// 记录任务开始时间</span><br><span class=\"hljs-keyword\">let</span> now = <span class=\"hljs-title class_\">Date</span>.<span class=\"hljs-title function_\">now</span>();<br><span class=\"hljs-comment\">// 插入十万条数据</span><br><span class=\"hljs-keyword\">const</span> total = <span class=\"hljs-number\">100000</span>;<br><span class=\"hljs-comment\">// 获取容器</span><br><span class=\"hljs-keyword\">let</span> ul = <span class=\"hljs-variable language_\">document</span>.<span class=\"hljs-title function_\">getElementById</span>(<span class=\"hljs-string\">&#x27;container&#x27;</span>);<br><span class=\"hljs-comment\">// 将数据插入容器中</span><br><span class=\"hljs-keyword\">for</span> (<span class=\"hljs-keyword\">let</span> i = <span class=\"hljs-number\">0</span>; i &lt; total; i++) &#123;<br>  <span class=\"hljs-keyword\">let</span> li = <span class=\"hljs-variable language_\">document</span>.<span class=\"hljs-title function_\">createElement</span>(<span class=\"hljs-string\">&#x27;li&#x27;</span>);<br>  li.<span class=\"hljs-property\">innerText</span> = i<br>  ul.<span class=\"hljs-title function_\">appendChild</span>(li);<br>&#125;<br><br><span class=\"hljs-variable language_\">console</span>.<span class=\"hljs-title function_\">log</span>(<span class=\"hljs-string\">&#x27;JS运行时间：&#x27;</span>, <span class=\"hljs-title class_\">Date</span>.<span class=\"hljs-title function_\">now</span>() - now);<br><span class=\"hljs-built_in\">setTimeout</span>(<span class=\"hljs-function\">() =&gt;</span> &#123;<br>  <span class=\"hljs-variable language_\">console</span>.<span class=\"hljs-title function_\">log</span>(<span class=\"hljs-string\">&#x27;总运行时间：&#x27;</span>, <span class=\"hljs-title class_\">Date</span>.<span class=\"hljs-title function_\">now</span>() - now);<br>&#125;, <span class=\"hljs-number\">0</span>)<br></code></pre></td></tr></table></figure>\n\n<h1 id=\"使用定时器\"><a href=\"#使用定时器\" class=\"headerlink\" title=\"使用定时器\"></a>使用定时器</h1><p>页面的卡顿是由于同时渲染大量DOM所引起的，所以考虑将渲染过程分批进行，这里用到的就是 <code>setTimeout</code>。</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\"><span class=\"hljs-keyword\">let</span> ul = <span class=\"hljs-variable language_\">document</span>.<span class=\"hljs-title function_\">getElementById</span>(<span class=\"hljs-string\">&#x27;container&#x27;</span>);<br><span class=\"hljs-comment\">// 插入十万条数据</span><br><span class=\"hljs-keyword\">let</span> total = <span class=\"hljs-number\">100000</span>;<br><span class=\"hljs-comment\">// 一次插入 20 条</span><br><span class=\"hljs-keyword\">let</span> once = <span class=\"hljs-number\">20</span>;<br><span class=\"hljs-comment\">//总页数</span><br><span class=\"hljs-keyword\">let</span> page = total / once<br><span class=\"hljs-comment\">//每条记录的索引</span><br><span class=\"hljs-keyword\">let</span> index = <span class=\"hljs-number\">0</span>;<br><span class=\"hljs-comment\">//循环加载数据</span><br><span class=\"hljs-keyword\">function</span> <span class=\"hljs-title function_\">loop</span>(<span class=\"hljs-params\">curTotal, curIndex</span>) &#123;<br>  <span class=\"hljs-keyword\">if</span> (curTotal &lt;= <span class=\"hljs-number\">0</span>) &#123;<br>    <span class=\"hljs-keyword\">return</span> <span class=\"hljs-literal\">false</span>;<br>  &#125;<br>  <span class=\"hljs-comment\">//每页多少条</span><br>  <span class=\"hljs-keyword\">let</span> pageCount = <span class=\"hljs-title class_\">Math</span>.<span class=\"hljs-title function_\">min</span>(curTotal, once);<br>  <span class=\"hljs-built_in\">setTimeout</span>(<span class=\"hljs-function\">() =&gt;</span> &#123;<br>    <span class=\"hljs-keyword\">for</span> (<span class=\"hljs-keyword\">let</span> i = <span class=\"hljs-number\">0</span>; i &lt; pageCount; i++) &#123;<br>      <span class=\"hljs-keyword\">let</span> li = <span class=\"hljs-variable language_\">document</span>.<span class=\"hljs-title function_\">createElement</span>(<span class=\"hljs-string\">&#x27;li&#x27;</span>);<br>      li.<span class=\"hljs-property\">innerText</span> = curIndex + i + <span class=\"hljs-string\">&#x27; : &#x27;</span> + ~~(<span class=\"hljs-title class_\">Math</span>.<span class=\"hljs-title function_\">random</span>() * total)<br>      ul.<span class=\"hljs-title function_\">appendChild</span>(li)<br>    &#125;<br>    <span class=\"hljs-title function_\">loop</span>(curTotal - pageCount, curIndex + pageCount)<br>  &#125;, <span class=\"hljs-number\">0</span>)<br>&#125;<br><span class=\"hljs-title function_\">loop</span>(total, index);<br></code></pre></td></tr></table></figure>\n\n<p><img src=\"https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-user-assets/2019/9/10/16d18aa76affbeb0~tplv-t2oaga2asx-zoom-in-crop-mark:4536:0:0:0.image\" alt=\"\"></p>\n<p>页面加载的时间已经非常快了，每次刷新时可以很快的看到第一屏的所有数据，但是当我们快速滚动页面的时候，会发现页面出现闪屏或白屏的现象。</p>\n<h2 id=\"为什么会出现闪屏现象呢\"><a href=\"#为什么会出现闪屏现象呢\" class=\"headerlink\" title=\"为什么会出现闪屏现象呢\"></a>为什么会出现闪屏现象呢</h2><p>首先，理清一些概念。FPS表示的是每秒钟画面更新次数。我们平时所看到的连续画面都是由一幅幅静止画面组成的，每幅画面称为一帧，FPS是描述帧变化速度的物理量。</p>\n<p>大多数电脑显示器的刷新频率是60Hz，大概相当于每秒钟重绘60次，FPS为60frame/s，为这个值的设定受屏幕分辨率、屏幕尺寸和显卡的影响。</p>\n<p>因此，当你对着电脑屏幕什么也不做的情况下，大多显示器也会以每秒60次的频率正在不断的更新屏幕上的图像。</p>\n<p>为什么你感觉不到这个变化？</p>\n<p>那是因为人的眼睛有视觉停留效应，即前一副画面留在大脑的印象还没消失，紧接着后一副画面就跟上来了，这中间只间隔了16.7ms(1000/60≈16.7)，所以会让你误以为屏幕上的图像是静止不动的。</p>\n<p>而屏幕给你的这种感觉是对的，试想一下，如果刷新频率变成1次/秒，屏幕上的图像就会出现严重的闪烁，<br>这样就很容易引起眼睛疲劳、酸痛和头晕目眩等症状。</p>\n<p>大多数浏览器都会对重绘操作加以限制，不超过显示器的重绘频率，因为即使超过那个频率用户体验也不会有提升。<br>因此，最平滑动画的最佳循环间隔是1000ms/60，约等于16.6ms。</p>\n<p>直观感受，不同帧率的体验：</p>\n<ul>\n<li>帧率能够达到 50 ～ 60 FPS 的动画将会相当流畅，让人倍感舒适；</li>\n<li>帧率在 30 ～ 50 FPS 之间的动画，因各人敏感程度不同，舒适度因人而异；</li>\n<li>帧率在 30 FPS 以下的动画，让人感觉到明显的卡顿和不适感；</li>\n<li>帧率波动很大的动画，亦会使人感觉到卡顿。</li>\n</ul>\n<h2 id=\"简单聊一下-setTimeout-和闪屏现象\"><a href=\"#简单聊一下-setTimeout-和闪屏现象\" class=\"headerlink\" title=\"简单聊一下 setTimeout 和闪屏现象\"></a>简单聊一下 setTimeout 和闪屏现象</h2><ul>\n<li><p>setTimeout的执行时间并不是确定的。在JS中，setTimeout任务被放进事件队列中，只有主线程执行完才会去检查事件队列中的任务是否需要执行，因此setTimeout的实际执行时间可能会比其设定的时间晚一些。</p>\n</li>\n<li><p>刷新频率受屏幕分辨率和屏幕尺寸的影响，因此不同设备的刷新频率可能会不同，而setTimeout只能设置一个固定时间间隔，这个时间不一定和屏幕的刷新时间相同。</p>\n</li>\n</ul>\n<p>以上两种情况都会导致setTimeout的执行步调和屏幕的刷新步调不一致。</p>\n<p>在setTimeout中对dom进行操作，必须要等到屏幕下次绘制时才能更新到屏幕上，如果两者步调不一致，就可能导致中间某一帧的操作被跨越过去，而直接更新下一帧的元素，从而导致丢帧现象。</p>\n<h1 id=\"使用-requestAnimationFrame\"><a href=\"#使用-requestAnimationFrame\" class=\"headerlink\" title=\"使用 requestAnimationFrame\"></a>使用 requestAnimationFrame</h1><p>与setTimeout相比，requestAnimationFrame最大的优势是由系统来决定回调函数的执行时机。</p>\n<p>如果屏幕刷新率是60Hz,那么回调函数就每16.7ms被执行一次，如果刷新率是75Hz，那么这个时间间隔就变成了<code>1000/75=13.3ms</code>，换句话说就是，<code>requestAnimationFrame</code> 的步伐跟着系统的刷新步伐走。它能保证回调函数在屏幕每一次的刷新间隔中只被执行一次，这样就不会引起丢帧现象。</p>\n<p>将 setTimeout 替换成 requestAnimationFrame:</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\"><span class=\"hljs-comment\">// 其他 ...</span><br><br><span class=\"hljs-variable language_\">window</span>.<span class=\"hljs-title function_\">requestAnimationFrame</span>(<span class=\"hljs-keyword\">function</span>(<span class=\"hljs-params\"></span>)&#123;<br>  <span class=\"hljs-keyword\">for</span>(<span class=\"hljs-keyword\">let</span> i = <span class=\"hljs-number\">0</span>; i &lt; pageCount; i++)&#123;<br>    <span class=\"hljs-keyword\">let</span> li = <span class=\"hljs-variable language_\">document</span>.<span class=\"hljs-title function_\">createElement</span>(<span class=\"hljs-string\">&#x27;li&#x27;</span>);<br>    li.<span class=\"hljs-property\">innerText</span> = curIndex + i + <span class=\"hljs-string\">&#x27; : &#x27;</span> + ~~(<span class=\"hljs-title class_\">Math</span>.<span class=\"hljs-title function_\">random</span>() * total)<br>    ul.<span class=\"hljs-title function_\">appendChild</span>(li)<br>  &#125;<br>  <span class=\"hljs-title function_\">loop</span>(curTotal - pageCount,curIndex + pageCount)<br>&#125;)<br><br><span class=\"hljs-comment\">// ...</span><br></code></pre></td></tr></table></figure>\n\n<p><img src=\"https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-user-assets/2019/9/10/16d18aa76abe9fe3~tplv-t2oaga2asx-zoom-in-crop-mark:4536:0:0:0.image\" alt=\"\"></p>\n<h1 id=\"使用-DocumentFragment\"><a href=\"#使用-DocumentFragment\" class=\"headerlink\" title=\"使用 DocumentFragment\"></a>使用 DocumentFragment</h1><blockquote>\n<p>DocumentFragment，文档片段接口，表示一个没有父级文件的最小文档对象。它被作为一个轻量版的Document使用，用于存储已排好版的或尚未打理好格式的XML片段。最大的区别是因为DocumentFragment不是真实DOM树的一部分，它的变化不会触发DOM树的（重新渲染) ，且不会导致性能等问题。可以使用document.createDocumentFragment方法或者构造函数来创建一个空的DocumentFragment</p>\n</blockquote>\n<p>从MDN的说明中，我们得知DocumentFragments是DOM节点，但并不是DOM树的一部分，可以认为是存在内存中的，所以将子元素插入到文档片段时不会引起页面回流（什么是回流? 回流是会导致页面重新渲染的一些元素,从而影响性能）。</p>\n<p>当append元素到document中时，被append进去的元素的样式表的计算是同步发生的，此时调用 getComputedStyle 可以得到样式的计算值。</p>\n<p>而append元素到 documentFragment 中时，是不会计算元素的样式表，所以documentFragment 性能更优。当然现在浏览器的优化已经做的很好了，</p>\n<p>当append元素到document中后，没有访问 getComputedStyle 之类的方法时，现代浏览器也可以把样式表的计算推迟到脚本执行之后。</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\"><span class=\"hljs-comment\">// 其他 ...</span><br><br><span class=\"hljs-variable language_\">window</span>.<span class=\"hljs-title function_\">requestAnimationFrame</span>(<span class=\"hljs-keyword\">function</span>(<span class=\"hljs-params\"></span>)&#123;<br>  <span class=\"hljs-keyword\">const</span> fragment = <span class=\"hljs-variable language_\">document</span>.<span class=\"hljs-title function_\">createDocumentFragment</span>()<br>  <span class=\"hljs-keyword\">for</span>(<span class=\"hljs-keyword\">let</span> i = <span class=\"hljs-number\">0</span>; i &lt; pageCount; i++)&#123;<br>    <span class=\"hljs-keyword\">let</span> li = <span class=\"hljs-variable language_\">document</span>.<span class=\"hljs-title function_\">createElement</span>(<span class=\"hljs-string\">&#x27;li&#x27;</span>);<br>    li.<span class=\"hljs-property\">innerText</span> = curIndex + i + <span class=\"hljs-string\">&#x27; : &#x27;</span> + ~~(<span class=\"hljs-title class_\">Math</span>.<span class=\"hljs-title function_\">random</span>() * total)<br>    fragment.<span class=\"hljs-title function_\">appendChild</span>(li)<br>  &#125;<br>  ul.<span class=\"hljs-title function_\">appendChild</span>(fragment)<br>  <span class=\"hljs-title function_\">loop</span>(curTotal - pageCount,curIndex + pageCount)<br>&#125;)<br><br><span class=\"hljs-comment\">// ...</span><br></code></pre></td></tr></table></figure>\n\n"},{"title":"在Linux上部署 Node 接口","date":"2022-12-16T06:00:00.000Z","banner_img":"/img/nodejs.png","index_img":"/img/nodejs.png","excerpt":"Never too old to learn.","_content":"\n# 连接远程服务器\n\n打开 mac 终端:\n\n```js\nssh root@124.221.230.105 (公网IP)\n\n// 接着输入密码，即可登录远程服务器\n```\n\n登录进去，输入 pwd，会输出 `/root`，这时我们切到 '/' 目录下: `cd ..`\n\n# 在远程安装 nodejs\n\n```js\nwget https://cdn.npmmirror.com/binaries/node/v14.19.1/node-v14.19.1-linux-x64.tar.xz\n```\n\n# 解压压缩包\n\n使用 tar 命令\n\n- -c 压缩\n- -x 解压\n- -t 查看内容\n- -r 想压缩归档文件末尾追加文件\n- -v 显示所有过程\n- -f 使用档案名字，切记，这是最后一个参数，最后只能接档案名\n\n```js\ntar -xvf node-v14.19.1-linux-x64.tar.xz\n```\n\n# 配置环境变量\n\n找到根目录 '/' 下的 etc文件夹，进去里面，打开 profile 文件，打开，执行命令：\n\n```js\n// '/'\n\ncd etc\n\nvim profile\n```\n\n在最后一行加上如下这句：\n```js\nexport PATH=$PATH:/node-v14.19.1-linux-x64/bin\n```\n\n最后，使文件生效\n\n```js\n// /etc\nsource profile\n```\n\n查看 node 版本\n```\nnode -v\n\nnpm -v\n```\n\n# 安装 pm2\n\n```\nnpm install -g pm2\n```\n\n# 部署 node 接口\n\n在根目录下 `/`，创建 `node-server` 文件夹\n\n可以通过 express 建立一个 node 服务\n\n```js\nconst express = require(\"express\");\n\nconst app = express()\n\napp.get('/list', (req, res) => {\n  console.log('current IP', req.ip)\n  res.json({\n    code: 200,\n    msg: 'linux node server'\n  })\n})\n\napp.listen(9999, () => {\n  console.log('node server at port 9999...')\n})\n```\n\n# 通过 pm2 启动node服务\n\n```js\n// node-server\npm2 start index.js --watch\n```\n\n通过 `pm2 monit` 查看 node 服务的打印日志\n\n# 注意\n\n访问接口，如果打不开，大概率是因为没有放开防火墙。\n\n> http://124.221.230.105:9999/list\n\n1. 找到服务器地址，放开 node 服务对应的端口号\n\n![](/img/firewall.png)\n\n此时依然无法打开对应的接口\n\n2. 登录服务器，查看防火墙所有的端口\n\n> firewall-cmd --zone=public --list-ports\n\n3. 添加新的端口\n\n> firewall-cmd --zone=public --add-port=9999/tcp --permanent\n\n删除 firewall-cmd --zone=public --remove-port=9999/tcp\n\n--permanent 表示永久有效\n\n4. 重启防火墙\n\n> firewall-cmd --reload\n\n至此，就可以访问服务器上 node 服务的接口了。\n\n![](/img/node-res.png)\n\n\n# 参考资料\n[^1]: [小满Linux介绍](https://blog.csdn.net/qq1195566313/article/details/123885302)\n\n\n","source":"_posts/nodejs.md","raw":"---\ntitle: 在Linux上部署 Node 接口\ndate: 2022-12-16 14:00:00\ntags: Nodejs\nbanner_img: /img/nodejs.png\nindex_img: /img/nodejs.png\nexcerpt: Never too old to learn.\n---\n\n# 连接远程服务器\n\n打开 mac 终端:\n\n```js\nssh root@124.221.230.105 (公网IP)\n\n// 接着输入密码，即可登录远程服务器\n```\n\n登录进去，输入 pwd，会输出 `/root`，这时我们切到 '/' 目录下: `cd ..`\n\n# 在远程安装 nodejs\n\n```js\nwget https://cdn.npmmirror.com/binaries/node/v14.19.1/node-v14.19.1-linux-x64.tar.xz\n```\n\n# 解压压缩包\n\n使用 tar 命令\n\n- -c 压缩\n- -x 解压\n- -t 查看内容\n- -r 想压缩归档文件末尾追加文件\n- -v 显示所有过程\n- -f 使用档案名字，切记，这是最后一个参数，最后只能接档案名\n\n```js\ntar -xvf node-v14.19.1-linux-x64.tar.xz\n```\n\n# 配置环境变量\n\n找到根目录 '/' 下的 etc文件夹，进去里面，打开 profile 文件，打开，执行命令：\n\n```js\n// '/'\n\ncd etc\n\nvim profile\n```\n\n在最后一行加上如下这句：\n```js\nexport PATH=$PATH:/node-v14.19.1-linux-x64/bin\n```\n\n最后，使文件生效\n\n```js\n// /etc\nsource profile\n```\n\n查看 node 版本\n```\nnode -v\n\nnpm -v\n```\n\n# 安装 pm2\n\n```\nnpm install -g pm2\n```\n\n# 部署 node 接口\n\n在根目录下 `/`，创建 `node-server` 文件夹\n\n可以通过 express 建立一个 node 服务\n\n```js\nconst express = require(\"express\");\n\nconst app = express()\n\napp.get('/list', (req, res) => {\n  console.log('current IP', req.ip)\n  res.json({\n    code: 200,\n    msg: 'linux node server'\n  })\n})\n\napp.listen(9999, () => {\n  console.log('node server at port 9999...')\n})\n```\n\n# 通过 pm2 启动node服务\n\n```js\n// node-server\npm2 start index.js --watch\n```\n\n通过 `pm2 monit` 查看 node 服务的打印日志\n\n# 注意\n\n访问接口，如果打不开，大概率是因为没有放开防火墙。\n\n> http://124.221.230.105:9999/list\n\n1. 找到服务器地址，放开 node 服务对应的端口号\n\n![](/img/firewall.png)\n\n此时依然无法打开对应的接口\n\n2. 登录服务器，查看防火墙所有的端口\n\n> firewall-cmd --zone=public --list-ports\n\n3. 添加新的端口\n\n> firewall-cmd --zone=public --add-port=9999/tcp --permanent\n\n删除 firewall-cmd --zone=public --remove-port=9999/tcp\n\n--permanent 表示永久有效\n\n4. 重启防火墙\n\n> firewall-cmd --reload\n\n至此，就可以访问服务器上 node 服务的接口了。\n\n![](/img/node-res.png)\n\n\n# 参考资料\n[^1]: [小满Linux介绍](https://blog.csdn.net/qq1195566313/article/details/123885302)\n\n\n","slug":"nodejs","published":1,"updated":"2023-05-12T10:49:20.013Z","comments":1,"layout":"post","photos":[],"link":"","_id":"clhkizgxl000r3y0q7cum0wm0","content":"<h1 id=\"连接远程服务器\"><a href=\"#连接远程服务器\" class=\"headerlink\" title=\"连接远程服务器\"></a>连接远程服务器</h1><p>打开 mac 终端:</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><div class=\"code-wrapper\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></div></td><td class=\"code\"><pre><code class=\"hljs js\">ssh root@<span class=\"hljs-number\">124.221</span><span class=\"hljs-number\">.230</span><span class=\"hljs-number\">.105</span> (公网<span class=\"hljs-variable constant_\">IP</span>)<br><br><span class=\"hljs-comment\">// 接着输入密码，即可登录远程服务器</span><br></code></pre></td></tr></table></figure>\n\n<p>登录进去，输入 pwd，会输出 <code>/root</code>，这时我们切到 ‘/‘ 目录下: <code>cd ..</code></p>\n<h1 id=\"在远程安装-nodejs\"><a href=\"#在远程安装-nodejs\" class=\"headerlink\" title=\"在远程安装 nodejs\"></a>在远程安装 nodejs</h1><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\">wget <span class=\"hljs-attr\">https</span>:<span class=\"hljs-comment\">//cdn.npmmirror.com/binaries/node/v14.19.1/node-v14.19.1-linux-x64.tar.xz</span><br></code></pre></td></tr></table></figure>\n\n<h1 id=\"解压压缩包\"><a href=\"#解压压缩包\" class=\"headerlink\" title=\"解压压缩包\"></a>解压压缩包</h1><p>使用 tar 命令</p>\n<ul>\n<li>-c 压缩</li>\n<li>-x 解压</li>\n<li>-t 查看内容</li>\n<li>-r 想压缩归档文件末尾追加文件</li>\n<li>-v 显示所有过程</li>\n<li>-f 使用档案名字，切记，这是最后一个参数，最后只能接档案名</li>\n</ul>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\">tar -xvf node-v14<span class=\"hljs-number\">.19</span><span class=\"hljs-number\">.1</span>-linux-x64.<span class=\"hljs-property\">tar</span>.<span class=\"hljs-property\">xz</span><br></code></pre></td></tr></table></figure>\n\n<h1 id=\"配置环境变量\"><a href=\"#配置环境变量\" class=\"headerlink\" title=\"配置环境变量\"></a>配置环境变量</h1><p>找到根目录 ‘/‘ 下的 etc文件夹，进去里面，打开 profile 文件，打开，执行命令：</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\"><span class=\"hljs-comment\">// &#x27;/&#x27;</span><br><br>cd etc<br><br>vim profile<br></code></pre></td></tr></table></figure>\n\n<p>在最后一行加上如下这句：</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\"><span class=\"hljs-keyword\">export</span> <span class=\"hljs-variable constant_\">PATH</span>=<span class=\"hljs-attr\">$PATH</span>:<span class=\"hljs-regexp\">/node-v14.19.1-linux-x64/</span>bin<br></code></pre></td></tr></table></figure>\n\n<p>最后，使文件生效</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\"><span class=\"hljs-comment\">// /etc</span><br>source profile<br></code></pre></td></tr></table></figure>\n\n<p>查看 node 版本</p>\n<figure class=\"highlight crmsh\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs crmsh\"><span class=\"hljs-keyword\">node</span> <span class=\"hljs-title\">-v</span><br><br>npm -v<br></code></pre></td></tr></table></figure>\n\n<h1 id=\"安装-pm2\"><a href=\"#安装-pm2\" class=\"headerlink\" title=\"安装 pm2\"></a>安装 pm2</h1><figure class=\"highlight cmake\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs cmake\">npm <span class=\"hljs-keyword\">install</span> -g pm2<br></code></pre></td></tr></table></figure>\n\n<h1 id=\"部署-node-接口\"><a href=\"#部署-node-接口\" class=\"headerlink\" title=\"部署 node 接口\"></a>部署 node 接口</h1><p>在根目录下 <code>/</code>，创建 <code>node-server</code> 文件夹</p>\n<p>可以通过 express 建立一个 node 服务</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\"><span class=\"hljs-keyword\">const</span> express = <span class=\"hljs-built_in\">require</span>(<span class=\"hljs-string\">&quot;express&quot;</span>);<br><br><span class=\"hljs-keyword\">const</span> app = <span class=\"hljs-title function_\">express</span>()<br><br>app.<span class=\"hljs-title function_\">get</span>(<span class=\"hljs-string\">&#x27;/list&#x27;</span>, <span class=\"hljs-function\">(<span class=\"hljs-params\">req, res</span>) =&gt;</span> &#123;<br>  <span class=\"hljs-variable language_\">console</span>.<span class=\"hljs-title function_\">log</span>(<span class=\"hljs-string\">&#x27;current IP&#x27;</span>, req.<span class=\"hljs-property\">ip</span>)<br>  res.<span class=\"hljs-title function_\">json</span>(&#123;<br>    <span class=\"hljs-attr\">code</span>: <span class=\"hljs-number\">200</span>,<br>    <span class=\"hljs-attr\">msg</span>: <span class=\"hljs-string\">&#x27;linux node server&#x27;</span><br>  &#125;)<br>&#125;)<br><br>app.<span class=\"hljs-title function_\">listen</span>(<span class=\"hljs-number\">9999</span>, <span class=\"hljs-function\">() =&gt;</span> &#123;<br>  <span class=\"hljs-variable language_\">console</span>.<span class=\"hljs-title function_\">log</span>(<span class=\"hljs-string\">&#x27;node server at port 9999...&#x27;</span>)<br>&#125;)<br></code></pre></td></tr></table></figure>\n\n<h1 id=\"通过-pm2-启动node服务\"><a href=\"#通过-pm2-启动node服务\" class=\"headerlink\" title=\"通过 pm2 启动node服务\"></a>通过 pm2 启动node服务</h1><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\"><span class=\"hljs-comment\">// node-server</span><br>pm2 start index.<span class=\"hljs-property\">js</span> --watch<br></code></pre></td></tr></table></figure>\n\n<p>通过 <code>pm2 monit</code> 查看 node 服务的打印日志</p>\n<h1 id=\"注意\"><a href=\"#注意\" class=\"headerlink\" title=\"注意\"></a>注意</h1><p>访问接口，如果打不开，大概率是因为没有放开防火墙。</p>\n<blockquote>\n<p><a href=\"http://124.221.230.105:9999/list\">http://124.221.230.105:9999/list</a></p>\n</blockquote>\n<ol>\n<li>找到服务器地址，放开 node 服务对应的端口号</li>\n</ol>\n<p><img src=\"/img/firewall.png\" alt=\"\"></p>\n<p>此时依然无法打开对应的接口</p>\n<ol start=\"2\">\n<li>登录服务器，查看防火墙所有的端口</li>\n</ol>\n<blockquote>\n<p>firewall-cmd –zone=public –list-ports</p>\n</blockquote>\n<ol start=\"3\">\n<li>添加新的端口</li>\n</ol>\n<blockquote>\n<p>firewall-cmd –zone=public –add-port=9999/tcp –permanent</p>\n</blockquote>\n<p>删除 firewall-cmd –zone=public –remove-port=9999/tcp</p>\n<p>–permanent 表示永久有效</p>\n<ol start=\"4\">\n<li>重启防火墙</li>\n</ol>\n<blockquote>\n<p>firewall-cmd –reload</p>\n</blockquote>\n<p>至此，就可以访问服务器上 node 服务的接口了。</p>\n<p><img src=\"/img/node-res.png\" alt=\"\"></p>\n<h1 id=\"参考资料\"><a href=\"#参考资料\" class=\"headerlink\" title=\"参考资料\"></a>参考资料</h1><section class=\"footnotes\"><div class=\"footnote-list\"><ol><li><span id=\"fn:1\" class=\"footnote-text\"><span><a href=\"https://blog.csdn.net/qq1195566313/article/details/123885302\">小满Linux介绍</a>\n<a href=\"#fnref:1\" rev=\"footnote\" class=\"footnote-backref\"> ↩</a></span></span></li></ol></div></section>","site":{"data":{}},"wordcount":1300,"more":"<h1 id=\"连接远程服务器\"><a href=\"#连接远程服务器\" class=\"headerlink\" title=\"连接远程服务器\"></a>连接远程服务器</h1><p>打开 mac 终端:</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\">ssh root@<span class=\"hljs-number\">124.221</span><span class=\"hljs-number\">.230</span><span class=\"hljs-number\">.105</span> (公网<span class=\"hljs-variable constant_\">IP</span>)<br><br><span class=\"hljs-comment\">// 接着输入密码，即可登录远程服务器</span><br></code></pre></td></tr></table></figure>\n\n<p>登录进去，输入 pwd，会输出 <code>/root</code>，这时我们切到 ‘/‘ 目录下: <code>cd ..</code></p>\n<h1 id=\"在远程安装-nodejs\"><a href=\"#在远程安装-nodejs\" class=\"headerlink\" title=\"在远程安装 nodejs\"></a>在远程安装 nodejs</h1><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\">wget <span class=\"hljs-attr\">https</span>:<span class=\"hljs-comment\">//cdn.npmmirror.com/binaries/node/v14.19.1/node-v14.19.1-linux-x64.tar.xz</span><br></code></pre></td></tr></table></figure>\n\n<h1 id=\"解压压缩包\"><a href=\"#解压压缩包\" class=\"headerlink\" title=\"解压压缩包\"></a>解压压缩包</h1><p>使用 tar 命令</p>\n<ul>\n<li>-c 压缩</li>\n<li>-x 解压</li>\n<li>-t 查看内容</li>\n<li>-r 想压缩归档文件末尾追加文件</li>\n<li>-v 显示所有过程</li>\n<li>-f 使用档案名字，切记，这是最后一个参数，最后只能接档案名</li>\n</ul>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\">tar -xvf node-v14<span class=\"hljs-number\">.19</span><span class=\"hljs-number\">.1</span>-linux-x64.<span class=\"hljs-property\">tar</span>.<span class=\"hljs-property\">xz</span><br></code></pre></td></tr></table></figure>\n\n<h1 id=\"配置环境变量\"><a href=\"#配置环境变量\" class=\"headerlink\" title=\"配置环境变量\"></a>配置环境变量</h1><p>找到根目录 ‘/‘ 下的 etc文件夹，进去里面，打开 profile 文件，打开，执行命令：</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\"><span class=\"hljs-comment\">// &#x27;/&#x27;</span><br><br>cd etc<br><br>vim profile<br></code></pre></td></tr></table></figure>\n\n<p>在最后一行加上如下这句：</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\"><span class=\"hljs-keyword\">export</span> <span class=\"hljs-variable constant_\">PATH</span>=<span class=\"hljs-attr\">$PATH</span>:<span class=\"hljs-regexp\">/node-v14.19.1-linux-x64/</span>bin<br></code></pre></td></tr></table></figure>\n\n<p>最后，使文件生效</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\"><span class=\"hljs-comment\">// /etc</span><br>source profile<br></code></pre></td></tr></table></figure>\n\n<p>查看 node 版本</p>\n<figure class=\"highlight crmsh\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs crmsh\"><span class=\"hljs-keyword\">node</span> <span class=\"hljs-title\">-v</span><br><br>npm -v<br></code></pre></td></tr></table></figure>\n\n<h1 id=\"安装-pm2\"><a href=\"#安装-pm2\" class=\"headerlink\" title=\"安装 pm2\"></a>安装 pm2</h1><figure class=\"highlight cmake\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs cmake\">npm <span class=\"hljs-keyword\">install</span> -g pm2<br></code></pre></td></tr></table></figure>\n\n<h1 id=\"部署-node-接口\"><a href=\"#部署-node-接口\" class=\"headerlink\" title=\"部署 node 接口\"></a>部署 node 接口</h1><p>在根目录下 <code>/</code>，创建 <code>node-server</code> 文件夹</p>\n<p>可以通过 express 建立一个 node 服务</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\"><span class=\"hljs-keyword\">const</span> express = <span class=\"hljs-built_in\">require</span>(<span class=\"hljs-string\">&quot;express&quot;</span>);<br><br><span class=\"hljs-keyword\">const</span> app = <span class=\"hljs-title function_\">express</span>()<br><br>app.<span class=\"hljs-title function_\">get</span>(<span class=\"hljs-string\">&#x27;/list&#x27;</span>, <span class=\"hljs-function\">(<span class=\"hljs-params\">req, res</span>) =&gt;</span> &#123;<br>  <span class=\"hljs-variable language_\">console</span>.<span class=\"hljs-title function_\">log</span>(<span class=\"hljs-string\">&#x27;current IP&#x27;</span>, req.<span class=\"hljs-property\">ip</span>)<br>  res.<span class=\"hljs-title function_\">json</span>(&#123;<br>    <span class=\"hljs-attr\">code</span>: <span class=\"hljs-number\">200</span>,<br>    <span class=\"hljs-attr\">msg</span>: <span class=\"hljs-string\">&#x27;linux node server&#x27;</span><br>  &#125;)<br>&#125;)<br><br>app.<span class=\"hljs-title function_\">listen</span>(<span class=\"hljs-number\">9999</span>, <span class=\"hljs-function\">() =&gt;</span> &#123;<br>  <span class=\"hljs-variable language_\">console</span>.<span class=\"hljs-title function_\">log</span>(<span class=\"hljs-string\">&#x27;node server at port 9999...&#x27;</span>)<br>&#125;)<br></code></pre></td></tr></table></figure>\n\n<h1 id=\"通过-pm2-启动node服务\"><a href=\"#通过-pm2-启动node服务\" class=\"headerlink\" title=\"通过 pm2 启动node服务\"></a>通过 pm2 启动node服务</h1><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\"><span class=\"hljs-comment\">// node-server</span><br>pm2 start index.<span class=\"hljs-property\">js</span> --watch<br></code></pre></td></tr></table></figure>\n\n<p>通过 <code>pm2 monit</code> 查看 node 服务的打印日志</p>\n<h1 id=\"注意\"><a href=\"#注意\" class=\"headerlink\" title=\"注意\"></a>注意</h1><p>访问接口，如果打不开，大概率是因为没有放开防火墙。</p>\n<blockquote>\n<p><a href=\"http://124.221.230.105:9999/list\">http://124.221.230.105:9999/list</a></p>\n</blockquote>\n<ol>\n<li>找到服务器地址，放开 node 服务对应的端口号</li>\n</ol>\n<p><img src=\"/img/firewall.png\" alt=\"\"></p>\n<p>此时依然无法打开对应的接口</p>\n<ol start=\"2\">\n<li>登录服务器，查看防火墙所有的端口</li>\n</ol>\n<blockquote>\n<p>firewall-cmd –zone=public –list-ports</p>\n</blockquote>\n<ol start=\"3\">\n<li>添加新的端口</li>\n</ol>\n<blockquote>\n<p>firewall-cmd –zone=public –add-port=9999/tcp –permanent</p>\n</blockquote>\n<p>删除 firewall-cmd –zone=public –remove-port=9999/tcp</p>\n<p>–permanent 表示永久有效</p>\n<ol start=\"4\">\n<li>重启防火墙</li>\n</ol>\n<blockquote>\n<p>firewall-cmd –reload</p>\n</blockquote>\n<p>至此，就可以访问服务器上 node 服务的接口了。</p>\n<p><img src=\"/img/node-res.png\" alt=\"\"></p>\n<h1 id=\"参考资料\"><a href=\"#参考资料\" class=\"headerlink\" title=\"参考资料\"></a>参考资料</h1><section class=\"footnotes\"><div class=\"footnote-list\"><ol><li><span id=\"fn:1\" class=\"footnote-text\"><span><a href=\"https://blog.csdn.net/qq1195566313/article/details/123885302\">小满Linux介绍</a>\n<a href=\"#fnref:1\" rev=\"footnote\" class=\"footnote-backref\"> ↩</a></span></span></li></ol></div></section>"},{"layout":"JavaScript","title":"高性能渲染十万条数据(虚拟列表)","date":"2022-11-23T12:43:13.000Z","banner_img":"/img/render-10w-data.jpg","index_img":"/img/render-10w-data.jpg","excerpt":"使用虚拟列表的方式，来同时加载大量数据。","_content":"\n# 前言\n\n在工作中，有时会遇到需要一些不能使用分页方式来加载列表数据的业务情况，对于此，我们称这种列表叫做长列表。比如，在一些外汇交易系统中，前端会实时的展示用户的持仓情况(收益、亏损、手数等)，此时对于用户的持仓列表一般是不能分页的。\n\n`时间分片` 提到了可以使用时间分片的方式来对长列表进行渲染，但这种方式更适用于列表项的DOM结构十分简单的情况。本文会介绍使用虚拟列表的方式，来同时加载大量数据。\n\n当我们渲染10w条数据时，其实主要是的时间花费在 `Recalculate Style` 和 `Layout` 上\n\n- Recalculate Style：样式计算，浏览器根据css选择器计算哪些元素应该应用哪些规则，确定每个元素具体的样式。\n- Layout：布局，知道元素应用哪些规则之后，浏览器开始计算它要占据的空间大小及其在屏幕的位置。\n\n![](/img/render-10w-data.jpg)\n\n在实际的工作中，列表项必然不会像例子中仅仅只由一个li标签组成，必然是由复杂DOM节点组成的。\n\n那么可以想象的是，当列表项数过多并且列表项结构复杂的时候，同时渲染时，会在`Recalculate Style`和`Layout`阶段消耗大量的时间。\n\n而`虚拟列表`就是解决这一问题的一种实现。\n\n# 什么是虚拟列表\n虚拟列表其实是按需显示的一种实现，即只对可见区域进行渲染，对非可见区域中的数据不渲染或部分渲染的技术，从而达到极高的渲染性能。\n\n假设有1万条记录需要同时渲染，我们屏幕的可见区域的高度为1000px,而列表项的高度为50px，则此时我们在屏幕中最多只能看到20个列表项，那么在首次渲染的时候，我们只需加载20条即可。\n\n![](https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-user-assets/2019/10/29/16e15195cf16a558~tplv-t2oaga2asx-zoom-in-crop-mark:4536:0:0:0.image)\n\n说完首次加载，再分析一下当滚动发生时，我们可以通过计算当前滚动值得知此时在屏幕可见区域应该显示的列表项。\n\n假设滚动发生，滚动条距顶部的位置为150px,则我们可得知在可见区域内的列表项为第4项至`第13项。\n\n![](https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-user-assets/2019/10/29/16e15197c273cbd9~tplv-t2oaga2asx-zoom-in-crop-mark:4536:0:0:0.image)\n\n\n# 实现\n虚拟列表的实现，实际上是在首屏加载的时候，只加载 `可视区域` 内需要的列表项，当滚动发生时，通过计算动态获得可视区域内的列表项，并将非可视区域内存在的列表项删除。\n\n- 计算当前可视区域`起始数据`索引（startIndex）\n- 计算当前可视区域`结束数据`索引（endIndex）\n- 计算当前可视区域的数据，并渲染到页面中\n- 计算startIndex对应的数据在整个列表中的偏移位置startOffset并设置到列表上\n\n![](https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-user-assets/2019/10/29/16e1519a393dee2c~tplv-t2oaga2asx-zoom-in-crop-mark:4536:0:0:0.image)\n\n由于只是对可视区域内的列表项进行渲染，所以为了保持列表容器的高度并可正常的触发滚动，将Html结构设计成如下结构：\n\n```html\n<div ref=\"list\" class=\"infinite-list-container\" @scroll=\"scrollEvent($event)\">\n\n    <!-- 所有数据的总高度 -->\n    <div class=\"infinite-list-phantom\" :style=\"{ height: listHeight + 'px' }\"></div>\n\n    <!-- 可视区区域，可以当做滑块看待 -->\n    <div class=\"infinite-list\" :style=\"{ transform: getTransform }\">\n\n      <!-- 每一项数据 -->\n      <div\n        ref=\"items\"\n        class=\"infinite-list-item\"\n        v-for=\"item in visibleData\"\n        :key=\"item.id\"\n        :style=\"{ height: itemSize + 'px', lineHeight: itemSize + 'px' }\"\n      >\n        {{ item.value }}\n      </div>\n    </div>\n  </div>\n```\n\n接着，监听infinite-list-container的 `scroll事件`，获取滚动位置 `scrollTop`。\n\n- 列表总高度 `listHeight = listData.length * itemSize`\n- 可显示的列表项数 `visibleCount = Math.ceil(screenHeight / itemSize)`\n- 数据的起始索引 `startIndex = Math.floor(scrollTop / itemSize)`\n- 数据的结束索引 `endIndex = startIndex + visibleCount`\n- 列表显示数据为 `visibleData = listData.slice(startIndex,endIndex)`\n\n```js\nscrollEvent() {\n  //当前滚动位置\n  let scrollTop = this.$refs.list.scrollTop;\n\n  //此时的开始索引（向下取整），itemSize 是 100\n  this.start = Math.floor(scrollTop / this.itemSize);\n\n  //此时的结束索引\n  this.end = this.start + this.visibleCount;\n\n  //此时的偏移量\n  this.startOffset = scrollTop - (scrollTop % this.itemSize);\n},\n```\n\n当滚动后，由于 `渲染区域` 相对于 `可视区域` 已经发生了偏移，此时我需要获取一个 `偏移量startOffset`，通过样式控制将渲染区域偏移至可视区域中，当用户在滑动时，渲染区域就会根据 `startOffset` 计算出偏移量，渲染区域就会一直在可视区域内呈现。\n\n```js\nthis.startOffset = scrollTop - (scrollTop % this.itemSize);\n\n// computed\n//偏移量对应的style\ngetTransform() {\n  return `translate3d(0,${this.startOffset}px,0)`;\n},\n```\n\n# 完整代码\n\n```html\n<style>\n  html{\n    height: 100%;\n  }\n  body{\n    height: 100%;\n    margin:0;\n  }\n  #app{\n    height:100%;\n  }\n</style>\n\n<div id=\"app\">\n  <VirtualList :listData=\"state.data\" :itemSize=\"100\" />\n</div>\n```\n\nVirtualList comp.\n```js\n<script>\nexport default {\n  name: \"VirtualList\",\n  props: {\n    //所有列表数据\n    listData: {\n      type: Array,\n      default: () => [],\n    },\n    //每项高度\n    itemSize: {\n      type: Number,\n      default: 200,\n    },\n  },\n  computed: {\n    //列表总高度\n    listHeight() {\n      return this.listData.length * this.itemSize;\n    },\n    //可显示的列表项数\n    visibleCount() {\n      // 向上取整: Math.ceil(13.06) => 14，表示整个屏幕，可以放 14 条数据\n      return Math.ceil(this.screenHeight / this.itemSize);\n    },\n    //偏移量对应的style\n    getTransform() {\n      return `translate3d(0,${this.startOffset}px,0)`;\n    },\n    //获取真实显示列表数据\n    visibleData() {\n      return this.listData.slice(\n        this.start,\n        Math.min(this.end, this.listData.length)\n      );\n    },\n  },\n  mounted() {\n    // this.$el 表示当前组件的根节点，这里是 infinite-list-container\n    this.screenHeight = this.$el.clientHeight;\n    this.start = 0;\n    this.end = this.start + this.visibleCount;\n  },\n  data() {\n    return {\n      //可视区域高度\n      screenHeight: 0,\n      //偏移量\n      startOffset: 0,\n      //起始索引\n      start: 0,\n      //结束索引\n      end: null,\n    };\n  },\n  methods: {\n    scrollEvent() {\n      //当前滚动位置\n      let scrollTop = this.$refs.list.scrollTop;\n\n      //此时的开始索引（向下取整），itemSize 是 100\n      this.start = Math.floor(scrollTop / this.itemSize);\n      //此时的结束索引\n      this.end = this.start + this.visibleCount;\n\n      //此时的偏移量\n      this.startOffset = scrollTop - (scrollTop % this.itemSize);\n    },\n  },\n};\n</script>\n\n<template>\n  <div ref=\"list\" class=\"infinite-list-container\" @scroll=\"scrollEvent($event)\">\n\n    <!-- 所有数据的总高度 -->\n    <div class=\"infinite-list-phantom\" :style=\"{ height: listHeight + 'px' }\"></div>\n\n    <!-- 可视区区域，可以当做滑块看待 -->\n    <div class=\"infinite-list\" :style=\"{ transform: getTransform }\">\n      <div\n        ref=\"items\"\n        class=\"infinite-list-item\"\n        v-for=\"item in visibleData\"\n        :key=\"item.id\"\n        :style=\"{ height: itemSize + 'px', lineHeight: itemSize + 'px' }\"\n      >\n        {{ item.value }}\n      </div>\n    </div>\n  </div>\n</template>\n\n<style scoped>\n.infinite-list-container {\n  height: 100%;\n  overflow: auto;\n  position: relative;\n  -webkit-overflow-scrolling: touch;\n}\n\n.infinite-list-phantom {\n  position: absolute;\n  left: 0;\n  top: 0;\n  right: 0;\n  z-index: -1;\n}\n\n.infinite-list {\n  left: 0;\n  right: 0;\n  top: 0;\n  position: absolute;\n  text-align: center;\n}\n\n.infinite-list-item {\n  padding: 10px;\n  color: #555;\n  box-sizing: border-box;\n  border-bottom: 1px solid #999;\n}\n</style>\n\n```\n\n# 列表项动态高度\n\n在之前的实现中，列表项的高度是固定的，因为高度固定，所以可以很轻易的获取列表项的整体高度以及滚动时的显示数据与对应的偏移量。\n\n而实际应用的时候，当列表中包含文本之类的可变内容，会导致 `列表项的高度并不相同`。\n\n比如这样：\n\n![](https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-user-assets/2019/10/29/16e1519f1e121be9~tplv-t2oaga2asx-zoom-in-crop-mark:4536:0:0:0.image)\n\n在虚拟列表中应用动态高度的解决方案一般有如下三种：\n\n> 1.对组件属性itemSize进行扩展，支持传递类型为数字、数组、函数\n\n- 可以是一个固定值，如 100，此时列表项是固高的\n- 可以是一个包含所有列表项高度的数据，如 [50, 20, 100, 80, ...]\n- 可以是一个根据列表项索引返回其高度的函数：(index: number): number\n\n这种方式虽然有比较好的灵活度，但仅适用于可以预先知道或可以通过计算得知列表项高度的情况，依然无法解决列表项高度由内容撑开的情况。\n\n> 2.将列表项 `渲染到屏幕外`，对其高度进行测量并缓存，然后再将其渲染至可视区域内。\n\n由于 `预先渲染至屏幕外`，再渲染至屏幕内，这导致渲染成本增加一倍，这对于数百万用户在低端移动设备上使用的产品来说是不切实际的。\n\n> 3.以预估高度先行渲染，然后获取真实高度并缓存。\n\n这是可以选择的实现方式，可以避免前两种方案的不足。\n","source":"_posts/virtual-list.md","raw":"---\nlayout: JavaScript\ntitle: 高性能渲染十万条数据(虚拟列表)\ndate: 2022-11-23 20:43:13\ntags: JS\nbanner_img: /img/render-10w-data.jpg\nindex_img: /img/render-10w-data.jpg\nexcerpt: 使用虚拟列表的方式，来同时加载大量数据。\n---\n\n# 前言\n\n在工作中，有时会遇到需要一些不能使用分页方式来加载列表数据的业务情况，对于此，我们称这种列表叫做长列表。比如，在一些外汇交易系统中，前端会实时的展示用户的持仓情况(收益、亏损、手数等)，此时对于用户的持仓列表一般是不能分页的。\n\n`时间分片` 提到了可以使用时间分片的方式来对长列表进行渲染，但这种方式更适用于列表项的DOM结构十分简单的情况。本文会介绍使用虚拟列表的方式，来同时加载大量数据。\n\n当我们渲染10w条数据时，其实主要是的时间花费在 `Recalculate Style` 和 `Layout` 上\n\n- Recalculate Style：样式计算，浏览器根据css选择器计算哪些元素应该应用哪些规则，确定每个元素具体的样式。\n- Layout：布局，知道元素应用哪些规则之后，浏览器开始计算它要占据的空间大小及其在屏幕的位置。\n\n![](/img/render-10w-data.jpg)\n\n在实际的工作中，列表项必然不会像例子中仅仅只由一个li标签组成，必然是由复杂DOM节点组成的。\n\n那么可以想象的是，当列表项数过多并且列表项结构复杂的时候，同时渲染时，会在`Recalculate Style`和`Layout`阶段消耗大量的时间。\n\n而`虚拟列表`就是解决这一问题的一种实现。\n\n# 什么是虚拟列表\n虚拟列表其实是按需显示的一种实现，即只对可见区域进行渲染，对非可见区域中的数据不渲染或部分渲染的技术，从而达到极高的渲染性能。\n\n假设有1万条记录需要同时渲染，我们屏幕的可见区域的高度为1000px,而列表项的高度为50px，则此时我们在屏幕中最多只能看到20个列表项，那么在首次渲染的时候，我们只需加载20条即可。\n\n![](https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-user-assets/2019/10/29/16e15195cf16a558~tplv-t2oaga2asx-zoom-in-crop-mark:4536:0:0:0.image)\n\n说完首次加载，再分析一下当滚动发生时，我们可以通过计算当前滚动值得知此时在屏幕可见区域应该显示的列表项。\n\n假设滚动发生，滚动条距顶部的位置为150px,则我们可得知在可见区域内的列表项为第4项至`第13项。\n\n![](https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-user-assets/2019/10/29/16e15197c273cbd9~tplv-t2oaga2asx-zoom-in-crop-mark:4536:0:0:0.image)\n\n\n# 实现\n虚拟列表的实现，实际上是在首屏加载的时候，只加载 `可视区域` 内需要的列表项，当滚动发生时，通过计算动态获得可视区域内的列表项，并将非可视区域内存在的列表项删除。\n\n- 计算当前可视区域`起始数据`索引（startIndex）\n- 计算当前可视区域`结束数据`索引（endIndex）\n- 计算当前可视区域的数据，并渲染到页面中\n- 计算startIndex对应的数据在整个列表中的偏移位置startOffset并设置到列表上\n\n![](https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-user-assets/2019/10/29/16e1519a393dee2c~tplv-t2oaga2asx-zoom-in-crop-mark:4536:0:0:0.image)\n\n由于只是对可视区域内的列表项进行渲染，所以为了保持列表容器的高度并可正常的触发滚动，将Html结构设计成如下结构：\n\n```html\n<div ref=\"list\" class=\"infinite-list-container\" @scroll=\"scrollEvent($event)\">\n\n    <!-- 所有数据的总高度 -->\n    <div class=\"infinite-list-phantom\" :style=\"{ height: listHeight + 'px' }\"></div>\n\n    <!-- 可视区区域，可以当做滑块看待 -->\n    <div class=\"infinite-list\" :style=\"{ transform: getTransform }\">\n\n      <!-- 每一项数据 -->\n      <div\n        ref=\"items\"\n        class=\"infinite-list-item\"\n        v-for=\"item in visibleData\"\n        :key=\"item.id\"\n        :style=\"{ height: itemSize + 'px', lineHeight: itemSize + 'px' }\"\n      >\n        {{ item.value }}\n      </div>\n    </div>\n  </div>\n```\n\n接着，监听infinite-list-container的 `scroll事件`，获取滚动位置 `scrollTop`。\n\n- 列表总高度 `listHeight = listData.length * itemSize`\n- 可显示的列表项数 `visibleCount = Math.ceil(screenHeight / itemSize)`\n- 数据的起始索引 `startIndex = Math.floor(scrollTop / itemSize)`\n- 数据的结束索引 `endIndex = startIndex + visibleCount`\n- 列表显示数据为 `visibleData = listData.slice(startIndex,endIndex)`\n\n```js\nscrollEvent() {\n  //当前滚动位置\n  let scrollTop = this.$refs.list.scrollTop;\n\n  //此时的开始索引（向下取整），itemSize 是 100\n  this.start = Math.floor(scrollTop / this.itemSize);\n\n  //此时的结束索引\n  this.end = this.start + this.visibleCount;\n\n  //此时的偏移量\n  this.startOffset = scrollTop - (scrollTop % this.itemSize);\n},\n```\n\n当滚动后，由于 `渲染区域` 相对于 `可视区域` 已经发生了偏移，此时我需要获取一个 `偏移量startOffset`，通过样式控制将渲染区域偏移至可视区域中，当用户在滑动时，渲染区域就会根据 `startOffset` 计算出偏移量，渲染区域就会一直在可视区域内呈现。\n\n```js\nthis.startOffset = scrollTop - (scrollTop % this.itemSize);\n\n// computed\n//偏移量对应的style\ngetTransform() {\n  return `translate3d(0,${this.startOffset}px,0)`;\n},\n```\n\n# 完整代码\n\n```html\n<style>\n  html{\n    height: 100%;\n  }\n  body{\n    height: 100%;\n    margin:0;\n  }\n  #app{\n    height:100%;\n  }\n</style>\n\n<div id=\"app\">\n  <VirtualList :listData=\"state.data\" :itemSize=\"100\" />\n</div>\n```\n\nVirtualList comp.\n```js\n<script>\nexport default {\n  name: \"VirtualList\",\n  props: {\n    //所有列表数据\n    listData: {\n      type: Array,\n      default: () => [],\n    },\n    //每项高度\n    itemSize: {\n      type: Number,\n      default: 200,\n    },\n  },\n  computed: {\n    //列表总高度\n    listHeight() {\n      return this.listData.length * this.itemSize;\n    },\n    //可显示的列表项数\n    visibleCount() {\n      // 向上取整: Math.ceil(13.06) => 14，表示整个屏幕，可以放 14 条数据\n      return Math.ceil(this.screenHeight / this.itemSize);\n    },\n    //偏移量对应的style\n    getTransform() {\n      return `translate3d(0,${this.startOffset}px,0)`;\n    },\n    //获取真实显示列表数据\n    visibleData() {\n      return this.listData.slice(\n        this.start,\n        Math.min(this.end, this.listData.length)\n      );\n    },\n  },\n  mounted() {\n    // this.$el 表示当前组件的根节点，这里是 infinite-list-container\n    this.screenHeight = this.$el.clientHeight;\n    this.start = 0;\n    this.end = this.start + this.visibleCount;\n  },\n  data() {\n    return {\n      //可视区域高度\n      screenHeight: 0,\n      //偏移量\n      startOffset: 0,\n      //起始索引\n      start: 0,\n      //结束索引\n      end: null,\n    };\n  },\n  methods: {\n    scrollEvent() {\n      //当前滚动位置\n      let scrollTop = this.$refs.list.scrollTop;\n\n      //此时的开始索引（向下取整），itemSize 是 100\n      this.start = Math.floor(scrollTop / this.itemSize);\n      //此时的结束索引\n      this.end = this.start + this.visibleCount;\n\n      //此时的偏移量\n      this.startOffset = scrollTop - (scrollTop % this.itemSize);\n    },\n  },\n};\n</script>\n\n<template>\n  <div ref=\"list\" class=\"infinite-list-container\" @scroll=\"scrollEvent($event)\">\n\n    <!-- 所有数据的总高度 -->\n    <div class=\"infinite-list-phantom\" :style=\"{ height: listHeight + 'px' }\"></div>\n\n    <!-- 可视区区域，可以当做滑块看待 -->\n    <div class=\"infinite-list\" :style=\"{ transform: getTransform }\">\n      <div\n        ref=\"items\"\n        class=\"infinite-list-item\"\n        v-for=\"item in visibleData\"\n        :key=\"item.id\"\n        :style=\"{ height: itemSize + 'px', lineHeight: itemSize + 'px' }\"\n      >\n        {{ item.value }}\n      </div>\n    </div>\n  </div>\n</template>\n\n<style scoped>\n.infinite-list-container {\n  height: 100%;\n  overflow: auto;\n  position: relative;\n  -webkit-overflow-scrolling: touch;\n}\n\n.infinite-list-phantom {\n  position: absolute;\n  left: 0;\n  top: 0;\n  right: 0;\n  z-index: -1;\n}\n\n.infinite-list {\n  left: 0;\n  right: 0;\n  top: 0;\n  position: absolute;\n  text-align: center;\n}\n\n.infinite-list-item {\n  padding: 10px;\n  color: #555;\n  box-sizing: border-box;\n  border-bottom: 1px solid #999;\n}\n</style>\n\n```\n\n# 列表项动态高度\n\n在之前的实现中，列表项的高度是固定的，因为高度固定，所以可以很轻易的获取列表项的整体高度以及滚动时的显示数据与对应的偏移量。\n\n而实际应用的时候，当列表中包含文本之类的可变内容，会导致 `列表项的高度并不相同`。\n\n比如这样：\n\n![](https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-user-assets/2019/10/29/16e1519f1e121be9~tplv-t2oaga2asx-zoom-in-crop-mark:4536:0:0:0.image)\n\n在虚拟列表中应用动态高度的解决方案一般有如下三种：\n\n> 1.对组件属性itemSize进行扩展，支持传递类型为数字、数组、函数\n\n- 可以是一个固定值，如 100，此时列表项是固高的\n- 可以是一个包含所有列表项高度的数据，如 [50, 20, 100, 80, ...]\n- 可以是一个根据列表项索引返回其高度的函数：(index: number): number\n\n这种方式虽然有比较好的灵活度，但仅适用于可以预先知道或可以通过计算得知列表项高度的情况，依然无法解决列表项高度由内容撑开的情况。\n\n> 2.将列表项 `渲染到屏幕外`，对其高度进行测量并缓存，然后再将其渲染至可视区域内。\n\n由于 `预先渲染至屏幕外`，再渲染至屏幕内，这导致渲染成本增加一倍，这对于数百万用户在低端移动设备上使用的产品来说是不切实际的。\n\n> 3.以预估高度先行渲染，然后获取真实高度并缓存。\n\n这是可以选择的实现方式，可以避免前两种方案的不足。\n","slug":"virtual-list","published":1,"updated":"2023-05-12T10:49:20.014Z","comments":1,"photos":[],"link":"","_id":"clhkizgxm000u3y0qd7z1d63w","content":"<h1 id=\"前言\"><a href=\"#前言\" class=\"headerlink\" title=\"前言\"></a>前言</h1><p>在工作中，有时会遇到需要一些不能使用分页方式来加载列表数据的业务情况，对于此，我们称这种列表叫做长列表。比如，在一些外汇交易系统中，前端会实时的展示用户的持仓情况(收益、亏损、手数等)，此时对于用户的持仓列表一般是不能分页的。</p>\n<p><code>时间分片</code> 提到了可以使用时间分片的方式来对长列表进行渲染，但这种方式更适用于列表项的DOM结构十分简单的情况。本文会介绍使用虚拟列表的方式，来同时加载大量数据。</p>\n<p>当我们渲染10w条数据时，其实主要是的时间花费在 <code>Recalculate Style</code> 和 <code>Layout</code> 上</p>\n<ul>\n<li>Recalculate Style：样式计算，浏览器根据css选择器计算哪些元素应该应用哪些规则，确定每个元素具体的样式。</li>\n<li>Layout：布局，知道元素应用哪些规则之后，浏览器开始计算它要占据的空间大小及其在屏幕的位置。</li>\n</ul>\n<p><img src=\"/img/render-10w-data.jpg\" alt=\"\"></p>\n<p>在实际的工作中，列表项必然不会像例子中仅仅只由一个li标签组成，必然是由复杂DOM节点组成的。</p>\n<p>那么可以想象的是，当列表项数过多并且列表项结构复杂的时候，同时渲染时，会在<code>Recalculate Style</code>和<code>Layout</code>阶段消耗大量的时间。</p>\n<p>而<code>虚拟列表</code>就是解决这一问题的一种实现。</p>\n<h1 id=\"什么是虚拟列表\"><a href=\"#什么是虚拟列表\" class=\"headerlink\" title=\"什么是虚拟列表\"></a>什么是虚拟列表</h1><p>虚拟列表其实是按需显示的一种实现，即只对可见区域进行渲染，对非可见区域中的数据不渲染或部分渲染的技术，从而达到极高的渲染性能。</p>\n<p>假设有1万条记录需要同时渲染，我们屏幕的可见区域的高度为1000px,而列表项的高度为50px，则此时我们在屏幕中最多只能看到20个列表项，那么在首次渲染的时候，我们只需加载20条即可。</p>\n<p><img src=\"https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-user-assets/2019/10/29/16e15195cf16a558~tplv-t2oaga2asx-zoom-in-crop-mark:4536:0:0:0.image\" alt=\"\"></p>\n<p>说完首次加载，再分析一下当滚动发生时，我们可以通过计算当前滚动值得知此时在屏幕可见区域应该显示的列表项。</p>\n<p>假设滚动发生，滚动条距顶部的位置为150px,则我们可得知在可见区域内的列表项为第4项至`第13项。</p>\n<p><img src=\"https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-user-assets/2019/10/29/16e15197c273cbd9~tplv-t2oaga2asx-zoom-in-crop-mark:4536:0:0:0.image\" alt=\"\"></p>\n<h1 id=\"实现\"><a href=\"#实现\" class=\"headerlink\" title=\"实现\"></a>实现</h1><p>虚拟列表的实现，实际上是在首屏加载的时候，只加载 <code>可视区域</code> 内需要的列表项，当滚动发生时，通过计算动态获得可视区域内的列表项，并将非可视区域内存在的列表项删除。</p>\n<ul>\n<li>计算当前可视区域<code>起始数据</code>索引（startIndex）</li>\n<li>计算当前可视区域<code>结束数据</code>索引（endIndex）</li>\n<li>计算当前可视区域的数据，并渲染到页面中</li>\n<li>计算startIndex对应的数据在整个列表中的偏移位置startOffset并设置到列表上</li>\n</ul>\n<p><img src=\"https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-user-assets/2019/10/29/16e1519a393dee2c~tplv-t2oaga2asx-zoom-in-crop-mark:4536:0:0:0.image\" alt=\"\"></p>\n<p>由于只是对可视区域内的列表项进行渲染，所以为了保持列表容器的高度并可正常的触发滚动，将Html结构设计成如下结构：</p>\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><div class=\"code-wrapper\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br></pre></div></td><td class=\"code\"><pre><code class=\"hljs html\"><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">div</span> <span class=\"hljs-attr\">ref</span>=<span class=\"hljs-string\">&quot;list&quot;</span> <span class=\"hljs-attr\">class</span>=<span class=\"hljs-string\">&quot;infinite-list-container&quot;</span> @<span class=\"hljs-attr\">scroll</span>=<span class=\"hljs-string\">&quot;scrollEvent($event)&quot;</span>&gt;</span><br><br>    <span class=\"hljs-comment\">&lt;!-- 所有数据的总高度 --&gt;</span><br>    <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">div</span> <span class=\"hljs-attr\">class</span>=<span class=\"hljs-string\">&quot;infinite-list-phantom&quot;</span> <span class=\"hljs-attr\">:style</span>=<span class=\"hljs-string\">&quot;&#123; height: listHeight + &#x27;px&#x27; &#125;&quot;</span>&gt;</span><span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">div</span>&gt;</span><br><br>    <span class=\"hljs-comment\">&lt;!-- 可视区区域，可以当做滑块看待 --&gt;</span><br>    <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">div</span> <span class=\"hljs-attr\">class</span>=<span class=\"hljs-string\">&quot;infinite-list&quot;</span> <span class=\"hljs-attr\">:style</span>=<span class=\"hljs-string\">&quot;&#123; transform: getTransform &#125;&quot;</span>&gt;</span><br><br>      <span class=\"hljs-comment\">&lt;!-- 每一项数据 --&gt;</span><br>      <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">div</span></span><br><span class=\"hljs-tag\">        <span class=\"hljs-attr\">ref</span>=<span class=\"hljs-string\">&quot;items&quot;</span></span><br><span class=\"hljs-tag\">        <span class=\"hljs-attr\">class</span>=<span class=\"hljs-string\">&quot;infinite-list-item&quot;</span></span><br><span class=\"hljs-tag\">        <span class=\"hljs-attr\">v-for</span>=<span class=\"hljs-string\">&quot;item in visibleData&quot;</span></span><br><span class=\"hljs-tag\">        <span class=\"hljs-attr\">:key</span>=<span class=\"hljs-string\">&quot;item.id&quot;</span></span><br><span class=\"hljs-tag\">        <span class=\"hljs-attr\">:style</span>=<span class=\"hljs-string\">&quot;&#123; height: itemSize + &#x27;px&#x27;, lineHeight: itemSize + &#x27;px&#x27; &#125;&quot;</span></span><br><span class=\"hljs-tag\">      &gt;</span><br>        &#123;&#123; item.value &#125;&#125;<br>      <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">div</span>&gt;</span><br>    <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">div</span>&gt;</span><br>  <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">div</span>&gt;</span><br></code></pre></td></tr></table></figure>\n\n<p>接着，监听infinite-list-container的 <code>scroll事件</code>，获取滚动位置 <code>scrollTop</code>。</p>\n<ul>\n<li>列表总高度 <code>listHeight = listData.length * itemSize</code></li>\n<li>可显示的列表项数 <code>visibleCount = Math.ceil(screenHeight / itemSize)</code></li>\n<li>数据的起始索引 <code>startIndex = Math.floor(scrollTop / itemSize)</code></li>\n<li>数据的结束索引 <code>endIndex = startIndex + visibleCount</code></li>\n<li>列表显示数据为 <code>visibleData = listData.slice(startIndex,endIndex)</code></li>\n</ul>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\"><span class=\"hljs-title function_\">scrollEvent</span>(<span class=\"hljs-params\"></span>) &#123;<br>  <span class=\"hljs-comment\">//当前滚动位置</span><br>  <span class=\"hljs-keyword\">let</span> scrollTop = <span class=\"hljs-variable language_\">this</span>.<span class=\"hljs-property\">$refs</span>.<span class=\"hljs-property\">list</span>.<span class=\"hljs-property\">scrollTop</span>;<br><br>  <span class=\"hljs-comment\">//此时的开始索引（向下取整），itemSize 是 100</span><br>  <span class=\"hljs-variable language_\">this</span>.<span class=\"hljs-property\">start</span> = <span class=\"hljs-title class_\">Math</span>.<span class=\"hljs-title function_\">floor</span>(scrollTop / <span class=\"hljs-variable language_\">this</span>.<span class=\"hljs-property\">itemSize</span>);<br><br>  <span class=\"hljs-comment\">//此时的结束索引</span><br>  <span class=\"hljs-variable language_\">this</span>.<span class=\"hljs-property\">end</span> = <span class=\"hljs-variable language_\">this</span>.<span class=\"hljs-property\">start</span> + <span class=\"hljs-variable language_\">this</span>.<span class=\"hljs-property\">visibleCount</span>;<br><br>  <span class=\"hljs-comment\">//此时的偏移量</span><br>  <span class=\"hljs-variable language_\">this</span>.<span class=\"hljs-property\">startOffset</span> = scrollTop - (scrollTop % <span class=\"hljs-variable language_\">this</span>.<span class=\"hljs-property\">itemSize</span>);<br>&#125;,<br></code></pre></td></tr></table></figure>\n\n<p>当滚动后，由于 <code>渲染区域</code> 相对于 <code>可视区域</code> 已经发生了偏移，此时我需要获取一个 <code>偏移量startOffset</code>，通过样式控制将渲染区域偏移至可视区域中，当用户在滑动时，渲染区域就会根据 <code>startOffset</code> 计算出偏移量，渲染区域就会一直在可视区域内呈现。</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\"><span class=\"hljs-variable language_\">this</span>.<span class=\"hljs-property\">startOffset</span> = scrollTop - (scrollTop % <span class=\"hljs-variable language_\">this</span>.<span class=\"hljs-property\">itemSize</span>);<br><br><span class=\"hljs-comment\">// computed</span><br><span class=\"hljs-comment\">//偏移量对应的style</span><br><span class=\"hljs-title function_\">getTransform</span>(<span class=\"hljs-params\"></span>) &#123;<br>  <span class=\"hljs-keyword\">return</span> <span class=\"hljs-string\">`translate3d(0,<span class=\"hljs-subst\">$&#123;<span class=\"hljs-variable language_\">this</span>.startOffset&#125;</span>px,0)`</span>;<br>&#125;,<br></code></pre></td></tr></table></figure>\n\n<h1 id=\"完整代码\"><a href=\"#完整代码\" class=\"headerlink\" title=\"完整代码\"></a>完整代码</h1><figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs html\"><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">style</span>&gt;</span><span class=\"language-css\"></span><br><span class=\"language-css\">  <span class=\"hljs-selector-tag\">html</span>&#123;</span><br><span class=\"language-css\">    <span class=\"hljs-attribute\">height</span>: <span class=\"hljs-number\">100%</span>;</span><br><span class=\"language-css\">  &#125;</span><br><span class=\"language-css\">  <span class=\"hljs-selector-tag\">body</span>&#123;</span><br><span class=\"language-css\">    <span class=\"hljs-attribute\">height</span>: <span class=\"hljs-number\">100%</span>;</span><br><span class=\"language-css\">    <span class=\"hljs-attribute\">margin</span>:<span class=\"hljs-number\">0</span>;</span><br><span class=\"language-css\">  &#125;</span><br><span class=\"language-css\">  <span class=\"hljs-selector-id\">#app</span>&#123;</span><br><span class=\"language-css\">    <span class=\"hljs-attribute\">height</span>:<span class=\"hljs-number\">100%</span>;</span><br><span class=\"language-css\">  &#125;</span><br><span class=\"language-css\"></span><span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">style</span>&gt;</span><br><br><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">div</span> <span class=\"hljs-attr\">id</span>=<span class=\"hljs-string\">&quot;app&quot;</span>&gt;</span><br>  <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">VirtualList</span> <span class=\"hljs-attr\">:listData</span>=<span class=\"hljs-string\">&quot;state.data&quot;</span> <span class=\"hljs-attr\">:itemSize</span>=<span class=\"hljs-string\">&quot;100&quot;</span> /&gt;</span><br><span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">div</span>&gt;</span><br></code></pre></td></tr></table></figure>\n\n<p>VirtualList comp.</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br><span class=\"line\">103</span><br><span class=\"line\">104</span><br><span class=\"line\">105</span><br><span class=\"line\">106</span><br><span class=\"line\">107</span><br><span class=\"line\">108</span><br><span class=\"line\">109</span><br><span class=\"line\">110</span><br><span class=\"line\">111</span><br><span class=\"line\">112</span><br><span class=\"line\">113</span><br><span class=\"line\">114</span><br><span class=\"line\">115</span><br><span class=\"line\">116</span><br><span class=\"line\">117</span><br><span class=\"line\">118</span><br><span class=\"line\">119</span><br><span class=\"line\">120</span><br><span class=\"line\">121</span><br><span class=\"line\">122</span><br><span class=\"line\">123</span><br><span class=\"line\">124</span><br><span class=\"line\">125</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\">&lt;script&gt;<br><span class=\"hljs-keyword\">export</span> <span class=\"hljs-keyword\">default</span> &#123;<br>  <span class=\"hljs-attr\">name</span>: <span class=\"hljs-string\">&quot;VirtualList&quot;</span>,<br>  <span class=\"hljs-attr\">props</span>: &#123;<br>    <span class=\"hljs-comment\">//所有列表数据</span><br>    <span class=\"hljs-attr\">listData</span>: &#123;<br>      <span class=\"hljs-attr\">type</span>: <span class=\"hljs-title class_\">Array</span>,<br>      <span class=\"hljs-attr\">default</span>: <span class=\"hljs-function\">() =&gt;</span> [],<br>    &#125;,<br>    <span class=\"hljs-comment\">//每项高度</span><br>    <span class=\"hljs-attr\">itemSize</span>: &#123;<br>      <span class=\"hljs-attr\">type</span>: <span class=\"hljs-title class_\">Number</span>,<br>      <span class=\"hljs-attr\">default</span>: <span class=\"hljs-number\">200</span>,<br>    &#125;,<br>  &#125;,<br>  <span class=\"hljs-attr\">computed</span>: &#123;<br>    <span class=\"hljs-comment\">//列表总高度</span><br>    <span class=\"hljs-title function_\">listHeight</span>(<span class=\"hljs-params\"></span>) &#123;<br>      <span class=\"hljs-keyword\">return</span> <span class=\"hljs-variable language_\">this</span>.<span class=\"hljs-property\">listData</span>.<span class=\"hljs-property\">length</span> * <span class=\"hljs-variable language_\">this</span>.<span class=\"hljs-property\">itemSize</span>;<br>    &#125;,<br>    <span class=\"hljs-comment\">//可显示的列表项数</span><br>    <span class=\"hljs-title function_\">visibleCount</span>(<span class=\"hljs-params\"></span>) &#123;<br>      <span class=\"hljs-comment\">// 向上取整: Math.ceil(13.06) =&gt; 14，表示整个屏幕，可以放 14 条数据</span><br>      <span class=\"hljs-keyword\">return</span> <span class=\"hljs-title class_\">Math</span>.<span class=\"hljs-title function_\">ceil</span>(<span class=\"hljs-variable language_\">this</span>.<span class=\"hljs-property\">screenHeight</span> / <span class=\"hljs-variable language_\">this</span>.<span class=\"hljs-property\">itemSize</span>);<br>    &#125;,<br>    <span class=\"hljs-comment\">//偏移量对应的style</span><br>    <span class=\"hljs-title function_\">getTransform</span>(<span class=\"hljs-params\"></span>) &#123;<br>      <span class=\"hljs-keyword\">return</span> <span class=\"hljs-string\">`translate3d(0,<span class=\"hljs-subst\">$&#123;<span class=\"hljs-variable language_\">this</span>.startOffset&#125;</span>px,0)`</span>;<br>    &#125;,<br>    <span class=\"hljs-comment\">//获取真实显示列表数据</span><br>    <span class=\"hljs-title function_\">visibleData</span>(<span class=\"hljs-params\"></span>) &#123;<br>      <span class=\"hljs-keyword\">return</span> <span class=\"hljs-variable language_\">this</span>.<span class=\"hljs-property\">listData</span>.<span class=\"hljs-title function_\">slice</span>(<br>        <span class=\"hljs-variable language_\">this</span>.<span class=\"hljs-property\">start</span>,<br>        <span class=\"hljs-title class_\">Math</span>.<span class=\"hljs-title function_\">min</span>(<span class=\"hljs-variable language_\">this</span>.<span class=\"hljs-property\">end</span>, <span class=\"hljs-variable language_\">this</span>.<span class=\"hljs-property\">listData</span>.<span class=\"hljs-property\">length</span>)<br>      );<br>    &#125;,<br>  &#125;,<br>  <span class=\"hljs-title function_\">mounted</span>(<span class=\"hljs-params\"></span>) &#123;<br>    <span class=\"hljs-comment\">// this.$el 表示当前组件的根节点，这里是 infinite-list-container</span><br>    <span class=\"hljs-variable language_\">this</span>.<span class=\"hljs-property\">screenHeight</span> = <span class=\"hljs-variable language_\">this</span>.<span class=\"hljs-property\">$el</span>.<span class=\"hljs-property\">clientHeight</span>;<br>    <span class=\"hljs-variable language_\">this</span>.<span class=\"hljs-property\">start</span> = <span class=\"hljs-number\">0</span>;<br>    <span class=\"hljs-variable language_\">this</span>.<span class=\"hljs-property\">end</span> = <span class=\"hljs-variable language_\">this</span>.<span class=\"hljs-property\">start</span> + <span class=\"hljs-variable language_\">this</span>.<span class=\"hljs-property\">visibleCount</span>;<br>  &#125;,<br>  <span class=\"hljs-title function_\">data</span>(<span class=\"hljs-params\"></span>) &#123;<br>    <span class=\"hljs-keyword\">return</span> &#123;<br>      <span class=\"hljs-comment\">//可视区域高度</span><br>      <span class=\"hljs-attr\">screenHeight</span>: <span class=\"hljs-number\">0</span>,<br>      <span class=\"hljs-comment\">//偏移量</span><br>      <span class=\"hljs-attr\">startOffset</span>: <span class=\"hljs-number\">0</span>,<br>      <span class=\"hljs-comment\">//起始索引</span><br>      <span class=\"hljs-attr\">start</span>: <span class=\"hljs-number\">0</span>,<br>      <span class=\"hljs-comment\">//结束索引</span><br>      <span class=\"hljs-attr\">end</span>: <span class=\"hljs-literal\">null</span>,<br>    &#125;;<br>  &#125;,<br>  <span class=\"hljs-attr\">methods</span>: &#123;<br>    <span class=\"hljs-title function_\">scrollEvent</span>(<span class=\"hljs-params\"></span>) &#123;<br>      <span class=\"hljs-comment\">//当前滚动位置</span><br>      <span class=\"hljs-keyword\">let</span> scrollTop = <span class=\"hljs-variable language_\">this</span>.<span class=\"hljs-property\">$refs</span>.<span class=\"hljs-property\">list</span>.<span class=\"hljs-property\">scrollTop</span>;<br><br>      <span class=\"hljs-comment\">//此时的开始索引（向下取整），itemSize 是 100</span><br>      <span class=\"hljs-variable language_\">this</span>.<span class=\"hljs-property\">start</span> = <span class=\"hljs-title class_\">Math</span>.<span class=\"hljs-title function_\">floor</span>(scrollTop / <span class=\"hljs-variable language_\">this</span>.<span class=\"hljs-property\">itemSize</span>);<br>      <span class=\"hljs-comment\">//此时的结束索引</span><br>      <span class=\"hljs-variable language_\">this</span>.<span class=\"hljs-property\">end</span> = <span class=\"hljs-variable language_\">this</span>.<span class=\"hljs-property\">start</span> + <span class=\"hljs-variable language_\">this</span>.<span class=\"hljs-property\">visibleCount</span>;<br><br>      <span class=\"hljs-comment\">//此时的偏移量</span><br>      <span class=\"hljs-variable language_\">this</span>.<span class=\"hljs-property\">startOffset</span> = scrollTop - (scrollTop % <span class=\"hljs-variable language_\">this</span>.<span class=\"hljs-property\">itemSize</span>);<br>    &#125;,<br>  &#125;,<br>&#125;;<br>&lt;/script&gt;<br><br><span class=\"language-xml\"><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">template</span>&gt;</span></span><br><span class=\"language-xml\">  <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">div</span> <span class=\"hljs-attr\">ref</span>=<span class=\"hljs-string\">&quot;list&quot;</span> <span class=\"hljs-attr\">class</span>=<span class=\"hljs-string\">&quot;infinite-list-container&quot;</span> @<span class=\"hljs-attr\">scroll</span>=<span class=\"hljs-string\">&quot;scrollEvent($event)&quot;</span>&gt;</span></span><br><span class=\"language-xml\"></span><br><span class=\"language-xml\">    <span class=\"hljs-comment\">&lt;!-- 所有数据的总高度 --&gt;</span></span><br><span class=\"language-xml\">    <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">div</span> <span class=\"hljs-attr\">class</span>=<span class=\"hljs-string\">&quot;infinite-list-phantom&quot;</span> <span class=\"hljs-attr\">:style</span>=<span class=\"hljs-string\">&quot;&#123; height: listHeight + &#x27;px&#x27; &#125;&quot;</span>&gt;</span><span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">div</span>&gt;</span></span><br><span class=\"language-xml\"></span><br><span class=\"language-xml\">    <span class=\"hljs-comment\">&lt;!-- 可视区区域，可以当做滑块看待 --&gt;</span></span><br><span class=\"language-xml\">    <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">div</span> <span class=\"hljs-attr\">class</span>=<span class=\"hljs-string\">&quot;infinite-list&quot;</span> <span class=\"hljs-attr\">:style</span>=<span class=\"hljs-string\">&quot;&#123; transform: getTransform &#125;&quot;</span>&gt;</span></span><br><span class=\"language-xml\">      <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">div</span></span></span><br><span class=\"hljs-tag\"><span class=\"language-xml\">        <span class=\"hljs-attr\">ref</span>=<span class=\"hljs-string\">&quot;items&quot;</span></span></span><br><span class=\"hljs-tag\"><span class=\"language-xml\">        <span class=\"hljs-attr\">class</span>=<span class=\"hljs-string\">&quot;infinite-list-item&quot;</span></span></span><br><span class=\"hljs-tag\"><span class=\"language-xml\">        <span class=\"hljs-attr\">v-for</span>=<span class=\"hljs-string\">&quot;item in visibleData&quot;</span></span></span><br><span class=\"hljs-tag\"><span class=\"language-xml\">        <span class=\"hljs-attr\">:key</span>=<span class=\"hljs-string\">&quot;item.id&quot;</span></span></span><br><span class=\"hljs-tag\"><span class=\"language-xml\">        <span class=\"hljs-attr\">:style</span>=<span class=\"hljs-string\">&quot;&#123; height: itemSize + &#x27;px&#x27;, lineHeight: itemSize + &#x27;px&#x27; &#125;&quot;</span></span></span><br><span class=\"hljs-tag\"><span class=\"language-xml\">      &gt;</span></span><br><span class=\"language-xml\">        &#123;&#123; item.value &#125;&#125;</span><br><span class=\"language-xml\">      <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">div</span>&gt;</span></span><br><span class=\"language-xml\">    <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">div</span>&gt;</span></span><br><span class=\"language-xml\">  <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">div</span>&gt;</span></span><br><span class=\"language-xml\"><span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">template</span>&gt;</span></span><br><br><span class=\"language-xml\"><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">style</span> <span class=\"hljs-attr\">scoped</span>&gt;</span><span class=\"language-css\"></span></span><br><span class=\"language-css\"><span class=\"language-xml\"><span class=\"hljs-selector-class\">.infinite-list-container</span> &#123;</span></span><br><span class=\"language-css\"><span class=\"language-xml\">  <span class=\"hljs-attribute\">height</span>: <span class=\"hljs-number\">100%</span>;</span></span><br><span class=\"language-css\"><span class=\"language-xml\">  <span class=\"hljs-attribute\">overflow</span>: auto;</span></span><br><span class=\"language-css\"><span class=\"language-xml\">  <span class=\"hljs-attribute\">position</span>: relative;</span></span><br><span class=\"language-css\"><span class=\"language-xml\">  -webkit-<span class=\"hljs-attribute\">overflow</span>-scrolling: touch;</span></span><br><span class=\"language-css\"><span class=\"language-xml\">&#125;</span></span><br><span class=\"language-css\"><span class=\"language-xml\"></span></span><br><span class=\"language-css\"><span class=\"language-xml\"><span class=\"hljs-selector-class\">.infinite-list-phantom</span> &#123;</span></span><br><span class=\"language-css\"><span class=\"language-xml\">  <span class=\"hljs-attribute\">position</span>: absolute;</span></span><br><span class=\"language-css\"><span class=\"language-xml\">  <span class=\"hljs-attribute\">left</span>: <span class=\"hljs-number\">0</span>;</span></span><br><span class=\"language-css\"><span class=\"language-xml\">  <span class=\"hljs-attribute\">top</span>: <span class=\"hljs-number\">0</span>;</span></span><br><span class=\"language-css\"><span class=\"language-xml\">  <span class=\"hljs-attribute\">right</span>: <span class=\"hljs-number\">0</span>;</span></span><br><span class=\"language-css\"><span class=\"language-xml\">  <span class=\"hljs-attribute\">z-index</span>: -<span class=\"hljs-number\">1</span>;</span></span><br><span class=\"language-css\"><span class=\"language-xml\">&#125;</span></span><br><span class=\"language-css\"><span class=\"language-xml\"></span></span><br><span class=\"language-css\"><span class=\"language-xml\"><span class=\"hljs-selector-class\">.infinite-list</span> &#123;</span></span><br><span class=\"language-css\"><span class=\"language-xml\">  <span class=\"hljs-attribute\">left</span>: <span class=\"hljs-number\">0</span>;</span></span><br><span class=\"language-css\"><span class=\"language-xml\">  <span class=\"hljs-attribute\">right</span>: <span class=\"hljs-number\">0</span>;</span></span><br><span class=\"language-css\"><span class=\"language-xml\">  <span class=\"hljs-attribute\">top</span>: <span class=\"hljs-number\">0</span>;</span></span><br><span class=\"language-css\"><span class=\"language-xml\">  <span class=\"hljs-attribute\">position</span>: absolute;</span></span><br><span class=\"language-css\"><span class=\"language-xml\">  <span class=\"hljs-attribute\">text-align</span>: center;</span></span><br><span class=\"language-css\"><span class=\"language-xml\">&#125;</span></span><br><span class=\"language-css\"><span class=\"language-xml\"></span></span><br><span class=\"language-css\"><span class=\"language-xml\"><span class=\"hljs-selector-class\">.infinite-list-item</span> &#123;</span></span><br><span class=\"language-css\"><span class=\"language-xml\">  <span class=\"hljs-attribute\">padding</span>: <span class=\"hljs-number\">10px</span>;</span></span><br><span class=\"language-css\"><span class=\"language-xml\">  <span class=\"hljs-attribute\">color</span>: <span class=\"hljs-number\">#555</span>;</span></span><br><span class=\"language-css\"><span class=\"language-xml\">  <span class=\"hljs-attribute\">box-sizing</span>: border-box;</span></span><br><span class=\"language-css\"><span class=\"language-xml\">  <span class=\"hljs-attribute\">border-bottom</span>: <span class=\"hljs-number\">1px</span> solid <span class=\"hljs-number\">#999</span>;</span></span><br><span class=\"language-css\"><span class=\"language-xml\">&#125;</span></span><br><span class=\"language-css\"><span class=\"language-xml\"></span><span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">style</span>&gt;</span></span><br><br></code></pre></td></tr></table></figure>\n\n<h1 id=\"列表项动态高度\"><a href=\"#列表项动态高度\" class=\"headerlink\" title=\"列表项动态高度\"></a>列表项动态高度</h1><p>在之前的实现中，列表项的高度是固定的，因为高度固定，所以可以很轻易的获取列表项的整体高度以及滚动时的显示数据与对应的偏移量。</p>\n<p>而实际应用的时候，当列表中包含文本之类的可变内容，会导致 <code>列表项的高度并不相同</code>。</p>\n<p>比如这样：</p>\n<p><img src=\"https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-user-assets/2019/10/29/16e1519f1e121be9~tplv-t2oaga2asx-zoom-in-crop-mark:4536:0:0:0.image\" alt=\"\"></p>\n<p>在虚拟列表中应用动态高度的解决方案一般有如下三种：</p>\n<blockquote>\n<p>1.对组件属性itemSize进行扩展，支持传递类型为数字、数组、函数</p>\n</blockquote>\n<ul>\n<li>可以是一个固定值，如 100，此时列表项是固高的</li>\n<li>可以是一个包含所有列表项高度的数据，如 [50, 20, 100, 80, …]</li>\n<li>可以是一个根据列表项索引返回其高度的函数：(index: number): number</li>\n</ul>\n<p>这种方式虽然有比较好的灵活度，但仅适用于可以预先知道或可以通过计算得知列表项高度的情况，依然无法解决列表项高度由内容撑开的情况。</p>\n<blockquote>\n<p>2.将列表项 <code>渲染到屏幕外</code>，对其高度进行测量并缓存，然后再将其渲染至可视区域内。</p>\n</blockquote>\n<p>由于 <code>预先渲染至屏幕外</code>，再渲染至屏幕内，这导致渲染成本增加一倍，这对于数百万用户在低端移动设备上使用的产品来说是不切实际的。</p>\n<blockquote>\n<p>3.以预估高度先行渲染，然后获取真实高度并缓存。</p>\n</blockquote>\n<p>这是可以选择的实现方式，可以避免前两种方案的不足。</p>\n","site":{"data":{}},"wordcount":5929,"more":"<h1 id=\"前言\"><a href=\"#前言\" class=\"headerlink\" title=\"前言\"></a>前言</h1><p>在工作中，有时会遇到需要一些不能使用分页方式来加载列表数据的业务情况，对于此，我们称这种列表叫做长列表。比如，在一些外汇交易系统中，前端会实时的展示用户的持仓情况(收益、亏损、手数等)，此时对于用户的持仓列表一般是不能分页的。</p>\n<p><code>时间分片</code> 提到了可以使用时间分片的方式来对长列表进行渲染，但这种方式更适用于列表项的DOM结构十分简单的情况。本文会介绍使用虚拟列表的方式，来同时加载大量数据。</p>\n<p>当我们渲染10w条数据时，其实主要是的时间花费在 <code>Recalculate Style</code> 和 <code>Layout</code> 上</p>\n<ul>\n<li>Recalculate Style：样式计算，浏览器根据css选择器计算哪些元素应该应用哪些规则，确定每个元素具体的样式。</li>\n<li>Layout：布局，知道元素应用哪些规则之后，浏览器开始计算它要占据的空间大小及其在屏幕的位置。</li>\n</ul>\n<p><img src=\"/img/render-10w-data.jpg\" alt=\"\"></p>\n<p>在实际的工作中，列表项必然不会像例子中仅仅只由一个li标签组成，必然是由复杂DOM节点组成的。</p>\n<p>那么可以想象的是，当列表项数过多并且列表项结构复杂的时候，同时渲染时，会在<code>Recalculate Style</code>和<code>Layout</code>阶段消耗大量的时间。</p>\n<p>而<code>虚拟列表</code>就是解决这一问题的一种实现。</p>\n<h1 id=\"什么是虚拟列表\"><a href=\"#什么是虚拟列表\" class=\"headerlink\" title=\"什么是虚拟列表\"></a>什么是虚拟列表</h1><p>虚拟列表其实是按需显示的一种实现，即只对可见区域进行渲染，对非可见区域中的数据不渲染或部分渲染的技术，从而达到极高的渲染性能。</p>\n<p>假设有1万条记录需要同时渲染，我们屏幕的可见区域的高度为1000px,而列表项的高度为50px，则此时我们在屏幕中最多只能看到20个列表项，那么在首次渲染的时候，我们只需加载20条即可。</p>\n<p><img src=\"https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-user-assets/2019/10/29/16e15195cf16a558~tplv-t2oaga2asx-zoom-in-crop-mark:4536:0:0:0.image\" alt=\"\"></p>\n<p>说完首次加载，再分析一下当滚动发生时，我们可以通过计算当前滚动值得知此时在屏幕可见区域应该显示的列表项。</p>\n<p>假设滚动发生，滚动条距顶部的位置为150px,则我们可得知在可见区域内的列表项为第4项至`第13项。</p>\n<p><img src=\"https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-user-assets/2019/10/29/16e15197c273cbd9~tplv-t2oaga2asx-zoom-in-crop-mark:4536:0:0:0.image\" alt=\"\"></p>\n<h1 id=\"实现\"><a href=\"#实现\" class=\"headerlink\" title=\"实现\"></a>实现</h1><p>虚拟列表的实现，实际上是在首屏加载的时候，只加载 <code>可视区域</code> 内需要的列表项，当滚动发生时，通过计算动态获得可视区域内的列表项，并将非可视区域内存在的列表项删除。</p>\n<ul>\n<li>计算当前可视区域<code>起始数据</code>索引（startIndex）</li>\n<li>计算当前可视区域<code>结束数据</code>索引（endIndex）</li>\n<li>计算当前可视区域的数据，并渲染到页面中</li>\n<li>计算startIndex对应的数据在整个列表中的偏移位置startOffset并设置到列表上</li>\n</ul>\n<p><img src=\"https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-user-assets/2019/10/29/16e1519a393dee2c~tplv-t2oaga2asx-zoom-in-crop-mark:4536:0:0:0.image\" alt=\"\"></p>\n<p>由于只是对可视区域内的列表项进行渲染，所以为了保持列表容器的高度并可正常的触发滚动，将Html结构设计成如下结构：</p>\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs html\"><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">div</span> <span class=\"hljs-attr\">ref</span>=<span class=\"hljs-string\">&quot;list&quot;</span> <span class=\"hljs-attr\">class</span>=<span class=\"hljs-string\">&quot;infinite-list-container&quot;</span> @<span class=\"hljs-attr\">scroll</span>=<span class=\"hljs-string\">&quot;scrollEvent($event)&quot;</span>&gt;</span><br><br>    <span class=\"hljs-comment\">&lt;!-- 所有数据的总高度 --&gt;</span><br>    <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">div</span> <span class=\"hljs-attr\">class</span>=<span class=\"hljs-string\">&quot;infinite-list-phantom&quot;</span> <span class=\"hljs-attr\">:style</span>=<span class=\"hljs-string\">&quot;&#123; height: listHeight + &#x27;px&#x27; &#125;&quot;</span>&gt;</span><span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">div</span>&gt;</span><br><br>    <span class=\"hljs-comment\">&lt;!-- 可视区区域，可以当做滑块看待 --&gt;</span><br>    <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">div</span> <span class=\"hljs-attr\">class</span>=<span class=\"hljs-string\">&quot;infinite-list&quot;</span> <span class=\"hljs-attr\">:style</span>=<span class=\"hljs-string\">&quot;&#123; transform: getTransform &#125;&quot;</span>&gt;</span><br><br>      <span class=\"hljs-comment\">&lt;!-- 每一项数据 --&gt;</span><br>      <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">div</span></span><br><span class=\"hljs-tag\">        <span class=\"hljs-attr\">ref</span>=<span class=\"hljs-string\">&quot;items&quot;</span></span><br><span class=\"hljs-tag\">        <span class=\"hljs-attr\">class</span>=<span class=\"hljs-string\">&quot;infinite-list-item&quot;</span></span><br><span class=\"hljs-tag\">        <span class=\"hljs-attr\">v-for</span>=<span class=\"hljs-string\">&quot;item in visibleData&quot;</span></span><br><span class=\"hljs-tag\">        <span class=\"hljs-attr\">:key</span>=<span class=\"hljs-string\">&quot;item.id&quot;</span></span><br><span class=\"hljs-tag\">        <span class=\"hljs-attr\">:style</span>=<span class=\"hljs-string\">&quot;&#123; height: itemSize + &#x27;px&#x27;, lineHeight: itemSize + &#x27;px&#x27; &#125;&quot;</span></span><br><span class=\"hljs-tag\">      &gt;</span><br>        &#123;&#123; item.value &#125;&#125;<br>      <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">div</span>&gt;</span><br>    <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">div</span>&gt;</span><br>  <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">div</span>&gt;</span><br></code></pre></td></tr></table></figure>\n\n<p>接着，监听infinite-list-container的 <code>scroll事件</code>，获取滚动位置 <code>scrollTop</code>。</p>\n<ul>\n<li>列表总高度 <code>listHeight = listData.length * itemSize</code></li>\n<li>可显示的列表项数 <code>visibleCount = Math.ceil(screenHeight / itemSize)</code></li>\n<li>数据的起始索引 <code>startIndex = Math.floor(scrollTop / itemSize)</code></li>\n<li>数据的结束索引 <code>endIndex = startIndex + visibleCount</code></li>\n<li>列表显示数据为 <code>visibleData = listData.slice(startIndex,endIndex)</code></li>\n</ul>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\"><span class=\"hljs-title function_\">scrollEvent</span>(<span class=\"hljs-params\"></span>) &#123;<br>  <span class=\"hljs-comment\">//当前滚动位置</span><br>  <span class=\"hljs-keyword\">let</span> scrollTop = <span class=\"hljs-variable language_\">this</span>.<span class=\"hljs-property\">$refs</span>.<span class=\"hljs-property\">list</span>.<span class=\"hljs-property\">scrollTop</span>;<br><br>  <span class=\"hljs-comment\">//此时的开始索引（向下取整），itemSize 是 100</span><br>  <span class=\"hljs-variable language_\">this</span>.<span class=\"hljs-property\">start</span> = <span class=\"hljs-title class_\">Math</span>.<span class=\"hljs-title function_\">floor</span>(scrollTop / <span class=\"hljs-variable language_\">this</span>.<span class=\"hljs-property\">itemSize</span>);<br><br>  <span class=\"hljs-comment\">//此时的结束索引</span><br>  <span class=\"hljs-variable language_\">this</span>.<span class=\"hljs-property\">end</span> = <span class=\"hljs-variable language_\">this</span>.<span class=\"hljs-property\">start</span> + <span class=\"hljs-variable language_\">this</span>.<span class=\"hljs-property\">visibleCount</span>;<br><br>  <span class=\"hljs-comment\">//此时的偏移量</span><br>  <span class=\"hljs-variable language_\">this</span>.<span class=\"hljs-property\">startOffset</span> = scrollTop - (scrollTop % <span class=\"hljs-variable language_\">this</span>.<span class=\"hljs-property\">itemSize</span>);<br>&#125;,<br></code></pre></td></tr></table></figure>\n\n<p>当滚动后，由于 <code>渲染区域</code> 相对于 <code>可视区域</code> 已经发生了偏移，此时我需要获取一个 <code>偏移量startOffset</code>，通过样式控制将渲染区域偏移至可视区域中，当用户在滑动时，渲染区域就会根据 <code>startOffset</code> 计算出偏移量，渲染区域就会一直在可视区域内呈现。</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\"><span class=\"hljs-variable language_\">this</span>.<span class=\"hljs-property\">startOffset</span> = scrollTop - (scrollTop % <span class=\"hljs-variable language_\">this</span>.<span class=\"hljs-property\">itemSize</span>);<br><br><span class=\"hljs-comment\">// computed</span><br><span class=\"hljs-comment\">//偏移量对应的style</span><br><span class=\"hljs-title function_\">getTransform</span>(<span class=\"hljs-params\"></span>) &#123;<br>  <span class=\"hljs-keyword\">return</span> <span class=\"hljs-string\">`translate3d(0,<span class=\"hljs-subst\">$&#123;<span class=\"hljs-variable language_\">this</span>.startOffset&#125;</span>px,0)`</span>;<br>&#125;,<br></code></pre></td></tr></table></figure>\n\n<h1 id=\"完整代码\"><a href=\"#完整代码\" class=\"headerlink\" title=\"完整代码\"></a>完整代码</h1><figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs html\"><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">style</span>&gt;</span><span class=\"language-css\"></span><br><span class=\"language-css\">  <span class=\"hljs-selector-tag\">html</span>&#123;</span><br><span class=\"language-css\">    <span class=\"hljs-attribute\">height</span>: <span class=\"hljs-number\">100%</span>;</span><br><span class=\"language-css\">  &#125;</span><br><span class=\"language-css\">  <span class=\"hljs-selector-tag\">body</span>&#123;</span><br><span class=\"language-css\">    <span class=\"hljs-attribute\">height</span>: <span class=\"hljs-number\">100%</span>;</span><br><span class=\"language-css\">    <span class=\"hljs-attribute\">margin</span>:<span class=\"hljs-number\">0</span>;</span><br><span class=\"language-css\">  &#125;</span><br><span class=\"language-css\">  <span class=\"hljs-selector-id\">#app</span>&#123;</span><br><span class=\"language-css\">    <span class=\"hljs-attribute\">height</span>:<span class=\"hljs-number\">100%</span>;</span><br><span class=\"language-css\">  &#125;</span><br><span class=\"language-css\"></span><span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">style</span>&gt;</span><br><br><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">div</span> <span class=\"hljs-attr\">id</span>=<span class=\"hljs-string\">&quot;app&quot;</span>&gt;</span><br>  <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">VirtualList</span> <span class=\"hljs-attr\">:listData</span>=<span class=\"hljs-string\">&quot;state.data&quot;</span> <span class=\"hljs-attr\">:itemSize</span>=<span class=\"hljs-string\">&quot;100&quot;</span> /&gt;</span><br><span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">div</span>&gt;</span><br></code></pre></td></tr></table></figure>\n\n<p>VirtualList comp.</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br><span class=\"line\">103</span><br><span class=\"line\">104</span><br><span class=\"line\">105</span><br><span class=\"line\">106</span><br><span class=\"line\">107</span><br><span class=\"line\">108</span><br><span class=\"line\">109</span><br><span class=\"line\">110</span><br><span class=\"line\">111</span><br><span class=\"line\">112</span><br><span class=\"line\">113</span><br><span class=\"line\">114</span><br><span class=\"line\">115</span><br><span class=\"line\">116</span><br><span class=\"line\">117</span><br><span class=\"line\">118</span><br><span class=\"line\">119</span><br><span class=\"line\">120</span><br><span class=\"line\">121</span><br><span class=\"line\">122</span><br><span class=\"line\">123</span><br><span class=\"line\">124</span><br><span class=\"line\">125</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\">&lt;script&gt;<br><span class=\"hljs-keyword\">export</span> <span class=\"hljs-keyword\">default</span> &#123;<br>  <span class=\"hljs-attr\">name</span>: <span class=\"hljs-string\">&quot;VirtualList&quot;</span>,<br>  <span class=\"hljs-attr\">props</span>: &#123;<br>    <span class=\"hljs-comment\">//所有列表数据</span><br>    <span class=\"hljs-attr\">listData</span>: &#123;<br>      <span class=\"hljs-attr\">type</span>: <span class=\"hljs-title class_\">Array</span>,<br>      <span class=\"hljs-attr\">default</span>: <span class=\"hljs-function\">() =&gt;</span> [],<br>    &#125;,<br>    <span class=\"hljs-comment\">//每项高度</span><br>    <span class=\"hljs-attr\">itemSize</span>: &#123;<br>      <span class=\"hljs-attr\">type</span>: <span class=\"hljs-title class_\">Number</span>,<br>      <span class=\"hljs-attr\">default</span>: <span class=\"hljs-number\">200</span>,<br>    &#125;,<br>  &#125;,<br>  <span class=\"hljs-attr\">computed</span>: &#123;<br>    <span class=\"hljs-comment\">//列表总高度</span><br>    <span class=\"hljs-title function_\">listHeight</span>(<span class=\"hljs-params\"></span>) &#123;<br>      <span class=\"hljs-keyword\">return</span> <span class=\"hljs-variable language_\">this</span>.<span class=\"hljs-property\">listData</span>.<span class=\"hljs-property\">length</span> * <span class=\"hljs-variable language_\">this</span>.<span class=\"hljs-property\">itemSize</span>;<br>    &#125;,<br>    <span class=\"hljs-comment\">//可显示的列表项数</span><br>    <span class=\"hljs-title function_\">visibleCount</span>(<span class=\"hljs-params\"></span>) &#123;<br>      <span class=\"hljs-comment\">// 向上取整: Math.ceil(13.06) =&gt; 14，表示整个屏幕，可以放 14 条数据</span><br>      <span class=\"hljs-keyword\">return</span> <span class=\"hljs-title class_\">Math</span>.<span class=\"hljs-title function_\">ceil</span>(<span class=\"hljs-variable language_\">this</span>.<span class=\"hljs-property\">screenHeight</span> / <span class=\"hljs-variable language_\">this</span>.<span class=\"hljs-property\">itemSize</span>);<br>    &#125;,<br>    <span class=\"hljs-comment\">//偏移量对应的style</span><br>    <span class=\"hljs-title function_\">getTransform</span>(<span class=\"hljs-params\"></span>) &#123;<br>      <span class=\"hljs-keyword\">return</span> <span class=\"hljs-string\">`translate3d(0,<span class=\"hljs-subst\">$&#123;<span class=\"hljs-variable language_\">this</span>.startOffset&#125;</span>px,0)`</span>;<br>    &#125;,<br>    <span class=\"hljs-comment\">//获取真实显示列表数据</span><br>    <span class=\"hljs-title function_\">visibleData</span>(<span class=\"hljs-params\"></span>) &#123;<br>      <span class=\"hljs-keyword\">return</span> <span class=\"hljs-variable language_\">this</span>.<span class=\"hljs-property\">listData</span>.<span class=\"hljs-title function_\">slice</span>(<br>        <span class=\"hljs-variable language_\">this</span>.<span class=\"hljs-property\">start</span>,<br>        <span class=\"hljs-title class_\">Math</span>.<span class=\"hljs-title function_\">min</span>(<span class=\"hljs-variable language_\">this</span>.<span class=\"hljs-property\">end</span>, <span class=\"hljs-variable language_\">this</span>.<span class=\"hljs-property\">listData</span>.<span class=\"hljs-property\">length</span>)<br>      );<br>    &#125;,<br>  &#125;,<br>  <span class=\"hljs-title function_\">mounted</span>(<span class=\"hljs-params\"></span>) &#123;<br>    <span class=\"hljs-comment\">// this.$el 表示当前组件的根节点，这里是 infinite-list-container</span><br>    <span class=\"hljs-variable language_\">this</span>.<span class=\"hljs-property\">screenHeight</span> = <span class=\"hljs-variable language_\">this</span>.<span class=\"hljs-property\">$el</span>.<span class=\"hljs-property\">clientHeight</span>;<br>    <span class=\"hljs-variable language_\">this</span>.<span class=\"hljs-property\">start</span> = <span class=\"hljs-number\">0</span>;<br>    <span class=\"hljs-variable language_\">this</span>.<span class=\"hljs-property\">end</span> = <span class=\"hljs-variable language_\">this</span>.<span class=\"hljs-property\">start</span> + <span class=\"hljs-variable language_\">this</span>.<span class=\"hljs-property\">visibleCount</span>;<br>  &#125;,<br>  <span class=\"hljs-title function_\">data</span>(<span class=\"hljs-params\"></span>) &#123;<br>    <span class=\"hljs-keyword\">return</span> &#123;<br>      <span class=\"hljs-comment\">//可视区域高度</span><br>      <span class=\"hljs-attr\">screenHeight</span>: <span class=\"hljs-number\">0</span>,<br>      <span class=\"hljs-comment\">//偏移量</span><br>      <span class=\"hljs-attr\">startOffset</span>: <span class=\"hljs-number\">0</span>,<br>      <span class=\"hljs-comment\">//起始索引</span><br>      <span class=\"hljs-attr\">start</span>: <span class=\"hljs-number\">0</span>,<br>      <span class=\"hljs-comment\">//结束索引</span><br>      <span class=\"hljs-attr\">end</span>: <span class=\"hljs-literal\">null</span>,<br>    &#125;;<br>  &#125;,<br>  <span class=\"hljs-attr\">methods</span>: &#123;<br>    <span class=\"hljs-title function_\">scrollEvent</span>(<span class=\"hljs-params\"></span>) &#123;<br>      <span class=\"hljs-comment\">//当前滚动位置</span><br>      <span class=\"hljs-keyword\">let</span> scrollTop = <span class=\"hljs-variable language_\">this</span>.<span class=\"hljs-property\">$refs</span>.<span class=\"hljs-property\">list</span>.<span class=\"hljs-property\">scrollTop</span>;<br><br>      <span class=\"hljs-comment\">//此时的开始索引（向下取整），itemSize 是 100</span><br>      <span class=\"hljs-variable language_\">this</span>.<span class=\"hljs-property\">start</span> = <span class=\"hljs-title class_\">Math</span>.<span class=\"hljs-title function_\">floor</span>(scrollTop / <span class=\"hljs-variable language_\">this</span>.<span class=\"hljs-property\">itemSize</span>);<br>      <span class=\"hljs-comment\">//此时的结束索引</span><br>      <span class=\"hljs-variable language_\">this</span>.<span class=\"hljs-property\">end</span> = <span class=\"hljs-variable language_\">this</span>.<span class=\"hljs-property\">start</span> + <span class=\"hljs-variable language_\">this</span>.<span class=\"hljs-property\">visibleCount</span>;<br><br>      <span class=\"hljs-comment\">//此时的偏移量</span><br>      <span class=\"hljs-variable language_\">this</span>.<span class=\"hljs-property\">startOffset</span> = scrollTop - (scrollTop % <span class=\"hljs-variable language_\">this</span>.<span class=\"hljs-property\">itemSize</span>);<br>    &#125;,<br>  &#125;,<br>&#125;;<br>&lt;/script&gt;<br><br><span class=\"language-xml\"><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">template</span>&gt;</span></span><br><span class=\"language-xml\">  <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">div</span> <span class=\"hljs-attr\">ref</span>=<span class=\"hljs-string\">&quot;list&quot;</span> <span class=\"hljs-attr\">class</span>=<span class=\"hljs-string\">&quot;infinite-list-container&quot;</span> @<span class=\"hljs-attr\">scroll</span>=<span class=\"hljs-string\">&quot;scrollEvent($event)&quot;</span>&gt;</span></span><br><span class=\"language-xml\"></span><br><span class=\"language-xml\">    <span class=\"hljs-comment\">&lt;!-- 所有数据的总高度 --&gt;</span></span><br><span class=\"language-xml\">    <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">div</span> <span class=\"hljs-attr\">class</span>=<span class=\"hljs-string\">&quot;infinite-list-phantom&quot;</span> <span class=\"hljs-attr\">:style</span>=<span class=\"hljs-string\">&quot;&#123; height: listHeight + &#x27;px&#x27; &#125;&quot;</span>&gt;</span><span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">div</span>&gt;</span></span><br><span class=\"language-xml\"></span><br><span class=\"language-xml\">    <span class=\"hljs-comment\">&lt;!-- 可视区区域，可以当做滑块看待 --&gt;</span></span><br><span class=\"language-xml\">    <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">div</span> <span class=\"hljs-attr\">class</span>=<span class=\"hljs-string\">&quot;infinite-list&quot;</span> <span class=\"hljs-attr\">:style</span>=<span class=\"hljs-string\">&quot;&#123; transform: getTransform &#125;&quot;</span>&gt;</span></span><br><span class=\"language-xml\">      <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">div</span></span></span><br><span class=\"hljs-tag\"><span class=\"language-xml\">        <span class=\"hljs-attr\">ref</span>=<span class=\"hljs-string\">&quot;items&quot;</span></span></span><br><span class=\"hljs-tag\"><span class=\"language-xml\">        <span class=\"hljs-attr\">class</span>=<span class=\"hljs-string\">&quot;infinite-list-item&quot;</span></span></span><br><span class=\"hljs-tag\"><span class=\"language-xml\">        <span class=\"hljs-attr\">v-for</span>=<span class=\"hljs-string\">&quot;item in visibleData&quot;</span></span></span><br><span class=\"hljs-tag\"><span class=\"language-xml\">        <span class=\"hljs-attr\">:key</span>=<span class=\"hljs-string\">&quot;item.id&quot;</span></span></span><br><span class=\"hljs-tag\"><span class=\"language-xml\">        <span class=\"hljs-attr\">:style</span>=<span class=\"hljs-string\">&quot;&#123; height: itemSize + &#x27;px&#x27;, lineHeight: itemSize + &#x27;px&#x27; &#125;&quot;</span></span></span><br><span class=\"hljs-tag\"><span class=\"language-xml\">      &gt;</span></span><br><span class=\"language-xml\">        &#123;&#123; item.value &#125;&#125;</span><br><span class=\"language-xml\">      <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">div</span>&gt;</span></span><br><span class=\"language-xml\">    <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">div</span>&gt;</span></span><br><span class=\"language-xml\">  <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">div</span>&gt;</span></span><br><span class=\"language-xml\"><span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">template</span>&gt;</span></span><br><br><span class=\"language-xml\"><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">style</span> <span class=\"hljs-attr\">scoped</span>&gt;</span><span class=\"language-css\"></span></span><br><span class=\"language-css\"><span class=\"language-xml\"><span class=\"hljs-selector-class\">.infinite-list-container</span> &#123;</span></span><br><span class=\"language-css\"><span class=\"language-xml\">  <span class=\"hljs-attribute\">height</span>: <span class=\"hljs-number\">100%</span>;</span></span><br><span class=\"language-css\"><span class=\"language-xml\">  <span class=\"hljs-attribute\">overflow</span>: auto;</span></span><br><span class=\"language-css\"><span class=\"language-xml\">  <span class=\"hljs-attribute\">position</span>: relative;</span></span><br><span class=\"language-css\"><span class=\"language-xml\">  -webkit-<span class=\"hljs-attribute\">overflow</span>-scrolling: touch;</span></span><br><span class=\"language-css\"><span class=\"language-xml\">&#125;</span></span><br><span class=\"language-css\"><span class=\"language-xml\"></span></span><br><span class=\"language-css\"><span class=\"language-xml\"><span class=\"hljs-selector-class\">.infinite-list-phantom</span> &#123;</span></span><br><span class=\"language-css\"><span class=\"language-xml\">  <span class=\"hljs-attribute\">position</span>: absolute;</span></span><br><span class=\"language-css\"><span class=\"language-xml\">  <span class=\"hljs-attribute\">left</span>: <span class=\"hljs-number\">0</span>;</span></span><br><span class=\"language-css\"><span class=\"language-xml\">  <span class=\"hljs-attribute\">top</span>: <span class=\"hljs-number\">0</span>;</span></span><br><span class=\"language-css\"><span class=\"language-xml\">  <span class=\"hljs-attribute\">right</span>: <span class=\"hljs-number\">0</span>;</span></span><br><span class=\"language-css\"><span class=\"language-xml\">  <span class=\"hljs-attribute\">z-index</span>: -<span class=\"hljs-number\">1</span>;</span></span><br><span class=\"language-css\"><span class=\"language-xml\">&#125;</span></span><br><span class=\"language-css\"><span class=\"language-xml\"></span></span><br><span class=\"language-css\"><span class=\"language-xml\"><span class=\"hljs-selector-class\">.infinite-list</span> &#123;</span></span><br><span class=\"language-css\"><span class=\"language-xml\">  <span class=\"hljs-attribute\">left</span>: <span class=\"hljs-number\">0</span>;</span></span><br><span class=\"language-css\"><span class=\"language-xml\">  <span class=\"hljs-attribute\">right</span>: <span class=\"hljs-number\">0</span>;</span></span><br><span class=\"language-css\"><span class=\"language-xml\">  <span class=\"hljs-attribute\">top</span>: <span class=\"hljs-number\">0</span>;</span></span><br><span class=\"language-css\"><span class=\"language-xml\">  <span class=\"hljs-attribute\">position</span>: absolute;</span></span><br><span class=\"language-css\"><span class=\"language-xml\">  <span class=\"hljs-attribute\">text-align</span>: center;</span></span><br><span class=\"language-css\"><span class=\"language-xml\">&#125;</span></span><br><span class=\"language-css\"><span class=\"language-xml\"></span></span><br><span class=\"language-css\"><span class=\"language-xml\"><span class=\"hljs-selector-class\">.infinite-list-item</span> &#123;</span></span><br><span class=\"language-css\"><span class=\"language-xml\">  <span class=\"hljs-attribute\">padding</span>: <span class=\"hljs-number\">10px</span>;</span></span><br><span class=\"language-css\"><span class=\"language-xml\">  <span class=\"hljs-attribute\">color</span>: <span class=\"hljs-number\">#555</span>;</span></span><br><span class=\"language-css\"><span class=\"language-xml\">  <span class=\"hljs-attribute\">box-sizing</span>: border-box;</span></span><br><span class=\"language-css\"><span class=\"language-xml\">  <span class=\"hljs-attribute\">border-bottom</span>: <span class=\"hljs-number\">1px</span> solid <span class=\"hljs-number\">#999</span>;</span></span><br><span class=\"language-css\"><span class=\"language-xml\">&#125;</span></span><br><span class=\"language-css\"><span class=\"language-xml\"></span><span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">style</span>&gt;</span></span><br><br></code></pre></td></tr></table></figure>\n\n<h1 id=\"列表项动态高度\"><a href=\"#列表项动态高度\" class=\"headerlink\" title=\"列表项动态高度\"></a>列表项动态高度</h1><p>在之前的实现中，列表项的高度是固定的，因为高度固定，所以可以很轻易的获取列表项的整体高度以及滚动时的显示数据与对应的偏移量。</p>\n<p>而实际应用的时候，当列表中包含文本之类的可变内容，会导致 <code>列表项的高度并不相同</code>。</p>\n<p>比如这样：</p>\n<p><img src=\"https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-user-assets/2019/10/29/16e1519f1e121be9~tplv-t2oaga2asx-zoom-in-crop-mark:4536:0:0:0.image\" alt=\"\"></p>\n<p>在虚拟列表中应用动态高度的解决方案一般有如下三种：</p>\n<blockquote>\n<p>1.对组件属性itemSize进行扩展，支持传递类型为数字、数组、函数</p>\n</blockquote>\n<ul>\n<li>可以是一个固定值，如 100，此时列表项是固高的</li>\n<li>可以是一个包含所有列表项高度的数据，如 [50, 20, 100, 80, …]</li>\n<li>可以是一个根据列表项索引返回其高度的函数：(index: number): number</li>\n</ul>\n<p>这种方式虽然有比较好的灵活度，但仅适用于可以预先知道或可以通过计算得知列表项高度的情况，依然无法解决列表项高度由内容撑开的情况。</p>\n<blockquote>\n<p>2.将列表项 <code>渲染到屏幕外</code>，对其高度进行测量并缓存，然后再将其渲染至可视区域内。</p>\n</blockquote>\n<p>由于 <code>预先渲染至屏幕外</code>，再渲染至屏幕内，这导致渲染成本增加一倍，这对于数百万用户在低端移动设备上使用的产品来说是不切实际的。</p>\n<blockquote>\n<p>3.以预估高度先行渲染，然后获取真实高度并缓存。</p>\n</blockquote>\n<p>这是可以选择的实现方式，可以避免前两种方案的不足。</p>\n"},{"layout":"Vue,JavaScript","title":"Vue Router 4+","date":"2022-12-16T04:22:00.000Z","banner_img":"/img/vue-logo.png","index_img":"/img/vue-logo.png","excerpt":"富有表现力的路由语法、细致的导航控制、基于组件的配置方法、支持历史模式、 支持滚动控制、支持自动编码","_content":"\n# Vue Router\n\n## history\n\n```js\nconst router = VueRouter.createRouter({\n  history: VueRouter.createWebHashHistory(), // hash 模式\n  routes,\n})\n```\n\nhash 模式底层是通过 `hashchange` 监听的：\n\n```js\nwindow.addEventListener('hashchange', () => { ... })\n```\n\nhistory 模式 (`createWebHistory`)，底层是通过 `popstate` 监听的:\n\n```js\nwindow.addEventListener('popstate', () => { ... })\n```\n\n# 在 setup 中访问路由和当前路由\n因为我们在 setup 里面没有访问 this，所以我们不能再直接访问 this.$router 或 this.$route。\n\n```js\nimport { useRouter, useRoute } from 'vue-router'\n\nexport default {\n  setup() {\n    const router = useRouter()\n    const route = useRoute()\n\n    function pushWithQuery(query) {\n      router.push({\n        name: 'search',\n        query: {\n          ...route.query,\n        },\n      })\n    }\n  },\n}\n```\n\nroute 对象是一个响应式对象，所以它的任何属性都可以被监听，但你应该避免监听整个 route 对象。在大多数情况下，你应该直接`监听你期望改变的参数`。\n\n请注意，在模板中我们仍然可以访问 $router 和 $route，所以不需要在 setup 中返回 router 或 route。\n\n","source":"_posts/vue-router4.md","raw":"---\nlayout: Vue,JavaScript\ntitle: Vue Router 4+\ndate: 2022-12-16 12:22:00\ntags: JS,Vue-Router,Vue3,\nbanner_img: /img/vue-logo.png\nindex_img: /img/vue-logo.png\nexcerpt: 富有表现力的路由语法、细致的导航控制、基于组件的配置方法、支持历史模式、 支持滚动控制、支持自动编码\n---\n\n# Vue Router\n\n## history\n\n```js\nconst router = VueRouter.createRouter({\n  history: VueRouter.createWebHashHistory(), // hash 模式\n  routes,\n})\n```\n\nhash 模式底层是通过 `hashchange` 监听的：\n\n```js\nwindow.addEventListener('hashchange', () => { ... })\n```\n\nhistory 模式 (`createWebHistory`)，底层是通过 `popstate` 监听的:\n\n```js\nwindow.addEventListener('popstate', () => { ... })\n```\n\n# 在 setup 中访问路由和当前路由\n因为我们在 setup 里面没有访问 this，所以我们不能再直接访问 this.$router 或 this.$route。\n\n```js\nimport { useRouter, useRoute } from 'vue-router'\n\nexport default {\n  setup() {\n    const router = useRouter()\n    const route = useRoute()\n\n    function pushWithQuery(query) {\n      router.push({\n        name: 'search',\n        query: {\n          ...route.query,\n        },\n      })\n    }\n  },\n}\n```\n\nroute 对象是一个响应式对象，所以它的任何属性都可以被监听，但你应该避免监听整个 route 对象。在大多数情况下，你应该直接`监听你期望改变的参数`。\n\n请注意，在模板中我们仍然可以访问 $router 和 $route，所以不需要在 setup 中返回 router 或 route。\n\n","slug":"vue-router4","published":1,"updated":"2023-05-12T10:49:20.014Z","comments":1,"photos":[],"link":"","_id":"clhkizgxn000y3y0q7b41gs5m","content":"<h1 id=\"Vue-Router\"><a href=\"#Vue-Router\" class=\"headerlink\" title=\"Vue Router\"></a>Vue Router</h1><h2 id=\"history\"><a href=\"#history\" class=\"headerlink\" title=\"history\"></a>history</h2><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><div class=\"code-wrapper\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></div></td><td class=\"code\"><pre><code class=\"hljs js\"><span class=\"hljs-keyword\">const</span> router = <span class=\"hljs-title class_\">VueRouter</span>.<span class=\"hljs-title function_\">createRouter</span>(&#123;<br>  <span class=\"hljs-attr\">history</span>: <span class=\"hljs-title class_\">VueRouter</span>.<span class=\"hljs-title function_\">createWebHashHistory</span>(), <span class=\"hljs-comment\">// hash 模式</span><br>  routes,<br>&#125;)<br></code></pre></td></tr></table></figure>\n\n<p>hash 模式底层是通过 <code>hashchange</code> 监听的：</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\"><span class=\"hljs-variable language_\">window</span>.<span class=\"hljs-title function_\">addEventListener</span>(<span class=\"hljs-string\">&#x27;hashchange&#x27;</span>, <span class=\"hljs-function\">() =&gt;</span> &#123; ... &#125;)<br></code></pre></td></tr></table></figure>\n\n<p>history 模式 (<code>createWebHistory</code>)，底层是通过 <code>popstate</code> 监听的:</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\"><span class=\"hljs-variable language_\">window</span>.<span class=\"hljs-title function_\">addEventListener</span>(<span class=\"hljs-string\">&#x27;popstate&#x27;</span>, <span class=\"hljs-function\">() =&gt;</span> &#123; ... &#125;)<br></code></pre></td></tr></table></figure>\n\n<h1 id=\"在-setup-中访问路由和当前路由\"><a href=\"#在-setup-中访问路由和当前路由\" class=\"headerlink\" title=\"在 setup 中访问路由和当前路由\"></a>在 setup 中访问路由和当前路由</h1><p>因为我们在 setup 里面没有访问 this，所以我们不能再直接访问 this.$router 或 this.$route。</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\"><span class=\"hljs-keyword\">import</span> &#123; useRouter, useRoute &#125; <span class=\"hljs-keyword\">from</span> <span class=\"hljs-string\">&#x27;vue-router&#x27;</span><br><br><span class=\"hljs-keyword\">export</span> <span class=\"hljs-keyword\">default</span> &#123;<br>  <span class=\"hljs-title function_\">setup</span>(<span class=\"hljs-params\"></span>) &#123;<br>    <span class=\"hljs-keyword\">const</span> router = <span class=\"hljs-title function_\">useRouter</span>()<br>    <span class=\"hljs-keyword\">const</span> route = <span class=\"hljs-title function_\">useRoute</span>()<br><br>    <span class=\"hljs-keyword\">function</span> <span class=\"hljs-title function_\">pushWithQuery</span>(<span class=\"hljs-params\">query</span>) &#123;<br>      router.<span class=\"hljs-title function_\">push</span>(&#123;<br>        <span class=\"hljs-attr\">name</span>: <span class=\"hljs-string\">&#x27;search&#x27;</span>,<br>        <span class=\"hljs-attr\">query</span>: &#123;<br>          ...route.<span class=\"hljs-property\">query</span>,<br>        &#125;,<br>      &#125;)<br>    &#125;<br>  &#125;,<br>&#125;<br></code></pre></td></tr></table></figure>\n\n<p>route 对象是一个响应式对象，所以它的任何属性都可以被监听，但你应该避免监听整个 route 对象。在大多数情况下，你应该直接<code>监听你期望改变的参数</code>。</p>\n<p>请注意，在模板中我们仍然可以访问 $router 和 $route，所以不需要在 setup 中返回 router 或 route。</p>\n","site":{"data":{}},"wordcount":837,"more":"<h1 id=\"Vue-Router\"><a href=\"#Vue-Router\" class=\"headerlink\" title=\"Vue Router\"></a>Vue Router</h1><h2 id=\"history\"><a href=\"#history\" class=\"headerlink\" title=\"history\"></a>history</h2><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\"><span class=\"hljs-keyword\">const</span> router = <span class=\"hljs-title class_\">VueRouter</span>.<span class=\"hljs-title function_\">createRouter</span>(&#123;<br>  <span class=\"hljs-attr\">history</span>: <span class=\"hljs-title class_\">VueRouter</span>.<span class=\"hljs-title function_\">createWebHashHistory</span>(), <span class=\"hljs-comment\">// hash 模式</span><br>  routes,<br>&#125;)<br></code></pre></td></tr></table></figure>\n\n<p>hash 模式底层是通过 <code>hashchange</code> 监听的：</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\"><span class=\"hljs-variable language_\">window</span>.<span class=\"hljs-title function_\">addEventListener</span>(<span class=\"hljs-string\">&#x27;hashchange&#x27;</span>, <span class=\"hljs-function\">() =&gt;</span> &#123; ... &#125;)<br></code></pre></td></tr></table></figure>\n\n<p>history 模式 (<code>createWebHistory</code>)，底层是通过 <code>popstate</code> 监听的:</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\"><span class=\"hljs-variable language_\">window</span>.<span class=\"hljs-title function_\">addEventListener</span>(<span class=\"hljs-string\">&#x27;popstate&#x27;</span>, <span class=\"hljs-function\">() =&gt;</span> &#123; ... &#125;)<br></code></pre></td></tr></table></figure>\n\n<h1 id=\"在-setup-中访问路由和当前路由\"><a href=\"#在-setup-中访问路由和当前路由\" class=\"headerlink\" title=\"在 setup 中访问路由和当前路由\"></a>在 setup 中访问路由和当前路由</h1><p>因为我们在 setup 里面没有访问 this，所以我们不能再直接访问 this.$router 或 this.$route。</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\"><span class=\"hljs-keyword\">import</span> &#123; useRouter, useRoute &#125; <span class=\"hljs-keyword\">from</span> <span class=\"hljs-string\">&#x27;vue-router&#x27;</span><br><br><span class=\"hljs-keyword\">export</span> <span class=\"hljs-keyword\">default</span> &#123;<br>  <span class=\"hljs-title function_\">setup</span>(<span class=\"hljs-params\"></span>) &#123;<br>    <span class=\"hljs-keyword\">const</span> router = <span class=\"hljs-title function_\">useRouter</span>()<br>    <span class=\"hljs-keyword\">const</span> route = <span class=\"hljs-title function_\">useRoute</span>()<br><br>    <span class=\"hljs-keyword\">function</span> <span class=\"hljs-title function_\">pushWithQuery</span>(<span class=\"hljs-params\">query</span>) &#123;<br>      router.<span class=\"hljs-title function_\">push</span>(&#123;<br>        <span class=\"hljs-attr\">name</span>: <span class=\"hljs-string\">&#x27;search&#x27;</span>,<br>        <span class=\"hljs-attr\">query</span>: &#123;<br>          ...route.<span class=\"hljs-property\">query</span>,<br>        &#125;,<br>      &#125;)<br>    &#125;<br>  &#125;,<br>&#125;<br></code></pre></td></tr></table></figure>\n\n<p>route 对象是一个响应式对象，所以它的任何属性都可以被监听，但你应该避免监听整个 route 对象。在大多数情况下，你应该直接<code>监听你期望改变的参数</code>。</p>\n<p>请注意，在模板中我们仍然可以访问 $router 和 $route，所以不需要在 setup 中返回 router 或 route。</p>\n"},{"layout":"Vue3","title":"Vue3项目实战(一)：工程化配置","date":"2022-12-23T04:16:55.000Z","banner_img":"/img/login.png","index_img":"/img/login.png","excerpt":"工程化/编程规范/项目基础配置/...","_content":"\n# 编程规范\n\n编程规范的重要作用：\n\n- 规范的代码可以促进团队合作\n- 规范的代码可以减少bug处理，规范不是对开发的制约，而确实是有助于提高开发效率的\n- 规范的代码可以降低维护成本\n- 规范的代码有助于代码审查\n- 养成代码规范的习惯，有助于自身的成长\n\n## ESLint + Prettier 自动格式化代码\n\n1. VSCode 安装 ESLint 插件，在根目录创建 `.eslintrc` 配置文件\n\n```json\nmodule.exports = {\n  root: true, // 表示当前目录为根目录\n  env: {\n    node: true,\n  },\n  // ESLint 中基础配置需要继承的配置\n  extends: [\n    \"plugin:vue/vue3-essential\",\n    \"eslint:recommended\",\n    \"@vue/typescript/recommended\",\n    \"@vue/prettier\",\n    \"@vue/prettier/@typescript-eslint\",\n  ],\n  parserOptions: {\n    ecmaVersion: 2020,\n  },\n  // 错误规则：off(0) warn(1) error(2)\n  rules: {\n    \"no-console\": process.env.NODE_ENV === \"production\" ? \"warn\" : \"off\",\n    \"no-debugger\": process.env.NODE_ENV === \"production\" ? \"warn\" : \"off\",\n    // 关闭 no-used 检查\n    \"@typescript-eslint/no-unused-vars\": \"off\",\n  },\n  overrides: [{\n    files: [\n      \"**/__tests__/*.{j,t}s?(x)\",\n      \"**/tests/unit/**/*.spec.{j,t}s?(x)\",\n    ],\n    env: {\n      jest: true,\n    },\n  }, ],\n};\n```\n\n2. VSCode 安装 `Prettier` 插件，在根目录创建 `.prettierrc` 配置文件\n```json\n{\n  \"semi\": false, // 是否加分号\n  \"singleQuote\": true, // 单引号\n  \"arrowParens\": \"avoid\", // (x) => {} 箭头函数参数只有一个时，是否要小括号， avoid: 省略小括号\n  \"trailingComma\": \"none\" // 以多个逗号相隔的，最后是否加逗号\n}\n```\n\n3. 我们打开 `VSCode` 设置，切换到 `工作区`，找到 `Code Action on Save`，修改配置：\n```json\n\"editor.codeActionsOnSave\": {\n  \"source.fixAll\": true,\n  \"source.fixAll.eslint\": true,\n  \"source.fixAll.stylelint\": true,\n  \"source.fixAll.tslint\": true,\n},\n```\n\n4. 注意项\n\n- 对 VSCode 而言，默认一个 tab 等于 4 个空格，而 ESlint 默认为两个空格，我们在 VSCode 设置中，找到 `tab size` 改为 2 就行。\n\n- 可能安装了多个代码格式化工具，我们右键文件，找到 `使用...格式化文档`，设置默认的为 `Prettier` 即可。\n\n- 有可能 Prettier 和 eslint 规则存在冲突，比如 eslint 希望方法名和括号之间有空格，而 Prettier 不希望有空格，控制台就会报出 ESlint 错误，我们就可以找到 ESlint 配置文件，找到 `rules`，将 `space-before-function-paren` 设置为 `0` 或者 `off` 即可。\n\n## Git 提交规范\n\n```md\n<类型>[可选 范围]: <描述>\n\n[可选 正文]\n\n[可选 脚注]\n```\n\n### Commitizen\n\nGithub: cz-cli\n\n当你使用 commitizen 进行代码提交时，commitizen 会提交你在提交时填写所有必须得提交字段\n\n1. 全局安装\n```js\nnpm install -g commitizen@4.2.4\n```\n\n2. 项目配置\n\n- 安装 cz-customizable\n\n```js\nnpm install cz-customizable@6.3.0 --save-dev\n```\n\n- 在 package.json 中配置\n\n表示 commitizen 的配置在 node_modules 中的第三方包之中。\n```json\n...\n\"config\": {\n  \"commitizen\": {\n    \"path\": \"node_modules/cz-customizable\"\n  }\n}\n...\n```\n\n3.项目根目录下创建 `.cz-config.js`，配置自定义提示文件\n\n```js\nmodule.exports = {\n  types: [\n    { value: 'feat', name: 'feat:     新功能' },\n    { value: 'fix', name: 'fix:     修复' },\n    { value: 'docs', name: 'docs:     文档变更' },\n    { value: 'style', name: 'style:     代码格式（不影响代码运行的变动）' },\n    { value: 'refactor', name: 'refactor:     重构（既不是增加 feature，也不是修复 bug）' },\n    { value: 'perf', name: 'perf:     性能优化' },\n    { value: 'test', name: 'test:     增加测试' },\n    { value: 'chore', name: 'chore:     构建过程或辅助工具的变动' },\n    { value: 'revert', name: 'revert:     回退' },\n    { value: 'build', name: 'build:     打包' },\n  ],\n  // 步骤\n  messages: {\n    type: '请选择提交的类型',\n    customScope: '请输入修改的范围（可选）',\n    subject: '请简要描述提交内容（必填）',\n    body: '请输入详细的描述（可选）',\n    footer: '请输入要关闭的 issue（可选）',\n    confirmCommit: '确认要使用以上信息提交?(y/n)',\n  },\n  // 需要跳过的问题\n  skipQuestions: ['body', 'footer'],\n  subjectLimit: 72, // 描述内容的限制\n}\n```\n\n4. 使用 `git cz` 代替 `git commit`\n\n5. 最后\n\n我们可以通过 `git cz` 规范化了 git 提交，那么存在一个问题，我们必须通过 `git cz` 提交，才能规范化，如果我们忘记了使用 `git cz`，依然使用的 `git commit` 直接提交了怎么办呢？\n\n那么，有没有办法限制这种错误的出现？\n\n使用 `git hooks`\n\n### Git Hooks\n\n当《提交描述信息》不符合 `约定式提交规范` 的时候，阻止当前的提交，并抛出相应的错误提示。\n\n通过 `git hooks` 在执行某个事件之前或者之后进行一些额外的操作。\n\ngit hooks 非常多，实际用的比较多的就两个：\n\n- pre-commit：git commit 执行前，在获取提交日志信息并进行提交之前调用\n- commit-msg：git commit 执行前，可用于将消息规范化为某种项目标准格式\n\n\n### 使用 husky + commitlint 检查提交信息\n\n使用 `git hooks`去检验我们的提交信息，需要使用两个工具：\n\n- commitlint: 用于检查提交信息\n- husky: git hooks 工具\n\n主要: **npm 版本需要在 7.x 以上**\n\n\n1. 安装依赖:\n```js\nnpm install @commitlint/config-conventional@12.1.4 @commitlint/cli@12.1.4 --save-dev\n```\n\n2. 创建 `commitlint-config.js`\n```js\nmodule.exports = {\n  extends: ['@commitlint/config-conventional']\n}\n```\n\n3. 增加配置项\n\n```js\nmodule.exports = {\n  extends: ['@commitlint/config-conventional'],\n  rules: {\n    // type 的类型定义，表示 git 提交的 type 必须在以下范围内\n    'type-enum': [\n      // 当前验证的错误级别\n      2,\n      // 在什么情况下验证\n      'always',\n      // 枚举的内容\n      ['feat', 'fix', 'docs', 'style', 'refactor', 'perf', 'test', 'chore', 'revert', 'build'],\n    ],\n    // subject 大小写不做校验\n    'subject-case': [0]\n  }\n}\n```\n\n**注意**: 必须确保我们的配置文件保存为 `utf-8` 的编码格式，否则可能会报错。\n\n打开配置文件，查看 `vscode` 右下角，是否显示了 `utf-8`，如果不是就要将其切换为正确的编码格式。\n\n\n4. 安装 husky\n\n检测 git hooks 的工具\n\n\n1. 安装\n```js\nnpm install husky@7.0.1 --save-dev\n```\n\n2. 启动 hooks，在根目录下生成 `.husky` 文件夹\n\n```js\nnpx husky install\n```\n\n3. 在 package.json 中生成 `prepare` 指令（npm > 7）\n\n```js\n// 执行指令，会在 npm scripts 中生成配置\nnpm set-script prepare \"husky install\"\n```\n\n4. 执行 prepare 指令\n\n```js\nnpm run prepare\n```\n\n5. 添加 `commitlint` 的 hook 到 husky 中，并在 commit-msg 的 hooks 下，执行 `npx --no-install commitlint --edit \"$1\"`\n\n```js\nnpx husky add .husky/commit-msg 'npx --no-install commitlint --edit \"$1\"'\n```\n\n6. 打开 .husky，就可以看到 commit-msg 文件了。\n\n```js\n// commit-msg\n\n#!/bin/sh\n. \"${dirname \"${0}\"}/_/husky.sh\"\n\nnpx --no-install commitlint --edit $1\n```\n\n7. 最后，我们就可以愉快的提交了。\n\n## pre-commit 检测代码提交规范\n\n虽然我们使用了 eslint + prettier 在本地自动格式化代码，但是，有可能有的小伙伴，忘记将 vscode 的自动保存格式化打开了，并且写的代码格式不符合规范，也是可以提交上去的。\n\n那么我们就得加一些配置，来检测小伙伴们提交的代码是否符合规范了。\n\n要完成这一操作，就需要使用 husky 配合 eslint 来实现了。\n\n我们期望通过 `husky` 检测 `pre-commit` 钩子，在该钩子下执行 `npx eslint --ext .js,.vue, src` 指令去进行相关的检测。\n\n1. 执行 `npx husky add .husky/pre-commit \"npx eslint --ext .js,.vue, src\"` 命令\n\n会在 .husky 文件夹下面，生成 `pre-commit` 文件\n\n```js\n// pre-commit\n\n#!/bin/sh\n. \"${dirname \"${0}\"}/_/husky.sh\"\n\nnpx eslint --ext .js,.vue, src\n```\n\n每次我们提交代码，都会触发 pre-commit 钩子，从而使用 eslint 去检测我们的代码文件。\n\n2. 关闭自动保存，修改代码提交试试吧\n\n\n## lint staged 自动修复错误\n\n我们通过 `pre-commit` + husky 处理了代码提交时的规范化问题，当我们进行代码提交时，会检测所有的代码格式规范。\n\n但是这样就有两个问题：\n\n1. 我们只修改了个别文件，没有必要检测所有的文件代码格式\n2. 它只能给我们提示出对应的错误，竟然还需要我们手动进行修复？不合理\n\n我们使用 `lint-staged` 插件，来帮助我们解决这两个问题。\n\n\nlint-staged 可以 `只检测本次更新的代码，并在错误出现的时候，自动修复并且推送`\n\n**安装**\n\n使用 `vue-cli` 生成项目时，lint-staged 不需要安装了，项目已经有了。如果没有的话，就需要单独安装\n\n1. 修改 `package.json`：\n```json\n\"lint-staged\": {\n  \"src/**/*.{js,jsx,vue}\": {\n    \"eslint --fix\",\n    \"git add\"\n  }\n}\n```\n\n2. 修改 .husky/pre-commit 文件\n\n```js\n// pre-commit\n\n#!/bin/sh\n. \"${dirname \"${0}\"}/_/husky.sh\"\n\n// npx eslint --ext .js,.vue, src // 删除\n\nnpx lint-staged // 新增\n```\n\n3. 尝试将代码修改为不符合规范的，通过 `git cz` 再次提交试试！\n\n- lint-staged 会尝试自动修复错误\n\n- 错误修复完成，继续执行，并将代码提交\n","source":"_posts/vue3-project-config.md","raw":"---\nlayout: Vue3\ntitle: Vue3项目实战(一)：工程化配置\ndate: 2022-12-23 12:16:55\ntags: 工程化,Vue3\nbanner_img: /img/login.png\nindex_img: /img/login.png\nexcerpt: 工程化/编程规范/项目基础配置/...\n---\n\n# 编程规范\n\n编程规范的重要作用：\n\n- 规范的代码可以促进团队合作\n- 规范的代码可以减少bug处理，规范不是对开发的制约，而确实是有助于提高开发效率的\n- 规范的代码可以降低维护成本\n- 规范的代码有助于代码审查\n- 养成代码规范的习惯，有助于自身的成长\n\n## ESLint + Prettier 自动格式化代码\n\n1. VSCode 安装 ESLint 插件，在根目录创建 `.eslintrc` 配置文件\n\n```json\nmodule.exports = {\n  root: true, // 表示当前目录为根目录\n  env: {\n    node: true,\n  },\n  // ESLint 中基础配置需要继承的配置\n  extends: [\n    \"plugin:vue/vue3-essential\",\n    \"eslint:recommended\",\n    \"@vue/typescript/recommended\",\n    \"@vue/prettier\",\n    \"@vue/prettier/@typescript-eslint\",\n  ],\n  parserOptions: {\n    ecmaVersion: 2020,\n  },\n  // 错误规则：off(0) warn(1) error(2)\n  rules: {\n    \"no-console\": process.env.NODE_ENV === \"production\" ? \"warn\" : \"off\",\n    \"no-debugger\": process.env.NODE_ENV === \"production\" ? \"warn\" : \"off\",\n    // 关闭 no-used 检查\n    \"@typescript-eslint/no-unused-vars\": \"off\",\n  },\n  overrides: [{\n    files: [\n      \"**/__tests__/*.{j,t}s?(x)\",\n      \"**/tests/unit/**/*.spec.{j,t}s?(x)\",\n    ],\n    env: {\n      jest: true,\n    },\n  }, ],\n};\n```\n\n2. VSCode 安装 `Prettier` 插件，在根目录创建 `.prettierrc` 配置文件\n```json\n{\n  \"semi\": false, // 是否加分号\n  \"singleQuote\": true, // 单引号\n  \"arrowParens\": \"avoid\", // (x) => {} 箭头函数参数只有一个时，是否要小括号， avoid: 省略小括号\n  \"trailingComma\": \"none\" // 以多个逗号相隔的，最后是否加逗号\n}\n```\n\n3. 我们打开 `VSCode` 设置，切换到 `工作区`，找到 `Code Action on Save`，修改配置：\n```json\n\"editor.codeActionsOnSave\": {\n  \"source.fixAll\": true,\n  \"source.fixAll.eslint\": true,\n  \"source.fixAll.stylelint\": true,\n  \"source.fixAll.tslint\": true,\n},\n```\n\n4. 注意项\n\n- 对 VSCode 而言，默认一个 tab 等于 4 个空格，而 ESlint 默认为两个空格，我们在 VSCode 设置中，找到 `tab size` 改为 2 就行。\n\n- 可能安装了多个代码格式化工具，我们右键文件，找到 `使用...格式化文档`，设置默认的为 `Prettier` 即可。\n\n- 有可能 Prettier 和 eslint 规则存在冲突，比如 eslint 希望方法名和括号之间有空格，而 Prettier 不希望有空格，控制台就会报出 ESlint 错误，我们就可以找到 ESlint 配置文件，找到 `rules`，将 `space-before-function-paren` 设置为 `0` 或者 `off` 即可。\n\n## Git 提交规范\n\n```md\n<类型>[可选 范围]: <描述>\n\n[可选 正文]\n\n[可选 脚注]\n```\n\n### Commitizen\n\nGithub: cz-cli\n\n当你使用 commitizen 进行代码提交时，commitizen 会提交你在提交时填写所有必须得提交字段\n\n1. 全局安装\n```js\nnpm install -g commitizen@4.2.4\n```\n\n2. 项目配置\n\n- 安装 cz-customizable\n\n```js\nnpm install cz-customizable@6.3.0 --save-dev\n```\n\n- 在 package.json 中配置\n\n表示 commitizen 的配置在 node_modules 中的第三方包之中。\n```json\n...\n\"config\": {\n  \"commitizen\": {\n    \"path\": \"node_modules/cz-customizable\"\n  }\n}\n...\n```\n\n3.项目根目录下创建 `.cz-config.js`，配置自定义提示文件\n\n```js\nmodule.exports = {\n  types: [\n    { value: 'feat', name: 'feat:     新功能' },\n    { value: 'fix', name: 'fix:     修复' },\n    { value: 'docs', name: 'docs:     文档变更' },\n    { value: 'style', name: 'style:     代码格式（不影响代码运行的变动）' },\n    { value: 'refactor', name: 'refactor:     重构（既不是增加 feature，也不是修复 bug）' },\n    { value: 'perf', name: 'perf:     性能优化' },\n    { value: 'test', name: 'test:     增加测试' },\n    { value: 'chore', name: 'chore:     构建过程或辅助工具的变动' },\n    { value: 'revert', name: 'revert:     回退' },\n    { value: 'build', name: 'build:     打包' },\n  ],\n  // 步骤\n  messages: {\n    type: '请选择提交的类型',\n    customScope: '请输入修改的范围（可选）',\n    subject: '请简要描述提交内容（必填）',\n    body: '请输入详细的描述（可选）',\n    footer: '请输入要关闭的 issue（可选）',\n    confirmCommit: '确认要使用以上信息提交?(y/n)',\n  },\n  // 需要跳过的问题\n  skipQuestions: ['body', 'footer'],\n  subjectLimit: 72, // 描述内容的限制\n}\n```\n\n4. 使用 `git cz` 代替 `git commit`\n\n5. 最后\n\n我们可以通过 `git cz` 规范化了 git 提交，那么存在一个问题，我们必须通过 `git cz` 提交，才能规范化，如果我们忘记了使用 `git cz`，依然使用的 `git commit` 直接提交了怎么办呢？\n\n那么，有没有办法限制这种错误的出现？\n\n使用 `git hooks`\n\n### Git Hooks\n\n当《提交描述信息》不符合 `约定式提交规范` 的时候，阻止当前的提交，并抛出相应的错误提示。\n\n通过 `git hooks` 在执行某个事件之前或者之后进行一些额外的操作。\n\ngit hooks 非常多，实际用的比较多的就两个：\n\n- pre-commit：git commit 执行前，在获取提交日志信息并进行提交之前调用\n- commit-msg：git commit 执行前，可用于将消息规范化为某种项目标准格式\n\n\n### 使用 husky + commitlint 检查提交信息\n\n使用 `git hooks`去检验我们的提交信息，需要使用两个工具：\n\n- commitlint: 用于检查提交信息\n- husky: git hooks 工具\n\n主要: **npm 版本需要在 7.x 以上**\n\n\n1. 安装依赖:\n```js\nnpm install @commitlint/config-conventional@12.1.4 @commitlint/cli@12.1.4 --save-dev\n```\n\n2. 创建 `commitlint-config.js`\n```js\nmodule.exports = {\n  extends: ['@commitlint/config-conventional']\n}\n```\n\n3. 增加配置项\n\n```js\nmodule.exports = {\n  extends: ['@commitlint/config-conventional'],\n  rules: {\n    // type 的类型定义，表示 git 提交的 type 必须在以下范围内\n    'type-enum': [\n      // 当前验证的错误级别\n      2,\n      // 在什么情况下验证\n      'always',\n      // 枚举的内容\n      ['feat', 'fix', 'docs', 'style', 'refactor', 'perf', 'test', 'chore', 'revert', 'build'],\n    ],\n    // subject 大小写不做校验\n    'subject-case': [0]\n  }\n}\n```\n\n**注意**: 必须确保我们的配置文件保存为 `utf-8` 的编码格式，否则可能会报错。\n\n打开配置文件，查看 `vscode` 右下角，是否显示了 `utf-8`，如果不是就要将其切换为正确的编码格式。\n\n\n4. 安装 husky\n\n检测 git hooks 的工具\n\n\n1. 安装\n```js\nnpm install husky@7.0.1 --save-dev\n```\n\n2. 启动 hooks，在根目录下生成 `.husky` 文件夹\n\n```js\nnpx husky install\n```\n\n3. 在 package.json 中生成 `prepare` 指令（npm > 7）\n\n```js\n// 执行指令，会在 npm scripts 中生成配置\nnpm set-script prepare \"husky install\"\n```\n\n4. 执行 prepare 指令\n\n```js\nnpm run prepare\n```\n\n5. 添加 `commitlint` 的 hook 到 husky 中，并在 commit-msg 的 hooks 下，执行 `npx --no-install commitlint --edit \"$1\"`\n\n```js\nnpx husky add .husky/commit-msg 'npx --no-install commitlint --edit \"$1\"'\n```\n\n6. 打开 .husky，就可以看到 commit-msg 文件了。\n\n```js\n// commit-msg\n\n#!/bin/sh\n. \"${dirname \"${0}\"}/_/husky.sh\"\n\nnpx --no-install commitlint --edit $1\n```\n\n7. 最后，我们就可以愉快的提交了。\n\n## pre-commit 检测代码提交规范\n\n虽然我们使用了 eslint + prettier 在本地自动格式化代码，但是，有可能有的小伙伴，忘记将 vscode 的自动保存格式化打开了，并且写的代码格式不符合规范，也是可以提交上去的。\n\n那么我们就得加一些配置，来检测小伙伴们提交的代码是否符合规范了。\n\n要完成这一操作，就需要使用 husky 配合 eslint 来实现了。\n\n我们期望通过 `husky` 检测 `pre-commit` 钩子，在该钩子下执行 `npx eslint --ext .js,.vue, src` 指令去进行相关的检测。\n\n1. 执行 `npx husky add .husky/pre-commit \"npx eslint --ext .js,.vue, src\"` 命令\n\n会在 .husky 文件夹下面，生成 `pre-commit` 文件\n\n```js\n// pre-commit\n\n#!/bin/sh\n. \"${dirname \"${0}\"}/_/husky.sh\"\n\nnpx eslint --ext .js,.vue, src\n```\n\n每次我们提交代码，都会触发 pre-commit 钩子，从而使用 eslint 去检测我们的代码文件。\n\n2. 关闭自动保存，修改代码提交试试吧\n\n\n## lint staged 自动修复错误\n\n我们通过 `pre-commit` + husky 处理了代码提交时的规范化问题，当我们进行代码提交时，会检测所有的代码格式规范。\n\n但是这样就有两个问题：\n\n1. 我们只修改了个别文件，没有必要检测所有的文件代码格式\n2. 它只能给我们提示出对应的错误，竟然还需要我们手动进行修复？不合理\n\n我们使用 `lint-staged` 插件，来帮助我们解决这两个问题。\n\n\nlint-staged 可以 `只检测本次更新的代码，并在错误出现的时候，自动修复并且推送`\n\n**安装**\n\n使用 `vue-cli` 生成项目时，lint-staged 不需要安装了，项目已经有了。如果没有的话，就需要单独安装\n\n1. 修改 `package.json`：\n```json\n\"lint-staged\": {\n  \"src/**/*.{js,jsx,vue}\": {\n    \"eslint --fix\",\n    \"git add\"\n  }\n}\n```\n\n2. 修改 .husky/pre-commit 文件\n\n```js\n// pre-commit\n\n#!/bin/sh\n. \"${dirname \"${0}\"}/_/husky.sh\"\n\n// npx eslint --ext .js,.vue, src // 删除\n\nnpx lint-staged // 新增\n```\n\n3. 尝试将代码修改为不符合规范的，通过 `git cz` 再次提交试试！\n\n- lint-staged 会尝试自动修复错误\n\n- 错误修复完成，继续执行，并将代码提交\n","slug":"vue3-project-config","published":1,"updated":"2023-05-12T10:49:20.014Z","comments":1,"photos":[],"link":"","_id":"clhkizgxo00113y0q9zwt9q5q","content":"<h1 id=\"编程规范\"><a href=\"#编程规范\" class=\"headerlink\" title=\"编程规范\"></a>编程规范</h1><p>编程规范的重要作用：</p>\n<ul>\n<li>规范的代码可以促进团队合作</li>\n<li>规范的代码可以减少bug处理，规范不是对开发的制约，而确实是有助于提高开发效率的</li>\n<li>规范的代码可以降低维护成本</li>\n<li>规范的代码有助于代码审查</li>\n<li>养成代码规范的习惯，有助于自身的成长</li>\n</ul>\n<h2 id=\"ESLint-Prettier-自动格式化代码\"><a href=\"#ESLint-Prettier-自动格式化代码\" class=\"headerlink\" title=\"ESLint + Prettier 自动格式化代码\"></a>ESLint + Prettier 自动格式化代码</h2><ol>\n<li>VSCode 安装 ESLint 插件，在根目录创建 <code>.eslintrc</code> 配置文件</li>\n</ol>\n<figure class=\"highlight json\"><table><tr><td class=\"gutter\"><div class=\"code-wrapper\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br></pre></div></td><td class=\"code\"><pre><code class=\"hljs json\">module.exports = <span class=\"hljs-punctuation\">&#123;</span><br>  root<span class=\"hljs-punctuation\">:</span> <span class=\"hljs-keyword\">true</span><span class=\"hljs-punctuation\">,</span> <span class=\"hljs-comment\">// 表示当前目录为根目录</span><br>  env<span class=\"hljs-punctuation\">:</span> <span class=\"hljs-punctuation\">&#123;</span><br>    node<span class=\"hljs-punctuation\">:</span> <span class=\"hljs-keyword\">true</span><span class=\"hljs-punctuation\">,</span><br>  <span class=\"hljs-punctuation\">&#125;</span><span class=\"hljs-punctuation\">,</span><br>  <span class=\"hljs-comment\">// ESLint 中基础配置需要继承的配置</span><br>  extends<span class=\"hljs-punctuation\">:</span> <span class=\"hljs-punctuation\">[</span><br>    <span class=\"hljs-string\">&quot;plugin:vue/vue3-essential&quot;</span><span class=\"hljs-punctuation\">,</span><br>    <span class=\"hljs-string\">&quot;eslint:recommended&quot;</span><span class=\"hljs-punctuation\">,</span><br>    <span class=\"hljs-string\">&quot;@vue/typescript/recommended&quot;</span><span class=\"hljs-punctuation\">,</span><br>    <span class=\"hljs-string\">&quot;@vue/prettier&quot;</span><span class=\"hljs-punctuation\">,</span><br>    <span class=\"hljs-string\">&quot;@vue/prettier/@typescript-eslint&quot;</span><span class=\"hljs-punctuation\">,</span><br>  <span class=\"hljs-punctuation\">]</span><span class=\"hljs-punctuation\">,</span><br>  parserOptions<span class=\"hljs-punctuation\">:</span> <span class=\"hljs-punctuation\">&#123;</span><br>    ecmaVersion<span class=\"hljs-punctuation\">:</span> <span class=\"hljs-number\">2020</span><span class=\"hljs-punctuation\">,</span><br>  <span class=\"hljs-punctuation\">&#125;</span><span class=\"hljs-punctuation\">,</span><br>  <span class=\"hljs-comment\">// 错误规则：off(0) warn(1) error(2)</span><br>  rules<span class=\"hljs-punctuation\">:</span> <span class=\"hljs-punctuation\">&#123;</span><br>    <span class=\"hljs-attr\">&quot;no-console&quot;</span><span class=\"hljs-punctuation\">:</span> process.env.NODE_ENV === <span class=\"hljs-string\">&quot;production&quot;</span> ? <span class=\"hljs-attr\">&quot;warn&quot;</span> <span class=\"hljs-punctuation\">:</span> <span class=\"hljs-string\">&quot;off&quot;</span><span class=\"hljs-punctuation\">,</span><br>    <span class=\"hljs-attr\">&quot;no-debugger&quot;</span><span class=\"hljs-punctuation\">:</span> process.env.NODE_ENV === <span class=\"hljs-string\">&quot;production&quot;</span> ? <span class=\"hljs-attr\">&quot;warn&quot;</span> <span class=\"hljs-punctuation\">:</span> <span class=\"hljs-string\">&quot;off&quot;</span><span class=\"hljs-punctuation\">,</span><br>    <span class=\"hljs-comment\">// 关闭 no-used 检查</span><br>    <span class=\"hljs-attr\">&quot;@typescript-eslint/no-unused-vars&quot;</span><span class=\"hljs-punctuation\">:</span> <span class=\"hljs-string\">&quot;off&quot;</span><span class=\"hljs-punctuation\">,</span><br>  <span class=\"hljs-punctuation\">&#125;</span><span class=\"hljs-punctuation\">,</span><br>  overrides<span class=\"hljs-punctuation\">:</span> <span class=\"hljs-punctuation\">[</span><span class=\"hljs-punctuation\">&#123;</span><br>    files<span class=\"hljs-punctuation\">:</span> <span class=\"hljs-punctuation\">[</span><br>      <span class=\"hljs-string\">&quot;**/__tests__/*.&#123;j,t&#125;s?(x)&quot;</span><span class=\"hljs-punctuation\">,</span><br>      <span class=\"hljs-string\">&quot;**/tests/unit/**/*.spec.&#123;j,t&#125;s?(x)&quot;</span><span class=\"hljs-punctuation\">,</span><br>    <span class=\"hljs-punctuation\">]</span><span class=\"hljs-punctuation\">,</span><br>    env<span class=\"hljs-punctuation\">:</span> <span class=\"hljs-punctuation\">&#123;</span><br>      jest<span class=\"hljs-punctuation\">:</span> <span class=\"hljs-keyword\">true</span><span class=\"hljs-punctuation\">,</span><br>    <span class=\"hljs-punctuation\">&#125;</span><span class=\"hljs-punctuation\">,</span><br>  <span class=\"hljs-punctuation\">&#125;</span><span class=\"hljs-punctuation\">,</span> <span class=\"hljs-punctuation\">]</span><span class=\"hljs-punctuation\">,</span><br><span class=\"hljs-punctuation\">&#125;</span>;<br></code></pre></td></tr></table></figure>\n\n<ol start=\"2\">\n<li><p>VSCode 安装 <code>Prettier</code> 插件，在根目录创建 <code>.prettierrc</code> 配置文件</p>\n<figure class=\"highlight json\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs json\"><span class=\"hljs-punctuation\">&#123;</span><br>  <span class=\"hljs-attr\">&quot;semi&quot;</span><span class=\"hljs-punctuation\">:</span> <span class=\"hljs-keyword\">false</span><span class=\"hljs-punctuation\">,</span> <span class=\"hljs-comment\">// 是否加分号</span><br>  <span class=\"hljs-attr\">&quot;singleQuote&quot;</span><span class=\"hljs-punctuation\">:</span> <span class=\"hljs-keyword\">true</span><span class=\"hljs-punctuation\">,</span> <span class=\"hljs-comment\">// 单引号</span><br>  <span class=\"hljs-attr\">&quot;arrowParens&quot;</span><span class=\"hljs-punctuation\">:</span> <span class=\"hljs-string\">&quot;avoid&quot;</span><span class=\"hljs-punctuation\">,</span> <span class=\"hljs-comment\">// (x) =&gt; &#123;&#125; 箭头函数参数只有一个时，是否要小括号， avoid: 省略小括号</span><br>  <span class=\"hljs-attr\">&quot;trailingComma&quot;</span><span class=\"hljs-punctuation\">:</span> <span class=\"hljs-string\">&quot;none&quot;</span> <span class=\"hljs-comment\">// 以多个逗号相隔的，最后是否加逗号</span><br><span class=\"hljs-punctuation\">&#125;</span><br></code></pre></td></tr></table></figure>\n</li>\n<li><p>我们打开 <code>VSCode</code> 设置，切换到 <code>工作区</code>，找到 <code>Code Action on Save</code>，修改配置：</p>\n<figure class=\"highlight json\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs json\"><span class=\"hljs-attr\">&quot;editor.codeActionsOnSave&quot;</span><span class=\"hljs-punctuation\">:</span> <span class=\"hljs-punctuation\">&#123;</span><br>  <span class=\"hljs-attr\">&quot;source.fixAll&quot;</span><span class=\"hljs-punctuation\">:</span> <span class=\"hljs-keyword\">true</span><span class=\"hljs-punctuation\">,</span><br>  <span class=\"hljs-attr\">&quot;source.fixAll.eslint&quot;</span><span class=\"hljs-punctuation\">:</span> <span class=\"hljs-keyword\">true</span><span class=\"hljs-punctuation\">,</span><br>  <span class=\"hljs-attr\">&quot;source.fixAll.stylelint&quot;</span><span class=\"hljs-punctuation\">:</span> <span class=\"hljs-keyword\">true</span><span class=\"hljs-punctuation\">,</span><br>  <span class=\"hljs-attr\">&quot;source.fixAll.tslint&quot;</span><span class=\"hljs-punctuation\">:</span> <span class=\"hljs-keyword\">true</span><span class=\"hljs-punctuation\">,</span><br><span class=\"hljs-punctuation\">&#125;</span><span class=\"hljs-punctuation\">,</span><br></code></pre></td></tr></table></figure>\n</li>\n<li><p>注意项</p>\n</li>\n</ol>\n<ul>\n<li><p>对 VSCode 而言，默认一个 tab 等于 4 个空格，而 ESlint 默认为两个空格，我们在 VSCode 设置中，找到 <code>tab size</code> 改为 2 就行。</p>\n</li>\n<li><p>可能安装了多个代码格式化工具，我们右键文件，找到 <code>使用...格式化文档</code>，设置默认的为 <code>Prettier</code> 即可。</p>\n</li>\n<li><p>有可能 Prettier 和 eslint 规则存在冲突，比如 eslint 希望方法名和括号之间有空格，而 Prettier 不希望有空格，控制台就会报出 ESlint 错误，我们就可以找到 ESlint 配置文件，找到 <code>rules</code>，将 <code>space-before-function-paren</code> 设置为 <code>0</code> 或者 <code>off</code> 即可。</p>\n</li>\n</ul>\n<h2 id=\"Git-提交规范\"><a href=\"#Git-提交规范\" class=\"headerlink\" title=\"Git 提交规范\"></a>Git 提交规范</h2><figure class=\"highlight md\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs md\">&lt;类型&gt;[可选 范围]: &lt;描述&gt;<br><br>[可选 正文]<br><br>[可选 脚注]<br></code></pre></td></tr></table></figure>\n\n<h3 id=\"Commitizen\"><a href=\"#Commitizen\" class=\"headerlink\" title=\"Commitizen\"></a>Commitizen</h3><p>Github: cz-cli</p>\n<p>当你使用 commitizen 进行代码提交时，commitizen 会提交你在提交时填写所有必须得提交字段</p>\n<ol>\n<li><p>全局安装</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\">npm install -g commitizen@<span class=\"hljs-number\">4.2</span><span class=\"hljs-number\">.4</span><br></code></pre></td></tr></table></figure>\n</li>\n<li><p>项目配置</p>\n</li>\n</ol>\n<ul>\n<li>安装 cz-customizable</li>\n</ul>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\">npm install cz-customizable@<span class=\"hljs-number\">6.3</span><span class=\"hljs-number\">.0</span> --save-dev<br></code></pre></td></tr></table></figure>\n\n<ul>\n<li>在 package.json 中配置</li>\n</ul>\n<p>表示 commitizen 的配置在 node_modules 中的第三方包之中。</p>\n<figure class=\"highlight json\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs json\">...<br><span class=\"hljs-attr\">&quot;config&quot;</span><span class=\"hljs-punctuation\">:</span> <span class=\"hljs-punctuation\">&#123;</span><br>  <span class=\"hljs-attr\">&quot;commitizen&quot;</span><span class=\"hljs-punctuation\">:</span> <span class=\"hljs-punctuation\">&#123;</span><br>    <span class=\"hljs-attr\">&quot;path&quot;</span><span class=\"hljs-punctuation\">:</span> <span class=\"hljs-string\">&quot;node_modules/cz-customizable&quot;</span><br>  <span class=\"hljs-punctuation\">&#125;</span><br><span class=\"hljs-punctuation\">&#125;</span><br>...<br></code></pre></td></tr></table></figure>\n\n<p>3.项目根目录下创建 <code>.cz-config.js</code>，配置自定义提示文件</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\"><span class=\"hljs-variable language_\">module</span>.<span class=\"hljs-property\">exports</span> = &#123;<br>  <span class=\"hljs-attr\">types</span>: [<br>    &#123; <span class=\"hljs-attr\">value</span>: <span class=\"hljs-string\">&#x27;feat&#x27;</span>, <span class=\"hljs-attr\">name</span>: <span class=\"hljs-string\">&#x27;feat:     新功能&#x27;</span> &#125;,<br>    &#123; <span class=\"hljs-attr\">value</span>: <span class=\"hljs-string\">&#x27;fix&#x27;</span>, <span class=\"hljs-attr\">name</span>: <span class=\"hljs-string\">&#x27;fix:     修复&#x27;</span> &#125;,<br>    &#123; <span class=\"hljs-attr\">value</span>: <span class=\"hljs-string\">&#x27;docs&#x27;</span>, <span class=\"hljs-attr\">name</span>: <span class=\"hljs-string\">&#x27;docs:     文档变更&#x27;</span> &#125;,<br>    &#123; <span class=\"hljs-attr\">value</span>: <span class=\"hljs-string\">&#x27;style&#x27;</span>, <span class=\"hljs-attr\">name</span>: <span class=\"hljs-string\">&#x27;style:     代码格式（不影响代码运行的变动）&#x27;</span> &#125;,<br>    &#123; <span class=\"hljs-attr\">value</span>: <span class=\"hljs-string\">&#x27;refactor&#x27;</span>, <span class=\"hljs-attr\">name</span>: <span class=\"hljs-string\">&#x27;refactor:     重构（既不是增加 feature，也不是修复 bug）&#x27;</span> &#125;,<br>    &#123; <span class=\"hljs-attr\">value</span>: <span class=\"hljs-string\">&#x27;perf&#x27;</span>, <span class=\"hljs-attr\">name</span>: <span class=\"hljs-string\">&#x27;perf:     性能优化&#x27;</span> &#125;,<br>    &#123; <span class=\"hljs-attr\">value</span>: <span class=\"hljs-string\">&#x27;test&#x27;</span>, <span class=\"hljs-attr\">name</span>: <span class=\"hljs-string\">&#x27;test:     增加测试&#x27;</span> &#125;,<br>    &#123; <span class=\"hljs-attr\">value</span>: <span class=\"hljs-string\">&#x27;chore&#x27;</span>, <span class=\"hljs-attr\">name</span>: <span class=\"hljs-string\">&#x27;chore:     构建过程或辅助工具的变动&#x27;</span> &#125;,<br>    &#123; <span class=\"hljs-attr\">value</span>: <span class=\"hljs-string\">&#x27;revert&#x27;</span>, <span class=\"hljs-attr\">name</span>: <span class=\"hljs-string\">&#x27;revert:     回退&#x27;</span> &#125;,<br>    &#123; <span class=\"hljs-attr\">value</span>: <span class=\"hljs-string\">&#x27;build&#x27;</span>, <span class=\"hljs-attr\">name</span>: <span class=\"hljs-string\">&#x27;build:     打包&#x27;</span> &#125;,<br>  ],<br>  <span class=\"hljs-comment\">// 步骤</span><br>  <span class=\"hljs-attr\">messages</span>: &#123;<br>    <span class=\"hljs-attr\">type</span>: <span class=\"hljs-string\">&#x27;请选择提交的类型&#x27;</span>,<br>    <span class=\"hljs-attr\">customScope</span>: <span class=\"hljs-string\">&#x27;请输入修改的范围（可选）&#x27;</span>,<br>    <span class=\"hljs-attr\">subject</span>: <span class=\"hljs-string\">&#x27;请简要描述提交内容（必填）&#x27;</span>,<br>    <span class=\"hljs-attr\">body</span>: <span class=\"hljs-string\">&#x27;请输入详细的描述（可选）&#x27;</span>,<br>    <span class=\"hljs-attr\">footer</span>: <span class=\"hljs-string\">&#x27;请输入要关闭的 issue（可选）&#x27;</span>,<br>    <span class=\"hljs-attr\">confirmCommit</span>: <span class=\"hljs-string\">&#x27;确认要使用以上信息提交?(y/n)&#x27;</span>,<br>  &#125;,<br>  <span class=\"hljs-comment\">// 需要跳过的问题</span><br>  <span class=\"hljs-attr\">skipQuestions</span>: [<span class=\"hljs-string\">&#x27;body&#x27;</span>, <span class=\"hljs-string\">&#x27;footer&#x27;</span>],<br>  <span class=\"hljs-attr\">subjectLimit</span>: <span class=\"hljs-number\">72</span>, <span class=\"hljs-comment\">// 描述内容的限制</span><br>&#125;<br></code></pre></td></tr></table></figure>\n\n<ol start=\"4\">\n<li><p>使用 <code>git cz</code> 代替 <code>git commit</code></p>\n</li>\n<li><p>最后</p>\n</li>\n</ol>\n<p>我们可以通过 <code>git cz</code> 规范化了 git 提交，那么存在一个问题，我们必须通过 <code>git cz</code> 提交，才能规范化，如果我们忘记了使用 <code>git cz</code>，依然使用的 <code>git commit</code> 直接提交了怎么办呢？</p>\n<p>那么，有没有办法限制这种错误的出现？</p>\n<p>使用 <code>git hooks</code></p>\n<h3 id=\"Git-Hooks\"><a href=\"#Git-Hooks\" class=\"headerlink\" title=\"Git Hooks\"></a>Git Hooks</h3><p>当《提交描述信息》不符合 <code>约定式提交规范</code> 的时候，阻止当前的提交，并抛出相应的错误提示。</p>\n<p>通过 <code>git hooks</code> 在执行某个事件之前或者之后进行一些额外的操作。</p>\n<p>git hooks 非常多，实际用的比较多的就两个：</p>\n<ul>\n<li>pre-commit：git commit 执行前，在获取提交日志信息并进行提交之前调用</li>\n<li>commit-msg：git commit 执行前，可用于将消息规范化为某种项目标准格式</li>\n</ul>\n<h3 id=\"使用-husky-commitlint-检查提交信息\"><a href=\"#使用-husky-commitlint-检查提交信息\" class=\"headerlink\" title=\"使用 husky + commitlint 检查提交信息\"></a>使用 husky + commitlint 检查提交信息</h3><p>使用 <code>git hooks</code>去检验我们的提交信息，需要使用两个工具：</p>\n<ul>\n<li>commitlint: 用于检查提交信息</li>\n<li>husky: git hooks 工具</li>\n</ul>\n<p>主要: <strong>npm 版本需要在 7.x 以上</strong></p>\n<ol>\n<li><p>安装依赖:</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\">npm install @commitlint/config-conventional@<span class=\"hljs-number\">12.1</span><span class=\"hljs-number\">.4</span> @commitlint/cli@<span class=\"hljs-number\">12.1</span><span class=\"hljs-number\">.4</span> --save-dev<br></code></pre></td></tr></table></figure>\n</li>\n<li><p>创建 <code>commitlint-config.js</code></p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\"><span class=\"hljs-variable language_\">module</span>.<span class=\"hljs-property\">exports</span> = &#123;<br>  <span class=\"hljs-attr\">extends</span>: [<span class=\"hljs-string\">&#x27;@commitlint/config-conventional&#x27;</span>]<br>&#125;<br></code></pre></td></tr></table></figure>\n</li>\n<li><p>增加配置项</p>\n</li>\n</ol>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\"><span class=\"hljs-variable language_\">module</span>.<span class=\"hljs-property\">exports</span> = &#123;<br>  <span class=\"hljs-attr\">extends</span>: [<span class=\"hljs-string\">&#x27;@commitlint/config-conventional&#x27;</span>],<br>  <span class=\"hljs-attr\">rules</span>: &#123;<br>    <span class=\"hljs-comment\">// type 的类型定义，表示 git 提交的 type 必须在以下范围内</span><br>    <span class=\"hljs-string\">&#x27;type-enum&#x27;</span>: [<br>      <span class=\"hljs-comment\">// 当前验证的错误级别</span><br>      <span class=\"hljs-number\">2</span>,<br>      <span class=\"hljs-comment\">// 在什么情况下验证</span><br>      <span class=\"hljs-string\">&#x27;always&#x27;</span>,<br>      <span class=\"hljs-comment\">// 枚举的内容</span><br>      [<span class=\"hljs-string\">&#x27;feat&#x27;</span>, <span class=\"hljs-string\">&#x27;fix&#x27;</span>, <span class=\"hljs-string\">&#x27;docs&#x27;</span>, <span class=\"hljs-string\">&#x27;style&#x27;</span>, <span class=\"hljs-string\">&#x27;refactor&#x27;</span>, <span class=\"hljs-string\">&#x27;perf&#x27;</span>, <span class=\"hljs-string\">&#x27;test&#x27;</span>, <span class=\"hljs-string\">&#x27;chore&#x27;</span>, <span class=\"hljs-string\">&#x27;revert&#x27;</span>, <span class=\"hljs-string\">&#x27;build&#x27;</span>],<br>    ],<br>    <span class=\"hljs-comment\">// subject 大小写不做校验</span><br>    <span class=\"hljs-string\">&#x27;subject-case&#x27;</span>: [<span class=\"hljs-number\">0</span>]<br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure>\n\n<p><strong>注意</strong>: 必须确保我们的配置文件保存为 <code>utf-8</code> 的编码格式，否则可能会报错。</p>\n<p>打开配置文件，查看 <code>vscode</code> 右下角，是否显示了 <code>utf-8</code>，如果不是就要将其切换为正确的编码格式。</p>\n<ol start=\"4\">\n<li>安装 husky</li>\n</ol>\n<p>检测 git hooks 的工具</p>\n<ol>\n<li><p>安装</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\">npm install husky@<span class=\"hljs-number\">7.0</span><span class=\"hljs-number\">.1</span> --save-dev<br></code></pre></td></tr></table></figure>\n</li>\n<li><p>启动 hooks，在根目录下生成 <code>.husky</code> 文件夹</p>\n</li>\n</ol>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\">npx husky install<br></code></pre></td></tr></table></figure>\n\n<ol start=\"3\">\n<li>在 package.json 中生成 <code>prepare</code> 指令（npm &gt; 7）</li>\n</ol>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\"><span class=\"hljs-comment\">// 执行指令，会在 npm scripts 中生成配置</span><br>npm set-script prepare <span class=\"hljs-string\">&quot;husky install&quot;</span><br></code></pre></td></tr></table></figure>\n\n<ol start=\"4\">\n<li>执行 prepare 指令</li>\n</ol>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\">npm run prepare<br></code></pre></td></tr></table></figure>\n\n<ol start=\"5\">\n<li>添加 <code>commitlint</code> 的 hook 到 husky 中，并在 commit-msg 的 hooks 下，执行 <code>npx --no-install commitlint --edit &quot;$1&quot;</code></li>\n</ol>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\">npx husky add .<span class=\"hljs-property\">husky</span>/commit-msg <span class=\"hljs-string\">&#x27;npx --no-install commitlint --edit &quot;$1&quot;&#x27;</span><br></code></pre></td></tr></table></figure>\n\n<ol start=\"6\">\n<li>打开 .husky，就可以看到 commit-msg 文件了。</li>\n</ol>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\"><span class=\"hljs-comment\">// commit-msg</span><br><br>#!<span class=\"hljs-regexp\">/bin/</span>sh<br>. <span class=\"hljs-string\">&quot;$&#123;dirname &quot;</span>$&#123;<span class=\"hljs-number\">0</span>&#125;<span class=\"hljs-string\">&quot;&#125;/_/husky.sh&quot;</span><br><br>npx --no-install commitlint --edit $<span class=\"hljs-number\">1</span><br></code></pre></td></tr></table></figure>\n\n<ol start=\"7\">\n<li>最后，我们就可以愉快的提交了。</li>\n</ol>\n<h2 id=\"pre-commit-检测代码提交规范\"><a href=\"#pre-commit-检测代码提交规范\" class=\"headerlink\" title=\"pre-commit 检测代码提交规范\"></a>pre-commit 检测代码提交规范</h2><p>虽然我们使用了 eslint + prettier 在本地自动格式化代码，但是，有可能有的小伙伴，忘记将 vscode 的自动保存格式化打开了，并且写的代码格式不符合规范，也是可以提交上去的。</p>\n<p>那么我们就得加一些配置，来检测小伙伴们提交的代码是否符合规范了。</p>\n<p>要完成这一操作，就需要使用 husky 配合 eslint 来实现了。</p>\n<p>我们期望通过 <code>husky</code> 检测 <code>pre-commit</code> 钩子，在该钩子下执行 <code>npx eslint --ext .js,.vue, src</code> 指令去进行相关的检测。</p>\n<ol>\n<li>执行 <code>npx husky add .husky/pre-commit &quot;npx eslint --ext .js,.vue, src&quot;</code> 命令</li>\n</ol>\n<p>会在 .husky 文件夹下面，生成 <code>pre-commit</code> 文件</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\"><span class=\"hljs-comment\">// pre-commit</span><br><br>#!<span class=\"hljs-regexp\">/bin/</span>sh<br>. <span class=\"hljs-string\">&quot;$&#123;dirname &quot;</span>$&#123;<span class=\"hljs-number\">0</span>&#125;<span class=\"hljs-string\">&quot;&#125;/_/husky.sh&quot;</span><br><br>npx eslint --ext .<span class=\"hljs-property\">js</span>,.<span class=\"hljs-property\">vue</span>, src<br></code></pre></td></tr></table></figure>\n\n<p>每次我们提交代码，都会触发 pre-commit 钩子，从而使用 eslint 去检测我们的代码文件。</p>\n<ol start=\"2\">\n<li>关闭自动保存，修改代码提交试试吧</li>\n</ol>\n<h2 id=\"lint-staged-自动修复错误\"><a href=\"#lint-staged-自动修复错误\" class=\"headerlink\" title=\"lint staged 自动修复错误\"></a>lint staged 自动修复错误</h2><p>我们通过 <code>pre-commit</code> + husky 处理了代码提交时的规范化问题，当我们进行代码提交时，会检测所有的代码格式规范。</p>\n<p>但是这样就有两个问题：</p>\n<ol>\n<li>我们只修改了个别文件，没有必要检测所有的文件代码格式</li>\n<li>它只能给我们提示出对应的错误，竟然还需要我们手动进行修复？不合理</li>\n</ol>\n<p>我们使用 <code>lint-staged</code> 插件，来帮助我们解决这两个问题。</p>\n<p>lint-staged 可以 <code>只检测本次更新的代码，并在错误出现的时候，自动修复并且推送</code></p>\n<p><strong>安装</strong></p>\n<p>使用 <code>vue-cli</code> 生成项目时，lint-staged 不需要安装了，项目已经有了。如果没有的话，就需要单独安装</p>\n<ol>\n<li><p>修改 <code>package.json</code>：</p>\n<figure class=\"highlight json\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs json\"><span class=\"hljs-attr\">&quot;lint-staged&quot;</span><span class=\"hljs-punctuation\">:</span> <span class=\"hljs-punctuation\">&#123;</span><br>  <span class=\"hljs-attr\">&quot;src/**/*.&#123;js,jsx,vue&#125;&quot;</span><span class=\"hljs-punctuation\">:</span> <span class=\"hljs-punctuation\">&#123;</span><br>    <span class=\"hljs-string\">&quot;eslint --fix&quot;</span><span class=\"hljs-punctuation\">,</span><br>    <span class=\"hljs-string\">&quot;git add&quot;</span><br>  <span class=\"hljs-punctuation\">&#125;</span><br><span class=\"hljs-punctuation\">&#125;</span><br></code></pre></td></tr></table></figure>\n</li>\n<li><p>修改 .husky/pre-commit 文件</p>\n</li>\n</ol>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\"><span class=\"hljs-comment\">// pre-commit</span><br><br>#!<span class=\"hljs-regexp\">/bin/</span>sh<br>. <span class=\"hljs-string\">&quot;$&#123;dirname &quot;</span>$&#123;<span class=\"hljs-number\">0</span>&#125;<span class=\"hljs-string\">&quot;&#125;/_/husky.sh&quot;</span><br><br><span class=\"hljs-comment\">// npx eslint --ext .js,.vue, src // 删除</span><br><br>npx lint-staged <span class=\"hljs-comment\">// 新增</span><br></code></pre></td></tr></table></figure>\n\n<ol start=\"3\">\n<li>尝试将代码修改为不符合规范的，通过 <code>git cz</code> 再次提交试试！</li>\n</ol>\n<ul>\n<li><p>lint-staged 会尝试自动修复错误</p>\n</li>\n<li><p>错误修复完成，继续执行，并将代码提交</p>\n</li>\n</ul>\n","site":{"data":{}},"wordcount":6284,"more":"<h1 id=\"编程规范\"><a href=\"#编程规范\" class=\"headerlink\" title=\"编程规范\"></a>编程规范</h1><p>编程规范的重要作用：</p>\n<ul>\n<li>规范的代码可以促进团队合作</li>\n<li>规范的代码可以减少bug处理，规范不是对开发的制约，而确实是有助于提高开发效率的</li>\n<li>规范的代码可以降低维护成本</li>\n<li>规范的代码有助于代码审查</li>\n<li>养成代码规范的习惯，有助于自身的成长</li>\n</ul>\n<h2 id=\"ESLint-Prettier-自动格式化代码\"><a href=\"#ESLint-Prettier-自动格式化代码\" class=\"headerlink\" title=\"ESLint + Prettier 自动格式化代码\"></a>ESLint + Prettier 自动格式化代码</h2><ol>\n<li>VSCode 安装 ESLint 插件，在根目录创建 <code>.eslintrc</code> 配置文件</li>\n</ol>\n<figure class=\"highlight json\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs json\">module.exports = <span class=\"hljs-punctuation\">&#123;</span><br>  root<span class=\"hljs-punctuation\">:</span> <span class=\"hljs-keyword\">true</span><span class=\"hljs-punctuation\">,</span> <span class=\"hljs-comment\">// 表示当前目录为根目录</span><br>  env<span class=\"hljs-punctuation\">:</span> <span class=\"hljs-punctuation\">&#123;</span><br>    node<span class=\"hljs-punctuation\">:</span> <span class=\"hljs-keyword\">true</span><span class=\"hljs-punctuation\">,</span><br>  <span class=\"hljs-punctuation\">&#125;</span><span class=\"hljs-punctuation\">,</span><br>  <span class=\"hljs-comment\">// ESLint 中基础配置需要继承的配置</span><br>  extends<span class=\"hljs-punctuation\">:</span> <span class=\"hljs-punctuation\">[</span><br>    <span class=\"hljs-string\">&quot;plugin:vue/vue3-essential&quot;</span><span class=\"hljs-punctuation\">,</span><br>    <span class=\"hljs-string\">&quot;eslint:recommended&quot;</span><span class=\"hljs-punctuation\">,</span><br>    <span class=\"hljs-string\">&quot;@vue/typescript/recommended&quot;</span><span class=\"hljs-punctuation\">,</span><br>    <span class=\"hljs-string\">&quot;@vue/prettier&quot;</span><span class=\"hljs-punctuation\">,</span><br>    <span class=\"hljs-string\">&quot;@vue/prettier/@typescript-eslint&quot;</span><span class=\"hljs-punctuation\">,</span><br>  <span class=\"hljs-punctuation\">]</span><span class=\"hljs-punctuation\">,</span><br>  parserOptions<span class=\"hljs-punctuation\">:</span> <span class=\"hljs-punctuation\">&#123;</span><br>    ecmaVersion<span class=\"hljs-punctuation\">:</span> <span class=\"hljs-number\">2020</span><span class=\"hljs-punctuation\">,</span><br>  <span class=\"hljs-punctuation\">&#125;</span><span class=\"hljs-punctuation\">,</span><br>  <span class=\"hljs-comment\">// 错误规则：off(0) warn(1) error(2)</span><br>  rules<span class=\"hljs-punctuation\">:</span> <span class=\"hljs-punctuation\">&#123;</span><br>    <span class=\"hljs-attr\">&quot;no-console&quot;</span><span class=\"hljs-punctuation\">:</span> process.env.NODE_ENV === <span class=\"hljs-string\">&quot;production&quot;</span> ? <span class=\"hljs-attr\">&quot;warn&quot;</span> <span class=\"hljs-punctuation\">:</span> <span class=\"hljs-string\">&quot;off&quot;</span><span class=\"hljs-punctuation\">,</span><br>    <span class=\"hljs-attr\">&quot;no-debugger&quot;</span><span class=\"hljs-punctuation\">:</span> process.env.NODE_ENV === <span class=\"hljs-string\">&quot;production&quot;</span> ? <span class=\"hljs-attr\">&quot;warn&quot;</span> <span class=\"hljs-punctuation\">:</span> <span class=\"hljs-string\">&quot;off&quot;</span><span class=\"hljs-punctuation\">,</span><br>    <span class=\"hljs-comment\">// 关闭 no-used 检查</span><br>    <span class=\"hljs-attr\">&quot;@typescript-eslint/no-unused-vars&quot;</span><span class=\"hljs-punctuation\">:</span> <span class=\"hljs-string\">&quot;off&quot;</span><span class=\"hljs-punctuation\">,</span><br>  <span class=\"hljs-punctuation\">&#125;</span><span class=\"hljs-punctuation\">,</span><br>  overrides<span class=\"hljs-punctuation\">:</span> <span class=\"hljs-punctuation\">[</span><span class=\"hljs-punctuation\">&#123;</span><br>    files<span class=\"hljs-punctuation\">:</span> <span class=\"hljs-punctuation\">[</span><br>      <span class=\"hljs-string\">&quot;**/__tests__/*.&#123;j,t&#125;s?(x)&quot;</span><span class=\"hljs-punctuation\">,</span><br>      <span class=\"hljs-string\">&quot;**/tests/unit/**/*.spec.&#123;j,t&#125;s?(x)&quot;</span><span class=\"hljs-punctuation\">,</span><br>    <span class=\"hljs-punctuation\">]</span><span class=\"hljs-punctuation\">,</span><br>    env<span class=\"hljs-punctuation\">:</span> <span class=\"hljs-punctuation\">&#123;</span><br>      jest<span class=\"hljs-punctuation\">:</span> <span class=\"hljs-keyword\">true</span><span class=\"hljs-punctuation\">,</span><br>    <span class=\"hljs-punctuation\">&#125;</span><span class=\"hljs-punctuation\">,</span><br>  <span class=\"hljs-punctuation\">&#125;</span><span class=\"hljs-punctuation\">,</span> <span class=\"hljs-punctuation\">]</span><span class=\"hljs-punctuation\">,</span><br><span class=\"hljs-punctuation\">&#125;</span>;<br></code></pre></td></tr></table></figure>\n\n<ol start=\"2\">\n<li><p>VSCode 安装 <code>Prettier</code> 插件，在根目录创建 <code>.prettierrc</code> 配置文件</p>\n<figure class=\"highlight json\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs json\"><span class=\"hljs-punctuation\">&#123;</span><br>  <span class=\"hljs-attr\">&quot;semi&quot;</span><span class=\"hljs-punctuation\">:</span> <span class=\"hljs-keyword\">false</span><span class=\"hljs-punctuation\">,</span> <span class=\"hljs-comment\">// 是否加分号</span><br>  <span class=\"hljs-attr\">&quot;singleQuote&quot;</span><span class=\"hljs-punctuation\">:</span> <span class=\"hljs-keyword\">true</span><span class=\"hljs-punctuation\">,</span> <span class=\"hljs-comment\">// 单引号</span><br>  <span class=\"hljs-attr\">&quot;arrowParens&quot;</span><span class=\"hljs-punctuation\">:</span> <span class=\"hljs-string\">&quot;avoid&quot;</span><span class=\"hljs-punctuation\">,</span> <span class=\"hljs-comment\">// (x) =&gt; &#123;&#125; 箭头函数参数只有一个时，是否要小括号， avoid: 省略小括号</span><br>  <span class=\"hljs-attr\">&quot;trailingComma&quot;</span><span class=\"hljs-punctuation\">:</span> <span class=\"hljs-string\">&quot;none&quot;</span> <span class=\"hljs-comment\">// 以多个逗号相隔的，最后是否加逗号</span><br><span class=\"hljs-punctuation\">&#125;</span><br></code></pre></td></tr></table></figure>\n</li>\n<li><p>我们打开 <code>VSCode</code> 设置，切换到 <code>工作区</code>，找到 <code>Code Action on Save</code>，修改配置：</p>\n<figure class=\"highlight json\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs json\"><span class=\"hljs-attr\">&quot;editor.codeActionsOnSave&quot;</span><span class=\"hljs-punctuation\">:</span> <span class=\"hljs-punctuation\">&#123;</span><br>  <span class=\"hljs-attr\">&quot;source.fixAll&quot;</span><span class=\"hljs-punctuation\">:</span> <span class=\"hljs-keyword\">true</span><span class=\"hljs-punctuation\">,</span><br>  <span class=\"hljs-attr\">&quot;source.fixAll.eslint&quot;</span><span class=\"hljs-punctuation\">:</span> <span class=\"hljs-keyword\">true</span><span class=\"hljs-punctuation\">,</span><br>  <span class=\"hljs-attr\">&quot;source.fixAll.stylelint&quot;</span><span class=\"hljs-punctuation\">:</span> <span class=\"hljs-keyword\">true</span><span class=\"hljs-punctuation\">,</span><br>  <span class=\"hljs-attr\">&quot;source.fixAll.tslint&quot;</span><span class=\"hljs-punctuation\">:</span> <span class=\"hljs-keyword\">true</span><span class=\"hljs-punctuation\">,</span><br><span class=\"hljs-punctuation\">&#125;</span><span class=\"hljs-punctuation\">,</span><br></code></pre></td></tr></table></figure>\n</li>\n<li><p>注意项</p>\n</li>\n</ol>\n<ul>\n<li><p>对 VSCode 而言，默认一个 tab 等于 4 个空格，而 ESlint 默认为两个空格，我们在 VSCode 设置中，找到 <code>tab size</code> 改为 2 就行。</p>\n</li>\n<li><p>可能安装了多个代码格式化工具，我们右键文件，找到 <code>使用...格式化文档</code>，设置默认的为 <code>Prettier</code> 即可。</p>\n</li>\n<li><p>有可能 Prettier 和 eslint 规则存在冲突，比如 eslint 希望方法名和括号之间有空格，而 Prettier 不希望有空格，控制台就会报出 ESlint 错误，我们就可以找到 ESlint 配置文件，找到 <code>rules</code>，将 <code>space-before-function-paren</code> 设置为 <code>0</code> 或者 <code>off</code> 即可。</p>\n</li>\n</ul>\n<h2 id=\"Git-提交规范\"><a href=\"#Git-提交规范\" class=\"headerlink\" title=\"Git 提交规范\"></a>Git 提交规范</h2><figure class=\"highlight md\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs md\">&lt;类型&gt;[可选 范围]: &lt;描述&gt;<br><br>[可选 正文]<br><br>[可选 脚注]<br></code></pre></td></tr></table></figure>\n\n<h3 id=\"Commitizen\"><a href=\"#Commitizen\" class=\"headerlink\" title=\"Commitizen\"></a>Commitizen</h3><p>Github: cz-cli</p>\n<p>当你使用 commitizen 进行代码提交时，commitizen 会提交你在提交时填写所有必须得提交字段</p>\n<ol>\n<li><p>全局安装</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\">npm install -g commitizen@<span class=\"hljs-number\">4.2</span><span class=\"hljs-number\">.4</span><br></code></pre></td></tr></table></figure>\n</li>\n<li><p>项目配置</p>\n</li>\n</ol>\n<ul>\n<li>安装 cz-customizable</li>\n</ul>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\">npm install cz-customizable@<span class=\"hljs-number\">6.3</span><span class=\"hljs-number\">.0</span> --save-dev<br></code></pre></td></tr></table></figure>\n\n<ul>\n<li>在 package.json 中配置</li>\n</ul>\n<p>表示 commitizen 的配置在 node_modules 中的第三方包之中。</p>\n<figure class=\"highlight json\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs json\">...<br><span class=\"hljs-attr\">&quot;config&quot;</span><span class=\"hljs-punctuation\">:</span> <span class=\"hljs-punctuation\">&#123;</span><br>  <span class=\"hljs-attr\">&quot;commitizen&quot;</span><span class=\"hljs-punctuation\">:</span> <span class=\"hljs-punctuation\">&#123;</span><br>    <span class=\"hljs-attr\">&quot;path&quot;</span><span class=\"hljs-punctuation\">:</span> <span class=\"hljs-string\">&quot;node_modules/cz-customizable&quot;</span><br>  <span class=\"hljs-punctuation\">&#125;</span><br><span class=\"hljs-punctuation\">&#125;</span><br>...<br></code></pre></td></tr></table></figure>\n\n<p>3.项目根目录下创建 <code>.cz-config.js</code>，配置自定义提示文件</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\"><span class=\"hljs-variable language_\">module</span>.<span class=\"hljs-property\">exports</span> = &#123;<br>  <span class=\"hljs-attr\">types</span>: [<br>    &#123; <span class=\"hljs-attr\">value</span>: <span class=\"hljs-string\">&#x27;feat&#x27;</span>, <span class=\"hljs-attr\">name</span>: <span class=\"hljs-string\">&#x27;feat:     新功能&#x27;</span> &#125;,<br>    &#123; <span class=\"hljs-attr\">value</span>: <span class=\"hljs-string\">&#x27;fix&#x27;</span>, <span class=\"hljs-attr\">name</span>: <span class=\"hljs-string\">&#x27;fix:     修复&#x27;</span> &#125;,<br>    &#123; <span class=\"hljs-attr\">value</span>: <span class=\"hljs-string\">&#x27;docs&#x27;</span>, <span class=\"hljs-attr\">name</span>: <span class=\"hljs-string\">&#x27;docs:     文档变更&#x27;</span> &#125;,<br>    &#123; <span class=\"hljs-attr\">value</span>: <span class=\"hljs-string\">&#x27;style&#x27;</span>, <span class=\"hljs-attr\">name</span>: <span class=\"hljs-string\">&#x27;style:     代码格式（不影响代码运行的变动）&#x27;</span> &#125;,<br>    &#123; <span class=\"hljs-attr\">value</span>: <span class=\"hljs-string\">&#x27;refactor&#x27;</span>, <span class=\"hljs-attr\">name</span>: <span class=\"hljs-string\">&#x27;refactor:     重构（既不是增加 feature，也不是修复 bug）&#x27;</span> &#125;,<br>    &#123; <span class=\"hljs-attr\">value</span>: <span class=\"hljs-string\">&#x27;perf&#x27;</span>, <span class=\"hljs-attr\">name</span>: <span class=\"hljs-string\">&#x27;perf:     性能优化&#x27;</span> &#125;,<br>    &#123; <span class=\"hljs-attr\">value</span>: <span class=\"hljs-string\">&#x27;test&#x27;</span>, <span class=\"hljs-attr\">name</span>: <span class=\"hljs-string\">&#x27;test:     增加测试&#x27;</span> &#125;,<br>    &#123; <span class=\"hljs-attr\">value</span>: <span class=\"hljs-string\">&#x27;chore&#x27;</span>, <span class=\"hljs-attr\">name</span>: <span class=\"hljs-string\">&#x27;chore:     构建过程或辅助工具的变动&#x27;</span> &#125;,<br>    &#123; <span class=\"hljs-attr\">value</span>: <span class=\"hljs-string\">&#x27;revert&#x27;</span>, <span class=\"hljs-attr\">name</span>: <span class=\"hljs-string\">&#x27;revert:     回退&#x27;</span> &#125;,<br>    &#123; <span class=\"hljs-attr\">value</span>: <span class=\"hljs-string\">&#x27;build&#x27;</span>, <span class=\"hljs-attr\">name</span>: <span class=\"hljs-string\">&#x27;build:     打包&#x27;</span> &#125;,<br>  ],<br>  <span class=\"hljs-comment\">// 步骤</span><br>  <span class=\"hljs-attr\">messages</span>: &#123;<br>    <span class=\"hljs-attr\">type</span>: <span class=\"hljs-string\">&#x27;请选择提交的类型&#x27;</span>,<br>    <span class=\"hljs-attr\">customScope</span>: <span class=\"hljs-string\">&#x27;请输入修改的范围（可选）&#x27;</span>,<br>    <span class=\"hljs-attr\">subject</span>: <span class=\"hljs-string\">&#x27;请简要描述提交内容（必填）&#x27;</span>,<br>    <span class=\"hljs-attr\">body</span>: <span class=\"hljs-string\">&#x27;请输入详细的描述（可选）&#x27;</span>,<br>    <span class=\"hljs-attr\">footer</span>: <span class=\"hljs-string\">&#x27;请输入要关闭的 issue（可选）&#x27;</span>,<br>    <span class=\"hljs-attr\">confirmCommit</span>: <span class=\"hljs-string\">&#x27;确认要使用以上信息提交?(y/n)&#x27;</span>,<br>  &#125;,<br>  <span class=\"hljs-comment\">// 需要跳过的问题</span><br>  <span class=\"hljs-attr\">skipQuestions</span>: [<span class=\"hljs-string\">&#x27;body&#x27;</span>, <span class=\"hljs-string\">&#x27;footer&#x27;</span>],<br>  <span class=\"hljs-attr\">subjectLimit</span>: <span class=\"hljs-number\">72</span>, <span class=\"hljs-comment\">// 描述内容的限制</span><br>&#125;<br></code></pre></td></tr></table></figure>\n\n<ol start=\"4\">\n<li><p>使用 <code>git cz</code> 代替 <code>git commit</code></p>\n</li>\n<li><p>最后</p>\n</li>\n</ol>\n<p>我们可以通过 <code>git cz</code> 规范化了 git 提交，那么存在一个问题，我们必须通过 <code>git cz</code> 提交，才能规范化，如果我们忘记了使用 <code>git cz</code>，依然使用的 <code>git commit</code> 直接提交了怎么办呢？</p>\n<p>那么，有没有办法限制这种错误的出现？</p>\n<p>使用 <code>git hooks</code></p>\n<h3 id=\"Git-Hooks\"><a href=\"#Git-Hooks\" class=\"headerlink\" title=\"Git Hooks\"></a>Git Hooks</h3><p>当《提交描述信息》不符合 <code>约定式提交规范</code> 的时候，阻止当前的提交，并抛出相应的错误提示。</p>\n<p>通过 <code>git hooks</code> 在执行某个事件之前或者之后进行一些额外的操作。</p>\n<p>git hooks 非常多，实际用的比较多的就两个：</p>\n<ul>\n<li>pre-commit：git commit 执行前，在获取提交日志信息并进行提交之前调用</li>\n<li>commit-msg：git commit 执行前，可用于将消息规范化为某种项目标准格式</li>\n</ul>\n<h3 id=\"使用-husky-commitlint-检查提交信息\"><a href=\"#使用-husky-commitlint-检查提交信息\" class=\"headerlink\" title=\"使用 husky + commitlint 检查提交信息\"></a>使用 husky + commitlint 检查提交信息</h3><p>使用 <code>git hooks</code>去检验我们的提交信息，需要使用两个工具：</p>\n<ul>\n<li>commitlint: 用于检查提交信息</li>\n<li>husky: git hooks 工具</li>\n</ul>\n<p>主要: <strong>npm 版本需要在 7.x 以上</strong></p>\n<ol>\n<li><p>安装依赖:</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\">npm install @commitlint/config-conventional@<span class=\"hljs-number\">12.1</span><span class=\"hljs-number\">.4</span> @commitlint/cli@<span class=\"hljs-number\">12.1</span><span class=\"hljs-number\">.4</span> --save-dev<br></code></pre></td></tr></table></figure>\n</li>\n<li><p>创建 <code>commitlint-config.js</code></p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\"><span class=\"hljs-variable language_\">module</span>.<span class=\"hljs-property\">exports</span> = &#123;<br>  <span class=\"hljs-attr\">extends</span>: [<span class=\"hljs-string\">&#x27;@commitlint/config-conventional&#x27;</span>]<br>&#125;<br></code></pre></td></tr></table></figure>\n</li>\n<li><p>增加配置项</p>\n</li>\n</ol>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\"><span class=\"hljs-variable language_\">module</span>.<span class=\"hljs-property\">exports</span> = &#123;<br>  <span class=\"hljs-attr\">extends</span>: [<span class=\"hljs-string\">&#x27;@commitlint/config-conventional&#x27;</span>],<br>  <span class=\"hljs-attr\">rules</span>: &#123;<br>    <span class=\"hljs-comment\">// type 的类型定义，表示 git 提交的 type 必须在以下范围内</span><br>    <span class=\"hljs-string\">&#x27;type-enum&#x27;</span>: [<br>      <span class=\"hljs-comment\">// 当前验证的错误级别</span><br>      <span class=\"hljs-number\">2</span>,<br>      <span class=\"hljs-comment\">// 在什么情况下验证</span><br>      <span class=\"hljs-string\">&#x27;always&#x27;</span>,<br>      <span class=\"hljs-comment\">// 枚举的内容</span><br>      [<span class=\"hljs-string\">&#x27;feat&#x27;</span>, <span class=\"hljs-string\">&#x27;fix&#x27;</span>, <span class=\"hljs-string\">&#x27;docs&#x27;</span>, <span class=\"hljs-string\">&#x27;style&#x27;</span>, <span class=\"hljs-string\">&#x27;refactor&#x27;</span>, <span class=\"hljs-string\">&#x27;perf&#x27;</span>, <span class=\"hljs-string\">&#x27;test&#x27;</span>, <span class=\"hljs-string\">&#x27;chore&#x27;</span>, <span class=\"hljs-string\">&#x27;revert&#x27;</span>, <span class=\"hljs-string\">&#x27;build&#x27;</span>],<br>    ],<br>    <span class=\"hljs-comment\">// subject 大小写不做校验</span><br>    <span class=\"hljs-string\">&#x27;subject-case&#x27;</span>: [<span class=\"hljs-number\">0</span>]<br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure>\n\n<p><strong>注意</strong>: 必须确保我们的配置文件保存为 <code>utf-8</code> 的编码格式，否则可能会报错。</p>\n<p>打开配置文件，查看 <code>vscode</code> 右下角，是否显示了 <code>utf-8</code>，如果不是就要将其切换为正确的编码格式。</p>\n<ol start=\"4\">\n<li>安装 husky</li>\n</ol>\n<p>检测 git hooks 的工具</p>\n<ol>\n<li><p>安装</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\">npm install husky@<span class=\"hljs-number\">7.0</span><span class=\"hljs-number\">.1</span> --save-dev<br></code></pre></td></tr></table></figure>\n</li>\n<li><p>启动 hooks，在根目录下生成 <code>.husky</code> 文件夹</p>\n</li>\n</ol>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\">npx husky install<br></code></pre></td></tr></table></figure>\n\n<ol start=\"3\">\n<li>在 package.json 中生成 <code>prepare</code> 指令（npm &gt; 7）</li>\n</ol>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\"><span class=\"hljs-comment\">// 执行指令，会在 npm scripts 中生成配置</span><br>npm set-script prepare <span class=\"hljs-string\">&quot;husky install&quot;</span><br></code></pre></td></tr></table></figure>\n\n<ol start=\"4\">\n<li>执行 prepare 指令</li>\n</ol>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\">npm run prepare<br></code></pre></td></tr></table></figure>\n\n<ol start=\"5\">\n<li>添加 <code>commitlint</code> 的 hook 到 husky 中，并在 commit-msg 的 hooks 下，执行 <code>npx --no-install commitlint --edit &quot;$1&quot;</code></li>\n</ol>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\">npx husky add .<span class=\"hljs-property\">husky</span>/commit-msg <span class=\"hljs-string\">&#x27;npx --no-install commitlint --edit &quot;$1&quot;&#x27;</span><br></code></pre></td></tr></table></figure>\n\n<ol start=\"6\">\n<li>打开 .husky，就可以看到 commit-msg 文件了。</li>\n</ol>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\"><span class=\"hljs-comment\">// commit-msg</span><br><br>#!<span class=\"hljs-regexp\">/bin/</span>sh<br>. <span class=\"hljs-string\">&quot;$&#123;dirname &quot;</span>$&#123;<span class=\"hljs-number\">0</span>&#125;<span class=\"hljs-string\">&quot;&#125;/_/husky.sh&quot;</span><br><br>npx --no-install commitlint --edit $<span class=\"hljs-number\">1</span><br></code></pre></td></tr></table></figure>\n\n<ol start=\"7\">\n<li>最后，我们就可以愉快的提交了。</li>\n</ol>\n<h2 id=\"pre-commit-检测代码提交规范\"><a href=\"#pre-commit-检测代码提交规范\" class=\"headerlink\" title=\"pre-commit 检测代码提交规范\"></a>pre-commit 检测代码提交规范</h2><p>虽然我们使用了 eslint + prettier 在本地自动格式化代码，但是，有可能有的小伙伴，忘记将 vscode 的自动保存格式化打开了，并且写的代码格式不符合规范，也是可以提交上去的。</p>\n<p>那么我们就得加一些配置，来检测小伙伴们提交的代码是否符合规范了。</p>\n<p>要完成这一操作，就需要使用 husky 配合 eslint 来实现了。</p>\n<p>我们期望通过 <code>husky</code> 检测 <code>pre-commit</code> 钩子，在该钩子下执行 <code>npx eslint --ext .js,.vue, src</code> 指令去进行相关的检测。</p>\n<ol>\n<li>执行 <code>npx husky add .husky/pre-commit &quot;npx eslint --ext .js,.vue, src&quot;</code> 命令</li>\n</ol>\n<p>会在 .husky 文件夹下面，生成 <code>pre-commit</code> 文件</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\"><span class=\"hljs-comment\">// pre-commit</span><br><br>#!<span class=\"hljs-regexp\">/bin/</span>sh<br>. <span class=\"hljs-string\">&quot;$&#123;dirname &quot;</span>$&#123;<span class=\"hljs-number\">0</span>&#125;<span class=\"hljs-string\">&quot;&#125;/_/husky.sh&quot;</span><br><br>npx eslint --ext .<span class=\"hljs-property\">js</span>,.<span class=\"hljs-property\">vue</span>, src<br></code></pre></td></tr></table></figure>\n\n<p>每次我们提交代码，都会触发 pre-commit 钩子，从而使用 eslint 去检测我们的代码文件。</p>\n<ol start=\"2\">\n<li>关闭自动保存，修改代码提交试试吧</li>\n</ol>\n<h2 id=\"lint-staged-自动修复错误\"><a href=\"#lint-staged-自动修复错误\" class=\"headerlink\" title=\"lint staged 自动修复错误\"></a>lint staged 自动修复错误</h2><p>我们通过 <code>pre-commit</code> + husky 处理了代码提交时的规范化问题，当我们进行代码提交时，会检测所有的代码格式规范。</p>\n<p>但是这样就有两个问题：</p>\n<ol>\n<li>我们只修改了个别文件，没有必要检测所有的文件代码格式</li>\n<li>它只能给我们提示出对应的错误，竟然还需要我们手动进行修复？不合理</li>\n</ol>\n<p>我们使用 <code>lint-staged</code> 插件，来帮助我们解决这两个问题。</p>\n<p>lint-staged 可以 <code>只检测本次更新的代码，并在错误出现的时候，自动修复并且推送</code></p>\n<p><strong>安装</strong></p>\n<p>使用 <code>vue-cli</code> 生成项目时，lint-staged 不需要安装了，项目已经有了。如果没有的话，就需要单独安装</p>\n<ol>\n<li><p>修改 <code>package.json</code>：</p>\n<figure class=\"highlight json\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs json\"><span class=\"hljs-attr\">&quot;lint-staged&quot;</span><span class=\"hljs-punctuation\">:</span> <span class=\"hljs-punctuation\">&#123;</span><br>  <span class=\"hljs-attr\">&quot;src/**/*.&#123;js,jsx,vue&#125;&quot;</span><span class=\"hljs-punctuation\">:</span> <span class=\"hljs-punctuation\">&#123;</span><br>    <span class=\"hljs-string\">&quot;eslint --fix&quot;</span><span class=\"hljs-punctuation\">,</span><br>    <span class=\"hljs-string\">&quot;git add&quot;</span><br>  <span class=\"hljs-punctuation\">&#125;</span><br><span class=\"hljs-punctuation\">&#125;</span><br></code></pre></td></tr></table></figure>\n</li>\n<li><p>修改 .husky/pre-commit 文件</p>\n</li>\n</ol>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\"><span class=\"hljs-comment\">// pre-commit</span><br><br>#!<span class=\"hljs-regexp\">/bin/</span>sh<br>. <span class=\"hljs-string\">&quot;$&#123;dirname &quot;</span>$&#123;<span class=\"hljs-number\">0</span>&#125;<span class=\"hljs-string\">&quot;&#125;/_/husky.sh&quot;</span><br><br><span class=\"hljs-comment\">// npx eslint --ext .js,.vue, src // 删除</span><br><br>npx lint-staged <span class=\"hljs-comment\">// 新增</span><br></code></pre></td></tr></table></figure>\n\n<ol start=\"3\">\n<li>尝试将代码修改为不符合规范的，通过 <code>git cz</code> 再次提交试试！</li>\n</ol>\n<ul>\n<li><p>lint-staged 会尝试自动修复错误</p>\n</li>\n<li><p>错误修复完成，继续执行，并将代码提交</p>\n</li>\n</ul>\n"},{"layout":"Vue3","title":"Vue3项目实战(三)：登录/请求模块/鉴权","date":"2022-12-23T15:34:24.000Z","banner_img":"/img/login.png","index_img":"/img/login.png","excerpt":"axios模块/接口请求模块/登录请求动作/Token缓存/鉴权","_content":"\n# 配置环境变量 / 封装 axios\n\n封装的 axios 模块，至少具备一种能力，**根据当前环境的不同，设定不同的 baseUrl**\n\n`@vue/cli` 模式\n\n> 官网：https://cli.vuejs.org/zh/guide/mode-and-env.html#%E7%8E%AF%E5%A2%83%E5%8F%98%E9%87%8F\n\n请注意，只有 NODE_ENV，BASE_URL 和以 VUE_APP_ 开头的变量将通过 webpack.DefinePlugin 静态地嵌入到客户端侧的代码中。这是为了避免意外公开机器上可能具有相同名称的私钥。\n\n除了 VUE_APP_* 变量之外，在你的应用代码中始终可用的还有两个特殊的变量：\n\n- NODE_ENV - 会是 \"development\"、\"production\" 或 \"test\" 中的一个。具体的值取决于应用运行的模式。\n- BASE_URL - 会和 vue.config.js 中的 publicPath 选项相符，即你的应用会部署到的基础路径。\n\n```js\n// .env.development\n\nusername=chenghaolun // 不会暴露出来\n\nVUE_APP_BASE_API=/api // 暴露出来，可以通过 process.env 获取\n```\n\n所有解析出来的环境变量都可以在 public/index.html 中以 HTML 插值中介绍的方式使用。\n\n```js\n<title>网站标题 <%= VUE_APP_BASE_API %></title>\n```\n\n我们可以打印 `process.env` 看看：\n\n```js\n{\n  BASE_URL: \"/\",\n  NODE_ENV: \"development\",\n  VUE_APP_BASE_API: \"/api\",\n}\n```\n\n# 根据环境变量切换 baseUrl\n\n```js\nimport axios from 'axios'\n\nconst service = axios.create({\n  baseURL: process.env.VUE_APP_BASE_API,\n  timeout: 5000\n})\n\nexport default service\n```\n\n# 封装接口请求模块\n\n在 `src` 下创建 `api` 文件夹，并创建 `sys.ts` 文件，用于处理系统的一些接口请求：\n\n```js\nimport request from '@/utils/request'\n\nexport const login = data => {\n  return request({\n    url: '/sys/login',\n    method: 'POST',\n    data\n  })\n}\n```\n\n# 封装登录请求动作\n\n我们不希望在点击登录按钮时，就立马调用登录接口，而是将其封装到 `vuex` 中，当然也可以使用 `pinia`。\n\n在 store 下创建 modules 文件夹，并创建 `user.ts` 模块，用于处理所有的 `用户相关` 的内容（token获取、用户信息获取、退出登录...）\n\n**注意**\n\n当我们创建好了 store 时，在 vue template 里面使用 `$store.state.globalName` 可能会爆红，原因是没有声明 `$store`\n\n```js\n// src/vuex.d.ts\nimport { Store } from 'vuex'\n\ndeclare module '@vue/runtime-core' {\n  // 声明自己的 store state\n  interface State {\n    globalName: string\n  }\n\n  // 为 `this.$store` 提供类型声明\n  interface ComponentCustomProperties {\n    $store: Store<State>\n  }\n}\n\n```\n\n**创建 user.ts** 模块\n\n```js\n// store/index.js\n\nimport { createStore } from 'vuex'\nimport user from './modules/user'\n\nexport default createStore({\n  state() {\n    return {\n      globalName: 'Hello_AlexCc'\n    }\n  },\n  modules: {\n    user\n  }\n})\n```\n\n**创建 `modules` 文件夹**\n```js\nimport md5 from 'md5'\nimport { login } from '@/api/sys'\n\nexport default {\n  namespaced: true,\n  state: () => ({}),\n  mutations: {},\n  actions: {\n    login(context: any, userInfo: any) {\n      const { username, password } = userInfo\n      return new Promise((resolve, reject) => {\n        login({\n          username,\n          password: md5(password)\n        })\n          .then(res => {\n            resolve(res)\n          })\n          .catch(err => {\n            reject(err)\n          })\n      })\n    }\n  }\n}\n```\n\n到这里，我们的登录请求动作就完成了，我们只需要在点击登录按钮时，获取到 store 并 dispatch login 方法即可：\n\n```js\n// 获取到 store 实例\nconst store = useStore()\n\n// user.value 是登录表单的 ref\n\nstore\n  .dispatch('user/login', user.value)\n  .then(res => {\n    console.log('login res', res)\n  })\n  .catch(err => {\n    console.log('err ', err)\n  })\n```\n\n# 写一个简单的 node 服务器\n```js\nconst express = require('express');\nconst app = express()\n\napp.get('/user', (req, res) => {\n  res.json({\n    code: 0,\n    msg: \"hello server 9999\"\n  })\n})\n\napp.listen(9999, () => {\n  console.log('server site an port 9999 ...')\n})\n```\n\n# 配置 devServer\n\n我们将 项目 和 node 服务跑起来之后，点击登录，发现报错了 404，是因为请求 `http://localhost:8080/#/api/user` 并不存在，接口请求地址资源找不到，我们的接口写在 node 端，那么 node 服务跑起来后，我们怎么去访问呢，这里就要用到 webpack 的 `devServer` 了。\n\n```js\n// vue.config.js\n\ndevServer: {\n  // 配置代理\n  proxy: {\n    // 当地址中有/api的时候会触发代理机制，因为我们配置了 axios baseURL，所以每个请求中，都会以 `/api` 开头\n    '/api': {\n      // 要代理的服务器地址  这里不用写 api\n      // node 服务\n      target: 'http://localhost:9999',\n      changeOrigin: true, // 是否跨域\n      pathRewrite: {\n        // 必须得带上,否则，真正的请求中就会带上 '/api'，'http://localhost:9999/api/user'\n        '^/api': ''\n      }\n    }\n  }\n},\n```\n\n最后，我们再重启项目，点击登录，就会拿到 `user` 接口返回的的结果了。\n\n![](/img/api-user.png)\n\n\n# 本地缓存处理方案\n\n存储 token 分为两种：\n\n- 本地缓存：localstorage\n- 全局状态管理：vuex\n\n保存在 `localstorage` 中，是为了在 token 没过期的情况下，让用户自动登录。保存在 vuex 中，是为了方便在其他位置使用。\n\n那么我们来定义 `localstorage` 的相关方法吧！\n\n```js\n// utils/storage.ts\n\n/**\n * 存储数据\n */\nexport const setItem = (key: string, value: unknown): void => {\n  // 将数组、对象类型的数据转化为 JSON 字符串进行存储\n  if (typeof value === 'object') {\n    value = JSON.stringify(value)\n  }\n  window.localStorage.setItem(key, value as string)\n}\n\n/**\n * 获取数据\n */\nexport const getItem = (key: string): unknown => {\n  const data = window.localStorage.getItem(key) as string\n  try {\n    return JSON.parse(data)\n  } catch (err) {\n    // 如果报错了，直接将数据发送给使用端\n    return data\n  }\n}\n\n/**\n * 删除数据\n */\nexport const removeItem = (key: string): void => {\n  window.localStorage.removeItem(key)\n}\n\n/**\n * 删除所有数据\n */\nexport const removeAllItem = (key: string): void => {\n  window.localStorage.clear()\n}\n```\n\n然后，我们来处理 vuex user 模块，在 state 中定义 `token`，以及设置 token 的 mutations 方法。\n\n```js\nimport { setItem, getItem } from '@/utils/storage'\n\n// 我们可以定义一个常量文件夹，用来设置 TOKEN 常量，或者各种其他常量值\nconst TOKEN = 'token'\n\n{\n  state: () => ({\n    token: getItem(TOKEN) || ''\n  }),\n  mutations: {\n    setToken(state: IState, token: string): void {\n      state.token = token\n\n      // 本地存储 token\n      setItem(TOKEN, token)\n    }\n  },\n}\n```\n\n在 actions login 方法中，请求成功后我们需要 commit 一个 mutation，来触发 setToken 方法:\n\n```js\ncontext.commit('setToken', res.data.data.token)\n```\n\n到这，我们的 token 存储就完成了，我们可以在页面上将其显示出来看看。\n\n```js\n<p>token: {{ $store.state.user.token || '暂无Token' }}</p>\n```\n\n# 接口响应数据统一处理\n\n我们在 `vuex user` 模块中通过 login 接口获取到了 `token`，当我们处理数据时，会发现需要通过好几个 `.` 的方式去拿到token，层级太深了，不太方便。\n\n那么我们可以通过 `axios` 的响应拦截器来处理这种情况。\n\n```js\nimport { ElMessage } from 'element-plus'\n\n// 响应拦截器\nservice.interceptors.response.use(\n  response => {\n    const { success, message, data } = response.data\n\n    if (success) {\n      return data\n    } else {\n      ElMessage.error(message)\n      return Promise.reject(new Error(message))\n    }\n  },\n  error => {\n    ElMessage.error(error.message) // 提示错误信息\n    return Promise.reject(error)\n  }\n)\n```\n\n修改好 axios 响应拦截器之后，我们就可以改写一下 `vuex user` 下的 `actions login` 方法了。\n\n```js\n.then(res => {\n  context.commit('setToken', res.token) // 这样获取 token 是不是就方便很多了\n  resolve(res)\n})\n```\n\n# 登录后操作\n\n我们可以创建一个 `src/layout` 文件夹，登录成功后，用来显示的主容器，将 `layout/index.vue` 配置在 router 路由表中\n\n```js\n{\n  path: '/',\n  component: () => import('@/layout/index.vue')\n}\n```\n\n登录成功后，跳转到 `layout` 页面\n\n```js\n// login/index.vue\n\nstore\n  .dispatch('user/login', user.value)\n  .then(() => {\n    router.replace('/')\n  })\n  .catch(err => {\n    console.log('err ', err)\n  })\n```\n\n# 登录鉴权\n\n到这里，我们点击登录，就可以跳转到 `layout` 页面了，但是我们如果在地址栏手动输入 `/login`，我们依然可以回到 `login` 页面，明明我们登录成功，有了 token 还会跳到 login 页面，这是为什么呢？\n\n因为我们到这里，还未做登录鉴权，即使存在token，我们并未做任何的权限控制和处理。\n\n那么我们要做什么处理呢？\n\n- 当用户未登录时，不允许进入除 `login` 之外的任何页面\n\n- 用户登录成功之后，token 未过期之前，不让用户进入 `login` 页面\n\n实现这个功能的核心就是使用 `vue-router` 的 **路由守卫**\n\n> 传送门：https://router.vuejs.org/zh/guide/advanced/navigation-guards.html\n\n那么我们创建 `permission.ts` 来处理路由守卫吧：\n\n因为我们的 token 定义在 `modules user` 中，每次获取 token，需要使用 `store.state.user.token`，这样显得太长了，我们可以定义 `store getters`，来方便获取 `token`：\n\n```js\n// getters.ts\nconst getters = {\n  token: (state: any) => state.user.token\n}\nexport default getters\n```\n\n然后将其放入 store 的 getters 中\n```js\nimport getters from './getters'\n\nexport default createStore({\n  state() {\n    return {\n      globalName: 'Hello_AlexCc'\n    }\n  },\n  getters,\n  modules: {\n    user\n  }\n})\n```\n\n然后创建 permissions.ts 文件，定义路由前置守卫。\n\n判断 token 是否存在，如果存在 token，并且 `to.path` 等于 `/login`，那么不让跳转到登录页，而是去 `layout` 页面。\n\n如果 `to.path` 不是 `/login`，直接执行 `next` 方法即可。\n\n如果 token 不存在，并且 `to.path` 是 `/login`，直接跳转 `next()`\n\n如果 token 不存在并且 `to.path` 不是 `/login`，我们让其跳转到登录页 `next('/login')`\n\n```js\n// permissions.ts\n\nimport router from './router'\nimport store from './store'\n\nrouter.beforeEach((to, from, next) => {\n  // 判断token是否存在\n  if (store.getters.token) {\n    if (to.path === '/login') {\n      next('/')\n    } else {\n      next()\n    }\n  } else {\n    if (to.path === '/login') {\n      next()\n    } else {\n      next('/login')\n    }\n  }\n})\n```\n\n到这里，我们点击登录，就会去到根路径下 '/'，也就是 `layout` 页面。这时我们在地址栏输入 `/login`，就不会再去登录页面了。\n\n我们还可以改进一下，当 `token` 不存在时，我们判断了 `to.path === '/login'`，这样限制死了，将来我们还有 `/404` 以及 `/401` 等页面，这些页面也是不需要 `token` 就能访问的，我们不希望在 `if` 语句里面加太多的判断逻辑，这时，我们可以定义一个 `白名单`，专门处理不需要 `token` 的路径:\n\n```js\nconst whiteList = ['/login']\n\nif (whiteList.indexOf(to.path) > -1) {\n  next()\n} else {\n  next('/login')\n}\n```\n","source":"_posts/vue3-project-generalLogin.md","raw":"---\nlayout: Vue3\ntitle: Vue3项目实战(三)：登录/请求模块/鉴权\ndate: 2022-12-23 23:34:24\ntags: 工程化,Vue3,Config\nbanner_img: /img/login.png\nindex_img: /img/login.png\nexcerpt: axios模块/接口请求模块/登录请求动作/Token缓存/鉴权\n---\n\n# 配置环境变量 / 封装 axios\n\n封装的 axios 模块，至少具备一种能力，**根据当前环境的不同，设定不同的 baseUrl**\n\n`@vue/cli` 模式\n\n> 官网：https://cli.vuejs.org/zh/guide/mode-and-env.html#%E7%8E%AF%E5%A2%83%E5%8F%98%E9%87%8F\n\n请注意，只有 NODE_ENV，BASE_URL 和以 VUE_APP_ 开头的变量将通过 webpack.DefinePlugin 静态地嵌入到客户端侧的代码中。这是为了避免意外公开机器上可能具有相同名称的私钥。\n\n除了 VUE_APP_* 变量之外，在你的应用代码中始终可用的还有两个特殊的变量：\n\n- NODE_ENV - 会是 \"development\"、\"production\" 或 \"test\" 中的一个。具体的值取决于应用运行的模式。\n- BASE_URL - 会和 vue.config.js 中的 publicPath 选项相符，即你的应用会部署到的基础路径。\n\n```js\n// .env.development\n\nusername=chenghaolun // 不会暴露出来\n\nVUE_APP_BASE_API=/api // 暴露出来，可以通过 process.env 获取\n```\n\n所有解析出来的环境变量都可以在 public/index.html 中以 HTML 插值中介绍的方式使用。\n\n```js\n<title>网站标题 <%= VUE_APP_BASE_API %></title>\n```\n\n我们可以打印 `process.env` 看看：\n\n```js\n{\n  BASE_URL: \"/\",\n  NODE_ENV: \"development\",\n  VUE_APP_BASE_API: \"/api\",\n}\n```\n\n# 根据环境变量切换 baseUrl\n\n```js\nimport axios from 'axios'\n\nconst service = axios.create({\n  baseURL: process.env.VUE_APP_BASE_API,\n  timeout: 5000\n})\n\nexport default service\n```\n\n# 封装接口请求模块\n\n在 `src` 下创建 `api` 文件夹，并创建 `sys.ts` 文件，用于处理系统的一些接口请求：\n\n```js\nimport request from '@/utils/request'\n\nexport const login = data => {\n  return request({\n    url: '/sys/login',\n    method: 'POST',\n    data\n  })\n}\n```\n\n# 封装登录请求动作\n\n我们不希望在点击登录按钮时，就立马调用登录接口，而是将其封装到 `vuex` 中，当然也可以使用 `pinia`。\n\n在 store 下创建 modules 文件夹，并创建 `user.ts` 模块，用于处理所有的 `用户相关` 的内容（token获取、用户信息获取、退出登录...）\n\n**注意**\n\n当我们创建好了 store 时，在 vue template 里面使用 `$store.state.globalName` 可能会爆红，原因是没有声明 `$store`\n\n```js\n// src/vuex.d.ts\nimport { Store } from 'vuex'\n\ndeclare module '@vue/runtime-core' {\n  // 声明自己的 store state\n  interface State {\n    globalName: string\n  }\n\n  // 为 `this.$store` 提供类型声明\n  interface ComponentCustomProperties {\n    $store: Store<State>\n  }\n}\n\n```\n\n**创建 user.ts** 模块\n\n```js\n// store/index.js\n\nimport { createStore } from 'vuex'\nimport user from './modules/user'\n\nexport default createStore({\n  state() {\n    return {\n      globalName: 'Hello_AlexCc'\n    }\n  },\n  modules: {\n    user\n  }\n})\n```\n\n**创建 `modules` 文件夹**\n```js\nimport md5 from 'md5'\nimport { login } from '@/api/sys'\n\nexport default {\n  namespaced: true,\n  state: () => ({}),\n  mutations: {},\n  actions: {\n    login(context: any, userInfo: any) {\n      const { username, password } = userInfo\n      return new Promise((resolve, reject) => {\n        login({\n          username,\n          password: md5(password)\n        })\n          .then(res => {\n            resolve(res)\n          })\n          .catch(err => {\n            reject(err)\n          })\n      })\n    }\n  }\n}\n```\n\n到这里，我们的登录请求动作就完成了，我们只需要在点击登录按钮时，获取到 store 并 dispatch login 方法即可：\n\n```js\n// 获取到 store 实例\nconst store = useStore()\n\n// user.value 是登录表单的 ref\n\nstore\n  .dispatch('user/login', user.value)\n  .then(res => {\n    console.log('login res', res)\n  })\n  .catch(err => {\n    console.log('err ', err)\n  })\n```\n\n# 写一个简单的 node 服务器\n```js\nconst express = require('express');\nconst app = express()\n\napp.get('/user', (req, res) => {\n  res.json({\n    code: 0,\n    msg: \"hello server 9999\"\n  })\n})\n\napp.listen(9999, () => {\n  console.log('server site an port 9999 ...')\n})\n```\n\n# 配置 devServer\n\n我们将 项目 和 node 服务跑起来之后，点击登录，发现报错了 404，是因为请求 `http://localhost:8080/#/api/user` 并不存在，接口请求地址资源找不到，我们的接口写在 node 端，那么 node 服务跑起来后，我们怎么去访问呢，这里就要用到 webpack 的 `devServer` 了。\n\n```js\n// vue.config.js\n\ndevServer: {\n  // 配置代理\n  proxy: {\n    // 当地址中有/api的时候会触发代理机制，因为我们配置了 axios baseURL，所以每个请求中，都会以 `/api` 开头\n    '/api': {\n      // 要代理的服务器地址  这里不用写 api\n      // node 服务\n      target: 'http://localhost:9999',\n      changeOrigin: true, // 是否跨域\n      pathRewrite: {\n        // 必须得带上,否则，真正的请求中就会带上 '/api'，'http://localhost:9999/api/user'\n        '^/api': ''\n      }\n    }\n  }\n},\n```\n\n最后，我们再重启项目，点击登录，就会拿到 `user` 接口返回的的结果了。\n\n![](/img/api-user.png)\n\n\n# 本地缓存处理方案\n\n存储 token 分为两种：\n\n- 本地缓存：localstorage\n- 全局状态管理：vuex\n\n保存在 `localstorage` 中，是为了在 token 没过期的情况下，让用户自动登录。保存在 vuex 中，是为了方便在其他位置使用。\n\n那么我们来定义 `localstorage` 的相关方法吧！\n\n```js\n// utils/storage.ts\n\n/**\n * 存储数据\n */\nexport const setItem = (key: string, value: unknown): void => {\n  // 将数组、对象类型的数据转化为 JSON 字符串进行存储\n  if (typeof value === 'object') {\n    value = JSON.stringify(value)\n  }\n  window.localStorage.setItem(key, value as string)\n}\n\n/**\n * 获取数据\n */\nexport const getItem = (key: string): unknown => {\n  const data = window.localStorage.getItem(key) as string\n  try {\n    return JSON.parse(data)\n  } catch (err) {\n    // 如果报错了，直接将数据发送给使用端\n    return data\n  }\n}\n\n/**\n * 删除数据\n */\nexport const removeItem = (key: string): void => {\n  window.localStorage.removeItem(key)\n}\n\n/**\n * 删除所有数据\n */\nexport const removeAllItem = (key: string): void => {\n  window.localStorage.clear()\n}\n```\n\n然后，我们来处理 vuex user 模块，在 state 中定义 `token`，以及设置 token 的 mutations 方法。\n\n```js\nimport { setItem, getItem } from '@/utils/storage'\n\n// 我们可以定义一个常量文件夹，用来设置 TOKEN 常量，或者各种其他常量值\nconst TOKEN = 'token'\n\n{\n  state: () => ({\n    token: getItem(TOKEN) || ''\n  }),\n  mutations: {\n    setToken(state: IState, token: string): void {\n      state.token = token\n\n      // 本地存储 token\n      setItem(TOKEN, token)\n    }\n  },\n}\n```\n\n在 actions login 方法中，请求成功后我们需要 commit 一个 mutation，来触发 setToken 方法:\n\n```js\ncontext.commit('setToken', res.data.data.token)\n```\n\n到这，我们的 token 存储就完成了，我们可以在页面上将其显示出来看看。\n\n```js\n<p>token: {{ $store.state.user.token || '暂无Token' }}</p>\n```\n\n# 接口响应数据统一处理\n\n我们在 `vuex user` 模块中通过 login 接口获取到了 `token`，当我们处理数据时，会发现需要通过好几个 `.` 的方式去拿到token，层级太深了，不太方便。\n\n那么我们可以通过 `axios` 的响应拦截器来处理这种情况。\n\n```js\nimport { ElMessage } from 'element-plus'\n\n// 响应拦截器\nservice.interceptors.response.use(\n  response => {\n    const { success, message, data } = response.data\n\n    if (success) {\n      return data\n    } else {\n      ElMessage.error(message)\n      return Promise.reject(new Error(message))\n    }\n  },\n  error => {\n    ElMessage.error(error.message) // 提示错误信息\n    return Promise.reject(error)\n  }\n)\n```\n\n修改好 axios 响应拦截器之后，我们就可以改写一下 `vuex user` 下的 `actions login` 方法了。\n\n```js\n.then(res => {\n  context.commit('setToken', res.token) // 这样获取 token 是不是就方便很多了\n  resolve(res)\n})\n```\n\n# 登录后操作\n\n我们可以创建一个 `src/layout` 文件夹，登录成功后，用来显示的主容器，将 `layout/index.vue` 配置在 router 路由表中\n\n```js\n{\n  path: '/',\n  component: () => import('@/layout/index.vue')\n}\n```\n\n登录成功后，跳转到 `layout` 页面\n\n```js\n// login/index.vue\n\nstore\n  .dispatch('user/login', user.value)\n  .then(() => {\n    router.replace('/')\n  })\n  .catch(err => {\n    console.log('err ', err)\n  })\n```\n\n# 登录鉴权\n\n到这里，我们点击登录，就可以跳转到 `layout` 页面了，但是我们如果在地址栏手动输入 `/login`，我们依然可以回到 `login` 页面，明明我们登录成功，有了 token 还会跳到 login 页面，这是为什么呢？\n\n因为我们到这里，还未做登录鉴权，即使存在token，我们并未做任何的权限控制和处理。\n\n那么我们要做什么处理呢？\n\n- 当用户未登录时，不允许进入除 `login` 之外的任何页面\n\n- 用户登录成功之后，token 未过期之前，不让用户进入 `login` 页面\n\n实现这个功能的核心就是使用 `vue-router` 的 **路由守卫**\n\n> 传送门：https://router.vuejs.org/zh/guide/advanced/navigation-guards.html\n\n那么我们创建 `permission.ts` 来处理路由守卫吧：\n\n因为我们的 token 定义在 `modules user` 中，每次获取 token，需要使用 `store.state.user.token`，这样显得太长了，我们可以定义 `store getters`，来方便获取 `token`：\n\n```js\n// getters.ts\nconst getters = {\n  token: (state: any) => state.user.token\n}\nexport default getters\n```\n\n然后将其放入 store 的 getters 中\n```js\nimport getters from './getters'\n\nexport default createStore({\n  state() {\n    return {\n      globalName: 'Hello_AlexCc'\n    }\n  },\n  getters,\n  modules: {\n    user\n  }\n})\n```\n\n然后创建 permissions.ts 文件，定义路由前置守卫。\n\n判断 token 是否存在，如果存在 token，并且 `to.path` 等于 `/login`，那么不让跳转到登录页，而是去 `layout` 页面。\n\n如果 `to.path` 不是 `/login`，直接执行 `next` 方法即可。\n\n如果 token 不存在，并且 `to.path` 是 `/login`，直接跳转 `next()`\n\n如果 token 不存在并且 `to.path` 不是 `/login`，我们让其跳转到登录页 `next('/login')`\n\n```js\n// permissions.ts\n\nimport router from './router'\nimport store from './store'\n\nrouter.beforeEach((to, from, next) => {\n  // 判断token是否存在\n  if (store.getters.token) {\n    if (to.path === '/login') {\n      next('/')\n    } else {\n      next()\n    }\n  } else {\n    if (to.path === '/login') {\n      next()\n    } else {\n      next('/login')\n    }\n  }\n})\n```\n\n到这里，我们点击登录，就会去到根路径下 '/'，也就是 `layout` 页面。这时我们在地址栏输入 `/login`，就不会再去登录页面了。\n\n我们还可以改进一下，当 `token` 不存在时，我们判断了 `to.path === '/login'`，这样限制死了，将来我们还有 `/404` 以及 `/401` 等页面，这些页面也是不需要 `token` 就能访问的，我们不希望在 `if` 语句里面加太多的判断逻辑，这时，我们可以定义一个 `白名单`，专门处理不需要 `token` 的路径:\n\n```js\nconst whiteList = ['/login']\n\nif (whiteList.indexOf(to.path) > -1) {\n  next()\n} else {\n  next('/login')\n}\n```\n","slug":"vue3-project-generalLogin","published":1,"updated":"2023-05-12T10:49:20.015Z","comments":1,"photos":[],"link":"","_id":"clhkizgxp00133y0qdq1n1mq4","content":"<h1 id=\"配置环境变量-封装-axios\"><a href=\"#配置环境变量-封装-axios\" class=\"headerlink\" title=\"配置环境变量 / 封装 axios\"></a>配置环境变量 / 封装 axios</h1><p>封装的 axios 模块，至少具备一种能力，<strong>根据当前环境的不同，设定不同的 baseUrl</strong></p>\n<p><code>@vue/cli</code> 模式</p>\n<blockquote>\n<p>官网：<a href=\"https://cli.vuejs.org/zh/guide/mode-and-env.html#%E7%8E%AF%E5%A2%83%E5%8F%98%E9%87%8F\">https://cli.vuejs.org/zh/guide/mode-and-env.html#%E7%8E%AF%E5%A2%83%E5%8F%98%E9%87%8F</a></p>\n</blockquote>\n<p>请注意，只有 NODE_ENV，BASE_URL 和以 VUE_APP_ 开头的变量将通过 webpack.DefinePlugin 静态地嵌入到客户端侧的代码中。这是为了避免意外公开机器上可能具有相同名称的私钥。</p>\n<p>除了 VUE_APP_* 变量之外，在你的应用代码中始终可用的还有两个特殊的变量：</p>\n<ul>\n<li>NODE_ENV - 会是 “development”、”production” 或 “test” 中的一个。具体的值取决于应用运行的模式。</li>\n<li>BASE_URL - 会和 vue.config.js 中的 publicPath 选项相符，即你的应用会部署到的基础路径。</li>\n</ul>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><div class=\"code-wrapper\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></div></td><td class=\"code\"><pre><code class=\"hljs js\"><span class=\"hljs-comment\">// .env.development</span><br><br>username=chenghaolun <span class=\"hljs-comment\">// 不会暴露出来</span><br><br><span class=\"hljs-variable constant_\">VUE_APP_BASE_API</span>=<span class=\"hljs-regexp\">/api /</span><span class=\"hljs-regexp\">/ 暴露出来，可以通过 process.env 获取</span><br></code></pre></td></tr></table></figure>\n\n<p>所有解析出来的环境变量都可以在 public/index.html 中以 HTML 插值中介绍的方式使用。</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\">&lt;title&gt;网站标题 &lt;%= <span class=\"hljs-variable constant_\">VUE_APP_BASE_API</span> %&gt;&lt;/title&gt;<br></code></pre></td></tr></table></figure>\n\n<p>我们可以打印 <code>process.env</code> 看看：</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\">&#123;<br>  <span class=\"hljs-attr\">BASE_URL</span>: <span class=\"hljs-string\">&quot;/&quot;</span>,<br>  <span class=\"hljs-attr\">NODE_ENV</span>: <span class=\"hljs-string\">&quot;development&quot;</span>,<br>  <span class=\"hljs-attr\">VUE_APP_BASE_API</span>: <span class=\"hljs-string\">&quot;/api&quot;</span>,<br>&#125;<br></code></pre></td></tr></table></figure>\n\n<h1 id=\"根据环境变量切换-baseUrl\"><a href=\"#根据环境变量切换-baseUrl\" class=\"headerlink\" title=\"根据环境变量切换 baseUrl\"></a>根据环境变量切换 baseUrl</h1><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\"><span class=\"hljs-keyword\">import</span> axios <span class=\"hljs-keyword\">from</span> <span class=\"hljs-string\">&#x27;axios&#x27;</span><br><br><span class=\"hljs-keyword\">const</span> service = axios.<span class=\"hljs-title function_\">create</span>(&#123;<br>  <span class=\"hljs-attr\">baseURL</span>: process.<span class=\"hljs-property\">env</span>.<span class=\"hljs-property\">VUE_APP_BASE_API</span>,<br>  <span class=\"hljs-attr\">timeout</span>: <span class=\"hljs-number\">5000</span><br>&#125;)<br><br><span class=\"hljs-keyword\">export</span> <span class=\"hljs-keyword\">default</span> service<br></code></pre></td></tr></table></figure>\n\n<h1 id=\"封装接口请求模块\"><a href=\"#封装接口请求模块\" class=\"headerlink\" title=\"封装接口请求模块\"></a>封装接口请求模块</h1><p>在 <code>src</code> 下创建 <code>api</code> 文件夹，并创建 <code>sys.ts</code> 文件，用于处理系统的一些接口请求：</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\"><span class=\"hljs-keyword\">import</span> request <span class=\"hljs-keyword\">from</span> <span class=\"hljs-string\">&#x27;@/utils/request&#x27;</span><br><br><span class=\"hljs-keyword\">export</span> <span class=\"hljs-keyword\">const</span> <span class=\"hljs-title function_\">login</span> = data =&gt; &#123;<br>  <span class=\"hljs-keyword\">return</span> <span class=\"hljs-title function_\">request</span>(&#123;<br>    <span class=\"hljs-attr\">url</span>: <span class=\"hljs-string\">&#x27;/sys/login&#x27;</span>,<br>    <span class=\"hljs-attr\">method</span>: <span class=\"hljs-string\">&#x27;POST&#x27;</span>,<br>    data<br>  &#125;)<br>&#125;<br></code></pre></td></tr></table></figure>\n\n<h1 id=\"封装登录请求动作\"><a href=\"#封装登录请求动作\" class=\"headerlink\" title=\"封装登录请求动作\"></a>封装登录请求动作</h1><p>我们不希望在点击登录按钮时，就立马调用登录接口，而是将其封装到 <code>vuex</code> 中，当然也可以使用 <code>pinia</code>。</p>\n<p>在 store 下创建 modules 文件夹，并创建 <code>user.ts</code> 模块，用于处理所有的 <code>用户相关</code> 的内容（token获取、用户信息获取、退出登录…）</p>\n<p><strong>注意</strong></p>\n<p>当我们创建好了 store 时，在 vue template 里面使用 <code>$store.state.globalName</code> 可能会爆红，原因是没有声明 <code>$store</code></p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\"><span class=\"hljs-comment\">// src/vuex.d.ts</span><br><span class=\"hljs-keyword\">import</span> &#123; <span class=\"hljs-title class_\">Store</span> &#125; <span class=\"hljs-keyword\">from</span> <span class=\"hljs-string\">&#x27;vuex&#x27;</span><br><br>declare <span class=\"hljs-variable language_\">module</span> <span class=\"hljs-string\">&#x27;@vue/runtime-core&#x27;</span> &#123;<br>  <span class=\"hljs-comment\">// 声明自己的 store state</span><br>  interface <span class=\"hljs-title class_\">State</span> &#123;<br>    <span class=\"hljs-attr\">globalName</span>: string<br>  &#125;<br><br>  <span class=\"hljs-comment\">// 为 `this.$store` 提供类型声明</span><br>  interface <span class=\"hljs-title class_\">ComponentCustomProperties</span> &#123;<br>    <span class=\"hljs-attr\">$store</span>: <span class=\"hljs-title class_\">Store</span>&lt;<span class=\"hljs-title class_\">State</span>&gt;<br>  &#125;<br>&#125;<br><br></code></pre></td></tr></table></figure>\n\n<p><strong>创建 user.ts</strong> 模块</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\"><span class=\"hljs-comment\">// store/index.js</span><br><br><span class=\"hljs-keyword\">import</span> &#123; createStore &#125; <span class=\"hljs-keyword\">from</span> <span class=\"hljs-string\">&#x27;vuex&#x27;</span><br><span class=\"hljs-keyword\">import</span> user <span class=\"hljs-keyword\">from</span> <span class=\"hljs-string\">&#x27;./modules/user&#x27;</span><br><br><span class=\"hljs-keyword\">export</span> <span class=\"hljs-keyword\">default</span> <span class=\"hljs-title function_\">createStore</span>(&#123;<br>  <span class=\"hljs-title function_\">state</span>(<span class=\"hljs-params\"></span>) &#123;<br>    <span class=\"hljs-keyword\">return</span> &#123;<br>      <span class=\"hljs-attr\">globalName</span>: <span class=\"hljs-string\">&#x27;Hello_AlexCc&#x27;</span><br>    &#125;<br>  &#125;,<br>  <span class=\"hljs-attr\">modules</span>: &#123;<br>    user<br>  &#125;<br>&#125;)<br></code></pre></td></tr></table></figure>\n\n<p><strong>创建 <code>modules</code> 文件夹</strong></p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\"><span class=\"hljs-keyword\">import</span> md5 <span class=\"hljs-keyword\">from</span> <span class=\"hljs-string\">&#x27;md5&#x27;</span><br><span class=\"hljs-keyword\">import</span> &#123; login &#125; <span class=\"hljs-keyword\">from</span> <span class=\"hljs-string\">&#x27;@/api/sys&#x27;</span><br><br><span class=\"hljs-keyword\">export</span> <span class=\"hljs-keyword\">default</span> &#123;<br>  <span class=\"hljs-attr\">namespaced</span>: <span class=\"hljs-literal\">true</span>,<br>  <span class=\"hljs-attr\">state</span>: <span class=\"hljs-function\">() =&gt;</span> (&#123;&#125;),<br>  <span class=\"hljs-attr\">mutations</span>: &#123;&#125;,<br>  <span class=\"hljs-attr\">actions</span>: &#123;<br>    <span class=\"hljs-title function_\">login</span>(<span class=\"hljs-params\">context: any, userInfo: any</span>) &#123;<br>      <span class=\"hljs-keyword\">const</span> &#123; username, password &#125; = userInfo<br>      <span class=\"hljs-keyword\">return</span> <span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">Promise</span>(<span class=\"hljs-function\">(<span class=\"hljs-params\">resolve, reject</span>) =&gt;</span> &#123;<br>        <span class=\"hljs-title function_\">login</span>(&#123;<br>          username,<br>          <span class=\"hljs-attr\">password</span>: <span class=\"hljs-title function_\">md5</span>(password)<br>        &#125;)<br>          .<span class=\"hljs-title function_\">then</span>(<span class=\"hljs-function\"><span class=\"hljs-params\">res</span> =&gt;</span> &#123;<br>            <span class=\"hljs-title function_\">resolve</span>(res)<br>          &#125;)<br>          .<span class=\"hljs-title function_\">catch</span>(<span class=\"hljs-function\"><span class=\"hljs-params\">err</span> =&gt;</span> &#123;<br>            <span class=\"hljs-title function_\">reject</span>(err)<br>          &#125;)<br>      &#125;)<br>    &#125;<br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure>\n\n<p>到这里，我们的登录请求动作就完成了，我们只需要在点击登录按钮时，获取到 store 并 dispatch login 方法即可：</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\"><span class=\"hljs-comment\">// 获取到 store 实例</span><br><span class=\"hljs-keyword\">const</span> store = <span class=\"hljs-title function_\">useStore</span>()<br><br><span class=\"hljs-comment\">// user.value 是登录表单的 ref</span><br><br>store<br>  .<span class=\"hljs-title function_\">dispatch</span>(<span class=\"hljs-string\">&#x27;user/login&#x27;</span>, user.<span class=\"hljs-property\">value</span>)<br>  .<span class=\"hljs-title function_\">then</span>(<span class=\"hljs-function\"><span class=\"hljs-params\">res</span> =&gt;</span> &#123;<br>    <span class=\"hljs-variable language_\">console</span>.<span class=\"hljs-title function_\">log</span>(<span class=\"hljs-string\">&#x27;login res&#x27;</span>, res)<br>  &#125;)<br>  .<span class=\"hljs-title function_\">catch</span>(<span class=\"hljs-function\"><span class=\"hljs-params\">err</span> =&gt;</span> &#123;<br>    <span class=\"hljs-variable language_\">console</span>.<span class=\"hljs-title function_\">log</span>(<span class=\"hljs-string\">&#x27;err &#x27;</span>, err)<br>  &#125;)<br></code></pre></td></tr></table></figure>\n\n<h1 id=\"写一个简单的-node-服务器\"><a href=\"#写一个简单的-node-服务器\" class=\"headerlink\" title=\"写一个简单的 node 服务器\"></a>写一个简单的 node 服务器</h1><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\"><span class=\"hljs-keyword\">const</span> express = <span class=\"hljs-built_in\">require</span>(<span class=\"hljs-string\">&#x27;express&#x27;</span>);<br><span class=\"hljs-keyword\">const</span> app = <span class=\"hljs-title function_\">express</span>()<br><br>app.<span class=\"hljs-title function_\">get</span>(<span class=\"hljs-string\">&#x27;/user&#x27;</span>, <span class=\"hljs-function\">(<span class=\"hljs-params\">req, res</span>) =&gt;</span> &#123;<br>  res.<span class=\"hljs-title function_\">json</span>(&#123;<br>    <span class=\"hljs-attr\">code</span>: <span class=\"hljs-number\">0</span>,<br>    <span class=\"hljs-attr\">msg</span>: <span class=\"hljs-string\">&quot;hello server 9999&quot;</span><br>  &#125;)<br>&#125;)<br><br>app.<span class=\"hljs-title function_\">listen</span>(<span class=\"hljs-number\">9999</span>, <span class=\"hljs-function\">() =&gt;</span> &#123;<br>  <span class=\"hljs-variable language_\">console</span>.<span class=\"hljs-title function_\">log</span>(<span class=\"hljs-string\">&#x27;server site an port 9999 ...&#x27;</span>)<br>&#125;)<br></code></pre></td></tr></table></figure>\n\n<h1 id=\"配置-devServer\"><a href=\"#配置-devServer\" class=\"headerlink\" title=\"配置 devServer\"></a>配置 devServer</h1><p>我们将 项目 和 node 服务跑起来之后，点击登录，发现报错了 404，是因为请求 <code>http://localhost:8080/#/api/user</code> 并不存在，接口请求地址资源找不到，我们的接口写在 node 端，那么 node 服务跑起来后，我们怎么去访问呢，这里就要用到 webpack 的 <code>devServer</code> 了。</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\"><span class=\"hljs-comment\">// vue.config.js</span><br><br><span class=\"hljs-attr\">devServer</span>: &#123;<br>  <span class=\"hljs-comment\">// 配置代理</span><br>  <span class=\"hljs-attr\">proxy</span>: &#123;<br>    <span class=\"hljs-comment\">// 当地址中有/api的时候会触发代理机制，因为我们配置了 axios baseURL，所以每个请求中，都会以 `/api` 开头</span><br>    <span class=\"hljs-string\">&#x27;/api&#x27;</span>: &#123;<br>      <span class=\"hljs-comment\">// 要代理的服务器地址  这里不用写 api</span><br>      <span class=\"hljs-comment\">// node 服务</span><br>      <span class=\"hljs-attr\">target</span>: <span class=\"hljs-string\">&#x27;http://localhost:9999&#x27;</span>,<br>      <span class=\"hljs-attr\">changeOrigin</span>: <span class=\"hljs-literal\">true</span>, <span class=\"hljs-comment\">// 是否跨域</span><br>      <span class=\"hljs-attr\">pathRewrite</span>: &#123;<br>        <span class=\"hljs-comment\">// 必须得带上,否则，真正的请求中就会带上 &#x27;/api&#x27;，&#x27;http://localhost:9999/api/user&#x27;</span><br>        <span class=\"hljs-string\">&#x27;^/api&#x27;</span>: <span class=\"hljs-string\">&#x27;&#x27;</span><br>      &#125;<br>    &#125;<br>  &#125;<br>&#125;,<br></code></pre></td></tr></table></figure>\n\n<p>最后，我们再重启项目，点击登录，就会拿到 <code>user</code> 接口返回的的结果了。</p>\n<p><img src=\"/img/api-user.png\" alt=\"\"></p>\n<h1 id=\"本地缓存处理方案\"><a href=\"#本地缓存处理方案\" class=\"headerlink\" title=\"本地缓存处理方案\"></a>本地缓存处理方案</h1><p>存储 token 分为两种：</p>\n<ul>\n<li>本地缓存：localstorage</li>\n<li>全局状态管理：vuex</li>\n</ul>\n<p>保存在 <code>localstorage</code> 中，是为了在 token 没过期的情况下，让用户自动登录。保存在 vuex 中，是为了方便在其他位置使用。</p>\n<p>那么我们来定义 <code>localstorage</code> 的相关方法吧！</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\"><span class=\"hljs-comment\">// utils/storage.ts</span><br><br><span class=\"hljs-comment\">/**</span><br><span class=\"hljs-comment\"> * 存储数据</span><br><span class=\"hljs-comment\"> */</span><br><span class=\"hljs-keyword\">export</span> <span class=\"hljs-keyword\">const</span> setItem = (<span class=\"hljs-attr\">key</span>: string, <span class=\"hljs-attr\">value</span>: unknown): <span class=\"hljs-function\"><span class=\"hljs-params\">void</span> =&gt;</span> &#123;<br>  <span class=\"hljs-comment\">// 将数组、对象类型的数据转化为 JSON 字符串进行存储</span><br>  <span class=\"hljs-keyword\">if</span> (<span class=\"hljs-keyword\">typeof</span> value === <span class=\"hljs-string\">&#x27;object&#x27;</span>) &#123;<br>    value = <span class=\"hljs-title class_\">JSON</span>.<span class=\"hljs-title function_\">stringify</span>(value)<br>  &#125;<br>  <span class=\"hljs-variable language_\">window</span>.<span class=\"hljs-property\">localStorage</span>.<span class=\"hljs-title function_\">setItem</span>(key, value <span class=\"hljs-keyword\">as</span> string)<br>&#125;<br><br><span class=\"hljs-comment\">/**</span><br><span class=\"hljs-comment\"> * 获取数据</span><br><span class=\"hljs-comment\"> */</span><br><span class=\"hljs-keyword\">export</span> <span class=\"hljs-keyword\">const</span> getItem = (<span class=\"hljs-attr\">key</span>: string): <span class=\"hljs-function\"><span class=\"hljs-params\">unknown</span> =&gt;</span> &#123;<br>  <span class=\"hljs-keyword\">const</span> data = <span class=\"hljs-variable language_\">window</span>.<span class=\"hljs-property\">localStorage</span>.<span class=\"hljs-title function_\">getItem</span>(key) <span class=\"hljs-keyword\">as</span> string<br>  <span class=\"hljs-keyword\">try</span> &#123;<br>    <span class=\"hljs-keyword\">return</span> <span class=\"hljs-title class_\">JSON</span>.<span class=\"hljs-title function_\">parse</span>(data)<br>  &#125; <span class=\"hljs-keyword\">catch</span> (err) &#123;<br>    <span class=\"hljs-comment\">// 如果报错了，直接将数据发送给使用端</span><br>    <span class=\"hljs-keyword\">return</span> data<br>  &#125;<br>&#125;<br><br><span class=\"hljs-comment\">/**</span><br><span class=\"hljs-comment\"> * 删除数据</span><br><span class=\"hljs-comment\"> */</span><br><span class=\"hljs-keyword\">export</span> <span class=\"hljs-keyword\">const</span> removeItem = (<span class=\"hljs-attr\">key</span>: string): <span class=\"hljs-function\"><span class=\"hljs-params\">void</span> =&gt;</span> &#123;<br>  <span class=\"hljs-variable language_\">window</span>.<span class=\"hljs-property\">localStorage</span>.<span class=\"hljs-title function_\">removeItem</span>(key)<br>&#125;<br><br><span class=\"hljs-comment\">/**</span><br><span class=\"hljs-comment\"> * 删除所有数据</span><br><span class=\"hljs-comment\"> */</span><br><span class=\"hljs-keyword\">export</span> <span class=\"hljs-keyword\">const</span> removeAllItem = (<span class=\"hljs-attr\">key</span>: string): <span class=\"hljs-function\"><span class=\"hljs-params\">void</span> =&gt;</span> &#123;<br>  <span class=\"hljs-variable language_\">window</span>.<span class=\"hljs-property\">localStorage</span>.<span class=\"hljs-title function_\">clear</span>()<br>&#125;<br></code></pre></td></tr></table></figure>\n\n<p>然后，我们来处理 vuex user 模块，在 state 中定义 <code>token</code>，以及设置 token 的 mutations 方法。</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\"><span class=\"hljs-keyword\">import</span> &#123; setItem, getItem &#125; <span class=\"hljs-keyword\">from</span> <span class=\"hljs-string\">&#x27;@/utils/storage&#x27;</span><br><br><span class=\"hljs-comment\">// 我们可以定义一个常量文件夹，用来设置 TOKEN 常量，或者各种其他常量值</span><br><span class=\"hljs-keyword\">const</span> <span class=\"hljs-variable constant_\">TOKEN</span> = <span class=\"hljs-string\">&#x27;token&#x27;</span><br><br>&#123;<br>  <span class=\"hljs-attr\">state</span>: <span class=\"hljs-function\">() =&gt;</span> (&#123;<br>    <span class=\"hljs-attr\">token</span>: <span class=\"hljs-title function_\">getItem</span>(<span class=\"hljs-variable constant_\">TOKEN</span>) || <span class=\"hljs-string\">&#x27;&#x27;</span><br>  &#125;),<br>  <span class=\"hljs-attr\">mutations</span>: &#123;<br>    <span class=\"hljs-title function_\">setToken</span>(<span class=\"hljs-attr\">state</span>: <span class=\"hljs-title class_\">IState</span>, <span class=\"hljs-attr\">token</span>: string): <span class=\"hljs-keyword\">void</span> &#123;<br>      state.<span class=\"hljs-property\">token</span> = token<br><br>      <span class=\"hljs-comment\">// 本地存储 token</span><br>      <span class=\"hljs-title function_\">setItem</span>(<span class=\"hljs-variable constant_\">TOKEN</span>, token)<br>    &#125;<br>  &#125;,<br>&#125;<br></code></pre></td></tr></table></figure>\n\n<p>在 actions login 方法中，请求成功后我们需要 commit 一个 mutation，来触发 setToken 方法:</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\">context.<span class=\"hljs-title function_\">commit</span>(<span class=\"hljs-string\">&#x27;setToken&#x27;</span>, res.<span class=\"hljs-property\">data</span>.<span class=\"hljs-property\">data</span>.<span class=\"hljs-property\">token</span>)<br></code></pre></td></tr></table></figure>\n\n<p>到这，我们的 token 存储就完成了，我们可以在页面上将其显示出来看看。</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\">&lt;p&gt;<span class=\"hljs-attr\">token</span>: &#123;&#123; $store.<span class=\"hljs-property\">state</span>.<span class=\"hljs-property\">user</span>.<span class=\"hljs-property\">token</span> || <span class=\"hljs-string\">&#x27;暂无Token&#x27;</span> &#125;&#125;&lt;/p&gt;<br></code></pre></td></tr></table></figure>\n\n<h1 id=\"接口响应数据统一处理\"><a href=\"#接口响应数据统一处理\" class=\"headerlink\" title=\"接口响应数据统一处理\"></a>接口响应数据统一处理</h1><p>我们在 <code>vuex user</code> 模块中通过 login 接口获取到了 <code>token</code>，当我们处理数据时，会发现需要通过好几个 <code>.</code> 的方式去拿到token，层级太深了，不太方便。</p>\n<p>那么我们可以通过 <code>axios</code> 的响应拦截器来处理这种情况。</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\"><span class=\"hljs-keyword\">import</span> &#123; <span class=\"hljs-title class_\">ElMessage</span> &#125; <span class=\"hljs-keyword\">from</span> <span class=\"hljs-string\">&#x27;element-plus&#x27;</span><br><br><span class=\"hljs-comment\">// 响应拦截器</span><br>service.<span class=\"hljs-property\">interceptors</span>.<span class=\"hljs-property\">response</span>.<span class=\"hljs-title function_\">use</span>(<br>  <span class=\"hljs-function\"><span class=\"hljs-params\">response</span> =&gt;</span> &#123;<br>    <span class=\"hljs-keyword\">const</span> &#123; success, message, data &#125; = response.<span class=\"hljs-property\">data</span><br><br>    <span class=\"hljs-keyword\">if</span> (success) &#123;<br>      <span class=\"hljs-keyword\">return</span> data<br>    &#125; <span class=\"hljs-keyword\">else</span> &#123;<br>      <span class=\"hljs-title class_\">ElMessage</span>.<span class=\"hljs-title function_\">error</span>(message)<br>      <span class=\"hljs-keyword\">return</span> <span class=\"hljs-title class_\">Promise</span>.<span class=\"hljs-title function_\">reject</span>(<span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">Error</span>(message))<br>    &#125;<br>  &#125;,<br>  <span class=\"hljs-function\"><span class=\"hljs-params\">error</span> =&gt;</span> &#123;<br>    <span class=\"hljs-title class_\">ElMessage</span>.<span class=\"hljs-title function_\">error</span>(error.<span class=\"hljs-property\">message</span>) <span class=\"hljs-comment\">// 提示错误信息</span><br>    <span class=\"hljs-keyword\">return</span> <span class=\"hljs-title class_\">Promise</span>.<span class=\"hljs-title function_\">reject</span>(error)<br>  &#125;<br>)<br></code></pre></td></tr></table></figure>\n\n<p>修改好 axios 响应拦截器之后，我们就可以改写一下 <code>vuex user</code> 下的 <code>actions login</code> 方法了。</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\">.<span class=\"hljs-title function_\">then</span>(<span class=\"hljs-function\"><span class=\"hljs-params\">res</span> =&gt;</span> &#123;<br>  context.<span class=\"hljs-title function_\">commit</span>(<span class=\"hljs-string\">&#x27;setToken&#x27;</span>, res.<span class=\"hljs-property\">token</span>) <span class=\"hljs-comment\">// 这样获取 token 是不是就方便很多了</span><br>  <span class=\"hljs-title function_\">resolve</span>(res)<br>&#125;)<br></code></pre></td></tr></table></figure>\n\n<h1 id=\"登录后操作\"><a href=\"#登录后操作\" class=\"headerlink\" title=\"登录后操作\"></a>登录后操作</h1><p>我们可以创建一个 <code>src/layout</code> 文件夹，登录成功后，用来显示的主容器，将 <code>layout/index.vue</code> 配置在 router 路由表中</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\">&#123;<br>  <span class=\"hljs-attr\">path</span>: <span class=\"hljs-string\">&#x27;/&#x27;</span>,<br>  <span class=\"hljs-attr\">component</span>: <span class=\"hljs-function\">() =&gt;</span> <span class=\"hljs-title function_\">import</span>(<span class=\"hljs-string\">&#x27;@/layout/index.vue&#x27;</span>)<br>&#125;<br></code></pre></td></tr></table></figure>\n\n<p>登录成功后，跳转到 <code>layout</code> 页面</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\"><span class=\"hljs-comment\">// login/index.vue</span><br><br>store<br>  .<span class=\"hljs-title function_\">dispatch</span>(<span class=\"hljs-string\">&#x27;user/login&#x27;</span>, user.<span class=\"hljs-property\">value</span>)<br>  .<span class=\"hljs-title function_\">then</span>(<span class=\"hljs-function\">() =&gt;</span> &#123;<br>    router.<span class=\"hljs-title function_\">replace</span>(<span class=\"hljs-string\">&#x27;/&#x27;</span>)<br>  &#125;)<br>  .<span class=\"hljs-title function_\">catch</span>(<span class=\"hljs-function\"><span class=\"hljs-params\">err</span> =&gt;</span> &#123;<br>    <span class=\"hljs-variable language_\">console</span>.<span class=\"hljs-title function_\">log</span>(<span class=\"hljs-string\">&#x27;err &#x27;</span>, err)<br>  &#125;)<br></code></pre></td></tr></table></figure>\n\n<h1 id=\"登录鉴权\"><a href=\"#登录鉴权\" class=\"headerlink\" title=\"登录鉴权\"></a>登录鉴权</h1><p>到这里，我们点击登录，就可以跳转到 <code>layout</code> 页面了，但是我们如果在地址栏手动输入 <code>/login</code>，我们依然可以回到 <code>login</code> 页面，明明我们登录成功，有了 token 还会跳到 login 页面，这是为什么呢？</p>\n<p>因为我们到这里，还未做登录鉴权，即使存在token，我们并未做任何的权限控制和处理。</p>\n<p>那么我们要做什么处理呢？</p>\n<ul>\n<li><p>当用户未登录时，不允许进入除 <code>login</code> 之外的任何页面</p>\n</li>\n<li><p>用户登录成功之后，token 未过期之前，不让用户进入 <code>login</code> 页面</p>\n</li>\n</ul>\n<p>实现这个功能的核心就是使用 <code>vue-router</code> 的 <strong>路由守卫</strong></p>\n<blockquote>\n<p>传送门：<a href=\"https://router.vuejs.org/zh/guide/advanced/navigation-guards.html\">https://router.vuejs.org/zh/guide/advanced/navigation-guards.html</a></p>\n</blockquote>\n<p>那么我们创建 <code>permission.ts</code> 来处理路由守卫吧：</p>\n<p>因为我们的 token 定义在 <code>modules user</code> 中，每次获取 token，需要使用 <code>store.state.user.token</code>，这样显得太长了，我们可以定义 <code>store getters</code>，来方便获取 <code>token</code>：</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\"><span class=\"hljs-comment\">// getters.ts</span><br><span class=\"hljs-keyword\">const</span> getters = &#123;<br>  <span class=\"hljs-attr\">token</span>: <span class=\"hljs-function\">(<span class=\"hljs-params\">state: any</span>) =&gt;</span> state.<span class=\"hljs-property\">user</span>.<span class=\"hljs-property\">token</span><br>&#125;<br><span class=\"hljs-keyword\">export</span> <span class=\"hljs-keyword\">default</span> getters<br></code></pre></td></tr></table></figure>\n\n<p>然后将其放入 store 的 getters 中</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\"><span class=\"hljs-keyword\">import</span> getters <span class=\"hljs-keyword\">from</span> <span class=\"hljs-string\">&#x27;./getters&#x27;</span><br><br><span class=\"hljs-keyword\">export</span> <span class=\"hljs-keyword\">default</span> <span class=\"hljs-title function_\">createStore</span>(&#123;<br>  <span class=\"hljs-title function_\">state</span>(<span class=\"hljs-params\"></span>) &#123;<br>    <span class=\"hljs-keyword\">return</span> &#123;<br>      <span class=\"hljs-attr\">globalName</span>: <span class=\"hljs-string\">&#x27;Hello_AlexCc&#x27;</span><br>    &#125;<br>  &#125;,<br>  getters,<br>  <span class=\"hljs-attr\">modules</span>: &#123;<br>    user<br>  &#125;<br>&#125;)<br></code></pre></td></tr></table></figure>\n\n<p>然后创建 permissions.ts 文件，定义路由前置守卫。</p>\n<p>判断 token 是否存在，如果存在 token，并且 <code>to.path</code> 等于 <code>/login</code>，那么不让跳转到登录页，而是去 <code>layout</code> 页面。</p>\n<p>如果 <code>to.path</code> 不是 <code>/login</code>，直接执行 <code>next</code> 方法即可。</p>\n<p>如果 token 不存在，并且 <code>to.path</code> 是 <code>/login</code>，直接跳转 <code>next()</code></p>\n<p>如果 token 不存在并且 <code>to.path</code> 不是 <code>/login</code>，我们让其跳转到登录页 <code>next(&#39;/login&#39;)</code></p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\"><span class=\"hljs-comment\">// permissions.ts</span><br><br><span class=\"hljs-keyword\">import</span> router <span class=\"hljs-keyword\">from</span> <span class=\"hljs-string\">&#x27;./router&#x27;</span><br><span class=\"hljs-keyword\">import</span> store <span class=\"hljs-keyword\">from</span> <span class=\"hljs-string\">&#x27;./store&#x27;</span><br><br>router.<span class=\"hljs-title function_\">beforeEach</span>(<span class=\"hljs-function\">(<span class=\"hljs-params\">to, <span class=\"hljs-keyword\">from</span>, next</span>) =&gt;</span> &#123;<br>  <span class=\"hljs-comment\">// 判断token是否存在</span><br>  <span class=\"hljs-keyword\">if</span> (store.<span class=\"hljs-property\">getters</span>.<span class=\"hljs-property\">token</span>) &#123;<br>    <span class=\"hljs-keyword\">if</span> (to.<span class=\"hljs-property\">path</span> === <span class=\"hljs-string\">&#x27;/login&#x27;</span>) &#123;<br>      <span class=\"hljs-title function_\">next</span>(<span class=\"hljs-string\">&#x27;/&#x27;</span>)<br>    &#125; <span class=\"hljs-keyword\">else</span> &#123;<br>      <span class=\"hljs-title function_\">next</span>()<br>    &#125;<br>  &#125; <span class=\"hljs-keyword\">else</span> &#123;<br>    <span class=\"hljs-keyword\">if</span> (to.<span class=\"hljs-property\">path</span> === <span class=\"hljs-string\">&#x27;/login&#x27;</span>) &#123;<br>      <span class=\"hljs-title function_\">next</span>()<br>    &#125; <span class=\"hljs-keyword\">else</span> &#123;<br>      <span class=\"hljs-title function_\">next</span>(<span class=\"hljs-string\">&#x27;/login&#x27;</span>)<br>    &#125;<br>  &#125;<br>&#125;)<br></code></pre></td></tr></table></figure>\n\n<p>到这里，我们点击登录，就会去到根路径下 ‘/‘，也就是 <code>layout</code> 页面。这时我们在地址栏输入 <code>/login</code>，就不会再去登录页面了。</p>\n<p>我们还可以改进一下，当 <code>token</code> 不存在时，我们判断了 <code>to.path === &#39;/login&#39;</code>，这样限制死了，将来我们还有 <code>/404</code> 以及 <code>/401</code> 等页面，这些页面也是不需要 <code>token</code> 就能访问的，我们不希望在 <code>if</code> 语句里面加太多的判断逻辑，这时，我们可以定义一个 <code>白名单</code>，专门处理不需要 <code>token</code> 的路径:</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\"><span class=\"hljs-keyword\">const</span> whiteList = [<span class=\"hljs-string\">&#x27;/login&#x27;</span>]<br><br><span class=\"hljs-keyword\">if</span> (whiteList.<span class=\"hljs-title function_\">indexOf</span>(to.<span class=\"hljs-property\">path</span>) &gt; -<span class=\"hljs-number\">1</span>) &#123;<br>  <span class=\"hljs-title function_\">next</span>()<br>&#125; <span class=\"hljs-keyword\">else</span> &#123;<br>  <span class=\"hljs-title function_\">next</span>(<span class=\"hljs-string\">&#x27;/login&#x27;</span>)<br>&#125;<br></code></pre></td></tr></table></figure>\n","site":{"data":{}},"wordcount":7872,"more":"<h1 id=\"配置环境变量-封装-axios\"><a href=\"#配置环境变量-封装-axios\" class=\"headerlink\" title=\"配置环境变量 / 封装 axios\"></a>配置环境变量 / 封装 axios</h1><p>封装的 axios 模块，至少具备一种能力，<strong>根据当前环境的不同，设定不同的 baseUrl</strong></p>\n<p><code>@vue/cli</code> 模式</p>\n<blockquote>\n<p>官网：<a href=\"https://cli.vuejs.org/zh/guide/mode-and-env.html#%E7%8E%AF%E5%A2%83%E5%8F%98%E9%87%8F\">https://cli.vuejs.org/zh/guide/mode-and-env.html#%E7%8E%AF%E5%A2%83%E5%8F%98%E9%87%8F</a></p>\n</blockquote>\n<p>请注意，只有 NODE_ENV，BASE_URL 和以 VUE_APP_ 开头的变量将通过 webpack.DefinePlugin 静态地嵌入到客户端侧的代码中。这是为了避免意外公开机器上可能具有相同名称的私钥。</p>\n<p>除了 VUE_APP_* 变量之外，在你的应用代码中始终可用的还有两个特殊的变量：</p>\n<ul>\n<li>NODE_ENV - 会是 “development”、”production” 或 “test” 中的一个。具体的值取决于应用运行的模式。</li>\n<li>BASE_URL - 会和 vue.config.js 中的 publicPath 选项相符，即你的应用会部署到的基础路径。</li>\n</ul>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\"><span class=\"hljs-comment\">// .env.development</span><br><br>username=chenghaolun <span class=\"hljs-comment\">// 不会暴露出来</span><br><br><span class=\"hljs-variable constant_\">VUE_APP_BASE_API</span>=<span class=\"hljs-regexp\">/api /</span><span class=\"hljs-regexp\">/ 暴露出来，可以通过 process.env 获取</span><br></code></pre></td></tr></table></figure>\n\n<p>所有解析出来的环境变量都可以在 public/index.html 中以 HTML 插值中介绍的方式使用。</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\">&lt;title&gt;网站标题 &lt;%= <span class=\"hljs-variable constant_\">VUE_APP_BASE_API</span> %&gt;&lt;/title&gt;<br></code></pre></td></tr></table></figure>\n\n<p>我们可以打印 <code>process.env</code> 看看：</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\">&#123;<br>  <span class=\"hljs-attr\">BASE_URL</span>: <span class=\"hljs-string\">&quot;/&quot;</span>,<br>  <span class=\"hljs-attr\">NODE_ENV</span>: <span class=\"hljs-string\">&quot;development&quot;</span>,<br>  <span class=\"hljs-attr\">VUE_APP_BASE_API</span>: <span class=\"hljs-string\">&quot;/api&quot;</span>,<br>&#125;<br></code></pre></td></tr></table></figure>\n\n<h1 id=\"根据环境变量切换-baseUrl\"><a href=\"#根据环境变量切换-baseUrl\" class=\"headerlink\" title=\"根据环境变量切换 baseUrl\"></a>根据环境变量切换 baseUrl</h1><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\"><span class=\"hljs-keyword\">import</span> axios <span class=\"hljs-keyword\">from</span> <span class=\"hljs-string\">&#x27;axios&#x27;</span><br><br><span class=\"hljs-keyword\">const</span> service = axios.<span class=\"hljs-title function_\">create</span>(&#123;<br>  <span class=\"hljs-attr\">baseURL</span>: process.<span class=\"hljs-property\">env</span>.<span class=\"hljs-property\">VUE_APP_BASE_API</span>,<br>  <span class=\"hljs-attr\">timeout</span>: <span class=\"hljs-number\">5000</span><br>&#125;)<br><br><span class=\"hljs-keyword\">export</span> <span class=\"hljs-keyword\">default</span> service<br></code></pre></td></tr></table></figure>\n\n<h1 id=\"封装接口请求模块\"><a href=\"#封装接口请求模块\" class=\"headerlink\" title=\"封装接口请求模块\"></a>封装接口请求模块</h1><p>在 <code>src</code> 下创建 <code>api</code> 文件夹，并创建 <code>sys.ts</code> 文件，用于处理系统的一些接口请求：</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\"><span class=\"hljs-keyword\">import</span> request <span class=\"hljs-keyword\">from</span> <span class=\"hljs-string\">&#x27;@/utils/request&#x27;</span><br><br><span class=\"hljs-keyword\">export</span> <span class=\"hljs-keyword\">const</span> <span class=\"hljs-title function_\">login</span> = data =&gt; &#123;<br>  <span class=\"hljs-keyword\">return</span> <span class=\"hljs-title function_\">request</span>(&#123;<br>    <span class=\"hljs-attr\">url</span>: <span class=\"hljs-string\">&#x27;/sys/login&#x27;</span>,<br>    <span class=\"hljs-attr\">method</span>: <span class=\"hljs-string\">&#x27;POST&#x27;</span>,<br>    data<br>  &#125;)<br>&#125;<br></code></pre></td></tr></table></figure>\n\n<h1 id=\"封装登录请求动作\"><a href=\"#封装登录请求动作\" class=\"headerlink\" title=\"封装登录请求动作\"></a>封装登录请求动作</h1><p>我们不希望在点击登录按钮时，就立马调用登录接口，而是将其封装到 <code>vuex</code> 中，当然也可以使用 <code>pinia</code>。</p>\n<p>在 store 下创建 modules 文件夹，并创建 <code>user.ts</code> 模块，用于处理所有的 <code>用户相关</code> 的内容（token获取、用户信息获取、退出登录…）</p>\n<p><strong>注意</strong></p>\n<p>当我们创建好了 store 时，在 vue template 里面使用 <code>$store.state.globalName</code> 可能会爆红，原因是没有声明 <code>$store</code></p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\"><span class=\"hljs-comment\">// src/vuex.d.ts</span><br><span class=\"hljs-keyword\">import</span> &#123; <span class=\"hljs-title class_\">Store</span> &#125; <span class=\"hljs-keyword\">from</span> <span class=\"hljs-string\">&#x27;vuex&#x27;</span><br><br>declare <span class=\"hljs-variable language_\">module</span> <span class=\"hljs-string\">&#x27;@vue/runtime-core&#x27;</span> &#123;<br>  <span class=\"hljs-comment\">// 声明自己的 store state</span><br>  interface <span class=\"hljs-title class_\">State</span> &#123;<br>    <span class=\"hljs-attr\">globalName</span>: string<br>  &#125;<br><br>  <span class=\"hljs-comment\">// 为 `this.$store` 提供类型声明</span><br>  interface <span class=\"hljs-title class_\">ComponentCustomProperties</span> &#123;<br>    <span class=\"hljs-attr\">$store</span>: <span class=\"hljs-title class_\">Store</span>&lt;<span class=\"hljs-title class_\">State</span>&gt;<br>  &#125;<br>&#125;<br><br></code></pre></td></tr></table></figure>\n\n<p><strong>创建 user.ts</strong> 模块</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\"><span class=\"hljs-comment\">// store/index.js</span><br><br><span class=\"hljs-keyword\">import</span> &#123; createStore &#125; <span class=\"hljs-keyword\">from</span> <span class=\"hljs-string\">&#x27;vuex&#x27;</span><br><span class=\"hljs-keyword\">import</span> user <span class=\"hljs-keyword\">from</span> <span class=\"hljs-string\">&#x27;./modules/user&#x27;</span><br><br><span class=\"hljs-keyword\">export</span> <span class=\"hljs-keyword\">default</span> <span class=\"hljs-title function_\">createStore</span>(&#123;<br>  <span class=\"hljs-title function_\">state</span>(<span class=\"hljs-params\"></span>) &#123;<br>    <span class=\"hljs-keyword\">return</span> &#123;<br>      <span class=\"hljs-attr\">globalName</span>: <span class=\"hljs-string\">&#x27;Hello_AlexCc&#x27;</span><br>    &#125;<br>  &#125;,<br>  <span class=\"hljs-attr\">modules</span>: &#123;<br>    user<br>  &#125;<br>&#125;)<br></code></pre></td></tr></table></figure>\n\n<p><strong>创建 <code>modules</code> 文件夹</strong></p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\"><span class=\"hljs-keyword\">import</span> md5 <span class=\"hljs-keyword\">from</span> <span class=\"hljs-string\">&#x27;md5&#x27;</span><br><span class=\"hljs-keyword\">import</span> &#123; login &#125; <span class=\"hljs-keyword\">from</span> <span class=\"hljs-string\">&#x27;@/api/sys&#x27;</span><br><br><span class=\"hljs-keyword\">export</span> <span class=\"hljs-keyword\">default</span> &#123;<br>  <span class=\"hljs-attr\">namespaced</span>: <span class=\"hljs-literal\">true</span>,<br>  <span class=\"hljs-attr\">state</span>: <span class=\"hljs-function\">() =&gt;</span> (&#123;&#125;),<br>  <span class=\"hljs-attr\">mutations</span>: &#123;&#125;,<br>  <span class=\"hljs-attr\">actions</span>: &#123;<br>    <span class=\"hljs-title function_\">login</span>(<span class=\"hljs-params\">context: any, userInfo: any</span>) &#123;<br>      <span class=\"hljs-keyword\">const</span> &#123; username, password &#125; = userInfo<br>      <span class=\"hljs-keyword\">return</span> <span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">Promise</span>(<span class=\"hljs-function\">(<span class=\"hljs-params\">resolve, reject</span>) =&gt;</span> &#123;<br>        <span class=\"hljs-title function_\">login</span>(&#123;<br>          username,<br>          <span class=\"hljs-attr\">password</span>: <span class=\"hljs-title function_\">md5</span>(password)<br>        &#125;)<br>          .<span class=\"hljs-title function_\">then</span>(<span class=\"hljs-function\"><span class=\"hljs-params\">res</span> =&gt;</span> &#123;<br>            <span class=\"hljs-title function_\">resolve</span>(res)<br>          &#125;)<br>          .<span class=\"hljs-title function_\">catch</span>(<span class=\"hljs-function\"><span class=\"hljs-params\">err</span> =&gt;</span> &#123;<br>            <span class=\"hljs-title function_\">reject</span>(err)<br>          &#125;)<br>      &#125;)<br>    &#125;<br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure>\n\n<p>到这里，我们的登录请求动作就完成了，我们只需要在点击登录按钮时，获取到 store 并 dispatch login 方法即可：</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\"><span class=\"hljs-comment\">// 获取到 store 实例</span><br><span class=\"hljs-keyword\">const</span> store = <span class=\"hljs-title function_\">useStore</span>()<br><br><span class=\"hljs-comment\">// user.value 是登录表单的 ref</span><br><br>store<br>  .<span class=\"hljs-title function_\">dispatch</span>(<span class=\"hljs-string\">&#x27;user/login&#x27;</span>, user.<span class=\"hljs-property\">value</span>)<br>  .<span class=\"hljs-title function_\">then</span>(<span class=\"hljs-function\"><span class=\"hljs-params\">res</span> =&gt;</span> &#123;<br>    <span class=\"hljs-variable language_\">console</span>.<span class=\"hljs-title function_\">log</span>(<span class=\"hljs-string\">&#x27;login res&#x27;</span>, res)<br>  &#125;)<br>  .<span class=\"hljs-title function_\">catch</span>(<span class=\"hljs-function\"><span class=\"hljs-params\">err</span> =&gt;</span> &#123;<br>    <span class=\"hljs-variable language_\">console</span>.<span class=\"hljs-title function_\">log</span>(<span class=\"hljs-string\">&#x27;err &#x27;</span>, err)<br>  &#125;)<br></code></pre></td></tr></table></figure>\n\n<h1 id=\"写一个简单的-node-服务器\"><a href=\"#写一个简单的-node-服务器\" class=\"headerlink\" title=\"写一个简单的 node 服务器\"></a>写一个简单的 node 服务器</h1><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\"><span class=\"hljs-keyword\">const</span> express = <span class=\"hljs-built_in\">require</span>(<span class=\"hljs-string\">&#x27;express&#x27;</span>);<br><span class=\"hljs-keyword\">const</span> app = <span class=\"hljs-title function_\">express</span>()<br><br>app.<span class=\"hljs-title function_\">get</span>(<span class=\"hljs-string\">&#x27;/user&#x27;</span>, <span class=\"hljs-function\">(<span class=\"hljs-params\">req, res</span>) =&gt;</span> &#123;<br>  res.<span class=\"hljs-title function_\">json</span>(&#123;<br>    <span class=\"hljs-attr\">code</span>: <span class=\"hljs-number\">0</span>,<br>    <span class=\"hljs-attr\">msg</span>: <span class=\"hljs-string\">&quot;hello server 9999&quot;</span><br>  &#125;)<br>&#125;)<br><br>app.<span class=\"hljs-title function_\">listen</span>(<span class=\"hljs-number\">9999</span>, <span class=\"hljs-function\">() =&gt;</span> &#123;<br>  <span class=\"hljs-variable language_\">console</span>.<span class=\"hljs-title function_\">log</span>(<span class=\"hljs-string\">&#x27;server site an port 9999 ...&#x27;</span>)<br>&#125;)<br></code></pre></td></tr></table></figure>\n\n<h1 id=\"配置-devServer\"><a href=\"#配置-devServer\" class=\"headerlink\" title=\"配置 devServer\"></a>配置 devServer</h1><p>我们将 项目 和 node 服务跑起来之后，点击登录，发现报错了 404，是因为请求 <code>http://localhost:8080/#/api/user</code> 并不存在，接口请求地址资源找不到，我们的接口写在 node 端，那么 node 服务跑起来后，我们怎么去访问呢，这里就要用到 webpack 的 <code>devServer</code> 了。</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\"><span class=\"hljs-comment\">// vue.config.js</span><br><br><span class=\"hljs-attr\">devServer</span>: &#123;<br>  <span class=\"hljs-comment\">// 配置代理</span><br>  <span class=\"hljs-attr\">proxy</span>: &#123;<br>    <span class=\"hljs-comment\">// 当地址中有/api的时候会触发代理机制，因为我们配置了 axios baseURL，所以每个请求中，都会以 `/api` 开头</span><br>    <span class=\"hljs-string\">&#x27;/api&#x27;</span>: &#123;<br>      <span class=\"hljs-comment\">// 要代理的服务器地址  这里不用写 api</span><br>      <span class=\"hljs-comment\">// node 服务</span><br>      <span class=\"hljs-attr\">target</span>: <span class=\"hljs-string\">&#x27;http://localhost:9999&#x27;</span>,<br>      <span class=\"hljs-attr\">changeOrigin</span>: <span class=\"hljs-literal\">true</span>, <span class=\"hljs-comment\">// 是否跨域</span><br>      <span class=\"hljs-attr\">pathRewrite</span>: &#123;<br>        <span class=\"hljs-comment\">// 必须得带上,否则，真正的请求中就会带上 &#x27;/api&#x27;，&#x27;http://localhost:9999/api/user&#x27;</span><br>        <span class=\"hljs-string\">&#x27;^/api&#x27;</span>: <span class=\"hljs-string\">&#x27;&#x27;</span><br>      &#125;<br>    &#125;<br>  &#125;<br>&#125;,<br></code></pre></td></tr></table></figure>\n\n<p>最后，我们再重启项目，点击登录，就会拿到 <code>user</code> 接口返回的的结果了。</p>\n<p><img src=\"/img/api-user.png\" alt=\"\"></p>\n<h1 id=\"本地缓存处理方案\"><a href=\"#本地缓存处理方案\" class=\"headerlink\" title=\"本地缓存处理方案\"></a>本地缓存处理方案</h1><p>存储 token 分为两种：</p>\n<ul>\n<li>本地缓存：localstorage</li>\n<li>全局状态管理：vuex</li>\n</ul>\n<p>保存在 <code>localstorage</code> 中，是为了在 token 没过期的情况下，让用户自动登录。保存在 vuex 中，是为了方便在其他位置使用。</p>\n<p>那么我们来定义 <code>localstorage</code> 的相关方法吧！</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\"><span class=\"hljs-comment\">// utils/storage.ts</span><br><br><span class=\"hljs-comment\">/**</span><br><span class=\"hljs-comment\"> * 存储数据</span><br><span class=\"hljs-comment\"> */</span><br><span class=\"hljs-keyword\">export</span> <span class=\"hljs-keyword\">const</span> setItem = (<span class=\"hljs-attr\">key</span>: string, <span class=\"hljs-attr\">value</span>: unknown): <span class=\"hljs-function\"><span class=\"hljs-params\">void</span> =&gt;</span> &#123;<br>  <span class=\"hljs-comment\">// 将数组、对象类型的数据转化为 JSON 字符串进行存储</span><br>  <span class=\"hljs-keyword\">if</span> (<span class=\"hljs-keyword\">typeof</span> value === <span class=\"hljs-string\">&#x27;object&#x27;</span>) &#123;<br>    value = <span class=\"hljs-title class_\">JSON</span>.<span class=\"hljs-title function_\">stringify</span>(value)<br>  &#125;<br>  <span class=\"hljs-variable language_\">window</span>.<span class=\"hljs-property\">localStorage</span>.<span class=\"hljs-title function_\">setItem</span>(key, value <span class=\"hljs-keyword\">as</span> string)<br>&#125;<br><br><span class=\"hljs-comment\">/**</span><br><span class=\"hljs-comment\"> * 获取数据</span><br><span class=\"hljs-comment\"> */</span><br><span class=\"hljs-keyword\">export</span> <span class=\"hljs-keyword\">const</span> getItem = (<span class=\"hljs-attr\">key</span>: string): <span class=\"hljs-function\"><span class=\"hljs-params\">unknown</span> =&gt;</span> &#123;<br>  <span class=\"hljs-keyword\">const</span> data = <span class=\"hljs-variable language_\">window</span>.<span class=\"hljs-property\">localStorage</span>.<span class=\"hljs-title function_\">getItem</span>(key) <span class=\"hljs-keyword\">as</span> string<br>  <span class=\"hljs-keyword\">try</span> &#123;<br>    <span class=\"hljs-keyword\">return</span> <span class=\"hljs-title class_\">JSON</span>.<span class=\"hljs-title function_\">parse</span>(data)<br>  &#125; <span class=\"hljs-keyword\">catch</span> (err) &#123;<br>    <span class=\"hljs-comment\">// 如果报错了，直接将数据发送给使用端</span><br>    <span class=\"hljs-keyword\">return</span> data<br>  &#125;<br>&#125;<br><br><span class=\"hljs-comment\">/**</span><br><span class=\"hljs-comment\"> * 删除数据</span><br><span class=\"hljs-comment\"> */</span><br><span class=\"hljs-keyword\">export</span> <span class=\"hljs-keyword\">const</span> removeItem = (<span class=\"hljs-attr\">key</span>: string): <span class=\"hljs-function\"><span class=\"hljs-params\">void</span> =&gt;</span> &#123;<br>  <span class=\"hljs-variable language_\">window</span>.<span class=\"hljs-property\">localStorage</span>.<span class=\"hljs-title function_\">removeItem</span>(key)<br>&#125;<br><br><span class=\"hljs-comment\">/**</span><br><span class=\"hljs-comment\"> * 删除所有数据</span><br><span class=\"hljs-comment\"> */</span><br><span class=\"hljs-keyword\">export</span> <span class=\"hljs-keyword\">const</span> removeAllItem = (<span class=\"hljs-attr\">key</span>: string): <span class=\"hljs-function\"><span class=\"hljs-params\">void</span> =&gt;</span> &#123;<br>  <span class=\"hljs-variable language_\">window</span>.<span class=\"hljs-property\">localStorage</span>.<span class=\"hljs-title function_\">clear</span>()<br>&#125;<br></code></pre></td></tr></table></figure>\n\n<p>然后，我们来处理 vuex user 模块，在 state 中定义 <code>token</code>，以及设置 token 的 mutations 方法。</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\"><span class=\"hljs-keyword\">import</span> &#123; setItem, getItem &#125; <span class=\"hljs-keyword\">from</span> <span class=\"hljs-string\">&#x27;@/utils/storage&#x27;</span><br><br><span class=\"hljs-comment\">// 我们可以定义一个常量文件夹，用来设置 TOKEN 常量，或者各种其他常量值</span><br><span class=\"hljs-keyword\">const</span> <span class=\"hljs-variable constant_\">TOKEN</span> = <span class=\"hljs-string\">&#x27;token&#x27;</span><br><br>&#123;<br>  <span class=\"hljs-attr\">state</span>: <span class=\"hljs-function\">() =&gt;</span> (&#123;<br>    <span class=\"hljs-attr\">token</span>: <span class=\"hljs-title function_\">getItem</span>(<span class=\"hljs-variable constant_\">TOKEN</span>) || <span class=\"hljs-string\">&#x27;&#x27;</span><br>  &#125;),<br>  <span class=\"hljs-attr\">mutations</span>: &#123;<br>    <span class=\"hljs-title function_\">setToken</span>(<span class=\"hljs-attr\">state</span>: <span class=\"hljs-title class_\">IState</span>, <span class=\"hljs-attr\">token</span>: string): <span class=\"hljs-keyword\">void</span> &#123;<br>      state.<span class=\"hljs-property\">token</span> = token<br><br>      <span class=\"hljs-comment\">// 本地存储 token</span><br>      <span class=\"hljs-title function_\">setItem</span>(<span class=\"hljs-variable constant_\">TOKEN</span>, token)<br>    &#125;<br>  &#125;,<br>&#125;<br></code></pre></td></tr></table></figure>\n\n<p>在 actions login 方法中，请求成功后我们需要 commit 一个 mutation，来触发 setToken 方法:</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\">context.<span class=\"hljs-title function_\">commit</span>(<span class=\"hljs-string\">&#x27;setToken&#x27;</span>, res.<span class=\"hljs-property\">data</span>.<span class=\"hljs-property\">data</span>.<span class=\"hljs-property\">token</span>)<br></code></pre></td></tr></table></figure>\n\n<p>到这，我们的 token 存储就完成了，我们可以在页面上将其显示出来看看。</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\">&lt;p&gt;<span class=\"hljs-attr\">token</span>: &#123;&#123; $store.<span class=\"hljs-property\">state</span>.<span class=\"hljs-property\">user</span>.<span class=\"hljs-property\">token</span> || <span class=\"hljs-string\">&#x27;暂无Token&#x27;</span> &#125;&#125;&lt;/p&gt;<br></code></pre></td></tr></table></figure>\n\n<h1 id=\"接口响应数据统一处理\"><a href=\"#接口响应数据统一处理\" class=\"headerlink\" title=\"接口响应数据统一处理\"></a>接口响应数据统一处理</h1><p>我们在 <code>vuex user</code> 模块中通过 login 接口获取到了 <code>token</code>，当我们处理数据时，会发现需要通过好几个 <code>.</code> 的方式去拿到token，层级太深了，不太方便。</p>\n<p>那么我们可以通过 <code>axios</code> 的响应拦截器来处理这种情况。</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\"><span class=\"hljs-keyword\">import</span> &#123; <span class=\"hljs-title class_\">ElMessage</span> &#125; <span class=\"hljs-keyword\">from</span> <span class=\"hljs-string\">&#x27;element-plus&#x27;</span><br><br><span class=\"hljs-comment\">// 响应拦截器</span><br>service.<span class=\"hljs-property\">interceptors</span>.<span class=\"hljs-property\">response</span>.<span class=\"hljs-title function_\">use</span>(<br>  <span class=\"hljs-function\"><span class=\"hljs-params\">response</span> =&gt;</span> &#123;<br>    <span class=\"hljs-keyword\">const</span> &#123; success, message, data &#125; = response.<span class=\"hljs-property\">data</span><br><br>    <span class=\"hljs-keyword\">if</span> (success) &#123;<br>      <span class=\"hljs-keyword\">return</span> data<br>    &#125; <span class=\"hljs-keyword\">else</span> &#123;<br>      <span class=\"hljs-title class_\">ElMessage</span>.<span class=\"hljs-title function_\">error</span>(message)<br>      <span class=\"hljs-keyword\">return</span> <span class=\"hljs-title class_\">Promise</span>.<span class=\"hljs-title function_\">reject</span>(<span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">Error</span>(message))<br>    &#125;<br>  &#125;,<br>  <span class=\"hljs-function\"><span class=\"hljs-params\">error</span> =&gt;</span> &#123;<br>    <span class=\"hljs-title class_\">ElMessage</span>.<span class=\"hljs-title function_\">error</span>(error.<span class=\"hljs-property\">message</span>) <span class=\"hljs-comment\">// 提示错误信息</span><br>    <span class=\"hljs-keyword\">return</span> <span class=\"hljs-title class_\">Promise</span>.<span class=\"hljs-title function_\">reject</span>(error)<br>  &#125;<br>)<br></code></pre></td></tr></table></figure>\n\n<p>修改好 axios 响应拦截器之后，我们就可以改写一下 <code>vuex user</code> 下的 <code>actions login</code> 方法了。</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\">.<span class=\"hljs-title function_\">then</span>(<span class=\"hljs-function\"><span class=\"hljs-params\">res</span> =&gt;</span> &#123;<br>  context.<span class=\"hljs-title function_\">commit</span>(<span class=\"hljs-string\">&#x27;setToken&#x27;</span>, res.<span class=\"hljs-property\">token</span>) <span class=\"hljs-comment\">// 这样获取 token 是不是就方便很多了</span><br>  <span class=\"hljs-title function_\">resolve</span>(res)<br>&#125;)<br></code></pre></td></tr></table></figure>\n\n<h1 id=\"登录后操作\"><a href=\"#登录后操作\" class=\"headerlink\" title=\"登录后操作\"></a>登录后操作</h1><p>我们可以创建一个 <code>src/layout</code> 文件夹，登录成功后，用来显示的主容器，将 <code>layout/index.vue</code> 配置在 router 路由表中</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\">&#123;<br>  <span class=\"hljs-attr\">path</span>: <span class=\"hljs-string\">&#x27;/&#x27;</span>,<br>  <span class=\"hljs-attr\">component</span>: <span class=\"hljs-function\">() =&gt;</span> <span class=\"hljs-title function_\">import</span>(<span class=\"hljs-string\">&#x27;@/layout/index.vue&#x27;</span>)<br>&#125;<br></code></pre></td></tr></table></figure>\n\n<p>登录成功后，跳转到 <code>layout</code> 页面</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\"><span class=\"hljs-comment\">// login/index.vue</span><br><br>store<br>  .<span class=\"hljs-title function_\">dispatch</span>(<span class=\"hljs-string\">&#x27;user/login&#x27;</span>, user.<span class=\"hljs-property\">value</span>)<br>  .<span class=\"hljs-title function_\">then</span>(<span class=\"hljs-function\">() =&gt;</span> &#123;<br>    router.<span class=\"hljs-title function_\">replace</span>(<span class=\"hljs-string\">&#x27;/&#x27;</span>)<br>  &#125;)<br>  .<span class=\"hljs-title function_\">catch</span>(<span class=\"hljs-function\"><span class=\"hljs-params\">err</span> =&gt;</span> &#123;<br>    <span class=\"hljs-variable language_\">console</span>.<span class=\"hljs-title function_\">log</span>(<span class=\"hljs-string\">&#x27;err &#x27;</span>, err)<br>  &#125;)<br></code></pre></td></tr></table></figure>\n\n<h1 id=\"登录鉴权\"><a href=\"#登录鉴权\" class=\"headerlink\" title=\"登录鉴权\"></a>登录鉴权</h1><p>到这里，我们点击登录，就可以跳转到 <code>layout</code> 页面了，但是我们如果在地址栏手动输入 <code>/login</code>，我们依然可以回到 <code>login</code> 页面，明明我们登录成功，有了 token 还会跳到 login 页面，这是为什么呢？</p>\n<p>因为我们到这里，还未做登录鉴权，即使存在token，我们并未做任何的权限控制和处理。</p>\n<p>那么我们要做什么处理呢？</p>\n<ul>\n<li><p>当用户未登录时，不允许进入除 <code>login</code> 之外的任何页面</p>\n</li>\n<li><p>用户登录成功之后，token 未过期之前，不让用户进入 <code>login</code> 页面</p>\n</li>\n</ul>\n<p>实现这个功能的核心就是使用 <code>vue-router</code> 的 <strong>路由守卫</strong></p>\n<blockquote>\n<p>传送门：<a href=\"https://router.vuejs.org/zh/guide/advanced/navigation-guards.html\">https://router.vuejs.org/zh/guide/advanced/navigation-guards.html</a></p>\n</blockquote>\n<p>那么我们创建 <code>permission.ts</code> 来处理路由守卫吧：</p>\n<p>因为我们的 token 定义在 <code>modules user</code> 中，每次获取 token，需要使用 <code>store.state.user.token</code>，这样显得太长了，我们可以定义 <code>store getters</code>，来方便获取 <code>token</code>：</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\"><span class=\"hljs-comment\">// getters.ts</span><br><span class=\"hljs-keyword\">const</span> getters = &#123;<br>  <span class=\"hljs-attr\">token</span>: <span class=\"hljs-function\">(<span class=\"hljs-params\">state: any</span>) =&gt;</span> state.<span class=\"hljs-property\">user</span>.<span class=\"hljs-property\">token</span><br>&#125;<br><span class=\"hljs-keyword\">export</span> <span class=\"hljs-keyword\">default</span> getters<br></code></pre></td></tr></table></figure>\n\n<p>然后将其放入 store 的 getters 中</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\"><span class=\"hljs-keyword\">import</span> getters <span class=\"hljs-keyword\">from</span> <span class=\"hljs-string\">&#x27;./getters&#x27;</span><br><br><span class=\"hljs-keyword\">export</span> <span class=\"hljs-keyword\">default</span> <span class=\"hljs-title function_\">createStore</span>(&#123;<br>  <span class=\"hljs-title function_\">state</span>(<span class=\"hljs-params\"></span>) &#123;<br>    <span class=\"hljs-keyword\">return</span> &#123;<br>      <span class=\"hljs-attr\">globalName</span>: <span class=\"hljs-string\">&#x27;Hello_AlexCc&#x27;</span><br>    &#125;<br>  &#125;,<br>  getters,<br>  <span class=\"hljs-attr\">modules</span>: &#123;<br>    user<br>  &#125;<br>&#125;)<br></code></pre></td></tr></table></figure>\n\n<p>然后创建 permissions.ts 文件，定义路由前置守卫。</p>\n<p>判断 token 是否存在，如果存在 token，并且 <code>to.path</code> 等于 <code>/login</code>，那么不让跳转到登录页，而是去 <code>layout</code> 页面。</p>\n<p>如果 <code>to.path</code> 不是 <code>/login</code>，直接执行 <code>next</code> 方法即可。</p>\n<p>如果 token 不存在，并且 <code>to.path</code> 是 <code>/login</code>，直接跳转 <code>next()</code></p>\n<p>如果 token 不存在并且 <code>to.path</code> 不是 <code>/login</code>，我们让其跳转到登录页 <code>next(&#39;/login&#39;)</code></p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\"><span class=\"hljs-comment\">// permissions.ts</span><br><br><span class=\"hljs-keyword\">import</span> router <span class=\"hljs-keyword\">from</span> <span class=\"hljs-string\">&#x27;./router&#x27;</span><br><span class=\"hljs-keyword\">import</span> store <span class=\"hljs-keyword\">from</span> <span class=\"hljs-string\">&#x27;./store&#x27;</span><br><br>router.<span class=\"hljs-title function_\">beforeEach</span>(<span class=\"hljs-function\">(<span class=\"hljs-params\">to, <span class=\"hljs-keyword\">from</span>, next</span>) =&gt;</span> &#123;<br>  <span class=\"hljs-comment\">// 判断token是否存在</span><br>  <span class=\"hljs-keyword\">if</span> (store.<span class=\"hljs-property\">getters</span>.<span class=\"hljs-property\">token</span>) &#123;<br>    <span class=\"hljs-keyword\">if</span> (to.<span class=\"hljs-property\">path</span> === <span class=\"hljs-string\">&#x27;/login&#x27;</span>) &#123;<br>      <span class=\"hljs-title function_\">next</span>(<span class=\"hljs-string\">&#x27;/&#x27;</span>)<br>    &#125; <span class=\"hljs-keyword\">else</span> &#123;<br>      <span class=\"hljs-title function_\">next</span>()<br>    &#125;<br>  &#125; <span class=\"hljs-keyword\">else</span> &#123;<br>    <span class=\"hljs-keyword\">if</span> (to.<span class=\"hljs-property\">path</span> === <span class=\"hljs-string\">&#x27;/login&#x27;</span>) &#123;<br>      <span class=\"hljs-title function_\">next</span>()<br>    &#125; <span class=\"hljs-keyword\">else</span> &#123;<br>      <span class=\"hljs-title function_\">next</span>(<span class=\"hljs-string\">&#x27;/login&#x27;</span>)<br>    &#125;<br>  &#125;<br>&#125;)<br></code></pre></td></tr></table></figure>\n\n<p>到这里，我们点击登录，就会去到根路径下 ‘/‘，也就是 <code>layout</code> 页面。这时我们在地址栏输入 <code>/login</code>，就不会再去登录页面了。</p>\n<p>我们还可以改进一下，当 <code>token</code> 不存在时，我们判断了 <code>to.path === &#39;/login&#39;</code>，这样限制死了，将来我们还有 <code>/404</code> 以及 <code>/401</code> 等页面，这些页面也是不需要 <code>token</code> 就能访问的，我们不希望在 <code>if</code> 语句里面加太多的判断逻辑，这时，我们可以定义一个 <code>白名单</code>，专门处理不需要 <code>token</code> 的路径:</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\"><span class=\"hljs-keyword\">const</span> whiteList = [<span class=\"hljs-string\">&#x27;/login&#x27;</span>]<br><br><span class=\"hljs-keyword\">if</span> (whiteList.<span class=\"hljs-title function_\">indexOf</span>(to.<span class=\"hljs-property\">path</span>) &gt; -<span class=\"hljs-number\">1</span>) &#123;<br>  <span class=\"hljs-title function_\">next</span>()<br>&#125; <span class=\"hljs-keyword\">else</span> &#123;<br>  <span class=\"hljs-title function_\">next</span>(<span class=\"hljs-string\">&#x27;/login&#x27;</span>)<br>&#125;<br></code></pre></td></tr></table></figure>\n"},{"layout":"Vue3","title":"Vue3项目实战(二)：Icon图标（SVG）","date":"2022-12-23T04:16:55.000Z","banner_img":"/img/icon.png","index_img":"/img/icon.png","excerpt":"自定义 SvgIcon 组件，支持外部链接显示以及本地 svg 图片显示","_content":"\n# 使用 Element plus Icon\n\n> https://element-plus.gitee.io/zh-CN/component/icon.html\n\n# 自定义 SVG 图标\n\n对于 element plus 的图标，我们可以直接通过 el-icon 来显示。\n\n```js\n<template>\n  <div>\n    <el-icon :size=\"size\" :color=\"color\">\n      <Edit />\n    </el-icon>\n\n    <!-- 或者独立使用它，不从父级获取属性 -->\n    <!-- 由于SVG图标默认不携带任何属性，你需要直接提供它们 -->\n    <Edit />\n    <Edit style=\"width: 1em; height: 1em; margin-right: 8px\" />\n    <Share style=\"width: 1em; height: 1em; margin-right: 8px\" />\n  </div>\n</template>\n```\n\n但是自定义的图标，我们却没有显示的方式，那么我们就需要一个自定义的组件，来展示自定义的 `svg` 图标。\n\n对于这个自定义的组件，它需要拥有两种能力：\n\n- 显示外部的 svg 图标（链接的方式）\n- 显示项目内的 svg 图标\n\n接下来，我们就来实现自定义组件。\n\n## 显示外部的 svg 图标\n\ncss mask:\nmask 属性允许使用者通过遮罩或者裁切特定区域的图片的方式来 `隐藏一个元素的部分` 或者 `全部可见区域`。\n\n> css mask: https://juejin.cn/post/6846687594693001223\n\n接下来，我们定义组件 `SvgIcon`:\n\n```js\n<template>\n  <div\n    v-if=\"isExternal\"\n    :style=\"styleExternalIcon\"\n    class=\"svg-external-icon svg-icon\"\n    :class=\"className\"\n  />\n</template>\n\n<script setup lang=\"ts\">\nimport { defineProps, computed } from 'vue'\n\nconst props = withDefaults(defineProps<{\n  icon: string\n  className?: string\n}>(), {\n  className: '',\n  icon: ''\n})\n\n// 判断是否为外部图标\nconst isExternal = computed(() => /^(https?:|mailto:|tel:)/.test(props.icon))\n\n// 外部图标样式\nconst styleExternalIcon = computed(() => ({\n  mask: `url(${props.icon}) no-repeat 50% 50%`,\n  '-webkit-mask': `url(${props.icon}) no-repeat 50% 50%`\n}))\n\n</script>\n<style scoped>\n.svg-icon {\n  width: 1em;\n  height: 1em;\n  vertical-align: -0.15em;\n  fill: currentColor;\n  overflow: hidden;\n}\n\n.svg-external-icon {\n  background-color: currentColor;\n  mask-size: cover !important;\n  display: inline-block;\n}\n</style>\n```\n\n这样，我们就可以通过 `链接` 的形式，来使用 `svg` 图标了：\n\n```js\n<svg-icon icon=\"https://res.lgdsunday.club/user.svg\"></svg-icon>\n```\n\n## 展示内部图标\n\n如果不是外部链接的话，我们就展示项目内部的 `svg` 图标。\n\n通过 use 的 `xlink href` 属性，找到 body 下已经处理的过的 svg sprite 元素内容，它其中就包含了 `symbol` 元素，每个 `symbol` 元素上都有一个 `id`，这个 id 就是和 `xlink:href` 与之对应的。\n\n```js\n// ...\n<svg v-else class=\"svg-icon\" :class=\"className\" aria-hidden=\"true\">\n  <use :xlink:href=\"iconName\" />\n</svg>\n\nconst iconName = computed(() => `#icon-${props.icon}`) // \n```\n\n当我们定义好了组件之后，那么就需要在项目中，导入所有的 svg 图标了。\n\n```js\n// icons/index.ts\n\nrequire('./svg/user.svg')\nrequire('./svg/password.svg')\n```\n\n假设我们有几百上千个 svg 图标，我们都要这样子引入吗？会不会太难受了 ~~\n\n这里，我们可以使用 webpack 提供的 require.context 方法，来 `批量` 导入 svg 图标:\n\n```js\n// https://webpack.docschina.org/guides/dependency-management/#requirecontext\n// 通过 require.context() 函数来创建自己的 context\nconst svgRequire = require.context('./svg', false, /\\.svg$/)\n// 此时返回一个 require 的函数，可以接受一个 request 的参数，用于 require 的导入。\n// 该函数提供了三个属性，可以通过 require.keys() 获取到所有的 svg 图标 ['./xxx1.svg', './xxx2.svg']\n// 遍历图标，把图标作为 request 传入到 require 导入函数中，完成本地 svg 图标的导入\n\nsvgRequire.keys().forEach(svgIcon => svgRequire(svgIcon))\n```\n\n这样，就完成了所有的本地 `svg` 图片导入。\n\n然后我们注册全局的 `SvgIcon` 组件，方便使用。\n\n```js\n// icons/index.ts\n\nimport type { App } from 'vue'\nimport SvgIcon from '@/components/SvgIcon/index.vue'\n\nexport default (app: App): void => {\n  app.component('svg-icon', SvgIcon)\n}\n```\n\n到这里，我们去页面上使用 `<svg-icon icon=\"user\" />`，发现没有效果，图标展示不出来。\n\n这是因为，我们虽然在 `icons/index.ts` 中，通过 `require.context` 导入了所有的 svg 图片，但是并没有做处理，`svg-icon` 内部的 `<use :xlink:href=\"#icon-user\" />` 找不到任何跟 `#icon-user` 有关的 svg 图标。\n\n这里，我们就需要用到 `svg-sprite-loader` 了。\n\n## svg-sprite-loader\n\nsvg-sprite-loader 的官方解释是：一个用于创建 svg 雪碧图的 Webpack 加载器。这个加载器现在已经被 JetBrains 公司收录和维护了。\n\n通俗的讲：svg-sprite-loader 会把你引入的 svg 塞到一个个 symbol 中，合成一个大的 svg，最后将这个大的 svg 放入 body 中。symbol 的 id 如果不特别指定，就是你的文件名。在页面上形成这样的元素，下面是导入了本地的 `user.svg` 和 `password.svg`：\n\n![](/img/svg-sprite.png)\n\n我们可以看到，每个 `symbol` 上，都有一个 `id` 属性，因为我们在 `SvgIcon` 中指定了 `use` 的 `:xlink:href`，使用时，就能找到页面上对应的图标了。\n\n接着，我们来配置 `svg-sprite-loader`，打开 `vue.config.js`:\n\n```js\nconst path = require('path')\n\nfunction resolve(dir) {\n  return path.join(__dirname, dir)\n}\n\nmodule.exports = {\n  chainWebpack(config) {\n    // 使用了 config.module.rule('svg') 方法来获取对 SVG 文件的处理规则。\n    // 然后，它使用了 exclude 属性来添加一个排除规则，这个规则会排除 resolve('src/icons') 目录中的所有文件。\n    // 最后，它使用了 end 方法来结束这个链式调用。\n    // 这段代码的作用是在 Webpack 构建流程中排除 src/icons 目录中的所有 SVG 文件。这意味着 Webpack 在构建时不会处理这些文件。\n    config.module.rule('svg').exclude.add(resolve('src/icons')).end()\n\n    // 使用了 config.module.rule('icons') 方法来获取对图标文件的处理规则。\n    // 然后，它使用了 test 属性来设置这个规则应用于哪些文件，这里使用的是一个正则表达式，表示只有以 .svg 结尾的文件才会被处理。\n    // 接着，它使用了 include 属性来添加一个包含规则，这个规则只会包含 resolve('src/icons') 目录中的文件。\n    // 最后，它使用了 use 方法来添加一个新的规则，这个规则使用了 svg-sprite-loader 来处理 SVG 文件。\n    // 这段代码的作用是在 Webpack 构建流程中处理 src/icons 目录中的 SVG 文件。\n    // 它会使用 svg-sprite-loader 加载器来将这些 SVG 文件转换为可以在浏览器中使用的精灵图（Sprite）。\n\n    config.module\n      .rule('icons')\n      .test(/\\.svg$/)\n      .include.add(resolve('src/icons'))\n      .end()\n      .use('svg-sprite-loader')\n      .loader('svg-sprite-loader')\n      .options({\n        symbolId: 'icon-[name]' // 指定精灵的符号 ID 应为 icon-[name]。\n      })\n      .end()\n  }\n}\n\n```\n\n这两条规则在 webpack 配置中设置了两种不同的方法来处理 SVG 文件：一种用于排除位于 src/icons 目录中的 SVG 文件，另一种用于使用 svg-sprite-loader 处理位于 src/icons 目录中的 SVG 文件。\n\n\n到这里，我们就完成了 `svg-sprite-loader` 的配置，然后重新启动项目，就可以愉快的使用本地的 `svg` 了。\n\n```js\n\n<svg-icon icon=\"user\"></svg-icon>\n\n<svg-icon icon=\"password\"></svg-icon>\n\n```\n\n![](/img/svg-sprite-result.png)\n\n页面上的效果是这样的\n\n![](/img/login.png)\n\n## 总结\n\n经过 `svg-sprite-loader` 加载之后，不仅可以通过指定 id 的方式引入 icon，而且相比图片引入的方式，最大的优点就在于可以通过给 svg 标签添加 fill 属性来调整 icon 的颜色。\n\n除此之外，还可以通过给 svg 添加 class 来调整 icon 的样式，虽然说图片引入的方式也能做到，但是如果图片指定宽高与原图的宽高不成比例，就会导致图片的失真，而 svg 不会。即使随意调整 svg 的宽高样式，它也是按照原尺寸进行缩放，达到高保真的效果。\n\n而且通过`svg-sprite-loader`的处理后，生成了精灵图，它是一种将多个图标放在一张图片中的技术，可以减少 HTTP 请求数，从而提升网站性能。\n\n\n\n","source":"_posts/vue3-project-traning.md","raw":"---\nlayout: Vue3\ntitle: Vue3项目实战(二)：Icon图标（SVG）\ndate: 2022-12-23 12:16:55\ntags: 工程化,Vue3\nbanner_img: /img/icon.png\nindex_img: /img/icon.png\nexcerpt: 自定义 SvgIcon 组件，支持外部链接显示以及本地 svg 图片显示\n---\n\n# 使用 Element plus Icon\n\n> https://element-plus.gitee.io/zh-CN/component/icon.html\n\n# 自定义 SVG 图标\n\n对于 element plus 的图标，我们可以直接通过 el-icon 来显示。\n\n```js\n<template>\n  <div>\n    <el-icon :size=\"size\" :color=\"color\">\n      <Edit />\n    </el-icon>\n\n    <!-- 或者独立使用它，不从父级获取属性 -->\n    <!-- 由于SVG图标默认不携带任何属性，你需要直接提供它们 -->\n    <Edit />\n    <Edit style=\"width: 1em; height: 1em; margin-right: 8px\" />\n    <Share style=\"width: 1em; height: 1em; margin-right: 8px\" />\n  </div>\n</template>\n```\n\n但是自定义的图标，我们却没有显示的方式，那么我们就需要一个自定义的组件，来展示自定义的 `svg` 图标。\n\n对于这个自定义的组件，它需要拥有两种能力：\n\n- 显示外部的 svg 图标（链接的方式）\n- 显示项目内的 svg 图标\n\n接下来，我们就来实现自定义组件。\n\n## 显示外部的 svg 图标\n\ncss mask:\nmask 属性允许使用者通过遮罩或者裁切特定区域的图片的方式来 `隐藏一个元素的部分` 或者 `全部可见区域`。\n\n> css mask: https://juejin.cn/post/6846687594693001223\n\n接下来，我们定义组件 `SvgIcon`:\n\n```js\n<template>\n  <div\n    v-if=\"isExternal\"\n    :style=\"styleExternalIcon\"\n    class=\"svg-external-icon svg-icon\"\n    :class=\"className\"\n  />\n</template>\n\n<script setup lang=\"ts\">\nimport { defineProps, computed } from 'vue'\n\nconst props = withDefaults(defineProps<{\n  icon: string\n  className?: string\n}>(), {\n  className: '',\n  icon: ''\n})\n\n// 判断是否为外部图标\nconst isExternal = computed(() => /^(https?:|mailto:|tel:)/.test(props.icon))\n\n// 外部图标样式\nconst styleExternalIcon = computed(() => ({\n  mask: `url(${props.icon}) no-repeat 50% 50%`,\n  '-webkit-mask': `url(${props.icon}) no-repeat 50% 50%`\n}))\n\n</script>\n<style scoped>\n.svg-icon {\n  width: 1em;\n  height: 1em;\n  vertical-align: -0.15em;\n  fill: currentColor;\n  overflow: hidden;\n}\n\n.svg-external-icon {\n  background-color: currentColor;\n  mask-size: cover !important;\n  display: inline-block;\n}\n</style>\n```\n\n这样，我们就可以通过 `链接` 的形式，来使用 `svg` 图标了：\n\n```js\n<svg-icon icon=\"https://res.lgdsunday.club/user.svg\"></svg-icon>\n```\n\n## 展示内部图标\n\n如果不是外部链接的话，我们就展示项目内部的 `svg` 图标。\n\n通过 use 的 `xlink href` 属性，找到 body 下已经处理的过的 svg sprite 元素内容，它其中就包含了 `symbol` 元素，每个 `symbol` 元素上都有一个 `id`，这个 id 就是和 `xlink:href` 与之对应的。\n\n```js\n// ...\n<svg v-else class=\"svg-icon\" :class=\"className\" aria-hidden=\"true\">\n  <use :xlink:href=\"iconName\" />\n</svg>\n\nconst iconName = computed(() => `#icon-${props.icon}`) // \n```\n\n当我们定义好了组件之后，那么就需要在项目中，导入所有的 svg 图标了。\n\n```js\n// icons/index.ts\n\nrequire('./svg/user.svg')\nrequire('./svg/password.svg')\n```\n\n假设我们有几百上千个 svg 图标，我们都要这样子引入吗？会不会太难受了 ~~\n\n这里，我们可以使用 webpack 提供的 require.context 方法，来 `批量` 导入 svg 图标:\n\n```js\n// https://webpack.docschina.org/guides/dependency-management/#requirecontext\n// 通过 require.context() 函数来创建自己的 context\nconst svgRequire = require.context('./svg', false, /\\.svg$/)\n// 此时返回一个 require 的函数，可以接受一个 request 的参数，用于 require 的导入。\n// 该函数提供了三个属性，可以通过 require.keys() 获取到所有的 svg 图标 ['./xxx1.svg', './xxx2.svg']\n// 遍历图标，把图标作为 request 传入到 require 导入函数中，完成本地 svg 图标的导入\n\nsvgRequire.keys().forEach(svgIcon => svgRequire(svgIcon))\n```\n\n这样，就完成了所有的本地 `svg` 图片导入。\n\n然后我们注册全局的 `SvgIcon` 组件，方便使用。\n\n```js\n// icons/index.ts\n\nimport type { App } from 'vue'\nimport SvgIcon from '@/components/SvgIcon/index.vue'\n\nexport default (app: App): void => {\n  app.component('svg-icon', SvgIcon)\n}\n```\n\n到这里，我们去页面上使用 `<svg-icon icon=\"user\" />`，发现没有效果，图标展示不出来。\n\n这是因为，我们虽然在 `icons/index.ts` 中，通过 `require.context` 导入了所有的 svg 图片，但是并没有做处理，`svg-icon` 内部的 `<use :xlink:href=\"#icon-user\" />` 找不到任何跟 `#icon-user` 有关的 svg 图标。\n\n这里，我们就需要用到 `svg-sprite-loader` 了。\n\n## svg-sprite-loader\n\nsvg-sprite-loader 的官方解释是：一个用于创建 svg 雪碧图的 Webpack 加载器。这个加载器现在已经被 JetBrains 公司收录和维护了。\n\n通俗的讲：svg-sprite-loader 会把你引入的 svg 塞到一个个 symbol 中，合成一个大的 svg，最后将这个大的 svg 放入 body 中。symbol 的 id 如果不特别指定，就是你的文件名。在页面上形成这样的元素，下面是导入了本地的 `user.svg` 和 `password.svg`：\n\n![](/img/svg-sprite.png)\n\n我们可以看到，每个 `symbol` 上，都有一个 `id` 属性，因为我们在 `SvgIcon` 中指定了 `use` 的 `:xlink:href`，使用时，就能找到页面上对应的图标了。\n\n接着，我们来配置 `svg-sprite-loader`，打开 `vue.config.js`:\n\n```js\nconst path = require('path')\n\nfunction resolve(dir) {\n  return path.join(__dirname, dir)\n}\n\nmodule.exports = {\n  chainWebpack(config) {\n    // 使用了 config.module.rule('svg') 方法来获取对 SVG 文件的处理规则。\n    // 然后，它使用了 exclude 属性来添加一个排除规则，这个规则会排除 resolve('src/icons') 目录中的所有文件。\n    // 最后，它使用了 end 方法来结束这个链式调用。\n    // 这段代码的作用是在 Webpack 构建流程中排除 src/icons 目录中的所有 SVG 文件。这意味着 Webpack 在构建时不会处理这些文件。\n    config.module.rule('svg').exclude.add(resolve('src/icons')).end()\n\n    // 使用了 config.module.rule('icons') 方法来获取对图标文件的处理规则。\n    // 然后，它使用了 test 属性来设置这个规则应用于哪些文件，这里使用的是一个正则表达式，表示只有以 .svg 结尾的文件才会被处理。\n    // 接着，它使用了 include 属性来添加一个包含规则，这个规则只会包含 resolve('src/icons') 目录中的文件。\n    // 最后，它使用了 use 方法来添加一个新的规则，这个规则使用了 svg-sprite-loader 来处理 SVG 文件。\n    // 这段代码的作用是在 Webpack 构建流程中处理 src/icons 目录中的 SVG 文件。\n    // 它会使用 svg-sprite-loader 加载器来将这些 SVG 文件转换为可以在浏览器中使用的精灵图（Sprite）。\n\n    config.module\n      .rule('icons')\n      .test(/\\.svg$/)\n      .include.add(resolve('src/icons'))\n      .end()\n      .use('svg-sprite-loader')\n      .loader('svg-sprite-loader')\n      .options({\n        symbolId: 'icon-[name]' // 指定精灵的符号 ID 应为 icon-[name]。\n      })\n      .end()\n  }\n}\n\n```\n\n这两条规则在 webpack 配置中设置了两种不同的方法来处理 SVG 文件：一种用于排除位于 src/icons 目录中的 SVG 文件，另一种用于使用 svg-sprite-loader 处理位于 src/icons 目录中的 SVG 文件。\n\n\n到这里，我们就完成了 `svg-sprite-loader` 的配置，然后重新启动项目，就可以愉快的使用本地的 `svg` 了。\n\n```js\n\n<svg-icon icon=\"user\"></svg-icon>\n\n<svg-icon icon=\"password\"></svg-icon>\n\n```\n\n![](/img/svg-sprite-result.png)\n\n页面上的效果是这样的\n\n![](/img/login.png)\n\n## 总结\n\n经过 `svg-sprite-loader` 加载之后，不仅可以通过指定 id 的方式引入 icon，而且相比图片引入的方式，最大的优点就在于可以通过给 svg 标签添加 fill 属性来调整 icon 的颜色。\n\n除此之外，还可以通过给 svg 添加 class 来调整 icon 的样式，虽然说图片引入的方式也能做到，但是如果图片指定宽高与原图的宽高不成比例，就会导致图片的失真，而 svg 不会。即使随意调整 svg 的宽高样式，它也是按照原尺寸进行缩放，达到高保真的效果。\n\n而且通过`svg-sprite-loader`的处理后，生成了精灵图，它是一种将多个图标放在一张图片中的技术，可以减少 HTTP 请求数，从而提升网站性能。\n\n\n\n","slug":"vue3-project-traning","published":1,"updated":"2023-05-12T10:49:20.017Z","comments":1,"photos":[],"link":"","_id":"clhkizgxq00173y0q59pn2npa","content":"<h1 id=\"使用-Element-plus-Icon\"><a href=\"#使用-Element-plus-Icon\" class=\"headerlink\" title=\"使用 Element plus Icon\"></a>使用 Element plus Icon</h1><blockquote>\n<p><a href=\"https://element-plus.gitee.io/zh-CN/component/icon.html\">https://element-plus.gitee.io/zh-CN/component/icon.html</a></p>\n</blockquote>\n<h1 id=\"自定义-SVG-图标\"><a href=\"#自定义-SVG-图标\" class=\"headerlink\" title=\"自定义 SVG 图标\"></a>自定义 SVG 图标</h1><p>对于 element plus 的图标，我们可以直接通过 el-icon 来显示。</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><div class=\"code-wrapper\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></div></td><td class=\"code\"><pre><code class=\"hljs js\">&lt;template&gt;<br>  <span class=\"language-xml\"><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">div</span>&gt;</span></span><br><span class=\"language-xml\">    <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">el-icon</span> <span class=\"hljs-attr\">:size</span>=<span class=\"hljs-string\">&quot;size&quot;</span> <span class=\"hljs-attr\">:color</span>=<span class=\"hljs-string\">&quot;color&quot;</span>&gt;</span></span><br><span class=\"language-xml\">      <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">Edit</span> /&gt;</span></span><br><span class=\"language-xml\">    <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">el-icon</span>&gt;</span></span><br><span class=\"language-xml\"></span><br><span class=\"language-xml\">    <span class=\"hljs-comment\">&lt;!-- 或者独立使用它，不从父级获取属性 --&gt;</span></span><br><span class=\"language-xml\">    <span class=\"hljs-comment\">&lt;!-- 由于SVG图标默认不携带任何属性，你需要直接提供它们 --&gt;</span></span><br><span class=\"language-xml\">    <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">Edit</span> /&gt;</span></span><br><span class=\"language-xml\">    <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">Edit</span> <span class=\"hljs-attr\">style</span>=<span class=\"hljs-string\">&quot;width: 1em; height: 1em; margin-right: 8px&quot;</span> /&gt;</span></span><br><span class=\"language-xml\">    <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">Share</span> <span class=\"hljs-attr\">style</span>=<span class=\"hljs-string\">&quot;width: 1em; height: 1em; margin-right: 8px&quot;</span> /&gt;</span></span><br><span class=\"language-xml\">  <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">div</span>&gt;</span></span><br>&lt;/template&gt;<br></code></pre></td></tr></table></figure>\n\n<p>但是自定义的图标，我们却没有显示的方式，那么我们就需要一个自定义的组件，来展示自定义的 <code>svg</code> 图标。</p>\n<p>对于这个自定义的组件，它需要拥有两种能力：</p>\n<ul>\n<li>显示外部的 svg 图标（链接的方式）</li>\n<li>显示项目内的 svg 图标</li>\n</ul>\n<p>接下来，我们就来实现自定义组件。</p>\n<h2 id=\"显示外部的-svg-图标\"><a href=\"#显示外部的-svg-图标\" class=\"headerlink\" title=\"显示外部的 svg 图标\"></a>显示外部的 svg 图标</h2><p>css mask:<br>mask 属性允许使用者通过遮罩或者裁切特定区域的图片的方式来 <code>隐藏一个元素的部分</code> 或者 <code>全部可见区域</code>。</p>\n<blockquote>\n<p>css mask: <a href=\"https://juejin.cn/post/6846687594693001223\">https://juejin.cn/post/6846687594693001223</a></p>\n</blockquote>\n<p>接下来，我们定义组件 <code>SvgIcon</code>:</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\">&lt;template&gt;<br>  <span class=\"language-xml\"><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">div</span></span></span><br><span class=\"hljs-tag\"><span class=\"language-xml\">    <span class=\"hljs-attr\">v-if</span>=<span class=\"hljs-string\">&quot;isExternal&quot;</span></span></span><br><span class=\"hljs-tag\"><span class=\"language-xml\">    <span class=\"hljs-attr\">:style</span>=<span class=\"hljs-string\">&quot;styleExternalIcon&quot;</span></span></span><br><span class=\"hljs-tag\"><span class=\"language-xml\">    <span class=\"hljs-attr\">class</span>=<span class=\"hljs-string\">&quot;svg-external-icon svg-icon&quot;</span></span></span><br><span class=\"hljs-tag\"><span class=\"language-xml\">    <span class=\"hljs-attr\">:class</span>=<span class=\"hljs-string\">&quot;className&quot;</span></span></span><br><span class=\"hljs-tag\"><span class=\"language-xml\">  /&gt;</span></span><br>&lt;/template&gt;<br><br><span class=\"language-xml\"><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">script</span> <span class=\"hljs-attr\">setup</span> <span class=\"hljs-attr\">lang</span>=<span class=\"hljs-string\">&quot;ts&quot;</span>&gt;</span><span class=\"language-javascript\"></span></span><br><span class=\"language-javascript\"><span class=\"language-xml\"><span class=\"hljs-keyword\">import</span> &#123; defineProps, computed &#125; <span class=\"hljs-keyword\">from</span> <span class=\"hljs-string\">&#x27;vue&#x27;</span></span></span><br><span class=\"language-javascript\"><span class=\"language-xml\"></span></span><br><span class=\"language-javascript\"><span class=\"language-xml\"><span class=\"hljs-keyword\">const</span> props = <span class=\"hljs-title function_\">withDefaults</span>(defineProps&lt;&#123;</span></span><br><span class=\"language-javascript\"><span class=\"language-xml\">  <span class=\"hljs-attr\">icon</span>: string</span></span><br><span class=\"language-javascript\"><span class=\"language-xml\">  className?: string</span></span><br><span class=\"language-javascript\"><span class=\"language-xml\">&#125;&gt;(), &#123;</span></span><br><span class=\"language-javascript\"><span class=\"language-xml\">  <span class=\"hljs-attr\">className</span>: <span class=\"hljs-string\">&#x27;&#x27;</span>,</span></span><br><span class=\"language-javascript\"><span class=\"language-xml\">  <span class=\"hljs-attr\">icon</span>: <span class=\"hljs-string\">&#x27;&#x27;</span></span></span><br><span class=\"language-javascript\"><span class=\"language-xml\">&#125;)</span></span><br><span class=\"language-javascript\"><span class=\"language-xml\"></span></span><br><span class=\"language-javascript\"><span class=\"language-xml\"><span class=\"hljs-comment\">// 判断是否为外部图标</span></span></span><br><span class=\"language-javascript\"><span class=\"language-xml\"><span class=\"hljs-keyword\">const</span> isExternal = <span class=\"hljs-title function_\">computed</span>(<span class=\"hljs-function\">() =&gt;</span> <span class=\"hljs-regexp\">/^(https?:|mailto:|tel:)/</span>.<span class=\"hljs-title function_\">test</span>(props.<span class=\"hljs-property\">icon</span>))</span></span><br><span class=\"language-javascript\"><span class=\"language-xml\"></span></span><br><span class=\"language-javascript\"><span class=\"language-xml\"><span class=\"hljs-comment\">// 外部图标样式</span></span></span><br><span class=\"language-javascript\"><span class=\"language-xml\"><span class=\"hljs-keyword\">const</span> styleExternalIcon = <span class=\"hljs-title function_\">computed</span>(<span class=\"hljs-function\">() =&gt;</span> (&#123;</span></span><br><span class=\"language-javascript\"><span class=\"language-xml\">  <span class=\"hljs-attr\">mask</span>: <span class=\"hljs-string\">`url(<span class=\"hljs-subst\">$&#123;props.icon&#125;</span>) no-repeat 50% 50%`</span>,</span></span><br><span class=\"language-javascript\"><span class=\"language-xml\">  <span class=\"hljs-string\">&#x27;-webkit-mask&#x27;</span>: <span class=\"hljs-string\">`url(<span class=\"hljs-subst\">$&#123;props.icon&#125;</span>) no-repeat 50% 50%`</span></span></span><br><span class=\"language-javascript\"><span class=\"language-xml\">&#125;))</span></span><br><span class=\"language-javascript\"><span class=\"language-xml\"></span></span><br><span class=\"language-javascript\"><span class=\"language-xml\"></span><span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">script</span>&gt;</span></span><br><span class=\"language-xml\"><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">style</span> <span class=\"hljs-attr\">scoped</span>&gt;</span><span class=\"language-css\"></span></span><br><span class=\"language-css\"><span class=\"language-xml\"><span class=\"hljs-selector-class\">.svg-icon</span> &#123;</span></span><br><span class=\"language-css\"><span class=\"language-xml\">  <span class=\"hljs-attribute\">width</span>: <span class=\"hljs-number\">1em</span>;</span></span><br><span class=\"language-css\"><span class=\"language-xml\">  <span class=\"hljs-attribute\">height</span>: <span class=\"hljs-number\">1em</span>;</span></span><br><span class=\"language-css\"><span class=\"language-xml\">  <span class=\"hljs-attribute\">vertical-align</span>: -<span class=\"hljs-number\">0.15em</span>;</span></span><br><span class=\"language-css\"><span class=\"language-xml\">  fill: currentColor;</span></span><br><span class=\"language-css\"><span class=\"language-xml\">  <span class=\"hljs-attribute\">overflow</span>: hidden;</span></span><br><span class=\"language-css\"><span class=\"language-xml\">&#125;</span></span><br><span class=\"language-css\"><span class=\"language-xml\"></span></span><br><span class=\"language-css\"><span class=\"language-xml\"><span class=\"hljs-selector-class\">.svg-external-icon</span> &#123;</span></span><br><span class=\"language-css\"><span class=\"language-xml\">  <span class=\"hljs-attribute\">background-color</span>: currentColor;</span></span><br><span class=\"language-css\"><span class=\"language-xml\">  <span class=\"hljs-attribute\">mask-size</span>: cover <span class=\"hljs-meta\">!important</span>;</span></span><br><span class=\"language-css\"><span class=\"language-xml\">  <span class=\"hljs-attribute\">display</span>: inline-block;</span></span><br><span class=\"language-css\"><span class=\"language-xml\">&#125;</span></span><br><span class=\"language-css\"><span class=\"language-xml\"></span><span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">style</span>&gt;</span></span><br></code></pre></td></tr></table></figure>\n\n<p>这样，我们就可以通过 <code>链接</code> 的形式，来使用 <code>svg</code> 图标了：</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\">&lt;svg-icon icon=<span class=\"hljs-string\">&quot;https://res.lgdsunday.club/user.svg&quot;</span>&gt;&lt;/svg-icon&gt;<br></code></pre></td></tr></table></figure>\n\n<h2 id=\"展示内部图标\"><a href=\"#展示内部图标\" class=\"headerlink\" title=\"展示内部图标\"></a>展示内部图标</h2><p>如果不是外部链接的话，我们就展示项目内部的 <code>svg</code> 图标。</p>\n<p>通过 use 的 <code>xlink href</code> 属性，找到 body 下已经处理的过的 svg sprite 元素内容，它其中就包含了 <code>symbol</code> 元素，每个 <code>symbol</code> 元素上都有一个 <code>id</code>，这个 id 就是和 <code>xlink:href</code> 与之对应的。</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\"><span class=\"hljs-comment\">// ...</span><br>&lt;svg v-<span class=\"hljs-keyword\">else</span> <span class=\"hljs-keyword\">class</span>=<span class=\"hljs-string\">&quot;svg-icon&quot;</span> :<span class=\"hljs-keyword\">class</span>=<span class=\"hljs-string\">&quot;className&quot;</span> aria-hidden=<span class=\"hljs-string\">&quot;true&quot;</span>&gt;<br>  <span class=\"language-xml\"><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">use</span> <span class=\"hljs-attr\">:xlink:href</span>=<span class=\"hljs-string\">&quot;iconName&quot;</span> /&gt;</span></span><br>&lt;/svg&gt;<br><br><span class=\"hljs-keyword\">const</span> iconName = <span class=\"hljs-title function_\">computed</span>(<span class=\"hljs-function\">() =&gt;</span> <span class=\"hljs-string\">`#icon-<span class=\"hljs-subst\">$&#123;props.icon&#125;</span>`</span>) <span class=\"hljs-comment\">// </span><br></code></pre></td></tr></table></figure>\n\n<p>当我们定义好了组件之后，那么就需要在项目中，导入所有的 svg 图标了。</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\"><span class=\"hljs-comment\">// icons/index.ts</span><br><br><span class=\"hljs-built_in\">require</span>(<span class=\"hljs-string\">&#x27;./svg/user.svg&#x27;</span>)<br><span class=\"hljs-built_in\">require</span>(<span class=\"hljs-string\">&#x27;./svg/password.svg&#x27;</span>)<br></code></pre></td></tr></table></figure>\n\n<p>假设我们有几百上千个 svg 图标，我们都要这样子引入吗？会不会太难受了 ~~</p>\n<p>这里，我们可以使用 webpack 提供的 require.context 方法，来 <code>批量</code> 导入 svg 图标:</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\"><span class=\"hljs-comment\">// https://webpack.docschina.org/guides/dependency-management/#requirecontext</span><br><span class=\"hljs-comment\">// 通过 require.context() 函数来创建自己的 context</span><br><span class=\"hljs-keyword\">const</span> svgRequire = <span class=\"hljs-built_in\">require</span>.<span class=\"hljs-title function_\">context</span>(<span class=\"hljs-string\">&#x27;./svg&#x27;</span>, <span class=\"hljs-literal\">false</span>, <span class=\"hljs-regexp\">/\\.svg$/</span>)<br><span class=\"hljs-comment\">// 此时返回一个 require 的函数，可以接受一个 request 的参数，用于 require 的导入。</span><br><span class=\"hljs-comment\">// 该函数提供了三个属性，可以通过 require.keys() 获取到所有的 svg 图标 [&#x27;./xxx1.svg&#x27;, &#x27;./xxx2.svg&#x27;]</span><br><span class=\"hljs-comment\">// 遍历图标，把图标作为 request 传入到 require 导入函数中，完成本地 svg 图标的导入</span><br><br>svgRequire.<span class=\"hljs-title function_\">keys</span>().<span class=\"hljs-title function_\">forEach</span>(<span class=\"hljs-function\"><span class=\"hljs-params\">svgIcon</span> =&gt;</span> <span class=\"hljs-title function_\">svgRequire</span>(svgIcon))<br></code></pre></td></tr></table></figure>\n\n<p>这样，就完成了所有的本地 <code>svg</code> 图片导入。</p>\n<p>然后我们注册全局的 <code>SvgIcon</code> 组件，方便使用。</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\"><span class=\"hljs-comment\">// icons/index.ts</span><br><br><span class=\"hljs-keyword\">import</span> type &#123; <span class=\"hljs-title class_\">App</span> &#125; <span class=\"hljs-keyword\">from</span> <span class=\"hljs-string\">&#x27;vue&#x27;</span><br><span class=\"hljs-keyword\">import</span> <span class=\"hljs-title class_\">SvgIcon</span> <span class=\"hljs-keyword\">from</span> <span class=\"hljs-string\">&#x27;@/components/SvgIcon/index.vue&#x27;</span><br><br><span class=\"hljs-keyword\">export</span> <span class=\"hljs-keyword\">default</span> (<span class=\"hljs-attr\">app</span>: <span class=\"hljs-title class_\">App</span>): <span class=\"hljs-function\"><span class=\"hljs-params\">void</span> =&gt;</span> &#123;<br>  app.<span class=\"hljs-title function_\">component</span>(<span class=\"hljs-string\">&#x27;svg-icon&#x27;</span>, <span class=\"hljs-title class_\">SvgIcon</span>)<br>&#125;<br></code></pre></td></tr></table></figure>\n\n<p>到这里，我们去页面上使用 <code>&lt;svg-icon icon=&quot;user&quot; /&gt;</code>，发现没有效果，图标展示不出来。</p>\n<p>这是因为，我们虽然在 <code>icons/index.ts</code> 中，通过 <code>require.context</code> 导入了所有的 svg 图片，但是并没有做处理，<code>svg-icon</code> 内部的 <code>&lt;use :xlink:href=&quot;#icon-user&quot; /&gt;</code> 找不到任何跟 <code>#icon-user</code> 有关的 svg 图标。</p>\n<p>这里，我们就需要用到 <code>svg-sprite-loader</code> 了。</p>\n<h2 id=\"svg-sprite-loader\"><a href=\"#svg-sprite-loader\" class=\"headerlink\" title=\"svg-sprite-loader\"></a>svg-sprite-loader</h2><p>svg-sprite-loader 的官方解释是：一个用于创建 svg 雪碧图的 Webpack 加载器。这个加载器现在已经被 JetBrains 公司收录和维护了。</p>\n<p>通俗的讲：svg-sprite-loader 会把你引入的 svg 塞到一个个 symbol 中，合成一个大的 svg，最后将这个大的 svg 放入 body 中。symbol 的 id 如果不特别指定，就是你的文件名。在页面上形成这样的元素，下面是导入了本地的 <code>user.svg</code> 和 <code>password.svg</code>：</p>\n<p><img src=\"/img/svg-sprite.png\" alt=\"\"></p>\n<p>我们可以看到，每个 <code>symbol</code> 上，都有一个 <code>id</code> 属性，因为我们在 <code>SvgIcon</code> 中指定了 <code>use</code> 的 <code>:xlink:href</code>，使用时，就能找到页面上对应的图标了。</p>\n<p>接着，我们来配置 <code>svg-sprite-loader</code>，打开 <code>vue.config.js</code>:</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\"><span class=\"hljs-keyword\">const</span> path = <span class=\"hljs-built_in\">require</span>(<span class=\"hljs-string\">&#x27;path&#x27;</span>)<br><br><span class=\"hljs-keyword\">function</span> <span class=\"hljs-title function_\">resolve</span>(<span class=\"hljs-params\">dir</span>) &#123;<br>  <span class=\"hljs-keyword\">return</span> path.<span class=\"hljs-title function_\">join</span>(__dirname, dir)<br>&#125;<br><br><span class=\"hljs-variable language_\">module</span>.<span class=\"hljs-property\">exports</span> = &#123;<br>  <span class=\"hljs-title function_\">chainWebpack</span>(<span class=\"hljs-params\">config</span>) &#123;<br>    <span class=\"hljs-comment\">// 使用了 config.module.rule(&#x27;svg&#x27;) 方法来获取对 SVG 文件的处理规则。</span><br>    <span class=\"hljs-comment\">// 然后，它使用了 exclude 属性来添加一个排除规则，这个规则会排除 resolve(&#x27;src/icons&#x27;) 目录中的所有文件。</span><br>    <span class=\"hljs-comment\">// 最后，它使用了 end 方法来结束这个链式调用。</span><br>    <span class=\"hljs-comment\">// 这段代码的作用是在 Webpack 构建流程中排除 src/icons 目录中的所有 SVG 文件。这意味着 Webpack 在构建时不会处理这些文件。</span><br>    config.<span class=\"hljs-property\">module</span>.<span class=\"hljs-title function_\">rule</span>(<span class=\"hljs-string\">&#x27;svg&#x27;</span>).<span class=\"hljs-property\">exclude</span>.<span class=\"hljs-title function_\">add</span>(<span class=\"hljs-title function_\">resolve</span>(<span class=\"hljs-string\">&#x27;src/icons&#x27;</span>)).<span class=\"hljs-title function_\">end</span>()<br><br>    <span class=\"hljs-comment\">// 使用了 config.module.rule(&#x27;icons&#x27;) 方法来获取对图标文件的处理规则。</span><br>    <span class=\"hljs-comment\">// 然后，它使用了 test 属性来设置这个规则应用于哪些文件，这里使用的是一个正则表达式，表示只有以 .svg 结尾的文件才会被处理。</span><br>    <span class=\"hljs-comment\">// 接着，它使用了 include 属性来添加一个包含规则，这个规则只会包含 resolve(&#x27;src/icons&#x27;) 目录中的文件。</span><br>    <span class=\"hljs-comment\">// 最后，它使用了 use 方法来添加一个新的规则，这个规则使用了 svg-sprite-loader 来处理 SVG 文件。</span><br>    <span class=\"hljs-comment\">// 这段代码的作用是在 Webpack 构建流程中处理 src/icons 目录中的 SVG 文件。</span><br>    <span class=\"hljs-comment\">// 它会使用 svg-sprite-loader 加载器来将这些 SVG 文件转换为可以在浏览器中使用的精灵图（Sprite）。</span><br><br>    config.<span class=\"hljs-property\">module</span><br>      .<span class=\"hljs-title function_\">rule</span>(<span class=\"hljs-string\">&#x27;icons&#x27;</span>)<br>      .<span class=\"hljs-title function_\">test</span>(<span class=\"hljs-regexp\">/\\.svg$/</span>)<br>      .<span class=\"hljs-property\">include</span>.<span class=\"hljs-title function_\">add</span>(<span class=\"hljs-title function_\">resolve</span>(<span class=\"hljs-string\">&#x27;src/icons&#x27;</span>))<br>      .<span class=\"hljs-title function_\">end</span>()<br>      .<span class=\"hljs-title function_\">use</span>(<span class=\"hljs-string\">&#x27;svg-sprite-loader&#x27;</span>)<br>      .<span class=\"hljs-title function_\">loader</span>(<span class=\"hljs-string\">&#x27;svg-sprite-loader&#x27;</span>)<br>      .<span class=\"hljs-title function_\">options</span>(&#123;<br>        <span class=\"hljs-attr\">symbolId</span>: <span class=\"hljs-string\">&#x27;icon-[name]&#x27;</span> <span class=\"hljs-comment\">// 指定精灵的符号 ID 应为 icon-[name]。</span><br>      &#125;)<br>      .<span class=\"hljs-title function_\">end</span>()<br>  &#125;<br>&#125;<br><br></code></pre></td></tr></table></figure>\n\n<p>这两条规则在 webpack 配置中设置了两种不同的方法来处理 SVG 文件：一种用于排除位于 src/icons 目录中的 SVG 文件，另一种用于使用 svg-sprite-loader 处理位于 src/icons 目录中的 SVG 文件。</p>\n<p>到这里，我们就完成了 <code>svg-sprite-loader</code> 的配置，然后重新启动项目，就可以愉快的使用本地的 <code>svg</code> 了。</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\"><br>&lt;svg-icon icon=<span class=\"hljs-string\">&quot;user&quot;</span>&gt;&lt;/svg-icon&gt;<br><br><span class=\"language-xml\"><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">svg-icon</span> <span class=\"hljs-attr\">icon</span>=<span class=\"hljs-string\">&quot;password&quot;</span>&gt;</span><span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">svg-icon</span>&gt;</span></span><br><br></code></pre></td></tr></table></figure>\n\n<p><img src=\"/img/svg-sprite-result.png\" alt=\"\"></p>\n<p>页面上的效果是这样的</p>\n<p><img src=\"/img/login.png\" alt=\"\"></p>\n<h2 id=\"总结\"><a href=\"#总结\" class=\"headerlink\" title=\"总结\"></a>总结</h2><p>经过 <code>svg-sprite-loader</code> 加载之后，不仅可以通过指定 id 的方式引入 icon，而且相比图片引入的方式，最大的优点就在于可以通过给 svg 标签添加 fill 属性来调整 icon 的颜色。</p>\n<p>除此之外，还可以通过给 svg 添加 class 来调整 icon 的样式，虽然说图片引入的方式也能做到，但是如果图片指定宽高与原图的宽高不成比例，就会导致图片的失真，而 svg 不会。即使随意调整 svg 的宽高样式，它也是按照原尺寸进行缩放，达到高保真的效果。</p>\n<p>而且通过<code>svg-sprite-loader</code>的处理后，生成了精灵图，它是一种将多个图标放在一张图片中的技术，可以减少 HTTP 请求数，从而提升网站性能。</p>\n","site":{"data":{}},"wordcount":5456,"more":"<h1 id=\"使用-Element-plus-Icon\"><a href=\"#使用-Element-plus-Icon\" class=\"headerlink\" title=\"使用 Element plus Icon\"></a>使用 Element plus Icon</h1><blockquote>\n<p><a href=\"https://element-plus.gitee.io/zh-CN/component/icon.html\">https://element-plus.gitee.io/zh-CN/component/icon.html</a></p>\n</blockquote>\n<h1 id=\"自定义-SVG-图标\"><a href=\"#自定义-SVG-图标\" class=\"headerlink\" title=\"自定义 SVG 图标\"></a>自定义 SVG 图标</h1><p>对于 element plus 的图标，我们可以直接通过 el-icon 来显示。</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\">&lt;template&gt;<br>  <span class=\"language-xml\"><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">div</span>&gt;</span></span><br><span class=\"language-xml\">    <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">el-icon</span> <span class=\"hljs-attr\">:size</span>=<span class=\"hljs-string\">&quot;size&quot;</span> <span class=\"hljs-attr\">:color</span>=<span class=\"hljs-string\">&quot;color&quot;</span>&gt;</span></span><br><span class=\"language-xml\">      <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">Edit</span> /&gt;</span></span><br><span class=\"language-xml\">    <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">el-icon</span>&gt;</span></span><br><span class=\"language-xml\"></span><br><span class=\"language-xml\">    <span class=\"hljs-comment\">&lt;!-- 或者独立使用它，不从父级获取属性 --&gt;</span></span><br><span class=\"language-xml\">    <span class=\"hljs-comment\">&lt;!-- 由于SVG图标默认不携带任何属性，你需要直接提供它们 --&gt;</span></span><br><span class=\"language-xml\">    <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">Edit</span> /&gt;</span></span><br><span class=\"language-xml\">    <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">Edit</span> <span class=\"hljs-attr\">style</span>=<span class=\"hljs-string\">&quot;width: 1em; height: 1em; margin-right: 8px&quot;</span> /&gt;</span></span><br><span class=\"language-xml\">    <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">Share</span> <span class=\"hljs-attr\">style</span>=<span class=\"hljs-string\">&quot;width: 1em; height: 1em; margin-right: 8px&quot;</span> /&gt;</span></span><br><span class=\"language-xml\">  <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">div</span>&gt;</span></span><br>&lt;/template&gt;<br></code></pre></td></tr></table></figure>\n\n<p>但是自定义的图标，我们却没有显示的方式，那么我们就需要一个自定义的组件，来展示自定义的 <code>svg</code> 图标。</p>\n<p>对于这个自定义的组件，它需要拥有两种能力：</p>\n<ul>\n<li>显示外部的 svg 图标（链接的方式）</li>\n<li>显示项目内的 svg 图标</li>\n</ul>\n<p>接下来，我们就来实现自定义组件。</p>\n<h2 id=\"显示外部的-svg-图标\"><a href=\"#显示外部的-svg-图标\" class=\"headerlink\" title=\"显示外部的 svg 图标\"></a>显示外部的 svg 图标</h2><p>css mask:<br>mask 属性允许使用者通过遮罩或者裁切特定区域的图片的方式来 <code>隐藏一个元素的部分</code> 或者 <code>全部可见区域</code>。</p>\n<blockquote>\n<p>css mask: <a href=\"https://juejin.cn/post/6846687594693001223\">https://juejin.cn/post/6846687594693001223</a></p>\n</blockquote>\n<p>接下来，我们定义组件 <code>SvgIcon</code>:</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\">&lt;template&gt;<br>  <span class=\"language-xml\"><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">div</span></span></span><br><span class=\"hljs-tag\"><span class=\"language-xml\">    <span class=\"hljs-attr\">v-if</span>=<span class=\"hljs-string\">&quot;isExternal&quot;</span></span></span><br><span class=\"hljs-tag\"><span class=\"language-xml\">    <span class=\"hljs-attr\">:style</span>=<span class=\"hljs-string\">&quot;styleExternalIcon&quot;</span></span></span><br><span class=\"hljs-tag\"><span class=\"language-xml\">    <span class=\"hljs-attr\">class</span>=<span class=\"hljs-string\">&quot;svg-external-icon svg-icon&quot;</span></span></span><br><span class=\"hljs-tag\"><span class=\"language-xml\">    <span class=\"hljs-attr\">:class</span>=<span class=\"hljs-string\">&quot;className&quot;</span></span></span><br><span class=\"hljs-tag\"><span class=\"language-xml\">  /&gt;</span></span><br>&lt;/template&gt;<br><br><span class=\"language-xml\"><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">script</span> <span class=\"hljs-attr\">setup</span> <span class=\"hljs-attr\">lang</span>=<span class=\"hljs-string\">&quot;ts&quot;</span>&gt;</span><span class=\"language-javascript\"></span></span><br><span class=\"language-javascript\"><span class=\"language-xml\"><span class=\"hljs-keyword\">import</span> &#123; defineProps, computed &#125; <span class=\"hljs-keyword\">from</span> <span class=\"hljs-string\">&#x27;vue&#x27;</span></span></span><br><span class=\"language-javascript\"><span class=\"language-xml\"></span></span><br><span class=\"language-javascript\"><span class=\"language-xml\"><span class=\"hljs-keyword\">const</span> props = <span class=\"hljs-title function_\">withDefaults</span>(defineProps&lt;&#123;</span></span><br><span class=\"language-javascript\"><span class=\"language-xml\">  <span class=\"hljs-attr\">icon</span>: string</span></span><br><span class=\"language-javascript\"><span class=\"language-xml\">  className?: string</span></span><br><span class=\"language-javascript\"><span class=\"language-xml\">&#125;&gt;(), &#123;</span></span><br><span class=\"language-javascript\"><span class=\"language-xml\">  <span class=\"hljs-attr\">className</span>: <span class=\"hljs-string\">&#x27;&#x27;</span>,</span></span><br><span class=\"language-javascript\"><span class=\"language-xml\">  <span class=\"hljs-attr\">icon</span>: <span class=\"hljs-string\">&#x27;&#x27;</span></span></span><br><span class=\"language-javascript\"><span class=\"language-xml\">&#125;)</span></span><br><span class=\"language-javascript\"><span class=\"language-xml\"></span></span><br><span class=\"language-javascript\"><span class=\"language-xml\"><span class=\"hljs-comment\">// 判断是否为外部图标</span></span></span><br><span class=\"language-javascript\"><span class=\"language-xml\"><span class=\"hljs-keyword\">const</span> isExternal = <span class=\"hljs-title function_\">computed</span>(<span class=\"hljs-function\">() =&gt;</span> <span class=\"hljs-regexp\">/^(https?:|mailto:|tel:)/</span>.<span class=\"hljs-title function_\">test</span>(props.<span class=\"hljs-property\">icon</span>))</span></span><br><span class=\"language-javascript\"><span class=\"language-xml\"></span></span><br><span class=\"language-javascript\"><span class=\"language-xml\"><span class=\"hljs-comment\">// 外部图标样式</span></span></span><br><span class=\"language-javascript\"><span class=\"language-xml\"><span class=\"hljs-keyword\">const</span> styleExternalIcon = <span class=\"hljs-title function_\">computed</span>(<span class=\"hljs-function\">() =&gt;</span> (&#123;</span></span><br><span class=\"language-javascript\"><span class=\"language-xml\">  <span class=\"hljs-attr\">mask</span>: <span class=\"hljs-string\">`url(<span class=\"hljs-subst\">$&#123;props.icon&#125;</span>) no-repeat 50% 50%`</span>,</span></span><br><span class=\"language-javascript\"><span class=\"language-xml\">  <span class=\"hljs-string\">&#x27;-webkit-mask&#x27;</span>: <span class=\"hljs-string\">`url(<span class=\"hljs-subst\">$&#123;props.icon&#125;</span>) no-repeat 50% 50%`</span></span></span><br><span class=\"language-javascript\"><span class=\"language-xml\">&#125;))</span></span><br><span class=\"language-javascript\"><span class=\"language-xml\"></span></span><br><span class=\"language-javascript\"><span class=\"language-xml\"></span><span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">script</span>&gt;</span></span><br><span class=\"language-xml\"><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">style</span> <span class=\"hljs-attr\">scoped</span>&gt;</span><span class=\"language-css\"></span></span><br><span class=\"language-css\"><span class=\"language-xml\"><span class=\"hljs-selector-class\">.svg-icon</span> &#123;</span></span><br><span class=\"language-css\"><span class=\"language-xml\">  <span class=\"hljs-attribute\">width</span>: <span class=\"hljs-number\">1em</span>;</span></span><br><span class=\"language-css\"><span class=\"language-xml\">  <span class=\"hljs-attribute\">height</span>: <span class=\"hljs-number\">1em</span>;</span></span><br><span class=\"language-css\"><span class=\"language-xml\">  <span class=\"hljs-attribute\">vertical-align</span>: -<span class=\"hljs-number\">0.15em</span>;</span></span><br><span class=\"language-css\"><span class=\"language-xml\">  fill: currentColor;</span></span><br><span class=\"language-css\"><span class=\"language-xml\">  <span class=\"hljs-attribute\">overflow</span>: hidden;</span></span><br><span class=\"language-css\"><span class=\"language-xml\">&#125;</span></span><br><span class=\"language-css\"><span class=\"language-xml\"></span></span><br><span class=\"language-css\"><span class=\"language-xml\"><span class=\"hljs-selector-class\">.svg-external-icon</span> &#123;</span></span><br><span class=\"language-css\"><span class=\"language-xml\">  <span class=\"hljs-attribute\">background-color</span>: currentColor;</span></span><br><span class=\"language-css\"><span class=\"language-xml\">  <span class=\"hljs-attribute\">mask-size</span>: cover <span class=\"hljs-meta\">!important</span>;</span></span><br><span class=\"language-css\"><span class=\"language-xml\">  <span class=\"hljs-attribute\">display</span>: inline-block;</span></span><br><span class=\"language-css\"><span class=\"language-xml\">&#125;</span></span><br><span class=\"language-css\"><span class=\"language-xml\"></span><span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">style</span>&gt;</span></span><br></code></pre></td></tr></table></figure>\n\n<p>这样，我们就可以通过 <code>链接</code> 的形式，来使用 <code>svg</code> 图标了：</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\">&lt;svg-icon icon=<span class=\"hljs-string\">&quot;https://res.lgdsunday.club/user.svg&quot;</span>&gt;&lt;/svg-icon&gt;<br></code></pre></td></tr></table></figure>\n\n<h2 id=\"展示内部图标\"><a href=\"#展示内部图标\" class=\"headerlink\" title=\"展示内部图标\"></a>展示内部图标</h2><p>如果不是外部链接的话，我们就展示项目内部的 <code>svg</code> 图标。</p>\n<p>通过 use 的 <code>xlink href</code> 属性，找到 body 下已经处理的过的 svg sprite 元素内容，它其中就包含了 <code>symbol</code> 元素，每个 <code>symbol</code> 元素上都有一个 <code>id</code>，这个 id 就是和 <code>xlink:href</code> 与之对应的。</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\"><span class=\"hljs-comment\">// ...</span><br>&lt;svg v-<span class=\"hljs-keyword\">else</span> <span class=\"hljs-keyword\">class</span>=<span class=\"hljs-string\">&quot;svg-icon&quot;</span> :<span class=\"hljs-keyword\">class</span>=<span class=\"hljs-string\">&quot;className&quot;</span> aria-hidden=<span class=\"hljs-string\">&quot;true&quot;</span>&gt;<br>  <span class=\"language-xml\"><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">use</span> <span class=\"hljs-attr\">:xlink:href</span>=<span class=\"hljs-string\">&quot;iconName&quot;</span> /&gt;</span></span><br>&lt;/svg&gt;<br><br><span class=\"hljs-keyword\">const</span> iconName = <span class=\"hljs-title function_\">computed</span>(<span class=\"hljs-function\">() =&gt;</span> <span class=\"hljs-string\">`#icon-<span class=\"hljs-subst\">$&#123;props.icon&#125;</span>`</span>) <span class=\"hljs-comment\">// </span><br></code></pre></td></tr></table></figure>\n\n<p>当我们定义好了组件之后，那么就需要在项目中，导入所有的 svg 图标了。</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\"><span class=\"hljs-comment\">// icons/index.ts</span><br><br><span class=\"hljs-built_in\">require</span>(<span class=\"hljs-string\">&#x27;./svg/user.svg&#x27;</span>)<br><span class=\"hljs-built_in\">require</span>(<span class=\"hljs-string\">&#x27;./svg/password.svg&#x27;</span>)<br></code></pre></td></tr></table></figure>\n\n<p>假设我们有几百上千个 svg 图标，我们都要这样子引入吗？会不会太难受了 ~~</p>\n<p>这里，我们可以使用 webpack 提供的 require.context 方法，来 <code>批量</code> 导入 svg 图标:</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\"><span class=\"hljs-comment\">// https://webpack.docschina.org/guides/dependency-management/#requirecontext</span><br><span class=\"hljs-comment\">// 通过 require.context() 函数来创建自己的 context</span><br><span class=\"hljs-keyword\">const</span> svgRequire = <span class=\"hljs-built_in\">require</span>.<span class=\"hljs-title function_\">context</span>(<span class=\"hljs-string\">&#x27;./svg&#x27;</span>, <span class=\"hljs-literal\">false</span>, <span class=\"hljs-regexp\">/\\.svg$/</span>)<br><span class=\"hljs-comment\">// 此时返回一个 require 的函数，可以接受一个 request 的参数，用于 require 的导入。</span><br><span class=\"hljs-comment\">// 该函数提供了三个属性，可以通过 require.keys() 获取到所有的 svg 图标 [&#x27;./xxx1.svg&#x27;, &#x27;./xxx2.svg&#x27;]</span><br><span class=\"hljs-comment\">// 遍历图标，把图标作为 request 传入到 require 导入函数中，完成本地 svg 图标的导入</span><br><br>svgRequire.<span class=\"hljs-title function_\">keys</span>().<span class=\"hljs-title function_\">forEach</span>(<span class=\"hljs-function\"><span class=\"hljs-params\">svgIcon</span> =&gt;</span> <span class=\"hljs-title function_\">svgRequire</span>(svgIcon))<br></code></pre></td></tr></table></figure>\n\n<p>这样，就完成了所有的本地 <code>svg</code> 图片导入。</p>\n<p>然后我们注册全局的 <code>SvgIcon</code> 组件，方便使用。</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\"><span class=\"hljs-comment\">// icons/index.ts</span><br><br><span class=\"hljs-keyword\">import</span> type &#123; <span class=\"hljs-title class_\">App</span> &#125; <span class=\"hljs-keyword\">from</span> <span class=\"hljs-string\">&#x27;vue&#x27;</span><br><span class=\"hljs-keyword\">import</span> <span class=\"hljs-title class_\">SvgIcon</span> <span class=\"hljs-keyword\">from</span> <span class=\"hljs-string\">&#x27;@/components/SvgIcon/index.vue&#x27;</span><br><br><span class=\"hljs-keyword\">export</span> <span class=\"hljs-keyword\">default</span> (<span class=\"hljs-attr\">app</span>: <span class=\"hljs-title class_\">App</span>): <span class=\"hljs-function\"><span class=\"hljs-params\">void</span> =&gt;</span> &#123;<br>  app.<span class=\"hljs-title function_\">component</span>(<span class=\"hljs-string\">&#x27;svg-icon&#x27;</span>, <span class=\"hljs-title class_\">SvgIcon</span>)<br>&#125;<br></code></pre></td></tr></table></figure>\n\n<p>到这里，我们去页面上使用 <code>&lt;svg-icon icon=&quot;user&quot; /&gt;</code>，发现没有效果，图标展示不出来。</p>\n<p>这是因为，我们虽然在 <code>icons/index.ts</code> 中，通过 <code>require.context</code> 导入了所有的 svg 图片，但是并没有做处理，<code>svg-icon</code> 内部的 <code>&lt;use :xlink:href=&quot;#icon-user&quot; /&gt;</code> 找不到任何跟 <code>#icon-user</code> 有关的 svg 图标。</p>\n<p>这里，我们就需要用到 <code>svg-sprite-loader</code> 了。</p>\n<h2 id=\"svg-sprite-loader\"><a href=\"#svg-sprite-loader\" class=\"headerlink\" title=\"svg-sprite-loader\"></a>svg-sprite-loader</h2><p>svg-sprite-loader 的官方解释是：一个用于创建 svg 雪碧图的 Webpack 加载器。这个加载器现在已经被 JetBrains 公司收录和维护了。</p>\n<p>通俗的讲：svg-sprite-loader 会把你引入的 svg 塞到一个个 symbol 中，合成一个大的 svg，最后将这个大的 svg 放入 body 中。symbol 的 id 如果不特别指定，就是你的文件名。在页面上形成这样的元素，下面是导入了本地的 <code>user.svg</code> 和 <code>password.svg</code>：</p>\n<p><img src=\"/img/svg-sprite.png\" alt=\"\"></p>\n<p>我们可以看到，每个 <code>symbol</code> 上，都有一个 <code>id</code> 属性，因为我们在 <code>SvgIcon</code> 中指定了 <code>use</code> 的 <code>:xlink:href</code>，使用时，就能找到页面上对应的图标了。</p>\n<p>接着，我们来配置 <code>svg-sprite-loader</code>，打开 <code>vue.config.js</code>:</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\"><span class=\"hljs-keyword\">const</span> path = <span class=\"hljs-built_in\">require</span>(<span class=\"hljs-string\">&#x27;path&#x27;</span>)<br><br><span class=\"hljs-keyword\">function</span> <span class=\"hljs-title function_\">resolve</span>(<span class=\"hljs-params\">dir</span>) &#123;<br>  <span class=\"hljs-keyword\">return</span> path.<span class=\"hljs-title function_\">join</span>(__dirname, dir)<br>&#125;<br><br><span class=\"hljs-variable language_\">module</span>.<span class=\"hljs-property\">exports</span> = &#123;<br>  <span class=\"hljs-title function_\">chainWebpack</span>(<span class=\"hljs-params\">config</span>) &#123;<br>    <span class=\"hljs-comment\">// 使用了 config.module.rule(&#x27;svg&#x27;) 方法来获取对 SVG 文件的处理规则。</span><br>    <span class=\"hljs-comment\">// 然后，它使用了 exclude 属性来添加一个排除规则，这个规则会排除 resolve(&#x27;src/icons&#x27;) 目录中的所有文件。</span><br>    <span class=\"hljs-comment\">// 最后，它使用了 end 方法来结束这个链式调用。</span><br>    <span class=\"hljs-comment\">// 这段代码的作用是在 Webpack 构建流程中排除 src/icons 目录中的所有 SVG 文件。这意味着 Webpack 在构建时不会处理这些文件。</span><br>    config.<span class=\"hljs-property\">module</span>.<span class=\"hljs-title function_\">rule</span>(<span class=\"hljs-string\">&#x27;svg&#x27;</span>).<span class=\"hljs-property\">exclude</span>.<span class=\"hljs-title function_\">add</span>(<span class=\"hljs-title function_\">resolve</span>(<span class=\"hljs-string\">&#x27;src/icons&#x27;</span>)).<span class=\"hljs-title function_\">end</span>()<br><br>    <span class=\"hljs-comment\">// 使用了 config.module.rule(&#x27;icons&#x27;) 方法来获取对图标文件的处理规则。</span><br>    <span class=\"hljs-comment\">// 然后，它使用了 test 属性来设置这个规则应用于哪些文件，这里使用的是一个正则表达式，表示只有以 .svg 结尾的文件才会被处理。</span><br>    <span class=\"hljs-comment\">// 接着，它使用了 include 属性来添加一个包含规则，这个规则只会包含 resolve(&#x27;src/icons&#x27;) 目录中的文件。</span><br>    <span class=\"hljs-comment\">// 最后，它使用了 use 方法来添加一个新的规则，这个规则使用了 svg-sprite-loader 来处理 SVG 文件。</span><br>    <span class=\"hljs-comment\">// 这段代码的作用是在 Webpack 构建流程中处理 src/icons 目录中的 SVG 文件。</span><br>    <span class=\"hljs-comment\">// 它会使用 svg-sprite-loader 加载器来将这些 SVG 文件转换为可以在浏览器中使用的精灵图（Sprite）。</span><br><br>    config.<span class=\"hljs-property\">module</span><br>      .<span class=\"hljs-title function_\">rule</span>(<span class=\"hljs-string\">&#x27;icons&#x27;</span>)<br>      .<span class=\"hljs-title function_\">test</span>(<span class=\"hljs-regexp\">/\\.svg$/</span>)<br>      .<span class=\"hljs-property\">include</span>.<span class=\"hljs-title function_\">add</span>(<span class=\"hljs-title function_\">resolve</span>(<span class=\"hljs-string\">&#x27;src/icons&#x27;</span>))<br>      .<span class=\"hljs-title function_\">end</span>()<br>      .<span class=\"hljs-title function_\">use</span>(<span class=\"hljs-string\">&#x27;svg-sprite-loader&#x27;</span>)<br>      .<span class=\"hljs-title function_\">loader</span>(<span class=\"hljs-string\">&#x27;svg-sprite-loader&#x27;</span>)<br>      .<span class=\"hljs-title function_\">options</span>(&#123;<br>        <span class=\"hljs-attr\">symbolId</span>: <span class=\"hljs-string\">&#x27;icon-[name]&#x27;</span> <span class=\"hljs-comment\">// 指定精灵的符号 ID 应为 icon-[name]。</span><br>      &#125;)<br>      .<span class=\"hljs-title function_\">end</span>()<br>  &#125;<br>&#125;<br><br></code></pre></td></tr></table></figure>\n\n<p>这两条规则在 webpack 配置中设置了两种不同的方法来处理 SVG 文件：一种用于排除位于 src/icons 目录中的 SVG 文件，另一种用于使用 svg-sprite-loader 处理位于 src/icons 目录中的 SVG 文件。</p>\n<p>到这里，我们就完成了 <code>svg-sprite-loader</code> 的配置，然后重新启动项目，就可以愉快的使用本地的 <code>svg</code> 了。</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\"><br>&lt;svg-icon icon=<span class=\"hljs-string\">&quot;user&quot;</span>&gt;&lt;/svg-icon&gt;<br><br><span class=\"language-xml\"><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">svg-icon</span> <span class=\"hljs-attr\">icon</span>=<span class=\"hljs-string\">&quot;password&quot;</span>&gt;</span><span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">svg-icon</span>&gt;</span></span><br><br></code></pre></td></tr></table></figure>\n\n<p><img src=\"/img/svg-sprite-result.png\" alt=\"\"></p>\n<p>页面上的效果是这样的</p>\n<p><img src=\"/img/login.png\" alt=\"\"></p>\n<h2 id=\"总结\"><a href=\"#总结\" class=\"headerlink\" title=\"总结\"></a>总结</h2><p>经过 <code>svg-sprite-loader</code> 加载之后，不仅可以通过指定 id 的方式引入 icon，而且相比图片引入的方式，最大的优点就在于可以通过给 svg 标签添加 fill 属性来调整 icon 的颜色。</p>\n<p>除此之外，还可以通过给 svg 添加 class 来调整 icon 的样式，虽然说图片引入的方式也能做到，但是如果图片指定宽高与原图的宽高不成比例，就会导致图片的失真，而 svg 不会。即使随意调整 svg 的宽高样式，它也是按照原尺寸进行缩放，达到高保真的效果。</p>\n<p>而且通过<code>svg-sprite-loader</code>的处理后，生成了精灵图，它是一种将多个图标放在一张图片中的技术，可以减少 HTTP 请求数，从而提升网站性能。</p>\n"},{"layout":"Vue3","title":"Vue3的响应式系统","date":"2022-12-22T13:34:30.000Z","banner_img":"/img/vue3.jpg","index_img":"/img/vue3.jpg","excerpt":"响应式系统的作用与实现","_content":"\n# 响应式系统实现\n\n## 响应式基础\n1. 通过 proxy 代理对象，读取属性时触发 get 方法，设置属性时触发 set 方法\n2. 在 get 方法中收集副作用函数，在 set 方法中触发副作用函数\n\n3. 假设有这么一个对象：`{ ok: true, text: 'hello world' }`，注册副作用函数\n```js\n  effect(() => {\n    document.body.innerHTML = obj.ok ? obj.text : 'ok not'\n  })\n```\n\n当 ok 为 true，我们会走 obj.text 的读取逻辑，触发 get 拦截方法。这个时候页面上会显示 `hello world`，当我们将 obj.ok 设置为 false 后，我们会有副作用遗留函数（text的），因为 ok 为 false，永远不会再读取 obj.text 了。\n\n但是，当我们修改 obj.text 时， effect 副作用函数依然会触发，虽然页面上永远是 `ok not`。\n\n\n## 清除不必要的副作用函数\n4. 这时，我们就需要进行 `分支切换和 cleanup` 函数了，通过 cleanup 函数，我们将只收集使用到的 key 的副作用函数，也就是说，当 ok 为false 时，我们不再对 obj.text 进行依赖手机，无论我们如何修改 obj.text，都不会触发 effect 方法。\n\n5. 我们对注册副作用函数，做一些改变，在注册函数内部，定义了一个新的副作用函数方法，这个方法内部执行 删除副作用函数的方法 和真正的副作用函数（设置 document.body 内容）\n\n同时，我们还在 副作用函数 上定义了一个 deps 属性，用来存储与该副作用函数相关联的依赖集合，将来在 `cleanup` 中通过 activeEffect.deps[i] delete effectFn 时，其实，就是将 某个 key 的 deps 中的副作用函数删除了\n\n```js\nfunction effect(fn) {\n\n  function effectFn() {\n    activeEffect = effectFn\n\n    cleanup(effectFn) // 删除所有key 收集到的依赖\n\n    fn() // 重新执行副作用函数，重新收集依赖\n  }\n\n  effectFn.deps = [] \n\n  effectFn()\n}\n```\n\n6. 定义 cleanup 函数，每一次触发 set 方法时，都会先删除所有 key 对应的依赖，然后重新执行 `effectFn` 内部的 `fn` 函数，重新收集依赖\n\n因为 obj.ok = false 了，不会再读取 `obj.text`，所以也就不会再对 obj.text 收集依赖了。\n\n```js\nfunction cleanup(effectFn) {\n\n  for(let i = 0; i < effectFn.deps.length; i++) {\n    const deps = effectFn.deps[i] // Set 集合\n\n    deps.delete(effectFn)\n  }\n\n  effectFn.deps.length = []\n}\n```\n\n\n**注意**\n\n我们删除 effectFn.deps[i] 中的 effectFn，其实就是删除了 'ok、text' 中对应的依赖集合（Set）的副作用函数，因为 effectFn.deps 中存放的集合 和 Map key 对应的 Value 的集合，是同一个集合\n\n删除后，Map 中的所有 value 都是空的 Set\n\n然后执行 `fn` 函数，重新进行读取 obj 属性，进行依赖收集。\n\n\n## 竟然无限循环？\n7. 最后一步，我们还需要改造一下 trigger 函数，否则会造成 `无限循环`\n\n```js\nfunction trigger(target, key) {\n  const depsMap = bucket.get(target)\n\n  if (!depsMap) return\n\n  const effects = depsMap.get(key)\n  const effectsToRun = new Set(effects)\n\n  // effects && effects.forEach(fn => fn())\n  effectsToRun && effectsToRun.forEach(fn => fn())\n}\n```\n\n为什么新建一个 `Set` 集合呢?  `const effectsToRun = new Set(effects)`\n\n因为，我们遍历 effects 时，执行了每一个 `副作用` 函数，当副作用函数执行时，会调用 cleanup 进行清除，实际上就是从 effects 集合中奖当前执行的副作用函数剔除\n\n但是，副作用函数的执行 `fn()` 会触发属性的读取操作，执行 `track`，导致副作用函数重新被收集到依赖中，而对于 effects集合的遍历仍然在执行，从而造成 `无限循环`。\n\n\n**解决办法**就是：根据 effects 重新建立一个集合，进行遍历。\n\n\n## 完整代码\n\n```html\n<!DOCTYPE html>\n<html lang=\"en\">\n<head>\n  <meta charset=\"UTF-8\">\n  <meta http-equiv=\"X-UA-Compatible\" content=\"IE=edge\">\n  <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n  <title>收集 key 的依赖</title>\n</head>\n<body>\n  \n  <script>\n    // 存储被注册的副作用函数\n    let activeEffect;\n\n    const data = {\n      ok: true,\n      text: 'hello world'\n    }\n\n    const bucket = new WeakMap() // target => Map\n\n    const obj = new Proxy(data, {\n      get(target, key) {\n        // 追踪依赖\n        track(target, key)\n        return target[key]\n      },\n      set(target, key, value) {\n        target[key] = value\n        // 触发依赖\n        trigger(target, key)\n      }\n    })\n\n\n    function track(target, key) {\n      if (!activeEffect) return target[key]\n      let depsMap = bucket.get(target)\n\n      if (!depsMap) {\n        bucket.set(target, depsMap = new Map())\n      }\n\n      let deps = depsMap.get(key)\n\n      if (!deps) {\n        depsMap.set(key, deps = new Set())\n      }\n\n      // 添加副作用函数\n      deps.add(activeEffect)\n\n      // deps 存储与该副作用函数相关联的依赖集合\n      // 将来在 cleanup 中通过 activeEffect.deps[i] delete effectFn 时，其实，就是将 deps 中的副作用函数删除了\n      activeEffect.deps.push(deps)\n    }\n\n    function trigger(target, key) {\n      const depsMap = bucket.get(target)\n\n      if (!depsMap) return\n\n      const effects = depsMap.get(key)\n      const effectsToRun = new Set(effects)\n\n      // effects && effects.forEach(fn => fn())\n      effectsToRun && effectsToRun.forEach(fn => fn())\n    }\n\n    function effect(fn) {\n      function effectFn() {\n        activeEffect = effectFn\n\n        cleanup(effectFn)\n        fn()\n      }\n\n      effectFn.deps = [] // 存储所有包含当前副作用函数的依赖 集合，在 get 拦截函数中处理 deps\n\n      effectFn()\n    }\n\n    function cleanup(effectFn) {\n\n      console.log('effectFn ', effectFn.deps)\n      // 我们删除 effectFn.deps[i] 中的 effectFn，其实就是删除了 'xxx'(key) 中对应的依赖集合的副作用函数\n      // effectFn.deps[i] 中，存放的依赖集合，和 Map key 对应的依赖集合，是同一个集合，删除某一项，自然会影响到另一个\n      // 当我们在 trigger 中执行 effects 时，就是执行副作用函数\n      // 这个时候，会执行 cleanup，删除所有的 key 对应的副作用函数，最后执行 fn，重新走 属性的读取逻辑，触发 get 方法，重新收集依赖\n      // 当我们设置 obj.ok = false 后，不会再读取 obj.text 了，从而不会对其 key 收集依赖。\n      for(let i = 0; i < effectFn.deps.length; i++) {\n        const deps = effectFn.deps[i]\n\n        deps.delete(effectFn)\n      }\n\n      effectFn.deps.length = 0\n    }\n\n    effect(() => {\n      console.log(' obj.ok',  obj.ok)\n      // obj.ok = true 会触发 obj 的 get拦截方法，并且通过 track 函数收集到了副作用函数，并且将其存储在 deps 中\n      document.body.innerHTML = obj.ok ? obj.text : 'ok not'\n    })\n\n\n    setTimeout(() => {\n      // obj.text = 'Vue3 Reactive'\n      obj.ok = false\n\n      console.log('bucket ', bucket)\n    }, 1000)\n\n    // setTimeout(() => {\n    //   console.log('执行了')\n    //   obj.text = 'Vue3 Reactive'\n    // }, 3000)\n\n\n  </script>\n</body>\n</html>\n```\n\n\n","source":"_posts/vue3-reactive.md","raw":"---\nlayout: Vue3\ntitle: Vue3的响应式系统\ndate: 2022-12-22 21:34:30\ntags: Reactive,Vue3\nbanner_img: /img/vue3.jpg\nindex_img: /img/vue3.jpg\nexcerpt: 响应式系统的作用与实现\n---\n\n# 响应式系统实现\n\n## 响应式基础\n1. 通过 proxy 代理对象，读取属性时触发 get 方法，设置属性时触发 set 方法\n2. 在 get 方法中收集副作用函数，在 set 方法中触发副作用函数\n\n3. 假设有这么一个对象：`{ ok: true, text: 'hello world' }`，注册副作用函数\n```js\n  effect(() => {\n    document.body.innerHTML = obj.ok ? obj.text : 'ok not'\n  })\n```\n\n当 ok 为 true，我们会走 obj.text 的读取逻辑，触发 get 拦截方法。这个时候页面上会显示 `hello world`，当我们将 obj.ok 设置为 false 后，我们会有副作用遗留函数（text的），因为 ok 为 false，永远不会再读取 obj.text 了。\n\n但是，当我们修改 obj.text 时， effect 副作用函数依然会触发，虽然页面上永远是 `ok not`。\n\n\n## 清除不必要的副作用函数\n4. 这时，我们就需要进行 `分支切换和 cleanup` 函数了，通过 cleanup 函数，我们将只收集使用到的 key 的副作用函数，也就是说，当 ok 为false 时，我们不再对 obj.text 进行依赖手机，无论我们如何修改 obj.text，都不会触发 effect 方法。\n\n5. 我们对注册副作用函数，做一些改变，在注册函数内部，定义了一个新的副作用函数方法，这个方法内部执行 删除副作用函数的方法 和真正的副作用函数（设置 document.body 内容）\n\n同时，我们还在 副作用函数 上定义了一个 deps 属性，用来存储与该副作用函数相关联的依赖集合，将来在 `cleanup` 中通过 activeEffect.deps[i] delete effectFn 时，其实，就是将 某个 key 的 deps 中的副作用函数删除了\n\n```js\nfunction effect(fn) {\n\n  function effectFn() {\n    activeEffect = effectFn\n\n    cleanup(effectFn) // 删除所有key 收集到的依赖\n\n    fn() // 重新执行副作用函数，重新收集依赖\n  }\n\n  effectFn.deps = [] \n\n  effectFn()\n}\n```\n\n6. 定义 cleanup 函数，每一次触发 set 方法时，都会先删除所有 key 对应的依赖，然后重新执行 `effectFn` 内部的 `fn` 函数，重新收集依赖\n\n因为 obj.ok = false 了，不会再读取 `obj.text`，所以也就不会再对 obj.text 收集依赖了。\n\n```js\nfunction cleanup(effectFn) {\n\n  for(let i = 0; i < effectFn.deps.length; i++) {\n    const deps = effectFn.deps[i] // Set 集合\n\n    deps.delete(effectFn)\n  }\n\n  effectFn.deps.length = []\n}\n```\n\n\n**注意**\n\n我们删除 effectFn.deps[i] 中的 effectFn，其实就是删除了 'ok、text' 中对应的依赖集合（Set）的副作用函数，因为 effectFn.deps 中存放的集合 和 Map key 对应的 Value 的集合，是同一个集合\n\n删除后，Map 中的所有 value 都是空的 Set\n\n然后执行 `fn` 函数，重新进行读取 obj 属性，进行依赖收集。\n\n\n## 竟然无限循环？\n7. 最后一步，我们还需要改造一下 trigger 函数，否则会造成 `无限循环`\n\n```js\nfunction trigger(target, key) {\n  const depsMap = bucket.get(target)\n\n  if (!depsMap) return\n\n  const effects = depsMap.get(key)\n  const effectsToRun = new Set(effects)\n\n  // effects && effects.forEach(fn => fn())\n  effectsToRun && effectsToRun.forEach(fn => fn())\n}\n```\n\n为什么新建一个 `Set` 集合呢?  `const effectsToRun = new Set(effects)`\n\n因为，我们遍历 effects 时，执行了每一个 `副作用` 函数，当副作用函数执行时，会调用 cleanup 进行清除，实际上就是从 effects 集合中奖当前执行的副作用函数剔除\n\n但是，副作用函数的执行 `fn()` 会触发属性的读取操作，执行 `track`，导致副作用函数重新被收集到依赖中，而对于 effects集合的遍历仍然在执行，从而造成 `无限循环`。\n\n\n**解决办法**就是：根据 effects 重新建立一个集合，进行遍历。\n\n\n## 完整代码\n\n```html\n<!DOCTYPE html>\n<html lang=\"en\">\n<head>\n  <meta charset=\"UTF-8\">\n  <meta http-equiv=\"X-UA-Compatible\" content=\"IE=edge\">\n  <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n  <title>收集 key 的依赖</title>\n</head>\n<body>\n  \n  <script>\n    // 存储被注册的副作用函数\n    let activeEffect;\n\n    const data = {\n      ok: true,\n      text: 'hello world'\n    }\n\n    const bucket = new WeakMap() // target => Map\n\n    const obj = new Proxy(data, {\n      get(target, key) {\n        // 追踪依赖\n        track(target, key)\n        return target[key]\n      },\n      set(target, key, value) {\n        target[key] = value\n        // 触发依赖\n        trigger(target, key)\n      }\n    })\n\n\n    function track(target, key) {\n      if (!activeEffect) return target[key]\n      let depsMap = bucket.get(target)\n\n      if (!depsMap) {\n        bucket.set(target, depsMap = new Map())\n      }\n\n      let deps = depsMap.get(key)\n\n      if (!deps) {\n        depsMap.set(key, deps = new Set())\n      }\n\n      // 添加副作用函数\n      deps.add(activeEffect)\n\n      // deps 存储与该副作用函数相关联的依赖集合\n      // 将来在 cleanup 中通过 activeEffect.deps[i] delete effectFn 时，其实，就是将 deps 中的副作用函数删除了\n      activeEffect.deps.push(deps)\n    }\n\n    function trigger(target, key) {\n      const depsMap = bucket.get(target)\n\n      if (!depsMap) return\n\n      const effects = depsMap.get(key)\n      const effectsToRun = new Set(effects)\n\n      // effects && effects.forEach(fn => fn())\n      effectsToRun && effectsToRun.forEach(fn => fn())\n    }\n\n    function effect(fn) {\n      function effectFn() {\n        activeEffect = effectFn\n\n        cleanup(effectFn)\n        fn()\n      }\n\n      effectFn.deps = [] // 存储所有包含当前副作用函数的依赖 集合，在 get 拦截函数中处理 deps\n\n      effectFn()\n    }\n\n    function cleanup(effectFn) {\n\n      console.log('effectFn ', effectFn.deps)\n      // 我们删除 effectFn.deps[i] 中的 effectFn，其实就是删除了 'xxx'(key) 中对应的依赖集合的副作用函数\n      // effectFn.deps[i] 中，存放的依赖集合，和 Map key 对应的依赖集合，是同一个集合，删除某一项，自然会影响到另一个\n      // 当我们在 trigger 中执行 effects 时，就是执行副作用函数\n      // 这个时候，会执行 cleanup，删除所有的 key 对应的副作用函数，最后执行 fn，重新走 属性的读取逻辑，触发 get 方法，重新收集依赖\n      // 当我们设置 obj.ok = false 后，不会再读取 obj.text 了，从而不会对其 key 收集依赖。\n      for(let i = 0; i < effectFn.deps.length; i++) {\n        const deps = effectFn.deps[i]\n\n        deps.delete(effectFn)\n      }\n\n      effectFn.deps.length = 0\n    }\n\n    effect(() => {\n      console.log(' obj.ok',  obj.ok)\n      // obj.ok = true 会触发 obj 的 get拦截方法，并且通过 track 函数收集到了副作用函数，并且将其存储在 deps 中\n      document.body.innerHTML = obj.ok ? obj.text : 'ok not'\n    })\n\n\n    setTimeout(() => {\n      // obj.text = 'Vue3 Reactive'\n      obj.ok = false\n\n      console.log('bucket ', bucket)\n    }, 1000)\n\n    // setTimeout(() => {\n    //   console.log('执行了')\n    //   obj.text = 'Vue3 Reactive'\n    // }, 3000)\n\n\n  </script>\n</body>\n</html>\n```\n\n\n","slug":"vue3-reactive","published":1,"updated":"2023-05-12T10:49:20.017Z","comments":1,"photos":[],"link":"","_id":"clhkizgxq00193y0qcpul4shp","content":"<h1 id=\"响应式系统实现\"><a href=\"#响应式系统实现\" class=\"headerlink\" title=\"响应式系统实现\"></a>响应式系统实现</h1><h2 id=\"响应式基础\"><a href=\"#响应式基础\" class=\"headerlink\" title=\"响应式基础\"></a>响应式基础</h2><ol>\n<li><p>通过 proxy 代理对象，读取属性时触发 get 方法，设置属性时触发 set 方法</p>\n</li>\n<li><p>在 get 方法中收集副作用函数，在 set 方法中触发副作用函数</p>\n</li>\n<li><p>假设有这么一个对象：<code>&#123; ok: true, text: &#39;hello world&#39; &#125;</code>，注册副作用函数</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><div class=\"code-wrapper\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></div></td><td class=\"code\"><pre><code class=\"hljs js\"><span class=\"hljs-title function_\">effect</span>(<span class=\"hljs-function\">() =&gt;</span> &#123;<br>  <span class=\"hljs-variable language_\">document</span>.<span class=\"hljs-property\">body</span>.<span class=\"hljs-property\">innerHTML</span> = obj.<span class=\"hljs-property\">ok</span> ? obj.<span class=\"hljs-property\">text</span> : <span class=\"hljs-string\">&#x27;ok not&#x27;</span><br>&#125;)<br></code></pre></td></tr></table></figure>\n\n</li>\n</ol>\n<p>当 ok 为 true，我们会走 obj.text 的读取逻辑，触发 get 拦截方法。这个时候页面上会显示 <code>hello world</code>，当我们将 obj.ok 设置为 false 后，我们会有副作用遗留函数（text的），因为 ok 为 false，永远不会再读取 obj.text 了。</p>\n<p>但是，当我们修改 obj.text 时， effect 副作用函数依然会触发，虽然页面上永远是 <code>ok not</code>。</p>\n<h2 id=\"清除不必要的副作用函数\"><a href=\"#清除不必要的副作用函数\" class=\"headerlink\" title=\"清除不必要的副作用函数\"></a>清除不必要的副作用函数</h2><ol start=\"4\">\n<li><p>这时，我们就需要进行 <code>分支切换和 cleanup</code> 函数了，通过 cleanup 函数，我们将只收集使用到的 key 的副作用函数，也就是说，当 ok 为false 时，我们不再对 obj.text 进行依赖手机，无论我们如何修改 obj.text，都不会触发 effect 方法。</p>\n</li>\n<li><p>我们对注册副作用函数，做一些改变，在注册函数内部，定义了一个新的副作用函数方法，这个方法内部执行 删除副作用函数的方法 和真正的副作用函数（设置 document.body 内容）</p>\n</li>\n</ol>\n<p>同时，我们还在 副作用函数 上定义了一个 deps 属性，用来存储与该副作用函数相关联的依赖集合，将来在 <code>cleanup</code> 中通过 activeEffect.deps[i] delete effectFn 时，其实，就是将 某个 key 的 deps 中的副作用函数删除了</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\"><span class=\"hljs-keyword\">function</span> <span class=\"hljs-title function_\">effect</span>(<span class=\"hljs-params\">fn</span>) &#123;<br><br>  <span class=\"hljs-keyword\">function</span> <span class=\"hljs-title function_\">effectFn</span>(<span class=\"hljs-params\"></span>) &#123;<br>    activeEffect = effectFn<br><br>    <span class=\"hljs-title function_\">cleanup</span>(effectFn) <span class=\"hljs-comment\">// 删除所有key 收集到的依赖</span><br><br>    <span class=\"hljs-title function_\">fn</span>() <span class=\"hljs-comment\">// 重新执行副作用函数，重新收集依赖</span><br>  &#125;<br><br>  effectFn.<span class=\"hljs-property\">deps</span> = [] <br><br>  <span class=\"hljs-title function_\">effectFn</span>()<br>&#125;<br></code></pre></td></tr></table></figure>\n\n<ol start=\"6\">\n<li>定义 cleanup 函数，每一次触发 set 方法时，都会先删除所有 key 对应的依赖，然后重新执行 <code>effectFn</code> 内部的 <code>fn</code> 函数，重新收集依赖</li>\n</ol>\n<p>因为 obj.ok = false 了，不会再读取 <code>obj.text</code>，所以也就不会再对 obj.text 收集依赖了。</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\"><span class=\"hljs-keyword\">function</span> <span class=\"hljs-title function_\">cleanup</span>(<span class=\"hljs-params\">effectFn</span>) &#123;<br><br>  <span class=\"hljs-keyword\">for</span>(<span class=\"hljs-keyword\">let</span> i = <span class=\"hljs-number\">0</span>; i &lt; effectFn.<span class=\"hljs-property\">deps</span>.<span class=\"hljs-property\">length</span>; i++) &#123;<br>    <span class=\"hljs-keyword\">const</span> deps = effectFn.<span class=\"hljs-property\">deps</span>[i] <span class=\"hljs-comment\">// Set 集合</span><br><br>    deps.<span class=\"hljs-title function_\">delete</span>(effectFn)<br>  &#125;<br><br>  effectFn.<span class=\"hljs-property\">deps</span>.<span class=\"hljs-property\">length</span> = []<br>&#125;<br></code></pre></td></tr></table></figure>\n\n\n<p><strong>注意</strong></p>\n<p>我们删除 effectFn.deps[i] 中的 effectFn，其实就是删除了 ‘ok、text’ 中对应的依赖集合（Set）的副作用函数，因为 effectFn.deps 中存放的集合 和 Map key 对应的 Value 的集合，是同一个集合</p>\n<p>删除后，Map 中的所有 value 都是空的 Set</p>\n<p>然后执行 <code>fn</code> 函数，重新进行读取 obj 属性，进行依赖收集。</p>\n<h2 id=\"竟然无限循环？\"><a href=\"#竟然无限循环？\" class=\"headerlink\" title=\"竟然无限循环？\"></a>竟然无限循环？</h2><ol start=\"7\">\n<li>最后一步，我们还需要改造一下 trigger 函数，否则会造成 <code>无限循环</code></li>\n</ol>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\"><span class=\"hljs-keyword\">function</span> <span class=\"hljs-title function_\">trigger</span>(<span class=\"hljs-params\">target, key</span>) &#123;<br>  <span class=\"hljs-keyword\">const</span> depsMap = bucket.<span class=\"hljs-title function_\">get</span>(target)<br><br>  <span class=\"hljs-keyword\">if</span> (!depsMap) <span class=\"hljs-keyword\">return</span><br><br>  <span class=\"hljs-keyword\">const</span> effects = depsMap.<span class=\"hljs-title function_\">get</span>(key)<br>  <span class=\"hljs-keyword\">const</span> effectsToRun = <span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">Set</span>(effects)<br><br>  <span class=\"hljs-comment\">// effects &amp;&amp; effects.forEach(fn =&gt; fn())</span><br>  effectsToRun &amp;&amp; effectsToRun.<span class=\"hljs-title function_\">forEach</span>(<span class=\"hljs-function\"><span class=\"hljs-params\">fn</span> =&gt;</span> <span class=\"hljs-title function_\">fn</span>())<br>&#125;<br></code></pre></td></tr></table></figure>\n\n<p>为什么新建一个 <code>Set</code> 集合呢?  <code>const effectsToRun = new Set(effects)</code></p>\n<p>因为，我们遍历 effects 时，执行了每一个 <code>副作用</code> 函数，当副作用函数执行时，会调用 cleanup 进行清除，实际上就是从 effects 集合中奖当前执行的副作用函数剔除</p>\n<p>但是，副作用函数的执行 <code>fn()</code> 会触发属性的读取操作，执行 <code>track</code>，导致副作用函数重新被收集到依赖中，而对于 effects集合的遍历仍然在执行，从而造成 <code>无限循环</code>。</p>\n<p><strong>解决办法</strong>就是：根据 effects 重新建立一个集合，进行遍历。</p>\n<h2 id=\"完整代码\"><a href=\"#完整代码\" class=\"headerlink\" title=\"完整代码\"></a>完整代码</h2><figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br><span class=\"line\">103</span><br><span class=\"line\">104</span><br><span class=\"line\">105</span><br><span class=\"line\">106</span><br><span class=\"line\">107</span><br><span class=\"line\">108</span><br><span class=\"line\">109</span><br><span class=\"line\">110</span><br><span class=\"line\">111</span><br><span class=\"line\">112</span><br><span class=\"line\">113</span><br><span class=\"line\">114</span><br><span class=\"line\">115</span><br><span class=\"line\">116</span><br><span class=\"line\">117</span><br><span class=\"line\">118</span><br><span class=\"line\">119</span><br><span class=\"line\">120</span><br><span class=\"line\">121</span><br><span class=\"line\">122</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs html\"><span class=\"hljs-meta\">&lt;!DOCTYPE <span class=\"hljs-keyword\">html</span>&gt;</span><br><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">html</span> <span class=\"hljs-attr\">lang</span>=<span class=\"hljs-string\">&quot;en&quot;</span>&gt;</span><br><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">head</span>&gt;</span><br>  <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">meta</span> <span class=\"hljs-attr\">charset</span>=<span class=\"hljs-string\">&quot;UTF-8&quot;</span>&gt;</span><br>  <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">meta</span> <span class=\"hljs-attr\">http-equiv</span>=<span class=\"hljs-string\">&quot;X-UA-Compatible&quot;</span> <span class=\"hljs-attr\">content</span>=<span class=\"hljs-string\">&quot;IE=edge&quot;</span>&gt;</span><br>  <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">meta</span> <span class=\"hljs-attr\">name</span>=<span class=\"hljs-string\">&quot;viewport&quot;</span> <span class=\"hljs-attr\">content</span>=<span class=\"hljs-string\">&quot;width=device-width, initial-scale=1.0&quot;</span>&gt;</span><br>  <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">title</span>&gt;</span>收集 key 的依赖<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">title</span>&gt;</span><br><span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">head</span>&gt;</span><br><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">body</span>&gt;</span><br>  <br>  <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">script</span>&gt;</span><span class=\"language-javascript\"></span><br><span class=\"language-javascript\">    <span class=\"hljs-comment\">// 存储被注册的副作用函数</span></span><br><span class=\"language-javascript\">    <span class=\"hljs-keyword\">let</span> activeEffect;</span><br><span class=\"language-javascript\"></span><br><span class=\"language-javascript\">    <span class=\"hljs-keyword\">const</span> data = &#123;</span><br><span class=\"language-javascript\">      <span class=\"hljs-attr\">ok</span>: <span class=\"hljs-literal\">true</span>,</span><br><span class=\"language-javascript\">      <span class=\"hljs-attr\">text</span>: <span class=\"hljs-string\">&#x27;hello world&#x27;</span></span><br><span class=\"language-javascript\">    &#125;</span><br><span class=\"language-javascript\"></span><br><span class=\"language-javascript\">    <span class=\"hljs-keyword\">const</span> bucket = <span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">WeakMap</span>() <span class=\"hljs-comment\">// target =&gt; Map</span></span><br><span class=\"language-javascript\"></span><br><span class=\"language-javascript\">    <span class=\"hljs-keyword\">const</span> obj = <span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">Proxy</span>(data, &#123;</span><br><span class=\"language-javascript\">      <span class=\"hljs-title function_\">get</span>(<span class=\"hljs-params\">target, key</span>) &#123;</span><br><span class=\"language-javascript\">        <span class=\"hljs-comment\">// 追踪依赖</span></span><br><span class=\"language-javascript\">        <span class=\"hljs-title function_\">track</span>(target, key)</span><br><span class=\"language-javascript\">        <span class=\"hljs-keyword\">return</span> target[key]</span><br><span class=\"language-javascript\">      &#125;,</span><br><span class=\"language-javascript\">      <span class=\"hljs-title function_\">set</span>(<span class=\"hljs-params\">target, key, value</span>) &#123;</span><br><span class=\"language-javascript\">        target[key] = value</span><br><span class=\"language-javascript\">        <span class=\"hljs-comment\">// 触发依赖</span></span><br><span class=\"language-javascript\">        <span class=\"hljs-title function_\">trigger</span>(target, key)</span><br><span class=\"language-javascript\">      &#125;</span><br><span class=\"language-javascript\">    &#125;)</span><br><span class=\"language-javascript\"></span><br><span class=\"language-javascript\"></span><br><span class=\"language-javascript\">    <span class=\"hljs-keyword\">function</span> <span class=\"hljs-title function_\">track</span>(<span class=\"hljs-params\">target, key</span>) &#123;</span><br><span class=\"language-javascript\">      <span class=\"hljs-keyword\">if</span> (!activeEffect) <span class=\"hljs-keyword\">return</span> target[key]</span><br><span class=\"language-javascript\">      <span class=\"hljs-keyword\">let</span> depsMap = bucket.<span class=\"hljs-title function_\">get</span>(target)</span><br><span class=\"language-javascript\"></span><br><span class=\"language-javascript\">      <span class=\"hljs-keyword\">if</span> (!depsMap) &#123;</span><br><span class=\"language-javascript\">        bucket.<span class=\"hljs-title function_\">set</span>(target, depsMap = <span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">Map</span>())</span><br><span class=\"language-javascript\">      &#125;</span><br><span class=\"language-javascript\"></span><br><span class=\"language-javascript\">      <span class=\"hljs-keyword\">let</span> deps = depsMap.<span class=\"hljs-title function_\">get</span>(key)</span><br><span class=\"language-javascript\"></span><br><span class=\"language-javascript\">      <span class=\"hljs-keyword\">if</span> (!deps) &#123;</span><br><span class=\"language-javascript\">        depsMap.<span class=\"hljs-title function_\">set</span>(key, deps = <span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">Set</span>())</span><br><span class=\"language-javascript\">      &#125;</span><br><span class=\"language-javascript\"></span><br><span class=\"language-javascript\">      <span class=\"hljs-comment\">// 添加副作用函数</span></span><br><span class=\"language-javascript\">      deps.<span class=\"hljs-title function_\">add</span>(activeEffect)</span><br><span class=\"language-javascript\"></span><br><span class=\"language-javascript\">      <span class=\"hljs-comment\">// deps 存储与该副作用函数相关联的依赖集合</span></span><br><span class=\"language-javascript\">      <span class=\"hljs-comment\">// 将来在 cleanup 中通过 activeEffect.deps[i] delete effectFn 时，其实，就是将 deps 中的副作用函数删除了</span></span><br><span class=\"language-javascript\">      activeEffect.<span class=\"hljs-property\">deps</span>.<span class=\"hljs-title function_\">push</span>(deps)</span><br><span class=\"language-javascript\">    &#125;</span><br><span class=\"language-javascript\"></span><br><span class=\"language-javascript\">    <span class=\"hljs-keyword\">function</span> <span class=\"hljs-title function_\">trigger</span>(<span class=\"hljs-params\">target, key</span>) &#123;</span><br><span class=\"language-javascript\">      <span class=\"hljs-keyword\">const</span> depsMap = bucket.<span class=\"hljs-title function_\">get</span>(target)</span><br><span class=\"language-javascript\"></span><br><span class=\"language-javascript\">      <span class=\"hljs-keyword\">if</span> (!depsMap) <span class=\"hljs-keyword\">return</span></span><br><span class=\"language-javascript\"></span><br><span class=\"language-javascript\">      <span class=\"hljs-keyword\">const</span> effects = depsMap.<span class=\"hljs-title function_\">get</span>(key)</span><br><span class=\"language-javascript\">      <span class=\"hljs-keyword\">const</span> effectsToRun = <span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">Set</span>(effects)</span><br><span class=\"language-javascript\"></span><br><span class=\"language-javascript\">      <span class=\"hljs-comment\">// effects &amp;&amp; effects.forEach(fn =&gt; fn())</span></span><br><span class=\"language-javascript\">      effectsToRun &amp;&amp; effectsToRun.<span class=\"hljs-title function_\">forEach</span>(<span class=\"hljs-function\"><span class=\"hljs-params\">fn</span> =&gt;</span> <span class=\"hljs-title function_\">fn</span>())</span><br><span class=\"language-javascript\">    &#125;</span><br><span class=\"language-javascript\"></span><br><span class=\"language-javascript\">    <span class=\"hljs-keyword\">function</span> <span class=\"hljs-title function_\">effect</span>(<span class=\"hljs-params\">fn</span>) &#123;</span><br><span class=\"language-javascript\">      <span class=\"hljs-keyword\">function</span> <span class=\"hljs-title function_\">effectFn</span>(<span class=\"hljs-params\"></span>) &#123;</span><br><span class=\"language-javascript\">        activeEffect = effectFn</span><br><span class=\"language-javascript\"></span><br><span class=\"language-javascript\">        <span class=\"hljs-title function_\">cleanup</span>(effectFn)</span><br><span class=\"language-javascript\">        <span class=\"hljs-title function_\">fn</span>()</span><br><span class=\"language-javascript\">      &#125;</span><br><span class=\"language-javascript\"></span><br><span class=\"language-javascript\">      effectFn.<span class=\"hljs-property\">deps</span> = [] <span class=\"hljs-comment\">// 存储所有包含当前副作用函数的依赖 集合，在 get 拦截函数中处理 deps</span></span><br><span class=\"language-javascript\"></span><br><span class=\"language-javascript\">      <span class=\"hljs-title function_\">effectFn</span>()</span><br><span class=\"language-javascript\">    &#125;</span><br><span class=\"language-javascript\"></span><br><span class=\"language-javascript\">    <span class=\"hljs-keyword\">function</span> <span class=\"hljs-title function_\">cleanup</span>(<span class=\"hljs-params\">effectFn</span>) &#123;</span><br><span class=\"language-javascript\"></span><br><span class=\"language-javascript\">      <span class=\"hljs-variable language_\">console</span>.<span class=\"hljs-title function_\">log</span>(<span class=\"hljs-string\">&#x27;effectFn &#x27;</span>, effectFn.<span class=\"hljs-property\">deps</span>)</span><br><span class=\"language-javascript\">      <span class=\"hljs-comment\">// 我们删除 effectFn.deps[i] 中的 effectFn，其实就是删除了 &#x27;xxx&#x27;(key) 中对应的依赖集合的副作用函数</span></span><br><span class=\"language-javascript\">      <span class=\"hljs-comment\">// effectFn.deps[i] 中，存放的依赖集合，和 Map key 对应的依赖集合，是同一个集合，删除某一项，自然会影响到另一个</span></span><br><span class=\"language-javascript\">      <span class=\"hljs-comment\">// 当我们在 trigger 中执行 effects 时，就是执行副作用函数</span></span><br><span class=\"language-javascript\">      <span class=\"hljs-comment\">// 这个时候，会执行 cleanup，删除所有的 key 对应的副作用函数，最后执行 fn，重新走 属性的读取逻辑，触发 get 方法，重新收集依赖</span></span><br><span class=\"language-javascript\">      <span class=\"hljs-comment\">// 当我们设置 obj.ok = false 后，不会再读取 obj.text 了，从而不会对其 key 收集依赖。</span></span><br><span class=\"language-javascript\">      <span class=\"hljs-keyword\">for</span>(<span class=\"hljs-keyword\">let</span> i = <span class=\"hljs-number\">0</span>; i &lt; effectFn.<span class=\"hljs-property\">deps</span>.<span class=\"hljs-property\">length</span>; i++) &#123;</span><br><span class=\"language-javascript\">        <span class=\"hljs-keyword\">const</span> deps = effectFn.<span class=\"hljs-property\">deps</span>[i]</span><br><span class=\"language-javascript\"></span><br><span class=\"language-javascript\">        deps.<span class=\"hljs-title function_\">delete</span>(effectFn)</span><br><span class=\"language-javascript\">      &#125;</span><br><span class=\"language-javascript\"></span><br><span class=\"language-javascript\">      effectFn.<span class=\"hljs-property\">deps</span>.<span class=\"hljs-property\">length</span> = <span class=\"hljs-number\">0</span></span><br><span class=\"language-javascript\">    &#125;</span><br><span class=\"language-javascript\"></span><br><span class=\"language-javascript\">    <span class=\"hljs-title function_\">effect</span>(<span class=\"hljs-function\">() =&gt;</span> &#123;</span><br><span class=\"language-javascript\">      <span class=\"hljs-variable language_\">console</span>.<span class=\"hljs-title function_\">log</span>(<span class=\"hljs-string\">&#x27; obj.ok&#x27;</span>,  obj.<span class=\"hljs-property\">ok</span>)</span><br><span class=\"language-javascript\">      <span class=\"hljs-comment\">// obj.ok = true 会触发 obj 的 get拦截方法，并且通过 track 函数收集到了副作用函数，并且将其存储在 deps 中</span></span><br><span class=\"language-javascript\">      <span class=\"hljs-variable language_\">document</span>.<span class=\"hljs-property\">body</span>.<span class=\"hljs-property\">innerHTML</span> = obj.<span class=\"hljs-property\">ok</span> ? obj.<span class=\"hljs-property\">text</span> : <span class=\"hljs-string\">&#x27;ok not&#x27;</span></span><br><span class=\"language-javascript\">    &#125;)</span><br><span class=\"language-javascript\"></span><br><span class=\"language-javascript\"></span><br><span class=\"language-javascript\">    <span class=\"hljs-built_in\">setTimeout</span>(<span class=\"hljs-function\">() =&gt;</span> &#123;</span><br><span class=\"language-javascript\">      <span class=\"hljs-comment\">// obj.text = &#x27;Vue3 Reactive&#x27;</span></span><br><span class=\"language-javascript\">      obj.<span class=\"hljs-property\">ok</span> = <span class=\"hljs-literal\">false</span></span><br><span class=\"language-javascript\"></span><br><span class=\"language-javascript\">      <span class=\"hljs-variable language_\">console</span>.<span class=\"hljs-title function_\">log</span>(<span class=\"hljs-string\">&#x27;bucket &#x27;</span>, bucket)</span><br><span class=\"language-javascript\">    &#125;, <span class=\"hljs-number\">1000</span>)</span><br><span class=\"language-javascript\"></span><br><span class=\"language-javascript\">    <span class=\"hljs-comment\">// setTimeout(() =&gt; &#123;</span></span><br><span class=\"language-javascript\">    <span class=\"hljs-comment\">//   console.log(&#x27;执行了&#x27;)</span></span><br><span class=\"language-javascript\">    <span class=\"hljs-comment\">//   obj.text = &#x27;Vue3 Reactive&#x27;</span></span><br><span class=\"language-javascript\">    <span class=\"hljs-comment\">// &#125;, 3000)</span></span><br><span class=\"language-javascript\"></span><br><span class=\"language-javascript\"></span><br><span class=\"language-javascript\">  </span><span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">script</span>&gt;</span><br><span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">body</span>&gt;</span><br><span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">html</span>&gt;</span><br></code></pre></td></tr></table></figure>\n\n\n","site":{"data":{}},"wordcount":4593,"more":"<h1 id=\"响应式系统实现\"><a href=\"#响应式系统实现\" class=\"headerlink\" title=\"响应式系统实现\"></a>响应式系统实现</h1><h2 id=\"响应式基础\"><a href=\"#响应式基础\" class=\"headerlink\" title=\"响应式基础\"></a>响应式基础</h2><ol>\n<li><p>通过 proxy 代理对象，读取属性时触发 get 方法，设置属性时触发 set 方法</p>\n</li>\n<li><p>在 get 方法中收集副作用函数，在 set 方法中触发副作用函数</p>\n</li>\n<li><p>假设有这么一个对象：<code>&#123; ok: true, text: &#39;hello world&#39; &#125;</code>，注册副作用函数</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\"><span class=\"hljs-title function_\">effect</span>(<span class=\"hljs-function\">() =&gt;</span> &#123;<br>  <span class=\"hljs-variable language_\">document</span>.<span class=\"hljs-property\">body</span>.<span class=\"hljs-property\">innerHTML</span> = obj.<span class=\"hljs-property\">ok</span> ? obj.<span class=\"hljs-property\">text</span> : <span class=\"hljs-string\">&#x27;ok not&#x27;</span><br>&#125;)<br></code></pre></td></tr></table></figure>\n\n</li>\n</ol>\n<p>当 ok 为 true，我们会走 obj.text 的读取逻辑，触发 get 拦截方法。这个时候页面上会显示 <code>hello world</code>，当我们将 obj.ok 设置为 false 后，我们会有副作用遗留函数（text的），因为 ok 为 false，永远不会再读取 obj.text 了。</p>\n<p>但是，当我们修改 obj.text 时， effect 副作用函数依然会触发，虽然页面上永远是 <code>ok not</code>。</p>\n<h2 id=\"清除不必要的副作用函数\"><a href=\"#清除不必要的副作用函数\" class=\"headerlink\" title=\"清除不必要的副作用函数\"></a>清除不必要的副作用函数</h2><ol start=\"4\">\n<li><p>这时，我们就需要进行 <code>分支切换和 cleanup</code> 函数了，通过 cleanup 函数，我们将只收集使用到的 key 的副作用函数，也就是说，当 ok 为false 时，我们不再对 obj.text 进行依赖手机，无论我们如何修改 obj.text，都不会触发 effect 方法。</p>\n</li>\n<li><p>我们对注册副作用函数，做一些改变，在注册函数内部，定义了一个新的副作用函数方法，这个方法内部执行 删除副作用函数的方法 和真正的副作用函数（设置 document.body 内容）</p>\n</li>\n</ol>\n<p>同时，我们还在 副作用函数 上定义了一个 deps 属性，用来存储与该副作用函数相关联的依赖集合，将来在 <code>cleanup</code> 中通过 activeEffect.deps[i] delete effectFn 时，其实，就是将 某个 key 的 deps 中的副作用函数删除了</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\"><span class=\"hljs-keyword\">function</span> <span class=\"hljs-title function_\">effect</span>(<span class=\"hljs-params\">fn</span>) &#123;<br><br>  <span class=\"hljs-keyword\">function</span> <span class=\"hljs-title function_\">effectFn</span>(<span class=\"hljs-params\"></span>) &#123;<br>    activeEffect = effectFn<br><br>    <span class=\"hljs-title function_\">cleanup</span>(effectFn) <span class=\"hljs-comment\">// 删除所有key 收集到的依赖</span><br><br>    <span class=\"hljs-title function_\">fn</span>() <span class=\"hljs-comment\">// 重新执行副作用函数，重新收集依赖</span><br>  &#125;<br><br>  effectFn.<span class=\"hljs-property\">deps</span> = [] <br><br>  <span class=\"hljs-title function_\">effectFn</span>()<br>&#125;<br></code></pre></td></tr></table></figure>\n\n<ol start=\"6\">\n<li>定义 cleanup 函数，每一次触发 set 方法时，都会先删除所有 key 对应的依赖，然后重新执行 <code>effectFn</code> 内部的 <code>fn</code> 函数，重新收集依赖</li>\n</ol>\n<p>因为 obj.ok = false 了，不会再读取 <code>obj.text</code>，所以也就不会再对 obj.text 收集依赖了。</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\"><span class=\"hljs-keyword\">function</span> <span class=\"hljs-title function_\">cleanup</span>(<span class=\"hljs-params\">effectFn</span>) &#123;<br><br>  <span class=\"hljs-keyword\">for</span>(<span class=\"hljs-keyword\">let</span> i = <span class=\"hljs-number\">0</span>; i &lt; effectFn.<span class=\"hljs-property\">deps</span>.<span class=\"hljs-property\">length</span>; i++) &#123;<br>    <span class=\"hljs-keyword\">const</span> deps = effectFn.<span class=\"hljs-property\">deps</span>[i] <span class=\"hljs-comment\">// Set 集合</span><br><br>    deps.<span class=\"hljs-title function_\">delete</span>(effectFn)<br>  &#125;<br><br>  effectFn.<span class=\"hljs-property\">deps</span>.<span class=\"hljs-property\">length</span> = []<br>&#125;<br></code></pre></td></tr></table></figure>\n\n\n<p><strong>注意</strong></p>\n<p>我们删除 effectFn.deps[i] 中的 effectFn，其实就是删除了 ‘ok、text’ 中对应的依赖集合（Set）的副作用函数，因为 effectFn.deps 中存放的集合 和 Map key 对应的 Value 的集合，是同一个集合</p>\n<p>删除后，Map 中的所有 value 都是空的 Set</p>\n<p>然后执行 <code>fn</code> 函数，重新进行读取 obj 属性，进行依赖收集。</p>\n<h2 id=\"竟然无限循环？\"><a href=\"#竟然无限循环？\" class=\"headerlink\" title=\"竟然无限循环？\"></a>竟然无限循环？</h2><ol start=\"7\">\n<li>最后一步，我们还需要改造一下 trigger 函数，否则会造成 <code>无限循环</code></li>\n</ol>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\"><span class=\"hljs-keyword\">function</span> <span class=\"hljs-title function_\">trigger</span>(<span class=\"hljs-params\">target, key</span>) &#123;<br>  <span class=\"hljs-keyword\">const</span> depsMap = bucket.<span class=\"hljs-title function_\">get</span>(target)<br><br>  <span class=\"hljs-keyword\">if</span> (!depsMap) <span class=\"hljs-keyword\">return</span><br><br>  <span class=\"hljs-keyword\">const</span> effects = depsMap.<span class=\"hljs-title function_\">get</span>(key)<br>  <span class=\"hljs-keyword\">const</span> effectsToRun = <span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">Set</span>(effects)<br><br>  <span class=\"hljs-comment\">// effects &amp;&amp; effects.forEach(fn =&gt; fn())</span><br>  effectsToRun &amp;&amp; effectsToRun.<span class=\"hljs-title function_\">forEach</span>(<span class=\"hljs-function\"><span class=\"hljs-params\">fn</span> =&gt;</span> <span class=\"hljs-title function_\">fn</span>())<br>&#125;<br></code></pre></td></tr></table></figure>\n\n<p>为什么新建一个 <code>Set</code> 集合呢?  <code>const effectsToRun = new Set(effects)</code></p>\n<p>因为，我们遍历 effects 时，执行了每一个 <code>副作用</code> 函数，当副作用函数执行时，会调用 cleanup 进行清除，实际上就是从 effects 集合中奖当前执行的副作用函数剔除</p>\n<p>但是，副作用函数的执行 <code>fn()</code> 会触发属性的读取操作，执行 <code>track</code>，导致副作用函数重新被收集到依赖中，而对于 effects集合的遍历仍然在执行，从而造成 <code>无限循环</code>。</p>\n<p><strong>解决办法</strong>就是：根据 effects 重新建立一个集合，进行遍历。</p>\n<h2 id=\"完整代码\"><a href=\"#完整代码\" class=\"headerlink\" title=\"完整代码\"></a>完整代码</h2><figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br><span class=\"line\">103</span><br><span class=\"line\">104</span><br><span class=\"line\">105</span><br><span class=\"line\">106</span><br><span class=\"line\">107</span><br><span class=\"line\">108</span><br><span class=\"line\">109</span><br><span class=\"line\">110</span><br><span class=\"line\">111</span><br><span class=\"line\">112</span><br><span class=\"line\">113</span><br><span class=\"line\">114</span><br><span class=\"line\">115</span><br><span class=\"line\">116</span><br><span class=\"line\">117</span><br><span class=\"line\">118</span><br><span class=\"line\">119</span><br><span class=\"line\">120</span><br><span class=\"line\">121</span><br><span class=\"line\">122</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs html\"><span class=\"hljs-meta\">&lt;!DOCTYPE <span class=\"hljs-keyword\">html</span>&gt;</span><br><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">html</span> <span class=\"hljs-attr\">lang</span>=<span class=\"hljs-string\">&quot;en&quot;</span>&gt;</span><br><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">head</span>&gt;</span><br>  <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">meta</span> <span class=\"hljs-attr\">charset</span>=<span class=\"hljs-string\">&quot;UTF-8&quot;</span>&gt;</span><br>  <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">meta</span> <span class=\"hljs-attr\">http-equiv</span>=<span class=\"hljs-string\">&quot;X-UA-Compatible&quot;</span> <span class=\"hljs-attr\">content</span>=<span class=\"hljs-string\">&quot;IE=edge&quot;</span>&gt;</span><br>  <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">meta</span> <span class=\"hljs-attr\">name</span>=<span class=\"hljs-string\">&quot;viewport&quot;</span> <span class=\"hljs-attr\">content</span>=<span class=\"hljs-string\">&quot;width=device-width, initial-scale=1.0&quot;</span>&gt;</span><br>  <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">title</span>&gt;</span>收集 key 的依赖<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">title</span>&gt;</span><br><span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">head</span>&gt;</span><br><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">body</span>&gt;</span><br>  <br>  <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">script</span>&gt;</span><span class=\"language-javascript\"></span><br><span class=\"language-javascript\">    <span class=\"hljs-comment\">// 存储被注册的副作用函数</span></span><br><span class=\"language-javascript\">    <span class=\"hljs-keyword\">let</span> activeEffect;</span><br><span class=\"language-javascript\"></span><br><span class=\"language-javascript\">    <span class=\"hljs-keyword\">const</span> data = &#123;</span><br><span class=\"language-javascript\">      <span class=\"hljs-attr\">ok</span>: <span class=\"hljs-literal\">true</span>,</span><br><span class=\"language-javascript\">      <span class=\"hljs-attr\">text</span>: <span class=\"hljs-string\">&#x27;hello world&#x27;</span></span><br><span class=\"language-javascript\">    &#125;</span><br><span class=\"language-javascript\"></span><br><span class=\"language-javascript\">    <span class=\"hljs-keyword\">const</span> bucket = <span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">WeakMap</span>() <span class=\"hljs-comment\">// target =&gt; Map</span></span><br><span class=\"language-javascript\"></span><br><span class=\"language-javascript\">    <span class=\"hljs-keyword\">const</span> obj = <span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">Proxy</span>(data, &#123;</span><br><span class=\"language-javascript\">      <span class=\"hljs-title function_\">get</span>(<span class=\"hljs-params\">target, key</span>) &#123;</span><br><span class=\"language-javascript\">        <span class=\"hljs-comment\">// 追踪依赖</span></span><br><span class=\"language-javascript\">        <span class=\"hljs-title function_\">track</span>(target, key)</span><br><span class=\"language-javascript\">        <span class=\"hljs-keyword\">return</span> target[key]</span><br><span class=\"language-javascript\">      &#125;,</span><br><span class=\"language-javascript\">      <span class=\"hljs-title function_\">set</span>(<span class=\"hljs-params\">target, key, value</span>) &#123;</span><br><span class=\"language-javascript\">        target[key] = value</span><br><span class=\"language-javascript\">        <span class=\"hljs-comment\">// 触发依赖</span></span><br><span class=\"language-javascript\">        <span class=\"hljs-title function_\">trigger</span>(target, key)</span><br><span class=\"language-javascript\">      &#125;</span><br><span class=\"language-javascript\">    &#125;)</span><br><span class=\"language-javascript\"></span><br><span class=\"language-javascript\"></span><br><span class=\"language-javascript\">    <span class=\"hljs-keyword\">function</span> <span class=\"hljs-title function_\">track</span>(<span class=\"hljs-params\">target, key</span>) &#123;</span><br><span class=\"language-javascript\">      <span class=\"hljs-keyword\">if</span> (!activeEffect) <span class=\"hljs-keyword\">return</span> target[key]</span><br><span class=\"language-javascript\">      <span class=\"hljs-keyword\">let</span> depsMap = bucket.<span class=\"hljs-title function_\">get</span>(target)</span><br><span class=\"language-javascript\"></span><br><span class=\"language-javascript\">      <span class=\"hljs-keyword\">if</span> (!depsMap) &#123;</span><br><span class=\"language-javascript\">        bucket.<span class=\"hljs-title function_\">set</span>(target, depsMap = <span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">Map</span>())</span><br><span class=\"language-javascript\">      &#125;</span><br><span class=\"language-javascript\"></span><br><span class=\"language-javascript\">      <span class=\"hljs-keyword\">let</span> deps = depsMap.<span class=\"hljs-title function_\">get</span>(key)</span><br><span class=\"language-javascript\"></span><br><span class=\"language-javascript\">      <span class=\"hljs-keyword\">if</span> (!deps) &#123;</span><br><span class=\"language-javascript\">        depsMap.<span class=\"hljs-title function_\">set</span>(key, deps = <span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">Set</span>())</span><br><span class=\"language-javascript\">      &#125;</span><br><span class=\"language-javascript\"></span><br><span class=\"language-javascript\">      <span class=\"hljs-comment\">// 添加副作用函数</span></span><br><span class=\"language-javascript\">      deps.<span class=\"hljs-title function_\">add</span>(activeEffect)</span><br><span class=\"language-javascript\"></span><br><span class=\"language-javascript\">      <span class=\"hljs-comment\">// deps 存储与该副作用函数相关联的依赖集合</span></span><br><span class=\"language-javascript\">      <span class=\"hljs-comment\">// 将来在 cleanup 中通过 activeEffect.deps[i] delete effectFn 时，其实，就是将 deps 中的副作用函数删除了</span></span><br><span class=\"language-javascript\">      activeEffect.<span class=\"hljs-property\">deps</span>.<span class=\"hljs-title function_\">push</span>(deps)</span><br><span class=\"language-javascript\">    &#125;</span><br><span class=\"language-javascript\"></span><br><span class=\"language-javascript\">    <span class=\"hljs-keyword\">function</span> <span class=\"hljs-title function_\">trigger</span>(<span class=\"hljs-params\">target, key</span>) &#123;</span><br><span class=\"language-javascript\">      <span class=\"hljs-keyword\">const</span> depsMap = bucket.<span class=\"hljs-title function_\">get</span>(target)</span><br><span class=\"language-javascript\"></span><br><span class=\"language-javascript\">      <span class=\"hljs-keyword\">if</span> (!depsMap) <span class=\"hljs-keyword\">return</span></span><br><span class=\"language-javascript\"></span><br><span class=\"language-javascript\">      <span class=\"hljs-keyword\">const</span> effects = depsMap.<span class=\"hljs-title function_\">get</span>(key)</span><br><span class=\"language-javascript\">      <span class=\"hljs-keyword\">const</span> effectsToRun = <span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">Set</span>(effects)</span><br><span class=\"language-javascript\"></span><br><span class=\"language-javascript\">      <span class=\"hljs-comment\">// effects &amp;&amp; effects.forEach(fn =&gt; fn())</span></span><br><span class=\"language-javascript\">      effectsToRun &amp;&amp; effectsToRun.<span class=\"hljs-title function_\">forEach</span>(<span class=\"hljs-function\"><span class=\"hljs-params\">fn</span> =&gt;</span> <span class=\"hljs-title function_\">fn</span>())</span><br><span class=\"language-javascript\">    &#125;</span><br><span class=\"language-javascript\"></span><br><span class=\"language-javascript\">    <span class=\"hljs-keyword\">function</span> <span class=\"hljs-title function_\">effect</span>(<span class=\"hljs-params\">fn</span>) &#123;</span><br><span class=\"language-javascript\">      <span class=\"hljs-keyword\">function</span> <span class=\"hljs-title function_\">effectFn</span>(<span class=\"hljs-params\"></span>) &#123;</span><br><span class=\"language-javascript\">        activeEffect = effectFn</span><br><span class=\"language-javascript\"></span><br><span class=\"language-javascript\">        <span class=\"hljs-title function_\">cleanup</span>(effectFn)</span><br><span class=\"language-javascript\">        <span class=\"hljs-title function_\">fn</span>()</span><br><span class=\"language-javascript\">      &#125;</span><br><span class=\"language-javascript\"></span><br><span class=\"language-javascript\">      effectFn.<span class=\"hljs-property\">deps</span> = [] <span class=\"hljs-comment\">// 存储所有包含当前副作用函数的依赖 集合，在 get 拦截函数中处理 deps</span></span><br><span class=\"language-javascript\"></span><br><span class=\"language-javascript\">      <span class=\"hljs-title function_\">effectFn</span>()</span><br><span class=\"language-javascript\">    &#125;</span><br><span class=\"language-javascript\"></span><br><span class=\"language-javascript\">    <span class=\"hljs-keyword\">function</span> <span class=\"hljs-title function_\">cleanup</span>(<span class=\"hljs-params\">effectFn</span>) &#123;</span><br><span class=\"language-javascript\"></span><br><span class=\"language-javascript\">      <span class=\"hljs-variable language_\">console</span>.<span class=\"hljs-title function_\">log</span>(<span class=\"hljs-string\">&#x27;effectFn &#x27;</span>, effectFn.<span class=\"hljs-property\">deps</span>)</span><br><span class=\"language-javascript\">      <span class=\"hljs-comment\">// 我们删除 effectFn.deps[i] 中的 effectFn，其实就是删除了 &#x27;xxx&#x27;(key) 中对应的依赖集合的副作用函数</span></span><br><span class=\"language-javascript\">      <span class=\"hljs-comment\">// effectFn.deps[i] 中，存放的依赖集合，和 Map key 对应的依赖集合，是同一个集合，删除某一项，自然会影响到另一个</span></span><br><span class=\"language-javascript\">      <span class=\"hljs-comment\">// 当我们在 trigger 中执行 effects 时，就是执行副作用函数</span></span><br><span class=\"language-javascript\">      <span class=\"hljs-comment\">// 这个时候，会执行 cleanup，删除所有的 key 对应的副作用函数，最后执行 fn，重新走 属性的读取逻辑，触发 get 方法，重新收集依赖</span></span><br><span class=\"language-javascript\">      <span class=\"hljs-comment\">// 当我们设置 obj.ok = false 后，不会再读取 obj.text 了，从而不会对其 key 收集依赖。</span></span><br><span class=\"language-javascript\">      <span class=\"hljs-keyword\">for</span>(<span class=\"hljs-keyword\">let</span> i = <span class=\"hljs-number\">0</span>; i &lt; effectFn.<span class=\"hljs-property\">deps</span>.<span class=\"hljs-property\">length</span>; i++) &#123;</span><br><span class=\"language-javascript\">        <span class=\"hljs-keyword\">const</span> deps = effectFn.<span class=\"hljs-property\">deps</span>[i]</span><br><span class=\"language-javascript\"></span><br><span class=\"language-javascript\">        deps.<span class=\"hljs-title function_\">delete</span>(effectFn)</span><br><span class=\"language-javascript\">      &#125;</span><br><span class=\"language-javascript\"></span><br><span class=\"language-javascript\">      effectFn.<span class=\"hljs-property\">deps</span>.<span class=\"hljs-property\">length</span> = <span class=\"hljs-number\">0</span></span><br><span class=\"language-javascript\">    &#125;</span><br><span class=\"language-javascript\"></span><br><span class=\"language-javascript\">    <span class=\"hljs-title function_\">effect</span>(<span class=\"hljs-function\">() =&gt;</span> &#123;</span><br><span class=\"language-javascript\">      <span class=\"hljs-variable language_\">console</span>.<span class=\"hljs-title function_\">log</span>(<span class=\"hljs-string\">&#x27; obj.ok&#x27;</span>,  obj.<span class=\"hljs-property\">ok</span>)</span><br><span class=\"language-javascript\">      <span class=\"hljs-comment\">// obj.ok = true 会触发 obj 的 get拦截方法，并且通过 track 函数收集到了副作用函数，并且将其存储在 deps 中</span></span><br><span class=\"language-javascript\">      <span class=\"hljs-variable language_\">document</span>.<span class=\"hljs-property\">body</span>.<span class=\"hljs-property\">innerHTML</span> = obj.<span class=\"hljs-property\">ok</span> ? obj.<span class=\"hljs-property\">text</span> : <span class=\"hljs-string\">&#x27;ok not&#x27;</span></span><br><span class=\"language-javascript\">    &#125;)</span><br><span class=\"language-javascript\"></span><br><span class=\"language-javascript\"></span><br><span class=\"language-javascript\">    <span class=\"hljs-built_in\">setTimeout</span>(<span class=\"hljs-function\">() =&gt;</span> &#123;</span><br><span class=\"language-javascript\">      <span class=\"hljs-comment\">// obj.text = &#x27;Vue3 Reactive&#x27;</span></span><br><span class=\"language-javascript\">      obj.<span class=\"hljs-property\">ok</span> = <span class=\"hljs-literal\">false</span></span><br><span class=\"language-javascript\"></span><br><span class=\"language-javascript\">      <span class=\"hljs-variable language_\">console</span>.<span class=\"hljs-title function_\">log</span>(<span class=\"hljs-string\">&#x27;bucket &#x27;</span>, bucket)</span><br><span class=\"language-javascript\">    &#125;, <span class=\"hljs-number\">1000</span>)</span><br><span class=\"language-javascript\"></span><br><span class=\"language-javascript\">    <span class=\"hljs-comment\">// setTimeout(() =&gt; &#123;</span></span><br><span class=\"language-javascript\">    <span class=\"hljs-comment\">//   console.log(&#x27;执行了&#x27;)</span></span><br><span class=\"language-javascript\">    <span class=\"hljs-comment\">//   obj.text = &#x27;Vue3 Reactive&#x27;</span></span><br><span class=\"language-javascript\">    <span class=\"hljs-comment\">// &#125;, 3000)</span></span><br><span class=\"language-javascript\"></span><br><span class=\"language-javascript\"></span><br><span class=\"language-javascript\">  </span><span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">script</span>&gt;</span><br><span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">body</span>&gt;</span><br><span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">html</span>&gt;</span><br></code></pre></td></tr></table></figure>\n\n\n"},{"layout":"Web Components","title":"Web Components","date":"2023-01-06T06:25:48.000Z","banner_img":"/img/webcomponents.png","index_img":"/img/webcomponents.png","excerpt":"Web Components","_content":"\n# Web Components\n\n作为开发者，我们都知道尽可能多的重用代码是一个好主意。这对于自定义标记结构来说通常不是那么容易 — 想想复杂的 HTML（以及相关的样式和脚本），有时您不得不写代码来呈现自定义 UI 控件，并且如果您不小心的话，多次使用它们会使您的页面变得一团糟。\n\n## 组成\n\n- Custom elements（自定义元素）\n\n- Shadow DOM（影子 DOM）\n\n- HTML templates（HTML 模板）\n\n## Custom elements（自定义元素）\n允许您定义 custom elements 及其行为，然后可以在您的用户界面中按照需要使用它们。\n\n```js\nclass ShadowElement extends HTMLElement {\n  constructor() {\n    super()\n  }\n\n  connectedCallback() {\n    const mountPoint = document.createElement('div');\n    const shadowRoot = this.attachShadow({ mode: 'open' });\n\n    shadowRoot.appendChild(mountPoint);\n\n    ReactDOM.render(<MyApp />, mountPoint);\n  }\n}\n\n\ncustomElements.define('my-custom-element', ShadowElement);\n```\n\n##  Shadow DOM（影子 DOM）\n有一些 Shadow DOM 特有的术语需要我们了解：\n\n- Shadow host：一个常规 DOM 节点，Shadow DOM 会被附加到这个节点上。\n- Shadow tree：Shadow DOM 内部的 DOM 树。\n- Shadow boundary：Shadow DOM 结束的地方，也是常规 DOM 开始的地方。\n- Shadow root: Shadow tree 的根节点。\n\n![](/img/webcomponents.png)\n\n**基本用法**\n\n```js\nlet shadow = elementRef.attachShadow({mode: 'open'});\nlet shadow = elementRef.attachShadow({mode: 'closed'});\n```\n\nopen 表示可以通过页面内的 JavaScript 方法来获取 Shadow DOM，例如使用 Element.shadowRoot 属性：\n\n```js\nlet myShadowDom = myCustomElem.shadowRoot;\n```\n\n## templates and slots\n\n复用结构，减少使用相同的标记结构。\n\n此元素及其内容不会在 DOM 中呈现，可使用 JavaScript 去引用它。\n\n```js\n<template id=\"my-paragraph\">\n  <p>My paragraph</p>\n</template>\n```\n\n上面的代码不会展示在你的页面中，直到你用 JavaScript 获取它的引用，然后添加到 DOM 中，如下面的代码：\n\n```js\nlet template = document.getElementById('my-paragraph');\nlet templateContent = template.content;\ndocument.body.appendChild(templateContent);\n```\n\n**在 Web Components 中使用模板**\n\n```js\ncustomElements.define('my-paragraph',\n  class extends HTMLElement {\n    constructor() {\n      super();\n      let template = document.getElementById('my-paragraph');\n      let templateContent = template.content;\n\n      const shadowRoot = this.attachShadow({mode: 'open'})\n        .appendChild(templateContent.cloneNode(true));\n  }\n})\n```\n\n**使用槽 (slots) 添加灵活度**\n\n改造 `my-paragraph`\n\n```js\n<p><slot name=\"my-text\">My default text</slot></p>\n```\n\n跟 `Vue` 插槽一样的用法。\n\n```js\n<my-paragraph>\n  <span slot=\"my-text\">Let's have some different text!</span>\n</my-paragraph>\n\n// or\n\n<my-paragraph>\n  <ul slot=\"my-text\">\n    <li>Let's have some different text!</li>\n    <li>In a list!</li>\n  </ul>\n</my-paragraph>\n```\n\n完整示例：\n\n```js\n// html\n\n<body>\n  <h1>template & slot</h1>\n\n  <template id=\"my-paragraph\">\n    <!-- 默认插槽 -->\n    <slot name=\"title\">\n      <h1>Default Title</h1>\n    </slot>\n\n    <slot>default slot</slot>\n    <p>My paragraph</p>\n  </template>\n\n  <my-paragraph>\n    <!-- 使用插槽 -->\n    <h1 slot=\"title\">Slot title</h1>\n  </my-paragraph>\n\n  <hr>\n</body>\n\n\n// js\n\nclass MyParagraph extends HTMLElement {\n  constructor() {\n    super()\n  }\n\n  connectedCallback() {\n    let template = document.getElementById('my-paragraph');\n    let templateContent = template.content;\n\n    this.attachShadow({ mode: 'open' })\n      .appendChild(templateContent.cloneNode(true))\n  }\n}\n\ncustomElements.define('my-paragraph', MyParagraph)\n```\n\n## 组件通信\n\n> Lightning Web Component\n\n在 LWC 中，可以通过实现 CustomEvent 接口进行自定义事件，通过 EventTarget.dispatchEvent() 来分配事件。\n\n**注意：**\n\n定义事件时，不需要在事件名前加 on，因为在使用的时候会默认在名称前使用 on，比如：当我们定义了 click 事件，在 HTML 代码中用 onclick 来调用它\n\n- 父组件\n```js\n// parent comp\nconnectedCallback() {\n  const child = this.shadowRoot.querySelector('child-wc')\n\n  // 1. 通过 DOM 属性传参，会触发子组件的 attributeChangedCallback 钩子\n  child.setAttribute('text', 'Parent changed the Text')\n\n  // 2. 通过组件实例直接修改内部数据（⚠️未获取到）\n  // console.log('??', child)\n\n  // 3. 监听子组件内部定义的事件\n  child.addEventListener('custom-event', ({ detail }) => {\n    console.log('事件触发 ', detail.value);\n  })\n  }\n```\n\n- 子组件\n\n```js\n// child comp\nconnectedCallback() {\n  // 定义事件\n  const event = new CustomEvent('custom-event', {\n    detail: {\n      value: 'child web component'\n    }\n  })\n  this.dispatchEvent(event)\n\n  const btn = this.shadowRoot.querySelector('button')\n  btn.addEventListener('click', () => {\n    // 获取父组件\n    this.getRootNode().host.sayHello('Hello :')\n  })\n}\n```\n\n## 子组件直接调用父组件实例上的方法\n\n```js\n// parent comp\nsayHello(msg) {\n  console.log(msg, this.data)\n}\n\n\n// child comp\nconnectedCallback() {\n  const btn = this.shadowRoot.querySelector('button')\n\n  btn.addEventListener('click', () => {\n    // 获取父组件实例\n    this.getRootNode().host.sayHello('Hello :')\n  })\n}\n```\n\n## 监听组件上属性的变化\n\n```js\n// parent\nconst child = this.shadowRoot.querySelector('child-wc')\n// 1. 通过 DOM 属性传参，会触发子组件的 attributeChangedCallback 钩子\nchild.setAttribute('text', 'Parent changed the Text')\n\n\n\n// child\n// 监听属性变化，必须定静态的 observedAttributes 方法\nstatic get observedAttributes() {\n  return ['text'];\n}\nattributeChangedCallback(name, oldValue, newValue) {\n  console.log('name', name)\n  console.log('oldValue', oldValue)\n  console.log('newValue', newValue)\n}\n```\n\n# web component in ReactJS\n\nReact 和 Web Components 为了解决不同的问题而生。\n\nWeb Components 为可复用组件提供了强大的封装，而 React 则提供了声明式的解决方案，使 DOM 与数据保持同步。\n\n两者旨在互补。作为开发人员，可以自由选择在 Web Components 中使用 React，或者在 React 中使用 Web Components，或者两者共存。\n\n## 问题\n\n> \"react\": \"^16.12.0\"\n\n```js\nclass MyApp extends React.Component {\n  render() {\n  \treturn <span onClick={() => alert('I have been clicked')}>Click me</span>;\n  }\n}\n\nclass ShadowElement extends HTMLElement {\n  constructor() {\n    super()\n  }\n\n  connectedCallback() {\n    const mountPoint = document.createElement('div');\n    const shadowRoot = this.attachShadow({ mode: 'open' });\n\n    shadowRoot.appendChild(mountPoint);\n\n    ReactDOM.render(<MyApp />, mountPoint);\n  }\n}\n\n\ncustomElements.define('my-custom-element', ShadowElement);\n\n\n// 使用\n\n<div className=\"app-main\" onClick={()=> console.log('app main clicked')}>\n  <my-custom-element></my-custom-element>\n</div>\n```\n\n效果图\n\n![](/img/react-v16.gif)\n\n> \"react\": \"^17.0.2\" 及以上版本，已解决此问题。\n\n代码一致，效果图。\n\n![](/img/react-v17.gif)\n\n\n## 解决方案\n\n> Web Components 触发的事件可能无法通过 React 渲染树正确的传递。 你需要在 React 组件中手动添加事件处理器来处理这些事件。\n\nShadow DOM 重定向了 click 事件并将其封装在 shadow 中，将组件内部的所有内容封装在单独的作用域中，并隔离事件。React 并不支持这样的 Shadow DOM，因此事件委托失败，事件无法触发。\n\n这意味着，如果您将带有 click 事件的 React 组件放在 Web 组件中，则点击事件可能不会冒泡到 React 组件中。这是因为事件在 Web 组件的 Shadow DOM 中触发，然后被封装在 Shadow DOM 中，而不会传播到外部组件。\n\n如果您希望在使用 Web 组件时能够触发 React 事件，则可以使用上述方法之一，例如重新绑定事件到实际的 shadow 容器并使用 \"__reactInternalInstances\" 来调度正确的 React 事件。您还可以使用其他方法来解决此问题，例如使用自定义事件或使用事件代理。\n\n\n> https://stackoverflow.com/questions/37866237/click-event-not-firing-when-react-component-in-a-shadow-dom\n\n\n**相关文章：当 Shadow Dom 遇上 React event**\n\n> https://github.com/huruji/blog/issues/104\n\n# 编写组件\n\n> https://juejin.cn/post/7157955953776820254\n>\n> https://juejin.cn/post/7161816035186720781\n>\n> https://quark-design.hellobike.com/#/\n\n# 参考链接\n- [MDN官方文档](https://developer.mozilla.org/zh-CN/docs/Web/Web_Components/Using_templates_and_slots)\n- [WC官方示例](https://github1s.com/mdn/web-components-examples/blob/main/shadow-part/main.js)\n- [基于 Web Components 跨框架组件开发](http://www.xieluping.cn/post/wc/)\n- [Shadow :host 选择器](https://blog.csdn.net/qq_37718797/article/details/122970991)\n\n\n","source":"_posts/web-components.md","raw":"---\nlayout: Web Components\ntitle: Web Components\ndate: 2023-01-06 14:25:48\ntags: 组件\nbanner_img: /img/webcomponents.png\nindex_img: /img/webcomponents.png\nexcerpt: Web Components\n---\n\n# Web Components\n\n作为开发者，我们都知道尽可能多的重用代码是一个好主意。这对于自定义标记结构来说通常不是那么容易 — 想想复杂的 HTML（以及相关的样式和脚本），有时您不得不写代码来呈现自定义 UI 控件，并且如果您不小心的话，多次使用它们会使您的页面变得一团糟。\n\n## 组成\n\n- Custom elements（自定义元素）\n\n- Shadow DOM（影子 DOM）\n\n- HTML templates（HTML 模板）\n\n## Custom elements（自定义元素）\n允许您定义 custom elements 及其行为，然后可以在您的用户界面中按照需要使用它们。\n\n```js\nclass ShadowElement extends HTMLElement {\n  constructor() {\n    super()\n  }\n\n  connectedCallback() {\n    const mountPoint = document.createElement('div');\n    const shadowRoot = this.attachShadow({ mode: 'open' });\n\n    shadowRoot.appendChild(mountPoint);\n\n    ReactDOM.render(<MyApp />, mountPoint);\n  }\n}\n\n\ncustomElements.define('my-custom-element', ShadowElement);\n```\n\n##  Shadow DOM（影子 DOM）\n有一些 Shadow DOM 特有的术语需要我们了解：\n\n- Shadow host：一个常规 DOM 节点，Shadow DOM 会被附加到这个节点上。\n- Shadow tree：Shadow DOM 内部的 DOM 树。\n- Shadow boundary：Shadow DOM 结束的地方，也是常规 DOM 开始的地方。\n- Shadow root: Shadow tree 的根节点。\n\n![](/img/webcomponents.png)\n\n**基本用法**\n\n```js\nlet shadow = elementRef.attachShadow({mode: 'open'});\nlet shadow = elementRef.attachShadow({mode: 'closed'});\n```\n\nopen 表示可以通过页面内的 JavaScript 方法来获取 Shadow DOM，例如使用 Element.shadowRoot 属性：\n\n```js\nlet myShadowDom = myCustomElem.shadowRoot;\n```\n\n## templates and slots\n\n复用结构，减少使用相同的标记结构。\n\n此元素及其内容不会在 DOM 中呈现，可使用 JavaScript 去引用它。\n\n```js\n<template id=\"my-paragraph\">\n  <p>My paragraph</p>\n</template>\n```\n\n上面的代码不会展示在你的页面中，直到你用 JavaScript 获取它的引用，然后添加到 DOM 中，如下面的代码：\n\n```js\nlet template = document.getElementById('my-paragraph');\nlet templateContent = template.content;\ndocument.body.appendChild(templateContent);\n```\n\n**在 Web Components 中使用模板**\n\n```js\ncustomElements.define('my-paragraph',\n  class extends HTMLElement {\n    constructor() {\n      super();\n      let template = document.getElementById('my-paragraph');\n      let templateContent = template.content;\n\n      const shadowRoot = this.attachShadow({mode: 'open'})\n        .appendChild(templateContent.cloneNode(true));\n  }\n})\n```\n\n**使用槽 (slots) 添加灵活度**\n\n改造 `my-paragraph`\n\n```js\n<p><slot name=\"my-text\">My default text</slot></p>\n```\n\n跟 `Vue` 插槽一样的用法。\n\n```js\n<my-paragraph>\n  <span slot=\"my-text\">Let's have some different text!</span>\n</my-paragraph>\n\n// or\n\n<my-paragraph>\n  <ul slot=\"my-text\">\n    <li>Let's have some different text!</li>\n    <li>In a list!</li>\n  </ul>\n</my-paragraph>\n```\n\n完整示例：\n\n```js\n// html\n\n<body>\n  <h1>template & slot</h1>\n\n  <template id=\"my-paragraph\">\n    <!-- 默认插槽 -->\n    <slot name=\"title\">\n      <h1>Default Title</h1>\n    </slot>\n\n    <slot>default slot</slot>\n    <p>My paragraph</p>\n  </template>\n\n  <my-paragraph>\n    <!-- 使用插槽 -->\n    <h1 slot=\"title\">Slot title</h1>\n  </my-paragraph>\n\n  <hr>\n</body>\n\n\n// js\n\nclass MyParagraph extends HTMLElement {\n  constructor() {\n    super()\n  }\n\n  connectedCallback() {\n    let template = document.getElementById('my-paragraph');\n    let templateContent = template.content;\n\n    this.attachShadow({ mode: 'open' })\n      .appendChild(templateContent.cloneNode(true))\n  }\n}\n\ncustomElements.define('my-paragraph', MyParagraph)\n```\n\n## 组件通信\n\n> Lightning Web Component\n\n在 LWC 中，可以通过实现 CustomEvent 接口进行自定义事件，通过 EventTarget.dispatchEvent() 来分配事件。\n\n**注意：**\n\n定义事件时，不需要在事件名前加 on，因为在使用的时候会默认在名称前使用 on，比如：当我们定义了 click 事件，在 HTML 代码中用 onclick 来调用它\n\n- 父组件\n```js\n// parent comp\nconnectedCallback() {\n  const child = this.shadowRoot.querySelector('child-wc')\n\n  // 1. 通过 DOM 属性传参，会触发子组件的 attributeChangedCallback 钩子\n  child.setAttribute('text', 'Parent changed the Text')\n\n  // 2. 通过组件实例直接修改内部数据（⚠️未获取到）\n  // console.log('??', child)\n\n  // 3. 监听子组件内部定义的事件\n  child.addEventListener('custom-event', ({ detail }) => {\n    console.log('事件触发 ', detail.value);\n  })\n  }\n```\n\n- 子组件\n\n```js\n// child comp\nconnectedCallback() {\n  // 定义事件\n  const event = new CustomEvent('custom-event', {\n    detail: {\n      value: 'child web component'\n    }\n  })\n  this.dispatchEvent(event)\n\n  const btn = this.shadowRoot.querySelector('button')\n  btn.addEventListener('click', () => {\n    // 获取父组件\n    this.getRootNode().host.sayHello('Hello :')\n  })\n}\n```\n\n## 子组件直接调用父组件实例上的方法\n\n```js\n// parent comp\nsayHello(msg) {\n  console.log(msg, this.data)\n}\n\n\n// child comp\nconnectedCallback() {\n  const btn = this.shadowRoot.querySelector('button')\n\n  btn.addEventListener('click', () => {\n    // 获取父组件实例\n    this.getRootNode().host.sayHello('Hello :')\n  })\n}\n```\n\n## 监听组件上属性的变化\n\n```js\n// parent\nconst child = this.shadowRoot.querySelector('child-wc')\n// 1. 通过 DOM 属性传参，会触发子组件的 attributeChangedCallback 钩子\nchild.setAttribute('text', 'Parent changed the Text')\n\n\n\n// child\n// 监听属性变化，必须定静态的 observedAttributes 方法\nstatic get observedAttributes() {\n  return ['text'];\n}\nattributeChangedCallback(name, oldValue, newValue) {\n  console.log('name', name)\n  console.log('oldValue', oldValue)\n  console.log('newValue', newValue)\n}\n```\n\n# web component in ReactJS\n\nReact 和 Web Components 为了解决不同的问题而生。\n\nWeb Components 为可复用组件提供了强大的封装，而 React 则提供了声明式的解决方案，使 DOM 与数据保持同步。\n\n两者旨在互补。作为开发人员，可以自由选择在 Web Components 中使用 React，或者在 React 中使用 Web Components，或者两者共存。\n\n## 问题\n\n> \"react\": \"^16.12.0\"\n\n```js\nclass MyApp extends React.Component {\n  render() {\n  \treturn <span onClick={() => alert('I have been clicked')}>Click me</span>;\n  }\n}\n\nclass ShadowElement extends HTMLElement {\n  constructor() {\n    super()\n  }\n\n  connectedCallback() {\n    const mountPoint = document.createElement('div');\n    const shadowRoot = this.attachShadow({ mode: 'open' });\n\n    shadowRoot.appendChild(mountPoint);\n\n    ReactDOM.render(<MyApp />, mountPoint);\n  }\n}\n\n\ncustomElements.define('my-custom-element', ShadowElement);\n\n\n// 使用\n\n<div className=\"app-main\" onClick={()=> console.log('app main clicked')}>\n  <my-custom-element></my-custom-element>\n</div>\n```\n\n效果图\n\n![](/img/react-v16.gif)\n\n> \"react\": \"^17.0.2\" 及以上版本，已解决此问题。\n\n代码一致，效果图。\n\n![](/img/react-v17.gif)\n\n\n## 解决方案\n\n> Web Components 触发的事件可能无法通过 React 渲染树正确的传递。 你需要在 React 组件中手动添加事件处理器来处理这些事件。\n\nShadow DOM 重定向了 click 事件并将其封装在 shadow 中，将组件内部的所有内容封装在单独的作用域中，并隔离事件。React 并不支持这样的 Shadow DOM，因此事件委托失败，事件无法触发。\n\n这意味着，如果您将带有 click 事件的 React 组件放在 Web 组件中，则点击事件可能不会冒泡到 React 组件中。这是因为事件在 Web 组件的 Shadow DOM 中触发，然后被封装在 Shadow DOM 中，而不会传播到外部组件。\n\n如果您希望在使用 Web 组件时能够触发 React 事件，则可以使用上述方法之一，例如重新绑定事件到实际的 shadow 容器并使用 \"__reactInternalInstances\" 来调度正确的 React 事件。您还可以使用其他方法来解决此问题，例如使用自定义事件或使用事件代理。\n\n\n> https://stackoverflow.com/questions/37866237/click-event-not-firing-when-react-component-in-a-shadow-dom\n\n\n**相关文章：当 Shadow Dom 遇上 React event**\n\n> https://github.com/huruji/blog/issues/104\n\n# 编写组件\n\n> https://juejin.cn/post/7157955953776820254\n>\n> https://juejin.cn/post/7161816035186720781\n>\n> https://quark-design.hellobike.com/#/\n\n# 参考链接\n- [MDN官方文档](https://developer.mozilla.org/zh-CN/docs/Web/Web_Components/Using_templates_and_slots)\n- [WC官方示例](https://github1s.com/mdn/web-components-examples/blob/main/shadow-part/main.js)\n- [基于 Web Components 跨框架组件开发](http://www.xieluping.cn/post/wc/)\n- [Shadow :host 选择器](https://blog.csdn.net/qq_37718797/article/details/122970991)\n\n\n","slug":"web-components","published":1,"updated":"2023-05-12T10:49:20.018Z","comments":1,"photos":[],"link":"","_id":"clhkizgxr001c3y0qfwuzb4g5","content":"<h1 id=\"Web-Components\"><a href=\"#Web-Components\" class=\"headerlink\" title=\"Web Components\"></a>Web Components</h1><p>作为开发者，我们都知道尽可能多的重用代码是一个好主意。这对于自定义标记结构来说通常不是那么容易 — 想想复杂的 HTML（以及相关的样式和脚本），有时您不得不写代码来呈现自定义 UI 控件，并且如果您不小心的话，多次使用它们会使您的页面变得一团糟。</p>\n<h2 id=\"组成\"><a href=\"#组成\" class=\"headerlink\" title=\"组成\"></a>组成</h2><ul>\n<li><p>Custom elements（自定义元素）</p>\n</li>\n<li><p>Shadow DOM（影子 DOM）</p>\n</li>\n<li><p>HTML templates（HTML 模板）</p>\n</li>\n</ul>\n<h2 id=\"Custom-elements（自定义元素）\"><a href=\"#Custom-elements（自定义元素）\" class=\"headerlink\" title=\"Custom elements（自定义元素）\"></a>Custom elements（自定义元素）</h2><p>允许您定义 custom elements 及其行为，然后可以在您的用户界面中按照需要使用它们。</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><div class=\"code-wrapper\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br></pre></div></td><td class=\"code\"><pre><code class=\"hljs js\"><span class=\"hljs-keyword\">class</span> <span class=\"hljs-title class_\">ShadowElement</span> <span class=\"hljs-keyword\">extends</span> <span class=\"hljs-title class_ inherited__\">HTMLElement</span> &#123;<br>  <span class=\"hljs-title function_\">constructor</span>(<span class=\"hljs-params\"></span>) &#123;<br>    <span class=\"hljs-variable language_\">super</span>()<br>  &#125;<br><br>  <span class=\"hljs-title function_\">connectedCallback</span>(<span class=\"hljs-params\"></span>) &#123;<br>    <span class=\"hljs-keyword\">const</span> mountPoint = <span class=\"hljs-variable language_\">document</span>.<span class=\"hljs-title function_\">createElement</span>(<span class=\"hljs-string\">&#x27;div&#x27;</span>);<br>    <span class=\"hljs-keyword\">const</span> shadowRoot = <span class=\"hljs-variable language_\">this</span>.<span class=\"hljs-title function_\">attachShadow</span>(&#123; <span class=\"hljs-attr\">mode</span>: <span class=\"hljs-string\">&#x27;open&#x27;</span> &#125;);<br><br>    shadowRoot.<span class=\"hljs-title function_\">appendChild</span>(mountPoint);<br><br>    <span class=\"hljs-title class_\">ReactDOM</span>.<span class=\"hljs-title function_\">render</span>(<span class=\"language-xml\"><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">MyApp</span> /&gt;</span></span>, mountPoint);<br>  &#125;<br>&#125;<br><br><br>customElements.<span class=\"hljs-title function_\">define</span>(<span class=\"hljs-string\">&#x27;my-custom-element&#x27;</span>, <span class=\"hljs-title class_\">ShadowElement</span>);<br></code></pre></td></tr></table></figure>\n\n<h2 id=\"Shadow-DOM（影子-DOM）\"><a href=\"#Shadow-DOM（影子-DOM）\" class=\"headerlink\" title=\"Shadow DOM（影子 DOM）\"></a>Shadow DOM（影子 DOM）</h2><p>有一些 Shadow DOM 特有的术语需要我们了解：</p>\n<ul>\n<li>Shadow host：一个常规 DOM 节点，Shadow DOM 会被附加到这个节点上。</li>\n<li>Shadow tree：Shadow DOM 内部的 DOM 树。</li>\n<li>Shadow boundary：Shadow DOM 结束的地方，也是常规 DOM 开始的地方。</li>\n<li>Shadow root: Shadow tree 的根节点。</li>\n</ul>\n<p><img src=\"/img/webcomponents.png\" alt=\"\"></p>\n<p><strong>基本用法</strong></p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\"><span class=\"hljs-keyword\">let</span> shadow = elementRef.<span class=\"hljs-title function_\">attachShadow</span>(&#123;<span class=\"hljs-attr\">mode</span>: <span class=\"hljs-string\">&#x27;open&#x27;</span>&#125;);<br><span class=\"hljs-keyword\">let</span> shadow = elementRef.<span class=\"hljs-title function_\">attachShadow</span>(&#123;<span class=\"hljs-attr\">mode</span>: <span class=\"hljs-string\">&#x27;closed&#x27;</span>&#125;);<br></code></pre></td></tr></table></figure>\n\n<p>open 表示可以通过页面内的 JavaScript 方法来获取 Shadow DOM，例如使用 Element.shadowRoot 属性：</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\"><span class=\"hljs-keyword\">let</span> myShadowDom = myCustomElem.<span class=\"hljs-property\">shadowRoot</span>;<br></code></pre></td></tr></table></figure>\n\n<h2 id=\"templates-and-slots\"><a href=\"#templates-and-slots\" class=\"headerlink\" title=\"templates and slots\"></a>templates and slots</h2><p>复用结构，减少使用相同的标记结构。</p>\n<p>此元素及其内容不会在 DOM 中呈现，可使用 JavaScript 去引用它。</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\">&lt;template id=<span class=\"hljs-string\">&quot;my-paragraph&quot;</span>&gt;<br>  <span class=\"language-xml\"><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">p</span>&gt;</span>My paragraph<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">p</span>&gt;</span></span><br>&lt;/template&gt;<br></code></pre></td></tr></table></figure>\n\n<p>上面的代码不会展示在你的页面中，直到你用 JavaScript 获取它的引用，然后添加到 DOM 中，如下面的代码：</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\"><span class=\"hljs-keyword\">let</span> template = <span class=\"hljs-variable language_\">document</span>.<span class=\"hljs-title function_\">getElementById</span>(<span class=\"hljs-string\">&#x27;my-paragraph&#x27;</span>);<br><span class=\"hljs-keyword\">let</span> templateContent = template.<span class=\"hljs-property\">content</span>;<br><span class=\"hljs-variable language_\">document</span>.<span class=\"hljs-property\">body</span>.<span class=\"hljs-title function_\">appendChild</span>(templateContent);<br></code></pre></td></tr></table></figure>\n\n<p><strong>在 Web Components 中使用模板</strong></p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\">customElements.<span class=\"hljs-title function_\">define</span>(<span class=\"hljs-string\">&#x27;my-paragraph&#x27;</span>,<br>  <span class=\"hljs-keyword\">class</span> <span class=\"hljs-title class_\">extends</span> <span class=\"hljs-title class_\">HTMLElement</span> &#123;<br>    <span class=\"hljs-title function_\">constructor</span>(<span class=\"hljs-params\"></span>) &#123;<br>      <span class=\"hljs-variable language_\">super</span>();<br>      <span class=\"hljs-keyword\">let</span> template = <span class=\"hljs-variable language_\">document</span>.<span class=\"hljs-title function_\">getElementById</span>(<span class=\"hljs-string\">&#x27;my-paragraph&#x27;</span>);<br>      <span class=\"hljs-keyword\">let</span> templateContent = template.<span class=\"hljs-property\">content</span>;<br><br>      <span class=\"hljs-keyword\">const</span> shadowRoot = <span class=\"hljs-variable language_\">this</span>.<span class=\"hljs-title function_\">attachShadow</span>(&#123;<span class=\"hljs-attr\">mode</span>: <span class=\"hljs-string\">&#x27;open&#x27;</span>&#125;)<br>        .<span class=\"hljs-title function_\">appendChild</span>(templateContent.<span class=\"hljs-title function_\">cloneNode</span>(<span class=\"hljs-literal\">true</span>));<br>  &#125;<br>&#125;)<br></code></pre></td></tr></table></figure>\n\n<p><strong>使用槽 (slots) 添加灵活度</strong></p>\n<p>改造 <code>my-paragraph</code></p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\">&lt;p&gt;<span class=\"language-xml\"><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">slot</span> <span class=\"hljs-attr\">name</span>=<span class=\"hljs-string\">&quot;my-text&quot;</span>&gt;</span>My default text<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">slot</span>&gt;</span></span>&lt;/p&gt;<br></code></pre></td></tr></table></figure>\n\n<p>跟 <code>Vue</code> 插槽一样的用法。</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\">&lt;my-paragraph&gt;<br>  <span class=\"language-xml\"><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">span</span> <span class=\"hljs-attr\">slot</span>=<span class=\"hljs-string\">&quot;my-text&quot;</span>&gt;</span>Let&#x27;s have some different text!<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">span</span>&gt;</span></span><br>&lt;/my-paragraph&gt;<br><br><span class=\"hljs-comment\">// or</span><br><br><span class=\"language-xml\"><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">my-paragraph</span>&gt;</span></span><br><span class=\"language-xml\">  <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">ul</span> <span class=\"hljs-attr\">slot</span>=<span class=\"hljs-string\">&quot;my-text&quot;</span>&gt;</span></span><br><span class=\"language-xml\">    <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">li</span>&gt;</span>Let&#x27;s have some different text!<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">li</span>&gt;</span></span><br><span class=\"language-xml\">    <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">li</span>&gt;</span>In a list!<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">li</span>&gt;</span></span><br><span class=\"language-xml\">  <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">ul</span>&gt;</span></span><br><span class=\"language-xml\"><span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">my-paragraph</span>&gt;</span></span><br></code></pre></td></tr></table></figure>\n\n<p>完整示例：</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\"><span class=\"hljs-comment\">// html</span><br><br>&lt;body&gt;<br>  <span class=\"language-xml\"><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">h1</span>&gt;</span>template &amp; slot<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">h1</span>&gt;</span></span><br><br>  <span class=\"language-xml\"><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">template</span> <span class=\"hljs-attr\">id</span>=<span class=\"hljs-string\">&quot;my-paragraph&quot;</span>&gt;</span></span><br><span class=\"language-xml\">    <span class=\"hljs-comment\">&lt;!-- 默认插槽 --&gt;</span></span><br><span class=\"language-xml\">    <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">slot</span> <span class=\"hljs-attr\">name</span>=<span class=\"hljs-string\">&quot;title&quot;</span>&gt;</span></span><br><span class=\"language-xml\">      <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">h1</span>&gt;</span>Default Title<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">h1</span>&gt;</span></span><br><span class=\"language-xml\">    <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">slot</span>&gt;</span></span><br><span class=\"language-xml\"></span><br><span class=\"language-xml\">    <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">slot</span>&gt;</span>default slot<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">slot</span>&gt;</span></span><br><span class=\"language-xml\">    <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">p</span>&gt;</span>My paragraph<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">p</span>&gt;</span></span><br><span class=\"language-xml\">  <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">template</span>&gt;</span></span><br><br>  <span class=\"language-xml\"><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">my-paragraph</span>&gt;</span></span><br><span class=\"language-xml\">    <span class=\"hljs-comment\">&lt;!-- 使用插槽 --&gt;</span></span><br><span class=\"language-xml\">    <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">h1</span> <span class=\"hljs-attr\">slot</span>=<span class=\"hljs-string\">&quot;title&quot;</span>&gt;</span>Slot title<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">h1</span>&gt;</span></span><br><span class=\"language-xml\">  <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">my-paragraph</span>&gt;</span></span><br><br>  &lt;hr&gt;<br>&lt;/body&gt;<br><br><br><span class=\"hljs-comment\">// js</span><br><br><span class=\"hljs-keyword\">class</span> <span class=\"hljs-title class_\">MyParagraph</span> <span class=\"hljs-keyword\">extends</span> <span class=\"hljs-title class_ inherited__\">HTMLElement</span> &#123;<br>  <span class=\"hljs-title function_\">constructor</span>(<span class=\"hljs-params\"></span>) &#123;<br>    <span class=\"hljs-variable language_\">super</span>()<br>  &#125;<br><br>  <span class=\"hljs-title function_\">connectedCallback</span>(<span class=\"hljs-params\"></span>) &#123;<br>    <span class=\"hljs-keyword\">let</span> template = <span class=\"hljs-variable language_\">document</span>.<span class=\"hljs-title function_\">getElementById</span>(<span class=\"hljs-string\">&#x27;my-paragraph&#x27;</span>);<br>    <span class=\"hljs-keyword\">let</span> templateContent = template.<span class=\"hljs-property\">content</span>;<br><br>    <span class=\"hljs-variable language_\">this</span>.<span class=\"hljs-title function_\">attachShadow</span>(&#123; <span class=\"hljs-attr\">mode</span>: <span class=\"hljs-string\">&#x27;open&#x27;</span> &#125;)<br>      .<span class=\"hljs-title function_\">appendChild</span>(templateContent.<span class=\"hljs-title function_\">cloneNode</span>(<span class=\"hljs-literal\">true</span>))<br>  &#125;<br>&#125;<br><br>customElements.<span class=\"hljs-title function_\">define</span>(<span class=\"hljs-string\">&#x27;my-paragraph&#x27;</span>, <span class=\"hljs-title class_\">MyParagraph</span>)<br></code></pre></td></tr></table></figure>\n\n<h2 id=\"组件通信\"><a href=\"#组件通信\" class=\"headerlink\" title=\"组件通信\"></a>组件通信</h2><blockquote>\n<p>Lightning Web Component</p>\n</blockquote>\n<p>在 LWC 中，可以通过实现 CustomEvent 接口进行自定义事件，通过 EventTarget.dispatchEvent() 来分配事件。</p>\n<p><strong>注意：</strong></p>\n<p>定义事件时，不需要在事件名前加 on，因为在使用的时候会默认在名称前使用 on，比如：当我们定义了 click 事件，在 HTML 代码中用 onclick 来调用它</p>\n<ul>\n<li><p>父组件</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\"><span class=\"hljs-comment\">// parent comp</span><br><span class=\"hljs-title function_\">connectedCallback</span>(<span class=\"hljs-params\"></span>) &#123;<br>  <span class=\"hljs-keyword\">const</span> child = <span class=\"hljs-variable language_\">this</span>.<span class=\"hljs-property\">shadowRoot</span>.<span class=\"hljs-title function_\">querySelector</span>(<span class=\"hljs-string\">&#x27;child-wc&#x27;</span>)<br><br>  <span class=\"hljs-comment\">// 1. 通过 DOM 属性传参，会触发子组件的 attributeChangedCallback 钩子</span><br>  child.<span class=\"hljs-title function_\">setAttribute</span>(<span class=\"hljs-string\">&#x27;text&#x27;</span>, <span class=\"hljs-string\">&#x27;Parent changed the Text&#x27;</span>)<br><br>  <span class=\"hljs-comment\">// 2. 通过组件实例直接修改内部数据（⚠️未获取到）</span><br>  <span class=\"hljs-comment\">// console.log(&#x27;??&#x27;, child)</span><br><br>  <span class=\"hljs-comment\">// 3. 监听子组件内部定义的事件</span><br>  child.<span class=\"hljs-title function_\">addEventListener</span>(<span class=\"hljs-string\">&#x27;custom-event&#x27;</span>, <span class=\"hljs-function\">(<span class=\"hljs-params\">&#123; detail &#125;</span>) =&gt;</span> &#123;<br>    <span class=\"hljs-variable language_\">console</span>.<span class=\"hljs-title function_\">log</span>(<span class=\"hljs-string\">&#x27;事件触发 &#x27;</span>, detail.<span class=\"hljs-property\">value</span>);<br>  &#125;)<br>  &#125;<br></code></pre></td></tr></table></figure>\n</li>\n<li><p>子组件</p>\n</li>\n</ul>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\"><span class=\"hljs-comment\">// child comp</span><br><span class=\"hljs-title function_\">connectedCallback</span>(<span class=\"hljs-params\"></span>) &#123;<br>  <span class=\"hljs-comment\">// 定义事件</span><br>  <span class=\"hljs-keyword\">const</span> event = <span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">CustomEvent</span>(<span class=\"hljs-string\">&#x27;custom-event&#x27;</span>, &#123;<br>    <span class=\"hljs-attr\">detail</span>: &#123;<br>      <span class=\"hljs-attr\">value</span>: <span class=\"hljs-string\">&#x27;child web component&#x27;</span><br>    &#125;<br>  &#125;)<br>  <span class=\"hljs-variable language_\">this</span>.<span class=\"hljs-title function_\">dispatchEvent</span>(event)<br><br>  <span class=\"hljs-keyword\">const</span> btn = <span class=\"hljs-variable language_\">this</span>.<span class=\"hljs-property\">shadowRoot</span>.<span class=\"hljs-title function_\">querySelector</span>(<span class=\"hljs-string\">&#x27;button&#x27;</span>)<br>  btn.<span class=\"hljs-title function_\">addEventListener</span>(<span class=\"hljs-string\">&#x27;click&#x27;</span>, <span class=\"hljs-function\">() =&gt;</span> &#123;<br>    <span class=\"hljs-comment\">// 获取父组件</span><br>    <span class=\"hljs-variable language_\">this</span>.<span class=\"hljs-title function_\">getRootNode</span>().<span class=\"hljs-property\">host</span>.<span class=\"hljs-title function_\">sayHello</span>(<span class=\"hljs-string\">&#x27;Hello :&#x27;</span>)<br>  &#125;)<br>&#125;<br></code></pre></td></tr></table></figure>\n\n<h2 id=\"子组件直接调用父组件实例上的方法\"><a href=\"#子组件直接调用父组件实例上的方法\" class=\"headerlink\" title=\"子组件直接调用父组件实例上的方法\"></a>子组件直接调用父组件实例上的方法</h2><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\"><span class=\"hljs-comment\">// parent comp</span><br><span class=\"hljs-title function_\">sayHello</span>(<span class=\"hljs-params\">msg</span>) &#123;<br>  <span class=\"hljs-variable language_\">console</span>.<span class=\"hljs-title function_\">log</span>(msg, <span class=\"hljs-variable language_\">this</span>.<span class=\"hljs-property\">data</span>)<br>&#125;<br><br><br><span class=\"hljs-comment\">// child comp</span><br><span class=\"hljs-title function_\">connectedCallback</span>(<span class=\"hljs-params\"></span>) &#123;<br>  <span class=\"hljs-keyword\">const</span> btn = <span class=\"hljs-variable language_\">this</span>.<span class=\"hljs-property\">shadowRoot</span>.<span class=\"hljs-title function_\">querySelector</span>(<span class=\"hljs-string\">&#x27;button&#x27;</span>)<br><br>  btn.<span class=\"hljs-title function_\">addEventListener</span>(<span class=\"hljs-string\">&#x27;click&#x27;</span>, <span class=\"hljs-function\">() =&gt;</span> &#123;<br>    <span class=\"hljs-comment\">// 获取父组件实例</span><br>    <span class=\"hljs-variable language_\">this</span>.<span class=\"hljs-title function_\">getRootNode</span>().<span class=\"hljs-property\">host</span>.<span class=\"hljs-title function_\">sayHello</span>(<span class=\"hljs-string\">&#x27;Hello :&#x27;</span>)<br>  &#125;)<br>&#125;<br></code></pre></td></tr></table></figure>\n\n<h2 id=\"监听组件上属性的变化\"><a href=\"#监听组件上属性的变化\" class=\"headerlink\" title=\"监听组件上属性的变化\"></a>监听组件上属性的变化</h2><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\"><span class=\"hljs-comment\">// parent</span><br><span class=\"hljs-keyword\">const</span> child = <span class=\"hljs-variable language_\">this</span>.<span class=\"hljs-property\">shadowRoot</span>.<span class=\"hljs-title function_\">querySelector</span>(<span class=\"hljs-string\">&#x27;child-wc&#x27;</span>)<br><span class=\"hljs-comment\">// 1. 通过 DOM 属性传参，会触发子组件的 attributeChangedCallback 钩子</span><br>child.<span class=\"hljs-title function_\">setAttribute</span>(<span class=\"hljs-string\">&#x27;text&#x27;</span>, <span class=\"hljs-string\">&#x27;Parent changed the Text&#x27;</span>)<br><br><br><br><span class=\"hljs-comment\">// child</span><br><span class=\"hljs-comment\">// 监听属性变化，必须定静态的 observedAttributes 方法</span><br><span class=\"hljs-keyword\">static</span> <span class=\"hljs-keyword\">get</span> <span class=\"hljs-title function_\">observedAttributes</span>() &#123;<br>  <span class=\"hljs-keyword\">return</span> [<span class=\"hljs-string\">&#x27;text&#x27;</span>];<br>&#125;<br><span class=\"hljs-title function_\">attributeChangedCallback</span>(<span class=\"hljs-params\">name, oldValue, newValue</span>) &#123;<br>  <span class=\"hljs-variable language_\">console</span>.<span class=\"hljs-title function_\">log</span>(<span class=\"hljs-string\">&#x27;name&#x27;</span>, name)<br>  <span class=\"hljs-variable language_\">console</span>.<span class=\"hljs-title function_\">log</span>(<span class=\"hljs-string\">&#x27;oldValue&#x27;</span>, oldValue)<br>  <span class=\"hljs-variable language_\">console</span>.<span class=\"hljs-title function_\">log</span>(<span class=\"hljs-string\">&#x27;newValue&#x27;</span>, newValue)<br>&#125;<br></code></pre></td></tr></table></figure>\n\n<h1 id=\"web-component-in-ReactJS\"><a href=\"#web-component-in-ReactJS\" class=\"headerlink\" title=\"web component in ReactJS\"></a>web component in ReactJS</h1><p>React 和 Web Components 为了解决不同的问题而生。</p>\n<p>Web Components 为可复用组件提供了强大的封装，而 React 则提供了声明式的解决方案，使 DOM 与数据保持同步。</p>\n<p>两者旨在互补。作为开发人员，可以自由选择在 Web Components 中使用 React，或者在 React 中使用 Web Components，或者两者共存。</p>\n<h2 id=\"问题\"><a href=\"#问题\" class=\"headerlink\" title=\"问题\"></a>问题</h2><blockquote>\n<p>“react”: “^16.12.0”</p>\n</blockquote>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\"><span class=\"hljs-keyword\">class</span> <span class=\"hljs-title class_\">MyApp</span> <span class=\"hljs-keyword\">extends</span> <span class=\"hljs-title class_ inherited__\">React.Component</span> &#123;<br>  <span class=\"hljs-title function_\">render</span>(<span class=\"hljs-params\"></span>) &#123;<br>  \t<span class=\"hljs-keyword\">return</span> <span class=\"language-xml\"><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">span</span> <span class=\"hljs-attr\">onClick</span>=<span class=\"hljs-string\">&#123;()</span> =&gt;</span> alert(&#x27;I have been clicked&#x27;)&#125;&gt;Click me<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">span</span>&gt;</span></span>;<br>  &#125;<br>&#125;<br><br><span class=\"hljs-keyword\">class</span> <span class=\"hljs-title class_\">ShadowElement</span> <span class=\"hljs-keyword\">extends</span> <span class=\"hljs-title class_ inherited__\">HTMLElement</span> &#123;<br>  <span class=\"hljs-title function_\">constructor</span>(<span class=\"hljs-params\"></span>) &#123;<br>    <span class=\"hljs-variable language_\">super</span>()<br>  &#125;<br><br>  <span class=\"hljs-title function_\">connectedCallback</span>(<span class=\"hljs-params\"></span>) &#123;<br>    <span class=\"hljs-keyword\">const</span> mountPoint = <span class=\"hljs-variable language_\">document</span>.<span class=\"hljs-title function_\">createElement</span>(<span class=\"hljs-string\">&#x27;div&#x27;</span>);<br>    <span class=\"hljs-keyword\">const</span> shadowRoot = <span class=\"hljs-variable language_\">this</span>.<span class=\"hljs-title function_\">attachShadow</span>(&#123; <span class=\"hljs-attr\">mode</span>: <span class=\"hljs-string\">&#x27;open&#x27;</span> &#125;);<br><br>    shadowRoot.<span class=\"hljs-title function_\">appendChild</span>(mountPoint);<br><br>    <span class=\"hljs-title class_\">ReactDOM</span>.<span class=\"hljs-title function_\">render</span>(<span class=\"language-xml\"><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">MyApp</span> /&gt;</span></span>, mountPoint);<br>  &#125;<br>&#125;<br><br><br>customElements.<span class=\"hljs-title function_\">define</span>(<span class=\"hljs-string\">&#x27;my-custom-element&#x27;</span>, <span class=\"hljs-title class_\">ShadowElement</span>);<br><br><br><span class=\"hljs-comment\">// 使用</span><br><br><span class=\"language-xml\"><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">div</span> <span class=\"hljs-attr\">className</span>=<span class=\"hljs-string\">&quot;app-main&quot;</span> <span class=\"hljs-attr\">onClick</span>=<span class=\"hljs-string\">&#123;()</span>=&gt;</span> console.log(&#x27;app main clicked&#x27;)&#125;&gt;</span><br><span class=\"language-xml\">  <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">my-custom-element</span>&gt;</span><span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">my-custom-element</span>&gt;</span></span><br><span class=\"language-xml\"><span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">div</span>&gt;</span></span><br></code></pre></td></tr></table></figure>\n\n<p>效果图</p>\n<p><img src=\"/img/react-v16.gif\" alt=\"\"></p>\n<blockquote>\n<p>“react”: “^17.0.2” 及以上版本，已解决此问题。</p>\n</blockquote>\n<p>代码一致，效果图。</p>\n<p><img src=\"/img/react-v17.gif\" alt=\"\"></p>\n<h2 id=\"解决方案\"><a href=\"#解决方案\" class=\"headerlink\" title=\"解决方案\"></a>解决方案</h2><blockquote>\n<p>Web Components 触发的事件可能无法通过 React 渲染树正确的传递。 你需要在 React 组件中手动添加事件处理器来处理这些事件。</p>\n</blockquote>\n<p>Shadow DOM 重定向了 click 事件并将其封装在 shadow 中，将组件内部的所有内容封装在单独的作用域中，并隔离事件。React 并不支持这样的 Shadow DOM，因此事件委托失败，事件无法触发。</p>\n<p>这意味着，如果您将带有 click 事件的 React 组件放在 Web 组件中，则点击事件可能不会冒泡到 React 组件中。这是因为事件在 Web 组件的 Shadow DOM 中触发，然后被封装在 Shadow DOM 中，而不会传播到外部组件。</p>\n<p>如果您希望在使用 Web 组件时能够触发 React 事件，则可以使用上述方法之一，例如重新绑定事件到实际的 shadow 容器并使用 “__reactInternalInstances” 来调度正确的 React 事件。您还可以使用其他方法来解决此问题，例如使用自定义事件或使用事件代理。</p>\n<blockquote>\n<p><a href=\"https://stackoverflow.com/questions/37866237/click-event-not-firing-when-react-component-in-a-shadow-dom\">https://stackoverflow.com/questions/37866237/click-event-not-firing-when-react-component-in-a-shadow-dom</a></p>\n</blockquote>\n<p><strong>相关文章：当 Shadow Dom 遇上 React event</strong></p>\n<blockquote>\n<p><a href=\"https://github.com/huruji/blog/issues/104\">https://github.com/huruji/blog/issues/104</a></p>\n</blockquote>\n<h1 id=\"编写组件\"><a href=\"#编写组件\" class=\"headerlink\" title=\"编写组件\"></a>编写组件</h1><blockquote>\n<p><a href=\"https://juejin.cn/post/7157955953776820254\">https://juejin.cn/post/7157955953776820254</a></p>\n<p><a href=\"https://juejin.cn/post/7161816035186720781\">https://juejin.cn/post/7161816035186720781</a></p>\n<p><a href=\"https://quark-design.hellobike.com/#/\">https://quark-design.hellobike.com/#/</a></p>\n</blockquote>\n<h1 id=\"参考链接\"><a href=\"#参考链接\" class=\"headerlink\" title=\"参考链接\"></a>参考链接</h1><ul>\n<li><a href=\"https://developer.mozilla.org/zh-CN/docs/Web/Web_Components/Using_templates_and_slots\">MDN官方文档</a></li>\n<li><a href=\"https://github1s.com/mdn/web-components-examples/blob/main/shadow-part/main.js\">WC官方示例</a></li>\n<li><a href=\"http://www.xieluping.cn/post/wc/\">基于 Web Components 跨框架组件开发</a></li>\n<li><a href=\"https://blog.csdn.net/qq_37718797/article/details/122970991\">Shadow :host 选择器</a></li>\n</ul>\n","site":{"data":{}},"wordcount":6727,"more":"<h1 id=\"Web-Components\"><a href=\"#Web-Components\" class=\"headerlink\" title=\"Web Components\"></a>Web Components</h1><p>作为开发者，我们都知道尽可能多的重用代码是一个好主意。这对于自定义标记结构来说通常不是那么容易 — 想想复杂的 HTML（以及相关的样式和脚本），有时您不得不写代码来呈现自定义 UI 控件，并且如果您不小心的话，多次使用它们会使您的页面变得一团糟。</p>\n<h2 id=\"组成\"><a href=\"#组成\" class=\"headerlink\" title=\"组成\"></a>组成</h2><ul>\n<li><p>Custom elements（自定义元素）</p>\n</li>\n<li><p>Shadow DOM（影子 DOM）</p>\n</li>\n<li><p>HTML templates（HTML 模板）</p>\n</li>\n</ul>\n<h2 id=\"Custom-elements（自定义元素）\"><a href=\"#Custom-elements（自定义元素）\" class=\"headerlink\" title=\"Custom elements（自定义元素）\"></a>Custom elements（自定义元素）</h2><p>允许您定义 custom elements 及其行为，然后可以在您的用户界面中按照需要使用它们。</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\"><span class=\"hljs-keyword\">class</span> <span class=\"hljs-title class_\">ShadowElement</span> <span class=\"hljs-keyword\">extends</span> <span class=\"hljs-title class_ inherited__\">HTMLElement</span> &#123;<br>  <span class=\"hljs-title function_\">constructor</span>(<span class=\"hljs-params\"></span>) &#123;<br>    <span class=\"hljs-variable language_\">super</span>()<br>  &#125;<br><br>  <span class=\"hljs-title function_\">connectedCallback</span>(<span class=\"hljs-params\"></span>) &#123;<br>    <span class=\"hljs-keyword\">const</span> mountPoint = <span class=\"hljs-variable language_\">document</span>.<span class=\"hljs-title function_\">createElement</span>(<span class=\"hljs-string\">&#x27;div&#x27;</span>);<br>    <span class=\"hljs-keyword\">const</span> shadowRoot = <span class=\"hljs-variable language_\">this</span>.<span class=\"hljs-title function_\">attachShadow</span>(&#123; <span class=\"hljs-attr\">mode</span>: <span class=\"hljs-string\">&#x27;open&#x27;</span> &#125;);<br><br>    shadowRoot.<span class=\"hljs-title function_\">appendChild</span>(mountPoint);<br><br>    <span class=\"hljs-title class_\">ReactDOM</span>.<span class=\"hljs-title function_\">render</span>(<span class=\"language-xml\"><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">MyApp</span> /&gt;</span></span>, mountPoint);<br>  &#125;<br>&#125;<br><br><br>customElements.<span class=\"hljs-title function_\">define</span>(<span class=\"hljs-string\">&#x27;my-custom-element&#x27;</span>, <span class=\"hljs-title class_\">ShadowElement</span>);<br></code></pre></td></tr></table></figure>\n\n<h2 id=\"Shadow-DOM（影子-DOM）\"><a href=\"#Shadow-DOM（影子-DOM）\" class=\"headerlink\" title=\"Shadow DOM（影子 DOM）\"></a>Shadow DOM（影子 DOM）</h2><p>有一些 Shadow DOM 特有的术语需要我们了解：</p>\n<ul>\n<li>Shadow host：一个常规 DOM 节点，Shadow DOM 会被附加到这个节点上。</li>\n<li>Shadow tree：Shadow DOM 内部的 DOM 树。</li>\n<li>Shadow boundary：Shadow DOM 结束的地方，也是常规 DOM 开始的地方。</li>\n<li>Shadow root: Shadow tree 的根节点。</li>\n</ul>\n<p><img src=\"/img/webcomponents.png\" alt=\"\"></p>\n<p><strong>基本用法</strong></p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\"><span class=\"hljs-keyword\">let</span> shadow = elementRef.<span class=\"hljs-title function_\">attachShadow</span>(&#123;<span class=\"hljs-attr\">mode</span>: <span class=\"hljs-string\">&#x27;open&#x27;</span>&#125;);<br><span class=\"hljs-keyword\">let</span> shadow = elementRef.<span class=\"hljs-title function_\">attachShadow</span>(&#123;<span class=\"hljs-attr\">mode</span>: <span class=\"hljs-string\">&#x27;closed&#x27;</span>&#125;);<br></code></pre></td></tr></table></figure>\n\n<p>open 表示可以通过页面内的 JavaScript 方法来获取 Shadow DOM，例如使用 Element.shadowRoot 属性：</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\"><span class=\"hljs-keyword\">let</span> myShadowDom = myCustomElem.<span class=\"hljs-property\">shadowRoot</span>;<br></code></pre></td></tr></table></figure>\n\n<h2 id=\"templates-and-slots\"><a href=\"#templates-and-slots\" class=\"headerlink\" title=\"templates and slots\"></a>templates and slots</h2><p>复用结构，减少使用相同的标记结构。</p>\n<p>此元素及其内容不会在 DOM 中呈现，可使用 JavaScript 去引用它。</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\">&lt;template id=<span class=\"hljs-string\">&quot;my-paragraph&quot;</span>&gt;<br>  <span class=\"language-xml\"><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">p</span>&gt;</span>My paragraph<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">p</span>&gt;</span></span><br>&lt;/template&gt;<br></code></pre></td></tr></table></figure>\n\n<p>上面的代码不会展示在你的页面中，直到你用 JavaScript 获取它的引用，然后添加到 DOM 中，如下面的代码：</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\"><span class=\"hljs-keyword\">let</span> template = <span class=\"hljs-variable language_\">document</span>.<span class=\"hljs-title function_\">getElementById</span>(<span class=\"hljs-string\">&#x27;my-paragraph&#x27;</span>);<br><span class=\"hljs-keyword\">let</span> templateContent = template.<span class=\"hljs-property\">content</span>;<br><span class=\"hljs-variable language_\">document</span>.<span class=\"hljs-property\">body</span>.<span class=\"hljs-title function_\">appendChild</span>(templateContent);<br></code></pre></td></tr></table></figure>\n\n<p><strong>在 Web Components 中使用模板</strong></p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\">customElements.<span class=\"hljs-title function_\">define</span>(<span class=\"hljs-string\">&#x27;my-paragraph&#x27;</span>,<br>  <span class=\"hljs-keyword\">class</span> <span class=\"hljs-title class_\">extends</span> <span class=\"hljs-title class_\">HTMLElement</span> &#123;<br>    <span class=\"hljs-title function_\">constructor</span>(<span class=\"hljs-params\"></span>) &#123;<br>      <span class=\"hljs-variable language_\">super</span>();<br>      <span class=\"hljs-keyword\">let</span> template = <span class=\"hljs-variable language_\">document</span>.<span class=\"hljs-title function_\">getElementById</span>(<span class=\"hljs-string\">&#x27;my-paragraph&#x27;</span>);<br>      <span class=\"hljs-keyword\">let</span> templateContent = template.<span class=\"hljs-property\">content</span>;<br><br>      <span class=\"hljs-keyword\">const</span> shadowRoot = <span class=\"hljs-variable language_\">this</span>.<span class=\"hljs-title function_\">attachShadow</span>(&#123;<span class=\"hljs-attr\">mode</span>: <span class=\"hljs-string\">&#x27;open&#x27;</span>&#125;)<br>        .<span class=\"hljs-title function_\">appendChild</span>(templateContent.<span class=\"hljs-title function_\">cloneNode</span>(<span class=\"hljs-literal\">true</span>));<br>  &#125;<br>&#125;)<br></code></pre></td></tr></table></figure>\n\n<p><strong>使用槽 (slots) 添加灵活度</strong></p>\n<p>改造 <code>my-paragraph</code></p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\">&lt;p&gt;<span class=\"language-xml\"><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">slot</span> <span class=\"hljs-attr\">name</span>=<span class=\"hljs-string\">&quot;my-text&quot;</span>&gt;</span>My default text<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">slot</span>&gt;</span></span>&lt;/p&gt;<br></code></pre></td></tr></table></figure>\n\n<p>跟 <code>Vue</code> 插槽一样的用法。</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\">&lt;my-paragraph&gt;<br>  <span class=\"language-xml\"><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">span</span> <span class=\"hljs-attr\">slot</span>=<span class=\"hljs-string\">&quot;my-text&quot;</span>&gt;</span>Let&#x27;s have some different text!<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">span</span>&gt;</span></span><br>&lt;/my-paragraph&gt;<br><br><span class=\"hljs-comment\">// or</span><br><br><span class=\"language-xml\"><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">my-paragraph</span>&gt;</span></span><br><span class=\"language-xml\">  <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">ul</span> <span class=\"hljs-attr\">slot</span>=<span class=\"hljs-string\">&quot;my-text&quot;</span>&gt;</span></span><br><span class=\"language-xml\">    <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">li</span>&gt;</span>Let&#x27;s have some different text!<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">li</span>&gt;</span></span><br><span class=\"language-xml\">    <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">li</span>&gt;</span>In a list!<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">li</span>&gt;</span></span><br><span class=\"language-xml\">  <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">ul</span>&gt;</span></span><br><span class=\"language-xml\"><span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">my-paragraph</span>&gt;</span></span><br></code></pre></td></tr></table></figure>\n\n<p>完整示例：</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\"><span class=\"hljs-comment\">// html</span><br><br>&lt;body&gt;<br>  <span class=\"language-xml\"><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">h1</span>&gt;</span>template &amp; slot<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">h1</span>&gt;</span></span><br><br>  <span class=\"language-xml\"><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">template</span> <span class=\"hljs-attr\">id</span>=<span class=\"hljs-string\">&quot;my-paragraph&quot;</span>&gt;</span></span><br><span class=\"language-xml\">    <span class=\"hljs-comment\">&lt;!-- 默认插槽 --&gt;</span></span><br><span class=\"language-xml\">    <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">slot</span> <span class=\"hljs-attr\">name</span>=<span class=\"hljs-string\">&quot;title&quot;</span>&gt;</span></span><br><span class=\"language-xml\">      <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">h1</span>&gt;</span>Default Title<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">h1</span>&gt;</span></span><br><span class=\"language-xml\">    <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">slot</span>&gt;</span></span><br><span class=\"language-xml\"></span><br><span class=\"language-xml\">    <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">slot</span>&gt;</span>default slot<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">slot</span>&gt;</span></span><br><span class=\"language-xml\">    <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">p</span>&gt;</span>My paragraph<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">p</span>&gt;</span></span><br><span class=\"language-xml\">  <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">template</span>&gt;</span></span><br><br>  <span class=\"language-xml\"><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">my-paragraph</span>&gt;</span></span><br><span class=\"language-xml\">    <span class=\"hljs-comment\">&lt;!-- 使用插槽 --&gt;</span></span><br><span class=\"language-xml\">    <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">h1</span> <span class=\"hljs-attr\">slot</span>=<span class=\"hljs-string\">&quot;title&quot;</span>&gt;</span>Slot title<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">h1</span>&gt;</span></span><br><span class=\"language-xml\">  <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">my-paragraph</span>&gt;</span></span><br><br>  &lt;hr&gt;<br>&lt;/body&gt;<br><br><br><span class=\"hljs-comment\">// js</span><br><br><span class=\"hljs-keyword\">class</span> <span class=\"hljs-title class_\">MyParagraph</span> <span class=\"hljs-keyword\">extends</span> <span class=\"hljs-title class_ inherited__\">HTMLElement</span> &#123;<br>  <span class=\"hljs-title function_\">constructor</span>(<span class=\"hljs-params\"></span>) &#123;<br>    <span class=\"hljs-variable language_\">super</span>()<br>  &#125;<br><br>  <span class=\"hljs-title function_\">connectedCallback</span>(<span class=\"hljs-params\"></span>) &#123;<br>    <span class=\"hljs-keyword\">let</span> template = <span class=\"hljs-variable language_\">document</span>.<span class=\"hljs-title function_\">getElementById</span>(<span class=\"hljs-string\">&#x27;my-paragraph&#x27;</span>);<br>    <span class=\"hljs-keyword\">let</span> templateContent = template.<span class=\"hljs-property\">content</span>;<br><br>    <span class=\"hljs-variable language_\">this</span>.<span class=\"hljs-title function_\">attachShadow</span>(&#123; <span class=\"hljs-attr\">mode</span>: <span class=\"hljs-string\">&#x27;open&#x27;</span> &#125;)<br>      .<span class=\"hljs-title function_\">appendChild</span>(templateContent.<span class=\"hljs-title function_\">cloneNode</span>(<span class=\"hljs-literal\">true</span>))<br>  &#125;<br>&#125;<br><br>customElements.<span class=\"hljs-title function_\">define</span>(<span class=\"hljs-string\">&#x27;my-paragraph&#x27;</span>, <span class=\"hljs-title class_\">MyParagraph</span>)<br></code></pre></td></tr></table></figure>\n\n<h2 id=\"组件通信\"><a href=\"#组件通信\" class=\"headerlink\" title=\"组件通信\"></a>组件通信</h2><blockquote>\n<p>Lightning Web Component</p>\n</blockquote>\n<p>在 LWC 中，可以通过实现 CustomEvent 接口进行自定义事件，通过 EventTarget.dispatchEvent() 来分配事件。</p>\n<p><strong>注意：</strong></p>\n<p>定义事件时，不需要在事件名前加 on，因为在使用的时候会默认在名称前使用 on，比如：当我们定义了 click 事件，在 HTML 代码中用 onclick 来调用它</p>\n<ul>\n<li><p>父组件</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\"><span class=\"hljs-comment\">// parent comp</span><br><span class=\"hljs-title function_\">connectedCallback</span>(<span class=\"hljs-params\"></span>) &#123;<br>  <span class=\"hljs-keyword\">const</span> child = <span class=\"hljs-variable language_\">this</span>.<span class=\"hljs-property\">shadowRoot</span>.<span class=\"hljs-title function_\">querySelector</span>(<span class=\"hljs-string\">&#x27;child-wc&#x27;</span>)<br><br>  <span class=\"hljs-comment\">// 1. 通过 DOM 属性传参，会触发子组件的 attributeChangedCallback 钩子</span><br>  child.<span class=\"hljs-title function_\">setAttribute</span>(<span class=\"hljs-string\">&#x27;text&#x27;</span>, <span class=\"hljs-string\">&#x27;Parent changed the Text&#x27;</span>)<br><br>  <span class=\"hljs-comment\">// 2. 通过组件实例直接修改内部数据（⚠️未获取到）</span><br>  <span class=\"hljs-comment\">// console.log(&#x27;??&#x27;, child)</span><br><br>  <span class=\"hljs-comment\">// 3. 监听子组件内部定义的事件</span><br>  child.<span class=\"hljs-title function_\">addEventListener</span>(<span class=\"hljs-string\">&#x27;custom-event&#x27;</span>, <span class=\"hljs-function\">(<span class=\"hljs-params\">&#123; detail &#125;</span>) =&gt;</span> &#123;<br>    <span class=\"hljs-variable language_\">console</span>.<span class=\"hljs-title function_\">log</span>(<span class=\"hljs-string\">&#x27;事件触发 &#x27;</span>, detail.<span class=\"hljs-property\">value</span>);<br>  &#125;)<br>  &#125;<br></code></pre></td></tr></table></figure>\n</li>\n<li><p>子组件</p>\n</li>\n</ul>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\"><span class=\"hljs-comment\">// child comp</span><br><span class=\"hljs-title function_\">connectedCallback</span>(<span class=\"hljs-params\"></span>) &#123;<br>  <span class=\"hljs-comment\">// 定义事件</span><br>  <span class=\"hljs-keyword\">const</span> event = <span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">CustomEvent</span>(<span class=\"hljs-string\">&#x27;custom-event&#x27;</span>, &#123;<br>    <span class=\"hljs-attr\">detail</span>: &#123;<br>      <span class=\"hljs-attr\">value</span>: <span class=\"hljs-string\">&#x27;child web component&#x27;</span><br>    &#125;<br>  &#125;)<br>  <span class=\"hljs-variable language_\">this</span>.<span class=\"hljs-title function_\">dispatchEvent</span>(event)<br><br>  <span class=\"hljs-keyword\">const</span> btn = <span class=\"hljs-variable language_\">this</span>.<span class=\"hljs-property\">shadowRoot</span>.<span class=\"hljs-title function_\">querySelector</span>(<span class=\"hljs-string\">&#x27;button&#x27;</span>)<br>  btn.<span class=\"hljs-title function_\">addEventListener</span>(<span class=\"hljs-string\">&#x27;click&#x27;</span>, <span class=\"hljs-function\">() =&gt;</span> &#123;<br>    <span class=\"hljs-comment\">// 获取父组件</span><br>    <span class=\"hljs-variable language_\">this</span>.<span class=\"hljs-title function_\">getRootNode</span>().<span class=\"hljs-property\">host</span>.<span class=\"hljs-title function_\">sayHello</span>(<span class=\"hljs-string\">&#x27;Hello :&#x27;</span>)<br>  &#125;)<br>&#125;<br></code></pre></td></tr></table></figure>\n\n<h2 id=\"子组件直接调用父组件实例上的方法\"><a href=\"#子组件直接调用父组件实例上的方法\" class=\"headerlink\" title=\"子组件直接调用父组件实例上的方法\"></a>子组件直接调用父组件实例上的方法</h2><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\"><span class=\"hljs-comment\">// parent comp</span><br><span class=\"hljs-title function_\">sayHello</span>(<span class=\"hljs-params\">msg</span>) &#123;<br>  <span class=\"hljs-variable language_\">console</span>.<span class=\"hljs-title function_\">log</span>(msg, <span class=\"hljs-variable language_\">this</span>.<span class=\"hljs-property\">data</span>)<br>&#125;<br><br><br><span class=\"hljs-comment\">// child comp</span><br><span class=\"hljs-title function_\">connectedCallback</span>(<span class=\"hljs-params\"></span>) &#123;<br>  <span class=\"hljs-keyword\">const</span> btn = <span class=\"hljs-variable language_\">this</span>.<span class=\"hljs-property\">shadowRoot</span>.<span class=\"hljs-title function_\">querySelector</span>(<span class=\"hljs-string\">&#x27;button&#x27;</span>)<br><br>  btn.<span class=\"hljs-title function_\">addEventListener</span>(<span class=\"hljs-string\">&#x27;click&#x27;</span>, <span class=\"hljs-function\">() =&gt;</span> &#123;<br>    <span class=\"hljs-comment\">// 获取父组件实例</span><br>    <span class=\"hljs-variable language_\">this</span>.<span class=\"hljs-title function_\">getRootNode</span>().<span class=\"hljs-property\">host</span>.<span class=\"hljs-title function_\">sayHello</span>(<span class=\"hljs-string\">&#x27;Hello :&#x27;</span>)<br>  &#125;)<br>&#125;<br></code></pre></td></tr></table></figure>\n\n<h2 id=\"监听组件上属性的变化\"><a href=\"#监听组件上属性的变化\" class=\"headerlink\" title=\"监听组件上属性的变化\"></a>监听组件上属性的变化</h2><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\"><span class=\"hljs-comment\">// parent</span><br><span class=\"hljs-keyword\">const</span> child = <span class=\"hljs-variable language_\">this</span>.<span class=\"hljs-property\">shadowRoot</span>.<span class=\"hljs-title function_\">querySelector</span>(<span class=\"hljs-string\">&#x27;child-wc&#x27;</span>)<br><span class=\"hljs-comment\">// 1. 通过 DOM 属性传参，会触发子组件的 attributeChangedCallback 钩子</span><br>child.<span class=\"hljs-title function_\">setAttribute</span>(<span class=\"hljs-string\">&#x27;text&#x27;</span>, <span class=\"hljs-string\">&#x27;Parent changed the Text&#x27;</span>)<br><br><br><br><span class=\"hljs-comment\">// child</span><br><span class=\"hljs-comment\">// 监听属性变化，必须定静态的 observedAttributes 方法</span><br><span class=\"hljs-keyword\">static</span> <span class=\"hljs-keyword\">get</span> <span class=\"hljs-title function_\">observedAttributes</span>() &#123;<br>  <span class=\"hljs-keyword\">return</span> [<span class=\"hljs-string\">&#x27;text&#x27;</span>];<br>&#125;<br><span class=\"hljs-title function_\">attributeChangedCallback</span>(<span class=\"hljs-params\">name, oldValue, newValue</span>) &#123;<br>  <span class=\"hljs-variable language_\">console</span>.<span class=\"hljs-title function_\">log</span>(<span class=\"hljs-string\">&#x27;name&#x27;</span>, name)<br>  <span class=\"hljs-variable language_\">console</span>.<span class=\"hljs-title function_\">log</span>(<span class=\"hljs-string\">&#x27;oldValue&#x27;</span>, oldValue)<br>  <span class=\"hljs-variable language_\">console</span>.<span class=\"hljs-title function_\">log</span>(<span class=\"hljs-string\">&#x27;newValue&#x27;</span>, newValue)<br>&#125;<br></code></pre></td></tr></table></figure>\n\n<h1 id=\"web-component-in-ReactJS\"><a href=\"#web-component-in-ReactJS\" class=\"headerlink\" title=\"web component in ReactJS\"></a>web component in ReactJS</h1><p>React 和 Web Components 为了解决不同的问题而生。</p>\n<p>Web Components 为可复用组件提供了强大的封装，而 React 则提供了声明式的解决方案，使 DOM 与数据保持同步。</p>\n<p>两者旨在互补。作为开发人员，可以自由选择在 Web Components 中使用 React，或者在 React 中使用 Web Components，或者两者共存。</p>\n<h2 id=\"问题\"><a href=\"#问题\" class=\"headerlink\" title=\"问题\"></a>问题</h2><blockquote>\n<p>“react”: “^16.12.0”</p>\n</blockquote>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\"><span class=\"hljs-keyword\">class</span> <span class=\"hljs-title class_\">MyApp</span> <span class=\"hljs-keyword\">extends</span> <span class=\"hljs-title class_ inherited__\">React.Component</span> &#123;<br>  <span class=\"hljs-title function_\">render</span>(<span class=\"hljs-params\"></span>) &#123;<br>  \t<span class=\"hljs-keyword\">return</span> <span class=\"language-xml\"><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">span</span> <span class=\"hljs-attr\">onClick</span>=<span class=\"hljs-string\">&#123;()</span> =&gt;</span> alert(&#x27;I have been clicked&#x27;)&#125;&gt;Click me<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">span</span>&gt;</span></span>;<br>  &#125;<br>&#125;<br><br><span class=\"hljs-keyword\">class</span> <span class=\"hljs-title class_\">ShadowElement</span> <span class=\"hljs-keyword\">extends</span> <span class=\"hljs-title class_ inherited__\">HTMLElement</span> &#123;<br>  <span class=\"hljs-title function_\">constructor</span>(<span class=\"hljs-params\"></span>) &#123;<br>    <span class=\"hljs-variable language_\">super</span>()<br>  &#125;<br><br>  <span class=\"hljs-title function_\">connectedCallback</span>(<span class=\"hljs-params\"></span>) &#123;<br>    <span class=\"hljs-keyword\">const</span> mountPoint = <span class=\"hljs-variable language_\">document</span>.<span class=\"hljs-title function_\">createElement</span>(<span class=\"hljs-string\">&#x27;div&#x27;</span>);<br>    <span class=\"hljs-keyword\">const</span> shadowRoot = <span class=\"hljs-variable language_\">this</span>.<span class=\"hljs-title function_\">attachShadow</span>(&#123; <span class=\"hljs-attr\">mode</span>: <span class=\"hljs-string\">&#x27;open&#x27;</span> &#125;);<br><br>    shadowRoot.<span class=\"hljs-title function_\">appendChild</span>(mountPoint);<br><br>    <span class=\"hljs-title class_\">ReactDOM</span>.<span class=\"hljs-title function_\">render</span>(<span class=\"language-xml\"><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">MyApp</span> /&gt;</span></span>, mountPoint);<br>  &#125;<br>&#125;<br><br><br>customElements.<span class=\"hljs-title function_\">define</span>(<span class=\"hljs-string\">&#x27;my-custom-element&#x27;</span>, <span class=\"hljs-title class_\">ShadowElement</span>);<br><br><br><span class=\"hljs-comment\">// 使用</span><br><br><span class=\"language-xml\"><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">div</span> <span class=\"hljs-attr\">className</span>=<span class=\"hljs-string\">&quot;app-main&quot;</span> <span class=\"hljs-attr\">onClick</span>=<span class=\"hljs-string\">&#123;()</span>=&gt;</span> console.log(&#x27;app main clicked&#x27;)&#125;&gt;</span><br><span class=\"language-xml\">  <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">my-custom-element</span>&gt;</span><span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">my-custom-element</span>&gt;</span></span><br><span class=\"language-xml\"><span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">div</span>&gt;</span></span><br></code></pre></td></tr></table></figure>\n\n<p>效果图</p>\n<p><img src=\"/img/react-v16.gif\" alt=\"\"></p>\n<blockquote>\n<p>“react”: “^17.0.2” 及以上版本，已解决此问题。</p>\n</blockquote>\n<p>代码一致，效果图。</p>\n<p><img src=\"/img/react-v17.gif\" alt=\"\"></p>\n<h2 id=\"解决方案\"><a href=\"#解决方案\" class=\"headerlink\" title=\"解决方案\"></a>解决方案</h2><blockquote>\n<p>Web Components 触发的事件可能无法通过 React 渲染树正确的传递。 你需要在 React 组件中手动添加事件处理器来处理这些事件。</p>\n</blockquote>\n<p>Shadow DOM 重定向了 click 事件并将其封装在 shadow 中，将组件内部的所有内容封装在单独的作用域中，并隔离事件。React 并不支持这样的 Shadow DOM，因此事件委托失败，事件无法触发。</p>\n<p>这意味着，如果您将带有 click 事件的 React 组件放在 Web 组件中，则点击事件可能不会冒泡到 React 组件中。这是因为事件在 Web 组件的 Shadow DOM 中触发，然后被封装在 Shadow DOM 中，而不会传播到外部组件。</p>\n<p>如果您希望在使用 Web 组件时能够触发 React 事件，则可以使用上述方法之一，例如重新绑定事件到实际的 shadow 容器并使用 “__reactInternalInstances” 来调度正确的 React 事件。您还可以使用其他方法来解决此问题，例如使用自定义事件或使用事件代理。</p>\n<blockquote>\n<p><a href=\"https://stackoverflow.com/questions/37866237/click-event-not-firing-when-react-component-in-a-shadow-dom\">https://stackoverflow.com/questions/37866237/click-event-not-firing-when-react-component-in-a-shadow-dom</a></p>\n</blockquote>\n<p><strong>相关文章：当 Shadow Dom 遇上 React event</strong></p>\n<blockquote>\n<p><a href=\"https://github.com/huruji/blog/issues/104\">https://github.com/huruji/blog/issues/104</a></p>\n</blockquote>\n<h1 id=\"编写组件\"><a href=\"#编写组件\" class=\"headerlink\" title=\"编写组件\"></a>编写组件</h1><blockquote>\n<p><a href=\"https://juejin.cn/post/7157955953776820254\">https://juejin.cn/post/7157955953776820254</a></p>\n<p><a href=\"https://juejin.cn/post/7161816035186720781\">https://juejin.cn/post/7161816035186720781</a></p>\n<p><a href=\"https://quark-design.hellobike.com/#/\">https://quark-design.hellobike.com/#/</a></p>\n</blockquote>\n<h1 id=\"参考链接\"><a href=\"#参考链接\" class=\"headerlink\" title=\"参考链接\"></a>参考链接</h1><ul>\n<li><a href=\"https://developer.mozilla.org/zh-CN/docs/Web/Web_Components/Using_templates_and_slots\">MDN官方文档</a></li>\n<li><a href=\"https://github1s.com/mdn/web-components-examples/blob/main/shadow-part/main.js\">WC官方示例</a></li>\n<li><a href=\"http://www.xieluping.cn/post/wc/\">基于 Web Components 跨框架组件开发</a></li>\n<li><a href=\"https://blog.csdn.net/qq_37718797/article/details/122970991\">Shadow :host 选择器</a></li>\n</ul>\n"},{"layout":"ts","title":"深入浅出TypeScript","date":"2022-09-09T02:35:36.000Z","banner_img":"/img/ts.jpg","index_img":"/img/ts.jpg","excerpt":"TypeScript","_content":"\n# TypeScript\n\n## .d.ts 和 declare 是干嘛用的\n\n如果一个文件有扩展名 `.d.ts`，则表示它是一个声明文件，可以用来声明全局的类型定义和接口，或者是其它模块。比如：\n```js\n// global.d.ts\n\n// 声明接口\ndeclare interface Person {\n  name: string;\n  age: number;\n}\n\n// 声明类型 (别名)\ndeclare type TName = string;\n\n// 声明模块\ndeclare module '*.css';\ndeclare module '*.less';\ndeclare module '*.png';\n\n// 拓展 window 属性，在 window 对象上显式设置属性\ndeclare interface Window {\n  MyNameSpace: any\n}\n```\n\n但是也不是说创建了.d.ts文件，里面声明的东西就能生效了，毕竟归根到底也是.ts文件，需要预编译，所以需要在tsconfig.json文件里面的include数组里面添加 `global.d.ts` 文件。\n```json\n\"include\": [\"src/**/*.ts\", \"src/**/*.d.ts\", \"src/**/*.tsx\", \"src/**/*.vue\"]\n```\n\n`.d.ts` 文件中的顶级声明必须以 \"declare\" 或 \"export\" 修饰符开头。通过`declare`声明的类型或者变量或者模块，在`include`包含的文件范围内，都可以直接引用。\n```js\n// .vue setup / .ts\nconst me: Person = {\n  name: 'alex.cheng',\n  age: 18\n}\n```\n\n**注意**\n`.d.ts`文件顶级声明`declare`最好不要跟`export`同级使用，不然在其他`ts`文件引用这个`.d.ts`的内容的时候，就需要手动import导入了。\n```js\n// global.d.ts\nexport type TName = string;\n\n// 这个时候，外部 ts 就无法直接使用 Person 了，需要引入 import { Person } from '../global.d.ts'\nexport declare interface Person {\n  name: string;\n  age: number;\n}\n```\n\n## 给对象分配动态（未知）属性\n```js\nconst o: { [key: string]: any } = {}\n\n// 使用 ts 内置工具 Record，效果同上\nconst o: Record<string, any> = {}\n\ninterface IPerson extends Record<string, any> {\n  name: string;\n  age?: number;\n}\n\nconst me1: IPerson = {\n  name: 'alex',\n  hair: 'black'\n}\n```\n\n## interface 和 type 有什么区别\n1. `接口`和`类型别名`都可以用来描述对象的形状或函数签名。\n\n2. 与`接口类型`不一样的是，`类型别名`可以用于一些其他类型，比如原始类型、联合类型（`|`）和元组。\n\n3. 接口和类型别名都能够被扩展，但语法有所不同。此外，接口和类型别名不是互斥的。接口可以扩展类型别名，而反过来是不行的。\n\n  `interface` 扩展（接口、类型）使用 `extends` 关键字，类型别名扩展（接口、类型）使用的是 `交叉类型（&）`:\n\n  ```js\n  // 接口扩展\n  interface IPerson {\n    name: string;\n  }\n  interface IMe extends IPerson {\n    age: number;\n  }\n\n  // 类型扩展\n  type TPerson = {\n    name: string;\n  }\n  type TMe = TPerson & {\n    age: number;\n  }\n  ```\n4. 类可以以相同的方式实现(`implements`)接口或类型别名，但类不能实现使用类型别名定义的联合类型\n  ```js\n  // Error:\n  type PartialPoint = { x: number; } | { y: number; };\n  class SomePartialPoint implements PartialPoint { // 类只能实现具有静态已知成员的对象类型或对象类型的交集。ts(2422)\n    x = 1;\n    y = 2;\n  }\n\n  // Success\n  type PartialPoint = { x: number; } & { y: number; };\n  class SomePartialPoint implements PartialPoint {\n    x = 1;\n    y = 2;\n  }\n  ```\n\n5. 与类型别名不同，接口可以定义多次，会被自动合并为单个接口。\n  ```js\n  interface IMerge {\n    a: 1;\n  }\n  interface IMerge {\n    b: 2\n  }\n  const ab: IMerge = {}; // 类型“{}”缺少类型“IMerge”中的以下属性: a, bts(2739)\n\n\n  // Error: 标识符“TOne”重复。ts(2300)\n  type TOne = string;\n  type TOne = number;\n  ```\n\n## 类型保护\n\n  1. typeof\n  2. instanceof\n  3. in\n\n## 参考资料\n[^1]: [TS 学习指南](https://juejin.cn/post/6872111128135073806)\n[^2]: [深入理解TypeScript](https://jkchao.github.io/typescript-book-chinese/)\n\n\n","source":"_posts/深入浅出TypeScript.md","raw":"---\nlayout: ts\ntitle: 深入浅出TypeScript\ndate: 2022-09-09 10:35:36\ntags: TypeScript TS\nbanner_img: /img/ts.jpg\nindex_img: /img/ts.jpg\nexcerpt: TypeScript\n---\n\n# TypeScript\n\n## .d.ts 和 declare 是干嘛用的\n\n如果一个文件有扩展名 `.d.ts`，则表示它是一个声明文件，可以用来声明全局的类型定义和接口，或者是其它模块。比如：\n```js\n// global.d.ts\n\n// 声明接口\ndeclare interface Person {\n  name: string;\n  age: number;\n}\n\n// 声明类型 (别名)\ndeclare type TName = string;\n\n// 声明模块\ndeclare module '*.css';\ndeclare module '*.less';\ndeclare module '*.png';\n\n// 拓展 window 属性，在 window 对象上显式设置属性\ndeclare interface Window {\n  MyNameSpace: any\n}\n```\n\n但是也不是说创建了.d.ts文件，里面声明的东西就能生效了，毕竟归根到底也是.ts文件，需要预编译，所以需要在tsconfig.json文件里面的include数组里面添加 `global.d.ts` 文件。\n```json\n\"include\": [\"src/**/*.ts\", \"src/**/*.d.ts\", \"src/**/*.tsx\", \"src/**/*.vue\"]\n```\n\n`.d.ts` 文件中的顶级声明必须以 \"declare\" 或 \"export\" 修饰符开头。通过`declare`声明的类型或者变量或者模块，在`include`包含的文件范围内，都可以直接引用。\n```js\n// .vue setup / .ts\nconst me: Person = {\n  name: 'alex.cheng',\n  age: 18\n}\n```\n\n**注意**\n`.d.ts`文件顶级声明`declare`最好不要跟`export`同级使用，不然在其他`ts`文件引用这个`.d.ts`的内容的时候，就需要手动import导入了。\n```js\n// global.d.ts\nexport type TName = string;\n\n// 这个时候，外部 ts 就无法直接使用 Person 了，需要引入 import { Person } from '../global.d.ts'\nexport declare interface Person {\n  name: string;\n  age: number;\n}\n```\n\n## 给对象分配动态（未知）属性\n```js\nconst o: { [key: string]: any } = {}\n\n// 使用 ts 内置工具 Record，效果同上\nconst o: Record<string, any> = {}\n\ninterface IPerson extends Record<string, any> {\n  name: string;\n  age?: number;\n}\n\nconst me1: IPerson = {\n  name: 'alex',\n  hair: 'black'\n}\n```\n\n## interface 和 type 有什么区别\n1. `接口`和`类型别名`都可以用来描述对象的形状或函数签名。\n\n2. 与`接口类型`不一样的是，`类型别名`可以用于一些其他类型，比如原始类型、联合类型（`|`）和元组。\n\n3. 接口和类型别名都能够被扩展，但语法有所不同。此外，接口和类型别名不是互斥的。接口可以扩展类型别名，而反过来是不行的。\n\n  `interface` 扩展（接口、类型）使用 `extends` 关键字，类型别名扩展（接口、类型）使用的是 `交叉类型（&）`:\n\n  ```js\n  // 接口扩展\n  interface IPerson {\n    name: string;\n  }\n  interface IMe extends IPerson {\n    age: number;\n  }\n\n  // 类型扩展\n  type TPerson = {\n    name: string;\n  }\n  type TMe = TPerson & {\n    age: number;\n  }\n  ```\n4. 类可以以相同的方式实现(`implements`)接口或类型别名，但类不能实现使用类型别名定义的联合类型\n  ```js\n  // Error:\n  type PartialPoint = { x: number; } | { y: number; };\n  class SomePartialPoint implements PartialPoint { // 类只能实现具有静态已知成员的对象类型或对象类型的交集。ts(2422)\n    x = 1;\n    y = 2;\n  }\n\n  // Success\n  type PartialPoint = { x: number; } & { y: number; };\n  class SomePartialPoint implements PartialPoint {\n    x = 1;\n    y = 2;\n  }\n  ```\n\n5. 与类型别名不同，接口可以定义多次，会被自动合并为单个接口。\n  ```js\n  interface IMerge {\n    a: 1;\n  }\n  interface IMerge {\n    b: 2\n  }\n  const ab: IMerge = {}; // 类型“{}”缺少类型“IMerge”中的以下属性: a, bts(2739)\n\n\n  // Error: 标识符“TOne”重复。ts(2300)\n  type TOne = string;\n  type TOne = number;\n  ```\n\n## 类型保护\n\n  1. typeof\n  2. instanceof\n  3. in\n\n## 参考资料\n[^1]: [TS 学习指南](https://juejin.cn/post/6872111128135073806)\n[^2]: [深入理解TypeScript](https://jkchao.github.io/typescript-book-chinese/)\n\n\n","slug":"深入浅出TypeScript","published":1,"updated":"2023-05-12T10:49:20.018Z","comments":1,"photos":[],"link":"","_id":"clhkizgxt001f3y0qgvnz59ir","content":"<h1 id=\"TypeScript\"><a href=\"#TypeScript\" class=\"headerlink\" title=\"TypeScript\"></a>TypeScript</h1><h2 id=\"d-ts-和-declare-是干嘛用的\"><a href=\"#d-ts-和-declare-是干嘛用的\" class=\"headerlink\" title=\".d.ts 和 declare 是干嘛用的\"></a>.d.ts 和 declare 是干嘛用的</h2><p>如果一个文件有扩展名 <code>.d.ts</code>，则表示它是一个声明文件，可以用来声明全局的类型定义和接口，或者是其它模块。比如：</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><div class=\"code-wrapper\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br></pre></div></td><td class=\"code\"><pre><code class=\"hljs js\"><span class=\"hljs-comment\">// global.d.ts</span><br><br><span class=\"hljs-comment\">// 声明接口</span><br>declare interface <span class=\"hljs-title class_\">Person</span> &#123;<br>  <span class=\"hljs-attr\">name</span>: string;<br>  <span class=\"hljs-attr\">age</span>: number;<br>&#125;<br><br><span class=\"hljs-comment\">// 声明类型 (别名)</span><br>declare type <span class=\"hljs-title class_\">TName</span> = string;<br><br><span class=\"hljs-comment\">// 声明模块</span><br>declare <span class=\"hljs-variable language_\">module</span> <span class=\"hljs-string\">&#x27;*.css&#x27;</span>;<br>declare <span class=\"hljs-variable language_\">module</span> <span class=\"hljs-string\">&#x27;*.less&#x27;</span>;<br>declare <span class=\"hljs-variable language_\">module</span> <span class=\"hljs-string\">&#x27;*.png&#x27;</span>;<br><br><span class=\"hljs-comment\">// 拓展 window 属性，在 window 对象上显式设置属性</span><br>declare interface <span class=\"hljs-title class_\">Window</span> &#123;<br>  <span class=\"hljs-title class_\">MyNameSpace</span>: any<br>&#125;<br></code></pre></td></tr></table></figure>\n\n<p>但是也不是说创建了.d.ts文件，里面声明的东西就能生效了，毕竟归根到底也是.ts文件，需要预编译，所以需要在tsconfig.json文件里面的include数组里面添加 <code>global.d.ts</code> 文件。</p>\n<figure class=\"highlight json\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs json\"><span class=\"hljs-attr\">&quot;include&quot;</span><span class=\"hljs-punctuation\">:</span> <span class=\"hljs-punctuation\">[</span><span class=\"hljs-string\">&quot;src/**/*.ts&quot;</span><span class=\"hljs-punctuation\">,</span> <span class=\"hljs-string\">&quot;src/**/*.d.ts&quot;</span><span class=\"hljs-punctuation\">,</span> <span class=\"hljs-string\">&quot;src/**/*.tsx&quot;</span><span class=\"hljs-punctuation\">,</span> <span class=\"hljs-string\">&quot;src/**/*.vue&quot;</span><span class=\"hljs-punctuation\">]</span><br></code></pre></td></tr></table></figure>\n\n<p><code>.d.ts</code> 文件中的顶级声明必须以 “declare” 或 “export” 修饰符开头。通过<code>declare</code>声明的类型或者变量或者模块，在<code>include</code>包含的文件范围内，都可以直接引用。</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\"><span class=\"hljs-comment\">// .vue setup / .ts</span><br><span class=\"hljs-keyword\">const</span> <span class=\"hljs-attr\">me</span>: <span class=\"hljs-title class_\">Person</span> = &#123;<br>  <span class=\"hljs-attr\">name</span>: <span class=\"hljs-string\">&#x27;alex.cheng&#x27;</span>,<br>  <span class=\"hljs-attr\">age</span>: <span class=\"hljs-number\">18</span><br>&#125;<br></code></pre></td></tr></table></figure>\n\n<p><strong>注意</strong><br><code>.d.ts</code>文件顶级声明<code>declare</code>最好不要跟<code>export</code>同级使用，不然在其他<code>ts</code>文件引用这个<code>.d.ts</code>的内容的时候，就需要手动import导入了。</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\"><span class=\"hljs-comment\">// global.d.ts</span><br><span class=\"hljs-keyword\">export</span> type <span class=\"hljs-title class_\">TName</span> = string;<br><br><span class=\"hljs-comment\">// 这个时候，外部 ts 就无法直接使用 Person 了，需要引入 import &#123; Person &#125; from &#x27;../global.d.ts&#x27;</span><br><span class=\"hljs-keyword\">export</span> declare interface <span class=\"hljs-title class_\">Person</span> &#123;<br>  <span class=\"hljs-attr\">name</span>: string;<br>  <span class=\"hljs-attr\">age</span>: number;<br>&#125;<br></code></pre></td></tr></table></figure>\n\n<h2 id=\"给对象分配动态（未知）属性\"><a href=\"#给对象分配动态（未知）属性\" class=\"headerlink\" title=\"给对象分配动态（未知）属性\"></a>给对象分配动态（未知）属性</h2><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\"><span class=\"hljs-keyword\">const</span> <span class=\"hljs-attr\">o</span>: &#123; [<span class=\"hljs-attr\">key</span>: string]: any &#125; = &#123;&#125;<br><br><span class=\"hljs-comment\">// 使用 ts 内置工具 Record，效果同上</span><br><span class=\"hljs-keyword\">const</span> <span class=\"hljs-attr\">o</span>: <span class=\"hljs-title class_\">Record</span>&lt;string, any&gt; = &#123;&#125;<br><br>interface <span class=\"hljs-title class_\">IPerson</span> <span class=\"hljs-keyword\">extends</span> <span class=\"hljs-title class_\">Record</span>&lt;string, any&gt; &#123;<br>  <span class=\"hljs-attr\">name</span>: string;<br>  age?: number;<br>&#125;<br><br><span class=\"hljs-keyword\">const</span> <span class=\"hljs-attr\">me1</span>: <span class=\"hljs-title class_\">IPerson</span> = &#123;<br>  <span class=\"hljs-attr\">name</span>: <span class=\"hljs-string\">&#x27;alex&#x27;</span>,<br>  <span class=\"hljs-attr\">hair</span>: <span class=\"hljs-string\">&#x27;black&#x27;</span><br>&#125;<br></code></pre></td></tr></table></figure>\n\n<h2 id=\"interface-和-type-有什么区别\"><a href=\"#interface-和-type-有什么区别\" class=\"headerlink\" title=\"interface 和 type 有什么区别\"></a>interface 和 type 有什么区别</h2><ol>\n<li><p><code>接口</code>和<code>类型别名</code>都可以用来描述对象的形状或函数签名。</p>\n</li>\n<li><p>与<code>接口类型</code>不一样的是，<code>类型别名</code>可以用于一些其他类型，比如原始类型、联合类型（<code>|</code>）和元组。</p>\n</li>\n<li><p>接口和类型别名都能够被扩展，但语法有所不同。此外，接口和类型别名不是互斥的。接口可以扩展类型别名，而反过来是不行的。</p>\n<p><code>interface</code> 扩展（接口、类型）使用 <code>extends</code> 关键字，类型别名扩展（接口、类型）使用的是 <code>交叉类型（&amp;）</code>:</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\"><span class=\"hljs-comment\">// 接口扩展</span><br>interface <span class=\"hljs-title class_\">IPerson</span> &#123;<br>  <span class=\"hljs-attr\">name</span>: string;<br>&#125;<br>interface <span class=\"hljs-title class_\">IMe</span> <span class=\"hljs-keyword\">extends</span> <span class=\"hljs-title class_\">IPerson</span> &#123;<br>  <span class=\"hljs-attr\">age</span>: number;<br>&#125;<br><br><span class=\"hljs-comment\">// 类型扩展</span><br>type <span class=\"hljs-title class_\">TPerson</span> = &#123;<br>  <span class=\"hljs-attr\">name</span>: string;<br>&#125;<br>type <span class=\"hljs-title class_\">TMe</span> = <span class=\"hljs-title class_\">TPerson</span> &amp; &#123;<br>  <span class=\"hljs-attr\">age</span>: number;<br>&#125;<br></code></pre></td></tr></table></figure></li>\n<li><p>类可以以相同的方式实现(<code>implements</code>)接口或类型别名，但类不能实现使用类型别名定义的联合类型</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\"><span class=\"hljs-comment\">// Error:</span><br>type <span class=\"hljs-title class_\">PartialPoint</span> = &#123; <span class=\"hljs-attr\">x</span>: number; &#125; | &#123; <span class=\"hljs-attr\">y</span>: number; &#125;;<br><span class=\"hljs-keyword\">class</span> <span class=\"hljs-title class_\">SomePartialPoint</span> implements <span class=\"hljs-title class_\">PartialPoint</span> &#123; <span class=\"hljs-comment\">// 类只能实现具有静态已知成员的对象类型或对象类型的交集。ts(2422)</span><br>  x = <span class=\"hljs-number\">1</span>;<br>  y = <span class=\"hljs-number\">2</span>;<br>&#125;<br><br><span class=\"hljs-comment\">// Success</span><br>type <span class=\"hljs-title class_\">PartialPoint</span> = &#123; <span class=\"hljs-attr\">x</span>: number; &#125; &amp; &#123; <span class=\"hljs-attr\">y</span>: number; &#125;;<br><span class=\"hljs-keyword\">class</span> <span class=\"hljs-title class_\">SomePartialPoint</span> implements <span class=\"hljs-title class_\">PartialPoint</span> &#123;<br>  x = <span class=\"hljs-number\">1</span>;<br>  y = <span class=\"hljs-number\">2</span>;<br>&#125;<br></code></pre></td></tr></table></figure>\n</li>\n<li><p>与类型别名不同，接口可以定义多次，会被自动合并为单个接口。</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\">interface <span class=\"hljs-title class_\">IMerge</span> &#123;<br>  <span class=\"hljs-attr\">a</span>: <span class=\"hljs-number\">1</span>;<br>&#125;<br>interface <span class=\"hljs-title class_\">IMerge</span> &#123;<br>  <span class=\"hljs-attr\">b</span>: <span class=\"hljs-number\">2</span><br>&#125;<br><span class=\"hljs-keyword\">const</span> <span class=\"hljs-attr\">ab</span>: <span class=\"hljs-title class_\">IMerge</span> = &#123;&#125;; <span class=\"hljs-comment\">// 类型“&#123;&#125;”缺少类型“IMerge”中的以下属性: a, bts(2739)</span><br><br><br><span class=\"hljs-comment\">// Error: 标识符“TOne”重复。ts(2300)</span><br>type <span class=\"hljs-title class_\">TOne</span> = string;<br>type <span class=\"hljs-title class_\">TOne</span> = number;<br></code></pre></td></tr></table></figure>\n\n</li>\n</ol>\n<h2 id=\"类型保护\"><a href=\"#类型保护\" class=\"headerlink\" title=\"类型保护\"></a>类型保护</h2><ol>\n<li>typeof</li>\n<li>instanceof</li>\n<li>in</li>\n</ol>\n<h2 id=\"参考资料\"><a href=\"#参考资料\" class=\"headerlink\" title=\"参考资料\"></a>参考资料</h2><section class=\"footnotes\"><div class=\"footnote-list\"><ol><li><span id=\"fn:1\" class=\"footnote-text\"><span><a href=\"https://juejin.cn/post/6872111128135073806\">TS 学习指南</a>\n<a href=\"#fnref:1\" rev=\"footnote\" class=\"footnote-backref\"> ↩</a></span></span></li><li><span id=\"fn:2\" class=\"footnote-text\"><span><a href=\"https://jkchao.github.io/typescript-book-chinese/\">深入理解TypeScript</a>\n<a href=\"#fnref:2\" rev=\"footnote\" class=\"footnote-backref\"> ↩</a></span></span></li></ol></div></section>","site":{"data":{}},"wordcount":2431,"more":"<h1 id=\"TypeScript\"><a href=\"#TypeScript\" class=\"headerlink\" title=\"TypeScript\"></a>TypeScript</h1><h2 id=\"d-ts-和-declare-是干嘛用的\"><a href=\"#d-ts-和-declare-是干嘛用的\" class=\"headerlink\" title=\".d.ts 和 declare 是干嘛用的\"></a>.d.ts 和 declare 是干嘛用的</h2><p>如果一个文件有扩展名 <code>.d.ts</code>，则表示它是一个声明文件，可以用来声明全局的类型定义和接口，或者是其它模块。比如：</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\"><span class=\"hljs-comment\">// global.d.ts</span><br><br><span class=\"hljs-comment\">// 声明接口</span><br>declare interface <span class=\"hljs-title class_\">Person</span> &#123;<br>  <span class=\"hljs-attr\">name</span>: string;<br>  <span class=\"hljs-attr\">age</span>: number;<br>&#125;<br><br><span class=\"hljs-comment\">// 声明类型 (别名)</span><br>declare type <span class=\"hljs-title class_\">TName</span> = string;<br><br><span class=\"hljs-comment\">// 声明模块</span><br>declare <span class=\"hljs-variable language_\">module</span> <span class=\"hljs-string\">&#x27;*.css&#x27;</span>;<br>declare <span class=\"hljs-variable language_\">module</span> <span class=\"hljs-string\">&#x27;*.less&#x27;</span>;<br>declare <span class=\"hljs-variable language_\">module</span> <span class=\"hljs-string\">&#x27;*.png&#x27;</span>;<br><br><span class=\"hljs-comment\">// 拓展 window 属性，在 window 对象上显式设置属性</span><br>declare interface <span class=\"hljs-title class_\">Window</span> &#123;<br>  <span class=\"hljs-title class_\">MyNameSpace</span>: any<br>&#125;<br></code></pre></td></tr></table></figure>\n\n<p>但是也不是说创建了.d.ts文件，里面声明的东西就能生效了，毕竟归根到底也是.ts文件，需要预编译，所以需要在tsconfig.json文件里面的include数组里面添加 <code>global.d.ts</code> 文件。</p>\n<figure class=\"highlight json\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs json\"><span class=\"hljs-attr\">&quot;include&quot;</span><span class=\"hljs-punctuation\">:</span> <span class=\"hljs-punctuation\">[</span><span class=\"hljs-string\">&quot;src/**/*.ts&quot;</span><span class=\"hljs-punctuation\">,</span> <span class=\"hljs-string\">&quot;src/**/*.d.ts&quot;</span><span class=\"hljs-punctuation\">,</span> <span class=\"hljs-string\">&quot;src/**/*.tsx&quot;</span><span class=\"hljs-punctuation\">,</span> <span class=\"hljs-string\">&quot;src/**/*.vue&quot;</span><span class=\"hljs-punctuation\">]</span><br></code></pre></td></tr></table></figure>\n\n<p><code>.d.ts</code> 文件中的顶级声明必须以 “declare” 或 “export” 修饰符开头。通过<code>declare</code>声明的类型或者变量或者模块，在<code>include</code>包含的文件范围内，都可以直接引用。</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\"><span class=\"hljs-comment\">// .vue setup / .ts</span><br><span class=\"hljs-keyword\">const</span> <span class=\"hljs-attr\">me</span>: <span class=\"hljs-title class_\">Person</span> = &#123;<br>  <span class=\"hljs-attr\">name</span>: <span class=\"hljs-string\">&#x27;alex.cheng&#x27;</span>,<br>  <span class=\"hljs-attr\">age</span>: <span class=\"hljs-number\">18</span><br>&#125;<br></code></pre></td></tr></table></figure>\n\n<p><strong>注意</strong><br><code>.d.ts</code>文件顶级声明<code>declare</code>最好不要跟<code>export</code>同级使用，不然在其他<code>ts</code>文件引用这个<code>.d.ts</code>的内容的时候，就需要手动import导入了。</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\"><span class=\"hljs-comment\">// global.d.ts</span><br><span class=\"hljs-keyword\">export</span> type <span class=\"hljs-title class_\">TName</span> = string;<br><br><span class=\"hljs-comment\">// 这个时候，外部 ts 就无法直接使用 Person 了，需要引入 import &#123; Person &#125; from &#x27;../global.d.ts&#x27;</span><br><span class=\"hljs-keyword\">export</span> declare interface <span class=\"hljs-title class_\">Person</span> &#123;<br>  <span class=\"hljs-attr\">name</span>: string;<br>  <span class=\"hljs-attr\">age</span>: number;<br>&#125;<br></code></pre></td></tr></table></figure>\n\n<h2 id=\"给对象分配动态（未知）属性\"><a href=\"#给对象分配动态（未知）属性\" class=\"headerlink\" title=\"给对象分配动态（未知）属性\"></a>给对象分配动态（未知）属性</h2><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\"><span class=\"hljs-keyword\">const</span> <span class=\"hljs-attr\">o</span>: &#123; [<span class=\"hljs-attr\">key</span>: string]: any &#125; = &#123;&#125;<br><br><span class=\"hljs-comment\">// 使用 ts 内置工具 Record，效果同上</span><br><span class=\"hljs-keyword\">const</span> <span class=\"hljs-attr\">o</span>: <span class=\"hljs-title class_\">Record</span>&lt;string, any&gt; = &#123;&#125;<br><br>interface <span class=\"hljs-title class_\">IPerson</span> <span class=\"hljs-keyword\">extends</span> <span class=\"hljs-title class_\">Record</span>&lt;string, any&gt; &#123;<br>  <span class=\"hljs-attr\">name</span>: string;<br>  age?: number;<br>&#125;<br><br><span class=\"hljs-keyword\">const</span> <span class=\"hljs-attr\">me1</span>: <span class=\"hljs-title class_\">IPerson</span> = &#123;<br>  <span class=\"hljs-attr\">name</span>: <span class=\"hljs-string\">&#x27;alex&#x27;</span>,<br>  <span class=\"hljs-attr\">hair</span>: <span class=\"hljs-string\">&#x27;black&#x27;</span><br>&#125;<br></code></pre></td></tr></table></figure>\n\n<h2 id=\"interface-和-type-有什么区别\"><a href=\"#interface-和-type-有什么区别\" class=\"headerlink\" title=\"interface 和 type 有什么区别\"></a>interface 和 type 有什么区别</h2><ol>\n<li><p><code>接口</code>和<code>类型别名</code>都可以用来描述对象的形状或函数签名。</p>\n</li>\n<li><p>与<code>接口类型</code>不一样的是，<code>类型别名</code>可以用于一些其他类型，比如原始类型、联合类型（<code>|</code>）和元组。</p>\n</li>\n<li><p>接口和类型别名都能够被扩展，但语法有所不同。此外，接口和类型别名不是互斥的。接口可以扩展类型别名，而反过来是不行的。</p>\n<p><code>interface</code> 扩展（接口、类型）使用 <code>extends</code> 关键字，类型别名扩展（接口、类型）使用的是 <code>交叉类型（&amp;）</code>:</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\"><span class=\"hljs-comment\">// 接口扩展</span><br>interface <span class=\"hljs-title class_\">IPerson</span> &#123;<br>  <span class=\"hljs-attr\">name</span>: string;<br>&#125;<br>interface <span class=\"hljs-title class_\">IMe</span> <span class=\"hljs-keyword\">extends</span> <span class=\"hljs-title class_\">IPerson</span> &#123;<br>  <span class=\"hljs-attr\">age</span>: number;<br>&#125;<br><br><span class=\"hljs-comment\">// 类型扩展</span><br>type <span class=\"hljs-title class_\">TPerson</span> = &#123;<br>  <span class=\"hljs-attr\">name</span>: string;<br>&#125;<br>type <span class=\"hljs-title class_\">TMe</span> = <span class=\"hljs-title class_\">TPerson</span> &amp; &#123;<br>  <span class=\"hljs-attr\">age</span>: number;<br>&#125;<br></code></pre></td></tr></table></figure></li>\n<li><p>类可以以相同的方式实现(<code>implements</code>)接口或类型别名，但类不能实现使用类型别名定义的联合类型</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\"><span class=\"hljs-comment\">// Error:</span><br>type <span class=\"hljs-title class_\">PartialPoint</span> = &#123; <span class=\"hljs-attr\">x</span>: number; &#125; | &#123; <span class=\"hljs-attr\">y</span>: number; &#125;;<br><span class=\"hljs-keyword\">class</span> <span class=\"hljs-title class_\">SomePartialPoint</span> implements <span class=\"hljs-title class_\">PartialPoint</span> &#123; <span class=\"hljs-comment\">// 类只能实现具有静态已知成员的对象类型或对象类型的交集。ts(2422)</span><br>  x = <span class=\"hljs-number\">1</span>;<br>  y = <span class=\"hljs-number\">2</span>;<br>&#125;<br><br><span class=\"hljs-comment\">// Success</span><br>type <span class=\"hljs-title class_\">PartialPoint</span> = &#123; <span class=\"hljs-attr\">x</span>: number; &#125; &amp; &#123; <span class=\"hljs-attr\">y</span>: number; &#125;;<br><span class=\"hljs-keyword\">class</span> <span class=\"hljs-title class_\">SomePartialPoint</span> implements <span class=\"hljs-title class_\">PartialPoint</span> &#123;<br>  x = <span class=\"hljs-number\">1</span>;<br>  y = <span class=\"hljs-number\">2</span>;<br>&#125;<br></code></pre></td></tr></table></figure>\n</li>\n<li><p>与类型别名不同，接口可以定义多次，会被自动合并为单个接口。</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\">interface <span class=\"hljs-title class_\">IMerge</span> &#123;<br>  <span class=\"hljs-attr\">a</span>: <span class=\"hljs-number\">1</span>;<br>&#125;<br>interface <span class=\"hljs-title class_\">IMerge</span> &#123;<br>  <span class=\"hljs-attr\">b</span>: <span class=\"hljs-number\">2</span><br>&#125;<br><span class=\"hljs-keyword\">const</span> <span class=\"hljs-attr\">ab</span>: <span class=\"hljs-title class_\">IMerge</span> = &#123;&#125;; <span class=\"hljs-comment\">// 类型“&#123;&#125;”缺少类型“IMerge”中的以下属性: a, bts(2739)</span><br><br><br><span class=\"hljs-comment\">// Error: 标识符“TOne”重复。ts(2300)</span><br>type <span class=\"hljs-title class_\">TOne</span> = string;<br>type <span class=\"hljs-title class_\">TOne</span> = number;<br></code></pre></td></tr></table></figure>\n\n</li>\n</ol>\n<h2 id=\"类型保护\"><a href=\"#类型保护\" class=\"headerlink\" title=\"类型保护\"></a>类型保护</h2><ol>\n<li>typeof</li>\n<li>instanceof</li>\n<li>in</li>\n</ol>\n<h2 id=\"参考资料\"><a href=\"#参考资料\" class=\"headerlink\" title=\"参考资料\"></a>参考资料</h2><section class=\"footnotes\"><div class=\"footnote-list\"><ol><li><span id=\"fn:1\" class=\"footnote-text\"><span><a href=\"https://juejin.cn/post/6872111128135073806\">TS 学习指南</a>\n<a href=\"#fnref:1\" rev=\"footnote\" class=\"footnote-backref\"> ↩</a></span></span></li><li><span id=\"fn:2\" class=\"footnote-text\"><span><a href=\"https://jkchao.github.io/typescript-book-chinese/\">深入理解TypeScript</a>\n<a href=\"#fnref:2\" rev=\"footnote\" class=\"footnote-backref\"> ↩</a></span></span></li></ol></div></section>"},{"title":"Funny English","date":"2022-04-09T06:00:00.000Z","banner_img":"/img/english.webp","index_img":"/img/english.webp","excerpt":"Never too old to learn.","_content":"\n## Be 动词\n每一个句子中必定要有一个动词，比如说 Be 动词：\n```md\nI am a boy.\n\nShe is a girl.\n```\n\nBe 动词有三种：is、am、are，表示 \"是\" 的意思。\n\n来看下个几个常用的代词配合 Be 动词的用法\n\n```md\nI am、You are、He/She is、It is、This is、That is...\n```\n\n## 代词\n### 单数代词\n1. 人称单数代词：I、You、She、He\n2. 指示单数代词：It、This、That\n\n代词必定要接be动词\n\n### 复数代词\n1. 人称复数代词：We、You、They、\n2. 指示复数代词：These、Those\n\n常用的复数代词如“我们”“你们”“他们”“这些”“那些”，一定要跟“are”来配合，不可以用“is”。\n\n\n`复数名词`变换形式：\n1. 数目有两个及以上，不过有些名词有特殊规则，例如词尾已经是s，必须再加上es;\n2. 词尾是y就要去y改成ies;\n3. 词尾是f或fe，要去f、fe改成ves.\n\n## 形容词\n形容词通常放在名词的前面。this，that，these，those除了本身作代词之外，也可以有以下形容词的用法：\n```md\nthis boy：这个男孩\nthese boy：这些男孩\nthat boy、those boy\n```\n\n\n## 一般疑问句\n疑问句必须将be动词移到句首，才能形成疑问句。并且语调提升。\n\n## No的用法：\nNo的意思是“不”，主要放于句首，用来回答他人的提问，表示否定的意思。而在句子中的“不”要用“not”来表示。不过要特别注意的是，中文会讲“不是”，但英文却要讲成“是不”，用“be动词＋not”表示。\n\n\n## 人称代词的所有格\n人称代词+名词：表明这个名词属于这个人称代词，比如：My book，这种写法称作所有格，表示名词的归属。\n\n人称代词所有格的有：my、your、his、her、its、our、your（你们的）、thier（他们的）\n\n\n## What 疑问句与专有名词\nWhat是疑问代词＝“什么”的意思，what本身兼具疑问词和代词的特性＝疑问词 （形成疑问语气）＋代词（代表要问的东西）。之前的一般疑问句只要把am, are, is放到句首就可以了；但有疑问词What的疑问句，必须要把what 放到 is, am, are之前句首的位置，形成疑问语气。\n\n比如：\n```md\nWhat is this？\n\n而不能是这样：This is what？\n```\n有What的疑问句，必须提到句首。\n\n## 专有名词\n是独一无二的名词，第一个字母永远都要大写。\n1. 专有名词无论在句子的什么位置，第一个字母永远要大写。\n2. 专有名词因为是独一无二的，所以前面当然不需用再加“a”来表示数量。\n\n“专有名词”常见的种类有以下几种。\n  ```js\n  人名 例如，John约翰。\n  地名 例如，Taipei台北。\n  国家 例如，America美国。\n  语言 例如，English英文。\n  ```\n\n## 疑问词\n\n### Why疑问句的用法\n\n\n### What疑问句的用法\n\n\n### Who疑问句的用法\n```md\nWho is that boy.\n```\n\nWho是疑问代词＝“谁”的意思，所以Who＝疑问词（形成疑问语气）＋代词（代表要问的人）。Who的用法和前面所学的“What”“Why”相同，都必须放在am, are, is之前句首的位置形成疑问语气。\n\n\n### How疑问句的用法\n\n\n### Where疑问句的用法\n\n### Whose疑问句的用法\n代表“谁的东西”，比如:\n  ```js\n  Whose cat is this? // 这只猫是谁的？\n  ```\n\n### Which疑问句的用法\nWhich意思是“哪一个 / 哪一些”。Which可以代表单数，也可以代表复数。\n1. 单数：Which is 哪一个\n2. 复数：Which are 哪一些\n\n比如：\n\n```md\nWhich is my book? // 哪本书是我的？\nWhich are my chairs? // 哪些椅子是我的？\n```\n\n也可以当做形容词用:\n```md\nWhich books are mine?\n```\n\n\n\n## 介词 in\nin（介词）＝“在……里面”的意思。in的后面常搭配空间（盒子 / 房屋）。\n\n## 介词 on\n“on”这个介词＝“在……上面”的意思，但是这里所说的“上面”，并不是“漂浮在东西的上空”喔，而是必须接触到东西的表面，才能使用“on”来说明！\n\n### 其他介词\n```md\nat：“在......地点旁边”\n\nbeside：“在... 旁边”，靠的很近，有靠在什么东西旁边的感觉\n\nnear：“在...附近”\n\nunder：“在...正下方”\n\nover：“在...正上方”，强调正上方\n\nbelow：“在...下方”\n\nabove：“在...上方”\n\n```\n\n“在树上”有两种写法，“属于树本身的东西”，如果实、叶子等要用“on”，而“在树枝间穿梭的小动物”，如鸟、猴子等要用“in”喔！\n\n\n## 单数/复数名词所有格\n\n```md\nJohn’s father is a doctor.\n```\n\n我们常讲你的、我的、妈妈的、约翰的等，其实在英文里面也有相同的讲法，只是在中文里，通常会在名词的后面加上“的”，英文却是要在名词后面加上’s来表示。而这样的写法，我们称为“所有格”，用来说明东西的所有权归属。\n\n名词的所有格：只限于有生命的“人”或“动物”。\n\n1. 单数名词的所有格写法＝单数名词＋’s\n2. 复数名词的所有格：\n  - 词尾有s的，要写成s’，比如 cats'、girls'、parents'\n  - 复数名词词尾没有 s 的，要加上 's，比如 men's、women's、children's\n\n### 所有格代词：为了避免重复叙述\n\n所有格代词 = 代词 + 名词\n\nmine,our,yours,hers,thiers,its\n\n```md\nThis book is mine.\n\nOr\n\nThis book is my book.\n```\n\n## 定冠词the的用法及无生命的所有格\n\n```md\nThe flower is beautiful.\n\nThe flowers are beautiful.\n```\n\nthe 除了可以代替“a”之外，the也可以代替“these / those”，因此the可以通用于单复数名词!\n\n### *重点1* \nthe 主要用来指出“特定的人或物”，可通用于单复数名词。\n\n```md\n// 特定的一朵花\nthe flower = this flower = that flower\n\n// 特定的一些花\nthe flowers = these flowers = those flowers\n```\n\n### *重点2* \n无生命的所有格写法＝“部分”属于（of）“全部”\n\n我们学过名词的所有格，必须在名词后面加上’s来表示，但这样的写法只限于有生命的“人”或“动物”。但是除了上述的所有格写法，另外还有“无生命”的所有格（物品）写法，它和有生命的所有格（人或动物）写法是不同的。\n\n```md\n有生命的所有格写法＝名词＋’s\n\n约翰的书桌＝Jonn’s desk\n这只猪的鼻子＝the pig’s nose\n```\n\n来看看无生命的所有格写法是怎样的吧！\n\n```md\n// 房子的窗户是坏的\nThe window of the house is broken. \n\n// 房子是无生命的，不能写成：house's\n```\n\n还要注意的是，特指某个物品上的某个部件，都是要加定冠词 `the` 的，比如：\n```md\n// 篮子的把手是好的。\nThe handle of the basket is good.\n\n// 戒指上的钻石是漂亮的。\nThe diamond of the ring is beautiful.\n\n// 句子中的单词是错误的。\nThe word of the sentence is wrong.\n```\n\n## 连词but、and、or\n\n### but\nbut（连词）＝但是，常用于连接两个有转折语气的句子。另外要注意的是，but前面必须加上逗号。\n```md\nBilly is poor, but he is happy.\n```\n\n还要注意的是，`but` 前后必须是意思`不对等`的句子：\n```md\n// 这里就不对，生病了，本就应该躺在床上\n\nI am sick, but I am in bed.\n\n// 对的\nI am sick, but I am happy.\n```\n\n### and\nand（连词）＝而且、和，可用于连接两个意思对等的单词或句子。和but相同的是，如果and连接的是句子，那么and的前面也必须加上逗号。\n```md\n// 又高又聪明\ntall and smart\n\nMy sister and your brother are busy.\n\nThat young person is fat and dirty.\n\nOur parents are angry and sad.\n```\n\n### or\nor也是连词，意思是“还是、或是”。or主要是让对方在答案中“二选一”。另外要特别注意的是“二选一”的念法，音调要先上升后下降。\n\n```md\nfat or thin\n\nIs your son tall or short?\n\nAre those children clean or dirty?\n\nAre those pens ours or theirs?\n```\n\n## 连词 although 及 so\n\n### although\n```md\nAlthough he is rich, he is selfish.\n```\n\n“although”为连词，意思是“虽然”，although的用法和because的用法一样，它们像是两节车厢之间的挂钩，都可以放在“句首”和“句尾”来连接两个句子成为一句。\n\n另外要注意的是，中文常说 “虽然……但是”，但英文却只说“虽然……”后面不会加“但是”，这点要特别注意！\n\n1. although可放句首＝“Although＋句1＋，＋句2”。\n2. although可放句中＝“句1＋although＋句2”，跟 because 一样，放在句中时不需要用逗号隔开。\n\n### so\n\n在英文里 because 和 so 绝对不能一起并用。另外so和and、but一样，前面都要加逗号。\n\n```md\nHe is sick, so he is weak.\n\nBecause he is sick, he is weak.\n```\n\n## There be 的用法\nThere is在这里表示“存在”的意思，也就是中文常说的“有”。因此there is可以表示“……地方有……”。\n\n```md\n\nThere is + 单数名词（a television 📺）\n\nThere are + 复数名词（two pigs🐷🐷）\n\nThere is a television in the living room.\n```\n\n另外There is的疑问句和之前所学过的疑问句一样，将be动词is放到句首，就可以形成疑问句了。记得疑问句句尾语调要上扬！\n\n```md\nIs there a television in the living room?\n\nThere are three books on your desk.\n```\n\n\n## 动词have的用法与三大人称\n英文里一个句子只能有一个动词，因此is和have不能同时出现在同一句子里，要注意！\n\n## 及物动词和不及物动词\n\n实义动词可以分为及物动词和不及物动词。\n\n```md\n及物动词：动词后面必须要有 人/物 作为宾语来承受这个动作\n\n不及物动词：句子较为完整，不需要 人/物 作为宾语。\n```\n\n不及物动词本身句子的意思较为完整，所以动词后面不用有人 / 物作为宾语来承受这个动作。\n```md\n// 我微笑着\nI smile.\n```\n\n大部分的动词都兼具“及物动词”和“不及物动词”两种特性，只有极少部分的动词才会只当“及物动词”使用。另外要注意的是，只有名词和代词才可以担任宾语！\n\n```md\n// 这里的 sings 是及物动词，song 做宾语\nShe sings a song.\n\n// 这里的 sings 是不及物动词，in the room 表地点，房间在这里不能当做宾语。\nShe sings in the room.\n```\n\n## 动词不定式\n在英文句子里一定要有动词，而且一个句子只能有一个动词！如果这个句子必须有“两个动作”才能完整表达语意的话，那该怎么办呢？\n\n这时就需要“to”来帮忙，形成“动词1＋to＋动词2”的结构，而其中“to＋动词2”这样的写法，就称作“不定式”。\n\n要特别注意的是，“to”后面的动词必须要“打回原形”＝“to＋动词原形”。\n```md\nHe likes to run in the park.\n\nJohn's father likes to teach us english in his living room.\n```\n\n英文句子里，若要让两个动词同时存在，除了使用“不定式”的概念，还可以使用“连词and”的概念！\n```md\n// 省略了 and he likes to run.\nHe likes to read and run.\n\nThose cats like to eat and those cats like to sleep.\n\n// 使用 and 省略写法\nThose cats like to eat and sleep.\n```\n\n## 频率副词\n可以把“副词”想成是一种“辅助说明”的词类，也可以把“副词”看成是一种“辅词”！\n```md\nalway\n\nofen\n\nusually\n\nsometimes\n\nseldom(很少)\n\nnever\n```\n\n“频率副词”的用法跟中文相似，通常会放在be动词am / are / is的后面，或是实义动词的前面。\n```\nHe is always busy.\n\nYou are ofen busy.\n\n// 频率副词usually要放在实义动词run的前面。\nHe usually runs in the park.\n```\n\n频率副词里面的usually（通常）和often（常常）两个词通常会混用，不过要细分出两者差异的话，usually（通常）比较常用于“习惯”的表示；而often（常常）比较常用于“次数”的表示\n```md\nThat teacher usually draws in the office.\n\nHer piano is often dirty.\n```\n\n还可以将副词放在句首来使用：\n```md\nThat student sometimes is lazy.\n\nSometimes that student is lazy.\n\nThat teacher sometimes teaches us english.\n\nSometimes that teacher teaches us english.\n```\n\n## 方式副词的构成和用法\n大多放在动词后，用来辅助说明“动作状况”。\n\n```md\nHe runs quickly.\n```\n\n形容词词尾是“辅音＋y”要去掉-y改成-ily\n```md\nhappy => happily\n\nhungry => hungrily\n\nbusy => busily\n\nangry => angrily\n```\n\n## 地点副词及时间副词的用法\n当英文句子里必须说明“地点”时，我们习惯将地点放在句尾来说明，其实“时间”也是。\n\n常用的地点副词：here、there\n\n```md\n// here是地点副词，本身已具备辅助说明“地点位置”的功能，不需要in或at来协助说明。\nI am here.\n\nI teach him English there.\n```\n\n常用的时间副词：today, tonight, now, early, late.\n\n```md\nWe learn history today.\n```\n\n特别注意的是，当“地点和时间”刚好都在同一句时，这时我们要先写地点，再写时间哦！\n```md\nThey are here now.\n\nShe is here now.\n```\n\n## 程度副词\n\n“加强语气”用的“程度副词”，比如 very.\n\n但要注意的是，very是个特别的“程度副词”，只能用来修饰“形容词”和“副词”，像是very beautiful /very well，但不能用来修饰“动词”，如very like就是个错误的写法。\n\n因为very不能修饰动词，所以very无法修饰“like（喜欢）”这个词，因此必须把“他非常喜欢我”写成“他喜欢我＋非常多”。但是“like（喜欢）”，无法用形容“可数名词”的“many（许多的）”来测量出有多少，所以要用形容“不可数名词”的“much（许多的）”来表示。\n\n```md\nShe likes me very much.\n\nThe piano is very good, but it is very old.\n```\n\n“也是”的副词：\n\nalso可以通用于肯定句和否定句，而too只能用于肯定句，either却只能用于否定句。\n\n“also（也是）”的用法其实和“always（总是）”的用法相同，都习惯放在be动词am / are / is的后面，实义动词前面。\n```md\nHe is also a student.\n\nHe is a student too.\n```\n\n如果同时出现两个动词时，就需要“不定式to”来帮忙。\n\n```md\nDo you also like to swim?\n\n// either 用于否定句\nI am not a student, and he is not a student either.\n```\n\nabout, only\n\n“about”经常与数字配合使用。\nonly的用法和always相同，都习惯放于be动词am / are / is后面，实义动词的前面。\n\n## 常和动词搭配的介词 to/ with/ for\n需要指明方向时，“to”这个介词来指出“动作的方向性”。\n```md\nHe runs to that park.\n```\n\n但是若遇到here /there这样的地点副词，因为本身就已经具备辅助说明“地点位置”的功能，因此就不需要介词to来协助说明要去哪个方向，请特别注意！\n\n“去到……地方”＝go to……地方，如果没有特别说明用什么方式“去”时，就可以用“go”来表示“去”的意思。当遇到主语是第三人称单数时，go就要改成goes。\n```md\nHe often goes to the bookstore.\n```\n\n“go to……地方”，通常地方前面要加the，但除了`here / there`不用加the之外，还有几个特别的情况不用加the:\n\n```md\n// 可以理解为，school和bed 是固定的，不需要加 the\n\ngo home\n\ngo to school\n\ngo to bed\n\nHe always goes to school early.\n```\n\n“来到……地方”＝come to……地方，没有特别说明用什么方式“来”时，就用come来表示“来”的意思。当遇到主语是第三人称单数时，记住come要改成comes。\n```md\nHe seldom comes here.\n```\n\n## 原级/比较级/最高级\n\n```md\nShe is as tall(原级) as he（主格）,and she is taller（比较级） than I（主格）.\n```\n\n### 原级\n要特别注意的是，既然是拿两者来比较，当然彼此的地位应该要对等，因此主格的写法也要一致，所以后面的“他”和前面的“我”相同，也要用“主格”写法he，不能用宾格写法him！\n\n\n### 比较级\n所谓“比较级”，表示两者有程度上的差别，因此所使用的形容词 / 副词就需要有特别的写法。\n\n`+ er`\n\n`more`\n\n### 最高级\n所谓“最高级”，表示程度的差异是最大的，因此所使用的形容词 / 副词就要有“差异程度最高”的写法。\n\n`+ est`\n\n`most`\n\n### 更多的 more / 最多的 most\n\n原级：many/much\n\n比较级：more\n\n最高级：most\n\n\n## 现在进行时\n\nbe动词＋动词ing＝是＋正在……\n\n\n\n\n\n\n\n\n## 参考资料\n[^1]: [小王子中英对照朗读](https://www.bilibili.com/video/BV1H64y1f73s?p=1&share_medium=iphone&share_plat=ios&share_session_id=7DD35B6D-AFD5-49C3-8C49-5B8606A0FBC7&share_source=WEIXIN&share_tag=s_i&timestamp=1649473343&unique_k=rfIiVZA)\n[^2]: [英语语法精讲集合](https://www.bilibili.com/video/BV1XY411J7aG?p=1&share_medium=iphone&share_plat=ios&share_session_id=68AF3897-D48F-4D8C-B8A8-0EC4F03D33DC&share_source=WEIXIN&share_tag=s_i&timestamp=1649476740&unique_k=nHkSdbD)\n[^3]: [Youtube 初级—中级—高级 | 跟读训练](https://www.bilibili.com/video/BV1Y7411k7U8?p=1&share_medium=iphone&share_plat=ios&share_session_id=BEAA42C6-E107-4B0F-A976-1B9140498334&share_source=WEIXIN&share_tag=s_i&timestamp=1649474013&unique_k=hzOJtvI)\n[^4]: [Youtube《30本英语原著》](https://www.bilibili.com/video/BV1354y1m77H?p=1&share_medium=iphone&share_plat=ios&share_session_id=4FC86032-3158-4719-AC90-97FC2BD2DA2F&share_source=WEIXIN&share_tag=s_i&timestamp=1649474052&unique_k=DycSmno)\n[^5]: [Youtube《46本英语原著》](https://www.bilibili.com/video/BV1uA411J7v9?p=1&share_medium=iphone&share_plat=ios&share_session_id=FD954A78-020B-4696-AADF-B4EEB9346008&share_source=WEIXIN&share_tag=s_i&timestamp=1649474078&unique_k=JzpJsi8)\n","source":"_drafts/english.md","raw":"---\ntitle: Funny English\ndate: 2022-04-09 14:00:00\ntags: English\nbanner_img: /img/english.webp\nindex_img: /img/english.webp\nexcerpt: Never too old to learn.\n---\n\n## Be 动词\n每一个句子中必定要有一个动词，比如说 Be 动词：\n```md\nI am a boy.\n\nShe is a girl.\n```\n\nBe 动词有三种：is、am、are，表示 \"是\" 的意思。\n\n来看下个几个常用的代词配合 Be 动词的用法\n\n```md\nI am、You are、He/She is、It is、This is、That is...\n```\n\n## 代词\n### 单数代词\n1. 人称单数代词：I、You、She、He\n2. 指示单数代词：It、This、That\n\n代词必定要接be动词\n\n### 复数代词\n1. 人称复数代词：We、You、They、\n2. 指示复数代词：These、Those\n\n常用的复数代词如“我们”“你们”“他们”“这些”“那些”，一定要跟“are”来配合，不可以用“is”。\n\n\n`复数名词`变换形式：\n1. 数目有两个及以上，不过有些名词有特殊规则，例如词尾已经是s，必须再加上es;\n2. 词尾是y就要去y改成ies;\n3. 词尾是f或fe，要去f、fe改成ves.\n\n## 形容词\n形容词通常放在名词的前面。this，that，these，those除了本身作代词之外，也可以有以下形容词的用法：\n```md\nthis boy：这个男孩\nthese boy：这些男孩\nthat boy、those boy\n```\n\n\n## 一般疑问句\n疑问句必须将be动词移到句首，才能形成疑问句。并且语调提升。\n\n## No的用法：\nNo的意思是“不”，主要放于句首，用来回答他人的提问，表示否定的意思。而在句子中的“不”要用“not”来表示。不过要特别注意的是，中文会讲“不是”，但英文却要讲成“是不”，用“be动词＋not”表示。\n\n\n## 人称代词的所有格\n人称代词+名词：表明这个名词属于这个人称代词，比如：My book，这种写法称作所有格，表示名词的归属。\n\n人称代词所有格的有：my、your、his、her、its、our、your（你们的）、thier（他们的）\n\n\n## What 疑问句与专有名词\nWhat是疑问代词＝“什么”的意思，what本身兼具疑问词和代词的特性＝疑问词 （形成疑问语气）＋代词（代表要问的东西）。之前的一般疑问句只要把am, are, is放到句首就可以了；但有疑问词What的疑问句，必须要把what 放到 is, am, are之前句首的位置，形成疑问语气。\n\n比如：\n```md\nWhat is this？\n\n而不能是这样：This is what？\n```\n有What的疑问句，必须提到句首。\n\n## 专有名词\n是独一无二的名词，第一个字母永远都要大写。\n1. 专有名词无论在句子的什么位置，第一个字母永远要大写。\n2. 专有名词因为是独一无二的，所以前面当然不需用再加“a”来表示数量。\n\n“专有名词”常见的种类有以下几种。\n  ```js\n  人名 例如，John约翰。\n  地名 例如，Taipei台北。\n  国家 例如，America美国。\n  语言 例如，English英文。\n  ```\n\n## 疑问词\n\n### Why疑问句的用法\n\n\n### What疑问句的用法\n\n\n### Who疑问句的用法\n```md\nWho is that boy.\n```\n\nWho是疑问代词＝“谁”的意思，所以Who＝疑问词（形成疑问语气）＋代词（代表要问的人）。Who的用法和前面所学的“What”“Why”相同，都必须放在am, are, is之前句首的位置形成疑问语气。\n\n\n### How疑问句的用法\n\n\n### Where疑问句的用法\n\n### Whose疑问句的用法\n代表“谁的东西”，比如:\n  ```js\n  Whose cat is this? // 这只猫是谁的？\n  ```\n\n### Which疑问句的用法\nWhich意思是“哪一个 / 哪一些”。Which可以代表单数，也可以代表复数。\n1. 单数：Which is 哪一个\n2. 复数：Which are 哪一些\n\n比如：\n\n```md\nWhich is my book? // 哪本书是我的？\nWhich are my chairs? // 哪些椅子是我的？\n```\n\n也可以当做形容词用:\n```md\nWhich books are mine?\n```\n\n\n\n## 介词 in\nin（介词）＝“在……里面”的意思。in的后面常搭配空间（盒子 / 房屋）。\n\n## 介词 on\n“on”这个介词＝“在……上面”的意思，但是这里所说的“上面”，并不是“漂浮在东西的上空”喔，而是必须接触到东西的表面，才能使用“on”来说明！\n\n### 其他介词\n```md\nat：“在......地点旁边”\n\nbeside：“在... 旁边”，靠的很近，有靠在什么东西旁边的感觉\n\nnear：“在...附近”\n\nunder：“在...正下方”\n\nover：“在...正上方”，强调正上方\n\nbelow：“在...下方”\n\nabove：“在...上方”\n\n```\n\n“在树上”有两种写法，“属于树本身的东西”，如果实、叶子等要用“on”，而“在树枝间穿梭的小动物”，如鸟、猴子等要用“in”喔！\n\n\n## 单数/复数名词所有格\n\n```md\nJohn’s father is a doctor.\n```\n\n我们常讲你的、我的、妈妈的、约翰的等，其实在英文里面也有相同的讲法，只是在中文里，通常会在名词的后面加上“的”，英文却是要在名词后面加上’s来表示。而这样的写法，我们称为“所有格”，用来说明东西的所有权归属。\n\n名词的所有格：只限于有生命的“人”或“动物”。\n\n1. 单数名词的所有格写法＝单数名词＋’s\n2. 复数名词的所有格：\n  - 词尾有s的，要写成s’，比如 cats'、girls'、parents'\n  - 复数名词词尾没有 s 的，要加上 's，比如 men's、women's、children's\n\n### 所有格代词：为了避免重复叙述\n\n所有格代词 = 代词 + 名词\n\nmine,our,yours,hers,thiers,its\n\n```md\nThis book is mine.\n\nOr\n\nThis book is my book.\n```\n\n## 定冠词the的用法及无生命的所有格\n\n```md\nThe flower is beautiful.\n\nThe flowers are beautiful.\n```\n\nthe 除了可以代替“a”之外，the也可以代替“these / those”，因此the可以通用于单复数名词!\n\n### *重点1* \nthe 主要用来指出“特定的人或物”，可通用于单复数名词。\n\n```md\n// 特定的一朵花\nthe flower = this flower = that flower\n\n// 特定的一些花\nthe flowers = these flowers = those flowers\n```\n\n### *重点2* \n无生命的所有格写法＝“部分”属于（of）“全部”\n\n我们学过名词的所有格，必须在名词后面加上’s来表示，但这样的写法只限于有生命的“人”或“动物”。但是除了上述的所有格写法，另外还有“无生命”的所有格（物品）写法，它和有生命的所有格（人或动物）写法是不同的。\n\n```md\n有生命的所有格写法＝名词＋’s\n\n约翰的书桌＝Jonn’s desk\n这只猪的鼻子＝the pig’s nose\n```\n\n来看看无生命的所有格写法是怎样的吧！\n\n```md\n// 房子的窗户是坏的\nThe window of the house is broken. \n\n// 房子是无生命的，不能写成：house's\n```\n\n还要注意的是，特指某个物品上的某个部件，都是要加定冠词 `the` 的，比如：\n```md\n// 篮子的把手是好的。\nThe handle of the basket is good.\n\n// 戒指上的钻石是漂亮的。\nThe diamond of the ring is beautiful.\n\n// 句子中的单词是错误的。\nThe word of the sentence is wrong.\n```\n\n## 连词but、and、or\n\n### but\nbut（连词）＝但是，常用于连接两个有转折语气的句子。另外要注意的是，but前面必须加上逗号。\n```md\nBilly is poor, but he is happy.\n```\n\n还要注意的是，`but` 前后必须是意思`不对等`的句子：\n```md\n// 这里就不对，生病了，本就应该躺在床上\n\nI am sick, but I am in bed.\n\n// 对的\nI am sick, but I am happy.\n```\n\n### and\nand（连词）＝而且、和，可用于连接两个意思对等的单词或句子。和but相同的是，如果and连接的是句子，那么and的前面也必须加上逗号。\n```md\n// 又高又聪明\ntall and smart\n\nMy sister and your brother are busy.\n\nThat young person is fat and dirty.\n\nOur parents are angry and sad.\n```\n\n### or\nor也是连词，意思是“还是、或是”。or主要是让对方在答案中“二选一”。另外要特别注意的是“二选一”的念法，音调要先上升后下降。\n\n```md\nfat or thin\n\nIs your son tall or short?\n\nAre those children clean or dirty?\n\nAre those pens ours or theirs?\n```\n\n## 连词 although 及 so\n\n### although\n```md\nAlthough he is rich, he is selfish.\n```\n\n“although”为连词，意思是“虽然”，although的用法和because的用法一样，它们像是两节车厢之间的挂钩，都可以放在“句首”和“句尾”来连接两个句子成为一句。\n\n另外要注意的是，中文常说 “虽然……但是”，但英文却只说“虽然……”后面不会加“但是”，这点要特别注意！\n\n1. although可放句首＝“Although＋句1＋，＋句2”。\n2. although可放句中＝“句1＋although＋句2”，跟 because 一样，放在句中时不需要用逗号隔开。\n\n### so\n\n在英文里 because 和 so 绝对不能一起并用。另外so和and、but一样，前面都要加逗号。\n\n```md\nHe is sick, so he is weak.\n\nBecause he is sick, he is weak.\n```\n\n## There be 的用法\nThere is在这里表示“存在”的意思，也就是中文常说的“有”。因此there is可以表示“……地方有……”。\n\n```md\n\nThere is + 单数名词（a television 📺）\n\nThere are + 复数名词（two pigs🐷🐷）\n\nThere is a television in the living room.\n```\n\n另外There is的疑问句和之前所学过的疑问句一样，将be动词is放到句首，就可以形成疑问句了。记得疑问句句尾语调要上扬！\n\n```md\nIs there a television in the living room?\n\nThere are three books on your desk.\n```\n\n\n## 动词have的用法与三大人称\n英文里一个句子只能有一个动词，因此is和have不能同时出现在同一句子里，要注意！\n\n## 及物动词和不及物动词\n\n实义动词可以分为及物动词和不及物动词。\n\n```md\n及物动词：动词后面必须要有 人/物 作为宾语来承受这个动作\n\n不及物动词：句子较为完整，不需要 人/物 作为宾语。\n```\n\n不及物动词本身句子的意思较为完整，所以动词后面不用有人 / 物作为宾语来承受这个动作。\n```md\n// 我微笑着\nI smile.\n```\n\n大部分的动词都兼具“及物动词”和“不及物动词”两种特性，只有极少部分的动词才会只当“及物动词”使用。另外要注意的是，只有名词和代词才可以担任宾语！\n\n```md\n// 这里的 sings 是及物动词，song 做宾语\nShe sings a song.\n\n// 这里的 sings 是不及物动词，in the room 表地点，房间在这里不能当做宾语。\nShe sings in the room.\n```\n\n## 动词不定式\n在英文句子里一定要有动词，而且一个句子只能有一个动词！如果这个句子必须有“两个动作”才能完整表达语意的话，那该怎么办呢？\n\n这时就需要“to”来帮忙，形成“动词1＋to＋动词2”的结构，而其中“to＋动词2”这样的写法，就称作“不定式”。\n\n要特别注意的是，“to”后面的动词必须要“打回原形”＝“to＋动词原形”。\n```md\nHe likes to run in the park.\n\nJohn's father likes to teach us english in his living room.\n```\n\n英文句子里，若要让两个动词同时存在，除了使用“不定式”的概念，还可以使用“连词and”的概念！\n```md\n// 省略了 and he likes to run.\nHe likes to read and run.\n\nThose cats like to eat and those cats like to sleep.\n\n// 使用 and 省略写法\nThose cats like to eat and sleep.\n```\n\n## 频率副词\n可以把“副词”想成是一种“辅助说明”的词类，也可以把“副词”看成是一种“辅词”！\n```md\nalway\n\nofen\n\nusually\n\nsometimes\n\nseldom(很少)\n\nnever\n```\n\n“频率副词”的用法跟中文相似，通常会放在be动词am / are / is的后面，或是实义动词的前面。\n```\nHe is always busy.\n\nYou are ofen busy.\n\n// 频率副词usually要放在实义动词run的前面。\nHe usually runs in the park.\n```\n\n频率副词里面的usually（通常）和often（常常）两个词通常会混用，不过要细分出两者差异的话，usually（通常）比较常用于“习惯”的表示；而often（常常）比较常用于“次数”的表示\n```md\nThat teacher usually draws in the office.\n\nHer piano is often dirty.\n```\n\n还可以将副词放在句首来使用：\n```md\nThat student sometimes is lazy.\n\nSometimes that student is lazy.\n\nThat teacher sometimes teaches us english.\n\nSometimes that teacher teaches us english.\n```\n\n## 方式副词的构成和用法\n大多放在动词后，用来辅助说明“动作状况”。\n\n```md\nHe runs quickly.\n```\n\n形容词词尾是“辅音＋y”要去掉-y改成-ily\n```md\nhappy => happily\n\nhungry => hungrily\n\nbusy => busily\n\nangry => angrily\n```\n\n## 地点副词及时间副词的用法\n当英文句子里必须说明“地点”时，我们习惯将地点放在句尾来说明，其实“时间”也是。\n\n常用的地点副词：here、there\n\n```md\n// here是地点副词，本身已具备辅助说明“地点位置”的功能，不需要in或at来协助说明。\nI am here.\n\nI teach him English there.\n```\n\n常用的时间副词：today, tonight, now, early, late.\n\n```md\nWe learn history today.\n```\n\n特别注意的是，当“地点和时间”刚好都在同一句时，这时我们要先写地点，再写时间哦！\n```md\nThey are here now.\n\nShe is here now.\n```\n\n## 程度副词\n\n“加强语气”用的“程度副词”，比如 very.\n\n但要注意的是，very是个特别的“程度副词”，只能用来修饰“形容词”和“副词”，像是very beautiful /very well，但不能用来修饰“动词”，如very like就是个错误的写法。\n\n因为very不能修饰动词，所以very无法修饰“like（喜欢）”这个词，因此必须把“他非常喜欢我”写成“他喜欢我＋非常多”。但是“like（喜欢）”，无法用形容“可数名词”的“many（许多的）”来测量出有多少，所以要用形容“不可数名词”的“much（许多的）”来表示。\n\n```md\nShe likes me very much.\n\nThe piano is very good, but it is very old.\n```\n\n“也是”的副词：\n\nalso可以通用于肯定句和否定句，而too只能用于肯定句，either却只能用于否定句。\n\n“also（也是）”的用法其实和“always（总是）”的用法相同，都习惯放在be动词am / are / is的后面，实义动词前面。\n```md\nHe is also a student.\n\nHe is a student too.\n```\n\n如果同时出现两个动词时，就需要“不定式to”来帮忙。\n\n```md\nDo you also like to swim?\n\n// either 用于否定句\nI am not a student, and he is not a student either.\n```\n\nabout, only\n\n“about”经常与数字配合使用。\nonly的用法和always相同，都习惯放于be动词am / are / is后面，实义动词的前面。\n\n## 常和动词搭配的介词 to/ with/ for\n需要指明方向时，“to”这个介词来指出“动作的方向性”。\n```md\nHe runs to that park.\n```\n\n但是若遇到here /there这样的地点副词，因为本身就已经具备辅助说明“地点位置”的功能，因此就不需要介词to来协助说明要去哪个方向，请特别注意！\n\n“去到……地方”＝go to……地方，如果没有特别说明用什么方式“去”时，就可以用“go”来表示“去”的意思。当遇到主语是第三人称单数时，go就要改成goes。\n```md\nHe often goes to the bookstore.\n```\n\n“go to……地方”，通常地方前面要加the，但除了`here / there`不用加the之外，还有几个特别的情况不用加the:\n\n```md\n// 可以理解为，school和bed 是固定的，不需要加 the\n\ngo home\n\ngo to school\n\ngo to bed\n\nHe always goes to school early.\n```\n\n“来到……地方”＝come to……地方，没有特别说明用什么方式“来”时，就用come来表示“来”的意思。当遇到主语是第三人称单数时，记住come要改成comes。\n```md\nHe seldom comes here.\n```\n\n## 原级/比较级/最高级\n\n```md\nShe is as tall(原级) as he（主格）,and she is taller（比较级） than I（主格）.\n```\n\n### 原级\n要特别注意的是，既然是拿两者来比较，当然彼此的地位应该要对等，因此主格的写法也要一致，所以后面的“他”和前面的“我”相同，也要用“主格”写法he，不能用宾格写法him！\n\n\n### 比较级\n所谓“比较级”，表示两者有程度上的差别，因此所使用的形容词 / 副词就需要有特别的写法。\n\n`+ er`\n\n`more`\n\n### 最高级\n所谓“最高级”，表示程度的差异是最大的，因此所使用的形容词 / 副词就要有“差异程度最高”的写法。\n\n`+ est`\n\n`most`\n\n### 更多的 more / 最多的 most\n\n原级：many/much\n\n比较级：more\n\n最高级：most\n\n\n## 现在进行时\n\nbe动词＋动词ing＝是＋正在……\n\n\n\n\n\n\n\n\n## 参考资料\n[^1]: [小王子中英对照朗读](https://www.bilibili.com/video/BV1H64y1f73s?p=1&share_medium=iphone&share_plat=ios&share_session_id=7DD35B6D-AFD5-49C3-8C49-5B8606A0FBC7&share_source=WEIXIN&share_tag=s_i&timestamp=1649473343&unique_k=rfIiVZA)\n[^2]: [英语语法精讲集合](https://www.bilibili.com/video/BV1XY411J7aG?p=1&share_medium=iphone&share_plat=ios&share_session_id=68AF3897-D48F-4D8C-B8A8-0EC4F03D33DC&share_source=WEIXIN&share_tag=s_i&timestamp=1649476740&unique_k=nHkSdbD)\n[^3]: [Youtube 初级—中级—高级 | 跟读训练](https://www.bilibili.com/video/BV1Y7411k7U8?p=1&share_medium=iphone&share_plat=ios&share_session_id=BEAA42C6-E107-4B0F-A976-1B9140498334&share_source=WEIXIN&share_tag=s_i&timestamp=1649474013&unique_k=hzOJtvI)\n[^4]: [Youtube《30本英语原著》](https://www.bilibili.com/video/BV1354y1m77H?p=1&share_medium=iphone&share_plat=ios&share_session_id=4FC86032-3158-4719-AC90-97FC2BD2DA2F&share_source=WEIXIN&share_tag=s_i&timestamp=1649474052&unique_k=DycSmno)\n[^5]: [Youtube《46本英语原著》](https://www.bilibili.com/video/BV1uA411J7v9?p=1&share_medium=iphone&share_plat=ios&share_session_id=FD954A78-020B-4696-AADF-B4EEB9346008&share_source=WEIXIN&share_tag=s_i&timestamp=1649474078&unique_k=JzpJsi8)\n","slug":"english","published":0,"updated":"2023-05-12T10:49:20.011Z","comments":1,"layout":"post","photos":[],"link":"","_id":"clhkizgy9002w3y0q91mw9zlr","content":"<h2 id=\"Be-动词\"><a href=\"#Be-动词\" class=\"headerlink\" title=\"Be 动词\"></a>Be 动词</h2><p>每一个句子中必定要有一个动词，比如说 Be 动词：</p>\n<figure class=\"highlight md\"><table><tr><td class=\"gutter\"><div class=\"code-wrapper\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></div></td><td class=\"code\"><pre><code class=\"hljs md\">I am a boy.<br><br>She is a girl.<br></code></pre></td></tr></table></figure>\n\n<p>Be 动词有三种：is、am、are，表示 “是” 的意思。</p>\n<p>来看下个几个常用的代词配合 Be 动词的用法</p>\n<figure class=\"highlight md\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs md\">I am、You are、He/She is、It is、This is、That is...<br></code></pre></td></tr></table></figure>\n\n<h2 id=\"代词\"><a href=\"#代词\" class=\"headerlink\" title=\"代词\"></a>代词</h2><h3 id=\"单数代词\"><a href=\"#单数代词\" class=\"headerlink\" title=\"单数代词\"></a>单数代词</h3><ol>\n<li>人称单数代词：I、You、She、He</li>\n<li>指示单数代词：It、This、That</li>\n</ol>\n<p>代词必定要接be动词</p>\n<h3 id=\"复数代词\"><a href=\"#复数代词\" class=\"headerlink\" title=\"复数代词\"></a>复数代词</h3><ol>\n<li>人称复数代词：We、You、They、</li>\n<li>指示复数代词：These、Those</li>\n</ol>\n<p>常用的复数代词如“我们”“你们”“他们”“这些”“那些”，一定要跟“are”来配合，不可以用“is”。</p>\n<p><code>复数名词</code>变换形式：</p>\n<ol>\n<li>数目有两个及以上，不过有些名词有特殊规则，例如词尾已经是s，必须再加上es;</li>\n<li>词尾是y就要去y改成ies;</li>\n<li>词尾是f或fe，要去f、fe改成ves.</li>\n</ol>\n<h2 id=\"形容词\"><a href=\"#形容词\" class=\"headerlink\" title=\"形容词\"></a>形容词</h2><p>形容词通常放在名词的前面。this，that，these，those除了本身作代词之外，也可以有以下形容词的用法：</p>\n<figure class=\"highlight md\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs md\">this boy：这个男孩<br>these boy：这些男孩<br>that boy、those boy<br></code></pre></td></tr></table></figure>\n\n\n<h2 id=\"一般疑问句\"><a href=\"#一般疑问句\" class=\"headerlink\" title=\"一般疑问句\"></a>一般疑问句</h2><p>疑问句必须将be动词移到句首，才能形成疑问句。并且语调提升。</p>\n<h2 id=\"No的用法：\"><a href=\"#No的用法：\" class=\"headerlink\" title=\"No的用法：\"></a>No的用法：</h2><p>No的意思是“不”，主要放于句首，用来回答他人的提问，表示否定的意思。而在句子中的“不”要用“not”来表示。不过要特别注意的是，中文会讲“不是”，但英文却要讲成“是不”，用“be动词＋not”表示。</p>\n<h2 id=\"人称代词的所有格\"><a href=\"#人称代词的所有格\" class=\"headerlink\" title=\"人称代词的所有格\"></a>人称代词的所有格</h2><p>人称代词+名词：表明这个名词属于这个人称代词，比如：My book，这种写法称作所有格，表示名词的归属。</p>\n<p>人称代词所有格的有：my、your、his、her、its、our、your（你们的）、thier（他们的）</p>\n<h2 id=\"What-疑问句与专有名词\"><a href=\"#What-疑问句与专有名词\" class=\"headerlink\" title=\"What 疑问句与专有名词\"></a>What 疑问句与专有名词</h2><p>What是疑问代词＝“什么”的意思，what本身兼具疑问词和代词的特性＝疑问词 （形成疑问语气）＋代词（代表要问的东西）。之前的一般疑问句只要把am, are, is放到句首就可以了；但有疑问词What的疑问句，必须要把what 放到 is, am, are之前句首的位置，形成疑问语气。</p>\n<p>比如：</p>\n<figure class=\"highlight md\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs md\">What is this？<br><br>而不能是这样：This is what？<br></code></pre></td></tr></table></figure>\n<p>有What的疑问句，必须提到句首。</p>\n<h2 id=\"专有名词\"><a href=\"#专有名词\" class=\"headerlink\" title=\"专有名词\"></a>专有名词</h2><p>是独一无二的名词，第一个字母永远都要大写。</p>\n<ol>\n<li>专有名词无论在句子的什么位置，第一个字母永远要大写。</li>\n<li>专有名词因为是独一无二的，所以前面当然不需用再加“a”来表示数量。</li>\n</ol>\n<p>“专有名词”常见的种类有以下几种。<br>  <figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\">人名 例如，<span class=\"hljs-title class_\">John</span>约翰。<br>地名 例如，<span class=\"hljs-title class_\">Taipei</span>台北。<br>国家 例如，<span class=\"hljs-title class_\">America</span>美国。<br>语言 例如，<span class=\"hljs-title class_\">English</span>英文。<br></code></pre></td></tr></table></figure></p>\n<h2 id=\"疑问词\"><a href=\"#疑问词\" class=\"headerlink\" title=\"疑问词\"></a>疑问词</h2><h3 id=\"Why疑问句的用法\"><a href=\"#Why疑问句的用法\" class=\"headerlink\" title=\"Why疑问句的用法\"></a>Why疑问句的用法</h3><h3 id=\"What疑问句的用法\"><a href=\"#What疑问句的用法\" class=\"headerlink\" title=\"What疑问句的用法\"></a>What疑问句的用法</h3><h3 id=\"Who疑问句的用法\"><a href=\"#Who疑问句的用法\" class=\"headerlink\" title=\"Who疑问句的用法\"></a>Who疑问句的用法</h3><figure class=\"highlight md\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs md\">Who is that boy.<br></code></pre></td></tr></table></figure>\n\n<p>Who是疑问代词＝“谁”的意思，所以Who＝疑问词（形成疑问语气）＋代词（代表要问的人）。Who的用法和前面所学的“What”“Why”相同，都必须放在am, are, is之前句首的位置形成疑问语气。</p>\n<h3 id=\"How疑问句的用法\"><a href=\"#How疑问句的用法\" class=\"headerlink\" title=\"How疑问句的用法\"></a>How疑问句的用法</h3><h3 id=\"Where疑问句的用法\"><a href=\"#Where疑问句的用法\" class=\"headerlink\" title=\"Where疑问句的用法\"></a>Where疑问句的用法</h3><h3 id=\"Whose疑问句的用法\"><a href=\"#Whose疑问句的用法\" class=\"headerlink\" title=\"Whose疑问句的用法\"></a>Whose疑问句的用法</h3><p>代表“谁的东西”，比如:<br>  <figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\"><span class=\"hljs-title class_\">Whose</span> cat is <span class=\"hljs-variable language_\">this</span>? <span class=\"hljs-comment\">// 这只猫是谁的？</span><br></code></pre></td></tr></table></figure></p>\n<h3 id=\"Which疑问句的用法\"><a href=\"#Which疑问句的用法\" class=\"headerlink\" title=\"Which疑问句的用法\"></a>Which疑问句的用法</h3><p>Which意思是“哪一个 / 哪一些”。Which可以代表单数，也可以代表复数。</p>\n<ol>\n<li>单数：Which is 哪一个</li>\n<li>复数：Which are 哪一些</li>\n</ol>\n<p>比如：</p>\n<figure class=\"highlight md\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs md\">Which is my book? // 哪本书是我的？<br>Which are my chairs? // 哪些椅子是我的？<br></code></pre></td></tr></table></figure>\n\n<p>也可以当做形容词用:</p>\n<figure class=\"highlight md\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs md\">Which books are mine?<br></code></pre></td></tr></table></figure>\n\n\n\n<h2 id=\"介词-in\"><a href=\"#介词-in\" class=\"headerlink\" title=\"介词 in\"></a>介词 in</h2><p>in（介词）＝“在……里面”的意思。in的后面常搭配空间（盒子 / 房屋）。</p>\n<h2 id=\"介词-on\"><a href=\"#介词-on\" class=\"headerlink\" title=\"介词 on\"></a>介词 on</h2><p>“on”这个介词＝“在……上面”的意思，但是这里所说的“上面”，并不是“漂浮在东西的上空”喔，而是必须接触到东西的表面，才能使用“on”来说明！</p>\n<h3 id=\"其他介词\"><a href=\"#其他介词\" class=\"headerlink\" title=\"其他介词\"></a>其他介词</h3><figure class=\"highlight md\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs md\">at：“在......地点旁边”<br><br>beside：“在... 旁边”，靠的很近，有靠在什么东西旁边的感觉<br><br>near：“在...附近”<br><br>under：“在...正下方”<br><br>over：“在...正上方”，强调正上方<br><br>below：“在...下方”<br><br>above：“在...上方”<br><br></code></pre></td></tr></table></figure>\n\n<p>“在树上”有两种写法，“属于树本身的东西”，如果实、叶子等要用“on”，而“在树枝间穿梭的小动物”，如鸟、猴子等要用“in”喔！</p>\n<h2 id=\"单数-复数名词所有格\"><a href=\"#单数-复数名词所有格\" class=\"headerlink\" title=\"单数/复数名词所有格\"></a>单数/复数名词所有格</h2><figure class=\"highlight md\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs md\">John’s father is a doctor.<br></code></pre></td></tr></table></figure>\n\n<p>我们常讲你的、我的、妈妈的、约翰的等，其实在英文里面也有相同的讲法，只是在中文里，通常会在名词的后面加上“的”，英文却是要在名词后面加上’s来表示。而这样的写法，我们称为“所有格”，用来说明东西的所有权归属。</p>\n<p>名词的所有格：只限于有生命的“人”或“动物”。</p>\n<ol>\n<li>单数名词的所有格写法＝单数名词＋’s</li>\n<li>复数名词的所有格：<ul>\n<li>词尾有s的，要写成s’，比如 cats’、girls’、parents’</li>\n<li>复数名词词尾没有 s 的，要加上 ‘s，比如 men’s、women’s、children’s</li>\n</ul>\n</li>\n</ol>\n<h3 id=\"所有格代词：为了避免重复叙述\"><a href=\"#所有格代词：为了避免重复叙述\" class=\"headerlink\" title=\"所有格代词：为了避免重复叙述\"></a>所有格代词：为了避免重复叙述</h3><p>所有格代词 = 代词 + 名词</p>\n<p>mine,our,yours,hers,thiers,its</p>\n<figure class=\"highlight md\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs md\">This book is mine.<br><br>Or<br><br>This book is my book.<br></code></pre></td></tr></table></figure>\n\n<h2 id=\"定冠词the的用法及无生命的所有格\"><a href=\"#定冠词the的用法及无生命的所有格\" class=\"headerlink\" title=\"定冠词the的用法及无生命的所有格\"></a>定冠词the的用法及无生命的所有格</h2><figure class=\"highlight md\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs md\">The flower is beautiful.<br><br>The flowers are beautiful.<br></code></pre></td></tr></table></figure>\n\n<p>the 除了可以代替“a”之外，the也可以代替“these / those”，因此the可以通用于单复数名词!</p>\n<h3 id=\"重点1\"><a href=\"#重点1\" class=\"headerlink\" title=\"重点1\"></a><em>重点1</em></h3><p>the 主要用来指出“特定的人或物”，可通用于单复数名词。</p>\n<figure class=\"highlight md\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs md\">// 特定的一朵花<br>the flower = this flower = that flower<br><br>// 特定的一些花<br>the flowers = these flowers = those flowers<br></code></pre></td></tr></table></figure>\n\n<h3 id=\"重点2\"><a href=\"#重点2\" class=\"headerlink\" title=\"重点2\"></a><em>重点2</em></h3><p>无生命的所有格写法＝“部分”属于（of）“全部”</p>\n<p>我们学过名词的所有格，必须在名词后面加上’s来表示，但这样的写法只限于有生命的“人”或“动物”。但是除了上述的所有格写法，另外还有“无生命”的所有格（物品）写法，它和有生命的所有格（人或动物）写法是不同的。</p>\n<figure class=\"highlight md\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs md\">有生命的所有格写法＝名词＋’s<br><br>约翰的书桌＝Jonn’s desk<br>这只猪的鼻子＝the pig’s nose<br></code></pre></td></tr></table></figure>\n\n<p>来看看无生命的所有格写法是怎样的吧！</p>\n<figure class=\"highlight md\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs md\">// 房子的窗户是坏的<br>The window of the house is broken. <br><br>// 房子是无生命的，不能写成：house&#x27;s<br></code></pre></td></tr></table></figure>\n\n<p>还要注意的是，特指某个物品上的某个部件，都是要加定冠词 <code>the</code> 的，比如：</p>\n<figure class=\"highlight md\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs md\">// 篮子的把手是好的。<br>The handle of the basket is good.<br><br>// 戒指上的钻石是漂亮的。<br>The diamond of the ring is beautiful.<br><br>// 句子中的单词是错误的。<br>The word of the sentence is wrong.<br></code></pre></td></tr></table></figure>\n\n<h2 id=\"连词but、and、or\"><a href=\"#连词but、and、or\" class=\"headerlink\" title=\"连词but、and、or\"></a>连词but、and、or</h2><h3 id=\"but\"><a href=\"#but\" class=\"headerlink\" title=\"but\"></a>but</h3><p>but（连词）＝但是，常用于连接两个有转折语气的句子。另外要注意的是，but前面必须加上逗号。</p>\n<figure class=\"highlight md\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs md\">Billy is poor, but he is happy.<br></code></pre></td></tr></table></figure>\n\n<p>还要注意的是，<code>but</code> 前后必须是意思<code>不对等</code>的句子：</p>\n<figure class=\"highlight md\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs md\">// 这里就不对，生病了，本就应该躺在床上<br><br>I am sick, but I am in bed.<br><br>// 对的<br>I am sick, but I am happy.<br></code></pre></td></tr></table></figure>\n\n<h3 id=\"and\"><a href=\"#and\" class=\"headerlink\" title=\"and\"></a>and</h3><p>and（连词）＝而且、和，可用于连接两个意思对等的单词或句子。和but相同的是，如果and连接的是句子，那么and的前面也必须加上逗号。</p>\n<figure class=\"highlight md\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs md\">// 又高又聪明<br>tall and smart<br><br>My sister and your brother are busy.<br><br>That young person is fat and dirty.<br><br>Our parents are angry and sad.<br></code></pre></td></tr></table></figure>\n\n<h3 id=\"or\"><a href=\"#or\" class=\"headerlink\" title=\"or\"></a>or</h3><p>or也是连词，意思是“还是、或是”。or主要是让对方在答案中“二选一”。另外要特别注意的是“二选一”的念法，音调要先上升后下降。</p>\n<figure class=\"highlight md\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs md\">fat or thin<br><br>Is your son tall or short?<br><br>Are those children clean or dirty?<br><br>Are those pens ours or theirs?<br></code></pre></td></tr></table></figure>\n\n<h2 id=\"连词-although-及-so\"><a href=\"#连词-although-及-so\" class=\"headerlink\" title=\"连词 although 及 so\"></a>连词 although 及 so</h2><h3 id=\"although\"><a href=\"#although\" class=\"headerlink\" title=\"although\"></a>although</h3><figure class=\"highlight md\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs md\">Although he is rich, he is selfish.<br></code></pre></td></tr></table></figure>\n\n<p>“although”为连词，意思是“虽然”，although的用法和because的用法一样，它们像是两节车厢之间的挂钩，都可以放在“句首”和“句尾”来连接两个句子成为一句。</p>\n<p>另外要注意的是，中文常说 “虽然……但是”，但英文却只说“虽然……”后面不会加“但是”，这点要特别注意！</p>\n<ol>\n<li>although可放句首＝“Although＋句1＋，＋句2”。</li>\n<li>although可放句中＝“句1＋although＋句2”，跟 because 一样，放在句中时不需要用逗号隔开。</li>\n</ol>\n<h3 id=\"so\"><a href=\"#so\" class=\"headerlink\" title=\"so\"></a>so</h3><p>在英文里 because 和 so 绝对不能一起并用。另外so和and、but一样，前面都要加逗号。</p>\n<figure class=\"highlight md\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs md\">He is sick, so he is weak.<br><br>Because he is sick, he is weak.<br></code></pre></td></tr></table></figure>\n\n<h2 id=\"There-be-的用法\"><a href=\"#There-be-的用法\" class=\"headerlink\" title=\"There be 的用法\"></a>There be 的用法</h2><p>There is在这里表示“存在”的意思，也就是中文常说的“有”。因此there is可以表示“……地方有……”。</p>\n<figure class=\"highlight md\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs md\"><br>There is + 单数名词（a television 📺）<br><br>There are + 复数名词（two pigs🐷🐷）<br><br>There is a television in the living room.<br></code></pre></td></tr></table></figure>\n\n<p>另外There is的疑问句和之前所学过的疑问句一样，将be动词is放到句首，就可以形成疑问句了。记得疑问句句尾语调要上扬！</p>\n<figure class=\"highlight md\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs md\">Is there a television in the living room?<br><br>There are three books on your desk.<br></code></pre></td></tr></table></figure>\n\n\n<h2 id=\"动词have的用法与三大人称\"><a href=\"#动词have的用法与三大人称\" class=\"headerlink\" title=\"动词have的用法与三大人称\"></a>动词have的用法与三大人称</h2><p>英文里一个句子只能有一个动词，因此is和have不能同时出现在同一句子里，要注意！</p>\n<h2 id=\"及物动词和不及物动词\"><a href=\"#及物动词和不及物动词\" class=\"headerlink\" title=\"及物动词和不及物动词\"></a>及物动词和不及物动词</h2><p>实义动词可以分为及物动词和不及物动词。</p>\n<figure class=\"highlight md\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs md\">及物动词：动词后面必须要有 人/物 作为宾语来承受这个动作<br><br>不及物动词：句子较为完整，不需要 人/物 作为宾语。<br></code></pre></td></tr></table></figure>\n\n<p>不及物动词本身句子的意思较为完整，所以动词后面不用有人 / 物作为宾语来承受这个动作。</p>\n<figure class=\"highlight md\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs md\">// 我微笑着<br>I smile.<br></code></pre></td></tr></table></figure>\n\n<p>大部分的动词都兼具“及物动词”和“不及物动词”两种特性，只有极少部分的动词才会只当“及物动词”使用。另外要注意的是，只有名词和代词才可以担任宾语！</p>\n<figure class=\"highlight md\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs md\">// 这里的 sings 是及物动词，song 做宾语<br>She sings a song.<br><br>// 这里的 sings 是不及物动词，in the room 表地点，房间在这里不能当做宾语。<br>She sings in the room.<br></code></pre></td></tr></table></figure>\n\n<h2 id=\"动词不定式\"><a href=\"#动词不定式\" class=\"headerlink\" title=\"动词不定式\"></a>动词不定式</h2><p>在英文句子里一定要有动词，而且一个句子只能有一个动词！如果这个句子必须有“两个动作”才能完整表达语意的话，那该怎么办呢？</p>\n<p>这时就需要“to”来帮忙，形成“动词1＋to＋动词2”的结构，而其中“to＋动词2”这样的写法，就称作“不定式”。</p>\n<p>要特别注意的是，“to”后面的动词必须要“打回原形”＝“to＋动词原形”。</p>\n<figure class=\"highlight md\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs md\">He likes to run in the park.<br><br>John&#x27;s father likes to teach us english in his living room.<br></code></pre></td></tr></table></figure>\n\n<p>英文句子里，若要让两个动词同时存在，除了使用“不定式”的概念，还可以使用“连词and”的概念！</p>\n<figure class=\"highlight md\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs md\">// 省略了 and he likes to run.<br>He likes to read and run.<br><br>Those cats like to eat and those cats like to sleep.<br><br>// 使用 and 省略写法<br>Those cats like to eat and sleep.<br></code></pre></td></tr></table></figure>\n\n<h2 id=\"频率副词\"><a href=\"#频率副词\" class=\"headerlink\" title=\"频率副词\"></a>频率副词</h2><p>可以把“副词”想成是一种“辅助说明”的词类，也可以把“副词”看成是一种“辅词”！</p>\n<figure class=\"highlight md\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs md\">alway<br><br>ofen<br><br>usually<br><br>sometimes<br><br>seldom(很少)<br><br>never<br></code></pre></td></tr></table></figure>\n\n<p>“频率副词”的用法跟中文相似，通常会放在be动词am / are / is的后面，或是实义动词的前面。</p>\n<figure class=\"highlight mercury\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs mercury\">He <span class=\"hljs-keyword\">is</span> always busy.<br><br>You are ofen busy.<br><br>// 频率副词usually要放在实义动词run的前面。<br>He usually runs in the park.<br></code></pre></td></tr></table></figure>\n\n<p>频率副词里面的usually（通常）和often（常常）两个词通常会混用，不过要细分出两者差异的话，usually（通常）比较常用于“习惯”的表示；而often（常常）比较常用于“次数”的表示</p>\n<figure class=\"highlight md\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs md\">That teacher usually draws in the office.<br><br>Her piano is often dirty.<br></code></pre></td></tr></table></figure>\n\n<p>还可以将副词放在句首来使用：</p>\n<figure class=\"highlight md\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs md\">That student sometimes is lazy.<br><br>Sometimes that student is lazy.<br><br>That teacher sometimes teaches us english.<br><br>Sometimes that teacher teaches us english.<br></code></pre></td></tr></table></figure>\n\n<h2 id=\"方式副词的构成和用法\"><a href=\"#方式副词的构成和用法\" class=\"headerlink\" title=\"方式副词的构成和用法\"></a>方式副词的构成和用法</h2><p>大多放在动词后，用来辅助说明“动作状况”。</p>\n<figure class=\"highlight md\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs md\">He runs quickly.<br></code></pre></td></tr></table></figure>\n\n<p>形容词词尾是“辅音＋y”要去掉-y改成-ily</p>\n<figure class=\"highlight md\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs md\">happy =&gt; happily<br><br>hungry =&gt; hungrily<br><br>busy =&gt; busily<br><br>angry =&gt; angrily<br></code></pre></td></tr></table></figure>\n\n<h2 id=\"地点副词及时间副词的用法\"><a href=\"#地点副词及时间副词的用法\" class=\"headerlink\" title=\"地点副词及时间副词的用法\"></a>地点副词及时间副词的用法</h2><p>当英文句子里必须说明“地点”时，我们习惯将地点放在句尾来说明，其实“时间”也是。</p>\n<p>常用的地点副词：here、there</p>\n<figure class=\"highlight md\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs md\">// here是地点副词，本身已具备辅助说明“地点位置”的功能，不需要in或at来协助说明。<br>I am here.<br><br>I teach him English there.<br></code></pre></td></tr></table></figure>\n\n<p>常用的时间副词：today, tonight, now, early, late.</p>\n<figure class=\"highlight md\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs md\">We learn history today.<br></code></pre></td></tr></table></figure>\n\n<p>特别注意的是，当“地点和时间”刚好都在同一句时，这时我们要先写地点，再写时间哦！</p>\n<figure class=\"highlight md\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs md\">They are here now.<br><br>She is here now.<br></code></pre></td></tr></table></figure>\n\n<h2 id=\"程度副词\"><a href=\"#程度副词\" class=\"headerlink\" title=\"程度副词\"></a>程度副词</h2><p>“加强语气”用的“程度副词”，比如 very.</p>\n<p>但要注意的是，very是个特别的“程度副词”，只能用来修饰“形容词”和“副词”，像是very beautiful /very well，但不能用来修饰“动词”，如very like就是个错误的写法。</p>\n<p>因为very不能修饰动词，所以very无法修饰“like（喜欢）”这个词，因此必须把“他非常喜欢我”写成“他喜欢我＋非常多”。但是“like（喜欢）”，无法用形容“可数名词”的“many（许多的）”来测量出有多少，所以要用形容“不可数名词”的“much（许多的）”来表示。</p>\n<figure class=\"highlight md\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs md\">She likes me very much.<br><br>The piano is very good, but it is very old.<br></code></pre></td></tr></table></figure>\n\n<p>“也是”的副词：</p>\n<p>also可以通用于肯定句和否定句，而too只能用于肯定句，either却只能用于否定句。</p>\n<p>“also（也是）”的用法其实和“always（总是）”的用法相同，都习惯放在be动词am / are / is的后面，实义动词前面。</p>\n<figure class=\"highlight md\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs md\">He is also a student.<br><br>He is a student too.<br></code></pre></td></tr></table></figure>\n\n<p>如果同时出现两个动词时，就需要“不定式to”来帮忙。</p>\n<figure class=\"highlight md\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs md\">Do you also like to swim?<br><br>// either 用于否定句<br>I am not a student, and he is not a student either.<br></code></pre></td></tr></table></figure>\n\n<p>about, only</p>\n<p>“about”经常与数字配合使用。<br>only的用法和always相同，都习惯放于be动词am / are / is后面，实义动词的前面。</p>\n<h2 id=\"常和动词搭配的介词-to-with-for\"><a href=\"#常和动词搭配的介词-to-with-for\" class=\"headerlink\" title=\"常和动词搭配的介词 to/ with/ for\"></a>常和动词搭配的介词 to/ with/ for</h2><p>需要指明方向时，“to”这个介词来指出“动作的方向性”。</p>\n<figure class=\"highlight md\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs md\">He runs to that park.<br></code></pre></td></tr></table></figure>\n\n<p>但是若遇到here /there这样的地点副词，因为本身就已经具备辅助说明“地点位置”的功能，因此就不需要介词to来协助说明要去哪个方向，请特别注意！</p>\n<p>“去到……地方”＝go to……地方，如果没有特别说明用什么方式“去”时，就可以用“go”来表示“去”的意思。当遇到主语是第三人称单数时，go就要改成goes。</p>\n<figure class=\"highlight md\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs md\">He often goes to the bookstore.<br></code></pre></td></tr></table></figure>\n\n<p>“go to……地方”，通常地方前面要加the，但除了<code>here / there</code>不用加the之外，还有几个特别的情况不用加the:</p>\n<figure class=\"highlight md\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs md\">// 可以理解为，school和bed 是固定的，不需要加 the<br><br>go home<br><br>go to school<br><br>go to bed<br><br>He always goes to school early.<br></code></pre></td></tr></table></figure>\n\n<p>“来到……地方”＝come to……地方，没有特别说明用什么方式“来”时，就用come来表示“来”的意思。当遇到主语是第三人称单数时，记住come要改成comes。</p>\n<figure class=\"highlight md\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs md\">He seldom comes here.<br></code></pre></td></tr></table></figure>\n\n<h2 id=\"原级-比较级-最高级\"><a href=\"#原级-比较级-最高级\" class=\"headerlink\" title=\"原级/比较级/最高级\"></a>原级/比较级/最高级</h2><figure class=\"highlight md\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs md\">She is as tall(原级) as he（主格）,and she is taller（比较级） than I（主格）.<br></code></pre></td></tr></table></figure>\n\n<h3 id=\"原级\"><a href=\"#原级\" class=\"headerlink\" title=\"原级\"></a>原级</h3><p>要特别注意的是，既然是拿两者来比较，当然彼此的地位应该要对等，因此主格的写法也要一致，所以后面的“他”和前面的“我”相同，也要用“主格”写法he，不能用宾格写法him！</p>\n<h3 id=\"比较级\"><a href=\"#比较级\" class=\"headerlink\" title=\"比较级\"></a>比较级</h3><p>所谓“比较级”，表示两者有程度上的差别，因此所使用的形容词 / 副词就需要有特别的写法。</p>\n<p><code>+ er</code></p>\n<p><code>more</code></p>\n<h3 id=\"最高级\"><a href=\"#最高级\" class=\"headerlink\" title=\"最高级\"></a>最高级</h3><p>所谓“最高级”，表示程度的差异是最大的，因此所使用的形容词 / 副词就要有“差异程度最高”的写法。</p>\n<p><code>+ est</code></p>\n<p><code>most</code></p>\n<h3 id=\"更多的-more-最多的-most\"><a href=\"#更多的-more-最多的-most\" class=\"headerlink\" title=\"更多的 more / 最多的 most\"></a>更多的 more / 最多的 most</h3><p>原级：many/much</p>\n<p>比较级：more</p>\n<p>最高级：most</p>\n<h2 id=\"现在进行时\"><a href=\"#现在进行时\" class=\"headerlink\" title=\"现在进行时\"></a>现在进行时</h2><p>be动词＋动词ing＝是＋正在……</p>\n<h2 id=\"参考资料\"><a href=\"#参考资料\" class=\"headerlink\" title=\"参考资料\"></a>参考资料</h2><section class=\"footnotes\"><div class=\"footnote-list\"><ol><li><span id=\"fn:1\" class=\"footnote-text\"><span><a href=\"https://www.bilibili.com/video/BV1H64y1f73s?p=1&share_medium=iphone&share_plat=ios&share_session_id=7DD35B6D-AFD5-49C3-8C49-5B8606A0FBC7&share_source=WEIXIN&share_tag=s_i&timestamp=1649473343&unique_k=rfIiVZA\">小王子中英对照朗读</a>\n<a href=\"#fnref:1\" rev=\"footnote\" class=\"footnote-backref\"> ↩</a></span></span></li><li><span id=\"fn:2\" class=\"footnote-text\"><span><a href=\"https://www.bilibili.com/video/BV1XY411J7aG?p=1&share_medium=iphone&share_plat=ios&share_session_id=68AF3897-D48F-4D8C-B8A8-0EC4F03D33DC&share_source=WEIXIN&share_tag=s_i&timestamp=1649476740&unique_k=nHkSdbD\">英语语法精讲集合</a>\n<a href=\"#fnref:2\" rev=\"footnote\" class=\"footnote-backref\"> ↩</a></span></span></li><li><span id=\"fn:3\" class=\"footnote-text\"><span><a href=\"https://www.bilibili.com/video/BV1Y7411k7U8?p=1&share_medium=iphone&share_plat=ios&share_session_id=BEAA42C6-E107-4B0F-A976-1B9140498334&share_source=WEIXIN&share_tag=s_i&timestamp=1649474013&unique_k=hzOJtvI\">Youtube 初级—中级—高级 | 跟读训练</a>\n<a href=\"#fnref:3\" rev=\"footnote\" class=\"footnote-backref\"> ↩</a></span></span></li><li><span id=\"fn:4\" class=\"footnote-text\"><span><a href=\"https://www.bilibili.com/video/BV1354y1m77H?p=1&share_medium=iphone&share_plat=ios&share_session_id=4FC86032-3158-4719-AC90-97FC2BD2DA2F&share_source=WEIXIN&share_tag=s_i&timestamp=1649474052&unique_k=DycSmno\">Youtube《30本英语原著》</a>\n<a href=\"#fnref:4\" rev=\"footnote\" class=\"footnote-backref\"> ↩</a></span></span></li><li><span id=\"fn:5\" class=\"footnote-text\"><span><a href=\"https://www.bilibili.com/video/BV1uA411J7v9?p=1&share_medium=iphone&share_plat=ios&share_session_id=FD954A78-020B-4696-AADF-B4EEB9346008&share_source=WEIXIN&share_tag=s_i&timestamp=1649474078&unique_k=JzpJsi8\">Youtube《46本英语原著》</a>\n<a href=\"#fnref:5\" rev=\"footnote\" class=\"footnote-backref\"> ↩</a></span></span></li></ol></div></section>","site":{"data":{}},"wordcount":7271,"more":"<h2 id=\"Be-动词\"><a href=\"#Be-动词\" class=\"headerlink\" title=\"Be 动词\"></a>Be 动词</h2><p>每一个句子中必定要有一个动词，比如说 Be 动词：</p>\n<figure class=\"highlight md\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs md\">I am a boy.<br><br>She is a girl.<br></code></pre></td></tr></table></figure>\n\n<p>Be 动词有三种：is、am、are，表示 “是” 的意思。</p>\n<p>来看下个几个常用的代词配合 Be 动词的用法</p>\n<figure class=\"highlight md\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs md\">I am、You are、He/She is、It is、This is、That is...<br></code></pre></td></tr></table></figure>\n\n<h2 id=\"代词\"><a href=\"#代词\" class=\"headerlink\" title=\"代词\"></a>代词</h2><h3 id=\"单数代词\"><a href=\"#单数代词\" class=\"headerlink\" title=\"单数代词\"></a>单数代词</h3><ol>\n<li>人称单数代词：I、You、She、He</li>\n<li>指示单数代词：It、This、That</li>\n</ol>\n<p>代词必定要接be动词</p>\n<h3 id=\"复数代词\"><a href=\"#复数代词\" class=\"headerlink\" title=\"复数代词\"></a>复数代词</h3><ol>\n<li>人称复数代词：We、You、They、</li>\n<li>指示复数代词：These、Those</li>\n</ol>\n<p>常用的复数代词如“我们”“你们”“他们”“这些”“那些”，一定要跟“are”来配合，不可以用“is”。</p>\n<p><code>复数名词</code>变换形式：</p>\n<ol>\n<li>数目有两个及以上，不过有些名词有特殊规则，例如词尾已经是s，必须再加上es;</li>\n<li>词尾是y就要去y改成ies;</li>\n<li>词尾是f或fe，要去f、fe改成ves.</li>\n</ol>\n<h2 id=\"形容词\"><a href=\"#形容词\" class=\"headerlink\" title=\"形容词\"></a>形容词</h2><p>形容词通常放在名词的前面。this，that，these，those除了本身作代词之外，也可以有以下形容词的用法：</p>\n<figure class=\"highlight md\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs md\">this boy：这个男孩<br>these boy：这些男孩<br>that boy、those boy<br></code></pre></td></tr></table></figure>\n\n\n<h2 id=\"一般疑问句\"><a href=\"#一般疑问句\" class=\"headerlink\" title=\"一般疑问句\"></a>一般疑问句</h2><p>疑问句必须将be动词移到句首，才能形成疑问句。并且语调提升。</p>\n<h2 id=\"No的用法：\"><a href=\"#No的用法：\" class=\"headerlink\" title=\"No的用法：\"></a>No的用法：</h2><p>No的意思是“不”，主要放于句首，用来回答他人的提问，表示否定的意思。而在句子中的“不”要用“not”来表示。不过要特别注意的是，中文会讲“不是”，但英文却要讲成“是不”，用“be动词＋not”表示。</p>\n<h2 id=\"人称代词的所有格\"><a href=\"#人称代词的所有格\" class=\"headerlink\" title=\"人称代词的所有格\"></a>人称代词的所有格</h2><p>人称代词+名词：表明这个名词属于这个人称代词，比如：My book，这种写法称作所有格，表示名词的归属。</p>\n<p>人称代词所有格的有：my、your、his、her、its、our、your（你们的）、thier（他们的）</p>\n<h2 id=\"What-疑问句与专有名词\"><a href=\"#What-疑问句与专有名词\" class=\"headerlink\" title=\"What 疑问句与专有名词\"></a>What 疑问句与专有名词</h2><p>What是疑问代词＝“什么”的意思，what本身兼具疑问词和代词的特性＝疑问词 （形成疑问语气）＋代词（代表要问的东西）。之前的一般疑问句只要把am, are, is放到句首就可以了；但有疑问词What的疑问句，必须要把what 放到 is, am, are之前句首的位置，形成疑问语气。</p>\n<p>比如：</p>\n<figure class=\"highlight md\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs md\">What is this？<br><br>而不能是这样：This is what？<br></code></pre></td></tr></table></figure>\n<p>有What的疑问句，必须提到句首。</p>\n<h2 id=\"专有名词\"><a href=\"#专有名词\" class=\"headerlink\" title=\"专有名词\"></a>专有名词</h2><p>是独一无二的名词，第一个字母永远都要大写。</p>\n<ol>\n<li>专有名词无论在句子的什么位置，第一个字母永远要大写。</li>\n<li>专有名词因为是独一无二的，所以前面当然不需用再加“a”来表示数量。</li>\n</ol>\n<p>“专有名词”常见的种类有以下几种。<br>  <figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\">人名 例如，<span class=\"hljs-title class_\">John</span>约翰。<br>地名 例如，<span class=\"hljs-title class_\">Taipei</span>台北。<br>国家 例如，<span class=\"hljs-title class_\">America</span>美国。<br>语言 例如，<span class=\"hljs-title class_\">English</span>英文。<br></code></pre></td></tr></table></figure></p>\n<h2 id=\"疑问词\"><a href=\"#疑问词\" class=\"headerlink\" title=\"疑问词\"></a>疑问词</h2><h3 id=\"Why疑问句的用法\"><a href=\"#Why疑问句的用法\" class=\"headerlink\" title=\"Why疑问句的用法\"></a>Why疑问句的用法</h3><h3 id=\"What疑问句的用法\"><a href=\"#What疑问句的用法\" class=\"headerlink\" title=\"What疑问句的用法\"></a>What疑问句的用法</h3><h3 id=\"Who疑问句的用法\"><a href=\"#Who疑问句的用法\" class=\"headerlink\" title=\"Who疑问句的用法\"></a>Who疑问句的用法</h3><figure class=\"highlight md\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs md\">Who is that boy.<br></code></pre></td></tr></table></figure>\n\n<p>Who是疑问代词＝“谁”的意思，所以Who＝疑问词（形成疑问语气）＋代词（代表要问的人）。Who的用法和前面所学的“What”“Why”相同，都必须放在am, are, is之前句首的位置形成疑问语气。</p>\n<h3 id=\"How疑问句的用法\"><a href=\"#How疑问句的用法\" class=\"headerlink\" title=\"How疑问句的用法\"></a>How疑问句的用法</h3><h3 id=\"Where疑问句的用法\"><a href=\"#Where疑问句的用法\" class=\"headerlink\" title=\"Where疑问句的用法\"></a>Where疑问句的用法</h3><h3 id=\"Whose疑问句的用法\"><a href=\"#Whose疑问句的用法\" class=\"headerlink\" title=\"Whose疑问句的用法\"></a>Whose疑问句的用法</h3><p>代表“谁的东西”，比如:<br>  <figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\"><span class=\"hljs-title class_\">Whose</span> cat is <span class=\"hljs-variable language_\">this</span>? <span class=\"hljs-comment\">// 这只猫是谁的？</span><br></code></pre></td></tr></table></figure></p>\n<h3 id=\"Which疑问句的用法\"><a href=\"#Which疑问句的用法\" class=\"headerlink\" title=\"Which疑问句的用法\"></a>Which疑问句的用法</h3><p>Which意思是“哪一个 / 哪一些”。Which可以代表单数，也可以代表复数。</p>\n<ol>\n<li>单数：Which is 哪一个</li>\n<li>复数：Which are 哪一些</li>\n</ol>\n<p>比如：</p>\n<figure class=\"highlight md\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs md\">Which is my book? // 哪本书是我的？<br>Which are my chairs? // 哪些椅子是我的？<br></code></pre></td></tr></table></figure>\n\n<p>也可以当做形容词用:</p>\n<figure class=\"highlight md\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs md\">Which books are mine?<br></code></pre></td></tr></table></figure>\n\n\n\n<h2 id=\"介词-in\"><a href=\"#介词-in\" class=\"headerlink\" title=\"介词 in\"></a>介词 in</h2><p>in（介词）＝“在……里面”的意思。in的后面常搭配空间（盒子 / 房屋）。</p>\n<h2 id=\"介词-on\"><a href=\"#介词-on\" class=\"headerlink\" title=\"介词 on\"></a>介词 on</h2><p>“on”这个介词＝“在……上面”的意思，但是这里所说的“上面”，并不是“漂浮在东西的上空”喔，而是必须接触到东西的表面，才能使用“on”来说明！</p>\n<h3 id=\"其他介词\"><a href=\"#其他介词\" class=\"headerlink\" title=\"其他介词\"></a>其他介词</h3><figure class=\"highlight md\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs md\">at：“在......地点旁边”<br><br>beside：“在... 旁边”，靠的很近，有靠在什么东西旁边的感觉<br><br>near：“在...附近”<br><br>under：“在...正下方”<br><br>over：“在...正上方”，强调正上方<br><br>below：“在...下方”<br><br>above：“在...上方”<br><br></code></pre></td></tr></table></figure>\n\n<p>“在树上”有两种写法，“属于树本身的东西”，如果实、叶子等要用“on”，而“在树枝间穿梭的小动物”，如鸟、猴子等要用“in”喔！</p>\n<h2 id=\"单数-复数名词所有格\"><a href=\"#单数-复数名词所有格\" class=\"headerlink\" title=\"单数/复数名词所有格\"></a>单数/复数名词所有格</h2><figure class=\"highlight md\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs md\">John’s father is a doctor.<br></code></pre></td></tr></table></figure>\n\n<p>我们常讲你的、我的、妈妈的、约翰的等，其实在英文里面也有相同的讲法，只是在中文里，通常会在名词的后面加上“的”，英文却是要在名词后面加上’s来表示。而这样的写法，我们称为“所有格”，用来说明东西的所有权归属。</p>\n<p>名词的所有格：只限于有生命的“人”或“动物”。</p>\n<ol>\n<li>单数名词的所有格写法＝单数名词＋’s</li>\n<li>复数名词的所有格：<ul>\n<li>词尾有s的，要写成s’，比如 cats’、girls’、parents’</li>\n<li>复数名词词尾没有 s 的，要加上 ‘s，比如 men’s、women’s、children’s</li>\n</ul>\n</li>\n</ol>\n<h3 id=\"所有格代词：为了避免重复叙述\"><a href=\"#所有格代词：为了避免重复叙述\" class=\"headerlink\" title=\"所有格代词：为了避免重复叙述\"></a>所有格代词：为了避免重复叙述</h3><p>所有格代词 = 代词 + 名词</p>\n<p>mine,our,yours,hers,thiers,its</p>\n<figure class=\"highlight md\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs md\">This book is mine.<br><br>Or<br><br>This book is my book.<br></code></pre></td></tr></table></figure>\n\n<h2 id=\"定冠词the的用法及无生命的所有格\"><a href=\"#定冠词the的用法及无生命的所有格\" class=\"headerlink\" title=\"定冠词the的用法及无生命的所有格\"></a>定冠词the的用法及无生命的所有格</h2><figure class=\"highlight md\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs md\">The flower is beautiful.<br><br>The flowers are beautiful.<br></code></pre></td></tr></table></figure>\n\n<p>the 除了可以代替“a”之外，the也可以代替“these / those”，因此the可以通用于单复数名词!</p>\n<h3 id=\"重点1\"><a href=\"#重点1\" class=\"headerlink\" title=\"重点1\"></a><em>重点1</em></h3><p>the 主要用来指出“特定的人或物”，可通用于单复数名词。</p>\n<figure class=\"highlight md\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs md\">// 特定的一朵花<br>the flower = this flower = that flower<br><br>// 特定的一些花<br>the flowers = these flowers = those flowers<br></code></pre></td></tr></table></figure>\n\n<h3 id=\"重点2\"><a href=\"#重点2\" class=\"headerlink\" title=\"重点2\"></a><em>重点2</em></h3><p>无生命的所有格写法＝“部分”属于（of）“全部”</p>\n<p>我们学过名词的所有格，必须在名词后面加上’s来表示，但这样的写法只限于有生命的“人”或“动物”。但是除了上述的所有格写法，另外还有“无生命”的所有格（物品）写法，它和有生命的所有格（人或动物）写法是不同的。</p>\n<figure class=\"highlight md\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs md\">有生命的所有格写法＝名词＋’s<br><br>约翰的书桌＝Jonn’s desk<br>这只猪的鼻子＝the pig’s nose<br></code></pre></td></tr></table></figure>\n\n<p>来看看无生命的所有格写法是怎样的吧！</p>\n<figure class=\"highlight md\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs md\">// 房子的窗户是坏的<br>The window of the house is broken. <br><br>// 房子是无生命的，不能写成：house&#x27;s<br></code></pre></td></tr></table></figure>\n\n<p>还要注意的是，特指某个物品上的某个部件，都是要加定冠词 <code>the</code> 的，比如：</p>\n<figure class=\"highlight md\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs md\">// 篮子的把手是好的。<br>The handle of the basket is good.<br><br>// 戒指上的钻石是漂亮的。<br>The diamond of the ring is beautiful.<br><br>// 句子中的单词是错误的。<br>The word of the sentence is wrong.<br></code></pre></td></tr></table></figure>\n\n<h2 id=\"连词but、and、or\"><a href=\"#连词but、and、or\" class=\"headerlink\" title=\"连词but、and、or\"></a>连词but、and、or</h2><h3 id=\"but\"><a href=\"#but\" class=\"headerlink\" title=\"but\"></a>but</h3><p>but（连词）＝但是，常用于连接两个有转折语气的句子。另外要注意的是，but前面必须加上逗号。</p>\n<figure class=\"highlight md\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs md\">Billy is poor, but he is happy.<br></code></pre></td></tr></table></figure>\n\n<p>还要注意的是，<code>but</code> 前后必须是意思<code>不对等</code>的句子：</p>\n<figure class=\"highlight md\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs md\">// 这里就不对，生病了，本就应该躺在床上<br><br>I am sick, but I am in bed.<br><br>// 对的<br>I am sick, but I am happy.<br></code></pre></td></tr></table></figure>\n\n<h3 id=\"and\"><a href=\"#and\" class=\"headerlink\" title=\"and\"></a>and</h3><p>and（连词）＝而且、和，可用于连接两个意思对等的单词或句子。和but相同的是，如果and连接的是句子，那么and的前面也必须加上逗号。</p>\n<figure class=\"highlight md\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs md\">// 又高又聪明<br>tall and smart<br><br>My sister and your brother are busy.<br><br>That young person is fat and dirty.<br><br>Our parents are angry and sad.<br></code></pre></td></tr></table></figure>\n\n<h3 id=\"or\"><a href=\"#or\" class=\"headerlink\" title=\"or\"></a>or</h3><p>or也是连词，意思是“还是、或是”。or主要是让对方在答案中“二选一”。另外要特别注意的是“二选一”的念法，音调要先上升后下降。</p>\n<figure class=\"highlight md\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs md\">fat or thin<br><br>Is your son tall or short?<br><br>Are those children clean or dirty?<br><br>Are those pens ours or theirs?<br></code></pre></td></tr></table></figure>\n\n<h2 id=\"连词-although-及-so\"><a href=\"#连词-although-及-so\" class=\"headerlink\" title=\"连词 although 及 so\"></a>连词 although 及 so</h2><h3 id=\"although\"><a href=\"#although\" class=\"headerlink\" title=\"although\"></a>although</h3><figure class=\"highlight md\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs md\">Although he is rich, he is selfish.<br></code></pre></td></tr></table></figure>\n\n<p>“although”为连词，意思是“虽然”，although的用法和because的用法一样，它们像是两节车厢之间的挂钩，都可以放在“句首”和“句尾”来连接两个句子成为一句。</p>\n<p>另外要注意的是，中文常说 “虽然……但是”，但英文却只说“虽然……”后面不会加“但是”，这点要特别注意！</p>\n<ol>\n<li>although可放句首＝“Although＋句1＋，＋句2”。</li>\n<li>although可放句中＝“句1＋although＋句2”，跟 because 一样，放在句中时不需要用逗号隔开。</li>\n</ol>\n<h3 id=\"so\"><a href=\"#so\" class=\"headerlink\" title=\"so\"></a>so</h3><p>在英文里 because 和 so 绝对不能一起并用。另外so和and、but一样，前面都要加逗号。</p>\n<figure class=\"highlight md\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs md\">He is sick, so he is weak.<br><br>Because he is sick, he is weak.<br></code></pre></td></tr></table></figure>\n\n<h2 id=\"There-be-的用法\"><a href=\"#There-be-的用法\" class=\"headerlink\" title=\"There be 的用法\"></a>There be 的用法</h2><p>There is在这里表示“存在”的意思，也就是中文常说的“有”。因此there is可以表示“……地方有……”。</p>\n<figure class=\"highlight md\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs md\"><br>There is + 单数名词（a television 📺）<br><br>There are + 复数名词（two pigs🐷🐷）<br><br>There is a television in the living room.<br></code></pre></td></tr></table></figure>\n\n<p>另外There is的疑问句和之前所学过的疑问句一样，将be动词is放到句首，就可以形成疑问句了。记得疑问句句尾语调要上扬！</p>\n<figure class=\"highlight md\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs md\">Is there a television in the living room?<br><br>There are three books on your desk.<br></code></pre></td></tr></table></figure>\n\n\n<h2 id=\"动词have的用法与三大人称\"><a href=\"#动词have的用法与三大人称\" class=\"headerlink\" title=\"动词have的用法与三大人称\"></a>动词have的用法与三大人称</h2><p>英文里一个句子只能有一个动词，因此is和have不能同时出现在同一句子里，要注意！</p>\n<h2 id=\"及物动词和不及物动词\"><a href=\"#及物动词和不及物动词\" class=\"headerlink\" title=\"及物动词和不及物动词\"></a>及物动词和不及物动词</h2><p>实义动词可以分为及物动词和不及物动词。</p>\n<figure class=\"highlight md\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs md\">及物动词：动词后面必须要有 人/物 作为宾语来承受这个动作<br><br>不及物动词：句子较为完整，不需要 人/物 作为宾语。<br></code></pre></td></tr></table></figure>\n\n<p>不及物动词本身句子的意思较为完整，所以动词后面不用有人 / 物作为宾语来承受这个动作。</p>\n<figure class=\"highlight md\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs md\">// 我微笑着<br>I smile.<br></code></pre></td></tr></table></figure>\n\n<p>大部分的动词都兼具“及物动词”和“不及物动词”两种特性，只有极少部分的动词才会只当“及物动词”使用。另外要注意的是，只有名词和代词才可以担任宾语！</p>\n<figure class=\"highlight md\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs md\">// 这里的 sings 是及物动词，song 做宾语<br>She sings a song.<br><br>// 这里的 sings 是不及物动词，in the room 表地点，房间在这里不能当做宾语。<br>She sings in the room.<br></code></pre></td></tr></table></figure>\n\n<h2 id=\"动词不定式\"><a href=\"#动词不定式\" class=\"headerlink\" title=\"动词不定式\"></a>动词不定式</h2><p>在英文句子里一定要有动词，而且一个句子只能有一个动词！如果这个句子必须有“两个动作”才能完整表达语意的话，那该怎么办呢？</p>\n<p>这时就需要“to”来帮忙，形成“动词1＋to＋动词2”的结构，而其中“to＋动词2”这样的写法，就称作“不定式”。</p>\n<p>要特别注意的是，“to”后面的动词必须要“打回原形”＝“to＋动词原形”。</p>\n<figure class=\"highlight md\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs md\">He likes to run in the park.<br><br>John&#x27;s father likes to teach us english in his living room.<br></code></pre></td></tr></table></figure>\n\n<p>英文句子里，若要让两个动词同时存在，除了使用“不定式”的概念，还可以使用“连词and”的概念！</p>\n<figure class=\"highlight md\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs md\">// 省略了 and he likes to run.<br>He likes to read and run.<br><br>Those cats like to eat and those cats like to sleep.<br><br>// 使用 and 省略写法<br>Those cats like to eat and sleep.<br></code></pre></td></tr></table></figure>\n\n<h2 id=\"频率副词\"><a href=\"#频率副词\" class=\"headerlink\" title=\"频率副词\"></a>频率副词</h2><p>可以把“副词”想成是一种“辅助说明”的词类，也可以把“副词”看成是一种“辅词”！</p>\n<figure class=\"highlight md\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs md\">alway<br><br>ofen<br><br>usually<br><br>sometimes<br><br>seldom(很少)<br><br>never<br></code></pre></td></tr></table></figure>\n\n<p>“频率副词”的用法跟中文相似，通常会放在be动词am / are / is的后面，或是实义动词的前面。</p>\n<figure class=\"highlight mercury\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs mercury\">He <span class=\"hljs-keyword\">is</span> always busy.<br><br>You are ofen busy.<br><br>// 频率副词usually要放在实义动词run的前面。<br>He usually runs in the park.<br></code></pre></td></tr></table></figure>\n\n<p>频率副词里面的usually（通常）和often（常常）两个词通常会混用，不过要细分出两者差异的话，usually（通常）比较常用于“习惯”的表示；而often（常常）比较常用于“次数”的表示</p>\n<figure class=\"highlight md\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs md\">That teacher usually draws in the office.<br><br>Her piano is often dirty.<br></code></pre></td></tr></table></figure>\n\n<p>还可以将副词放在句首来使用：</p>\n<figure class=\"highlight md\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs md\">That student sometimes is lazy.<br><br>Sometimes that student is lazy.<br><br>That teacher sometimes teaches us english.<br><br>Sometimes that teacher teaches us english.<br></code></pre></td></tr></table></figure>\n\n<h2 id=\"方式副词的构成和用法\"><a href=\"#方式副词的构成和用法\" class=\"headerlink\" title=\"方式副词的构成和用法\"></a>方式副词的构成和用法</h2><p>大多放在动词后，用来辅助说明“动作状况”。</p>\n<figure class=\"highlight md\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs md\">He runs quickly.<br></code></pre></td></tr></table></figure>\n\n<p>形容词词尾是“辅音＋y”要去掉-y改成-ily</p>\n<figure class=\"highlight md\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs md\">happy =&gt; happily<br><br>hungry =&gt; hungrily<br><br>busy =&gt; busily<br><br>angry =&gt; angrily<br></code></pre></td></tr></table></figure>\n\n<h2 id=\"地点副词及时间副词的用法\"><a href=\"#地点副词及时间副词的用法\" class=\"headerlink\" title=\"地点副词及时间副词的用法\"></a>地点副词及时间副词的用法</h2><p>当英文句子里必须说明“地点”时，我们习惯将地点放在句尾来说明，其实“时间”也是。</p>\n<p>常用的地点副词：here、there</p>\n<figure class=\"highlight md\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs md\">// here是地点副词，本身已具备辅助说明“地点位置”的功能，不需要in或at来协助说明。<br>I am here.<br><br>I teach him English there.<br></code></pre></td></tr></table></figure>\n\n<p>常用的时间副词：today, tonight, now, early, late.</p>\n<figure class=\"highlight md\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs md\">We learn history today.<br></code></pre></td></tr></table></figure>\n\n<p>特别注意的是，当“地点和时间”刚好都在同一句时，这时我们要先写地点，再写时间哦！</p>\n<figure class=\"highlight md\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs md\">They are here now.<br><br>She is here now.<br></code></pre></td></tr></table></figure>\n\n<h2 id=\"程度副词\"><a href=\"#程度副词\" class=\"headerlink\" title=\"程度副词\"></a>程度副词</h2><p>“加强语气”用的“程度副词”，比如 very.</p>\n<p>但要注意的是，very是个特别的“程度副词”，只能用来修饰“形容词”和“副词”，像是very beautiful /very well，但不能用来修饰“动词”，如very like就是个错误的写法。</p>\n<p>因为very不能修饰动词，所以very无法修饰“like（喜欢）”这个词，因此必须把“他非常喜欢我”写成“他喜欢我＋非常多”。但是“like（喜欢）”，无法用形容“可数名词”的“many（许多的）”来测量出有多少，所以要用形容“不可数名词”的“much（许多的）”来表示。</p>\n<figure class=\"highlight md\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs md\">She likes me very much.<br><br>The piano is very good, but it is very old.<br></code></pre></td></tr></table></figure>\n\n<p>“也是”的副词：</p>\n<p>also可以通用于肯定句和否定句，而too只能用于肯定句，either却只能用于否定句。</p>\n<p>“also（也是）”的用法其实和“always（总是）”的用法相同，都习惯放在be动词am / are / is的后面，实义动词前面。</p>\n<figure class=\"highlight md\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs md\">He is also a student.<br><br>He is a student too.<br></code></pre></td></tr></table></figure>\n\n<p>如果同时出现两个动词时，就需要“不定式to”来帮忙。</p>\n<figure class=\"highlight md\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs md\">Do you also like to swim?<br><br>// either 用于否定句<br>I am not a student, and he is not a student either.<br></code></pre></td></tr></table></figure>\n\n<p>about, only</p>\n<p>“about”经常与数字配合使用。<br>only的用法和always相同，都习惯放于be动词am / are / is后面，实义动词的前面。</p>\n<h2 id=\"常和动词搭配的介词-to-with-for\"><a href=\"#常和动词搭配的介词-to-with-for\" class=\"headerlink\" title=\"常和动词搭配的介词 to/ with/ for\"></a>常和动词搭配的介词 to/ with/ for</h2><p>需要指明方向时，“to”这个介词来指出“动作的方向性”。</p>\n<figure class=\"highlight md\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs md\">He runs to that park.<br></code></pre></td></tr></table></figure>\n\n<p>但是若遇到here /there这样的地点副词，因为本身就已经具备辅助说明“地点位置”的功能，因此就不需要介词to来协助说明要去哪个方向，请特别注意！</p>\n<p>“去到……地方”＝go to……地方，如果没有特别说明用什么方式“去”时，就可以用“go”来表示“去”的意思。当遇到主语是第三人称单数时，go就要改成goes。</p>\n<figure class=\"highlight md\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs md\">He often goes to the bookstore.<br></code></pre></td></tr></table></figure>\n\n<p>“go to……地方”，通常地方前面要加the，但除了<code>here / there</code>不用加the之外，还有几个特别的情况不用加the:</p>\n<figure class=\"highlight md\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs md\">// 可以理解为，school和bed 是固定的，不需要加 the<br><br>go home<br><br>go to school<br><br>go to bed<br><br>He always goes to school early.<br></code></pre></td></tr></table></figure>\n\n<p>“来到……地方”＝come to……地方，没有特别说明用什么方式“来”时，就用come来表示“来”的意思。当遇到主语是第三人称单数时，记住come要改成comes。</p>\n<figure class=\"highlight md\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs md\">He seldom comes here.<br></code></pre></td></tr></table></figure>\n\n<h2 id=\"原级-比较级-最高级\"><a href=\"#原级-比较级-最高级\" class=\"headerlink\" title=\"原级/比较级/最高级\"></a>原级/比较级/最高级</h2><figure class=\"highlight md\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs md\">She is as tall(原级) as he（主格）,and she is taller（比较级） than I（主格）.<br></code></pre></td></tr></table></figure>\n\n<h3 id=\"原级\"><a href=\"#原级\" class=\"headerlink\" title=\"原级\"></a>原级</h3><p>要特别注意的是，既然是拿两者来比较，当然彼此的地位应该要对等，因此主格的写法也要一致，所以后面的“他”和前面的“我”相同，也要用“主格”写法he，不能用宾格写法him！</p>\n<h3 id=\"比较级\"><a href=\"#比较级\" class=\"headerlink\" title=\"比较级\"></a>比较级</h3><p>所谓“比较级”，表示两者有程度上的差别，因此所使用的形容词 / 副词就需要有特别的写法。</p>\n<p><code>+ er</code></p>\n<p><code>more</code></p>\n<h3 id=\"最高级\"><a href=\"#最高级\" class=\"headerlink\" title=\"最高级\"></a>最高级</h3><p>所谓“最高级”，表示程度的差异是最大的，因此所使用的形容词 / 副词就要有“差异程度最高”的写法。</p>\n<p><code>+ est</code></p>\n<p><code>most</code></p>\n<h3 id=\"更多的-more-最多的-most\"><a href=\"#更多的-more-最多的-most\" class=\"headerlink\" title=\"更多的 more / 最多的 most\"></a>更多的 more / 最多的 most</h3><p>原级：many/much</p>\n<p>比较级：more</p>\n<p>最高级：most</p>\n<h2 id=\"现在进行时\"><a href=\"#现在进行时\" class=\"headerlink\" title=\"现在进行时\"></a>现在进行时</h2><p>be动词＋动词ing＝是＋正在……</p>\n<h2 id=\"参考资料\"><a href=\"#参考资料\" class=\"headerlink\" title=\"参考资料\"></a>参考资料</h2><section class=\"footnotes\"><div class=\"footnote-list\"><ol><li><span id=\"fn:1\" class=\"footnote-text\"><span><a href=\"https://www.bilibili.com/video/BV1H64y1f73s?p=1&share_medium=iphone&share_plat=ios&share_session_id=7DD35B6D-AFD5-49C3-8C49-5B8606A0FBC7&share_source=WEIXIN&share_tag=s_i&timestamp=1649473343&unique_k=rfIiVZA\">小王子中英对照朗读</a>\n<a href=\"#fnref:1\" rev=\"footnote\" class=\"footnote-backref\"> ↩</a></span></span></li><li><span id=\"fn:2\" class=\"footnote-text\"><span><a href=\"https://www.bilibili.com/video/BV1XY411J7aG?p=1&share_medium=iphone&share_plat=ios&share_session_id=68AF3897-D48F-4D8C-B8A8-0EC4F03D33DC&share_source=WEIXIN&share_tag=s_i&timestamp=1649476740&unique_k=nHkSdbD\">英语语法精讲集合</a>\n<a href=\"#fnref:2\" rev=\"footnote\" class=\"footnote-backref\"> ↩</a></span></span></li><li><span id=\"fn:3\" class=\"footnote-text\"><span><a href=\"https://www.bilibili.com/video/BV1Y7411k7U8?p=1&share_medium=iphone&share_plat=ios&share_session_id=BEAA42C6-E107-4B0F-A976-1B9140498334&share_source=WEIXIN&share_tag=s_i&timestamp=1649474013&unique_k=hzOJtvI\">Youtube 初级—中级—高级 | 跟读训练</a>\n<a href=\"#fnref:3\" rev=\"footnote\" class=\"footnote-backref\"> ↩</a></span></span></li><li><span id=\"fn:4\" class=\"footnote-text\"><span><a href=\"https://www.bilibili.com/video/BV1354y1m77H?p=1&share_medium=iphone&share_plat=ios&share_session_id=4FC86032-3158-4719-AC90-97FC2BD2DA2F&share_source=WEIXIN&share_tag=s_i&timestamp=1649474052&unique_k=DycSmno\">Youtube《30本英语原著》</a>\n<a href=\"#fnref:4\" rev=\"footnote\" class=\"footnote-backref\"> ↩</a></span></span></li><li><span id=\"fn:5\" class=\"footnote-text\"><span><a href=\"https://www.bilibili.com/video/BV1uA411J7v9?p=1&share_medium=iphone&share_plat=ios&share_session_id=FD954A78-020B-4696-AADF-B4EEB9346008&share_source=WEIXIN&share_tag=s_i&timestamp=1649474078&unique_k=JzpJsi8\">Youtube《46本英语原著》</a>\n<a href=\"#fnref:5\" rev=\"footnote\" class=\"footnote-backref\"> ↩</a></span></span></li></ol></div></section>"},{"layout":"build","title":"ESM/ESBuild","date":"2022-09-13T09:11:35.000Z","banner_img":"/img/modules.jpg","index_img":"/img/modules.jpg","excerpt":"继 CommonJS、AMD、CMD 几种模块化规范由社区提出后，ES 2015（ES6）在语言层面上实现了模块功能，且实现简单，可以替代CommonJS和AMD规范，成为在服务器和浏览器通用的解决方案。","_content":"\n# Module\n\n在ES6之前，社区制定了一些模块加载方案，最主要的有CommonJS和AMD两种。前者用于服务器，后者用于浏览器。\n\nES6在语言规格的层面上实现了模块功能，而且实现得相当简单，完全可以取代现有的CommonJS和AMD规范，成为浏览器和服务器通用的模块解决方案。\n\n\n## stage1\n\n> 文件划分方式，约定每一个 js 文件就是一个独立的模块\n\n```html\n<script src=\"./lib.js\"></script>\n<script src=\"./main.js\"></script>\n\n<script>\n  // 直接使用导入文件中的变量与方法\n  method1()\n\n  // 模块成员可以被修改\n  count = 2\n</script>\n```\n\n缺点：\n1. 污染全局作用域\n2. 命名冲突\n3. 无法管理模块间的依赖关系\n4. 模块成员可以在外部直接修改\n\n## stage2\n\n> 命名空间，减少命名冲突\n\n每个文件中，通过一个命名对象来包裹所有的变量和方法\n\n```js\n// module a 相关的数据和方法\n\nconst moduleA = {\n  name: 'module a',\n  count: 1,\n  incCount() {\n    this.count ++\n  }\n}\n```\n\n缺点：\n1. 污染全局作用域\n2. 无法管理模块间的依赖关系\n3. 模块成员可以在外部直接修改\n\n\n## stage3\n\n> IIFE（立即执行函数）\n\n```js\n;(function($){\n  const name = 'moduleA'\n  let count = 1\n  function incCount() {\n    count++\n  }\n\n  window.moduleA = {\n    incCount\n  }\n})(jQuery)\n```\n\n通过闭包的方式，模块内部的变量只能被模块内部修改，外部无法修改。\n\n通过 IIFE 的传参，我们可以传递一些依赖包给模块使用。\n\n# 模块化规范\n\n- CommonJS（NodeJS）\n\n  1. 一个文件就是一个模块\n  2. 每个模块都有单独的作用域\n  3. 通过 module.exports 导出成员\n  4. 通过 require 函数加载成员\n\n以同步的方式加载模块，如果放在浏览器中，那么会出现大量的文件请求，有时候并不是立马就需要的文件也会被加载，从而造成性能问题，不适合在浏览器中使用。\n\n- AMD（Asyncronous module definition）\n\n  异步的模块定义\n\n```js\n// 定义一个模块\n// 第二个参数表示当前模块的依赖项\ndefine('module1', ['lodash', './module2'], function('lodash', 'module2') {\n  \n  // 导出成员，外部可以方法 start 方法\n  return {\n    start:function() {\n      // lodash\n\n      module2()\n    }\n  }\n})\n\n  // 加载模块\n\n  require('./module1', function(module1) {\n    module1.start()\n  })\n  ```\n\n- CMD规范（类似 CommonJS）\n\n- ES Modules（浏览器）\n\n# ES6 模块化\n\n```html\n<script src=\"./main.js\" type=\"module\"></script>\n\n<script type=\"module\">\n  console.log(1)\n</script>\n```\n\n特性：\n\n- ES6的模块自动采用严格模式，不管有没有在模块头部加上＂use strict＂。\n- 每个 ES Module 都运行在私有作用域中\n- ESM 是通过 CORS(跨域) 的方式去请求外部的 JS 资源的。（原 script 标签默认支持跨域）\n- ESM 的 script 标签会延迟执行脚本（类似标签的 defer 属性），等待网页渲染完成后，再执行。\n  ```js\n  // 会比有 type=\"module\" 的script 先执行\n  <script>\n    alert('hello')\n  </script>\n\n  // 延迟执行\n  <script type=\"module\"> // 等同于加了 defer 属性\n    console.log(1)\n  </script>\n  ```\n\n严格模式主要有以下限制：\n\n- 变量必须声明后再使用。\n- 函数的参数不能有同名属性，否则报错。\n- 不能使用with语句。\n- 不能对只读属性赋值，否则报错。\n- 不能使用前缀0表示八进制数，否则报错。\n- 不能删除不可删除的属性，否则报错。\n- 不能删除变量(delete prop)，会报错，只能删除属性(delete global[prop])。\n- eval不会在其外层作用域引入变量。\n- eval和arguments不能被重新赋值。\n- arguments不会自动反映函数参数的变化。\n- 不能使用arguments.callee。\n- 不能使用arguments.caller。\n- 禁止this指向全局对象。\n- 不能使用fn.caller和fn.arguments获取函数调用的堆栈。\n- 增加了保留字（比如protected、static和interface）。\n\n## export & import\n\n模块功能主要由两个命令构成：export和import。\n\nexport命令用于规定模块的对外接口，import命令用于输入其他模块提供的功能。一个模块就是一个独立的文件。该文件内部的所有变量，外部无法获取。\n\n如果希望外部能够读取模块内部的某个变量，就必须使用export关键字输出该变量。\n\n```js\n// test.js\nexport const myName = 'Hello_AlexCC'\n\n// 组合导出\nconst myAge = 18\nconst sayMe = function() {\n  console.log(`my name is ${myName}, and I'm ${myAge} years old!`)\n}\n\nexport {\n  myAge,\n  sayMe\n}\n```\n\n如果在一个模块中先输入后输出同一个模块，import语句可以与export语句写在一起。\n\n```js\nexport { sayName as default} from './someModule'\n\n// 等价于\n\nimport { sayName } from './someModule'\nexport default sayName\n```\n\n另外，ES7有一个提案(https://github.com/leebyron/ecmascript-more-export-from)，简化先输入后输出的写法，拿掉了输出时的大括号。\n\n```js\n// 提案\nexport v from 'mod'\n\n// 现在\nexport { v } from 'mod'\n```\n\nimport语句会执行所加载的模块\n\n```js\nimport 'lodash'\n```\n\n## 模块整体加载\n```js\nimport * as myModule from './myModule'\n```\n\n## module 命令\nmodule命令可以取代import语句，达到整体输入模块的作用。\n\n```js\nmodule myModule from './myModule'\n\nmyModule.sayName()\n```\n\n## 动态加载模块\n\n返回的是 Promise\n\n```js\nimport('./moduleA.js').then(module => {\n  ...\n})\n```\n\n## ES6模块加载的实质\n\nES6模块加载的机制与CommonJS模块完全不同。\n\nCommonJS模块输出的是一个值的拷贝，而ES6模块输出的是 `值的引用`。\n\n```js\n// lib.js\nexport let count = 1\nexport function incCount() {\n  count++\n}\n\n// main.js\nimport { count, incCount } from './lib.js'\n\nconsole.log(count) // 1\n\nincCount()\n\nconsole.log(count) // 2\n```\n\n\n注意加上 type=\"module\"\n\n```html\n<script src=\"./main.js\" type=\"module\"></script>\n```\n\n## ES Module in NodeJS\n\n如何在 Nodejs 中使用 ES module!\n\n有两个步骤：\n\n1. `.js` 后缀都改为 `.mjs`\n2. 执行脚本时，加上 `node --experimental-modules main.mjs`\n\n```js\n// node\n\n// main.mjs\nimport fs from 'fs'\nimport _ from 'lodash'\n```\n\n注意事项：\n\n1. 在 node 环境中，我们可以使用 ES Module 导入 CommonJS 导出的成员\n\n```js\n// commonjs.js\nmodule.exports = {\n  foo: 'commonjs exports foo'\n}\n\n// esmodule.js\nimport mod from './commonjs.js'\n\nconsole.log(mod.foo)\n```\n\n2. 在 node 环境中，CommonJS 中`不能`导入 ES Module 导出的成员\n\n```js\nconst mod = require('./esmodule.js') // 报错\n```\n\n## CommonJS 与 ES Module 差异\n\n```js\n// CommonJS\n\nrequire // 加载模块函数\n\nmodule // 模块对象\n\nexports // 导出对象别名 exports.name = 'hello world'\n\n__filename // 当前文件的绝对路径\n\n__dirname // 当前文件所在目录\n```\n\n```js\n// ES Module\n\nimport.meta.url // 文件路径信息\n\n// 可以通过内置模块 url 和 path 处理，拿到 __filename 和 __dirname\nimport { fileURLToPath } from 'url'\nimport { dirname } from 'path'\n\nconst __filename = fileURLToPath(import.meta.url)\nconst __dirname = dirname(__filename)\n```\n\n## 高版本 NodeJS 已支持 ESM (Version > 12.10.0)\n\n不需要再写 `.mjs` 结尾了，直接 `.js`\n\n```js\n// package.json\n{\n  \"type\": \"module\"\n}\n\n// 执行\nnode --experimental-modules main.js \n```\n\n加上 type module 配置之后，如果我们还想用 `CommonJS` 规范，发现会报错了。因为我们已经使用了 ESM。\n\n如果继续使用 `CommonJS` 规范，那么就需要将 `.js` 改为 `.cjs`。\n\n## ESM in NodeJS （babel 兼容方案）\n\n> yarn add @babel/node @babel/preset-env --save-dev\n\n```js\n// 通过 babel-node 命令执行脚本\nyarn babel-node main.js\n```\n\n要注意的是，`babel/core` 并不会转换我们的代码，转换代码的工作交给 babel 内置的插件去实现的。也就是说，我们需要一个插件，去转换 ES6 中的一个新特性。\n\n<img src=\"/img/babel.jpg\" />\n\n而 `@bable/preset-env` 是插件的集合，所以不需要每个插件都安装一遍。\n\n```js\n// 命令行使用\nyarn babel-node main.js --presets=@bable/preset-env\n```\n\n结合 babel 配置文件使用\n```js\n// .babelrc\n{\n  \"presets\": [\"@babel/presets-env\"]\n}\n\nyarn babel-node main.js\n```\n\n既然 `@babel/preset-env` 是插件的集合，而我不想要那么多，只是想处理 `ESM` 怎么办呢？\n\n我们卸载掉 `@babel/preset-env`，安装 `@babel/plugin-transform-modules-commonjs`\n\n```js\n// .babelrc\n{\n  \"presets\": [\"@babel/plugin-transform-modules-commonjs\"]\n}\n\nyarn babel-node main.js\n```\n\n# babel\n\n> 编译器\n\n主要用于将ES6版本的JS代码转换为ES5等向后兼容的JS代码，从而使代码可以运行在低版本浏览器或其他环境中。\n\n> npm install --save-dev babel-core babel-preset-es2015 babel-preset-latest --registry=https://registry.npm.taobao.org\n\n配置文件 `.babelrc`（或者 babel.config.js || .babelrc.js）\n\n```js\n{\n  \"presets\": [\"es2015\", \"latest\"], // 安装包的别名，用来处理最新的 ES6 语法\n  \"plugins\": []\n}\n```\n\n安装 `babel-cli`，命令行编译工具，依赖 `babel/core`\n\n```js\nnpm install --save-dev babel-cli \n```\n\n查看 babel 版本（npx 是新版 NodeJS 附带的命令）\n\n```js\nnpx babel --version // ===== node_modules/.bin/babel --version \n\n// ====> 6.26.0 (babel-core 6.26.3)\n```\n\n到这里，我们就可以使用 babel 来编译js 文件了。创建一个 babel.js 文件，写入一些 es6 的语法。\n\n```js\n// babel.js\n\nconst foo = () => {\n  return 3 * 3\n}\n\nconst count = 123\n```\n\n打开命令行工具：\n\n```js\nnpx babel babel.js -o compiled.js // 等效 node_modules/.bin/babel babel.js -o compiled.js \n```\n\n转化后的结果：\n\n```js\n\"use strict\";\n\nvar foo = function foo() {\n  return 3 * 3;\n};\n\nvar count = 123;\n```\n\n## Polyfill\n\nBabel默认只转换新的JS语法（syntax），而不转换新的API（Promise、Map）。如果只是做语法转换，Promise 是不会被降级的，在低版本的浏览器中可能无法使用。\n\n引入 Polyfill，为当前环境提供一个“垫片”。所谓“垫片”，是指垫平不同浏览器之间差异的东西。polyfill提供了全局的ES6对象及通过修改原型链Array.prototype等来补充对实例的实现。\n\n## babel 版本\n\nBabel版本主要是Babel 6和Babel 7这两个版本。\n\n提到Babel版本的时候，通常指的是@babel/core这个Babel核心包的版本。\n\nBabel 7的npm包都存放在babel域下，即在安装npm包的时候，我们安装的是名称以@babel/开头的npm包，如@babel/cli、@babel/core等。而在Babel 6中，我们安装的包名是babel-cli、babel-core等以babel-开头的npm包。其实它们本质上是一样的，都是Babel官方提供的cli命令行工具和core核心包。在平时开发和学习的过程中，碰到@babel/和babel-时应该认识到它俩是作用相同、内容接近的包，只是版本不一样而已。\n\n## babel 配置文件\n\n> 指定编译的规则。\n\n```js\n.babelrc || babel.config.js || .babelrc.js || package.json（配置 babel 属性，配置项都是 一样的）\n```\n\n```js\n// package.json\n\n{\n  ...\n\n  babel: {\n    \"presets\": [\"es2015\", \"react\"],\n    \"plugin\": [\"transform-class-properties\"]\n  },\n\n  ...\n}\n```\n\n推荐使用后缀名是js的配置文件来进行配置，因为可以使用该文件做一些逻辑处理，适用性更强。\n\n## 插件 & 预设\n\nplugin代表插件，preset代表预设。通常每个插件或预设都是一个npm包。\n\nBabel的插件实在太多了，假如只配置插件数组，那我们前端工程要把ES2015、ES2016、ES2017……下的所有插件都写到配置项里，这样的Babel配置文件会非常臃肿。\n\npreset预设就是帮我们解决这个问题的。预设是一组Babel插件的集合，通俗的说法就是插件包，例如babel-preset-es2015就是所有处理ES2015的二十多个Babel插件的集合。这样我们就不用写一大堆插件配置项了，只需要用一个预设代替就可以。另外，预设也可以是插件和其他预设的集合。\n\nBabel官方已经针对常用的环境做了如下这些preset包。\n\n1）@babel/preset-env.\n\n2）@babel/preset-react.\n\n3）@babel/preset-typescript.\n\n4）@babel/preset-stage-0.\n\n5）@babel/preset-stage-1.\n\n## 插件与预设的简称\n\n如果插件的npm包名称的前缀为babel-plugin-，则可以省略其前缀。\n\n如果npm包名称的前缀带有npm作用域@，如@org/babel-plugin-xxx，则短名称可以写成@org/xxx。\n\n```js\n{\n  \"plugins\": [\"babel-plugin-transform-decorators-legacy\"]\n}\n\n// =====\n\n{\n  \"plugins\": [\"transform-decorators-legacy\"]\n}\n```\n\n预设的短名称规则与插件的类似，预设npm包名称的前缀为babel-preset-或作用域@xxx/babel-preset-xxx的可以省略掉babel-preset-。\n\n## 插件和预设执行顺序\n\nplugins插件数组和presets预设数组是有顺序要求的。如果两个插件或预设都要处理同一个代码片段，那么会根据插件和预设的顺序来执行。规则如下:\n\n1）插件比预设先执行。\n\n2）插件执行顺序是插件数组元素从前向后依次执行。\n\n3）预设执行顺序是预设数组元素从后向前依次执行。\n\n## 预设的选择\n\nbabel-preset-latest，在Babel 6时期，是所有年代preset的集合，在Babel 6最后一个版本中，它是babel-preset-es2015、babel-preset-es2016、babel-preset-es2017的集合。\n\n@babel/preset-env`包含了babel-preset-latest的功能，并对其进行了增强`，现在@babel/preset-env完全可以替代babel-preset-latest。\n\nBabel 6 中是babel-preset-env，Babel 7版本开始，@babel/preset-env。\n\n```js\n// babel 6\nnpm install babel-preset-env --save-dev\n\n// .babelrc\n{\n  \"presets\": [\"env\"]\n}\n\n// babel 7\nnpm install @babel/preset-env --save-dev\n\n// .babelrc\n{\n  \"presets\": [\"@babel/env\"]\n}\n```\n\n总结起来，Babel官方提供的预设，我们实际会用到的其实就只有四个。\n\n1）@babel/preset-env.\n\n2）@babel/preset-flow.\n\n3）@babel/preset-react.\n\n4）@babel/preset-typescript.\n\n\n## 插件的选择\n\nBabel 7 官方有九十多个插件，不过其中大多数都已经整合在@babel/preset-env和@babel/preset-react等预设里了，我们在开发的时候直接使用预设就可以。\n\n目前比较常用的插件只有@babel/plugin-transform-runtime。\n\n## browserslist\n\n在 package.json 中经常遇到这个配置项：\n\n```js\n// package.json\n\n{\n  \"browserslist\": [\n    \"> 1%\",\n    \"not ie <= 8\"\n  ]\n}\n```\n上面配置的含义是，该项目工程的目标环境是市场份额大于1%的浏览器并且不考虑IE 8及以下的IE浏览器。\n\nbrowserslist叫作目标环境配置表，除了写在package.json文件里，也可以单独写在工程目录下的.browserslistrc文件里。\n\n我们写一个含有箭头函数的 js 文件，如果我们在browserslist里指定目标环境是Chrome 60浏览器，再来看一下转换结果:\n```js\n// package.json\n{\n  \"browserslist\": [\"chrome 60\"]\n}\n```\n我们发现转换后的代码仍然是箭头函数，因为Chrome 60浏览器已经实现了箭头函数语法，所以不会转换成ES5的函数定义语法。\n\n## @babel/runtime\n\n我们写个 js 文件，里面包含 es6 的 class 语法:\n```js\nclass Person {\n  sayName() {\n    alert(this.name)\n  }\n}\n```\n\n然后执行 babel 命令，查看转换后的结果 `npx babel babel.js -o compiled.js`\n```js\n\"use strict\";\n\nvar _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nvar Person = function () {\n  function Person() {\n    _classCallCheck(this, Person);\n  }\n\n  _createClass(Person, [{\n    key: \"sayName\",\n    value: function sayName() {\n      alert(this.name);\n    }\n  }]);\n\n  return Person;\n}();\n```\n\n可以看到，转换后的代码上部增加了好几个函数声明，这些函数是Babel转码时注入的，我们称之为辅助函数。@babel/preset-env在做语法转换的时候，注入了这些函数声明，以便语法转换后使用。\n\n但这样做存在一个问题。在我们正常地进行前端工程开发的时候，少则有几十个JS文件，多则有上千个。如果每个文件里都使用了class类语法，那么会导致每个转换后的代码上部都会注入这些相同的函数声明。这会导致我们用构建工具打包出来的包体积非常大。\n\n那么应该怎么办呢？一个思路就是，我们把这些函数声明都放在一个npm包里，需要使用的时候直接从这个包里引入我们的文件。这样即使有上千个文件，也会从相同的包里引入这些函数。使用Webpack这一类的构建工具进行打包时，我们只需要引入一次npm包里的函数，这样就做到了复用，减小了包的体积。\n\n`@babel/runtime` 就是上面说的这个npm包，**@babel/runtime把所有语法转换会用到的辅助函数都集中在了一起。**\n\n```js\n// babbel 6\nnpm install babel-runtime --save-dev // /node_modules/babel-runtime/helpers/createClass.js\n\n// babel 7\nnpm install @babel/runtime@7.12.5 --save-dev\n```\n\n然后到node_modules目录下看一下这个包的结构，找到 _classCallCheck、_defineProperties与_createClass这三个辅助函数的位置，我们直接引入即可。\n\n这时，我们就可以替换转换后自动创建的方法，而是使用 @babel/runtime/helpers 中已有的方法。\n\n不过，这么多辅助函数要一个个记住并手动引入，是很难做到的。这时Babel插件 `@babel/plugin-transform-runtime` 就可以用来帮我们解决这个问题。\n\n## @babel/plugin-transform-runtime\n\n辅助函数的自动引入。\n\n@babel/plugin-transform-runtime有三大作用，其中之一就是自动移除语法转换后内联的辅助函数（inline Babel helpers），而是使用@babel/runtime/helpers里的辅助函数来替代，这样就减少了我们手动引入的麻烦。\n\n```js\n// babel6\nnpm install babel-plugin-transform-runtime --save-dev\n\n// babel 7\nnpm install @babel/plugin-transform-runtime@7.12.10 --save-dev\n```\n\n```js\n{\n  \"plugins\": [\"@babel/plugin-transform-runtime\"] // babel 6: \"babel-plugin-transform-runtime\"\n}\n```\n\n还是上面的例子，我们再看看转换后的结果，会发现插件已经自动帮我们处理了。\n\n```js\n\"use strict\";\n\nvar _classCallCheck2 = require(\"babel-runtime/helpers/classCallCheck\");\n\nvar _classCallCheck3 = _interopRequireDefault(_classCallCheck2);\n\nvar _createClass2 = require(\"babel-runtime/helpers/createClass\");\n\nvar _createClass3 = _interopRequireDefault(_createClass2);\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nvar Person = function () {\n  function Person() {\n    (0, _classCallCheck3.default)(this, Person);\n  }\n\n  (0, _createClass3.default)(Person, [{\n    key: \"sayName\",\n    value: function sayName() {\n      alert(this.name);\n    }\n  }]);\n  return Person;\n}();\n```\n\n实际进行前端开发时，我们除了安装@babel/runtime包，基本也会安装@babel/plugin-transform-runtime这个Babel插件。\n\n\n# Babel 原理与插件开发\n\nBabel的转码过程主要由三个阶段组成：解析（parse）、转换（transform）和生成（generate）。这三个阶段分别由@babel/parser、@babel/core和@babel/generator来完成。\n\n1. **解析阶段**\n\n该阶段由Babel读取源码并生成抽象语法树（AST），该阶段由两部分组成：词法分析与语法分析。\n\n词法分析会将字符串形式的代码转换成tokens流，语法分析会将tokens流转换成AST。\n\n```js\nconst name = \"hello AlexCc\"\n```\n\nAST\n\n```js\n-\n#1\n  type: VariableDeclaration\n  declarations\n    #1\n    type: VariableDeclarator\n    id\n      type: Identifier\n      name: name\n    init\n      type: Literal\n      value: hello AlexCc\n      raw: \"hello AlexCc\"\n    kind: const\n```\n\n2. **转换阶段**\n\n完成了解析工作，生成了AST，AST是一个树状的JSON结构。接下来就可以通过Babel插件对该树状结构执行修改操作，修改完成后就得到了新的AST。\n\n3. **生成阶段**\n\n通过转换阶段的工作，我们得到了新的AST。在生成阶段，我们对AST的树状JSON结构进行还原操作，生成新的JS代码，通常这就是我们需要的ES5代码。\n\n## Babel 插件开发\n> babel-handbook\n>\n> https://github.com/jamiebuilds/babel-handbook/blob/master/translations/zh-Hans/plugin-handbook.md\n\n开发Babel转码插件的重点是在第二阶段（转换阶段），在这一阶段我们要从AST上找出需要转换的节点，改成我们需要的形式，最后在生成阶段把AST变回JS代码。\n\n插件模板结构:\n\n```js\nmodule.exports = function({ types: t }) {\n  return {\n    name: 'pluginName',\n    visitor: {}\n  }\n}\n```\n\n假设我们有这样一段代码：\n\n```js\nconst dog = 'is dog'\n```\n\n现在我想将 dog 变成喵咪。\n\n```js\nmodule.exports = function({ types: t }) {\n  return {\n    visitor: {\n      Identifier(path, state) {\n        if (path.node.name === 'dog') {\n          path.node.name = 'cat'\n          path.parent.init.value = 'is cat'\n        }\n      },\n      var\n    }\n  }\n}\n```\n\n转换后：\n\n```js\nconst cat = 'is cat';\n```\n\n我们编写Babel插件的主要工作就是修改`visitor`对象，该对象是遍历AST各个节点的方法。\n\n在上面的插件里，要把变量名dog修改为cat，于是我们修改了visitor.Identifier方法，那我们如何知道要修改的是Identifier方法呢？\n\nBabel原理里讲过Babel转码的三个阶段：解析阶段、转换阶段和生成阶段，我们编写的Babel插件实际上是在执行第二个阶段（转换阶段）的工作，该工作需要前一个阶段解析工作先完成。在解析阶段，我们得到了转码前代码的AST树状结构信息，该AST上会有Identifier等节点信息，我们编写插件的时候参考该AST的信息即可。\n\n<img src=\"/img/ast.jpg\" />\n\n接着看Identifier方法，可以看到它有两个参数path和state，visitor中的每个方法都接收这两个参数，path代表路径。最后我们判断path上节点信息name是不是dog，是的话把它修改为cat即可。\n\n同理，我们也可以修改 `const`、`value`：\n\n```js\nmodule.exports = function({ types: t }) {\n  return {\n    visitor: {\n      Identifier(path, state) {\n        path.node.name = 'cat'\n        path.parent.init.value = 'is cat'\n      },\n      VariableDeclaration(path, state) {\n        if (path.node.kind === 'const') {\n          path.node.kind = 'let'\n        }\n      },\n      Literal(path, state) {\n        // 修改 value\n        path.node.value = 'is caaat...'\n      }\n    }\n  }\n}\n```\n\n## 插件传参\n\n给插件传递参数，注意第一个成员变成了数组，数组的第二项是参数\n\n```js\n// .babelrc\n{\n  \"plugins\": [[\"./plugin.js\", {\n    \"ES5\": false\n  }]]\n}\n```\n\n在插件中，我们可以通过 `state.opts` 获取到参数：\n\n```js\n// plugin.js\n\n...\nVariableDeclaration(path, state) {\n  if (state.opts.ES5 === true && ['let', 'const'].includes(path.node.kind)) {\n    path.node.kind = 'var'\n  }\n},\n...\n```\n\n# ESBuild\n> https://esbuild.github.io/api/\n\n> 介绍: https://juejin.cn/post/6918927987056312327\n","source":"_posts/ESM-ESBuild.md","raw":"---\nlayout: build\ntitle: ESM/ESBuild\ndate: 2022-09-13 17:11:35\ntags: ESM ESModule ESBuild\nbanner_img: /img/modules.jpg\nindex_img: /img/modules.jpg\nexcerpt: 继 CommonJS、AMD、CMD 几种模块化规范由社区提出后，ES 2015（ES6）在语言层面上实现了模块功能，且实现简单，可以替代CommonJS和AMD规范，成为在服务器和浏览器通用的解决方案。\n---\n\n# Module\n\n在ES6之前，社区制定了一些模块加载方案，最主要的有CommonJS和AMD两种。前者用于服务器，后者用于浏览器。\n\nES6在语言规格的层面上实现了模块功能，而且实现得相当简单，完全可以取代现有的CommonJS和AMD规范，成为浏览器和服务器通用的模块解决方案。\n\n\n## stage1\n\n> 文件划分方式，约定每一个 js 文件就是一个独立的模块\n\n```html\n<script src=\"./lib.js\"></script>\n<script src=\"./main.js\"></script>\n\n<script>\n  // 直接使用导入文件中的变量与方法\n  method1()\n\n  // 模块成员可以被修改\n  count = 2\n</script>\n```\n\n缺点：\n1. 污染全局作用域\n2. 命名冲突\n3. 无法管理模块间的依赖关系\n4. 模块成员可以在外部直接修改\n\n## stage2\n\n> 命名空间，减少命名冲突\n\n每个文件中，通过一个命名对象来包裹所有的变量和方法\n\n```js\n// module a 相关的数据和方法\n\nconst moduleA = {\n  name: 'module a',\n  count: 1,\n  incCount() {\n    this.count ++\n  }\n}\n```\n\n缺点：\n1. 污染全局作用域\n2. 无法管理模块间的依赖关系\n3. 模块成员可以在外部直接修改\n\n\n## stage3\n\n> IIFE（立即执行函数）\n\n```js\n;(function($){\n  const name = 'moduleA'\n  let count = 1\n  function incCount() {\n    count++\n  }\n\n  window.moduleA = {\n    incCount\n  }\n})(jQuery)\n```\n\n通过闭包的方式，模块内部的变量只能被模块内部修改，外部无法修改。\n\n通过 IIFE 的传参，我们可以传递一些依赖包给模块使用。\n\n# 模块化规范\n\n- CommonJS（NodeJS）\n\n  1. 一个文件就是一个模块\n  2. 每个模块都有单独的作用域\n  3. 通过 module.exports 导出成员\n  4. 通过 require 函数加载成员\n\n以同步的方式加载模块，如果放在浏览器中，那么会出现大量的文件请求，有时候并不是立马就需要的文件也会被加载，从而造成性能问题，不适合在浏览器中使用。\n\n- AMD（Asyncronous module definition）\n\n  异步的模块定义\n\n```js\n// 定义一个模块\n// 第二个参数表示当前模块的依赖项\ndefine('module1', ['lodash', './module2'], function('lodash', 'module2') {\n  \n  // 导出成员，外部可以方法 start 方法\n  return {\n    start:function() {\n      // lodash\n\n      module2()\n    }\n  }\n})\n\n  // 加载模块\n\n  require('./module1', function(module1) {\n    module1.start()\n  })\n  ```\n\n- CMD规范（类似 CommonJS）\n\n- ES Modules（浏览器）\n\n# ES6 模块化\n\n```html\n<script src=\"./main.js\" type=\"module\"></script>\n\n<script type=\"module\">\n  console.log(1)\n</script>\n```\n\n特性：\n\n- ES6的模块自动采用严格模式，不管有没有在模块头部加上＂use strict＂。\n- 每个 ES Module 都运行在私有作用域中\n- ESM 是通过 CORS(跨域) 的方式去请求外部的 JS 资源的。（原 script 标签默认支持跨域）\n- ESM 的 script 标签会延迟执行脚本（类似标签的 defer 属性），等待网页渲染完成后，再执行。\n  ```js\n  // 会比有 type=\"module\" 的script 先执行\n  <script>\n    alert('hello')\n  </script>\n\n  // 延迟执行\n  <script type=\"module\"> // 等同于加了 defer 属性\n    console.log(1)\n  </script>\n  ```\n\n严格模式主要有以下限制：\n\n- 变量必须声明后再使用。\n- 函数的参数不能有同名属性，否则报错。\n- 不能使用with语句。\n- 不能对只读属性赋值，否则报错。\n- 不能使用前缀0表示八进制数，否则报错。\n- 不能删除不可删除的属性，否则报错。\n- 不能删除变量(delete prop)，会报错，只能删除属性(delete global[prop])。\n- eval不会在其外层作用域引入变量。\n- eval和arguments不能被重新赋值。\n- arguments不会自动反映函数参数的变化。\n- 不能使用arguments.callee。\n- 不能使用arguments.caller。\n- 禁止this指向全局对象。\n- 不能使用fn.caller和fn.arguments获取函数调用的堆栈。\n- 增加了保留字（比如protected、static和interface）。\n\n## export & import\n\n模块功能主要由两个命令构成：export和import。\n\nexport命令用于规定模块的对外接口，import命令用于输入其他模块提供的功能。一个模块就是一个独立的文件。该文件内部的所有变量，外部无法获取。\n\n如果希望外部能够读取模块内部的某个变量，就必须使用export关键字输出该变量。\n\n```js\n// test.js\nexport const myName = 'Hello_AlexCC'\n\n// 组合导出\nconst myAge = 18\nconst sayMe = function() {\n  console.log(`my name is ${myName}, and I'm ${myAge} years old!`)\n}\n\nexport {\n  myAge,\n  sayMe\n}\n```\n\n如果在一个模块中先输入后输出同一个模块，import语句可以与export语句写在一起。\n\n```js\nexport { sayName as default} from './someModule'\n\n// 等价于\n\nimport { sayName } from './someModule'\nexport default sayName\n```\n\n另外，ES7有一个提案(https://github.com/leebyron/ecmascript-more-export-from)，简化先输入后输出的写法，拿掉了输出时的大括号。\n\n```js\n// 提案\nexport v from 'mod'\n\n// 现在\nexport { v } from 'mod'\n```\n\nimport语句会执行所加载的模块\n\n```js\nimport 'lodash'\n```\n\n## 模块整体加载\n```js\nimport * as myModule from './myModule'\n```\n\n## module 命令\nmodule命令可以取代import语句，达到整体输入模块的作用。\n\n```js\nmodule myModule from './myModule'\n\nmyModule.sayName()\n```\n\n## 动态加载模块\n\n返回的是 Promise\n\n```js\nimport('./moduleA.js').then(module => {\n  ...\n})\n```\n\n## ES6模块加载的实质\n\nES6模块加载的机制与CommonJS模块完全不同。\n\nCommonJS模块输出的是一个值的拷贝，而ES6模块输出的是 `值的引用`。\n\n```js\n// lib.js\nexport let count = 1\nexport function incCount() {\n  count++\n}\n\n// main.js\nimport { count, incCount } from './lib.js'\n\nconsole.log(count) // 1\n\nincCount()\n\nconsole.log(count) // 2\n```\n\n\n注意加上 type=\"module\"\n\n```html\n<script src=\"./main.js\" type=\"module\"></script>\n```\n\n## ES Module in NodeJS\n\n如何在 Nodejs 中使用 ES module!\n\n有两个步骤：\n\n1. `.js` 后缀都改为 `.mjs`\n2. 执行脚本时，加上 `node --experimental-modules main.mjs`\n\n```js\n// node\n\n// main.mjs\nimport fs from 'fs'\nimport _ from 'lodash'\n```\n\n注意事项：\n\n1. 在 node 环境中，我们可以使用 ES Module 导入 CommonJS 导出的成员\n\n```js\n// commonjs.js\nmodule.exports = {\n  foo: 'commonjs exports foo'\n}\n\n// esmodule.js\nimport mod from './commonjs.js'\n\nconsole.log(mod.foo)\n```\n\n2. 在 node 环境中，CommonJS 中`不能`导入 ES Module 导出的成员\n\n```js\nconst mod = require('./esmodule.js') // 报错\n```\n\n## CommonJS 与 ES Module 差异\n\n```js\n// CommonJS\n\nrequire // 加载模块函数\n\nmodule // 模块对象\n\nexports // 导出对象别名 exports.name = 'hello world'\n\n__filename // 当前文件的绝对路径\n\n__dirname // 当前文件所在目录\n```\n\n```js\n// ES Module\n\nimport.meta.url // 文件路径信息\n\n// 可以通过内置模块 url 和 path 处理，拿到 __filename 和 __dirname\nimport { fileURLToPath } from 'url'\nimport { dirname } from 'path'\n\nconst __filename = fileURLToPath(import.meta.url)\nconst __dirname = dirname(__filename)\n```\n\n## 高版本 NodeJS 已支持 ESM (Version > 12.10.0)\n\n不需要再写 `.mjs` 结尾了，直接 `.js`\n\n```js\n// package.json\n{\n  \"type\": \"module\"\n}\n\n// 执行\nnode --experimental-modules main.js \n```\n\n加上 type module 配置之后，如果我们还想用 `CommonJS` 规范，发现会报错了。因为我们已经使用了 ESM。\n\n如果继续使用 `CommonJS` 规范，那么就需要将 `.js` 改为 `.cjs`。\n\n## ESM in NodeJS （babel 兼容方案）\n\n> yarn add @babel/node @babel/preset-env --save-dev\n\n```js\n// 通过 babel-node 命令执行脚本\nyarn babel-node main.js\n```\n\n要注意的是，`babel/core` 并不会转换我们的代码，转换代码的工作交给 babel 内置的插件去实现的。也就是说，我们需要一个插件，去转换 ES6 中的一个新特性。\n\n<img src=\"/img/babel.jpg\" />\n\n而 `@bable/preset-env` 是插件的集合，所以不需要每个插件都安装一遍。\n\n```js\n// 命令行使用\nyarn babel-node main.js --presets=@bable/preset-env\n```\n\n结合 babel 配置文件使用\n```js\n// .babelrc\n{\n  \"presets\": [\"@babel/presets-env\"]\n}\n\nyarn babel-node main.js\n```\n\n既然 `@babel/preset-env` 是插件的集合，而我不想要那么多，只是想处理 `ESM` 怎么办呢？\n\n我们卸载掉 `@babel/preset-env`，安装 `@babel/plugin-transform-modules-commonjs`\n\n```js\n// .babelrc\n{\n  \"presets\": [\"@babel/plugin-transform-modules-commonjs\"]\n}\n\nyarn babel-node main.js\n```\n\n# babel\n\n> 编译器\n\n主要用于将ES6版本的JS代码转换为ES5等向后兼容的JS代码，从而使代码可以运行在低版本浏览器或其他环境中。\n\n> npm install --save-dev babel-core babel-preset-es2015 babel-preset-latest --registry=https://registry.npm.taobao.org\n\n配置文件 `.babelrc`（或者 babel.config.js || .babelrc.js）\n\n```js\n{\n  \"presets\": [\"es2015\", \"latest\"], // 安装包的别名，用来处理最新的 ES6 语法\n  \"plugins\": []\n}\n```\n\n安装 `babel-cli`，命令行编译工具，依赖 `babel/core`\n\n```js\nnpm install --save-dev babel-cli \n```\n\n查看 babel 版本（npx 是新版 NodeJS 附带的命令）\n\n```js\nnpx babel --version // ===== node_modules/.bin/babel --version \n\n// ====> 6.26.0 (babel-core 6.26.3)\n```\n\n到这里，我们就可以使用 babel 来编译js 文件了。创建一个 babel.js 文件，写入一些 es6 的语法。\n\n```js\n// babel.js\n\nconst foo = () => {\n  return 3 * 3\n}\n\nconst count = 123\n```\n\n打开命令行工具：\n\n```js\nnpx babel babel.js -o compiled.js // 等效 node_modules/.bin/babel babel.js -o compiled.js \n```\n\n转化后的结果：\n\n```js\n\"use strict\";\n\nvar foo = function foo() {\n  return 3 * 3;\n};\n\nvar count = 123;\n```\n\n## Polyfill\n\nBabel默认只转换新的JS语法（syntax），而不转换新的API（Promise、Map）。如果只是做语法转换，Promise 是不会被降级的，在低版本的浏览器中可能无法使用。\n\n引入 Polyfill，为当前环境提供一个“垫片”。所谓“垫片”，是指垫平不同浏览器之间差异的东西。polyfill提供了全局的ES6对象及通过修改原型链Array.prototype等来补充对实例的实现。\n\n## babel 版本\n\nBabel版本主要是Babel 6和Babel 7这两个版本。\n\n提到Babel版本的时候，通常指的是@babel/core这个Babel核心包的版本。\n\nBabel 7的npm包都存放在babel域下，即在安装npm包的时候，我们安装的是名称以@babel/开头的npm包，如@babel/cli、@babel/core等。而在Babel 6中，我们安装的包名是babel-cli、babel-core等以babel-开头的npm包。其实它们本质上是一样的，都是Babel官方提供的cli命令行工具和core核心包。在平时开发和学习的过程中，碰到@babel/和babel-时应该认识到它俩是作用相同、内容接近的包，只是版本不一样而已。\n\n## babel 配置文件\n\n> 指定编译的规则。\n\n```js\n.babelrc || babel.config.js || .babelrc.js || package.json（配置 babel 属性，配置项都是 一样的）\n```\n\n```js\n// package.json\n\n{\n  ...\n\n  babel: {\n    \"presets\": [\"es2015\", \"react\"],\n    \"plugin\": [\"transform-class-properties\"]\n  },\n\n  ...\n}\n```\n\n推荐使用后缀名是js的配置文件来进行配置，因为可以使用该文件做一些逻辑处理，适用性更强。\n\n## 插件 & 预设\n\nplugin代表插件，preset代表预设。通常每个插件或预设都是一个npm包。\n\nBabel的插件实在太多了，假如只配置插件数组，那我们前端工程要把ES2015、ES2016、ES2017……下的所有插件都写到配置项里，这样的Babel配置文件会非常臃肿。\n\npreset预设就是帮我们解决这个问题的。预设是一组Babel插件的集合，通俗的说法就是插件包，例如babel-preset-es2015就是所有处理ES2015的二十多个Babel插件的集合。这样我们就不用写一大堆插件配置项了，只需要用一个预设代替就可以。另外，预设也可以是插件和其他预设的集合。\n\nBabel官方已经针对常用的环境做了如下这些preset包。\n\n1）@babel/preset-env.\n\n2）@babel/preset-react.\n\n3）@babel/preset-typescript.\n\n4）@babel/preset-stage-0.\n\n5）@babel/preset-stage-1.\n\n## 插件与预设的简称\n\n如果插件的npm包名称的前缀为babel-plugin-，则可以省略其前缀。\n\n如果npm包名称的前缀带有npm作用域@，如@org/babel-plugin-xxx，则短名称可以写成@org/xxx。\n\n```js\n{\n  \"plugins\": [\"babel-plugin-transform-decorators-legacy\"]\n}\n\n// =====\n\n{\n  \"plugins\": [\"transform-decorators-legacy\"]\n}\n```\n\n预设的短名称规则与插件的类似，预设npm包名称的前缀为babel-preset-或作用域@xxx/babel-preset-xxx的可以省略掉babel-preset-。\n\n## 插件和预设执行顺序\n\nplugins插件数组和presets预设数组是有顺序要求的。如果两个插件或预设都要处理同一个代码片段，那么会根据插件和预设的顺序来执行。规则如下:\n\n1）插件比预设先执行。\n\n2）插件执行顺序是插件数组元素从前向后依次执行。\n\n3）预设执行顺序是预设数组元素从后向前依次执行。\n\n## 预设的选择\n\nbabel-preset-latest，在Babel 6时期，是所有年代preset的集合，在Babel 6最后一个版本中，它是babel-preset-es2015、babel-preset-es2016、babel-preset-es2017的集合。\n\n@babel/preset-env`包含了babel-preset-latest的功能，并对其进行了增强`，现在@babel/preset-env完全可以替代babel-preset-latest。\n\nBabel 6 中是babel-preset-env，Babel 7版本开始，@babel/preset-env。\n\n```js\n// babel 6\nnpm install babel-preset-env --save-dev\n\n// .babelrc\n{\n  \"presets\": [\"env\"]\n}\n\n// babel 7\nnpm install @babel/preset-env --save-dev\n\n// .babelrc\n{\n  \"presets\": [\"@babel/env\"]\n}\n```\n\n总结起来，Babel官方提供的预设，我们实际会用到的其实就只有四个。\n\n1）@babel/preset-env.\n\n2）@babel/preset-flow.\n\n3）@babel/preset-react.\n\n4）@babel/preset-typescript.\n\n\n## 插件的选择\n\nBabel 7 官方有九十多个插件，不过其中大多数都已经整合在@babel/preset-env和@babel/preset-react等预设里了，我们在开发的时候直接使用预设就可以。\n\n目前比较常用的插件只有@babel/plugin-transform-runtime。\n\n## browserslist\n\n在 package.json 中经常遇到这个配置项：\n\n```js\n// package.json\n\n{\n  \"browserslist\": [\n    \"> 1%\",\n    \"not ie <= 8\"\n  ]\n}\n```\n上面配置的含义是，该项目工程的目标环境是市场份额大于1%的浏览器并且不考虑IE 8及以下的IE浏览器。\n\nbrowserslist叫作目标环境配置表，除了写在package.json文件里，也可以单独写在工程目录下的.browserslistrc文件里。\n\n我们写一个含有箭头函数的 js 文件，如果我们在browserslist里指定目标环境是Chrome 60浏览器，再来看一下转换结果:\n```js\n// package.json\n{\n  \"browserslist\": [\"chrome 60\"]\n}\n```\n我们发现转换后的代码仍然是箭头函数，因为Chrome 60浏览器已经实现了箭头函数语法，所以不会转换成ES5的函数定义语法。\n\n## @babel/runtime\n\n我们写个 js 文件，里面包含 es6 的 class 语法:\n```js\nclass Person {\n  sayName() {\n    alert(this.name)\n  }\n}\n```\n\n然后执行 babel 命令，查看转换后的结果 `npx babel babel.js -o compiled.js`\n```js\n\"use strict\";\n\nvar _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nvar Person = function () {\n  function Person() {\n    _classCallCheck(this, Person);\n  }\n\n  _createClass(Person, [{\n    key: \"sayName\",\n    value: function sayName() {\n      alert(this.name);\n    }\n  }]);\n\n  return Person;\n}();\n```\n\n可以看到，转换后的代码上部增加了好几个函数声明，这些函数是Babel转码时注入的，我们称之为辅助函数。@babel/preset-env在做语法转换的时候，注入了这些函数声明，以便语法转换后使用。\n\n但这样做存在一个问题。在我们正常地进行前端工程开发的时候，少则有几十个JS文件，多则有上千个。如果每个文件里都使用了class类语法，那么会导致每个转换后的代码上部都会注入这些相同的函数声明。这会导致我们用构建工具打包出来的包体积非常大。\n\n那么应该怎么办呢？一个思路就是，我们把这些函数声明都放在一个npm包里，需要使用的时候直接从这个包里引入我们的文件。这样即使有上千个文件，也会从相同的包里引入这些函数。使用Webpack这一类的构建工具进行打包时，我们只需要引入一次npm包里的函数，这样就做到了复用，减小了包的体积。\n\n`@babel/runtime` 就是上面说的这个npm包，**@babel/runtime把所有语法转换会用到的辅助函数都集中在了一起。**\n\n```js\n// babbel 6\nnpm install babel-runtime --save-dev // /node_modules/babel-runtime/helpers/createClass.js\n\n// babel 7\nnpm install @babel/runtime@7.12.5 --save-dev\n```\n\n然后到node_modules目录下看一下这个包的结构，找到 _classCallCheck、_defineProperties与_createClass这三个辅助函数的位置，我们直接引入即可。\n\n这时，我们就可以替换转换后自动创建的方法，而是使用 @babel/runtime/helpers 中已有的方法。\n\n不过，这么多辅助函数要一个个记住并手动引入，是很难做到的。这时Babel插件 `@babel/plugin-transform-runtime` 就可以用来帮我们解决这个问题。\n\n## @babel/plugin-transform-runtime\n\n辅助函数的自动引入。\n\n@babel/plugin-transform-runtime有三大作用，其中之一就是自动移除语法转换后内联的辅助函数（inline Babel helpers），而是使用@babel/runtime/helpers里的辅助函数来替代，这样就减少了我们手动引入的麻烦。\n\n```js\n// babel6\nnpm install babel-plugin-transform-runtime --save-dev\n\n// babel 7\nnpm install @babel/plugin-transform-runtime@7.12.10 --save-dev\n```\n\n```js\n{\n  \"plugins\": [\"@babel/plugin-transform-runtime\"] // babel 6: \"babel-plugin-transform-runtime\"\n}\n```\n\n还是上面的例子，我们再看看转换后的结果，会发现插件已经自动帮我们处理了。\n\n```js\n\"use strict\";\n\nvar _classCallCheck2 = require(\"babel-runtime/helpers/classCallCheck\");\n\nvar _classCallCheck3 = _interopRequireDefault(_classCallCheck2);\n\nvar _createClass2 = require(\"babel-runtime/helpers/createClass\");\n\nvar _createClass3 = _interopRequireDefault(_createClass2);\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nvar Person = function () {\n  function Person() {\n    (0, _classCallCheck3.default)(this, Person);\n  }\n\n  (0, _createClass3.default)(Person, [{\n    key: \"sayName\",\n    value: function sayName() {\n      alert(this.name);\n    }\n  }]);\n  return Person;\n}();\n```\n\n实际进行前端开发时，我们除了安装@babel/runtime包，基本也会安装@babel/plugin-transform-runtime这个Babel插件。\n\n\n# Babel 原理与插件开发\n\nBabel的转码过程主要由三个阶段组成：解析（parse）、转换（transform）和生成（generate）。这三个阶段分别由@babel/parser、@babel/core和@babel/generator来完成。\n\n1. **解析阶段**\n\n该阶段由Babel读取源码并生成抽象语法树（AST），该阶段由两部分组成：词法分析与语法分析。\n\n词法分析会将字符串形式的代码转换成tokens流，语法分析会将tokens流转换成AST。\n\n```js\nconst name = \"hello AlexCc\"\n```\n\nAST\n\n```js\n-\n#1\n  type: VariableDeclaration\n  declarations\n    #1\n    type: VariableDeclarator\n    id\n      type: Identifier\n      name: name\n    init\n      type: Literal\n      value: hello AlexCc\n      raw: \"hello AlexCc\"\n    kind: const\n```\n\n2. **转换阶段**\n\n完成了解析工作，生成了AST，AST是一个树状的JSON结构。接下来就可以通过Babel插件对该树状结构执行修改操作，修改完成后就得到了新的AST。\n\n3. **生成阶段**\n\n通过转换阶段的工作，我们得到了新的AST。在生成阶段，我们对AST的树状JSON结构进行还原操作，生成新的JS代码，通常这就是我们需要的ES5代码。\n\n## Babel 插件开发\n> babel-handbook\n>\n> https://github.com/jamiebuilds/babel-handbook/blob/master/translations/zh-Hans/plugin-handbook.md\n\n开发Babel转码插件的重点是在第二阶段（转换阶段），在这一阶段我们要从AST上找出需要转换的节点，改成我们需要的形式，最后在生成阶段把AST变回JS代码。\n\n插件模板结构:\n\n```js\nmodule.exports = function({ types: t }) {\n  return {\n    name: 'pluginName',\n    visitor: {}\n  }\n}\n```\n\n假设我们有这样一段代码：\n\n```js\nconst dog = 'is dog'\n```\n\n现在我想将 dog 变成喵咪。\n\n```js\nmodule.exports = function({ types: t }) {\n  return {\n    visitor: {\n      Identifier(path, state) {\n        if (path.node.name === 'dog') {\n          path.node.name = 'cat'\n          path.parent.init.value = 'is cat'\n        }\n      },\n      var\n    }\n  }\n}\n```\n\n转换后：\n\n```js\nconst cat = 'is cat';\n```\n\n我们编写Babel插件的主要工作就是修改`visitor`对象，该对象是遍历AST各个节点的方法。\n\n在上面的插件里，要把变量名dog修改为cat，于是我们修改了visitor.Identifier方法，那我们如何知道要修改的是Identifier方法呢？\n\nBabel原理里讲过Babel转码的三个阶段：解析阶段、转换阶段和生成阶段，我们编写的Babel插件实际上是在执行第二个阶段（转换阶段）的工作，该工作需要前一个阶段解析工作先完成。在解析阶段，我们得到了转码前代码的AST树状结构信息，该AST上会有Identifier等节点信息，我们编写插件的时候参考该AST的信息即可。\n\n<img src=\"/img/ast.jpg\" />\n\n接着看Identifier方法，可以看到它有两个参数path和state，visitor中的每个方法都接收这两个参数，path代表路径。最后我们判断path上节点信息name是不是dog，是的话把它修改为cat即可。\n\n同理，我们也可以修改 `const`、`value`：\n\n```js\nmodule.exports = function({ types: t }) {\n  return {\n    visitor: {\n      Identifier(path, state) {\n        path.node.name = 'cat'\n        path.parent.init.value = 'is cat'\n      },\n      VariableDeclaration(path, state) {\n        if (path.node.kind === 'const') {\n          path.node.kind = 'let'\n        }\n      },\n      Literal(path, state) {\n        // 修改 value\n        path.node.value = 'is caaat...'\n      }\n    }\n  }\n}\n```\n\n## 插件传参\n\n给插件传递参数，注意第一个成员变成了数组，数组的第二项是参数\n\n```js\n// .babelrc\n{\n  \"plugins\": [[\"./plugin.js\", {\n    \"ES5\": false\n  }]]\n}\n```\n\n在插件中，我们可以通过 `state.opts` 获取到参数：\n\n```js\n// plugin.js\n\n...\nVariableDeclaration(path, state) {\n  if (state.opts.ES5 === true && ['let', 'const'].includes(path.node.kind)) {\n    path.node.kind = 'var'\n  }\n},\n...\n```\n\n# ESBuild\n> https://esbuild.github.io/api/\n\n> 介绍: https://juejin.cn/post/6918927987056312327\n","slug":"ESM-ESBuild","published":1,"updated":"2023-05-12T12:17:13.035Z","comments":1,"photos":[],"link":"","_id":"clhkizgy9002x3y0qbrnr9vze","content":"<h1 id=\"Module\"><a href=\"#Module\" class=\"headerlink\" title=\"Module\"></a>Module</h1><p>在ES6之前，社区制定了一些模块加载方案，最主要的有CommonJS和AMD两种。前者用于服务器，后者用于浏览器。</p>\n<p>ES6在语言规格的层面上实现了模块功能，而且实现得相当简单，完全可以取代现有的CommonJS和AMD规范，成为浏览器和服务器通用的模块解决方案。</p>\n<h2 id=\"stage1\"><a href=\"#stage1\" class=\"headerlink\" title=\"stage1\"></a>stage1</h2><blockquote>\n<p>文件划分方式，约定每一个 js 文件就是一个独立的模块</p>\n</blockquote>\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><div class=\"code-wrapper\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></div></td><td class=\"code\"><pre><code class=\"hljs html\"><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">script</span> <span class=\"hljs-attr\">src</span>=<span class=\"hljs-string\">&quot;./lib.js&quot;</span>&gt;</span><span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">script</span>&gt;</span><br><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">script</span> <span class=\"hljs-attr\">src</span>=<span class=\"hljs-string\">&quot;./main.js&quot;</span>&gt;</span><span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">script</span>&gt;</span><br><br><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">script</span>&gt;</span><span class=\"language-javascript\"></span><br><span class=\"language-javascript\">  <span class=\"hljs-comment\">// 直接使用导入文件中的变量与方法</span></span><br><span class=\"language-javascript\">  <span class=\"hljs-title function_\">method1</span>()</span><br><span class=\"language-javascript\"></span><br><span class=\"language-javascript\">  <span class=\"hljs-comment\">// 模块成员可以被修改</span></span><br><span class=\"language-javascript\">  count = <span class=\"hljs-number\">2</span></span><br><span class=\"language-javascript\"></span><span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">script</span>&gt;</span><br></code></pre></td></tr></table></figure>\n\n<p>缺点：</p>\n<ol>\n<li>污染全局作用域</li>\n<li>命名冲突</li>\n<li>无法管理模块间的依赖关系</li>\n<li>模块成员可以在外部直接修改</li>\n</ol>\n<h2 id=\"stage2\"><a href=\"#stage2\" class=\"headerlink\" title=\"stage2\"></a>stage2</h2><blockquote>\n<p>命名空间，减少命名冲突</p>\n</blockquote>\n<p>每个文件中，通过一个命名对象来包裹所有的变量和方法</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\"><span class=\"hljs-comment\">// module a 相关的数据和方法</span><br><br><span class=\"hljs-keyword\">const</span> moduleA = &#123;<br>  <span class=\"hljs-attr\">name</span>: <span class=\"hljs-string\">&#x27;module a&#x27;</span>,<br>  <span class=\"hljs-attr\">count</span>: <span class=\"hljs-number\">1</span>,<br>  <span class=\"hljs-title function_\">incCount</span>(<span class=\"hljs-params\"></span>) &#123;<br>    <span class=\"hljs-variable language_\">this</span>.<span class=\"hljs-property\">count</span> ++<br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure>\n\n<p>缺点：</p>\n<ol>\n<li>污染全局作用域</li>\n<li>无法管理模块间的依赖关系</li>\n<li>模块成员可以在外部直接修改</li>\n</ol>\n<h2 id=\"stage3\"><a href=\"#stage3\" class=\"headerlink\" title=\"stage3\"></a>stage3</h2><blockquote>\n<p>IIFE（立即执行函数）</p>\n</blockquote>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\">;(<span class=\"hljs-keyword\">function</span>(<span class=\"hljs-params\">$</span>)&#123;<br>  <span class=\"hljs-keyword\">const</span> name = <span class=\"hljs-string\">&#x27;moduleA&#x27;</span><br>  <span class=\"hljs-keyword\">let</span> count = <span class=\"hljs-number\">1</span><br>  <span class=\"hljs-keyword\">function</span> <span class=\"hljs-title function_\">incCount</span>(<span class=\"hljs-params\"></span>) &#123;<br>    count++<br>  &#125;<br><br>  <span class=\"hljs-variable language_\">window</span>.<span class=\"hljs-property\">moduleA</span> = &#123;<br>    incCount<br>  &#125;<br>&#125;)(jQuery)<br></code></pre></td></tr></table></figure>\n\n<p>通过闭包的方式，模块内部的变量只能被模块内部修改，外部无法修改。</p>\n<p>通过 IIFE 的传参，我们可以传递一些依赖包给模块使用。</p>\n<h1 id=\"模块化规范\"><a href=\"#模块化规范\" class=\"headerlink\" title=\"模块化规范\"></a>模块化规范</h1><ul>\n<li><p>CommonJS（NodeJS）</p>\n<ol>\n<li>一个文件就是一个模块</li>\n<li>每个模块都有单独的作用域</li>\n<li>通过 module.exports 导出成员</li>\n<li>通过 require 函数加载成员</li>\n</ol>\n</li>\n</ul>\n<p>以同步的方式加载模块，如果放在浏览器中，那么会出现大量的文件请求，有时候并不是立马就需要的文件也会被加载，从而造成性能问题，不适合在浏览器中使用。</p>\n<ul>\n<li><p>AMD（Asyncronous module definition）</p>\n<p>异步的模块定义</p>\n</li>\n</ul>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\"><span class=\"hljs-comment\">// 定义一个模块</span><br><span class=\"hljs-comment\">// 第二个参数表示当前模块的依赖项</span><br><span class=\"hljs-title function_\">define</span>(<span class=\"hljs-string\">&#x27;module1&#x27;</span>, [<span class=\"hljs-string\">&#x27;lodash&#x27;</span>, <span class=\"hljs-string\">&#x27;./module2&#x27;</span>], <span class=\"hljs-keyword\">function</span>(<span class=\"hljs-params\"><span class=\"hljs-string\">&#x27;lodash&#x27;</span>, <span class=\"hljs-string\">&#x27;module2&#x27;</span></span>) &#123;<br>  <br>  <span class=\"hljs-comment\">// 导出成员，外部可以方法 start 方法</span><br>  <span class=\"hljs-keyword\">return</span> &#123;<br>    <span class=\"hljs-attr\">start</span>:<span class=\"hljs-keyword\">function</span>(<span class=\"hljs-params\"></span>) &#123;<br>      <span class=\"hljs-comment\">// lodash</span><br><br>      <span class=\"hljs-title function_\">module2</span>()<br>    &#125;<br>  &#125;<br>&#125;)<br><br>  <span class=\"hljs-comment\">// 加载模块</span><br><br>  <span class=\"hljs-built_in\">require</span>(<span class=\"hljs-string\">&#x27;./module1&#x27;</span>, <span class=\"hljs-keyword\">function</span>(<span class=\"hljs-params\">module1</span>) &#123;<br>    module1.<span class=\"hljs-title function_\">start</span>()<br>  &#125;)<br></code></pre></td></tr></table></figure>\n\n<ul>\n<li><p>CMD规范（类似 CommonJS）</p>\n</li>\n<li><p>ES Modules（浏览器）</p>\n</li>\n</ul>\n<h1 id=\"ES6-模块化\"><a href=\"#ES6-模块化\" class=\"headerlink\" title=\"ES6 模块化\"></a>ES6 模块化</h1><figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs html\"><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">script</span> <span class=\"hljs-attr\">src</span>=<span class=\"hljs-string\">&quot;./main.js&quot;</span> <span class=\"hljs-attr\">type</span>=<span class=\"hljs-string\">&quot;module&quot;</span>&gt;</span><span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">script</span>&gt;</span><br><br><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">script</span> <span class=\"hljs-attr\">type</span>=<span class=\"hljs-string\">&quot;module&quot;</span>&gt;</span><span class=\"language-javascript\"></span><br><span class=\"language-javascript\">  <span class=\"hljs-variable language_\">console</span>.<span class=\"hljs-title function_\">log</span>(<span class=\"hljs-number\">1</span>)</span><br><span class=\"language-javascript\"></span><span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">script</span>&gt;</span><br></code></pre></td></tr></table></figure>\n\n<p>特性：</p>\n<ul>\n<li>ES6的模块自动采用严格模式，不管有没有在模块头部加上＂use strict＂。</li>\n<li>每个 ES Module 都运行在私有作用域中</li>\n<li>ESM 是通过 CORS(跨域) 的方式去请求外部的 JS 资源的。（原 script 标签默认支持跨域）</li>\n<li>ESM 的 script 标签会延迟执行脚本（类似标签的 defer 属性），等待网页渲染完成后，再执行。<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\"><span class=\"hljs-comment\">// 会比有 type=&quot;module&quot; 的script 先执行</span><br>&lt;script&gt;<br>  <span class=\"hljs-title function_\">alert</span>(<span class=\"hljs-string\">&#x27;hello&#x27;</span>)<br>&lt;/script&gt;<br><br><span class=\"hljs-comment\">// 延迟执行</span><br><span class=\"language-xml\"><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">script</span> <span class=\"hljs-attr\">type</span>=<span class=\"hljs-string\">&quot;module&quot;</span>&gt;</span><span class=\"language-javascript\"> <span class=\"hljs-comment\">// 等同于加了 defer 属性</span></span></span><br><span class=\"language-javascript\"><span class=\"language-xml\">  <span class=\"hljs-variable language_\">console</span>.<span class=\"hljs-title function_\">log</span>(<span class=\"hljs-number\">1</span>)</span></span><br><span class=\"language-javascript\"><span class=\"language-xml\"></span><span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">script</span>&gt;</span></span><br></code></pre></td></tr></table></figure>\n\n</li>\n</ul>\n<p>严格模式主要有以下限制：</p>\n<ul>\n<li>变量必须声明后再使用。</li>\n<li>函数的参数不能有同名属性，否则报错。</li>\n<li>不能使用with语句。</li>\n<li>不能对只读属性赋值，否则报错。</li>\n<li>不能使用前缀0表示八进制数，否则报错。</li>\n<li>不能删除不可删除的属性，否则报错。</li>\n<li>不能删除变量(delete prop)，会报错，只能删除属性(delete global[prop])。</li>\n<li>eval不会在其外层作用域引入变量。</li>\n<li>eval和arguments不能被重新赋值。</li>\n<li>arguments不会自动反映函数参数的变化。</li>\n<li>不能使用arguments.callee。</li>\n<li>不能使用arguments.caller。</li>\n<li>禁止this指向全局对象。</li>\n<li>不能使用fn.caller和fn.arguments获取函数调用的堆栈。</li>\n<li>增加了保留字（比如protected、static和interface）。</li>\n</ul>\n<h2 id=\"export-amp-import\"><a href=\"#export-amp-import\" class=\"headerlink\" title=\"export &amp; import\"></a>export &amp; import</h2><p>模块功能主要由两个命令构成：export和import。</p>\n<p>export命令用于规定模块的对外接口，import命令用于输入其他模块提供的功能。一个模块就是一个独立的文件。该文件内部的所有变量，外部无法获取。</p>\n<p>如果希望外部能够读取模块内部的某个变量，就必须使用export关键字输出该变量。</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\"><span class=\"hljs-comment\">// test.js</span><br><span class=\"hljs-keyword\">export</span> <span class=\"hljs-keyword\">const</span> myName = <span class=\"hljs-string\">&#x27;Hello_AlexCC&#x27;</span><br><br><span class=\"hljs-comment\">// 组合导出</span><br><span class=\"hljs-keyword\">const</span> myAge = <span class=\"hljs-number\">18</span><br><span class=\"hljs-keyword\">const</span> sayMe = <span class=\"hljs-keyword\">function</span>(<span class=\"hljs-params\"></span>) &#123;<br>  <span class=\"hljs-variable language_\">console</span>.<span class=\"hljs-title function_\">log</span>(<span class=\"hljs-string\">`my name is <span class=\"hljs-subst\">$&#123;myName&#125;</span>, and I&#x27;m <span class=\"hljs-subst\">$&#123;myAge&#125;</span> years old!`</span>)<br>&#125;<br><br><span class=\"hljs-keyword\">export</span> &#123;<br>  myAge,<br>  sayMe<br>&#125;<br></code></pre></td></tr></table></figure>\n\n<p>如果在一个模块中先输入后输出同一个模块，import语句可以与export语句写在一起。</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\"><span class=\"hljs-keyword\">export</span> &#123; sayName <span class=\"hljs-keyword\">as</span> <span class=\"hljs-keyword\">default</span>&#125; <span class=\"hljs-keyword\">from</span> <span class=\"hljs-string\">&#x27;./someModule&#x27;</span><br><br><span class=\"hljs-comment\">// 等价于</span><br><br><span class=\"hljs-keyword\">import</span> &#123; sayName &#125; <span class=\"hljs-keyword\">from</span> <span class=\"hljs-string\">&#x27;./someModule&#x27;</span><br><span class=\"hljs-keyword\">export</span> <span class=\"hljs-keyword\">default</span> sayName<br></code></pre></td></tr></table></figure>\n\n<p>另外，ES7有一个提案(<a href=\"https://github.com/leebyron/ecmascript-more-export-from)，简化先输入后输出的写法，拿掉了输出时的大括号。\">https://github.com/leebyron/ecmascript-more-export-from)，简化先输入后输出的写法，拿掉了输出时的大括号。</a></p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\"><span class=\"hljs-comment\">// 提案</span><br><span class=\"hljs-keyword\">export</span> v <span class=\"hljs-keyword\">from</span> <span class=\"hljs-string\">&#x27;mod&#x27;</span><br><br><span class=\"hljs-comment\">// 现在</span><br><span class=\"hljs-keyword\">export</span> &#123; v &#125; <span class=\"hljs-keyword\">from</span> <span class=\"hljs-string\">&#x27;mod&#x27;</span><br></code></pre></td></tr></table></figure>\n\n<p>import语句会执行所加载的模块</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\"><span class=\"hljs-keyword\">import</span> <span class=\"hljs-string\">&#x27;lodash&#x27;</span><br></code></pre></td></tr></table></figure>\n\n<h2 id=\"模块整体加载\"><a href=\"#模块整体加载\" class=\"headerlink\" title=\"模块整体加载\"></a>模块整体加载</h2><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\"><span class=\"hljs-keyword\">import</span> * <span class=\"hljs-keyword\">as</span> myModule <span class=\"hljs-keyword\">from</span> <span class=\"hljs-string\">&#x27;./myModule&#x27;</span><br></code></pre></td></tr></table></figure>\n\n<h2 id=\"module-命令\"><a href=\"#module-命令\" class=\"headerlink\" title=\"module 命令\"></a>module 命令</h2><p>module命令可以取代import语句，达到整体输入模块的作用。</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\"><span class=\"hljs-variable language_\">module</span> myModule <span class=\"hljs-keyword\">from</span> <span class=\"hljs-string\">&#x27;./myModule&#x27;</span><br><br>myModule.<span class=\"hljs-title function_\">sayName</span>()<br></code></pre></td></tr></table></figure>\n\n<h2 id=\"动态加载模块\"><a href=\"#动态加载模块\" class=\"headerlink\" title=\"动态加载模块\"></a>动态加载模块</h2><p>返回的是 Promise</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\"><span class=\"hljs-title function_\">import</span>(<span class=\"hljs-string\">&#x27;./moduleA.js&#x27;</span>).<span class=\"hljs-title function_\">then</span>(<span class=\"hljs-function\"><span class=\"hljs-params\">module</span> =&gt;</span> &#123;<br>  ...<br>&#125;)<br></code></pre></td></tr></table></figure>\n\n<h2 id=\"ES6模块加载的实质\"><a href=\"#ES6模块加载的实质\" class=\"headerlink\" title=\"ES6模块加载的实质\"></a>ES6模块加载的实质</h2><p>ES6模块加载的机制与CommonJS模块完全不同。</p>\n<p>CommonJS模块输出的是一个值的拷贝，而ES6模块输出的是 <code>值的引用</code>。</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\"><span class=\"hljs-comment\">// lib.js</span><br><span class=\"hljs-keyword\">export</span> <span class=\"hljs-keyword\">let</span> count = <span class=\"hljs-number\">1</span><br><span class=\"hljs-keyword\">export</span> <span class=\"hljs-keyword\">function</span> <span class=\"hljs-title function_\">incCount</span>(<span class=\"hljs-params\"></span>) &#123;<br>  count++<br>&#125;<br><br><span class=\"hljs-comment\">// main.js</span><br><span class=\"hljs-keyword\">import</span> &#123; count, incCount &#125; <span class=\"hljs-keyword\">from</span> <span class=\"hljs-string\">&#x27;./lib.js&#x27;</span><br><br><span class=\"hljs-variable language_\">console</span>.<span class=\"hljs-title function_\">log</span>(count) <span class=\"hljs-comment\">// 1</span><br><br><span class=\"hljs-title function_\">incCount</span>()<br><br><span class=\"hljs-variable language_\">console</span>.<span class=\"hljs-title function_\">log</span>(count) <span class=\"hljs-comment\">// 2</span><br></code></pre></td></tr></table></figure>\n\n\n<p>注意加上 type=”module”</p>\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs html\"><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">script</span> <span class=\"hljs-attr\">src</span>=<span class=\"hljs-string\">&quot;./main.js&quot;</span> <span class=\"hljs-attr\">type</span>=<span class=\"hljs-string\">&quot;module&quot;</span>&gt;</span><span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">script</span>&gt;</span><br></code></pre></td></tr></table></figure>\n\n<h2 id=\"ES-Module-in-NodeJS\"><a href=\"#ES-Module-in-NodeJS\" class=\"headerlink\" title=\"ES Module in NodeJS\"></a>ES Module in NodeJS</h2><p>如何在 Nodejs 中使用 ES module!</p>\n<p>有两个步骤：</p>\n<ol>\n<li><code>.js</code> 后缀都改为 <code>.mjs</code></li>\n<li>执行脚本时，加上 <code>node --experimental-modules main.mjs</code></li>\n</ol>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\"><span class=\"hljs-comment\">// node</span><br><br><span class=\"hljs-comment\">// main.mjs</span><br><span class=\"hljs-keyword\">import</span> fs <span class=\"hljs-keyword\">from</span> <span class=\"hljs-string\">&#x27;fs&#x27;</span><br><span class=\"hljs-keyword\">import</span> _ <span class=\"hljs-keyword\">from</span> <span class=\"hljs-string\">&#x27;lodash&#x27;</span><br></code></pre></td></tr></table></figure>\n\n<p>注意事项：</p>\n<ol>\n<li>在 node 环境中，我们可以使用 ES Module 导入 CommonJS 导出的成员</li>\n</ol>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\"><span class=\"hljs-comment\">// commonjs.js</span><br><span class=\"hljs-variable language_\">module</span>.<span class=\"hljs-property\">exports</span> = &#123;<br>  <span class=\"hljs-attr\">foo</span>: <span class=\"hljs-string\">&#x27;commonjs exports foo&#x27;</span><br>&#125;<br><br><span class=\"hljs-comment\">// esmodule.js</span><br><span class=\"hljs-keyword\">import</span> mod <span class=\"hljs-keyword\">from</span> <span class=\"hljs-string\">&#x27;./commonjs.js&#x27;</span><br><br><span class=\"hljs-variable language_\">console</span>.<span class=\"hljs-title function_\">log</span>(mod.<span class=\"hljs-property\">foo</span>)<br></code></pre></td></tr></table></figure>\n\n<ol start=\"2\">\n<li>在 node 环境中，CommonJS 中<code>不能</code>导入 ES Module 导出的成员</li>\n</ol>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\"><span class=\"hljs-keyword\">const</span> mod = <span class=\"hljs-built_in\">require</span>(<span class=\"hljs-string\">&#x27;./esmodule.js&#x27;</span>) <span class=\"hljs-comment\">// 报错</span><br></code></pre></td></tr></table></figure>\n\n<h2 id=\"CommonJS-与-ES-Module-差异\"><a href=\"#CommonJS-与-ES-Module-差异\" class=\"headerlink\" title=\"CommonJS 与 ES Module 差异\"></a>CommonJS 与 ES Module 差异</h2><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\"><span class=\"hljs-comment\">// CommonJS</span><br><br><span class=\"hljs-built_in\">require</span> <span class=\"hljs-comment\">// 加载模块函数</span><br><br><span class=\"hljs-variable language_\">module</span> <span class=\"hljs-comment\">// 模块对象</span><br><br><span class=\"hljs-built_in\">exports</span> <span class=\"hljs-comment\">// 导出对象别名 exports.name = &#x27;hello world&#x27;</span><br><br>__filename <span class=\"hljs-comment\">// 当前文件的绝对路径</span><br><br>__dirname <span class=\"hljs-comment\">// 当前文件所在目录</span><br></code></pre></td></tr></table></figure>\n\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\"><span class=\"hljs-comment\">// ES Module</span><br><br><span class=\"hljs-keyword\">import</span>.<span class=\"hljs-property\">meta</span>.<span class=\"hljs-property\">url</span> <span class=\"hljs-comment\">// 文件路径信息</span><br><br><span class=\"hljs-comment\">// 可以通过内置模块 url 和 path 处理，拿到 __filename 和 __dirname</span><br><span class=\"hljs-keyword\">import</span> &#123; fileURLToPath &#125; <span class=\"hljs-keyword\">from</span> <span class=\"hljs-string\">&#x27;url&#x27;</span><br><span class=\"hljs-keyword\">import</span> &#123; dirname &#125; <span class=\"hljs-keyword\">from</span> <span class=\"hljs-string\">&#x27;path&#x27;</span><br><br><span class=\"hljs-keyword\">const</span> __filename = <span class=\"hljs-title function_\">fileURLToPath</span>(<span class=\"hljs-keyword\">import</span>.<span class=\"hljs-property\">meta</span>.<span class=\"hljs-property\">url</span>)<br><span class=\"hljs-keyword\">const</span> __dirname = <span class=\"hljs-title function_\">dirname</span>(__filename)<br></code></pre></td></tr></table></figure>\n\n<h2 id=\"高版本-NodeJS-已支持-ESM-Version-gt-12-10-0\"><a href=\"#高版本-NodeJS-已支持-ESM-Version-gt-12-10-0\" class=\"headerlink\" title=\"高版本 NodeJS 已支持 ESM (Version &gt; 12.10.0)\"></a>高版本 NodeJS 已支持 ESM (Version &gt; 12.10.0)</h2><p>不需要再写 <code>.mjs</code> 结尾了，直接 <code>.js</code></p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\"><span class=\"hljs-comment\">// package.json</span><br>&#123;<br>  <span class=\"hljs-string\">&quot;type&quot;</span>: <span class=\"hljs-string\">&quot;module&quot;</span><br>&#125;<br><br><span class=\"hljs-comment\">// 执行</span><br>node --experimental-modules main.<span class=\"hljs-property\">js</span> <br></code></pre></td></tr></table></figure>\n\n<p>加上 type module 配置之后，如果我们还想用 <code>CommonJS</code> 规范，发现会报错了。因为我们已经使用了 ESM。</p>\n<p>如果继续使用 <code>CommonJS</code> 规范，那么就需要将 <code>.js</code> 改为 <code>.cjs</code>。</p>\n<h2 id=\"ESM-in-NodeJS-（babel-兼容方案）\"><a href=\"#ESM-in-NodeJS-（babel-兼容方案）\" class=\"headerlink\" title=\"ESM in NodeJS （babel 兼容方案）\"></a>ESM in NodeJS （babel 兼容方案）</h2><blockquote>\n<p>yarn add @babel/node @babel/preset-env –save-dev</p>\n</blockquote>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\"><span class=\"hljs-comment\">// 通过 babel-node 命令执行脚本</span><br>yarn babel-node main.<span class=\"hljs-property\">js</span><br></code></pre></td></tr></table></figure>\n\n<p>要注意的是，<code>babel/core</code> 并不会转换我们的代码，转换代码的工作交给 babel 内置的插件去实现的。也就是说，我们需要一个插件，去转换 ES6 中的一个新特性。</p>\n<img src=\"/img/babel.jpg\" />\n\n<p>而 <code>@bable/preset-env</code> 是插件的集合，所以不需要每个插件都安装一遍。</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\"><span class=\"hljs-comment\">// 命令行使用</span><br>yarn babel-node main.<span class=\"hljs-property\">js</span> --presets=@bable/preset-env<br></code></pre></td></tr></table></figure>\n\n<p>结合 babel 配置文件使用</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\"><span class=\"hljs-comment\">// .babelrc</span><br>&#123;<br>  <span class=\"hljs-string\">&quot;presets&quot;</span>: [<span class=\"hljs-string\">&quot;@babel/presets-env&quot;</span>]<br>&#125;<br><br>yarn babel-node main.<span class=\"hljs-property\">js</span><br></code></pre></td></tr></table></figure>\n\n<p>既然 <code>@babel/preset-env</code> 是插件的集合，而我不想要那么多，只是想处理 <code>ESM</code> 怎么办呢？</p>\n<p>我们卸载掉 <code>@babel/preset-env</code>，安装 <code>@babel/plugin-transform-modules-commonjs</code></p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\"><span class=\"hljs-comment\">// .babelrc</span><br>&#123;<br>  <span class=\"hljs-string\">&quot;presets&quot;</span>: [<span class=\"hljs-string\">&quot;@babel/plugin-transform-modules-commonjs&quot;</span>]<br>&#125;<br><br>yarn babel-node main.<span class=\"hljs-property\">js</span><br></code></pre></td></tr></table></figure>\n\n<h1 id=\"babel\"><a href=\"#babel\" class=\"headerlink\" title=\"babel\"></a>babel</h1><blockquote>\n<p>编译器</p>\n</blockquote>\n<p>主要用于将ES6版本的JS代码转换为ES5等向后兼容的JS代码，从而使代码可以运行在低版本浏览器或其他环境中。</p>\n<blockquote>\n<p>npm install –save-dev babel-core babel-preset-es2015 babel-preset-latest –registry=<a href=\"https://registry.npm.taobao.org\">https://registry.npm.taobao.org</a></p>\n</blockquote>\n<p>配置文件 <code>.babelrc</code>（或者 babel.config.js || .babelrc.js）</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\">&#123;<br>  <span class=\"hljs-string\">&quot;presets&quot;</span>: [<span class=\"hljs-string\">&quot;es2015&quot;</span>, <span class=\"hljs-string\">&quot;latest&quot;</span>], <span class=\"hljs-comment\">// 安装包的别名，用来处理最新的 ES6 语法</span><br>  <span class=\"hljs-string\">&quot;plugins&quot;</span>: []<br>&#125;<br></code></pre></td></tr></table></figure>\n\n<p>安装 <code>babel-cli</code>，命令行编译工具，依赖 <code>babel/core</code></p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\">npm install --save-dev babel-cli <br></code></pre></td></tr></table></figure>\n\n<p>查看 babel 版本（npx 是新版 NodeJS 附带的命令）</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\">npx babel --version <span class=\"hljs-comment\">// ===== node_modules/.bin/babel --version </span><br><br><span class=\"hljs-comment\">// ====&gt; 6.26.0 (babel-core 6.26.3)</span><br></code></pre></td></tr></table></figure>\n\n<p>到这里，我们就可以使用 babel 来编译js 文件了。创建一个 babel.js 文件，写入一些 es6 的语法。</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\"><span class=\"hljs-comment\">// babel.js</span><br><br><span class=\"hljs-keyword\">const</span> <span class=\"hljs-title function_\">foo</span> = (<span class=\"hljs-params\"></span>) =&gt; &#123;<br>  <span class=\"hljs-keyword\">return</span> <span class=\"hljs-number\">3</span> * <span class=\"hljs-number\">3</span><br>&#125;<br><br><span class=\"hljs-keyword\">const</span> count = <span class=\"hljs-number\">123</span><br></code></pre></td></tr></table></figure>\n\n<p>打开命令行工具：</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\">npx babel babel.<span class=\"hljs-property\">js</span> -o compiled.<span class=\"hljs-property\">js</span> <span class=\"hljs-comment\">// 等效 node_modules/.bin/babel babel.js -o compiled.js </span><br></code></pre></td></tr></table></figure>\n\n<p>转化后的结果：</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\"><span class=\"hljs-meta\">&quot;use strict&quot;</span>;<br><br><span class=\"hljs-keyword\">var</span> foo = <span class=\"hljs-keyword\">function</span> <span class=\"hljs-title function_\">foo</span>(<span class=\"hljs-params\"></span>) &#123;<br>  <span class=\"hljs-keyword\">return</span> <span class=\"hljs-number\">3</span> * <span class=\"hljs-number\">3</span>;<br>&#125;;<br><br><span class=\"hljs-keyword\">var</span> count = <span class=\"hljs-number\">123</span>;<br></code></pre></td></tr></table></figure>\n\n<h2 id=\"Polyfill\"><a href=\"#Polyfill\" class=\"headerlink\" title=\"Polyfill\"></a>Polyfill</h2><p>Babel默认只转换新的JS语法（syntax），而不转换新的API（Promise、Map）。如果只是做语法转换，Promise 是不会被降级的，在低版本的浏览器中可能无法使用。</p>\n<p>引入 Polyfill，为当前环境提供一个“垫片”。所谓“垫片”，是指垫平不同浏览器之间差异的东西。polyfill提供了全局的ES6对象及通过修改原型链Array.prototype等来补充对实例的实现。</p>\n<h2 id=\"babel-版本\"><a href=\"#babel-版本\" class=\"headerlink\" title=\"babel 版本\"></a>babel 版本</h2><p>Babel版本主要是Babel 6和Babel 7这两个版本。</p>\n<p>提到Babel版本的时候，通常指的是@babel/core这个Babel核心包的版本。</p>\n<p>Babel 7的npm包都存放在babel域下，即在安装npm包的时候，我们安装的是名称以@babel/开头的npm包，如@babel/cli、@babel/core等。而在Babel 6中，我们安装的包名是babel-cli、babel-core等以babel-开头的npm包。其实它们本质上是一样的，都是Babel官方提供的cli命令行工具和core核心包。在平时开发和学习的过程中，碰到@babel/和babel-时应该认识到它俩是作用相同、内容接近的包，只是版本不一样而已。</p>\n<h2 id=\"babel-配置文件\"><a href=\"#babel-配置文件\" class=\"headerlink\" title=\"babel 配置文件\"></a>babel 配置文件</h2><blockquote>\n<p>指定编译的规则。</p>\n</blockquote>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\">.<span class=\"hljs-property\">babelrc</span> || babel.<span class=\"hljs-property\">config</span>.<span class=\"hljs-property\">js</span> || .<span class=\"hljs-property\">babelrc</span>.<span class=\"hljs-property\">js</span> || package.<span class=\"hljs-property\">json</span>（配置 babel 属性，配置项都是 一样的）<br></code></pre></td></tr></table></figure>\n\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\"><span class=\"hljs-comment\">// package.json</span><br><br>&#123;<br>  ...<br><br>  <span class=\"hljs-attr\">babel</span>: &#123;<br>    <span class=\"hljs-string\">&quot;presets&quot;</span>: [<span class=\"hljs-string\">&quot;es2015&quot;</span>, <span class=\"hljs-string\">&quot;react&quot;</span>],<br>    <span class=\"hljs-string\">&quot;plugin&quot;</span>: [<span class=\"hljs-string\">&quot;transform-class-properties&quot;</span>]<br>  &#125;,<br><br>  ...<br>&#125;<br></code></pre></td></tr></table></figure>\n\n<p>推荐使用后缀名是js的配置文件来进行配置，因为可以使用该文件做一些逻辑处理，适用性更强。</p>\n<h2 id=\"插件-amp-预设\"><a href=\"#插件-amp-预设\" class=\"headerlink\" title=\"插件 &amp; 预设\"></a>插件 &amp; 预设</h2><p>plugin代表插件，preset代表预设。通常每个插件或预设都是一个npm包。</p>\n<p>Babel的插件实在太多了，假如只配置插件数组，那我们前端工程要把ES2015、ES2016、ES2017……下的所有插件都写到配置项里，这样的Babel配置文件会非常臃肿。</p>\n<p>preset预设就是帮我们解决这个问题的。预设是一组Babel插件的集合，通俗的说法就是插件包，例如babel-preset-es2015就是所有处理ES2015的二十多个Babel插件的集合。这样我们就不用写一大堆插件配置项了，只需要用一个预设代替就可以。另外，预设也可以是插件和其他预设的集合。</p>\n<p>Babel官方已经针对常用的环境做了如下这些preset包。</p>\n<p>1）@babel/preset-env.</p>\n<p>2）@babel/preset-react.</p>\n<p>3）@babel/preset-typescript.</p>\n<p>4）@babel/preset-stage-0.</p>\n<p>5）@babel/preset-stage-1.</p>\n<h2 id=\"插件与预设的简称\"><a href=\"#插件与预设的简称\" class=\"headerlink\" title=\"插件与预设的简称\"></a>插件与预设的简称</h2><p>如果插件的npm包名称的前缀为babel-plugin-，则可以省略其前缀。</p>\n<p>如果npm包名称的前缀带有npm作用域@，如@org/babel-plugin-xxx，则短名称可以写成@org/xxx。</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\">&#123;<br>  <span class=\"hljs-string\">&quot;plugins&quot;</span>: [<span class=\"hljs-string\">&quot;babel-plugin-transform-decorators-legacy&quot;</span>]<br>&#125;<br><br><span class=\"hljs-comment\">// =====</span><br><br>&#123;<br>  <span class=\"hljs-string\">&quot;plugins&quot;</span>: [<span class=\"hljs-string\">&quot;transform-decorators-legacy&quot;</span>]<br>&#125;<br></code></pre></td></tr></table></figure>\n\n<p>预设的短名称规则与插件的类似，预设npm包名称的前缀为babel-preset-或作用域@xxx/babel-preset-xxx的可以省略掉babel-preset-。</p>\n<h2 id=\"插件和预设执行顺序\"><a href=\"#插件和预设执行顺序\" class=\"headerlink\" title=\"插件和预设执行顺序\"></a>插件和预设执行顺序</h2><p>plugins插件数组和presets预设数组是有顺序要求的。如果两个插件或预设都要处理同一个代码片段，那么会根据插件和预设的顺序来执行。规则如下:</p>\n<p>1）插件比预设先执行。</p>\n<p>2）插件执行顺序是插件数组元素从前向后依次执行。</p>\n<p>3）预设执行顺序是预设数组元素从后向前依次执行。</p>\n<h2 id=\"预设的选择\"><a href=\"#预设的选择\" class=\"headerlink\" title=\"预设的选择\"></a>预设的选择</h2><p>babel-preset-latest，在Babel 6时期，是所有年代preset的集合，在Babel 6最后一个版本中，它是babel-preset-es2015、babel-preset-es2016、babel-preset-es2017的集合。</p>\n<p>@babel/preset-env<code>包含了babel-preset-latest的功能，并对其进行了增强</code>，现在@babel/preset-env完全可以替代babel-preset-latest。</p>\n<p>Babel 6 中是babel-preset-env，Babel 7版本开始，@babel/preset-env。</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\"><span class=\"hljs-comment\">// babel 6</span><br>npm install babel-preset-env --save-dev<br><br><span class=\"hljs-comment\">// .babelrc</span><br>&#123;<br>  <span class=\"hljs-string\">&quot;presets&quot;</span>: [<span class=\"hljs-string\">&quot;env&quot;</span>]<br>&#125;<br><br><span class=\"hljs-comment\">// babel 7</span><br>npm install @babel/preset-env --save-dev<br><br><span class=\"hljs-comment\">// .babelrc</span><br>&#123;<br>  <span class=\"hljs-string\">&quot;presets&quot;</span>: [<span class=\"hljs-string\">&quot;@babel/env&quot;</span>]<br>&#125;<br></code></pre></td></tr></table></figure>\n\n<p>总结起来，Babel官方提供的预设，我们实际会用到的其实就只有四个。</p>\n<p>1）@babel/preset-env.</p>\n<p>2）@babel/preset-flow.</p>\n<p>3）@babel/preset-react.</p>\n<p>4）@babel/preset-typescript.</p>\n<h2 id=\"插件的选择\"><a href=\"#插件的选择\" class=\"headerlink\" title=\"插件的选择\"></a>插件的选择</h2><p>Babel 7 官方有九十多个插件，不过其中大多数都已经整合在@babel/preset-env和@babel/preset-react等预设里了，我们在开发的时候直接使用预设就可以。</p>\n<p>目前比较常用的插件只有@babel/plugin-transform-runtime。</p>\n<h2 id=\"browserslist\"><a href=\"#browserslist\" class=\"headerlink\" title=\"browserslist\"></a>browserslist</h2><p>在 package.json 中经常遇到这个配置项：</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\"><span class=\"hljs-comment\">// package.json</span><br><br>&#123;<br>  <span class=\"hljs-string\">&quot;browserslist&quot;</span>: [<br>    <span class=\"hljs-string\">&quot;&gt; 1%&quot;</span>,<br>    <span class=\"hljs-string\">&quot;not ie &lt;= 8&quot;</span><br>  ]<br>&#125;<br></code></pre></td></tr></table></figure>\n<p>上面配置的含义是，该项目工程的目标环境是市场份额大于1%的浏览器并且不考虑IE 8及以下的IE浏览器。</p>\n<p>browserslist叫作目标环境配置表，除了写在package.json文件里，也可以单独写在工程目录下的.browserslistrc文件里。</p>\n<p>我们写一个含有箭头函数的 js 文件，如果我们在browserslist里指定目标环境是Chrome 60浏览器，再来看一下转换结果:</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\"><span class=\"hljs-comment\">// package.json</span><br>&#123;<br>  <span class=\"hljs-string\">&quot;browserslist&quot;</span>: [<span class=\"hljs-string\">&quot;chrome 60&quot;</span>]<br>&#125;<br></code></pre></td></tr></table></figure>\n<p>我们发现转换后的代码仍然是箭头函数，因为Chrome 60浏览器已经实现了箭头函数语法，所以不会转换成ES5的函数定义语法。</p>\n<h2 id=\"babel-runtime\"><a href=\"#babel-runtime\" class=\"headerlink\" title=\"@babel/runtime\"></a>@babel/runtime</h2><p>我们写个 js 文件，里面包含 es6 的 class 语法:</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\"><span class=\"hljs-keyword\">class</span> <span class=\"hljs-title class_\">Person</span> &#123;<br>  <span class=\"hljs-title function_\">sayName</span>(<span class=\"hljs-params\"></span>) &#123;<br>    <span class=\"hljs-title function_\">alert</span>(<span class=\"hljs-variable language_\">this</span>.<span class=\"hljs-property\">name</span>)<br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure>\n\n<p>然后执行 babel 命令，查看转换后的结果 <code>npx babel babel.js -o compiled.js</code></p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\"><span class=\"hljs-meta\">&quot;use strict&quot;</span>;<br><br><span class=\"hljs-keyword\">var</span> _createClass = <span class=\"hljs-keyword\">function</span> (<span class=\"hljs-params\"></span>) &#123; <span class=\"hljs-keyword\">function</span> <span class=\"hljs-title function_\">defineProperties</span>(<span class=\"hljs-params\">target, props</span>) &#123; <span class=\"hljs-keyword\">for</span> (<span class=\"hljs-keyword\">var</span> i = <span class=\"hljs-number\">0</span>; i &lt; props.<span class=\"hljs-property\">length</span>; i++) &#123; <span class=\"hljs-keyword\">var</span> descriptor = props[i]; descriptor.<span class=\"hljs-property\">enumerable</span> = descriptor.<span class=\"hljs-property\">enumerable</span> || <span class=\"hljs-literal\">false</span>; descriptor.<span class=\"hljs-property\">configurable</span> = <span class=\"hljs-literal\">true</span>; <span class=\"hljs-keyword\">if</span> (<span class=\"hljs-string\">&quot;value&quot;</span> <span class=\"hljs-keyword\">in</span> descriptor) descriptor.<span class=\"hljs-property\">writable</span> = <span class=\"hljs-literal\">true</span>; <span class=\"hljs-title class_\">Object</span>.<span class=\"hljs-title function_\">defineProperty</span>(target, descriptor.<span class=\"hljs-property\">key</span>, descriptor); &#125; &#125; <span class=\"hljs-keyword\">return</span> <span class=\"hljs-keyword\">function</span> (<span class=\"hljs-params\">Constructor, protoProps, staticProps</span>) &#123; <span class=\"hljs-keyword\">if</span> (protoProps) <span class=\"hljs-title function_\">defineProperties</span>(<span class=\"hljs-title class_\">Constructor</span>.<span class=\"hljs-property\"><span class=\"hljs-keyword\">prototype</span></span>, protoProps); <span class=\"hljs-keyword\">if</span> (staticProps) <span class=\"hljs-title function_\">defineProperties</span>(<span class=\"hljs-title class_\">Constructor</span>, staticProps); <span class=\"hljs-keyword\">return</span> <span class=\"hljs-title class_\">Constructor</span>; &#125;; &#125;();<br><br><span class=\"hljs-keyword\">function</span> <span class=\"hljs-title function_\">_classCallCheck</span>(<span class=\"hljs-params\">instance, Constructor</span>) &#123; <span class=\"hljs-keyword\">if</span> (!(instance <span class=\"hljs-keyword\">instanceof</span> <span class=\"hljs-title class_\">Constructor</span>)) &#123; <span class=\"hljs-keyword\">throw</span> <span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">TypeError</span>(<span class=\"hljs-string\">&quot;Cannot call a class as a function&quot;</span>); &#125; &#125;<br><br><span class=\"hljs-keyword\">var</span> <span class=\"hljs-title class_\">Person</span> = <span class=\"hljs-keyword\">function</span> (<span class=\"hljs-params\"></span>) &#123;<br>  <span class=\"hljs-keyword\">function</span> <span class=\"hljs-title function_\">Person</span>(<span class=\"hljs-params\"></span>) &#123;<br>    <span class=\"hljs-title function_\">_classCallCheck</span>(<span class=\"hljs-variable language_\">this</span>, <span class=\"hljs-title class_\">Person</span>);<br>  &#125;<br><br>  <span class=\"hljs-title function_\">_createClass</span>(<span class=\"hljs-title class_\">Person</span>, [&#123;<br>    <span class=\"hljs-attr\">key</span>: <span class=\"hljs-string\">&quot;sayName&quot;</span>,<br>    <span class=\"hljs-attr\">value</span>: <span class=\"hljs-keyword\">function</span> <span class=\"hljs-title function_\">sayName</span>(<span class=\"hljs-params\"></span>) &#123;<br>      <span class=\"hljs-title function_\">alert</span>(<span class=\"hljs-variable language_\">this</span>.<span class=\"hljs-property\">name</span>);<br>    &#125;<br>  &#125;]);<br><br>  <span class=\"hljs-keyword\">return</span> <span class=\"hljs-title class_\">Person</span>;<br>&#125;();<br></code></pre></td></tr></table></figure>\n\n<p>可以看到，转换后的代码上部增加了好几个函数声明，这些函数是Babel转码时注入的，我们称之为辅助函数。@babel/preset-env在做语法转换的时候，注入了这些函数声明，以便语法转换后使用。</p>\n<p>但这样做存在一个问题。在我们正常地进行前端工程开发的时候，少则有几十个JS文件，多则有上千个。如果每个文件里都使用了class类语法，那么会导致每个转换后的代码上部都会注入这些相同的函数声明。这会导致我们用构建工具打包出来的包体积非常大。</p>\n<p>那么应该怎么办呢？一个思路就是，我们把这些函数声明都放在一个npm包里，需要使用的时候直接从这个包里引入我们的文件。这样即使有上千个文件，也会从相同的包里引入这些函数。使用Webpack这一类的构建工具进行打包时，我们只需要引入一次npm包里的函数，这样就做到了复用，减小了包的体积。</p>\n<p><code>@babel/runtime</code> 就是上面说的这个npm包，<strong>@babel/runtime把所有语法转换会用到的辅助函数都集中在了一起。</strong></p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\"><span class=\"hljs-comment\">// babbel 6</span><br>npm install babel-runtime --save-dev <span class=\"hljs-comment\">// /node_modules/babel-runtime/helpers/createClass.js</span><br><br><span class=\"hljs-comment\">// babel 7</span><br>npm install @babel/runtime@<span class=\"hljs-number\">7.12</span><span class=\"hljs-number\">.5</span> --save-dev<br></code></pre></td></tr></table></figure>\n\n<p>然后到node_modules目录下看一下这个包的结构，找到 _classCallCheck、_defineProperties与_createClass这三个辅助函数的位置，我们直接引入即可。</p>\n<p>这时，我们就可以替换转换后自动创建的方法，而是使用 @babel/runtime/helpers 中已有的方法。</p>\n<p>不过，这么多辅助函数要一个个记住并手动引入，是很难做到的。这时Babel插件 <code>@babel/plugin-transform-runtime</code> 就可以用来帮我们解决这个问题。</p>\n<h2 id=\"babel-plugin-transform-runtime\"><a href=\"#babel-plugin-transform-runtime\" class=\"headerlink\" title=\"@babel/plugin-transform-runtime\"></a>@babel/plugin-transform-runtime</h2><p>辅助函数的自动引入。</p>\n<p>@babel/plugin-transform-runtime有三大作用，其中之一就是自动移除语法转换后内联的辅助函数（inline Babel helpers），而是使用@babel/runtime/helpers里的辅助函数来替代，这样就减少了我们手动引入的麻烦。</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\"><span class=\"hljs-comment\">// babel6</span><br>npm install babel-plugin-transform-runtime --save-dev<br><br><span class=\"hljs-comment\">// babel 7</span><br>npm install @babel/plugin-transform-runtime@<span class=\"hljs-number\">7.12</span><span class=\"hljs-number\">.10</span> --save-dev<br></code></pre></td></tr></table></figure>\n\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\">&#123;<br>  <span class=\"hljs-string\">&quot;plugins&quot;</span>: [<span class=\"hljs-string\">&quot;@babel/plugin-transform-runtime&quot;</span>] <span class=\"hljs-comment\">// babel 6: &quot;babel-plugin-transform-runtime&quot;</span><br>&#125;<br></code></pre></td></tr></table></figure>\n\n<p>还是上面的例子，我们再看看转换后的结果，会发现插件已经自动帮我们处理了。</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\"><span class=\"hljs-meta\">&quot;use strict&quot;</span>;<br><br><span class=\"hljs-keyword\">var</span> _classCallCheck2 = <span class=\"hljs-built_in\">require</span>(<span class=\"hljs-string\">&quot;babel-runtime/helpers/classCallCheck&quot;</span>);<br><br><span class=\"hljs-keyword\">var</span> _classCallCheck3 = <span class=\"hljs-title function_\">_interopRequireDefault</span>(_classCallCheck2);<br><br><span class=\"hljs-keyword\">var</span> _createClass2 = <span class=\"hljs-built_in\">require</span>(<span class=\"hljs-string\">&quot;babel-runtime/helpers/createClass&quot;</span>);<br><br><span class=\"hljs-keyword\">var</span> _createClass3 = <span class=\"hljs-title function_\">_interopRequireDefault</span>(_createClass2);<br><br><span class=\"hljs-keyword\">function</span> <span class=\"hljs-title function_\">_interopRequireDefault</span>(<span class=\"hljs-params\">obj</span>) &#123; <span class=\"hljs-keyword\">return</span> obj &amp;&amp; obj.<span class=\"hljs-property\">__esModule</span> ? obj : &#123; <span class=\"hljs-attr\">default</span>: obj &#125;; &#125;<br><br><span class=\"hljs-keyword\">var</span> <span class=\"hljs-title class_\">Person</span> = <span class=\"hljs-keyword\">function</span> (<span class=\"hljs-params\"></span>) &#123;<br>  <span class=\"hljs-keyword\">function</span> <span class=\"hljs-title function_\">Person</span>(<span class=\"hljs-params\"></span>) &#123;<br>    (<span class=\"hljs-number\">0</span>, _classCallCheck3.<span class=\"hljs-property\">default</span>)(<span class=\"hljs-variable language_\">this</span>, <span class=\"hljs-title class_\">Person</span>);<br>  &#125;<br><br>  (<span class=\"hljs-number\">0</span>, _createClass3.<span class=\"hljs-property\">default</span>)(<span class=\"hljs-title class_\">Person</span>, [&#123;<br>    <span class=\"hljs-attr\">key</span>: <span class=\"hljs-string\">&quot;sayName&quot;</span>,<br>    <span class=\"hljs-attr\">value</span>: <span class=\"hljs-keyword\">function</span> <span class=\"hljs-title function_\">sayName</span>(<span class=\"hljs-params\"></span>) &#123;<br>      <span class=\"hljs-title function_\">alert</span>(<span class=\"hljs-variable language_\">this</span>.<span class=\"hljs-property\">name</span>);<br>    &#125;<br>  &#125;]);<br>  <span class=\"hljs-keyword\">return</span> <span class=\"hljs-title class_\">Person</span>;<br>&#125;();<br></code></pre></td></tr></table></figure>\n\n<p>实际进行前端开发时，我们除了安装@babel/runtime包，基本也会安装@babel/plugin-transform-runtime这个Babel插件。</p>\n<h1 id=\"Babel-原理与插件开发\"><a href=\"#Babel-原理与插件开发\" class=\"headerlink\" title=\"Babel 原理与插件开发\"></a>Babel 原理与插件开发</h1><p>Babel的转码过程主要由三个阶段组成：解析（parse）、转换（transform）和生成（generate）。这三个阶段分别由@babel/parser、@babel/core和@babel/generator来完成。</p>\n<ol>\n<li><strong>解析阶段</strong></li>\n</ol>\n<p>该阶段由Babel读取源码并生成抽象语法树（AST），该阶段由两部分组成：词法分析与语法分析。</p>\n<p>词法分析会将字符串形式的代码转换成tokens流，语法分析会将tokens流转换成AST。</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\"><span class=\"hljs-keyword\">const</span> name = <span class=\"hljs-string\">&quot;hello AlexCc&quot;</span><br></code></pre></td></tr></table></figure>\n\n<p>AST</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\">-<br>#<span class=\"hljs-number\">1</span><br>  <span class=\"hljs-attr\">type</span>: <span class=\"hljs-title class_\">VariableDeclaration</span><br>  declarations<br>    #<span class=\"hljs-number\">1</span><br>    <span class=\"hljs-attr\">type</span>: <span class=\"hljs-title class_\">VariableDeclarator</span><br>    id<br>      <span class=\"hljs-attr\">type</span>: <span class=\"hljs-title class_\">Identifier</span><br>      <span class=\"hljs-attr\">name</span>: name<br>    init<br>      <span class=\"hljs-attr\">type</span>: <span class=\"hljs-title class_\">Literal</span><br>      <span class=\"hljs-attr\">value</span>: hello <span class=\"hljs-title class_\">AlexCc</span><br>      <span class=\"hljs-attr\">raw</span>: <span class=\"hljs-string\">&quot;hello AlexCc&quot;</span><br>    <span class=\"hljs-attr\">kind</span>: <span class=\"hljs-keyword\">const</span><br></code></pre></td></tr></table></figure>\n\n<ol start=\"2\">\n<li><strong>转换阶段</strong></li>\n</ol>\n<p>完成了解析工作，生成了AST，AST是一个树状的JSON结构。接下来就可以通过Babel插件对该树状结构执行修改操作，修改完成后就得到了新的AST。</p>\n<ol start=\"3\">\n<li><strong>生成阶段</strong></li>\n</ol>\n<p>通过转换阶段的工作，我们得到了新的AST。在生成阶段，我们对AST的树状JSON结构进行还原操作，生成新的JS代码，通常这就是我们需要的ES5代码。</p>\n<h2 id=\"Babel-插件开发\"><a href=\"#Babel-插件开发\" class=\"headerlink\" title=\"Babel 插件开发\"></a>Babel 插件开发</h2><blockquote>\n<p>babel-handbook</p>\n<p><a href=\"https://github.com/jamiebuilds/babel-handbook/blob/master/translations/zh-Hans/plugin-handbook.md\">https://github.com/jamiebuilds/babel-handbook/blob/master/translations/zh-Hans/plugin-handbook.md</a></p>\n</blockquote>\n<p>开发Babel转码插件的重点是在第二阶段（转换阶段），在这一阶段我们要从AST上找出需要转换的节点，改成我们需要的形式，最后在生成阶段把AST变回JS代码。</p>\n<p>插件模板结构:</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\"><span class=\"hljs-variable language_\">module</span>.<span class=\"hljs-property\">exports</span> = <span class=\"hljs-keyword\">function</span>(<span class=\"hljs-params\">&#123; types: t &#125;</span>) &#123;<br>  <span class=\"hljs-keyword\">return</span> &#123;<br>    <span class=\"hljs-attr\">name</span>: <span class=\"hljs-string\">&#x27;pluginName&#x27;</span>,<br>    <span class=\"hljs-attr\">visitor</span>: &#123;&#125;<br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure>\n\n<p>假设我们有这样一段代码：</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\"><span class=\"hljs-keyword\">const</span> dog = <span class=\"hljs-string\">&#x27;is dog&#x27;</span><br></code></pre></td></tr></table></figure>\n\n<p>现在我想将 dog 变成喵咪。</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\"><span class=\"hljs-variable language_\">module</span>.<span class=\"hljs-property\">exports</span> = <span class=\"hljs-keyword\">function</span>(<span class=\"hljs-params\">&#123; types: t &#125;</span>) &#123;<br>  <span class=\"hljs-keyword\">return</span> &#123;<br>    <span class=\"hljs-attr\">visitor</span>: &#123;<br>      <span class=\"hljs-title class_\">Identifier</span>(path, state) &#123;<br>        <span class=\"hljs-keyword\">if</span> (path.<span class=\"hljs-property\">node</span>.<span class=\"hljs-property\">name</span> === <span class=\"hljs-string\">&#x27;dog&#x27;</span>) &#123;<br>          path.<span class=\"hljs-property\">node</span>.<span class=\"hljs-property\">name</span> = <span class=\"hljs-string\">&#x27;cat&#x27;</span><br>          path.<span class=\"hljs-property\">parent</span>.<span class=\"hljs-property\">init</span>.<span class=\"hljs-property\">value</span> = <span class=\"hljs-string\">&#x27;is cat&#x27;</span><br>        &#125;<br>      &#125;,<br>      <span class=\"hljs-keyword\">var</span><br>    &#125;<br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure>\n\n<p>转换后：</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\"><span class=\"hljs-keyword\">const</span> cat = <span class=\"hljs-string\">&#x27;is cat&#x27;</span>;<br></code></pre></td></tr></table></figure>\n\n<p>我们编写Babel插件的主要工作就是修改<code>visitor</code>对象，该对象是遍历AST各个节点的方法。</p>\n<p>在上面的插件里，要把变量名dog修改为cat，于是我们修改了visitor.Identifier方法，那我们如何知道要修改的是Identifier方法呢？</p>\n<p>Babel原理里讲过Babel转码的三个阶段：解析阶段、转换阶段和生成阶段，我们编写的Babel插件实际上是在执行第二个阶段（转换阶段）的工作，该工作需要前一个阶段解析工作先完成。在解析阶段，我们得到了转码前代码的AST树状结构信息，该AST上会有Identifier等节点信息，我们编写插件的时候参考该AST的信息即可。</p>\n<img src=\"/img/ast.jpg\" />\n\n<p>接着看Identifier方法，可以看到它有两个参数path和state，visitor中的每个方法都接收这两个参数，path代表路径。最后我们判断path上节点信息name是不是dog，是的话把它修改为cat即可。</p>\n<p>同理，我们也可以修改 <code>const</code>、<code>value</code>：</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\"><span class=\"hljs-variable language_\">module</span>.<span class=\"hljs-property\">exports</span> = <span class=\"hljs-keyword\">function</span>(<span class=\"hljs-params\">&#123; types: t &#125;</span>) &#123;<br>  <span class=\"hljs-keyword\">return</span> &#123;<br>    <span class=\"hljs-attr\">visitor</span>: &#123;<br>      <span class=\"hljs-title class_\">Identifier</span>(path, state) &#123;<br>        path.<span class=\"hljs-property\">node</span>.<span class=\"hljs-property\">name</span> = <span class=\"hljs-string\">&#x27;cat&#x27;</span><br>        path.<span class=\"hljs-property\">parent</span>.<span class=\"hljs-property\">init</span>.<span class=\"hljs-property\">value</span> = <span class=\"hljs-string\">&#x27;is cat&#x27;</span><br>      &#125;,<br>      <span class=\"hljs-title class_\">VariableDeclaration</span>(path, state) &#123;<br>        <span class=\"hljs-keyword\">if</span> (path.<span class=\"hljs-property\">node</span>.<span class=\"hljs-property\">kind</span> === <span class=\"hljs-string\">&#x27;const&#x27;</span>) &#123;<br>          path.<span class=\"hljs-property\">node</span>.<span class=\"hljs-property\">kind</span> = <span class=\"hljs-string\">&#x27;let&#x27;</span><br>        &#125;<br>      &#125;,<br>      <span class=\"hljs-title class_\">Literal</span>(path, state) &#123;<br>        <span class=\"hljs-comment\">// 修改 value</span><br>        path.<span class=\"hljs-property\">node</span>.<span class=\"hljs-property\">value</span> = <span class=\"hljs-string\">&#x27;is caaat...&#x27;</span><br>      &#125;<br>    &#125;<br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure>\n\n<h2 id=\"插件传参\"><a href=\"#插件传参\" class=\"headerlink\" title=\"插件传参\"></a>插件传参</h2><p>给插件传递参数，注意第一个成员变成了数组，数组的第二项是参数</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\"><span class=\"hljs-comment\">// .babelrc</span><br>&#123;<br>  <span class=\"hljs-string\">&quot;plugins&quot;</span>: [[<span class=\"hljs-string\">&quot;./plugin.js&quot;</span>, &#123;<br>    <span class=\"hljs-string\">&quot;ES5&quot;</span>: <span class=\"hljs-literal\">false</span><br>  &#125;]]<br>&#125;<br></code></pre></td></tr></table></figure>\n\n<p>在插件中，我们可以通过 <code>state.opts</code> 获取到参数：</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\"><span class=\"hljs-comment\">// plugin.js</span><br><br>...<br><span class=\"hljs-title class_\">VariableDeclaration</span>(path, state) &#123;<br>  <span class=\"hljs-keyword\">if</span> (state.<span class=\"hljs-property\">opts</span>.<span class=\"hljs-property\">ES5</span> === <span class=\"hljs-literal\">true</span> &amp;&amp; [<span class=\"hljs-string\">&#x27;let&#x27;</span>, <span class=\"hljs-string\">&#x27;const&#x27;</span>].<span class=\"hljs-title function_\">includes</span>(path.<span class=\"hljs-property\">node</span>.<span class=\"hljs-property\">kind</span>)) &#123;<br>    path.<span class=\"hljs-property\">node</span>.<span class=\"hljs-property\">kind</span> = <span class=\"hljs-string\">&#x27;var&#x27;</span><br>  &#125;<br>&#125;,<br>...<br></code></pre></td></tr></table></figure>\n\n<h1 id=\"ESBuild\"><a href=\"#ESBuild\" class=\"headerlink\" title=\"ESBuild\"></a>ESBuild</h1><blockquote>\n<p><a href=\"https://esbuild.github.io/api/\">https://esbuild.github.io/api/</a></p>\n</blockquote>\n<blockquote>\n<p>介绍: <a href=\"https://juejin.cn/post/6918927987056312327\">https://juejin.cn/post/6918927987056312327</a></p>\n</blockquote>\n","site":{"data":{}},"wordcount":14979,"more":"<h1 id=\"Module\"><a href=\"#Module\" class=\"headerlink\" title=\"Module\"></a>Module</h1><p>在ES6之前，社区制定了一些模块加载方案，最主要的有CommonJS和AMD两种。前者用于服务器，后者用于浏览器。</p>\n<p>ES6在语言规格的层面上实现了模块功能，而且实现得相当简单，完全可以取代现有的CommonJS和AMD规范，成为浏览器和服务器通用的模块解决方案。</p>\n<h2 id=\"stage1\"><a href=\"#stage1\" class=\"headerlink\" title=\"stage1\"></a>stage1</h2><blockquote>\n<p>文件划分方式，约定每一个 js 文件就是一个独立的模块</p>\n</blockquote>\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs html\"><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">script</span> <span class=\"hljs-attr\">src</span>=<span class=\"hljs-string\">&quot;./lib.js&quot;</span>&gt;</span><span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">script</span>&gt;</span><br><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">script</span> <span class=\"hljs-attr\">src</span>=<span class=\"hljs-string\">&quot;./main.js&quot;</span>&gt;</span><span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">script</span>&gt;</span><br><br><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">script</span>&gt;</span><span class=\"language-javascript\"></span><br><span class=\"language-javascript\">  <span class=\"hljs-comment\">// 直接使用导入文件中的变量与方法</span></span><br><span class=\"language-javascript\">  <span class=\"hljs-title function_\">method1</span>()</span><br><span class=\"language-javascript\"></span><br><span class=\"language-javascript\">  <span class=\"hljs-comment\">// 模块成员可以被修改</span></span><br><span class=\"language-javascript\">  count = <span class=\"hljs-number\">2</span></span><br><span class=\"language-javascript\"></span><span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">script</span>&gt;</span><br></code></pre></td></tr></table></figure>\n\n<p>缺点：</p>\n<ol>\n<li>污染全局作用域</li>\n<li>命名冲突</li>\n<li>无法管理模块间的依赖关系</li>\n<li>模块成员可以在外部直接修改</li>\n</ol>\n<h2 id=\"stage2\"><a href=\"#stage2\" class=\"headerlink\" title=\"stage2\"></a>stage2</h2><blockquote>\n<p>命名空间，减少命名冲突</p>\n</blockquote>\n<p>每个文件中，通过一个命名对象来包裹所有的变量和方法</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\"><span class=\"hljs-comment\">// module a 相关的数据和方法</span><br><br><span class=\"hljs-keyword\">const</span> moduleA = &#123;<br>  <span class=\"hljs-attr\">name</span>: <span class=\"hljs-string\">&#x27;module a&#x27;</span>,<br>  <span class=\"hljs-attr\">count</span>: <span class=\"hljs-number\">1</span>,<br>  <span class=\"hljs-title function_\">incCount</span>(<span class=\"hljs-params\"></span>) &#123;<br>    <span class=\"hljs-variable language_\">this</span>.<span class=\"hljs-property\">count</span> ++<br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure>\n\n<p>缺点：</p>\n<ol>\n<li>污染全局作用域</li>\n<li>无法管理模块间的依赖关系</li>\n<li>模块成员可以在外部直接修改</li>\n</ol>\n<h2 id=\"stage3\"><a href=\"#stage3\" class=\"headerlink\" title=\"stage3\"></a>stage3</h2><blockquote>\n<p>IIFE（立即执行函数）</p>\n</blockquote>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\">;(<span class=\"hljs-keyword\">function</span>(<span class=\"hljs-params\">$</span>)&#123;<br>  <span class=\"hljs-keyword\">const</span> name = <span class=\"hljs-string\">&#x27;moduleA&#x27;</span><br>  <span class=\"hljs-keyword\">let</span> count = <span class=\"hljs-number\">1</span><br>  <span class=\"hljs-keyword\">function</span> <span class=\"hljs-title function_\">incCount</span>(<span class=\"hljs-params\"></span>) &#123;<br>    count++<br>  &#125;<br><br>  <span class=\"hljs-variable language_\">window</span>.<span class=\"hljs-property\">moduleA</span> = &#123;<br>    incCount<br>  &#125;<br>&#125;)(jQuery)<br></code></pre></td></tr></table></figure>\n\n<p>通过闭包的方式，模块内部的变量只能被模块内部修改，外部无法修改。</p>\n<p>通过 IIFE 的传参，我们可以传递一些依赖包给模块使用。</p>\n<h1 id=\"模块化规范\"><a href=\"#模块化规范\" class=\"headerlink\" title=\"模块化规范\"></a>模块化规范</h1><ul>\n<li><p>CommonJS（NodeJS）</p>\n<ol>\n<li>一个文件就是一个模块</li>\n<li>每个模块都有单独的作用域</li>\n<li>通过 module.exports 导出成员</li>\n<li>通过 require 函数加载成员</li>\n</ol>\n</li>\n</ul>\n<p>以同步的方式加载模块，如果放在浏览器中，那么会出现大量的文件请求，有时候并不是立马就需要的文件也会被加载，从而造成性能问题，不适合在浏览器中使用。</p>\n<ul>\n<li><p>AMD（Asyncronous module definition）</p>\n<p>异步的模块定义</p>\n</li>\n</ul>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\"><span class=\"hljs-comment\">// 定义一个模块</span><br><span class=\"hljs-comment\">// 第二个参数表示当前模块的依赖项</span><br><span class=\"hljs-title function_\">define</span>(<span class=\"hljs-string\">&#x27;module1&#x27;</span>, [<span class=\"hljs-string\">&#x27;lodash&#x27;</span>, <span class=\"hljs-string\">&#x27;./module2&#x27;</span>], <span class=\"hljs-keyword\">function</span>(<span class=\"hljs-params\"><span class=\"hljs-string\">&#x27;lodash&#x27;</span>, <span class=\"hljs-string\">&#x27;module2&#x27;</span></span>) &#123;<br>  <br>  <span class=\"hljs-comment\">// 导出成员，外部可以方法 start 方法</span><br>  <span class=\"hljs-keyword\">return</span> &#123;<br>    <span class=\"hljs-attr\">start</span>:<span class=\"hljs-keyword\">function</span>(<span class=\"hljs-params\"></span>) &#123;<br>      <span class=\"hljs-comment\">// lodash</span><br><br>      <span class=\"hljs-title function_\">module2</span>()<br>    &#125;<br>  &#125;<br>&#125;)<br><br>  <span class=\"hljs-comment\">// 加载模块</span><br><br>  <span class=\"hljs-built_in\">require</span>(<span class=\"hljs-string\">&#x27;./module1&#x27;</span>, <span class=\"hljs-keyword\">function</span>(<span class=\"hljs-params\">module1</span>) &#123;<br>    module1.<span class=\"hljs-title function_\">start</span>()<br>  &#125;)<br></code></pre></td></tr></table></figure>\n\n<ul>\n<li><p>CMD规范（类似 CommonJS）</p>\n</li>\n<li><p>ES Modules（浏览器）</p>\n</li>\n</ul>\n<h1 id=\"ES6-模块化\"><a href=\"#ES6-模块化\" class=\"headerlink\" title=\"ES6 模块化\"></a>ES6 模块化</h1><figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs html\"><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">script</span> <span class=\"hljs-attr\">src</span>=<span class=\"hljs-string\">&quot;./main.js&quot;</span> <span class=\"hljs-attr\">type</span>=<span class=\"hljs-string\">&quot;module&quot;</span>&gt;</span><span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">script</span>&gt;</span><br><br><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">script</span> <span class=\"hljs-attr\">type</span>=<span class=\"hljs-string\">&quot;module&quot;</span>&gt;</span><span class=\"language-javascript\"></span><br><span class=\"language-javascript\">  <span class=\"hljs-variable language_\">console</span>.<span class=\"hljs-title function_\">log</span>(<span class=\"hljs-number\">1</span>)</span><br><span class=\"language-javascript\"></span><span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">script</span>&gt;</span><br></code></pre></td></tr></table></figure>\n\n<p>特性：</p>\n<ul>\n<li>ES6的模块自动采用严格模式，不管有没有在模块头部加上＂use strict＂。</li>\n<li>每个 ES Module 都运行在私有作用域中</li>\n<li>ESM 是通过 CORS(跨域) 的方式去请求外部的 JS 资源的。（原 script 标签默认支持跨域）</li>\n<li>ESM 的 script 标签会延迟执行脚本（类似标签的 defer 属性），等待网页渲染完成后，再执行。<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\"><span class=\"hljs-comment\">// 会比有 type=&quot;module&quot; 的script 先执行</span><br>&lt;script&gt;<br>  <span class=\"hljs-title function_\">alert</span>(<span class=\"hljs-string\">&#x27;hello&#x27;</span>)<br>&lt;/script&gt;<br><br><span class=\"hljs-comment\">// 延迟执行</span><br><span class=\"language-xml\"><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">script</span> <span class=\"hljs-attr\">type</span>=<span class=\"hljs-string\">&quot;module&quot;</span>&gt;</span><span class=\"language-javascript\"> <span class=\"hljs-comment\">// 等同于加了 defer 属性</span></span></span><br><span class=\"language-javascript\"><span class=\"language-xml\">  <span class=\"hljs-variable language_\">console</span>.<span class=\"hljs-title function_\">log</span>(<span class=\"hljs-number\">1</span>)</span></span><br><span class=\"language-javascript\"><span class=\"language-xml\"></span><span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">script</span>&gt;</span></span><br></code></pre></td></tr></table></figure>\n\n</li>\n</ul>\n<p>严格模式主要有以下限制：</p>\n<ul>\n<li>变量必须声明后再使用。</li>\n<li>函数的参数不能有同名属性，否则报错。</li>\n<li>不能使用with语句。</li>\n<li>不能对只读属性赋值，否则报错。</li>\n<li>不能使用前缀0表示八进制数，否则报错。</li>\n<li>不能删除不可删除的属性，否则报错。</li>\n<li>不能删除变量(delete prop)，会报错，只能删除属性(delete global[prop])。</li>\n<li>eval不会在其外层作用域引入变量。</li>\n<li>eval和arguments不能被重新赋值。</li>\n<li>arguments不会自动反映函数参数的变化。</li>\n<li>不能使用arguments.callee。</li>\n<li>不能使用arguments.caller。</li>\n<li>禁止this指向全局对象。</li>\n<li>不能使用fn.caller和fn.arguments获取函数调用的堆栈。</li>\n<li>增加了保留字（比如protected、static和interface）。</li>\n</ul>\n<h2 id=\"export-amp-import\"><a href=\"#export-amp-import\" class=\"headerlink\" title=\"export &amp; import\"></a>export &amp; import</h2><p>模块功能主要由两个命令构成：export和import。</p>\n<p>export命令用于规定模块的对外接口，import命令用于输入其他模块提供的功能。一个模块就是一个独立的文件。该文件内部的所有变量，外部无法获取。</p>\n<p>如果希望外部能够读取模块内部的某个变量，就必须使用export关键字输出该变量。</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\"><span class=\"hljs-comment\">// test.js</span><br><span class=\"hljs-keyword\">export</span> <span class=\"hljs-keyword\">const</span> myName = <span class=\"hljs-string\">&#x27;Hello_AlexCC&#x27;</span><br><br><span class=\"hljs-comment\">// 组合导出</span><br><span class=\"hljs-keyword\">const</span> myAge = <span class=\"hljs-number\">18</span><br><span class=\"hljs-keyword\">const</span> sayMe = <span class=\"hljs-keyword\">function</span>(<span class=\"hljs-params\"></span>) &#123;<br>  <span class=\"hljs-variable language_\">console</span>.<span class=\"hljs-title function_\">log</span>(<span class=\"hljs-string\">`my name is <span class=\"hljs-subst\">$&#123;myName&#125;</span>, and I&#x27;m <span class=\"hljs-subst\">$&#123;myAge&#125;</span> years old!`</span>)<br>&#125;<br><br><span class=\"hljs-keyword\">export</span> &#123;<br>  myAge,<br>  sayMe<br>&#125;<br></code></pre></td></tr></table></figure>\n\n<p>如果在一个模块中先输入后输出同一个模块，import语句可以与export语句写在一起。</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\"><span class=\"hljs-keyword\">export</span> &#123; sayName <span class=\"hljs-keyword\">as</span> <span class=\"hljs-keyword\">default</span>&#125; <span class=\"hljs-keyword\">from</span> <span class=\"hljs-string\">&#x27;./someModule&#x27;</span><br><br><span class=\"hljs-comment\">// 等价于</span><br><br><span class=\"hljs-keyword\">import</span> &#123; sayName &#125; <span class=\"hljs-keyword\">from</span> <span class=\"hljs-string\">&#x27;./someModule&#x27;</span><br><span class=\"hljs-keyword\">export</span> <span class=\"hljs-keyword\">default</span> sayName<br></code></pre></td></tr></table></figure>\n\n<p>另外，ES7有一个提案(<a href=\"https://github.com/leebyron/ecmascript-more-export-from)，简化先输入后输出的写法，拿掉了输出时的大括号。\">https://github.com/leebyron/ecmascript-more-export-from)，简化先输入后输出的写法，拿掉了输出时的大括号。</a></p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\"><span class=\"hljs-comment\">// 提案</span><br><span class=\"hljs-keyword\">export</span> v <span class=\"hljs-keyword\">from</span> <span class=\"hljs-string\">&#x27;mod&#x27;</span><br><br><span class=\"hljs-comment\">// 现在</span><br><span class=\"hljs-keyword\">export</span> &#123; v &#125; <span class=\"hljs-keyword\">from</span> <span class=\"hljs-string\">&#x27;mod&#x27;</span><br></code></pre></td></tr></table></figure>\n\n<p>import语句会执行所加载的模块</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\"><span class=\"hljs-keyword\">import</span> <span class=\"hljs-string\">&#x27;lodash&#x27;</span><br></code></pre></td></tr></table></figure>\n\n<h2 id=\"模块整体加载\"><a href=\"#模块整体加载\" class=\"headerlink\" title=\"模块整体加载\"></a>模块整体加载</h2><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\"><span class=\"hljs-keyword\">import</span> * <span class=\"hljs-keyword\">as</span> myModule <span class=\"hljs-keyword\">from</span> <span class=\"hljs-string\">&#x27;./myModule&#x27;</span><br></code></pre></td></tr></table></figure>\n\n<h2 id=\"module-命令\"><a href=\"#module-命令\" class=\"headerlink\" title=\"module 命令\"></a>module 命令</h2><p>module命令可以取代import语句，达到整体输入模块的作用。</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\"><span class=\"hljs-variable language_\">module</span> myModule <span class=\"hljs-keyword\">from</span> <span class=\"hljs-string\">&#x27;./myModule&#x27;</span><br><br>myModule.<span class=\"hljs-title function_\">sayName</span>()<br></code></pre></td></tr></table></figure>\n\n<h2 id=\"动态加载模块\"><a href=\"#动态加载模块\" class=\"headerlink\" title=\"动态加载模块\"></a>动态加载模块</h2><p>返回的是 Promise</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\"><span class=\"hljs-title function_\">import</span>(<span class=\"hljs-string\">&#x27;./moduleA.js&#x27;</span>).<span class=\"hljs-title function_\">then</span>(<span class=\"hljs-function\"><span class=\"hljs-params\">module</span> =&gt;</span> &#123;<br>  ...<br>&#125;)<br></code></pre></td></tr></table></figure>\n\n<h2 id=\"ES6模块加载的实质\"><a href=\"#ES6模块加载的实质\" class=\"headerlink\" title=\"ES6模块加载的实质\"></a>ES6模块加载的实质</h2><p>ES6模块加载的机制与CommonJS模块完全不同。</p>\n<p>CommonJS模块输出的是一个值的拷贝，而ES6模块输出的是 <code>值的引用</code>。</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\"><span class=\"hljs-comment\">// lib.js</span><br><span class=\"hljs-keyword\">export</span> <span class=\"hljs-keyword\">let</span> count = <span class=\"hljs-number\">1</span><br><span class=\"hljs-keyword\">export</span> <span class=\"hljs-keyword\">function</span> <span class=\"hljs-title function_\">incCount</span>(<span class=\"hljs-params\"></span>) &#123;<br>  count++<br>&#125;<br><br><span class=\"hljs-comment\">// main.js</span><br><span class=\"hljs-keyword\">import</span> &#123; count, incCount &#125; <span class=\"hljs-keyword\">from</span> <span class=\"hljs-string\">&#x27;./lib.js&#x27;</span><br><br><span class=\"hljs-variable language_\">console</span>.<span class=\"hljs-title function_\">log</span>(count) <span class=\"hljs-comment\">// 1</span><br><br><span class=\"hljs-title function_\">incCount</span>()<br><br><span class=\"hljs-variable language_\">console</span>.<span class=\"hljs-title function_\">log</span>(count) <span class=\"hljs-comment\">// 2</span><br></code></pre></td></tr></table></figure>\n\n\n<p>注意加上 type=”module”</p>\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs html\"><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">script</span> <span class=\"hljs-attr\">src</span>=<span class=\"hljs-string\">&quot;./main.js&quot;</span> <span class=\"hljs-attr\">type</span>=<span class=\"hljs-string\">&quot;module&quot;</span>&gt;</span><span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">script</span>&gt;</span><br></code></pre></td></tr></table></figure>\n\n<h2 id=\"ES-Module-in-NodeJS\"><a href=\"#ES-Module-in-NodeJS\" class=\"headerlink\" title=\"ES Module in NodeJS\"></a>ES Module in NodeJS</h2><p>如何在 Nodejs 中使用 ES module!</p>\n<p>有两个步骤：</p>\n<ol>\n<li><code>.js</code> 后缀都改为 <code>.mjs</code></li>\n<li>执行脚本时，加上 <code>node --experimental-modules main.mjs</code></li>\n</ol>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\"><span class=\"hljs-comment\">// node</span><br><br><span class=\"hljs-comment\">// main.mjs</span><br><span class=\"hljs-keyword\">import</span> fs <span class=\"hljs-keyword\">from</span> <span class=\"hljs-string\">&#x27;fs&#x27;</span><br><span class=\"hljs-keyword\">import</span> _ <span class=\"hljs-keyword\">from</span> <span class=\"hljs-string\">&#x27;lodash&#x27;</span><br></code></pre></td></tr></table></figure>\n\n<p>注意事项：</p>\n<ol>\n<li>在 node 环境中，我们可以使用 ES Module 导入 CommonJS 导出的成员</li>\n</ol>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\"><span class=\"hljs-comment\">// commonjs.js</span><br><span class=\"hljs-variable language_\">module</span>.<span class=\"hljs-property\">exports</span> = &#123;<br>  <span class=\"hljs-attr\">foo</span>: <span class=\"hljs-string\">&#x27;commonjs exports foo&#x27;</span><br>&#125;<br><br><span class=\"hljs-comment\">// esmodule.js</span><br><span class=\"hljs-keyword\">import</span> mod <span class=\"hljs-keyword\">from</span> <span class=\"hljs-string\">&#x27;./commonjs.js&#x27;</span><br><br><span class=\"hljs-variable language_\">console</span>.<span class=\"hljs-title function_\">log</span>(mod.<span class=\"hljs-property\">foo</span>)<br></code></pre></td></tr></table></figure>\n\n<ol start=\"2\">\n<li>在 node 环境中，CommonJS 中<code>不能</code>导入 ES Module 导出的成员</li>\n</ol>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\"><span class=\"hljs-keyword\">const</span> mod = <span class=\"hljs-built_in\">require</span>(<span class=\"hljs-string\">&#x27;./esmodule.js&#x27;</span>) <span class=\"hljs-comment\">// 报错</span><br></code></pre></td></tr></table></figure>\n\n<h2 id=\"CommonJS-与-ES-Module-差异\"><a href=\"#CommonJS-与-ES-Module-差异\" class=\"headerlink\" title=\"CommonJS 与 ES Module 差异\"></a>CommonJS 与 ES Module 差异</h2><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\"><span class=\"hljs-comment\">// CommonJS</span><br><br><span class=\"hljs-built_in\">require</span> <span class=\"hljs-comment\">// 加载模块函数</span><br><br><span class=\"hljs-variable language_\">module</span> <span class=\"hljs-comment\">// 模块对象</span><br><br><span class=\"hljs-built_in\">exports</span> <span class=\"hljs-comment\">// 导出对象别名 exports.name = &#x27;hello world&#x27;</span><br><br>__filename <span class=\"hljs-comment\">// 当前文件的绝对路径</span><br><br>__dirname <span class=\"hljs-comment\">// 当前文件所在目录</span><br></code></pre></td></tr></table></figure>\n\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\"><span class=\"hljs-comment\">// ES Module</span><br><br><span class=\"hljs-keyword\">import</span>.<span class=\"hljs-property\">meta</span>.<span class=\"hljs-property\">url</span> <span class=\"hljs-comment\">// 文件路径信息</span><br><br><span class=\"hljs-comment\">// 可以通过内置模块 url 和 path 处理，拿到 __filename 和 __dirname</span><br><span class=\"hljs-keyword\">import</span> &#123; fileURLToPath &#125; <span class=\"hljs-keyword\">from</span> <span class=\"hljs-string\">&#x27;url&#x27;</span><br><span class=\"hljs-keyword\">import</span> &#123; dirname &#125; <span class=\"hljs-keyword\">from</span> <span class=\"hljs-string\">&#x27;path&#x27;</span><br><br><span class=\"hljs-keyword\">const</span> __filename = <span class=\"hljs-title function_\">fileURLToPath</span>(<span class=\"hljs-keyword\">import</span>.<span class=\"hljs-property\">meta</span>.<span class=\"hljs-property\">url</span>)<br><span class=\"hljs-keyword\">const</span> __dirname = <span class=\"hljs-title function_\">dirname</span>(__filename)<br></code></pre></td></tr></table></figure>\n\n<h2 id=\"高版本-NodeJS-已支持-ESM-Version-gt-12-10-0\"><a href=\"#高版本-NodeJS-已支持-ESM-Version-gt-12-10-0\" class=\"headerlink\" title=\"高版本 NodeJS 已支持 ESM (Version &gt; 12.10.0)\"></a>高版本 NodeJS 已支持 ESM (Version &gt; 12.10.0)</h2><p>不需要再写 <code>.mjs</code> 结尾了，直接 <code>.js</code></p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\"><span class=\"hljs-comment\">// package.json</span><br>&#123;<br>  <span class=\"hljs-string\">&quot;type&quot;</span>: <span class=\"hljs-string\">&quot;module&quot;</span><br>&#125;<br><br><span class=\"hljs-comment\">// 执行</span><br>node --experimental-modules main.<span class=\"hljs-property\">js</span> <br></code></pre></td></tr></table></figure>\n\n<p>加上 type module 配置之后，如果我们还想用 <code>CommonJS</code> 规范，发现会报错了。因为我们已经使用了 ESM。</p>\n<p>如果继续使用 <code>CommonJS</code> 规范，那么就需要将 <code>.js</code> 改为 <code>.cjs</code>。</p>\n<h2 id=\"ESM-in-NodeJS-（babel-兼容方案）\"><a href=\"#ESM-in-NodeJS-（babel-兼容方案）\" class=\"headerlink\" title=\"ESM in NodeJS （babel 兼容方案）\"></a>ESM in NodeJS （babel 兼容方案）</h2><blockquote>\n<p>yarn add @babel/node @babel/preset-env –save-dev</p>\n</blockquote>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\"><span class=\"hljs-comment\">// 通过 babel-node 命令执行脚本</span><br>yarn babel-node main.<span class=\"hljs-property\">js</span><br></code></pre></td></tr></table></figure>\n\n<p>要注意的是，<code>babel/core</code> 并不会转换我们的代码，转换代码的工作交给 babel 内置的插件去实现的。也就是说，我们需要一个插件，去转换 ES6 中的一个新特性。</p>\n<img src=\"/img/babel.jpg\" />\n\n<p>而 <code>@bable/preset-env</code> 是插件的集合，所以不需要每个插件都安装一遍。</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\"><span class=\"hljs-comment\">// 命令行使用</span><br>yarn babel-node main.<span class=\"hljs-property\">js</span> --presets=@bable/preset-env<br></code></pre></td></tr></table></figure>\n\n<p>结合 babel 配置文件使用</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\"><span class=\"hljs-comment\">// .babelrc</span><br>&#123;<br>  <span class=\"hljs-string\">&quot;presets&quot;</span>: [<span class=\"hljs-string\">&quot;@babel/presets-env&quot;</span>]<br>&#125;<br><br>yarn babel-node main.<span class=\"hljs-property\">js</span><br></code></pre></td></tr></table></figure>\n\n<p>既然 <code>@babel/preset-env</code> 是插件的集合，而我不想要那么多，只是想处理 <code>ESM</code> 怎么办呢？</p>\n<p>我们卸载掉 <code>@babel/preset-env</code>，安装 <code>@babel/plugin-transform-modules-commonjs</code></p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\"><span class=\"hljs-comment\">// .babelrc</span><br>&#123;<br>  <span class=\"hljs-string\">&quot;presets&quot;</span>: [<span class=\"hljs-string\">&quot;@babel/plugin-transform-modules-commonjs&quot;</span>]<br>&#125;<br><br>yarn babel-node main.<span class=\"hljs-property\">js</span><br></code></pre></td></tr></table></figure>\n\n<h1 id=\"babel\"><a href=\"#babel\" class=\"headerlink\" title=\"babel\"></a>babel</h1><blockquote>\n<p>编译器</p>\n</blockquote>\n<p>主要用于将ES6版本的JS代码转换为ES5等向后兼容的JS代码，从而使代码可以运行在低版本浏览器或其他环境中。</p>\n<blockquote>\n<p>npm install –save-dev babel-core babel-preset-es2015 babel-preset-latest –registry=<a href=\"https://registry.npm.taobao.org\">https://registry.npm.taobao.org</a></p>\n</blockquote>\n<p>配置文件 <code>.babelrc</code>（或者 babel.config.js || .babelrc.js）</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\">&#123;<br>  <span class=\"hljs-string\">&quot;presets&quot;</span>: [<span class=\"hljs-string\">&quot;es2015&quot;</span>, <span class=\"hljs-string\">&quot;latest&quot;</span>], <span class=\"hljs-comment\">// 安装包的别名，用来处理最新的 ES6 语法</span><br>  <span class=\"hljs-string\">&quot;plugins&quot;</span>: []<br>&#125;<br></code></pre></td></tr></table></figure>\n\n<p>安装 <code>babel-cli</code>，命令行编译工具，依赖 <code>babel/core</code></p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\">npm install --save-dev babel-cli <br></code></pre></td></tr></table></figure>\n\n<p>查看 babel 版本（npx 是新版 NodeJS 附带的命令）</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\">npx babel --version <span class=\"hljs-comment\">// ===== node_modules/.bin/babel --version </span><br><br><span class=\"hljs-comment\">// ====&gt; 6.26.0 (babel-core 6.26.3)</span><br></code></pre></td></tr></table></figure>\n\n<p>到这里，我们就可以使用 babel 来编译js 文件了。创建一个 babel.js 文件，写入一些 es6 的语法。</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\"><span class=\"hljs-comment\">// babel.js</span><br><br><span class=\"hljs-keyword\">const</span> <span class=\"hljs-title function_\">foo</span> = (<span class=\"hljs-params\"></span>) =&gt; &#123;<br>  <span class=\"hljs-keyword\">return</span> <span class=\"hljs-number\">3</span> * <span class=\"hljs-number\">3</span><br>&#125;<br><br><span class=\"hljs-keyword\">const</span> count = <span class=\"hljs-number\">123</span><br></code></pre></td></tr></table></figure>\n\n<p>打开命令行工具：</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\">npx babel babel.<span class=\"hljs-property\">js</span> -o compiled.<span class=\"hljs-property\">js</span> <span class=\"hljs-comment\">// 等效 node_modules/.bin/babel babel.js -o compiled.js </span><br></code></pre></td></tr></table></figure>\n\n<p>转化后的结果：</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\"><span class=\"hljs-meta\">&quot;use strict&quot;</span>;<br><br><span class=\"hljs-keyword\">var</span> foo = <span class=\"hljs-keyword\">function</span> <span class=\"hljs-title function_\">foo</span>(<span class=\"hljs-params\"></span>) &#123;<br>  <span class=\"hljs-keyword\">return</span> <span class=\"hljs-number\">3</span> * <span class=\"hljs-number\">3</span>;<br>&#125;;<br><br><span class=\"hljs-keyword\">var</span> count = <span class=\"hljs-number\">123</span>;<br></code></pre></td></tr></table></figure>\n\n<h2 id=\"Polyfill\"><a href=\"#Polyfill\" class=\"headerlink\" title=\"Polyfill\"></a>Polyfill</h2><p>Babel默认只转换新的JS语法（syntax），而不转换新的API（Promise、Map）。如果只是做语法转换，Promise 是不会被降级的，在低版本的浏览器中可能无法使用。</p>\n<p>引入 Polyfill，为当前环境提供一个“垫片”。所谓“垫片”，是指垫平不同浏览器之间差异的东西。polyfill提供了全局的ES6对象及通过修改原型链Array.prototype等来补充对实例的实现。</p>\n<h2 id=\"babel-版本\"><a href=\"#babel-版本\" class=\"headerlink\" title=\"babel 版本\"></a>babel 版本</h2><p>Babel版本主要是Babel 6和Babel 7这两个版本。</p>\n<p>提到Babel版本的时候，通常指的是@babel/core这个Babel核心包的版本。</p>\n<p>Babel 7的npm包都存放在babel域下，即在安装npm包的时候，我们安装的是名称以@babel/开头的npm包，如@babel/cli、@babel/core等。而在Babel 6中，我们安装的包名是babel-cli、babel-core等以babel-开头的npm包。其实它们本质上是一样的，都是Babel官方提供的cli命令行工具和core核心包。在平时开发和学习的过程中，碰到@babel/和babel-时应该认识到它俩是作用相同、内容接近的包，只是版本不一样而已。</p>\n<h2 id=\"babel-配置文件\"><a href=\"#babel-配置文件\" class=\"headerlink\" title=\"babel 配置文件\"></a>babel 配置文件</h2><blockquote>\n<p>指定编译的规则。</p>\n</blockquote>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\">.<span class=\"hljs-property\">babelrc</span> || babel.<span class=\"hljs-property\">config</span>.<span class=\"hljs-property\">js</span> || .<span class=\"hljs-property\">babelrc</span>.<span class=\"hljs-property\">js</span> || package.<span class=\"hljs-property\">json</span>（配置 babel 属性，配置项都是 一样的）<br></code></pre></td></tr></table></figure>\n\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\"><span class=\"hljs-comment\">// package.json</span><br><br>&#123;<br>  ...<br><br>  <span class=\"hljs-attr\">babel</span>: &#123;<br>    <span class=\"hljs-string\">&quot;presets&quot;</span>: [<span class=\"hljs-string\">&quot;es2015&quot;</span>, <span class=\"hljs-string\">&quot;react&quot;</span>],<br>    <span class=\"hljs-string\">&quot;plugin&quot;</span>: [<span class=\"hljs-string\">&quot;transform-class-properties&quot;</span>]<br>  &#125;,<br><br>  ...<br>&#125;<br></code></pre></td></tr></table></figure>\n\n<p>推荐使用后缀名是js的配置文件来进行配置，因为可以使用该文件做一些逻辑处理，适用性更强。</p>\n<h2 id=\"插件-amp-预设\"><a href=\"#插件-amp-预设\" class=\"headerlink\" title=\"插件 &amp; 预设\"></a>插件 &amp; 预设</h2><p>plugin代表插件，preset代表预设。通常每个插件或预设都是一个npm包。</p>\n<p>Babel的插件实在太多了，假如只配置插件数组，那我们前端工程要把ES2015、ES2016、ES2017……下的所有插件都写到配置项里，这样的Babel配置文件会非常臃肿。</p>\n<p>preset预设就是帮我们解决这个问题的。预设是一组Babel插件的集合，通俗的说法就是插件包，例如babel-preset-es2015就是所有处理ES2015的二十多个Babel插件的集合。这样我们就不用写一大堆插件配置项了，只需要用一个预设代替就可以。另外，预设也可以是插件和其他预设的集合。</p>\n<p>Babel官方已经针对常用的环境做了如下这些preset包。</p>\n<p>1）@babel/preset-env.</p>\n<p>2）@babel/preset-react.</p>\n<p>3）@babel/preset-typescript.</p>\n<p>4）@babel/preset-stage-0.</p>\n<p>5）@babel/preset-stage-1.</p>\n<h2 id=\"插件与预设的简称\"><a href=\"#插件与预设的简称\" class=\"headerlink\" title=\"插件与预设的简称\"></a>插件与预设的简称</h2><p>如果插件的npm包名称的前缀为babel-plugin-，则可以省略其前缀。</p>\n<p>如果npm包名称的前缀带有npm作用域@，如@org/babel-plugin-xxx，则短名称可以写成@org/xxx。</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\">&#123;<br>  <span class=\"hljs-string\">&quot;plugins&quot;</span>: [<span class=\"hljs-string\">&quot;babel-plugin-transform-decorators-legacy&quot;</span>]<br>&#125;<br><br><span class=\"hljs-comment\">// =====</span><br><br>&#123;<br>  <span class=\"hljs-string\">&quot;plugins&quot;</span>: [<span class=\"hljs-string\">&quot;transform-decorators-legacy&quot;</span>]<br>&#125;<br></code></pre></td></tr></table></figure>\n\n<p>预设的短名称规则与插件的类似，预设npm包名称的前缀为babel-preset-或作用域@xxx/babel-preset-xxx的可以省略掉babel-preset-。</p>\n<h2 id=\"插件和预设执行顺序\"><a href=\"#插件和预设执行顺序\" class=\"headerlink\" title=\"插件和预设执行顺序\"></a>插件和预设执行顺序</h2><p>plugins插件数组和presets预设数组是有顺序要求的。如果两个插件或预设都要处理同一个代码片段，那么会根据插件和预设的顺序来执行。规则如下:</p>\n<p>1）插件比预设先执行。</p>\n<p>2）插件执行顺序是插件数组元素从前向后依次执行。</p>\n<p>3）预设执行顺序是预设数组元素从后向前依次执行。</p>\n<h2 id=\"预设的选择\"><a href=\"#预设的选择\" class=\"headerlink\" title=\"预设的选择\"></a>预设的选择</h2><p>babel-preset-latest，在Babel 6时期，是所有年代preset的集合，在Babel 6最后一个版本中，它是babel-preset-es2015、babel-preset-es2016、babel-preset-es2017的集合。</p>\n<p>@babel/preset-env<code>包含了babel-preset-latest的功能，并对其进行了增强</code>，现在@babel/preset-env完全可以替代babel-preset-latest。</p>\n<p>Babel 6 中是babel-preset-env，Babel 7版本开始，@babel/preset-env。</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\"><span class=\"hljs-comment\">// babel 6</span><br>npm install babel-preset-env --save-dev<br><br><span class=\"hljs-comment\">// .babelrc</span><br>&#123;<br>  <span class=\"hljs-string\">&quot;presets&quot;</span>: [<span class=\"hljs-string\">&quot;env&quot;</span>]<br>&#125;<br><br><span class=\"hljs-comment\">// babel 7</span><br>npm install @babel/preset-env --save-dev<br><br><span class=\"hljs-comment\">// .babelrc</span><br>&#123;<br>  <span class=\"hljs-string\">&quot;presets&quot;</span>: [<span class=\"hljs-string\">&quot;@babel/env&quot;</span>]<br>&#125;<br></code></pre></td></tr></table></figure>\n\n<p>总结起来，Babel官方提供的预设，我们实际会用到的其实就只有四个。</p>\n<p>1）@babel/preset-env.</p>\n<p>2）@babel/preset-flow.</p>\n<p>3）@babel/preset-react.</p>\n<p>4）@babel/preset-typescript.</p>\n<h2 id=\"插件的选择\"><a href=\"#插件的选择\" class=\"headerlink\" title=\"插件的选择\"></a>插件的选择</h2><p>Babel 7 官方有九十多个插件，不过其中大多数都已经整合在@babel/preset-env和@babel/preset-react等预设里了，我们在开发的时候直接使用预设就可以。</p>\n<p>目前比较常用的插件只有@babel/plugin-transform-runtime。</p>\n<h2 id=\"browserslist\"><a href=\"#browserslist\" class=\"headerlink\" title=\"browserslist\"></a>browserslist</h2><p>在 package.json 中经常遇到这个配置项：</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\"><span class=\"hljs-comment\">// package.json</span><br><br>&#123;<br>  <span class=\"hljs-string\">&quot;browserslist&quot;</span>: [<br>    <span class=\"hljs-string\">&quot;&gt; 1%&quot;</span>,<br>    <span class=\"hljs-string\">&quot;not ie &lt;= 8&quot;</span><br>  ]<br>&#125;<br></code></pre></td></tr></table></figure>\n<p>上面配置的含义是，该项目工程的目标环境是市场份额大于1%的浏览器并且不考虑IE 8及以下的IE浏览器。</p>\n<p>browserslist叫作目标环境配置表，除了写在package.json文件里，也可以单独写在工程目录下的.browserslistrc文件里。</p>\n<p>我们写一个含有箭头函数的 js 文件，如果我们在browserslist里指定目标环境是Chrome 60浏览器，再来看一下转换结果:</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\"><span class=\"hljs-comment\">// package.json</span><br>&#123;<br>  <span class=\"hljs-string\">&quot;browserslist&quot;</span>: [<span class=\"hljs-string\">&quot;chrome 60&quot;</span>]<br>&#125;<br></code></pre></td></tr></table></figure>\n<p>我们发现转换后的代码仍然是箭头函数，因为Chrome 60浏览器已经实现了箭头函数语法，所以不会转换成ES5的函数定义语法。</p>\n<h2 id=\"babel-runtime\"><a href=\"#babel-runtime\" class=\"headerlink\" title=\"@babel/runtime\"></a>@babel/runtime</h2><p>我们写个 js 文件，里面包含 es6 的 class 语法:</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\"><span class=\"hljs-keyword\">class</span> <span class=\"hljs-title class_\">Person</span> &#123;<br>  <span class=\"hljs-title function_\">sayName</span>(<span class=\"hljs-params\"></span>) &#123;<br>    <span class=\"hljs-title function_\">alert</span>(<span class=\"hljs-variable language_\">this</span>.<span class=\"hljs-property\">name</span>)<br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure>\n\n<p>然后执行 babel 命令，查看转换后的结果 <code>npx babel babel.js -o compiled.js</code></p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\"><span class=\"hljs-meta\">&quot;use strict&quot;</span>;<br><br><span class=\"hljs-keyword\">var</span> _createClass = <span class=\"hljs-keyword\">function</span> (<span class=\"hljs-params\"></span>) &#123; <span class=\"hljs-keyword\">function</span> <span class=\"hljs-title function_\">defineProperties</span>(<span class=\"hljs-params\">target, props</span>) &#123; <span class=\"hljs-keyword\">for</span> (<span class=\"hljs-keyword\">var</span> i = <span class=\"hljs-number\">0</span>; i &lt; props.<span class=\"hljs-property\">length</span>; i++) &#123; <span class=\"hljs-keyword\">var</span> descriptor = props[i]; descriptor.<span class=\"hljs-property\">enumerable</span> = descriptor.<span class=\"hljs-property\">enumerable</span> || <span class=\"hljs-literal\">false</span>; descriptor.<span class=\"hljs-property\">configurable</span> = <span class=\"hljs-literal\">true</span>; <span class=\"hljs-keyword\">if</span> (<span class=\"hljs-string\">&quot;value&quot;</span> <span class=\"hljs-keyword\">in</span> descriptor) descriptor.<span class=\"hljs-property\">writable</span> = <span class=\"hljs-literal\">true</span>; <span class=\"hljs-title class_\">Object</span>.<span class=\"hljs-title function_\">defineProperty</span>(target, descriptor.<span class=\"hljs-property\">key</span>, descriptor); &#125; &#125; <span class=\"hljs-keyword\">return</span> <span class=\"hljs-keyword\">function</span> (<span class=\"hljs-params\">Constructor, protoProps, staticProps</span>) &#123; <span class=\"hljs-keyword\">if</span> (protoProps) <span class=\"hljs-title function_\">defineProperties</span>(<span class=\"hljs-title class_\">Constructor</span>.<span class=\"hljs-property\"><span class=\"hljs-keyword\">prototype</span></span>, protoProps); <span class=\"hljs-keyword\">if</span> (staticProps) <span class=\"hljs-title function_\">defineProperties</span>(<span class=\"hljs-title class_\">Constructor</span>, staticProps); <span class=\"hljs-keyword\">return</span> <span class=\"hljs-title class_\">Constructor</span>; &#125;; &#125;();<br><br><span class=\"hljs-keyword\">function</span> <span class=\"hljs-title function_\">_classCallCheck</span>(<span class=\"hljs-params\">instance, Constructor</span>) &#123; <span class=\"hljs-keyword\">if</span> (!(instance <span class=\"hljs-keyword\">instanceof</span> <span class=\"hljs-title class_\">Constructor</span>)) &#123; <span class=\"hljs-keyword\">throw</span> <span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">TypeError</span>(<span class=\"hljs-string\">&quot;Cannot call a class as a function&quot;</span>); &#125; &#125;<br><br><span class=\"hljs-keyword\">var</span> <span class=\"hljs-title class_\">Person</span> = <span class=\"hljs-keyword\">function</span> (<span class=\"hljs-params\"></span>) &#123;<br>  <span class=\"hljs-keyword\">function</span> <span class=\"hljs-title function_\">Person</span>(<span class=\"hljs-params\"></span>) &#123;<br>    <span class=\"hljs-title function_\">_classCallCheck</span>(<span class=\"hljs-variable language_\">this</span>, <span class=\"hljs-title class_\">Person</span>);<br>  &#125;<br><br>  <span class=\"hljs-title function_\">_createClass</span>(<span class=\"hljs-title class_\">Person</span>, [&#123;<br>    <span class=\"hljs-attr\">key</span>: <span class=\"hljs-string\">&quot;sayName&quot;</span>,<br>    <span class=\"hljs-attr\">value</span>: <span class=\"hljs-keyword\">function</span> <span class=\"hljs-title function_\">sayName</span>(<span class=\"hljs-params\"></span>) &#123;<br>      <span class=\"hljs-title function_\">alert</span>(<span class=\"hljs-variable language_\">this</span>.<span class=\"hljs-property\">name</span>);<br>    &#125;<br>  &#125;]);<br><br>  <span class=\"hljs-keyword\">return</span> <span class=\"hljs-title class_\">Person</span>;<br>&#125;();<br></code></pre></td></tr></table></figure>\n\n<p>可以看到，转换后的代码上部增加了好几个函数声明，这些函数是Babel转码时注入的，我们称之为辅助函数。@babel/preset-env在做语法转换的时候，注入了这些函数声明，以便语法转换后使用。</p>\n<p>但这样做存在一个问题。在我们正常地进行前端工程开发的时候，少则有几十个JS文件，多则有上千个。如果每个文件里都使用了class类语法，那么会导致每个转换后的代码上部都会注入这些相同的函数声明。这会导致我们用构建工具打包出来的包体积非常大。</p>\n<p>那么应该怎么办呢？一个思路就是，我们把这些函数声明都放在一个npm包里，需要使用的时候直接从这个包里引入我们的文件。这样即使有上千个文件，也会从相同的包里引入这些函数。使用Webpack这一类的构建工具进行打包时，我们只需要引入一次npm包里的函数，这样就做到了复用，减小了包的体积。</p>\n<p><code>@babel/runtime</code> 就是上面说的这个npm包，<strong>@babel/runtime把所有语法转换会用到的辅助函数都集中在了一起。</strong></p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\"><span class=\"hljs-comment\">// babbel 6</span><br>npm install babel-runtime --save-dev <span class=\"hljs-comment\">// /node_modules/babel-runtime/helpers/createClass.js</span><br><br><span class=\"hljs-comment\">// babel 7</span><br>npm install @babel/runtime@<span class=\"hljs-number\">7.12</span><span class=\"hljs-number\">.5</span> --save-dev<br></code></pre></td></tr></table></figure>\n\n<p>然后到node_modules目录下看一下这个包的结构，找到 _classCallCheck、_defineProperties与_createClass这三个辅助函数的位置，我们直接引入即可。</p>\n<p>这时，我们就可以替换转换后自动创建的方法，而是使用 @babel/runtime/helpers 中已有的方法。</p>\n<p>不过，这么多辅助函数要一个个记住并手动引入，是很难做到的。这时Babel插件 <code>@babel/plugin-transform-runtime</code> 就可以用来帮我们解决这个问题。</p>\n<h2 id=\"babel-plugin-transform-runtime\"><a href=\"#babel-plugin-transform-runtime\" class=\"headerlink\" title=\"@babel/plugin-transform-runtime\"></a>@babel/plugin-transform-runtime</h2><p>辅助函数的自动引入。</p>\n<p>@babel/plugin-transform-runtime有三大作用，其中之一就是自动移除语法转换后内联的辅助函数（inline Babel helpers），而是使用@babel/runtime/helpers里的辅助函数来替代，这样就减少了我们手动引入的麻烦。</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\"><span class=\"hljs-comment\">// babel6</span><br>npm install babel-plugin-transform-runtime --save-dev<br><br><span class=\"hljs-comment\">// babel 7</span><br>npm install @babel/plugin-transform-runtime@<span class=\"hljs-number\">7.12</span><span class=\"hljs-number\">.10</span> --save-dev<br></code></pre></td></tr></table></figure>\n\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\">&#123;<br>  <span class=\"hljs-string\">&quot;plugins&quot;</span>: [<span class=\"hljs-string\">&quot;@babel/plugin-transform-runtime&quot;</span>] <span class=\"hljs-comment\">// babel 6: &quot;babel-plugin-transform-runtime&quot;</span><br>&#125;<br></code></pre></td></tr></table></figure>\n\n<p>还是上面的例子，我们再看看转换后的结果，会发现插件已经自动帮我们处理了。</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\"><span class=\"hljs-meta\">&quot;use strict&quot;</span>;<br><br><span class=\"hljs-keyword\">var</span> _classCallCheck2 = <span class=\"hljs-built_in\">require</span>(<span class=\"hljs-string\">&quot;babel-runtime/helpers/classCallCheck&quot;</span>);<br><br><span class=\"hljs-keyword\">var</span> _classCallCheck3 = <span class=\"hljs-title function_\">_interopRequireDefault</span>(_classCallCheck2);<br><br><span class=\"hljs-keyword\">var</span> _createClass2 = <span class=\"hljs-built_in\">require</span>(<span class=\"hljs-string\">&quot;babel-runtime/helpers/createClass&quot;</span>);<br><br><span class=\"hljs-keyword\">var</span> _createClass3 = <span class=\"hljs-title function_\">_interopRequireDefault</span>(_createClass2);<br><br><span class=\"hljs-keyword\">function</span> <span class=\"hljs-title function_\">_interopRequireDefault</span>(<span class=\"hljs-params\">obj</span>) &#123; <span class=\"hljs-keyword\">return</span> obj &amp;&amp; obj.<span class=\"hljs-property\">__esModule</span> ? obj : &#123; <span class=\"hljs-attr\">default</span>: obj &#125;; &#125;<br><br><span class=\"hljs-keyword\">var</span> <span class=\"hljs-title class_\">Person</span> = <span class=\"hljs-keyword\">function</span> (<span class=\"hljs-params\"></span>) &#123;<br>  <span class=\"hljs-keyword\">function</span> <span class=\"hljs-title function_\">Person</span>(<span class=\"hljs-params\"></span>) &#123;<br>    (<span class=\"hljs-number\">0</span>, _classCallCheck3.<span class=\"hljs-property\">default</span>)(<span class=\"hljs-variable language_\">this</span>, <span class=\"hljs-title class_\">Person</span>);<br>  &#125;<br><br>  (<span class=\"hljs-number\">0</span>, _createClass3.<span class=\"hljs-property\">default</span>)(<span class=\"hljs-title class_\">Person</span>, [&#123;<br>    <span class=\"hljs-attr\">key</span>: <span class=\"hljs-string\">&quot;sayName&quot;</span>,<br>    <span class=\"hljs-attr\">value</span>: <span class=\"hljs-keyword\">function</span> <span class=\"hljs-title function_\">sayName</span>(<span class=\"hljs-params\"></span>) &#123;<br>      <span class=\"hljs-title function_\">alert</span>(<span class=\"hljs-variable language_\">this</span>.<span class=\"hljs-property\">name</span>);<br>    &#125;<br>  &#125;]);<br>  <span class=\"hljs-keyword\">return</span> <span class=\"hljs-title class_\">Person</span>;<br>&#125;();<br></code></pre></td></tr></table></figure>\n\n<p>实际进行前端开发时，我们除了安装@babel/runtime包，基本也会安装@babel/plugin-transform-runtime这个Babel插件。</p>\n<h1 id=\"Babel-原理与插件开发\"><a href=\"#Babel-原理与插件开发\" class=\"headerlink\" title=\"Babel 原理与插件开发\"></a>Babel 原理与插件开发</h1><p>Babel的转码过程主要由三个阶段组成：解析（parse）、转换（transform）和生成（generate）。这三个阶段分别由@babel/parser、@babel/core和@babel/generator来完成。</p>\n<ol>\n<li><strong>解析阶段</strong></li>\n</ol>\n<p>该阶段由Babel读取源码并生成抽象语法树（AST），该阶段由两部分组成：词法分析与语法分析。</p>\n<p>词法分析会将字符串形式的代码转换成tokens流，语法分析会将tokens流转换成AST。</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\"><span class=\"hljs-keyword\">const</span> name = <span class=\"hljs-string\">&quot;hello AlexCc&quot;</span><br></code></pre></td></tr></table></figure>\n\n<p>AST</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\">-<br>#<span class=\"hljs-number\">1</span><br>  <span class=\"hljs-attr\">type</span>: <span class=\"hljs-title class_\">VariableDeclaration</span><br>  declarations<br>    #<span class=\"hljs-number\">1</span><br>    <span class=\"hljs-attr\">type</span>: <span class=\"hljs-title class_\">VariableDeclarator</span><br>    id<br>      <span class=\"hljs-attr\">type</span>: <span class=\"hljs-title class_\">Identifier</span><br>      <span class=\"hljs-attr\">name</span>: name<br>    init<br>      <span class=\"hljs-attr\">type</span>: <span class=\"hljs-title class_\">Literal</span><br>      <span class=\"hljs-attr\">value</span>: hello <span class=\"hljs-title class_\">AlexCc</span><br>      <span class=\"hljs-attr\">raw</span>: <span class=\"hljs-string\">&quot;hello AlexCc&quot;</span><br>    <span class=\"hljs-attr\">kind</span>: <span class=\"hljs-keyword\">const</span><br></code></pre></td></tr></table></figure>\n\n<ol start=\"2\">\n<li><strong>转换阶段</strong></li>\n</ol>\n<p>完成了解析工作，生成了AST，AST是一个树状的JSON结构。接下来就可以通过Babel插件对该树状结构执行修改操作，修改完成后就得到了新的AST。</p>\n<ol start=\"3\">\n<li><strong>生成阶段</strong></li>\n</ol>\n<p>通过转换阶段的工作，我们得到了新的AST。在生成阶段，我们对AST的树状JSON结构进行还原操作，生成新的JS代码，通常这就是我们需要的ES5代码。</p>\n<h2 id=\"Babel-插件开发\"><a href=\"#Babel-插件开发\" class=\"headerlink\" title=\"Babel 插件开发\"></a>Babel 插件开发</h2><blockquote>\n<p>babel-handbook</p>\n<p><a href=\"https://github.com/jamiebuilds/babel-handbook/blob/master/translations/zh-Hans/plugin-handbook.md\">https://github.com/jamiebuilds/babel-handbook/blob/master/translations/zh-Hans/plugin-handbook.md</a></p>\n</blockquote>\n<p>开发Babel转码插件的重点是在第二阶段（转换阶段），在这一阶段我们要从AST上找出需要转换的节点，改成我们需要的形式，最后在生成阶段把AST变回JS代码。</p>\n<p>插件模板结构:</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\"><span class=\"hljs-variable language_\">module</span>.<span class=\"hljs-property\">exports</span> = <span class=\"hljs-keyword\">function</span>(<span class=\"hljs-params\">&#123; types: t &#125;</span>) &#123;<br>  <span class=\"hljs-keyword\">return</span> &#123;<br>    <span class=\"hljs-attr\">name</span>: <span class=\"hljs-string\">&#x27;pluginName&#x27;</span>,<br>    <span class=\"hljs-attr\">visitor</span>: &#123;&#125;<br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure>\n\n<p>假设我们有这样一段代码：</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\"><span class=\"hljs-keyword\">const</span> dog = <span class=\"hljs-string\">&#x27;is dog&#x27;</span><br></code></pre></td></tr></table></figure>\n\n<p>现在我想将 dog 变成喵咪。</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\"><span class=\"hljs-variable language_\">module</span>.<span class=\"hljs-property\">exports</span> = <span class=\"hljs-keyword\">function</span>(<span class=\"hljs-params\">&#123; types: t &#125;</span>) &#123;<br>  <span class=\"hljs-keyword\">return</span> &#123;<br>    <span class=\"hljs-attr\">visitor</span>: &#123;<br>      <span class=\"hljs-title class_\">Identifier</span>(path, state) &#123;<br>        <span class=\"hljs-keyword\">if</span> (path.<span class=\"hljs-property\">node</span>.<span class=\"hljs-property\">name</span> === <span class=\"hljs-string\">&#x27;dog&#x27;</span>) &#123;<br>          path.<span class=\"hljs-property\">node</span>.<span class=\"hljs-property\">name</span> = <span class=\"hljs-string\">&#x27;cat&#x27;</span><br>          path.<span class=\"hljs-property\">parent</span>.<span class=\"hljs-property\">init</span>.<span class=\"hljs-property\">value</span> = <span class=\"hljs-string\">&#x27;is cat&#x27;</span><br>        &#125;<br>      &#125;,<br>      <span class=\"hljs-keyword\">var</span><br>    &#125;<br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure>\n\n<p>转换后：</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\"><span class=\"hljs-keyword\">const</span> cat = <span class=\"hljs-string\">&#x27;is cat&#x27;</span>;<br></code></pre></td></tr></table></figure>\n\n<p>我们编写Babel插件的主要工作就是修改<code>visitor</code>对象，该对象是遍历AST各个节点的方法。</p>\n<p>在上面的插件里，要把变量名dog修改为cat，于是我们修改了visitor.Identifier方法，那我们如何知道要修改的是Identifier方法呢？</p>\n<p>Babel原理里讲过Babel转码的三个阶段：解析阶段、转换阶段和生成阶段，我们编写的Babel插件实际上是在执行第二个阶段（转换阶段）的工作，该工作需要前一个阶段解析工作先完成。在解析阶段，我们得到了转码前代码的AST树状结构信息，该AST上会有Identifier等节点信息，我们编写插件的时候参考该AST的信息即可。</p>\n<img src=\"/img/ast.jpg\" />\n\n<p>接着看Identifier方法，可以看到它有两个参数path和state，visitor中的每个方法都接收这两个参数，path代表路径。最后我们判断path上节点信息name是不是dog，是的话把它修改为cat即可。</p>\n<p>同理，我们也可以修改 <code>const</code>、<code>value</code>：</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\"><span class=\"hljs-variable language_\">module</span>.<span class=\"hljs-property\">exports</span> = <span class=\"hljs-keyword\">function</span>(<span class=\"hljs-params\">&#123; types: t &#125;</span>) &#123;<br>  <span class=\"hljs-keyword\">return</span> &#123;<br>    <span class=\"hljs-attr\">visitor</span>: &#123;<br>      <span class=\"hljs-title class_\">Identifier</span>(path, state) &#123;<br>        path.<span class=\"hljs-property\">node</span>.<span class=\"hljs-property\">name</span> = <span class=\"hljs-string\">&#x27;cat&#x27;</span><br>        path.<span class=\"hljs-property\">parent</span>.<span class=\"hljs-property\">init</span>.<span class=\"hljs-property\">value</span> = <span class=\"hljs-string\">&#x27;is cat&#x27;</span><br>      &#125;,<br>      <span class=\"hljs-title class_\">VariableDeclaration</span>(path, state) &#123;<br>        <span class=\"hljs-keyword\">if</span> (path.<span class=\"hljs-property\">node</span>.<span class=\"hljs-property\">kind</span> === <span class=\"hljs-string\">&#x27;const&#x27;</span>) &#123;<br>          path.<span class=\"hljs-property\">node</span>.<span class=\"hljs-property\">kind</span> = <span class=\"hljs-string\">&#x27;let&#x27;</span><br>        &#125;<br>      &#125;,<br>      <span class=\"hljs-title class_\">Literal</span>(path, state) &#123;<br>        <span class=\"hljs-comment\">// 修改 value</span><br>        path.<span class=\"hljs-property\">node</span>.<span class=\"hljs-property\">value</span> = <span class=\"hljs-string\">&#x27;is caaat...&#x27;</span><br>      &#125;<br>    &#125;<br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure>\n\n<h2 id=\"插件传参\"><a href=\"#插件传参\" class=\"headerlink\" title=\"插件传参\"></a>插件传参</h2><p>给插件传递参数，注意第一个成员变成了数组，数组的第二项是参数</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\"><span class=\"hljs-comment\">// .babelrc</span><br>&#123;<br>  <span class=\"hljs-string\">&quot;plugins&quot;</span>: [[<span class=\"hljs-string\">&quot;./plugin.js&quot;</span>, &#123;<br>    <span class=\"hljs-string\">&quot;ES5&quot;</span>: <span class=\"hljs-literal\">false</span><br>  &#125;]]<br>&#125;<br></code></pre></td></tr></table></figure>\n\n<p>在插件中，我们可以通过 <code>state.opts</code> 获取到参数：</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\"><span class=\"hljs-comment\">// plugin.js</span><br><br>...<br><span class=\"hljs-title class_\">VariableDeclaration</span>(path, state) &#123;<br>  <span class=\"hljs-keyword\">if</span> (state.<span class=\"hljs-property\">opts</span>.<span class=\"hljs-property\">ES5</span> === <span class=\"hljs-literal\">true</span> &amp;&amp; [<span class=\"hljs-string\">&#x27;let&#x27;</span>, <span class=\"hljs-string\">&#x27;const&#x27;</span>].<span class=\"hljs-title function_\">includes</span>(path.<span class=\"hljs-property\">node</span>.<span class=\"hljs-property\">kind</span>)) &#123;<br>    path.<span class=\"hljs-property\">node</span>.<span class=\"hljs-property\">kind</span> = <span class=\"hljs-string\">&#x27;var&#x27;</span><br>  &#125;<br>&#125;,<br>...<br></code></pre></td></tr></table></figure>\n\n<h1 id=\"ESBuild\"><a href=\"#ESBuild\" class=\"headerlink\" title=\"ESBuild\"></a>ESBuild</h1><blockquote>\n<p><a href=\"https://esbuild.github.io/api/\">https://esbuild.github.io/api/</a></p>\n</blockquote>\n<blockquote>\n<p>介绍: <a href=\"https://juejin.cn/post/6918927987056312327\">https://juejin.cn/post/6918927987056312327</a></p>\n</blockquote>\n"},{"layout":"Vue3","title":"Vue3项目实战(六)：通用功能开发(二)","date":"2023-01-01T06:53:36.000Z","banner_img":"/img/general2.png","index_img":"/img/general2.png","excerpt":"screenfull/headerSearch/tagView/guide","_content":"\n# screenfull\n\n对于 `screenfull ` 和之前一样 ，我们还是先分析它的原理，然后在制定对应的方案实现\n\n**原理：**\n\n对于 `screenfull ` 而言，浏览器本身已经提供了对用的 `API`，[点击这里即可查看](https://developer.mozilla.org/zh-CN/docs/Web/API/Fullscreen_API)，这个 `API` 中，主要提供了两个方法：\n\n1. [`Document.exitFullscreen()`](https://developer.mozilla.org/zh-CN/docs/Web/API/Document/exitFullscreen)：该方法用于请求从全屏模式切换到窗口模式\n2. [`Element.requestFullscreen()`](https://developer.mozilla.org/zh-CN/docs/Web/API/Element/requestFullScreen)：该方法用于请求浏览器（user agent）将特定元素（甚至延伸到它的后代元素）置为全屏模式\n  1. 比如我们可以通过 `document.getElementById('app').requestFullscreen()` 在获取 `id=app` 的 `DOM` 之后，把该区域置为全屏\n\n但是该方法存在一定的小问题，兼容性也不是那么好。\n\n所以通常情况下我们不会直接使用该 `API` 来去实现全屏效果，而是会使用它的包装库 [screenfull](https://www.npmjs.com/package/screenfull)\n\n\n整体的方案实现分为两步：\n\n1. 封装 `screenfull` 组件\n  1. 展示切换按钮\n  2. 基于 [screenfull](https://www.npmjs.com/package/screenfull) 实现切换功能\n2. 在 `navbar` 中引入该组件\n\n明确好了方案之后，接下来我们就落地该方案\n\n**封装 `screenfull` 组件：**\n\n1. 下来依赖包  [screenfull](https://www.npmjs.com/package/screenfull) \n\n```\nnpm i screenfull@5.1.0 -S\n```\n\n2. 创建 `components/Screenfull/index`\n\n```js\n<template>\n  <div>\n    <svg-icon\n      :icon=\"isFullscreen ? 'exit-fullscreen' : 'fullscreen'\"\n      @click=\"onToggle\"\n    />\n  </div>\n</template>\n\n<script setup>\nimport { ref, onMounted, onUnmounted } from 'vue'\nimport screenfull from 'screenfull'\n\n// 是否全屏\nconst isFullscreen = ref(false)\n\n// 切换事件\nconst onToggle = () => {\n  if (screenfull.isEnabled) {\n    screenfull.toggle()\n  }\n}\n\n// 监听变化\nconst change = () => {\n  if (screenfull.isEnabled) {\n    isFullscreen.value = screenfull.isFullscreen\n  }\n}\n\n// 设置侦听器\nonMounted(() => {\n  if (screenfull.isEnabled) {\n    screenfull.on('change', change)\n  }\n})\n\n// 删除侦听器\nonUnmounted(() => {\n  if (screenfull.isEnabled) {\n    screenfull.off('change', change)\n  }\n})\n</script>\n\n<style lang=\"scss\" scoped></style>\n\n```\n\n**在 `navbar` 中引入该组件：**\n\n```\n<screenfull class=\"right-menu-item hover-effect\" />\n\n...\n\nimport Screenfull from '@/components/Screenfull'\n```\n\n# headerSeach\n\n> 所谓 `headerSearch` 一般是指 **页面搜索**\n\n**原理：**\n\n`headerSearch` 是复杂后台系统中非常常见的一个功能，它可以：**在指定搜索框中对当前应用中所有页面进行检索，以 `select` 的形式展示出被检索的页面，以达到快速进入的目的**\n\n那么明确好了 `headerSearch`  的作用之后，接下来我们来看一下对应的实现原理\n\n根据前面的目的我们可以发现，整个 `headerSearch` 其实可以分为三个核心的功能点：\n\n1. 根据指定内容对所有页面进行检索\n2. 以 `select` 形式展示检索出的页面\n3. 通过检索页面可快速进入对应页面\n\n那么围绕着这三个核心的功能点，我们想要分析它的原理就非常简单了：**根据指定内容检索所有页面，把检索出的页面以 `select` 展示，点击对应 `option` 可进入到指定页面**\n\n**方案：**\n\n对照着三个核心功能点和原理，想要指定对应的实现方案是非常简单的一件事情了\n\n1. 创建 `headerSearch` 组件，用作样式展示和用户输入内容获取\n2. 获取所有的页面数据，用作被检索的数据源\n3. 根据用户输入内容在数据源中进行模糊搜索(https://fusejs.io/) \n4. 把搜索到的内容以 `select` 进行展示\n5. 监听 `select` 的 `change` 事件，完成对应跳转\n\n## headerSearch 组件\n\n创建 `components/headerSearch/index` 组件，当点击搜索图标时，通过 `transition` 动画，将其长度展示出来，并且自动聚焦 `focus()`:\n\n```js\n<template>\n  <div :class=\"{ show: isShow }\" class=\"header-search\">\n    <svg-icon\n      class-name=\"search-icon\"\n      icon=\"search\"\n      @click.stop=\"onShowClick\"\n    />\n    <el-select\n      ref=\"headerSearchSelectRef\"\n      class=\"header-search-select\"\n      v-model=\"search\"\n      filterable\n      default-first-option\n      remote\n      placeholder=\"Search\"\n      :remote-method=\"querySearch\"\n      @change=\"onSelectChange\"\n    >\n      <el-option\n        v-for=\"option in 5\"\n        :key=\"option\"\n        :label=\"option\"\n        :value=\"option\"\n      ></el-option>\n    </el-select>\n  </div>\n</template>\n\n<script setup>\nimport { ref } from 'vue'\n\n// 控制 search 显示\nconst isShow = ref(false)\n// el-select 实例\nconst headerSearchSelectRef = ref(null)\nconst onShowClick = () => {\n  isShow.value = !isShow.value\n  headerSearchSelectRef.value.focus()\n}\n\n// search 相关\nconst search = ref('')\n// 搜索方法\nconst querySearch = () => {\n  console.log('querySearch')\n}\n// 选中回调\nconst onSelectChange = () => {\n  console.log('onSelectChange')\n}\n</script>\n\n<style lang=\"scss\" scoped>\n.header-search {\n  font-size: 0 !important;\n  .search-icon {\n    cursor: pointer;\n    font-size: 18px;\n    vertical-align: middle;\n  }\n  .header-search-select {\n    font-size: 18px;\n    transition: width 0.2s; // width 动画\n    width: 0;\n    overflow: hidden;\n    background: transparent;\n    border-radius: 0;\n    display: inline-block;\n    vertical-align: middle;\n\n    ::v-deep .el-input__inner {\n      border-radius: 0;\n      border: 0;\n      padding-left: 0;\n      padding-right: 0;\n      box-shadow: none !important;\n      border-bottom: 1px solid #d9d9d9;\n      vertical-align: middle;\n    }\n  }\n  &.show {\n    .header-search-select {\n      width: 210px;\n      margin-left: 10px;\n    }\n  }\n}\n</style>\n\n```\n\n在 `navbar` 中导入该组件\n\n```js\n<header-search class=\"right-menu-item hover-effect\"></header-search>\n\n...\n\nimport HeaderSearch from '@/components/HeaderSearch/index.vue'\n```\n\n## 获取数据源\n\n在有了 `headerSearch` 之后，接下来就可以来处理对应的 **检索数据源了**\n\n**检索数据源** 表示：**有哪些页面希望检索**\n\n那么对于我们当前的业务而言，我们希望被检索的页面其实就是左侧菜单中的页面，那么我们检索数据源即为：**左侧菜单对应的数据源**\n\n根据以上原理，我们可以得出以下代码：\n\n```js\n<script setup>\nimport { ref, computed } from 'vue'\nimport { filterRouters, generateMenus } from '@/utils/route'\nimport { useRouter } from 'vue-router'\n...\n// 检索数据源\nconst router = useRouter()\nconst searchPool = computed(() => {\n  const filterRoutes = filterRouters(router.getRoutes())\n  console.log(generateMenus(filterRoutes))\n  return generateMenus(filterRoutes)\n})\nconsole.log(searchPool)\n</script>\n```\n\n## 模糊搜索Fuse.js\n> Fuse.js is a powerful, lightweight fuzzy-search library, with zero dependencies.\n\n如果我们想要进行  [模糊搜索](https://fusejs.io/)  的话，那么需要依赖一个第三方的库  [fuse.js](https://fusejs.io/) \n\n它是0️⃣依赖的，专门处理模糊搜索的库。\n\n**Why should I use it?**\n\n- 使用 Fuse.js，您不需要仅仅为了处理搜索而设置专用的后端。\n- 简单性和性能是开发这个库的主要标准。\n\n\n1. 安装 [fuse.js](https://fusejs.io/)\n\n```js\nnpm install --save fuse.js@6.4.6\n```\n\n2. 初始化 `Fuse`，更多初始化配置项 [可点击这里](https://fusejs.io/api/options.html)\n\n```js\nimport Fuse from 'fuse.js'\n\n/**\n* 搜索库相关\n*/\nconst fuse = new Fuse(list, {\n    // 是否按优先级进行排序\n    shouldSort: true,\n    // 匹配长度超过这个值的才会被认为是匹配的\n    minMatchCharLength: 1,\n    // 将被搜索的键列表。 这支持嵌套路径、加权搜索、在字符串和对象数组中搜索。\n    // name：搜索的键\n    // weight：对应的权重\n    // 表示我们将用户输入的值，与 title 和 path 进行匹配\n    keys: [\n      {\n        name: 'title',\n        weight: 0.7\n      },\n      {\n        name: 'path',\n        weight: 0.3\n      }\n    ]\n  })\n```\n\n3. 参考 [Fuse Demo](https://fusejs.io/demo.html) 与 最终效果，可以得出，我们最终期望得到如下的检索数据源结构\n\n```json\n[\n    {\n        \"path\":\"/my\",\n        \"title\":[\n            \"个人中心\"\n        ]\n    },\n    {\n        \"path\":\"/user\",\n        \"title\":[\n            \"用户\"\n        ]\n    },\n    {\n        \"path\":\"/user/manage\",\n        \"title\":[\n            \"用户\",\n            \"用户管理\"\n        ]\n    },\n    {\n        \"path\":\"/user/info\",\n        \"title\":[\n            \"用户\",\n            \"用户信息\"\n        ]\n    },\n    {\n        \"path\":\"/article\",\n        \"title\":[\n            \"文章\"\n        ]\n    },\n    {\n        \"path\":\"/article/ranking\",\n        \"title\":[\n            \"文章\",\n            \"文章排名\"\n        ]\n    },\n    {\n        \"path\":\"/article/create\",\n        \"title\":[\n            \"文章\",\n            \"创建文章\"\n        ]\n    }\n]\n```\n\n4. 所以我们之前处理了的数据源并不符合我们的需要，所以我们需要对数据源进行重新处理\n\n## 数据源重处理，生成 searchPool\n\n我们明确了最终我们期望得到数据源结构，那么接下来我们就对重新计算数据源，生成对应的 `searchPoll`\n\n创建 `components/HeaderSearch/FuseData.js`\n\n```js\nimport path from 'path'\nimport i18n from '@/i18n'\n/**\n * 筛选出可供搜索的路由对象\n * @param routes 路由表\n * @param basePath 基础路径，默认为 /\n * @param prefixTitle 父级title，子集title集合 [文章，文章排名]\n */\nexport const generateRoutes = (routes, basePath = '/', prefixTitle = []) => {\n  // 创建 result 数据\n  let res = []\n  // 循环 routes 路由\n  for (const route of routes) {\n    // 创建包含 path 和 title 的 item\n    const data = {\n      path: path.resolve(basePath, route.path),\n      title: [...prefixTitle]\n    }\n    // 当前存在 meta 时，使用 i18n 解析国际化数据，组合成新的 title 内容\n    // 动态路由不允许被搜索（类似：user/:id 这种）\n    // 匹配动态路由的正则\n    const re = /.*\\/:.*/\n    if (route.meta && route.meta.title && !re.exec(route.path)) {\n      const i18ntitle = i18n.global.t(`msg.route.${route.meta.title}`)\n      data.title = [...data.title, i18ntitle]\n      res.push(data)\n    }\n\n    // 存在 children 时，迭代调用\n    if (route.children) {\n      const tempRoutes = generateRoutes(route.children, data.path, data.title)\n      if (tempRoutes.length >= 1) {\n        res = [...res, ...tempRoutes]\n      }\n    }\n  }\n  return res\n}\n\n```\n\n这样，我们就通过 `generateRoutes` 方法，根据咱们的路由表，生成了符合 `fuse.js` 的数据。\n\n在 `headerSearch` 中导入 `generateRoutes`\n\n```vue\n<script setup>\nimport { computed, ref } from 'vue'\nimport { generateRoutes } from './FuseData'\nimport Fuse from 'fuse.js'\nimport { filterRouters } from '@/utils/route'\nimport { useRouter } from 'vue-router'\n\n...\n\n// 检索数据源\nconst router = useRouter()\nconst searchPool = computed(() => {\n  const filterRoutes = filterRouters(router.getRoutes())\n  return generateRoutes(filterRoutes)\n})\n/**\n * 搜索库相关\n */\nconst fuse = new Fuse(searchPool.value, {\n  ...\n})\n</script>\n```\n\n通过 `querySearch` 测试搜索结果\n\n```js\n// 搜索方法\nconst querySearch = query => {\n  console.log(fuse.search(query))\n}\n```\n\n## 渲染检索数据\n\n数据源处理完成之后，最后我们就只需要完成:\n\n1. 渲染检索出的数据\n2. 完成对应跳转\n\n那么下面我们按照步骤进行实现：\n\n1. 渲染检索出的数据\n\n```js\n<template>\n  <el-option\n      v-for=\"option in searchOptions\"\n      :key=\"option.item.path\"\n      :label=\"option.item.title.join(' > ')\"\n      :value=\"option.item\"\n  ></el-option>\n</template>\n\n<script setup>\n...\n// 搜索结果\nconst searchOptions = ref([])\n// 搜索方法\nconst querySearch = query => {\n  if (query !== '') {\n    searchOptions.value = fuse.search(query)\n  } else {\n    searchOptions.value = []\n  }\n}\n...\n</script>\n\n```\n\n2. 完成对应跳转\n\n```js\nconst onSelectChange = val => {\n  router.push(val.path)\n}\n```\n\n## 剩余问题处理\n\n这里我们的 `headerSearch` 功能基本上就已经处理完成了，但是还存在一些小 `bug` ，那么最后这一小节我们就处理下这些剩余的 `bug`\n\n1. 在 `search` 打开时，点击 `body` 关闭 `search`\n2. 在 `search` 关闭时，清理 `searchOptions`\n3. `headerSearch` 应该具备国际化能力\n\n明确好问题之后，接下来我们进行处理\n\n首先我们先处理前前面两个问题：\n\n```js\n/**\n * 关闭 search 的处理事件\n */\nconst onClose = () => {\n  headerSearchSelectRef.value.blur()\n  isShow.value = false\n  searchOptions.value = []\n}\n/**\n * 监听 search 打开，处理 close 事件\n */\nwatch(isShow, val => {\n  if (val) {\n    document.body.addEventListener('click', onClose)\n  } else {\n    document.body.removeEventListener('click', onClose)\n  }\n})\n```\n\n接下来是国际化的问题，想要处理这个问题非常简单，我们只需要：**监听语言变化，重新计算数据源初始化 `fuse` 即可**\n\n1. 在 `utils/i18n` 下，新建方法 `watchSwitchLang`\n\n```js\nimport { watch } from 'vue'\nimport store from '@/store'\n\ntype IProps = ((lang: string) => void)[]\n\nexport default function watchSwitchLang(...cbs: IProps) {\n  watch(\n    () => store.getters.language,\n    () => {\n      cbs.forEach(cb => cbs.forEach(cb => cb(store.getters.language)))\n    }\n  )\n}\n```\n\n2. 在 `headerSearch` 监听变化，重新赋值\n\n```js\n<script setup>\n...\nimport { watchSwitchLang } from '@/utils/i18n'\n\n...\n\n// 检索数据源\nconst router = useRouter()\nlet searchPool = computed(() => {\n  const filterRoutes = filterRouters(router.getRoutes())\n  return generateRoutes(filterRoutes)\n})\n/**\n* 搜索库相关\n*/\nlet fuse\nconst initFuse = searchPool => {\n  fuse = new Fuse(searchPool, {\n    ...\n}\ninitFuse(searchPool.value)\n\n...\n\n// 处理国际化\nwatchSwitchLang(() => {\n  searchPool = computed(() => {\n    const filterRoutes = filterRouters(router.getRoutes())\n    return generateRoutes(filterRoutes)\n  })\n  initFuse(searchPool.value)\n})\n</script>\n```\n\n## headerSearch 方案总结\n\n那么到这里整个的 `headerSearch` 我们就已经全部处理完成了，整个 `headerSearch` 我们只需要把握住三个核心的关键点\n\n1. 根据指定内容对所有页面进行检索\n2. 以 `select` 形式展示检索出的页面\n3. 通过检索页面可快速进入对应页面\n\n保证大方向没有错误，那么具体的细节处理我们具体分析就可以了。\n\n关于细节的处理，可能比较复杂的地方有两个：\n\n1. 模糊搜索\n2. 检索数据源\n\n对于这两块，我们依赖于 `fuse.js` 进行了实现，大大简化了我们的业务处理流程。\n\n# tagsView 原理及方案分析\n\n所谓 `tagsView` 可以分成两部分来去看：\n\n1. tags\n2. view\n\n好像和废话一样是吧。那怎么分开看呢？\n\n首先我们先来看 `tags`：\n\n所谓 `tgas` 指的是：**位于 `appmain` 之上的标签**\n\n那么现在我们忽略掉 `view`，现在只有一个要求：\n\n> 在 `view` 之上渲染这个 `tag` \n\n仅看这一个要求，很简单吧。\n\n**views：**\n\n明确好了 `tags` 之后，我们来看 `views`。\n\n脱离了 `tags` 只看 `views` 就更简单了，所谓 `views` ：**指的就是一个用来渲染组件的位置**，就像我们之前的 `Appmain` 一样，只不过这里的 `views` 可能稍微复杂一点，因为它需要在渲染的基础上增加：\n\n1. 动画\n2. 缓存\n\n这两个额外的功能。\n\n加上这两个功能之后可能会略显复杂，但是 [官网已经帮助我们处理了这个问题](https://next.router.vuejs.org/zh/guide/advanced/transitions.html#%E5%9F%BA%E4%BA%8E%E8%B7%AF%E7%94%B1%E7%9A%84%E5%8A%A8%E6%80%81%E8%BF%87%E6%B8%A1) \n\n所以 单看 `views` 也是一个很简单的功能。\n\n那么接下来我们需要做的就是把 `tags` 和 `view` 合并起来而已。\n\n那么明确好了原理之后，我们就来看 **实现方案：**\n\n1. 创建 `tagsView` 组件：用来处理 `tags` 的展示\n2. 处理基于路由的动态过渡，在 `AppMain` 中进行：用于处理 `view` 的部分\n\n整个的方案就是这么两大部，但是其中我们还需要处理一些细节相关的，**完整的方案为**：\n\n1. 监听路由变化，组成用于渲染 `tags` 的数据源\n2. 创建 `tags` 组件，根据数据源渲染 `tag`，渲染出来的 `tags` 需要同时具备\n   1. 国际化 `title`\n   2. 路由跳转\n3. 处理鼠标右键效果，根据右键处理对应数据源\n4. 处理基于路由的动态过渡\n\n那么明确好了方案之后，接下来我们根据方案进行处理即可。\n\n## 创建 tags 数据源\n\n`tags` 的数据源分为两部分：\n\n1. 保存数据：`appmain` 组件中进行\n2. 展示数据：`tags` 组件中进行\n\n所以 `tags` 的数据我们最好把它保存到 `vuex` 中。\n\n1. 在 `constant` 中新建常量\n\n   ```js\n   // tags\n   export const TAGS_VIEW = 'tagsView'\n   ```\n\n2. 在 `store/app` 中创建 `tagsViewList`\n\n   ```js\n   import { LANG, TAGS_VIEW } from '@/constant'\n   import { getItem, setItem } from '@/utils/storage'\n   export default {\n     namespaced: true,\n     state: () => ({\n       ...\n       tagsViewList: getItem(TAGS_VIEW) || []\n     }),\n     mutations: {\n       ...\n       /**\n        * 添加 tags\n        */\n       addTagsViewList(state, tag) {\n         const isFind = state.tagsViewList.find(item => {\n           return item.path === tag.path\n         })\n       // 处理重复\n         if (!isFind) {\n           state.tagsViewList.push(tag)\n           setItem(TAGS_VIEW, state.tagsViewList)\n         }\n       }\n     },\n     actions: {}\n   }\n   \n   ```\n\n3. 在 `appmain` 中监听路由的变化\n\n   ```js\n   <script setup>\n   import { watch } from 'vue'\n   import { isTags } from '@/utils/tags'\n   import { generateTitle } from '@/utils/i18n'\n   import { useRoute } from 'vue-router'\n   import { useStore } from 'vuex'\n   \n   const route = useRoute()\n   \n   /**\n    * 生成 title\n    */\n   const getTitle = route => {\n     let title = ''\n     if (!route.meta) {\n       // 处理无 meta 的路由\n       const pathArr = route.path.split('/')\n       title = pathArr[pathArr.length - 1]\n     } else {\n       title = generateTitle(route.meta.title)\n     }\n     return title\n   }\n   \n   /**\n    * 监听路由变化\n    */\n   const store = useStore()\n   watch(\n     route,\n     (to, from) => {\n       if (!isTags(to.path)) return\n       const { fullPath, meta, name, params, path, query } = to\n       store.commit('app/addTagsViewList', {\n         fullPath,\n         meta,\n         name,\n         params,\n         path,\n         query,\n         title: getTitle(to)\n       })\n     },\n     {\n       immediate: true\n     }\n   )\n   </script>\n   \n   \n   ```\n\n4. 创建 `utils/tags`\n\n   ```js\n   const whiteList = ['/login', '/import', '/404', '/401']\n   \n   /**\n    * path 是否需要被缓存\n    * @param {*} path\n    * @returns\n    */\n   export function isTags(path) {\n     return !whiteList.includes(path)\n   }\n   \n   ```\n\n   \n\n## 生成 tagsView\n\n目前数据已经被保存到 `store` 中，那么接下来我们就依赖数据渲染 `tags`\n\n1. 创建 `store/app` 中 `tagsViewList` 的快捷访问\n\n   ```js\n     tagsViewList: state => state.app.tagsViewList\n   ```\n\n2. 创建 `components/tagsview`\n\n   ```js\n   <template>\n     <div class=\"tags-view-container\">\n         <router-link\n           class=\"tags-view-item\"\n           :class=\"isActive(tag) ? 'active' : ''\"\n           :style=\"{\n             backgroundColor: isActive(tag) ? $store.getters.cssVar.menuBg : '',\n             borderColor: isActive(tag) ? $store.getters.cssVar.menuBg : ''\n           }\"\n           v-for=\"(tag, index) in $store.getters.tagsViewList\"\n           :key=\"tag.fullPath\"\n           :to=\"{ path: tag.fullPath }\"\n         >\n           {{ tag.title }}\n           <i\n             v-show=\"!isActive(tag)\"\n             class=\"el-icon-close\"\n             @click.prevent.stop=\"onCloseClick(index)\"\n           />\n         </router-link>\n     </div>\n   </template>\n   \n   <script setup>\n   import { useRoute } from 'vue-router'\n   const route = useRoute()\n   \n   /**\n    * 是否被选中\n    */\n   const isActive = tag => {\n     return tag.path === route.path\n   }\n   \n   /**\n    * 关闭 tag 的点击事件\n    */\n   const onCloseClick = index => {}\n   </script>\n   \n   <style lang=\"scss\" scoped>\n   .tags-view-container {\n     height: 34px;\n     width: 100%;\n     background: #fff;\n     border-bottom: 1px solid #d8dce5;\n     box-shadow: 0 1px 3px 0 rgba(0, 0, 0, 0.12), 0 0 3px 0 rgba(0, 0, 0, 0.04);\n       .tags-view-item {\n         display: inline-block;\n         position: relative;\n         cursor: pointer;\n         height: 26px;\n         line-height: 26px;\n         border: 1px solid #d8dce5;\n         color: #495060;\n         background: #fff;\n         padding: 0 8px;\n         font-size: 12px;\n         margin-left: 5px;\n         margin-top: 4px;\n         &:first-of-type {\n           margin-left: 15px;\n         }\n         &:last-of-type {\n           margin-right: 15px;\n         }\n         &.active {\n           color: #fff;\n           &::before {\n             content: '';\n             background: #fff;\n             display: inline-block;\n             width: 8px;\n             height: 8px;\n             border-radius: 50%;\n             position: relative;\n             margin-right: 4px;\n           }\n         }\n         // close 按钮\n         .el-icon-close {\n           width: 16px;\n           height: 16px;\n           line-height: 10px;\n           vertical-align: 2px;\n           border-radius: 50%;\n           text-align: center;\n           transition: all 0.3s cubic-bezier(0.645, 0.045, 0.355, 1);\n           transform-origin: 100% 50%;\n           &:before {\n             transform: scale(0.6);\n             display: inline-block;\n             vertical-align: -3px;\n           }\n           &:hover {\n             background-color: #b4bccc;\n             color: #fff;\n           }\n         }\n       \n     }\n   }\n   </style>\n   ```\n   \n3. 在 `layout/index` 中导入\n\n   ```js\n   <div class=\"fixed-header\">\n       <!-- 顶部的 navbar -->\n       <navbar />\n       <!-- tags -->\n       <tags-view></tags-view>\n   </div>\n   \n   import TagsView from '@/components/TagsView'\n   \n   ```\n\n\n\n## tagsView 国际化处理\n\n`tagsView` 的国际化处理可以理解为修改现有 `tags` 的 `title`。\n\n所以我们只需要：\n\n1. 监听到语言变化\n2. 国际化对应的 `title` 即可\n\n根据方案，可生成如下代码：\n\n1. 在 `store/app` 中，创建修改 `ttile` 的 `mutations`\n\n   ```js\n   /**\n   * 为指定的 tag 修改 title\n   */\n   changeTagsView(state, { index, tag }) {\n       state.tagsViewList[index] = tag\n       setItem(TAGS_VIEW, state.tagsViewList)\n   }\n   ```\n\n   \n\n2. 在 `appmain` 中监听语言变化\n\n   ```js\n   import { generateTitle, watchSwitchLang } from '@/utils/i18n'\n   \n   /**\n    * 国际化 tags\n    */\n   watchSwitchLang(() => {\n     store.getters.tagsViewList.forEach((route, index) => {\n       store.commit('app/changeTagsView', {\n         index,\n         tag: {\n           ...route,\n           title: getTitle(route)\n         }\n       })\n     })\n   })\n   ```\n\n   \n\n## contextMenu 展示处理\n\n> [contextMenu](https://developer.mozilla.org/zh-CN/docs/Web/API/Element/contextmenu_event) 为 鼠标右键事件\n\n[contextMenu](https://developer.mozilla.org/zh-CN/docs/Web/API/Element/contextmenu_event) 事件的处理分为两部分：\n\n1. `contextMenu` 的展示\n2. 右键项对应逻辑处理\n\n那么这一小节我们先处理第一部分：`contextMenu` 的展示：\n\n1. 创建 `components/TagsView/ContextMenu` 组件，作为右键展示部分\n\n   ```js\n   <template>\n     <ul class=\"context-menu-container\">\n       <li @click=\"onRefreshClick\">\n         {{ $t('msg.tagsView.refresh') }}\n       </li>\n       <li @click=\"onCloseRightClick\">\n         {{ $t('msg.tagsView.closeRight') }}\n       </li>\n       <li @click=\"onCloseOtherClick\">\n         {{ $t('msg.tagsView.closeOther') }}\n       </li>\n     </ul>\n   </template>\n   \n   <script setup>\n   import { defineProps } from 'vue'\n   defineProps({\n     index: {\n       type: Number,\n       required: true\n     }\n   })\n   \n   const onRefreshClick = () => {}\n   \n   const onCloseRightClick = () => {}\n   \n   const onCloseOtherClick = () => {}\n   </script>\n   \n   <style lang=\"scss\" scoped>\n   .context-menu-container {\n     position: fixed;\n     background: #fff;\n     z-index: 3000;\n     list-style-type: none;\n     padding: 5px 0;\n     border-radius: 4px;\n     font-size: 12px;\n     font-weight: 400;\n     color: #333;\n     box-shadow: 2px 2px 3px 0 rgba(0, 0, 0, 0.3);\n     li {\n       margin: 0;\n       padding: 7px 16px;\n       cursor: pointer;\n       &:hover {\n         background: #eee;\n       }\n     }\n   }\n   </style>\n   \n   ```\n\n2. 在 `tagsview ` 中控制 `contextMenu` 的展示\n\n   ```js\n   <template>\n     <div class=\"tags-view-container\">\n       <el-scrollbar class=\"tags-view-wrapper\">\n         <router-link\n           ...\n           @contextmenu.prevent=\"openMenu($event, index)\"\n         >\n           ...\n       </el-scrollbar>\n       <context-menu\n         v-show=\"visible\"\n         :style=\"menuStyle\"\n         :index=\"selectIndex\"\n       ></context-menu>\n     </div>\n   </template>\n   \n   <script setup>\n   import ContextMenu from './ContextMenu.vue'\n   import { ref, reactive, watch } from 'vue'\n   import { useRoute } from 'vue-router'\n   ...\n   \n   // contextMenu 相关\n   const selectIndex = ref(0)\n   const visible = ref(false)\n   const menuStyle = reactive({\n     left: 0,\n     top: 0\n   })\n   /**\n    * 展示 menu\n    */\n   const openMenu = (e, index) => {\n     const { x, y } = e\n     menuStyle.left = x + 'px'\n     menuStyle.top = y + 'px'\n     selectIndex.value = index\n     visible.value = true\n   }\n   \n   \n   </script>\n   ```\n   \n   \n\n## contextMenu 事件处理\n\n对于 `contextMenu` 的事件一共分为三个：\n\n1. 刷新\n2. 关闭右侧\n3. 关闭所有\n\n但是不要忘记，我们之前 **关闭单个 `tags`** 的事件还没有进行处理，所以这一小节我们一共需要处理 4 个对应的事件\n\n1. 刷新事件\n\n   ```js\n   const router = useRouter()\n   const onRefreshClick = () => {\n     router.go(0)\n   }\n   ```\n\n2. 在 `store/app` 中，创建删除 `tags` 的 `mutations`，该 `mutations` 需要同时具备以下三个能力：\n\n   1. 删除 “右侧”\n   2. 删除 “其他”\n   3. 删除 “当前”\n\n3. 根据以上理论得出以下代码：\n\n  ```js\n  /**\n  * 删除 tag\n  * @param {type: 'other'||'right'||'index', index: index} payload\n  */\n  removeTagsView(state, payload) {\n    if (payload.type === 'index') {\n      state.tagsViewList.splice(payload.index, 1)\n      return\n    } else if (payload.type === 'other') {\n      state.tagsViewList.splice(\n        payload.index + 1,\n        state.tagsViewList.length - payload.index + 1\n      )\n      state.tagsViewList.splice(0, payload.index)\n    } else if (payload.type === 'right') {\n      state.tagsViewList.splice(\n        payload.index + 1,\n        state.tagsViewList.length - payload.index + 1\n      )\n    }\n    setItem(TAGS_VIEW, state.tagsViewList)\n  },\n  ```\n\n4. 关闭右侧事件\n\n   ```js\n   const store = useStore()\n   const onCloseRightClick = () => {\n     store.commit('app/removeTagsView', {\n       type: 'right',\n       index: props.index\n     })\n   }\n   ```\n\n5. 关闭其他\n\n   ```js\n   const onCloseOtherClick = () => {\n     store.commit('app/removeTagsView', {\n       type: 'other',\n       index: props.index\n     })\n   }\n   ```\n\n6. 关闭当前（`tagsview`）\n\n   ```js\n   /**\n    * 关闭 tag 的点击事件\n    */\n   const store = useStore()\n   const onCloseClick = index => {\n     store.commit('app/removeTagsView', {\n       type: 'index',\n       index: index\n     })\n   }\n   ```\n\n   \n\n## 处理 contextMenu 的关闭行为\n\n```js\n/**\n * 关闭 menu\n */\nconst closeMenu = () => {\n  visible.value = false\n}\n\n/**\n * 监听变化\n */\nwatch(visible, val => {\n  if (val) {\n    document.body.addEventListener('click', closeMenu)\n  } else {\n    document.body.removeEventListener('click', closeMenu)\n  }\n})\n```\n\n\n## 处理基于路由的动态过渡\n\n[处理基于路由的动态过渡](https://next.router.vuejs.org/zh/guide/advanced/transitions.html#%E5%9F%BA%E4%BA%8E%E8%B7%AF%E7%94%B1%E7%9A%84%E5%8A%A8%E6%80%81%E8%BF%87%E6%B8%A1)  官方已经给出了示例代码，结合 `router-view` 和 `transition` 我们可以非常方便的实现这个功能\n\n1. 在 `appmain` 中处理对应代码逻辑\n\n   ```js\n   <template>\n     <div class=\"app-main\">\n       <router-view v-slot=\"{ Component, route }\">\n         <transition name=\"fade-transform\" mode=\"out-in\">\n           <keep-alive>\n             <component :is=\"Component\" :key=\"route.path\" />\n           </keep-alive>\n         </transition>\n       </router-view>\n     </div>\n   </template>\n   ```\n\n2. 增加了 `tags` 之后，`app-main` 的位置需要进行以下处理\n\n   ```js\n   <style lang=\"scss\" scoped>\n   .app-main {\n     min-height: calc(100vh - 50px - 43px);\n     ...\n     padding: 104px 20px 20px 20px;\n     ...\n   }\n   </style>\n   ```\n\n3. 在 `styles/transition` 中增加动画渲染\n\n  ```scss\n  /* fade-transform */\n  .fade-transform-leave-active,\n  .fade-transform-enter-active {\n    transition: all 0.5s;\n  }\n  \n  .fade-transform-enter-from {\n    opacity: 0;\n    transform: translateX(-30px);\n  }\n  \n  .fade-transform-leave-to {\n    opacity: 0;\n    transform: translateX(30px);\n  }\n  ```\n\n\n\n## tagsView 方案总结\n\n那么到这里关于 `tagsView` 的内容我们就已经处理完成了。\n\n整个 `tagsView` 就像我们之前说的，拆开来看之后，会显得明确很多。\n\n整个 `tagsView` 整体来看就是三块大的内容：\n\n1. `tags`：`tagsView` 组件\n2. `contextMenu`：`contextMenu` 组件\n3. `view`：`appmain` 组件\n\n再加上一部分的数据处理即可。\n\n最后关于 `tags` 的国际化部分，其实处理的方案有非常多，大家也可以在后面的 **讨论题** 中探讨一下关于 **此处国家化** 的实现，相信会有很多新的思路被打开的。","source":"_posts/vue3-project-generalModule2.md","raw":"---\nlayout: Vue3\ntitle: Vue3项目实战(六)：通用功能开发(二)\ndate: 2023-01-01 14:53:36\ntags: 工程化,Vue3,通用功能\nbanner_img: /img/general2.png\nindex_img: /img/general2.png\nexcerpt: screenfull/headerSearch/tagView/guide\n---\n\n# screenfull\n\n对于 `screenfull ` 和之前一样 ，我们还是先分析它的原理，然后在制定对应的方案实现\n\n**原理：**\n\n对于 `screenfull ` 而言，浏览器本身已经提供了对用的 `API`，[点击这里即可查看](https://developer.mozilla.org/zh-CN/docs/Web/API/Fullscreen_API)，这个 `API` 中，主要提供了两个方法：\n\n1. [`Document.exitFullscreen()`](https://developer.mozilla.org/zh-CN/docs/Web/API/Document/exitFullscreen)：该方法用于请求从全屏模式切换到窗口模式\n2. [`Element.requestFullscreen()`](https://developer.mozilla.org/zh-CN/docs/Web/API/Element/requestFullScreen)：该方法用于请求浏览器（user agent）将特定元素（甚至延伸到它的后代元素）置为全屏模式\n  1. 比如我们可以通过 `document.getElementById('app').requestFullscreen()` 在获取 `id=app` 的 `DOM` 之后，把该区域置为全屏\n\n但是该方法存在一定的小问题，兼容性也不是那么好。\n\n所以通常情况下我们不会直接使用该 `API` 来去实现全屏效果，而是会使用它的包装库 [screenfull](https://www.npmjs.com/package/screenfull)\n\n\n整体的方案实现分为两步：\n\n1. 封装 `screenfull` 组件\n  1. 展示切换按钮\n  2. 基于 [screenfull](https://www.npmjs.com/package/screenfull) 实现切换功能\n2. 在 `navbar` 中引入该组件\n\n明确好了方案之后，接下来我们就落地该方案\n\n**封装 `screenfull` 组件：**\n\n1. 下来依赖包  [screenfull](https://www.npmjs.com/package/screenfull) \n\n```\nnpm i screenfull@5.1.0 -S\n```\n\n2. 创建 `components/Screenfull/index`\n\n```js\n<template>\n  <div>\n    <svg-icon\n      :icon=\"isFullscreen ? 'exit-fullscreen' : 'fullscreen'\"\n      @click=\"onToggle\"\n    />\n  </div>\n</template>\n\n<script setup>\nimport { ref, onMounted, onUnmounted } from 'vue'\nimport screenfull from 'screenfull'\n\n// 是否全屏\nconst isFullscreen = ref(false)\n\n// 切换事件\nconst onToggle = () => {\n  if (screenfull.isEnabled) {\n    screenfull.toggle()\n  }\n}\n\n// 监听变化\nconst change = () => {\n  if (screenfull.isEnabled) {\n    isFullscreen.value = screenfull.isFullscreen\n  }\n}\n\n// 设置侦听器\nonMounted(() => {\n  if (screenfull.isEnabled) {\n    screenfull.on('change', change)\n  }\n})\n\n// 删除侦听器\nonUnmounted(() => {\n  if (screenfull.isEnabled) {\n    screenfull.off('change', change)\n  }\n})\n</script>\n\n<style lang=\"scss\" scoped></style>\n\n```\n\n**在 `navbar` 中引入该组件：**\n\n```\n<screenfull class=\"right-menu-item hover-effect\" />\n\n...\n\nimport Screenfull from '@/components/Screenfull'\n```\n\n# headerSeach\n\n> 所谓 `headerSearch` 一般是指 **页面搜索**\n\n**原理：**\n\n`headerSearch` 是复杂后台系统中非常常见的一个功能，它可以：**在指定搜索框中对当前应用中所有页面进行检索，以 `select` 的形式展示出被检索的页面，以达到快速进入的目的**\n\n那么明确好了 `headerSearch`  的作用之后，接下来我们来看一下对应的实现原理\n\n根据前面的目的我们可以发现，整个 `headerSearch` 其实可以分为三个核心的功能点：\n\n1. 根据指定内容对所有页面进行检索\n2. 以 `select` 形式展示检索出的页面\n3. 通过检索页面可快速进入对应页面\n\n那么围绕着这三个核心的功能点，我们想要分析它的原理就非常简单了：**根据指定内容检索所有页面，把检索出的页面以 `select` 展示，点击对应 `option` 可进入到指定页面**\n\n**方案：**\n\n对照着三个核心功能点和原理，想要指定对应的实现方案是非常简单的一件事情了\n\n1. 创建 `headerSearch` 组件，用作样式展示和用户输入内容获取\n2. 获取所有的页面数据，用作被检索的数据源\n3. 根据用户输入内容在数据源中进行模糊搜索(https://fusejs.io/) \n4. 把搜索到的内容以 `select` 进行展示\n5. 监听 `select` 的 `change` 事件，完成对应跳转\n\n## headerSearch 组件\n\n创建 `components/headerSearch/index` 组件，当点击搜索图标时，通过 `transition` 动画，将其长度展示出来，并且自动聚焦 `focus()`:\n\n```js\n<template>\n  <div :class=\"{ show: isShow }\" class=\"header-search\">\n    <svg-icon\n      class-name=\"search-icon\"\n      icon=\"search\"\n      @click.stop=\"onShowClick\"\n    />\n    <el-select\n      ref=\"headerSearchSelectRef\"\n      class=\"header-search-select\"\n      v-model=\"search\"\n      filterable\n      default-first-option\n      remote\n      placeholder=\"Search\"\n      :remote-method=\"querySearch\"\n      @change=\"onSelectChange\"\n    >\n      <el-option\n        v-for=\"option in 5\"\n        :key=\"option\"\n        :label=\"option\"\n        :value=\"option\"\n      ></el-option>\n    </el-select>\n  </div>\n</template>\n\n<script setup>\nimport { ref } from 'vue'\n\n// 控制 search 显示\nconst isShow = ref(false)\n// el-select 实例\nconst headerSearchSelectRef = ref(null)\nconst onShowClick = () => {\n  isShow.value = !isShow.value\n  headerSearchSelectRef.value.focus()\n}\n\n// search 相关\nconst search = ref('')\n// 搜索方法\nconst querySearch = () => {\n  console.log('querySearch')\n}\n// 选中回调\nconst onSelectChange = () => {\n  console.log('onSelectChange')\n}\n</script>\n\n<style lang=\"scss\" scoped>\n.header-search {\n  font-size: 0 !important;\n  .search-icon {\n    cursor: pointer;\n    font-size: 18px;\n    vertical-align: middle;\n  }\n  .header-search-select {\n    font-size: 18px;\n    transition: width 0.2s; // width 动画\n    width: 0;\n    overflow: hidden;\n    background: transparent;\n    border-radius: 0;\n    display: inline-block;\n    vertical-align: middle;\n\n    ::v-deep .el-input__inner {\n      border-radius: 0;\n      border: 0;\n      padding-left: 0;\n      padding-right: 0;\n      box-shadow: none !important;\n      border-bottom: 1px solid #d9d9d9;\n      vertical-align: middle;\n    }\n  }\n  &.show {\n    .header-search-select {\n      width: 210px;\n      margin-left: 10px;\n    }\n  }\n}\n</style>\n\n```\n\n在 `navbar` 中导入该组件\n\n```js\n<header-search class=\"right-menu-item hover-effect\"></header-search>\n\n...\n\nimport HeaderSearch from '@/components/HeaderSearch/index.vue'\n```\n\n## 获取数据源\n\n在有了 `headerSearch` 之后，接下来就可以来处理对应的 **检索数据源了**\n\n**检索数据源** 表示：**有哪些页面希望检索**\n\n那么对于我们当前的业务而言，我们希望被检索的页面其实就是左侧菜单中的页面，那么我们检索数据源即为：**左侧菜单对应的数据源**\n\n根据以上原理，我们可以得出以下代码：\n\n```js\n<script setup>\nimport { ref, computed } from 'vue'\nimport { filterRouters, generateMenus } from '@/utils/route'\nimport { useRouter } from 'vue-router'\n...\n// 检索数据源\nconst router = useRouter()\nconst searchPool = computed(() => {\n  const filterRoutes = filterRouters(router.getRoutes())\n  console.log(generateMenus(filterRoutes))\n  return generateMenus(filterRoutes)\n})\nconsole.log(searchPool)\n</script>\n```\n\n## 模糊搜索Fuse.js\n> Fuse.js is a powerful, lightweight fuzzy-search library, with zero dependencies.\n\n如果我们想要进行  [模糊搜索](https://fusejs.io/)  的话，那么需要依赖一个第三方的库  [fuse.js](https://fusejs.io/) \n\n它是0️⃣依赖的，专门处理模糊搜索的库。\n\n**Why should I use it?**\n\n- 使用 Fuse.js，您不需要仅仅为了处理搜索而设置专用的后端。\n- 简单性和性能是开发这个库的主要标准。\n\n\n1. 安装 [fuse.js](https://fusejs.io/)\n\n```js\nnpm install --save fuse.js@6.4.6\n```\n\n2. 初始化 `Fuse`，更多初始化配置项 [可点击这里](https://fusejs.io/api/options.html)\n\n```js\nimport Fuse from 'fuse.js'\n\n/**\n* 搜索库相关\n*/\nconst fuse = new Fuse(list, {\n    // 是否按优先级进行排序\n    shouldSort: true,\n    // 匹配长度超过这个值的才会被认为是匹配的\n    minMatchCharLength: 1,\n    // 将被搜索的键列表。 这支持嵌套路径、加权搜索、在字符串和对象数组中搜索。\n    // name：搜索的键\n    // weight：对应的权重\n    // 表示我们将用户输入的值，与 title 和 path 进行匹配\n    keys: [\n      {\n        name: 'title',\n        weight: 0.7\n      },\n      {\n        name: 'path',\n        weight: 0.3\n      }\n    ]\n  })\n```\n\n3. 参考 [Fuse Demo](https://fusejs.io/demo.html) 与 最终效果，可以得出，我们最终期望得到如下的检索数据源结构\n\n```json\n[\n    {\n        \"path\":\"/my\",\n        \"title\":[\n            \"个人中心\"\n        ]\n    },\n    {\n        \"path\":\"/user\",\n        \"title\":[\n            \"用户\"\n        ]\n    },\n    {\n        \"path\":\"/user/manage\",\n        \"title\":[\n            \"用户\",\n            \"用户管理\"\n        ]\n    },\n    {\n        \"path\":\"/user/info\",\n        \"title\":[\n            \"用户\",\n            \"用户信息\"\n        ]\n    },\n    {\n        \"path\":\"/article\",\n        \"title\":[\n            \"文章\"\n        ]\n    },\n    {\n        \"path\":\"/article/ranking\",\n        \"title\":[\n            \"文章\",\n            \"文章排名\"\n        ]\n    },\n    {\n        \"path\":\"/article/create\",\n        \"title\":[\n            \"文章\",\n            \"创建文章\"\n        ]\n    }\n]\n```\n\n4. 所以我们之前处理了的数据源并不符合我们的需要，所以我们需要对数据源进行重新处理\n\n## 数据源重处理，生成 searchPool\n\n我们明确了最终我们期望得到数据源结构，那么接下来我们就对重新计算数据源，生成对应的 `searchPoll`\n\n创建 `components/HeaderSearch/FuseData.js`\n\n```js\nimport path from 'path'\nimport i18n from '@/i18n'\n/**\n * 筛选出可供搜索的路由对象\n * @param routes 路由表\n * @param basePath 基础路径，默认为 /\n * @param prefixTitle 父级title，子集title集合 [文章，文章排名]\n */\nexport const generateRoutes = (routes, basePath = '/', prefixTitle = []) => {\n  // 创建 result 数据\n  let res = []\n  // 循环 routes 路由\n  for (const route of routes) {\n    // 创建包含 path 和 title 的 item\n    const data = {\n      path: path.resolve(basePath, route.path),\n      title: [...prefixTitle]\n    }\n    // 当前存在 meta 时，使用 i18n 解析国际化数据，组合成新的 title 内容\n    // 动态路由不允许被搜索（类似：user/:id 这种）\n    // 匹配动态路由的正则\n    const re = /.*\\/:.*/\n    if (route.meta && route.meta.title && !re.exec(route.path)) {\n      const i18ntitle = i18n.global.t(`msg.route.${route.meta.title}`)\n      data.title = [...data.title, i18ntitle]\n      res.push(data)\n    }\n\n    // 存在 children 时，迭代调用\n    if (route.children) {\n      const tempRoutes = generateRoutes(route.children, data.path, data.title)\n      if (tempRoutes.length >= 1) {\n        res = [...res, ...tempRoutes]\n      }\n    }\n  }\n  return res\n}\n\n```\n\n这样，我们就通过 `generateRoutes` 方法，根据咱们的路由表，生成了符合 `fuse.js` 的数据。\n\n在 `headerSearch` 中导入 `generateRoutes`\n\n```vue\n<script setup>\nimport { computed, ref } from 'vue'\nimport { generateRoutes } from './FuseData'\nimport Fuse from 'fuse.js'\nimport { filterRouters } from '@/utils/route'\nimport { useRouter } from 'vue-router'\n\n...\n\n// 检索数据源\nconst router = useRouter()\nconst searchPool = computed(() => {\n  const filterRoutes = filterRouters(router.getRoutes())\n  return generateRoutes(filterRoutes)\n})\n/**\n * 搜索库相关\n */\nconst fuse = new Fuse(searchPool.value, {\n  ...\n})\n</script>\n```\n\n通过 `querySearch` 测试搜索结果\n\n```js\n// 搜索方法\nconst querySearch = query => {\n  console.log(fuse.search(query))\n}\n```\n\n## 渲染检索数据\n\n数据源处理完成之后，最后我们就只需要完成:\n\n1. 渲染检索出的数据\n2. 完成对应跳转\n\n那么下面我们按照步骤进行实现：\n\n1. 渲染检索出的数据\n\n```js\n<template>\n  <el-option\n      v-for=\"option in searchOptions\"\n      :key=\"option.item.path\"\n      :label=\"option.item.title.join(' > ')\"\n      :value=\"option.item\"\n  ></el-option>\n</template>\n\n<script setup>\n...\n// 搜索结果\nconst searchOptions = ref([])\n// 搜索方法\nconst querySearch = query => {\n  if (query !== '') {\n    searchOptions.value = fuse.search(query)\n  } else {\n    searchOptions.value = []\n  }\n}\n...\n</script>\n\n```\n\n2. 完成对应跳转\n\n```js\nconst onSelectChange = val => {\n  router.push(val.path)\n}\n```\n\n## 剩余问题处理\n\n这里我们的 `headerSearch` 功能基本上就已经处理完成了，但是还存在一些小 `bug` ，那么最后这一小节我们就处理下这些剩余的 `bug`\n\n1. 在 `search` 打开时，点击 `body` 关闭 `search`\n2. 在 `search` 关闭时，清理 `searchOptions`\n3. `headerSearch` 应该具备国际化能力\n\n明确好问题之后，接下来我们进行处理\n\n首先我们先处理前前面两个问题：\n\n```js\n/**\n * 关闭 search 的处理事件\n */\nconst onClose = () => {\n  headerSearchSelectRef.value.blur()\n  isShow.value = false\n  searchOptions.value = []\n}\n/**\n * 监听 search 打开，处理 close 事件\n */\nwatch(isShow, val => {\n  if (val) {\n    document.body.addEventListener('click', onClose)\n  } else {\n    document.body.removeEventListener('click', onClose)\n  }\n})\n```\n\n接下来是国际化的问题，想要处理这个问题非常简单，我们只需要：**监听语言变化，重新计算数据源初始化 `fuse` 即可**\n\n1. 在 `utils/i18n` 下，新建方法 `watchSwitchLang`\n\n```js\nimport { watch } from 'vue'\nimport store from '@/store'\n\ntype IProps = ((lang: string) => void)[]\n\nexport default function watchSwitchLang(...cbs: IProps) {\n  watch(\n    () => store.getters.language,\n    () => {\n      cbs.forEach(cb => cbs.forEach(cb => cb(store.getters.language)))\n    }\n  )\n}\n```\n\n2. 在 `headerSearch` 监听变化，重新赋值\n\n```js\n<script setup>\n...\nimport { watchSwitchLang } from '@/utils/i18n'\n\n...\n\n// 检索数据源\nconst router = useRouter()\nlet searchPool = computed(() => {\n  const filterRoutes = filterRouters(router.getRoutes())\n  return generateRoutes(filterRoutes)\n})\n/**\n* 搜索库相关\n*/\nlet fuse\nconst initFuse = searchPool => {\n  fuse = new Fuse(searchPool, {\n    ...\n}\ninitFuse(searchPool.value)\n\n...\n\n// 处理国际化\nwatchSwitchLang(() => {\n  searchPool = computed(() => {\n    const filterRoutes = filterRouters(router.getRoutes())\n    return generateRoutes(filterRoutes)\n  })\n  initFuse(searchPool.value)\n})\n</script>\n```\n\n## headerSearch 方案总结\n\n那么到这里整个的 `headerSearch` 我们就已经全部处理完成了，整个 `headerSearch` 我们只需要把握住三个核心的关键点\n\n1. 根据指定内容对所有页面进行检索\n2. 以 `select` 形式展示检索出的页面\n3. 通过检索页面可快速进入对应页面\n\n保证大方向没有错误，那么具体的细节处理我们具体分析就可以了。\n\n关于细节的处理，可能比较复杂的地方有两个：\n\n1. 模糊搜索\n2. 检索数据源\n\n对于这两块，我们依赖于 `fuse.js` 进行了实现，大大简化了我们的业务处理流程。\n\n# tagsView 原理及方案分析\n\n所谓 `tagsView` 可以分成两部分来去看：\n\n1. tags\n2. view\n\n好像和废话一样是吧。那怎么分开看呢？\n\n首先我们先来看 `tags`：\n\n所谓 `tgas` 指的是：**位于 `appmain` 之上的标签**\n\n那么现在我们忽略掉 `view`，现在只有一个要求：\n\n> 在 `view` 之上渲染这个 `tag` \n\n仅看这一个要求，很简单吧。\n\n**views：**\n\n明确好了 `tags` 之后，我们来看 `views`。\n\n脱离了 `tags` 只看 `views` 就更简单了，所谓 `views` ：**指的就是一个用来渲染组件的位置**，就像我们之前的 `Appmain` 一样，只不过这里的 `views` 可能稍微复杂一点，因为它需要在渲染的基础上增加：\n\n1. 动画\n2. 缓存\n\n这两个额外的功能。\n\n加上这两个功能之后可能会略显复杂，但是 [官网已经帮助我们处理了这个问题](https://next.router.vuejs.org/zh/guide/advanced/transitions.html#%E5%9F%BA%E4%BA%8E%E8%B7%AF%E7%94%B1%E7%9A%84%E5%8A%A8%E6%80%81%E8%BF%87%E6%B8%A1) \n\n所以 单看 `views` 也是一个很简单的功能。\n\n那么接下来我们需要做的就是把 `tags` 和 `view` 合并起来而已。\n\n那么明确好了原理之后，我们就来看 **实现方案：**\n\n1. 创建 `tagsView` 组件：用来处理 `tags` 的展示\n2. 处理基于路由的动态过渡，在 `AppMain` 中进行：用于处理 `view` 的部分\n\n整个的方案就是这么两大部，但是其中我们还需要处理一些细节相关的，**完整的方案为**：\n\n1. 监听路由变化，组成用于渲染 `tags` 的数据源\n2. 创建 `tags` 组件，根据数据源渲染 `tag`，渲染出来的 `tags` 需要同时具备\n   1. 国际化 `title`\n   2. 路由跳转\n3. 处理鼠标右键效果，根据右键处理对应数据源\n4. 处理基于路由的动态过渡\n\n那么明确好了方案之后，接下来我们根据方案进行处理即可。\n\n## 创建 tags 数据源\n\n`tags` 的数据源分为两部分：\n\n1. 保存数据：`appmain` 组件中进行\n2. 展示数据：`tags` 组件中进行\n\n所以 `tags` 的数据我们最好把它保存到 `vuex` 中。\n\n1. 在 `constant` 中新建常量\n\n   ```js\n   // tags\n   export const TAGS_VIEW = 'tagsView'\n   ```\n\n2. 在 `store/app` 中创建 `tagsViewList`\n\n   ```js\n   import { LANG, TAGS_VIEW } from '@/constant'\n   import { getItem, setItem } from '@/utils/storage'\n   export default {\n     namespaced: true,\n     state: () => ({\n       ...\n       tagsViewList: getItem(TAGS_VIEW) || []\n     }),\n     mutations: {\n       ...\n       /**\n        * 添加 tags\n        */\n       addTagsViewList(state, tag) {\n         const isFind = state.tagsViewList.find(item => {\n           return item.path === tag.path\n         })\n       // 处理重复\n         if (!isFind) {\n           state.tagsViewList.push(tag)\n           setItem(TAGS_VIEW, state.tagsViewList)\n         }\n       }\n     },\n     actions: {}\n   }\n   \n   ```\n\n3. 在 `appmain` 中监听路由的变化\n\n   ```js\n   <script setup>\n   import { watch } from 'vue'\n   import { isTags } from '@/utils/tags'\n   import { generateTitle } from '@/utils/i18n'\n   import { useRoute } from 'vue-router'\n   import { useStore } from 'vuex'\n   \n   const route = useRoute()\n   \n   /**\n    * 生成 title\n    */\n   const getTitle = route => {\n     let title = ''\n     if (!route.meta) {\n       // 处理无 meta 的路由\n       const pathArr = route.path.split('/')\n       title = pathArr[pathArr.length - 1]\n     } else {\n       title = generateTitle(route.meta.title)\n     }\n     return title\n   }\n   \n   /**\n    * 监听路由变化\n    */\n   const store = useStore()\n   watch(\n     route,\n     (to, from) => {\n       if (!isTags(to.path)) return\n       const { fullPath, meta, name, params, path, query } = to\n       store.commit('app/addTagsViewList', {\n         fullPath,\n         meta,\n         name,\n         params,\n         path,\n         query,\n         title: getTitle(to)\n       })\n     },\n     {\n       immediate: true\n     }\n   )\n   </script>\n   \n   \n   ```\n\n4. 创建 `utils/tags`\n\n   ```js\n   const whiteList = ['/login', '/import', '/404', '/401']\n   \n   /**\n    * path 是否需要被缓存\n    * @param {*} path\n    * @returns\n    */\n   export function isTags(path) {\n     return !whiteList.includes(path)\n   }\n   \n   ```\n\n   \n\n## 生成 tagsView\n\n目前数据已经被保存到 `store` 中，那么接下来我们就依赖数据渲染 `tags`\n\n1. 创建 `store/app` 中 `tagsViewList` 的快捷访问\n\n   ```js\n     tagsViewList: state => state.app.tagsViewList\n   ```\n\n2. 创建 `components/tagsview`\n\n   ```js\n   <template>\n     <div class=\"tags-view-container\">\n         <router-link\n           class=\"tags-view-item\"\n           :class=\"isActive(tag) ? 'active' : ''\"\n           :style=\"{\n             backgroundColor: isActive(tag) ? $store.getters.cssVar.menuBg : '',\n             borderColor: isActive(tag) ? $store.getters.cssVar.menuBg : ''\n           }\"\n           v-for=\"(tag, index) in $store.getters.tagsViewList\"\n           :key=\"tag.fullPath\"\n           :to=\"{ path: tag.fullPath }\"\n         >\n           {{ tag.title }}\n           <i\n             v-show=\"!isActive(tag)\"\n             class=\"el-icon-close\"\n             @click.prevent.stop=\"onCloseClick(index)\"\n           />\n         </router-link>\n     </div>\n   </template>\n   \n   <script setup>\n   import { useRoute } from 'vue-router'\n   const route = useRoute()\n   \n   /**\n    * 是否被选中\n    */\n   const isActive = tag => {\n     return tag.path === route.path\n   }\n   \n   /**\n    * 关闭 tag 的点击事件\n    */\n   const onCloseClick = index => {}\n   </script>\n   \n   <style lang=\"scss\" scoped>\n   .tags-view-container {\n     height: 34px;\n     width: 100%;\n     background: #fff;\n     border-bottom: 1px solid #d8dce5;\n     box-shadow: 0 1px 3px 0 rgba(0, 0, 0, 0.12), 0 0 3px 0 rgba(0, 0, 0, 0.04);\n       .tags-view-item {\n         display: inline-block;\n         position: relative;\n         cursor: pointer;\n         height: 26px;\n         line-height: 26px;\n         border: 1px solid #d8dce5;\n         color: #495060;\n         background: #fff;\n         padding: 0 8px;\n         font-size: 12px;\n         margin-left: 5px;\n         margin-top: 4px;\n         &:first-of-type {\n           margin-left: 15px;\n         }\n         &:last-of-type {\n           margin-right: 15px;\n         }\n         &.active {\n           color: #fff;\n           &::before {\n             content: '';\n             background: #fff;\n             display: inline-block;\n             width: 8px;\n             height: 8px;\n             border-radius: 50%;\n             position: relative;\n             margin-right: 4px;\n           }\n         }\n         // close 按钮\n         .el-icon-close {\n           width: 16px;\n           height: 16px;\n           line-height: 10px;\n           vertical-align: 2px;\n           border-radius: 50%;\n           text-align: center;\n           transition: all 0.3s cubic-bezier(0.645, 0.045, 0.355, 1);\n           transform-origin: 100% 50%;\n           &:before {\n             transform: scale(0.6);\n             display: inline-block;\n             vertical-align: -3px;\n           }\n           &:hover {\n             background-color: #b4bccc;\n             color: #fff;\n           }\n         }\n       \n     }\n   }\n   </style>\n   ```\n   \n3. 在 `layout/index` 中导入\n\n   ```js\n   <div class=\"fixed-header\">\n       <!-- 顶部的 navbar -->\n       <navbar />\n       <!-- tags -->\n       <tags-view></tags-view>\n   </div>\n   \n   import TagsView from '@/components/TagsView'\n   \n   ```\n\n\n\n## tagsView 国际化处理\n\n`tagsView` 的国际化处理可以理解为修改现有 `tags` 的 `title`。\n\n所以我们只需要：\n\n1. 监听到语言变化\n2. 国际化对应的 `title` 即可\n\n根据方案，可生成如下代码：\n\n1. 在 `store/app` 中，创建修改 `ttile` 的 `mutations`\n\n   ```js\n   /**\n   * 为指定的 tag 修改 title\n   */\n   changeTagsView(state, { index, tag }) {\n       state.tagsViewList[index] = tag\n       setItem(TAGS_VIEW, state.tagsViewList)\n   }\n   ```\n\n   \n\n2. 在 `appmain` 中监听语言变化\n\n   ```js\n   import { generateTitle, watchSwitchLang } from '@/utils/i18n'\n   \n   /**\n    * 国际化 tags\n    */\n   watchSwitchLang(() => {\n     store.getters.tagsViewList.forEach((route, index) => {\n       store.commit('app/changeTagsView', {\n         index,\n         tag: {\n           ...route,\n           title: getTitle(route)\n         }\n       })\n     })\n   })\n   ```\n\n   \n\n## contextMenu 展示处理\n\n> [contextMenu](https://developer.mozilla.org/zh-CN/docs/Web/API/Element/contextmenu_event) 为 鼠标右键事件\n\n[contextMenu](https://developer.mozilla.org/zh-CN/docs/Web/API/Element/contextmenu_event) 事件的处理分为两部分：\n\n1. `contextMenu` 的展示\n2. 右键项对应逻辑处理\n\n那么这一小节我们先处理第一部分：`contextMenu` 的展示：\n\n1. 创建 `components/TagsView/ContextMenu` 组件，作为右键展示部分\n\n   ```js\n   <template>\n     <ul class=\"context-menu-container\">\n       <li @click=\"onRefreshClick\">\n         {{ $t('msg.tagsView.refresh') }}\n       </li>\n       <li @click=\"onCloseRightClick\">\n         {{ $t('msg.tagsView.closeRight') }}\n       </li>\n       <li @click=\"onCloseOtherClick\">\n         {{ $t('msg.tagsView.closeOther') }}\n       </li>\n     </ul>\n   </template>\n   \n   <script setup>\n   import { defineProps } from 'vue'\n   defineProps({\n     index: {\n       type: Number,\n       required: true\n     }\n   })\n   \n   const onRefreshClick = () => {}\n   \n   const onCloseRightClick = () => {}\n   \n   const onCloseOtherClick = () => {}\n   </script>\n   \n   <style lang=\"scss\" scoped>\n   .context-menu-container {\n     position: fixed;\n     background: #fff;\n     z-index: 3000;\n     list-style-type: none;\n     padding: 5px 0;\n     border-radius: 4px;\n     font-size: 12px;\n     font-weight: 400;\n     color: #333;\n     box-shadow: 2px 2px 3px 0 rgba(0, 0, 0, 0.3);\n     li {\n       margin: 0;\n       padding: 7px 16px;\n       cursor: pointer;\n       &:hover {\n         background: #eee;\n       }\n     }\n   }\n   </style>\n   \n   ```\n\n2. 在 `tagsview ` 中控制 `contextMenu` 的展示\n\n   ```js\n   <template>\n     <div class=\"tags-view-container\">\n       <el-scrollbar class=\"tags-view-wrapper\">\n         <router-link\n           ...\n           @contextmenu.prevent=\"openMenu($event, index)\"\n         >\n           ...\n       </el-scrollbar>\n       <context-menu\n         v-show=\"visible\"\n         :style=\"menuStyle\"\n         :index=\"selectIndex\"\n       ></context-menu>\n     </div>\n   </template>\n   \n   <script setup>\n   import ContextMenu from './ContextMenu.vue'\n   import { ref, reactive, watch } from 'vue'\n   import { useRoute } from 'vue-router'\n   ...\n   \n   // contextMenu 相关\n   const selectIndex = ref(0)\n   const visible = ref(false)\n   const menuStyle = reactive({\n     left: 0,\n     top: 0\n   })\n   /**\n    * 展示 menu\n    */\n   const openMenu = (e, index) => {\n     const { x, y } = e\n     menuStyle.left = x + 'px'\n     menuStyle.top = y + 'px'\n     selectIndex.value = index\n     visible.value = true\n   }\n   \n   \n   </script>\n   ```\n   \n   \n\n## contextMenu 事件处理\n\n对于 `contextMenu` 的事件一共分为三个：\n\n1. 刷新\n2. 关闭右侧\n3. 关闭所有\n\n但是不要忘记，我们之前 **关闭单个 `tags`** 的事件还没有进行处理，所以这一小节我们一共需要处理 4 个对应的事件\n\n1. 刷新事件\n\n   ```js\n   const router = useRouter()\n   const onRefreshClick = () => {\n     router.go(0)\n   }\n   ```\n\n2. 在 `store/app` 中，创建删除 `tags` 的 `mutations`，该 `mutations` 需要同时具备以下三个能力：\n\n   1. 删除 “右侧”\n   2. 删除 “其他”\n   3. 删除 “当前”\n\n3. 根据以上理论得出以下代码：\n\n  ```js\n  /**\n  * 删除 tag\n  * @param {type: 'other'||'right'||'index', index: index} payload\n  */\n  removeTagsView(state, payload) {\n    if (payload.type === 'index') {\n      state.tagsViewList.splice(payload.index, 1)\n      return\n    } else if (payload.type === 'other') {\n      state.tagsViewList.splice(\n        payload.index + 1,\n        state.tagsViewList.length - payload.index + 1\n      )\n      state.tagsViewList.splice(0, payload.index)\n    } else if (payload.type === 'right') {\n      state.tagsViewList.splice(\n        payload.index + 1,\n        state.tagsViewList.length - payload.index + 1\n      )\n    }\n    setItem(TAGS_VIEW, state.tagsViewList)\n  },\n  ```\n\n4. 关闭右侧事件\n\n   ```js\n   const store = useStore()\n   const onCloseRightClick = () => {\n     store.commit('app/removeTagsView', {\n       type: 'right',\n       index: props.index\n     })\n   }\n   ```\n\n5. 关闭其他\n\n   ```js\n   const onCloseOtherClick = () => {\n     store.commit('app/removeTagsView', {\n       type: 'other',\n       index: props.index\n     })\n   }\n   ```\n\n6. 关闭当前（`tagsview`）\n\n   ```js\n   /**\n    * 关闭 tag 的点击事件\n    */\n   const store = useStore()\n   const onCloseClick = index => {\n     store.commit('app/removeTagsView', {\n       type: 'index',\n       index: index\n     })\n   }\n   ```\n\n   \n\n## 处理 contextMenu 的关闭行为\n\n```js\n/**\n * 关闭 menu\n */\nconst closeMenu = () => {\n  visible.value = false\n}\n\n/**\n * 监听变化\n */\nwatch(visible, val => {\n  if (val) {\n    document.body.addEventListener('click', closeMenu)\n  } else {\n    document.body.removeEventListener('click', closeMenu)\n  }\n})\n```\n\n\n## 处理基于路由的动态过渡\n\n[处理基于路由的动态过渡](https://next.router.vuejs.org/zh/guide/advanced/transitions.html#%E5%9F%BA%E4%BA%8E%E8%B7%AF%E7%94%B1%E7%9A%84%E5%8A%A8%E6%80%81%E8%BF%87%E6%B8%A1)  官方已经给出了示例代码，结合 `router-view` 和 `transition` 我们可以非常方便的实现这个功能\n\n1. 在 `appmain` 中处理对应代码逻辑\n\n   ```js\n   <template>\n     <div class=\"app-main\">\n       <router-view v-slot=\"{ Component, route }\">\n         <transition name=\"fade-transform\" mode=\"out-in\">\n           <keep-alive>\n             <component :is=\"Component\" :key=\"route.path\" />\n           </keep-alive>\n         </transition>\n       </router-view>\n     </div>\n   </template>\n   ```\n\n2. 增加了 `tags` 之后，`app-main` 的位置需要进行以下处理\n\n   ```js\n   <style lang=\"scss\" scoped>\n   .app-main {\n     min-height: calc(100vh - 50px - 43px);\n     ...\n     padding: 104px 20px 20px 20px;\n     ...\n   }\n   </style>\n   ```\n\n3. 在 `styles/transition` 中增加动画渲染\n\n  ```scss\n  /* fade-transform */\n  .fade-transform-leave-active,\n  .fade-transform-enter-active {\n    transition: all 0.5s;\n  }\n  \n  .fade-transform-enter-from {\n    opacity: 0;\n    transform: translateX(-30px);\n  }\n  \n  .fade-transform-leave-to {\n    opacity: 0;\n    transform: translateX(30px);\n  }\n  ```\n\n\n\n## tagsView 方案总结\n\n那么到这里关于 `tagsView` 的内容我们就已经处理完成了。\n\n整个 `tagsView` 就像我们之前说的，拆开来看之后，会显得明确很多。\n\n整个 `tagsView` 整体来看就是三块大的内容：\n\n1. `tags`：`tagsView` 组件\n2. `contextMenu`：`contextMenu` 组件\n3. `view`：`appmain` 组件\n\n再加上一部分的数据处理即可。\n\n最后关于 `tags` 的国际化部分，其实处理的方案有非常多，大家也可以在后面的 **讨论题** 中探讨一下关于 **此处国家化** 的实现，相信会有很多新的思路被打开的。","slug":"vue3-project-generalModule2","published":1,"updated":"2023-05-12T10:49:20.016Z","comments":1,"photos":[],"link":"","_id":"clhkizgya002z3y0qg7fp3obv","content":"<h1 id=\"screenfull\"><a href=\"#screenfull\" class=\"headerlink\" title=\"screenfull\"></a>screenfull</h1><p>对于 <code>screenfull</code> 和之前一样 ，我们还是先分析它的原理，然后在制定对应的方案实现</p>\n<p><strong>原理：</strong></p>\n<p>对于 <code>screenfull</code> 而言，浏览器本身已经提供了对用的 <code>API</code>，<a href=\"https://developer.mozilla.org/zh-CN/docs/Web/API/Fullscreen_API\">点击这里即可查看</a>，这个 <code>API</code> 中，主要提供了两个方法：</p>\n<ol>\n<li><a href=\"https://developer.mozilla.org/zh-CN/docs/Web/API/Document/exitFullscreen\"><code>Document.exitFullscreen()</code></a>：该方法用于请求从全屏模式切换到窗口模式</li>\n<li><a href=\"https://developer.mozilla.org/zh-CN/docs/Web/API/Element/requestFullScreen\"><code>Element.requestFullscreen()</code></a>：该方法用于请求浏览器（user agent）将特定元素（甚至延伸到它的后代元素）置为全屏模式<ol>\n<li>比如我们可以通过 <code>document.getElementById(&#39;app&#39;).requestFullscreen()</code> 在获取 <code>id=app</code> 的 <code>DOM</code> 之后，把该区域置为全屏</li>\n</ol>\n</li>\n</ol>\n<p>但是该方法存在一定的小问题，兼容性也不是那么好。</p>\n<p>所以通常情况下我们不会直接使用该 <code>API</code> 来去实现全屏效果，而是会使用它的包装库 <a href=\"https://www.npmjs.com/package/screenfull\">screenfull</a></p>\n<p>整体的方案实现分为两步：</p>\n<ol>\n<li>封装 <code>screenfull</code> 组件<ol>\n<li>展示切换按钮</li>\n<li>基于 <a href=\"https://www.npmjs.com/package/screenfull\">screenfull</a> 实现切换功能</li>\n</ol>\n</li>\n<li>在 <code>navbar</code> 中引入该组件</li>\n</ol>\n<p>明确好了方案之后，接下来我们就落地该方案</p>\n<p><strong>封装 <code>screenfull</code> 组件：</strong></p>\n<ol>\n<li>下来依赖包  <a href=\"https://www.npmjs.com/package/screenfull\">screenfull</a> </li>\n</ol>\n<figure class=\"highlight apache\"><table><tr><td class=\"gutter\"><div class=\"code-wrapper\"><pre><span class=\"line\">1</span><br></pre></div></td><td class=\"code\"><pre><code class=\"hljs apache\"><span class=\"hljs-attribute\">npm</span> i screenfull@<span class=\"hljs-number\">5</span>.<span class=\"hljs-number\">1</span>.<span class=\"hljs-number\">0</span> -S<br></code></pre></td></tr></table></figure>\n\n<ol start=\"2\">\n<li>创建 <code>components/Screenfull/index</code></li>\n</ol>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\">&lt;template&gt;<br>  <span class=\"language-xml\"><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">div</span>&gt;</span></span><br><span class=\"language-xml\">    <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">svg-icon</span></span></span><br><span class=\"hljs-tag\"><span class=\"language-xml\">      <span class=\"hljs-attr\">:icon</span>=<span class=\"hljs-string\">&quot;isFullscreen ? &#x27;exit-fullscreen&#x27; : &#x27;fullscreen&#x27;&quot;</span></span></span><br><span class=\"hljs-tag\"><span class=\"language-xml\">      @<span class=\"hljs-attr\">click</span>=<span class=\"hljs-string\">&quot;onToggle&quot;</span></span></span><br><span class=\"hljs-tag\"><span class=\"language-xml\">    /&gt;</span></span><br><span class=\"language-xml\">  <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">div</span>&gt;</span></span><br>&lt;/template&gt;<br><br><span class=\"language-xml\"><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">script</span> <span class=\"hljs-attr\">setup</span>&gt;</span><span class=\"language-javascript\"></span></span><br><span class=\"language-javascript\"><span class=\"language-xml\"><span class=\"hljs-keyword\">import</span> &#123; ref, onMounted, onUnmounted &#125; <span class=\"hljs-keyword\">from</span> <span class=\"hljs-string\">&#x27;vue&#x27;</span></span></span><br><span class=\"language-javascript\"><span class=\"language-xml\"><span class=\"hljs-keyword\">import</span> screenfull <span class=\"hljs-keyword\">from</span> <span class=\"hljs-string\">&#x27;screenfull&#x27;</span></span></span><br><span class=\"language-javascript\"><span class=\"language-xml\"></span></span><br><span class=\"language-javascript\"><span class=\"language-xml\"><span class=\"hljs-comment\">// 是否全屏</span></span></span><br><span class=\"language-javascript\"><span class=\"language-xml\"><span class=\"hljs-keyword\">const</span> isFullscreen = <span class=\"hljs-title function_\">ref</span>(<span class=\"hljs-literal\">false</span>)</span></span><br><span class=\"language-javascript\"><span class=\"language-xml\"></span></span><br><span class=\"language-javascript\"><span class=\"language-xml\"><span class=\"hljs-comment\">// 切换事件</span></span></span><br><span class=\"language-javascript\"><span class=\"language-xml\"><span class=\"hljs-keyword\">const</span> <span class=\"hljs-title function_\">onToggle</span> = (<span class=\"hljs-params\"></span>) =&gt; &#123;</span></span><br><span class=\"language-javascript\"><span class=\"language-xml\">  <span class=\"hljs-keyword\">if</span> (screenfull.<span class=\"hljs-property\">isEnabled</span>) &#123;</span></span><br><span class=\"language-javascript\"><span class=\"language-xml\">    screenfull.<span class=\"hljs-title function_\">toggle</span>()</span></span><br><span class=\"language-javascript\"><span class=\"language-xml\">  &#125;</span></span><br><span class=\"language-javascript\"><span class=\"language-xml\">&#125;</span></span><br><span class=\"language-javascript\"><span class=\"language-xml\"></span></span><br><span class=\"language-javascript\"><span class=\"language-xml\"><span class=\"hljs-comment\">// 监听变化</span></span></span><br><span class=\"language-javascript\"><span class=\"language-xml\"><span class=\"hljs-keyword\">const</span> <span class=\"hljs-title function_\">change</span> = (<span class=\"hljs-params\"></span>) =&gt; &#123;</span></span><br><span class=\"language-javascript\"><span class=\"language-xml\">  <span class=\"hljs-keyword\">if</span> (screenfull.<span class=\"hljs-property\">isEnabled</span>) &#123;</span></span><br><span class=\"language-javascript\"><span class=\"language-xml\">    isFullscreen.<span class=\"hljs-property\">value</span> = screenfull.<span class=\"hljs-property\">isFullscreen</span></span></span><br><span class=\"language-javascript\"><span class=\"language-xml\">  &#125;</span></span><br><span class=\"language-javascript\"><span class=\"language-xml\">&#125;</span></span><br><span class=\"language-javascript\"><span class=\"language-xml\"></span></span><br><span class=\"language-javascript\"><span class=\"language-xml\"><span class=\"hljs-comment\">// 设置侦听器</span></span></span><br><span class=\"language-javascript\"><span class=\"language-xml\"><span class=\"hljs-title function_\">onMounted</span>(<span class=\"hljs-function\">() =&gt;</span> &#123;</span></span><br><span class=\"language-javascript\"><span class=\"language-xml\">  <span class=\"hljs-keyword\">if</span> (screenfull.<span class=\"hljs-property\">isEnabled</span>) &#123;</span></span><br><span class=\"language-javascript\"><span class=\"language-xml\">    screenfull.<span class=\"hljs-title function_\">on</span>(<span class=\"hljs-string\">&#x27;change&#x27;</span>, change)</span></span><br><span class=\"language-javascript\"><span class=\"language-xml\">  &#125;</span></span><br><span class=\"language-javascript\"><span class=\"language-xml\">&#125;)</span></span><br><span class=\"language-javascript\"><span class=\"language-xml\"></span></span><br><span class=\"language-javascript\"><span class=\"language-xml\"><span class=\"hljs-comment\">// 删除侦听器</span></span></span><br><span class=\"language-javascript\"><span class=\"language-xml\"><span class=\"hljs-title function_\">onUnmounted</span>(<span class=\"hljs-function\">() =&gt;</span> &#123;</span></span><br><span class=\"language-javascript\"><span class=\"language-xml\">  <span class=\"hljs-keyword\">if</span> (screenfull.<span class=\"hljs-property\">isEnabled</span>) &#123;</span></span><br><span class=\"language-javascript\"><span class=\"language-xml\">    screenfull.<span class=\"hljs-title function_\">off</span>(<span class=\"hljs-string\">&#x27;change&#x27;</span>, change)</span></span><br><span class=\"language-javascript\"><span class=\"language-xml\">  &#125;</span></span><br><span class=\"language-javascript\"><span class=\"language-xml\">&#125;)</span></span><br><span class=\"language-javascript\"><span class=\"language-xml\"></span><span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">script</span>&gt;</span></span><br><br><span class=\"language-xml\"><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">style</span> <span class=\"hljs-attr\">lang</span>=<span class=\"hljs-string\">&quot;scss&quot;</span> <span class=\"hljs-attr\">scoped</span>&gt;</span><span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">style</span>&gt;</span></span><br><br></code></pre></td></tr></table></figure>\n\n<p><strong>在 <code>navbar</code> 中引入该组件：</strong></p>\n<figure class=\"highlight clean\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs clean\">&lt;screenfull <span class=\"hljs-keyword\">class</span>=<span class=\"hljs-string\">&quot;right-menu-item hover-effect&quot;</span> /&gt;<br><br>...<br><br><span class=\"hljs-keyword\">import</span> Screenfull <span class=\"hljs-keyword\">from</span> <span class=\"hljs-string\">&#x27;@/components/Screenfull&#x27;</span><br></code></pre></td></tr></table></figure>\n\n<h1 id=\"headerSeach\"><a href=\"#headerSeach\" class=\"headerlink\" title=\"headerSeach\"></a>headerSeach</h1><blockquote>\n<p>所谓 <code>headerSearch</code> 一般是指 <strong>页面搜索</strong></p>\n</blockquote>\n<p><strong>原理：</strong></p>\n<p><code>headerSearch</code> 是复杂后台系统中非常常见的一个功能，它可以：<strong>在指定搜索框中对当前应用中所有页面进行检索，以 <code>select</code> 的形式展示出被检索的页面，以达到快速进入的目的</strong></p>\n<p>那么明确好了 <code>headerSearch</code>  的作用之后，接下来我们来看一下对应的实现原理</p>\n<p>根据前面的目的我们可以发现，整个 <code>headerSearch</code> 其实可以分为三个核心的功能点：</p>\n<ol>\n<li>根据指定内容对所有页面进行检索</li>\n<li>以 <code>select</code> 形式展示检索出的页面</li>\n<li>通过检索页面可快速进入对应页面</li>\n</ol>\n<p>那么围绕着这三个核心的功能点，我们想要分析它的原理就非常简单了：<strong>根据指定内容检索所有页面，把检索出的页面以 <code>select</code> 展示，点击对应 <code>option</code> 可进入到指定页面</strong></p>\n<p><strong>方案：</strong></p>\n<p>对照着三个核心功能点和原理，想要指定对应的实现方案是非常简单的一件事情了</p>\n<ol>\n<li>创建 <code>headerSearch</code> 组件，用作样式展示和用户输入内容获取</li>\n<li>获取所有的页面数据，用作被检索的数据源</li>\n<li>根据用户输入内容在数据源中进行模糊搜索(<a href=\"https://fusejs.io/\">https://fusejs.io/</a>) </li>\n<li>把搜索到的内容以 <code>select</code> 进行展示</li>\n<li>监听 <code>select</code> 的 <code>change</code> 事件，完成对应跳转</li>\n</ol>\n<h2 id=\"headerSearch-组件\"><a href=\"#headerSearch-组件\" class=\"headerlink\" title=\"headerSearch 组件\"></a>headerSearch 组件</h2><p>创建 <code>components/headerSearch/index</code> 组件，当点击搜索图标时，通过 <code>transition</code> 动画，将其长度展示出来，并且自动聚焦 <code>focus()</code>:</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\">&lt;template&gt;<br>  <span class=\"language-xml\"><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">div</span> <span class=\"hljs-attr\">:class</span>=<span class=\"hljs-string\">&quot;&#123; show: isShow &#125;&quot;</span> <span class=\"hljs-attr\">class</span>=<span class=\"hljs-string\">&quot;header-search&quot;</span>&gt;</span></span><br><span class=\"language-xml\">    <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">svg-icon</span></span></span><br><span class=\"hljs-tag\"><span class=\"language-xml\">      <span class=\"hljs-attr\">class-name</span>=<span class=\"hljs-string\">&quot;search-icon&quot;</span></span></span><br><span class=\"hljs-tag\"><span class=\"language-xml\">      <span class=\"hljs-attr\">icon</span>=<span class=\"hljs-string\">&quot;search&quot;</span></span></span><br><span class=\"hljs-tag\"><span class=\"language-xml\">      @<span class=\"hljs-attr\">click.stop</span>=<span class=\"hljs-string\">&quot;onShowClick&quot;</span></span></span><br><span class=\"hljs-tag\"><span class=\"language-xml\">    /&gt;</span></span><br><span class=\"language-xml\">    <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">el-select</span></span></span><br><span class=\"hljs-tag\"><span class=\"language-xml\">      <span class=\"hljs-attr\">ref</span>=<span class=\"hljs-string\">&quot;headerSearchSelectRef&quot;</span></span></span><br><span class=\"hljs-tag\"><span class=\"language-xml\">      <span class=\"hljs-attr\">class</span>=<span class=\"hljs-string\">&quot;header-search-select&quot;</span></span></span><br><span class=\"hljs-tag\"><span class=\"language-xml\">      <span class=\"hljs-attr\">v-model</span>=<span class=\"hljs-string\">&quot;search&quot;</span></span></span><br><span class=\"hljs-tag\"><span class=\"language-xml\">      <span class=\"hljs-attr\">filterable</span></span></span><br><span class=\"hljs-tag\"><span class=\"language-xml\">      <span class=\"hljs-attr\">default-first-option</span></span></span><br><span class=\"hljs-tag\"><span class=\"language-xml\">      <span class=\"hljs-attr\">remote</span></span></span><br><span class=\"hljs-tag\"><span class=\"language-xml\">      <span class=\"hljs-attr\">placeholder</span>=<span class=\"hljs-string\">&quot;Search&quot;</span></span></span><br><span class=\"hljs-tag\"><span class=\"language-xml\">      <span class=\"hljs-attr\">:remote-method</span>=<span class=\"hljs-string\">&quot;querySearch&quot;</span></span></span><br><span class=\"hljs-tag\"><span class=\"language-xml\">      @<span class=\"hljs-attr\">change</span>=<span class=\"hljs-string\">&quot;onSelectChange&quot;</span></span></span><br><span class=\"hljs-tag\"><span class=\"language-xml\">    &gt;</span></span><br><span class=\"language-xml\">      <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">el-option</span></span></span><br><span class=\"hljs-tag\"><span class=\"language-xml\">        <span class=\"hljs-attr\">v-for</span>=<span class=\"hljs-string\">&quot;option in 5&quot;</span></span></span><br><span class=\"hljs-tag\"><span class=\"language-xml\">        <span class=\"hljs-attr\">:key</span>=<span class=\"hljs-string\">&quot;option&quot;</span></span></span><br><span class=\"hljs-tag\"><span class=\"language-xml\">        <span class=\"hljs-attr\">:label</span>=<span class=\"hljs-string\">&quot;option&quot;</span></span></span><br><span class=\"hljs-tag\"><span class=\"language-xml\">        <span class=\"hljs-attr\">:value</span>=<span class=\"hljs-string\">&quot;option&quot;</span></span></span><br><span class=\"hljs-tag\"><span class=\"language-xml\">      &gt;</span><span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">el-option</span>&gt;</span></span><br><span class=\"language-xml\">    <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">el-select</span>&gt;</span></span><br><span class=\"language-xml\">  <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">div</span>&gt;</span></span><br>&lt;/template&gt;<br><br><span class=\"language-xml\"><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">script</span> <span class=\"hljs-attr\">setup</span>&gt;</span><span class=\"language-javascript\"></span></span><br><span class=\"language-javascript\"><span class=\"language-xml\"><span class=\"hljs-keyword\">import</span> &#123; ref &#125; <span class=\"hljs-keyword\">from</span> <span class=\"hljs-string\">&#x27;vue&#x27;</span></span></span><br><span class=\"language-javascript\"><span class=\"language-xml\"></span></span><br><span class=\"language-javascript\"><span class=\"language-xml\"><span class=\"hljs-comment\">// 控制 search 显示</span></span></span><br><span class=\"language-javascript\"><span class=\"language-xml\"><span class=\"hljs-keyword\">const</span> isShow = <span class=\"hljs-title function_\">ref</span>(<span class=\"hljs-literal\">false</span>)</span></span><br><span class=\"language-javascript\"><span class=\"language-xml\"><span class=\"hljs-comment\">// el-select 实例</span></span></span><br><span class=\"language-javascript\"><span class=\"language-xml\"><span class=\"hljs-keyword\">const</span> headerSearchSelectRef = <span class=\"hljs-title function_\">ref</span>(<span class=\"hljs-literal\">null</span>)</span></span><br><span class=\"language-javascript\"><span class=\"language-xml\"><span class=\"hljs-keyword\">const</span> <span class=\"hljs-title function_\">onShowClick</span> = (<span class=\"hljs-params\"></span>) =&gt; &#123;</span></span><br><span class=\"language-javascript\"><span class=\"language-xml\">  isShow.<span class=\"hljs-property\">value</span> = !isShow.<span class=\"hljs-property\">value</span></span></span><br><span class=\"language-javascript\"><span class=\"language-xml\">  headerSearchSelectRef.<span class=\"hljs-property\">value</span>.<span class=\"hljs-title function_\">focus</span>()</span></span><br><span class=\"language-javascript\"><span class=\"language-xml\">&#125;</span></span><br><span class=\"language-javascript\"><span class=\"language-xml\"></span></span><br><span class=\"language-javascript\"><span class=\"language-xml\"><span class=\"hljs-comment\">// search 相关</span></span></span><br><span class=\"language-javascript\"><span class=\"language-xml\"><span class=\"hljs-keyword\">const</span> search = <span class=\"hljs-title function_\">ref</span>(<span class=\"hljs-string\">&#x27;&#x27;</span>)</span></span><br><span class=\"language-javascript\"><span class=\"language-xml\"><span class=\"hljs-comment\">// 搜索方法</span></span></span><br><span class=\"language-javascript\"><span class=\"language-xml\"><span class=\"hljs-keyword\">const</span> <span class=\"hljs-title function_\">querySearch</span> = (<span class=\"hljs-params\"></span>) =&gt; &#123;</span></span><br><span class=\"language-javascript\"><span class=\"language-xml\">  <span class=\"hljs-variable language_\">console</span>.<span class=\"hljs-title function_\">log</span>(<span class=\"hljs-string\">&#x27;querySearch&#x27;</span>)</span></span><br><span class=\"language-javascript\"><span class=\"language-xml\">&#125;</span></span><br><span class=\"language-javascript\"><span class=\"language-xml\"><span class=\"hljs-comment\">// 选中回调</span></span></span><br><span class=\"language-javascript\"><span class=\"language-xml\"><span class=\"hljs-keyword\">const</span> <span class=\"hljs-title function_\">onSelectChange</span> = (<span class=\"hljs-params\"></span>) =&gt; &#123;</span></span><br><span class=\"language-javascript\"><span class=\"language-xml\">  <span class=\"hljs-variable language_\">console</span>.<span class=\"hljs-title function_\">log</span>(<span class=\"hljs-string\">&#x27;onSelectChange&#x27;</span>)</span></span><br><span class=\"language-javascript\"><span class=\"language-xml\">&#125;</span></span><br><span class=\"language-javascript\"><span class=\"language-xml\"></span><span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">script</span>&gt;</span></span><br><br><span class=\"language-xml\"><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">style</span> <span class=\"hljs-attr\">lang</span>=<span class=\"hljs-string\">&quot;scss&quot;</span> <span class=\"hljs-attr\">scoped</span>&gt;</span><span class=\"language-css\"></span></span><br><span class=\"language-css\"><span class=\"language-xml\"><span class=\"hljs-selector-class\">.header-search</span> &#123;</span></span><br><span class=\"language-css\"><span class=\"language-xml\">  <span class=\"hljs-attribute\">font-size</span>: <span class=\"hljs-number\">0</span> <span class=\"hljs-meta\">!important</span>;</span></span><br><span class=\"language-css\"><span class=\"language-xml\">  <span class=\"hljs-selector-class\">.search-icon</span> &#123;</span></span><br><span class=\"language-css\"><span class=\"language-xml\">    <span class=\"hljs-attribute\">cursor</span>: pointer;</span></span><br><span class=\"language-css\"><span class=\"language-xml\">    <span class=\"hljs-attribute\">font-size</span>: <span class=\"hljs-number\">18px</span>;</span></span><br><span class=\"language-css\"><span class=\"language-xml\">    <span class=\"hljs-attribute\">vertical-align</span>: middle;</span></span><br><span class=\"language-css\"><span class=\"language-xml\">  &#125;</span></span><br><span class=\"language-css\"><span class=\"language-xml\">  <span class=\"hljs-selector-class\">.header-search-select</span> &#123;</span></span><br><span class=\"language-css\"><span class=\"language-xml\">    <span class=\"hljs-attribute\">font-size</span>: <span class=\"hljs-number\">18px</span>;</span></span><br><span class=\"language-css\"><span class=\"language-xml\">    <span class=\"hljs-attribute\">transition</span>: width <span class=\"hljs-number\">0.2s</span>; // <span class=\"hljs-attribute\">width</span> 动画</span></span><br><span class=\"language-css\"><span class=\"language-xml\">    <span class=\"hljs-attribute\">width</span>: <span class=\"hljs-number\">0</span>;</span></span><br><span class=\"language-css\"><span class=\"language-xml\">    <span class=\"hljs-attribute\">overflow</span>: hidden;</span></span><br><span class=\"language-css\"><span class=\"language-xml\">    <span class=\"hljs-attribute\">background</span>: transparent;</span></span><br><span class=\"language-css\"><span class=\"language-xml\">    <span class=\"hljs-attribute\">border-radius</span>: <span class=\"hljs-number\">0</span>;</span></span><br><span class=\"language-css\"><span class=\"language-xml\">    <span class=\"hljs-attribute\">display</span>: inline-block;</span></span><br><span class=\"language-css\"><span class=\"language-xml\">    <span class=\"hljs-attribute\">vertical-align</span>: middle;</span></span><br><span class=\"language-css\"><span class=\"language-xml\"></span></span><br><span class=\"language-css\"><span class=\"language-xml\">    ::v-deep .el-input__inner &#123;</span></span><br><span class=\"language-css\"><span class=\"language-xml\">      <span class=\"hljs-attribute\">border-radius</span>: <span class=\"hljs-number\">0</span>;</span></span><br><span class=\"language-css\"><span class=\"language-xml\">      <span class=\"hljs-attribute\">border</span>: <span class=\"hljs-number\">0</span>;</span></span><br><span class=\"language-css\"><span class=\"language-xml\">      <span class=\"hljs-attribute\">padding-left</span>: <span class=\"hljs-number\">0</span>;</span></span><br><span class=\"language-css\"><span class=\"language-xml\">      <span class=\"hljs-attribute\">padding-right</span>: <span class=\"hljs-number\">0</span>;</span></span><br><span class=\"language-css\"><span class=\"language-xml\">      <span class=\"hljs-attribute\">box-shadow</span>: none <span class=\"hljs-meta\">!important</span>;</span></span><br><span class=\"language-css\"><span class=\"language-xml\">      <span class=\"hljs-attribute\">border-bottom</span>: <span class=\"hljs-number\">1px</span> solid <span class=\"hljs-number\">#d9d9d9</span>;</span></span><br><span class=\"language-css\"><span class=\"language-xml\">      <span class=\"hljs-attribute\">vertical-align</span>: middle;</span></span><br><span class=\"language-css\"><span class=\"language-xml\">    &#125;</span></span><br><span class=\"language-css\"><span class=\"language-xml\">  &#125;</span></span><br><span class=\"language-css\"><span class=\"language-xml\">  &amp;<span class=\"hljs-selector-class\">.show</span> &#123;</span></span><br><span class=\"language-css\"><span class=\"language-xml\">    <span class=\"hljs-selector-class\">.header-search-select</span> &#123;</span></span><br><span class=\"language-css\"><span class=\"language-xml\">      <span class=\"hljs-attribute\">width</span>: <span class=\"hljs-number\">210px</span>;</span></span><br><span class=\"language-css\"><span class=\"language-xml\">      <span class=\"hljs-attribute\">margin-left</span>: <span class=\"hljs-number\">10px</span>;</span></span><br><span class=\"language-css\"><span class=\"language-xml\">    &#125;</span></span><br><span class=\"language-css\"><span class=\"language-xml\">  &#125;</span></span><br><span class=\"language-css\"><span class=\"language-xml\">&#125;</span></span><br><span class=\"language-css\"><span class=\"language-xml\"></span><span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">style</span>&gt;</span></span><br><br></code></pre></td></tr></table></figure>\n\n<p>在 <code>navbar</code> 中导入该组件</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\">&lt;header-search <span class=\"hljs-keyword\">class</span>=<span class=\"hljs-string\">&quot;right-menu-item hover-effect&quot;</span>&gt;&lt;/header-search&gt;<br><br>...<br><br><span class=\"hljs-keyword\">import</span> <span class=\"hljs-title class_\">HeaderSearch</span> <span class=\"hljs-keyword\">from</span> <span class=\"hljs-string\">&#x27;@/components/HeaderSearch/index.vue&#x27;</span><br></code></pre></td></tr></table></figure>\n\n<h2 id=\"获取数据源\"><a href=\"#获取数据源\" class=\"headerlink\" title=\"获取数据源\"></a>获取数据源</h2><p>在有了 <code>headerSearch</code> 之后，接下来就可以来处理对应的 <strong>检索数据源了</strong></p>\n<p><strong>检索数据源</strong> 表示：<strong>有哪些页面希望检索</strong></p>\n<p>那么对于我们当前的业务而言，我们希望被检索的页面其实就是左侧菜单中的页面，那么我们检索数据源即为：<strong>左侧菜单对应的数据源</strong></p>\n<p>根据以上原理，我们可以得出以下代码：</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\">&lt;script setup&gt;<br><span class=\"hljs-keyword\">import</span> &#123; ref, computed &#125; <span class=\"hljs-keyword\">from</span> <span class=\"hljs-string\">&#x27;vue&#x27;</span><br><span class=\"hljs-keyword\">import</span> &#123; filterRouters, generateMenus &#125; <span class=\"hljs-keyword\">from</span> <span class=\"hljs-string\">&#x27;@/utils/route&#x27;</span><br><span class=\"hljs-keyword\">import</span> &#123; useRouter &#125; <span class=\"hljs-keyword\">from</span> <span class=\"hljs-string\">&#x27;vue-router&#x27;</span><br>...<br><span class=\"hljs-comment\">// 检索数据源</span><br><span class=\"hljs-keyword\">const</span> router = <span class=\"hljs-title function_\">useRouter</span>()<br><span class=\"hljs-keyword\">const</span> searchPool = <span class=\"hljs-title function_\">computed</span>(<span class=\"hljs-function\">() =&gt;</span> &#123;<br>  <span class=\"hljs-keyword\">const</span> filterRoutes = <span class=\"hljs-title function_\">filterRouters</span>(router.<span class=\"hljs-title function_\">getRoutes</span>())<br>  <span class=\"hljs-variable language_\">console</span>.<span class=\"hljs-title function_\">log</span>(<span class=\"hljs-title function_\">generateMenus</span>(filterRoutes))<br>  <span class=\"hljs-keyword\">return</span> <span class=\"hljs-title function_\">generateMenus</span>(filterRoutes)<br>&#125;)<br><span class=\"hljs-variable language_\">console</span>.<span class=\"hljs-title function_\">log</span>(searchPool)<br>&lt;/script&gt;<br></code></pre></td></tr></table></figure>\n\n<h2 id=\"模糊搜索Fuse-js\"><a href=\"#模糊搜索Fuse-js\" class=\"headerlink\" title=\"模糊搜索Fuse.js\"></a>模糊搜索Fuse.js</h2><blockquote>\n<p>Fuse.js is a powerful, lightweight fuzzy-search library, with zero dependencies.</p>\n</blockquote>\n<p>如果我们想要进行  <a href=\"https://fusejs.io/\">模糊搜索</a>  的话，那么需要依赖一个第三方的库  <a href=\"https://fusejs.io/\">fuse.js</a> </p>\n<p>它是0️⃣依赖的，专门处理模糊搜索的库。</p>\n<p><strong>Why should I use it?</strong></p>\n<ul>\n<li>使用 Fuse.js，您不需要仅仅为了处理搜索而设置专用的后端。</li>\n<li>简单性和性能是开发这个库的主要标准。</li>\n</ul>\n<ol>\n<li>安装 <a href=\"https://fusejs.io/\">fuse.js</a></li>\n</ol>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\">npm install --save fuse.<span class=\"hljs-property\">js</span>@<span class=\"hljs-number\">6.4</span><span class=\"hljs-number\">.6</span><br></code></pre></td></tr></table></figure>\n\n<ol start=\"2\">\n<li>初始化 <code>Fuse</code>，更多初始化配置项 <a href=\"https://fusejs.io/api/options.html\">可点击这里</a></li>\n</ol>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\"><span class=\"hljs-keyword\">import</span> <span class=\"hljs-title class_\">Fuse</span> <span class=\"hljs-keyword\">from</span> <span class=\"hljs-string\">&#x27;fuse.js&#x27;</span><br><br><span class=\"hljs-comment\">/**</span><br><span class=\"hljs-comment\">* 搜索库相关</span><br><span class=\"hljs-comment\">*/</span><br><span class=\"hljs-keyword\">const</span> fuse = <span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">Fuse</span>(list, &#123;<br>    <span class=\"hljs-comment\">// 是否按优先级进行排序</span><br>    <span class=\"hljs-attr\">shouldSort</span>: <span class=\"hljs-literal\">true</span>,<br>    <span class=\"hljs-comment\">// 匹配长度超过这个值的才会被认为是匹配的</span><br>    <span class=\"hljs-attr\">minMatchCharLength</span>: <span class=\"hljs-number\">1</span>,<br>    <span class=\"hljs-comment\">// 将被搜索的键列表。 这支持嵌套路径、加权搜索、在字符串和对象数组中搜索。</span><br>    <span class=\"hljs-comment\">// name：搜索的键</span><br>    <span class=\"hljs-comment\">// weight：对应的权重</span><br>    <span class=\"hljs-comment\">// 表示我们将用户输入的值，与 title 和 path 进行匹配</span><br>    <span class=\"hljs-attr\">keys</span>: [<br>      &#123;<br>        <span class=\"hljs-attr\">name</span>: <span class=\"hljs-string\">&#x27;title&#x27;</span>,<br>        <span class=\"hljs-attr\">weight</span>: <span class=\"hljs-number\">0.7</span><br>      &#125;,<br>      &#123;<br>        <span class=\"hljs-attr\">name</span>: <span class=\"hljs-string\">&#x27;path&#x27;</span>,<br>        <span class=\"hljs-attr\">weight</span>: <span class=\"hljs-number\">0.3</span><br>      &#125;<br>    ]<br>  &#125;)<br></code></pre></td></tr></table></figure>\n\n<ol start=\"3\">\n<li>参考 <a href=\"https://fusejs.io/demo.html\">Fuse Demo</a> 与 最终效果，可以得出，我们最终期望得到如下的检索数据源结构</li>\n</ol>\n<figure class=\"highlight json\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs json\"><span class=\"hljs-punctuation\">[</span><br>    <span class=\"hljs-punctuation\">&#123;</span><br>        <span class=\"hljs-attr\">&quot;path&quot;</span><span class=\"hljs-punctuation\">:</span><span class=\"hljs-string\">&quot;/my&quot;</span><span class=\"hljs-punctuation\">,</span><br>        <span class=\"hljs-attr\">&quot;title&quot;</span><span class=\"hljs-punctuation\">:</span><span class=\"hljs-punctuation\">[</span><br>            <span class=\"hljs-string\">&quot;个人中心&quot;</span><br>        <span class=\"hljs-punctuation\">]</span><br>    <span class=\"hljs-punctuation\">&#125;</span><span class=\"hljs-punctuation\">,</span><br>    <span class=\"hljs-punctuation\">&#123;</span><br>        <span class=\"hljs-attr\">&quot;path&quot;</span><span class=\"hljs-punctuation\">:</span><span class=\"hljs-string\">&quot;/user&quot;</span><span class=\"hljs-punctuation\">,</span><br>        <span class=\"hljs-attr\">&quot;title&quot;</span><span class=\"hljs-punctuation\">:</span><span class=\"hljs-punctuation\">[</span><br>            <span class=\"hljs-string\">&quot;用户&quot;</span><br>        <span class=\"hljs-punctuation\">]</span><br>    <span class=\"hljs-punctuation\">&#125;</span><span class=\"hljs-punctuation\">,</span><br>    <span class=\"hljs-punctuation\">&#123;</span><br>        <span class=\"hljs-attr\">&quot;path&quot;</span><span class=\"hljs-punctuation\">:</span><span class=\"hljs-string\">&quot;/user/manage&quot;</span><span class=\"hljs-punctuation\">,</span><br>        <span class=\"hljs-attr\">&quot;title&quot;</span><span class=\"hljs-punctuation\">:</span><span class=\"hljs-punctuation\">[</span><br>            <span class=\"hljs-string\">&quot;用户&quot;</span><span class=\"hljs-punctuation\">,</span><br>            <span class=\"hljs-string\">&quot;用户管理&quot;</span><br>        <span class=\"hljs-punctuation\">]</span><br>    <span class=\"hljs-punctuation\">&#125;</span><span class=\"hljs-punctuation\">,</span><br>    <span class=\"hljs-punctuation\">&#123;</span><br>        <span class=\"hljs-attr\">&quot;path&quot;</span><span class=\"hljs-punctuation\">:</span><span class=\"hljs-string\">&quot;/user/info&quot;</span><span class=\"hljs-punctuation\">,</span><br>        <span class=\"hljs-attr\">&quot;title&quot;</span><span class=\"hljs-punctuation\">:</span><span class=\"hljs-punctuation\">[</span><br>            <span class=\"hljs-string\">&quot;用户&quot;</span><span class=\"hljs-punctuation\">,</span><br>            <span class=\"hljs-string\">&quot;用户信息&quot;</span><br>        <span class=\"hljs-punctuation\">]</span><br>    <span class=\"hljs-punctuation\">&#125;</span><span class=\"hljs-punctuation\">,</span><br>    <span class=\"hljs-punctuation\">&#123;</span><br>        <span class=\"hljs-attr\">&quot;path&quot;</span><span class=\"hljs-punctuation\">:</span><span class=\"hljs-string\">&quot;/article&quot;</span><span class=\"hljs-punctuation\">,</span><br>        <span class=\"hljs-attr\">&quot;title&quot;</span><span class=\"hljs-punctuation\">:</span><span class=\"hljs-punctuation\">[</span><br>            <span class=\"hljs-string\">&quot;文章&quot;</span><br>        <span class=\"hljs-punctuation\">]</span><br>    <span class=\"hljs-punctuation\">&#125;</span><span class=\"hljs-punctuation\">,</span><br>    <span class=\"hljs-punctuation\">&#123;</span><br>        <span class=\"hljs-attr\">&quot;path&quot;</span><span class=\"hljs-punctuation\">:</span><span class=\"hljs-string\">&quot;/article/ranking&quot;</span><span class=\"hljs-punctuation\">,</span><br>        <span class=\"hljs-attr\">&quot;title&quot;</span><span class=\"hljs-punctuation\">:</span><span class=\"hljs-punctuation\">[</span><br>            <span class=\"hljs-string\">&quot;文章&quot;</span><span class=\"hljs-punctuation\">,</span><br>            <span class=\"hljs-string\">&quot;文章排名&quot;</span><br>        <span class=\"hljs-punctuation\">]</span><br>    <span class=\"hljs-punctuation\">&#125;</span><span class=\"hljs-punctuation\">,</span><br>    <span class=\"hljs-punctuation\">&#123;</span><br>        <span class=\"hljs-attr\">&quot;path&quot;</span><span class=\"hljs-punctuation\">:</span><span class=\"hljs-string\">&quot;/article/create&quot;</span><span class=\"hljs-punctuation\">,</span><br>        <span class=\"hljs-attr\">&quot;title&quot;</span><span class=\"hljs-punctuation\">:</span><span class=\"hljs-punctuation\">[</span><br>            <span class=\"hljs-string\">&quot;文章&quot;</span><span class=\"hljs-punctuation\">,</span><br>            <span class=\"hljs-string\">&quot;创建文章&quot;</span><br>        <span class=\"hljs-punctuation\">]</span><br>    <span class=\"hljs-punctuation\">&#125;</span><br><span class=\"hljs-punctuation\">]</span><br></code></pre></td></tr></table></figure>\n\n<ol start=\"4\">\n<li>所以我们之前处理了的数据源并不符合我们的需要，所以我们需要对数据源进行重新处理</li>\n</ol>\n<h2 id=\"数据源重处理，生成-searchPool\"><a href=\"#数据源重处理，生成-searchPool\" class=\"headerlink\" title=\"数据源重处理，生成 searchPool\"></a>数据源重处理，生成 searchPool</h2><p>我们明确了最终我们期望得到数据源结构，那么接下来我们就对重新计算数据源，生成对应的 <code>searchPoll</code></p>\n<p>创建 <code>components/HeaderSearch/FuseData.js</code></p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\"><span class=\"hljs-keyword\">import</span> path <span class=\"hljs-keyword\">from</span> <span class=\"hljs-string\">&#x27;path&#x27;</span><br><span class=\"hljs-keyword\">import</span> i18n <span class=\"hljs-keyword\">from</span> <span class=\"hljs-string\">&#x27;@/i18n&#x27;</span><br><span class=\"hljs-comment\">/**</span><br><span class=\"hljs-comment\"> * 筛选出可供搜索的路由对象</span><br><span class=\"hljs-comment\"> * <span class=\"hljs-doctag\">@param</span> routes 路由表</span><br><span class=\"hljs-comment\"> * <span class=\"hljs-doctag\">@param</span> basePath 基础路径，默认为 /</span><br><span class=\"hljs-comment\"> * <span class=\"hljs-doctag\">@param</span> prefixTitle 父级title，子集title集合 [文章，文章排名]</span><br><span class=\"hljs-comment\"> */</span><br><span class=\"hljs-keyword\">export</span> <span class=\"hljs-keyword\">const</span> <span class=\"hljs-title function_\">generateRoutes</span> = (<span class=\"hljs-params\">routes, basePath = <span class=\"hljs-string\">&#x27;/&#x27;</span>, prefixTitle = []</span>) =&gt; &#123;<br>  <span class=\"hljs-comment\">// 创建 result 数据</span><br>  <span class=\"hljs-keyword\">let</span> res = []<br>  <span class=\"hljs-comment\">// 循环 routes 路由</span><br>  <span class=\"hljs-keyword\">for</span> (<span class=\"hljs-keyword\">const</span> route <span class=\"hljs-keyword\">of</span> routes) &#123;<br>    <span class=\"hljs-comment\">// 创建包含 path 和 title 的 item</span><br>    <span class=\"hljs-keyword\">const</span> data = &#123;<br>      <span class=\"hljs-attr\">path</span>: path.<span class=\"hljs-title function_\">resolve</span>(basePath, route.<span class=\"hljs-property\">path</span>),<br>      <span class=\"hljs-attr\">title</span>: [...prefixTitle]<br>    &#125;<br>    <span class=\"hljs-comment\">// 当前存在 meta 时，使用 i18n 解析国际化数据，组合成新的 title 内容</span><br>    <span class=\"hljs-comment\">// 动态路由不允许被搜索（类似：user/:id 这种）</span><br>    <span class=\"hljs-comment\">// 匹配动态路由的正则</span><br>    <span class=\"hljs-keyword\">const</span> re = <span class=\"hljs-regexp\">/.*\\/:.*/</span><br>    <span class=\"hljs-keyword\">if</span> (route.<span class=\"hljs-property\">meta</span> &amp;&amp; route.<span class=\"hljs-property\">meta</span>.<span class=\"hljs-property\">title</span> &amp;&amp; !re.<span class=\"hljs-title function_\">exec</span>(route.<span class=\"hljs-property\">path</span>)) &#123;<br>      <span class=\"hljs-keyword\">const</span> i18ntitle = i18n.<span class=\"hljs-property\">global</span>.<span class=\"hljs-title function_\">t</span>(<span class=\"hljs-string\">`msg.route.<span class=\"hljs-subst\">$&#123;route.meta.title&#125;</span>`</span>)<br>      data.<span class=\"hljs-property\">title</span> = [...data.<span class=\"hljs-property\">title</span>, i18ntitle]<br>      res.<span class=\"hljs-title function_\">push</span>(data)<br>    &#125;<br><br>    <span class=\"hljs-comment\">// 存在 children 时，迭代调用</span><br>    <span class=\"hljs-keyword\">if</span> (route.<span class=\"hljs-property\">children</span>) &#123;<br>      <span class=\"hljs-keyword\">const</span> tempRoutes = <span class=\"hljs-title function_\">generateRoutes</span>(route.<span class=\"hljs-property\">children</span>, data.<span class=\"hljs-property\">path</span>, data.<span class=\"hljs-property\">title</span>)<br>      <span class=\"hljs-keyword\">if</span> (tempRoutes.<span class=\"hljs-property\">length</span> &gt;= <span class=\"hljs-number\">1</span>) &#123;<br>        res = [...res, ...tempRoutes]<br>      &#125;<br>    &#125;<br>  &#125;<br>  <span class=\"hljs-keyword\">return</span> res<br>&#125;<br><br></code></pre></td></tr></table></figure>\n\n<p>这样，我们就通过 <code>generateRoutes</code> 方法，根据咱们的路由表，生成了符合 <code>fuse.js</code> 的数据。</p>\n<p>在 <code>headerSearch</code> 中导入 <code>generateRoutes</code></p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs vue\">&lt;script setup&gt;<br>import &#123; computed, ref &#125; from &#x27;vue&#x27;<br>import &#123; generateRoutes &#125; from &#x27;./FuseData&#x27;<br>import Fuse from &#x27;fuse.js&#x27;<br>import &#123; filterRouters &#125; from &#x27;@/utils/route&#x27;<br>import &#123; useRouter &#125; from &#x27;vue-router&#x27;<br><br>...<br><br>// 检索数据源<br>const router = useRouter()<br>const searchPool = computed(() =&gt; &#123;<br>  const filterRoutes = filterRouters(router.getRoutes())<br>  return generateRoutes(filterRoutes)<br>&#125;)<br>/**<br> * 搜索库相关<br> */<br>const fuse = new Fuse(searchPool.value, &#123;<br>  ...<br>&#125;)<br>&lt;/script&gt;<br></code></pre></td></tr></table></figure>\n\n<p>通过 <code>querySearch</code> 测试搜索结果</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\"><span class=\"hljs-comment\">// 搜索方法</span><br><span class=\"hljs-keyword\">const</span> <span class=\"hljs-title function_\">querySearch</span> = query =&gt; &#123;<br>  <span class=\"hljs-variable language_\">console</span>.<span class=\"hljs-title function_\">log</span>(fuse.<span class=\"hljs-title function_\">search</span>(query))<br>&#125;<br></code></pre></td></tr></table></figure>\n\n<h2 id=\"渲染检索数据\"><a href=\"#渲染检索数据\" class=\"headerlink\" title=\"渲染检索数据\"></a>渲染检索数据</h2><p>数据源处理完成之后，最后我们就只需要完成:</p>\n<ol>\n<li>渲染检索出的数据</li>\n<li>完成对应跳转</li>\n</ol>\n<p>那么下面我们按照步骤进行实现：</p>\n<ol>\n<li>渲染检索出的数据</li>\n</ol>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\">&lt;template&gt;<br>  <span class=\"language-xml\"><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">el-option</span></span></span><br><span class=\"hljs-tag\"><span class=\"language-xml\">      <span class=\"hljs-attr\">v-for</span>=<span class=\"hljs-string\">&quot;option in searchOptions&quot;</span></span></span><br><span class=\"hljs-tag\"><span class=\"language-xml\">      <span class=\"hljs-attr\">:key</span>=<span class=\"hljs-string\">&quot;option.item.path&quot;</span></span></span><br><span class=\"hljs-tag\"><span class=\"language-xml\">      <span class=\"hljs-attr\">:label</span>=<span class=\"hljs-string\">&quot;option.item.title.join(&#x27; &gt; &#x27;)&quot;</span></span></span><br><span class=\"hljs-tag\"><span class=\"language-xml\">      <span class=\"hljs-attr\">:value</span>=<span class=\"hljs-string\">&quot;option.item&quot;</span></span></span><br><span class=\"hljs-tag\"><span class=\"language-xml\">  &gt;</span><span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">el-option</span>&gt;</span></span><br>&lt;/template&gt;<br><br><span class=\"language-xml\"><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">script</span> <span class=\"hljs-attr\">setup</span>&gt;</span><span class=\"language-javascript\"></span></span><br><span class=\"language-javascript\"><span class=\"language-xml\">...</span></span><br><span class=\"language-javascript\"><span class=\"language-xml\"><span class=\"hljs-comment\">// 搜索结果</span></span></span><br><span class=\"language-javascript\"><span class=\"language-xml\"><span class=\"hljs-keyword\">const</span> searchOptions = <span class=\"hljs-title function_\">ref</span>([])</span></span><br><span class=\"language-javascript\"><span class=\"language-xml\"><span class=\"hljs-comment\">// 搜索方法</span></span></span><br><span class=\"language-javascript\"><span class=\"language-xml\"><span class=\"hljs-keyword\">const</span> <span class=\"hljs-title function_\">querySearch</span> = query =&gt; &#123;</span></span><br><span class=\"language-javascript\"><span class=\"language-xml\">  <span class=\"hljs-keyword\">if</span> (query !== <span class=\"hljs-string\">&#x27;&#x27;</span>) &#123;</span></span><br><span class=\"language-javascript\"><span class=\"language-xml\">    searchOptions.<span class=\"hljs-property\">value</span> = fuse.<span class=\"hljs-title function_\">search</span>(query)</span></span><br><span class=\"language-javascript\"><span class=\"language-xml\">  &#125; <span class=\"hljs-keyword\">else</span> &#123;</span></span><br><span class=\"language-javascript\"><span class=\"language-xml\">    searchOptions.<span class=\"hljs-property\">value</span> = []</span></span><br><span class=\"language-javascript\"><span class=\"language-xml\">  &#125;</span></span><br><span class=\"language-javascript\"><span class=\"language-xml\">&#125;</span></span><br><span class=\"language-javascript\"><span class=\"language-xml\">...</span></span><br><span class=\"language-javascript\"><span class=\"language-xml\"></span><span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">script</span>&gt;</span></span><br><br></code></pre></td></tr></table></figure>\n\n<ol start=\"2\">\n<li>完成对应跳转</li>\n</ol>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\"><span class=\"hljs-keyword\">const</span> <span class=\"hljs-title function_\">onSelectChange</span> = val =&gt; &#123;<br>  router.<span class=\"hljs-title function_\">push</span>(val.<span class=\"hljs-property\">path</span>)<br>&#125;<br></code></pre></td></tr></table></figure>\n\n<h2 id=\"剩余问题处理\"><a href=\"#剩余问题处理\" class=\"headerlink\" title=\"剩余问题处理\"></a>剩余问题处理</h2><p>这里我们的 <code>headerSearch</code> 功能基本上就已经处理完成了，但是还存在一些小 <code>bug</code> ，那么最后这一小节我们就处理下这些剩余的 <code>bug</code></p>\n<ol>\n<li>在 <code>search</code> 打开时，点击 <code>body</code> 关闭 <code>search</code></li>\n<li>在 <code>search</code> 关闭时，清理 <code>searchOptions</code></li>\n<li><code>headerSearch</code> 应该具备国际化能力</li>\n</ol>\n<p>明确好问题之后，接下来我们进行处理</p>\n<p>首先我们先处理前前面两个问题：</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\"><span class=\"hljs-comment\">/**</span><br><span class=\"hljs-comment\"> * 关闭 search 的处理事件</span><br><span class=\"hljs-comment\"> */</span><br><span class=\"hljs-keyword\">const</span> <span class=\"hljs-title function_\">onClose</span> = (<span class=\"hljs-params\"></span>) =&gt; &#123;<br>  headerSearchSelectRef.<span class=\"hljs-property\">value</span>.<span class=\"hljs-title function_\">blur</span>()<br>  isShow.<span class=\"hljs-property\">value</span> = <span class=\"hljs-literal\">false</span><br>  searchOptions.<span class=\"hljs-property\">value</span> = []<br>&#125;<br><span class=\"hljs-comment\">/**</span><br><span class=\"hljs-comment\"> * 监听 search 打开，处理 close 事件</span><br><span class=\"hljs-comment\"> */</span><br><span class=\"hljs-title function_\">watch</span>(isShow, <span class=\"hljs-function\"><span class=\"hljs-params\">val</span> =&gt;</span> &#123;<br>  <span class=\"hljs-keyword\">if</span> (val) &#123;<br>    <span class=\"hljs-variable language_\">document</span>.<span class=\"hljs-property\">body</span>.<span class=\"hljs-title function_\">addEventListener</span>(<span class=\"hljs-string\">&#x27;click&#x27;</span>, onClose)<br>  &#125; <span class=\"hljs-keyword\">else</span> &#123;<br>    <span class=\"hljs-variable language_\">document</span>.<span class=\"hljs-property\">body</span>.<span class=\"hljs-title function_\">removeEventListener</span>(<span class=\"hljs-string\">&#x27;click&#x27;</span>, onClose)<br>  &#125;<br>&#125;)<br></code></pre></td></tr></table></figure>\n\n<p>接下来是国际化的问题，想要处理这个问题非常简单，我们只需要：<strong>监听语言变化，重新计算数据源初始化 <code>fuse</code> 即可</strong></p>\n<ol>\n<li>在 <code>utils/i18n</code> 下，新建方法 <code>watchSwitchLang</code></li>\n</ol>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\"><span class=\"hljs-keyword\">import</span> &#123; watch &#125; <span class=\"hljs-keyword\">from</span> <span class=\"hljs-string\">&#x27;vue&#x27;</span><br><span class=\"hljs-keyword\">import</span> store <span class=\"hljs-keyword\">from</span> <span class=\"hljs-string\">&#x27;@/store&#x27;</span><br><br>type <span class=\"hljs-title class_\">IProps</span> = (<span class=\"hljs-function\">(<span class=\"hljs-params\">lang: string</span>) =&gt;</span> <span class=\"hljs-keyword\">void</span>)[]<br><br><span class=\"hljs-keyword\">export</span> <span class=\"hljs-keyword\">default</span> <span class=\"hljs-keyword\">function</span> <span class=\"hljs-title function_\">watchSwitchLang</span>(<span class=\"hljs-params\">...cbs: IProps</span>) &#123;<br>  <span class=\"hljs-title function_\">watch</span>(<br>    <span class=\"hljs-function\">() =&gt;</span> store.<span class=\"hljs-property\">getters</span>.<span class=\"hljs-property\">language</span>,<br>    <span class=\"hljs-function\">() =&gt;</span> &#123;<br>      cbs.<span class=\"hljs-title function_\">forEach</span>(<span class=\"hljs-function\"><span class=\"hljs-params\">cb</span> =&gt;</span> cbs.<span class=\"hljs-title function_\">forEach</span>(<span class=\"hljs-function\"><span class=\"hljs-params\">cb</span> =&gt;</span> <span class=\"hljs-title function_\">cb</span>(store.<span class=\"hljs-property\">getters</span>.<span class=\"hljs-property\">language</span>)))<br>    &#125;<br>  )<br>&#125;<br></code></pre></td></tr></table></figure>\n\n<ol start=\"2\">\n<li>在 <code>headerSearch</code> 监听变化，重新赋值</li>\n</ol>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\">&lt;script setup&gt;<br>...<br><span class=\"hljs-keyword\">import</span> &#123; watchSwitchLang &#125; <span class=\"hljs-keyword\">from</span> <span class=\"hljs-string\">&#x27;@/utils/i18n&#x27;</span><br><br>...<br><br><span class=\"hljs-comment\">// 检索数据源</span><br><span class=\"hljs-keyword\">const</span> router = <span class=\"hljs-title function_\">useRouter</span>()<br><span class=\"hljs-keyword\">let</span> searchPool = <span class=\"hljs-title function_\">computed</span>(<span class=\"hljs-function\">() =&gt;</span> &#123;<br>  <span class=\"hljs-keyword\">const</span> filterRoutes = <span class=\"hljs-title function_\">filterRouters</span>(router.<span class=\"hljs-title function_\">getRoutes</span>())<br>  <span class=\"hljs-keyword\">return</span> <span class=\"hljs-title function_\">generateRoutes</span>(filterRoutes)<br>&#125;)<br><span class=\"hljs-comment\">/**</span><br><span class=\"hljs-comment\">* 搜索库相关</span><br><span class=\"hljs-comment\">*/</span><br><span class=\"hljs-keyword\">let</span> fuse<br><span class=\"hljs-keyword\">const</span> <span class=\"hljs-title function_\">initFuse</span> = searchPool =&gt; &#123;<br>  fuse = <span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">Fuse</span>(searchPool, &#123;<br>    ...<br>&#125;<br><span class=\"hljs-title function_\">initFuse</span>(searchPool.<span class=\"hljs-property\">value</span>)<br><br>...<br><br><span class=\"hljs-comment\">// 处理国际化</span><br><span class=\"hljs-title function_\">watchSwitchLang</span>(<span class=\"hljs-function\">() =&gt;</span> &#123;<br>  searchPool = <span class=\"hljs-title function_\">computed</span>(<span class=\"hljs-function\">() =&gt;</span> &#123;<br>    <span class=\"hljs-keyword\">const</span> filterRoutes = <span class=\"hljs-title function_\">filterRouters</span>(router.<span class=\"hljs-title function_\">getRoutes</span>())<br>    <span class=\"hljs-keyword\">return</span> <span class=\"hljs-title function_\">generateRoutes</span>(filterRoutes)<br>  &#125;)<br>  <span class=\"hljs-title function_\">initFuse</span>(searchPool.<span class=\"hljs-property\">value</span>)<br>&#125;)<br>&lt;/script&gt;<br></code></pre></td></tr></table></figure>\n\n<h2 id=\"headerSearch-方案总结\"><a href=\"#headerSearch-方案总结\" class=\"headerlink\" title=\"headerSearch 方案总结\"></a>headerSearch 方案总结</h2><p>那么到这里整个的 <code>headerSearch</code> 我们就已经全部处理完成了，整个 <code>headerSearch</code> 我们只需要把握住三个核心的关键点</p>\n<ol>\n<li>根据指定内容对所有页面进行检索</li>\n<li>以 <code>select</code> 形式展示检索出的页面</li>\n<li>通过检索页面可快速进入对应页面</li>\n</ol>\n<p>保证大方向没有错误，那么具体的细节处理我们具体分析就可以了。</p>\n<p>关于细节的处理，可能比较复杂的地方有两个：</p>\n<ol>\n<li>模糊搜索</li>\n<li>检索数据源</li>\n</ol>\n<p>对于这两块，我们依赖于 <code>fuse.js</code> 进行了实现，大大简化了我们的业务处理流程。</p>\n<h1 id=\"tagsView-原理及方案分析\"><a href=\"#tagsView-原理及方案分析\" class=\"headerlink\" title=\"tagsView 原理及方案分析\"></a>tagsView 原理及方案分析</h1><p>所谓 <code>tagsView</code> 可以分成两部分来去看：</p>\n<ol>\n<li>tags</li>\n<li>view</li>\n</ol>\n<p>好像和废话一样是吧。那怎么分开看呢？</p>\n<p>首先我们先来看 <code>tags</code>：</p>\n<p>所谓 <code>tgas</code> 指的是：<strong>位于 <code>appmain</code> 之上的标签</strong></p>\n<p>那么现在我们忽略掉 <code>view</code>，现在只有一个要求：</p>\n<blockquote>\n<p>在 <code>view</code> 之上渲染这个 <code>tag</code> </p>\n</blockquote>\n<p>仅看这一个要求，很简单吧。</p>\n<p><strong>views：</strong></p>\n<p>明确好了 <code>tags</code> 之后，我们来看 <code>views</code>。</p>\n<p>脱离了 <code>tags</code> 只看 <code>views</code> 就更简单了，所谓 <code>views</code> ：<strong>指的就是一个用来渲染组件的位置</strong>，就像我们之前的 <code>Appmain</code> 一样，只不过这里的 <code>views</code> 可能稍微复杂一点，因为它需要在渲染的基础上增加：</p>\n<ol>\n<li>动画</li>\n<li>缓存</li>\n</ol>\n<p>这两个额外的功能。</p>\n<p>加上这两个功能之后可能会略显复杂，但是 <a href=\"https://next.router.vuejs.org/zh/guide/advanced/transitions.html#%E5%9F%BA%E4%BA%8E%E8%B7%AF%E7%94%B1%E7%9A%84%E5%8A%A8%E6%80%81%E8%BF%87%E6%B8%A1\">官网已经帮助我们处理了这个问题</a> </p>\n<p>所以 单看 <code>views</code> 也是一个很简单的功能。</p>\n<p>那么接下来我们需要做的就是把 <code>tags</code> 和 <code>view</code> 合并起来而已。</p>\n<p>那么明确好了原理之后，我们就来看 <strong>实现方案：</strong></p>\n<ol>\n<li>创建 <code>tagsView</code> 组件：用来处理 <code>tags</code> 的展示</li>\n<li>处理基于路由的动态过渡，在 <code>AppMain</code> 中进行：用于处理 <code>view</code> 的部分</li>\n</ol>\n<p>整个的方案就是这么两大部，但是其中我们还需要处理一些细节相关的，<strong>完整的方案为</strong>：</p>\n<ol>\n<li>监听路由变化，组成用于渲染 <code>tags</code> 的数据源</li>\n<li>创建 <code>tags</code> 组件，根据数据源渲染 <code>tag</code>，渲染出来的 <code>tags</code> 需要同时具备<ol>\n<li>国际化 <code>title</code></li>\n<li>路由跳转</li>\n</ol>\n</li>\n<li>处理鼠标右键效果，根据右键处理对应数据源</li>\n<li>处理基于路由的动态过渡</li>\n</ol>\n<p>那么明确好了方案之后，接下来我们根据方案进行处理即可。</p>\n<h2 id=\"创建-tags-数据源\"><a href=\"#创建-tags-数据源\" class=\"headerlink\" title=\"创建 tags 数据源\"></a>创建 tags 数据源</h2><p><code>tags</code> 的数据源分为两部分：</p>\n<ol>\n<li>保存数据：<code>appmain</code> 组件中进行</li>\n<li>展示数据：<code>tags</code> 组件中进行</li>\n</ol>\n<p>所以 <code>tags</code> 的数据我们最好把它保存到 <code>vuex</code> 中。</p>\n<ol>\n<li><p>在 <code>constant</code> 中新建常量</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\"><span class=\"hljs-comment\">// tags</span><br><span class=\"hljs-keyword\">export</span> <span class=\"hljs-keyword\">const</span> <span class=\"hljs-variable constant_\">TAGS_VIEW</span> = <span class=\"hljs-string\">&#x27;tagsView&#x27;</span><br></code></pre></td></tr></table></figure>\n</li>\n<li><p>在 <code>store/app</code> 中创建 <code>tagsViewList</code></p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\"><span class=\"hljs-keyword\">import</span> &#123; <span class=\"hljs-variable constant_\">LANG</span>, <span class=\"hljs-variable constant_\">TAGS_VIEW</span> &#125; <span class=\"hljs-keyword\">from</span> <span class=\"hljs-string\">&#x27;@/constant&#x27;</span><br><span class=\"hljs-keyword\">import</span> &#123; getItem, setItem &#125; <span class=\"hljs-keyword\">from</span> <span class=\"hljs-string\">&#x27;@/utils/storage&#x27;</span><br><span class=\"hljs-keyword\">export</span> <span class=\"hljs-keyword\">default</span> &#123;<br>  <span class=\"hljs-attr\">namespaced</span>: <span class=\"hljs-literal\">true</span>,<br>  <span class=\"hljs-attr\">state</span>: <span class=\"hljs-function\">() =&gt;</span> (&#123;<br>    ...<br>    <span class=\"hljs-attr\">tagsViewList</span>: <span class=\"hljs-title function_\">getItem</span>(<span class=\"hljs-variable constant_\">TAGS_VIEW</span>) || []<br>  &#125;),<br>  <span class=\"hljs-attr\">mutations</span>: &#123;<br>    ...<br>    <span class=\"hljs-comment\">/**</span><br><span class=\"hljs-comment\">     * 添加 tags</span><br><span class=\"hljs-comment\">     */</span><br>    <span class=\"hljs-title function_\">addTagsViewList</span>(<span class=\"hljs-params\">state, tag</span>) &#123;<br>      <span class=\"hljs-keyword\">const</span> isFind = state.<span class=\"hljs-property\">tagsViewList</span>.<span class=\"hljs-title function_\">find</span>(<span class=\"hljs-function\"><span class=\"hljs-params\">item</span> =&gt;</span> &#123;<br>        <span class=\"hljs-keyword\">return</span> item.<span class=\"hljs-property\">path</span> === tag.<span class=\"hljs-property\">path</span><br>      &#125;)<br>    <span class=\"hljs-comment\">// 处理重复</span><br>      <span class=\"hljs-keyword\">if</span> (!isFind) &#123;<br>        state.<span class=\"hljs-property\">tagsViewList</span>.<span class=\"hljs-title function_\">push</span>(tag)<br>        <span class=\"hljs-title function_\">setItem</span>(<span class=\"hljs-variable constant_\">TAGS_VIEW</span>, state.<span class=\"hljs-property\">tagsViewList</span>)<br>      &#125;<br>    &#125;<br>  &#125;,<br>  <span class=\"hljs-attr\">actions</span>: &#123;&#125;<br>&#125;<br><br></code></pre></td></tr></table></figure>\n</li>\n<li><p>在 <code>appmain</code> 中监听路由的变化</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\">&lt;script setup&gt;<br><span class=\"hljs-keyword\">import</span> &#123; watch &#125; <span class=\"hljs-keyword\">from</span> <span class=\"hljs-string\">&#x27;vue&#x27;</span><br><span class=\"hljs-keyword\">import</span> &#123; isTags &#125; <span class=\"hljs-keyword\">from</span> <span class=\"hljs-string\">&#x27;@/utils/tags&#x27;</span><br><span class=\"hljs-keyword\">import</span> &#123; generateTitle &#125; <span class=\"hljs-keyword\">from</span> <span class=\"hljs-string\">&#x27;@/utils/i18n&#x27;</span><br><span class=\"hljs-keyword\">import</span> &#123; useRoute &#125; <span class=\"hljs-keyword\">from</span> <span class=\"hljs-string\">&#x27;vue-router&#x27;</span><br><span class=\"hljs-keyword\">import</span> &#123; useStore &#125; <span class=\"hljs-keyword\">from</span> <span class=\"hljs-string\">&#x27;vuex&#x27;</span><br><br><span class=\"hljs-keyword\">const</span> route = <span class=\"hljs-title function_\">useRoute</span>()<br><br><span class=\"hljs-comment\">/**</span><br><span class=\"hljs-comment\"> * 生成 title</span><br><span class=\"hljs-comment\"> */</span><br><span class=\"hljs-keyword\">const</span> <span class=\"hljs-title function_\">getTitle</span> = route =&gt; &#123;<br>  <span class=\"hljs-keyword\">let</span> title = <span class=\"hljs-string\">&#x27;&#x27;</span><br>  <span class=\"hljs-keyword\">if</span> (!route.<span class=\"hljs-property\">meta</span>) &#123;<br>    <span class=\"hljs-comment\">// 处理无 meta 的路由</span><br>    <span class=\"hljs-keyword\">const</span> pathArr = route.<span class=\"hljs-property\">path</span>.<span class=\"hljs-title function_\">split</span>(<span class=\"hljs-string\">&#x27;/&#x27;</span>)<br>    title = pathArr[pathArr.<span class=\"hljs-property\">length</span> - <span class=\"hljs-number\">1</span>]<br>  &#125; <span class=\"hljs-keyword\">else</span> &#123;<br>    title = <span class=\"hljs-title function_\">generateTitle</span>(route.<span class=\"hljs-property\">meta</span>.<span class=\"hljs-property\">title</span>)<br>  &#125;<br>  <span class=\"hljs-keyword\">return</span> title<br>&#125;<br><br><span class=\"hljs-comment\">/**</span><br><span class=\"hljs-comment\"> * 监听路由变化</span><br><span class=\"hljs-comment\"> */</span><br><span class=\"hljs-keyword\">const</span> store = <span class=\"hljs-title function_\">useStore</span>()<br><span class=\"hljs-title function_\">watch</span>(<br>  route,<br>  <span class=\"hljs-function\">(<span class=\"hljs-params\">to, <span class=\"hljs-keyword\">from</span></span>) =&gt;</span> &#123;<br>    <span class=\"hljs-keyword\">if</span> (!<span class=\"hljs-title function_\">isTags</span>(to.<span class=\"hljs-property\">path</span>)) <span class=\"hljs-keyword\">return</span><br>    <span class=\"hljs-keyword\">const</span> &#123; fullPath, meta, name, params, path, query &#125; = to<br>    store.<span class=\"hljs-title function_\">commit</span>(<span class=\"hljs-string\">&#x27;app/addTagsViewList&#x27;</span>, &#123;<br>      fullPath,<br>      meta,<br>      name,<br>      params,<br>      path,<br>      query,<br>      <span class=\"hljs-attr\">title</span>: <span class=\"hljs-title function_\">getTitle</span>(to)<br>    &#125;)<br>  &#125;,<br>  &#123;<br>    <span class=\"hljs-attr\">immediate</span>: <span class=\"hljs-literal\">true</span><br>  &#125;<br>)<br>&lt;/script&gt;<br><br><br></code></pre></td></tr></table></figure>\n</li>\n<li><p>创建 <code>utils/tags</code></p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\"><span class=\"hljs-keyword\">const</span> whiteList = [<span class=\"hljs-string\">&#x27;/login&#x27;</span>, <span class=\"hljs-string\">&#x27;/import&#x27;</span>, <span class=\"hljs-string\">&#x27;/404&#x27;</span>, <span class=\"hljs-string\">&#x27;/401&#x27;</span>]<br><br><span class=\"hljs-comment\">/**</span><br><span class=\"hljs-comment\"> * path 是否需要被缓存</span><br><span class=\"hljs-comment\"> * <span class=\"hljs-doctag\">@param</span> &#123;<span class=\"hljs-type\">*</span>&#125; <span class=\"hljs-variable\">path</span></span><br><span class=\"hljs-comment\"> * <span class=\"hljs-doctag\">@returns</span></span><br><span class=\"hljs-comment\"> */</span><br><span class=\"hljs-keyword\">export</span> <span class=\"hljs-keyword\">function</span> <span class=\"hljs-title function_\">isTags</span>(<span class=\"hljs-params\">path</span>) &#123;<br>  <span class=\"hljs-keyword\">return</span> !whiteList.<span class=\"hljs-title function_\">includes</span>(path)<br>&#125;<br><br></code></pre></td></tr></table></figure>\n\n\n\n</li>\n</ol>\n<h2 id=\"生成-tagsView\"><a href=\"#生成-tagsView\" class=\"headerlink\" title=\"生成 tagsView\"></a>生成 tagsView</h2><p>目前数据已经被保存到 <code>store</code> 中，那么接下来我们就依赖数据渲染 <code>tags</code></p>\n<ol>\n<li><p>创建 <code>store/app</code> 中 <code>tagsViewList</code> 的快捷访问</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\"><span class=\"hljs-attr\">tagsViewList</span>: <span class=\"hljs-function\"><span class=\"hljs-params\">state</span> =&gt;</span> state.<span class=\"hljs-property\">app</span>.<span class=\"hljs-property\">tagsViewList</span><br></code></pre></td></tr></table></figure>\n</li>\n<li><p>创建 <code>components/tagsview</code></p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br><span class=\"line\">103</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\">&lt;template&gt;<br>  <span class=\"language-xml\"><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">div</span> <span class=\"hljs-attr\">class</span>=<span class=\"hljs-string\">&quot;tags-view-container&quot;</span>&gt;</span></span><br><span class=\"language-xml\">      <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">router-link</span></span></span><br><span class=\"hljs-tag\"><span class=\"language-xml\">        <span class=\"hljs-attr\">class</span>=<span class=\"hljs-string\">&quot;tags-view-item&quot;</span></span></span><br><span class=\"hljs-tag\"><span class=\"language-xml\">        <span class=\"hljs-attr\">:class</span>=<span class=\"hljs-string\">&quot;isActive(tag) ? &#x27;active&#x27; : &#x27;&#x27;&quot;</span></span></span><br><span class=\"hljs-tag\"><span class=\"language-xml\">        <span class=\"hljs-attr\">:style</span>=<span class=\"hljs-string\">&quot;&#123;</span></span></span><br><span class=\"hljs-string\"><span class=\"hljs-tag\"><span class=\"language-xml\">          backgroundColor: isActive(tag) ? $store.getters.cssVar.menuBg : &#x27;&#x27;,</span></span></span><br><span class=\"hljs-string\"><span class=\"hljs-tag\"><span class=\"language-xml\">          borderColor: isActive(tag) ? $store.getters.cssVar.menuBg : &#x27;&#x27;</span></span></span><br><span class=\"hljs-string\"><span class=\"hljs-tag\"><span class=\"language-xml\">        &#125;&quot;</span></span></span><br><span class=\"hljs-tag\"><span class=\"language-xml\">        <span class=\"hljs-attr\">v-for</span>=<span class=\"hljs-string\">&quot;(tag, index) in $store.getters.tagsViewList&quot;</span></span></span><br><span class=\"hljs-tag\"><span class=\"language-xml\">        <span class=\"hljs-attr\">:key</span>=<span class=\"hljs-string\">&quot;tag.fullPath&quot;</span></span></span><br><span class=\"hljs-tag\"><span class=\"language-xml\">        <span class=\"hljs-attr\">:to</span>=<span class=\"hljs-string\">&quot;&#123; path: tag.fullPath &#125;&quot;</span></span></span><br><span class=\"hljs-tag\"><span class=\"language-xml\">      &gt;</span></span><br><span class=\"language-xml\">        &#123;&#123; tag.title &#125;&#125;</span><br><span class=\"language-xml\">        <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">i</span></span></span><br><span class=\"hljs-tag\"><span class=\"language-xml\">          <span class=\"hljs-attr\">v-show</span>=<span class=\"hljs-string\">&quot;!isActive(tag)&quot;</span></span></span><br><span class=\"hljs-tag\"><span class=\"language-xml\">          <span class=\"hljs-attr\">class</span>=<span class=\"hljs-string\">&quot;el-icon-close&quot;</span></span></span><br><span class=\"hljs-tag\"><span class=\"language-xml\">          @<span class=\"hljs-attr\">click.prevent.stop</span>=<span class=\"hljs-string\">&quot;onCloseClick(index)&quot;</span></span></span><br><span class=\"hljs-tag\"><span class=\"language-xml\">        /&gt;</span></span><br><span class=\"language-xml\">      <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">router-link</span>&gt;</span></span><br><span class=\"language-xml\">  <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">div</span>&gt;</span></span><br>&lt;/template&gt;<br><br><span class=\"language-xml\"><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">script</span> <span class=\"hljs-attr\">setup</span>&gt;</span><span class=\"language-javascript\"></span></span><br><span class=\"language-javascript\"><span class=\"language-xml\"><span class=\"hljs-keyword\">import</span> &#123; useRoute &#125; <span class=\"hljs-keyword\">from</span> <span class=\"hljs-string\">&#x27;vue-router&#x27;</span></span></span><br><span class=\"language-javascript\"><span class=\"language-xml\"><span class=\"hljs-keyword\">const</span> route = <span class=\"hljs-title function_\">useRoute</span>()</span></span><br><span class=\"language-javascript\"><span class=\"language-xml\"></span></span><br><span class=\"language-javascript\"><span class=\"language-xml\"><span class=\"hljs-comment\">/**</span></span></span><br><span class=\"hljs-comment\"><span class=\"language-javascript\"><span class=\"language-xml\"> * 是否被选中</span></span></span><br><span class=\"hljs-comment\"><span class=\"language-javascript\"><span class=\"language-xml\"> */</span></span></span><br><span class=\"language-javascript\"><span class=\"language-xml\"><span class=\"hljs-keyword\">const</span> <span class=\"hljs-title function_\">isActive</span> = tag =&gt; &#123;</span></span><br><span class=\"language-javascript\"><span class=\"language-xml\">  <span class=\"hljs-keyword\">return</span> tag.<span class=\"hljs-property\">path</span> === route.<span class=\"hljs-property\">path</span></span></span><br><span class=\"language-javascript\"><span class=\"language-xml\">&#125;</span></span><br><span class=\"language-javascript\"><span class=\"language-xml\"></span></span><br><span class=\"language-javascript\"><span class=\"language-xml\"><span class=\"hljs-comment\">/**</span></span></span><br><span class=\"hljs-comment\"><span class=\"language-javascript\"><span class=\"language-xml\"> * 关闭 tag 的点击事件</span></span></span><br><span class=\"hljs-comment\"><span class=\"language-javascript\"><span class=\"language-xml\"> */</span></span></span><br><span class=\"language-javascript\"><span class=\"language-xml\"><span class=\"hljs-keyword\">const</span> <span class=\"hljs-title function_\">onCloseClick</span> = index =&gt; &#123;&#125;</span></span><br><span class=\"language-javascript\"><span class=\"language-xml\"></span><span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">script</span>&gt;</span></span><br><br><span class=\"language-xml\"><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">style</span> <span class=\"hljs-attr\">lang</span>=<span class=\"hljs-string\">&quot;scss&quot;</span> <span class=\"hljs-attr\">scoped</span>&gt;</span><span class=\"language-css\"></span></span><br><span class=\"language-css\"><span class=\"language-xml\"><span class=\"hljs-selector-class\">.tags-view-container</span> &#123;</span></span><br><span class=\"language-css\"><span class=\"language-xml\">  <span class=\"hljs-attribute\">height</span>: <span class=\"hljs-number\">34px</span>;</span></span><br><span class=\"language-css\"><span class=\"language-xml\">  <span class=\"hljs-attribute\">width</span>: <span class=\"hljs-number\">100%</span>;</span></span><br><span class=\"language-css\"><span class=\"language-xml\">  <span class=\"hljs-attribute\">background</span>: <span class=\"hljs-number\">#fff</span>;</span></span><br><span class=\"language-css\"><span class=\"language-xml\">  <span class=\"hljs-attribute\">border-bottom</span>: <span class=\"hljs-number\">1px</span> solid <span class=\"hljs-number\">#d8dce5</span>;</span></span><br><span class=\"language-css\"><span class=\"language-xml\">  <span class=\"hljs-attribute\">box-shadow</span>: <span class=\"hljs-number\">0</span> <span class=\"hljs-number\">1px</span> <span class=\"hljs-number\">3px</span> <span class=\"hljs-number\">0</span> <span class=\"hljs-built_in\">rgba</span>(<span class=\"hljs-number\">0</span>, <span class=\"hljs-number\">0</span>, <span class=\"hljs-number\">0</span>, <span class=\"hljs-number\">0.12</span>), <span class=\"hljs-number\">0</span> <span class=\"hljs-number\">0</span> <span class=\"hljs-number\">3px</span> <span class=\"hljs-number\">0</span> <span class=\"hljs-built_in\">rgba</span>(<span class=\"hljs-number\">0</span>, <span class=\"hljs-number\">0</span>, <span class=\"hljs-number\">0</span>, <span class=\"hljs-number\">0.04</span>);</span></span><br><span class=\"language-css\"><span class=\"language-xml\">    <span class=\"hljs-selector-class\">.tags-view-item</span> &#123;</span></span><br><span class=\"language-css\"><span class=\"language-xml\">      <span class=\"hljs-attribute\">display</span>: inline-block;</span></span><br><span class=\"language-css\"><span class=\"language-xml\">      <span class=\"hljs-attribute\">position</span>: relative;</span></span><br><span class=\"language-css\"><span class=\"language-xml\">      <span class=\"hljs-attribute\">cursor</span>: pointer;</span></span><br><span class=\"language-css\"><span class=\"language-xml\">      <span class=\"hljs-attribute\">height</span>: <span class=\"hljs-number\">26px</span>;</span></span><br><span class=\"language-css\"><span class=\"language-xml\">      <span class=\"hljs-attribute\">line-height</span>: <span class=\"hljs-number\">26px</span>;</span></span><br><span class=\"language-css\"><span class=\"language-xml\">      <span class=\"hljs-attribute\">border</span>: <span class=\"hljs-number\">1px</span> solid <span class=\"hljs-number\">#d8dce5</span>;</span></span><br><span class=\"language-css\"><span class=\"language-xml\">      <span class=\"hljs-attribute\">color</span>: <span class=\"hljs-number\">#495060</span>;</span></span><br><span class=\"language-css\"><span class=\"language-xml\">      <span class=\"hljs-attribute\">background</span>: <span class=\"hljs-number\">#fff</span>;</span></span><br><span class=\"language-css\"><span class=\"language-xml\">      <span class=\"hljs-attribute\">padding</span>: <span class=\"hljs-number\">0</span> <span class=\"hljs-number\">8px</span>;</span></span><br><span class=\"language-css\"><span class=\"language-xml\">      <span class=\"hljs-attribute\">font-size</span>: <span class=\"hljs-number\">12px</span>;</span></span><br><span class=\"language-css\"><span class=\"language-xml\">      <span class=\"hljs-attribute\">margin-left</span>: <span class=\"hljs-number\">5px</span>;</span></span><br><span class=\"language-css\"><span class=\"language-xml\">      <span class=\"hljs-attribute\">margin-top</span>: <span class=\"hljs-number\">4px</span>;</span></span><br><span class=\"language-css\"><span class=\"language-xml\">      &amp;<span class=\"hljs-selector-pseudo\">:first</span>-of-type &#123;</span></span><br><span class=\"language-css\"><span class=\"language-xml\">        <span class=\"hljs-attribute\">margin-left</span>: <span class=\"hljs-number\">15px</span>;</span></span><br><span class=\"language-css\"><span class=\"language-xml\">      &#125;</span></span><br><span class=\"language-css\"><span class=\"language-xml\">      &amp;<span class=\"hljs-selector-pseudo\">:last-of-type</span> &#123;</span></span><br><span class=\"language-css\"><span class=\"language-xml\">        <span class=\"hljs-attribute\">margin-right</span>: <span class=\"hljs-number\">15px</span>;</span></span><br><span class=\"language-css\"><span class=\"language-xml\">      &#125;</span></span><br><span class=\"language-css\"><span class=\"language-xml\">      &amp;<span class=\"hljs-selector-class\">.active</span> &#123;</span></span><br><span class=\"language-css\"><span class=\"language-xml\">        <span class=\"hljs-attribute\">color</span>: <span class=\"hljs-number\">#fff</span>;</span></span><br><span class=\"language-css\"><span class=\"language-xml\">        &amp;<span class=\"hljs-selector-pseudo\">::before</span> &#123;</span></span><br><span class=\"language-css\"><span class=\"language-xml\">          <span class=\"hljs-attribute\">content</span>: <span class=\"hljs-string\">&#x27;&#x27;</span>;</span></span><br><span class=\"language-css\"><span class=\"language-xml\">          <span class=\"hljs-attribute\">background</span>: <span class=\"hljs-number\">#fff</span>;</span></span><br><span class=\"language-css\"><span class=\"language-xml\">          <span class=\"hljs-attribute\">display</span>: inline-block;</span></span><br><span class=\"language-css\"><span class=\"language-xml\">          <span class=\"hljs-attribute\">width</span>: <span class=\"hljs-number\">8px</span>;</span></span><br><span class=\"language-css\"><span class=\"language-xml\">          <span class=\"hljs-attribute\">height</span>: <span class=\"hljs-number\">8px</span>;</span></span><br><span class=\"language-css\"><span class=\"language-xml\">          <span class=\"hljs-attribute\">border-radius</span>: <span class=\"hljs-number\">50%</span>;</span></span><br><span class=\"language-css\"><span class=\"language-xml\">          <span class=\"hljs-attribute\">position</span>: relative;</span></span><br><span class=\"language-css\"><span class=\"language-xml\">          <span class=\"hljs-attribute\">margin-right</span>: <span class=\"hljs-number\">4px</span>;</span></span><br><span class=\"language-css\"><span class=\"language-xml\">        &#125;</span></span><br><span class=\"language-css\"><span class=\"language-xml\">      &#125;</span></span><br><span class=\"language-css\"><span class=\"language-xml\">      // close 按钮</span></span><br><span class=\"language-css\"><span class=\"language-xml\">      <span class=\"hljs-selector-class\">.el-icon-close</span> &#123;</span></span><br><span class=\"language-css\"><span class=\"language-xml\">        <span class=\"hljs-attribute\">width</span>: <span class=\"hljs-number\">16px</span>;</span></span><br><span class=\"language-css\"><span class=\"language-xml\">        <span class=\"hljs-attribute\">height</span>: <span class=\"hljs-number\">16px</span>;</span></span><br><span class=\"language-css\"><span class=\"language-xml\">        <span class=\"hljs-attribute\">line-height</span>: <span class=\"hljs-number\">10px</span>;</span></span><br><span class=\"language-css\"><span class=\"language-xml\">        <span class=\"hljs-attribute\">vertical-align</span>: <span class=\"hljs-number\">2px</span>;</span></span><br><span class=\"language-css\"><span class=\"language-xml\">        <span class=\"hljs-attribute\">border-radius</span>: <span class=\"hljs-number\">50%</span>;</span></span><br><span class=\"language-css\"><span class=\"language-xml\">        <span class=\"hljs-attribute\">text-align</span>: center;</span></span><br><span class=\"language-css\"><span class=\"language-xml\">        <span class=\"hljs-attribute\">transition</span>: all <span class=\"hljs-number\">0.3s</span> <span class=\"hljs-built_in\">cubic-bezier</span>(<span class=\"hljs-number\">0.645</span>, <span class=\"hljs-number\">0.045</span>, <span class=\"hljs-number\">0.355</span>, <span class=\"hljs-number\">1</span>);</span></span><br><span class=\"language-css\"><span class=\"language-xml\">        <span class=\"hljs-attribute\">transform-origin</span>: <span class=\"hljs-number\">100%</span> <span class=\"hljs-number\">50%</span>;</span></span><br><span class=\"language-css\"><span class=\"language-xml\">        &amp;<span class=\"hljs-selector-pseudo\">:before</span> &#123;</span></span><br><span class=\"language-css\"><span class=\"language-xml\">          <span class=\"hljs-attribute\">transform</span>: <span class=\"hljs-built_in\">scale</span>(<span class=\"hljs-number\">0.6</span>);</span></span><br><span class=\"language-css\"><span class=\"language-xml\">          <span class=\"hljs-attribute\">display</span>: inline-block;</span></span><br><span class=\"language-css\"><span class=\"language-xml\">          <span class=\"hljs-attribute\">vertical-align</span>: -<span class=\"hljs-number\">3px</span>;</span></span><br><span class=\"language-css\"><span class=\"language-xml\">        &#125;</span></span><br><span class=\"language-css\"><span class=\"language-xml\">        &amp;<span class=\"hljs-selector-pseudo\">:hover</span> &#123;</span></span><br><span class=\"language-css\"><span class=\"language-xml\">          <span class=\"hljs-attribute\">background-color</span>: <span class=\"hljs-number\">#b4bccc</span>;</span></span><br><span class=\"language-css\"><span class=\"language-xml\">          <span class=\"hljs-attribute\">color</span>: <span class=\"hljs-number\">#fff</span>;</span></span><br><span class=\"language-css\"><span class=\"language-xml\">        &#125;</span></span><br><span class=\"language-css\"><span class=\"language-xml\">      &#125;</span></span><br><span class=\"language-css\"><span class=\"language-xml\">    </span></span><br><span class=\"language-css\"><span class=\"language-xml\">  &#125;</span></span><br><span class=\"language-css\"><span class=\"language-xml\">&#125;</span></span><br><span class=\"language-css\"><span class=\"language-xml\"></span><span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">style</span>&gt;</span></span><br></code></pre></td></tr></table></figure>\n</li>\n<li><p>在 <code>layout/index</code> 中导入</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\">&lt;div <span class=\"hljs-keyword\">class</span>=<span class=\"hljs-string\">&quot;fixed-header&quot;</span>&gt;<br>    &lt;!-- 顶部的 navbar --&gt;<br>    <span class=\"language-xml\"><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">navbar</span> /&gt;</span></span><br>    &lt;!-- tags --&gt;<br>    <span class=\"language-xml\"><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">tags-view</span>&gt;</span><span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">tags-view</span>&gt;</span></span><br>&lt;/div&gt;<br><br><span class=\"hljs-keyword\">import</span> <span class=\"hljs-title class_\">TagsView</span> <span class=\"hljs-keyword\">from</span> <span class=\"hljs-string\">&#x27;@/components/TagsView&#x27;</span><br><br></code></pre></td></tr></table></figure>\n\n\n\n</li>\n</ol>\n<h2 id=\"tagsView-国际化处理\"><a href=\"#tagsView-国际化处理\" class=\"headerlink\" title=\"tagsView 国际化处理\"></a>tagsView 国际化处理</h2><p><code>tagsView</code> 的国际化处理可以理解为修改现有 <code>tags</code> 的 <code>title</code>。</p>\n<p>所以我们只需要：</p>\n<ol>\n<li>监听到语言变化</li>\n<li>国际化对应的 <code>title</code> 即可</li>\n</ol>\n<p>根据方案，可生成如下代码：</p>\n<ol>\n<li><p>在 <code>store/app</code> 中，创建修改 <code>ttile</code> 的 <code>mutations</code></p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\"><span class=\"hljs-comment\">/**</span><br><span class=\"hljs-comment\">* 为指定的 tag 修改 title</span><br><span class=\"hljs-comment\">*/</span><br><span class=\"hljs-title function_\">changeTagsView</span>(<span class=\"hljs-params\">state, &#123; index, tag &#125;</span>) &#123;<br>    state.<span class=\"hljs-property\">tagsViewList</span>[index] = tag<br>    <span class=\"hljs-title function_\">setItem</span>(<span class=\"hljs-variable constant_\">TAGS_VIEW</span>, state.<span class=\"hljs-property\">tagsViewList</span>)<br>&#125;<br></code></pre></td></tr></table></figure>\n\n\n\n</li>\n</ol>\n<ol start=\"2\">\n<li><p>在 <code>appmain</code> 中监听语言变化</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\"><span class=\"hljs-keyword\">import</span> &#123; generateTitle, watchSwitchLang &#125; <span class=\"hljs-keyword\">from</span> <span class=\"hljs-string\">&#x27;@/utils/i18n&#x27;</span><br><br><span class=\"hljs-comment\">/**</span><br><span class=\"hljs-comment\"> * 国际化 tags</span><br><span class=\"hljs-comment\"> */</span><br><span class=\"hljs-title function_\">watchSwitchLang</span>(<span class=\"hljs-function\">() =&gt;</span> &#123;<br>  store.<span class=\"hljs-property\">getters</span>.<span class=\"hljs-property\">tagsViewList</span>.<span class=\"hljs-title function_\">forEach</span>(<span class=\"hljs-function\">(<span class=\"hljs-params\">route, index</span>) =&gt;</span> &#123;<br>    store.<span class=\"hljs-title function_\">commit</span>(<span class=\"hljs-string\">&#x27;app/changeTagsView&#x27;</span>, &#123;<br>      index,<br>      <span class=\"hljs-attr\">tag</span>: &#123;<br>        ...route,<br>        <span class=\"hljs-attr\">title</span>: <span class=\"hljs-title function_\">getTitle</span>(route)<br>      &#125;<br>    &#125;)<br>  &#125;)<br>&#125;)<br></code></pre></td></tr></table></figure>\n\n\n\n</li>\n</ol>\n<h2 id=\"contextMenu-展示处理\"><a href=\"#contextMenu-展示处理\" class=\"headerlink\" title=\"contextMenu 展示处理\"></a>contextMenu 展示处理</h2><blockquote>\n<p><a href=\"https://developer.mozilla.org/zh-CN/docs/Web/API/Element/contextmenu_event\">contextMenu</a> 为 鼠标右键事件</p>\n</blockquote>\n<p><a href=\"https://developer.mozilla.org/zh-CN/docs/Web/API/Element/contextmenu_event\">contextMenu</a> 事件的处理分为两部分：</p>\n<ol>\n<li><code>contextMenu</code> 的展示</li>\n<li>右键项对应逻辑处理</li>\n</ol>\n<p>那么这一小节我们先处理第一部分：<code>contextMenu</code> 的展示：</p>\n<ol>\n<li><p>创建 <code>components/TagsView/ContextMenu</code> 组件，作为右键展示部分</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\">&lt;template&gt;<br>  <span class=\"language-xml\"><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">ul</span> <span class=\"hljs-attr\">class</span>=<span class=\"hljs-string\">&quot;context-menu-container&quot;</span>&gt;</span></span><br><span class=\"language-xml\">    <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">li</span> @<span class=\"hljs-attr\">click</span>=<span class=\"hljs-string\">&quot;onRefreshClick&quot;</span>&gt;</span></span><br><span class=\"language-xml\">      &#123;&#123; $t(&#x27;msg.tagsView.refresh&#x27;) &#125;&#125;</span><br><span class=\"language-xml\">    <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">li</span>&gt;</span></span><br><span class=\"language-xml\">    <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">li</span> @<span class=\"hljs-attr\">click</span>=<span class=\"hljs-string\">&quot;onCloseRightClick&quot;</span>&gt;</span></span><br><span class=\"language-xml\">      &#123;&#123; $t(&#x27;msg.tagsView.closeRight&#x27;) &#125;&#125;</span><br><span class=\"language-xml\">    <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">li</span>&gt;</span></span><br><span class=\"language-xml\">    <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">li</span> @<span class=\"hljs-attr\">click</span>=<span class=\"hljs-string\">&quot;onCloseOtherClick&quot;</span>&gt;</span></span><br><span class=\"language-xml\">      &#123;&#123; $t(&#x27;msg.tagsView.closeOther&#x27;) &#125;&#125;</span><br><span class=\"language-xml\">    <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">li</span>&gt;</span></span><br><span class=\"language-xml\">  <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">ul</span>&gt;</span></span><br>&lt;/template&gt;<br><br><span class=\"language-xml\"><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">script</span> <span class=\"hljs-attr\">setup</span>&gt;</span><span class=\"language-javascript\"></span></span><br><span class=\"language-javascript\"><span class=\"language-xml\"><span class=\"hljs-keyword\">import</span> &#123; defineProps &#125; <span class=\"hljs-keyword\">from</span> <span class=\"hljs-string\">&#x27;vue&#x27;</span></span></span><br><span class=\"language-javascript\"><span class=\"language-xml\"><span class=\"hljs-title function_\">defineProps</span>(&#123;</span></span><br><span class=\"language-javascript\"><span class=\"language-xml\">  <span class=\"hljs-attr\">index</span>: &#123;</span></span><br><span class=\"language-javascript\"><span class=\"language-xml\">    <span class=\"hljs-attr\">type</span>: <span class=\"hljs-title class_\">Number</span>,</span></span><br><span class=\"language-javascript\"><span class=\"language-xml\">    <span class=\"hljs-attr\">required</span>: <span class=\"hljs-literal\">true</span></span></span><br><span class=\"language-javascript\"><span class=\"language-xml\">  &#125;</span></span><br><span class=\"language-javascript\"><span class=\"language-xml\">&#125;)</span></span><br><span class=\"language-javascript\"><span class=\"language-xml\"></span></span><br><span class=\"language-javascript\"><span class=\"language-xml\"><span class=\"hljs-keyword\">const</span> <span class=\"hljs-title function_\">onRefreshClick</span> = (<span class=\"hljs-params\"></span>) =&gt; &#123;&#125;</span></span><br><span class=\"language-javascript\"><span class=\"language-xml\"></span></span><br><span class=\"language-javascript\"><span class=\"language-xml\"><span class=\"hljs-keyword\">const</span> <span class=\"hljs-title function_\">onCloseRightClick</span> = (<span class=\"hljs-params\"></span>) =&gt; &#123;&#125;</span></span><br><span class=\"language-javascript\"><span class=\"language-xml\"></span></span><br><span class=\"language-javascript\"><span class=\"language-xml\"><span class=\"hljs-keyword\">const</span> <span class=\"hljs-title function_\">onCloseOtherClick</span> = (<span class=\"hljs-params\"></span>) =&gt; &#123;&#125;</span></span><br><span class=\"language-javascript\"><span class=\"language-xml\"></span><span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">script</span>&gt;</span></span><br><br><span class=\"language-xml\"><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">style</span> <span class=\"hljs-attr\">lang</span>=<span class=\"hljs-string\">&quot;scss&quot;</span> <span class=\"hljs-attr\">scoped</span>&gt;</span><span class=\"language-css\"></span></span><br><span class=\"language-css\"><span class=\"language-xml\"><span class=\"hljs-selector-class\">.context-menu-container</span> &#123;</span></span><br><span class=\"language-css\"><span class=\"language-xml\">  <span class=\"hljs-attribute\">position</span>: fixed;</span></span><br><span class=\"language-css\"><span class=\"language-xml\">  <span class=\"hljs-attribute\">background</span>: <span class=\"hljs-number\">#fff</span>;</span></span><br><span class=\"language-css\"><span class=\"language-xml\">  <span class=\"hljs-attribute\">z-index</span>: <span class=\"hljs-number\">3000</span>;</span></span><br><span class=\"language-css\"><span class=\"language-xml\">  <span class=\"hljs-attribute\">list-style-type</span>: none;</span></span><br><span class=\"language-css\"><span class=\"language-xml\">  <span class=\"hljs-attribute\">padding</span>: <span class=\"hljs-number\">5px</span> <span class=\"hljs-number\">0</span>;</span></span><br><span class=\"language-css\"><span class=\"language-xml\">  <span class=\"hljs-attribute\">border-radius</span>: <span class=\"hljs-number\">4px</span>;</span></span><br><span class=\"language-css\"><span class=\"language-xml\">  <span class=\"hljs-attribute\">font-size</span>: <span class=\"hljs-number\">12px</span>;</span></span><br><span class=\"language-css\"><span class=\"language-xml\">  <span class=\"hljs-attribute\">font-weight</span>: <span class=\"hljs-number\">400</span>;</span></span><br><span class=\"language-css\"><span class=\"language-xml\">  <span class=\"hljs-attribute\">color</span>: <span class=\"hljs-number\">#333</span>;</span></span><br><span class=\"language-css\"><span class=\"language-xml\">  <span class=\"hljs-attribute\">box-shadow</span>: <span class=\"hljs-number\">2px</span> <span class=\"hljs-number\">2px</span> <span class=\"hljs-number\">3px</span> <span class=\"hljs-number\">0</span> <span class=\"hljs-built_in\">rgba</span>(<span class=\"hljs-number\">0</span>, <span class=\"hljs-number\">0</span>, <span class=\"hljs-number\">0</span>, <span class=\"hljs-number\">0.3</span>);</span></span><br><span class=\"language-css\"><span class=\"language-xml\">  <span class=\"hljs-selector-tag\">li</span> &#123;</span></span><br><span class=\"language-css\"><span class=\"language-xml\">    <span class=\"hljs-attribute\">margin</span>: <span class=\"hljs-number\">0</span>;</span></span><br><span class=\"language-css\"><span class=\"language-xml\">    <span class=\"hljs-attribute\">padding</span>: <span class=\"hljs-number\">7px</span> <span class=\"hljs-number\">16px</span>;</span></span><br><span class=\"language-css\"><span class=\"language-xml\">    <span class=\"hljs-attribute\">cursor</span>: pointer;</span></span><br><span class=\"language-css\"><span class=\"language-xml\">    &amp;<span class=\"hljs-selector-pseudo\">:hover</span> &#123;</span></span><br><span class=\"language-css\"><span class=\"language-xml\">      <span class=\"hljs-attribute\">background</span>: <span class=\"hljs-number\">#eee</span>;</span></span><br><span class=\"language-css\"><span class=\"language-xml\">    &#125;</span></span><br><span class=\"language-css\"><span class=\"language-xml\">  &#125;</span></span><br><span class=\"language-css\"><span class=\"language-xml\">&#125;</span></span><br><span class=\"language-css\"><span class=\"language-xml\"></span><span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">style</span>&gt;</span></span><br><br></code></pre></td></tr></table></figure>\n</li>\n<li><p>在 <code>tagsview</code> 中控制 <code>contextMenu</code> 的展示</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\">&lt;template&gt;<br>  <span class=\"language-xml\"><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">div</span> <span class=\"hljs-attr\">class</span>=<span class=\"hljs-string\">&quot;tags-view-container&quot;</span>&gt;</span></span><br><span class=\"language-xml\">    <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">el-scrollbar</span> <span class=\"hljs-attr\">class</span>=<span class=\"hljs-string\">&quot;tags-view-wrapper&quot;</span>&gt;</span></span><br><span class=\"language-xml\">      <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">router-link</span></span></span><br><span class=\"hljs-tag\"><span class=\"language-xml\">        <span class=\"hljs-attr\">...</span></span></span><br><span class=\"hljs-tag\"><span class=\"language-xml\">        @<span class=\"hljs-attr\">contextmenu.prevent</span>=<span class=\"hljs-string\">&quot;openMenu($event, index)&quot;</span></span></span><br><span class=\"hljs-tag\"><span class=\"language-xml\">      &gt;</span></span><br><span class=\"language-xml\">        ...</span><br><span class=\"language-xml\">    <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">el-scrollbar</span>&gt;</span></span><br><span class=\"language-xml\">    <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">context-menu</span></span></span><br><span class=\"hljs-tag\"><span class=\"language-xml\">      <span class=\"hljs-attr\">v-show</span>=<span class=\"hljs-string\">&quot;visible&quot;</span></span></span><br><span class=\"hljs-tag\"><span class=\"language-xml\">      <span class=\"hljs-attr\">:style</span>=<span class=\"hljs-string\">&quot;menuStyle&quot;</span></span></span><br><span class=\"hljs-tag\"><span class=\"language-xml\">      <span class=\"hljs-attr\">:index</span>=<span class=\"hljs-string\">&quot;selectIndex&quot;</span></span></span><br><span class=\"hljs-tag\"><span class=\"language-xml\">    &gt;</span><span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">context-menu</span>&gt;</span></span><br><span class=\"language-xml\">  <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">div</span>&gt;</span></span><br><span class=\"language-xml\"><span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">template</span>&gt;</span></span><br><br><span class=\"language-xml\"><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">script</span> <span class=\"hljs-attr\">setup</span>&gt;</span><span class=\"language-javascript\"></span></span><br><span class=\"language-javascript\"><span class=\"language-xml\"><span class=\"hljs-keyword\">import</span> <span class=\"hljs-title class_\">ContextMenu</span> <span class=\"hljs-keyword\">from</span> <span class=\"hljs-string\">&#x27;./ContextMenu.vue&#x27;</span></span></span><br><span class=\"language-javascript\"><span class=\"language-xml\"><span class=\"hljs-keyword\">import</span> &#123; ref, reactive, watch &#125; <span class=\"hljs-keyword\">from</span> <span class=\"hljs-string\">&#x27;vue&#x27;</span></span></span><br><span class=\"language-javascript\"><span class=\"language-xml\"><span class=\"hljs-keyword\">import</span> &#123; useRoute &#125; <span class=\"hljs-keyword\">from</span> <span class=\"hljs-string\">&#x27;vue-router&#x27;</span></span></span><br><span class=\"language-javascript\"><span class=\"language-xml\">...</span></span><br><span class=\"language-javascript\"><span class=\"language-xml\"></span></span><br><span class=\"language-javascript\"><span class=\"language-xml\"><span class=\"hljs-comment\">// contextMenu 相关</span></span></span><br><span class=\"language-javascript\"><span class=\"language-xml\"><span class=\"hljs-keyword\">const</span> selectIndex = <span class=\"hljs-title function_\">ref</span>(<span class=\"hljs-number\">0</span>)</span></span><br><span class=\"language-javascript\"><span class=\"language-xml\"><span class=\"hljs-keyword\">const</span> visible = <span class=\"hljs-title function_\">ref</span>(<span class=\"hljs-literal\">false</span>)</span></span><br><span class=\"language-javascript\"><span class=\"language-xml\"><span class=\"hljs-keyword\">const</span> menuStyle = <span class=\"hljs-title function_\">reactive</span>(&#123;</span></span><br><span class=\"language-javascript\"><span class=\"language-xml\">  <span class=\"hljs-attr\">left</span>: <span class=\"hljs-number\">0</span>,</span></span><br><span class=\"language-javascript\"><span class=\"language-xml\">  <span class=\"hljs-attr\">top</span>: <span class=\"hljs-number\">0</span></span></span><br><span class=\"language-javascript\"><span class=\"language-xml\">&#125;)</span></span><br><span class=\"language-javascript\"><span class=\"language-xml\"><span class=\"hljs-comment\">/**</span></span></span><br><span class=\"hljs-comment\"><span class=\"language-javascript\"><span class=\"language-xml\"> * 展示 menu</span></span></span><br><span class=\"hljs-comment\"><span class=\"language-javascript\"><span class=\"language-xml\"> */</span></span></span><br><span class=\"language-javascript\"><span class=\"language-xml\"><span class=\"hljs-keyword\">const</span> <span class=\"hljs-title function_\">openMenu</span> = (<span class=\"hljs-params\">e, index</span>) =&gt; &#123;</span></span><br><span class=\"language-javascript\"><span class=\"language-xml\">  <span class=\"hljs-keyword\">const</span> &#123; x, y &#125; = e</span></span><br><span class=\"language-javascript\"><span class=\"language-xml\">  menuStyle.<span class=\"hljs-property\">left</span> = x + <span class=\"hljs-string\">&#x27;px&#x27;</span></span></span><br><span class=\"language-javascript\"><span class=\"language-xml\">  menuStyle.<span class=\"hljs-property\">top</span> = y + <span class=\"hljs-string\">&#x27;px&#x27;</span></span></span><br><span class=\"language-javascript\"><span class=\"language-xml\">  selectIndex.<span class=\"hljs-property\">value</span> = index</span></span><br><span class=\"language-javascript\"><span class=\"language-xml\">  visible.<span class=\"hljs-property\">value</span> = <span class=\"hljs-literal\">true</span></span></span><br><span class=\"language-javascript\"><span class=\"language-xml\">&#125;</span></span><br><span class=\"language-javascript\"><span class=\"language-xml\"></span></span><br><span class=\"language-javascript\"><span class=\"language-xml\"></span></span><br><span class=\"language-javascript\"><span class=\"language-xml\"></span><span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">script</span>&gt;</span></span><br></code></pre></td></tr></table></figure>\n\n\n\n</li>\n</ol>\n<h2 id=\"contextMenu-事件处理\"><a href=\"#contextMenu-事件处理\" class=\"headerlink\" title=\"contextMenu 事件处理\"></a>contextMenu 事件处理</h2><p>对于 <code>contextMenu</code> 的事件一共分为三个：</p>\n<ol>\n<li>刷新</li>\n<li>关闭右侧</li>\n<li>关闭所有</li>\n</ol>\n<p>但是不要忘记，我们之前 <strong>关闭单个 <code>tags</code></strong> 的事件还没有进行处理，所以这一小节我们一共需要处理 4 个对应的事件</p>\n<ol>\n<li><p>刷新事件</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\"><span class=\"hljs-keyword\">const</span> router = <span class=\"hljs-title function_\">useRouter</span>()<br><span class=\"hljs-keyword\">const</span> <span class=\"hljs-title function_\">onRefreshClick</span> = (<span class=\"hljs-params\"></span>) =&gt; &#123;<br>  router.<span class=\"hljs-title function_\">go</span>(<span class=\"hljs-number\">0</span>)<br>&#125;<br></code></pre></td></tr></table></figure>\n</li>\n<li><p>在 <code>store/app</code> 中，创建删除 <code>tags</code> 的 <code>mutations</code>，该 <code>mutations</code> 需要同时具备以下三个能力：</p>\n<ol>\n<li>删除 “右侧”</li>\n<li>删除 “其他”</li>\n<li>删除 “当前”</li>\n</ol>\n</li>\n<li><p>根据以上理论得出以下代码：</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\"><span class=\"hljs-comment\">/**</span><br><span class=\"hljs-comment\">* 删除 tag</span><br><span class=\"hljs-comment\">* <span class=\"hljs-doctag\">@param</span> &#123;<span class=\"hljs-type\">type: &#x27;other&#x27;||&#x27;right&#x27;||&#x27;index&#x27;, index: index</span>&#125; <span class=\"hljs-variable\">payload</span></span><br><span class=\"hljs-comment\">*/</span><br><span class=\"hljs-title function_\">removeTagsView</span>(<span class=\"hljs-params\">state, payload</span>) &#123;<br>  <span class=\"hljs-keyword\">if</span> (payload.<span class=\"hljs-property\">type</span> === <span class=\"hljs-string\">&#x27;index&#x27;</span>) &#123;<br>    state.<span class=\"hljs-property\">tagsViewList</span>.<span class=\"hljs-title function_\">splice</span>(payload.<span class=\"hljs-property\">index</span>, <span class=\"hljs-number\">1</span>)<br>    <span class=\"hljs-keyword\">return</span><br>  &#125; <span class=\"hljs-keyword\">else</span> <span class=\"hljs-keyword\">if</span> (payload.<span class=\"hljs-property\">type</span> === <span class=\"hljs-string\">&#x27;other&#x27;</span>) &#123;<br>    state.<span class=\"hljs-property\">tagsViewList</span>.<span class=\"hljs-title function_\">splice</span>(<br>      payload.<span class=\"hljs-property\">index</span> + <span class=\"hljs-number\">1</span>,<br>      state.<span class=\"hljs-property\">tagsViewList</span>.<span class=\"hljs-property\">length</span> - payload.<span class=\"hljs-property\">index</span> + <span class=\"hljs-number\">1</span><br>    )<br>    state.<span class=\"hljs-property\">tagsViewList</span>.<span class=\"hljs-title function_\">splice</span>(<span class=\"hljs-number\">0</span>, payload.<span class=\"hljs-property\">index</span>)<br>  &#125; <span class=\"hljs-keyword\">else</span> <span class=\"hljs-keyword\">if</span> (payload.<span class=\"hljs-property\">type</span> === <span class=\"hljs-string\">&#x27;right&#x27;</span>) &#123;<br>    state.<span class=\"hljs-property\">tagsViewList</span>.<span class=\"hljs-title function_\">splice</span>(<br>      payload.<span class=\"hljs-property\">index</span> + <span class=\"hljs-number\">1</span>,<br>      state.<span class=\"hljs-property\">tagsViewList</span>.<span class=\"hljs-property\">length</span> - payload.<span class=\"hljs-property\">index</span> + <span class=\"hljs-number\">1</span><br>    )<br>  &#125;<br>  <span class=\"hljs-title function_\">setItem</span>(<span class=\"hljs-variable constant_\">TAGS_VIEW</span>, state.<span class=\"hljs-property\">tagsViewList</span>)<br>&#125;,<br></code></pre></td></tr></table></figure>\n</li>\n<li><p>关闭右侧事件</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\"><span class=\"hljs-keyword\">const</span> store = <span class=\"hljs-title function_\">useStore</span>()<br><span class=\"hljs-keyword\">const</span> <span class=\"hljs-title function_\">onCloseRightClick</span> = (<span class=\"hljs-params\"></span>) =&gt; &#123;<br>  store.<span class=\"hljs-title function_\">commit</span>(<span class=\"hljs-string\">&#x27;app/removeTagsView&#x27;</span>, &#123;<br>    <span class=\"hljs-attr\">type</span>: <span class=\"hljs-string\">&#x27;right&#x27;</span>,<br>    <span class=\"hljs-attr\">index</span>: props.<span class=\"hljs-property\">index</span><br>  &#125;)<br>&#125;<br></code></pre></td></tr></table></figure>\n</li>\n<li><p>关闭其他</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\"><span class=\"hljs-keyword\">const</span> <span class=\"hljs-title function_\">onCloseOtherClick</span> = (<span class=\"hljs-params\"></span>) =&gt; &#123;<br>  store.<span class=\"hljs-title function_\">commit</span>(<span class=\"hljs-string\">&#x27;app/removeTagsView&#x27;</span>, &#123;<br>    <span class=\"hljs-attr\">type</span>: <span class=\"hljs-string\">&#x27;other&#x27;</span>,<br>    <span class=\"hljs-attr\">index</span>: props.<span class=\"hljs-property\">index</span><br>  &#125;)<br>&#125;<br></code></pre></td></tr></table></figure>\n</li>\n<li><p>关闭当前（<code>tagsview</code>）</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\"><span class=\"hljs-comment\">/**</span><br><span class=\"hljs-comment\"> * 关闭 tag 的点击事件</span><br><span class=\"hljs-comment\"> */</span><br><span class=\"hljs-keyword\">const</span> store = <span class=\"hljs-title function_\">useStore</span>()<br><span class=\"hljs-keyword\">const</span> <span class=\"hljs-title function_\">onCloseClick</span> = index =&gt; &#123;<br>  store.<span class=\"hljs-title function_\">commit</span>(<span class=\"hljs-string\">&#x27;app/removeTagsView&#x27;</span>, &#123;<br>    <span class=\"hljs-attr\">type</span>: <span class=\"hljs-string\">&#x27;index&#x27;</span>,<br>    <span class=\"hljs-attr\">index</span>: index<br>  &#125;)<br>&#125;<br></code></pre></td></tr></table></figure>\n\n\n\n</li>\n</ol>\n<h2 id=\"处理-contextMenu-的关闭行为\"><a href=\"#处理-contextMenu-的关闭行为\" class=\"headerlink\" title=\"处理 contextMenu 的关闭行为\"></a>处理 contextMenu 的关闭行为</h2><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\"><span class=\"hljs-comment\">/**</span><br><span class=\"hljs-comment\"> * 关闭 menu</span><br><span class=\"hljs-comment\"> */</span><br><span class=\"hljs-keyword\">const</span> <span class=\"hljs-title function_\">closeMenu</span> = (<span class=\"hljs-params\"></span>) =&gt; &#123;<br>  visible.<span class=\"hljs-property\">value</span> = <span class=\"hljs-literal\">false</span><br>&#125;<br><br><span class=\"hljs-comment\">/**</span><br><span class=\"hljs-comment\"> * 监听变化</span><br><span class=\"hljs-comment\"> */</span><br><span class=\"hljs-title function_\">watch</span>(visible, <span class=\"hljs-function\"><span class=\"hljs-params\">val</span> =&gt;</span> &#123;<br>  <span class=\"hljs-keyword\">if</span> (val) &#123;<br>    <span class=\"hljs-variable language_\">document</span>.<span class=\"hljs-property\">body</span>.<span class=\"hljs-title function_\">addEventListener</span>(<span class=\"hljs-string\">&#x27;click&#x27;</span>, closeMenu)<br>  &#125; <span class=\"hljs-keyword\">else</span> &#123;<br>    <span class=\"hljs-variable language_\">document</span>.<span class=\"hljs-property\">body</span>.<span class=\"hljs-title function_\">removeEventListener</span>(<span class=\"hljs-string\">&#x27;click&#x27;</span>, closeMenu)<br>  &#125;<br>&#125;)<br></code></pre></td></tr></table></figure>\n\n\n<h2 id=\"处理基于路由的动态过渡\"><a href=\"#处理基于路由的动态过渡\" class=\"headerlink\" title=\"处理基于路由的动态过渡\"></a>处理基于路由的动态过渡</h2><p><a href=\"https://next.router.vuejs.org/zh/guide/advanced/transitions.html#%E5%9F%BA%E4%BA%8E%E8%B7%AF%E7%94%B1%E7%9A%84%E5%8A%A8%E6%80%81%E8%BF%87%E6%B8%A1\">处理基于路由的动态过渡</a>  官方已经给出了示例代码，结合 <code>router-view</code> 和 <code>transition</code> 我们可以非常方便的实现这个功能</p>\n<ol>\n<li><p>在 <code>appmain</code> 中处理对应代码逻辑</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\">&lt;template&gt;<br>  <span class=\"language-xml\"><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">div</span> <span class=\"hljs-attr\">class</span>=<span class=\"hljs-string\">&quot;app-main&quot;</span>&gt;</span></span><br><span class=\"language-xml\">    <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">router-view</span> <span class=\"hljs-attr\">v-slot</span>=<span class=\"hljs-string\">&quot;&#123; Component, route &#125;&quot;</span>&gt;</span></span><br><span class=\"language-xml\">      <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">transition</span> <span class=\"hljs-attr\">name</span>=<span class=\"hljs-string\">&quot;fade-transform&quot;</span> <span class=\"hljs-attr\">mode</span>=<span class=\"hljs-string\">&quot;out-in&quot;</span>&gt;</span></span><br><span class=\"language-xml\">        <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">keep-alive</span>&gt;</span></span><br><span class=\"language-xml\">          <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">component</span> <span class=\"hljs-attr\">:is</span>=<span class=\"hljs-string\">&quot;Component&quot;</span> <span class=\"hljs-attr\">:key</span>=<span class=\"hljs-string\">&quot;route.path&quot;</span> /&gt;</span></span><br><span class=\"language-xml\">        <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">keep-alive</span>&gt;</span></span><br><span class=\"language-xml\">      <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">transition</span>&gt;</span></span><br><span class=\"language-xml\">    <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">router-view</span>&gt;</span></span><br><span class=\"language-xml\">  <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">div</span>&gt;</span></span><br>&lt;/template&gt;<br></code></pre></td></tr></table></figure>\n</li>\n<li><p>增加了 <code>tags</code> 之后，<code>app-main</code> 的位置需要进行以下处理</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\">&lt;style lang=<span class=\"hljs-string\">&quot;scss&quot;</span> scoped&gt;<br>.<span class=\"hljs-property\">app</span>-main &#123;<br>  min-<span class=\"hljs-attr\">height</span>: <span class=\"hljs-title function_\">calc</span>(100vh - 50px - 43px);<br>  ...<br>  <span class=\"hljs-attr\">padding</span>: 104px 20px 20px 20px;<br>  ...<br>&#125;<br>&lt;/style&gt;<br></code></pre></td></tr></table></figure>\n</li>\n<li><p>在 <code>styles/transition</code> 中增加动画渲染</p>\n<figure class=\"highlight scss\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs scss\"><span class=\"hljs-comment\">/* fade-transform */</span><br><span class=\"hljs-selector-class\">.fade-transform-leave-active</span>,<br><span class=\"hljs-selector-class\">.fade-transform-enter-active</span> &#123;<br>  <span class=\"hljs-attribute\">transition</span>: all <span class=\"hljs-number\">0.5s</span>;<br>&#125;<br><br><span class=\"hljs-selector-class\">.fade-transform-enter-from</span> &#123;<br>  <span class=\"hljs-attribute\">opacity</span>: <span class=\"hljs-number\">0</span>;<br>  <span class=\"hljs-attribute\">transform</span>: translateX(-<span class=\"hljs-number\">30px</span>);<br>&#125;<br><br><span class=\"hljs-selector-class\">.fade-transform-leave-to</span> &#123;<br>  <span class=\"hljs-attribute\">opacity</span>: <span class=\"hljs-number\">0</span>;<br>  <span class=\"hljs-attribute\">transform</span>: translateX(<span class=\"hljs-number\">30px</span>);<br>&#125;<br></code></pre></td></tr></table></figure>\n\n\n\n</li>\n</ol>\n<h2 id=\"tagsView-方案总结\"><a href=\"#tagsView-方案总结\" class=\"headerlink\" title=\"tagsView 方案总结\"></a>tagsView 方案总结</h2><p>那么到这里关于 <code>tagsView</code> 的内容我们就已经处理完成了。</p>\n<p>整个 <code>tagsView</code> 就像我们之前说的，拆开来看之后，会显得明确很多。</p>\n<p>整个 <code>tagsView</code> 整体来看就是三块大的内容：</p>\n<ol>\n<li><code>tags</code>：<code>tagsView</code> 组件</li>\n<li><code>contextMenu</code>：<code>contextMenu</code> 组件</li>\n<li><code>view</code>：<code>appmain</code> 组件</li>\n</ol>\n<p>再加上一部分的数据处理即可。</p>\n<p>最后关于 <code>tags</code> 的国际化部分，其实处理的方案有非常多，大家也可以在后面的 <strong>讨论题</strong> 中探讨一下关于 <strong>此处国家化</strong> 的实现，相信会有很多新的思路被打开的。</p>\n","site":{"data":{}},"wordcount":21494,"more":"<h1 id=\"screenfull\"><a href=\"#screenfull\" class=\"headerlink\" title=\"screenfull\"></a>screenfull</h1><p>对于 <code>screenfull</code> 和之前一样 ，我们还是先分析它的原理，然后在制定对应的方案实现</p>\n<p><strong>原理：</strong></p>\n<p>对于 <code>screenfull</code> 而言，浏览器本身已经提供了对用的 <code>API</code>，<a href=\"https://developer.mozilla.org/zh-CN/docs/Web/API/Fullscreen_API\">点击这里即可查看</a>，这个 <code>API</code> 中，主要提供了两个方法：</p>\n<ol>\n<li><a href=\"https://developer.mozilla.org/zh-CN/docs/Web/API/Document/exitFullscreen\"><code>Document.exitFullscreen()</code></a>：该方法用于请求从全屏模式切换到窗口模式</li>\n<li><a href=\"https://developer.mozilla.org/zh-CN/docs/Web/API/Element/requestFullScreen\"><code>Element.requestFullscreen()</code></a>：该方法用于请求浏览器（user agent）将特定元素（甚至延伸到它的后代元素）置为全屏模式<ol>\n<li>比如我们可以通过 <code>document.getElementById(&#39;app&#39;).requestFullscreen()</code> 在获取 <code>id=app</code> 的 <code>DOM</code> 之后，把该区域置为全屏</li>\n</ol>\n</li>\n</ol>\n<p>但是该方法存在一定的小问题，兼容性也不是那么好。</p>\n<p>所以通常情况下我们不会直接使用该 <code>API</code> 来去实现全屏效果，而是会使用它的包装库 <a href=\"https://www.npmjs.com/package/screenfull\">screenfull</a></p>\n<p>整体的方案实现分为两步：</p>\n<ol>\n<li>封装 <code>screenfull</code> 组件<ol>\n<li>展示切换按钮</li>\n<li>基于 <a href=\"https://www.npmjs.com/package/screenfull\">screenfull</a> 实现切换功能</li>\n</ol>\n</li>\n<li>在 <code>navbar</code> 中引入该组件</li>\n</ol>\n<p>明确好了方案之后，接下来我们就落地该方案</p>\n<p><strong>封装 <code>screenfull</code> 组件：</strong></p>\n<ol>\n<li>下来依赖包  <a href=\"https://www.npmjs.com/package/screenfull\">screenfull</a> </li>\n</ol>\n<figure class=\"highlight apache\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs apache\"><span class=\"hljs-attribute\">npm</span> i screenfull@<span class=\"hljs-number\">5</span>.<span class=\"hljs-number\">1</span>.<span class=\"hljs-number\">0</span> -S<br></code></pre></td></tr></table></figure>\n\n<ol start=\"2\">\n<li>创建 <code>components/Screenfull/index</code></li>\n</ol>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\">&lt;template&gt;<br>  <span class=\"language-xml\"><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">div</span>&gt;</span></span><br><span class=\"language-xml\">    <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">svg-icon</span></span></span><br><span class=\"hljs-tag\"><span class=\"language-xml\">      <span class=\"hljs-attr\">:icon</span>=<span class=\"hljs-string\">&quot;isFullscreen ? &#x27;exit-fullscreen&#x27; : &#x27;fullscreen&#x27;&quot;</span></span></span><br><span class=\"hljs-tag\"><span class=\"language-xml\">      @<span class=\"hljs-attr\">click</span>=<span class=\"hljs-string\">&quot;onToggle&quot;</span></span></span><br><span class=\"hljs-tag\"><span class=\"language-xml\">    /&gt;</span></span><br><span class=\"language-xml\">  <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">div</span>&gt;</span></span><br>&lt;/template&gt;<br><br><span class=\"language-xml\"><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">script</span> <span class=\"hljs-attr\">setup</span>&gt;</span><span class=\"language-javascript\"></span></span><br><span class=\"language-javascript\"><span class=\"language-xml\"><span class=\"hljs-keyword\">import</span> &#123; ref, onMounted, onUnmounted &#125; <span class=\"hljs-keyword\">from</span> <span class=\"hljs-string\">&#x27;vue&#x27;</span></span></span><br><span class=\"language-javascript\"><span class=\"language-xml\"><span class=\"hljs-keyword\">import</span> screenfull <span class=\"hljs-keyword\">from</span> <span class=\"hljs-string\">&#x27;screenfull&#x27;</span></span></span><br><span class=\"language-javascript\"><span class=\"language-xml\"></span></span><br><span class=\"language-javascript\"><span class=\"language-xml\"><span class=\"hljs-comment\">// 是否全屏</span></span></span><br><span class=\"language-javascript\"><span class=\"language-xml\"><span class=\"hljs-keyword\">const</span> isFullscreen = <span class=\"hljs-title function_\">ref</span>(<span class=\"hljs-literal\">false</span>)</span></span><br><span class=\"language-javascript\"><span class=\"language-xml\"></span></span><br><span class=\"language-javascript\"><span class=\"language-xml\"><span class=\"hljs-comment\">// 切换事件</span></span></span><br><span class=\"language-javascript\"><span class=\"language-xml\"><span class=\"hljs-keyword\">const</span> <span class=\"hljs-title function_\">onToggle</span> = (<span class=\"hljs-params\"></span>) =&gt; &#123;</span></span><br><span class=\"language-javascript\"><span class=\"language-xml\">  <span class=\"hljs-keyword\">if</span> (screenfull.<span class=\"hljs-property\">isEnabled</span>) &#123;</span></span><br><span class=\"language-javascript\"><span class=\"language-xml\">    screenfull.<span class=\"hljs-title function_\">toggle</span>()</span></span><br><span class=\"language-javascript\"><span class=\"language-xml\">  &#125;</span></span><br><span class=\"language-javascript\"><span class=\"language-xml\">&#125;</span></span><br><span class=\"language-javascript\"><span class=\"language-xml\"></span></span><br><span class=\"language-javascript\"><span class=\"language-xml\"><span class=\"hljs-comment\">// 监听变化</span></span></span><br><span class=\"language-javascript\"><span class=\"language-xml\"><span class=\"hljs-keyword\">const</span> <span class=\"hljs-title function_\">change</span> = (<span class=\"hljs-params\"></span>) =&gt; &#123;</span></span><br><span class=\"language-javascript\"><span class=\"language-xml\">  <span class=\"hljs-keyword\">if</span> (screenfull.<span class=\"hljs-property\">isEnabled</span>) &#123;</span></span><br><span class=\"language-javascript\"><span class=\"language-xml\">    isFullscreen.<span class=\"hljs-property\">value</span> = screenfull.<span class=\"hljs-property\">isFullscreen</span></span></span><br><span class=\"language-javascript\"><span class=\"language-xml\">  &#125;</span></span><br><span class=\"language-javascript\"><span class=\"language-xml\">&#125;</span></span><br><span class=\"language-javascript\"><span class=\"language-xml\"></span></span><br><span class=\"language-javascript\"><span class=\"language-xml\"><span class=\"hljs-comment\">// 设置侦听器</span></span></span><br><span class=\"language-javascript\"><span class=\"language-xml\"><span class=\"hljs-title function_\">onMounted</span>(<span class=\"hljs-function\">() =&gt;</span> &#123;</span></span><br><span class=\"language-javascript\"><span class=\"language-xml\">  <span class=\"hljs-keyword\">if</span> (screenfull.<span class=\"hljs-property\">isEnabled</span>) &#123;</span></span><br><span class=\"language-javascript\"><span class=\"language-xml\">    screenfull.<span class=\"hljs-title function_\">on</span>(<span class=\"hljs-string\">&#x27;change&#x27;</span>, change)</span></span><br><span class=\"language-javascript\"><span class=\"language-xml\">  &#125;</span></span><br><span class=\"language-javascript\"><span class=\"language-xml\">&#125;)</span></span><br><span class=\"language-javascript\"><span class=\"language-xml\"></span></span><br><span class=\"language-javascript\"><span class=\"language-xml\"><span class=\"hljs-comment\">// 删除侦听器</span></span></span><br><span class=\"language-javascript\"><span class=\"language-xml\"><span class=\"hljs-title function_\">onUnmounted</span>(<span class=\"hljs-function\">() =&gt;</span> &#123;</span></span><br><span class=\"language-javascript\"><span class=\"language-xml\">  <span class=\"hljs-keyword\">if</span> (screenfull.<span class=\"hljs-property\">isEnabled</span>) &#123;</span></span><br><span class=\"language-javascript\"><span class=\"language-xml\">    screenfull.<span class=\"hljs-title function_\">off</span>(<span class=\"hljs-string\">&#x27;change&#x27;</span>, change)</span></span><br><span class=\"language-javascript\"><span class=\"language-xml\">  &#125;</span></span><br><span class=\"language-javascript\"><span class=\"language-xml\">&#125;)</span></span><br><span class=\"language-javascript\"><span class=\"language-xml\"></span><span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">script</span>&gt;</span></span><br><br><span class=\"language-xml\"><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">style</span> <span class=\"hljs-attr\">lang</span>=<span class=\"hljs-string\">&quot;scss&quot;</span> <span class=\"hljs-attr\">scoped</span>&gt;</span><span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">style</span>&gt;</span></span><br><br></code></pre></td></tr></table></figure>\n\n<p><strong>在 <code>navbar</code> 中引入该组件：</strong></p>\n<figure class=\"highlight clean\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs clean\">&lt;screenfull <span class=\"hljs-keyword\">class</span>=<span class=\"hljs-string\">&quot;right-menu-item hover-effect&quot;</span> /&gt;<br><br>...<br><br><span class=\"hljs-keyword\">import</span> Screenfull <span class=\"hljs-keyword\">from</span> <span class=\"hljs-string\">&#x27;@/components/Screenfull&#x27;</span><br></code></pre></td></tr></table></figure>\n\n<h1 id=\"headerSeach\"><a href=\"#headerSeach\" class=\"headerlink\" title=\"headerSeach\"></a>headerSeach</h1><blockquote>\n<p>所谓 <code>headerSearch</code> 一般是指 <strong>页面搜索</strong></p>\n</blockquote>\n<p><strong>原理：</strong></p>\n<p><code>headerSearch</code> 是复杂后台系统中非常常见的一个功能，它可以：<strong>在指定搜索框中对当前应用中所有页面进行检索，以 <code>select</code> 的形式展示出被检索的页面，以达到快速进入的目的</strong></p>\n<p>那么明确好了 <code>headerSearch</code>  的作用之后，接下来我们来看一下对应的实现原理</p>\n<p>根据前面的目的我们可以发现，整个 <code>headerSearch</code> 其实可以分为三个核心的功能点：</p>\n<ol>\n<li>根据指定内容对所有页面进行检索</li>\n<li>以 <code>select</code> 形式展示检索出的页面</li>\n<li>通过检索页面可快速进入对应页面</li>\n</ol>\n<p>那么围绕着这三个核心的功能点，我们想要分析它的原理就非常简单了：<strong>根据指定内容检索所有页面，把检索出的页面以 <code>select</code> 展示，点击对应 <code>option</code> 可进入到指定页面</strong></p>\n<p><strong>方案：</strong></p>\n<p>对照着三个核心功能点和原理，想要指定对应的实现方案是非常简单的一件事情了</p>\n<ol>\n<li>创建 <code>headerSearch</code> 组件，用作样式展示和用户输入内容获取</li>\n<li>获取所有的页面数据，用作被检索的数据源</li>\n<li>根据用户输入内容在数据源中进行模糊搜索(<a href=\"https://fusejs.io/\">https://fusejs.io/</a>) </li>\n<li>把搜索到的内容以 <code>select</code> 进行展示</li>\n<li>监听 <code>select</code> 的 <code>change</code> 事件，完成对应跳转</li>\n</ol>\n<h2 id=\"headerSearch-组件\"><a href=\"#headerSearch-组件\" class=\"headerlink\" title=\"headerSearch 组件\"></a>headerSearch 组件</h2><p>创建 <code>components/headerSearch/index</code> 组件，当点击搜索图标时，通过 <code>transition</code> 动画，将其长度展示出来，并且自动聚焦 <code>focus()</code>:</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\">&lt;template&gt;<br>  <span class=\"language-xml\"><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">div</span> <span class=\"hljs-attr\">:class</span>=<span class=\"hljs-string\">&quot;&#123; show: isShow &#125;&quot;</span> <span class=\"hljs-attr\">class</span>=<span class=\"hljs-string\">&quot;header-search&quot;</span>&gt;</span></span><br><span class=\"language-xml\">    <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">svg-icon</span></span></span><br><span class=\"hljs-tag\"><span class=\"language-xml\">      <span class=\"hljs-attr\">class-name</span>=<span class=\"hljs-string\">&quot;search-icon&quot;</span></span></span><br><span class=\"hljs-tag\"><span class=\"language-xml\">      <span class=\"hljs-attr\">icon</span>=<span class=\"hljs-string\">&quot;search&quot;</span></span></span><br><span class=\"hljs-tag\"><span class=\"language-xml\">      @<span class=\"hljs-attr\">click.stop</span>=<span class=\"hljs-string\">&quot;onShowClick&quot;</span></span></span><br><span class=\"hljs-tag\"><span class=\"language-xml\">    /&gt;</span></span><br><span class=\"language-xml\">    <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">el-select</span></span></span><br><span class=\"hljs-tag\"><span class=\"language-xml\">      <span class=\"hljs-attr\">ref</span>=<span class=\"hljs-string\">&quot;headerSearchSelectRef&quot;</span></span></span><br><span class=\"hljs-tag\"><span class=\"language-xml\">      <span class=\"hljs-attr\">class</span>=<span class=\"hljs-string\">&quot;header-search-select&quot;</span></span></span><br><span class=\"hljs-tag\"><span class=\"language-xml\">      <span class=\"hljs-attr\">v-model</span>=<span class=\"hljs-string\">&quot;search&quot;</span></span></span><br><span class=\"hljs-tag\"><span class=\"language-xml\">      <span class=\"hljs-attr\">filterable</span></span></span><br><span class=\"hljs-tag\"><span class=\"language-xml\">      <span class=\"hljs-attr\">default-first-option</span></span></span><br><span class=\"hljs-tag\"><span class=\"language-xml\">      <span class=\"hljs-attr\">remote</span></span></span><br><span class=\"hljs-tag\"><span class=\"language-xml\">      <span class=\"hljs-attr\">placeholder</span>=<span class=\"hljs-string\">&quot;Search&quot;</span></span></span><br><span class=\"hljs-tag\"><span class=\"language-xml\">      <span class=\"hljs-attr\">:remote-method</span>=<span class=\"hljs-string\">&quot;querySearch&quot;</span></span></span><br><span class=\"hljs-tag\"><span class=\"language-xml\">      @<span class=\"hljs-attr\">change</span>=<span class=\"hljs-string\">&quot;onSelectChange&quot;</span></span></span><br><span class=\"hljs-tag\"><span class=\"language-xml\">    &gt;</span></span><br><span class=\"language-xml\">      <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">el-option</span></span></span><br><span class=\"hljs-tag\"><span class=\"language-xml\">        <span class=\"hljs-attr\">v-for</span>=<span class=\"hljs-string\">&quot;option in 5&quot;</span></span></span><br><span class=\"hljs-tag\"><span class=\"language-xml\">        <span class=\"hljs-attr\">:key</span>=<span class=\"hljs-string\">&quot;option&quot;</span></span></span><br><span class=\"hljs-tag\"><span class=\"language-xml\">        <span class=\"hljs-attr\">:label</span>=<span class=\"hljs-string\">&quot;option&quot;</span></span></span><br><span class=\"hljs-tag\"><span class=\"language-xml\">        <span class=\"hljs-attr\">:value</span>=<span class=\"hljs-string\">&quot;option&quot;</span></span></span><br><span class=\"hljs-tag\"><span class=\"language-xml\">      &gt;</span><span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">el-option</span>&gt;</span></span><br><span class=\"language-xml\">    <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">el-select</span>&gt;</span></span><br><span class=\"language-xml\">  <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">div</span>&gt;</span></span><br>&lt;/template&gt;<br><br><span class=\"language-xml\"><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">script</span> <span class=\"hljs-attr\">setup</span>&gt;</span><span class=\"language-javascript\"></span></span><br><span class=\"language-javascript\"><span class=\"language-xml\"><span class=\"hljs-keyword\">import</span> &#123; ref &#125; <span class=\"hljs-keyword\">from</span> <span class=\"hljs-string\">&#x27;vue&#x27;</span></span></span><br><span class=\"language-javascript\"><span class=\"language-xml\"></span></span><br><span class=\"language-javascript\"><span class=\"language-xml\"><span class=\"hljs-comment\">// 控制 search 显示</span></span></span><br><span class=\"language-javascript\"><span class=\"language-xml\"><span class=\"hljs-keyword\">const</span> isShow = <span class=\"hljs-title function_\">ref</span>(<span class=\"hljs-literal\">false</span>)</span></span><br><span class=\"language-javascript\"><span class=\"language-xml\"><span class=\"hljs-comment\">// el-select 实例</span></span></span><br><span class=\"language-javascript\"><span class=\"language-xml\"><span class=\"hljs-keyword\">const</span> headerSearchSelectRef = <span class=\"hljs-title function_\">ref</span>(<span class=\"hljs-literal\">null</span>)</span></span><br><span class=\"language-javascript\"><span class=\"language-xml\"><span class=\"hljs-keyword\">const</span> <span class=\"hljs-title function_\">onShowClick</span> = (<span class=\"hljs-params\"></span>) =&gt; &#123;</span></span><br><span class=\"language-javascript\"><span class=\"language-xml\">  isShow.<span class=\"hljs-property\">value</span> = !isShow.<span class=\"hljs-property\">value</span></span></span><br><span class=\"language-javascript\"><span class=\"language-xml\">  headerSearchSelectRef.<span class=\"hljs-property\">value</span>.<span class=\"hljs-title function_\">focus</span>()</span></span><br><span class=\"language-javascript\"><span class=\"language-xml\">&#125;</span></span><br><span class=\"language-javascript\"><span class=\"language-xml\"></span></span><br><span class=\"language-javascript\"><span class=\"language-xml\"><span class=\"hljs-comment\">// search 相关</span></span></span><br><span class=\"language-javascript\"><span class=\"language-xml\"><span class=\"hljs-keyword\">const</span> search = <span class=\"hljs-title function_\">ref</span>(<span class=\"hljs-string\">&#x27;&#x27;</span>)</span></span><br><span class=\"language-javascript\"><span class=\"language-xml\"><span class=\"hljs-comment\">// 搜索方法</span></span></span><br><span class=\"language-javascript\"><span class=\"language-xml\"><span class=\"hljs-keyword\">const</span> <span class=\"hljs-title function_\">querySearch</span> = (<span class=\"hljs-params\"></span>) =&gt; &#123;</span></span><br><span class=\"language-javascript\"><span class=\"language-xml\">  <span class=\"hljs-variable language_\">console</span>.<span class=\"hljs-title function_\">log</span>(<span class=\"hljs-string\">&#x27;querySearch&#x27;</span>)</span></span><br><span class=\"language-javascript\"><span class=\"language-xml\">&#125;</span></span><br><span class=\"language-javascript\"><span class=\"language-xml\"><span class=\"hljs-comment\">// 选中回调</span></span></span><br><span class=\"language-javascript\"><span class=\"language-xml\"><span class=\"hljs-keyword\">const</span> <span class=\"hljs-title function_\">onSelectChange</span> = (<span class=\"hljs-params\"></span>) =&gt; &#123;</span></span><br><span class=\"language-javascript\"><span class=\"language-xml\">  <span class=\"hljs-variable language_\">console</span>.<span class=\"hljs-title function_\">log</span>(<span class=\"hljs-string\">&#x27;onSelectChange&#x27;</span>)</span></span><br><span class=\"language-javascript\"><span class=\"language-xml\">&#125;</span></span><br><span class=\"language-javascript\"><span class=\"language-xml\"></span><span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">script</span>&gt;</span></span><br><br><span class=\"language-xml\"><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">style</span> <span class=\"hljs-attr\">lang</span>=<span class=\"hljs-string\">&quot;scss&quot;</span> <span class=\"hljs-attr\">scoped</span>&gt;</span><span class=\"language-css\"></span></span><br><span class=\"language-css\"><span class=\"language-xml\"><span class=\"hljs-selector-class\">.header-search</span> &#123;</span></span><br><span class=\"language-css\"><span class=\"language-xml\">  <span class=\"hljs-attribute\">font-size</span>: <span class=\"hljs-number\">0</span> <span class=\"hljs-meta\">!important</span>;</span></span><br><span class=\"language-css\"><span class=\"language-xml\">  <span class=\"hljs-selector-class\">.search-icon</span> &#123;</span></span><br><span class=\"language-css\"><span class=\"language-xml\">    <span class=\"hljs-attribute\">cursor</span>: pointer;</span></span><br><span class=\"language-css\"><span class=\"language-xml\">    <span class=\"hljs-attribute\">font-size</span>: <span class=\"hljs-number\">18px</span>;</span></span><br><span class=\"language-css\"><span class=\"language-xml\">    <span class=\"hljs-attribute\">vertical-align</span>: middle;</span></span><br><span class=\"language-css\"><span class=\"language-xml\">  &#125;</span></span><br><span class=\"language-css\"><span class=\"language-xml\">  <span class=\"hljs-selector-class\">.header-search-select</span> &#123;</span></span><br><span class=\"language-css\"><span class=\"language-xml\">    <span class=\"hljs-attribute\">font-size</span>: <span class=\"hljs-number\">18px</span>;</span></span><br><span class=\"language-css\"><span class=\"language-xml\">    <span class=\"hljs-attribute\">transition</span>: width <span class=\"hljs-number\">0.2s</span>; // <span class=\"hljs-attribute\">width</span> 动画</span></span><br><span class=\"language-css\"><span class=\"language-xml\">    <span class=\"hljs-attribute\">width</span>: <span class=\"hljs-number\">0</span>;</span></span><br><span class=\"language-css\"><span class=\"language-xml\">    <span class=\"hljs-attribute\">overflow</span>: hidden;</span></span><br><span class=\"language-css\"><span class=\"language-xml\">    <span class=\"hljs-attribute\">background</span>: transparent;</span></span><br><span class=\"language-css\"><span class=\"language-xml\">    <span class=\"hljs-attribute\">border-radius</span>: <span class=\"hljs-number\">0</span>;</span></span><br><span class=\"language-css\"><span class=\"language-xml\">    <span class=\"hljs-attribute\">display</span>: inline-block;</span></span><br><span class=\"language-css\"><span class=\"language-xml\">    <span class=\"hljs-attribute\">vertical-align</span>: middle;</span></span><br><span class=\"language-css\"><span class=\"language-xml\"></span></span><br><span class=\"language-css\"><span class=\"language-xml\">    ::v-deep .el-input__inner &#123;</span></span><br><span class=\"language-css\"><span class=\"language-xml\">      <span class=\"hljs-attribute\">border-radius</span>: <span class=\"hljs-number\">0</span>;</span></span><br><span class=\"language-css\"><span class=\"language-xml\">      <span class=\"hljs-attribute\">border</span>: <span class=\"hljs-number\">0</span>;</span></span><br><span class=\"language-css\"><span class=\"language-xml\">      <span class=\"hljs-attribute\">padding-left</span>: <span class=\"hljs-number\">0</span>;</span></span><br><span class=\"language-css\"><span class=\"language-xml\">      <span class=\"hljs-attribute\">padding-right</span>: <span class=\"hljs-number\">0</span>;</span></span><br><span class=\"language-css\"><span class=\"language-xml\">      <span class=\"hljs-attribute\">box-shadow</span>: none <span class=\"hljs-meta\">!important</span>;</span></span><br><span class=\"language-css\"><span class=\"language-xml\">      <span class=\"hljs-attribute\">border-bottom</span>: <span class=\"hljs-number\">1px</span> solid <span class=\"hljs-number\">#d9d9d9</span>;</span></span><br><span class=\"language-css\"><span class=\"language-xml\">      <span class=\"hljs-attribute\">vertical-align</span>: middle;</span></span><br><span class=\"language-css\"><span class=\"language-xml\">    &#125;</span></span><br><span class=\"language-css\"><span class=\"language-xml\">  &#125;</span></span><br><span class=\"language-css\"><span class=\"language-xml\">  &amp;<span class=\"hljs-selector-class\">.show</span> &#123;</span></span><br><span class=\"language-css\"><span class=\"language-xml\">    <span class=\"hljs-selector-class\">.header-search-select</span> &#123;</span></span><br><span class=\"language-css\"><span class=\"language-xml\">      <span class=\"hljs-attribute\">width</span>: <span class=\"hljs-number\">210px</span>;</span></span><br><span class=\"language-css\"><span class=\"language-xml\">      <span class=\"hljs-attribute\">margin-left</span>: <span class=\"hljs-number\">10px</span>;</span></span><br><span class=\"language-css\"><span class=\"language-xml\">    &#125;</span></span><br><span class=\"language-css\"><span class=\"language-xml\">  &#125;</span></span><br><span class=\"language-css\"><span class=\"language-xml\">&#125;</span></span><br><span class=\"language-css\"><span class=\"language-xml\"></span><span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">style</span>&gt;</span></span><br><br></code></pre></td></tr></table></figure>\n\n<p>在 <code>navbar</code> 中导入该组件</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\">&lt;header-search <span class=\"hljs-keyword\">class</span>=<span class=\"hljs-string\">&quot;right-menu-item hover-effect&quot;</span>&gt;&lt;/header-search&gt;<br><br>...<br><br><span class=\"hljs-keyword\">import</span> <span class=\"hljs-title class_\">HeaderSearch</span> <span class=\"hljs-keyword\">from</span> <span class=\"hljs-string\">&#x27;@/components/HeaderSearch/index.vue&#x27;</span><br></code></pre></td></tr></table></figure>\n\n<h2 id=\"获取数据源\"><a href=\"#获取数据源\" class=\"headerlink\" title=\"获取数据源\"></a>获取数据源</h2><p>在有了 <code>headerSearch</code> 之后，接下来就可以来处理对应的 <strong>检索数据源了</strong></p>\n<p><strong>检索数据源</strong> 表示：<strong>有哪些页面希望检索</strong></p>\n<p>那么对于我们当前的业务而言，我们希望被检索的页面其实就是左侧菜单中的页面，那么我们检索数据源即为：<strong>左侧菜单对应的数据源</strong></p>\n<p>根据以上原理，我们可以得出以下代码：</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\">&lt;script setup&gt;<br><span class=\"hljs-keyword\">import</span> &#123; ref, computed &#125; <span class=\"hljs-keyword\">from</span> <span class=\"hljs-string\">&#x27;vue&#x27;</span><br><span class=\"hljs-keyword\">import</span> &#123; filterRouters, generateMenus &#125; <span class=\"hljs-keyword\">from</span> <span class=\"hljs-string\">&#x27;@/utils/route&#x27;</span><br><span class=\"hljs-keyword\">import</span> &#123; useRouter &#125; <span class=\"hljs-keyword\">from</span> <span class=\"hljs-string\">&#x27;vue-router&#x27;</span><br>...<br><span class=\"hljs-comment\">// 检索数据源</span><br><span class=\"hljs-keyword\">const</span> router = <span class=\"hljs-title function_\">useRouter</span>()<br><span class=\"hljs-keyword\">const</span> searchPool = <span class=\"hljs-title function_\">computed</span>(<span class=\"hljs-function\">() =&gt;</span> &#123;<br>  <span class=\"hljs-keyword\">const</span> filterRoutes = <span class=\"hljs-title function_\">filterRouters</span>(router.<span class=\"hljs-title function_\">getRoutes</span>())<br>  <span class=\"hljs-variable language_\">console</span>.<span class=\"hljs-title function_\">log</span>(<span class=\"hljs-title function_\">generateMenus</span>(filterRoutes))<br>  <span class=\"hljs-keyword\">return</span> <span class=\"hljs-title function_\">generateMenus</span>(filterRoutes)<br>&#125;)<br><span class=\"hljs-variable language_\">console</span>.<span class=\"hljs-title function_\">log</span>(searchPool)<br>&lt;/script&gt;<br></code></pre></td></tr></table></figure>\n\n<h2 id=\"模糊搜索Fuse-js\"><a href=\"#模糊搜索Fuse-js\" class=\"headerlink\" title=\"模糊搜索Fuse.js\"></a>模糊搜索Fuse.js</h2><blockquote>\n<p>Fuse.js is a powerful, lightweight fuzzy-search library, with zero dependencies.</p>\n</blockquote>\n<p>如果我们想要进行  <a href=\"https://fusejs.io/\">模糊搜索</a>  的话，那么需要依赖一个第三方的库  <a href=\"https://fusejs.io/\">fuse.js</a> </p>\n<p>它是0️⃣依赖的，专门处理模糊搜索的库。</p>\n<p><strong>Why should I use it?</strong></p>\n<ul>\n<li>使用 Fuse.js，您不需要仅仅为了处理搜索而设置专用的后端。</li>\n<li>简单性和性能是开发这个库的主要标准。</li>\n</ul>\n<ol>\n<li>安装 <a href=\"https://fusejs.io/\">fuse.js</a></li>\n</ol>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\">npm install --save fuse.<span class=\"hljs-property\">js</span>@<span class=\"hljs-number\">6.4</span><span class=\"hljs-number\">.6</span><br></code></pre></td></tr></table></figure>\n\n<ol start=\"2\">\n<li>初始化 <code>Fuse</code>，更多初始化配置项 <a href=\"https://fusejs.io/api/options.html\">可点击这里</a></li>\n</ol>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\"><span class=\"hljs-keyword\">import</span> <span class=\"hljs-title class_\">Fuse</span> <span class=\"hljs-keyword\">from</span> <span class=\"hljs-string\">&#x27;fuse.js&#x27;</span><br><br><span class=\"hljs-comment\">/**</span><br><span class=\"hljs-comment\">* 搜索库相关</span><br><span class=\"hljs-comment\">*/</span><br><span class=\"hljs-keyword\">const</span> fuse = <span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">Fuse</span>(list, &#123;<br>    <span class=\"hljs-comment\">// 是否按优先级进行排序</span><br>    <span class=\"hljs-attr\">shouldSort</span>: <span class=\"hljs-literal\">true</span>,<br>    <span class=\"hljs-comment\">// 匹配长度超过这个值的才会被认为是匹配的</span><br>    <span class=\"hljs-attr\">minMatchCharLength</span>: <span class=\"hljs-number\">1</span>,<br>    <span class=\"hljs-comment\">// 将被搜索的键列表。 这支持嵌套路径、加权搜索、在字符串和对象数组中搜索。</span><br>    <span class=\"hljs-comment\">// name：搜索的键</span><br>    <span class=\"hljs-comment\">// weight：对应的权重</span><br>    <span class=\"hljs-comment\">// 表示我们将用户输入的值，与 title 和 path 进行匹配</span><br>    <span class=\"hljs-attr\">keys</span>: [<br>      &#123;<br>        <span class=\"hljs-attr\">name</span>: <span class=\"hljs-string\">&#x27;title&#x27;</span>,<br>        <span class=\"hljs-attr\">weight</span>: <span class=\"hljs-number\">0.7</span><br>      &#125;,<br>      &#123;<br>        <span class=\"hljs-attr\">name</span>: <span class=\"hljs-string\">&#x27;path&#x27;</span>,<br>        <span class=\"hljs-attr\">weight</span>: <span class=\"hljs-number\">0.3</span><br>      &#125;<br>    ]<br>  &#125;)<br></code></pre></td></tr></table></figure>\n\n<ol start=\"3\">\n<li>参考 <a href=\"https://fusejs.io/demo.html\">Fuse Demo</a> 与 最终效果，可以得出，我们最终期望得到如下的检索数据源结构</li>\n</ol>\n<figure class=\"highlight json\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs json\"><span class=\"hljs-punctuation\">[</span><br>    <span class=\"hljs-punctuation\">&#123;</span><br>        <span class=\"hljs-attr\">&quot;path&quot;</span><span class=\"hljs-punctuation\">:</span><span class=\"hljs-string\">&quot;/my&quot;</span><span class=\"hljs-punctuation\">,</span><br>        <span class=\"hljs-attr\">&quot;title&quot;</span><span class=\"hljs-punctuation\">:</span><span class=\"hljs-punctuation\">[</span><br>            <span class=\"hljs-string\">&quot;个人中心&quot;</span><br>        <span class=\"hljs-punctuation\">]</span><br>    <span class=\"hljs-punctuation\">&#125;</span><span class=\"hljs-punctuation\">,</span><br>    <span class=\"hljs-punctuation\">&#123;</span><br>        <span class=\"hljs-attr\">&quot;path&quot;</span><span class=\"hljs-punctuation\">:</span><span class=\"hljs-string\">&quot;/user&quot;</span><span class=\"hljs-punctuation\">,</span><br>        <span class=\"hljs-attr\">&quot;title&quot;</span><span class=\"hljs-punctuation\">:</span><span class=\"hljs-punctuation\">[</span><br>            <span class=\"hljs-string\">&quot;用户&quot;</span><br>        <span class=\"hljs-punctuation\">]</span><br>    <span class=\"hljs-punctuation\">&#125;</span><span class=\"hljs-punctuation\">,</span><br>    <span class=\"hljs-punctuation\">&#123;</span><br>        <span class=\"hljs-attr\">&quot;path&quot;</span><span class=\"hljs-punctuation\">:</span><span class=\"hljs-string\">&quot;/user/manage&quot;</span><span class=\"hljs-punctuation\">,</span><br>        <span class=\"hljs-attr\">&quot;title&quot;</span><span class=\"hljs-punctuation\">:</span><span class=\"hljs-punctuation\">[</span><br>            <span class=\"hljs-string\">&quot;用户&quot;</span><span class=\"hljs-punctuation\">,</span><br>            <span class=\"hljs-string\">&quot;用户管理&quot;</span><br>        <span class=\"hljs-punctuation\">]</span><br>    <span class=\"hljs-punctuation\">&#125;</span><span class=\"hljs-punctuation\">,</span><br>    <span class=\"hljs-punctuation\">&#123;</span><br>        <span class=\"hljs-attr\">&quot;path&quot;</span><span class=\"hljs-punctuation\">:</span><span class=\"hljs-string\">&quot;/user/info&quot;</span><span class=\"hljs-punctuation\">,</span><br>        <span class=\"hljs-attr\">&quot;title&quot;</span><span class=\"hljs-punctuation\">:</span><span class=\"hljs-punctuation\">[</span><br>            <span class=\"hljs-string\">&quot;用户&quot;</span><span class=\"hljs-punctuation\">,</span><br>            <span class=\"hljs-string\">&quot;用户信息&quot;</span><br>        <span class=\"hljs-punctuation\">]</span><br>    <span class=\"hljs-punctuation\">&#125;</span><span class=\"hljs-punctuation\">,</span><br>    <span class=\"hljs-punctuation\">&#123;</span><br>        <span class=\"hljs-attr\">&quot;path&quot;</span><span class=\"hljs-punctuation\">:</span><span class=\"hljs-string\">&quot;/article&quot;</span><span class=\"hljs-punctuation\">,</span><br>        <span class=\"hljs-attr\">&quot;title&quot;</span><span class=\"hljs-punctuation\">:</span><span class=\"hljs-punctuation\">[</span><br>            <span class=\"hljs-string\">&quot;文章&quot;</span><br>        <span class=\"hljs-punctuation\">]</span><br>    <span class=\"hljs-punctuation\">&#125;</span><span class=\"hljs-punctuation\">,</span><br>    <span class=\"hljs-punctuation\">&#123;</span><br>        <span class=\"hljs-attr\">&quot;path&quot;</span><span class=\"hljs-punctuation\">:</span><span class=\"hljs-string\">&quot;/article/ranking&quot;</span><span class=\"hljs-punctuation\">,</span><br>        <span class=\"hljs-attr\">&quot;title&quot;</span><span class=\"hljs-punctuation\">:</span><span class=\"hljs-punctuation\">[</span><br>            <span class=\"hljs-string\">&quot;文章&quot;</span><span class=\"hljs-punctuation\">,</span><br>            <span class=\"hljs-string\">&quot;文章排名&quot;</span><br>        <span class=\"hljs-punctuation\">]</span><br>    <span class=\"hljs-punctuation\">&#125;</span><span class=\"hljs-punctuation\">,</span><br>    <span class=\"hljs-punctuation\">&#123;</span><br>        <span class=\"hljs-attr\">&quot;path&quot;</span><span class=\"hljs-punctuation\">:</span><span class=\"hljs-string\">&quot;/article/create&quot;</span><span class=\"hljs-punctuation\">,</span><br>        <span class=\"hljs-attr\">&quot;title&quot;</span><span class=\"hljs-punctuation\">:</span><span class=\"hljs-punctuation\">[</span><br>            <span class=\"hljs-string\">&quot;文章&quot;</span><span class=\"hljs-punctuation\">,</span><br>            <span class=\"hljs-string\">&quot;创建文章&quot;</span><br>        <span class=\"hljs-punctuation\">]</span><br>    <span class=\"hljs-punctuation\">&#125;</span><br><span class=\"hljs-punctuation\">]</span><br></code></pre></td></tr></table></figure>\n\n<ol start=\"4\">\n<li>所以我们之前处理了的数据源并不符合我们的需要，所以我们需要对数据源进行重新处理</li>\n</ol>\n<h2 id=\"数据源重处理，生成-searchPool\"><a href=\"#数据源重处理，生成-searchPool\" class=\"headerlink\" title=\"数据源重处理，生成 searchPool\"></a>数据源重处理，生成 searchPool</h2><p>我们明确了最终我们期望得到数据源结构，那么接下来我们就对重新计算数据源，生成对应的 <code>searchPoll</code></p>\n<p>创建 <code>components/HeaderSearch/FuseData.js</code></p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\"><span class=\"hljs-keyword\">import</span> path <span class=\"hljs-keyword\">from</span> <span class=\"hljs-string\">&#x27;path&#x27;</span><br><span class=\"hljs-keyword\">import</span> i18n <span class=\"hljs-keyword\">from</span> <span class=\"hljs-string\">&#x27;@/i18n&#x27;</span><br><span class=\"hljs-comment\">/**</span><br><span class=\"hljs-comment\"> * 筛选出可供搜索的路由对象</span><br><span class=\"hljs-comment\"> * <span class=\"hljs-doctag\">@param</span> routes 路由表</span><br><span class=\"hljs-comment\"> * <span class=\"hljs-doctag\">@param</span> basePath 基础路径，默认为 /</span><br><span class=\"hljs-comment\"> * <span class=\"hljs-doctag\">@param</span> prefixTitle 父级title，子集title集合 [文章，文章排名]</span><br><span class=\"hljs-comment\"> */</span><br><span class=\"hljs-keyword\">export</span> <span class=\"hljs-keyword\">const</span> <span class=\"hljs-title function_\">generateRoutes</span> = (<span class=\"hljs-params\">routes, basePath = <span class=\"hljs-string\">&#x27;/&#x27;</span>, prefixTitle = []</span>) =&gt; &#123;<br>  <span class=\"hljs-comment\">// 创建 result 数据</span><br>  <span class=\"hljs-keyword\">let</span> res = []<br>  <span class=\"hljs-comment\">// 循环 routes 路由</span><br>  <span class=\"hljs-keyword\">for</span> (<span class=\"hljs-keyword\">const</span> route <span class=\"hljs-keyword\">of</span> routes) &#123;<br>    <span class=\"hljs-comment\">// 创建包含 path 和 title 的 item</span><br>    <span class=\"hljs-keyword\">const</span> data = &#123;<br>      <span class=\"hljs-attr\">path</span>: path.<span class=\"hljs-title function_\">resolve</span>(basePath, route.<span class=\"hljs-property\">path</span>),<br>      <span class=\"hljs-attr\">title</span>: [...prefixTitle]<br>    &#125;<br>    <span class=\"hljs-comment\">// 当前存在 meta 时，使用 i18n 解析国际化数据，组合成新的 title 内容</span><br>    <span class=\"hljs-comment\">// 动态路由不允许被搜索（类似：user/:id 这种）</span><br>    <span class=\"hljs-comment\">// 匹配动态路由的正则</span><br>    <span class=\"hljs-keyword\">const</span> re = <span class=\"hljs-regexp\">/.*\\/:.*/</span><br>    <span class=\"hljs-keyword\">if</span> (route.<span class=\"hljs-property\">meta</span> &amp;&amp; route.<span class=\"hljs-property\">meta</span>.<span class=\"hljs-property\">title</span> &amp;&amp; !re.<span class=\"hljs-title function_\">exec</span>(route.<span class=\"hljs-property\">path</span>)) &#123;<br>      <span class=\"hljs-keyword\">const</span> i18ntitle = i18n.<span class=\"hljs-property\">global</span>.<span class=\"hljs-title function_\">t</span>(<span class=\"hljs-string\">`msg.route.<span class=\"hljs-subst\">$&#123;route.meta.title&#125;</span>`</span>)<br>      data.<span class=\"hljs-property\">title</span> = [...data.<span class=\"hljs-property\">title</span>, i18ntitle]<br>      res.<span class=\"hljs-title function_\">push</span>(data)<br>    &#125;<br><br>    <span class=\"hljs-comment\">// 存在 children 时，迭代调用</span><br>    <span class=\"hljs-keyword\">if</span> (route.<span class=\"hljs-property\">children</span>) &#123;<br>      <span class=\"hljs-keyword\">const</span> tempRoutes = <span class=\"hljs-title function_\">generateRoutes</span>(route.<span class=\"hljs-property\">children</span>, data.<span class=\"hljs-property\">path</span>, data.<span class=\"hljs-property\">title</span>)<br>      <span class=\"hljs-keyword\">if</span> (tempRoutes.<span class=\"hljs-property\">length</span> &gt;= <span class=\"hljs-number\">1</span>) &#123;<br>        res = [...res, ...tempRoutes]<br>      &#125;<br>    &#125;<br>  &#125;<br>  <span class=\"hljs-keyword\">return</span> res<br>&#125;<br><br></code></pre></td></tr></table></figure>\n\n<p>这样，我们就通过 <code>generateRoutes</code> 方法，根据咱们的路由表，生成了符合 <code>fuse.js</code> 的数据。</p>\n<p>在 <code>headerSearch</code> 中导入 <code>generateRoutes</code></p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs vue\">&lt;script setup&gt;<br>import &#123; computed, ref &#125; from &#x27;vue&#x27;<br>import &#123; generateRoutes &#125; from &#x27;./FuseData&#x27;<br>import Fuse from &#x27;fuse.js&#x27;<br>import &#123; filterRouters &#125; from &#x27;@/utils/route&#x27;<br>import &#123; useRouter &#125; from &#x27;vue-router&#x27;<br><br>...<br><br>// 检索数据源<br>const router = useRouter()<br>const searchPool = computed(() =&gt; &#123;<br>  const filterRoutes = filterRouters(router.getRoutes())<br>  return generateRoutes(filterRoutes)<br>&#125;)<br>/**<br> * 搜索库相关<br> */<br>const fuse = new Fuse(searchPool.value, &#123;<br>  ...<br>&#125;)<br>&lt;/script&gt;<br></code></pre></td></tr></table></figure>\n\n<p>通过 <code>querySearch</code> 测试搜索结果</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\"><span class=\"hljs-comment\">// 搜索方法</span><br><span class=\"hljs-keyword\">const</span> <span class=\"hljs-title function_\">querySearch</span> = query =&gt; &#123;<br>  <span class=\"hljs-variable language_\">console</span>.<span class=\"hljs-title function_\">log</span>(fuse.<span class=\"hljs-title function_\">search</span>(query))<br>&#125;<br></code></pre></td></tr></table></figure>\n\n<h2 id=\"渲染检索数据\"><a href=\"#渲染检索数据\" class=\"headerlink\" title=\"渲染检索数据\"></a>渲染检索数据</h2><p>数据源处理完成之后，最后我们就只需要完成:</p>\n<ol>\n<li>渲染检索出的数据</li>\n<li>完成对应跳转</li>\n</ol>\n<p>那么下面我们按照步骤进行实现：</p>\n<ol>\n<li>渲染检索出的数据</li>\n</ol>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\">&lt;template&gt;<br>  <span class=\"language-xml\"><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">el-option</span></span></span><br><span class=\"hljs-tag\"><span class=\"language-xml\">      <span class=\"hljs-attr\">v-for</span>=<span class=\"hljs-string\">&quot;option in searchOptions&quot;</span></span></span><br><span class=\"hljs-tag\"><span class=\"language-xml\">      <span class=\"hljs-attr\">:key</span>=<span class=\"hljs-string\">&quot;option.item.path&quot;</span></span></span><br><span class=\"hljs-tag\"><span class=\"language-xml\">      <span class=\"hljs-attr\">:label</span>=<span class=\"hljs-string\">&quot;option.item.title.join(&#x27; &gt; &#x27;)&quot;</span></span></span><br><span class=\"hljs-tag\"><span class=\"language-xml\">      <span class=\"hljs-attr\">:value</span>=<span class=\"hljs-string\">&quot;option.item&quot;</span></span></span><br><span class=\"hljs-tag\"><span class=\"language-xml\">  &gt;</span><span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">el-option</span>&gt;</span></span><br>&lt;/template&gt;<br><br><span class=\"language-xml\"><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">script</span> <span class=\"hljs-attr\">setup</span>&gt;</span><span class=\"language-javascript\"></span></span><br><span class=\"language-javascript\"><span class=\"language-xml\">...</span></span><br><span class=\"language-javascript\"><span class=\"language-xml\"><span class=\"hljs-comment\">// 搜索结果</span></span></span><br><span class=\"language-javascript\"><span class=\"language-xml\"><span class=\"hljs-keyword\">const</span> searchOptions = <span class=\"hljs-title function_\">ref</span>([])</span></span><br><span class=\"language-javascript\"><span class=\"language-xml\"><span class=\"hljs-comment\">// 搜索方法</span></span></span><br><span class=\"language-javascript\"><span class=\"language-xml\"><span class=\"hljs-keyword\">const</span> <span class=\"hljs-title function_\">querySearch</span> = query =&gt; &#123;</span></span><br><span class=\"language-javascript\"><span class=\"language-xml\">  <span class=\"hljs-keyword\">if</span> (query !== <span class=\"hljs-string\">&#x27;&#x27;</span>) &#123;</span></span><br><span class=\"language-javascript\"><span class=\"language-xml\">    searchOptions.<span class=\"hljs-property\">value</span> = fuse.<span class=\"hljs-title function_\">search</span>(query)</span></span><br><span class=\"language-javascript\"><span class=\"language-xml\">  &#125; <span class=\"hljs-keyword\">else</span> &#123;</span></span><br><span class=\"language-javascript\"><span class=\"language-xml\">    searchOptions.<span class=\"hljs-property\">value</span> = []</span></span><br><span class=\"language-javascript\"><span class=\"language-xml\">  &#125;</span></span><br><span class=\"language-javascript\"><span class=\"language-xml\">&#125;</span></span><br><span class=\"language-javascript\"><span class=\"language-xml\">...</span></span><br><span class=\"language-javascript\"><span class=\"language-xml\"></span><span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">script</span>&gt;</span></span><br><br></code></pre></td></tr></table></figure>\n\n<ol start=\"2\">\n<li>完成对应跳转</li>\n</ol>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\"><span class=\"hljs-keyword\">const</span> <span class=\"hljs-title function_\">onSelectChange</span> = val =&gt; &#123;<br>  router.<span class=\"hljs-title function_\">push</span>(val.<span class=\"hljs-property\">path</span>)<br>&#125;<br></code></pre></td></tr></table></figure>\n\n<h2 id=\"剩余问题处理\"><a href=\"#剩余问题处理\" class=\"headerlink\" title=\"剩余问题处理\"></a>剩余问题处理</h2><p>这里我们的 <code>headerSearch</code> 功能基本上就已经处理完成了，但是还存在一些小 <code>bug</code> ，那么最后这一小节我们就处理下这些剩余的 <code>bug</code></p>\n<ol>\n<li>在 <code>search</code> 打开时，点击 <code>body</code> 关闭 <code>search</code></li>\n<li>在 <code>search</code> 关闭时，清理 <code>searchOptions</code></li>\n<li><code>headerSearch</code> 应该具备国际化能力</li>\n</ol>\n<p>明确好问题之后，接下来我们进行处理</p>\n<p>首先我们先处理前前面两个问题：</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\"><span class=\"hljs-comment\">/**</span><br><span class=\"hljs-comment\"> * 关闭 search 的处理事件</span><br><span class=\"hljs-comment\"> */</span><br><span class=\"hljs-keyword\">const</span> <span class=\"hljs-title function_\">onClose</span> = (<span class=\"hljs-params\"></span>) =&gt; &#123;<br>  headerSearchSelectRef.<span class=\"hljs-property\">value</span>.<span class=\"hljs-title function_\">blur</span>()<br>  isShow.<span class=\"hljs-property\">value</span> = <span class=\"hljs-literal\">false</span><br>  searchOptions.<span class=\"hljs-property\">value</span> = []<br>&#125;<br><span class=\"hljs-comment\">/**</span><br><span class=\"hljs-comment\"> * 监听 search 打开，处理 close 事件</span><br><span class=\"hljs-comment\"> */</span><br><span class=\"hljs-title function_\">watch</span>(isShow, <span class=\"hljs-function\"><span class=\"hljs-params\">val</span> =&gt;</span> &#123;<br>  <span class=\"hljs-keyword\">if</span> (val) &#123;<br>    <span class=\"hljs-variable language_\">document</span>.<span class=\"hljs-property\">body</span>.<span class=\"hljs-title function_\">addEventListener</span>(<span class=\"hljs-string\">&#x27;click&#x27;</span>, onClose)<br>  &#125; <span class=\"hljs-keyword\">else</span> &#123;<br>    <span class=\"hljs-variable language_\">document</span>.<span class=\"hljs-property\">body</span>.<span class=\"hljs-title function_\">removeEventListener</span>(<span class=\"hljs-string\">&#x27;click&#x27;</span>, onClose)<br>  &#125;<br>&#125;)<br></code></pre></td></tr></table></figure>\n\n<p>接下来是国际化的问题，想要处理这个问题非常简单，我们只需要：<strong>监听语言变化，重新计算数据源初始化 <code>fuse</code> 即可</strong></p>\n<ol>\n<li>在 <code>utils/i18n</code> 下，新建方法 <code>watchSwitchLang</code></li>\n</ol>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\"><span class=\"hljs-keyword\">import</span> &#123; watch &#125; <span class=\"hljs-keyword\">from</span> <span class=\"hljs-string\">&#x27;vue&#x27;</span><br><span class=\"hljs-keyword\">import</span> store <span class=\"hljs-keyword\">from</span> <span class=\"hljs-string\">&#x27;@/store&#x27;</span><br><br>type <span class=\"hljs-title class_\">IProps</span> = (<span class=\"hljs-function\">(<span class=\"hljs-params\">lang: string</span>) =&gt;</span> <span class=\"hljs-keyword\">void</span>)[]<br><br><span class=\"hljs-keyword\">export</span> <span class=\"hljs-keyword\">default</span> <span class=\"hljs-keyword\">function</span> <span class=\"hljs-title function_\">watchSwitchLang</span>(<span class=\"hljs-params\">...cbs: IProps</span>) &#123;<br>  <span class=\"hljs-title function_\">watch</span>(<br>    <span class=\"hljs-function\">() =&gt;</span> store.<span class=\"hljs-property\">getters</span>.<span class=\"hljs-property\">language</span>,<br>    <span class=\"hljs-function\">() =&gt;</span> &#123;<br>      cbs.<span class=\"hljs-title function_\">forEach</span>(<span class=\"hljs-function\"><span class=\"hljs-params\">cb</span> =&gt;</span> cbs.<span class=\"hljs-title function_\">forEach</span>(<span class=\"hljs-function\"><span class=\"hljs-params\">cb</span> =&gt;</span> <span class=\"hljs-title function_\">cb</span>(store.<span class=\"hljs-property\">getters</span>.<span class=\"hljs-property\">language</span>)))<br>    &#125;<br>  )<br>&#125;<br></code></pre></td></tr></table></figure>\n\n<ol start=\"2\">\n<li>在 <code>headerSearch</code> 监听变化，重新赋值</li>\n</ol>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\">&lt;script setup&gt;<br>...<br><span class=\"hljs-keyword\">import</span> &#123; watchSwitchLang &#125; <span class=\"hljs-keyword\">from</span> <span class=\"hljs-string\">&#x27;@/utils/i18n&#x27;</span><br><br>...<br><br><span class=\"hljs-comment\">// 检索数据源</span><br><span class=\"hljs-keyword\">const</span> router = <span class=\"hljs-title function_\">useRouter</span>()<br><span class=\"hljs-keyword\">let</span> searchPool = <span class=\"hljs-title function_\">computed</span>(<span class=\"hljs-function\">() =&gt;</span> &#123;<br>  <span class=\"hljs-keyword\">const</span> filterRoutes = <span class=\"hljs-title function_\">filterRouters</span>(router.<span class=\"hljs-title function_\">getRoutes</span>())<br>  <span class=\"hljs-keyword\">return</span> <span class=\"hljs-title function_\">generateRoutes</span>(filterRoutes)<br>&#125;)<br><span class=\"hljs-comment\">/**</span><br><span class=\"hljs-comment\">* 搜索库相关</span><br><span class=\"hljs-comment\">*/</span><br><span class=\"hljs-keyword\">let</span> fuse<br><span class=\"hljs-keyword\">const</span> <span class=\"hljs-title function_\">initFuse</span> = searchPool =&gt; &#123;<br>  fuse = <span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">Fuse</span>(searchPool, &#123;<br>    ...<br>&#125;<br><span class=\"hljs-title function_\">initFuse</span>(searchPool.<span class=\"hljs-property\">value</span>)<br><br>...<br><br><span class=\"hljs-comment\">// 处理国际化</span><br><span class=\"hljs-title function_\">watchSwitchLang</span>(<span class=\"hljs-function\">() =&gt;</span> &#123;<br>  searchPool = <span class=\"hljs-title function_\">computed</span>(<span class=\"hljs-function\">() =&gt;</span> &#123;<br>    <span class=\"hljs-keyword\">const</span> filterRoutes = <span class=\"hljs-title function_\">filterRouters</span>(router.<span class=\"hljs-title function_\">getRoutes</span>())<br>    <span class=\"hljs-keyword\">return</span> <span class=\"hljs-title function_\">generateRoutes</span>(filterRoutes)<br>  &#125;)<br>  <span class=\"hljs-title function_\">initFuse</span>(searchPool.<span class=\"hljs-property\">value</span>)<br>&#125;)<br>&lt;/script&gt;<br></code></pre></td></tr></table></figure>\n\n<h2 id=\"headerSearch-方案总结\"><a href=\"#headerSearch-方案总结\" class=\"headerlink\" title=\"headerSearch 方案总结\"></a>headerSearch 方案总结</h2><p>那么到这里整个的 <code>headerSearch</code> 我们就已经全部处理完成了，整个 <code>headerSearch</code> 我们只需要把握住三个核心的关键点</p>\n<ol>\n<li>根据指定内容对所有页面进行检索</li>\n<li>以 <code>select</code> 形式展示检索出的页面</li>\n<li>通过检索页面可快速进入对应页面</li>\n</ol>\n<p>保证大方向没有错误，那么具体的细节处理我们具体分析就可以了。</p>\n<p>关于细节的处理，可能比较复杂的地方有两个：</p>\n<ol>\n<li>模糊搜索</li>\n<li>检索数据源</li>\n</ol>\n<p>对于这两块，我们依赖于 <code>fuse.js</code> 进行了实现，大大简化了我们的业务处理流程。</p>\n<h1 id=\"tagsView-原理及方案分析\"><a href=\"#tagsView-原理及方案分析\" class=\"headerlink\" title=\"tagsView 原理及方案分析\"></a>tagsView 原理及方案分析</h1><p>所谓 <code>tagsView</code> 可以分成两部分来去看：</p>\n<ol>\n<li>tags</li>\n<li>view</li>\n</ol>\n<p>好像和废话一样是吧。那怎么分开看呢？</p>\n<p>首先我们先来看 <code>tags</code>：</p>\n<p>所谓 <code>tgas</code> 指的是：<strong>位于 <code>appmain</code> 之上的标签</strong></p>\n<p>那么现在我们忽略掉 <code>view</code>，现在只有一个要求：</p>\n<blockquote>\n<p>在 <code>view</code> 之上渲染这个 <code>tag</code> </p>\n</blockquote>\n<p>仅看这一个要求，很简单吧。</p>\n<p><strong>views：</strong></p>\n<p>明确好了 <code>tags</code> 之后，我们来看 <code>views</code>。</p>\n<p>脱离了 <code>tags</code> 只看 <code>views</code> 就更简单了，所谓 <code>views</code> ：<strong>指的就是一个用来渲染组件的位置</strong>，就像我们之前的 <code>Appmain</code> 一样，只不过这里的 <code>views</code> 可能稍微复杂一点，因为它需要在渲染的基础上增加：</p>\n<ol>\n<li>动画</li>\n<li>缓存</li>\n</ol>\n<p>这两个额外的功能。</p>\n<p>加上这两个功能之后可能会略显复杂，但是 <a href=\"https://next.router.vuejs.org/zh/guide/advanced/transitions.html#%E5%9F%BA%E4%BA%8E%E8%B7%AF%E7%94%B1%E7%9A%84%E5%8A%A8%E6%80%81%E8%BF%87%E6%B8%A1\">官网已经帮助我们处理了这个问题</a> </p>\n<p>所以 单看 <code>views</code> 也是一个很简单的功能。</p>\n<p>那么接下来我们需要做的就是把 <code>tags</code> 和 <code>view</code> 合并起来而已。</p>\n<p>那么明确好了原理之后，我们就来看 <strong>实现方案：</strong></p>\n<ol>\n<li>创建 <code>tagsView</code> 组件：用来处理 <code>tags</code> 的展示</li>\n<li>处理基于路由的动态过渡，在 <code>AppMain</code> 中进行：用于处理 <code>view</code> 的部分</li>\n</ol>\n<p>整个的方案就是这么两大部，但是其中我们还需要处理一些细节相关的，<strong>完整的方案为</strong>：</p>\n<ol>\n<li>监听路由变化，组成用于渲染 <code>tags</code> 的数据源</li>\n<li>创建 <code>tags</code> 组件，根据数据源渲染 <code>tag</code>，渲染出来的 <code>tags</code> 需要同时具备<ol>\n<li>国际化 <code>title</code></li>\n<li>路由跳转</li>\n</ol>\n</li>\n<li>处理鼠标右键效果，根据右键处理对应数据源</li>\n<li>处理基于路由的动态过渡</li>\n</ol>\n<p>那么明确好了方案之后，接下来我们根据方案进行处理即可。</p>\n<h2 id=\"创建-tags-数据源\"><a href=\"#创建-tags-数据源\" class=\"headerlink\" title=\"创建 tags 数据源\"></a>创建 tags 数据源</h2><p><code>tags</code> 的数据源分为两部分：</p>\n<ol>\n<li>保存数据：<code>appmain</code> 组件中进行</li>\n<li>展示数据：<code>tags</code> 组件中进行</li>\n</ol>\n<p>所以 <code>tags</code> 的数据我们最好把它保存到 <code>vuex</code> 中。</p>\n<ol>\n<li><p>在 <code>constant</code> 中新建常量</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\"><span class=\"hljs-comment\">// tags</span><br><span class=\"hljs-keyword\">export</span> <span class=\"hljs-keyword\">const</span> <span class=\"hljs-variable constant_\">TAGS_VIEW</span> = <span class=\"hljs-string\">&#x27;tagsView&#x27;</span><br></code></pre></td></tr></table></figure>\n</li>\n<li><p>在 <code>store/app</code> 中创建 <code>tagsViewList</code></p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\"><span class=\"hljs-keyword\">import</span> &#123; <span class=\"hljs-variable constant_\">LANG</span>, <span class=\"hljs-variable constant_\">TAGS_VIEW</span> &#125; <span class=\"hljs-keyword\">from</span> <span class=\"hljs-string\">&#x27;@/constant&#x27;</span><br><span class=\"hljs-keyword\">import</span> &#123; getItem, setItem &#125; <span class=\"hljs-keyword\">from</span> <span class=\"hljs-string\">&#x27;@/utils/storage&#x27;</span><br><span class=\"hljs-keyword\">export</span> <span class=\"hljs-keyword\">default</span> &#123;<br>  <span class=\"hljs-attr\">namespaced</span>: <span class=\"hljs-literal\">true</span>,<br>  <span class=\"hljs-attr\">state</span>: <span class=\"hljs-function\">() =&gt;</span> (&#123;<br>    ...<br>    <span class=\"hljs-attr\">tagsViewList</span>: <span class=\"hljs-title function_\">getItem</span>(<span class=\"hljs-variable constant_\">TAGS_VIEW</span>) || []<br>  &#125;),<br>  <span class=\"hljs-attr\">mutations</span>: &#123;<br>    ...<br>    <span class=\"hljs-comment\">/**</span><br><span class=\"hljs-comment\">     * 添加 tags</span><br><span class=\"hljs-comment\">     */</span><br>    <span class=\"hljs-title function_\">addTagsViewList</span>(<span class=\"hljs-params\">state, tag</span>) &#123;<br>      <span class=\"hljs-keyword\">const</span> isFind = state.<span class=\"hljs-property\">tagsViewList</span>.<span class=\"hljs-title function_\">find</span>(<span class=\"hljs-function\"><span class=\"hljs-params\">item</span> =&gt;</span> &#123;<br>        <span class=\"hljs-keyword\">return</span> item.<span class=\"hljs-property\">path</span> === tag.<span class=\"hljs-property\">path</span><br>      &#125;)<br>    <span class=\"hljs-comment\">// 处理重复</span><br>      <span class=\"hljs-keyword\">if</span> (!isFind) &#123;<br>        state.<span class=\"hljs-property\">tagsViewList</span>.<span class=\"hljs-title function_\">push</span>(tag)<br>        <span class=\"hljs-title function_\">setItem</span>(<span class=\"hljs-variable constant_\">TAGS_VIEW</span>, state.<span class=\"hljs-property\">tagsViewList</span>)<br>      &#125;<br>    &#125;<br>  &#125;,<br>  <span class=\"hljs-attr\">actions</span>: &#123;&#125;<br>&#125;<br><br></code></pre></td></tr></table></figure>\n</li>\n<li><p>在 <code>appmain</code> 中监听路由的变化</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\">&lt;script setup&gt;<br><span class=\"hljs-keyword\">import</span> &#123; watch &#125; <span class=\"hljs-keyword\">from</span> <span class=\"hljs-string\">&#x27;vue&#x27;</span><br><span class=\"hljs-keyword\">import</span> &#123; isTags &#125; <span class=\"hljs-keyword\">from</span> <span class=\"hljs-string\">&#x27;@/utils/tags&#x27;</span><br><span class=\"hljs-keyword\">import</span> &#123; generateTitle &#125; <span class=\"hljs-keyword\">from</span> <span class=\"hljs-string\">&#x27;@/utils/i18n&#x27;</span><br><span class=\"hljs-keyword\">import</span> &#123; useRoute &#125; <span class=\"hljs-keyword\">from</span> <span class=\"hljs-string\">&#x27;vue-router&#x27;</span><br><span class=\"hljs-keyword\">import</span> &#123; useStore &#125; <span class=\"hljs-keyword\">from</span> <span class=\"hljs-string\">&#x27;vuex&#x27;</span><br><br><span class=\"hljs-keyword\">const</span> route = <span class=\"hljs-title function_\">useRoute</span>()<br><br><span class=\"hljs-comment\">/**</span><br><span class=\"hljs-comment\"> * 生成 title</span><br><span class=\"hljs-comment\"> */</span><br><span class=\"hljs-keyword\">const</span> <span class=\"hljs-title function_\">getTitle</span> = route =&gt; &#123;<br>  <span class=\"hljs-keyword\">let</span> title = <span class=\"hljs-string\">&#x27;&#x27;</span><br>  <span class=\"hljs-keyword\">if</span> (!route.<span class=\"hljs-property\">meta</span>) &#123;<br>    <span class=\"hljs-comment\">// 处理无 meta 的路由</span><br>    <span class=\"hljs-keyword\">const</span> pathArr = route.<span class=\"hljs-property\">path</span>.<span class=\"hljs-title function_\">split</span>(<span class=\"hljs-string\">&#x27;/&#x27;</span>)<br>    title = pathArr[pathArr.<span class=\"hljs-property\">length</span> - <span class=\"hljs-number\">1</span>]<br>  &#125; <span class=\"hljs-keyword\">else</span> &#123;<br>    title = <span class=\"hljs-title function_\">generateTitle</span>(route.<span class=\"hljs-property\">meta</span>.<span class=\"hljs-property\">title</span>)<br>  &#125;<br>  <span class=\"hljs-keyword\">return</span> title<br>&#125;<br><br><span class=\"hljs-comment\">/**</span><br><span class=\"hljs-comment\"> * 监听路由变化</span><br><span class=\"hljs-comment\"> */</span><br><span class=\"hljs-keyword\">const</span> store = <span class=\"hljs-title function_\">useStore</span>()<br><span class=\"hljs-title function_\">watch</span>(<br>  route,<br>  <span class=\"hljs-function\">(<span class=\"hljs-params\">to, <span class=\"hljs-keyword\">from</span></span>) =&gt;</span> &#123;<br>    <span class=\"hljs-keyword\">if</span> (!<span class=\"hljs-title function_\">isTags</span>(to.<span class=\"hljs-property\">path</span>)) <span class=\"hljs-keyword\">return</span><br>    <span class=\"hljs-keyword\">const</span> &#123; fullPath, meta, name, params, path, query &#125; = to<br>    store.<span class=\"hljs-title function_\">commit</span>(<span class=\"hljs-string\">&#x27;app/addTagsViewList&#x27;</span>, &#123;<br>      fullPath,<br>      meta,<br>      name,<br>      params,<br>      path,<br>      query,<br>      <span class=\"hljs-attr\">title</span>: <span class=\"hljs-title function_\">getTitle</span>(to)<br>    &#125;)<br>  &#125;,<br>  &#123;<br>    <span class=\"hljs-attr\">immediate</span>: <span class=\"hljs-literal\">true</span><br>  &#125;<br>)<br>&lt;/script&gt;<br><br><br></code></pre></td></tr></table></figure>\n</li>\n<li><p>创建 <code>utils/tags</code></p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\"><span class=\"hljs-keyword\">const</span> whiteList = [<span class=\"hljs-string\">&#x27;/login&#x27;</span>, <span class=\"hljs-string\">&#x27;/import&#x27;</span>, <span class=\"hljs-string\">&#x27;/404&#x27;</span>, <span class=\"hljs-string\">&#x27;/401&#x27;</span>]<br><br><span class=\"hljs-comment\">/**</span><br><span class=\"hljs-comment\"> * path 是否需要被缓存</span><br><span class=\"hljs-comment\"> * <span class=\"hljs-doctag\">@param</span> &#123;<span class=\"hljs-type\">*</span>&#125; <span class=\"hljs-variable\">path</span></span><br><span class=\"hljs-comment\"> * <span class=\"hljs-doctag\">@returns</span></span><br><span class=\"hljs-comment\"> */</span><br><span class=\"hljs-keyword\">export</span> <span class=\"hljs-keyword\">function</span> <span class=\"hljs-title function_\">isTags</span>(<span class=\"hljs-params\">path</span>) &#123;<br>  <span class=\"hljs-keyword\">return</span> !whiteList.<span class=\"hljs-title function_\">includes</span>(path)<br>&#125;<br><br></code></pre></td></tr></table></figure>\n\n\n\n</li>\n</ol>\n<h2 id=\"生成-tagsView\"><a href=\"#生成-tagsView\" class=\"headerlink\" title=\"生成 tagsView\"></a>生成 tagsView</h2><p>目前数据已经被保存到 <code>store</code> 中，那么接下来我们就依赖数据渲染 <code>tags</code></p>\n<ol>\n<li><p>创建 <code>store/app</code> 中 <code>tagsViewList</code> 的快捷访问</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\"><span class=\"hljs-attr\">tagsViewList</span>: <span class=\"hljs-function\"><span class=\"hljs-params\">state</span> =&gt;</span> state.<span class=\"hljs-property\">app</span>.<span class=\"hljs-property\">tagsViewList</span><br></code></pre></td></tr></table></figure>\n</li>\n<li><p>创建 <code>components/tagsview</code></p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br><span class=\"line\">103</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\">&lt;template&gt;<br>  <span class=\"language-xml\"><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">div</span> <span class=\"hljs-attr\">class</span>=<span class=\"hljs-string\">&quot;tags-view-container&quot;</span>&gt;</span></span><br><span class=\"language-xml\">      <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">router-link</span></span></span><br><span class=\"hljs-tag\"><span class=\"language-xml\">        <span class=\"hljs-attr\">class</span>=<span class=\"hljs-string\">&quot;tags-view-item&quot;</span></span></span><br><span class=\"hljs-tag\"><span class=\"language-xml\">        <span class=\"hljs-attr\">:class</span>=<span class=\"hljs-string\">&quot;isActive(tag) ? &#x27;active&#x27; : &#x27;&#x27;&quot;</span></span></span><br><span class=\"hljs-tag\"><span class=\"language-xml\">        <span class=\"hljs-attr\">:style</span>=<span class=\"hljs-string\">&quot;&#123;</span></span></span><br><span class=\"hljs-string\"><span class=\"hljs-tag\"><span class=\"language-xml\">          backgroundColor: isActive(tag) ? $store.getters.cssVar.menuBg : &#x27;&#x27;,</span></span></span><br><span class=\"hljs-string\"><span class=\"hljs-tag\"><span class=\"language-xml\">          borderColor: isActive(tag) ? $store.getters.cssVar.menuBg : &#x27;&#x27;</span></span></span><br><span class=\"hljs-string\"><span class=\"hljs-tag\"><span class=\"language-xml\">        &#125;&quot;</span></span></span><br><span class=\"hljs-tag\"><span class=\"language-xml\">        <span class=\"hljs-attr\">v-for</span>=<span class=\"hljs-string\">&quot;(tag, index) in $store.getters.tagsViewList&quot;</span></span></span><br><span class=\"hljs-tag\"><span class=\"language-xml\">        <span class=\"hljs-attr\">:key</span>=<span class=\"hljs-string\">&quot;tag.fullPath&quot;</span></span></span><br><span class=\"hljs-tag\"><span class=\"language-xml\">        <span class=\"hljs-attr\">:to</span>=<span class=\"hljs-string\">&quot;&#123; path: tag.fullPath &#125;&quot;</span></span></span><br><span class=\"hljs-tag\"><span class=\"language-xml\">      &gt;</span></span><br><span class=\"language-xml\">        &#123;&#123; tag.title &#125;&#125;</span><br><span class=\"language-xml\">        <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">i</span></span></span><br><span class=\"hljs-tag\"><span class=\"language-xml\">          <span class=\"hljs-attr\">v-show</span>=<span class=\"hljs-string\">&quot;!isActive(tag)&quot;</span></span></span><br><span class=\"hljs-tag\"><span class=\"language-xml\">          <span class=\"hljs-attr\">class</span>=<span class=\"hljs-string\">&quot;el-icon-close&quot;</span></span></span><br><span class=\"hljs-tag\"><span class=\"language-xml\">          @<span class=\"hljs-attr\">click.prevent.stop</span>=<span class=\"hljs-string\">&quot;onCloseClick(index)&quot;</span></span></span><br><span class=\"hljs-tag\"><span class=\"language-xml\">        /&gt;</span></span><br><span class=\"language-xml\">      <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">router-link</span>&gt;</span></span><br><span class=\"language-xml\">  <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">div</span>&gt;</span></span><br>&lt;/template&gt;<br><br><span class=\"language-xml\"><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">script</span> <span class=\"hljs-attr\">setup</span>&gt;</span><span class=\"language-javascript\"></span></span><br><span class=\"language-javascript\"><span class=\"language-xml\"><span class=\"hljs-keyword\">import</span> &#123; useRoute &#125; <span class=\"hljs-keyword\">from</span> <span class=\"hljs-string\">&#x27;vue-router&#x27;</span></span></span><br><span class=\"language-javascript\"><span class=\"language-xml\"><span class=\"hljs-keyword\">const</span> route = <span class=\"hljs-title function_\">useRoute</span>()</span></span><br><span class=\"language-javascript\"><span class=\"language-xml\"></span></span><br><span class=\"language-javascript\"><span class=\"language-xml\"><span class=\"hljs-comment\">/**</span></span></span><br><span class=\"hljs-comment\"><span class=\"language-javascript\"><span class=\"language-xml\"> * 是否被选中</span></span></span><br><span class=\"hljs-comment\"><span class=\"language-javascript\"><span class=\"language-xml\"> */</span></span></span><br><span class=\"language-javascript\"><span class=\"language-xml\"><span class=\"hljs-keyword\">const</span> <span class=\"hljs-title function_\">isActive</span> = tag =&gt; &#123;</span></span><br><span class=\"language-javascript\"><span class=\"language-xml\">  <span class=\"hljs-keyword\">return</span> tag.<span class=\"hljs-property\">path</span> === route.<span class=\"hljs-property\">path</span></span></span><br><span class=\"language-javascript\"><span class=\"language-xml\">&#125;</span></span><br><span class=\"language-javascript\"><span class=\"language-xml\"></span></span><br><span class=\"language-javascript\"><span class=\"language-xml\"><span class=\"hljs-comment\">/**</span></span></span><br><span class=\"hljs-comment\"><span class=\"language-javascript\"><span class=\"language-xml\"> * 关闭 tag 的点击事件</span></span></span><br><span class=\"hljs-comment\"><span class=\"language-javascript\"><span class=\"language-xml\"> */</span></span></span><br><span class=\"language-javascript\"><span class=\"language-xml\"><span class=\"hljs-keyword\">const</span> <span class=\"hljs-title function_\">onCloseClick</span> = index =&gt; &#123;&#125;</span></span><br><span class=\"language-javascript\"><span class=\"language-xml\"></span><span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">script</span>&gt;</span></span><br><br><span class=\"language-xml\"><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">style</span> <span class=\"hljs-attr\">lang</span>=<span class=\"hljs-string\">&quot;scss&quot;</span> <span class=\"hljs-attr\">scoped</span>&gt;</span><span class=\"language-css\"></span></span><br><span class=\"language-css\"><span class=\"language-xml\"><span class=\"hljs-selector-class\">.tags-view-container</span> &#123;</span></span><br><span class=\"language-css\"><span class=\"language-xml\">  <span class=\"hljs-attribute\">height</span>: <span class=\"hljs-number\">34px</span>;</span></span><br><span class=\"language-css\"><span class=\"language-xml\">  <span class=\"hljs-attribute\">width</span>: <span class=\"hljs-number\">100%</span>;</span></span><br><span class=\"language-css\"><span class=\"language-xml\">  <span class=\"hljs-attribute\">background</span>: <span class=\"hljs-number\">#fff</span>;</span></span><br><span class=\"language-css\"><span class=\"language-xml\">  <span class=\"hljs-attribute\">border-bottom</span>: <span class=\"hljs-number\">1px</span> solid <span class=\"hljs-number\">#d8dce5</span>;</span></span><br><span class=\"language-css\"><span class=\"language-xml\">  <span class=\"hljs-attribute\">box-shadow</span>: <span class=\"hljs-number\">0</span> <span class=\"hljs-number\">1px</span> <span class=\"hljs-number\">3px</span> <span class=\"hljs-number\">0</span> <span class=\"hljs-built_in\">rgba</span>(<span class=\"hljs-number\">0</span>, <span class=\"hljs-number\">0</span>, <span class=\"hljs-number\">0</span>, <span class=\"hljs-number\">0.12</span>), <span class=\"hljs-number\">0</span> <span class=\"hljs-number\">0</span> <span class=\"hljs-number\">3px</span> <span class=\"hljs-number\">0</span> <span class=\"hljs-built_in\">rgba</span>(<span class=\"hljs-number\">0</span>, <span class=\"hljs-number\">0</span>, <span class=\"hljs-number\">0</span>, <span class=\"hljs-number\">0.04</span>);</span></span><br><span class=\"language-css\"><span class=\"language-xml\">    <span class=\"hljs-selector-class\">.tags-view-item</span> &#123;</span></span><br><span class=\"language-css\"><span class=\"language-xml\">      <span class=\"hljs-attribute\">display</span>: inline-block;</span></span><br><span class=\"language-css\"><span class=\"language-xml\">      <span class=\"hljs-attribute\">position</span>: relative;</span></span><br><span class=\"language-css\"><span class=\"language-xml\">      <span class=\"hljs-attribute\">cursor</span>: pointer;</span></span><br><span class=\"language-css\"><span class=\"language-xml\">      <span class=\"hljs-attribute\">height</span>: <span class=\"hljs-number\">26px</span>;</span></span><br><span class=\"language-css\"><span class=\"language-xml\">      <span class=\"hljs-attribute\">line-height</span>: <span class=\"hljs-number\">26px</span>;</span></span><br><span class=\"language-css\"><span class=\"language-xml\">      <span class=\"hljs-attribute\">border</span>: <span class=\"hljs-number\">1px</span> solid <span class=\"hljs-number\">#d8dce5</span>;</span></span><br><span class=\"language-css\"><span class=\"language-xml\">      <span class=\"hljs-attribute\">color</span>: <span class=\"hljs-number\">#495060</span>;</span></span><br><span class=\"language-css\"><span class=\"language-xml\">      <span class=\"hljs-attribute\">background</span>: <span class=\"hljs-number\">#fff</span>;</span></span><br><span class=\"language-css\"><span class=\"language-xml\">      <span class=\"hljs-attribute\">padding</span>: <span class=\"hljs-number\">0</span> <span class=\"hljs-number\">8px</span>;</span></span><br><span class=\"language-css\"><span class=\"language-xml\">      <span class=\"hljs-attribute\">font-size</span>: <span class=\"hljs-number\">12px</span>;</span></span><br><span class=\"language-css\"><span class=\"language-xml\">      <span class=\"hljs-attribute\">margin-left</span>: <span class=\"hljs-number\">5px</span>;</span></span><br><span class=\"language-css\"><span class=\"language-xml\">      <span class=\"hljs-attribute\">margin-top</span>: <span class=\"hljs-number\">4px</span>;</span></span><br><span class=\"language-css\"><span class=\"language-xml\">      &amp;<span class=\"hljs-selector-pseudo\">:first</span>-of-type &#123;</span></span><br><span class=\"language-css\"><span class=\"language-xml\">        <span class=\"hljs-attribute\">margin-left</span>: <span class=\"hljs-number\">15px</span>;</span></span><br><span class=\"language-css\"><span class=\"language-xml\">      &#125;</span></span><br><span class=\"language-css\"><span class=\"language-xml\">      &amp;<span class=\"hljs-selector-pseudo\">:last-of-type</span> &#123;</span></span><br><span class=\"language-css\"><span class=\"language-xml\">        <span class=\"hljs-attribute\">margin-right</span>: <span class=\"hljs-number\">15px</span>;</span></span><br><span class=\"language-css\"><span class=\"language-xml\">      &#125;</span></span><br><span class=\"language-css\"><span class=\"language-xml\">      &amp;<span class=\"hljs-selector-class\">.active</span> &#123;</span></span><br><span class=\"language-css\"><span class=\"language-xml\">        <span class=\"hljs-attribute\">color</span>: <span class=\"hljs-number\">#fff</span>;</span></span><br><span class=\"language-css\"><span class=\"language-xml\">        &amp;<span class=\"hljs-selector-pseudo\">::before</span> &#123;</span></span><br><span class=\"language-css\"><span class=\"language-xml\">          <span class=\"hljs-attribute\">content</span>: <span class=\"hljs-string\">&#x27;&#x27;</span>;</span></span><br><span class=\"language-css\"><span class=\"language-xml\">          <span class=\"hljs-attribute\">background</span>: <span class=\"hljs-number\">#fff</span>;</span></span><br><span class=\"language-css\"><span class=\"language-xml\">          <span class=\"hljs-attribute\">display</span>: inline-block;</span></span><br><span class=\"language-css\"><span class=\"language-xml\">          <span class=\"hljs-attribute\">width</span>: <span class=\"hljs-number\">8px</span>;</span></span><br><span class=\"language-css\"><span class=\"language-xml\">          <span class=\"hljs-attribute\">height</span>: <span class=\"hljs-number\">8px</span>;</span></span><br><span class=\"language-css\"><span class=\"language-xml\">          <span class=\"hljs-attribute\">border-radius</span>: <span class=\"hljs-number\">50%</span>;</span></span><br><span class=\"language-css\"><span class=\"language-xml\">          <span class=\"hljs-attribute\">position</span>: relative;</span></span><br><span class=\"language-css\"><span class=\"language-xml\">          <span class=\"hljs-attribute\">margin-right</span>: <span class=\"hljs-number\">4px</span>;</span></span><br><span class=\"language-css\"><span class=\"language-xml\">        &#125;</span></span><br><span class=\"language-css\"><span class=\"language-xml\">      &#125;</span></span><br><span class=\"language-css\"><span class=\"language-xml\">      // close 按钮</span></span><br><span class=\"language-css\"><span class=\"language-xml\">      <span class=\"hljs-selector-class\">.el-icon-close</span> &#123;</span></span><br><span class=\"language-css\"><span class=\"language-xml\">        <span class=\"hljs-attribute\">width</span>: <span class=\"hljs-number\">16px</span>;</span></span><br><span class=\"language-css\"><span class=\"language-xml\">        <span class=\"hljs-attribute\">height</span>: <span class=\"hljs-number\">16px</span>;</span></span><br><span class=\"language-css\"><span class=\"language-xml\">        <span class=\"hljs-attribute\">line-height</span>: <span class=\"hljs-number\">10px</span>;</span></span><br><span class=\"language-css\"><span class=\"language-xml\">        <span class=\"hljs-attribute\">vertical-align</span>: <span class=\"hljs-number\">2px</span>;</span></span><br><span class=\"language-css\"><span class=\"language-xml\">        <span class=\"hljs-attribute\">border-radius</span>: <span class=\"hljs-number\">50%</span>;</span></span><br><span class=\"language-css\"><span class=\"language-xml\">        <span class=\"hljs-attribute\">text-align</span>: center;</span></span><br><span class=\"language-css\"><span class=\"language-xml\">        <span class=\"hljs-attribute\">transition</span>: all <span class=\"hljs-number\">0.3s</span> <span class=\"hljs-built_in\">cubic-bezier</span>(<span class=\"hljs-number\">0.645</span>, <span class=\"hljs-number\">0.045</span>, <span class=\"hljs-number\">0.355</span>, <span class=\"hljs-number\">1</span>);</span></span><br><span class=\"language-css\"><span class=\"language-xml\">        <span class=\"hljs-attribute\">transform-origin</span>: <span class=\"hljs-number\">100%</span> <span class=\"hljs-number\">50%</span>;</span></span><br><span class=\"language-css\"><span class=\"language-xml\">        &amp;<span class=\"hljs-selector-pseudo\">:before</span> &#123;</span></span><br><span class=\"language-css\"><span class=\"language-xml\">          <span class=\"hljs-attribute\">transform</span>: <span class=\"hljs-built_in\">scale</span>(<span class=\"hljs-number\">0.6</span>);</span></span><br><span class=\"language-css\"><span class=\"language-xml\">          <span class=\"hljs-attribute\">display</span>: inline-block;</span></span><br><span class=\"language-css\"><span class=\"language-xml\">          <span class=\"hljs-attribute\">vertical-align</span>: -<span class=\"hljs-number\">3px</span>;</span></span><br><span class=\"language-css\"><span class=\"language-xml\">        &#125;</span></span><br><span class=\"language-css\"><span class=\"language-xml\">        &amp;<span class=\"hljs-selector-pseudo\">:hover</span> &#123;</span></span><br><span class=\"language-css\"><span class=\"language-xml\">          <span class=\"hljs-attribute\">background-color</span>: <span class=\"hljs-number\">#b4bccc</span>;</span></span><br><span class=\"language-css\"><span class=\"language-xml\">          <span class=\"hljs-attribute\">color</span>: <span class=\"hljs-number\">#fff</span>;</span></span><br><span class=\"language-css\"><span class=\"language-xml\">        &#125;</span></span><br><span class=\"language-css\"><span class=\"language-xml\">      &#125;</span></span><br><span class=\"language-css\"><span class=\"language-xml\">    </span></span><br><span class=\"language-css\"><span class=\"language-xml\">  &#125;</span></span><br><span class=\"language-css\"><span class=\"language-xml\">&#125;</span></span><br><span class=\"language-css\"><span class=\"language-xml\"></span><span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">style</span>&gt;</span></span><br></code></pre></td></tr></table></figure>\n</li>\n<li><p>在 <code>layout/index</code> 中导入</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\">&lt;div <span class=\"hljs-keyword\">class</span>=<span class=\"hljs-string\">&quot;fixed-header&quot;</span>&gt;<br>    &lt;!-- 顶部的 navbar --&gt;<br>    <span class=\"language-xml\"><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">navbar</span> /&gt;</span></span><br>    &lt;!-- tags --&gt;<br>    <span class=\"language-xml\"><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">tags-view</span>&gt;</span><span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">tags-view</span>&gt;</span></span><br>&lt;/div&gt;<br><br><span class=\"hljs-keyword\">import</span> <span class=\"hljs-title class_\">TagsView</span> <span class=\"hljs-keyword\">from</span> <span class=\"hljs-string\">&#x27;@/components/TagsView&#x27;</span><br><br></code></pre></td></tr></table></figure>\n\n\n\n</li>\n</ol>\n<h2 id=\"tagsView-国际化处理\"><a href=\"#tagsView-国际化处理\" class=\"headerlink\" title=\"tagsView 国际化处理\"></a>tagsView 国际化处理</h2><p><code>tagsView</code> 的国际化处理可以理解为修改现有 <code>tags</code> 的 <code>title</code>。</p>\n<p>所以我们只需要：</p>\n<ol>\n<li>监听到语言变化</li>\n<li>国际化对应的 <code>title</code> 即可</li>\n</ol>\n<p>根据方案，可生成如下代码：</p>\n<ol>\n<li><p>在 <code>store/app</code> 中，创建修改 <code>ttile</code> 的 <code>mutations</code></p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\"><span class=\"hljs-comment\">/**</span><br><span class=\"hljs-comment\">* 为指定的 tag 修改 title</span><br><span class=\"hljs-comment\">*/</span><br><span class=\"hljs-title function_\">changeTagsView</span>(<span class=\"hljs-params\">state, &#123; index, tag &#125;</span>) &#123;<br>    state.<span class=\"hljs-property\">tagsViewList</span>[index] = tag<br>    <span class=\"hljs-title function_\">setItem</span>(<span class=\"hljs-variable constant_\">TAGS_VIEW</span>, state.<span class=\"hljs-property\">tagsViewList</span>)<br>&#125;<br></code></pre></td></tr></table></figure>\n\n\n\n</li>\n</ol>\n<ol start=\"2\">\n<li><p>在 <code>appmain</code> 中监听语言变化</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\"><span class=\"hljs-keyword\">import</span> &#123; generateTitle, watchSwitchLang &#125; <span class=\"hljs-keyword\">from</span> <span class=\"hljs-string\">&#x27;@/utils/i18n&#x27;</span><br><br><span class=\"hljs-comment\">/**</span><br><span class=\"hljs-comment\"> * 国际化 tags</span><br><span class=\"hljs-comment\"> */</span><br><span class=\"hljs-title function_\">watchSwitchLang</span>(<span class=\"hljs-function\">() =&gt;</span> &#123;<br>  store.<span class=\"hljs-property\">getters</span>.<span class=\"hljs-property\">tagsViewList</span>.<span class=\"hljs-title function_\">forEach</span>(<span class=\"hljs-function\">(<span class=\"hljs-params\">route, index</span>) =&gt;</span> &#123;<br>    store.<span class=\"hljs-title function_\">commit</span>(<span class=\"hljs-string\">&#x27;app/changeTagsView&#x27;</span>, &#123;<br>      index,<br>      <span class=\"hljs-attr\">tag</span>: &#123;<br>        ...route,<br>        <span class=\"hljs-attr\">title</span>: <span class=\"hljs-title function_\">getTitle</span>(route)<br>      &#125;<br>    &#125;)<br>  &#125;)<br>&#125;)<br></code></pre></td></tr></table></figure>\n\n\n\n</li>\n</ol>\n<h2 id=\"contextMenu-展示处理\"><a href=\"#contextMenu-展示处理\" class=\"headerlink\" title=\"contextMenu 展示处理\"></a>contextMenu 展示处理</h2><blockquote>\n<p><a href=\"https://developer.mozilla.org/zh-CN/docs/Web/API/Element/contextmenu_event\">contextMenu</a> 为 鼠标右键事件</p>\n</blockquote>\n<p><a href=\"https://developer.mozilla.org/zh-CN/docs/Web/API/Element/contextmenu_event\">contextMenu</a> 事件的处理分为两部分：</p>\n<ol>\n<li><code>contextMenu</code> 的展示</li>\n<li>右键项对应逻辑处理</li>\n</ol>\n<p>那么这一小节我们先处理第一部分：<code>contextMenu</code> 的展示：</p>\n<ol>\n<li><p>创建 <code>components/TagsView/ContextMenu</code> 组件，作为右键展示部分</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\">&lt;template&gt;<br>  <span class=\"language-xml\"><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">ul</span> <span class=\"hljs-attr\">class</span>=<span class=\"hljs-string\">&quot;context-menu-container&quot;</span>&gt;</span></span><br><span class=\"language-xml\">    <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">li</span> @<span class=\"hljs-attr\">click</span>=<span class=\"hljs-string\">&quot;onRefreshClick&quot;</span>&gt;</span></span><br><span class=\"language-xml\">      &#123;&#123; $t(&#x27;msg.tagsView.refresh&#x27;) &#125;&#125;</span><br><span class=\"language-xml\">    <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">li</span>&gt;</span></span><br><span class=\"language-xml\">    <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">li</span> @<span class=\"hljs-attr\">click</span>=<span class=\"hljs-string\">&quot;onCloseRightClick&quot;</span>&gt;</span></span><br><span class=\"language-xml\">      &#123;&#123; $t(&#x27;msg.tagsView.closeRight&#x27;) &#125;&#125;</span><br><span class=\"language-xml\">    <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">li</span>&gt;</span></span><br><span class=\"language-xml\">    <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">li</span> @<span class=\"hljs-attr\">click</span>=<span class=\"hljs-string\">&quot;onCloseOtherClick&quot;</span>&gt;</span></span><br><span class=\"language-xml\">      &#123;&#123; $t(&#x27;msg.tagsView.closeOther&#x27;) &#125;&#125;</span><br><span class=\"language-xml\">    <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">li</span>&gt;</span></span><br><span class=\"language-xml\">  <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">ul</span>&gt;</span></span><br>&lt;/template&gt;<br><br><span class=\"language-xml\"><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">script</span> <span class=\"hljs-attr\">setup</span>&gt;</span><span class=\"language-javascript\"></span></span><br><span class=\"language-javascript\"><span class=\"language-xml\"><span class=\"hljs-keyword\">import</span> &#123; defineProps &#125; <span class=\"hljs-keyword\">from</span> <span class=\"hljs-string\">&#x27;vue&#x27;</span></span></span><br><span class=\"language-javascript\"><span class=\"language-xml\"><span class=\"hljs-title function_\">defineProps</span>(&#123;</span></span><br><span class=\"language-javascript\"><span class=\"language-xml\">  <span class=\"hljs-attr\">index</span>: &#123;</span></span><br><span class=\"language-javascript\"><span class=\"language-xml\">    <span class=\"hljs-attr\">type</span>: <span class=\"hljs-title class_\">Number</span>,</span></span><br><span class=\"language-javascript\"><span class=\"language-xml\">    <span class=\"hljs-attr\">required</span>: <span class=\"hljs-literal\">true</span></span></span><br><span class=\"language-javascript\"><span class=\"language-xml\">  &#125;</span></span><br><span class=\"language-javascript\"><span class=\"language-xml\">&#125;)</span></span><br><span class=\"language-javascript\"><span class=\"language-xml\"></span></span><br><span class=\"language-javascript\"><span class=\"language-xml\"><span class=\"hljs-keyword\">const</span> <span class=\"hljs-title function_\">onRefreshClick</span> = (<span class=\"hljs-params\"></span>) =&gt; &#123;&#125;</span></span><br><span class=\"language-javascript\"><span class=\"language-xml\"></span></span><br><span class=\"language-javascript\"><span class=\"language-xml\"><span class=\"hljs-keyword\">const</span> <span class=\"hljs-title function_\">onCloseRightClick</span> = (<span class=\"hljs-params\"></span>) =&gt; &#123;&#125;</span></span><br><span class=\"language-javascript\"><span class=\"language-xml\"></span></span><br><span class=\"language-javascript\"><span class=\"language-xml\"><span class=\"hljs-keyword\">const</span> <span class=\"hljs-title function_\">onCloseOtherClick</span> = (<span class=\"hljs-params\"></span>) =&gt; &#123;&#125;</span></span><br><span class=\"language-javascript\"><span class=\"language-xml\"></span><span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">script</span>&gt;</span></span><br><br><span class=\"language-xml\"><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">style</span> <span class=\"hljs-attr\">lang</span>=<span class=\"hljs-string\">&quot;scss&quot;</span> <span class=\"hljs-attr\">scoped</span>&gt;</span><span class=\"language-css\"></span></span><br><span class=\"language-css\"><span class=\"language-xml\"><span class=\"hljs-selector-class\">.context-menu-container</span> &#123;</span></span><br><span class=\"language-css\"><span class=\"language-xml\">  <span class=\"hljs-attribute\">position</span>: fixed;</span></span><br><span class=\"language-css\"><span class=\"language-xml\">  <span class=\"hljs-attribute\">background</span>: <span class=\"hljs-number\">#fff</span>;</span></span><br><span class=\"language-css\"><span class=\"language-xml\">  <span class=\"hljs-attribute\">z-index</span>: <span class=\"hljs-number\">3000</span>;</span></span><br><span class=\"language-css\"><span class=\"language-xml\">  <span class=\"hljs-attribute\">list-style-type</span>: none;</span></span><br><span class=\"language-css\"><span class=\"language-xml\">  <span class=\"hljs-attribute\">padding</span>: <span class=\"hljs-number\">5px</span> <span class=\"hljs-number\">0</span>;</span></span><br><span class=\"language-css\"><span class=\"language-xml\">  <span class=\"hljs-attribute\">border-radius</span>: <span class=\"hljs-number\">4px</span>;</span></span><br><span class=\"language-css\"><span class=\"language-xml\">  <span class=\"hljs-attribute\">font-size</span>: <span class=\"hljs-number\">12px</span>;</span></span><br><span class=\"language-css\"><span class=\"language-xml\">  <span class=\"hljs-attribute\">font-weight</span>: <span class=\"hljs-number\">400</span>;</span></span><br><span class=\"language-css\"><span class=\"language-xml\">  <span class=\"hljs-attribute\">color</span>: <span class=\"hljs-number\">#333</span>;</span></span><br><span class=\"language-css\"><span class=\"language-xml\">  <span class=\"hljs-attribute\">box-shadow</span>: <span class=\"hljs-number\">2px</span> <span class=\"hljs-number\">2px</span> <span class=\"hljs-number\">3px</span> <span class=\"hljs-number\">0</span> <span class=\"hljs-built_in\">rgba</span>(<span class=\"hljs-number\">0</span>, <span class=\"hljs-number\">0</span>, <span class=\"hljs-number\">0</span>, <span class=\"hljs-number\">0.3</span>);</span></span><br><span class=\"language-css\"><span class=\"language-xml\">  <span class=\"hljs-selector-tag\">li</span> &#123;</span></span><br><span class=\"language-css\"><span class=\"language-xml\">    <span class=\"hljs-attribute\">margin</span>: <span class=\"hljs-number\">0</span>;</span></span><br><span class=\"language-css\"><span class=\"language-xml\">    <span class=\"hljs-attribute\">padding</span>: <span class=\"hljs-number\">7px</span> <span class=\"hljs-number\">16px</span>;</span></span><br><span class=\"language-css\"><span class=\"language-xml\">    <span class=\"hljs-attribute\">cursor</span>: pointer;</span></span><br><span class=\"language-css\"><span class=\"language-xml\">    &amp;<span class=\"hljs-selector-pseudo\">:hover</span> &#123;</span></span><br><span class=\"language-css\"><span class=\"language-xml\">      <span class=\"hljs-attribute\">background</span>: <span class=\"hljs-number\">#eee</span>;</span></span><br><span class=\"language-css\"><span class=\"language-xml\">    &#125;</span></span><br><span class=\"language-css\"><span class=\"language-xml\">  &#125;</span></span><br><span class=\"language-css\"><span class=\"language-xml\">&#125;</span></span><br><span class=\"language-css\"><span class=\"language-xml\"></span><span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">style</span>&gt;</span></span><br><br></code></pre></td></tr></table></figure>\n</li>\n<li><p>在 <code>tagsview</code> 中控制 <code>contextMenu</code> 的展示</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\">&lt;template&gt;<br>  <span class=\"language-xml\"><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">div</span> <span class=\"hljs-attr\">class</span>=<span class=\"hljs-string\">&quot;tags-view-container&quot;</span>&gt;</span></span><br><span class=\"language-xml\">    <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">el-scrollbar</span> <span class=\"hljs-attr\">class</span>=<span class=\"hljs-string\">&quot;tags-view-wrapper&quot;</span>&gt;</span></span><br><span class=\"language-xml\">      <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">router-link</span></span></span><br><span class=\"hljs-tag\"><span class=\"language-xml\">        <span class=\"hljs-attr\">...</span></span></span><br><span class=\"hljs-tag\"><span class=\"language-xml\">        @<span class=\"hljs-attr\">contextmenu.prevent</span>=<span class=\"hljs-string\">&quot;openMenu($event, index)&quot;</span></span></span><br><span class=\"hljs-tag\"><span class=\"language-xml\">      &gt;</span></span><br><span class=\"language-xml\">        ...</span><br><span class=\"language-xml\">    <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">el-scrollbar</span>&gt;</span></span><br><span class=\"language-xml\">    <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">context-menu</span></span></span><br><span class=\"hljs-tag\"><span class=\"language-xml\">      <span class=\"hljs-attr\">v-show</span>=<span class=\"hljs-string\">&quot;visible&quot;</span></span></span><br><span class=\"hljs-tag\"><span class=\"language-xml\">      <span class=\"hljs-attr\">:style</span>=<span class=\"hljs-string\">&quot;menuStyle&quot;</span></span></span><br><span class=\"hljs-tag\"><span class=\"language-xml\">      <span class=\"hljs-attr\">:index</span>=<span class=\"hljs-string\">&quot;selectIndex&quot;</span></span></span><br><span class=\"hljs-tag\"><span class=\"language-xml\">    &gt;</span><span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">context-menu</span>&gt;</span></span><br><span class=\"language-xml\">  <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">div</span>&gt;</span></span><br><span class=\"language-xml\"><span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">template</span>&gt;</span></span><br><br><span class=\"language-xml\"><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">script</span> <span class=\"hljs-attr\">setup</span>&gt;</span><span class=\"language-javascript\"></span></span><br><span class=\"language-javascript\"><span class=\"language-xml\"><span class=\"hljs-keyword\">import</span> <span class=\"hljs-title class_\">ContextMenu</span> <span class=\"hljs-keyword\">from</span> <span class=\"hljs-string\">&#x27;./ContextMenu.vue&#x27;</span></span></span><br><span class=\"language-javascript\"><span class=\"language-xml\"><span class=\"hljs-keyword\">import</span> &#123; ref, reactive, watch &#125; <span class=\"hljs-keyword\">from</span> <span class=\"hljs-string\">&#x27;vue&#x27;</span></span></span><br><span class=\"language-javascript\"><span class=\"language-xml\"><span class=\"hljs-keyword\">import</span> &#123; useRoute &#125; <span class=\"hljs-keyword\">from</span> <span class=\"hljs-string\">&#x27;vue-router&#x27;</span></span></span><br><span class=\"language-javascript\"><span class=\"language-xml\">...</span></span><br><span class=\"language-javascript\"><span class=\"language-xml\"></span></span><br><span class=\"language-javascript\"><span class=\"language-xml\"><span class=\"hljs-comment\">// contextMenu 相关</span></span></span><br><span class=\"language-javascript\"><span class=\"language-xml\"><span class=\"hljs-keyword\">const</span> selectIndex = <span class=\"hljs-title function_\">ref</span>(<span class=\"hljs-number\">0</span>)</span></span><br><span class=\"language-javascript\"><span class=\"language-xml\"><span class=\"hljs-keyword\">const</span> visible = <span class=\"hljs-title function_\">ref</span>(<span class=\"hljs-literal\">false</span>)</span></span><br><span class=\"language-javascript\"><span class=\"language-xml\"><span class=\"hljs-keyword\">const</span> menuStyle = <span class=\"hljs-title function_\">reactive</span>(&#123;</span></span><br><span class=\"language-javascript\"><span class=\"language-xml\">  <span class=\"hljs-attr\">left</span>: <span class=\"hljs-number\">0</span>,</span></span><br><span class=\"language-javascript\"><span class=\"language-xml\">  <span class=\"hljs-attr\">top</span>: <span class=\"hljs-number\">0</span></span></span><br><span class=\"language-javascript\"><span class=\"language-xml\">&#125;)</span></span><br><span class=\"language-javascript\"><span class=\"language-xml\"><span class=\"hljs-comment\">/**</span></span></span><br><span class=\"hljs-comment\"><span class=\"language-javascript\"><span class=\"language-xml\"> * 展示 menu</span></span></span><br><span class=\"hljs-comment\"><span class=\"language-javascript\"><span class=\"language-xml\"> */</span></span></span><br><span class=\"language-javascript\"><span class=\"language-xml\"><span class=\"hljs-keyword\">const</span> <span class=\"hljs-title function_\">openMenu</span> = (<span class=\"hljs-params\">e, index</span>) =&gt; &#123;</span></span><br><span class=\"language-javascript\"><span class=\"language-xml\">  <span class=\"hljs-keyword\">const</span> &#123; x, y &#125; = e</span></span><br><span class=\"language-javascript\"><span class=\"language-xml\">  menuStyle.<span class=\"hljs-property\">left</span> = x + <span class=\"hljs-string\">&#x27;px&#x27;</span></span></span><br><span class=\"language-javascript\"><span class=\"language-xml\">  menuStyle.<span class=\"hljs-property\">top</span> = y + <span class=\"hljs-string\">&#x27;px&#x27;</span></span></span><br><span class=\"language-javascript\"><span class=\"language-xml\">  selectIndex.<span class=\"hljs-property\">value</span> = index</span></span><br><span class=\"language-javascript\"><span class=\"language-xml\">  visible.<span class=\"hljs-property\">value</span> = <span class=\"hljs-literal\">true</span></span></span><br><span class=\"language-javascript\"><span class=\"language-xml\">&#125;</span></span><br><span class=\"language-javascript\"><span class=\"language-xml\"></span></span><br><span class=\"language-javascript\"><span class=\"language-xml\"></span></span><br><span class=\"language-javascript\"><span class=\"language-xml\"></span><span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">script</span>&gt;</span></span><br></code></pre></td></tr></table></figure>\n\n\n\n</li>\n</ol>\n<h2 id=\"contextMenu-事件处理\"><a href=\"#contextMenu-事件处理\" class=\"headerlink\" title=\"contextMenu 事件处理\"></a>contextMenu 事件处理</h2><p>对于 <code>contextMenu</code> 的事件一共分为三个：</p>\n<ol>\n<li>刷新</li>\n<li>关闭右侧</li>\n<li>关闭所有</li>\n</ol>\n<p>但是不要忘记，我们之前 <strong>关闭单个 <code>tags</code></strong> 的事件还没有进行处理，所以这一小节我们一共需要处理 4 个对应的事件</p>\n<ol>\n<li><p>刷新事件</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\"><span class=\"hljs-keyword\">const</span> router = <span class=\"hljs-title function_\">useRouter</span>()<br><span class=\"hljs-keyword\">const</span> <span class=\"hljs-title function_\">onRefreshClick</span> = (<span class=\"hljs-params\"></span>) =&gt; &#123;<br>  router.<span class=\"hljs-title function_\">go</span>(<span class=\"hljs-number\">0</span>)<br>&#125;<br></code></pre></td></tr></table></figure>\n</li>\n<li><p>在 <code>store/app</code> 中，创建删除 <code>tags</code> 的 <code>mutations</code>，该 <code>mutations</code> 需要同时具备以下三个能力：</p>\n<ol>\n<li>删除 “右侧”</li>\n<li>删除 “其他”</li>\n<li>删除 “当前”</li>\n</ol>\n</li>\n<li><p>根据以上理论得出以下代码：</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\"><span class=\"hljs-comment\">/**</span><br><span class=\"hljs-comment\">* 删除 tag</span><br><span class=\"hljs-comment\">* <span class=\"hljs-doctag\">@param</span> &#123;<span class=\"hljs-type\">type: &#x27;other&#x27;||&#x27;right&#x27;||&#x27;index&#x27;, index: index</span>&#125; <span class=\"hljs-variable\">payload</span></span><br><span class=\"hljs-comment\">*/</span><br><span class=\"hljs-title function_\">removeTagsView</span>(<span class=\"hljs-params\">state, payload</span>) &#123;<br>  <span class=\"hljs-keyword\">if</span> (payload.<span class=\"hljs-property\">type</span> === <span class=\"hljs-string\">&#x27;index&#x27;</span>) &#123;<br>    state.<span class=\"hljs-property\">tagsViewList</span>.<span class=\"hljs-title function_\">splice</span>(payload.<span class=\"hljs-property\">index</span>, <span class=\"hljs-number\">1</span>)<br>    <span class=\"hljs-keyword\">return</span><br>  &#125; <span class=\"hljs-keyword\">else</span> <span class=\"hljs-keyword\">if</span> (payload.<span class=\"hljs-property\">type</span> === <span class=\"hljs-string\">&#x27;other&#x27;</span>) &#123;<br>    state.<span class=\"hljs-property\">tagsViewList</span>.<span class=\"hljs-title function_\">splice</span>(<br>      payload.<span class=\"hljs-property\">index</span> + <span class=\"hljs-number\">1</span>,<br>      state.<span class=\"hljs-property\">tagsViewList</span>.<span class=\"hljs-property\">length</span> - payload.<span class=\"hljs-property\">index</span> + <span class=\"hljs-number\">1</span><br>    )<br>    state.<span class=\"hljs-property\">tagsViewList</span>.<span class=\"hljs-title function_\">splice</span>(<span class=\"hljs-number\">0</span>, payload.<span class=\"hljs-property\">index</span>)<br>  &#125; <span class=\"hljs-keyword\">else</span> <span class=\"hljs-keyword\">if</span> (payload.<span class=\"hljs-property\">type</span> === <span class=\"hljs-string\">&#x27;right&#x27;</span>) &#123;<br>    state.<span class=\"hljs-property\">tagsViewList</span>.<span class=\"hljs-title function_\">splice</span>(<br>      payload.<span class=\"hljs-property\">index</span> + <span class=\"hljs-number\">1</span>,<br>      state.<span class=\"hljs-property\">tagsViewList</span>.<span class=\"hljs-property\">length</span> - payload.<span class=\"hljs-property\">index</span> + <span class=\"hljs-number\">1</span><br>    )<br>  &#125;<br>  <span class=\"hljs-title function_\">setItem</span>(<span class=\"hljs-variable constant_\">TAGS_VIEW</span>, state.<span class=\"hljs-property\">tagsViewList</span>)<br>&#125;,<br></code></pre></td></tr></table></figure>\n</li>\n<li><p>关闭右侧事件</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\"><span class=\"hljs-keyword\">const</span> store = <span class=\"hljs-title function_\">useStore</span>()<br><span class=\"hljs-keyword\">const</span> <span class=\"hljs-title function_\">onCloseRightClick</span> = (<span class=\"hljs-params\"></span>) =&gt; &#123;<br>  store.<span class=\"hljs-title function_\">commit</span>(<span class=\"hljs-string\">&#x27;app/removeTagsView&#x27;</span>, &#123;<br>    <span class=\"hljs-attr\">type</span>: <span class=\"hljs-string\">&#x27;right&#x27;</span>,<br>    <span class=\"hljs-attr\">index</span>: props.<span class=\"hljs-property\">index</span><br>  &#125;)<br>&#125;<br></code></pre></td></tr></table></figure>\n</li>\n<li><p>关闭其他</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\"><span class=\"hljs-keyword\">const</span> <span class=\"hljs-title function_\">onCloseOtherClick</span> = (<span class=\"hljs-params\"></span>) =&gt; &#123;<br>  store.<span class=\"hljs-title function_\">commit</span>(<span class=\"hljs-string\">&#x27;app/removeTagsView&#x27;</span>, &#123;<br>    <span class=\"hljs-attr\">type</span>: <span class=\"hljs-string\">&#x27;other&#x27;</span>,<br>    <span class=\"hljs-attr\">index</span>: props.<span class=\"hljs-property\">index</span><br>  &#125;)<br>&#125;<br></code></pre></td></tr></table></figure>\n</li>\n<li><p>关闭当前（<code>tagsview</code>）</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\"><span class=\"hljs-comment\">/**</span><br><span class=\"hljs-comment\"> * 关闭 tag 的点击事件</span><br><span class=\"hljs-comment\"> */</span><br><span class=\"hljs-keyword\">const</span> store = <span class=\"hljs-title function_\">useStore</span>()<br><span class=\"hljs-keyword\">const</span> <span class=\"hljs-title function_\">onCloseClick</span> = index =&gt; &#123;<br>  store.<span class=\"hljs-title function_\">commit</span>(<span class=\"hljs-string\">&#x27;app/removeTagsView&#x27;</span>, &#123;<br>    <span class=\"hljs-attr\">type</span>: <span class=\"hljs-string\">&#x27;index&#x27;</span>,<br>    <span class=\"hljs-attr\">index</span>: index<br>  &#125;)<br>&#125;<br></code></pre></td></tr></table></figure>\n\n\n\n</li>\n</ol>\n<h2 id=\"处理-contextMenu-的关闭行为\"><a href=\"#处理-contextMenu-的关闭行为\" class=\"headerlink\" title=\"处理 contextMenu 的关闭行为\"></a>处理 contextMenu 的关闭行为</h2><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\"><span class=\"hljs-comment\">/**</span><br><span class=\"hljs-comment\"> * 关闭 menu</span><br><span class=\"hljs-comment\"> */</span><br><span class=\"hljs-keyword\">const</span> <span class=\"hljs-title function_\">closeMenu</span> = (<span class=\"hljs-params\"></span>) =&gt; &#123;<br>  visible.<span class=\"hljs-property\">value</span> = <span class=\"hljs-literal\">false</span><br>&#125;<br><br><span class=\"hljs-comment\">/**</span><br><span class=\"hljs-comment\"> * 监听变化</span><br><span class=\"hljs-comment\"> */</span><br><span class=\"hljs-title function_\">watch</span>(visible, <span class=\"hljs-function\"><span class=\"hljs-params\">val</span> =&gt;</span> &#123;<br>  <span class=\"hljs-keyword\">if</span> (val) &#123;<br>    <span class=\"hljs-variable language_\">document</span>.<span class=\"hljs-property\">body</span>.<span class=\"hljs-title function_\">addEventListener</span>(<span class=\"hljs-string\">&#x27;click&#x27;</span>, closeMenu)<br>  &#125; <span class=\"hljs-keyword\">else</span> &#123;<br>    <span class=\"hljs-variable language_\">document</span>.<span class=\"hljs-property\">body</span>.<span class=\"hljs-title function_\">removeEventListener</span>(<span class=\"hljs-string\">&#x27;click&#x27;</span>, closeMenu)<br>  &#125;<br>&#125;)<br></code></pre></td></tr></table></figure>\n\n\n<h2 id=\"处理基于路由的动态过渡\"><a href=\"#处理基于路由的动态过渡\" class=\"headerlink\" title=\"处理基于路由的动态过渡\"></a>处理基于路由的动态过渡</h2><p><a href=\"https://next.router.vuejs.org/zh/guide/advanced/transitions.html#%E5%9F%BA%E4%BA%8E%E8%B7%AF%E7%94%B1%E7%9A%84%E5%8A%A8%E6%80%81%E8%BF%87%E6%B8%A1\">处理基于路由的动态过渡</a>  官方已经给出了示例代码，结合 <code>router-view</code> 和 <code>transition</code> 我们可以非常方便的实现这个功能</p>\n<ol>\n<li><p>在 <code>appmain</code> 中处理对应代码逻辑</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\">&lt;template&gt;<br>  <span class=\"language-xml\"><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">div</span> <span class=\"hljs-attr\">class</span>=<span class=\"hljs-string\">&quot;app-main&quot;</span>&gt;</span></span><br><span class=\"language-xml\">    <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">router-view</span> <span class=\"hljs-attr\">v-slot</span>=<span class=\"hljs-string\">&quot;&#123; Component, route &#125;&quot;</span>&gt;</span></span><br><span class=\"language-xml\">      <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">transition</span> <span class=\"hljs-attr\">name</span>=<span class=\"hljs-string\">&quot;fade-transform&quot;</span> <span class=\"hljs-attr\">mode</span>=<span class=\"hljs-string\">&quot;out-in&quot;</span>&gt;</span></span><br><span class=\"language-xml\">        <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">keep-alive</span>&gt;</span></span><br><span class=\"language-xml\">          <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">component</span> <span class=\"hljs-attr\">:is</span>=<span class=\"hljs-string\">&quot;Component&quot;</span> <span class=\"hljs-attr\">:key</span>=<span class=\"hljs-string\">&quot;route.path&quot;</span> /&gt;</span></span><br><span class=\"language-xml\">        <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">keep-alive</span>&gt;</span></span><br><span class=\"language-xml\">      <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">transition</span>&gt;</span></span><br><span class=\"language-xml\">    <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">router-view</span>&gt;</span></span><br><span class=\"language-xml\">  <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">div</span>&gt;</span></span><br>&lt;/template&gt;<br></code></pre></td></tr></table></figure>\n</li>\n<li><p>增加了 <code>tags</code> 之后，<code>app-main</code> 的位置需要进行以下处理</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\">&lt;style lang=<span class=\"hljs-string\">&quot;scss&quot;</span> scoped&gt;<br>.<span class=\"hljs-property\">app</span>-main &#123;<br>  min-<span class=\"hljs-attr\">height</span>: <span class=\"hljs-title function_\">calc</span>(100vh - 50px - 43px);<br>  ...<br>  <span class=\"hljs-attr\">padding</span>: 104px 20px 20px 20px;<br>  ...<br>&#125;<br>&lt;/style&gt;<br></code></pre></td></tr></table></figure>\n</li>\n<li><p>在 <code>styles/transition</code> 中增加动画渲染</p>\n<figure class=\"highlight scss\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs scss\"><span class=\"hljs-comment\">/* fade-transform */</span><br><span class=\"hljs-selector-class\">.fade-transform-leave-active</span>,<br><span class=\"hljs-selector-class\">.fade-transform-enter-active</span> &#123;<br>  <span class=\"hljs-attribute\">transition</span>: all <span class=\"hljs-number\">0.5s</span>;<br>&#125;<br><br><span class=\"hljs-selector-class\">.fade-transform-enter-from</span> &#123;<br>  <span class=\"hljs-attribute\">opacity</span>: <span class=\"hljs-number\">0</span>;<br>  <span class=\"hljs-attribute\">transform</span>: translateX(-<span class=\"hljs-number\">30px</span>);<br>&#125;<br><br><span class=\"hljs-selector-class\">.fade-transform-leave-to</span> &#123;<br>  <span class=\"hljs-attribute\">opacity</span>: <span class=\"hljs-number\">0</span>;<br>  <span class=\"hljs-attribute\">transform</span>: translateX(<span class=\"hljs-number\">30px</span>);<br>&#125;<br></code></pre></td></tr></table></figure>\n\n\n\n</li>\n</ol>\n<h2 id=\"tagsView-方案总结\"><a href=\"#tagsView-方案总结\" class=\"headerlink\" title=\"tagsView 方案总结\"></a>tagsView 方案总结</h2><p>那么到这里关于 <code>tagsView</code> 的内容我们就已经处理完成了。</p>\n<p>整个 <code>tagsView</code> 就像我们之前说的，拆开来看之后，会显得明确很多。</p>\n<p>整个 <code>tagsView</code> 整体来看就是三块大的内容：</p>\n<ol>\n<li><code>tags</code>：<code>tagsView</code> 组件</li>\n<li><code>contextMenu</code>：<code>contextMenu</code> 组件</li>\n<li><code>view</code>：<code>appmain</code> 组件</li>\n</ol>\n<p>再加上一部分的数据处理即可。</p>\n<p>最后关于 <code>tags</code> 的国际化部分，其实处理的方案有非常多，大家也可以在后面的 <strong>讨论题</strong> 中探讨一下关于 <strong>此处国家化</strong> 的实现，相信会有很多新的思路被打开的。</p>\n"},{"layout":"Vue,JavaScript","title":"深入浅出Vue3","date":"2022-12-01T10:09:04.000Z","banner_img":"/img/vue3.jpg","index_img":"/img/vue3.jpg","excerpt":"渐进式 JavaScript 框架。易学易用，性能出色，适用场景丰富的 Web 前端框架","_content":"\n# ref 和 reactive 使用上有什么区别?\n\n1. ref 支持所有的类型，reactive 只接收引用类型（Array/Object/Map/Set）\n2. ref 取值和赋值都需要加 .value，reactive 不需要 .value\n3. reactive 不能直接赋值，否则会破坏响应式（proxy）\n\n如果要改变数组，可以通过 push 方法，将要 push 的数组结构 (xx.push(...arr))\n\n\n## 如何抉择呢？\n\n因为社区大佬 `basvanmeurs`提出了一个新的 PR，大概就是重构了响应式的部分内容，由于重构内容过于庞大，所以一直等到 2021 年 8 月 5 号，伴随着 Vue3.2 的发布，尤大大才合并对应的代码。\n\n`ref` 被重构之后，有了更高效的实现（提升了 约 260% 的读取速度 / 约 50% 的写入速度），依赖跟踪速度提高了约 40%，内存使用量减少了约 17%，毫无疑问这是一个伟大的变化。\n\n那么，在以后的使用过程当中，能使用 `ref` 就用 `ref`吧，毕竟它的性能得到了如此大的提升。\n\n\n# defineProps 如何定义默认值？\n\n> 针对类型的 defineProps 声明的不足之处在于，它没有可以给 props 提供默认值的方式。\n\n使用TS 特有的默认值方式 `withDefaults` 函数，无须引入开箱即用，接受一个props函数第二个参数是一个对象设置默认值。\n\n```js\nexport interface Props {\n  msg?: string\n  labels?: string[]\n}\n\nconst props = withDefaults(defineProps<Props>(), {\n  msg: 'hello',\n  labels: () => ['one', 'two']\n})\n```\n\n**注意**\n\n如果使用 withDefaults 报错 `'withDefaults' is not defined`，我们修改 `.eslintrc` 文件\n\n添加如下配置代码：\n\n```js\nglobals: {\n    withDefaults: 'readonly'\n},\n```\n\n# 动态组件\n> component\n\n要渲染的实际组件由 is prop 决定。\n\n- 当 is 是字符串，它既可以是 HTML 标签名也可以是组件的注册名。\n- 或者，is 也可以直接绑定组件。\n\n\n按注册名渲染组件\n```js\n<script>\nimport Foo from './Foo.vue'\nimport Bar from './Bar.vue'\n\nexport default {\n  components: { Foo, Bar },\n  data() {\n    return {\n      view: 'Foo'\n    }\n  }\n}\n</script>\n\n<template>\n  <component :is=\"view\" />\n</template>\n```\n\n按定义渲染组件 `<script setup> 组合式 API`：\n\n```js\n<component :is=\"Math.random() > 0.5 ? Foo : Bar\" />\n```\n\n渲染 HTML 元素\n```js\n<component :is=\"href ? 'a' : 'span'\"></component>\n```\n\n# 插槽\n\n默认插槽、具名插槽。\n\n作用域插槽：`:headerName=\"'我是头部'\"`，父组件可以通过 `v-slot=\"{ headerName }\"` 拿到组件内部暴露出来的数据\n\n```js\n// SlotComp.vue\n<template>\n  <div class=\"slot-wrapper\">\n    <header class=\"header\">\n      <slot name=\"header\" :headerName=\"'我是头部'\"></slot>\n    </header>\n    <main class=\"content\">\n      <slot></slot>\n    </main>\n    <footer class=\"footer\">\n      <slot name=\"footer\"></slot>\n    </footer>\n  </div>\n</template>\n```\n\n使用具有插槽的组件，`headerName` 是作用域插槽从内部提供的\n```js\n<SlotComp>\n  <template v-slot:header=\"{ headerName }\">{{ headerName }}</template>\n  <template v-slot>default slot</template>\n  <template v-slot:footer>footer</template>\n</SlotComp>\n```\n\n**插槽简写方式 #**\n```js\n<SlotComp>\n  <template #header=\"{ headerName }\">{{ headerName }}</template>\n  <template #default>default slot</template>\n  <template #footer>footer</template>\n</SlotComp>\n```\n\n**动态插槽**\n```js\n<SlotComp>\n  <template #[slotName]>动态插槽</template>\n</SlotComp>\n\n\n// js\nconst slotName = ref('header')\n```\n\n# 异步组件\n\n[官方描述](https://cn.vuejs.org/guide/components/async.html#basic-usage)\n\n> 在大型项目中，我们可能需要拆分应用为更小的块，并仅在需要时再从服务器加载相关组件。Vue 提供了 `defineAsyncComponent` 方法来实现此功能：\n\n```js\nimport { defineAsyncComponent } from 'vue'\n\nconst AsyncComp = defineAsyncComponent(() => {\n  return new Promise((resolve, reject) => {\n    // ...从服务器获取组件\n    resolve(/* 获取到的组件 */)\n  })\n})\n```\n\n`ES 模块动态导入` 也会返回一个 Promise，所以多数情况下我们会将它和 defineAsyncComponent 搭配使用。类似 Vite 和 Webpack 这样的构建工具也支持此语法 (并且会将它们作为打包时的代码分割点  `分包、性能优化`)\n\n```js\nimport { defineAsyncComponent } from 'vue'\n\nconst AsyncComp = defineAsyncComponent(() =>\n  import('./components/MyComponent.vue')\n)\n```\n\n最后得到的 AsyncComp 是一个外层包装过的组件，`仅在页面需要它渲染时` 才会调用加载内部实际组件的函数。\n\n## 顶层 await\n\n`<script setup>` 中可以使用顶层 await。结果代码会被编译成 `async setup()`：\n\n```js\n<script setup>\nconst post = await fetch(`/api/post/1`).then((r) => r.json())\n</script>\n```\n\n## 搭配 Suspense 组件使用\n\n1. 定义异步组件 Sync.vue\n\n```js\n<template>\n  <div>\n    Name: {{ name }}\n  </div>\n</template>\n\n<script setup lang='ts'>\nimport {ref, reactive} from 'vue'\nimport iTools from '@/utils/Tools'\n\nconst name = ref('')\nconst { data } = await iTools.Axios.get('./sync-data.json') // 定义在 public 下的json文件\nname.value = data.name\n\n</script>\n```\n\n2. 通过 `defineAsyncComponent` 动态导入 `Sync.vue` 组件\n\n```js\nconst Sync = defineAsyncComponent(() => import('@/components/Sync.vue'))\n```\n\n3. 使用 `Suspense` 内置组件\n\n在请求过程中，会一直显示 loading... 状态，真实项目中我们可以替换成骨架屏。当接口请求成功，才会显示 `Sync.vue` 的内容。\n```js\n<Suspense>\n  <template #default>\n    <Sync />\n  </template>\n\n  <template #fallback>\n    Loading...\n  </template>\n</Suspense>\n```\n\n## 性能优化\n当我们使用了 defineAsyncComponent 动态导入组件，build 项目时，会单独将 Sync.vue 的 js 包拎出来，不会将其打包到index.js 中，通过拆包的方式，减少入口文件的大小，从而减少白屏的时间。\n\n\n# Teleport 传送门\n\n将其插槽内容渲染到 DOM 中的另一个位置。\n\n```js\ninterface TeleportProps {\n  /**\n   * 必填项。指定目标容器。\n   * 可以是选择器或实际元素。\n   */\n  to: string | HTMLElement\n  /**\n   * 当值为 `true` 时，内容将保留在其原始位置\n   * 而不是移动到目标容器中。\n   * 可以动态更改。\n   */\n  disabled?: boolean\n}\n\n// examples\n<teleport to=\"#some-id\" />\n<teleport to=\".some-class\" />\n<teleport to=\"[data-teleport]\" />\n<teleport to=\"body\" />\n```\n\n# Mitt\n\nVue 2可以支持$on，$off来实现event bus，但是 Vue3 已经不支持这些属性，不过Vue 3可以支持第三方event bus来实现事件通信，\n\n这里使用 `mitt`，官方地址：https://github.com/developit/mitt\n\n```js\nimport mitt from 'mitt'\n\n// vue3挂载到全局\napp.config.globalProperties.$mitt = mitt()\n```\n\n# tsx\n\n> 安装插件 npm install @vitejs/plugin-vue-jsx -D\n\n安装如果失败，将 node 版本切换至 v14.16.0\n\n\n使用插件\n```js\nimport vueJsx from \"@vitejs/plugin-vue-jsx\";\n\nexport default defineConfig({\n  plugins: [vue(), vueJsx()],\n  // ...\n})\n```\n\n但是导入 .tsx 文件，TypeScript 会报错：\n\n```js\n// 找不到模块“@/components/Foo”或其相应的类型声明。\nimport Foo from '@/components/Foo' // 省略了 .tsx 后缀\n\n// 导入路径不能以“.tsx”扩展名结束。考虑改为导入“@/components/Bar.js”。\nimport Bar from '@/components/Bar.tsx'\n```\n\n配置 `tsconfig.json`:\n```json\n{\n  \"compilerOptions\": {\n    \"baseUrl\": \".\",\n    \"paths\": {\n      \"@/*\": [\"src/*\"]\n    },\n  }\n}\n```\n\n之后我们导入 tsx 类型的组件，就不要带上后缀了。\n\n**编写 tsx 组件的3中方式**\n\n1. 函数模式\n```js\nexport default function() {\n  return (\n    <h1>TSX componen111t</h1>\n  )\n}\n```\n\n2. options API 模式\n```js\nimport { defineComponent } from 'vue'\n\nexport default defineComponent({\n  data() {\n    return {\n      compname: 'jsx comp'\n    }\n  },\n  render() {\n    return (\n      <div>{this.compname}</div>\n    )\n  }\n})\n```\n\n3. setup 函数模式\n```js\n\ninterface IProps {\n  name?: string;\n}\n\nexport default defineComponent({\n  props: {\n    name: String,\n  },\n  emits: ['on-click'],\n  setup(props: IProps) {\n    const is = true\n    // 返回渲染函数\n    return () => {\n      return (\n        <h1 v-show={is}>setup 渲染函数 {props?.name}</h1>\n      )\n    }\n  }\n})\n```\n\n## tsx slot 使用\n\n```js\nconst Foo = (_, { slots }) => {\n  \n  return (<>\n    <p>{ slots?.header?.()}</p>\n    <h3>slot comp</h3>\n    <p>{ slots.default ? slots.default() : '默认插槽' }</p>\n  </>)\n}\n\n\n<Foo v-slots={{\n  default() {\n    return 'setup default slot'\n  },\n  header() {\n    return 'header'\n  }\n}} />\n\n```\n\n# 自动引入\n> 安装插件 unplugin-auto-import/vite  https://github.com/antfu/unplugin-auto-import\n\n注册完 plugin 之后，不再引入 `ref, reactive` 等等方法了，直接使用即可。\n\n\n# v-model\n> 官网：https://cn.vuejs.org/guide/components/events.html\n\nv-model 在原生元素上的用法：\n\n```js\n<input v-model=\"searchText\" />\n\n// 等价于\n\n<input\n  :value=\"searchText\"\n  @input=\"searchText = $event.target.value\"\n/>\n```\n\n而当使用在一个组件上时，v-model 会被展开为如下的形式：\n\n```js\n<CustomInput\n  :modelValue=\"searchText\"\n  @update:modelValue=\"newValue => searchText = newValue\"\n/>\n\n\n// 内部定义 props 和 方法\n\nconst props = defineProps<{\n  modelValue: boolean\n}>()\n\nconst emits = defineEmits(['update:modelValue'])\n\n\n// 调用\nemits('update:modelValue', !props.modelValue)\n\n```\n\n当然，我们也可以给 `v-model` 指定一个参数，不使用默认的 `modelValue`:\n\n```js\n<MyComponent v-model:title=\"bookTitle\" />\n\n// 定义 props\ndefineProps(['title'])\ndefineEmits(['update:title'])\n```\n\n我们还可以绑定多个 v-model:\n\n```js\n<UserName\n  v-model:first-name=\"first\"\n  v-model:last-name=\"last\"\n/>\n```\n\n# 自定义指令\n\n> https://cn.vuejs.org/guide/reusability/custom-directives.html\n\n```js\nconst myDirective = {\n  // 在绑定元素的 attribute 前\n  // 或事件监听器应用前调用\n  created(el, binding, vnode, prevVnode) {},\n  // 在元素被插入到 DOM 前调用\n  beforeMount(el, binding, vnode, prevVnode) {},\n  // 在绑定元素的父组件\n  // 及他自己的所有子节点都挂载完成后调用\n  mounted(el, binding, vnode, prevVnode) {},\n  // 绑定元素的父组件更新前调用\n  beforeUpdate(el, binding, vnode, prevVnode) {},\n  // 在绑定元素的父组件\n  // 及他自己的所有子节点都更新后调用\n  updated(el, binding, vnode, prevVnode) {},\n  // 绑定元素的父组件卸载前调用\n  beforeUnmount(el, binding, vnode, prevVnode) {},\n  // 绑定元素的父组件卸载后调用\n  unmounted(el, binding, vnode, prevVnode) {}\n}\n```\n\n```js\n<div v-example:foo.bar=\"baz\">\n\n// binding 参数会是一个这样的对象：\n{\n  arg: 'foo',\n  modifiers: { bar: true },\n  value: /* `baz` 的值 */,\n  oldValue: /* 上一次更新时 `baz` 的值 */\n}\n```\n\n# 全局函数或变量\n\n在 Vue2 中，我们经常将全局用到的函数定义在 Vue 的 prototype 上，在 Vue3 中已经不这样使用了:\n\n```js\nconst app = createApp(App)\n\n\napp.config.globalProperties.$env = 'dev'\napp.config.globalProperties.$filters = {\n  format<T>(str: T): string {\n    return str.trim()\n  }\n}\n```\n\n我们使用的时候，不需要导入什么，直接在 .vue 文件使用即可:\n\n```js\n<div>env {{$env}}</div>\n\n\n<script setup lang=\"ts\">\n  const app = getCurrentInstance()\n\n  console.log(app?.proxy?.$filters.format('getCurrentInstance'))\n</script>\n```\n\n\n在组件中使用全局的变量或者函数时，会出现 ts 报错，这时我们需要去声明它的类型:\n\n```js\ndeclare module 'vue' {\n  export interface ComponentCustomProperties {\n    $filters: {\n      format<T>(str: T): string,\n    },\n    $env: string,\n  }\n}\n```\n\n# 自定义插件\n\n> 一个插件可以是一个拥有 install() 方法的对象，也可以直接是一个安装函数本身。\n\n插件没有严格定义的使用范围，但是插件发挥作用的常见场景主要包括以下几种：\n\n1. 通过 app.component() 和 app.directive() 注册一到多个全局组件或自定义指令。\n\n2. 通过 app.provide() 使一个资源可被注入进整个应用。\n\n3. 向 app.config.globalProperties 中添加一些全局实例属性或方法\n\n以一个全局的 `Loading` 组件为例：\n\n```js\n// Loading/index.ts\n\nimport type { App, VNode } from 'vue'\nimport { createVNode, render } from 'vue'\nimport Loading from './index.vue'\n\nexport default {\n  install (app: App) {\n    // Loading 需要转成 VNode\n    const VNode: VNode = createVNode(Loading)\n\n    // 将组件挂在到某个元素下\n    render(VNode, document.body)\n\n    // Loading 组件通过 defineExpose 方法，暴露内部方法会在 exposed 字段上\n\n    app.config.globalProperties.$loading = {\n      onShow: VNode.component?.exposed?.onShow,\n      onHide: VNode.component?.exposed?.onHide\n    }\n  }\n}\n```\n\nLoading 组件内部实现\n\n```js\n<template>\n  <div class=\"loading\" v-if=\"show\" @click=\"onHide\">\n    <img src=\"../../assets/imgs/loading.gif\" alt=\"\" />\n  </div>\n</template>\n\n<script setup lang='ts'>\nimport {ref, reactive} from 'vue'\n\nconst show = ref(false)\n\nconst onShow = () => show.value = true\nconst onHide = () => show.value = false\n\n// 暴露内部方法供外部调用\ndefineExpose({\n  onShow,\n  onHide,\n})\n\n</script>\n<style scoped lang=\"less\">\n.loading {\n  width: 100%;\n  height: 100%;\n  background-color: #1f2123;\n  position: absolute;\n  top: 0;\n  left: 0;\n  text-align: center;\n}\n</style>\n```\n\n这样我们就可以在任何地方使用 全局 Loading 了。\n\n```js\n// setup\nconst instance = getCurrentInstance()\n\nconst showLoading = () => {\n  instance?.proxy?.$loading.onShow()\n}\n\n// or 直接在 template 中使用\n<button @click=\"$loading.onShow\">show loading</button>\n```\n\n如果调用 $loading 报ts错误，我们可以声明全局类型\n\n```js\ndeclare module 'vue' {\n  export interface ComponentCustomProperties {\n    $loading: {\n      onShow(): void;\n      onHide(): void;\n    }\n  }\n}\n```\n\n# Scoped原理 & 样式穿透\n\n1. 给 HTML DOM节点加一个不重复的 data 属性（形如: data-v-xxxxx），来表示它的唯一性\n2. 在每句 CSS 选择器的末尾，加一个当前组件的 data 属性选择器，来私有化样式\n3. 如果组件内部包含其他组件，只会给其他组件的最外层标签加上当前组件的 data 属性.\n\n想要直接修改开源组件的样式，大概率是失败的，解决方案就是要使用样式穿透\n\n```css\n/deep/ .input {\n  ...\n}\n\n// or\n\n:deep(.input) {\n  ...\n}\n```\n\n\n# css新特性\n\n## 插槽选择器\n我们在使用插槽时，如何在子组件中修改插槽内容的样式\n\n```css\n  :slotted(.p-footer) {\n    color: red;\n  }\n```\n\n## 定义全局样式\n```css\n  :global(div) {\n    color: red;\n  }\n```\n\n## 动态 css\n```js\n// js\nconst color = ref('red')\nconst font = ref({\n  fontSize: '24px',\n  fontWeight: 'bold',\n})\n\n// css\n.box {\n  color: v-bind(color);\n  font-size: v-bind('font.fontSize');\n}\n```\n\n## 模块化 css\n\n给 style 标签加上 module 属性\n\n```css\n// template\n// 如果有多个，就写成数组形式\n<div :class=\"[$style.box]\">\n  模块 css\n</div>\n\n// css\n<style module>\n.box {\n  color: red\n}\n</style>\n```\n\n`$style` 是固定的写法，如果不想用这个变量，我们可以指定 `module=\"myStyle\"` 。\n\n我们还可以通过 `useCssModule` 获取当前组件下的样式类名\n\n```\n// 默认\nconst class = useCssModule()\nconst class = useCssModule('$style')\n\n// 如果指定了 module\nconst class = useCssModule('myStyle')\n```\n\n# 集成 Tailwind CSS\n\n> https://blog.csdn.net/qq1195566313/article/details/124951311?ops_request_misc=%257B%2522request%255Fid%2522%253A%2522167109189716782427434983%2522%252C%2522scm%2522%253A%252220140713.130102334.pc%255Fblog.%2522%257D&request_id=167109189716782427434983&biz_id=0&utm_medium=distribute.pc_search_result.none-task-blog-2~blog~first_rank_ecpm_v1~rank_v31_ecpm-1-124951311-null-null.nonecase&utm_term=tailwind&spm=1018.2226.3001.4450\n\n安装 vscode 提示插件 `Tailwind CSS IntelliSense`\n\n# h函数\n\n```js\nimport { h } from 'vue'\n\nconst Btn = (props, ctx) => {\n  return h('div', {\n    class: [...],\n    onClick: () => {\n      ctx.emit('on-click', 'hello world')\n    },\n  }, ctx.slots.default())\n}\n\n```\n\n\n\n# 参考资料\n[^1]: [Vue3+Vite+Ts 项目实战 01 Vite 创建项目、ESLint+TS+GitCommit配置、Vue3新特性介绍](https://blog.csdn.net/u012961419/article/details/124299803)\n\n","source":"_posts/vue3.md","raw":"---\nlayout: Vue,JavaScript\ntitle: 深入浅出Vue3\ndate: 2022-12-01 18:09:04\ntags: JS,Vue3\nbanner_img: /img/vue3.jpg\nindex_img: /img/vue3.jpg\nexcerpt: 渐进式 JavaScript 框架。易学易用，性能出色，适用场景丰富的 Web 前端框架\n---\n\n# ref 和 reactive 使用上有什么区别?\n\n1. ref 支持所有的类型，reactive 只接收引用类型（Array/Object/Map/Set）\n2. ref 取值和赋值都需要加 .value，reactive 不需要 .value\n3. reactive 不能直接赋值，否则会破坏响应式（proxy）\n\n如果要改变数组，可以通过 push 方法，将要 push 的数组结构 (xx.push(...arr))\n\n\n## 如何抉择呢？\n\n因为社区大佬 `basvanmeurs`提出了一个新的 PR，大概就是重构了响应式的部分内容，由于重构内容过于庞大，所以一直等到 2021 年 8 月 5 号，伴随着 Vue3.2 的发布，尤大大才合并对应的代码。\n\n`ref` 被重构之后，有了更高效的实现（提升了 约 260% 的读取速度 / 约 50% 的写入速度），依赖跟踪速度提高了约 40%，内存使用量减少了约 17%，毫无疑问这是一个伟大的变化。\n\n那么，在以后的使用过程当中，能使用 `ref` 就用 `ref`吧，毕竟它的性能得到了如此大的提升。\n\n\n# defineProps 如何定义默认值？\n\n> 针对类型的 defineProps 声明的不足之处在于，它没有可以给 props 提供默认值的方式。\n\n使用TS 特有的默认值方式 `withDefaults` 函数，无须引入开箱即用，接受一个props函数第二个参数是一个对象设置默认值。\n\n```js\nexport interface Props {\n  msg?: string\n  labels?: string[]\n}\n\nconst props = withDefaults(defineProps<Props>(), {\n  msg: 'hello',\n  labels: () => ['one', 'two']\n})\n```\n\n**注意**\n\n如果使用 withDefaults 报错 `'withDefaults' is not defined`，我们修改 `.eslintrc` 文件\n\n添加如下配置代码：\n\n```js\nglobals: {\n    withDefaults: 'readonly'\n},\n```\n\n# 动态组件\n> component\n\n要渲染的实际组件由 is prop 决定。\n\n- 当 is 是字符串，它既可以是 HTML 标签名也可以是组件的注册名。\n- 或者，is 也可以直接绑定组件。\n\n\n按注册名渲染组件\n```js\n<script>\nimport Foo from './Foo.vue'\nimport Bar from './Bar.vue'\n\nexport default {\n  components: { Foo, Bar },\n  data() {\n    return {\n      view: 'Foo'\n    }\n  }\n}\n</script>\n\n<template>\n  <component :is=\"view\" />\n</template>\n```\n\n按定义渲染组件 `<script setup> 组合式 API`：\n\n```js\n<component :is=\"Math.random() > 0.5 ? Foo : Bar\" />\n```\n\n渲染 HTML 元素\n```js\n<component :is=\"href ? 'a' : 'span'\"></component>\n```\n\n# 插槽\n\n默认插槽、具名插槽。\n\n作用域插槽：`:headerName=\"'我是头部'\"`，父组件可以通过 `v-slot=\"{ headerName }\"` 拿到组件内部暴露出来的数据\n\n```js\n// SlotComp.vue\n<template>\n  <div class=\"slot-wrapper\">\n    <header class=\"header\">\n      <slot name=\"header\" :headerName=\"'我是头部'\"></slot>\n    </header>\n    <main class=\"content\">\n      <slot></slot>\n    </main>\n    <footer class=\"footer\">\n      <slot name=\"footer\"></slot>\n    </footer>\n  </div>\n</template>\n```\n\n使用具有插槽的组件，`headerName` 是作用域插槽从内部提供的\n```js\n<SlotComp>\n  <template v-slot:header=\"{ headerName }\">{{ headerName }}</template>\n  <template v-slot>default slot</template>\n  <template v-slot:footer>footer</template>\n</SlotComp>\n```\n\n**插槽简写方式 #**\n```js\n<SlotComp>\n  <template #header=\"{ headerName }\">{{ headerName }}</template>\n  <template #default>default slot</template>\n  <template #footer>footer</template>\n</SlotComp>\n```\n\n**动态插槽**\n```js\n<SlotComp>\n  <template #[slotName]>动态插槽</template>\n</SlotComp>\n\n\n// js\nconst slotName = ref('header')\n```\n\n# 异步组件\n\n[官方描述](https://cn.vuejs.org/guide/components/async.html#basic-usage)\n\n> 在大型项目中，我们可能需要拆分应用为更小的块，并仅在需要时再从服务器加载相关组件。Vue 提供了 `defineAsyncComponent` 方法来实现此功能：\n\n```js\nimport { defineAsyncComponent } from 'vue'\n\nconst AsyncComp = defineAsyncComponent(() => {\n  return new Promise((resolve, reject) => {\n    // ...从服务器获取组件\n    resolve(/* 获取到的组件 */)\n  })\n})\n```\n\n`ES 模块动态导入` 也会返回一个 Promise，所以多数情况下我们会将它和 defineAsyncComponent 搭配使用。类似 Vite 和 Webpack 这样的构建工具也支持此语法 (并且会将它们作为打包时的代码分割点  `分包、性能优化`)\n\n```js\nimport { defineAsyncComponent } from 'vue'\n\nconst AsyncComp = defineAsyncComponent(() =>\n  import('./components/MyComponent.vue')\n)\n```\n\n最后得到的 AsyncComp 是一个外层包装过的组件，`仅在页面需要它渲染时` 才会调用加载内部实际组件的函数。\n\n## 顶层 await\n\n`<script setup>` 中可以使用顶层 await。结果代码会被编译成 `async setup()`：\n\n```js\n<script setup>\nconst post = await fetch(`/api/post/1`).then((r) => r.json())\n</script>\n```\n\n## 搭配 Suspense 组件使用\n\n1. 定义异步组件 Sync.vue\n\n```js\n<template>\n  <div>\n    Name: {{ name }}\n  </div>\n</template>\n\n<script setup lang='ts'>\nimport {ref, reactive} from 'vue'\nimport iTools from '@/utils/Tools'\n\nconst name = ref('')\nconst { data } = await iTools.Axios.get('./sync-data.json') // 定义在 public 下的json文件\nname.value = data.name\n\n</script>\n```\n\n2. 通过 `defineAsyncComponent` 动态导入 `Sync.vue` 组件\n\n```js\nconst Sync = defineAsyncComponent(() => import('@/components/Sync.vue'))\n```\n\n3. 使用 `Suspense` 内置组件\n\n在请求过程中，会一直显示 loading... 状态，真实项目中我们可以替换成骨架屏。当接口请求成功，才会显示 `Sync.vue` 的内容。\n```js\n<Suspense>\n  <template #default>\n    <Sync />\n  </template>\n\n  <template #fallback>\n    Loading...\n  </template>\n</Suspense>\n```\n\n## 性能优化\n当我们使用了 defineAsyncComponent 动态导入组件，build 项目时，会单独将 Sync.vue 的 js 包拎出来，不会将其打包到index.js 中，通过拆包的方式，减少入口文件的大小，从而减少白屏的时间。\n\n\n# Teleport 传送门\n\n将其插槽内容渲染到 DOM 中的另一个位置。\n\n```js\ninterface TeleportProps {\n  /**\n   * 必填项。指定目标容器。\n   * 可以是选择器或实际元素。\n   */\n  to: string | HTMLElement\n  /**\n   * 当值为 `true` 时，内容将保留在其原始位置\n   * 而不是移动到目标容器中。\n   * 可以动态更改。\n   */\n  disabled?: boolean\n}\n\n// examples\n<teleport to=\"#some-id\" />\n<teleport to=\".some-class\" />\n<teleport to=\"[data-teleport]\" />\n<teleport to=\"body\" />\n```\n\n# Mitt\n\nVue 2可以支持$on，$off来实现event bus，但是 Vue3 已经不支持这些属性，不过Vue 3可以支持第三方event bus来实现事件通信，\n\n这里使用 `mitt`，官方地址：https://github.com/developit/mitt\n\n```js\nimport mitt from 'mitt'\n\n// vue3挂载到全局\napp.config.globalProperties.$mitt = mitt()\n```\n\n# tsx\n\n> 安装插件 npm install @vitejs/plugin-vue-jsx -D\n\n安装如果失败，将 node 版本切换至 v14.16.0\n\n\n使用插件\n```js\nimport vueJsx from \"@vitejs/plugin-vue-jsx\";\n\nexport default defineConfig({\n  plugins: [vue(), vueJsx()],\n  // ...\n})\n```\n\n但是导入 .tsx 文件，TypeScript 会报错：\n\n```js\n// 找不到模块“@/components/Foo”或其相应的类型声明。\nimport Foo from '@/components/Foo' // 省略了 .tsx 后缀\n\n// 导入路径不能以“.tsx”扩展名结束。考虑改为导入“@/components/Bar.js”。\nimport Bar from '@/components/Bar.tsx'\n```\n\n配置 `tsconfig.json`:\n```json\n{\n  \"compilerOptions\": {\n    \"baseUrl\": \".\",\n    \"paths\": {\n      \"@/*\": [\"src/*\"]\n    },\n  }\n}\n```\n\n之后我们导入 tsx 类型的组件，就不要带上后缀了。\n\n**编写 tsx 组件的3中方式**\n\n1. 函数模式\n```js\nexport default function() {\n  return (\n    <h1>TSX componen111t</h1>\n  )\n}\n```\n\n2. options API 模式\n```js\nimport { defineComponent } from 'vue'\n\nexport default defineComponent({\n  data() {\n    return {\n      compname: 'jsx comp'\n    }\n  },\n  render() {\n    return (\n      <div>{this.compname}</div>\n    )\n  }\n})\n```\n\n3. setup 函数模式\n```js\n\ninterface IProps {\n  name?: string;\n}\n\nexport default defineComponent({\n  props: {\n    name: String,\n  },\n  emits: ['on-click'],\n  setup(props: IProps) {\n    const is = true\n    // 返回渲染函数\n    return () => {\n      return (\n        <h1 v-show={is}>setup 渲染函数 {props?.name}</h1>\n      )\n    }\n  }\n})\n```\n\n## tsx slot 使用\n\n```js\nconst Foo = (_, { slots }) => {\n  \n  return (<>\n    <p>{ slots?.header?.()}</p>\n    <h3>slot comp</h3>\n    <p>{ slots.default ? slots.default() : '默认插槽' }</p>\n  </>)\n}\n\n\n<Foo v-slots={{\n  default() {\n    return 'setup default slot'\n  },\n  header() {\n    return 'header'\n  }\n}} />\n\n```\n\n# 自动引入\n> 安装插件 unplugin-auto-import/vite  https://github.com/antfu/unplugin-auto-import\n\n注册完 plugin 之后，不再引入 `ref, reactive` 等等方法了，直接使用即可。\n\n\n# v-model\n> 官网：https://cn.vuejs.org/guide/components/events.html\n\nv-model 在原生元素上的用法：\n\n```js\n<input v-model=\"searchText\" />\n\n// 等价于\n\n<input\n  :value=\"searchText\"\n  @input=\"searchText = $event.target.value\"\n/>\n```\n\n而当使用在一个组件上时，v-model 会被展开为如下的形式：\n\n```js\n<CustomInput\n  :modelValue=\"searchText\"\n  @update:modelValue=\"newValue => searchText = newValue\"\n/>\n\n\n// 内部定义 props 和 方法\n\nconst props = defineProps<{\n  modelValue: boolean\n}>()\n\nconst emits = defineEmits(['update:modelValue'])\n\n\n// 调用\nemits('update:modelValue', !props.modelValue)\n\n```\n\n当然，我们也可以给 `v-model` 指定一个参数，不使用默认的 `modelValue`:\n\n```js\n<MyComponent v-model:title=\"bookTitle\" />\n\n// 定义 props\ndefineProps(['title'])\ndefineEmits(['update:title'])\n```\n\n我们还可以绑定多个 v-model:\n\n```js\n<UserName\n  v-model:first-name=\"first\"\n  v-model:last-name=\"last\"\n/>\n```\n\n# 自定义指令\n\n> https://cn.vuejs.org/guide/reusability/custom-directives.html\n\n```js\nconst myDirective = {\n  // 在绑定元素的 attribute 前\n  // 或事件监听器应用前调用\n  created(el, binding, vnode, prevVnode) {},\n  // 在元素被插入到 DOM 前调用\n  beforeMount(el, binding, vnode, prevVnode) {},\n  // 在绑定元素的父组件\n  // 及他自己的所有子节点都挂载完成后调用\n  mounted(el, binding, vnode, prevVnode) {},\n  // 绑定元素的父组件更新前调用\n  beforeUpdate(el, binding, vnode, prevVnode) {},\n  // 在绑定元素的父组件\n  // 及他自己的所有子节点都更新后调用\n  updated(el, binding, vnode, prevVnode) {},\n  // 绑定元素的父组件卸载前调用\n  beforeUnmount(el, binding, vnode, prevVnode) {},\n  // 绑定元素的父组件卸载后调用\n  unmounted(el, binding, vnode, prevVnode) {}\n}\n```\n\n```js\n<div v-example:foo.bar=\"baz\">\n\n// binding 参数会是一个这样的对象：\n{\n  arg: 'foo',\n  modifiers: { bar: true },\n  value: /* `baz` 的值 */,\n  oldValue: /* 上一次更新时 `baz` 的值 */\n}\n```\n\n# 全局函数或变量\n\n在 Vue2 中，我们经常将全局用到的函数定义在 Vue 的 prototype 上，在 Vue3 中已经不这样使用了:\n\n```js\nconst app = createApp(App)\n\n\napp.config.globalProperties.$env = 'dev'\napp.config.globalProperties.$filters = {\n  format<T>(str: T): string {\n    return str.trim()\n  }\n}\n```\n\n我们使用的时候，不需要导入什么，直接在 .vue 文件使用即可:\n\n```js\n<div>env {{$env}}</div>\n\n\n<script setup lang=\"ts\">\n  const app = getCurrentInstance()\n\n  console.log(app?.proxy?.$filters.format('getCurrentInstance'))\n</script>\n```\n\n\n在组件中使用全局的变量或者函数时，会出现 ts 报错，这时我们需要去声明它的类型:\n\n```js\ndeclare module 'vue' {\n  export interface ComponentCustomProperties {\n    $filters: {\n      format<T>(str: T): string,\n    },\n    $env: string,\n  }\n}\n```\n\n# 自定义插件\n\n> 一个插件可以是一个拥有 install() 方法的对象，也可以直接是一个安装函数本身。\n\n插件没有严格定义的使用范围，但是插件发挥作用的常见场景主要包括以下几种：\n\n1. 通过 app.component() 和 app.directive() 注册一到多个全局组件或自定义指令。\n\n2. 通过 app.provide() 使一个资源可被注入进整个应用。\n\n3. 向 app.config.globalProperties 中添加一些全局实例属性或方法\n\n以一个全局的 `Loading` 组件为例：\n\n```js\n// Loading/index.ts\n\nimport type { App, VNode } from 'vue'\nimport { createVNode, render } from 'vue'\nimport Loading from './index.vue'\n\nexport default {\n  install (app: App) {\n    // Loading 需要转成 VNode\n    const VNode: VNode = createVNode(Loading)\n\n    // 将组件挂在到某个元素下\n    render(VNode, document.body)\n\n    // Loading 组件通过 defineExpose 方法，暴露内部方法会在 exposed 字段上\n\n    app.config.globalProperties.$loading = {\n      onShow: VNode.component?.exposed?.onShow,\n      onHide: VNode.component?.exposed?.onHide\n    }\n  }\n}\n```\n\nLoading 组件内部实现\n\n```js\n<template>\n  <div class=\"loading\" v-if=\"show\" @click=\"onHide\">\n    <img src=\"../../assets/imgs/loading.gif\" alt=\"\" />\n  </div>\n</template>\n\n<script setup lang='ts'>\nimport {ref, reactive} from 'vue'\n\nconst show = ref(false)\n\nconst onShow = () => show.value = true\nconst onHide = () => show.value = false\n\n// 暴露内部方法供外部调用\ndefineExpose({\n  onShow,\n  onHide,\n})\n\n</script>\n<style scoped lang=\"less\">\n.loading {\n  width: 100%;\n  height: 100%;\n  background-color: #1f2123;\n  position: absolute;\n  top: 0;\n  left: 0;\n  text-align: center;\n}\n</style>\n```\n\n这样我们就可以在任何地方使用 全局 Loading 了。\n\n```js\n// setup\nconst instance = getCurrentInstance()\n\nconst showLoading = () => {\n  instance?.proxy?.$loading.onShow()\n}\n\n// or 直接在 template 中使用\n<button @click=\"$loading.onShow\">show loading</button>\n```\n\n如果调用 $loading 报ts错误，我们可以声明全局类型\n\n```js\ndeclare module 'vue' {\n  export interface ComponentCustomProperties {\n    $loading: {\n      onShow(): void;\n      onHide(): void;\n    }\n  }\n}\n```\n\n# Scoped原理 & 样式穿透\n\n1. 给 HTML DOM节点加一个不重复的 data 属性（形如: data-v-xxxxx），来表示它的唯一性\n2. 在每句 CSS 选择器的末尾，加一个当前组件的 data 属性选择器，来私有化样式\n3. 如果组件内部包含其他组件，只会给其他组件的最外层标签加上当前组件的 data 属性.\n\n想要直接修改开源组件的样式，大概率是失败的，解决方案就是要使用样式穿透\n\n```css\n/deep/ .input {\n  ...\n}\n\n// or\n\n:deep(.input) {\n  ...\n}\n```\n\n\n# css新特性\n\n## 插槽选择器\n我们在使用插槽时，如何在子组件中修改插槽内容的样式\n\n```css\n  :slotted(.p-footer) {\n    color: red;\n  }\n```\n\n## 定义全局样式\n```css\n  :global(div) {\n    color: red;\n  }\n```\n\n## 动态 css\n```js\n// js\nconst color = ref('red')\nconst font = ref({\n  fontSize: '24px',\n  fontWeight: 'bold',\n})\n\n// css\n.box {\n  color: v-bind(color);\n  font-size: v-bind('font.fontSize');\n}\n```\n\n## 模块化 css\n\n给 style 标签加上 module 属性\n\n```css\n// template\n// 如果有多个，就写成数组形式\n<div :class=\"[$style.box]\">\n  模块 css\n</div>\n\n// css\n<style module>\n.box {\n  color: red\n}\n</style>\n```\n\n`$style` 是固定的写法，如果不想用这个变量，我们可以指定 `module=\"myStyle\"` 。\n\n我们还可以通过 `useCssModule` 获取当前组件下的样式类名\n\n```\n// 默认\nconst class = useCssModule()\nconst class = useCssModule('$style')\n\n// 如果指定了 module\nconst class = useCssModule('myStyle')\n```\n\n# 集成 Tailwind CSS\n\n> https://blog.csdn.net/qq1195566313/article/details/124951311?ops_request_misc=%257B%2522request%255Fid%2522%253A%2522167109189716782427434983%2522%252C%2522scm%2522%253A%252220140713.130102334.pc%255Fblog.%2522%257D&request_id=167109189716782427434983&biz_id=0&utm_medium=distribute.pc_search_result.none-task-blog-2~blog~first_rank_ecpm_v1~rank_v31_ecpm-1-124951311-null-null.nonecase&utm_term=tailwind&spm=1018.2226.3001.4450\n\n安装 vscode 提示插件 `Tailwind CSS IntelliSense`\n\n# h函数\n\n```js\nimport { h } from 'vue'\n\nconst Btn = (props, ctx) => {\n  return h('div', {\n    class: [...],\n    onClick: () => {\n      ctx.emit('on-click', 'hello world')\n    },\n  }, ctx.slots.default())\n}\n\n```\n\n\n\n# 参考资料\n[^1]: [Vue3+Vite+Ts 项目实战 01 Vite 创建项目、ESLint+TS+GitCommit配置、Vue3新特性介绍](https://blog.csdn.net/u012961419/article/details/124299803)\n\n","slug":"vue3","published":1,"updated":"2023-05-12T10:49:20.017Z","comments":1,"photos":[],"link":"","_id":"clhkizgya00303y0qh7oi6ba8","content":"<h1 id=\"ref-和-reactive-使用上有什么区别\"><a href=\"#ref-和-reactive-使用上有什么区别\" class=\"headerlink\" title=\"ref 和 reactive 使用上有什么区别?\"></a>ref 和 reactive 使用上有什么区别?</h1><ol>\n<li>ref 支持所有的类型，reactive 只接收引用类型（Array/Object/Map/Set）</li>\n<li>ref 取值和赋值都需要加 .value，reactive 不需要 .value</li>\n<li>reactive 不能直接赋值，否则会破坏响应式（proxy）</li>\n</ol>\n<p>如果要改变数组，可以通过 push 方法，将要 push 的数组结构 (xx.push(…arr))</p>\n<h2 id=\"如何抉择呢？\"><a href=\"#如何抉择呢？\" class=\"headerlink\" title=\"如何抉择呢？\"></a>如何抉择呢？</h2><p>因为社区大佬 <code>basvanmeurs</code>提出了一个新的 PR，大概就是重构了响应式的部分内容，由于重构内容过于庞大，所以一直等到 2021 年 8 月 5 号，伴随着 Vue3.2 的发布，尤大大才合并对应的代码。</p>\n<p><code>ref</code> 被重构之后，有了更高效的实现（提升了 约 260% 的读取速度 / 约 50% 的写入速度），依赖跟踪速度提高了约 40%，内存使用量减少了约 17%，毫无疑问这是一个伟大的变化。</p>\n<p>那么，在以后的使用过程当中，能使用 <code>ref</code> 就用 <code>ref</code>吧，毕竟它的性能得到了如此大的提升。</p>\n<h1 id=\"defineProps-如何定义默认值？\"><a href=\"#defineProps-如何定义默认值？\" class=\"headerlink\" title=\"defineProps 如何定义默认值？\"></a>defineProps 如何定义默认值？</h1><blockquote>\n<p>针对类型的 defineProps 声明的不足之处在于，它没有可以给 props 提供默认值的方式。</p>\n</blockquote>\n<p>使用TS 特有的默认值方式 <code>withDefaults</code> 函数，无须引入开箱即用，接受一个props函数第二个参数是一个对象设置默认值。</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><div class=\"code-wrapper\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></div></td><td class=\"code\"><pre><code class=\"hljs js\"><span class=\"hljs-keyword\">export</span> interface <span class=\"hljs-title class_\">Props</span> &#123;<br>  msg?: string<br>  labels?: string[]<br>&#125;<br><br><span class=\"hljs-keyword\">const</span> props = <span class=\"hljs-title function_\">withDefaults</span>(defineProps&lt;<span class=\"hljs-title class_\">Props</span>&gt;(), &#123;<br>  <span class=\"hljs-attr\">msg</span>: <span class=\"hljs-string\">&#x27;hello&#x27;</span>,<br>  <span class=\"hljs-attr\">labels</span>: <span class=\"hljs-function\">() =&gt;</span> [<span class=\"hljs-string\">&#x27;one&#x27;</span>, <span class=\"hljs-string\">&#x27;two&#x27;</span>]<br>&#125;)<br></code></pre></td></tr></table></figure>\n\n<p><strong>注意</strong></p>\n<p>如果使用 withDefaults 报错 <code>&#39;withDefaults&#39; is not defined</code>，我们修改 <code>.eslintrc</code> 文件</p>\n<p>添加如下配置代码：</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\"><span class=\"hljs-attr\">globals</span>: &#123;<br>    <span class=\"hljs-attr\">withDefaults</span>: <span class=\"hljs-string\">&#x27;readonly&#x27;</span><br>&#125;,<br></code></pre></td></tr></table></figure>\n\n<h1 id=\"动态组件\"><a href=\"#动态组件\" class=\"headerlink\" title=\"动态组件\"></a>动态组件</h1><blockquote>\n<p>component</p>\n</blockquote>\n<p>要渲染的实际组件由 is prop 决定。</p>\n<ul>\n<li>当 is 是字符串，它既可以是 HTML 标签名也可以是组件的注册名。</li>\n<li>或者，is 也可以直接绑定组件。</li>\n</ul>\n<p>按注册名渲染组件</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\">&lt;script&gt;<br><span class=\"hljs-keyword\">import</span> <span class=\"hljs-title class_\">Foo</span> <span class=\"hljs-keyword\">from</span> <span class=\"hljs-string\">&#x27;./Foo.vue&#x27;</span><br><span class=\"hljs-keyword\">import</span> <span class=\"hljs-title class_\">Bar</span> <span class=\"hljs-keyword\">from</span> <span class=\"hljs-string\">&#x27;./Bar.vue&#x27;</span><br><br><span class=\"hljs-keyword\">export</span> <span class=\"hljs-keyword\">default</span> &#123;<br>  <span class=\"hljs-attr\">components</span>: &#123; <span class=\"hljs-title class_\">Foo</span>, <span class=\"hljs-title class_\">Bar</span> &#125;,<br>  <span class=\"hljs-title function_\">data</span>(<span class=\"hljs-params\"></span>) &#123;<br>    <span class=\"hljs-keyword\">return</span> &#123;<br>      <span class=\"hljs-attr\">view</span>: <span class=\"hljs-string\">&#x27;Foo&#x27;</span><br>    &#125;<br>  &#125;<br>&#125;<br>&lt;/script&gt;<br><br><span class=\"language-xml\"><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">template</span>&gt;</span></span><br><span class=\"language-xml\">  <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">component</span> <span class=\"hljs-attr\">:is</span>=<span class=\"hljs-string\">&quot;view&quot;</span> /&gt;</span></span><br><span class=\"language-xml\"><span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">template</span>&gt;</span></span><br></code></pre></td></tr></table></figure>\n\n<p>按定义渲染组件 <code>&lt;script setup&gt; 组合式 API</code>：</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\">&lt;component :is=<span class=\"hljs-string\">&quot;Math.random() &gt; 0.5 ? Foo : Bar&quot;</span> /&gt;<br></code></pre></td></tr></table></figure>\n\n<p>渲染 HTML 元素</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\">&lt;component :is=<span class=\"hljs-string\">&quot;href ? &#x27;a&#x27; : &#x27;span&#x27;&quot;</span>&gt;&lt;/component&gt;<br></code></pre></td></tr></table></figure>\n\n<h1 id=\"插槽\"><a href=\"#插槽\" class=\"headerlink\" title=\"插槽\"></a>插槽</h1><p>默认插槽、具名插槽。</p>\n<p>作用域插槽：<code>:headerName=&quot;&#39;我是头部&#39;&quot;</code>，父组件可以通过 <code>v-slot=&quot;&#123; headerName &#125;&quot;</code> 拿到组件内部暴露出来的数据</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\"><span class=\"hljs-comment\">// SlotComp.vue</span><br>&lt;template&gt;<br>  <span class=\"language-xml\"><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">div</span> <span class=\"hljs-attr\">class</span>=<span class=\"hljs-string\">&quot;slot-wrapper&quot;</span>&gt;</span></span><br><span class=\"language-xml\">    <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">header</span> <span class=\"hljs-attr\">class</span>=<span class=\"hljs-string\">&quot;header&quot;</span>&gt;</span></span><br><span class=\"language-xml\">      <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">slot</span> <span class=\"hljs-attr\">name</span>=<span class=\"hljs-string\">&quot;header&quot;</span> <span class=\"hljs-attr\">:headerName</span>=<span class=\"hljs-string\">&quot;&#x27;我是头部&#x27;&quot;</span>&gt;</span><span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">slot</span>&gt;</span></span><br><span class=\"language-xml\">    <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">header</span>&gt;</span></span><br><span class=\"language-xml\">    <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">main</span> <span class=\"hljs-attr\">class</span>=<span class=\"hljs-string\">&quot;content&quot;</span>&gt;</span></span><br><span class=\"language-xml\">      <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">slot</span>&gt;</span><span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">slot</span>&gt;</span></span><br><span class=\"language-xml\">    <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">main</span>&gt;</span></span><br><span class=\"language-xml\">    <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">footer</span> <span class=\"hljs-attr\">class</span>=<span class=\"hljs-string\">&quot;footer&quot;</span>&gt;</span></span><br><span class=\"language-xml\">      <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">slot</span> <span class=\"hljs-attr\">name</span>=<span class=\"hljs-string\">&quot;footer&quot;</span>&gt;</span><span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">slot</span>&gt;</span></span><br><span class=\"language-xml\">    <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">footer</span>&gt;</span></span><br><span class=\"language-xml\">  <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">div</span>&gt;</span></span><br>&lt;/template&gt;<br></code></pre></td></tr></table></figure>\n\n<p>使用具有插槽的组件，<code>headerName</code> 是作用域插槽从内部提供的</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\">&lt;<span class=\"hljs-title class_\">SlotComp</span>&gt;<br>  <span class=\"language-xml\"><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">template</span> <span class=\"hljs-attr\">v-slot:header</span>=<span class=\"hljs-string\">&quot;&#123; headerName &#125;&quot;</span>&gt;</span>&#123;&#123; headerName &#125;&#125;<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">template</span>&gt;</span></span><br>  <span class=\"language-xml\"><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">template</span> <span class=\"hljs-attr\">v-slot</span>&gt;</span>default slot<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">template</span>&gt;</span></span><br>  <span class=\"language-xml\"><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">template</span> <span class=\"hljs-attr\">v-slot:footer</span>&gt;</span>footer<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">template</span>&gt;</span></span><br>&lt;/<span class=\"hljs-title class_\">SlotComp</span>&gt;<br></code></pre></td></tr></table></figure>\n\n<p><strong>插槽简写方式 #</strong></p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\">&lt;<span class=\"hljs-title class_\">SlotComp</span>&gt;<br>  <span class=\"language-xml\"><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">template</span> #<span class=\"hljs-attr\">header</span>=<span class=\"hljs-string\">&quot;&#123; headerName &#125;&quot;</span>&gt;</span>&#123;&#123; headerName &#125;&#125;<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">template</span>&gt;</span></span><br>  <span class=\"language-xml\"><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">template</span> #<span class=\"hljs-attr\">default</span>&gt;</span>default slot<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">template</span>&gt;</span></span><br>  <span class=\"language-xml\"><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">template</span> #<span class=\"hljs-attr\">footer</span>&gt;</span>footer<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">template</span>&gt;</span></span><br>&lt;/<span class=\"hljs-title class_\">SlotComp</span>&gt;<br></code></pre></td></tr></table></figure>\n\n<p><strong>动态插槽</strong></p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\">&lt;<span class=\"hljs-title class_\">SlotComp</span>&gt;<br>  <span class=\"language-xml\"><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">template</span> #[<span class=\"hljs-attr\">slotName</span>]&gt;</span>动态插槽<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">template</span>&gt;</span></span><br>&lt;/<span class=\"hljs-title class_\">SlotComp</span>&gt;<br><br><br><span class=\"hljs-comment\">// js</span><br><span class=\"hljs-keyword\">const</span> slotName = <span class=\"hljs-title function_\">ref</span>(<span class=\"hljs-string\">&#x27;header&#x27;</span>)<br></code></pre></td></tr></table></figure>\n\n<h1 id=\"异步组件\"><a href=\"#异步组件\" class=\"headerlink\" title=\"异步组件\"></a>异步组件</h1><p><a href=\"https://cn.vuejs.org/guide/components/async.html#basic-usage\">官方描述</a></p>\n<blockquote>\n<p>在大型项目中，我们可能需要拆分应用为更小的块，并仅在需要时再从服务器加载相关组件。Vue 提供了 <code>defineAsyncComponent</code> 方法来实现此功能：</p>\n</blockquote>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\"><span class=\"hljs-keyword\">import</span> &#123; defineAsyncComponent &#125; <span class=\"hljs-keyword\">from</span> <span class=\"hljs-string\">&#x27;vue&#x27;</span><br><br><span class=\"hljs-keyword\">const</span> <span class=\"hljs-title class_\">AsyncComp</span> = <span class=\"hljs-title function_\">defineAsyncComponent</span>(<span class=\"hljs-function\">() =&gt;</span> &#123;<br>  <span class=\"hljs-keyword\">return</span> <span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">Promise</span>(<span class=\"hljs-function\">(<span class=\"hljs-params\">resolve, reject</span>) =&gt;</span> &#123;<br>    <span class=\"hljs-comment\">// ...从服务器获取组件</span><br>    <span class=\"hljs-title function_\">resolve</span>(<span class=\"hljs-comment\">/* 获取到的组件 */</span>)<br>  &#125;)<br>&#125;)<br></code></pre></td></tr></table></figure>\n\n<p><code>ES 模块动态导入</code> 也会返回一个 Promise，所以多数情况下我们会将它和 defineAsyncComponent 搭配使用。类似 Vite 和 Webpack 这样的构建工具也支持此语法 (并且会将它们作为打包时的代码分割点  <code>分包、性能优化</code>)</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\"><span class=\"hljs-keyword\">import</span> &#123; defineAsyncComponent &#125; <span class=\"hljs-keyword\">from</span> <span class=\"hljs-string\">&#x27;vue&#x27;</span><br><br><span class=\"hljs-keyword\">const</span> <span class=\"hljs-title class_\">AsyncComp</span> = <span class=\"hljs-title function_\">defineAsyncComponent</span>(<span class=\"hljs-function\">() =&gt;</span><br>  <span class=\"hljs-title function_\">import</span>(<span class=\"hljs-string\">&#x27;./components/MyComponent.vue&#x27;</span>)<br>)<br></code></pre></td></tr></table></figure>\n\n<p>最后得到的 AsyncComp 是一个外层包装过的组件，<code>仅在页面需要它渲染时</code> 才会调用加载内部实际组件的函数。</p>\n<h2 id=\"顶层-await\"><a href=\"#顶层-await\" class=\"headerlink\" title=\"顶层 await\"></a>顶层 await</h2><p><code>&lt;script setup&gt;</code> 中可以使用顶层 await。结果代码会被编译成 <code>async setup()</code>：</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\">&lt;script setup&gt;<br><span class=\"hljs-keyword\">const</span> post = <span class=\"hljs-keyword\">await</span> <span class=\"hljs-title function_\">fetch</span>(<span class=\"hljs-string\">`/api/post/1`</span>).<span class=\"hljs-title function_\">then</span>(<span class=\"hljs-function\">(<span class=\"hljs-params\">r</span>) =&gt;</span> r.<span class=\"hljs-title function_\">json</span>())<br>&lt;/script&gt;<br></code></pre></td></tr></table></figure>\n\n<h2 id=\"搭配-Suspense-组件使用\"><a href=\"#搭配-Suspense-组件使用\" class=\"headerlink\" title=\"搭配 Suspense 组件使用\"></a>搭配 Suspense 组件使用</h2><ol>\n<li>定义异步组件 Sync.vue</li>\n</ol>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\">&lt;template&gt;<br>  <span class=\"language-xml\"><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">div</span>&gt;</span></span><br><span class=\"language-xml\">    Name: &#123;&#123; name &#125;&#125;</span><br><span class=\"language-xml\">  <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">div</span>&gt;</span></span><br>&lt;/template&gt;<br><br><span class=\"language-xml\"><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">script</span> <span class=\"hljs-attr\">setup</span> <span class=\"hljs-attr\">lang</span>=<span class=\"hljs-string\">&#x27;ts&#x27;</span>&gt;</span><span class=\"language-javascript\"></span></span><br><span class=\"language-javascript\"><span class=\"language-xml\"><span class=\"hljs-keyword\">import</span> &#123;ref, reactive&#125; <span class=\"hljs-keyword\">from</span> <span class=\"hljs-string\">&#x27;vue&#x27;</span></span></span><br><span class=\"language-javascript\"><span class=\"language-xml\"><span class=\"hljs-keyword\">import</span> iTools <span class=\"hljs-keyword\">from</span> <span class=\"hljs-string\">&#x27;@/utils/Tools&#x27;</span></span></span><br><span class=\"language-javascript\"><span class=\"language-xml\"></span></span><br><span class=\"language-javascript\"><span class=\"language-xml\"><span class=\"hljs-keyword\">const</span> name = <span class=\"hljs-title function_\">ref</span>(<span class=\"hljs-string\">&#x27;&#x27;</span>)</span></span><br><span class=\"language-javascript\"><span class=\"language-xml\"><span class=\"hljs-keyword\">const</span> &#123; data &#125; = <span class=\"hljs-keyword\">await</span> iTools.<span class=\"hljs-property\">Axios</span>.<span class=\"hljs-title function_\">get</span>(<span class=\"hljs-string\">&#x27;./sync-data.json&#x27;</span>) <span class=\"hljs-comment\">// 定义在 public 下的json文件</span></span></span><br><span class=\"language-javascript\"><span class=\"language-xml\">name.<span class=\"hljs-property\">value</span> = data.<span class=\"hljs-property\">name</span></span></span><br><span class=\"language-javascript\"><span class=\"language-xml\"></span></span><br><span class=\"language-javascript\"><span class=\"language-xml\"></span><span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">script</span>&gt;</span></span><br></code></pre></td></tr></table></figure>\n\n<ol start=\"2\">\n<li>通过 <code>defineAsyncComponent</code> 动态导入 <code>Sync.vue</code> 组件</li>\n</ol>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\"><span class=\"hljs-keyword\">const</span> <span class=\"hljs-title class_\">Sync</span> = <span class=\"hljs-title function_\">defineAsyncComponent</span>(<span class=\"hljs-function\">() =&gt;</span> <span class=\"hljs-title function_\">import</span>(<span class=\"hljs-string\">&#x27;@/components/Sync.vue&#x27;</span>))<br></code></pre></td></tr></table></figure>\n\n<ol start=\"3\">\n<li>使用 <code>Suspense</code> 内置组件</li>\n</ol>\n<p>在请求过程中，会一直显示 loading… 状态，真实项目中我们可以替换成骨架屏。当接口请求成功，才会显示 <code>Sync.vue</code> 的内容。</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\">&lt;<span class=\"hljs-title class_\">Suspense</span>&gt;<br>  <span class=\"language-xml\"><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">template</span> #<span class=\"hljs-attr\">default</span>&gt;</span></span><br><span class=\"language-xml\">    <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">Sync</span> /&gt;</span></span><br><span class=\"language-xml\">  <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">template</span>&gt;</span></span><br><br>  <span class=\"language-xml\"><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">template</span> #<span class=\"hljs-attr\">fallback</span>&gt;</span></span><br><span class=\"language-xml\">    Loading...</span><br><span class=\"language-xml\">  <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">template</span>&gt;</span></span><br>&lt;/<span class=\"hljs-title class_\">Suspense</span>&gt;<br></code></pre></td></tr></table></figure>\n\n<h2 id=\"性能优化\"><a href=\"#性能优化\" class=\"headerlink\" title=\"性能优化\"></a>性能优化</h2><p>当我们使用了 defineAsyncComponent 动态导入组件，build 项目时，会单独将 Sync.vue 的 js 包拎出来，不会将其打包到index.js 中，通过拆包的方式，减少入口文件的大小，从而减少白屏的时间。</p>\n<h1 id=\"Teleport-传送门\"><a href=\"#Teleport-传送门\" class=\"headerlink\" title=\"Teleport 传送门\"></a>Teleport 传送门</h1><p>将其插槽内容渲染到 DOM 中的另一个位置。</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\">interface <span class=\"hljs-title class_\">TeleportProps</span> &#123;<br>  <span class=\"hljs-comment\">/**</span><br><span class=\"hljs-comment\">   * 必填项。指定目标容器。</span><br><span class=\"hljs-comment\">   * 可以是选择器或实际元素。</span><br><span class=\"hljs-comment\">   */</span><br>  <span class=\"hljs-attr\">to</span>: string | <span class=\"hljs-title class_\">HTMLElement</span><br>  <span class=\"hljs-comment\">/**</span><br><span class=\"hljs-comment\">   * 当值为 `true` 时，内容将保留在其原始位置</span><br><span class=\"hljs-comment\">   * 而不是移动到目标容器中。</span><br><span class=\"hljs-comment\">   * 可以动态更改。</span><br><span class=\"hljs-comment\">   */</span><br>  disabled?: boolean<br>&#125;<br><br><span class=\"hljs-comment\">// examples</span><br>&lt;teleport to=<span class=\"hljs-string\">&quot;#some-id&quot;</span> /&gt;<br><span class=\"language-xml\"><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">teleport</span> <span class=\"hljs-attr\">to</span>=<span class=\"hljs-string\">&quot;.some-class&quot;</span> /&gt;</span></span><br><span class=\"language-xml\"><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">teleport</span> <span class=\"hljs-attr\">to</span>=<span class=\"hljs-string\">&quot;[data-teleport]&quot;</span> /&gt;</span></span><br><span class=\"language-xml\"><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">teleport</span> <span class=\"hljs-attr\">to</span>=<span class=\"hljs-string\">&quot;body&quot;</span> /&gt;</span></span><br></code></pre></td></tr></table></figure>\n\n<h1 id=\"Mitt\"><a href=\"#Mitt\" class=\"headerlink\" title=\"Mitt\"></a>Mitt</h1><p>Vue 2可以支持$on，$off来实现event bus，但是 Vue3 已经不支持这些属性，不过Vue 3可以支持第三方event bus来实现事件通信，</p>\n<p>这里使用 <code>mitt</code>，官方地址：<a href=\"https://github.com/developit/mitt\">https://github.com/developit/mitt</a></p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\"><span class=\"hljs-keyword\">import</span> mitt <span class=\"hljs-keyword\">from</span> <span class=\"hljs-string\">&#x27;mitt&#x27;</span><br><br><span class=\"hljs-comment\">// vue3挂载到全局</span><br>app.<span class=\"hljs-property\">config</span>.<span class=\"hljs-property\">globalProperties</span>.<span class=\"hljs-property\">$mitt</span> = <span class=\"hljs-title function_\">mitt</span>()<br></code></pre></td></tr></table></figure>\n\n<h1 id=\"tsx\"><a href=\"#tsx\" class=\"headerlink\" title=\"tsx\"></a>tsx</h1><blockquote>\n<p>安装插件 npm install @vitejs/plugin-vue-jsx -D</p>\n</blockquote>\n<p>安装如果失败，将 node 版本切换至 v14.16.0</p>\n<p>使用插件</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\"><span class=\"hljs-keyword\">import</span> vueJsx <span class=\"hljs-keyword\">from</span> <span class=\"hljs-string\">&quot;@vitejs/plugin-vue-jsx&quot;</span>;<br><br><span class=\"hljs-keyword\">export</span> <span class=\"hljs-keyword\">default</span> <span class=\"hljs-title function_\">defineConfig</span>(&#123;<br>  <span class=\"hljs-attr\">plugins</span>: [<span class=\"hljs-title function_\">vue</span>(), <span class=\"hljs-title function_\">vueJsx</span>()],<br>  <span class=\"hljs-comment\">// ...</span><br>&#125;)<br></code></pre></td></tr></table></figure>\n\n<p>但是导入 .tsx 文件，TypeScript 会报错：</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\"><span class=\"hljs-comment\">// 找不到模块“@/components/Foo”或其相应的类型声明。</span><br><span class=\"hljs-keyword\">import</span> <span class=\"hljs-title class_\">Foo</span> <span class=\"hljs-keyword\">from</span> <span class=\"hljs-string\">&#x27;@/components/Foo&#x27;</span> <span class=\"hljs-comment\">// 省略了 .tsx 后缀</span><br><br><span class=\"hljs-comment\">// 导入路径不能以“.tsx”扩展名结束。考虑改为导入“@/components/Bar.js”。</span><br><span class=\"hljs-keyword\">import</span> <span class=\"hljs-title class_\">Bar</span> <span class=\"hljs-keyword\">from</span> <span class=\"hljs-string\">&#x27;@/components/Bar.tsx&#x27;</span><br></code></pre></td></tr></table></figure>\n\n<p>配置 <code>tsconfig.json</code>:</p>\n<figure class=\"highlight json\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs json\"><span class=\"hljs-punctuation\">&#123;</span><br>  <span class=\"hljs-attr\">&quot;compilerOptions&quot;</span><span class=\"hljs-punctuation\">:</span> <span class=\"hljs-punctuation\">&#123;</span><br>    <span class=\"hljs-attr\">&quot;baseUrl&quot;</span><span class=\"hljs-punctuation\">:</span> <span class=\"hljs-string\">&quot;.&quot;</span><span class=\"hljs-punctuation\">,</span><br>    <span class=\"hljs-attr\">&quot;paths&quot;</span><span class=\"hljs-punctuation\">:</span> <span class=\"hljs-punctuation\">&#123;</span><br>      <span class=\"hljs-attr\">&quot;@/*&quot;</span><span class=\"hljs-punctuation\">:</span> <span class=\"hljs-punctuation\">[</span><span class=\"hljs-string\">&quot;src/*&quot;</span><span class=\"hljs-punctuation\">]</span><br>    <span class=\"hljs-punctuation\">&#125;</span><span class=\"hljs-punctuation\">,</span><br>  <span class=\"hljs-punctuation\">&#125;</span><br><span class=\"hljs-punctuation\">&#125;</span><br></code></pre></td></tr></table></figure>\n\n<p>之后我们导入 tsx 类型的组件，就不要带上后缀了。</p>\n<p><strong>编写 tsx 组件的3中方式</strong></p>\n<ol>\n<li><p>函数模式</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\"><span class=\"hljs-keyword\">export</span> <span class=\"hljs-keyword\">default</span> <span class=\"hljs-keyword\">function</span>(<span class=\"hljs-params\"></span>) &#123;<br>  <span class=\"hljs-keyword\">return</span> (<br>    <span class=\"language-xml\"><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">h1</span>&gt;</span>TSX componen111t<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">h1</span>&gt;</span></span><br>  )<br>&#125;<br></code></pre></td></tr></table></figure>\n</li>\n<li><p>options API 模式</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\"><span class=\"hljs-keyword\">import</span> &#123; defineComponent &#125; <span class=\"hljs-keyword\">from</span> <span class=\"hljs-string\">&#x27;vue&#x27;</span><br><br><span class=\"hljs-keyword\">export</span> <span class=\"hljs-keyword\">default</span> <span class=\"hljs-title function_\">defineComponent</span>(&#123;<br>  <span class=\"hljs-title function_\">data</span>(<span class=\"hljs-params\"></span>) &#123;<br>    <span class=\"hljs-keyword\">return</span> &#123;<br>      <span class=\"hljs-attr\">compname</span>: <span class=\"hljs-string\">&#x27;jsx comp&#x27;</span><br>    &#125;<br>  &#125;,<br>  <span class=\"hljs-title function_\">render</span>(<span class=\"hljs-params\"></span>) &#123;<br>    <span class=\"hljs-keyword\">return</span> (<br>      <span class=\"language-xml\"><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">div</span>&gt;</span>&#123;this.compname&#125;<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">div</span>&gt;</span></span><br>    )<br>  &#125;<br>&#125;)<br></code></pre></td></tr></table></figure>\n</li>\n<li><p>setup 函数模式</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\"><br>interface <span class=\"hljs-title class_\">IProps</span> &#123;<br>  name?: string;<br>&#125;<br><br><span class=\"hljs-keyword\">export</span> <span class=\"hljs-keyword\">default</span> <span class=\"hljs-title function_\">defineComponent</span>(&#123;<br>  <span class=\"hljs-attr\">props</span>: &#123;<br>    <span class=\"hljs-attr\">name</span>: <span class=\"hljs-title class_\">String</span>,<br>  &#125;,<br>  <span class=\"hljs-attr\">emits</span>: [<span class=\"hljs-string\">&#x27;on-click&#x27;</span>],<br>  <span class=\"hljs-title function_\">setup</span>(<span class=\"hljs-params\">props: IProps</span>) &#123;<br>    <span class=\"hljs-keyword\">const</span> is = <span class=\"hljs-literal\">true</span><br>    <span class=\"hljs-comment\">// 返回渲染函数</span><br>    <span class=\"hljs-keyword\">return</span> <span class=\"hljs-function\">() =&gt;</span> &#123;<br>      <span class=\"hljs-keyword\">return</span> (<br>        <span class=\"language-xml\"><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">h1</span> <span class=\"hljs-attr\">v-show</span>=<span class=\"hljs-string\">&#123;is&#125;</span>&gt;</span>setup 渲染函数 &#123;props?.name&#125;<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">h1</span>&gt;</span></span><br>      )<br>    &#125;<br>  &#125;<br>&#125;)<br></code></pre></td></tr></table></figure>\n\n</li>\n</ol>\n<h2 id=\"tsx-slot-使用\"><a href=\"#tsx-slot-使用\" class=\"headerlink\" title=\"tsx slot 使用\"></a>tsx slot 使用</h2><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\"><span class=\"hljs-keyword\">const</span> <span class=\"hljs-title function_\">Foo</span> = (<span class=\"hljs-params\">_, &#123; slots &#125;</span>) =&gt; &#123;<br>  <br>  <span class=\"hljs-keyword\">return</span> (<span class=\"language-xml\"><span class=\"hljs-tag\">&lt;&gt;</span></span><br><span class=\"language-xml\">    <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">p</span>&gt;</span>&#123; slots?.header?.()&#125;<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">p</span>&gt;</span></span><br><span class=\"language-xml\">    <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">h3</span>&gt;</span>slot comp<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">h3</span>&gt;</span></span><br><span class=\"language-xml\">    <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">p</span>&gt;</span>&#123; slots.default ? slots.default() : &#x27;默认插槽&#x27; &#125;<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">p</span>&gt;</span></span><br><span class=\"language-xml\">  <span class=\"hljs-tag\">&lt;/&gt;</span></span>)<br>&#125;<br><br><br>&lt;<span class=\"hljs-title class_\">Foo</span> v-slots=&#123;&#123;<br>  <span class=\"hljs-title function_\">default</span>(<span class=\"hljs-params\"></span>) &#123;<br>    <span class=\"hljs-keyword\">return</span> <span class=\"hljs-string\">&#x27;setup default slot&#x27;</span><br>  &#125;,<br>  <span class=\"hljs-title function_\">header</span>(<span class=\"hljs-params\"></span>) &#123;<br>    <span class=\"hljs-keyword\">return</span> <span class=\"hljs-string\">&#x27;header&#x27;</span><br>  &#125;<br>&#125;&#125; /&gt;<br><br></code></pre></td></tr></table></figure>\n\n<h1 id=\"自动引入\"><a href=\"#自动引入\" class=\"headerlink\" title=\"自动引入\"></a>自动引入</h1><blockquote>\n<p>安装插件 unplugin-auto-import/vite  <a href=\"https://github.com/antfu/unplugin-auto-import\">https://github.com/antfu/unplugin-auto-import</a></p>\n</blockquote>\n<p>注册完 plugin 之后，不再引入 <code>ref, reactive</code> 等等方法了，直接使用即可。</p>\n<h1 id=\"v-model\"><a href=\"#v-model\" class=\"headerlink\" title=\"v-model\"></a>v-model</h1><blockquote>\n<p>官网：<a href=\"https://cn.vuejs.org/guide/components/events.html\">https://cn.vuejs.org/guide/components/events.html</a></p>\n</blockquote>\n<p>v-model 在原生元素上的用法：</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\">&lt;input v-model=<span class=\"hljs-string\">&quot;searchText&quot;</span> /&gt;<br><br><span class=\"hljs-comment\">// 等价于</span><br><br><span class=\"language-xml\"><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">input</span></span></span><br><span class=\"hljs-tag\"><span class=\"language-xml\">  <span class=\"hljs-attr\">:value</span>=<span class=\"hljs-string\">&quot;searchText&quot;</span></span></span><br><span class=\"hljs-tag\"><span class=\"language-xml\">  @<span class=\"hljs-attr\">input</span>=<span class=\"hljs-string\">&quot;searchText = $event.target.value&quot;</span></span></span><br><span class=\"hljs-tag\"><span class=\"language-xml\">/&gt;</span></span><br></code></pre></td></tr></table></figure>\n\n<p>而当使用在一个组件上时，v-model 会被展开为如下的形式：</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\">&lt;<span class=\"hljs-title class_\">CustomInput</span><br>  :modelValue=<span class=\"hljs-string\">&quot;searchText&quot;</span><br>  @<span class=\"hljs-attr\">update</span>:modelValue=<span class=\"hljs-string\">&quot;newValue =&gt; searchText = newValue&quot;</span><br>/&gt;<br><br><br><span class=\"hljs-comment\">// 内部定义 props 和 方法</span><br><br><span class=\"hljs-keyword\">const</span> props = defineProps&lt;&#123;<br>  <span class=\"hljs-attr\">modelValue</span>: boolean<br>&#125;&gt;()<br><br><span class=\"hljs-keyword\">const</span> emits = <span class=\"hljs-title function_\">defineEmits</span>([<span class=\"hljs-string\">&#x27;update:modelValue&#x27;</span>])<br><br><br><span class=\"hljs-comment\">// 调用</span><br><span class=\"hljs-title function_\">emits</span>(<span class=\"hljs-string\">&#x27;update:modelValue&#x27;</span>, !props.<span class=\"hljs-property\">modelValue</span>)<br><br></code></pre></td></tr></table></figure>\n\n<p>当然，我们也可以给 <code>v-model</code> 指定一个参数，不使用默认的 <code>modelValue</code>:</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\">&lt;<span class=\"hljs-title class_\">MyComponent</span> v-<span class=\"hljs-attr\">model</span>:title=<span class=\"hljs-string\">&quot;bookTitle&quot;</span> /&gt;<br><br><span class=\"hljs-comment\">// 定义 props</span><br><span class=\"hljs-title function_\">defineProps</span>([<span class=\"hljs-string\">&#x27;title&#x27;</span>])<br><span class=\"hljs-title function_\">defineEmits</span>([<span class=\"hljs-string\">&#x27;update:title&#x27;</span>])<br></code></pre></td></tr></table></figure>\n\n<p>我们还可以绑定多个 v-model:</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\">&lt;<span class=\"hljs-title class_\">UserName</span><br>  v-<span class=\"hljs-attr\">model</span>:first-name=<span class=\"hljs-string\">&quot;first&quot;</span><br>  v-<span class=\"hljs-attr\">model</span>:last-name=<span class=\"hljs-string\">&quot;last&quot;</span><br>/&gt;<br></code></pre></td></tr></table></figure>\n\n<h1 id=\"自定义指令\"><a href=\"#自定义指令\" class=\"headerlink\" title=\"自定义指令\"></a>自定义指令</h1><blockquote>\n<p><a href=\"https://cn.vuejs.org/guide/reusability/custom-directives.html\">https://cn.vuejs.org/guide/reusability/custom-directives.html</a></p>\n</blockquote>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\"><span class=\"hljs-keyword\">const</span> myDirective = &#123;<br>  <span class=\"hljs-comment\">// 在绑定元素的 attribute 前</span><br>  <span class=\"hljs-comment\">// 或事件监听器应用前调用</span><br>  <span class=\"hljs-title function_\">created</span>(<span class=\"hljs-params\">el, binding, vnode, prevVnode</span>) &#123;&#125;,<br>  <span class=\"hljs-comment\">// 在元素被插入到 DOM 前调用</span><br>  <span class=\"hljs-title function_\">beforeMount</span>(<span class=\"hljs-params\">el, binding, vnode, prevVnode</span>) &#123;&#125;,<br>  <span class=\"hljs-comment\">// 在绑定元素的父组件</span><br>  <span class=\"hljs-comment\">// 及他自己的所有子节点都挂载完成后调用</span><br>  <span class=\"hljs-title function_\">mounted</span>(<span class=\"hljs-params\">el, binding, vnode, prevVnode</span>) &#123;&#125;,<br>  <span class=\"hljs-comment\">// 绑定元素的父组件更新前调用</span><br>  <span class=\"hljs-title function_\">beforeUpdate</span>(<span class=\"hljs-params\">el, binding, vnode, prevVnode</span>) &#123;&#125;,<br>  <span class=\"hljs-comment\">// 在绑定元素的父组件</span><br>  <span class=\"hljs-comment\">// 及他自己的所有子节点都更新后调用</span><br>  <span class=\"hljs-title function_\">updated</span>(<span class=\"hljs-params\">el, binding, vnode, prevVnode</span>) &#123;&#125;,<br>  <span class=\"hljs-comment\">// 绑定元素的父组件卸载前调用</span><br>  <span class=\"hljs-title function_\">beforeUnmount</span>(<span class=\"hljs-params\">el, binding, vnode, prevVnode</span>) &#123;&#125;,<br>  <span class=\"hljs-comment\">// 绑定元素的父组件卸载后调用</span><br>  <span class=\"hljs-title function_\">unmounted</span>(<span class=\"hljs-params\">el, binding, vnode, prevVnode</span>) &#123;&#125;<br>&#125;<br></code></pre></td></tr></table></figure>\n\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\">&lt;div v-<span class=\"hljs-attr\">example</span>:foo.<span class=\"hljs-property\">bar</span>=<span class=\"hljs-string\">&quot;baz&quot;</span>&gt;<br><br><span class=\"hljs-comment\">// binding 参数会是一个这样的对象：</span><br>&#123;<br>  <span class=\"hljs-attr\">arg</span>: <span class=\"hljs-string\">&#x27;foo&#x27;</span>,<br>  <span class=\"hljs-attr\">modifiers</span>: &#123; <span class=\"hljs-attr\">bar</span>: <span class=\"hljs-literal\">true</span> &#125;,<br>  <span class=\"hljs-attr\">value</span>: <span class=\"hljs-comment\">/* `baz` 的值 */</span>,<br>  <span class=\"hljs-attr\">oldValue</span>: <span class=\"hljs-comment\">/* 上一次更新时 `baz` 的值 */</span><br>&#125;<br></code></pre></td></tr></table></figure>\n\n<h1 id=\"全局函数或变量\"><a href=\"#全局函数或变量\" class=\"headerlink\" title=\"全局函数或变量\"></a>全局函数或变量</h1><p>在 Vue2 中，我们经常将全局用到的函数定义在 Vue 的 prototype 上，在 Vue3 中已经不这样使用了:</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\"><span class=\"hljs-keyword\">const</span> app = <span class=\"hljs-title function_\">createApp</span>(<span class=\"hljs-title class_\">App</span>)<br><br><br>app.<span class=\"hljs-property\">config</span>.<span class=\"hljs-property\">globalProperties</span>.<span class=\"hljs-property\">$env</span> = <span class=\"hljs-string\">&#x27;dev&#x27;</span><br>app.<span class=\"hljs-property\">config</span>.<span class=\"hljs-property\">globalProperties</span>.<span class=\"hljs-property\">$filters</span> = &#123;<br>  format&lt;T&gt;(<span class=\"hljs-attr\">str</span>: T): string &#123;<br>    <span class=\"hljs-keyword\">return</span> str.<span class=\"hljs-title function_\">trim</span>()<br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure>\n\n<p>我们使用的时候，不需要导入什么，直接在 .vue 文件使用即可:</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\">&lt;div&gt;env &#123;&#123;$env&#125;&#125;&lt;/div&gt;<br><br><br><span class=\"language-xml\"><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">script</span> <span class=\"hljs-attr\">setup</span> <span class=\"hljs-attr\">lang</span>=<span class=\"hljs-string\">&quot;ts&quot;</span>&gt;</span><span class=\"language-javascript\"></span></span><br><span class=\"language-javascript\"><span class=\"language-xml\">  <span class=\"hljs-keyword\">const</span> app = <span class=\"hljs-title function_\">getCurrentInstance</span>()</span></span><br><span class=\"language-javascript\"><span class=\"language-xml\"></span></span><br><span class=\"language-javascript\"><span class=\"language-xml\">  <span class=\"hljs-variable language_\">console</span>.<span class=\"hljs-title function_\">log</span>(app?.<span class=\"hljs-property\">proxy</span>?.<span class=\"hljs-property\">$filters</span>.<span class=\"hljs-title function_\">format</span>(<span class=\"hljs-string\">&#x27;getCurrentInstance&#x27;</span>))</span></span><br><span class=\"language-javascript\"><span class=\"language-xml\"></span><span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">script</span>&gt;</span></span><br></code></pre></td></tr></table></figure>\n\n\n<p>在组件中使用全局的变量或者函数时，会出现 ts 报错，这时我们需要去声明它的类型:</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\">declare <span class=\"hljs-variable language_\">module</span> <span class=\"hljs-string\">&#x27;vue&#x27;</span> &#123;<br>  <span class=\"hljs-keyword\">export</span> interface <span class=\"hljs-title class_\">ComponentCustomProperties</span> &#123;<br>    <span class=\"hljs-attr\">$filters</span>: &#123;<br>      format&lt;T&gt;(<span class=\"hljs-attr\">str</span>: T): string,<br>    &#125;,<br>    <span class=\"hljs-attr\">$env</span>: string,<br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure>\n\n<h1 id=\"自定义插件\"><a href=\"#自定义插件\" class=\"headerlink\" title=\"自定义插件\"></a>自定义插件</h1><blockquote>\n<p>一个插件可以是一个拥有 install() 方法的对象，也可以直接是一个安装函数本身。</p>\n</blockquote>\n<p>插件没有严格定义的使用范围，但是插件发挥作用的常见场景主要包括以下几种：</p>\n<ol>\n<li><p>通过 app.component() 和 app.directive() 注册一到多个全局组件或自定义指令。</p>\n</li>\n<li><p>通过 app.provide() 使一个资源可被注入进整个应用。</p>\n</li>\n<li><p>向 app.config.globalProperties 中添加一些全局实例属性或方法</p>\n</li>\n</ol>\n<p>以一个全局的 <code>Loading</code> 组件为例：</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\"><span class=\"hljs-comment\">// Loading/index.ts</span><br><br><span class=\"hljs-keyword\">import</span> type &#123; <span class=\"hljs-title class_\">App</span>, <span class=\"hljs-title class_\">VNode</span> &#125; <span class=\"hljs-keyword\">from</span> <span class=\"hljs-string\">&#x27;vue&#x27;</span><br><span class=\"hljs-keyword\">import</span> &#123; createVNode, render &#125; <span class=\"hljs-keyword\">from</span> <span class=\"hljs-string\">&#x27;vue&#x27;</span><br><span class=\"hljs-keyword\">import</span> <span class=\"hljs-title class_\">Loading</span> <span class=\"hljs-keyword\">from</span> <span class=\"hljs-string\">&#x27;./index.vue&#x27;</span><br><br><span class=\"hljs-keyword\">export</span> <span class=\"hljs-keyword\">default</span> &#123;<br>  install (<span class=\"hljs-attr\">app</span>: <span class=\"hljs-title class_\">App</span>) &#123;<br>    <span class=\"hljs-comment\">// Loading 需要转成 VNode</span><br>    <span class=\"hljs-keyword\">const</span> <span class=\"hljs-title class_\">VNode</span>: <span class=\"hljs-title class_\">VNode</span> = <span class=\"hljs-title function_\">createVNode</span>(<span class=\"hljs-title class_\">Loading</span>)<br><br>    <span class=\"hljs-comment\">// 将组件挂在到某个元素下</span><br>    <span class=\"hljs-title function_\">render</span>(<span class=\"hljs-title class_\">VNode</span>, <span class=\"hljs-variable language_\">document</span>.<span class=\"hljs-property\">body</span>)<br><br>    <span class=\"hljs-comment\">// Loading 组件通过 defineExpose 方法，暴露内部方法会在 exposed 字段上</span><br><br>    app.<span class=\"hljs-property\">config</span>.<span class=\"hljs-property\">globalProperties</span>.<span class=\"hljs-property\">$loading</span> = &#123;<br>      <span class=\"hljs-attr\">onShow</span>: <span class=\"hljs-title class_\">VNode</span>.<span class=\"hljs-property\">component</span>?.<span class=\"hljs-property\">exposed</span>?.<span class=\"hljs-property\">onShow</span>,<br>      <span class=\"hljs-attr\">onHide</span>: <span class=\"hljs-title class_\">VNode</span>.<span class=\"hljs-property\">component</span>?.<span class=\"hljs-property\">exposed</span>?.<span class=\"hljs-property\">onHide</span><br>    &#125;<br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure>\n\n<p>Loading 组件内部实现</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\">&lt;template&gt;<br>  <span class=\"language-xml\"><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">div</span> <span class=\"hljs-attr\">class</span>=<span class=\"hljs-string\">&quot;loading&quot;</span> <span class=\"hljs-attr\">v-if</span>=<span class=\"hljs-string\">&quot;show&quot;</span> @<span class=\"hljs-attr\">click</span>=<span class=\"hljs-string\">&quot;onHide&quot;</span>&gt;</span></span><br><span class=\"language-xml\">    <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">img</span> <span class=\"hljs-attr\">src</span>=<span class=\"hljs-string\">&quot;../../assets/imgs/loading.gif&quot;</span> <span class=\"hljs-attr\">alt</span>=<span class=\"hljs-string\">&quot;&quot;</span> /&gt;</span></span><br><span class=\"language-xml\">  <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">div</span>&gt;</span></span><br>&lt;/template&gt;<br><br><span class=\"language-xml\"><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">script</span> <span class=\"hljs-attr\">setup</span> <span class=\"hljs-attr\">lang</span>=<span class=\"hljs-string\">&#x27;ts&#x27;</span>&gt;</span><span class=\"language-javascript\"></span></span><br><span class=\"language-javascript\"><span class=\"language-xml\"><span class=\"hljs-keyword\">import</span> &#123;ref, reactive&#125; <span class=\"hljs-keyword\">from</span> <span class=\"hljs-string\">&#x27;vue&#x27;</span></span></span><br><span class=\"language-javascript\"><span class=\"language-xml\"></span></span><br><span class=\"language-javascript\"><span class=\"language-xml\"><span class=\"hljs-keyword\">const</span> show = <span class=\"hljs-title function_\">ref</span>(<span class=\"hljs-literal\">false</span>)</span></span><br><span class=\"language-javascript\"><span class=\"language-xml\"></span></span><br><span class=\"language-javascript\"><span class=\"language-xml\"><span class=\"hljs-keyword\">const</span> <span class=\"hljs-title function_\">onShow</span> = (<span class=\"hljs-params\"></span>) =&gt; show.<span class=\"hljs-property\">value</span> = <span class=\"hljs-literal\">true</span></span></span><br><span class=\"language-javascript\"><span class=\"language-xml\"><span class=\"hljs-keyword\">const</span> <span class=\"hljs-title function_\">onHide</span> = (<span class=\"hljs-params\"></span>) =&gt; show.<span class=\"hljs-property\">value</span> = <span class=\"hljs-literal\">false</span></span></span><br><span class=\"language-javascript\"><span class=\"language-xml\"></span></span><br><span class=\"language-javascript\"><span class=\"language-xml\"><span class=\"hljs-comment\">// 暴露内部方法供外部调用</span></span></span><br><span class=\"language-javascript\"><span class=\"language-xml\"><span class=\"hljs-title function_\">defineExpose</span>(&#123;</span></span><br><span class=\"language-javascript\"><span class=\"language-xml\">  onShow,</span></span><br><span class=\"language-javascript\"><span class=\"language-xml\">  onHide,</span></span><br><span class=\"language-javascript\"><span class=\"language-xml\">&#125;)</span></span><br><span class=\"language-javascript\"><span class=\"language-xml\"></span></span><br><span class=\"language-javascript\"><span class=\"language-xml\"></span><span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">script</span>&gt;</span></span><br><span class=\"language-xml\"><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">style</span> <span class=\"hljs-attr\">scoped</span> <span class=\"hljs-attr\">lang</span>=<span class=\"hljs-string\">&quot;less&quot;</span>&gt;</span><span class=\"language-css\"></span></span><br><span class=\"language-css\"><span class=\"language-xml\"><span class=\"hljs-selector-class\">.loading</span> &#123;</span></span><br><span class=\"language-css\"><span class=\"language-xml\">  <span class=\"hljs-attribute\">width</span>: <span class=\"hljs-number\">100%</span>;</span></span><br><span class=\"language-css\"><span class=\"language-xml\">  <span class=\"hljs-attribute\">height</span>: <span class=\"hljs-number\">100%</span>;</span></span><br><span class=\"language-css\"><span class=\"language-xml\">  <span class=\"hljs-attribute\">background-color</span>: <span class=\"hljs-number\">#1f2123</span>;</span></span><br><span class=\"language-css\"><span class=\"language-xml\">  <span class=\"hljs-attribute\">position</span>: absolute;</span></span><br><span class=\"language-css\"><span class=\"language-xml\">  <span class=\"hljs-attribute\">top</span>: <span class=\"hljs-number\">0</span>;</span></span><br><span class=\"language-css\"><span class=\"language-xml\">  <span class=\"hljs-attribute\">left</span>: <span class=\"hljs-number\">0</span>;</span></span><br><span class=\"language-css\"><span class=\"language-xml\">  <span class=\"hljs-attribute\">text-align</span>: center;</span></span><br><span class=\"language-css\"><span class=\"language-xml\">&#125;</span></span><br><span class=\"language-css\"><span class=\"language-xml\"></span><span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">style</span>&gt;</span></span><br></code></pre></td></tr></table></figure>\n\n<p>这样我们就可以在任何地方使用 全局 Loading 了。</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\"><span class=\"hljs-comment\">// setup</span><br><span class=\"hljs-keyword\">const</span> instance = <span class=\"hljs-title function_\">getCurrentInstance</span>()<br><br><span class=\"hljs-keyword\">const</span> <span class=\"hljs-title function_\">showLoading</span> = (<span class=\"hljs-params\"></span>) =&gt; &#123;<br>  instance?.<span class=\"hljs-property\">proxy</span>?.<span class=\"hljs-property\">$loading</span>.<span class=\"hljs-title function_\">onShow</span>()<br>&#125;<br><br><span class=\"hljs-comment\">// or 直接在 template 中使用</span><br>&lt;button @click=<span class=\"hljs-string\">&quot;$loading.onShow&quot;</span>&gt;show loading&lt;/button&gt;<br></code></pre></td></tr></table></figure>\n\n<p>如果调用 $loading 报ts错误，我们可以声明全局类型</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\">declare <span class=\"hljs-variable language_\">module</span> <span class=\"hljs-string\">&#x27;vue&#x27;</span> &#123;<br>  <span class=\"hljs-keyword\">export</span> interface <span class=\"hljs-title class_\">ComponentCustomProperties</span> &#123;<br>    <span class=\"hljs-attr\">$loading</span>: &#123;<br>      <span class=\"hljs-title function_\">onShow</span>(): <span class=\"hljs-keyword\">void</span>;<br>      <span class=\"hljs-title function_\">onHide</span>(): <span class=\"hljs-keyword\">void</span>;<br>    &#125;<br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure>\n\n<h1 id=\"Scoped原理-amp-样式穿透\"><a href=\"#Scoped原理-amp-样式穿透\" class=\"headerlink\" title=\"Scoped原理 &amp; 样式穿透\"></a>Scoped原理 &amp; 样式穿透</h1><ol>\n<li>给 HTML DOM节点加一个不重复的 data 属性（形如: data-v-xxxxx），来表示它的唯一性</li>\n<li>在每句 CSS 选择器的末尾，加一个当前组件的 data 属性选择器，来私有化样式</li>\n<li>如果组件内部包含其他组件，只会给其他组件的最外层标签加上当前组件的 data 属性.</li>\n</ol>\n<p>想要直接修改开源组件的样式，大概率是失败的，解决方案就是要使用样式穿透</p>\n<figure class=\"highlight css\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs css\">/deep/ <span class=\"hljs-selector-class\">.input</span> &#123;<br>  ...<br>&#125;<br><br>// or<br><br>:<span class=\"hljs-built_in\">deep</span>(.input) &#123;<br>  ...<br>&#125;<br></code></pre></td></tr></table></figure>\n\n\n<h1 id=\"css新特性\"><a href=\"#css新特性\" class=\"headerlink\" title=\"css新特性\"></a>css新特性</h1><h2 id=\"插槽选择器\"><a href=\"#插槽选择器\" class=\"headerlink\" title=\"插槽选择器\"></a>插槽选择器</h2><p>我们在使用插槽时，如何在子组件中修改插槽内容的样式</p>\n<figure class=\"highlight css\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs css\"><span class=\"hljs-selector-pseudo\">:slotted</span>(<span class=\"hljs-selector-class\">.p-footer</span>) &#123;<br>  <span class=\"hljs-attribute\">color</span>: red;<br>&#125;<br></code></pre></td></tr></table></figure>\n\n<h2 id=\"定义全局样式\"><a href=\"#定义全局样式\" class=\"headerlink\" title=\"定义全局样式\"></a>定义全局样式</h2><figure class=\"highlight css\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs css\">:<span class=\"hljs-built_in\">global</span>(div) &#123;<br>  <span class=\"hljs-attribute\">color</span>: red;<br>&#125;<br></code></pre></td></tr></table></figure>\n\n<h2 id=\"动态-css\"><a href=\"#动态-css\" class=\"headerlink\" title=\"动态 css\"></a>动态 css</h2><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\"><span class=\"hljs-comment\">// js</span><br><span class=\"hljs-keyword\">const</span> color = <span class=\"hljs-title function_\">ref</span>(<span class=\"hljs-string\">&#x27;red&#x27;</span>)<br><span class=\"hljs-keyword\">const</span> font = <span class=\"hljs-title function_\">ref</span>(&#123;<br>  <span class=\"hljs-attr\">fontSize</span>: <span class=\"hljs-string\">&#x27;24px&#x27;</span>,<br>  <span class=\"hljs-attr\">fontWeight</span>: <span class=\"hljs-string\">&#x27;bold&#x27;</span>,<br>&#125;)<br><br><span class=\"hljs-comment\">// css</span><br>.<span class=\"hljs-property\">box</span> &#123;<br>  <span class=\"hljs-attr\">color</span>: v-<span class=\"hljs-title function_\">bind</span>(color);<br>  font-<span class=\"hljs-attr\">size</span>: v-<span class=\"hljs-title function_\">bind</span>(<span class=\"hljs-string\">&#x27;font.fontSize&#x27;</span>);<br>&#125;<br></code></pre></td></tr></table></figure>\n\n<h2 id=\"模块化-css\"><a href=\"#模块化-css\" class=\"headerlink\" title=\"模块化 css\"></a>模块化 css</h2><p>给 style 标签加上 module 属性</p>\n<figure class=\"highlight css\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs css\">// template<br>// 如果有多个，就写成数组形式<br>&lt;<span class=\"hljs-selector-tag\">div</span> :class=<span class=\"hljs-string\">&quot;[$style.box]&quot;</span>&gt;<br>  模块 css<br>&lt;/div&gt;<br><br>// css<br>&lt;style module&gt;<br>.box &#123;<br>  <span class=\"hljs-attribute\">color</span>: red<br>&#125;<br>&lt;/style&gt;<br></code></pre></td></tr></table></figure>\n\n<p><code>$style</code> 是固定的写法，如果不想用这个变量，我们可以指定 <code>module=&quot;myStyle&quot;</code> 。</p>\n<p>我们还可以通过 <code>useCssModule</code> 获取当前组件下的样式类名</p>\n<figure class=\"highlight angelscript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs angelscript\"><span class=\"hljs-comment\">// 默认</span><br><span class=\"hljs-keyword\">const</span> <span class=\"hljs-keyword\">class</span> = <span class=\"hljs-symbol\">useCssModule</span>()<br><span class=\"hljs-symbol\">const</span> <span class=\"hljs-symbol\">class</span> = <span class=\"hljs-symbol\">useCssModule</span>(&#x27;$<span class=\"hljs-symbol\">style</span>&#x27;)<br><br>// 如果指定了 <span class=\"hljs-symbol\">module</span><br><span class=\"hljs-symbol\">const</span> <span class=\"hljs-symbol\">class</span> = <span class=\"hljs-symbol\">useCssModule</span>(&#x27;<span class=\"hljs-symbol\">myStyle</span>&#x27;)<br></code></pre></td></tr></table></figure>\n\n<h1 id=\"集成-Tailwind-CSS\"><a href=\"#集成-Tailwind-CSS\" class=\"headerlink\" title=\"集成 Tailwind CSS\"></a>集成 Tailwind CSS</h1><blockquote>\n<p><a href=\"https://blog.csdn.net/qq1195566313/article/details/124951311?ops_request_misc=%257B%2522request%255Fid%2522%253A%2522167109189716782427434983%2522%252C%2522scm%2522%253A%252220140713.130102334.pc%255Fblog.%2522%257D&amp;request_id=167109189716782427434983&amp;biz_id=0&amp;utm_medium=distribute.pc_search_result.none-task-blog-2~blog~first_rank_ecpm_v1~rank_v31_ecpm-1-124951311-null-null.nonecase&amp;utm_term=tailwind&amp;spm=1018.2226.3001.4450\">https://blog.csdn.net/qq1195566313/article/details/124951311?ops_request_misc=%257B%2522request%255Fid%2522%253A%2522167109189716782427434983%2522%252C%2522scm%2522%253A%252220140713.130102334.pc%255Fblog.%2522%257D&amp;request_id=167109189716782427434983&amp;biz_id=0&amp;utm_medium=distribute.pc_search_result.none-task-blog-2~blog~first_rank_ecpm_v1~rank_v31_ecpm-1-124951311-null-null.nonecase&amp;utm_term=tailwind&amp;spm=1018.2226.3001.4450</a></p>\n</blockquote>\n<p>安装 vscode 提示插件 <code>Tailwind CSS IntelliSense</code></p>\n<h1 id=\"h函数\"><a href=\"#h函数\" class=\"headerlink\" title=\"h函数\"></a>h函数</h1><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\"><span class=\"hljs-keyword\">import</span> &#123; h &#125; <span class=\"hljs-keyword\">from</span> <span class=\"hljs-string\">&#x27;vue&#x27;</span><br><br><span class=\"hljs-keyword\">const</span> <span class=\"hljs-title function_\">Btn</span> = (<span class=\"hljs-params\">props, ctx</span>) =&gt; &#123;<br>  <span class=\"hljs-keyword\">return</span> <span class=\"hljs-title function_\">h</span>(<span class=\"hljs-string\">&#x27;div&#x27;</span>, &#123;<br>    <span class=\"hljs-attr\">class</span>: [...],<br>    <span class=\"hljs-attr\">onClick</span>: <span class=\"hljs-function\">() =&gt;</span> &#123;<br>      ctx.<span class=\"hljs-title function_\">emit</span>(<span class=\"hljs-string\">&#x27;on-click&#x27;</span>, <span class=\"hljs-string\">&#x27;hello world&#x27;</span>)<br>    &#125;,<br>  &#125;, ctx.<span class=\"hljs-property\">slots</span>.<span class=\"hljs-title function_\">default</span>())<br>&#125;<br><br></code></pre></td></tr></table></figure>\n\n\n\n<h1 id=\"参考资料\"><a href=\"#参考资料\" class=\"headerlink\" title=\"参考资料\"></a>参考资料</h1><section class=\"footnotes\"><div class=\"footnote-list\"><ol><li><span id=\"fn:1\" class=\"footnote-text\"><span><a href=\"https://blog.csdn.net/u012961419/article/details/124299803\">Vue3+Vite+Ts 项目实战 01 Vite 创建项目、ESLint+TS+GitCommit配置、Vue3新特性介绍</a>\n<a href=\"#fnref:1\" rev=\"footnote\" class=\"footnote-backref\"> ↩</a></span></span></li></ol></div></section>","site":{"data":{}},"wordcount":12766,"more":"<h1 id=\"ref-和-reactive-使用上有什么区别\"><a href=\"#ref-和-reactive-使用上有什么区别\" class=\"headerlink\" title=\"ref 和 reactive 使用上有什么区别?\"></a>ref 和 reactive 使用上有什么区别?</h1><ol>\n<li>ref 支持所有的类型，reactive 只接收引用类型（Array/Object/Map/Set）</li>\n<li>ref 取值和赋值都需要加 .value，reactive 不需要 .value</li>\n<li>reactive 不能直接赋值，否则会破坏响应式（proxy）</li>\n</ol>\n<p>如果要改变数组，可以通过 push 方法，将要 push 的数组结构 (xx.push(…arr))</p>\n<h2 id=\"如何抉择呢？\"><a href=\"#如何抉择呢？\" class=\"headerlink\" title=\"如何抉择呢？\"></a>如何抉择呢？</h2><p>因为社区大佬 <code>basvanmeurs</code>提出了一个新的 PR，大概就是重构了响应式的部分内容，由于重构内容过于庞大，所以一直等到 2021 年 8 月 5 号，伴随着 Vue3.2 的发布，尤大大才合并对应的代码。</p>\n<p><code>ref</code> 被重构之后，有了更高效的实现（提升了 约 260% 的读取速度 / 约 50% 的写入速度），依赖跟踪速度提高了约 40%，内存使用量减少了约 17%，毫无疑问这是一个伟大的变化。</p>\n<p>那么，在以后的使用过程当中，能使用 <code>ref</code> 就用 <code>ref</code>吧，毕竟它的性能得到了如此大的提升。</p>\n<h1 id=\"defineProps-如何定义默认值？\"><a href=\"#defineProps-如何定义默认值？\" class=\"headerlink\" title=\"defineProps 如何定义默认值？\"></a>defineProps 如何定义默认值？</h1><blockquote>\n<p>针对类型的 defineProps 声明的不足之处在于，它没有可以给 props 提供默认值的方式。</p>\n</blockquote>\n<p>使用TS 特有的默认值方式 <code>withDefaults</code> 函数，无须引入开箱即用，接受一个props函数第二个参数是一个对象设置默认值。</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\"><span class=\"hljs-keyword\">export</span> interface <span class=\"hljs-title class_\">Props</span> &#123;<br>  msg?: string<br>  labels?: string[]<br>&#125;<br><br><span class=\"hljs-keyword\">const</span> props = <span class=\"hljs-title function_\">withDefaults</span>(defineProps&lt;<span class=\"hljs-title class_\">Props</span>&gt;(), &#123;<br>  <span class=\"hljs-attr\">msg</span>: <span class=\"hljs-string\">&#x27;hello&#x27;</span>,<br>  <span class=\"hljs-attr\">labels</span>: <span class=\"hljs-function\">() =&gt;</span> [<span class=\"hljs-string\">&#x27;one&#x27;</span>, <span class=\"hljs-string\">&#x27;two&#x27;</span>]<br>&#125;)<br></code></pre></td></tr></table></figure>\n\n<p><strong>注意</strong></p>\n<p>如果使用 withDefaults 报错 <code>&#39;withDefaults&#39; is not defined</code>，我们修改 <code>.eslintrc</code> 文件</p>\n<p>添加如下配置代码：</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\"><span class=\"hljs-attr\">globals</span>: &#123;<br>    <span class=\"hljs-attr\">withDefaults</span>: <span class=\"hljs-string\">&#x27;readonly&#x27;</span><br>&#125;,<br></code></pre></td></tr></table></figure>\n\n<h1 id=\"动态组件\"><a href=\"#动态组件\" class=\"headerlink\" title=\"动态组件\"></a>动态组件</h1><blockquote>\n<p>component</p>\n</blockquote>\n<p>要渲染的实际组件由 is prop 决定。</p>\n<ul>\n<li>当 is 是字符串，它既可以是 HTML 标签名也可以是组件的注册名。</li>\n<li>或者，is 也可以直接绑定组件。</li>\n</ul>\n<p>按注册名渲染组件</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\">&lt;script&gt;<br><span class=\"hljs-keyword\">import</span> <span class=\"hljs-title class_\">Foo</span> <span class=\"hljs-keyword\">from</span> <span class=\"hljs-string\">&#x27;./Foo.vue&#x27;</span><br><span class=\"hljs-keyword\">import</span> <span class=\"hljs-title class_\">Bar</span> <span class=\"hljs-keyword\">from</span> <span class=\"hljs-string\">&#x27;./Bar.vue&#x27;</span><br><br><span class=\"hljs-keyword\">export</span> <span class=\"hljs-keyword\">default</span> &#123;<br>  <span class=\"hljs-attr\">components</span>: &#123; <span class=\"hljs-title class_\">Foo</span>, <span class=\"hljs-title class_\">Bar</span> &#125;,<br>  <span class=\"hljs-title function_\">data</span>(<span class=\"hljs-params\"></span>) &#123;<br>    <span class=\"hljs-keyword\">return</span> &#123;<br>      <span class=\"hljs-attr\">view</span>: <span class=\"hljs-string\">&#x27;Foo&#x27;</span><br>    &#125;<br>  &#125;<br>&#125;<br>&lt;/script&gt;<br><br><span class=\"language-xml\"><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">template</span>&gt;</span></span><br><span class=\"language-xml\">  <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">component</span> <span class=\"hljs-attr\">:is</span>=<span class=\"hljs-string\">&quot;view&quot;</span> /&gt;</span></span><br><span class=\"language-xml\"><span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">template</span>&gt;</span></span><br></code></pre></td></tr></table></figure>\n\n<p>按定义渲染组件 <code>&lt;script setup&gt; 组合式 API</code>：</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\">&lt;component :is=<span class=\"hljs-string\">&quot;Math.random() &gt; 0.5 ? Foo : Bar&quot;</span> /&gt;<br></code></pre></td></tr></table></figure>\n\n<p>渲染 HTML 元素</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\">&lt;component :is=<span class=\"hljs-string\">&quot;href ? &#x27;a&#x27; : &#x27;span&#x27;&quot;</span>&gt;&lt;/component&gt;<br></code></pre></td></tr></table></figure>\n\n<h1 id=\"插槽\"><a href=\"#插槽\" class=\"headerlink\" title=\"插槽\"></a>插槽</h1><p>默认插槽、具名插槽。</p>\n<p>作用域插槽：<code>:headerName=&quot;&#39;我是头部&#39;&quot;</code>，父组件可以通过 <code>v-slot=&quot;&#123; headerName &#125;&quot;</code> 拿到组件内部暴露出来的数据</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\"><span class=\"hljs-comment\">// SlotComp.vue</span><br>&lt;template&gt;<br>  <span class=\"language-xml\"><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">div</span> <span class=\"hljs-attr\">class</span>=<span class=\"hljs-string\">&quot;slot-wrapper&quot;</span>&gt;</span></span><br><span class=\"language-xml\">    <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">header</span> <span class=\"hljs-attr\">class</span>=<span class=\"hljs-string\">&quot;header&quot;</span>&gt;</span></span><br><span class=\"language-xml\">      <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">slot</span> <span class=\"hljs-attr\">name</span>=<span class=\"hljs-string\">&quot;header&quot;</span> <span class=\"hljs-attr\">:headerName</span>=<span class=\"hljs-string\">&quot;&#x27;我是头部&#x27;&quot;</span>&gt;</span><span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">slot</span>&gt;</span></span><br><span class=\"language-xml\">    <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">header</span>&gt;</span></span><br><span class=\"language-xml\">    <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">main</span> <span class=\"hljs-attr\">class</span>=<span class=\"hljs-string\">&quot;content&quot;</span>&gt;</span></span><br><span class=\"language-xml\">      <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">slot</span>&gt;</span><span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">slot</span>&gt;</span></span><br><span class=\"language-xml\">    <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">main</span>&gt;</span></span><br><span class=\"language-xml\">    <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">footer</span> <span class=\"hljs-attr\">class</span>=<span class=\"hljs-string\">&quot;footer&quot;</span>&gt;</span></span><br><span class=\"language-xml\">      <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">slot</span> <span class=\"hljs-attr\">name</span>=<span class=\"hljs-string\">&quot;footer&quot;</span>&gt;</span><span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">slot</span>&gt;</span></span><br><span class=\"language-xml\">    <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">footer</span>&gt;</span></span><br><span class=\"language-xml\">  <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">div</span>&gt;</span></span><br>&lt;/template&gt;<br></code></pre></td></tr></table></figure>\n\n<p>使用具有插槽的组件，<code>headerName</code> 是作用域插槽从内部提供的</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\">&lt;<span class=\"hljs-title class_\">SlotComp</span>&gt;<br>  <span class=\"language-xml\"><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">template</span> <span class=\"hljs-attr\">v-slot:header</span>=<span class=\"hljs-string\">&quot;&#123; headerName &#125;&quot;</span>&gt;</span>&#123;&#123; headerName &#125;&#125;<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">template</span>&gt;</span></span><br>  <span class=\"language-xml\"><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">template</span> <span class=\"hljs-attr\">v-slot</span>&gt;</span>default slot<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">template</span>&gt;</span></span><br>  <span class=\"language-xml\"><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">template</span> <span class=\"hljs-attr\">v-slot:footer</span>&gt;</span>footer<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">template</span>&gt;</span></span><br>&lt;/<span class=\"hljs-title class_\">SlotComp</span>&gt;<br></code></pre></td></tr></table></figure>\n\n<p><strong>插槽简写方式 #</strong></p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\">&lt;<span class=\"hljs-title class_\">SlotComp</span>&gt;<br>  <span class=\"language-xml\"><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">template</span> #<span class=\"hljs-attr\">header</span>=<span class=\"hljs-string\">&quot;&#123; headerName &#125;&quot;</span>&gt;</span>&#123;&#123; headerName &#125;&#125;<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">template</span>&gt;</span></span><br>  <span class=\"language-xml\"><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">template</span> #<span class=\"hljs-attr\">default</span>&gt;</span>default slot<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">template</span>&gt;</span></span><br>  <span class=\"language-xml\"><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">template</span> #<span class=\"hljs-attr\">footer</span>&gt;</span>footer<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">template</span>&gt;</span></span><br>&lt;/<span class=\"hljs-title class_\">SlotComp</span>&gt;<br></code></pre></td></tr></table></figure>\n\n<p><strong>动态插槽</strong></p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\">&lt;<span class=\"hljs-title class_\">SlotComp</span>&gt;<br>  <span class=\"language-xml\"><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">template</span> #[<span class=\"hljs-attr\">slotName</span>]&gt;</span>动态插槽<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">template</span>&gt;</span></span><br>&lt;/<span class=\"hljs-title class_\">SlotComp</span>&gt;<br><br><br><span class=\"hljs-comment\">// js</span><br><span class=\"hljs-keyword\">const</span> slotName = <span class=\"hljs-title function_\">ref</span>(<span class=\"hljs-string\">&#x27;header&#x27;</span>)<br></code></pre></td></tr></table></figure>\n\n<h1 id=\"异步组件\"><a href=\"#异步组件\" class=\"headerlink\" title=\"异步组件\"></a>异步组件</h1><p><a href=\"https://cn.vuejs.org/guide/components/async.html#basic-usage\">官方描述</a></p>\n<blockquote>\n<p>在大型项目中，我们可能需要拆分应用为更小的块，并仅在需要时再从服务器加载相关组件。Vue 提供了 <code>defineAsyncComponent</code> 方法来实现此功能：</p>\n</blockquote>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\"><span class=\"hljs-keyword\">import</span> &#123; defineAsyncComponent &#125; <span class=\"hljs-keyword\">from</span> <span class=\"hljs-string\">&#x27;vue&#x27;</span><br><br><span class=\"hljs-keyword\">const</span> <span class=\"hljs-title class_\">AsyncComp</span> = <span class=\"hljs-title function_\">defineAsyncComponent</span>(<span class=\"hljs-function\">() =&gt;</span> &#123;<br>  <span class=\"hljs-keyword\">return</span> <span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">Promise</span>(<span class=\"hljs-function\">(<span class=\"hljs-params\">resolve, reject</span>) =&gt;</span> &#123;<br>    <span class=\"hljs-comment\">// ...从服务器获取组件</span><br>    <span class=\"hljs-title function_\">resolve</span>(<span class=\"hljs-comment\">/* 获取到的组件 */</span>)<br>  &#125;)<br>&#125;)<br></code></pre></td></tr></table></figure>\n\n<p><code>ES 模块动态导入</code> 也会返回一个 Promise，所以多数情况下我们会将它和 defineAsyncComponent 搭配使用。类似 Vite 和 Webpack 这样的构建工具也支持此语法 (并且会将它们作为打包时的代码分割点  <code>分包、性能优化</code>)</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\"><span class=\"hljs-keyword\">import</span> &#123; defineAsyncComponent &#125; <span class=\"hljs-keyword\">from</span> <span class=\"hljs-string\">&#x27;vue&#x27;</span><br><br><span class=\"hljs-keyword\">const</span> <span class=\"hljs-title class_\">AsyncComp</span> = <span class=\"hljs-title function_\">defineAsyncComponent</span>(<span class=\"hljs-function\">() =&gt;</span><br>  <span class=\"hljs-title function_\">import</span>(<span class=\"hljs-string\">&#x27;./components/MyComponent.vue&#x27;</span>)<br>)<br></code></pre></td></tr></table></figure>\n\n<p>最后得到的 AsyncComp 是一个外层包装过的组件，<code>仅在页面需要它渲染时</code> 才会调用加载内部实际组件的函数。</p>\n<h2 id=\"顶层-await\"><a href=\"#顶层-await\" class=\"headerlink\" title=\"顶层 await\"></a>顶层 await</h2><p><code>&lt;script setup&gt;</code> 中可以使用顶层 await。结果代码会被编译成 <code>async setup()</code>：</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\">&lt;script setup&gt;<br><span class=\"hljs-keyword\">const</span> post = <span class=\"hljs-keyword\">await</span> <span class=\"hljs-title function_\">fetch</span>(<span class=\"hljs-string\">`/api/post/1`</span>).<span class=\"hljs-title function_\">then</span>(<span class=\"hljs-function\">(<span class=\"hljs-params\">r</span>) =&gt;</span> r.<span class=\"hljs-title function_\">json</span>())<br>&lt;/script&gt;<br></code></pre></td></tr></table></figure>\n\n<h2 id=\"搭配-Suspense-组件使用\"><a href=\"#搭配-Suspense-组件使用\" class=\"headerlink\" title=\"搭配 Suspense 组件使用\"></a>搭配 Suspense 组件使用</h2><ol>\n<li>定义异步组件 Sync.vue</li>\n</ol>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\">&lt;template&gt;<br>  <span class=\"language-xml\"><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">div</span>&gt;</span></span><br><span class=\"language-xml\">    Name: &#123;&#123; name &#125;&#125;</span><br><span class=\"language-xml\">  <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">div</span>&gt;</span></span><br>&lt;/template&gt;<br><br><span class=\"language-xml\"><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">script</span> <span class=\"hljs-attr\">setup</span> <span class=\"hljs-attr\">lang</span>=<span class=\"hljs-string\">&#x27;ts&#x27;</span>&gt;</span><span class=\"language-javascript\"></span></span><br><span class=\"language-javascript\"><span class=\"language-xml\"><span class=\"hljs-keyword\">import</span> &#123;ref, reactive&#125; <span class=\"hljs-keyword\">from</span> <span class=\"hljs-string\">&#x27;vue&#x27;</span></span></span><br><span class=\"language-javascript\"><span class=\"language-xml\"><span class=\"hljs-keyword\">import</span> iTools <span class=\"hljs-keyword\">from</span> <span class=\"hljs-string\">&#x27;@/utils/Tools&#x27;</span></span></span><br><span class=\"language-javascript\"><span class=\"language-xml\"></span></span><br><span class=\"language-javascript\"><span class=\"language-xml\"><span class=\"hljs-keyword\">const</span> name = <span class=\"hljs-title function_\">ref</span>(<span class=\"hljs-string\">&#x27;&#x27;</span>)</span></span><br><span class=\"language-javascript\"><span class=\"language-xml\"><span class=\"hljs-keyword\">const</span> &#123; data &#125; = <span class=\"hljs-keyword\">await</span> iTools.<span class=\"hljs-property\">Axios</span>.<span class=\"hljs-title function_\">get</span>(<span class=\"hljs-string\">&#x27;./sync-data.json&#x27;</span>) <span class=\"hljs-comment\">// 定义在 public 下的json文件</span></span></span><br><span class=\"language-javascript\"><span class=\"language-xml\">name.<span class=\"hljs-property\">value</span> = data.<span class=\"hljs-property\">name</span></span></span><br><span class=\"language-javascript\"><span class=\"language-xml\"></span></span><br><span class=\"language-javascript\"><span class=\"language-xml\"></span><span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">script</span>&gt;</span></span><br></code></pre></td></tr></table></figure>\n\n<ol start=\"2\">\n<li>通过 <code>defineAsyncComponent</code> 动态导入 <code>Sync.vue</code> 组件</li>\n</ol>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\"><span class=\"hljs-keyword\">const</span> <span class=\"hljs-title class_\">Sync</span> = <span class=\"hljs-title function_\">defineAsyncComponent</span>(<span class=\"hljs-function\">() =&gt;</span> <span class=\"hljs-title function_\">import</span>(<span class=\"hljs-string\">&#x27;@/components/Sync.vue&#x27;</span>))<br></code></pre></td></tr></table></figure>\n\n<ol start=\"3\">\n<li>使用 <code>Suspense</code> 内置组件</li>\n</ol>\n<p>在请求过程中，会一直显示 loading… 状态，真实项目中我们可以替换成骨架屏。当接口请求成功，才会显示 <code>Sync.vue</code> 的内容。</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\">&lt;<span class=\"hljs-title class_\">Suspense</span>&gt;<br>  <span class=\"language-xml\"><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">template</span> #<span class=\"hljs-attr\">default</span>&gt;</span></span><br><span class=\"language-xml\">    <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">Sync</span> /&gt;</span></span><br><span class=\"language-xml\">  <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">template</span>&gt;</span></span><br><br>  <span class=\"language-xml\"><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">template</span> #<span class=\"hljs-attr\">fallback</span>&gt;</span></span><br><span class=\"language-xml\">    Loading...</span><br><span class=\"language-xml\">  <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">template</span>&gt;</span></span><br>&lt;/<span class=\"hljs-title class_\">Suspense</span>&gt;<br></code></pre></td></tr></table></figure>\n\n<h2 id=\"性能优化\"><a href=\"#性能优化\" class=\"headerlink\" title=\"性能优化\"></a>性能优化</h2><p>当我们使用了 defineAsyncComponent 动态导入组件，build 项目时，会单独将 Sync.vue 的 js 包拎出来，不会将其打包到index.js 中，通过拆包的方式，减少入口文件的大小，从而减少白屏的时间。</p>\n<h1 id=\"Teleport-传送门\"><a href=\"#Teleport-传送门\" class=\"headerlink\" title=\"Teleport 传送门\"></a>Teleport 传送门</h1><p>将其插槽内容渲染到 DOM 中的另一个位置。</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\">interface <span class=\"hljs-title class_\">TeleportProps</span> &#123;<br>  <span class=\"hljs-comment\">/**</span><br><span class=\"hljs-comment\">   * 必填项。指定目标容器。</span><br><span class=\"hljs-comment\">   * 可以是选择器或实际元素。</span><br><span class=\"hljs-comment\">   */</span><br>  <span class=\"hljs-attr\">to</span>: string | <span class=\"hljs-title class_\">HTMLElement</span><br>  <span class=\"hljs-comment\">/**</span><br><span class=\"hljs-comment\">   * 当值为 `true` 时，内容将保留在其原始位置</span><br><span class=\"hljs-comment\">   * 而不是移动到目标容器中。</span><br><span class=\"hljs-comment\">   * 可以动态更改。</span><br><span class=\"hljs-comment\">   */</span><br>  disabled?: boolean<br>&#125;<br><br><span class=\"hljs-comment\">// examples</span><br>&lt;teleport to=<span class=\"hljs-string\">&quot;#some-id&quot;</span> /&gt;<br><span class=\"language-xml\"><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">teleport</span> <span class=\"hljs-attr\">to</span>=<span class=\"hljs-string\">&quot;.some-class&quot;</span> /&gt;</span></span><br><span class=\"language-xml\"><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">teleport</span> <span class=\"hljs-attr\">to</span>=<span class=\"hljs-string\">&quot;[data-teleport]&quot;</span> /&gt;</span></span><br><span class=\"language-xml\"><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">teleport</span> <span class=\"hljs-attr\">to</span>=<span class=\"hljs-string\">&quot;body&quot;</span> /&gt;</span></span><br></code></pre></td></tr></table></figure>\n\n<h1 id=\"Mitt\"><a href=\"#Mitt\" class=\"headerlink\" title=\"Mitt\"></a>Mitt</h1><p>Vue 2可以支持$on，$off来实现event bus，但是 Vue3 已经不支持这些属性，不过Vue 3可以支持第三方event bus来实现事件通信，</p>\n<p>这里使用 <code>mitt</code>，官方地址：<a href=\"https://github.com/developit/mitt\">https://github.com/developit/mitt</a></p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\"><span class=\"hljs-keyword\">import</span> mitt <span class=\"hljs-keyword\">from</span> <span class=\"hljs-string\">&#x27;mitt&#x27;</span><br><br><span class=\"hljs-comment\">// vue3挂载到全局</span><br>app.<span class=\"hljs-property\">config</span>.<span class=\"hljs-property\">globalProperties</span>.<span class=\"hljs-property\">$mitt</span> = <span class=\"hljs-title function_\">mitt</span>()<br></code></pre></td></tr></table></figure>\n\n<h1 id=\"tsx\"><a href=\"#tsx\" class=\"headerlink\" title=\"tsx\"></a>tsx</h1><blockquote>\n<p>安装插件 npm install @vitejs/plugin-vue-jsx -D</p>\n</blockquote>\n<p>安装如果失败，将 node 版本切换至 v14.16.0</p>\n<p>使用插件</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\"><span class=\"hljs-keyword\">import</span> vueJsx <span class=\"hljs-keyword\">from</span> <span class=\"hljs-string\">&quot;@vitejs/plugin-vue-jsx&quot;</span>;<br><br><span class=\"hljs-keyword\">export</span> <span class=\"hljs-keyword\">default</span> <span class=\"hljs-title function_\">defineConfig</span>(&#123;<br>  <span class=\"hljs-attr\">plugins</span>: [<span class=\"hljs-title function_\">vue</span>(), <span class=\"hljs-title function_\">vueJsx</span>()],<br>  <span class=\"hljs-comment\">// ...</span><br>&#125;)<br></code></pre></td></tr></table></figure>\n\n<p>但是导入 .tsx 文件，TypeScript 会报错：</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\"><span class=\"hljs-comment\">// 找不到模块“@/components/Foo”或其相应的类型声明。</span><br><span class=\"hljs-keyword\">import</span> <span class=\"hljs-title class_\">Foo</span> <span class=\"hljs-keyword\">from</span> <span class=\"hljs-string\">&#x27;@/components/Foo&#x27;</span> <span class=\"hljs-comment\">// 省略了 .tsx 后缀</span><br><br><span class=\"hljs-comment\">// 导入路径不能以“.tsx”扩展名结束。考虑改为导入“@/components/Bar.js”。</span><br><span class=\"hljs-keyword\">import</span> <span class=\"hljs-title class_\">Bar</span> <span class=\"hljs-keyword\">from</span> <span class=\"hljs-string\">&#x27;@/components/Bar.tsx&#x27;</span><br></code></pre></td></tr></table></figure>\n\n<p>配置 <code>tsconfig.json</code>:</p>\n<figure class=\"highlight json\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs json\"><span class=\"hljs-punctuation\">&#123;</span><br>  <span class=\"hljs-attr\">&quot;compilerOptions&quot;</span><span class=\"hljs-punctuation\">:</span> <span class=\"hljs-punctuation\">&#123;</span><br>    <span class=\"hljs-attr\">&quot;baseUrl&quot;</span><span class=\"hljs-punctuation\">:</span> <span class=\"hljs-string\">&quot;.&quot;</span><span class=\"hljs-punctuation\">,</span><br>    <span class=\"hljs-attr\">&quot;paths&quot;</span><span class=\"hljs-punctuation\">:</span> <span class=\"hljs-punctuation\">&#123;</span><br>      <span class=\"hljs-attr\">&quot;@/*&quot;</span><span class=\"hljs-punctuation\">:</span> <span class=\"hljs-punctuation\">[</span><span class=\"hljs-string\">&quot;src/*&quot;</span><span class=\"hljs-punctuation\">]</span><br>    <span class=\"hljs-punctuation\">&#125;</span><span class=\"hljs-punctuation\">,</span><br>  <span class=\"hljs-punctuation\">&#125;</span><br><span class=\"hljs-punctuation\">&#125;</span><br></code></pre></td></tr></table></figure>\n\n<p>之后我们导入 tsx 类型的组件，就不要带上后缀了。</p>\n<p><strong>编写 tsx 组件的3中方式</strong></p>\n<ol>\n<li><p>函数模式</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\"><span class=\"hljs-keyword\">export</span> <span class=\"hljs-keyword\">default</span> <span class=\"hljs-keyword\">function</span>(<span class=\"hljs-params\"></span>) &#123;<br>  <span class=\"hljs-keyword\">return</span> (<br>    <span class=\"language-xml\"><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">h1</span>&gt;</span>TSX componen111t<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">h1</span>&gt;</span></span><br>  )<br>&#125;<br></code></pre></td></tr></table></figure>\n</li>\n<li><p>options API 模式</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\"><span class=\"hljs-keyword\">import</span> &#123; defineComponent &#125; <span class=\"hljs-keyword\">from</span> <span class=\"hljs-string\">&#x27;vue&#x27;</span><br><br><span class=\"hljs-keyword\">export</span> <span class=\"hljs-keyword\">default</span> <span class=\"hljs-title function_\">defineComponent</span>(&#123;<br>  <span class=\"hljs-title function_\">data</span>(<span class=\"hljs-params\"></span>) &#123;<br>    <span class=\"hljs-keyword\">return</span> &#123;<br>      <span class=\"hljs-attr\">compname</span>: <span class=\"hljs-string\">&#x27;jsx comp&#x27;</span><br>    &#125;<br>  &#125;,<br>  <span class=\"hljs-title function_\">render</span>(<span class=\"hljs-params\"></span>) &#123;<br>    <span class=\"hljs-keyword\">return</span> (<br>      <span class=\"language-xml\"><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">div</span>&gt;</span>&#123;this.compname&#125;<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">div</span>&gt;</span></span><br>    )<br>  &#125;<br>&#125;)<br></code></pre></td></tr></table></figure>\n</li>\n<li><p>setup 函数模式</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\"><br>interface <span class=\"hljs-title class_\">IProps</span> &#123;<br>  name?: string;<br>&#125;<br><br><span class=\"hljs-keyword\">export</span> <span class=\"hljs-keyword\">default</span> <span class=\"hljs-title function_\">defineComponent</span>(&#123;<br>  <span class=\"hljs-attr\">props</span>: &#123;<br>    <span class=\"hljs-attr\">name</span>: <span class=\"hljs-title class_\">String</span>,<br>  &#125;,<br>  <span class=\"hljs-attr\">emits</span>: [<span class=\"hljs-string\">&#x27;on-click&#x27;</span>],<br>  <span class=\"hljs-title function_\">setup</span>(<span class=\"hljs-params\">props: IProps</span>) &#123;<br>    <span class=\"hljs-keyword\">const</span> is = <span class=\"hljs-literal\">true</span><br>    <span class=\"hljs-comment\">// 返回渲染函数</span><br>    <span class=\"hljs-keyword\">return</span> <span class=\"hljs-function\">() =&gt;</span> &#123;<br>      <span class=\"hljs-keyword\">return</span> (<br>        <span class=\"language-xml\"><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">h1</span> <span class=\"hljs-attr\">v-show</span>=<span class=\"hljs-string\">&#123;is&#125;</span>&gt;</span>setup 渲染函数 &#123;props?.name&#125;<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">h1</span>&gt;</span></span><br>      )<br>    &#125;<br>  &#125;<br>&#125;)<br></code></pre></td></tr></table></figure>\n\n</li>\n</ol>\n<h2 id=\"tsx-slot-使用\"><a href=\"#tsx-slot-使用\" class=\"headerlink\" title=\"tsx slot 使用\"></a>tsx slot 使用</h2><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\"><span class=\"hljs-keyword\">const</span> <span class=\"hljs-title function_\">Foo</span> = (<span class=\"hljs-params\">_, &#123; slots &#125;</span>) =&gt; &#123;<br>  <br>  <span class=\"hljs-keyword\">return</span> (<span class=\"language-xml\"><span class=\"hljs-tag\">&lt;&gt;</span></span><br><span class=\"language-xml\">    <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">p</span>&gt;</span>&#123; slots?.header?.()&#125;<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">p</span>&gt;</span></span><br><span class=\"language-xml\">    <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">h3</span>&gt;</span>slot comp<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">h3</span>&gt;</span></span><br><span class=\"language-xml\">    <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">p</span>&gt;</span>&#123; slots.default ? slots.default() : &#x27;默认插槽&#x27; &#125;<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">p</span>&gt;</span></span><br><span class=\"language-xml\">  <span class=\"hljs-tag\">&lt;/&gt;</span></span>)<br>&#125;<br><br><br>&lt;<span class=\"hljs-title class_\">Foo</span> v-slots=&#123;&#123;<br>  <span class=\"hljs-title function_\">default</span>(<span class=\"hljs-params\"></span>) &#123;<br>    <span class=\"hljs-keyword\">return</span> <span class=\"hljs-string\">&#x27;setup default slot&#x27;</span><br>  &#125;,<br>  <span class=\"hljs-title function_\">header</span>(<span class=\"hljs-params\"></span>) &#123;<br>    <span class=\"hljs-keyword\">return</span> <span class=\"hljs-string\">&#x27;header&#x27;</span><br>  &#125;<br>&#125;&#125; /&gt;<br><br></code></pre></td></tr></table></figure>\n\n<h1 id=\"自动引入\"><a href=\"#自动引入\" class=\"headerlink\" title=\"自动引入\"></a>自动引入</h1><blockquote>\n<p>安装插件 unplugin-auto-import/vite  <a href=\"https://github.com/antfu/unplugin-auto-import\">https://github.com/antfu/unplugin-auto-import</a></p>\n</blockquote>\n<p>注册完 plugin 之后，不再引入 <code>ref, reactive</code> 等等方法了，直接使用即可。</p>\n<h1 id=\"v-model\"><a href=\"#v-model\" class=\"headerlink\" title=\"v-model\"></a>v-model</h1><blockquote>\n<p>官网：<a href=\"https://cn.vuejs.org/guide/components/events.html\">https://cn.vuejs.org/guide/components/events.html</a></p>\n</blockquote>\n<p>v-model 在原生元素上的用法：</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\">&lt;input v-model=<span class=\"hljs-string\">&quot;searchText&quot;</span> /&gt;<br><br><span class=\"hljs-comment\">// 等价于</span><br><br><span class=\"language-xml\"><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">input</span></span></span><br><span class=\"hljs-tag\"><span class=\"language-xml\">  <span class=\"hljs-attr\">:value</span>=<span class=\"hljs-string\">&quot;searchText&quot;</span></span></span><br><span class=\"hljs-tag\"><span class=\"language-xml\">  @<span class=\"hljs-attr\">input</span>=<span class=\"hljs-string\">&quot;searchText = $event.target.value&quot;</span></span></span><br><span class=\"hljs-tag\"><span class=\"language-xml\">/&gt;</span></span><br></code></pre></td></tr></table></figure>\n\n<p>而当使用在一个组件上时，v-model 会被展开为如下的形式：</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\">&lt;<span class=\"hljs-title class_\">CustomInput</span><br>  :modelValue=<span class=\"hljs-string\">&quot;searchText&quot;</span><br>  @<span class=\"hljs-attr\">update</span>:modelValue=<span class=\"hljs-string\">&quot;newValue =&gt; searchText = newValue&quot;</span><br>/&gt;<br><br><br><span class=\"hljs-comment\">// 内部定义 props 和 方法</span><br><br><span class=\"hljs-keyword\">const</span> props = defineProps&lt;&#123;<br>  <span class=\"hljs-attr\">modelValue</span>: boolean<br>&#125;&gt;()<br><br><span class=\"hljs-keyword\">const</span> emits = <span class=\"hljs-title function_\">defineEmits</span>([<span class=\"hljs-string\">&#x27;update:modelValue&#x27;</span>])<br><br><br><span class=\"hljs-comment\">// 调用</span><br><span class=\"hljs-title function_\">emits</span>(<span class=\"hljs-string\">&#x27;update:modelValue&#x27;</span>, !props.<span class=\"hljs-property\">modelValue</span>)<br><br></code></pre></td></tr></table></figure>\n\n<p>当然，我们也可以给 <code>v-model</code> 指定一个参数，不使用默认的 <code>modelValue</code>:</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\">&lt;<span class=\"hljs-title class_\">MyComponent</span> v-<span class=\"hljs-attr\">model</span>:title=<span class=\"hljs-string\">&quot;bookTitle&quot;</span> /&gt;<br><br><span class=\"hljs-comment\">// 定义 props</span><br><span class=\"hljs-title function_\">defineProps</span>([<span class=\"hljs-string\">&#x27;title&#x27;</span>])<br><span class=\"hljs-title function_\">defineEmits</span>([<span class=\"hljs-string\">&#x27;update:title&#x27;</span>])<br></code></pre></td></tr></table></figure>\n\n<p>我们还可以绑定多个 v-model:</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\">&lt;<span class=\"hljs-title class_\">UserName</span><br>  v-<span class=\"hljs-attr\">model</span>:first-name=<span class=\"hljs-string\">&quot;first&quot;</span><br>  v-<span class=\"hljs-attr\">model</span>:last-name=<span class=\"hljs-string\">&quot;last&quot;</span><br>/&gt;<br></code></pre></td></tr></table></figure>\n\n<h1 id=\"自定义指令\"><a href=\"#自定义指令\" class=\"headerlink\" title=\"自定义指令\"></a>自定义指令</h1><blockquote>\n<p><a href=\"https://cn.vuejs.org/guide/reusability/custom-directives.html\">https://cn.vuejs.org/guide/reusability/custom-directives.html</a></p>\n</blockquote>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\"><span class=\"hljs-keyword\">const</span> myDirective = &#123;<br>  <span class=\"hljs-comment\">// 在绑定元素的 attribute 前</span><br>  <span class=\"hljs-comment\">// 或事件监听器应用前调用</span><br>  <span class=\"hljs-title function_\">created</span>(<span class=\"hljs-params\">el, binding, vnode, prevVnode</span>) &#123;&#125;,<br>  <span class=\"hljs-comment\">// 在元素被插入到 DOM 前调用</span><br>  <span class=\"hljs-title function_\">beforeMount</span>(<span class=\"hljs-params\">el, binding, vnode, prevVnode</span>) &#123;&#125;,<br>  <span class=\"hljs-comment\">// 在绑定元素的父组件</span><br>  <span class=\"hljs-comment\">// 及他自己的所有子节点都挂载完成后调用</span><br>  <span class=\"hljs-title function_\">mounted</span>(<span class=\"hljs-params\">el, binding, vnode, prevVnode</span>) &#123;&#125;,<br>  <span class=\"hljs-comment\">// 绑定元素的父组件更新前调用</span><br>  <span class=\"hljs-title function_\">beforeUpdate</span>(<span class=\"hljs-params\">el, binding, vnode, prevVnode</span>) &#123;&#125;,<br>  <span class=\"hljs-comment\">// 在绑定元素的父组件</span><br>  <span class=\"hljs-comment\">// 及他自己的所有子节点都更新后调用</span><br>  <span class=\"hljs-title function_\">updated</span>(<span class=\"hljs-params\">el, binding, vnode, prevVnode</span>) &#123;&#125;,<br>  <span class=\"hljs-comment\">// 绑定元素的父组件卸载前调用</span><br>  <span class=\"hljs-title function_\">beforeUnmount</span>(<span class=\"hljs-params\">el, binding, vnode, prevVnode</span>) &#123;&#125;,<br>  <span class=\"hljs-comment\">// 绑定元素的父组件卸载后调用</span><br>  <span class=\"hljs-title function_\">unmounted</span>(<span class=\"hljs-params\">el, binding, vnode, prevVnode</span>) &#123;&#125;<br>&#125;<br></code></pre></td></tr></table></figure>\n\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\">&lt;div v-<span class=\"hljs-attr\">example</span>:foo.<span class=\"hljs-property\">bar</span>=<span class=\"hljs-string\">&quot;baz&quot;</span>&gt;<br><br><span class=\"hljs-comment\">// binding 参数会是一个这样的对象：</span><br>&#123;<br>  <span class=\"hljs-attr\">arg</span>: <span class=\"hljs-string\">&#x27;foo&#x27;</span>,<br>  <span class=\"hljs-attr\">modifiers</span>: &#123; <span class=\"hljs-attr\">bar</span>: <span class=\"hljs-literal\">true</span> &#125;,<br>  <span class=\"hljs-attr\">value</span>: <span class=\"hljs-comment\">/* `baz` 的值 */</span>,<br>  <span class=\"hljs-attr\">oldValue</span>: <span class=\"hljs-comment\">/* 上一次更新时 `baz` 的值 */</span><br>&#125;<br></code></pre></td></tr></table></figure>\n\n<h1 id=\"全局函数或变量\"><a href=\"#全局函数或变量\" class=\"headerlink\" title=\"全局函数或变量\"></a>全局函数或变量</h1><p>在 Vue2 中，我们经常将全局用到的函数定义在 Vue 的 prototype 上，在 Vue3 中已经不这样使用了:</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\"><span class=\"hljs-keyword\">const</span> app = <span class=\"hljs-title function_\">createApp</span>(<span class=\"hljs-title class_\">App</span>)<br><br><br>app.<span class=\"hljs-property\">config</span>.<span class=\"hljs-property\">globalProperties</span>.<span class=\"hljs-property\">$env</span> = <span class=\"hljs-string\">&#x27;dev&#x27;</span><br>app.<span class=\"hljs-property\">config</span>.<span class=\"hljs-property\">globalProperties</span>.<span class=\"hljs-property\">$filters</span> = &#123;<br>  format&lt;T&gt;(<span class=\"hljs-attr\">str</span>: T): string &#123;<br>    <span class=\"hljs-keyword\">return</span> str.<span class=\"hljs-title function_\">trim</span>()<br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure>\n\n<p>我们使用的时候，不需要导入什么，直接在 .vue 文件使用即可:</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\">&lt;div&gt;env &#123;&#123;$env&#125;&#125;&lt;/div&gt;<br><br><br><span class=\"language-xml\"><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">script</span> <span class=\"hljs-attr\">setup</span> <span class=\"hljs-attr\">lang</span>=<span class=\"hljs-string\">&quot;ts&quot;</span>&gt;</span><span class=\"language-javascript\"></span></span><br><span class=\"language-javascript\"><span class=\"language-xml\">  <span class=\"hljs-keyword\">const</span> app = <span class=\"hljs-title function_\">getCurrentInstance</span>()</span></span><br><span class=\"language-javascript\"><span class=\"language-xml\"></span></span><br><span class=\"language-javascript\"><span class=\"language-xml\">  <span class=\"hljs-variable language_\">console</span>.<span class=\"hljs-title function_\">log</span>(app?.<span class=\"hljs-property\">proxy</span>?.<span class=\"hljs-property\">$filters</span>.<span class=\"hljs-title function_\">format</span>(<span class=\"hljs-string\">&#x27;getCurrentInstance&#x27;</span>))</span></span><br><span class=\"language-javascript\"><span class=\"language-xml\"></span><span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">script</span>&gt;</span></span><br></code></pre></td></tr></table></figure>\n\n\n<p>在组件中使用全局的变量或者函数时，会出现 ts 报错，这时我们需要去声明它的类型:</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\">declare <span class=\"hljs-variable language_\">module</span> <span class=\"hljs-string\">&#x27;vue&#x27;</span> &#123;<br>  <span class=\"hljs-keyword\">export</span> interface <span class=\"hljs-title class_\">ComponentCustomProperties</span> &#123;<br>    <span class=\"hljs-attr\">$filters</span>: &#123;<br>      format&lt;T&gt;(<span class=\"hljs-attr\">str</span>: T): string,<br>    &#125;,<br>    <span class=\"hljs-attr\">$env</span>: string,<br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure>\n\n<h1 id=\"自定义插件\"><a href=\"#自定义插件\" class=\"headerlink\" title=\"自定义插件\"></a>自定义插件</h1><blockquote>\n<p>一个插件可以是一个拥有 install() 方法的对象，也可以直接是一个安装函数本身。</p>\n</blockquote>\n<p>插件没有严格定义的使用范围，但是插件发挥作用的常见场景主要包括以下几种：</p>\n<ol>\n<li><p>通过 app.component() 和 app.directive() 注册一到多个全局组件或自定义指令。</p>\n</li>\n<li><p>通过 app.provide() 使一个资源可被注入进整个应用。</p>\n</li>\n<li><p>向 app.config.globalProperties 中添加一些全局实例属性或方法</p>\n</li>\n</ol>\n<p>以一个全局的 <code>Loading</code> 组件为例：</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\"><span class=\"hljs-comment\">// Loading/index.ts</span><br><br><span class=\"hljs-keyword\">import</span> type &#123; <span class=\"hljs-title class_\">App</span>, <span class=\"hljs-title class_\">VNode</span> &#125; <span class=\"hljs-keyword\">from</span> <span class=\"hljs-string\">&#x27;vue&#x27;</span><br><span class=\"hljs-keyword\">import</span> &#123; createVNode, render &#125; <span class=\"hljs-keyword\">from</span> <span class=\"hljs-string\">&#x27;vue&#x27;</span><br><span class=\"hljs-keyword\">import</span> <span class=\"hljs-title class_\">Loading</span> <span class=\"hljs-keyword\">from</span> <span class=\"hljs-string\">&#x27;./index.vue&#x27;</span><br><br><span class=\"hljs-keyword\">export</span> <span class=\"hljs-keyword\">default</span> &#123;<br>  install (<span class=\"hljs-attr\">app</span>: <span class=\"hljs-title class_\">App</span>) &#123;<br>    <span class=\"hljs-comment\">// Loading 需要转成 VNode</span><br>    <span class=\"hljs-keyword\">const</span> <span class=\"hljs-title class_\">VNode</span>: <span class=\"hljs-title class_\">VNode</span> = <span class=\"hljs-title function_\">createVNode</span>(<span class=\"hljs-title class_\">Loading</span>)<br><br>    <span class=\"hljs-comment\">// 将组件挂在到某个元素下</span><br>    <span class=\"hljs-title function_\">render</span>(<span class=\"hljs-title class_\">VNode</span>, <span class=\"hljs-variable language_\">document</span>.<span class=\"hljs-property\">body</span>)<br><br>    <span class=\"hljs-comment\">// Loading 组件通过 defineExpose 方法，暴露内部方法会在 exposed 字段上</span><br><br>    app.<span class=\"hljs-property\">config</span>.<span class=\"hljs-property\">globalProperties</span>.<span class=\"hljs-property\">$loading</span> = &#123;<br>      <span class=\"hljs-attr\">onShow</span>: <span class=\"hljs-title class_\">VNode</span>.<span class=\"hljs-property\">component</span>?.<span class=\"hljs-property\">exposed</span>?.<span class=\"hljs-property\">onShow</span>,<br>      <span class=\"hljs-attr\">onHide</span>: <span class=\"hljs-title class_\">VNode</span>.<span class=\"hljs-property\">component</span>?.<span class=\"hljs-property\">exposed</span>?.<span class=\"hljs-property\">onHide</span><br>    &#125;<br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure>\n\n<p>Loading 组件内部实现</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\">&lt;template&gt;<br>  <span class=\"language-xml\"><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">div</span> <span class=\"hljs-attr\">class</span>=<span class=\"hljs-string\">&quot;loading&quot;</span> <span class=\"hljs-attr\">v-if</span>=<span class=\"hljs-string\">&quot;show&quot;</span> @<span class=\"hljs-attr\">click</span>=<span class=\"hljs-string\">&quot;onHide&quot;</span>&gt;</span></span><br><span class=\"language-xml\">    <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">img</span> <span class=\"hljs-attr\">src</span>=<span class=\"hljs-string\">&quot;../../assets/imgs/loading.gif&quot;</span> <span class=\"hljs-attr\">alt</span>=<span class=\"hljs-string\">&quot;&quot;</span> /&gt;</span></span><br><span class=\"language-xml\">  <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">div</span>&gt;</span></span><br>&lt;/template&gt;<br><br><span class=\"language-xml\"><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">script</span> <span class=\"hljs-attr\">setup</span> <span class=\"hljs-attr\">lang</span>=<span class=\"hljs-string\">&#x27;ts&#x27;</span>&gt;</span><span class=\"language-javascript\"></span></span><br><span class=\"language-javascript\"><span class=\"language-xml\"><span class=\"hljs-keyword\">import</span> &#123;ref, reactive&#125; <span class=\"hljs-keyword\">from</span> <span class=\"hljs-string\">&#x27;vue&#x27;</span></span></span><br><span class=\"language-javascript\"><span class=\"language-xml\"></span></span><br><span class=\"language-javascript\"><span class=\"language-xml\"><span class=\"hljs-keyword\">const</span> show = <span class=\"hljs-title function_\">ref</span>(<span class=\"hljs-literal\">false</span>)</span></span><br><span class=\"language-javascript\"><span class=\"language-xml\"></span></span><br><span class=\"language-javascript\"><span class=\"language-xml\"><span class=\"hljs-keyword\">const</span> <span class=\"hljs-title function_\">onShow</span> = (<span class=\"hljs-params\"></span>) =&gt; show.<span class=\"hljs-property\">value</span> = <span class=\"hljs-literal\">true</span></span></span><br><span class=\"language-javascript\"><span class=\"language-xml\"><span class=\"hljs-keyword\">const</span> <span class=\"hljs-title function_\">onHide</span> = (<span class=\"hljs-params\"></span>) =&gt; show.<span class=\"hljs-property\">value</span> = <span class=\"hljs-literal\">false</span></span></span><br><span class=\"language-javascript\"><span class=\"language-xml\"></span></span><br><span class=\"language-javascript\"><span class=\"language-xml\"><span class=\"hljs-comment\">// 暴露内部方法供外部调用</span></span></span><br><span class=\"language-javascript\"><span class=\"language-xml\"><span class=\"hljs-title function_\">defineExpose</span>(&#123;</span></span><br><span class=\"language-javascript\"><span class=\"language-xml\">  onShow,</span></span><br><span class=\"language-javascript\"><span class=\"language-xml\">  onHide,</span></span><br><span class=\"language-javascript\"><span class=\"language-xml\">&#125;)</span></span><br><span class=\"language-javascript\"><span class=\"language-xml\"></span></span><br><span class=\"language-javascript\"><span class=\"language-xml\"></span><span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">script</span>&gt;</span></span><br><span class=\"language-xml\"><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">style</span> <span class=\"hljs-attr\">scoped</span> <span class=\"hljs-attr\">lang</span>=<span class=\"hljs-string\">&quot;less&quot;</span>&gt;</span><span class=\"language-css\"></span></span><br><span class=\"language-css\"><span class=\"language-xml\"><span class=\"hljs-selector-class\">.loading</span> &#123;</span></span><br><span class=\"language-css\"><span class=\"language-xml\">  <span class=\"hljs-attribute\">width</span>: <span class=\"hljs-number\">100%</span>;</span></span><br><span class=\"language-css\"><span class=\"language-xml\">  <span class=\"hljs-attribute\">height</span>: <span class=\"hljs-number\">100%</span>;</span></span><br><span class=\"language-css\"><span class=\"language-xml\">  <span class=\"hljs-attribute\">background-color</span>: <span class=\"hljs-number\">#1f2123</span>;</span></span><br><span class=\"language-css\"><span class=\"language-xml\">  <span class=\"hljs-attribute\">position</span>: absolute;</span></span><br><span class=\"language-css\"><span class=\"language-xml\">  <span class=\"hljs-attribute\">top</span>: <span class=\"hljs-number\">0</span>;</span></span><br><span class=\"language-css\"><span class=\"language-xml\">  <span class=\"hljs-attribute\">left</span>: <span class=\"hljs-number\">0</span>;</span></span><br><span class=\"language-css\"><span class=\"language-xml\">  <span class=\"hljs-attribute\">text-align</span>: center;</span></span><br><span class=\"language-css\"><span class=\"language-xml\">&#125;</span></span><br><span class=\"language-css\"><span class=\"language-xml\"></span><span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">style</span>&gt;</span></span><br></code></pre></td></tr></table></figure>\n\n<p>这样我们就可以在任何地方使用 全局 Loading 了。</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\"><span class=\"hljs-comment\">// setup</span><br><span class=\"hljs-keyword\">const</span> instance = <span class=\"hljs-title function_\">getCurrentInstance</span>()<br><br><span class=\"hljs-keyword\">const</span> <span class=\"hljs-title function_\">showLoading</span> = (<span class=\"hljs-params\"></span>) =&gt; &#123;<br>  instance?.<span class=\"hljs-property\">proxy</span>?.<span class=\"hljs-property\">$loading</span>.<span class=\"hljs-title function_\">onShow</span>()<br>&#125;<br><br><span class=\"hljs-comment\">// or 直接在 template 中使用</span><br>&lt;button @click=<span class=\"hljs-string\">&quot;$loading.onShow&quot;</span>&gt;show loading&lt;/button&gt;<br></code></pre></td></tr></table></figure>\n\n<p>如果调用 $loading 报ts错误，我们可以声明全局类型</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\">declare <span class=\"hljs-variable language_\">module</span> <span class=\"hljs-string\">&#x27;vue&#x27;</span> &#123;<br>  <span class=\"hljs-keyword\">export</span> interface <span class=\"hljs-title class_\">ComponentCustomProperties</span> &#123;<br>    <span class=\"hljs-attr\">$loading</span>: &#123;<br>      <span class=\"hljs-title function_\">onShow</span>(): <span class=\"hljs-keyword\">void</span>;<br>      <span class=\"hljs-title function_\">onHide</span>(): <span class=\"hljs-keyword\">void</span>;<br>    &#125;<br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure>\n\n<h1 id=\"Scoped原理-amp-样式穿透\"><a href=\"#Scoped原理-amp-样式穿透\" class=\"headerlink\" title=\"Scoped原理 &amp; 样式穿透\"></a>Scoped原理 &amp; 样式穿透</h1><ol>\n<li>给 HTML DOM节点加一个不重复的 data 属性（形如: data-v-xxxxx），来表示它的唯一性</li>\n<li>在每句 CSS 选择器的末尾，加一个当前组件的 data 属性选择器，来私有化样式</li>\n<li>如果组件内部包含其他组件，只会给其他组件的最外层标签加上当前组件的 data 属性.</li>\n</ol>\n<p>想要直接修改开源组件的样式，大概率是失败的，解决方案就是要使用样式穿透</p>\n<figure class=\"highlight css\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs css\">/deep/ <span class=\"hljs-selector-class\">.input</span> &#123;<br>  ...<br>&#125;<br><br>// or<br><br>:<span class=\"hljs-built_in\">deep</span>(.input) &#123;<br>  ...<br>&#125;<br></code></pre></td></tr></table></figure>\n\n\n<h1 id=\"css新特性\"><a href=\"#css新特性\" class=\"headerlink\" title=\"css新特性\"></a>css新特性</h1><h2 id=\"插槽选择器\"><a href=\"#插槽选择器\" class=\"headerlink\" title=\"插槽选择器\"></a>插槽选择器</h2><p>我们在使用插槽时，如何在子组件中修改插槽内容的样式</p>\n<figure class=\"highlight css\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs css\"><span class=\"hljs-selector-pseudo\">:slotted</span>(<span class=\"hljs-selector-class\">.p-footer</span>) &#123;<br>  <span class=\"hljs-attribute\">color</span>: red;<br>&#125;<br></code></pre></td></tr></table></figure>\n\n<h2 id=\"定义全局样式\"><a href=\"#定义全局样式\" class=\"headerlink\" title=\"定义全局样式\"></a>定义全局样式</h2><figure class=\"highlight css\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs css\">:<span class=\"hljs-built_in\">global</span>(div) &#123;<br>  <span class=\"hljs-attribute\">color</span>: red;<br>&#125;<br></code></pre></td></tr></table></figure>\n\n<h2 id=\"动态-css\"><a href=\"#动态-css\" class=\"headerlink\" title=\"动态 css\"></a>动态 css</h2><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\"><span class=\"hljs-comment\">// js</span><br><span class=\"hljs-keyword\">const</span> color = <span class=\"hljs-title function_\">ref</span>(<span class=\"hljs-string\">&#x27;red&#x27;</span>)<br><span class=\"hljs-keyword\">const</span> font = <span class=\"hljs-title function_\">ref</span>(&#123;<br>  <span class=\"hljs-attr\">fontSize</span>: <span class=\"hljs-string\">&#x27;24px&#x27;</span>,<br>  <span class=\"hljs-attr\">fontWeight</span>: <span class=\"hljs-string\">&#x27;bold&#x27;</span>,<br>&#125;)<br><br><span class=\"hljs-comment\">// css</span><br>.<span class=\"hljs-property\">box</span> &#123;<br>  <span class=\"hljs-attr\">color</span>: v-<span class=\"hljs-title function_\">bind</span>(color);<br>  font-<span class=\"hljs-attr\">size</span>: v-<span class=\"hljs-title function_\">bind</span>(<span class=\"hljs-string\">&#x27;font.fontSize&#x27;</span>);<br>&#125;<br></code></pre></td></tr></table></figure>\n\n<h2 id=\"模块化-css\"><a href=\"#模块化-css\" class=\"headerlink\" title=\"模块化 css\"></a>模块化 css</h2><p>给 style 标签加上 module 属性</p>\n<figure class=\"highlight css\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs css\">// template<br>// 如果有多个，就写成数组形式<br>&lt;<span class=\"hljs-selector-tag\">div</span> :class=<span class=\"hljs-string\">&quot;[$style.box]&quot;</span>&gt;<br>  模块 css<br>&lt;/div&gt;<br><br>// css<br>&lt;style module&gt;<br>.box &#123;<br>  <span class=\"hljs-attribute\">color</span>: red<br>&#125;<br>&lt;/style&gt;<br></code></pre></td></tr></table></figure>\n\n<p><code>$style</code> 是固定的写法，如果不想用这个变量，我们可以指定 <code>module=&quot;myStyle&quot;</code> 。</p>\n<p>我们还可以通过 <code>useCssModule</code> 获取当前组件下的样式类名</p>\n<figure class=\"highlight angelscript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs angelscript\"><span class=\"hljs-comment\">// 默认</span><br><span class=\"hljs-keyword\">const</span> <span class=\"hljs-keyword\">class</span> = <span class=\"hljs-symbol\">useCssModule</span>()<br><span class=\"hljs-symbol\">const</span> <span class=\"hljs-symbol\">class</span> = <span class=\"hljs-symbol\">useCssModule</span>(&#x27;$<span class=\"hljs-symbol\">style</span>&#x27;)<br><br>// 如果指定了 <span class=\"hljs-symbol\">module</span><br><span class=\"hljs-symbol\">const</span> <span class=\"hljs-symbol\">class</span> = <span class=\"hljs-symbol\">useCssModule</span>(&#x27;<span class=\"hljs-symbol\">myStyle</span>&#x27;)<br></code></pre></td></tr></table></figure>\n\n<h1 id=\"集成-Tailwind-CSS\"><a href=\"#集成-Tailwind-CSS\" class=\"headerlink\" title=\"集成 Tailwind CSS\"></a>集成 Tailwind CSS</h1><blockquote>\n<p><a href=\"https://blog.csdn.net/qq1195566313/article/details/124951311?ops_request_misc=%257B%2522request%255Fid%2522%253A%2522167109189716782427434983%2522%252C%2522scm%2522%253A%252220140713.130102334.pc%255Fblog.%2522%257D&amp;request_id=167109189716782427434983&amp;biz_id=0&amp;utm_medium=distribute.pc_search_result.none-task-blog-2~blog~first_rank_ecpm_v1~rank_v31_ecpm-1-124951311-null-null.nonecase&amp;utm_term=tailwind&amp;spm=1018.2226.3001.4450\">https://blog.csdn.net/qq1195566313/article/details/124951311?ops_request_misc=%257B%2522request%255Fid%2522%253A%2522167109189716782427434983%2522%252C%2522scm%2522%253A%252220140713.130102334.pc%255Fblog.%2522%257D&amp;request_id=167109189716782427434983&amp;biz_id=0&amp;utm_medium=distribute.pc_search_result.none-task-blog-2~blog~first_rank_ecpm_v1~rank_v31_ecpm-1-124951311-null-null.nonecase&amp;utm_term=tailwind&amp;spm=1018.2226.3001.4450</a></p>\n</blockquote>\n<p>安装 vscode 提示插件 <code>Tailwind CSS IntelliSense</code></p>\n<h1 id=\"h函数\"><a href=\"#h函数\" class=\"headerlink\" title=\"h函数\"></a>h函数</h1><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\"><span class=\"hljs-keyword\">import</span> &#123; h &#125; <span class=\"hljs-keyword\">from</span> <span class=\"hljs-string\">&#x27;vue&#x27;</span><br><br><span class=\"hljs-keyword\">const</span> <span class=\"hljs-title function_\">Btn</span> = (<span class=\"hljs-params\">props, ctx</span>) =&gt; &#123;<br>  <span class=\"hljs-keyword\">return</span> <span class=\"hljs-title function_\">h</span>(<span class=\"hljs-string\">&#x27;div&#x27;</span>, &#123;<br>    <span class=\"hljs-attr\">class</span>: [...],<br>    <span class=\"hljs-attr\">onClick</span>: <span class=\"hljs-function\">() =&gt;</span> &#123;<br>      ctx.<span class=\"hljs-title function_\">emit</span>(<span class=\"hljs-string\">&#x27;on-click&#x27;</span>, <span class=\"hljs-string\">&#x27;hello world&#x27;</span>)<br>    &#125;,<br>  &#125;, ctx.<span class=\"hljs-property\">slots</span>.<span class=\"hljs-title function_\">default</span>())<br>&#125;<br><br></code></pre></td></tr></table></figure>\n\n\n\n<h1 id=\"参考资料\"><a href=\"#参考资料\" class=\"headerlink\" title=\"参考资料\"></a>参考资料</h1><section class=\"footnotes\"><div class=\"footnote-list\"><ol><li><span id=\"fn:1\" class=\"footnote-text\"><span><a href=\"https://blog.csdn.net/u012961419/article/details/124299803\">Vue3+Vite+Ts 项目实战 01 Vite 创建项目、ESLint+TS+GitCommit配置、Vue3新特性介绍</a>\n<a href=\"#fnref:1\" rev=\"footnote\" class=\"footnote-backref\"> ↩</a></span></span></li></ol></div></section>"},{"layout":"Vue3","title":"Vue3项目实战(五)：通用功能开发（一）","date":"2022-12-29T03:00:23.000Z","banner_img":"/img/theme.png","index_img":"/img/theme.png","excerpt":"国际化/换肤","_content":"\n# 通用功能\n\n1. 国际化\n2. 动态换肤\n3. `screenfull`\n4. `headerSearch`\n5. `tagView`\n6. `guide`\n\n# 国际化实现原理\n\n先来看一个需求：\n\n> 我们有一个变量 `msg` ，但是这个 `msg` 有且只能有两个值：\n>\n> 1. hello world\n> 2. 你好世界\n>\n> 要求：根据需要切换 `msg` 的值\n\n这样的一个需求就是 国际化 的需求，那么我们可以通过以下代码来实现这个需求\n\n```js\n<script>\n  // 1. 定义 msg 值的数据源\n  const messages = {\n    en: {\n      msg: 'hello world'\n    },\n    zh: {\n      msg: '你好世界'\n    }\n  }\n  // 2. 定义切换变量\n  let locale = 'en'\n  // 3. 定义赋值函数\n  function t(key) {\n    return messages[locale][key]\n  }\n  // 4. 为 msg 赋值 \n  let msg = t('msg')\n  console.log(msg);\n  // 修改 locale， 重新执行 t 方法，获取不同语言环境下的值\n\n</script>\n```\n\n总结：\n\n1. 通过一个变量来 **控制** 语言环境\n2. 所有语言环境下的数据源要 **预先** 定义好\n3. 通过一个方法来获取 **当前语言** 下 **指定属性** 的值\n4. 该值即为国际化下展示值\n\n## 基于 vue-i18n V9  的国际化实现方案分析\n\n在 `vue` 的项目中，我们不需要手写这么复杂的一些基础代码，可以直接使用 [vue-i18n](https://vue-i18n.intlify.dev/) 进行实现（注意：**`vue3` 下需要使用 `V 9.x` 的 `i18n`**）\n\n[vue-i18n](https://vue-i18n.intlify.dev/guide/) 的使用可以分为四个部分：\n\n1. 创建 `messages` 数据源\n2. 创建 `locale` 语言变量\n3. 初始化 `i18n` 实例\n4. 注册 `i18n` 实例\n\n那么接下来我们就去实现以下：\n\n1. 安装 `vue-i18n`\n```js\n  npm install vue-i18n@next\n```\n\n\n2. 创建 `i18n/index.js` 文件\n\n3. 创建 `messages` 数据源\n\n   ```js\n   const messages = {\n     en: {\n       msg: {\n         test: 'hello world'\n       }\n     },\n     zh: {\n       msg: {\n         test: '你好世界'\n       }\n     }\n   }\n   ```\n\n4. 创建 `locale` 语言变量\n\n   ```js\n   const locale = 'en'\n   ```\n\n5. 初始化 `i18n` 实例\n\n   ```js\n   import { createI18n } from 'vue-i18n'\n   \n   const i18n = createI18n({\n     // 使用 Composition API 模式，则需要将其设置为false\n     legacy: false,\n     // 全局注入 $t 函数\n     globalInjection: true,\n     locale,\n     messages\n   })\n   ```\n\n6. 把 `i18n` 注册到 `vue` 实例\n\n   ```js\n   export default i18n\n   ```\n\n7. 在 `main.js` 中导入\n\n   ```js\n   // i18n （PS：导入放到 APP.vue 导入之前，因为后面我们会在 app.vue 中使用国际化内容）\n   import i18n from '@/i18n'\n   ...\n   app.use(i18n)\n   ```\n\n8. 在 `layout/components/Sidebar/index.vue` 中使用 `i18n`\n\n   ```html\n   <h1 class=\"logo-title\" v-if=\"$store.getters.sidebarOpened\">\n           {{ $t('msg.test') }}\n   </h1>\n   ```\n\n9. 修改 `locale` 的值，即可改变展示的内容\n\n截止到现在我们已经实现了 `i18n` 的最基础用法，那么解下来我们就可以在项目中使用 `i18n` 完成国际化。\n\n项目中完成国际化分成以下几步进行:\n\n1. 封装 `langSelect` 组件用于修改 `locale`\n2. 导入 `el-locale` 语言包\n3. 创建自定义语言包\n\n## 封装  langSelect  组件\n\n1. 定义 `store/app.js`\n\n   ```js\n   import { LANG } from '@/constant'\n   import { getItem, setItem } from '@/utils/storage'\n   export default {\n     namespaced: true,\n     state: () => ({\n       ...\n       language: getItem(LANG) || 'zh'\n     }),\n     mutations: {\n       ...\n       /**\n        * 设置国际化\n        */\n       setLanguage(state, lang) {\n         setItem(LANG, lang)\n         state.language = lang\n       }\n     },\n     actions: {}\n   }\n   \n   ```\n\n   \n\n2. 在 `constant` 中定义常量\n\n   ```js\n   // 国际化\n   export const LANG = 'language'\n   ```\n\n\n3. 创建 `components/LangSelect/index` \n\n   ```js\n   <template>\n     <el-dropdown\n       trigger=\"click\"\n       class=\"international\"\n       @command=\"handleSetLanguage\"\n     >\n       <div>\n         <el-tooltip content=\"国际化\" :effect=\"effect\">\n           <svg-icon icon=\"language\" />\n         </el-tooltip>\n       </div>\n       <template #dropdown>\n         <el-dropdown-menu>\n           <el-dropdown-item :disabled=\"language === 'zh'\" command=\"zh\">\n             中文\n           </el-dropdown-item>\n           <el-dropdown-item :disabled=\"language === 'en'\" command=\"en\">\n             English\n           </el-dropdown-item>\n         </el-dropdown-menu>\n       </template>\n     </el-dropdown>\n   </template>\n   \n   <script setup>\n   import { useI18n } from 'vue-i18n'\n   import { defineProps, computed } from 'vue'\n   import { useStore } from 'vuex'\n   import { ElMessage } from 'element-plus'\n   \n   defineProps({\n     effect: {\n       type: String,\n       default: 'dark',\n       validator: function(value) {\n         // 这个值必须匹配下列字符串中的一个\n         return ['dark', 'light'].indexOf(value) !== -1\n       }\n     }\n   })\n   \n   const store = useStore()\n   const language = computed(() => store.getters.language)\n   \n   // 切换语言的方法\n   const i18n = useI18n()\n   const handleSetLanguage = lang => {\n     i18n.locale.value = lang\n     store.commit('app/setLanguage', lang)\n     ElMessage.success('更新成功')\n   }\n   </script>\n   ```\n\n4. 在 `navbar` 中导入 `LangSelect`\n\n   ```js\n   <template>\n     <div class=\"navbar\">\n       ...\n       <div class=\"right-menu\">\n         <lang-select class=\"right-menu-item hover-effect\" />\n         <!-- 头像 -->\n         ...\n       </div>\n     </div>\n   </template>\n   \n   <script setup>\n   import LangSelect from '@/components/LangSelect'\n   ...\n   </script>\n   \n   <style lang=\"scss\" scoped>\n   .navbar {\n     ...\n   \n     .right-menu {\n       ...\n   \n       ::v-deep .right-menu-item {\n         display: inline-block;\n         padding: 0 18px 0 0;\n         font-size: 24px;\n         color: #5a5e66;\n         vertical-align: text-bottom;\n   \n         &.hover-effect {\n           cursor: pointer;\n         }\n       }\n   \n       ...\n   }\n   </style>\n   \n   ```\n\n## element-plus 国际化处理\n\n截止到目前，我们的国际化内容已经基本功能已经处理完成了。接下来需要处理的就是对应的语言包，有了语言包就可以实现整个项目中的所有国际化处理了。\n\n那么对于语言包来说，我们整个项目中会分成两部分：\n\n1. `element-plus` 语言包：用来处理 `element` 组件的国际化功能\n2. 自定义语言包：用来处理 **非**`element` 组件的国际化功能\n\n那么首先我们先来处理 `element-plus` 语言包：\n\n3. 在 `plugins/index` 中导入 `element` 的中文、英文语言包：\n\n```js\nimport zhCn from 'element-plus/es/locale/lang/zh-cn'\nimport en from 'element-plus/lib/locale/lang/en'\n```\n\n4. 注册 `element` 时，根据当前语言选择使用哪种语言包\n\n   ```js\n   import store from '@/store'\n   \n   export default app => {\n     app.use(ElementPlus, {\n       locale: store.getters.language === 'en' ? en : zhCn\n     })\n   }\n   ```\n\n   \n\n\n\n## 自定义语言包国际化处理\n\n处理完 `element` 的国际化内容之后，接下来我们来处理 **自定义语言包**。\n\n1.  在本地创建 `lang` 文件夹，里面创建好本地需要的语言包，由于比较多，就放一部分来看看：\n\n```js\n// en.ts\nexport default {\n  login: {\n    title: 'User Login',\n    loginBtn: 'Login',\n    usernameRule: 'Username is required',\n    passwordRule: 'Password cannot be less than 6 digits',\n  },\n  // other....\n}\n\n// zh.ts\nexport default {\n  login: {\n    title: '用户登录',\n    loginBtn: '登录',\n    usernameRule: '用户名为必填项',\n    passwordRule: '密码不能少于6位',\n  },\n  // other...\n}\n```\n\n2. 在 `lang/index` 中，导入语言包\n\n  ```js\n  import mZhLocale from './lang/zh'\n  import mEnLocale from './lang/en'\n  ```\n\n3. 在 `messages` 中注册到语言包\n\n   ```js\n   const messages = {\n     en: {\n       msg: {\n         ...mEnLocale\n       }\n     },\n     zh: {\n       msg: {\n         ...mZhLocale\n       }\n     }\n   }\n   ```\n\n## 处理项目国际化内容\n\n在处理好了国际化的语言包之后，接下来我们就可以应用国际化功能到我们的项目中\n\n对于我们目前的项目而言，需要进行国际化处理的地方主要分为：\n\n1. 登录页面\n2. `navbar` 区域\n3. `sidebar` 区域\n4. 面包屑区域\n\n那么这一小节，我们先来处理前两个\n\n**登录页面：**\n\n`login/index`\n\n```js\n<template>\n  <div class=\"login-container\">\n    ...\n      <div class=\"title-container\">\n        <h3 class=\"title\">{{ $t('msg.login.title') }}</h3>\n          <lang-select class=\"lang-select\" effect=\"light\"></lang-select>\n      </div>\n\n      ...\n\n      <el-button\n        type=\"primary\"\n        style=\"width: 100%; margin-bottom: 30px\"\n        :loading=\"loading\"\n        @click=\"handleLogin\"\n        >{{ $t('msg.login.loginBtn') }}</el-button\n      >\n      \n      <div class=\"tips\" v-html=\"$t('msg.login.desc')\"></div>\n    </el-form>\n  </div>\n</template>\n\n<script setup>\nimport { useI18n } from 'vue-i18n'\n...\n// 验证规则\nconst i18n = useI18n()\nconst loginRules = ref({\n  username: [\n    {\n      ...\n      message: i18n.t('msg.login.usernameRule')\n    }\n  ],\n  ...\n})\n...\n</script>\n\n\n```\n\n`login/rules`\n\n```js\nimport i18n from '@/i18n'\nexport const validatePassword = () => {\n  return (rule, value, callback) => {\n    if (value.length < 6) {\n      callback(new Error(i18n.global.t('msg.login.passwordRule')))\n    } else {\n      callback()\n    }\n  }\n}\n\n```\n\n **`navbar` 区域**\n\n`layout/components/navbar`\n\n```js\n<template>\n  <div class=\"navbar\">\n    ...\n        <template #dropdown>\n          <el-dropdown-menu class=\"user-dropdown\">\n            <router-link to=\"/\">\n              <el-dropdown-item> {{ $t('msg.navBar.home') }} </el-dropdown-item>\n            </router-link>\n            <a target=\"_blank\" href=\"\">\n              <el-dropdown-item>{{ $t('msg.navBar.course') }}</el-dropdown-item>\n            </a>\n            <el-dropdown-item divided @click=\"logout\">\n              {{ $t('msg.navBar.logout') }}\n            </el-dropdown-item>\n          </el-dropdown-menu>\n        </template>\n      </el-dropdown>\n    </div>\n  </div>\n</template>\n```\n\n`components/LangSelect/index`\n\n```js\n<el-tooltip :content=\"$t('msg.navBar.lang')\" :effect=\"effect\">\n\nconst handleSetLanguage = lang => {\n  ...\n  ElMessage.success(i18n.t('msg.toast.switchLangSuccess'))\n}\n```\n\n## sidebar 与 面包屑 区域的国际化处理\n\n**sidebar 区域**\n\n目前对于 `sidebar` 而言，显示的文本是我们在定义路由表时的 `title`\n\n```html\n<span>{{ title }}</span>\n```\n\n我们可以 **把 `title` 作为语言包内容的 `key` 进行处理**\n\n创建 `utils/i18n` 工具模块，用于 **将 `title` 转化为国际化内容**\n\n```js\nimport i18n from '@/i18n'\nexport function generateTitle(title) {\n  return i18n.global.t('msg.route.' + title)\n}\n\n```\n\n在 `layout/components/Sidebar/MenuItem.vue` 中导入该方法：\n\n```js\n<template>\n  ...\n  <span>{{ generateTitle(title) }}</span>\n</template>\n\n<script setup>\nimport { generateTitle } from '@/utils/i18n'\n...\n</script>\n\n```\n\n最后修改下 `sidebarHeader` 的内容\n\n```js\n<h1 class=\"logo-title\" v-if=\"$store.getters.sidebarOpened\">\n  {{ $t('msg.logo') }}\n</h1>\n```\n\n**面包屑区域：**\n\n在 `components/Breadcrumb/index`\n\n```js\n<template>\n...\n    <!-- 不可点击项 -->\n    <span v-if=\"index === breadcrumbData.length - 1\" class=\"no-redirect\">{{\n        generateTitle(item.meta.title)\n        }}</span>\n    <!-- 可点击项 -->\n    <a v-else class=\"redirect\" @click.prevent=\"onLinkClick(item)\">{{\n        generateTitle(item.meta.title)\n        }}</a>\n...\n</template>\n\n<script setup>\nimport { generateTitle } from '@/utils/i18n'\n...\n</script>\n\n```\n\n## 国际化缓存处理\n\n我们希望在 **刷新页面后，当前的国际化选择可以被保留**，所以想要实现这个功能，那么就需要进行 **国际化的缓存处理**\n\n此处的缓存，我们依然通过两个方面进行：\n\n1. `vuex` 缓存\n2. `LocalStorage` 缓存\n\n只不过这里的缓存，我们已经在处理 **`langSelect` 组件时** 处理完成了，所以此时我们只需要使用缓存下来的数据即可。\n\n在 `i18n/index` 中，创建 `getLanguage` 方法：\n\n```js\nimport store from '@/store'\n/**\n * 返回当前 lang\n */\nfunction getLanguage() {\n  return store && store.getters && store.getters.language\n}\n```\n\n修改 `createI18n` 的 `locale` 为 `getLanguage()` \n\n```js\nconst i18n = createI18n({\n  ...\n  locale: getLanguage()\n})\n```\n\n## 国际化方案总结\n\n国际化是前端项目中的一个非常常见的功能，那么在前端项目中实现国际化主要依靠的就是 `vue-i18n` 这个第三方的包。\n\n关于国际化的实现原理大家可以参照 **国际化实现原理** 这一小节，这里我们就不再赘述了。\n\n而  `i18n` 的使用，整体来说就分为这么四步：\n\n1. 创建 `messages` 数据源\n2. 创建 `locale` 语言变量\n3. 初始化 `i18n` 实例\n4. 注册 `i18n` 实例\n\n核心的内容其实就是 数据源的部分，但是大家需要注意，如果你的项目中使用了 **第三方组件库** ，那么不要忘记 **第三方组件库的数据源** 需要 **单独** 进行处理！\n\n# 动态换肤原理分析\n\n想要实现 **动态换肤** 的一个前置条件就是：**色值不可以写死！**\n\n首先我们先来说一下动态换肤的实现方式。\n\n在 `scss` 中，我们可以通过 `$变量名:变量值` 的方式定义 `css 变量` ，然后通过该 `css` 来去指定某一块 `DOM` 对应的颜色。\n\n那么大家可以想一下，如果我此时改变了该 `css` 变量的值，那么对应的 `DOM` 颜色是不是也会同步发生变化。\n\n当大量的 `DOM` 都依赖这个 `css 变量` 设置颜色时，我们是不是只需要改变这个 `css 变量` ，那么所有 `DOM` 的颜色是不是都会发生变化，所谓的 **动态换肤** 是不是就可以实现了！\n\n这个就是 **动态换肤** 的实现原理!\n\n实现换肤和主题大致有两种方案:\n\n1. 使用原生支持的 css var\n2. 通过一些手段覆盖 element plus 样式\n\n我们先看来看看 css var 的实现吧。\n\n## css变量\n\n> https://developer.mozilla.org/zh-CN/docs/Web/CSS/:root\n\n变量 与 color、font-size 等正式属性没有什么不同，只是没有默认含义。\n\n所以 CSS 变量（CSS variable）又叫做\"CSS 自定义属性\"（CSS custom properties）。因为变量与自定义的 CSS 属性其实是一回事。\n\n\n变量可以分为\n\n- 全局变量\n- 局部变量\n\n**全局变量**\n通过 `:root` 去定义，其他所有的元素都可以通过 `var(--xxx)` 的形式去使用`全局变量`，我们来看下面这个例子:\n\n> var()函数还可以使用第二个参数，表示变量的默认值。如果该变量不存在，就会使用这个默认值。\n\n```js\n<style>\n  :root {\n    --color: skyblue;\n  }\n\n  .use-global {\n    color: var(--color)\n  }\n</style>\n\n// body\n<div class=\"use-global\">使用了全局变量</div>\n```\n**:root**\n> :root 这个 CSS 伪类匹配文档树的根元素。对于 HTML 来说，:root 表示 <html> 元素，除了优先级更高之外，与 html 选择器相同。\n\n**自定义属性 (--*)：CSS 变量**\n\n> 带有前缀--的属性名，比如--example--name，表示的是带有值的自定义属性，其可以通过 var 函数在全文档范围内复用的。\n\n**局部变量**\n\n我们可以在某个选择器下去定义变量，或者在元素的 `style` 属性上定义变量：\n\n```js\n// style\n:root {\n  --color: skyblue;\n}\n\n.parent {\n  --color: pink; // 优先级更高\n}\n\nh3 {\n  color: var(--color)\n}\n\n// html\n<div class=\"parent\">\n  <h3>child title</h3>\n</div>\n```\n\n这里 `h3` 标签会显示红色。虽然我们在 `:root` 上也定义了 `--color` 变量，但是根据就近原则，`h3` 会取父级定义的变量。\n\n我们还可以在 `style` 属性上定义变量，这里我们定义了一个 `--bg` 变量，其子元素可以访问到这个变量。\n\n```js\n.parent {\n  --color: pink;\n}\n\nh3 {\n  color: var(--color);\n  background-color: var(--bg);\n}\n\n<div class=\"parent\" style=\"--bg: black;\">\n  <h3>child title</h3>\n</div>\n```\n\n## 修改 css 变量\n\n这里定义了两个按钮，一个修改全局的（根组件）的变量，一个用来修改特定元素上的定义的变量：\n\n```js\n<button class=\"btn\">change root</button>\n<button class=\"variable\">change local variable</button>\n```\n\n**修改全局变量**\n```js\nconst btn = document.querySelector('.btn')\n\nbtn.addEventListener('click', () => {\n  const html = document.documentElement\n\n  html.style.setProperty('--color', 'red')\n})\n```\n\n**修改局部变量**\n\n```js\nconst variableBtn = document.querySelector('.variable')\n\nvariableBtn.addEventListener('click', () => {\n  const parent = document.querySelector('.parent')\n\n  parent.style.setProperty('--color', 'green')\n})\n```\n\n# 暗黑模式原理分析\n\n> prefers-color-scheme\n>\n> prefers-color-scheme CSS 媒体特性: 用于检测用户是否有将系统的主题色设置为亮色或者暗色。\n\n## 主题色实现原理\n\n通过 `媒体查询` 去监听系统主题色的变化。\n\n```js\n// style\n@media (prefers-color-scheme: dark) {\n  .day.dark-scheme   { background:  #333; color: white; }\n  .night.dark-scheme { background: black; color:  red; }\n}\n\n@media (prefers-color-scheme: light) {\n  .day.light-scheme   { background: skyblue; color:  #333; }\n  .night.light-scheme { background:  pink; color: #333; }\n}\n\n.day, .night {\n  display: inline-block;\n  padding: 1em;\n  width: 7em;\n  height: 7em;\n  vertical-align: middle;\n}\n\n// html\n<div class=\"day light-scheme\">Day (changes in light scheme)</div>\n<div class=\"day dark-scheme\">Day (changes in dark scheme)</div> <br>\n\n<div class=\"night light-scheme\">Night (changes in light scheme)</div>\n<div class=\"night dark-scheme\">Night (changes in dark scheme)</div>\n```\n\n现在，我们可以去切换系统的主题色，就会发现页面上的颜色跟着变化了，这是因为我们通过 `@media` 监听 `prefers-color-scheme` 起作用了。\n\n## window.matchMedia\n\n虽然我们通过 css @media 能够应对系统的主题色切换，但是我们如何在 `js` 中去监听呢？\n\n答案是通过 `window.matchMedia` 方法：\n\n```js\n// 如果匹配成功，scheme.matches === true\n// 也就是说，如果我们的系统是暗黑色，那么这个 matches 就是true，否则是 false\nconst scheme = window.matchMedia('(prefers-color-scheme: dark)')\n\nscheme.addEventListener('change', e => {\n  if (e.matches) {\n    // 暗黑色\n  } else {\n    // 亮色\n  }\n})\n```\n\n## 修改主题色\n\n到此，我们知道了主题色的实现原理，我们如何在项目里去实现主题色的切换呢？\n\n我们来看一个小例子\n\n首先，我们先定义好 `全局变量`，里面包含了一些 `亮色模式` 下的变量：\n\n```js\n:root {\n  --color: #333;\n  --background-color: pink;\n}\n\n<h1 style=\"background-color: var(--background-color); color: var(--color)\">\n  我是一个标题。！！！\n</h1>\n\n<button class=\"dark-btn\">dark mode</button>\n```\n\n在页面初始时，我们的背景色是粉色，颜色是浅黑色。\n\n现在我们创建一个按钮，来修改主题颜色，这个之前实现过了很简单对吧。\n\n```js\nconst darkBtn = document.querySelector('.dark-btn')\n\ndarkBtn.addEventListener('click', () => {\n  // 修改变量\n  document.documentElement.style.setProperty('--color', '#fff')\n  document.documentElement.style.setProperty('--background-color', '#000')\n})\n```\n\n好无疑问这样是可以实现的，但是，如果变量多起来了，几十上百个，我们也要一个个去修改吗？\n\n既然我们的变量都定义在根元素上，那么我们可以采取 **属性覆盖** 的形式。\n\n我们定义一个 `[data-theme=\"dark\"]` 样式表，专门用来处理 `暗黑模式` 下的变量，这里是黑色背景白色字体。\n\n```js\n[data-theme=\"dark\"] {\n  --color: #fff;\n  --background-color: #000;\n}\n```\n\n或者属性选择器：\n\n```js\n/* 浅色模式 */\nhtml[data-theme=\"light\"]:root {\n  --body-background: #efefef;\n  --text-color: #333;\n}\n\n/* 深色模式 */\nhtml[data-theme=\"dark\"]:root {\n  --body-background: #000;\n  --text-color: #ededed;\n}\n```\n\n一开始，这个样式表并不会生效，因为根标签上根本没有 `data-theme=\"dark\"` 属性，我们通过按钮来修改：\n\n```js\ndarkBtn.addEventListener('click', () => {\n  document.documentElement.setAttribute('data-theme', 'dark')\n})\n```\n\n我们给根标签设置了 `data-theme=\"dark\"` 属性，同时内部定了暗黑相关的变量，这时，`data-theme=\"dark\"` 内部的变量就会覆盖 `:root` 中的变量了，从而达到切换主题色的效果。\n\n同时，我们需要根据系统的主题色，来设置项目的主题色，这里就要用到 `window.matchMedia` 方法了。\n\n如果在 `Vue` 项目中，我们可以这样去实现:\n\n```js\nconst theme = computed(() => store.state.settings.theme);\n\n// 查看当前是否是 暗黑模式\nconst mediaQueryListDark = window.matchMedia('(prefers-color-scheme: dark)');\n\nconst changeTheme = (theme) => {\n  // 批量覆盖全局的变量\n\tdocument.documentElement.setAttribute('data-theme', theme);\n};\n\nconst handleColorSchemeChange = evt => {\n  if (evt.matches) {\n    changeTheme('dark');\n  } else {\n    changeTheme('light');\n  }\n};\n\nwatchEffect(() => {\n  if (theme.value === 'Follow System') {\n    // 初始值：跟随系统设置\n    handleColorSchemeChange(mediaQueryListDark);\n\n    // 监听系统主题的变化\n    mediaQueryListDark.addEventListener('change', handleColorSchemeChange);\n  } else if (theme.value) {\n    changeTheme(theme.value.toLowerCase());\n\n    // 如果不是跟随系统设置主题了，用户自己设置的主题色，我们就不需要监听系统的主题色切换了\n    mediaQueryListDark.removeEventListener('change', handleColorSchemeChange);\n  }\n});\n```\n\n## 总结\n\n到这里，我们花了大量的时间和实例对换肤和主题的原理进行了研究，那么接下来就要进入正式的项目开发环节了。\n\n\n# 官方换肤方案\n> 官方样式路径：/node_modules/element-plus/theme-chalk/src/common/var.scss\n\n定义自己的 scss 文件，然后在 main.ts 导入。\n\n```css\n$--colors: (\n  \"primary\": (\n    \"base\": pink,\n  ),\n  \"success\": (\n    \"base\": blue,\n  ),\n  \"warning\": (\n    \"base\": #f2711c,\n  ),\n  \"danger\": (\n    \"base\": #db2828,\n  ),\n  \"error\": (\n    \"base\": #db2828,\n  ),\n  \"info\": (\n    \"base\": #42b8dd,\n  ),\n);\n\n@forward 'element-plus/theme-chalk/src/common/var.scss' with (\n  $colors: $--colors,\n);\n\n/* 导入所有的样式变量 */\n@use \"element-plus/theme-chalk/src/index.scss\" as *;\n```\n\n修改 `main.ts`\n\n```css\n// 注释原导入的 element-plus 样式\n// import 'element-plus/dist/index.css'\n\n\n// 导入我们自己的定义的样式\nimport '@/styles/cover-element-plus.scss'\n```\n\n## 通过 CSS 变量设置\n如果不通过上面那种方案，我们还可以定义全局的变量，来覆盖官方的样式。\n\n在自己的样式文件中写入需要覆盖的样式变量：\n\n```css\n:root {\n  --el-color-primary: green;\n}\n```\n\n如果你只想自定义一个特定的组件，只需为某些组件单独添加内联样式。\n\n```css\n<el-tag style=\"--el-tag-bg-color: red\">Tag</el-tag>\n```\n\n出于性能原因，更加推荐你在类名下添加自定义 css 变量，而不是在全局的 :root 下。\n\n```css\n.custom-class {\n  --el-tag-bg-color: red;\n}\n```\n\n如果您想要通过 js 控制 css 变量，可以这样做：\n\n```css\n// document.documentElement 是全局变量时\nconst el = document.documentElement\n// const el = document.getElementById('xxx')\n\n// 获取 css 变量\ngetComputedStyle(el).getPropertyValue(`--el-color-primary`)\n\n// 设置 css 变量\nel.style.setProperty('--el-color-primary', 'red')\n```\n\n## 总结。\n相当于我们重新定义了变量，覆盖了官方自己定义的变量，如果我们项目只需要一种颜色，那么这种方案是可行的，但是我们项目需要支持用户选择主题来替换，那么这种方案就不适用了。\n\n那么我来用另一种方案来实现吧。\n\n# 换肤方案落地\n\n在我们的项目中想要实现动态换肤，需要同时处理两个方面的内容：\n\n1. `element-plus` 主题\n2. 非 `element-plus` 主题\n\n明确好了原理之后，接下来我们就来理一下咱们的实现思路。\n\n从原理中我们可以得到以下两个关键信息：\n\n1. 动态换肤的关键是修改 `css 变量` 的值\n2. 换肤需要同时兼顾\n  1. `element-plus` \n  2. 非 `element-plus` \n\n那么根据以上关键信息，我们就可以得出对应的实现方案:\n\n1. 创建一个组件 `ThemeSelect` 用来处理修改之后的 `css 变量` 的值\n2. 根据新值修改 `element-plus`  主题色\n3. 根据新值修改非 `element-plus`  主题色\n\n## 创建 ThemeSelect 组件\n\n`ThemeSelect` 组件将由两部分组成：\n\n1. `navbar` 中的展示图标\n2. 选择颜色的弹出层\n\n这是效果图：\n\n![](/img/theme-select.png)\n\n**创建 `components/ThemeSelect/index` 组件**\n\n```js\n<template>\n  <!-- 主题图标 v-bind：https://v3.cn.vuejs.org/api/instance-properties.html#attrs -->\n  <el-dropdown\n    v-bind=\"$attrs\"\n    trigger=\"click\"\n    class=\"theme\"\n    @command=\"handleSetTheme\"\n  >\n    <div>\n      <el-tooltip :content=\"$t('msg.navBar.themeChange')\">\n        <svg-icon icon=\"change-theme\" />\n      </el-tooltip>\n    </div>\n    <template #dropdown>\n      <el-dropdown-menu>\n        <el-dropdown-item command=\"color\">\n          {{ $t('msg.theme.themeColorChange') }}\n        </el-dropdown-item>\n      </el-dropdown-menu>\n    </template>\n  </el-dropdown>\n\n  <!-- 展示弹出层 -->\n  <div>\n    ...\n  </div>\n</template>\n\n<script setup>\nconst handleSetTheme = command => {}\n</script>\n\n<style lang=\"scss\" scoped></style>\n```\n\n在 `layout/components/navbar` 中进行引用\n\n```js\n<div class=\"right-menu\">\n  <theme-picker class=\"right-menu-item hover-effect\"></theme-picker>\n</div>\n\n... \n\nimport ThemePicker from '@/components/ThemeSelect/index'\n```\n\n**创建 `SelectColor` 组件**\n\n在有了 `ThemeSelect ` 之后，接下来我们来去处理颜色选择的组件 `SelectColor`，在这里我们会用到 `element` 中的 `el-color-picker` 组件\n\n对于 `SelectColor` 的处理，我们需要分成两步进行：\n\n1. 完成 `SelectColor` 弹窗展示的双向数据绑定\n2. 把选中的色值进行本地缓存\n\n那么下面咱们先来看第一步：**完成 `SelectColor` 弹窗展示的双向数据绑定**\n\n创建 `components/ThemePicker/components/SelectColor.vue` \n\n```js\n<template>\n  <el-dialog title=\"提示\" :model-value=\"modelValue\" @close=\"closed\" width=\"22%\">\n    <div class=\"center\">\n      <p class=\"title\">{{ $t('msg.theme.themeColorChange') }}</p>\n      <el-color-picker\n        v-model=\"mColor\"\n        :predefine=\"predefineColors\"\n      ></el-color-picker>\n    </div>\n    <template #footer>\n      <span class=\"dialog-footer\">\n        <el-button @click=\"closed\">{{ $t('msg.universal.cancel') }}</el-button>\n        <el-button type=\"primary\" @click=\"comfirm\">{{\n          $t('msg.universal.confirm')\n        }}</el-button>\n      </span>\n    </template>\n  </el-dialog>\n</template>\n\n<script setup>\nimport { defineProps, defineEmits, ref } from 'vue'\ndefineProps({\n  modelValue: {\n    type: Boolean,\n    required: true\n  }\n})\nconst emits = defineEmits(['update:modelValue'])\n\n// 预定义色值\nconst predefineColors = [\n  '#ff4500',\n  '#ff8c00',\n  '#ffd700',\n  '#90ee90',\n  '#00ced1',\n  '#1e90ff',\n  '#c71585',\n  'rgba(255, 69, 0, 0.68)',\n  'rgb(255, 120, 0)',\n  'hsv(51, 100, 98)',\n  'hsva(120, 40, 94, 0.5)',\n  'hsl(181, 100%, 37%)',\n  'hsla(209, 100%, 56%, 0.73)',\n  '#c7158577'\n]\n// 默认色值\nconst mColor = ref('#00ff00')\n\n/**\n * 关闭\n */\nconst closed = () => {\n  emits('update:modelValue', false)\n}\n/**\n * 确定\n * 1. 修改主题色\n * 2. 保存最新的主题色\n * 3. 关闭 dialog\n */\nconst comfirm = async () => {\n  closed()\n}\n</script>\n\n<style lang=\"scss\" scoped>\n.center {\n  text-align: center;\n  .title {\n    margin-bottom: 12px;\n  }\n}\n</style>\n\n```\n\n在 `ThemePicker/index` 中使用该组件\n\n\n```js\n<template>\n  ...\n  <!-- 展示弹出层 -->\n  <div>\n    <select-color v-model=\"selectColorVisible\"></select-color>\n  </div>\n</template>\n\n<script setup>\nimport SelectColor from './components/SelectColor.vue'\nimport { ref } from 'vue'\n\nconst selectColorVisible = ref(false)\nconst handleSetTheme = command => {\n  selectColorVisible.value = true\n}\n</script>\n\n```\n\n完成双向数据绑定之后，我们来处理第二步：**把选中的色值进行本地缓存**\n\n缓存的方式分为两种：\n\n1. `vuex`\n2. 本地存储\n\n在 `constants/index` 下新建常量值\n\n```js\n// 主题色保存的 key\nexport const MAIN_COLOR = 'mainColor'\n// 默认色值\nexport const DEFAULT_COLOR = '#409eff'\n```\n\n创建 `store/modules/theme` 模块，用来处理 **主题色** 相关内容\n\n```js\nimport { getItem, setItem } from '@/utils/storage'\nimport { MAIN_COLOR, DEFAULT_COLOR } from '@/constant'\nexport default {\n  namespaced: true,\n  state: () => ({\n    mainColor: getItem(MAIN_COLOR) || DEFAULT_COLOR\n  }),\n  mutations: {\n    /**\n     * 设置主题色\n     */\n    setMainColor(state, newColor) {\n      state.mainColor = newColor\n      setItem(MAIN_COLOR, newColor)\n    }\n  }\n}\n```\n\n在 `store/getters` 下指定快捷访问\n\n```js\nmainColor: state => state.theme.mainColor\n```\n\n在 `store/index` 中导入 `theme`\n\n```js\n...\nimport theme from './modules/theme.js'\n\nexport default createStore({\n  getters,\n  modules: {\n    ...\n    theme\n  }\n})\n```\n\n在 `selectColor` 中，设置初始色值 和  缓存色值\n\n```js\n...\n\n<script setup>\nimport { defineProps, defineEmits, ref } from 'vue'\nimport { useStore } from 'vuex'\n...\nconst store = useStore()\n\n// 默认色值\nconst mColor = ref(store.getters.mainColor)\n\n...\n\n/**\n * 确定按钮\n *\n * 1. 修改主题色\n * 2. 保存最新的主题色\n * 3. 关闭 dialog\n *\n */\nconst comfirm = async () => {\n  // 2. 保存最新的主题色\n  store.commit('theme/setMainColor', mColor.value)\n  // 3. 关闭 dialog\n  closed()\n}\n</script>\n```\n\n## scss mix方法\n```css\n// 给当前的颜色值，添加上 50% 的白色\n.white {\n  color: mix(white, $color, 50%);\n}\n\n// 给当前的颜色值，添加上 50% 的黑色\n.black {\n  color: mix(black, $color, 50%);\n}\n```\n\n## 处理 element-plus 主题色变更原理与步骤分析\n\n对于 `element-plus` 的主题变更，相对比较复杂，所以说整个过程我们会分为三部分：\n\n1. 实现原理\n2. 实现步骤\n3. 实现过程\n\n**实现原理：**\n\n在之前我们分析主题变更的实现原理时，我们说过，核心的原理是：**通过修改 `scss` 变量 ** 的形式修改主题色完成主题变更\n\n但是对于 `element-plus` 而言，我们怎么去修改这样的主题色呢？\n\n其实整体的原理非常简单，分为三步：\n\n1. 获取当前 `element-plus` 的所有样式\n2. 找到我们想要替换的样式部分，通过正则完成替换\n3. 把替换后的样式写入到 `style` 标签中，利用样式优先级的特性，替代固有样式\n\n**实现步骤：**\n\n那么明确了原理之后，我们的实现步骤也就呼之欲出了，对应原理总体可分为四步：\n\n1. 获取当前 `element-plus` 的所有样式\n2. 定义我们要替换之后的样式\n3. 在原样式中，利用正则替换新样式\n4. 把替换后的样式写入到 `style` 标签中\n\n\n**创建 `utils/theme` 工具类，写入两个方法**\n\n```js\n/**\n * 写入新样式到 style\n * @param {*} elNewStyle  element-plus 的新样式\n * @param {*} isNewStyleTag 是否生成新的 style 标签\n */\nexport const writeNewStyle = elNewStyle => {\n  \n}\n\n/**\n * 根据主色值，生成最新的样式表\n */\nexport const generateNewStyle =  primaryColor => {\n \n}\n```\n\n那么接下来我们先实现第一个方法 `generateNewStyle`，在实现的过程中，我们需要安装两个工具类：\n\n1. [rgb-hex](https://www.npmjs.com/package/rgb-hex)：转换RGB(A)颜色为十六进制\n2. [css-color-function](https://www.npmjs.com/package/css-color-function)：在 CSS 中 Tab Atkins 提出的颜色函数的解析器和转换器。\n\n**示例**\n```js\nimport rgbHex from 'rgb-hex'\n\nrgbHex(65, 131, 196);\n//=> '4183c4'\n\nrgbHex('rgb(40, 42, 54)');\n//=> '282a36'\n\nrgbHex(65, 131, 196, 0.2);\n//=> '4183c433'\n\nrgbHex(40, 42, 54, '75%');\n//=> '282a36bf'\n\nrgbHex('rgba(40, 42, 54, 75%)');\n//=> '282a36bf'\n\n------------------------------------------------\n\nimport color from 'css-color-function'\n \ncolor.convert('color(red tint(50%))');\n// \"rgb(255, 128, 128)\"\n```\n\n然后还需要写入一个 **颜色转化计算器  `formula.json`**，这里主要是以 `primary` 色值为例\n\n创建 `constants/formula.json` \n\n```json\n{\n  \"shade-1\": \"color(primary shade(10%))\",\n  \"light-1\": \"color(primary tint(10%))\",\n  \"light-2\": \"color(primary tint(20%))\",\n  \"light-3\": \"color(primary tint(30%))\",\n  \"light-4\": \"color(primary tint(40%))\",\n  \"light-5\": \"color(primary tint(50%))\",\n  \"light-6\": \"color(primary tint(60%))\",\n  \"light-7\": \"color(primary tint(70%))\",\n  \"light-8\": \"color(primary tint(80%))\",\n  \"light-9\": \"color(primary tint(90%))\",\n  \"subMenuHover\": \"color(primary tint(70%))\",\n  \"subMenuBg\": \"color(primary tint(80%))\",\n  \"menuHover\": \"color(primary tint(90%))\",\n  \"menuBg\": \"color(primary)\"\n}\n```\n\n我们来看下 element plus 定义的 `primary` 变量，`light-i` 表示颜色的深浅。\n\n![](/img/primary.png)\n\n如果我们想要定义其它颜色，比如`--el-color-success`，已同样的方法，添加到 `formula.json` 中即可。\n\n同时我们还定义了自己变量在 `formula` 颜色转换器中，因为我们的 `菜单` 部分，也是需要跟着主题色变化的。\n\n**shade tint 方法其实就是利用了 scss 的 mix 方法**，css-color-function 库内部调用进行解析，对某个颜色加深或者淡化！！\n\n```css\n// scss\n\n// 给当前的颜色值，添加上 50% 的白色\n.white {\n  color: mix(white, $color, 50%);\n}\n\n// 给当前的颜色值，添加上 50% 的黑色\n.black {\n  color: mix(black, $color, 50%);\n}\n\n@function tint($color, $parcent) {\n  @return mix(white, $color, $parcent)\n}\n@function shade($color, $parcent) {\n  @return mix(black, $color, $parcent)\n}\n```\n\n准备就绪后，我们来实现 `generateNewStyle` 方法：\n\n```js\n// https://www.npmjs.com/package/css-color-function\nimport color from 'css-color-function'\n\n// https://www.npmjs.com/package/rgb-hex\nimport rgbHex from 'rgb-hex'\nimport axios from 'axios'\nimport formula from '@/constants/formula.json'\n/**\n * 写入新样式到 style\n * @param {*} cssText  element-plus 的新样式\n * @param {*} isNewStyleTag 是否生成新的 style 标签\n */\nexport const writeNewStyle = (cssText: string) => {\n  const style = document.createElement('style')\n  style.innerText = cssText\n  document.head.appendChild(style)\n}\n\n/**\n * 根据主色值，生成最新的样式表\n */\ntype TObject = { [key: string]: string }\nexport const generateNewStyle = async (primaryColor: string) => {\n  // colors ===> { primary: 'rgba(8, 12, 132, 0.68)', shade-1: '#070b77ad', light-1: '#212490ad', ...... }\n  const colors: TObject = generateColors(primaryColor) as TObject\n\n  // 拿到整个 element plus 样式表，并对需要修改的变量打上了标记\n  let cssText = await getOriginalStyle()\n\n  // 遍历生成的样式表，在 CSS 的原样式中进行全局替换\n  Object.keys(colors).forEach(key => {\n    // reg pattern\n    // /(:|\\s+)primary/g\n    // /(:|\\s+)shade-1/g\n    // /(:|\\s+)menuBg/g\n    // ...\n\n    // 这个模式中的 (:|\\\\s+) 表示一个冒号或一个或多个空白字符（包括空格、制表符和换行符）。\n    // \\\\s+ 的第一个 \\ 是转义字符\n    // key 是一个变量，代表一个需要匹配的字符串，比如匹配 `primary`\n\n    // '$1' + colors[key]\n    // 关于为什么要在色值前面加上 $1，我们需要查看 replace 方法的第二个参数。\n    // 在这里，第二个参数是一个字符串，字符串中的 $1 会被替换成第一个括号捕获组（即 (:|\\\\s+)）匹配到的文本。\n    // 所以加上 $1 就是为了在【替换的文本】中【保留原本匹配到的文本】。\n    cssText = cssText.replace(\n      new RegExp('(:|\\\\s+)' + key, 'g'),\n      '$1' + colors[key]\n    )\n  })\n\n  // 最终，新的样式表中，含有我们自定义的颜色主题\n  return cssText\n}\n\n/**\n * 根据主色生成色值表\n */\ntype TFormulaKey = keyof typeof formula\nexport const generateColors = (primary: string) => {\n  if (!primary) return\n  const colors: { [key: string]: string } = {\n    primary\n  }\n\n  ;(Object.keys(formula) as Array<TFormulaKey>).forEach(\n    <K extends TFormulaKey>(key: K) => {\n      // 将所有的主色，替换成我们选中的主题色，形式如 >>> color(rgba(255, 69, 0, 1) shade(10%))\n      const value = formula[key].replace(/primary/g, primary)\n\n      // 通过 color 的 conver 方法，计算出 rgba 色值\n      // color.convert(value)  ===>>>  rgba(0, 12, 230, 0.68)\n\n      // 最终将转为每个颜色，转为十六进制：#030420ad，写入到 colors 对象中，并返回\n      colors[key] = '#' + rgbHex(color.convert(value))\n    }\n  )\n  return colors\n}\n\n/**\n * 获取当前 element-plus 的默认样式表\n */\nconst getOriginalStyle = async () => {\n  const version = require('element-plus/package.json').version\n  const url = `https://unpkg.com/element-plus@${version}/dist/index.css`\n  const { data } = await axios(url)\n\n  // 把获取到的数据筛选为原样式模板\n  return getStyleTemplate(data)\n}\n\n/**\n * 返回 style 的 template\n */\nconst getStyleTemplate = (data: string) => {\n  // element-plus 默认色值\n  const colorMap: { [key: string]: string } = {\n    '#3a8ee6': 'shade-1',\n    '#409eff': 'primary', // element-plus 中含有变量 `--el-color-primary: #409eff`\n    '#53a8ff': 'light-1',\n    '#66b1ff': 'light-2',\n    '#79bbff': 'light-3',\n    '#8cc5ff': 'light-4',\n    '#a0cfff': 'light-5',\n    '#b3d8ff': 'light-6',\n    '#c6e2ff': 'light-7',\n    '#d9ecff': 'light-8',\n    '#ecf5ff': 'light-9'\n  }\n  // 根据默认色值为要替换的色值打上标记\n  Object.keys(colorMap).forEach(key => {\n    const value = colorMap[key]\n    data = data.replace(new RegExp(key, 'ig'), value)\n  })\n\n  // 替换完之后\n  // `--el-color-primary: #409eff` 就变成了 `--el-color-primary: primary`\n  // --el-color-primary-light-3: #79bbff;  变成了  --el-color-primary-light-3: light-3\n  // ...\n  // ...\n  // `--el-color-primary-light-9: #ecf5ff` 变成了 `--el-color-primary-light-9: light-9`\n\n  return data\n}\n```\n\n**我们来分析一下 theme.ts 中函数的执行流程**\n\n1. 首先，外部调用 `generateNewStyle` 方法，传入 primaryColor，我们通过 el-color-picker 选中后的值，就是 `primaryColor`，它的色值长这样 `rgba(8, 12, 132, 0.68)`。\n\n2. 通过 `generateColors` 方法生成色值表\n  1. 通过 `css-color-function` 处理我们的颜色转化计算器`formula.json`\n  ```js\n  color(rgba(255, 69, 0, 1) shade(10%)) >>> color.convert(value) >>> rgba(0, 12, 230, 0.68)\n  ```\n  \n  2. 使用 `rgbHex` 方法将 rgba 转化为十六进制格式\n  ```js\n  rgbHex(color.convert(value))  ===>>>  '#030420ad'\n  ```\n  3. 返回处理过后的色值表 `colors`\n\n  ```js\n  {\n    primary: 'rgba(8, 12, 132, 0.68)', // 保留了原始的rgba格式\n    shade-1: '#070b77ad',\n    light-1: '#212490ad',\n    light-2: '#393d9dad',\n    ......\n  }\n  ```\n3. 通过 `getOriginalStyle` 方法，获取 element plus 样式表\n4. 拿到 element plus 样式数据后，通过 `getStyleTemplate` 方法，根据默认色值 `colorMap` 为要替换的色值打上标记\n  1. element-plus 中含有变量 `--el-color-primary: #409eff`，而我们定义的 colorMap 默认值 `'#409eff': 'primary'` 就是与 element plus 中的十六进制值是对应。\n  2. 我们就是要将 element plus 中的 primary 十六进制值替换成我们的标记，`primary、shade-*`。因为我们已经处理过 `formula.json` 了，处理过后得到的是 **`{ primary: 'rgba(8, 12, 132, 0.68)', shade-1: '#070b77ad', light-1: '#212490ad', ...}`** 这种形式，这里面的色值，就是我们需要应用到页面上的颜色。\n  3. 替换完之后，element plus 中的颜色变量就被标记上了记号，表示将来需要替换成真正的色值。\n  ```js\n  `--el-color-primary: #409eff` 就变成了 `--el-color-primary: primary`\n  `--el-color-primary-light-9: #ecf5ff` 变成了 `--el-color-primary-light-9: light-9`\n  ```\n  4. 返回处理过后的 element plus 样式表 `cssText`\n\n5. 接着，我们通过正则以及第二步 `generateColors` 方法返回的 colors，将 `cssText` 中每个打了标记的变量值替换\n  ```js\n  cssText = cssText.replace(new RegExp('(:|\\\\s+)' + key, 'g'), '$1' + colors[key])\n  ```\n\n  1. 这个模式中的 (:|\\\\s+) 表示一个冒号或一个【或】多个空白字符(\\s+)（包括空格、制表符和换行符）\n  2. \\\\s+ 的第一个 \\ 是转义字符\n  3. key 是一个变量，代表一个需要匹配的字符串，比如匹配 `primary`\n  4. `'$1' + colors[key]`: replace 第二个参数是一个字符串，字符串中的 $1 会被替换成第一个括号捕获组（即 (:|\\\\s+)）匹配到的文本。所以加上 $1 就是为了在【替换的文本】中【保留原本匹配到的文本】。\n  5. 最后返回 cssText，新的样式表中，含有我们自定义的颜色主题\n\n6. 最后，通过 `writeNewStyle` 将新的样式表 `cssText` 插入到文档中。\n  ```js\n  const style = document.createElement('style')\n  style.innerText = cssText\n  document.head.appendChild(style)\n  ```\n\n**总结**\n\n到这里，我们对 `element plus` 的主题换肤就完成了。\n\n原理就是：拿到用户选中的颜色值(rgba)，通过 formula 颜色转换器转换成十六进制表 colors，然后拿到 `element plus` 的样式表，将其中需要修改的变量打上标记并返回含有标记的新样式表 cssText，最后，遍历 colors，通过正则将所有标记替换成 colors 中的值。完成样式的替换。\n\n## element-plus 新主题的立即生效\n\n到目前我们已经完成了 `element-plus` 的主题变更，但是当前的主题变更还有一个小问题，那就是：**在刷新页面后，新主题会失效**\n\n那么出现这个问题的原因，非常简单：**因为没有写入新的 `style`**\n\n所以我们只需要在 **应用加载后，写入 `style` 即可**\n\n那么写入的时机，我们可以放入到 `app.vue` 中\n\n```js\n<script setup>\nimport { useStore } from 'vuex'\nimport { generateNewStyle, writeNewStyle } from '@/utils/theme'\n\nconst store = useStore()\ngenerateNewStyle(store.getters.mainColor).then(newStyleText => {\n  writeNewStyle(newStyleText)\n})\n</script>\n```\n\n## 自定义主题变更\n\n自定义主题变更相对来说比较简单，因为 **自己的代码更加可控**。\n\n目前在我们的代码中，需要进行 **自定义主题变更** 为  **`menu` 菜单背景色**\n\n而目前指定 `menu` 菜单背景色的位置在 `layout/components/sidebar/SidebarMenu.vue` 中\n\n```js\n  <el-menu\n    :default-active=\"activeMenu\"\n    :collapse=\"!$store.getters.sidebarOpened\"\n    :background-color=\"$store.getters.cssVar.menuBg\"\n    :text-color=\"$store.getters.cssVar.menuText\"\n    :active-text-color=\"$store.getters.cssVar.menuActiveText\"\n    :unique-opened=\"true\"\n    router\n  >\n```\n\n此处的 背景色是通过 `getters` 进行指定的，该 `cssVar` 的 `getters` 为：\n\n```js\ncssVar: state => variables,\n```\n\n所以，我们想要修改 **自定义主题** ，只需要从这里入手即可。\n\n**根据当前保存的 `mainColor` 覆盖原有的默认色值**\n\n```js\nimport variables from '@/styles/variables.scss'\nimport { MAIN_COLOR } from '@/constant'\nimport { getItem } from '@/utils/storage'\nimport { generateColors } from '@/utils/theme'\n\nconst getters = {\n  ...\n  cssVar: state => {\n    return {\n      ...variables,\n      ...generateColors(getItem(MAIN_COLOR))\n    }\n  },\n  ...\n}\nexport default getters\n\n```\n\n但是我们这样设定之后，整个自定义主题变更，还存在两个问题：\n\n1. `menuBg` 背景颜色没有变化\n\n这个问题是因为咱们的 `sidebar` 的背景色未被替换，所以我们可以在 `layout/index` 中设置 `sidebar` 的 `backgroundColor`\n\n```html\n<sidebar\n  id=\"guide-sidebar\"\n  class=\"sidebar-container\"\n  :style=\"{ backgroundColor: $store.getters.cssVar.menuBg }\"\n/>\n```\n\n2. 主题色替换之后，需要刷新页面才可响应\n\n这个是因为 `getters` 中没有监听到 **依赖值的响应变化**，所以我们希望修改依赖值\n\n在 `store/modules/theme` 中\n\n```js\n...\nimport variables from '@/styles/variables.scss'\nexport default {\n  namespaced: true,\n  state: () => ({\n    ...\n    variables\n  }),\n  mutations: {\n    /**\n     * 设置主题色\n     */\n    setMainColor(state, newColor) {\n      ...\n      state.variables.menuBg = newColor\n      ...\n    }\n  }\n}\n\n```\n\n在 `getters` 中\n\n```js\n....\n\nconst getters = {\n ...\n  cssVar: state => {\n    return {\n      ...state.theme.variables,\n      ...generateColors(getItem(MAIN_COLOR))\n    }\n  },\n  ...\n}\nexport default getters\n\n```\n\n那么到这里整个自定义主题我们就处理完成了。\n\n对于 **自定义主题而言**，核心的原理其实就是 **修改`scss`变量来进行实现主题色变化** \n\n明确好了原理之后，对后续实现的步骤就具体情况具体分析了。\n\n1. 对于 `element-plus`：因为 `element-plus` 是第三方的包，所以它 **不是完全可控** 的，那么对于这种最简单直白的方案，就是直接拿到它编译后的 `css` 进行色值替换，利用 `style` **内部样式表** 优先级高于 **外部样式表** 的特性，来进行主题替换\n2. 对于自定义主题：因为自定义主题是 **完全可控** 的，所以我们实现起来就轻松很多，只需要修改对应的 `scss`变量即可\n\n那么在之后大家遇到 **自定义主题** 的处理时，就可以按照这里所梳理的方案进行处理了。\n\n# 结束语\n\n这一章我们花了大量的篇幅来介绍换肤的原理以及业务场景如何实现换肤，篇幅有点长，就不在此添加其他功能的描述了。\n\n如下功能我们放到下一章节去实现：\n\n- screenfull\n- headerSearch\n- tagView\n- guide\n\n# 参考链接\n\n- [CSS变量教程](https://www.ruanyifeng.com/blog/2017/05/css-variables.html)\n\n","source":"_posts/vue3-project-generalModule.md","raw":"---\nlayout: Vue3\ntitle: Vue3项目实战(五)：通用功能开发（一）\ndate: 2022-12-29 11:00:23\ntags: 工程化,Vue3,通用功能\nbanner_img: /img/theme.png\nindex_img: /img/theme.png\nexcerpt: 国际化/换肤\n---\n\n# 通用功能\n\n1. 国际化\n2. 动态换肤\n3. `screenfull`\n4. `headerSearch`\n5. `tagView`\n6. `guide`\n\n# 国际化实现原理\n\n先来看一个需求：\n\n> 我们有一个变量 `msg` ，但是这个 `msg` 有且只能有两个值：\n>\n> 1. hello world\n> 2. 你好世界\n>\n> 要求：根据需要切换 `msg` 的值\n\n这样的一个需求就是 国际化 的需求，那么我们可以通过以下代码来实现这个需求\n\n```js\n<script>\n  // 1. 定义 msg 值的数据源\n  const messages = {\n    en: {\n      msg: 'hello world'\n    },\n    zh: {\n      msg: '你好世界'\n    }\n  }\n  // 2. 定义切换变量\n  let locale = 'en'\n  // 3. 定义赋值函数\n  function t(key) {\n    return messages[locale][key]\n  }\n  // 4. 为 msg 赋值 \n  let msg = t('msg')\n  console.log(msg);\n  // 修改 locale， 重新执行 t 方法，获取不同语言环境下的值\n\n</script>\n```\n\n总结：\n\n1. 通过一个变量来 **控制** 语言环境\n2. 所有语言环境下的数据源要 **预先** 定义好\n3. 通过一个方法来获取 **当前语言** 下 **指定属性** 的值\n4. 该值即为国际化下展示值\n\n## 基于 vue-i18n V9  的国际化实现方案分析\n\n在 `vue` 的项目中，我们不需要手写这么复杂的一些基础代码，可以直接使用 [vue-i18n](https://vue-i18n.intlify.dev/) 进行实现（注意：**`vue3` 下需要使用 `V 9.x` 的 `i18n`**）\n\n[vue-i18n](https://vue-i18n.intlify.dev/guide/) 的使用可以分为四个部分：\n\n1. 创建 `messages` 数据源\n2. 创建 `locale` 语言变量\n3. 初始化 `i18n` 实例\n4. 注册 `i18n` 实例\n\n那么接下来我们就去实现以下：\n\n1. 安装 `vue-i18n`\n```js\n  npm install vue-i18n@next\n```\n\n\n2. 创建 `i18n/index.js` 文件\n\n3. 创建 `messages` 数据源\n\n   ```js\n   const messages = {\n     en: {\n       msg: {\n         test: 'hello world'\n       }\n     },\n     zh: {\n       msg: {\n         test: '你好世界'\n       }\n     }\n   }\n   ```\n\n4. 创建 `locale` 语言变量\n\n   ```js\n   const locale = 'en'\n   ```\n\n5. 初始化 `i18n` 实例\n\n   ```js\n   import { createI18n } from 'vue-i18n'\n   \n   const i18n = createI18n({\n     // 使用 Composition API 模式，则需要将其设置为false\n     legacy: false,\n     // 全局注入 $t 函数\n     globalInjection: true,\n     locale,\n     messages\n   })\n   ```\n\n6. 把 `i18n` 注册到 `vue` 实例\n\n   ```js\n   export default i18n\n   ```\n\n7. 在 `main.js` 中导入\n\n   ```js\n   // i18n （PS：导入放到 APP.vue 导入之前，因为后面我们会在 app.vue 中使用国际化内容）\n   import i18n from '@/i18n'\n   ...\n   app.use(i18n)\n   ```\n\n8. 在 `layout/components/Sidebar/index.vue` 中使用 `i18n`\n\n   ```html\n   <h1 class=\"logo-title\" v-if=\"$store.getters.sidebarOpened\">\n           {{ $t('msg.test') }}\n   </h1>\n   ```\n\n9. 修改 `locale` 的值，即可改变展示的内容\n\n截止到现在我们已经实现了 `i18n` 的最基础用法，那么解下来我们就可以在项目中使用 `i18n` 完成国际化。\n\n项目中完成国际化分成以下几步进行:\n\n1. 封装 `langSelect` 组件用于修改 `locale`\n2. 导入 `el-locale` 语言包\n3. 创建自定义语言包\n\n## 封装  langSelect  组件\n\n1. 定义 `store/app.js`\n\n   ```js\n   import { LANG } from '@/constant'\n   import { getItem, setItem } from '@/utils/storage'\n   export default {\n     namespaced: true,\n     state: () => ({\n       ...\n       language: getItem(LANG) || 'zh'\n     }),\n     mutations: {\n       ...\n       /**\n        * 设置国际化\n        */\n       setLanguage(state, lang) {\n         setItem(LANG, lang)\n         state.language = lang\n       }\n     },\n     actions: {}\n   }\n   \n   ```\n\n   \n\n2. 在 `constant` 中定义常量\n\n   ```js\n   // 国际化\n   export const LANG = 'language'\n   ```\n\n\n3. 创建 `components/LangSelect/index` \n\n   ```js\n   <template>\n     <el-dropdown\n       trigger=\"click\"\n       class=\"international\"\n       @command=\"handleSetLanguage\"\n     >\n       <div>\n         <el-tooltip content=\"国际化\" :effect=\"effect\">\n           <svg-icon icon=\"language\" />\n         </el-tooltip>\n       </div>\n       <template #dropdown>\n         <el-dropdown-menu>\n           <el-dropdown-item :disabled=\"language === 'zh'\" command=\"zh\">\n             中文\n           </el-dropdown-item>\n           <el-dropdown-item :disabled=\"language === 'en'\" command=\"en\">\n             English\n           </el-dropdown-item>\n         </el-dropdown-menu>\n       </template>\n     </el-dropdown>\n   </template>\n   \n   <script setup>\n   import { useI18n } from 'vue-i18n'\n   import { defineProps, computed } from 'vue'\n   import { useStore } from 'vuex'\n   import { ElMessage } from 'element-plus'\n   \n   defineProps({\n     effect: {\n       type: String,\n       default: 'dark',\n       validator: function(value) {\n         // 这个值必须匹配下列字符串中的一个\n         return ['dark', 'light'].indexOf(value) !== -1\n       }\n     }\n   })\n   \n   const store = useStore()\n   const language = computed(() => store.getters.language)\n   \n   // 切换语言的方法\n   const i18n = useI18n()\n   const handleSetLanguage = lang => {\n     i18n.locale.value = lang\n     store.commit('app/setLanguage', lang)\n     ElMessage.success('更新成功')\n   }\n   </script>\n   ```\n\n4. 在 `navbar` 中导入 `LangSelect`\n\n   ```js\n   <template>\n     <div class=\"navbar\">\n       ...\n       <div class=\"right-menu\">\n         <lang-select class=\"right-menu-item hover-effect\" />\n         <!-- 头像 -->\n         ...\n       </div>\n     </div>\n   </template>\n   \n   <script setup>\n   import LangSelect from '@/components/LangSelect'\n   ...\n   </script>\n   \n   <style lang=\"scss\" scoped>\n   .navbar {\n     ...\n   \n     .right-menu {\n       ...\n   \n       ::v-deep .right-menu-item {\n         display: inline-block;\n         padding: 0 18px 0 0;\n         font-size: 24px;\n         color: #5a5e66;\n         vertical-align: text-bottom;\n   \n         &.hover-effect {\n           cursor: pointer;\n         }\n       }\n   \n       ...\n   }\n   </style>\n   \n   ```\n\n## element-plus 国际化处理\n\n截止到目前，我们的国际化内容已经基本功能已经处理完成了。接下来需要处理的就是对应的语言包，有了语言包就可以实现整个项目中的所有国际化处理了。\n\n那么对于语言包来说，我们整个项目中会分成两部分：\n\n1. `element-plus` 语言包：用来处理 `element` 组件的国际化功能\n2. 自定义语言包：用来处理 **非**`element` 组件的国际化功能\n\n那么首先我们先来处理 `element-plus` 语言包：\n\n3. 在 `plugins/index` 中导入 `element` 的中文、英文语言包：\n\n```js\nimport zhCn from 'element-plus/es/locale/lang/zh-cn'\nimport en from 'element-plus/lib/locale/lang/en'\n```\n\n4. 注册 `element` 时，根据当前语言选择使用哪种语言包\n\n   ```js\n   import store from '@/store'\n   \n   export default app => {\n     app.use(ElementPlus, {\n       locale: store.getters.language === 'en' ? en : zhCn\n     })\n   }\n   ```\n\n   \n\n\n\n## 自定义语言包国际化处理\n\n处理完 `element` 的国际化内容之后，接下来我们来处理 **自定义语言包**。\n\n1.  在本地创建 `lang` 文件夹，里面创建好本地需要的语言包，由于比较多，就放一部分来看看：\n\n```js\n// en.ts\nexport default {\n  login: {\n    title: 'User Login',\n    loginBtn: 'Login',\n    usernameRule: 'Username is required',\n    passwordRule: 'Password cannot be less than 6 digits',\n  },\n  // other....\n}\n\n// zh.ts\nexport default {\n  login: {\n    title: '用户登录',\n    loginBtn: '登录',\n    usernameRule: '用户名为必填项',\n    passwordRule: '密码不能少于6位',\n  },\n  // other...\n}\n```\n\n2. 在 `lang/index` 中，导入语言包\n\n  ```js\n  import mZhLocale from './lang/zh'\n  import mEnLocale from './lang/en'\n  ```\n\n3. 在 `messages` 中注册到语言包\n\n   ```js\n   const messages = {\n     en: {\n       msg: {\n         ...mEnLocale\n       }\n     },\n     zh: {\n       msg: {\n         ...mZhLocale\n       }\n     }\n   }\n   ```\n\n## 处理项目国际化内容\n\n在处理好了国际化的语言包之后，接下来我们就可以应用国际化功能到我们的项目中\n\n对于我们目前的项目而言，需要进行国际化处理的地方主要分为：\n\n1. 登录页面\n2. `navbar` 区域\n3. `sidebar` 区域\n4. 面包屑区域\n\n那么这一小节，我们先来处理前两个\n\n**登录页面：**\n\n`login/index`\n\n```js\n<template>\n  <div class=\"login-container\">\n    ...\n      <div class=\"title-container\">\n        <h3 class=\"title\">{{ $t('msg.login.title') }}</h3>\n          <lang-select class=\"lang-select\" effect=\"light\"></lang-select>\n      </div>\n\n      ...\n\n      <el-button\n        type=\"primary\"\n        style=\"width: 100%; margin-bottom: 30px\"\n        :loading=\"loading\"\n        @click=\"handleLogin\"\n        >{{ $t('msg.login.loginBtn') }}</el-button\n      >\n      \n      <div class=\"tips\" v-html=\"$t('msg.login.desc')\"></div>\n    </el-form>\n  </div>\n</template>\n\n<script setup>\nimport { useI18n } from 'vue-i18n'\n...\n// 验证规则\nconst i18n = useI18n()\nconst loginRules = ref({\n  username: [\n    {\n      ...\n      message: i18n.t('msg.login.usernameRule')\n    }\n  ],\n  ...\n})\n...\n</script>\n\n\n```\n\n`login/rules`\n\n```js\nimport i18n from '@/i18n'\nexport const validatePassword = () => {\n  return (rule, value, callback) => {\n    if (value.length < 6) {\n      callback(new Error(i18n.global.t('msg.login.passwordRule')))\n    } else {\n      callback()\n    }\n  }\n}\n\n```\n\n **`navbar` 区域**\n\n`layout/components/navbar`\n\n```js\n<template>\n  <div class=\"navbar\">\n    ...\n        <template #dropdown>\n          <el-dropdown-menu class=\"user-dropdown\">\n            <router-link to=\"/\">\n              <el-dropdown-item> {{ $t('msg.navBar.home') }} </el-dropdown-item>\n            </router-link>\n            <a target=\"_blank\" href=\"\">\n              <el-dropdown-item>{{ $t('msg.navBar.course') }}</el-dropdown-item>\n            </a>\n            <el-dropdown-item divided @click=\"logout\">\n              {{ $t('msg.navBar.logout') }}\n            </el-dropdown-item>\n          </el-dropdown-menu>\n        </template>\n      </el-dropdown>\n    </div>\n  </div>\n</template>\n```\n\n`components/LangSelect/index`\n\n```js\n<el-tooltip :content=\"$t('msg.navBar.lang')\" :effect=\"effect\">\n\nconst handleSetLanguage = lang => {\n  ...\n  ElMessage.success(i18n.t('msg.toast.switchLangSuccess'))\n}\n```\n\n## sidebar 与 面包屑 区域的国际化处理\n\n**sidebar 区域**\n\n目前对于 `sidebar` 而言，显示的文本是我们在定义路由表时的 `title`\n\n```html\n<span>{{ title }}</span>\n```\n\n我们可以 **把 `title` 作为语言包内容的 `key` 进行处理**\n\n创建 `utils/i18n` 工具模块，用于 **将 `title` 转化为国际化内容**\n\n```js\nimport i18n from '@/i18n'\nexport function generateTitle(title) {\n  return i18n.global.t('msg.route.' + title)\n}\n\n```\n\n在 `layout/components/Sidebar/MenuItem.vue` 中导入该方法：\n\n```js\n<template>\n  ...\n  <span>{{ generateTitle(title) }}</span>\n</template>\n\n<script setup>\nimport { generateTitle } from '@/utils/i18n'\n...\n</script>\n\n```\n\n最后修改下 `sidebarHeader` 的内容\n\n```js\n<h1 class=\"logo-title\" v-if=\"$store.getters.sidebarOpened\">\n  {{ $t('msg.logo') }}\n</h1>\n```\n\n**面包屑区域：**\n\n在 `components/Breadcrumb/index`\n\n```js\n<template>\n...\n    <!-- 不可点击项 -->\n    <span v-if=\"index === breadcrumbData.length - 1\" class=\"no-redirect\">{{\n        generateTitle(item.meta.title)\n        }}</span>\n    <!-- 可点击项 -->\n    <a v-else class=\"redirect\" @click.prevent=\"onLinkClick(item)\">{{\n        generateTitle(item.meta.title)\n        }}</a>\n...\n</template>\n\n<script setup>\nimport { generateTitle } from '@/utils/i18n'\n...\n</script>\n\n```\n\n## 国际化缓存处理\n\n我们希望在 **刷新页面后，当前的国际化选择可以被保留**，所以想要实现这个功能，那么就需要进行 **国际化的缓存处理**\n\n此处的缓存，我们依然通过两个方面进行：\n\n1. `vuex` 缓存\n2. `LocalStorage` 缓存\n\n只不过这里的缓存，我们已经在处理 **`langSelect` 组件时** 处理完成了，所以此时我们只需要使用缓存下来的数据即可。\n\n在 `i18n/index` 中，创建 `getLanguage` 方法：\n\n```js\nimport store from '@/store'\n/**\n * 返回当前 lang\n */\nfunction getLanguage() {\n  return store && store.getters && store.getters.language\n}\n```\n\n修改 `createI18n` 的 `locale` 为 `getLanguage()` \n\n```js\nconst i18n = createI18n({\n  ...\n  locale: getLanguage()\n})\n```\n\n## 国际化方案总结\n\n国际化是前端项目中的一个非常常见的功能，那么在前端项目中实现国际化主要依靠的就是 `vue-i18n` 这个第三方的包。\n\n关于国际化的实现原理大家可以参照 **国际化实现原理** 这一小节，这里我们就不再赘述了。\n\n而  `i18n` 的使用，整体来说就分为这么四步：\n\n1. 创建 `messages` 数据源\n2. 创建 `locale` 语言变量\n3. 初始化 `i18n` 实例\n4. 注册 `i18n` 实例\n\n核心的内容其实就是 数据源的部分，但是大家需要注意，如果你的项目中使用了 **第三方组件库** ，那么不要忘记 **第三方组件库的数据源** 需要 **单独** 进行处理！\n\n# 动态换肤原理分析\n\n想要实现 **动态换肤** 的一个前置条件就是：**色值不可以写死！**\n\n首先我们先来说一下动态换肤的实现方式。\n\n在 `scss` 中，我们可以通过 `$变量名:变量值` 的方式定义 `css 变量` ，然后通过该 `css` 来去指定某一块 `DOM` 对应的颜色。\n\n那么大家可以想一下，如果我此时改变了该 `css` 变量的值，那么对应的 `DOM` 颜色是不是也会同步发生变化。\n\n当大量的 `DOM` 都依赖这个 `css 变量` 设置颜色时，我们是不是只需要改变这个 `css 变量` ，那么所有 `DOM` 的颜色是不是都会发生变化，所谓的 **动态换肤** 是不是就可以实现了！\n\n这个就是 **动态换肤** 的实现原理!\n\n实现换肤和主题大致有两种方案:\n\n1. 使用原生支持的 css var\n2. 通过一些手段覆盖 element plus 样式\n\n我们先看来看看 css var 的实现吧。\n\n## css变量\n\n> https://developer.mozilla.org/zh-CN/docs/Web/CSS/:root\n\n变量 与 color、font-size 等正式属性没有什么不同，只是没有默认含义。\n\n所以 CSS 变量（CSS variable）又叫做\"CSS 自定义属性\"（CSS custom properties）。因为变量与自定义的 CSS 属性其实是一回事。\n\n\n变量可以分为\n\n- 全局变量\n- 局部变量\n\n**全局变量**\n通过 `:root` 去定义，其他所有的元素都可以通过 `var(--xxx)` 的形式去使用`全局变量`，我们来看下面这个例子:\n\n> var()函数还可以使用第二个参数，表示变量的默认值。如果该变量不存在，就会使用这个默认值。\n\n```js\n<style>\n  :root {\n    --color: skyblue;\n  }\n\n  .use-global {\n    color: var(--color)\n  }\n</style>\n\n// body\n<div class=\"use-global\">使用了全局变量</div>\n```\n**:root**\n> :root 这个 CSS 伪类匹配文档树的根元素。对于 HTML 来说，:root 表示 <html> 元素，除了优先级更高之外，与 html 选择器相同。\n\n**自定义属性 (--*)：CSS 变量**\n\n> 带有前缀--的属性名，比如--example--name，表示的是带有值的自定义属性，其可以通过 var 函数在全文档范围内复用的。\n\n**局部变量**\n\n我们可以在某个选择器下去定义变量，或者在元素的 `style` 属性上定义变量：\n\n```js\n// style\n:root {\n  --color: skyblue;\n}\n\n.parent {\n  --color: pink; // 优先级更高\n}\n\nh3 {\n  color: var(--color)\n}\n\n// html\n<div class=\"parent\">\n  <h3>child title</h3>\n</div>\n```\n\n这里 `h3` 标签会显示红色。虽然我们在 `:root` 上也定义了 `--color` 变量，但是根据就近原则，`h3` 会取父级定义的变量。\n\n我们还可以在 `style` 属性上定义变量，这里我们定义了一个 `--bg` 变量，其子元素可以访问到这个变量。\n\n```js\n.parent {\n  --color: pink;\n}\n\nh3 {\n  color: var(--color);\n  background-color: var(--bg);\n}\n\n<div class=\"parent\" style=\"--bg: black;\">\n  <h3>child title</h3>\n</div>\n```\n\n## 修改 css 变量\n\n这里定义了两个按钮，一个修改全局的（根组件）的变量，一个用来修改特定元素上的定义的变量：\n\n```js\n<button class=\"btn\">change root</button>\n<button class=\"variable\">change local variable</button>\n```\n\n**修改全局变量**\n```js\nconst btn = document.querySelector('.btn')\n\nbtn.addEventListener('click', () => {\n  const html = document.documentElement\n\n  html.style.setProperty('--color', 'red')\n})\n```\n\n**修改局部变量**\n\n```js\nconst variableBtn = document.querySelector('.variable')\n\nvariableBtn.addEventListener('click', () => {\n  const parent = document.querySelector('.parent')\n\n  parent.style.setProperty('--color', 'green')\n})\n```\n\n# 暗黑模式原理分析\n\n> prefers-color-scheme\n>\n> prefers-color-scheme CSS 媒体特性: 用于检测用户是否有将系统的主题色设置为亮色或者暗色。\n\n## 主题色实现原理\n\n通过 `媒体查询` 去监听系统主题色的变化。\n\n```js\n// style\n@media (prefers-color-scheme: dark) {\n  .day.dark-scheme   { background:  #333; color: white; }\n  .night.dark-scheme { background: black; color:  red; }\n}\n\n@media (prefers-color-scheme: light) {\n  .day.light-scheme   { background: skyblue; color:  #333; }\n  .night.light-scheme { background:  pink; color: #333; }\n}\n\n.day, .night {\n  display: inline-block;\n  padding: 1em;\n  width: 7em;\n  height: 7em;\n  vertical-align: middle;\n}\n\n// html\n<div class=\"day light-scheme\">Day (changes in light scheme)</div>\n<div class=\"day dark-scheme\">Day (changes in dark scheme)</div> <br>\n\n<div class=\"night light-scheme\">Night (changes in light scheme)</div>\n<div class=\"night dark-scheme\">Night (changes in dark scheme)</div>\n```\n\n现在，我们可以去切换系统的主题色，就会发现页面上的颜色跟着变化了，这是因为我们通过 `@media` 监听 `prefers-color-scheme` 起作用了。\n\n## window.matchMedia\n\n虽然我们通过 css @media 能够应对系统的主题色切换，但是我们如何在 `js` 中去监听呢？\n\n答案是通过 `window.matchMedia` 方法：\n\n```js\n// 如果匹配成功，scheme.matches === true\n// 也就是说，如果我们的系统是暗黑色，那么这个 matches 就是true，否则是 false\nconst scheme = window.matchMedia('(prefers-color-scheme: dark)')\n\nscheme.addEventListener('change', e => {\n  if (e.matches) {\n    // 暗黑色\n  } else {\n    // 亮色\n  }\n})\n```\n\n## 修改主题色\n\n到此，我们知道了主题色的实现原理，我们如何在项目里去实现主题色的切换呢？\n\n我们来看一个小例子\n\n首先，我们先定义好 `全局变量`，里面包含了一些 `亮色模式` 下的变量：\n\n```js\n:root {\n  --color: #333;\n  --background-color: pink;\n}\n\n<h1 style=\"background-color: var(--background-color); color: var(--color)\">\n  我是一个标题。！！！\n</h1>\n\n<button class=\"dark-btn\">dark mode</button>\n```\n\n在页面初始时，我们的背景色是粉色，颜色是浅黑色。\n\n现在我们创建一个按钮，来修改主题颜色，这个之前实现过了很简单对吧。\n\n```js\nconst darkBtn = document.querySelector('.dark-btn')\n\ndarkBtn.addEventListener('click', () => {\n  // 修改变量\n  document.documentElement.style.setProperty('--color', '#fff')\n  document.documentElement.style.setProperty('--background-color', '#000')\n})\n```\n\n好无疑问这样是可以实现的，但是，如果变量多起来了，几十上百个，我们也要一个个去修改吗？\n\n既然我们的变量都定义在根元素上，那么我们可以采取 **属性覆盖** 的形式。\n\n我们定义一个 `[data-theme=\"dark\"]` 样式表，专门用来处理 `暗黑模式` 下的变量，这里是黑色背景白色字体。\n\n```js\n[data-theme=\"dark\"] {\n  --color: #fff;\n  --background-color: #000;\n}\n```\n\n或者属性选择器：\n\n```js\n/* 浅色模式 */\nhtml[data-theme=\"light\"]:root {\n  --body-background: #efefef;\n  --text-color: #333;\n}\n\n/* 深色模式 */\nhtml[data-theme=\"dark\"]:root {\n  --body-background: #000;\n  --text-color: #ededed;\n}\n```\n\n一开始，这个样式表并不会生效，因为根标签上根本没有 `data-theme=\"dark\"` 属性，我们通过按钮来修改：\n\n```js\ndarkBtn.addEventListener('click', () => {\n  document.documentElement.setAttribute('data-theme', 'dark')\n})\n```\n\n我们给根标签设置了 `data-theme=\"dark\"` 属性，同时内部定了暗黑相关的变量，这时，`data-theme=\"dark\"` 内部的变量就会覆盖 `:root` 中的变量了，从而达到切换主题色的效果。\n\n同时，我们需要根据系统的主题色，来设置项目的主题色，这里就要用到 `window.matchMedia` 方法了。\n\n如果在 `Vue` 项目中，我们可以这样去实现:\n\n```js\nconst theme = computed(() => store.state.settings.theme);\n\n// 查看当前是否是 暗黑模式\nconst mediaQueryListDark = window.matchMedia('(prefers-color-scheme: dark)');\n\nconst changeTheme = (theme) => {\n  // 批量覆盖全局的变量\n\tdocument.documentElement.setAttribute('data-theme', theme);\n};\n\nconst handleColorSchemeChange = evt => {\n  if (evt.matches) {\n    changeTheme('dark');\n  } else {\n    changeTheme('light');\n  }\n};\n\nwatchEffect(() => {\n  if (theme.value === 'Follow System') {\n    // 初始值：跟随系统设置\n    handleColorSchemeChange(mediaQueryListDark);\n\n    // 监听系统主题的变化\n    mediaQueryListDark.addEventListener('change', handleColorSchemeChange);\n  } else if (theme.value) {\n    changeTheme(theme.value.toLowerCase());\n\n    // 如果不是跟随系统设置主题了，用户自己设置的主题色，我们就不需要监听系统的主题色切换了\n    mediaQueryListDark.removeEventListener('change', handleColorSchemeChange);\n  }\n});\n```\n\n## 总结\n\n到这里，我们花了大量的时间和实例对换肤和主题的原理进行了研究，那么接下来就要进入正式的项目开发环节了。\n\n\n# 官方换肤方案\n> 官方样式路径：/node_modules/element-plus/theme-chalk/src/common/var.scss\n\n定义自己的 scss 文件，然后在 main.ts 导入。\n\n```css\n$--colors: (\n  \"primary\": (\n    \"base\": pink,\n  ),\n  \"success\": (\n    \"base\": blue,\n  ),\n  \"warning\": (\n    \"base\": #f2711c,\n  ),\n  \"danger\": (\n    \"base\": #db2828,\n  ),\n  \"error\": (\n    \"base\": #db2828,\n  ),\n  \"info\": (\n    \"base\": #42b8dd,\n  ),\n);\n\n@forward 'element-plus/theme-chalk/src/common/var.scss' with (\n  $colors: $--colors,\n);\n\n/* 导入所有的样式变量 */\n@use \"element-plus/theme-chalk/src/index.scss\" as *;\n```\n\n修改 `main.ts`\n\n```css\n// 注释原导入的 element-plus 样式\n// import 'element-plus/dist/index.css'\n\n\n// 导入我们自己的定义的样式\nimport '@/styles/cover-element-plus.scss'\n```\n\n## 通过 CSS 变量设置\n如果不通过上面那种方案，我们还可以定义全局的变量，来覆盖官方的样式。\n\n在自己的样式文件中写入需要覆盖的样式变量：\n\n```css\n:root {\n  --el-color-primary: green;\n}\n```\n\n如果你只想自定义一个特定的组件，只需为某些组件单独添加内联样式。\n\n```css\n<el-tag style=\"--el-tag-bg-color: red\">Tag</el-tag>\n```\n\n出于性能原因，更加推荐你在类名下添加自定义 css 变量，而不是在全局的 :root 下。\n\n```css\n.custom-class {\n  --el-tag-bg-color: red;\n}\n```\n\n如果您想要通过 js 控制 css 变量，可以这样做：\n\n```css\n// document.documentElement 是全局变量时\nconst el = document.documentElement\n// const el = document.getElementById('xxx')\n\n// 获取 css 变量\ngetComputedStyle(el).getPropertyValue(`--el-color-primary`)\n\n// 设置 css 变量\nel.style.setProperty('--el-color-primary', 'red')\n```\n\n## 总结。\n相当于我们重新定义了变量，覆盖了官方自己定义的变量，如果我们项目只需要一种颜色，那么这种方案是可行的，但是我们项目需要支持用户选择主题来替换，那么这种方案就不适用了。\n\n那么我来用另一种方案来实现吧。\n\n# 换肤方案落地\n\n在我们的项目中想要实现动态换肤，需要同时处理两个方面的内容：\n\n1. `element-plus` 主题\n2. 非 `element-plus` 主题\n\n明确好了原理之后，接下来我们就来理一下咱们的实现思路。\n\n从原理中我们可以得到以下两个关键信息：\n\n1. 动态换肤的关键是修改 `css 变量` 的值\n2. 换肤需要同时兼顾\n  1. `element-plus` \n  2. 非 `element-plus` \n\n那么根据以上关键信息，我们就可以得出对应的实现方案:\n\n1. 创建一个组件 `ThemeSelect` 用来处理修改之后的 `css 变量` 的值\n2. 根据新值修改 `element-plus`  主题色\n3. 根据新值修改非 `element-plus`  主题色\n\n## 创建 ThemeSelect 组件\n\n`ThemeSelect` 组件将由两部分组成：\n\n1. `navbar` 中的展示图标\n2. 选择颜色的弹出层\n\n这是效果图：\n\n![](/img/theme-select.png)\n\n**创建 `components/ThemeSelect/index` 组件**\n\n```js\n<template>\n  <!-- 主题图标 v-bind：https://v3.cn.vuejs.org/api/instance-properties.html#attrs -->\n  <el-dropdown\n    v-bind=\"$attrs\"\n    trigger=\"click\"\n    class=\"theme\"\n    @command=\"handleSetTheme\"\n  >\n    <div>\n      <el-tooltip :content=\"$t('msg.navBar.themeChange')\">\n        <svg-icon icon=\"change-theme\" />\n      </el-tooltip>\n    </div>\n    <template #dropdown>\n      <el-dropdown-menu>\n        <el-dropdown-item command=\"color\">\n          {{ $t('msg.theme.themeColorChange') }}\n        </el-dropdown-item>\n      </el-dropdown-menu>\n    </template>\n  </el-dropdown>\n\n  <!-- 展示弹出层 -->\n  <div>\n    ...\n  </div>\n</template>\n\n<script setup>\nconst handleSetTheme = command => {}\n</script>\n\n<style lang=\"scss\" scoped></style>\n```\n\n在 `layout/components/navbar` 中进行引用\n\n```js\n<div class=\"right-menu\">\n  <theme-picker class=\"right-menu-item hover-effect\"></theme-picker>\n</div>\n\n... \n\nimport ThemePicker from '@/components/ThemeSelect/index'\n```\n\n**创建 `SelectColor` 组件**\n\n在有了 `ThemeSelect ` 之后，接下来我们来去处理颜色选择的组件 `SelectColor`，在这里我们会用到 `element` 中的 `el-color-picker` 组件\n\n对于 `SelectColor` 的处理，我们需要分成两步进行：\n\n1. 完成 `SelectColor` 弹窗展示的双向数据绑定\n2. 把选中的色值进行本地缓存\n\n那么下面咱们先来看第一步：**完成 `SelectColor` 弹窗展示的双向数据绑定**\n\n创建 `components/ThemePicker/components/SelectColor.vue` \n\n```js\n<template>\n  <el-dialog title=\"提示\" :model-value=\"modelValue\" @close=\"closed\" width=\"22%\">\n    <div class=\"center\">\n      <p class=\"title\">{{ $t('msg.theme.themeColorChange') }}</p>\n      <el-color-picker\n        v-model=\"mColor\"\n        :predefine=\"predefineColors\"\n      ></el-color-picker>\n    </div>\n    <template #footer>\n      <span class=\"dialog-footer\">\n        <el-button @click=\"closed\">{{ $t('msg.universal.cancel') }}</el-button>\n        <el-button type=\"primary\" @click=\"comfirm\">{{\n          $t('msg.universal.confirm')\n        }}</el-button>\n      </span>\n    </template>\n  </el-dialog>\n</template>\n\n<script setup>\nimport { defineProps, defineEmits, ref } from 'vue'\ndefineProps({\n  modelValue: {\n    type: Boolean,\n    required: true\n  }\n})\nconst emits = defineEmits(['update:modelValue'])\n\n// 预定义色值\nconst predefineColors = [\n  '#ff4500',\n  '#ff8c00',\n  '#ffd700',\n  '#90ee90',\n  '#00ced1',\n  '#1e90ff',\n  '#c71585',\n  'rgba(255, 69, 0, 0.68)',\n  'rgb(255, 120, 0)',\n  'hsv(51, 100, 98)',\n  'hsva(120, 40, 94, 0.5)',\n  'hsl(181, 100%, 37%)',\n  'hsla(209, 100%, 56%, 0.73)',\n  '#c7158577'\n]\n// 默认色值\nconst mColor = ref('#00ff00')\n\n/**\n * 关闭\n */\nconst closed = () => {\n  emits('update:modelValue', false)\n}\n/**\n * 确定\n * 1. 修改主题色\n * 2. 保存最新的主题色\n * 3. 关闭 dialog\n */\nconst comfirm = async () => {\n  closed()\n}\n</script>\n\n<style lang=\"scss\" scoped>\n.center {\n  text-align: center;\n  .title {\n    margin-bottom: 12px;\n  }\n}\n</style>\n\n```\n\n在 `ThemePicker/index` 中使用该组件\n\n\n```js\n<template>\n  ...\n  <!-- 展示弹出层 -->\n  <div>\n    <select-color v-model=\"selectColorVisible\"></select-color>\n  </div>\n</template>\n\n<script setup>\nimport SelectColor from './components/SelectColor.vue'\nimport { ref } from 'vue'\n\nconst selectColorVisible = ref(false)\nconst handleSetTheme = command => {\n  selectColorVisible.value = true\n}\n</script>\n\n```\n\n完成双向数据绑定之后，我们来处理第二步：**把选中的色值进行本地缓存**\n\n缓存的方式分为两种：\n\n1. `vuex`\n2. 本地存储\n\n在 `constants/index` 下新建常量值\n\n```js\n// 主题色保存的 key\nexport const MAIN_COLOR = 'mainColor'\n// 默认色值\nexport const DEFAULT_COLOR = '#409eff'\n```\n\n创建 `store/modules/theme` 模块，用来处理 **主题色** 相关内容\n\n```js\nimport { getItem, setItem } from '@/utils/storage'\nimport { MAIN_COLOR, DEFAULT_COLOR } from '@/constant'\nexport default {\n  namespaced: true,\n  state: () => ({\n    mainColor: getItem(MAIN_COLOR) || DEFAULT_COLOR\n  }),\n  mutations: {\n    /**\n     * 设置主题色\n     */\n    setMainColor(state, newColor) {\n      state.mainColor = newColor\n      setItem(MAIN_COLOR, newColor)\n    }\n  }\n}\n```\n\n在 `store/getters` 下指定快捷访问\n\n```js\nmainColor: state => state.theme.mainColor\n```\n\n在 `store/index` 中导入 `theme`\n\n```js\n...\nimport theme from './modules/theme.js'\n\nexport default createStore({\n  getters,\n  modules: {\n    ...\n    theme\n  }\n})\n```\n\n在 `selectColor` 中，设置初始色值 和  缓存色值\n\n```js\n...\n\n<script setup>\nimport { defineProps, defineEmits, ref } from 'vue'\nimport { useStore } from 'vuex'\n...\nconst store = useStore()\n\n// 默认色值\nconst mColor = ref(store.getters.mainColor)\n\n...\n\n/**\n * 确定按钮\n *\n * 1. 修改主题色\n * 2. 保存最新的主题色\n * 3. 关闭 dialog\n *\n */\nconst comfirm = async () => {\n  // 2. 保存最新的主题色\n  store.commit('theme/setMainColor', mColor.value)\n  // 3. 关闭 dialog\n  closed()\n}\n</script>\n```\n\n## scss mix方法\n```css\n// 给当前的颜色值，添加上 50% 的白色\n.white {\n  color: mix(white, $color, 50%);\n}\n\n// 给当前的颜色值，添加上 50% 的黑色\n.black {\n  color: mix(black, $color, 50%);\n}\n```\n\n## 处理 element-plus 主题色变更原理与步骤分析\n\n对于 `element-plus` 的主题变更，相对比较复杂，所以说整个过程我们会分为三部分：\n\n1. 实现原理\n2. 实现步骤\n3. 实现过程\n\n**实现原理：**\n\n在之前我们分析主题变更的实现原理时，我们说过，核心的原理是：**通过修改 `scss` 变量 ** 的形式修改主题色完成主题变更\n\n但是对于 `element-plus` 而言，我们怎么去修改这样的主题色呢？\n\n其实整体的原理非常简单，分为三步：\n\n1. 获取当前 `element-plus` 的所有样式\n2. 找到我们想要替换的样式部分，通过正则完成替换\n3. 把替换后的样式写入到 `style` 标签中，利用样式优先级的特性，替代固有样式\n\n**实现步骤：**\n\n那么明确了原理之后，我们的实现步骤也就呼之欲出了，对应原理总体可分为四步：\n\n1. 获取当前 `element-plus` 的所有样式\n2. 定义我们要替换之后的样式\n3. 在原样式中，利用正则替换新样式\n4. 把替换后的样式写入到 `style` 标签中\n\n\n**创建 `utils/theme` 工具类，写入两个方法**\n\n```js\n/**\n * 写入新样式到 style\n * @param {*} elNewStyle  element-plus 的新样式\n * @param {*} isNewStyleTag 是否生成新的 style 标签\n */\nexport const writeNewStyle = elNewStyle => {\n  \n}\n\n/**\n * 根据主色值，生成最新的样式表\n */\nexport const generateNewStyle =  primaryColor => {\n \n}\n```\n\n那么接下来我们先实现第一个方法 `generateNewStyle`，在实现的过程中，我们需要安装两个工具类：\n\n1. [rgb-hex](https://www.npmjs.com/package/rgb-hex)：转换RGB(A)颜色为十六进制\n2. [css-color-function](https://www.npmjs.com/package/css-color-function)：在 CSS 中 Tab Atkins 提出的颜色函数的解析器和转换器。\n\n**示例**\n```js\nimport rgbHex from 'rgb-hex'\n\nrgbHex(65, 131, 196);\n//=> '4183c4'\n\nrgbHex('rgb(40, 42, 54)');\n//=> '282a36'\n\nrgbHex(65, 131, 196, 0.2);\n//=> '4183c433'\n\nrgbHex(40, 42, 54, '75%');\n//=> '282a36bf'\n\nrgbHex('rgba(40, 42, 54, 75%)');\n//=> '282a36bf'\n\n------------------------------------------------\n\nimport color from 'css-color-function'\n \ncolor.convert('color(red tint(50%))');\n// \"rgb(255, 128, 128)\"\n```\n\n然后还需要写入一个 **颜色转化计算器  `formula.json`**，这里主要是以 `primary` 色值为例\n\n创建 `constants/formula.json` \n\n```json\n{\n  \"shade-1\": \"color(primary shade(10%))\",\n  \"light-1\": \"color(primary tint(10%))\",\n  \"light-2\": \"color(primary tint(20%))\",\n  \"light-3\": \"color(primary tint(30%))\",\n  \"light-4\": \"color(primary tint(40%))\",\n  \"light-5\": \"color(primary tint(50%))\",\n  \"light-6\": \"color(primary tint(60%))\",\n  \"light-7\": \"color(primary tint(70%))\",\n  \"light-8\": \"color(primary tint(80%))\",\n  \"light-9\": \"color(primary tint(90%))\",\n  \"subMenuHover\": \"color(primary tint(70%))\",\n  \"subMenuBg\": \"color(primary tint(80%))\",\n  \"menuHover\": \"color(primary tint(90%))\",\n  \"menuBg\": \"color(primary)\"\n}\n```\n\n我们来看下 element plus 定义的 `primary` 变量，`light-i` 表示颜色的深浅。\n\n![](/img/primary.png)\n\n如果我们想要定义其它颜色，比如`--el-color-success`，已同样的方法，添加到 `formula.json` 中即可。\n\n同时我们还定义了自己变量在 `formula` 颜色转换器中，因为我们的 `菜单` 部分，也是需要跟着主题色变化的。\n\n**shade tint 方法其实就是利用了 scss 的 mix 方法**，css-color-function 库内部调用进行解析，对某个颜色加深或者淡化！！\n\n```css\n// scss\n\n// 给当前的颜色值，添加上 50% 的白色\n.white {\n  color: mix(white, $color, 50%);\n}\n\n// 给当前的颜色值，添加上 50% 的黑色\n.black {\n  color: mix(black, $color, 50%);\n}\n\n@function tint($color, $parcent) {\n  @return mix(white, $color, $parcent)\n}\n@function shade($color, $parcent) {\n  @return mix(black, $color, $parcent)\n}\n```\n\n准备就绪后，我们来实现 `generateNewStyle` 方法：\n\n```js\n// https://www.npmjs.com/package/css-color-function\nimport color from 'css-color-function'\n\n// https://www.npmjs.com/package/rgb-hex\nimport rgbHex from 'rgb-hex'\nimport axios from 'axios'\nimport formula from '@/constants/formula.json'\n/**\n * 写入新样式到 style\n * @param {*} cssText  element-plus 的新样式\n * @param {*} isNewStyleTag 是否生成新的 style 标签\n */\nexport const writeNewStyle = (cssText: string) => {\n  const style = document.createElement('style')\n  style.innerText = cssText\n  document.head.appendChild(style)\n}\n\n/**\n * 根据主色值，生成最新的样式表\n */\ntype TObject = { [key: string]: string }\nexport const generateNewStyle = async (primaryColor: string) => {\n  // colors ===> { primary: 'rgba(8, 12, 132, 0.68)', shade-1: '#070b77ad', light-1: '#212490ad', ...... }\n  const colors: TObject = generateColors(primaryColor) as TObject\n\n  // 拿到整个 element plus 样式表，并对需要修改的变量打上了标记\n  let cssText = await getOriginalStyle()\n\n  // 遍历生成的样式表，在 CSS 的原样式中进行全局替换\n  Object.keys(colors).forEach(key => {\n    // reg pattern\n    // /(:|\\s+)primary/g\n    // /(:|\\s+)shade-1/g\n    // /(:|\\s+)menuBg/g\n    // ...\n\n    // 这个模式中的 (:|\\\\s+) 表示一个冒号或一个或多个空白字符（包括空格、制表符和换行符）。\n    // \\\\s+ 的第一个 \\ 是转义字符\n    // key 是一个变量，代表一个需要匹配的字符串，比如匹配 `primary`\n\n    // '$1' + colors[key]\n    // 关于为什么要在色值前面加上 $1，我们需要查看 replace 方法的第二个参数。\n    // 在这里，第二个参数是一个字符串，字符串中的 $1 会被替换成第一个括号捕获组（即 (:|\\\\s+)）匹配到的文本。\n    // 所以加上 $1 就是为了在【替换的文本】中【保留原本匹配到的文本】。\n    cssText = cssText.replace(\n      new RegExp('(:|\\\\s+)' + key, 'g'),\n      '$1' + colors[key]\n    )\n  })\n\n  // 最终，新的样式表中，含有我们自定义的颜色主题\n  return cssText\n}\n\n/**\n * 根据主色生成色值表\n */\ntype TFormulaKey = keyof typeof formula\nexport const generateColors = (primary: string) => {\n  if (!primary) return\n  const colors: { [key: string]: string } = {\n    primary\n  }\n\n  ;(Object.keys(formula) as Array<TFormulaKey>).forEach(\n    <K extends TFormulaKey>(key: K) => {\n      // 将所有的主色，替换成我们选中的主题色，形式如 >>> color(rgba(255, 69, 0, 1) shade(10%))\n      const value = formula[key].replace(/primary/g, primary)\n\n      // 通过 color 的 conver 方法，计算出 rgba 色值\n      // color.convert(value)  ===>>>  rgba(0, 12, 230, 0.68)\n\n      // 最终将转为每个颜色，转为十六进制：#030420ad，写入到 colors 对象中，并返回\n      colors[key] = '#' + rgbHex(color.convert(value))\n    }\n  )\n  return colors\n}\n\n/**\n * 获取当前 element-plus 的默认样式表\n */\nconst getOriginalStyle = async () => {\n  const version = require('element-plus/package.json').version\n  const url = `https://unpkg.com/element-plus@${version}/dist/index.css`\n  const { data } = await axios(url)\n\n  // 把获取到的数据筛选为原样式模板\n  return getStyleTemplate(data)\n}\n\n/**\n * 返回 style 的 template\n */\nconst getStyleTemplate = (data: string) => {\n  // element-plus 默认色值\n  const colorMap: { [key: string]: string } = {\n    '#3a8ee6': 'shade-1',\n    '#409eff': 'primary', // element-plus 中含有变量 `--el-color-primary: #409eff`\n    '#53a8ff': 'light-1',\n    '#66b1ff': 'light-2',\n    '#79bbff': 'light-3',\n    '#8cc5ff': 'light-4',\n    '#a0cfff': 'light-5',\n    '#b3d8ff': 'light-6',\n    '#c6e2ff': 'light-7',\n    '#d9ecff': 'light-8',\n    '#ecf5ff': 'light-9'\n  }\n  // 根据默认色值为要替换的色值打上标记\n  Object.keys(colorMap).forEach(key => {\n    const value = colorMap[key]\n    data = data.replace(new RegExp(key, 'ig'), value)\n  })\n\n  // 替换完之后\n  // `--el-color-primary: #409eff` 就变成了 `--el-color-primary: primary`\n  // --el-color-primary-light-3: #79bbff;  变成了  --el-color-primary-light-3: light-3\n  // ...\n  // ...\n  // `--el-color-primary-light-9: #ecf5ff` 变成了 `--el-color-primary-light-9: light-9`\n\n  return data\n}\n```\n\n**我们来分析一下 theme.ts 中函数的执行流程**\n\n1. 首先，外部调用 `generateNewStyle` 方法，传入 primaryColor，我们通过 el-color-picker 选中后的值，就是 `primaryColor`，它的色值长这样 `rgba(8, 12, 132, 0.68)`。\n\n2. 通过 `generateColors` 方法生成色值表\n  1. 通过 `css-color-function` 处理我们的颜色转化计算器`formula.json`\n  ```js\n  color(rgba(255, 69, 0, 1) shade(10%)) >>> color.convert(value) >>> rgba(0, 12, 230, 0.68)\n  ```\n  \n  2. 使用 `rgbHex` 方法将 rgba 转化为十六进制格式\n  ```js\n  rgbHex(color.convert(value))  ===>>>  '#030420ad'\n  ```\n  3. 返回处理过后的色值表 `colors`\n\n  ```js\n  {\n    primary: 'rgba(8, 12, 132, 0.68)', // 保留了原始的rgba格式\n    shade-1: '#070b77ad',\n    light-1: '#212490ad',\n    light-2: '#393d9dad',\n    ......\n  }\n  ```\n3. 通过 `getOriginalStyle` 方法，获取 element plus 样式表\n4. 拿到 element plus 样式数据后，通过 `getStyleTemplate` 方法，根据默认色值 `colorMap` 为要替换的色值打上标记\n  1. element-plus 中含有变量 `--el-color-primary: #409eff`，而我们定义的 colorMap 默认值 `'#409eff': 'primary'` 就是与 element plus 中的十六进制值是对应。\n  2. 我们就是要将 element plus 中的 primary 十六进制值替换成我们的标记，`primary、shade-*`。因为我们已经处理过 `formula.json` 了，处理过后得到的是 **`{ primary: 'rgba(8, 12, 132, 0.68)', shade-1: '#070b77ad', light-1: '#212490ad', ...}`** 这种形式，这里面的色值，就是我们需要应用到页面上的颜色。\n  3. 替换完之后，element plus 中的颜色变量就被标记上了记号，表示将来需要替换成真正的色值。\n  ```js\n  `--el-color-primary: #409eff` 就变成了 `--el-color-primary: primary`\n  `--el-color-primary-light-9: #ecf5ff` 变成了 `--el-color-primary-light-9: light-9`\n  ```\n  4. 返回处理过后的 element plus 样式表 `cssText`\n\n5. 接着，我们通过正则以及第二步 `generateColors` 方法返回的 colors，将 `cssText` 中每个打了标记的变量值替换\n  ```js\n  cssText = cssText.replace(new RegExp('(:|\\\\s+)' + key, 'g'), '$1' + colors[key])\n  ```\n\n  1. 这个模式中的 (:|\\\\s+) 表示一个冒号或一个【或】多个空白字符(\\s+)（包括空格、制表符和换行符）\n  2. \\\\s+ 的第一个 \\ 是转义字符\n  3. key 是一个变量，代表一个需要匹配的字符串，比如匹配 `primary`\n  4. `'$1' + colors[key]`: replace 第二个参数是一个字符串，字符串中的 $1 会被替换成第一个括号捕获组（即 (:|\\\\s+)）匹配到的文本。所以加上 $1 就是为了在【替换的文本】中【保留原本匹配到的文本】。\n  5. 最后返回 cssText，新的样式表中，含有我们自定义的颜色主题\n\n6. 最后，通过 `writeNewStyle` 将新的样式表 `cssText` 插入到文档中。\n  ```js\n  const style = document.createElement('style')\n  style.innerText = cssText\n  document.head.appendChild(style)\n  ```\n\n**总结**\n\n到这里，我们对 `element plus` 的主题换肤就完成了。\n\n原理就是：拿到用户选中的颜色值(rgba)，通过 formula 颜色转换器转换成十六进制表 colors，然后拿到 `element plus` 的样式表，将其中需要修改的变量打上标记并返回含有标记的新样式表 cssText，最后，遍历 colors，通过正则将所有标记替换成 colors 中的值。完成样式的替换。\n\n## element-plus 新主题的立即生效\n\n到目前我们已经完成了 `element-plus` 的主题变更，但是当前的主题变更还有一个小问题，那就是：**在刷新页面后，新主题会失效**\n\n那么出现这个问题的原因，非常简单：**因为没有写入新的 `style`**\n\n所以我们只需要在 **应用加载后，写入 `style` 即可**\n\n那么写入的时机，我们可以放入到 `app.vue` 中\n\n```js\n<script setup>\nimport { useStore } from 'vuex'\nimport { generateNewStyle, writeNewStyle } from '@/utils/theme'\n\nconst store = useStore()\ngenerateNewStyle(store.getters.mainColor).then(newStyleText => {\n  writeNewStyle(newStyleText)\n})\n</script>\n```\n\n## 自定义主题变更\n\n自定义主题变更相对来说比较简单，因为 **自己的代码更加可控**。\n\n目前在我们的代码中，需要进行 **自定义主题变更** 为  **`menu` 菜单背景色**\n\n而目前指定 `menu` 菜单背景色的位置在 `layout/components/sidebar/SidebarMenu.vue` 中\n\n```js\n  <el-menu\n    :default-active=\"activeMenu\"\n    :collapse=\"!$store.getters.sidebarOpened\"\n    :background-color=\"$store.getters.cssVar.menuBg\"\n    :text-color=\"$store.getters.cssVar.menuText\"\n    :active-text-color=\"$store.getters.cssVar.menuActiveText\"\n    :unique-opened=\"true\"\n    router\n  >\n```\n\n此处的 背景色是通过 `getters` 进行指定的，该 `cssVar` 的 `getters` 为：\n\n```js\ncssVar: state => variables,\n```\n\n所以，我们想要修改 **自定义主题** ，只需要从这里入手即可。\n\n**根据当前保存的 `mainColor` 覆盖原有的默认色值**\n\n```js\nimport variables from '@/styles/variables.scss'\nimport { MAIN_COLOR } from '@/constant'\nimport { getItem } from '@/utils/storage'\nimport { generateColors } from '@/utils/theme'\n\nconst getters = {\n  ...\n  cssVar: state => {\n    return {\n      ...variables,\n      ...generateColors(getItem(MAIN_COLOR))\n    }\n  },\n  ...\n}\nexport default getters\n\n```\n\n但是我们这样设定之后，整个自定义主题变更，还存在两个问题：\n\n1. `menuBg` 背景颜色没有变化\n\n这个问题是因为咱们的 `sidebar` 的背景色未被替换，所以我们可以在 `layout/index` 中设置 `sidebar` 的 `backgroundColor`\n\n```html\n<sidebar\n  id=\"guide-sidebar\"\n  class=\"sidebar-container\"\n  :style=\"{ backgroundColor: $store.getters.cssVar.menuBg }\"\n/>\n```\n\n2. 主题色替换之后，需要刷新页面才可响应\n\n这个是因为 `getters` 中没有监听到 **依赖值的响应变化**，所以我们希望修改依赖值\n\n在 `store/modules/theme` 中\n\n```js\n...\nimport variables from '@/styles/variables.scss'\nexport default {\n  namespaced: true,\n  state: () => ({\n    ...\n    variables\n  }),\n  mutations: {\n    /**\n     * 设置主题色\n     */\n    setMainColor(state, newColor) {\n      ...\n      state.variables.menuBg = newColor\n      ...\n    }\n  }\n}\n\n```\n\n在 `getters` 中\n\n```js\n....\n\nconst getters = {\n ...\n  cssVar: state => {\n    return {\n      ...state.theme.variables,\n      ...generateColors(getItem(MAIN_COLOR))\n    }\n  },\n  ...\n}\nexport default getters\n\n```\n\n那么到这里整个自定义主题我们就处理完成了。\n\n对于 **自定义主题而言**，核心的原理其实就是 **修改`scss`变量来进行实现主题色变化** \n\n明确好了原理之后，对后续实现的步骤就具体情况具体分析了。\n\n1. 对于 `element-plus`：因为 `element-plus` 是第三方的包，所以它 **不是完全可控** 的，那么对于这种最简单直白的方案，就是直接拿到它编译后的 `css` 进行色值替换，利用 `style` **内部样式表** 优先级高于 **外部样式表** 的特性，来进行主题替换\n2. 对于自定义主题：因为自定义主题是 **完全可控** 的，所以我们实现起来就轻松很多，只需要修改对应的 `scss`变量即可\n\n那么在之后大家遇到 **自定义主题** 的处理时，就可以按照这里所梳理的方案进行处理了。\n\n# 结束语\n\n这一章我们花了大量的篇幅来介绍换肤的原理以及业务场景如何实现换肤，篇幅有点长，就不在此添加其他功能的描述了。\n\n如下功能我们放到下一章节去实现：\n\n- screenfull\n- headerSearch\n- tagView\n- guide\n\n# 参考链接\n\n- [CSS变量教程](https://www.ruanyifeng.com/blog/2017/05/css-variables.html)\n\n","slug":"vue3-project-generalModule","published":1,"updated":"2023-05-12T10:49:20.015Z","comments":1,"photos":[],"link":"","_id":"clhkizgyd00383y0qgsg2ddnv","content":"<h1 id=\"通用功能\"><a href=\"#通用功能\" class=\"headerlink\" title=\"通用功能\"></a>通用功能</h1><ol>\n<li>国际化</li>\n<li>动态换肤</li>\n<li><code>screenfull</code></li>\n<li><code>headerSearch</code></li>\n<li><code>tagView</code></li>\n<li><code>guide</code></li>\n</ol>\n<h1 id=\"国际化实现原理\"><a href=\"#国际化实现原理\" class=\"headerlink\" title=\"国际化实现原理\"></a>国际化实现原理</h1><p>先来看一个需求：</p>\n<blockquote>\n<p>我们有一个变量 <code>msg</code> ，但是这个 <code>msg</code> 有且只能有两个值：</p>\n<ol>\n<li>hello world</li>\n<li>你好世界</li>\n</ol>\n<p>要求：根据需要切换 <code>msg</code> 的值</p>\n</blockquote>\n<p>这样的一个需求就是 国际化 的需求，那么我们可以通过以下代码来实现这个需求</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><div class=\"code-wrapper\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br></pre></div></td><td class=\"code\"><pre><code class=\"hljs js\">&lt;script&gt;<br>  <span class=\"hljs-comment\">// 1. 定义 msg 值的数据源</span><br>  <span class=\"hljs-keyword\">const</span> messages = &#123;<br>    <span class=\"hljs-attr\">en</span>: &#123;<br>      <span class=\"hljs-attr\">msg</span>: <span class=\"hljs-string\">&#x27;hello world&#x27;</span><br>    &#125;,<br>    <span class=\"hljs-attr\">zh</span>: &#123;<br>      <span class=\"hljs-attr\">msg</span>: <span class=\"hljs-string\">&#x27;你好世界&#x27;</span><br>    &#125;<br>  &#125;<br>  <span class=\"hljs-comment\">// 2. 定义切换变量</span><br>  <span class=\"hljs-keyword\">let</span> locale = <span class=\"hljs-string\">&#x27;en&#x27;</span><br>  <span class=\"hljs-comment\">// 3. 定义赋值函数</span><br>  <span class=\"hljs-keyword\">function</span> <span class=\"hljs-title function_\">t</span>(<span class=\"hljs-params\">key</span>) &#123;<br>    <span class=\"hljs-keyword\">return</span> messages[locale][key]<br>  &#125;<br>  <span class=\"hljs-comment\">// 4. 为 msg 赋值 </span><br>  <span class=\"hljs-keyword\">let</span> msg = <span class=\"hljs-title function_\">t</span>(<span class=\"hljs-string\">&#x27;msg&#x27;</span>)<br>  <span class=\"hljs-variable language_\">console</span>.<span class=\"hljs-title function_\">log</span>(msg);<br>  <span class=\"hljs-comment\">// 修改 locale， 重新执行 t 方法，获取不同语言环境下的值</span><br><br>&lt;/script&gt;<br></code></pre></td></tr></table></figure>\n\n<p>总结：</p>\n<ol>\n<li>通过一个变量来 <strong>控制</strong> 语言环境</li>\n<li>所有语言环境下的数据源要 <strong>预先</strong> 定义好</li>\n<li>通过一个方法来获取 <strong>当前语言</strong> 下 <strong>指定属性</strong> 的值</li>\n<li>该值即为国际化下展示值</li>\n</ol>\n<h2 id=\"基于-vue-i18n-V9-的国际化实现方案分析\"><a href=\"#基于-vue-i18n-V9-的国际化实现方案分析\" class=\"headerlink\" title=\"基于 vue-i18n V9  的国际化实现方案分析\"></a>基于 vue-i18n V9  的国际化实现方案分析</h2><p>在 <code>vue</code> 的项目中，我们不需要手写这么复杂的一些基础代码，可以直接使用 <a href=\"https://vue-i18n.intlify.dev/\">vue-i18n</a> 进行实现（注意：<strong><code>vue3</code> 下需要使用 <code>V 9.x</code> 的 <code>i18n</code></strong>）</p>\n<p><a href=\"https://vue-i18n.intlify.dev/guide/\">vue-i18n</a> 的使用可以分为四个部分：</p>\n<ol>\n<li>创建 <code>messages</code> 数据源</li>\n<li>创建 <code>locale</code> 语言变量</li>\n<li>初始化 <code>i18n</code> 实例</li>\n<li>注册 <code>i18n</code> 实例</li>\n</ol>\n<p>那么接下来我们就去实现以下：</p>\n<ol>\n<li>安装 <code>vue-i18n</code><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\">npm install vue-i18n@next<br></code></pre></td></tr></table></figure>\n\n\n</li>\n</ol>\n<ol start=\"2\">\n<li><p>创建 <code>i18n/index.js</code> 文件</p>\n</li>\n<li><p>创建 <code>messages</code> 数据源</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\"><span class=\"hljs-keyword\">const</span> messages = &#123;<br>  <span class=\"hljs-attr\">en</span>: &#123;<br>    <span class=\"hljs-attr\">msg</span>: &#123;<br>      <span class=\"hljs-attr\">test</span>: <span class=\"hljs-string\">&#x27;hello world&#x27;</span><br>    &#125;<br>  &#125;,<br>  <span class=\"hljs-attr\">zh</span>: &#123;<br>    <span class=\"hljs-attr\">msg</span>: &#123;<br>      <span class=\"hljs-attr\">test</span>: <span class=\"hljs-string\">&#x27;你好世界&#x27;</span><br>    &#125;<br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure>\n</li>\n<li><p>创建 <code>locale</code> 语言变量</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\"><span class=\"hljs-keyword\">const</span> locale = <span class=\"hljs-string\">&#x27;en&#x27;</span><br></code></pre></td></tr></table></figure>\n</li>\n<li><p>初始化 <code>i18n</code> 实例</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\"><span class=\"hljs-keyword\">import</span> &#123; createI18n &#125; <span class=\"hljs-keyword\">from</span> <span class=\"hljs-string\">&#x27;vue-i18n&#x27;</span><br><br><span class=\"hljs-keyword\">const</span> i18n = <span class=\"hljs-title function_\">createI18n</span>(&#123;<br>  <span class=\"hljs-comment\">// 使用 Composition API 模式，则需要将其设置为false</span><br>  <span class=\"hljs-attr\">legacy</span>: <span class=\"hljs-literal\">false</span>,<br>  <span class=\"hljs-comment\">// 全局注入 $t 函数</span><br>  <span class=\"hljs-attr\">globalInjection</span>: <span class=\"hljs-literal\">true</span>,<br>  locale,<br>  messages<br>&#125;)<br></code></pre></td></tr></table></figure>\n</li>\n<li><p>把 <code>i18n</code> 注册到 <code>vue</code> 实例</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\"><span class=\"hljs-keyword\">export</span> <span class=\"hljs-keyword\">default</span> i18n<br></code></pre></td></tr></table></figure>\n</li>\n<li><p>在 <code>main.js</code> 中导入</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\"><span class=\"hljs-comment\">// i18n （PS：导入放到 APP.vue 导入之前，因为后面我们会在 app.vue 中使用国际化内容）</span><br><span class=\"hljs-keyword\">import</span> i18n <span class=\"hljs-keyword\">from</span> <span class=\"hljs-string\">&#x27;@/i18n&#x27;</span><br>...<br>app.<span class=\"hljs-title function_\">use</span>(i18n)<br></code></pre></td></tr></table></figure>\n</li>\n<li><p>在 <code>layout/components/Sidebar/index.vue</code> 中使用 <code>i18n</code></p>\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs html\"><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">h1</span> <span class=\"hljs-attr\">class</span>=<span class=\"hljs-string\">&quot;logo-title&quot;</span> <span class=\"hljs-attr\">v-if</span>=<span class=\"hljs-string\">&quot;$store.getters.sidebarOpened&quot;</span>&gt;</span><br>        &#123;&#123; $t(&#x27;msg.test&#x27;) &#125;&#125;<br><span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">h1</span>&gt;</span><br></code></pre></td></tr></table></figure>\n</li>\n<li><p>修改 <code>locale</code> 的值，即可改变展示的内容</p>\n</li>\n</ol>\n<p>截止到现在我们已经实现了 <code>i18n</code> 的最基础用法，那么解下来我们就可以在项目中使用 <code>i18n</code> 完成国际化。</p>\n<p>项目中完成国际化分成以下几步进行:</p>\n<ol>\n<li>封装 <code>langSelect</code> 组件用于修改 <code>locale</code></li>\n<li>导入 <code>el-locale</code> 语言包</li>\n<li>创建自定义语言包</li>\n</ol>\n<h2 id=\"封装-langSelect-组件\"><a href=\"#封装-langSelect-组件\" class=\"headerlink\" title=\"封装  langSelect  组件\"></a>封装  langSelect  组件</h2><ol>\n<li><p>定义 <code>store/app.js</code></p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\"><span class=\"hljs-keyword\">import</span> &#123; <span class=\"hljs-variable constant_\">LANG</span> &#125; <span class=\"hljs-keyword\">from</span> <span class=\"hljs-string\">&#x27;@/constant&#x27;</span><br><span class=\"hljs-keyword\">import</span> &#123; getItem, setItem &#125; <span class=\"hljs-keyword\">from</span> <span class=\"hljs-string\">&#x27;@/utils/storage&#x27;</span><br><span class=\"hljs-keyword\">export</span> <span class=\"hljs-keyword\">default</span> &#123;<br>  <span class=\"hljs-attr\">namespaced</span>: <span class=\"hljs-literal\">true</span>,<br>  <span class=\"hljs-attr\">state</span>: <span class=\"hljs-function\">() =&gt;</span> (&#123;<br>    ...<br>    <span class=\"hljs-attr\">language</span>: <span class=\"hljs-title function_\">getItem</span>(<span class=\"hljs-variable constant_\">LANG</span>) || <span class=\"hljs-string\">&#x27;zh&#x27;</span><br>  &#125;),<br>  <span class=\"hljs-attr\">mutations</span>: &#123;<br>    ...<br>    <span class=\"hljs-comment\">/**</span><br><span class=\"hljs-comment\">     * 设置国际化</span><br><span class=\"hljs-comment\">     */</span><br>    <span class=\"hljs-title function_\">setLanguage</span>(<span class=\"hljs-params\">state, lang</span>) &#123;<br>      <span class=\"hljs-title function_\">setItem</span>(<span class=\"hljs-variable constant_\">LANG</span>, lang)<br>      state.<span class=\"hljs-property\">language</span> = lang<br>    &#125;<br>  &#125;,<br>  <span class=\"hljs-attr\">actions</span>: &#123;&#125;<br>&#125;<br><br></code></pre></td></tr></table></figure>\n\n\n\n</li>\n</ol>\n<ol start=\"2\">\n<li><p>在 <code>constant</code> 中定义常量</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\"><span class=\"hljs-comment\">// 国际化</span><br><span class=\"hljs-keyword\">export</span> <span class=\"hljs-keyword\">const</span> <span class=\"hljs-variable constant_\">LANG</span> = <span class=\"hljs-string\">&#x27;language&#x27;</span><br></code></pre></td></tr></table></figure>\n\n\n</li>\n</ol>\n<ol start=\"3\">\n<li><p>创建 <code>components/LangSelect/index</code> </p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\">&lt;template&gt;<br>  <span class=\"language-xml\"><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">el-dropdown</span></span></span><br><span class=\"hljs-tag\"><span class=\"language-xml\">    <span class=\"hljs-attr\">trigger</span>=<span class=\"hljs-string\">&quot;click&quot;</span></span></span><br><span class=\"hljs-tag\"><span class=\"language-xml\">    <span class=\"hljs-attr\">class</span>=<span class=\"hljs-string\">&quot;international&quot;</span></span></span><br><span class=\"hljs-tag\"><span class=\"language-xml\">    @<span class=\"hljs-attr\">command</span>=<span class=\"hljs-string\">&quot;handleSetLanguage&quot;</span></span></span><br><span class=\"hljs-tag\"><span class=\"language-xml\">  &gt;</span></span><br><span class=\"language-xml\">    <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">div</span>&gt;</span></span><br><span class=\"language-xml\">      <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">el-tooltip</span> <span class=\"hljs-attr\">content</span>=<span class=\"hljs-string\">&quot;国际化&quot;</span> <span class=\"hljs-attr\">:effect</span>=<span class=\"hljs-string\">&quot;effect&quot;</span>&gt;</span></span><br><span class=\"language-xml\">        <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">svg-icon</span> <span class=\"hljs-attr\">icon</span>=<span class=\"hljs-string\">&quot;language&quot;</span> /&gt;</span></span><br><span class=\"language-xml\">      <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">el-tooltip</span>&gt;</span></span><br><span class=\"language-xml\">    <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">div</span>&gt;</span></span><br><span class=\"language-xml\">    <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">template</span> #<span class=\"hljs-attr\">dropdown</span>&gt;</span></span><br><span class=\"language-xml\">      <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">el-dropdown-menu</span>&gt;</span></span><br><span class=\"language-xml\">        <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">el-dropdown-item</span> <span class=\"hljs-attr\">:disabled</span>=<span class=\"hljs-string\">&quot;language === &#x27;zh&#x27;&quot;</span> <span class=\"hljs-attr\">command</span>=<span class=\"hljs-string\">&quot;zh&quot;</span>&gt;</span></span><br><span class=\"language-xml\">          中文</span><br><span class=\"language-xml\">        <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">el-dropdown-item</span>&gt;</span></span><br><span class=\"language-xml\">        <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">el-dropdown-item</span> <span class=\"hljs-attr\">:disabled</span>=<span class=\"hljs-string\">&quot;language === &#x27;en&#x27;&quot;</span> <span class=\"hljs-attr\">command</span>=<span class=\"hljs-string\">&quot;en&quot;</span>&gt;</span></span><br><span class=\"language-xml\">          English</span><br><span class=\"language-xml\">        <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">el-dropdown-item</span>&gt;</span></span><br><span class=\"language-xml\">      <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">el-dropdown-menu</span>&gt;</span></span><br><span class=\"language-xml\">    <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">template</span>&gt;</span></span><br><span class=\"language-xml\">  <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">el-dropdown</span>&gt;</span></span><br>&lt;/template&gt;<br><br><span class=\"language-xml\"><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">script</span> <span class=\"hljs-attr\">setup</span>&gt;</span><span class=\"language-javascript\"></span></span><br><span class=\"language-javascript\"><span class=\"language-xml\"><span class=\"hljs-keyword\">import</span> &#123; useI18n &#125; <span class=\"hljs-keyword\">from</span> <span class=\"hljs-string\">&#x27;vue-i18n&#x27;</span></span></span><br><span class=\"language-javascript\"><span class=\"language-xml\"><span class=\"hljs-keyword\">import</span> &#123; defineProps, computed &#125; <span class=\"hljs-keyword\">from</span> <span class=\"hljs-string\">&#x27;vue&#x27;</span></span></span><br><span class=\"language-javascript\"><span class=\"language-xml\"><span class=\"hljs-keyword\">import</span> &#123; useStore &#125; <span class=\"hljs-keyword\">from</span> <span class=\"hljs-string\">&#x27;vuex&#x27;</span></span></span><br><span class=\"language-javascript\"><span class=\"language-xml\"><span class=\"hljs-keyword\">import</span> &#123; <span class=\"hljs-title class_\">ElMessage</span> &#125; <span class=\"hljs-keyword\">from</span> <span class=\"hljs-string\">&#x27;element-plus&#x27;</span></span></span><br><span class=\"language-javascript\"><span class=\"language-xml\"></span></span><br><span class=\"language-javascript\"><span class=\"language-xml\"><span class=\"hljs-title function_\">defineProps</span>(&#123;</span></span><br><span class=\"language-javascript\"><span class=\"language-xml\">  <span class=\"hljs-attr\">effect</span>: &#123;</span></span><br><span class=\"language-javascript\"><span class=\"language-xml\">    <span class=\"hljs-attr\">type</span>: <span class=\"hljs-title class_\">String</span>,</span></span><br><span class=\"language-javascript\"><span class=\"language-xml\">    <span class=\"hljs-attr\">default</span>: <span class=\"hljs-string\">&#x27;dark&#x27;</span>,</span></span><br><span class=\"language-javascript\"><span class=\"language-xml\">    <span class=\"hljs-attr\">validator</span>: <span class=\"hljs-keyword\">function</span>(<span class=\"hljs-params\">value</span>) &#123;</span></span><br><span class=\"language-javascript\"><span class=\"language-xml\">      <span class=\"hljs-comment\">// 这个值必须匹配下列字符串中的一个</span></span></span><br><span class=\"language-javascript\"><span class=\"language-xml\">      <span class=\"hljs-keyword\">return</span> [<span class=\"hljs-string\">&#x27;dark&#x27;</span>, <span class=\"hljs-string\">&#x27;light&#x27;</span>].<span class=\"hljs-title function_\">indexOf</span>(value) !== -<span class=\"hljs-number\">1</span></span></span><br><span class=\"language-javascript\"><span class=\"language-xml\">    &#125;</span></span><br><span class=\"language-javascript\"><span class=\"language-xml\">  &#125;</span></span><br><span class=\"language-javascript\"><span class=\"language-xml\">&#125;)</span></span><br><span class=\"language-javascript\"><span class=\"language-xml\"></span></span><br><span class=\"language-javascript\"><span class=\"language-xml\"><span class=\"hljs-keyword\">const</span> store = <span class=\"hljs-title function_\">useStore</span>()</span></span><br><span class=\"language-javascript\"><span class=\"language-xml\"><span class=\"hljs-keyword\">const</span> language = <span class=\"hljs-title function_\">computed</span>(<span class=\"hljs-function\">() =&gt;</span> store.<span class=\"hljs-property\">getters</span>.<span class=\"hljs-property\">language</span>)</span></span><br><span class=\"language-javascript\"><span class=\"language-xml\"></span></span><br><span class=\"language-javascript\"><span class=\"language-xml\"><span class=\"hljs-comment\">// 切换语言的方法</span></span></span><br><span class=\"language-javascript\"><span class=\"language-xml\"><span class=\"hljs-keyword\">const</span> i18n = <span class=\"hljs-title function_\">useI18n</span>()</span></span><br><span class=\"language-javascript\"><span class=\"language-xml\"><span class=\"hljs-keyword\">const</span> <span class=\"hljs-title function_\">handleSetLanguage</span> = lang =&gt; &#123;</span></span><br><span class=\"language-javascript\"><span class=\"language-xml\">  i18n.<span class=\"hljs-property\">locale</span>.<span class=\"hljs-property\">value</span> = lang</span></span><br><span class=\"language-javascript\"><span class=\"language-xml\">  store.<span class=\"hljs-title function_\">commit</span>(<span class=\"hljs-string\">&#x27;app/setLanguage&#x27;</span>, lang)</span></span><br><span class=\"language-javascript\"><span class=\"language-xml\">  <span class=\"hljs-title class_\">ElMessage</span>.<span class=\"hljs-title function_\">success</span>(<span class=\"hljs-string\">&#x27;更新成功&#x27;</span>)</span></span><br><span class=\"language-javascript\"><span class=\"language-xml\">&#125;</span></span><br><span class=\"language-javascript\"><span class=\"language-xml\"></span><span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">script</span>&gt;</span></span><br></code></pre></td></tr></table></figure>\n</li>\n<li><p>在 <code>navbar</code> 中导入 <code>LangSelect</code></p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\">&lt;template&gt;<br>  <span class=\"language-xml\"><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">div</span> <span class=\"hljs-attr\">class</span>=<span class=\"hljs-string\">&quot;navbar&quot;</span>&gt;</span></span><br><span class=\"language-xml\">    ...</span><br><span class=\"language-xml\">    <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">div</span> <span class=\"hljs-attr\">class</span>=<span class=\"hljs-string\">&quot;right-menu&quot;</span>&gt;</span></span><br><span class=\"language-xml\">      <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">lang-select</span> <span class=\"hljs-attr\">class</span>=<span class=\"hljs-string\">&quot;right-menu-item hover-effect&quot;</span> /&gt;</span></span><br><span class=\"language-xml\">      <span class=\"hljs-comment\">&lt;!-- 头像 --&gt;</span></span><br><span class=\"language-xml\">      ...</span><br><span class=\"language-xml\">    <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">div</span>&gt;</span></span><br><span class=\"language-xml\">  <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">div</span>&gt;</span></span><br>&lt;/template&gt;<br><br><span class=\"language-xml\"><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">script</span> <span class=\"hljs-attr\">setup</span>&gt;</span><span class=\"language-javascript\"></span></span><br><span class=\"language-javascript\"><span class=\"language-xml\"><span class=\"hljs-keyword\">import</span> <span class=\"hljs-title class_\">LangSelect</span> <span class=\"hljs-keyword\">from</span> <span class=\"hljs-string\">&#x27;@/components/LangSelect&#x27;</span></span></span><br><span class=\"language-javascript\"><span class=\"language-xml\">...</span></span><br><span class=\"language-javascript\"><span class=\"language-xml\"></span><span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">script</span>&gt;</span></span><br><br><span class=\"language-xml\"><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">style</span> <span class=\"hljs-attr\">lang</span>=<span class=\"hljs-string\">&quot;scss&quot;</span> <span class=\"hljs-attr\">scoped</span>&gt;</span><span class=\"language-css\"></span></span><br><span class=\"language-css\"><span class=\"language-xml\"><span class=\"hljs-selector-class\">.navbar</span> &#123;</span></span><br><span class=\"language-css\"><span class=\"language-xml\">  ...</span></span><br><span class=\"language-css\"><span class=\"language-xml\"></span></span><br><span class=\"language-css\"><span class=\"language-xml\">  <span class=\"hljs-selector-class\">.right-menu</span> &#123;</span></span><br><span class=\"language-css\"><span class=\"language-xml\">    ...</span></span><br><span class=\"language-css\"><span class=\"language-xml\"></span></span><br><span class=\"language-css\"><span class=\"language-xml\">    ::v-deep .right-menu-item &#123;</span></span><br><span class=\"language-css\"><span class=\"language-xml\">      <span class=\"hljs-attribute\">display</span>: inline-block;</span></span><br><span class=\"language-css\"><span class=\"language-xml\">      <span class=\"hljs-attribute\">padding</span>: <span class=\"hljs-number\">0</span> <span class=\"hljs-number\">18px</span> <span class=\"hljs-number\">0</span> <span class=\"hljs-number\">0</span>;</span></span><br><span class=\"language-css\"><span class=\"language-xml\">      <span class=\"hljs-attribute\">font-size</span>: <span class=\"hljs-number\">24px</span>;</span></span><br><span class=\"language-css\"><span class=\"language-xml\">      <span class=\"hljs-attribute\">color</span>: <span class=\"hljs-number\">#5a5e66</span>;</span></span><br><span class=\"language-css\"><span class=\"language-xml\">      <span class=\"hljs-attribute\">vertical-align</span>: text-bottom;</span></span><br><span class=\"language-css\"><span class=\"language-xml\"></span></span><br><span class=\"language-css\"><span class=\"language-xml\">      &amp;<span class=\"hljs-selector-class\">.hover-effect</span> &#123;</span></span><br><span class=\"language-css\"><span class=\"language-xml\">        <span class=\"hljs-attribute\">cursor</span>: pointer;</span></span><br><span class=\"language-css\"><span class=\"language-xml\">      &#125;</span></span><br><span class=\"language-css\"><span class=\"language-xml\">    &#125;</span></span><br><span class=\"language-css\"><span class=\"language-xml\"></span></span><br><span class=\"language-css\"><span class=\"language-xml\">    ...</span></span><br><span class=\"language-css\"><span class=\"language-xml\">&#125;</span></span><br><span class=\"language-css\"><span class=\"language-xml\"></span><span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">style</span>&gt;</span></span><br><br></code></pre></td></tr></table></figure>\n\n</li>\n</ol>\n<h2 id=\"element-plus-国际化处理\"><a href=\"#element-plus-国际化处理\" class=\"headerlink\" title=\"element-plus 国际化处理\"></a>element-plus 国际化处理</h2><p>截止到目前，我们的国际化内容已经基本功能已经处理完成了。接下来需要处理的就是对应的语言包，有了语言包就可以实现整个项目中的所有国际化处理了。</p>\n<p>那么对于语言包来说，我们整个项目中会分成两部分：</p>\n<ol>\n<li><code>element-plus</code> 语言包：用来处理 <code>element</code> 组件的国际化功能</li>\n<li>自定义语言包：用来处理 <strong>非</strong><code>element</code> 组件的国际化功能</li>\n</ol>\n<p>那么首先我们先来处理 <code>element-plus</code> 语言包：</p>\n<ol start=\"3\">\n<li>在 <code>plugins/index</code> 中导入 <code>element</code> 的中文、英文语言包：</li>\n</ol>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\"><span class=\"hljs-keyword\">import</span> zhCn <span class=\"hljs-keyword\">from</span> <span class=\"hljs-string\">&#x27;element-plus/es/locale/lang/zh-cn&#x27;</span><br><span class=\"hljs-keyword\">import</span> en <span class=\"hljs-keyword\">from</span> <span class=\"hljs-string\">&#x27;element-plus/lib/locale/lang/en&#x27;</span><br></code></pre></td></tr></table></figure>\n\n<ol start=\"4\">\n<li><p>注册 <code>element</code> 时，根据当前语言选择使用哪种语言包</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\"><span class=\"hljs-keyword\">import</span> store <span class=\"hljs-keyword\">from</span> <span class=\"hljs-string\">&#x27;@/store&#x27;</span><br><br><span class=\"hljs-keyword\">export</span> <span class=\"hljs-keyword\">default</span> app =&gt; &#123;<br>  app.<span class=\"hljs-title function_\">use</span>(<span class=\"hljs-title class_\">ElementPlus</span>, &#123;<br>    <span class=\"hljs-attr\">locale</span>: store.<span class=\"hljs-property\">getters</span>.<span class=\"hljs-property\">language</span> === <span class=\"hljs-string\">&#x27;en&#x27;</span> ? en : zhCn<br>  &#125;)<br>&#125;<br></code></pre></td></tr></table></figure>\n\n\n\n\n\n</li>\n</ol>\n<h2 id=\"自定义语言包国际化处理\"><a href=\"#自定义语言包国际化处理\" class=\"headerlink\" title=\"自定义语言包国际化处理\"></a>自定义语言包国际化处理</h2><p>处理完 <code>element</code> 的国际化内容之后，接下来我们来处理 <strong>自定义语言包</strong>。</p>\n<ol>\n<li>在本地创建 <code>lang</code> 文件夹，里面创建好本地需要的语言包，由于比较多，就放一部分来看看：</li>\n</ol>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\"><span class=\"hljs-comment\">// en.ts</span><br><span class=\"hljs-keyword\">export</span> <span class=\"hljs-keyword\">default</span> &#123;<br>  <span class=\"hljs-attr\">login</span>: &#123;<br>    <span class=\"hljs-attr\">title</span>: <span class=\"hljs-string\">&#x27;User Login&#x27;</span>,<br>    <span class=\"hljs-attr\">loginBtn</span>: <span class=\"hljs-string\">&#x27;Login&#x27;</span>,<br>    <span class=\"hljs-attr\">usernameRule</span>: <span class=\"hljs-string\">&#x27;Username is required&#x27;</span>,<br>    <span class=\"hljs-attr\">passwordRule</span>: <span class=\"hljs-string\">&#x27;Password cannot be less than 6 digits&#x27;</span>,<br>  &#125;,<br>  <span class=\"hljs-comment\">// other....</span><br>&#125;<br><br><span class=\"hljs-comment\">// zh.ts</span><br><span class=\"hljs-keyword\">export</span> <span class=\"hljs-keyword\">default</span> &#123;<br>  <span class=\"hljs-attr\">login</span>: &#123;<br>    <span class=\"hljs-attr\">title</span>: <span class=\"hljs-string\">&#x27;用户登录&#x27;</span>,<br>    <span class=\"hljs-attr\">loginBtn</span>: <span class=\"hljs-string\">&#x27;登录&#x27;</span>,<br>    <span class=\"hljs-attr\">usernameRule</span>: <span class=\"hljs-string\">&#x27;用户名为必填项&#x27;</span>,<br>    <span class=\"hljs-attr\">passwordRule</span>: <span class=\"hljs-string\">&#x27;密码不能少于6位&#x27;</span>,<br>  &#125;,<br>  <span class=\"hljs-comment\">// other...</span><br>&#125;<br></code></pre></td></tr></table></figure>\n\n<ol start=\"2\">\n<li><p>在 <code>lang/index</code> 中，导入语言包</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\"><span class=\"hljs-keyword\">import</span> mZhLocale <span class=\"hljs-keyword\">from</span> <span class=\"hljs-string\">&#x27;./lang/zh&#x27;</span><br><span class=\"hljs-keyword\">import</span> mEnLocale <span class=\"hljs-keyword\">from</span> <span class=\"hljs-string\">&#x27;./lang/en&#x27;</span><br></code></pre></td></tr></table></figure>\n</li>\n<li><p>在 <code>messages</code> 中注册到语言包</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\"><span class=\"hljs-keyword\">const</span> messages = &#123;<br>  <span class=\"hljs-attr\">en</span>: &#123;<br>    <span class=\"hljs-attr\">msg</span>: &#123;<br>      ...mEnLocale<br>    &#125;<br>  &#125;,<br>  <span class=\"hljs-attr\">zh</span>: &#123;<br>    <span class=\"hljs-attr\">msg</span>: &#123;<br>      ...mZhLocale<br>    &#125;<br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure>\n\n</li>\n</ol>\n<h2 id=\"处理项目国际化内容\"><a href=\"#处理项目国际化内容\" class=\"headerlink\" title=\"处理项目国际化内容\"></a>处理项目国际化内容</h2><p>在处理好了国际化的语言包之后，接下来我们就可以应用国际化功能到我们的项目中</p>\n<p>对于我们目前的项目而言，需要进行国际化处理的地方主要分为：</p>\n<ol>\n<li>登录页面</li>\n<li><code>navbar</code> 区域</li>\n<li><code>sidebar</code> 区域</li>\n<li>面包屑区域</li>\n</ol>\n<p>那么这一小节，我们先来处理前两个</p>\n<p><strong>登录页面：</strong></p>\n<p><code>login/index</code></p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\">&lt;template&gt;<br>  <span class=\"language-xml\"><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">div</span> <span class=\"hljs-attr\">class</span>=<span class=\"hljs-string\">&quot;login-container&quot;</span>&gt;</span></span><br><span class=\"language-xml\">    ...</span><br><span class=\"language-xml\">      <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">div</span> <span class=\"hljs-attr\">class</span>=<span class=\"hljs-string\">&quot;title-container&quot;</span>&gt;</span></span><br><span class=\"language-xml\">        <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">h3</span> <span class=\"hljs-attr\">class</span>=<span class=\"hljs-string\">&quot;title&quot;</span>&gt;</span>&#123;&#123; $t(&#x27;msg.login.title&#x27;) &#125;&#125;<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">h3</span>&gt;</span></span><br><span class=\"language-xml\">          <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">lang-select</span> <span class=\"hljs-attr\">class</span>=<span class=\"hljs-string\">&quot;lang-select&quot;</span> <span class=\"hljs-attr\">effect</span>=<span class=\"hljs-string\">&quot;light&quot;</span>&gt;</span><span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">lang-select</span>&gt;</span></span><br><span class=\"language-xml\">      <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">div</span>&gt;</span></span><br><span class=\"language-xml\"></span><br><span class=\"language-xml\">      ...</span><br><span class=\"language-xml\"></span><br><span class=\"language-xml\">      <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">el-button</span></span></span><br><span class=\"hljs-tag\"><span class=\"language-xml\">        <span class=\"hljs-attr\">type</span>=<span class=\"hljs-string\">&quot;primary&quot;</span></span></span><br><span class=\"hljs-tag\"><span class=\"language-xml\">        <span class=\"hljs-attr\">style</span>=<span class=\"hljs-string\">&quot;width: 100%; margin-bottom: 30px&quot;</span></span></span><br><span class=\"hljs-tag\"><span class=\"language-xml\">        <span class=\"hljs-attr\">:loading</span>=<span class=\"hljs-string\">&quot;loading&quot;</span></span></span><br><span class=\"hljs-tag\"><span class=\"language-xml\">        @<span class=\"hljs-attr\">click</span>=<span class=\"hljs-string\">&quot;handleLogin&quot;</span></span></span><br><span class=\"hljs-tag\"><span class=\"language-xml\">        &gt;</span>&#123;&#123; $t(&#x27;msg.login.loginBtn&#x27;) &#125;&#125;&lt;/el-button</span><br><span class=\"language-xml\">      &gt;</span><br><span class=\"language-xml\">      </span><br><span class=\"language-xml\">      <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">div</span> <span class=\"hljs-attr\">class</span>=<span class=\"hljs-string\">&quot;tips&quot;</span> <span class=\"hljs-attr\">v-html</span>=<span class=\"hljs-string\">&quot;$t(&#x27;msg.login.desc&#x27;)&quot;</span>&gt;</span><span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">div</span>&gt;</span></span><br><span class=\"language-xml\">    <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">el-form</span>&gt;</span></span><br><span class=\"language-xml\">  <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">div</span>&gt;</span></span><br>&lt;/template&gt;<br><br><span class=\"language-xml\"><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">script</span> <span class=\"hljs-attr\">setup</span>&gt;</span><span class=\"language-javascript\"></span></span><br><span class=\"language-javascript\"><span class=\"language-xml\"><span class=\"hljs-keyword\">import</span> &#123; useI18n &#125; <span class=\"hljs-keyword\">from</span> <span class=\"hljs-string\">&#x27;vue-i18n&#x27;</span></span></span><br><span class=\"language-javascript\"><span class=\"language-xml\">...</span></span><br><span class=\"language-javascript\"><span class=\"language-xml\"><span class=\"hljs-comment\">// 验证规则</span></span></span><br><span class=\"language-javascript\"><span class=\"language-xml\"><span class=\"hljs-keyword\">const</span> i18n = <span class=\"hljs-title function_\">useI18n</span>()</span></span><br><span class=\"language-javascript\"><span class=\"language-xml\"><span class=\"hljs-keyword\">const</span> loginRules = <span class=\"hljs-title function_\">ref</span>(&#123;</span></span><br><span class=\"language-javascript\"><span class=\"language-xml\">  <span class=\"hljs-attr\">username</span>: [</span></span><br><span class=\"language-javascript\"><span class=\"language-xml\">    &#123;</span></span><br><span class=\"language-javascript\"><span class=\"language-xml\">      ...</span></span><br><span class=\"language-javascript\"><span class=\"language-xml\">      <span class=\"hljs-attr\">message</span>: i18n.<span class=\"hljs-title function_\">t</span>(<span class=\"hljs-string\">&#x27;msg.login.usernameRule&#x27;</span>)</span></span><br><span class=\"language-javascript\"><span class=\"language-xml\">    &#125;</span></span><br><span class=\"language-javascript\"><span class=\"language-xml\">  ],</span></span><br><span class=\"language-javascript\"><span class=\"language-xml\">  ...</span></span><br><span class=\"language-javascript\"><span class=\"language-xml\">&#125;)</span></span><br><span class=\"language-javascript\"><span class=\"language-xml\">...</span></span><br><span class=\"language-javascript\"><span class=\"language-xml\"></span><span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">script</span>&gt;</span></span><br><br><br></code></pre></td></tr></table></figure>\n\n<p><code>login/rules</code></p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\"><span class=\"hljs-keyword\">import</span> i18n <span class=\"hljs-keyword\">from</span> <span class=\"hljs-string\">&#x27;@/i18n&#x27;</span><br><span class=\"hljs-keyword\">export</span> <span class=\"hljs-keyword\">const</span> <span class=\"hljs-title function_\">validatePassword</span> = (<span class=\"hljs-params\"></span>) =&gt; &#123;<br>  <span class=\"hljs-keyword\">return</span> <span class=\"hljs-function\">(<span class=\"hljs-params\">rule, value, callback</span>) =&gt;</span> &#123;<br>    <span class=\"hljs-keyword\">if</span> (value.<span class=\"hljs-property\">length</span> &lt; <span class=\"hljs-number\">6</span>) &#123;<br>      <span class=\"hljs-title function_\">callback</span>(<span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">Error</span>(i18n.<span class=\"hljs-property\">global</span>.<span class=\"hljs-title function_\">t</span>(<span class=\"hljs-string\">&#x27;msg.login.passwordRule&#x27;</span>)))<br>    &#125; <span class=\"hljs-keyword\">else</span> &#123;<br>      <span class=\"hljs-title function_\">callback</span>()<br>    &#125;<br>  &#125;<br>&#125;<br><br></code></pre></td></tr></table></figure>\n\n<p> <strong><code>navbar</code> 区域</strong></p>\n<p><code>layout/components/navbar</code></p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\">&lt;template&gt;<br>  <span class=\"language-xml\"><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">div</span> <span class=\"hljs-attr\">class</span>=<span class=\"hljs-string\">&quot;navbar&quot;</span>&gt;</span></span><br><span class=\"language-xml\">    ...</span><br><span class=\"language-xml\">        <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">template</span> #<span class=\"hljs-attr\">dropdown</span>&gt;</span></span><br><span class=\"language-xml\">          <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">el-dropdown-menu</span> <span class=\"hljs-attr\">class</span>=<span class=\"hljs-string\">&quot;user-dropdown&quot;</span>&gt;</span></span><br><span class=\"language-xml\">            <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">router-link</span> <span class=\"hljs-attr\">to</span>=<span class=\"hljs-string\">&quot;/&quot;</span>&gt;</span></span><br><span class=\"language-xml\">              <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">el-dropdown-item</span>&gt;</span> &#123;&#123; $t(&#x27;msg.navBar.home&#x27;) &#125;&#125; <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">el-dropdown-item</span>&gt;</span></span><br><span class=\"language-xml\">            <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">router-link</span>&gt;</span></span><br><span class=\"language-xml\">            <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">a</span> <span class=\"hljs-attr\">target</span>=<span class=\"hljs-string\">&quot;_blank&quot;</span> <span class=\"hljs-attr\">href</span>=<span class=\"hljs-string\">&quot;&quot;</span>&gt;</span></span><br><span class=\"language-xml\">              <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">el-dropdown-item</span>&gt;</span>&#123;&#123; $t(&#x27;msg.navBar.course&#x27;) &#125;&#125;<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">el-dropdown-item</span>&gt;</span></span><br><span class=\"language-xml\">            <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">a</span>&gt;</span></span><br><span class=\"language-xml\">            <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">el-dropdown-item</span> <span class=\"hljs-attr\">divided</span> @<span class=\"hljs-attr\">click</span>=<span class=\"hljs-string\">&quot;logout&quot;</span>&gt;</span></span><br><span class=\"language-xml\">              &#123;&#123; $t(&#x27;msg.navBar.logout&#x27;) &#125;&#125;</span><br><span class=\"language-xml\">            <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">el-dropdown-item</span>&gt;</span></span><br><span class=\"language-xml\">          <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">el-dropdown-menu</span>&gt;</span></span><br><span class=\"language-xml\">        <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">template</span>&gt;</span></span><br><span class=\"language-xml\">      <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">el-dropdown</span>&gt;</span></span><br>    &lt;/div&gt;<br>  &lt;/div&gt;<br>&lt;/template&gt;<br></code></pre></td></tr></table></figure>\n\n<p><code>components/LangSelect/index</code></p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\">&lt;el-tooltip :content=<span class=\"hljs-string\">&quot;$t(&#x27;msg.navBar.lang&#x27;)&quot;</span> :effect=<span class=\"hljs-string\">&quot;effect&quot;</span>&gt;<br><br><span class=\"hljs-keyword\">const</span> <span class=\"hljs-title function_\">handleSetLanguage</span> = lang =&gt; &#123;<br>  ...<br>  <span class=\"hljs-title class_\">ElMessage</span>.<span class=\"hljs-title function_\">success</span>(i18n.<span class=\"hljs-title function_\">t</span>(<span class=\"hljs-string\">&#x27;msg.toast.switchLangSuccess&#x27;</span>))<br>&#125;<br></code></pre></td></tr></table></figure>\n\n<h2 id=\"sidebar-与-面包屑-区域的国际化处理\"><a href=\"#sidebar-与-面包屑-区域的国际化处理\" class=\"headerlink\" title=\"sidebar 与 面包屑 区域的国际化处理\"></a>sidebar 与 面包屑 区域的国际化处理</h2><p><strong>sidebar 区域</strong></p>\n<p>目前对于 <code>sidebar</code> 而言，显示的文本是我们在定义路由表时的 <code>title</code></p>\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs html\"><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">span</span>&gt;</span>&#123;&#123; title &#125;&#125;<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">span</span>&gt;</span><br></code></pre></td></tr></table></figure>\n\n<p>我们可以 <strong>把 <code>title</code> 作为语言包内容的 <code>key</code> 进行处理</strong></p>\n<p>创建 <code>utils/i18n</code> 工具模块，用于 <strong>将 <code>title</code> 转化为国际化内容</strong></p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\"><span class=\"hljs-keyword\">import</span> i18n <span class=\"hljs-keyword\">from</span> <span class=\"hljs-string\">&#x27;@/i18n&#x27;</span><br><span class=\"hljs-keyword\">export</span> <span class=\"hljs-keyword\">function</span> <span class=\"hljs-title function_\">generateTitle</span>(<span class=\"hljs-params\">title</span>) &#123;<br>  <span class=\"hljs-keyword\">return</span> i18n.<span class=\"hljs-property\">global</span>.<span class=\"hljs-title function_\">t</span>(<span class=\"hljs-string\">&#x27;msg.route.&#x27;</span> + title)<br>&#125;<br><br></code></pre></td></tr></table></figure>\n\n<p>在 <code>layout/components/Sidebar/MenuItem.vue</code> 中导入该方法：</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\">&lt;template&gt;<br>  ...<br>  &lt;span&gt;&#123;&#123; <span class=\"hljs-title function_\">generateTitle</span>(title) &#125;&#125;&lt;/span&gt;<br>&lt;/template&gt;<br><br><span class=\"language-xml\"><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">script</span> <span class=\"hljs-attr\">setup</span>&gt;</span><span class=\"language-javascript\"></span></span><br><span class=\"language-javascript\"><span class=\"language-xml\"><span class=\"hljs-keyword\">import</span> &#123; generateTitle &#125; <span class=\"hljs-keyword\">from</span> <span class=\"hljs-string\">&#x27;@/utils/i18n&#x27;</span></span></span><br><span class=\"language-javascript\"><span class=\"language-xml\">...</span></span><br><span class=\"language-javascript\"><span class=\"language-xml\"></span><span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">script</span>&gt;</span></span><br><br></code></pre></td></tr></table></figure>\n\n<p>最后修改下 <code>sidebarHeader</code> 的内容</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\">&lt;h1 <span class=\"hljs-keyword\">class</span>=<span class=\"hljs-string\">&quot;logo-title&quot;</span> v-<span class=\"hljs-keyword\">if</span>=<span class=\"hljs-string\">&quot;$store.getters.sidebarOpened&quot;</span>&gt;<br>  &#123;&#123; $t(<span class=\"hljs-string\">&#x27;msg.logo&#x27;</span>) &#125;&#125;<br>&lt;/h1&gt;<br></code></pre></td></tr></table></figure>\n\n<p><strong>面包屑区域：</strong></p>\n<p>在 <code>components/Breadcrumb/index</code></p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\">&lt;template&gt;<br>...<br>    &lt;!-- 不可点击项 --&gt;<br>    <span class=\"language-xml\"><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">span</span> <span class=\"hljs-attr\">v-if</span>=<span class=\"hljs-string\">&quot;index === breadcrumbData.length - 1&quot;</span> <span class=\"hljs-attr\">class</span>=<span class=\"hljs-string\">&quot;no-redirect&quot;</span>&gt;</span>&#123;&#123;</span><br><span class=\"language-xml\">        generateTitle(item.meta.title)</span><br><span class=\"language-xml\">        &#125;&#125;<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">span</span>&gt;</span></span><br>    &lt;!-- 可点击项 --&gt;<br>    <span class=\"language-xml\"><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">a</span> <span class=\"hljs-attr\">v-else</span> <span class=\"hljs-attr\">class</span>=<span class=\"hljs-string\">&quot;redirect&quot;</span> @<span class=\"hljs-attr\">click.prevent</span>=<span class=\"hljs-string\">&quot;onLinkClick(item)&quot;</span>&gt;</span>&#123;&#123;</span><br><span class=\"language-xml\">        generateTitle(item.meta.title)</span><br><span class=\"language-xml\">        &#125;&#125;<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">a</span>&gt;</span></span><br>...<br>&lt;/template&gt;<br><br><span class=\"language-xml\"><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">script</span> <span class=\"hljs-attr\">setup</span>&gt;</span><span class=\"language-javascript\"></span></span><br><span class=\"language-javascript\"><span class=\"language-xml\"><span class=\"hljs-keyword\">import</span> &#123; generateTitle &#125; <span class=\"hljs-keyword\">from</span> <span class=\"hljs-string\">&#x27;@/utils/i18n&#x27;</span></span></span><br><span class=\"language-javascript\"><span class=\"language-xml\">...</span></span><br><span class=\"language-javascript\"><span class=\"language-xml\"></span><span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">script</span>&gt;</span></span><br><br></code></pre></td></tr></table></figure>\n\n<h2 id=\"国际化缓存处理\"><a href=\"#国际化缓存处理\" class=\"headerlink\" title=\"国际化缓存处理\"></a>国际化缓存处理</h2><p>我们希望在 <strong>刷新页面后，当前的国际化选择可以被保留</strong>，所以想要实现这个功能，那么就需要进行 <strong>国际化的缓存处理</strong></p>\n<p>此处的缓存，我们依然通过两个方面进行：</p>\n<ol>\n<li><code>vuex</code> 缓存</li>\n<li><code>LocalStorage</code> 缓存</li>\n</ol>\n<p>只不过这里的缓存，我们已经在处理 <strong><code>langSelect</code> 组件时</strong> 处理完成了，所以此时我们只需要使用缓存下来的数据即可。</p>\n<p>在 <code>i18n/index</code> 中，创建 <code>getLanguage</code> 方法：</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\"><span class=\"hljs-keyword\">import</span> store <span class=\"hljs-keyword\">from</span> <span class=\"hljs-string\">&#x27;@/store&#x27;</span><br><span class=\"hljs-comment\">/**</span><br><span class=\"hljs-comment\"> * 返回当前 lang</span><br><span class=\"hljs-comment\"> */</span><br><span class=\"hljs-keyword\">function</span> <span class=\"hljs-title function_\">getLanguage</span>(<span class=\"hljs-params\"></span>) &#123;<br>  <span class=\"hljs-keyword\">return</span> store &amp;&amp; store.<span class=\"hljs-property\">getters</span> &amp;&amp; store.<span class=\"hljs-property\">getters</span>.<span class=\"hljs-property\">language</span><br>&#125;<br></code></pre></td></tr></table></figure>\n\n<p>修改 <code>createI18n</code> 的 <code>locale</code> 为 <code>getLanguage()</code> </p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\"><span class=\"hljs-keyword\">const</span> i18n = <span class=\"hljs-title function_\">createI18n</span>(&#123;<br>  ...<br>  <span class=\"hljs-attr\">locale</span>: <span class=\"hljs-title function_\">getLanguage</span>()<br>&#125;)<br></code></pre></td></tr></table></figure>\n\n<h2 id=\"国际化方案总结\"><a href=\"#国际化方案总结\" class=\"headerlink\" title=\"国际化方案总结\"></a>国际化方案总结</h2><p>国际化是前端项目中的一个非常常见的功能，那么在前端项目中实现国际化主要依靠的就是 <code>vue-i18n</code> 这个第三方的包。</p>\n<p>关于国际化的实现原理大家可以参照 <strong>国际化实现原理</strong> 这一小节，这里我们就不再赘述了。</p>\n<p>而  <code>i18n</code> 的使用，整体来说就分为这么四步：</p>\n<ol>\n<li>创建 <code>messages</code> 数据源</li>\n<li>创建 <code>locale</code> 语言变量</li>\n<li>初始化 <code>i18n</code> 实例</li>\n<li>注册 <code>i18n</code> 实例</li>\n</ol>\n<p>核心的内容其实就是 数据源的部分，但是大家需要注意，如果你的项目中使用了 <strong>第三方组件库</strong> ，那么不要忘记 <strong>第三方组件库的数据源</strong> 需要 <strong>单独</strong> 进行处理！</p>\n<h1 id=\"动态换肤原理分析\"><a href=\"#动态换肤原理分析\" class=\"headerlink\" title=\"动态换肤原理分析\"></a>动态换肤原理分析</h1><p>想要实现 <strong>动态换肤</strong> 的一个前置条件就是：<strong>色值不可以写死！</strong></p>\n<p>首先我们先来说一下动态换肤的实现方式。</p>\n<p>在 <code>scss</code> 中，我们可以通过 <code>$变量名:变量值</code> 的方式定义 <code>css 变量</code> ，然后通过该 <code>css</code> 来去指定某一块 <code>DOM</code> 对应的颜色。</p>\n<p>那么大家可以想一下，如果我此时改变了该 <code>css</code> 变量的值，那么对应的 <code>DOM</code> 颜色是不是也会同步发生变化。</p>\n<p>当大量的 <code>DOM</code> 都依赖这个 <code>css 变量</code> 设置颜色时，我们是不是只需要改变这个 <code>css 变量</code> ，那么所有 <code>DOM</code> 的颜色是不是都会发生变化，所谓的 <strong>动态换肤</strong> 是不是就可以实现了！</p>\n<p>这个就是 <strong>动态换肤</strong> 的实现原理!</p>\n<p>实现换肤和主题大致有两种方案:</p>\n<ol>\n<li>使用原生支持的 css var</li>\n<li>通过一些手段覆盖 element plus 样式</li>\n</ol>\n<p>我们先看来看看 css var 的实现吧。</p>\n<h2 id=\"css变量\"><a href=\"#css变量\" class=\"headerlink\" title=\"css变量\"></a>css变量</h2><blockquote>\n<p><a href=\"https://developer.mozilla.org/zh-CN/docs/Web/CSS/:root\">https://developer.mozilla.org/zh-CN/docs/Web/CSS/:root</a></p>\n</blockquote>\n<p>变量 与 color、font-size 等正式属性没有什么不同，只是没有默认含义。</p>\n<p>所以 CSS 变量（CSS variable）又叫做”CSS 自定义属性”（CSS custom properties）。因为变量与自定义的 CSS 属性其实是一回事。</p>\n<p>变量可以分为</p>\n<ul>\n<li>全局变量</li>\n<li>局部变量</li>\n</ul>\n<p><strong>全局变量</strong><br>通过 <code>:root</code> 去定义，其他所有的元素都可以通过 <code>var(--xxx)</code> 的形式去使用<code>全局变量</code>，我们来看下面这个例子:</p>\n<blockquote>\n<p>var()函数还可以使用第二个参数，表示变量的默认值。如果该变量不存在，就会使用这个默认值。</p>\n</blockquote>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\">&lt;style&gt;<br>  :root &#123;<br>    --<span class=\"hljs-attr\">color</span>: skyblue;<br>  &#125;<br><br>  .<span class=\"hljs-property\">use</span>-<span class=\"hljs-variable language_\">global</span> &#123;<br>    <span class=\"hljs-attr\">color</span>: <span class=\"hljs-title function_\">var</span>(--color)<br>  &#125;<br>&lt;/style&gt;<br><br><span class=\"hljs-comment\">// body</span><br><span class=\"language-xml\"><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">div</span> <span class=\"hljs-attr\">class</span>=<span class=\"hljs-string\">&quot;use-global&quot;</span>&gt;</span>使用了全局变量<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">div</span>&gt;</span></span><br></code></pre></td></tr></table></figure>\n<p><strong>:root</strong></p>\n<blockquote>\n<p>:root 这个 CSS 伪类匹配文档树的根元素。对于 HTML 来说，:root 表示 <html> 元素，除了优先级更高之外，与 html 选择器相同。</p>\n</blockquote>\n<p><strong>自定义属性 (–*)：CSS 变量</strong></p>\n<blockquote>\n<p>带有前缀–的属性名，比如–example–name，表示的是带有值的自定义属性，其可以通过 var 函数在全文档范围内复用的。</p>\n</blockquote>\n<p><strong>局部变量</strong></p>\n<p>我们可以在某个选择器下去定义变量，或者在元素的 <code>style</code> 属性上定义变量：</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\"><span class=\"hljs-comment\">// style</span><br>:root &#123;<br>  --<span class=\"hljs-attr\">color</span>: skyblue;<br>&#125;<br><br>.<span class=\"hljs-property\">parent</span> &#123;<br>  --<span class=\"hljs-attr\">color</span>: pink; <span class=\"hljs-comment\">// 优先级更高</span><br>&#125;<br><br>h3 &#123;<br>  <span class=\"hljs-attr\">color</span>: <span class=\"hljs-title function_\">var</span>(--color)<br>&#125;<br><br><span class=\"hljs-comment\">// html</span><br>&lt;div <span class=\"hljs-keyword\">class</span>=<span class=\"hljs-string\">&quot;parent&quot;</span>&gt;<br>  <span class=\"language-xml\"><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">h3</span>&gt;</span>child title<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">h3</span>&gt;</span></span><br>&lt;/div&gt;<br></code></pre></td></tr></table></figure>\n\n<p>这里 <code>h3</code> 标签会显示红色。虽然我们在 <code>:root</code> 上也定义了 <code>--color</code> 变量，但是根据就近原则，<code>h3</code> 会取父级定义的变量。</p>\n<p>我们还可以在 <code>style</code> 属性上定义变量，这里我们定义了一个 <code>--bg</code> 变量，其子元素可以访问到这个变量。</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\">.<span class=\"hljs-property\">parent</span> &#123;<br>  --<span class=\"hljs-attr\">color</span>: pink;<br>&#125;<br><br>h3 &#123;<br>  <span class=\"hljs-attr\">color</span>: <span class=\"hljs-title function_\">var</span>(--color);<br>  background-<span class=\"hljs-attr\">color</span>: <span class=\"hljs-title function_\">var</span>(--bg);<br>&#125;<br><br>&lt;div <span class=\"hljs-keyword\">class</span>=<span class=\"hljs-string\">&quot;parent&quot;</span> style=<span class=\"hljs-string\">&quot;--bg: black;&quot;</span>&gt;<br>  <span class=\"language-xml\"><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">h3</span>&gt;</span>child title<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">h3</span>&gt;</span></span><br>&lt;/div&gt;<br></code></pre></td></tr></table></figure>\n\n<h2 id=\"修改-css-变量\"><a href=\"#修改-css-变量\" class=\"headerlink\" title=\"修改 css 变量\"></a>修改 css 变量</h2><p>这里定义了两个按钮，一个修改全局的（根组件）的变量，一个用来修改特定元素上的定义的变量：</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\">&lt;button <span class=\"hljs-keyword\">class</span>=<span class=\"hljs-string\">&quot;btn&quot;</span>&gt;change root&lt;/button&gt;<br><span class=\"language-xml\"><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">button</span> <span class=\"hljs-attr\">class</span>=<span class=\"hljs-string\">&quot;variable&quot;</span>&gt;</span>change local variable<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">button</span>&gt;</span></span><br></code></pre></td></tr></table></figure>\n\n<p><strong>修改全局变量</strong></p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\"><span class=\"hljs-keyword\">const</span> btn = <span class=\"hljs-variable language_\">document</span>.<span class=\"hljs-title function_\">querySelector</span>(<span class=\"hljs-string\">&#x27;.btn&#x27;</span>)<br><br>btn.<span class=\"hljs-title function_\">addEventListener</span>(<span class=\"hljs-string\">&#x27;click&#x27;</span>, <span class=\"hljs-function\">() =&gt;</span> &#123;<br>  <span class=\"hljs-keyword\">const</span> html = <span class=\"hljs-variable language_\">document</span>.<span class=\"hljs-property\">documentElement</span><br><br>  html.<span class=\"hljs-property\">style</span>.<span class=\"hljs-title function_\">setProperty</span>(<span class=\"hljs-string\">&#x27;--color&#x27;</span>, <span class=\"hljs-string\">&#x27;red&#x27;</span>)<br>&#125;)<br></code></pre></td></tr></table></figure>\n\n<p><strong>修改局部变量</strong></p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\"><span class=\"hljs-keyword\">const</span> variableBtn = <span class=\"hljs-variable language_\">document</span>.<span class=\"hljs-title function_\">querySelector</span>(<span class=\"hljs-string\">&#x27;.variable&#x27;</span>)<br><br>variableBtn.<span class=\"hljs-title function_\">addEventListener</span>(<span class=\"hljs-string\">&#x27;click&#x27;</span>, <span class=\"hljs-function\">() =&gt;</span> &#123;<br>  <span class=\"hljs-keyword\">const</span> parent = <span class=\"hljs-variable language_\">document</span>.<span class=\"hljs-title function_\">querySelector</span>(<span class=\"hljs-string\">&#x27;.parent&#x27;</span>)<br><br>  parent.<span class=\"hljs-property\">style</span>.<span class=\"hljs-title function_\">setProperty</span>(<span class=\"hljs-string\">&#x27;--color&#x27;</span>, <span class=\"hljs-string\">&#x27;green&#x27;</span>)<br>&#125;)<br></code></pre></td></tr></table></figure>\n\n<h1 id=\"暗黑模式原理分析\"><a href=\"#暗黑模式原理分析\" class=\"headerlink\" title=\"暗黑模式原理分析\"></a>暗黑模式原理分析</h1><blockquote>\n<p>prefers-color-scheme</p>\n<p>prefers-color-scheme CSS 媒体特性: 用于检测用户是否有将系统的主题色设置为亮色或者暗色。</p>\n</blockquote>\n<h2 id=\"主题色实现原理\"><a href=\"#主题色实现原理\" class=\"headerlink\" title=\"主题色实现原理\"></a>主题色实现原理</h2><p>通过 <code>媒体查询</code> 去监听系统主题色的变化。</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\"><span class=\"hljs-comment\">// style</span><br>@media (prefers-color-<span class=\"hljs-attr\">scheme</span>: dark) &#123;<br>  .<span class=\"hljs-property\">day</span>.<span class=\"hljs-property\">dark</span>-scheme   &#123; <span class=\"hljs-attr\">background</span>:  #<span class=\"hljs-number\">333</span>; <span class=\"hljs-attr\">color</span>: white; &#125;<br>  .<span class=\"hljs-property\">night</span>.<span class=\"hljs-property\">dark</span>-scheme &#123; <span class=\"hljs-attr\">background</span>: black; <span class=\"hljs-attr\">color</span>:  red; &#125;<br>&#125;<br><br>@media (prefers-color-<span class=\"hljs-attr\">scheme</span>: light) &#123;<br>  .<span class=\"hljs-property\">day</span>.<span class=\"hljs-property\">light</span>-scheme   &#123; <span class=\"hljs-attr\">background</span>: skyblue; <span class=\"hljs-attr\">color</span>:  #<span class=\"hljs-number\">333</span>; &#125;<br>  .<span class=\"hljs-property\">night</span>.<span class=\"hljs-property\">light</span>-scheme &#123; <span class=\"hljs-attr\">background</span>:  pink; <span class=\"hljs-attr\">color</span>: #<span class=\"hljs-number\">333</span>; &#125;<br>&#125;<br><br>.<span class=\"hljs-property\">day</span>, .<span class=\"hljs-property\">night</span> &#123;<br>  <span class=\"hljs-attr\">display</span>: inline-block;<br>  <span class=\"hljs-attr\">padding</span>: 1em;<br>  <span class=\"hljs-attr\">width</span>: 7em;<br>  <span class=\"hljs-attr\">height</span>: 7em;<br>  vertical-<span class=\"hljs-attr\">align</span>: middle;<br>&#125;<br><br><span class=\"hljs-comment\">// html</span><br>&lt;div <span class=\"hljs-keyword\">class</span>=<span class=\"hljs-string\">&quot;day light-scheme&quot;</span>&gt;<span class=\"hljs-title class_\">Day</span> (changes <span class=\"hljs-keyword\">in</span> light scheme)&lt;/div&gt;<br><span class=\"language-xml\"><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">div</span> <span class=\"hljs-attr\">class</span>=<span class=\"hljs-string\">&quot;day dark-scheme&quot;</span>&gt;</span>Day (changes in dark scheme)<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">div</span>&gt;</span></span> &lt;br&gt;<br><br><span class=\"language-xml\"><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">div</span> <span class=\"hljs-attr\">class</span>=<span class=\"hljs-string\">&quot;night light-scheme&quot;</span>&gt;</span>Night (changes in light scheme)<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">div</span>&gt;</span></span><br><span class=\"language-xml\"><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">div</span> <span class=\"hljs-attr\">class</span>=<span class=\"hljs-string\">&quot;night dark-scheme&quot;</span>&gt;</span>Night (changes in dark scheme)<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">div</span>&gt;</span></span><br></code></pre></td></tr></table></figure>\n\n<p>现在，我们可以去切换系统的主题色，就会发现页面上的颜色跟着变化了，这是因为我们通过 <code>@media</code> 监听 <code>prefers-color-scheme</code> 起作用了。</p>\n<h2 id=\"window-matchMedia\"><a href=\"#window-matchMedia\" class=\"headerlink\" title=\"window.matchMedia\"></a>window.matchMedia</h2><p>虽然我们通过 css @media 能够应对系统的主题色切换，但是我们如何在 <code>js</code> 中去监听呢？</p>\n<p>答案是通过 <code>window.matchMedia</code> 方法：</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\"><span class=\"hljs-comment\">// 如果匹配成功，scheme.matches === true</span><br><span class=\"hljs-comment\">// 也就是说，如果我们的系统是暗黑色，那么这个 matches 就是true，否则是 false</span><br><span class=\"hljs-keyword\">const</span> scheme = <span class=\"hljs-variable language_\">window</span>.<span class=\"hljs-title function_\">matchMedia</span>(<span class=\"hljs-string\">&#x27;(prefers-color-scheme: dark)&#x27;</span>)<br><br>scheme.<span class=\"hljs-title function_\">addEventListener</span>(<span class=\"hljs-string\">&#x27;change&#x27;</span>, <span class=\"hljs-function\"><span class=\"hljs-params\">e</span> =&gt;</span> &#123;<br>  <span class=\"hljs-keyword\">if</span> (e.<span class=\"hljs-property\">matches</span>) &#123;<br>    <span class=\"hljs-comment\">// 暗黑色</span><br>  &#125; <span class=\"hljs-keyword\">else</span> &#123;<br>    <span class=\"hljs-comment\">// 亮色</span><br>  &#125;<br>&#125;)<br></code></pre></td></tr></table></figure>\n\n<h2 id=\"修改主题色\"><a href=\"#修改主题色\" class=\"headerlink\" title=\"修改主题色\"></a>修改主题色</h2><p>到此，我们知道了主题色的实现原理，我们如何在项目里去实现主题色的切换呢？</p>\n<p>我们来看一个小例子</p>\n<p>首先，我们先定义好 <code>全局变量</code>，里面包含了一些 <code>亮色模式</code> 下的变量：</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\">:root &#123;<br>  --<span class=\"hljs-attr\">color</span>: #<span class=\"hljs-number\">333</span>;<br>  --background-<span class=\"hljs-attr\">color</span>: pink;<br>&#125;<br><br>&lt;h1 style=<span class=\"hljs-string\">&quot;background-color: var(--background-color); color: var(--color)&quot;</span>&gt;<br>  我是一个标题。！！！<br>&lt;/h1&gt;<br><br><span class=\"language-xml\"><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">button</span> <span class=\"hljs-attr\">class</span>=<span class=\"hljs-string\">&quot;dark-btn&quot;</span>&gt;</span>dark mode<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">button</span>&gt;</span></span><br></code></pre></td></tr></table></figure>\n\n<p>在页面初始时，我们的背景色是粉色，颜色是浅黑色。</p>\n<p>现在我们创建一个按钮，来修改主题颜色，这个之前实现过了很简单对吧。</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\"><span class=\"hljs-keyword\">const</span> darkBtn = <span class=\"hljs-variable language_\">document</span>.<span class=\"hljs-title function_\">querySelector</span>(<span class=\"hljs-string\">&#x27;.dark-btn&#x27;</span>)<br><br>darkBtn.<span class=\"hljs-title function_\">addEventListener</span>(<span class=\"hljs-string\">&#x27;click&#x27;</span>, <span class=\"hljs-function\">() =&gt;</span> &#123;<br>  <span class=\"hljs-comment\">// 修改变量</span><br>  <span class=\"hljs-variable language_\">document</span>.<span class=\"hljs-property\">documentElement</span>.<span class=\"hljs-property\">style</span>.<span class=\"hljs-title function_\">setProperty</span>(<span class=\"hljs-string\">&#x27;--color&#x27;</span>, <span class=\"hljs-string\">&#x27;#fff&#x27;</span>)<br>  <span class=\"hljs-variable language_\">document</span>.<span class=\"hljs-property\">documentElement</span>.<span class=\"hljs-property\">style</span>.<span class=\"hljs-title function_\">setProperty</span>(<span class=\"hljs-string\">&#x27;--background-color&#x27;</span>, <span class=\"hljs-string\">&#x27;#000&#x27;</span>)<br>&#125;)<br></code></pre></td></tr></table></figure>\n\n<p>好无疑问这样是可以实现的，但是，如果变量多起来了，几十上百个，我们也要一个个去修改吗？</p>\n<p>既然我们的变量都定义在根元素上，那么我们可以采取 <strong>属性覆盖</strong> 的形式。</p>\n<p>我们定义一个 <code>[data-theme=&quot;dark&quot;]</code> 样式表，专门用来处理 <code>暗黑模式</code> 下的变量，这里是黑色背景白色字体。</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\">[data-theme=<span class=\"hljs-string\">&quot;dark&quot;</span>] &#123;<br>  --<span class=\"hljs-attr\">color</span>: #fff;<br>  --background-<span class=\"hljs-attr\">color</span>: #<span class=\"hljs-number\">000</span>;<br>&#125;<br></code></pre></td></tr></table></figure>\n\n<p>或者属性选择器：</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\"><span class=\"hljs-comment\">/* 浅色模式 */</span><br>html[data-theme=<span class=\"hljs-string\">&quot;light&quot;</span>]:root &#123;<br>  --body-<span class=\"hljs-attr\">background</span>: #efefef;<br>  --text-<span class=\"hljs-attr\">color</span>: #<span class=\"hljs-number\">333</span>;<br>&#125;<br><br><span class=\"hljs-comment\">/* 深色模式 */</span><br>html[data-theme=<span class=\"hljs-string\">&quot;dark&quot;</span>]:root &#123;<br>  --body-<span class=\"hljs-attr\">background</span>: #<span class=\"hljs-number\">000</span>;<br>  --text-<span class=\"hljs-attr\">color</span>: #ededed;<br>&#125;<br></code></pre></td></tr></table></figure>\n\n<p>一开始，这个样式表并不会生效，因为根标签上根本没有 <code>data-theme=&quot;dark&quot;</code> 属性，我们通过按钮来修改：</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\">darkBtn.<span class=\"hljs-title function_\">addEventListener</span>(<span class=\"hljs-string\">&#x27;click&#x27;</span>, <span class=\"hljs-function\">() =&gt;</span> &#123;<br>  <span class=\"hljs-variable language_\">document</span>.<span class=\"hljs-property\">documentElement</span>.<span class=\"hljs-title function_\">setAttribute</span>(<span class=\"hljs-string\">&#x27;data-theme&#x27;</span>, <span class=\"hljs-string\">&#x27;dark&#x27;</span>)<br>&#125;)<br></code></pre></td></tr></table></figure>\n\n<p>我们给根标签设置了 <code>data-theme=&quot;dark&quot;</code> 属性，同时内部定了暗黑相关的变量，这时，<code>data-theme=&quot;dark&quot;</code> 内部的变量就会覆盖 <code>:root</code> 中的变量了，从而达到切换主题色的效果。</p>\n<p>同时，我们需要根据系统的主题色，来设置项目的主题色，这里就要用到 <code>window.matchMedia</code> 方法了。</p>\n<p>如果在 <code>Vue</code> 项目中，我们可以这样去实现:</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\"><span class=\"hljs-keyword\">const</span> theme = <span class=\"hljs-title function_\">computed</span>(<span class=\"hljs-function\">() =&gt;</span> store.<span class=\"hljs-property\">state</span>.<span class=\"hljs-property\">settings</span>.<span class=\"hljs-property\">theme</span>);<br><br><span class=\"hljs-comment\">// 查看当前是否是 暗黑模式</span><br><span class=\"hljs-keyword\">const</span> mediaQueryListDark = <span class=\"hljs-variable language_\">window</span>.<span class=\"hljs-title function_\">matchMedia</span>(<span class=\"hljs-string\">&#x27;(prefers-color-scheme: dark)&#x27;</span>);<br><br><span class=\"hljs-keyword\">const</span> <span class=\"hljs-title function_\">changeTheme</span> = (<span class=\"hljs-params\">theme</span>) =&gt; &#123;<br>  <span class=\"hljs-comment\">// 批量覆盖全局的变量</span><br>\t<span class=\"hljs-variable language_\">document</span>.<span class=\"hljs-property\">documentElement</span>.<span class=\"hljs-title function_\">setAttribute</span>(<span class=\"hljs-string\">&#x27;data-theme&#x27;</span>, theme);<br>&#125;;<br><br><span class=\"hljs-keyword\">const</span> <span class=\"hljs-title function_\">handleColorSchemeChange</span> = evt =&gt; &#123;<br>  <span class=\"hljs-keyword\">if</span> (evt.<span class=\"hljs-property\">matches</span>) &#123;<br>    <span class=\"hljs-title function_\">changeTheme</span>(<span class=\"hljs-string\">&#x27;dark&#x27;</span>);<br>  &#125; <span class=\"hljs-keyword\">else</span> &#123;<br>    <span class=\"hljs-title function_\">changeTheme</span>(<span class=\"hljs-string\">&#x27;light&#x27;</span>);<br>  &#125;<br>&#125;;<br><br><span class=\"hljs-title function_\">watchEffect</span>(<span class=\"hljs-function\">() =&gt;</span> &#123;<br>  <span class=\"hljs-keyword\">if</span> (theme.<span class=\"hljs-property\">value</span> === <span class=\"hljs-string\">&#x27;Follow System&#x27;</span>) &#123;<br>    <span class=\"hljs-comment\">// 初始值：跟随系统设置</span><br>    <span class=\"hljs-title function_\">handleColorSchemeChange</span>(mediaQueryListDark);<br><br>    <span class=\"hljs-comment\">// 监听系统主题的变化</span><br>    mediaQueryListDark.<span class=\"hljs-title function_\">addEventListener</span>(<span class=\"hljs-string\">&#x27;change&#x27;</span>, handleColorSchemeChange);<br>  &#125; <span class=\"hljs-keyword\">else</span> <span class=\"hljs-keyword\">if</span> (theme.<span class=\"hljs-property\">value</span>) &#123;<br>    <span class=\"hljs-title function_\">changeTheme</span>(theme.<span class=\"hljs-property\">value</span>.<span class=\"hljs-title function_\">toLowerCase</span>());<br><br>    <span class=\"hljs-comment\">// 如果不是跟随系统设置主题了，用户自己设置的主题色，我们就不需要监听系统的主题色切换了</span><br>    mediaQueryListDark.<span class=\"hljs-title function_\">removeEventListener</span>(<span class=\"hljs-string\">&#x27;change&#x27;</span>, handleColorSchemeChange);<br>  &#125;<br>&#125;);<br></code></pre></td></tr></table></figure>\n\n<h2 id=\"总结\"><a href=\"#总结\" class=\"headerlink\" title=\"总结\"></a>总结</h2><p>到这里，我们花了大量的时间和实例对换肤和主题的原理进行了研究，那么接下来就要进入正式的项目开发环节了。</p>\n<h1 id=\"官方换肤方案\"><a href=\"#官方换肤方案\" class=\"headerlink\" title=\"官方换肤方案\"></a>官方换肤方案</h1><blockquote>\n<p>官方样式路径：/node_modules/element-plus/theme-chalk/src/common/var.scss</p>\n</blockquote>\n<p>定义自己的 scss 文件，然后在 main.ts 导入。</p>\n<figure class=\"highlight css\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs css\">$<span class=\"hljs-attr\">--colors</span>: (<br>  <span class=\"hljs-string\">&quot;primary&quot;</span>: (<br>    <span class=\"hljs-string\">&quot;base&quot;</span>: pink,<br>  ),<br>  <span class=\"hljs-string\">&quot;success&quot;</span>: (<br>    <span class=\"hljs-string\">&quot;base&quot;</span>: blue,<br>  ),<br>  <span class=\"hljs-string\">&quot;warning&quot;</span>: (<br>    <span class=\"hljs-string\">&quot;base&quot;</span>: <span class=\"hljs-number\">#f2711c</span>,<br>  ),<br>  <span class=\"hljs-string\">&quot;danger&quot;</span>: (<br>    <span class=\"hljs-string\">&quot;base&quot;</span>: <span class=\"hljs-number\">#db2828</span>,<br>  ),<br>  <span class=\"hljs-string\">&quot;error&quot;</span>: (<br>    <span class=\"hljs-string\">&quot;base&quot;</span>: <span class=\"hljs-number\">#db2828</span>,<br>  ),<br>  <span class=\"hljs-string\">&quot;info&quot;</span>: (<br>    <span class=\"hljs-string\">&quot;base&quot;</span>: <span class=\"hljs-number\">#42b8dd</span>,<br>  ),<br>);<br><br><span class=\"hljs-keyword\">@forward</span> <span class=\"hljs-string\">&#x27;element-plus/theme-chalk/src/common/var.scss&#x27;</span> with (<br>  $<span class=\"hljs-attribute\">colors</span>: $--colors,<br>);<br><br><span class=\"hljs-comment\">/* 导入所有的样式变量 */</span><br><span class=\"hljs-keyword\">@use</span> <span class=\"hljs-string\">&quot;element-plus/theme-chalk/src/index.scss&quot;</span> as *;<br></code></pre></td></tr></table></figure>\n\n<p>修改 <code>main.ts</code></p>\n<figure class=\"highlight css\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs css\">// 注释原导入的 element-plus 样式<br>// import &#x27;element-plus/dist/index<span class=\"hljs-selector-class\">.css</span>&#x27;<br><br><br>// 导入我们自己的定义的样式<br>import &#x27;@/styles/cover-element-plus.scss&#x27;<br></code></pre></td></tr></table></figure>\n\n<h2 id=\"通过-CSS-变量设置\"><a href=\"#通过-CSS-变量设置\" class=\"headerlink\" title=\"通过 CSS 变量设置\"></a>通过 CSS 变量设置</h2><p>如果不通过上面那种方案，我们还可以定义全局的变量，来覆盖官方的样式。</p>\n<p>在自己的样式文件中写入需要覆盖的样式变量：</p>\n<figure class=\"highlight css\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs css\"><span class=\"hljs-selector-pseudo\">:root</span> &#123;<br>  <span class=\"hljs-attr\">--el-color-primary</span>: green;<br>&#125;<br></code></pre></td></tr></table></figure>\n\n<p>如果你只想自定义一个特定的组件，只需为某些组件单独添加内联样式。</p>\n<figure class=\"highlight css\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs css\">&lt;el-tag style=&quot;<span class=\"hljs-attr\">--el-tag-bg-color</span>: red<span class=\"hljs-string\">&quot;&gt;Tag&lt;/el-tag&gt;</span><br></code></pre></td></tr></table></figure>\n\n<p>出于性能原因，更加推荐你在类名下添加自定义 css 变量，而不是在全局的 :root 下。</p>\n<figure class=\"highlight css\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs css\"><span class=\"hljs-selector-class\">.custom-class</span> &#123;<br>  <span class=\"hljs-attr\">--el-tag-bg-color</span>: red;<br>&#125;<br></code></pre></td></tr></table></figure>\n\n<p>如果您想要通过 js 控制 css 变量，可以这样做：</p>\n<figure class=\"highlight css\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs css\">// document<span class=\"hljs-selector-class\">.documentElement</span> 是全局变量时<br>const el = document<span class=\"hljs-selector-class\">.documentElement</span><br>// const el = document<span class=\"hljs-selector-class\">.getElementById</span>(&#x27;xxx&#x27;)<br><br>// 获取 css 变量<br>getComputedStyle(el)<span class=\"hljs-selector-class\">.getPropertyValue</span>(`<span class=\"hljs-attr\">--el-color-primary</span>`)<br><br>// 设置 css 变量<br>el<span class=\"hljs-selector-class\">.style</span><span class=\"hljs-selector-class\">.setProperty</span>(&#x27;<span class=\"hljs-attr\">--el-color-primary</span>&#x27;, &#x27;red&#x27;)<br></code></pre></td></tr></table></figure>\n\n<h2 id=\"总结。\"><a href=\"#总结。\" class=\"headerlink\" title=\"总结。\"></a>总结。</h2><p>相当于我们重新定义了变量，覆盖了官方自己定义的变量，如果我们项目只需要一种颜色，那么这种方案是可行的，但是我们项目需要支持用户选择主题来替换，那么这种方案就不适用了。</p>\n<p>那么我来用另一种方案来实现吧。</p>\n<h1 id=\"换肤方案落地\"><a href=\"#换肤方案落地\" class=\"headerlink\" title=\"换肤方案落地\"></a>换肤方案落地</h1><p>在我们的项目中想要实现动态换肤，需要同时处理两个方面的内容：</p>\n<ol>\n<li><code>element-plus</code> 主题</li>\n<li>非 <code>element-plus</code> 主题</li>\n</ol>\n<p>明确好了原理之后，接下来我们就来理一下咱们的实现思路。</p>\n<p>从原理中我们可以得到以下两个关键信息：</p>\n<ol>\n<li>动态换肤的关键是修改 <code>css 变量</code> 的值</li>\n<li>换肤需要同时兼顾<ol>\n<li><code>element-plus</code> </li>\n<li>非 <code>element-plus</code> </li>\n</ol>\n</li>\n</ol>\n<p>那么根据以上关键信息，我们就可以得出对应的实现方案:</p>\n<ol>\n<li>创建一个组件 <code>ThemeSelect</code> 用来处理修改之后的 <code>css 变量</code> 的值</li>\n<li>根据新值修改 <code>element-plus</code>  主题色</li>\n<li>根据新值修改非 <code>element-plus</code>  主题色</li>\n</ol>\n<h2 id=\"创建-ThemeSelect-组件\"><a href=\"#创建-ThemeSelect-组件\" class=\"headerlink\" title=\"创建 ThemeSelect 组件\"></a>创建 ThemeSelect 组件</h2><p><code>ThemeSelect</code> 组件将由两部分组成：</p>\n<ol>\n<li><code>navbar</code> 中的展示图标</li>\n<li>选择颜色的弹出层</li>\n</ol>\n<p>这是效果图：</p>\n<p><img src=\"/img/theme-select.png\" alt=\"\"></p>\n<p><strong>创建 <code>components/ThemeSelect/index</code> 组件</strong></p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\">&lt;template&gt;<br>  &lt;!-- 主题图标 v-bind：<span class=\"hljs-attr\">https</span>:<span class=\"hljs-comment\">//v3.cn.vuejs.org/api/instance-properties.html#attrs --&gt;</span><br>  <span class=\"language-xml\"><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">el-dropdown</span></span></span><br><span class=\"hljs-tag\"><span class=\"language-xml\">    <span class=\"hljs-attr\">v-bind</span>=<span class=\"hljs-string\">&quot;$attrs&quot;</span></span></span><br><span class=\"hljs-tag\"><span class=\"language-xml\">    <span class=\"hljs-attr\">trigger</span>=<span class=\"hljs-string\">&quot;click&quot;</span></span></span><br><span class=\"hljs-tag\"><span class=\"language-xml\">    <span class=\"hljs-attr\">class</span>=<span class=\"hljs-string\">&quot;theme&quot;</span></span></span><br><span class=\"hljs-tag\"><span class=\"language-xml\">    @<span class=\"hljs-attr\">command</span>=<span class=\"hljs-string\">&quot;handleSetTheme&quot;</span></span></span><br><span class=\"hljs-tag\"><span class=\"language-xml\">  &gt;</span></span><br><span class=\"language-xml\">    <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">div</span>&gt;</span></span><br><span class=\"language-xml\">      <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">el-tooltip</span> <span class=\"hljs-attr\">:content</span>=<span class=\"hljs-string\">&quot;$t(&#x27;msg.navBar.themeChange&#x27;)&quot;</span>&gt;</span></span><br><span class=\"language-xml\">        <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">svg-icon</span> <span class=\"hljs-attr\">icon</span>=<span class=\"hljs-string\">&quot;change-theme&quot;</span> /&gt;</span></span><br><span class=\"language-xml\">      <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">el-tooltip</span>&gt;</span></span><br><span class=\"language-xml\">    <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">div</span>&gt;</span></span><br><span class=\"language-xml\">    <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">template</span> #<span class=\"hljs-attr\">dropdown</span>&gt;</span></span><br><span class=\"language-xml\">      <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">el-dropdown-menu</span>&gt;</span></span><br><span class=\"language-xml\">        <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">el-dropdown-item</span> <span class=\"hljs-attr\">command</span>=<span class=\"hljs-string\">&quot;color&quot;</span>&gt;</span></span><br><span class=\"language-xml\">          &#123;&#123; $t(&#x27;msg.theme.themeColorChange&#x27;) &#125;&#125;</span><br><span class=\"language-xml\">        <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">el-dropdown-item</span>&gt;</span></span><br><span class=\"language-xml\">      <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">el-dropdown-menu</span>&gt;</span></span><br><span class=\"language-xml\">    <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">template</span>&gt;</span></span><br><span class=\"language-xml\">  <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">el-dropdown</span>&gt;</span></span><br><br>  &lt;!-- 展示弹出层 --&gt;<br>  <span class=\"language-xml\"><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">div</span>&gt;</span></span><br><span class=\"language-xml\">    ...</span><br><span class=\"language-xml\">  <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">div</span>&gt;</span></span><br>&lt;/template&gt;<br><br><span class=\"language-xml\"><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">script</span> <span class=\"hljs-attr\">setup</span>&gt;</span><span class=\"language-javascript\"></span></span><br><span class=\"language-javascript\"><span class=\"language-xml\"><span class=\"hljs-keyword\">const</span> <span class=\"hljs-title function_\">handleSetTheme</span> = command =&gt; &#123;&#125;</span></span><br><span class=\"language-javascript\"><span class=\"language-xml\"></span><span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">script</span>&gt;</span></span><br><br><span class=\"language-xml\"><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">style</span> <span class=\"hljs-attr\">lang</span>=<span class=\"hljs-string\">&quot;scss&quot;</span> <span class=\"hljs-attr\">scoped</span>&gt;</span><span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">style</span>&gt;</span></span><br></code></pre></td></tr></table></figure>\n\n<p>在 <code>layout/components/navbar</code> 中进行引用</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\">&lt;div <span class=\"hljs-keyword\">class</span>=<span class=\"hljs-string\">&quot;right-menu&quot;</span>&gt;<br>  <span class=\"language-xml\"><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">theme-picker</span> <span class=\"hljs-attr\">class</span>=<span class=\"hljs-string\">&quot;right-menu-item hover-effect&quot;</span>&gt;</span><span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">theme-picker</span>&gt;</span></span><br>&lt;/div&gt;<br><br>... <br><br><span class=\"hljs-keyword\">import</span> <span class=\"hljs-title class_\">ThemePicker</span> <span class=\"hljs-keyword\">from</span> <span class=\"hljs-string\">&#x27;@/components/ThemeSelect/index&#x27;</span><br></code></pre></td></tr></table></figure>\n\n<p><strong>创建 <code>SelectColor</code> 组件</strong></p>\n<p>在有了 <code>ThemeSelect</code> 之后，接下来我们来去处理颜色选择的组件 <code>SelectColor</code>，在这里我们会用到 <code>element</code> 中的 <code>el-color-picker</code> 组件</p>\n<p>对于 <code>SelectColor</code> 的处理，我们需要分成两步进行：</p>\n<ol>\n<li>完成 <code>SelectColor</code> 弹窗展示的双向数据绑定</li>\n<li>把选中的色值进行本地缓存</li>\n</ol>\n<p>那么下面咱们先来看第一步：<strong>完成 <code>SelectColor</code> 弹窗展示的双向数据绑定</strong></p>\n<p>创建 <code>components/ThemePicker/components/SelectColor.vue</code> </p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\">&lt;template&gt;<br>  <span class=\"language-xml\"><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">el-dialog</span> <span class=\"hljs-attr\">title</span>=<span class=\"hljs-string\">&quot;提示&quot;</span> <span class=\"hljs-attr\">:model-value</span>=<span class=\"hljs-string\">&quot;modelValue&quot;</span> @<span class=\"hljs-attr\">close</span>=<span class=\"hljs-string\">&quot;closed&quot;</span> <span class=\"hljs-attr\">width</span>=<span class=\"hljs-string\">&quot;22%&quot;</span>&gt;</span></span><br><span class=\"language-xml\">    <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">div</span> <span class=\"hljs-attr\">class</span>=<span class=\"hljs-string\">&quot;center&quot;</span>&gt;</span></span><br><span class=\"language-xml\">      <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">p</span> <span class=\"hljs-attr\">class</span>=<span class=\"hljs-string\">&quot;title&quot;</span>&gt;</span>&#123;&#123; $t(&#x27;msg.theme.themeColorChange&#x27;) &#125;&#125;<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">p</span>&gt;</span></span><br><span class=\"language-xml\">      <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">el-color-picker</span></span></span><br><span class=\"hljs-tag\"><span class=\"language-xml\">        <span class=\"hljs-attr\">v-model</span>=<span class=\"hljs-string\">&quot;mColor&quot;</span></span></span><br><span class=\"hljs-tag\"><span class=\"language-xml\">        <span class=\"hljs-attr\">:predefine</span>=<span class=\"hljs-string\">&quot;predefineColors&quot;</span></span></span><br><span class=\"hljs-tag\"><span class=\"language-xml\">      &gt;</span><span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">el-color-picker</span>&gt;</span></span><br><span class=\"language-xml\">    <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">div</span>&gt;</span></span><br><span class=\"language-xml\">    <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">template</span> #<span class=\"hljs-attr\">footer</span>&gt;</span></span><br><span class=\"language-xml\">      <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">span</span> <span class=\"hljs-attr\">class</span>=<span class=\"hljs-string\">&quot;dialog-footer&quot;</span>&gt;</span></span><br><span class=\"language-xml\">        <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">el-button</span> @<span class=\"hljs-attr\">click</span>=<span class=\"hljs-string\">&quot;closed&quot;</span>&gt;</span>&#123;&#123; $t(&#x27;msg.universal.cancel&#x27;) &#125;&#125;<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">el-button</span>&gt;</span></span><br><span class=\"language-xml\">        <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">el-button</span> <span class=\"hljs-attr\">type</span>=<span class=\"hljs-string\">&quot;primary&quot;</span> @<span class=\"hljs-attr\">click</span>=<span class=\"hljs-string\">&quot;comfirm&quot;</span>&gt;</span>&#123;&#123;</span><br><span class=\"language-xml\">          $t(&#x27;msg.universal.confirm&#x27;)</span><br><span class=\"language-xml\">        &#125;&#125;<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">el-button</span>&gt;</span></span><br><span class=\"language-xml\">      <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">span</span>&gt;</span></span><br><span class=\"language-xml\">    <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">template</span>&gt;</span></span><br><span class=\"language-xml\">  <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">el-dialog</span>&gt;</span></span><br>&lt;/template&gt;<br><br><span class=\"language-xml\"><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">script</span> <span class=\"hljs-attr\">setup</span>&gt;</span><span class=\"language-javascript\"></span></span><br><span class=\"language-javascript\"><span class=\"language-xml\"><span class=\"hljs-keyword\">import</span> &#123; defineProps, defineEmits, ref &#125; <span class=\"hljs-keyword\">from</span> <span class=\"hljs-string\">&#x27;vue&#x27;</span></span></span><br><span class=\"language-javascript\"><span class=\"language-xml\"><span class=\"hljs-title function_\">defineProps</span>(&#123;</span></span><br><span class=\"language-javascript\"><span class=\"language-xml\">  <span class=\"hljs-attr\">modelValue</span>: &#123;</span></span><br><span class=\"language-javascript\"><span class=\"language-xml\">    <span class=\"hljs-attr\">type</span>: <span class=\"hljs-title class_\">Boolean</span>,</span></span><br><span class=\"language-javascript\"><span class=\"language-xml\">    <span class=\"hljs-attr\">required</span>: <span class=\"hljs-literal\">true</span></span></span><br><span class=\"language-javascript\"><span class=\"language-xml\">  &#125;</span></span><br><span class=\"language-javascript\"><span class=\"language-xml\">&#125;)</span></span><br><span class=\"language-javascript\"><span class=\"language-xml\"><span class=\"hljs-keyword\">const</span> emits = <span class=\"hljs-title function_\">defineEmits</span>([<span class=\"hljs-string\">&#x27;update:modelValue&#x27;</span>])</span></span><br><span class=\"language-javascript\"><span class=\"language-xml\"></span></span><br><span class=\"language-javascript\"><span class=\"language-xml\"><span class=\"hljs-comment\">// 预定义色值</span></span></span><br><span class=\"language-javascript\"><span class=\"language-xml\"><span class=\"hljs-keyword\">const</span> predefineColors = [</span></span><br><span class=\"language-javascript\"><span class=\"language-xml\">  <span class=\"hljs-string\">&#x27;#ff4500&#x27;</span>,</span></span><br><span class=\"language-javascript\"><span class=\"language-xml\">  <span class=\"hljs-string\">&#x27;#ff8c00&#x27;</span>,</span></span><br><span class=\"language-javascript\"><span class=\"language-xml\">  <span class=\"hljs-string\">&#x27;#ffd700&#x27;</span>,</span></span><br><span class=\"language-javascript\"><span class=\"language-xml\">  <span class=\"hljs-string\">&#x27;#90ee90&#x27;</span>,</span></span><br><span class=\"language-javascript\"><span class=\"language-xml\">  <span class=\"hljs-string\">&#x27;#00ced1&#x27;</span>,</span></span><br><span class=\"language-javascript\"><span class=\"language-xml\">  <span class=\"hljs-string\">&#x27;#1e90ff&#x27;</span>,</span></span><br><span class=\"language-javascript\"><span class=\"language-xml\">  <span class=\"hljs-string\">&#x27;#c71585&#x27;</span>,</span></span><br><span class=\"language-javascript\"><span class=\"language-xml\">  <span class=\"hljs-string\">&#x27;rgba(255, 69, 0, 0.68)&#x27;</span>,</span></span><br><span class=\"language-javascript\"><span class=\"language-xml\">  <span class=\"hljs-string\">&#x27;rgb(255, 120, 0)&#x27;</span>,</span></span><br><span class=\"language-javascript\"><span class=\"language-xml\">  <span class=\"hljs-string\">&#x27;hsv(51, 100, 98)&#x27;</span>,</span></span><br><span class=\"language-javascript\"><span class=\"language-xml\">  <span class=\"hljs-string\">&#x27;hsva(120, 40, 94, 0.5)&#x27;</span>,</span></span><br><span class=\"language-javascript\"><span class=\"language-xml\">  <span class=\"hljs-string\">&#x27;hsl(181, 100%, 37%)&#x27;</span>,</span></span><br><span class=\"language-javascript\"><span class=\"language-xml\">  <span class=\"hljs-string\">&#x27;hsla(209, 100%, 56%, 0.73)&#x27;</span>,</span></span><br><span class=\"language-javascript\"><span class=\"language-xml\">  <span class=\"hljs-string\">&#x27;#c7158577&#x27;</span></span></span><br><span class=\"language-javascript\"><span class=\"language-xml\">]</span></span><br><span class=\"language-javascript\"><span class=\"language-xml\"><span class=\"hljs-comment\">// 默认色值</span></span></span><br><span class=\"language-javascript\"><span class=\"language-xml\"><span class=\"hljs-keyword\">const</span> mColor = <span class=\"hljs-title function_\">ref</span>(<span class=\"hljs-string\">&#x27;#00ff00&#x27;</span>)</span></span><br><span class=\"language-javascript\"><span class=\"language-xml\"></span></span><br><span class=\"language-javascript\"><span class=\"language-xml\"><span class=\"hljs-comment\">/**</span></span></span><br><span class=\"hljs-comment\"><span class=\"language-javascript\"><span class=\"language-xml\"> * 关闭</span></span></span><br><span class=\"hljs-comment\"><span class=\"language-javascript\"><span class=\"language-xml\"> */</span></span></span><br><span class=\"language-javascript\"><span class=\"language-xml\"><span class=\"hljs-keyword\">const</span> <span class=\"hljs-title function_\">closed</span> = (<span class=\"hljs-params\"></span>) =&gt; &#123;</span></span><br><span class=\"language-javascript\"><span class=\"language-xml\">  <span class=\"hljs-title function_\">emits</span>(<span class=\"hljs-string\">&#x27;update:modelValue&#x27;</span>, <span class=\"hljs-literal\">false</span>)</span></span><br><span class=\"language-javascript\"><span class=\"language-xml\">&#125;</span></span><br><span class=\"language-javascript\"><span class=\"language-xml\"><span class=\"hljs-comment\">/**</span></span></span><br><span class=\"hljs-comment\"><span class=\"language-javascript\"><span class=\"language-xml\"> * 确定</span></span></span><br><span class=\"hljs-comment\"><span class=\"language-javascript\"><span class=\"language-xml\"> * 1. 修改主题色</span></span></span><br><span class=\"hljs-comment\"><span class=\"language-javascript\"><span class=\"language-xml\"> * 2. 保存最新的主题色</span></span></span><br><span class=\"hljs-comment\"><span class=\"language-javascript\"><span class=\"language-xml\"> * 3. 关闭 dialog</span></span></span><br><span class=\"hljs-comment\"><span class=\"language-javascript\"><span class=\"language-xml\"> */</span></span></span><br><span class=\"language-javascript\"><span class=\"language-xml\"><span class=\"hljs-keyword\">const</span> <span class=\"hljs-title function_\">comfirm</span> = <span class=\"hljs-keyword\">async</span> (<span class=\"hljs-params\"></span>) =&gt; &#123;</span></span><br><span class=\"language-javascript\"><span class=\"language-xml\">  <span class=\"hljs-title function_\">closed</span>()</span></span><br><span class=\"language-javascript\"><span class=\"language-xml\">&#125;</span></span><br><span class=\"language-javascript\"><span class=\"language-xml\"></span><span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">script</span>&gt;</span></span><br><br><span class=\"language-xml\"><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">style</span> <span class=\"hljs-attr\">lang</span>=<span class=\"hljs-string\">&quot;scss&quot;</span> <span class=\"hljs-attr\">scoped</span>&gt;</span><span class=\"language-css\"></span></span><br><span class=\"language-css\"><span class=\"language-xml\"><span class=\"hljs-selector-class\">.center</span> &#123;</span></span><br><span class=\"language-css\"><span class=\"language-xml\">  <span class=\"hljs-attribute\">text-align</span>: center;</span></span><br><span class=\"language-css\"><span class=\"language-xml\">  <span class=\"hljs-selector-class\">.title</span> &#123;</span></span><br><span class=\"language-css\"><span class=\"language-xml\">    <span class=\"hljs-attribute\">margin-bottom</span>: <span class=\"hljs-number\">12px</span>;</span></span><br><span class=\"language-css\"><span class=\"language-xml\">  &#125;</span></span><br><span class=\"language-css\"><span class=\"language-xml\">&#125;</span></span><br><span class=\"language-css\"><span class=\"language-xml\"></span><span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">style</span>&gt;</span></span><br><br></code></pre></td></tr></table></figure>\n\n<p>在 <code>ThemePicker/index</code> 中使用该组件</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\">&lt;template&gt;<br>  ...<br>  &lt;!-- 展示弹出层 --&gt;<br>  <span class=\"language-xml\"><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">div</span>&gt;</span></span><br><span class=\"language-xml\">    <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">select-color</span> <span class=\"hljs-attr\">v-model</span>=<span class=\"hljs-string\">&quot;selectColorVisible&quot;</span>&gt;</span><span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">select-color</span>&gt;</span></span><br><span class=\"language-xml\">  <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">div</span>&gt;</span></span><br>&lt;/template&gt;<br><br><span class=\"language-xml\"><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">script</span> <span class=\"hljs-attr\">setup</span>&gt;</span><span class=\"language-javascript\"></span></span><br><span class=\"language-javascript\"><span class=\"language-xml\"><span class=\"hljs-keyword\">import</span> <span class=\"hljs-title class_\">SelectColor</span> <span class=\"hljs-keyword\">from</span> <span class=\"hljs-string\">&#x27;./components/SelectColor.vue&#x27;</span></span></span><br><span class=\"language-javascript\"><span class=\"language-xml\"><span class=\"hljs-keyword\">import</span> &#123; ref &#125; <span class=\"hljs-keyword\">from</span> <span class=\"hljs-string\">&#x27;vue&#x27;</span></span></span><br><span class=\"language-javascript\"><span class=\"language-xml\"></span></span><br><span class=\"language-javascript\"><span class=\"language-xml\"><span class=\"hljs-keyword\">const</span> selectColorVisible = <span class=\"hljs-title function_\">ref</span>(<span class=\"hljs-literal\">false</span>)</span></span><br><span class=\"language-javascript\"><span class=\"language-xml\"><span class=\"hljs-keyword\">const</span> <span class=\"hljs-title function_\">handleSetTheme</span> = command =&gt; &#123;</span></span><br><span class=\"language-javascript\"><span class=\"language-xml\">  selectColorVisible.<span class=\"hljs-property\">value</span> = <span class=\"hljs-literal\">true</span></span></span><br><span class=\"language-javascript\"><span class=\"language-xml\">&#125;</span></span><br><span class=\"language-javascript\"><span class=\"language-xml\"></span><span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">script</span>&gt;</span></span><br><br></code></pre></td></tr></table></figure>\n\n<p>完成双向数据绑定之后，我们来处理第二步：<strong>把选中的色值进行本地缓存</strong></p>\n<p>缓存的方式分为两种：</p>\n<ol>\n<li><code>vuex</code></li>\n<li>本地存储</li>\n</ol>\n<p>在 <code>constants/index</code> 下新建常量值</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\"><span class=\"hljs-comment\">// 主题色保存的 key</span><br><span class=\"hljs-keyword\">export</span> <span class=\"hljs-keyword\">const</span> <span class=\"hljs-variable constant_\">MAIN_COLOR</span> = <span class=\"hljs-string\">&#x27;mainColor&#x27;</span><br><span class=\"hljs-comment\">// 默认色值</span><br><span class=\"hljs-keyword\">export</span> <span class=\"hljs-keyword\">const</span> <span class=\"hljs-variable constant_\">DEFAULT_COLOR</span> = <span class=\"hljs-string\">&#x27;#409eff&#x27;</span><br></code></pre></td></tr></table></figure>\n\n<p>创建 <code>store/modules/theme</code> 模块，用来处理 <strong>主题色</strong> 相关内容</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\"><span class=\"hljs-keyword\">import</span> &#123; getItem, setItem &#125; <span class=\"hljs-keyword\">from</span> <span class=\"hljs-string\">&#x27;@/utils/storage&#x27;</span><br><span class=\"hljs-keyword\">import</span> &#123; <span class=\"hljs-variable constant_\">MAIN_COLOR</span>, <span class=\"hljs-variable constant_\">DEFAULT_COLOR</span> &#125; <span class=\"hljs-keyword\">from</span> <span class=\"hljs-string\">&#x27;@/constant&#x27;</span><br><span class=\"hljs-keyword\">export</span> <span class=\"hljs-keyword\">default</span> &#123;<br>  <span class=\"hljs-attr\">namespaced</span>: <span class=\"hljs-literal\">true</span>,<br>  <span class=\"hljs-attr\">state</span>: <span class=\"hljs-function\">() =&gt;</span> (&#123;<br>    <span class=\"hljs-attr\">mainColor</span>: <span class=\"hljs-title function_\">getItem</span>(<span class=\"hljs-variable constant_\">MAIN_COLOR</span>) || <span class=\"hljs-variable constant_\">DEFAULT_COLOR</span><br>  &#125;),<br>  <span class=\"hljs-attr\">mutations</span>: &#123;<br>    <span class=\"hljs-comment\">/**</span><br><span class=\"hljs-comment\">     * 设置主题色</span><br><span class=\"hljs-comment\">     */</span><br>    <span class=\"hljs-title function_\">setMainColor</span>(<span class=\"hljs-params\">state, newColor</span>) &#123;<br>      state.<span class=\"hljs-property\">mainColor</span> = newColor<br>      <span class=\"hljs-title function_\">setItem</span>(<span class=\"hljs-variable constant_\">MAIN_COLOR</span>, newColor)<br>    &#125;<br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure>\n\n<p>在 <code>store/getters</code> 下指定快捷访问</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\"><span class=\"hljs-attr\">mainColor</span>: <span class=\"hljs-function\"><span class=\"hljs-params\">state</span> =&gt;</span> state.<span class=\"hljs-property\">theme</span>.<span class=\"hljs-property\">mainColor</span><br></code></pre></td></tr></table></figure>\n\n<p>在 <code>store/index</code> 中导入 <code>theme</code></p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\">...<br><span class=\"hljs-keyword\">import</span> theme <span class=\"hljs-keyword\">from</span> <span class=\"hljs-string\">&#x27;./modules/theme.js&#x27;</span><br><br><span class=\"hljs-keyword\">export</span> <span class=\"hljs-keyword\">default</span> <span class=\"hljs-title function_\">createStore</span>(&#123;<br>  getters,<br>  <span class=\"hljs-attr\">modules</span>: &#123;<br>    ...<br>    theme<br>  &#125;<br>&#125;)<br></code></pre></td></tr></table></figure>\n\n<p>在 <code>selectColor</code> 中，设置初始色值 和  缓存色值</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\">...<br><br>&lt;script setup&gt;<br><span class=\"hljs-keyword\">import</span> &#123; defineProps, defineEmits, ref &#125; <span class=\"hljs-keyword\">from</span> <span class=\"hljs-string\">&#x27;vue&#x27;</span><br><span class=\"hljs-keyword\">import</span> &#123; useStore &#125; <span class=\"hljs-keyword\">from</span> <span class=\"hljs-string\">&#x27;vuex&#x27;</span><br>...<br><span class=\"hljs-keyword\">const</span> store = <span class=\"hljs-title function_\">useStore</span>()<br><br><span class=\"hljs-comment\">// 默认色值</span><br><span class=\"hljs-keyword\">const</span> mColor = <span class=\"hljs-title function_\">ref</span>(store.<span class=\"hljs-property\">getters</span>.<span class=\"hljs-property\">mainColor</span>)<br><br>...<br><br><span class=\"hljs-comment\">/**</span><br><span class=\"hljs-comment\"> * 确定按钮</span><br><span class=\"hljs-comment\"> *</span><br><span class=\"hljs-comment\"> * 1. 修改主题色</span><br><span class=\"hljs-comment\"> * 2. 保存最新的主题色</span><br><span class=\"hljs-comment\"> * 3. 关闭 dialog</span><br><span class=\"hljs-comment\"> *</span><br><span class=\"hljs-comment\"> */</span><br><span class=\"hljs-keyword\">const</span> <span class=\"hljs-title function_\">comfirm</span> = <span class=\"hljs-keyword\">async</span> (<span class=\"hljs-params\"></span>) =&gt; &#123;<br>  <span class=\"hljs-comment\">// 2. 保存最新的主题色</span><br>  store.<span class=\"hljs-title function_\">commit</span>(<span class=\"hljs-string\">&#x27;theme/setMainColor&#x27;</span>, mColor.<span class=\"hljs-property\">value</span>)<br>  <span class=\"hljs-comment\">// 3. 关闭 dialog</span><br>  <span class=\"hljs-title function_\">closed</span>()<br>&#125;<br>&lt;/script&gt;<br></code></pre></td></tr></table></figure>\n\n<h2 id=\"scss-mix方法\"><a href=\"#scss-mix方法\" class=\"headerlink\" title=\"scss mix方法\"></a>scss mix方法</h2><figure class=\"highlight css\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs css\">// 给当前的颜色值，添加上 <span class=\"hljs-number\">50%</span> 的白色<br><span class=\"hljs-selector-class\">.white</span> &#123;<br>  <span class=\"hljs-attribute\">color</span>: <span class=\"hljs-built_in\">mix</span>(white, $color, <span class=\"hljs-number\">50%</span>);<br>&#125;<br><br>// 给当前的颜色值，添加上 <span class=\"hljs-number\">50%</span> 的黑色<br><span class=\"hljs-selector-class\">.black</span> &#123;<br>  <span class=\"hljs-attribute\">color</span>: <span class=\"hljs-built_in\">mix</span>(black, $color, <span class=\"hljs-number\">50%</span>);<br>&#125;<br></code></pre></td></tr></table></figure>\n\n<h2 id=\"处理-element-plus-主题色变更原理与步骤分析\"><a href=\"#处理-element-plus-主题色变更原理与步骤分析\" class=\"headerlink\" title=\"处理 element-plus 主题色变更原理与步骤分析\"></a>处理 element-plus 主题色变更原理与步骤分析</h2><p>对于 <code>element-plus</code> 的主题变更，相对比较复杂，所以说整个过程我们会分为三部分：</p>\n<ol>\n<li>实现原理</li>\n<li>实现步骤</li>\n<li>实现过程</li>\n</ol>\n<p><strong>实现原理：</strong></p>\n<p>在之前我们分析主题变更的实现原理时，我们说过，核心的原理是：*<em>通过修改 <code>scss</code> 变量 *</em> 的形式修改主题色完成主题变更</p>\n<p>但是对于 <code>element-plus</code> 而言，我们怎么去修改这样的主题色呢？</p>\n<p>其实整体的原理非常简单，分为三步：</p>\n<ol>\n<li>获取当前 <code>element-plus</code> 的所有样式</li>\n<li>找到我们想要替换的样式部分，通过正则完成替换</li>\n<li>把替换后的样式写入到 <code>style</code> 标签中，利用样式优先级的特性，替代固有样式</li>\n</ol>\n<p><strong>实现步骤：</strong></p>\n<p>那么明确了原理之后，我们的实现步骤也就呼之欲出了，对应原理总体可分为四步：</p>\n<ol>\n<li>获取当前 <code>element-plus</code> 的所有样式</li>\n<li>定义我们要替换之后的样式</li>\n<li>在原样式中，利用正则替换新样式</li>\n<li>把替换后的样式写入到 <code>style</code> 标签中</li>\n</ol>\n<p><strong>创建 <code>utils/theme</code> 工具类，写入两个方法</strong></p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\"><span class=\"hljs-comment\">/**</span><br><span class=\"hljs-comment\"> * 写入新样式到 style</span><br><span class=\"hljs-comment\"> * <span class=\"hljs-doctag\">@param</span> &#123;<span class=\"hljs-type\">*</span>&#125; elNewStyle  element-plus 的新样式</span><br><span class=\"hljs-comment\"> * <span class=\"hljs-doctag\">@param</span> &#123;<span class=\"hljs-type\">*</span>&#125; isNewStyleTag 是否生成新的 style 标签</span><br><span class=\"hljs-comment\"> */</span><br><span class=\"hljs-keyword\">export</span> <span class=\"hljs-keyword\">const</span> <span class=\"hljs-title function_\">writeNewStyle</span> = elNewStyle =&gt; &#123;<br>  <br>&#125;<br><br><span class=\"hljs-comment\">/**</span><br><span class=\"hljs-comment\"> * 根据主色值，生成最新的样式表</span><br><span class=\"hljs-comment\"> */</span><br><span class=\"hljs-keyword\">export</span> <span class=\"hljs-keyword\">const</span> <span class=\"hljs-title function_\">generateNewStyle</span> =  primaryColor =&gt; &#123;<br> <br>&#125;<br></code></pre></td></tr></table></figure>\n\n<p>那么接下来我们先实现第一个方法 <code>generateNewStyle</code>，在实现的过程中，我们需要安装两个工具类：</p>\n<ol>\n<li><a href=\"https://www.npmjs.com/package/rgb-hex\">rgb-hex</a>：转换RGB(A)颜色为十六进制</li>\n<li><a href=\"https://www.npmjs.com/package/css-color-function\">css-color-function</a>：在 CSS 中 Tab Atkins 提出的颜色函数的解析器和转换器。</li>\n</ol>\n<p><strong>示例</strong></p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\"><span class=\"hljs-keyword\">import</span> rgbHex <span class=\"hljs-keyword\">from</span> <span class=\"hljs-string\">&#x27;rgb-hex&#x27;</span><br><br><span class=\"hljs-title function_\">rgbHex</span>(<span class=\"hljs-number\">65</span>, <span class=\"hljs-number\">131</span>, <span class=\"hljs-number\">196</span>);<br><span class=\"hljs-comment\">//=&gt; &#x27;4183c4&#x27;</span><br><br><span class=\"hljs-title function_\">rgbHex</span>(<span class=\"hljs-string\">&#x27;rgb(40, 42, 54)&#x27;</span>);<br><span class=\"hljs-comment\">//=&gt; &#x27;282a36&#x27;</span><br><br><span class=\"hljs-title function_\">rgbHex</span>(<span class=\"hljs-number\">65</span>, <span class=\"hljs-number\">131</span>, <span class=\"hljs-number\">196</span>, <span class=\"hljs-number\">0.2</span>);<br><span class=\"hljs-comment\">//=&gt; &#x27;4183c433&#x27;</span><br><br><span class=\"hljs-title function_\">rgbHex</span>(<span class=\"hljs-number\">40</span>, <span class=\"hljs-number\">42</span>, <span class=\"hljs-number\">54</span>, <span class=\"hljs-string\">&#x27;75%&#x27;</span>);<br><span class=\"hljs-comment\">//=&gt; &#x27;282a36bf&#x27;</span><br><br><span class=\"hljs-title function_\">rgbHex</span>(<span class=\"hljs-string\">&#x27;rgba(40, 42, 54, 75%)&#x27;</span>);<br><span class=\"hljs-comment\">//=&gt; &#x27;282a36bf&#x27;</span><br><br>------------------------------------------------<br><br><span class=\"hljs-keyword\">import</span> color <span class=\"hljs-keyword\">from</span> <span class=\"hljs-string\">&#x27;css-color-function&#x27;</span><br> <br>color.<span class=\"hljs-title function_\">convert</span>(<span class=\"hljs-string\">&#x27;color(red tint(50%))&#x27;</span>);<br><span class=\"hljs-comment\">// &quot;rgb(255, 128, 128)&quot;</span><br></code></pre></td></tr></table></figure>\n\n<p>然后还需要写入一个 <strong>颜色转化计算器  <code>formula.json</code></strong>，这里主要是以 <code>primary</code> 色值为例</p>\n<p>创建 <code>constants/formula.json</code> </p>\n<figure class=\"highlight json\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs json\"><span class=\"hljs-punctuation\">&#123;</span><br>  <span class=\"hljs-attr\">&quot;shade-1&quot;</span><span class=\"hljs-punctuation\">:</span> <span class=\"hljs-string\">&quot;color(primary shade(10%))&quot;</span><span class=\"hljs-punctuation\">,</span><br>  <span class=\"hljs-attr\">&quot;light-1&quot;</span><span class=\"hljs-punctuation\">:</span> <span class=\"hljs-string\">&quot;color(primary tint(10%))&quot;</span><span class=\"hljs-punctuation\">,</span><br>  <span class=\"hljs-attr\">&quot;light-2&quot;</span><span class=\"hljs-punctuation\">:</span> <span class=\"hljs-string\">&quot;color(primary tint(20%))&quot;</span><span class=\"hljs-punctuation\">,</span><br>  <span class=\"hljs-attr\">&quot;light-3&quot;</span><span class=\"hljs-punctuation\">:</span> <span class=\"hljs-string\">&quot;color(primary tint(30%))&quot;</span><span class=\"hljs-punctuation\">,</span><br>  <span class=\"hljs-attr\">&quot;light-4&quot;</span><span class=\"hljs-punctuation\">:</span> <span class=\"hljs-string\">&quot;color(primary tint(40%))&quot;</span><span class=\"hljs-punctuation\">,</span><br>  <span class=\"hljs-attr\">&quot;light-5&quot;</span><span class=\"hljs-punctuation\">:</span> <span class=\"hljs-string\">&quot;color(primary tint(50%))&quot;</span><span class=\"hljs-punctuation\">,</span><br>  <span class=\"hljs-attr\">&quot;light-6&quot;</span><span class=\"hljs-punctuation\">:</span> <span class=\"hljs-string\">&quot;color(primary tint(60%))&quot;</span><span class=\"hljs-punctuation\">,</span><br>  <span class=\"hljs-attr\">&quot;light-7&quot;</span><span class=\"hljs-punctuation\">:</span> <span class=\"hljs-string\">&quot;color(primary tint(70%))&quot;</span><span class=\"hljs-punctuation\">,</span><br>  <span class=\"hljs-attr\">&quot;light-8&quot;</span><span class=\"hljs-punctuation\">:</span> <span class=\"hljs-string\">&quot;color(primary tint(80%))&quot;</span><span class=\"hljs-punctuation\">,</span><br>  <span class=\"hljs-attr\">&quot;light-9&quot;</span><span class=\"hljs-punctuation\">:</span> <span class=\"hljs-string\">&quot;color(primary tint(90%))&quot;</span><span class=\"hljs-punctuation\">,</span><br>  <span class=\"hljs-attr\">&quot;subMenuHover&quot;</span><span class=\"hljs-punctuation\">:</span> <span class=\"hljs-string\">&quot;color(primary tint(70%))&quot;</span><span class=\"hljs-punctuation\">,</span><br>  <span class=\"hljs-attr\">&quot;subMenuBg&quot;</span><span class=\"hljs-punctuation\">:</span> <span class=\"hljs-string\">&quot;color(primary tint(80%))&quot;</span><span class=\"hljs-punctuation\">,</span><br>  <span class=\"hljs-attr\">&quot;menuHover&quot;</span><span class=\"hljs-punctuation\">:</span> <span class=\"hljs-string\">&quot;color(primary tint(90%))&quot;</span><span class=\"hljs-punctuation\">,</span><br>  <span class=\"hljs-attr\">&quot;menuBg&quot;</span><span class=\"hljs-punctuation\">:</span> <span class=\"hljs-string\">&quot;color(primary)&quot;</span><br><span class=\"hljs-punctuation\">&#125;</span><br></code></pre></td></tr></table></figure>\n\n<p>我们来看下 element plus 定义的 <code>primary</code> 变量，<code>light-i</code> 表示颜色的深浅。</p>\n<p><img src=\"/img/primary.png\" alt=\"\"></p>\n<p>如果我们想要定义其它颜色，比如<code>--el-color-success</code>，已同样的方法，添加到 <code>formula.json</code> 中即可。</p>\n<p>同时我们还定义了自己变量在 <code>formula</code> 颜色转换器中，因为我们的 <code>菜单</code> 部分，也是需要跟着主题色变化的。</p>\n<p><strong>shade tint 方法其实就是利用了 scss 的 mix 方法</strong>，css-color-function 库内部调用进行解析，对某个颜色加深或者淡化！！</p>\n<figure class=\"highlight css\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs css\">// scss<br><br>// 给当前的颜色值，添加上 <span class=\"hljs-number\">50%</span> 的白色<br><span class=\"hljs-selector-class\">.white</span> &#123;<br>  <span class=\"hljs-attribute\">color</span>: <span class=\"hljs-built_in\">mix</span>(white, $color, <span class=\"hljs-number\">50%</span>);<br>&#125;<br><br>// 给当前的颜色值，添加上 <span class=\"hljs-number\">50%</span> 的黑色<br><span class=\"hljs-selector-class\">.black</span> &#123;<br>  <span class=\"hljs-attribute\">color</span>: <span class=\"hljs-built_in\">mix</span>(black, $color, <span class=\"hljs-number\">50%</span>);<br>&#125;<br><br><span class=\"hljs-keyword\">@function</span> tint($<span class=\"hljs-attribute\">color</span>, $parcent) &#123;<br>  <span class=\"hljs-keyword\">@return</span> mix(white, $<span class=\"hljs-attribute\">color</span>, $parcent)<br>&#125;<br>@function shade($<span class=\"hljs-attribute\">color</span>, $parcent) &#123;<br>  <span class=\"hljs-keyword\">@return</span> mix(black, $<span class=\"hljs-attribute\">color</span>, $parcent)<br>&#125;<br></code></pre></td></tr></table></figure>\n\n<p>准备就绪后，我们来实现 <code>generateNewStyle</code> 方法：</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br><span class=\"line\">103</span><br><span class=\"line\">104</span><br><span class=\"line\">105</span><br><span class=\"line\">106</span><br><span class=\"line\">107</span><br><span class=\"line\">108</span><br><span class=\"line\">109</span><br><span class=\"line\">110</span><br><span class=\"line\">111</span><br><span class=\"line\">112</span><br><span class=\"line\">113</span><br><span class=\"line\">114</span><br><span class=\"line\">115</span><br><span class=\"line\">116</span><br><span class=\"line\">117</span><br><span class=\"line\">118</span><br><span class=\"line\">119</span><br><span class=\"line\">120</span><br><span class=\"line\">121</span><br><span class=\"line\">122</span><br><span class=\"line\">123</span><br><span class=\"line\">124</span><br><span class=\"line\">125</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\"><span class=\"hljs-comment\">// https://www.npmjs.com/package/css-color-function</span><br><span class=\"hljs-keyword\">import</span> color <span class=\"hljs-keyword\">from</span> <span class=\"hljs-string\">&#x27;css-color-function&#x27;</span><br><br><span class=\"hljs-comment\">// https://www.npmjs.com/package/rgb-hex</span><br><span class=\"hljs-keyword\">import</span> rgbHex <span class=\"hljs-keyword\">from</span> <span class=\"hljs-string\">&#x27;rgb-hex&#x27;</span><br><span class=\"hljs-keyword\">import</span> axios <span class=\"hljs-keyword\">from</span> <span class=\"hljs-string\">&#x27;axios&#x27;</span><br><span class=\"hljs-keyword\">import</span> formula <span class=\"hljs-keyword\">from</span> <span class=\"hljs-string\">&#x27;@/constants/formula.json&#x27;</span><br><span class=\"hljs-comment\">/**</span><br><span class=\"hljs-comment\"> * 写入新样式到 style</span><br><span class=\"hljs-comment\"> * <span class=\"hljs-doctag\">@param</span> &#123;<span class=\"hljs-type\">*</span>&#125; cssText  element-plus 的新样式</span><br><span class=\"hljs-comment\"> * <span class=\"hljs-doctag\">@param</span> &#123;<span class=\"hljs-type\">*</span>&#125; isNewStyleTag 是否生成新的 style 标签</span><br><span class=\"hljs-comment\"> */</span><br><span class=\"hljs-keyword\">export</span> <span class=\"hljs-keyword\">const</span> <span class=\"hljs-title function_\">writeNewStyle</span> = (<span class=\"hljs-params\">cssText: string</span>) =&gt; &#123;<br>  <span class=\"hljs-keyword\">const</span> style = <span class=\"hljs-variable language_\">document</span>.<span class=\"hljs-title function_\">createElement</span>(<span class=\"hljs-string\">&#x27;style&#x27;</span>)<br>  style.<span class=\"hljs-property\">innerText</span> = cssText<br>  <span class=\"hljs-variable language_\">document</span>.<span class=\"hljs-property\">head</span>.<span class=\"hljs-title function_\">appendChild</span>(style)<br>&#125;<br><br><span class=\"hljs-comment\">/**</span><br><span class=\"hljs-comment\"> * 根据主色值，生成最新的样式表</span><br><span class=\"hljs-comment\"> */</span><br>type <span class=\"hljs-title class_\">TObject</span> = &#123; [<span class=\"hljs-attr\">key</span>: string]: string &#125;<br><span class=\"hljs-keyword\">export</span> <span class=\"hljs-keyword\">const</span> <span class=\"hljs-title function_\">generateNewStyle</span> = <span class=\"hljs-keyword\">async</span> (<span class=\"hljs-params\">primaryColor: string</span>) =&gt; &#123;<br>  <span class=\"hljs-comment\">// colors ===&gt; &#123; primary: &#x27;rgba(8, 12, 132, 0.68)&#x27;, shade-1: &#x27;#070b77ad&#x27;, light-1: &#x27;#212490ad&#x27;, ...... &#125;</span><br>  <span class=\"hljs-keyword\">const</span> <span class=\"hljs-attr\">colors</span>: <span class=\"hljs-title class_\">TObject</span> = <span class=\"hljs-title function_\">generateColors</span>(primaryColor) <span class=\"hljs-keyword\">as</span> <span class=\"hljs-title class_\">TObject</span><br><br>  <span class=\"hljs-comment\">// 拿到整个 element plus 样式表，并对需要修改的变量打上了标记</span><br>  <span class=\"hljs-keyword\">let</span> cssText = <span class=\"hljs-keyword\">await</span> <span class=\"hljs-title function_\">getOriginalStyle</span>()<br><br>  <span class=\"hljs-comment\">// 遍历生成的样式表，在 CSS 的原样式中进行全局替换</span><br>  <span class=\"hljs-title class_\">Object</span>.<span class=\"hljs-title function_\">keys</span>(colors).<span class=\"hljs-title function_\">forEach</span>(<span class=\"hljs-function\"><span class=\"hljs-params\">key</span> =&gt;</span> &#123;<br>    <span class=\"hljs-comment\">// reg pattern</span><br>    <span class=\"hljs-comment\">// /(:|\\s+)primary/g</span><br>    <span class=\"hljs-comment\">// /(:|\\s+)shade-1/g</span><br>    <span class=\"hljs-comment\">// /(:|\\s+)menuBg/g</span><br>    <span class=\"hljs-comment\">// ...</span><br><br>    <span class=\"hljs-comment\">// 这个模式中的 (:|\\\\s+) 表示一个冒号或一个或多个空白字符（包括空格、制表符和换行符）。</span><br>    <span class=\"hljs-comment\">// \\\\s+ 的第一个 \\ 是转义字符</span><br>    <span class=\"hljs-comment\">// key 是一个变量，代表一个需要匹配的字符串，比如匹配 `primary`</span><br><br>    <span class=\"hljs-comment\">// &#x27;$1&#x27; + colors[key]</span><br>    <span class=\"hljs-comment\">// 关于为什么要在色值前面加上 $1，我们需要查看 replace 方法的第二个参数。</span><br>    <span class=\"hljs-comment\">// 在这里，第二个参数是一个字符串，字符串中的 $1 会被替换成第一个括号捕获组（即 (:|\\\\s+)）匹配到的文本。</span><br>    <span class=\"hljs-comment\">// 所以加上 $1 就是为了在【替换的文本】中【保留原本匹配到的文本】。</span><br>    cssText = cssText.<span class=\"hljs-title function_\">replace</span>(<br>      <span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">RegExp</span>(<span class=\"hljs-string\">&#x27;(:|\\\\s+)&#x27;</span> + key, <span class=\"hljs-string\">&#x27;g&#x27;</span>),<br>      <span class=\"hljs-string\">&#x27;$1&#x27;</span> + colors[key]<br>    )<br>  &#125;)<br><br>  <span class=\"hljs-comment\">// 最终，新的样式表中，含有我们自定义的颜色主题</span><br>  <span class=\"hljs-keyword\">return</span> cssText<br>&#125;<br><br><span class=\"hljs-comment\">/**</span><br><span class=\"hljs-comment\"> * 根据主色生成色值表</span><br><span class=\"hljs-comment\"> */</span><br>type <span class=\"hljs-title class_\">TFormulaKey</span> = keyof <span class=\"hljs-keyword\">typeof</span> formula<br><span class=\"hljs-keyword\">export</span> <span class=\"hljs-keyword\">const</span> <span class=\"hljs-title function_\">generateColors</span> = (<span class=\"hljs-params\">primary: string</span>) =&gt; &#123;<br>  <span class=\"hljs-keyword\">if</span> (!primary) <span class=\"hljs-keyword\">return</span><br>  <span class=\"hljs-keyword\">const</span> <span class=\"hljs-attr\">colors</span>: &#123; [<span class=\"hljs-attr\">key</span>: string]: string &#125; = &#123;<br>    primary<br>  &#125;<br><br>  ;(<span class=\"hljs-title class_\">Object</span>.<span class=\"hljs-title function_\">keys</span>(formula) <span class=\"hljs-keyword\">as</span> <span class=\"hljs-title class_\">Array</span>&lt;<span class=\"hljs-title class_\">TFormulaKey</span>&gt;).<span class=\"hljs-title function_\">forEach</span>(<br>    &lt;K <span class=\"hljs-keyword\">extends</span> <span class=\"hljs-title class_\">TFormulaKey</span>&gt;<span class=\"hljs-function\">(<span class=\"hljs-params\">key: K</span>) =&gt;</span> &#123;<br>      <span class=\"hljs-comment\">// 将所有的主色，替换成我们选中的主题色，形式如 &gt;&gt;&gt; color(rgba(255, 69, 0, 1) shade(10%))</span><br>      <span class=\"hljs-keyword\">const</span> value = formula[key].<span class=\"hljs-title function_\">replace</span>(<span class=\"hljs-regexp\">/primary/g</span>, primary)<br><br>      <span class=\"hljs-comment\">// 通过 color 的 conver 方法，计算出 rgba 色值</span><br>      <span class=\"hljs-comment\">// color.convert(value)  ===&gt;&gt;&gt;  rgba(0, 12, 230, 0.68)</span><br><br>      <span class=\"hljs-comment\">// 最终将转为每个颜色，转为十六进制：#030420ad，写入到 colors 对象中，并返回</span><br>      colors[key] = <span class=\"hljs-string\">&#x27;#&#x27;</span> + <span class=\"hljs-title function_\">rgbHex</span>(color.<span class=\"hljs-title function_\">convert</span>(value))<br>    &#125;<br>  )<br>  <span class=\"hljs-keyword\">return</span> colors<br>&#125;<br><br><span class=\"hljs-comment\">/**</span><br><span class=\"hljs-comment\"> * 获取当前 element-plus 的默认样式表</span><br><span class=\"hljs-comment\"> */</span><br><span class=\"hljs-keyword\">const</span> <span class=\"hljs-title function_\">getOriginalStyle</span> = <span class=\"hljs-keyword\">async</span> (<span class=\"hljs-params\"></span>) =&gt; &#123;<br>  <span class=\"hljs-keyword\">const</span> version = <span class=\"hljs-built_in\">require</span>(<span class=\"hljs-string\">&#x27;element-plus/package.json&#x27;</span>).<span class=\"hljs-property\">version</span><br>  <span class=\"hljs-keyword\">const</span> url = <span class=\"hljs-string\">`https://unpkg.com/element-plus@<span class=\"hljs-subst\">$&#123;version&#125;</span>/dist/index.css`</span><br>  <span class=\"hljs-keyword\">const</span> &#123; data &#125; = <span class=\"hljs-keyword\">await</span> <span class=\"hljs-title function_\">axios</span>(url)<br><br>  <span class=\"hljs-comment\">// 把获取到的数据筛选为原样式模板</span><br>  <span class=\"hljs-keyword\">return</span> <span class=\"hljs-title function_\">getStyleTemplate</span>(data)<br>&#125;<br><br><span class=\"hljs-comment\">/**</span><br><span class=\"hljs-comment\"> * 返回 style 的 template</span><br><span class=\"hljs-comment\"> */</span><br><span class=\"hljs-keyword\">const</span> <span class=\"hljs-title function_\">getStyleTemplate</span> = (<span class=\"hljs-params\">data: string</span>) =&gt; &#123;<br>  <span class=\"hljs-comment\">// element-plus 默认色值</span><br>  <span class=\"hljs-keyword\">const</span> <span class=\"hljs-attr\">colorMap</span>: &#123; [<span class=\"hljs-attr\">key</span>: string]: string &#125; = &#123;<br>    <span class=\"hljs-string\">&#x27;#3a8ee6&#x27;</span>: <span class=\"hljs-string\">&#x27;shade-1&#x27;</span>,<br>    <span class=\"hljs-string\">&#x27;#409eff&#x27;</span>: <span class=\"hljs-string\">&#x27;primary&#x27;</span>, <span class=\"hljs-comment\">// element-plus 中含有变量 `--el-color-primary: #409eff`</span><br>    <span class=\"hljs-string\">&#x27;#53a8ff&#x27;</span>: <span class=\"hljs-string\">&#x27;light-1&#x27;</span>,<br>    <span class=\"hljs-string\">&#x27;#66b1ff&#x27;</span>: <span class=\"hljs-string\">&#x27;light-2&#x27;</span>,<br>    <span class=\"hljs-string\">&#x27;#79bbff&#x27;</span>: <span class=\"hljs-string\">&#x27;light-3&#x27;</span>,<br>    <span class=\"hljs-string\">&#x27;#8cc5ff&#x27;</span>: <span class=\"hljs-string\">&#x27;light-4&#x27;</span>,<br>    <span class=\"hljs-string\">&#x27;#a0cfff&#x27;</span>: <span class=\"hljs-string\">&#x27;light-5&#x27;</span>,<br>    <span class=\"hljs-string\">&#x27;#b3d8ff&#x27;</span>: <span class=\"hljs-string\">&#x27;light-6&#x27;</span>,<br>    <span class=\"hljs-string\">&#x27;#c6e2ff&#x27;</span>: <span class=\"hljs-string\">&#x27;light-7&#x27;</span>,<br>    <span class=\"hljs-string\">&#x27;#d9ecff&#x27;</span>: <span class=\"hljs-string\">&#x27;light-8&#x27;</span>,<br>    <span class=\"hljs-string\">&#x27;#ecf5ff&#x27;</span>: <span class=\"hljs-string\">&#x27;light-9&#x27;</span><br>  &#125;<br>  <span class=\"hljs-comment\">// 根据默认色值为要替换的色值打上标记</span><br>  <span class=\"hljs-title class_\">Object</span>.<span class=\"hljs-title function_\">keys</span>(colorMap).<span class=\"hljs-title function_\">forEach</span>(<span class=\"hljs-function\"><span class=\"hljs-params\">key</span> =&gt;</span> &#123;<br>    <span class=\"hljs-keyword\">const</span> value = colorMap[key]<br>    data = data.<span class=\"hljs-title function_\">replace</span>(<span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">RegExp</span>(key, <span class=\"hljs-string\">&#x27;ig&#x27;</span>), value)<br>  &#125;)<br><br>  <span class=\"hljs-comment\">// 替换完之后</span><br>  <span class=\"hljs-comment\">// `--el-color-primary: #409eff` 就变成了 `--el-color-primary: primary`</span><br>  <span class=\"hljs-comment\">// --el-color-primary-light-3: #79bbff;  变成了  --el-color-primary-light-3: light-3</span><br>  <span class=\"hljs-comment\">// ...</span><br>  <span class=\"hljs-comment\">// ...</span><br>  <span class=\"hljs-comment\">// `--el-color-primary-light-9: #ecf5ff` 变成了 `--el-color-primary-light-9: light-9`</span><br><br>  <span class=\"hljs-keyword\">return</span> data<br>&#125;<br></code></pre></td></tr></table></figure>\n\n<p><strong>我们来分析一下 theme.ts 中函数的执行流程</strong></p>\n<ol>\n<li><p>首先，外部调用 <code>generateNewStyle</code> 方法，传入 primaryColor，我们通过 el-color-picker 选中后的值，就是 <code>primaryColor</code>，它的色值长这样 <code>rgba(8, 12, 132, 0.68)</code>。</p>\n</li>\n<li><p>通过 <code>generateColors</code> 方法生成色值表</p>\n<ol>\n<li><p>通过 <code>css-color-function</code> 处理我们的颜色转化计算器<code>formula.json</code></p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\"><span class=\"hljs-title function_\">color</span>(<span class=\"hljs-title function_\">rgba</span>(<span class=\"hljs-number\">255</span>, <span class=\"hljs-number\">69</span>, <span class=\"hljs-number\">0</span>, <span class=\"hljs-number\">1</span>) <span class=\"hljs-title function_\">shade</span>(<span class=\"hljs-number\">10</span>%)) &gt;&gt;&gt; color.<span class=\"hljs-title function_\">convert</span>(value) &gt;&gt;&gt; <span class=\"hljs-title function_\">rgba</span>(<span class=\"hljs-number\">0</span>, <span class=\"hljs-number\">12</span>, <span class=\"hljs-number\">230</span>, <span class=\"hljs-number\">0.68</span>)<br></code></pre></td></tr></table></figure>\n</li>\n<li><p>使用 <code>rgbHex</code> 方法将 rgba 转化为十六进制格式</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\"><span class=\"hljs-title function_\">rgbHex</span>(color.<span class=\"hljs-title function_\">convert</span>(value))  ===&gt;&gt;&gt;  <span class=\"hljs-string\">&#x27;#030420ad&#x27;</span><br></code></pre></td></tr></table></figure></li>\n<li><p>返回处理过后的色值表 <code>colors</code></p>\n</li>\n</ol>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\">&#123;<br>  <span class=\"hljs-attr\">primary</span>: <span class=\"hljs-string\">&#x27;rgba(8, 12, 132, 0.68)&#x27;</span>, <span class=\"hljs-comment\">// 保留了原始的rgba格式</span><br>  shade-<span class=\"hljs-number\">1</span>: <span class=\"hljs-string\">&#x27;#070b77ad&#x27;</span>,<br>  light-<span class=\"hljs-number\">1</span>: <span class=\"hljs-string\">&#x27;#212490ad&#x27;</span>,<br>  light-<span class=\"hljs-number\">2</span>: <span class=\"hljs-string\">&#x27;#393d9dad&#x27;</span>,<br>  ......<br>&#125;<br></code></pre></td></tr></table></figure></li>\n<li><p>通过 <code>getOriginalStyle</code> 方法，获取 element plus 样式表</p>\n</li>\n<li><p>拿到 element plus 样式数据后，通过 <code>getStyleTemplate</code> 方法，根据默认色值 <code>colorMap</code> 为要替换的色值打上标记</p>\n<ol>\n<li>element-plus 中含有变量 <code>--el-color-primary: #409eff</code>，而我们定义的 colorMap 默认值 <code>&#39;#409eff&#39;: &#39;primary&#39;</code> 就是与 element plus 中的十六进制值是对应。</li>\n<li>我们就是要将 element plus 中的 primary 十六进制值替换成我们的标记，<code>primary、shade-*</code>。因为我们已经处理过 <code>formula.json</code> 了，处理过后得到的是 <strong><code>&#123; primary: &#39;rgba(8, 12, 132, 0.68)&#39;, shade-1: &#39;#070b77ad&#39;, light-1: &#39;#212490ad&#39;, ...&#125;</code></strong> 这种形式，这里面的色值，就是我们需要应用到页面上的颜色。</li>\n<li>替换完之后，element plus 中的颜色变量就被标记上了记号，表示将来需要替换成真正的色值。<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\"><span class=\"hljs-string\">`--el-color-primary: #409eff`</span> 就变成了 <span class=\"hljs-string\">`--el-color-primary: primary`</span><br><span class=\"hljs-string\">`--el-color-primary-light-9: #ecf5ff`</span> 变成了 <span class=\"hljs-string\">`--el-color-primary-light-9: light-9`</span><br></code></pre></td></tr></table></figure></li>\n<li>返回处理过后的 element plus 样式表 <code>cssText</code></li>\n</ol>\n</li>\n<li><p>接着，我们通过正则以及第二步 <code>generateColors</code> 方法返回的 colors，将 <code>cssText</code> 中每个打了标记的变量值替换</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\">cssText = cssText.<span class=\"hljs-title function_\">replace</span>(<span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">RegExp</span>(<span class=\"hljs-string\">&#x27;(:|\\\\s+)&#x27;</span> + key, <span class=\"hljs-string\">&#x27;g&#x27;</span>), <span class=\"hljs-string\">&#x27;$1&#x27;</span> + colors[key])<br></code></pre></td></tr></table></figure>\n\n<ol>\n<li>这个模式中的 (:|\\s+) 表示一个冒号或一个【或】多个空白字符(\\s+)（包括空格、制表符和换行符）</li>\n<li>\\s+ 的第一个 \\ 是转义字符</li>\n<li>key 是一个变量，代表一个需要匹配的字符串，比如匹配 <code>primary</code></li>\n<li><code>&#39;$1&#39; + colors[key]</code>: replace 第二个参数是一个字符串，字符串中的 $1 会被替换成第一个括号捕获组（即 (:|\\s+)）匹配到的文本。所以加上 $1 就是为了在【替换的文本】中【保留原本匹配到的文本】。</li>\n<li>最后返回 cssText，新的样式表中，含有我们自定义的颜色主题</li>\n</ol>\n</li>\n<li><p>最后，通过 <code>writeNewStyle</code> 将新的样式表 <code>cssText</code> 插入到文档中。</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\"><span class=\"hljs-keyword\">const</span> style = <span class=\"hljs-variable language_\">document</span>.<span class=\"hljs-title function_\">createElement</span>(<span class=\"hljs-string\">&#x27;style&#x27;</span>)<br>style.<span class=\"hljs-property\">innerText</span> = cssText<br><span class=\"hljs-variable language_\">document</span>.<span class=\"hljs-property\">head</span>.<span class=\"hljs-title function_\">appendChild</span>(style)<br></code></pre></td></tr></table></figure>\n\n</li>\n</ol>\n<p><strong>总结</strong></p>\n<p>到这里，我们对 <code>element plus</code> 的主题换肤就完成了。</p>\n<p>原理就是：拿到用户选中的颜色值(rgba)，通过 formula 颜色转换器转换成十六进制表 colors，然后拿到 <code>element plus</code> 的样式表，将其中需要修改的变量打上标记并返回含有标记的新样式表 cssText，最后，遍历 colors，通过正则将所有标记替换成 colors 中的值。完成样式的替换。</p>\n<h2 id=\"element-plus-新主题的立即生效\"><a href=\"#element-plus-新主题的立即生效\" class=\"headerlink\" title=\"element-plus 新主题的立即生效\"></a>element-plus 新主题的立即生效</h2><p>到目前我们已经完成了 <code>element-plus</code> 的主题变更，但是当前的主题变更还有一个小问题，那就是：<strong>在刷新页面后，新主题会失效</strong></p>\n<p>那么出现这个问题的原因，非常简单：<strong>因为没有写入新的 <code>style</code></strong></p>\n<p>所以我们只需要在 <strong>应用加载后，写入 <code>style</code> 即可</strong></p>\n<p>那么写入的时机，我们可以放入到 <code>app.vue</code> 中</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\">&lt;script setup&gt;<br><span class=\"hljs-keyword\">import</span> &#123; useStore &#125; <span class=\"hljs-keyword\">from</span> <span class=\"hljs-string\">&#x27;vuex&#x27;</span><br><span class=\"hljs-keyword\">import</span> &#123; generateNewStyle, writeNewStyle &#125; <span class=\"hljs-keyword\">from</span> <span class=\"hljs-string\">&#x27;@/utils/theme&#x27;</span><br><br><span class=\"hljs-keyword\">const</span> store = <span class=\"hljs-title function_\">useStore</span>()<br><span class=\"hljs-title function_\">generateNewStyle</span>(store.<span class=\"hljs-property\">getters</span>.<span class=\"hljs-property\">mainColor</span>).<span class=\"hljs-title function_\">then</span>(<span class=\"hljs-function\"><span class=\"hljs-params\">newStyleText</span> =&gt;</span> &#123;<br>  <span class=\"hljs-title function_\">writeNewStyle</span>(newStyleText)<br>&#125;)<br>&lt;/script&gt;<br></code></pre></td></tr></table></figure>\n\n<h2 id=\"自定义主题变更\"><a href=\"#自定义主题变更\" class=\"headerlink\" title=\"自定义主题变更\"></a>自定义主题变更</h2><p>自定义主题变更相对来说比较简单，因为 <strong>自己的代码更加可控</strong>。</p>\n<p>目前在我们的代码中，需要进行 <strong>自定义主题变更</strong> 为  <strong><code>menu</code> 菜单背景色</strong></p>\n<p>而目前指定 <code>menu</code> 菜单背景色的位置在 <code>layout/components/sidebar/SidebarMenu.vue</code> 中</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\">&lt;el-menu<br>  :<span class=\"hljs-keyword\">default</span>-active=<span class=\"hljs-string\">&quot;activeMenu&quot;</span><br>  :collapse=<span class=\"hljs-string\">&quot;!$store.getters.sidebarOpened&quot;</span><br>  :background-color=<span class=\"hljs-string\">&quot;$store.getters.cssVar.menuBg&quot;</span><br>  :text-color=<span class=\"hljs-string\">&quot;$store.getters.cssVar.menuText&quot;</span><br>  :active-text-color=<span class=\"hljs-string\">&quot;$store.getters.cssVar.menuActiveText&quot;</span><br>  :unique-opened=<span class=\"hljs-string\">&quot;true&quot;</span><br>  router<br>&gt;<br></code></pre></td></tr></table></figure>\n\n<p>此处的 背景色是通过 <code>getters</code> 进行指定的，该 <code>cssVar</code> 的 <code>getters</code> 为：</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\"><span class=\"hljs-attr\">cssVar</span>: <span class=\"hljs-function\"><span class=\"hljs-params\">state</span> =&gt;</span> variables,<br></code></pre></td></tr></table></figure>\n\n<p>所以，我们想要修改 <strong>自定义主题</strong> ，只需要从这里入手即可。</p>\n<p><strong>根据当前保存的 <code>mainColor</code> 覆盖原有的默认色值</strong></p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\"><span class=\"hljs-keyword\">import</span> variables <span class=\"hljs-keyword\">from</span> <span class=\"hljs-string\">&#x27;@/styles/variables.scss&#x27;</span><br><span class=\"hljs-keyword\">import</span> &#123; <span class=\"hljs-variable constant_\">MAIN_COLOR</span> &#125; <span class=\"hljs-keyword\">from</span> <span class=\"hljs-string\">&#x27;@/constant&#x27;</span><br><span class=\"hljs-keyword\">import</span> &#123; getItem &#125; <span class=\"hljs-keyword\">from</span> <span class=\"hljs-string\">&#x27;@/utils/storage&#x27;</span><br><span class=\"hljs-keyword\">import</span> &#123; generateColors &#125; <span class=\"hljs-keyword\">from</span> <span class=\"hljs-string\">&#x27;@/utils/theme&#x27;</span><br><br><span class=\"hljs-keyword\">const</span> getters = &#123;<br>  ...<br>  <span class=\"hljs-attr\">cssVar</span>: <span class=\"hljs-function\"><span class=\"hljs-params\">state</span> =&gt;</span> &#123;<br>    <span class=\"hljs-keyword\">return</span> &#123;<br>      ...variables,<br>      ...<span class=\"hljs-title function_\">generateColors</span>(<span class=\"hljs-title function_\">getItem</span>(<span class=\"hljs-variable constant_\">MAIN_COLOR</span>))<br>    &#125;<br>  &#125;,<br>  ...<br>&#125;<br><span class=\"hljs-keyword\">export</span> <span class=\"hljs-keyword\">default</span> getters<br><br></code></pre></td></tr></table></figure>\n\n<p>但是我们这样设定之后，整个自定义主题变更，还存在两个问题：</p>\n<ol>\n<li><code>menuBg</code> 背景颜色没有变化</li>\n</ol>\n<p>这个问题是因为咱们的 <code>sidebar</code> 的背景色未被替换，所以我们可以在 <code>layout/index</code> 中设置 <code>sidebar</code> 的 <code>backgroundColor</code></p>\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs html\"><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">sidebar</span></span><br><span class=\"hljs-tag\">  <span class=\"hljs-attr\">id</span>=<span class=\"hljs-string\">&quot;guide-sidebar&quot;</span></span><br><span class=\"hljs-tag\">  <span class=\"hljs-attr\">class</span>=<span class=\"hljs-string\">&quot;sidebar-container&quot;</span></span><br><span class=\"hljs-tag\">  <span class=\"hljs-attr\">:style</span>=<span class=\"hljs-string\">&quot;&#123; backgroundColor: $store.getters.cssVar.menuBg &#125;&quot;</span></span><br><span class=\"hljs-tag\">/&gt;</span><br></code></pre></td></tr></table></figure>\n\n<ol start=\"2\">\n<li>主题色替换之后，需要刷新页面才可响应</li>\n</ol>\n<p>这个是因为 <code>getters</code> 中没有监听到 <strong>依赖值的响应变化</strong>，所以我们希望修改依赖值</p>\n<p>在 <code>store/modules/theme</code> 中</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\">...<br><span class=\"hljs-keyword\">import</span> variables <span class=\"hljs-keyword\">from</span> <span class=\"hljs-string\">&#x27;@/styles/variables.scss&#x27;</span><br><span class=\"hljs-keyword\">export</span> <span class=\"hljs-keyword\">default</span> &#123;<br>  <span class=\"hljs-attr\">namespaced</span>: <span class=\"hljs-literal\">true</span>,<br>  <span class=\"hljs-attr\">state</span>: <span class=\"hljs-function\">() =&gt;</span> (&#123;<br>    ...<br>    variables<br>  &#125;),<br>  <span class=\"hljs-attr\">mutations</span>: &#123;<br>    <span class=\"hljs-comment\">/**</span><br><span class=\"hljs-comment\">     * 设置主题色</span><br><span class=\"hljs-comment\">     */</span><br>    <span class=\"hljs-title function_\">setMainColor</span>(<span class=\"hljs-params\">state, newColor</span>) &#123;<br>      ...<br>      state.<span class=\"hljs-property\">variables</span>.<span class=\"hljs-property\">menuBg</span> = newColor<br>      ...<br>    &#125;<br>  &#125;<br>&#125;<br><br></code></pre></td></tr></table></figure>\n\n<p>在 <code>getters</code> 中</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\">....<br><br><span class=\"hljs-keyword\">const</span> getters = &#123;<br> ...<br>  <span class=\"hljs-attr\">cssVar</span>: <span class=\"hljs-function\"><span class=\"hljs-params\">state</span> =&gt;</span> &#123;<br>    <span class=\"hljs-keyword\">return</span> &#123;<br>      ...state.<span class=\"hljs-property\">theme</span>.<span class=\"hljs-property\">variables</span>,<br>      ...<span class=\"hljs-title function_\">generateColors</span>(<span class=\"hljs-title function_\">getItem</span>(<span class=\"hljs-variable constant_\">MAIN_COLOR</span>))<br>    &#125;<br>  &#125;,<br>  ...<br>&#125;<br><span class=\"hljs-keyword\">export</span> <span class=\"hljs-keyword\">default</span> getters<br><br></code></pre></td></tr></table></figure>\n\n<p>那么到这里整个自定义主题我们就处理完成了。</p>\n<p>对于 <strong>自定义主题而言</strong>，核心的原理其实就是 <strong>修改<code>scss</code>变量来进行实现主题色变化</strong> </p>\n<p>明确好了原理之后，对后续实现的步骤就具体情况具体分析了。</p>\n<ol>\n<li>对于 <code>element-plus</code>：因为 <code>element-plus</code> 是第三方的包，所以它 <strong>不是完全可控</strong> 的，那么对于这种最简单直白的方案，就是直接拿到它编译后的 <code>css</code> 进行色值替换，利用 <code>style</code> <strong>内部样式表</strong> 优先级高于 <strong>外部样式表</strong> 的特性，来进行主题替换</li>\n<li>对于自定义主题：因为自定义主题是 <strong>完全可控</strong> 的，所以我们实现起来就轻松很多，只需要修改对应的 <code>scss</code>变量即可</li>\n</ol>\n<p>那么在之后大家遇到 <strong>自定义主题</strong> 的处理时，就可以按照这里所梳理的方案进行处理了。</p>\n<h1 id=\"结束语\"><a href=\"#结束语\" class=\"headerlink\" title=\"结束语\"></a>结束语</h1><p>这一章我们花了大量的篇幅来介绍换肤的原理以及业务场景如何实现换肤，篇幅有点长，就不在此添加其他功能的描述了。</p>\n<p>如下功能我们放到下一章节去实现：</p>\n<ul>\n<li>screenfull</li>\n<li>headerSearch</li>\n<li>tagView</li>\n<li>guide</li>\n</ul>\n<h1 id=\"参考链接\"><a href=\"#参考链接\" class=\"headerlink\" title=\"参考链接\"></a>参考链接</h1><ul>\n<li><a href=\"https://www.ruanyifeng.com/blog/2017/05/css-variables.html\">CSS变量教程</a></li>\n</ul>\n","site":{"data":{}},"wordcount":33859,"more":"<h1 id=\"通用功能\"><a href=\"#通用功能\" class=\"headerlink\" title=\"通用功能\"></a>通用功能</h1><ol>\n<li>国际化</li>\n<li>动态换肤</li>\n<li><code>screenfull</code></li>\n<li><code>headerSearch</code></li>\n<li><code>tagView</code></li>\n<li><code>guide</code></li>\n</ol>\n<h1 id=\"国际化实现原理\"><a href=\"#国际化实现原理\" class=\"headerlink\" title=\"国际化实现原理\"></a>国际化实现原理</h1><p>先来看一个需求：</p>\n<blockquote>\n<p>我们有一个变量 <code>msg</code> ，但是这个 <code>msg</code> 有且只能有两个值：</p>\n<ol>\n<li>hello world</li>\n<li>你好世界</li>\n</ol>\n<p>要求：根据需要切换 <code>msg</code> 的值</p>\n</blockquote>\n<p>这样的一个需求就是 国际化 的需求，那么我们可以通过以下代码来实现这个需求</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\">&lt;script&gt;<br>  <span class=\"hljs-comment\">// 1. 定义 msg 值的数据源</span><br>  <span class=\"hljs-keyword\">const</span> messages = &#123;<br>    <span class=\"hljs-attr\">en</span>: &#123;<br>      <span class=\"hljs-attr\">msg</span>: <span class=\"hljs-string\">&#x27;hello world&#x27;</span><br>    &#125;,<br>    <span class=\"hljs-attr\">zh</span>: &#123;<br>      <span class=\"hljs-attr\">msg</span>: <span class=\"hljs-string\">&#x27;你好世界&#x27;</span><br>    &#125;<br>  &#125;<br>  <span class=\"hljs-comment\">// 2. 定义切换变量</span><br>  <span class=\"hljs-keyword\">let</span> locale = <span class=\"hljs-string\">&#x27;en&#x27;</span><br>  <span class=\"hljs-comment\">// 3. 定义赋值函数</span><br>  <span class=\"hljs-keyword\">function</span> <span class=\"hljs-title function_\">t</span>(<span class=\"hljs-params\">key</span>) &#123;<br>    <span class=\"hljs-keyword\">return</span> messages[locale][key]<br>  &#125;<br>  <span class=\"hljs-comment\">// 4. 为 msg 赋值 </span><br>  <span class=\"hljs-keyword\">let</span> msg = <span class=\"hljs-title function_\">t</span>(<span class=\"hljs-string\">&#x27;msg&#x27;</span>)<br>  <span class=\"hljs-variable language_\">console</span>.<span class=\"hljs-title function_\">log</span>(msg);<br>  <span class=\"hljs-comment\">// 修改 locale， 重新执行 t 方法，获取不同语言环境下的值</span><br><br>&lt;/script&gt;<br></code></pre></td></tr></table></figure>\n\n<p>总结：</p>\n<ol>\n<li>通过一个变量来 <strong>控制</strong> 语言环境</li>\n<li>所有语言环境下的数据源要 <strong>预先</strong> 定义好</li>\n<li>通过一个方法来获取 <strong>当前语言</strong> 下 <strong>指定属性</strong> 的值</li>\n<li>该值即为国际化下展示值</li>\n</ol>\n<h2 id=\"基于-vue-i18n-V9-的国际化实现方案分析\"><a href=\"#基于-vue-i18n-V9-的国际化实现方案分析\" class=\"headerlink\" title=\"基于 vue-i18n V9  的国际化实现方案分析\"></a>基于 vue-i18n V9  的国际化实现方案分析</h2><p>在 <code>vue</code> 的项目中，我们不需要手写这么复杂的一些基础代码，可以直接使用 <a href=\"https://vue-i18n.intlify.dev/\">vue-i18n</a> 进行实现（注意：<strong><code>vue3</code> 下需要使用 <code>V 9.x</code> 的 <code>i18n</code></strong>）</p>\n<p><a href=\"https://vue-i18n.intlify.dev/guide/\">vue-i18n</a> 的使用可以分为四个部分：</p>\n<ol>\n<li>创建 <code>messages</code> 数据源</li>\n<li>创建 <code>locale</code> 语言变量</li>\n<li>初始化 <code>i18n</code> 实例</li>\n<li>注册 <code>i18n</code> 实例</li>\n</ol>\n<p>那么接下来我们就去实现以下：</p>\n<ol>\n<li>安装 <code>vue-i18n</code><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\">npm install vue-i18n@next<br></code></pre></td></tr></table></figure>\n\n\n</li>\n</ol>\n<ol start=\"2\">\n<li><p>创建 <code>i18n/index.js</code> 文件</p>\n</li>\n<li><p>创建 <code>messages</code> 数据源</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\"><span class=\"hljs-keyword\">const</span> messages = &#123;<br>  <span class=\"hljs-attr\">en</span>: &#123;<br>    <span class=\"hljs-attr\">msg</span>: &#123;<br>      <span class=\"hljs-attr\">test</span>: <span class=\"hljs-string\">&#x27;hello world&#x27;</span><br>    &#125;<br>  &#125;,<br>  <span class=\"hljs-attr\">zh</span>: &#123;<br>    <span class=\"hljs-attr\">msg</span>: &#123;<br>      <span class=\"hljs-attr\">test</span>: <span class=\"hljs-string\">&#x27;你好世界&#x27;</span><br>    &#125;<br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure>\n</li>\n<li><p>创建 <code>locale</code> 语言变量</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\"><span class=\"hljs-keyword\">const</span> locale = <span class=\"hljs-string\">&#x27;en&#x27;</span><br></code></pre></td></tr></table></figure>\n</li>\n<li><p>初始化 <code>i18n</code> 实例</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\"><span class=\"hljs-keyword\">import</span> &#123; createI18n &#125; <span class=\"hljs-keyword\">from</span> <span class=\"hljs-string\">&#x27;vue-i18n&#x27;</span><br><br><span class=\"hljs-keyword\">const</span> i18n = <span class=\"hljs-title function_\">createI18n</span>(&#123;<br>  <span class=\"hljs-comment\">// 使用 Composition API 模式，则需要将其设置为false</span><br>  <span class=\"hljs-attr\">legacy</span>: <span class=\"hljs-literal\">false</span>,<br>  <span class=\"hljs-comment\">// 全局注入 $t 函数</span><br>  <span class=\"hljs-attr\">globalInjection</span>: <span class=\"hljs-literal\">true</span>,<br>  locale,<br>  messages<br>&#125;)<br></code></pre></td></tr></table></figure>\n</li>\n<li><p>把 <code>i18n</code> 注册到 <code>vue</code> 实例</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\"><span class=\"hljs-keyword\">export</span> <span class=\"hljs-keyword\">default</span> i18n<br></code></pre></td></tr></table></figure>\n</li>\n<li><p>在 <code>main.js</code> 中导入</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\"><span class=\"hljs-comment\">// i18n （PS：导入放到 APP.vue 导入之前，因为后面我们会在 app.vue 中使用国际化内容）</span><br><span class=\"hljs-keyword\">import</span> i18n <span class=\"hljs-keyword\">from</span> <span class=\"hljs-string\">&#x27;@/i18n&#x27;</span><br>...<br>app.<span class=\"hljs-title function_\">use</span>(i18n)<br></code></pre></td></tr></table></figure>\n</li>\n<li><p>在 <code>layout/components/Sidebar/index.vue</code> 中使用 <code>i18n</code></p>\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs html\"><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">h1</span> <span class=\"hljs-attr\">class</span>=<span class=\"hljs-string\">&quot;logo-title&quot;</span> <span class=\"hljs-attr\">v-if</span>=<span class=\"hljs-string\">&quot;$store.getters.sidebarOpened&quot;</span>&gt;</span><br>        &#123;&#123; $t(&#x27;msg.test&#x27;) &#125;&#125;<br><span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">h1</span>&gt;</span><br></code></pre></td></tr></table></figure>\n</li>\n<li><p>修改 <code>locale</code> 的值，即可改变展示的内容</p>\n</li>\n</ol>\n<p>截止到现在我们已经实现了 <code>i18n</code> 的最基础用法，那么解下来我们就可以在项目中使用 <code>i18n</code> 完成国际化。</p>\n<p>项目中完成国际化分成以下几步进行:</p>\n<ol>\n<li>封装 <code>langSelect</code> 组件用于修改 <code>locale</code></li>\n<li>导入 <code>el-locale</code> 语言包</li>\n<li>创建自定义语言包</li>\n</ol>\n<h2 id=\"封装-langSelect-组件\"><a href=\"#封装-langSelect-组件\" class=\"headerlink\" title=\"封装  langSelect  组件\"></a>封装  langSelect  组件</h2><ol>\n<li><p>定义 <code>store/app.js</code></p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\"><span class=\"hljs-keyword\">import</span> &#123; <span class=\"hljs-variable constant_\">LANG</span> &#125; <span class=\"hljs-keyword\">from</span> <span class=\"hljs-string\">&#x27;@/constant&#x27;</span><br><span class=\"hljs-keyword\">import</span> &#123; getItem, setItem &#125; <span class=\"hljs-keyword\">from</span> <span class=\"hljs-string\">&#x27;@/utils/storage&#x27;</span><br><span class=\"hljs-keyword\">export</span> <span class=\"hljs-keyword\">default</span> &#123;<br>  <span class=\"hljs-attr\">namespaced</span>: <span class=\"hljs-literal\">true</span>,<br>  <span class=\"hljs-attr\">state</span>: <span class=\"hljs-function\">() =&gt;</span> (&#123;<br>    ...<br>    <span class=\"hljs-attr\">language</span>: <span class=\"hljs-title function_\">getItem</span>(<span class=\"hljs-variable constant_\">LANG</span>) || <span class=\"hljs-string\">&#x27;zh&#x27;</span><br>  &#125;),<br>  <span class=\"hljs-attr\">mutations</span>: &#123;<br>    ...<br>    <span class=\"hljs-comment\">/**</span><br><span class=\"hljs-comment\">     * 设置国际化</span><br><span class=\"hljs-comment\">     */</span><br>    <span class=\"hljs-title function_\">setLanguage</span>(<span class=\"hljs-params\">state, lang</span>) &#123;<br>      <span class=\"hljs-title function_\">setItem</span>(<span class=\"hljs-variable constant_\">LANG</span>, lang)<br>      state.<span class=\"hljs-property\">language</span> = lang<br>    &#125;<br>  &#125;,<br>  <span class=\"hljs-attr\">actions</span>: &#123;&#125;<br>&#125;<br><br></code></pre></td></tr></table></figure>\n\n\n\n</li>\n</ol>\n<ol start=\"2\">\n<li><p>在 <code>constant</code> 中定义常量</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\"><span class=\"hljs-comment\">// 国际化</span><br><span class=\"hljs-keyword\">export</span> <span class=\"hljs-keyword\">const</span> <span class=\"hljs-variable constant_\">LANG</span> = <span class=\"hljs-string\">&#x27;language&#x27;</span><br></code></pre></td></tr></table></figure>\n\n\n</li>\n</ol>\n<ol start=\"3\">\n<li><p>创建 <code>components/LangSelect/index</code> </p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\">&lt;template&gt;<br>  <span class=\"language-xml\"><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">el-dropdown</span></span></span><br><span class=\"hljs-tag\"><span class=\"language-xml\">    <span class=\"hljs-attr\">trigger</span>=<span class=\"hljs-string\">&quot;click&quot;</span></span></span><br><span class=\"hljs-tag\"><span class=\"language-xml\">    <span class=\"hljs-attr\">class</span>=<span class=\"hljs-string\">&quot;international&quot;</span></span></span><br><span class=\"hljs-tag\"><span class=\"language-xml\">    @<span class=\"hljs-attr\">command</span>=<span class=\"hljs-string\">&quot;handleSetLanguage&quot;</span></span></span><br><span class=\"hljs-tag\"><span class=\"language-xml\">  &gt;</span></span><br><span class=\"language-xml\">    <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">div</span>&gt;</span></span><br><span class=\"language-xml\">      <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">el-tooltip</span> <span class=\"hljs-attr\">content</span>=<span class=\"hljs-string\">&quot;国际化&quot;</span> <span class=\"hljs-attr\">:effect</span>=<span class=\"hljs-string\">&quot;effect&quot;</span>&gt;</span></span><br><span class=\"language-xml\">        <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">svg-icon</span> <span class=\"hljs-attr\">icon</span>=<span class=\"hljs-string\">&quot;language&quot;</span> /&gt;</span></span><br><span class=\"language-xml\">      <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">el-tooltip</span>&gt;</span></span><br><span class=\"language-xml\">    <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">div</span>&gt;</span></span><br><span class=\"language-xml\">    <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">template</span> #<span class=\"hljs-attr\">dropdown</span>&gt;</span></span><br><span class=\"language-xml\">      <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">el-dropdown-menu</span>&gt;</span></span><br><span class=\"language-xml\">        <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">el-dropdown-item</span> <span class=\"hljs-attr\">:disabled</span>=<span class=\"hljs-string\">&quot;language === &#x27;zh&#x27;&quot;</span> <span class=\"hljs-attr\">command</span>=<span class=\"hljs-string\">&quot;zh&quot;</span>&gt;</span></span><br><span class=\"language-xml\">          中文</span><br><span class=\"language-xml\">        <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">el-dropdown-item</span>&gt;</span></span><br><span class=\"language-xml\">        <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">el-dropdown-item</span> <span class=\"hljs-attr\">:disabled</span>=<span class=\"hljs-string\">&quot;language === &#x27;en&#x27;&quot;</span> <span class=\"hljs-attr\">command</span>=<span class=\"hljs-string\">&quot;en&quot;</span>&gt;</span></span><br><span class=\"language-xml\">          English</span><br><span class=\"language-xml\">        <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">el-dropdown-item</span>&gt;</span></span><br><span class=\"language-xml\">      <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">el-dropdown-menu</span>&gt;</span></span><br><span class=\"language-xml\">    <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">template</span>&gt;</span></span><br><span class=\"language-xml\">  <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">el-dropdown</span>&gt;</span></span><br>&lt;/template&gt;<br><br><span class=\"language-xml\"><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">script</span> <span class=\"hljs-attr\">setup</span>&gt;</span><span class=\"language-javascript\"></span></span><br><span class=\"language-javascript\"><span class=\"language-xml\"><span class=\"hljs-keyword\">import</span> &#123; useI18n &#125; <span class=\"hljs-keyword\">from</span> <span class=\"hljs-string\">&#x27;vue-i18n&#x27;</span></span></span><br><span class=\"language-javascript\"><span class=\"language-xml\"><span class=\"hljs-keyword\">import</span> &#123; defineProps, computed &#125; <span class=\"hljs-keyword\">from</span> <span class=\"hljs-string\">&#x27;vue&#x27;</span></span></span><br><span class=\"language-javascript\"><span class=\"language-xml\"><span class=\"hljs-keyword\">import</span> &#123; useStore &#125; <span class=\"hljs-keyword\">from</span> <span class=\"hljs-string\">&#x27;vuex&#x27;</span></span></span><br><span class=\"language-javascript\"><span class=\"language-xml\"><span class=\"hljs-keyword\">import</span> &#123; <span class=\"hljs-title class_\">ElMessage</span> &#125; <span class=\"hljs-keyword\">from</span> <span class=\"hljs-string\">&#x27;element-plus&#x27;</span></span></span><br><span class=\"language-javascript\"><span class=\"language-xml\"></span></span><br><span class=\"language-javascript\"><span class=\"language-xml\"><span class=\"hljs-title function_\">defineProps</span>(&#123;</span></span><br><span class=\"language-javascript\"><span class=\"language-xml\">  <span class=\"hljs-attr\">effect</span>: &#123;</span></span><br><span class=\"language-javascript\"><span class=\"language-xml\">    <span class=\"hljs-attr\">type</span>: <span class=\"hljs-title class_\">String</span>,</span></span><br><span class=\"language-javascript\"><span class=\"language-xml\">    <span class=\"hljs-attr\">default</span>: <span class=\"hljs-string\">&#x27;dark&#x27;</span>,</span></span><br><span class=\"language-javascript\"><span class=\"language-xml\">    <span class=\"hljs-attr\">validator</span>: <span class=\"hljs-keyword\">function</span>(<span class=\"hljs-params\">value</span>) &#123;</span></span><br><span class=\"language-javascript\"><span class=\"language-xml\">      <span class=\"hljs-comment\">// 这个值必须匹配下列字符串中的一个</span></span></span><br><span class=\"language-javascript\"><span class=\"language-xml\">      <span class=\"hljs-keyword\">return</span> [<span class=\"hljs-string\">&#x27;dark&#x27;</span>, <span class=\"hljs-string\">&#x27;light&#x27;</span>].<span class=\"hljs-title function_\">indexOf</span>(value) !== -<span class=\"hljs-number\">1</span></span></span><br><span class=\"language-javascript\"><span class=\"language-xml\">    &#125;</span></span><br><span class=\"language-javascript\"><span class=\"language-xml\">  &#125;</span></span><br><span class=\"language-javascript\"><span class=\"language-xml\">&#125;)</span></span><br><span class=\"language-javascript\"><span class=\"language-xml\"></span></span><br><span class=\"language-javascript\"><span class=\"language-xml\"><span class=\"hljs-keyword\">const</span> store = <span class=\"hljs-title function_\">useStore</span>()</span></span><br><span class=\"language-javascript\"><span class=\"language-xml\"><span class=\"hljs-keyword\">const</span> language = <span class=\"hljs-title function_\">computed</span>(<span class=\"hljs-function\">() =&gt;</span> store.<span class=\"hljs-property\">getters</span>.<span class=\"hljs-property\">language</span>)</span></span><br><span class=\"language-javascript\"><span class=\"language-xml\"></span></span><br><span class=\"language-javascript\"><span class=\"language-xml\"><span class=\"hljs-comment\">// 切换语言的方法</span></span></span><br><span class=\"language-javascript\"><span class=\"language-xml\"><span class=\"hljs-keyword\">const</span> i18n = <span class=\"hljs-title function_\">useI18n</span>()</span></span><br><span class=\"language-javascript\"><span class=\"language-xml\"><span class=\"hljs-keyword\">const</span> <span class=\"hljs-title function_\">handleSetLanguage</span> = lang =&gt; &#123;</span></span><br><span class=\"language-javascript\"><span class=\"language-xml\">  i18n.<span class=\"hljs-property\">locale</span>.<span class=\"hljs-property\">value</span> = lang</span></span><br><span class=\"language-javascript\"><span class=\"language-xml\">  store.<span class=\"hljs-title function_\">commit</span>(<span class=\"hljs-string\">&#x27;app/setLanguage&#x27;</span>, lang)</span></span><br><span class=\"language-javascript\"><span class=\"language-xml\">  <span class=\"hljs-title class_\">ElMessage</span>.<span class=\"hljs-title function_\">success</span>(<span class=\"hljs-string\">&#x27;更新成功&#x27;</span>)</span></span><br><span class=\"language-javascript\"><span class=\"language-xml\">&#125;</span></span><br><span class=\"language-javascript\"><span class=\"language-xml\"></span><span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">script</span>&gt;</span></span><br></code></pre></td></tr></table></figure>\n</li>\n<li><p>在 <code>navbar</code> 中导入 <code>LangSelect</code></p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\">&lt;template&gt;<br>  <span class=\"language-xml\"><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">div</span> <span class=\"hljs-attr\">class</span>=<span class=\"hljs-string\">&quot;navbar&quot;</span>&gt;</span></span><br><span class=\"language-xml\">    ...</span><br><span class=\"language-xml\">    <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">div</span> <span class=\"hljs-attr\">class</span>=<span class=\"hljs-string\">&quot;right-menu&quot;</span>&gt;</span></span><br><span class=\"language-xml\">      <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">lang-select</span> <span class=\"hljs-attr\">class</span>=<span class=\"hljs-string\">&quot;right-menu-item hover-effect&quot;</span> /&gt;</span></span><br><span class=\"language-xml\">      <span class=\"hljs-comment\">&lt;!-- 头像 --&gt;</span></span><br><span class=\"language-xml\">      ...</span><br><span class=\"language-xml\">    <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">div</span>&gt;</span></span><br><span class=\"language-xml\">  <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">div</span>&gt;</span></span><br>&lt;/template&gt;<br><br><span class=\"language-xml\"><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">script</span> <span class=\"hljs-attr\">setup</span>&gt;</span><span class=\"language-javascript\"></span></span><br><span class=\"language-javascript\"><span class=\"language-xml\"><span class=\"hljs-keyword\">import</span> <span class=\"hljs-title class_\">LangSelect</span> <span class=\"hljs-keyword\">from</span> <span class=\"hljs-string\">&#x27;@/components/LangSelect&#x27;</span></span></span><br><span class=\"language-javascript\"><span class=\"language-xml\">...</span></span><br><span class=\"language-javascript\"><span class=\"language-xml\"></span><span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">script</span>&gt;</span></span><br><br><span class=\"language-xml\"><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">style</span> <span class=\"hljs-attr\">lang</span>=<span class=\"hljs-string\">&quot;scss&quot;</span> <span class=\"hljs-attr\">scoped</span>&gt;</span><span class=\"language-css\"></span></span><br><span class=\"language-css\"><span class=\"language-xml\"><span class=\"hljs-selector-class\">.navbar</span> &#123;</span></span><br><span class=\"language-css\"><span class=\"language-xml\">  ...</span></span><br><span class=\"language-css\"><span class=\"language-xml\"></span></span><br><span class=\"language-css\"><span class=\"language-xml\">  <span class=\"hljs-selector-class\">.right-menu</span> &#123;</span></span><br><span class=\"language-css\"><span class=\"language-xml\">    ...</span></span><br><span class=\"language-css\"><span class=\"language-xml\"></span></span><br><span class=\"language-css\"><span class=\"language-xml\">    ::v-deep .right-menu-item &#123;</span></span><br><span class=\"language-css\"><span class=\"language-xml\">      <span class=\"hljs-attribute\">display</span>: inline-block;</span></span><br><span class=\"language-css\"><span class=\"language-xml\">      <span class=\"hljs-attribute\">padding</span>: <span class=\"hljs-number\">0</span> <span class=\"hljs-number\">18px</span> <span class=\"hljs-number\">0</span> <span class=\"hljs-number\">0</span>;</span></span><br><span class=\"language-css\"><span class=\"language-xml\">      <span class=\"hljs-attribute\">font-size</span>: <span class=\"hljs-number\">24px</span>;</span></span><br><span class=\"language-css\"><span class=\"language-xml\">      <span class=\"hljs-attribute\">color</span>: <span class=\"hljs-number\">#5a5e66</span>;</span></span><br><span class=\"language-css\"><span class=\"language-xml\">      <span class=\"hljs-attribute\">vertical-align</span>: text-bottom;</span></span><br><span class=\"language-css\"><span class=\"language-xml\"></span></span><br><span class=\"language-css\"><span class=\"language-xml\">      &amp;<span class=\"hljs-selector-class\">.hover-effect</span> &#123;</span></span><br><span class=\"language-css\"><span class=\"language-xml\">        <span class=\"hljs-attribute\">cursor</span>: pointer;</span></span><br><span class=\"language-css\"><span class=\"language-xml\">      &#125;</span></span><br><span class=\"language-css\"><span class=\"language-xml\">    &#125;</span></span><br><span class=\"language-css\"><span class=\"language-xml\"></span></span><br><span class=\"language-css\"><span class=\"language-xml\">    ...</span></span><br><span class=\"language-css\"><span class=\"language-xml\">&#125;</span></span><br><span class=\"language-css\"><span class=\"language-xml\"></span><span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">style</span>&gt;</span></span><br><br></code></pre></td></tr></table></figure>\n\n</li>\n</ol>\n<h2 id=\"element-plus-国际化处理\"><a href=\"#element-plus-国际化处理\" class=\"headerlink\" title=\"element-plus 国际化处理\"></a>element-plus 国际化处理</h2><p>截止到目前，我们的国际化内容已经基本功能已经处理完成了。接下来需要处理的就是对应的语言包，有了语言包就可以实现整个项目中的所有国际化处理了。</p>\n<p>那么对于语言包来说，我们整个项目中会分成两部分：</p>\n<ol>\n<li><code>element-plus</code> 语言包：用来处理 <code>element</code> 组件的国际化功能</li>\n<li>自定义语言包：用来处理 <strong>非</strong><code>element</code> 组件的国际化功能</li>\n</ol>\n<p>那么首先我们先来处理 <code>element-plus</code> 语言包：</p>\n<ol start=\"3\">\n<li>在 <code>plugins/index</code> 中导入 <code>element</code> 的中文、英文语言包：</li>\n</ol>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\"><span class=\"hljs-keyword\">import</span> zhCn <span class=\"hljs-keyword\">from</span> <span class=\"hljs-string\">&#x27;element-plus/es/locale/lang/zh-cn&#x27;</span><br><span class=\"hljs-keyword\">import</span> en <span class=\"hljs-keyword\">from</span> <span class=\"hljs-string\">&#x27;element-plus/lib/locale/lang/en&#x27;</span><br></code></pre></td></tr></table></figure>\n\n<ol start=\"4\">\n<li><p>注册 <code>element</code> 时，根据当前语言选择使用哪种语言包</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\"><span class=\"hljs-keyword\">import</span> store <span class=\"hljs-keyword\">from</span> <span class=\"hljs-string\">&#x27;@/store&#x27;</span><br><br><span class=\"hljs-keyword\">export</span> <span class=\"hljs-keyword\">default</span> app =&gt; &#123;<br>  app.<span class=\"hljs-title function_\">use</span>(<span class=\"hljs-title class_\">ElementPlus</span>, &#123;<br>    <span class=\"hljs-attr\">locale</span>: store.<span class=\"hljs-property\">getters</span>.<span class=\"hljs-property\">language</span> === <span class=\"hljs-string\">&#x27;en&#x27;</span> ? en : zhCn<br>  &#125;)<br>&#125;<br></code></pre></td></tr></table></figure>\n\n\n\n\n\n</li>\n</ol>\n<h2 id=\"自定义语言包国际化处理\"><a href=\"#自定义语言包国际化处理\" class=\"headerlink\" title=\"自定义语言包国际化处理\"></a>自定义语言包国际化处理</h2><p>处理完 <code>element</code> 的国际化内容之后，接下来我们来处理 <strong>自定义语言包</strong>。</p>\n<ol>\n<li>在本地创建 <code>lang</code> 文件夹，里面创建好本地需要的语言包，由于比较多，就放一部分来看看：</li>\n</ol>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\"><span class=\"hljs-comment\">// en.ts</span><br><span class=\"hljs-keyword\">export</span> <span class=\"hljs-keyword\">default</span> &#123;<br>  <span class=\"hljs-attr\">login</span>: &#123;<br>    <span class=\"hljs-attr\">title</span>: <span class=\"hljs-string\">&#x27;User Login&#x27;</span>,<br>    <span class=\"hljs-attr\">loginBtn</span>: <span class=\"hljs-string\">&#x27;Login&#x27;</span>,<br>    <span class=\"hljs-attr\">usernameRule</span>: <span class=\"hljs-string\">&#x27;Username is required&#x27;</span>,<br>    <span class=\"hljs-attr\">passwordRule</span>: <span class=\"hljs-string\">&#x27;Password cannot be less than 6 digits&#x27;</span>,<br>  &#125;,<br>  <span class=\"hljs-comment\">// other....</span><br>&#125;<br><br><span class=\"hljs-comment\">// zh.ts</span><br><span class=\"hljs-keyword\">export</span> <span class=\"hljs-keyword\">default</span> &#123;<br>  <span class=\"hljs-attr\">login</span>: &#123;<br>    <span class=\"hljs-attr\">title</span>: <span class=\"hljs-string\">&#x27;用户登录&#x27;</span>,<br>    <span class=\"hljs-attr\">loginBtn</span>: <span class=\"hljs-string\">&#x27;登录&#x27;</span>,<br>    <span class=\"hljs-attr\">usernameRule</span>: <span class=\"hljs-string\">&#x27;用户名为必填项&#x27;</span>,<br>    <span class=\"hljs-attr\">passwordRule</span>: <span class=\"hljs-string\">&#x27;密码不能少于6位&#x27;</span>,<br>  &#125;,<br>  <span class=\"hljs-comment\">// other...</span><br>&#125;<br></code></pre></td></tr></table></figure>\n\n<ol start=\"2\">\n<li><p>在 <code>lang/index</code> 中，导入语言包</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\"><span class=\"hljs-keyword\">import</span> mZhLocale <span class=\"hljs-keyword\">from</span> <span class=\"hljs-string\">&#x27;./lang/zh&#x27;</span><br><span class=\"hljs-keyword\">import</span> mEnLocale <span class=\"hljs-keyword\">from</span> <span class=\"hljs-string\">&#x27;./lang/en&#x27;</span><br></code></pre></td></tr></table></figure>\n</li>\n<li><p>在 <code>messages</code> 中注册到语言包</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\"><span class=\"hljs-keyword\">const</span> messages = &#123;<br>  <span class=\"hljs-attr\">en</span>: &#123;<br>    <span class=\"hljs-attr\">msg</span>: &#123;<br>      ...mEnLocale<br>    &#125;<br>  &#125;,<br>  <span class=\"hljs-attr\">zh</span>: &#123;<br>    <span class=\"hljs-attr\">msg</span>: &#123;<br>      ...mZhLocale<br>    &#125;<br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure>\n\n</li>\n</ol>\n<h2 id=\"处理项目国际化内容\"><a href=\"#处理项目国际化内容\" class=\"headerlink\" title=\"处理项目国际化内容\"></a>处理项目国际化内容</h2><p>在处理好了国际化的语言包之后，接下来我们就可以应用国际化功能到我们的项目中</p>\n<p>对于我们目前的项目而言，需要进行国际化处理的地方主要分为：</p>\n<ol>\n<li>登录页面</li>\n<li><code>navbar</code> 区域</li>\n<li><code>sidebar</code> 区域</li>\n<li>面包屑区域</li>\n</ol>\n<p>那么这一小节，我们先来处理前两个</p>\n<p><strong>登录页面：</strong></p>\n<p><code>login/index</code></p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\">&lt;template&gt;<br>  <span class=\"language-xml\"><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">div</span> <span class=\"hljs-attr\">class</span>=<span class=\"hljs-string\">&quot;login-container&quot;</span>&gt;</span></span><br><span class=\"language-xml\">    ...</span><br><span class=\"language-xml\">      <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">div</span> <span class=\"hljs-attr\">class</span>=<span class=\"hljs-string\">&quot;title-container&quot;</span>&gt;</span></span><br><span class=\"language-xml\">        <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">h3</span> <span class=\"hljs-attr\">class</span>=<span class=\"hljs-string\">&quot;title&quot;</span>&gt;</span>&#123;&#123; $t(&#x27;msg.login.title&#x27;) &#125;&#125;<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">h3</span>&gt;</span></span><br><span class=\"language-xml\">          <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">lang-select</span> <span class=\"hljs-attr\">class</span>=<span class=\"hljs-string\">&quot;lang-select&quot;</span> <span class=\"hljs-attr\">effect</span>=<span class=\"hljs-string\">&quot;light&quot;</span>&gt;</span><span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">lang-select</span>&gt;</span></span><br><span class=\"language-xml\">      <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">div</span>&gt;</span></span><br><span class=\"language-xml\"></span><br><span class=\"language-xml\">      ...</span><br><span class=\"language-xml\"></span><br><span class=\"language-xml\">      <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">el-button</span></span></span><br><span class=\"hljs-tag\"><span class=\"language-xml\">        <span class=\"hljs-attr\">type</span>=<span class=\"hljs-string\">&quot;primary&quot;</span></span></span><br><span class=\"hljs-tag\"><span class=\"language-xml\">        <span class=\"hljs-attr\">style</span>=<span class=\"hljs-string\">&quot;width: 100%; margin-bottom: 30px&quot;</span></span></span><br><span class=\"hljs-tag\"><span class=\"language-xml\">        <span class=\"hljs-attr\">:loading</span>=<span class=\"hljs-string\">&quot;loading&quot;</span></span></span><br><span class=\"hljs-tag\"><span class=\"language-xml\">        @<span class=\"hljs-attr\">click</span>=<span class=\"hljs-string\">&quot;handleLogin&quot;</span></span></span><br><span class=\"hljs-tag\"><span class=\"language-xml\">        &gt;</span>&#123;&#123; $t(&#x27;msg.login.loginBtn&#x27;) &#125;&#125;&lt;/el-button</span><br><span class=\"language-xml\">      &gt;</span><br><span class=\"language-xml\">      </span><br><span class=\"language-xml\">      <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">div</span> <span class=\"hljs-attr\">class</span>=<span class=\"hljs-string\">&quot;tips&quot;</span> <span class=\"hljs-attr\">v-html</span>=<span class=\"hljs-string\">&quot;$t(&#x27;msg.login.desc&#x27;)&quot;</span>&gt;</span><span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">div</span>&gt;</span></span><br><span class=\"language-xml\">    <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">el-form</span>&gt;</span></span><br><span class=\"language-xml\">  <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">div</span>&gt;</span></span><br>&lt;/template&gt;<br><br><span class=\"language-xml\"><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">script</span> <span class=\"hljs-attr\">setup</span>&gt;</span><span class=\"language-javascript\"></span></span><br><span class=\"language-javascript\"><span class=\"language-xml\"><span class=\"hljs-keyword\">import</span> &#123; useI18n &#125; <span class=\"hljs-keyword\">from</span> <span class=\"hljs-string\">&#x27;vue-i18n&#x27;</span></span></span><br><span class=\"language-javascript\"><span class=\"language-xml\">...</span></span><br><span class=\"language-javascript\"><span class=\"language-xml\"><span class=\"hljs-comment\">// 验证规则</span></span></span><br><span class=\"language-javascript\"><span class=\"language-xml\"><span class=\"hljs-keyword\">const</span> i18n = <span class=\"hljs-title function_\">useI18n</span>()</span></span><br><span class=\"language-javascript\"><span class=\"language-xml\"><span class=\"hljs-keyword\">const</span> loginRules = <span class=\"hljs-title function_\">ref</span>(&#123;</span></span><br><span class=\"language-javascript\"><span class=\"language-xml\">  <span class=\"hljs-attr\">username</span>: [</span></span><br><span class=\"language-javascript\"><span class=\"language-xml\">    &#123;</span></span><br><span class=\"language-javascript\"><span class=\"language-xml\">      ...</span></span><br><span class=\"language-javascript\"><span class=\"language-xml\">      <span class=\"hljs-attr\">message</span>: i18n.<span class=\"hljs-title function_\">t</span>(<span class=\"hljs-string\">&#x27;msg.login.usernameRule&#x27;</span>)</span></span><br><span class=\"language-javascript\"><span class=\"language-xml\">    &#125;</span></span><br><span class=\"language-javascript\"><span class=\"language-xml\">  ],</span></span><br><span class=\"language-javascript\"><span class=\"language-xml\">  ...</span></span><br><span class=\"language-javascript\"><span class=\"language-xml\">&#125;)</span></span><br><span class=\"language-javascript\"><span class=\"language-xml\">...</span></span><br><span class=\"language-javascript\"><span class=\"language-xml\"></span><span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">script</span>&gt;</span></span><br><br><br></code></pre></td></tr></table></figure>\n\n<p><code>login/rules</code></p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\"><span class=\"hljs-keyword\">import</span> i18n <span class=\"hljs-keyword\">from</span> <span class=\"hljs-string\">&#x27;@/i18n&#x27;</span><br><span class=\"hljs-keyword\">export</span> <span class=\"hljs-keyword\">const</span> <span class=\"hljs-title function_\">validatePassword</span> = (<span class=\"hljs-params\"></span>) =&gt; &#123;<br>  <span class=\"hljs-keyword\">return</span> <span class=\"hljs-function\">(<span class=\"hljs-params\">rule, value, callback</span>) =&gt;</span> &#123;<br>    <span class=\"hljs-keyword\">if</span> (value.<span class=\"hljs-property\">length</span> &lt; <span class=\"hljs-number\">6</span>) &#123;<br>      <span class=\"hljs-title function_\">callback</span>(<span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">Error</span>(i18n.<span class=\"hljs-property\">global</span>.<span class=\"hljs-title function_\">t</span>(<span class=\"hljs-string\">&#x27;msg.login.passwordRule&#x27;</span>)))<br>    &#125; <span class=\"hljs-keyword\">else</span> &#123;<br>      <span class=\"hljs-title function_\">callback</span>()<br>    &#125;<br>  &#125;<br>&#125;<br><br></code></pre></td></tr></table></figure>\n\n<p> <strong><code>navbar</code> 区域</strong></p>\n<p><code>layout/components/navbar</code></p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\">&lt;template&gt;<br>  <span class=\"language-xml\"><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">div</span> <span class=\"hljs-attr\">class</span>=<span class=\"hljs-string\">&quot;navbar&quot;</span>&gt;</span></span><br><span class=\"language-xml\">    ...</span><br><span class=\"language-xml\">        <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">template</span> #<span class=\"hljs-attr\">dropdown</span>&gt;</span></span><br><span class=\"language-xml\">          <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">el-dropdown-menu</span> <span class=\"hljs-attr\">class</span>=<span class=\"hljs-string\">&quot;user-dropdown&quot;</span>&gt;</span></span><br><span class=\"language-xml\">            <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">router-link</span> <span class=\"hljs-attr\">to</span>=<span class=\"hljs-string\">&quot;/&quot;</span>&gt;</span></span><br><span class=\"language-xml\">              <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">el-dropdown-item</span>&gt;</span> &#123;&#123; $t(&#x27;msg.navBar.home&#x27;) &#125;&#125; <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">el-dropdown-item</span>&gt;</span></span><br><span class=\"language-xml\">            <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">router-link</span>&gt;</span></span><br><span class=\"language-xml\">            <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">a</span> <span class=\"hljs-attr\">target</span>=<span class=\"hljs-string\">&quot;_blank&quot;</span> <span class=\"hljs-attr\">href</span>=<span class=\"hljs-string\">&quot;&quot;</span>&gt;</span></span><br><span class=\"language-xml\">              <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">el-dropdown-item</span>&gt;</span>&#123;&#123; $t(&#x27;msg.navBar.course&#x27;) &#125;&#125;<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">el-dropdown-item</span>&gt;</span></span><br><span class=\"language-xml\">            <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">a</span>&gt;</span></span><br><span class=\"language-xml\">            <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">el-dropdown-item</span> <span class=\"hljs-attr\">divided</span> @<span class=\"hljs-attr\">click</span>=<span class=\"hljs-string\">&quot;logout&quot;</span>&gt;</span></span><br><span class=\"language-xml\">              &#123;&#123; $t(&#x27;msg.navBar.logout&#x27;) &#125;&#125;</span><br><span class=\"language-xml\">            <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">el-dropdown-item</span>&gt;</span></span><br><span class=\"language-xml\">          <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">el-dropdown-menu</span>&gt;</span></span><br><span class=\"language-xml\">        <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">template</span>&gt;</span></span><br><span class=\"language-xml\">      <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">el-dropdown</span>&gt;</span></span><br>    &lt;/div&gt;<br>  &lt;/div&gt;<br>&lt;/template&gt;<br></code></pre></td></tr></table></figure>\n\n<p><code>components/LangSelect/index</code></p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\">&lt;el-tooltip :content=<span class=\"hljs-string\">&quot;$t(&#x27;msg.navBar.lang&#x27;)&quot;</span> :effect=<span class=\"hljs-string\">&quot;effect&quot;</span>&gt;<br><br><span class=\"hljs-keyword\">const</span> <span class=\"hljs-title function_\">handleSetLanguage</span> = lang =&gt; &#123;<br>  ...<br>  <span class=\"hljs-title class_\">ElMessage</span>.<span class=\"hljs-title function_\">success</span>(i18n.<span class=\"hljs-title function_\">t</span>(<span class=\"hljs-string\">&#x27;msg.toast.switchLangSuccess&#x27;</span>))<br>&#125;<br></code></pre></td></tr></table></figure>\n\n<h2 id=\"sidebar-与-面包屑-区域的国际化处理\"><a href=\"#sidebar-与-面包屑-区域的国际化处理\" class=\"headerlink\" title=\"sidebar 与 面包屑 区域的国际化处理\"></a>sidebar 与 面包屑 区域的国际化处理</h2><p><strong>sidebar 区域</strong></p>\n<p>目前对于 <code>sidebar</code> 而言，显示的文本是我们在定义路由表时的 <code>title</code></p>\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs html\"><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">span</span>&gt;</span>&#123;&#123; title &#125;&#125;<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">span</span>&gt;</span><br></code></pre></td></tr></table></figure>\n\n<p>我们可以 <strong>把 <code>title</code> 作为语言包内容的 <code>key</code> 进行处理</strong></p>\n<p>创建 <code>utils/i18n</code> 工具模块，用于 <strong>将 <code>title</code> 转化为国际化内容</strong></p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\"><span class=\"hljs-keyword\">import</span> i18n <span class=\"hljs-keyword\">from</span> <span class=\"hljs-string\">&#x27;@/i18n&#x27;</span><br><span class=\"hljs-keyword\">export</span> <span class=\"hljs-keyword\">function</span> <span class=\"hljs-title function_\">generateTitle</span>(<span class=\"hljs-params\">title</span>) &#123;<br>  <span class=\"hljs-keyword\">return</span> i18n.<span class=\"hljs-property\">global</span>.<span class=\"hljs-title function_\">t</span>(<span class=\"hljs-string\">&#x27;msg.route.&#x27;</span> + title)<br>&#125;<br><br></code></pre></td></tr></table></figure>\n\n<p>在 <code>layout/components/Sidebar/MenuItem.vue</code> 中导入该方法：</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\">&lt;template&gt;<br>  ...<br>  &lt;span&gt;&#123;&#123; <span class=\"hljs-title function_\">generateTitle</span>(title) &#125;&#125;&lt;/span&gt;<br>&lt;/template&gt;<br><br><span class=\"language-xml\"><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">script</span> <span class=\"hljs-attr\">setup</span>&gt;</span><span class=\"language-javascript\"></span></span><br><span class=\"language-javascript\"><span class=\"language-xml\"><span class=\"hljs-keyword\">import</span> &#123; generateTitle &#125; <span class=\"hljs-keyword\">from</span> <span class=\"hljs-string\">&#x27;@/utils/i18n&#x27;</span></span></span><br><span class=\"language-javascript\"><span class=\"language-xml\">...</span></span><br><span class=\"language-javascript\"><span class=\"language-xml\"></span><span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">script</span>&gt;</span></span><br><br></code></pre></td></tr></table></figure>\n\n<p>最后修改下 <code>sidebarHeader</code> 的内容</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\">&lt;h1 <span class=\"hljs-keyword\">class</span>=<span class=\"hljs-string\">&quot;logo-title&quot;</span> v-<span class=\"hljs-keyword\">if</span>=<span class=\"hljs-string\">&quot;$store.getters.sidebarOpened&quot;</span>&gt;<br>  &#123;&#123; $t(<span class=\"hljs-string\">&#x27;msg.logo&#x27;</span>) &#125;&#125;<br>&lt;/h1&gt;<br></code></pre></td></tr></table></figure>\n\n<p><strong>面包屑区域：</strong></p>\n<p>在 <code>components/Breadcrumb/index</code></p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\">&lt;template&gt;<br>...<br>    &lt;!-- 不可点击项 --&gt;<br>    <span class=\"language-xml\"><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">span</span> <span class=\"hljs-attr\">v-if</span>=<span class=\"hljs-string\">&quot;index === breadcrumbData.length - 1&quot;</span> <span class=\"hljs-attr\">class</span>=<span class=\"hljs-string\">&quot;no-redirect&quot;</span>&gt;</span>&#123;&#123;</span><br><span class=\"language-xml\">        generateTitle(item.meta.title)</span><br><span class=\"language-xml\">        &#125;&#125;<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">span</span>&gt;</span></span><br>    &lt;!-- 可点击项 --&gt;<br>    <span class=\"language-xml\"><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">a</span> <span class=\"hljs-attr\">v-else</span> <span class=\"hljs-attr\">class</span>=<span class=\"hljs-string\">&quot;redirect&quot;</span> @<span class=\"hljs-attr\">click.prevent</span>=<span class=\"hljs-string\">&quot;onLinkClick(item)&quot;</span>&gt;</span>&#123;&#123;</span><br><span class=\"language-xml\">        generateTitle(item.meta.title)</span><br><span class=\"language-xml\">        &#125;&#125;<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">a</span>&gt;</span></span><br>...<br>&lt;/template&gt;<br><br><span class=\"language-xml\"><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">script</span> <span class=\"hljs-attr\">setup</span>&gt;</span><span class=\"language-javascript\"></span></span><br><span class=\"language-javascript\"><span class=\"language-xml\"><span class=\"hljs-keyword\">import</span> &#123; generateTitle &#125; <span class=\"hljs-keyword\">from</span> <span class=\"hljs-string\">&#x27;@/utils/i18n&#x27;</span></span></span><br><span class=\"language-javascript\"><span class=\"language-xml\">...</span></span><br><span class=\"language-javascript\"><span class=\"language-xml\"></span><span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">script</span>&gt;</span></span><br><br></code></pre></td></tr></table></figure>\n\n<h2 id=\"国际化缓存处理\"><a href=\"#国际化缓存处理\" class=\"headerlink\" title=\"国际化缓存处理\"></a>国际化缓存处理</h2><p>我们希望在 <strong>刷新页面后，当前的国际化选择可以被保留</strong>，所以想要实现这个功能，那么就需要进行 <strong>国际化的缓存处理</strong></p>\n<p>此处的缓存，我们依然通过两个方面进行：</p>\n<ol>\n<li><code>vuex</code> 缓存</li>\n<li><code>LocalStorage</code> 缓存</li>\n</ol>\n<p>只不过这里的缓存，我们已经在处理 <strong><code>langSelect</code> 组件时</strong> 处理完成了，所以此时我们只需要使用缓存下来的数据即可。</p>\n<p>在 <code>i18n/index</code> 中，创建 <code>getLanguage</code> 方法：</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\"><span class=\"hljs-keyword\">import</span> store <span class=\"hljs-keyword\">from</span> <span class=\"hljs-string\">&#x27;@/store&#x27;</span><br><span class=\"hljs-comment\">/**</span><br><span class=\"hljs-comment\"> * 返回当前 lang</span><br><span class=\"hljs-comment\"> */</span><br><span class=\"hljs-keyword\">function</span> <span class=\"hljs-title function_\">getLanguage</span>(<span class=\"hljs-params\"></span>) &#123;<br>  <span class=\"hljs-keyword\">return</span> store &amp;&amp; store.<span class=\"hljs-property\">getters</span> &amp;&amp; store.<span class=\"hljs-property\">getters</span>.<span class=\"hljs-property\">language</span><br>&#125;<br></code></pre></td></tr></table></figure>\n\n<p>修改 <code>createI18n</code> 的 <code>locale</code> 为 <code>getLanguage()</code> </p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\"><span class=\"hljs-keyword\">const</span> i18n = <span class=\"hljs-title function_\">createI18n</span>(&#123;<br>  ...<br>  <span class=\"hljs-attr\">locale</span>: <span class=\"hljs-title function_\">getLanguage</span>()<br>&#125;)<br></code></pre></td></tr></table></figure>\n\n<h2 id=\"国际化方案总结\"><a href=\"#国际化方案总结\" class=\"headerlink\" title=\"国际化方案总结\"></a>国际化方案总结</h2><p>国际化是前端项目中的一个非常常见的功能，那么在前端项目中实现国际化主要依靠的就是 <code>vue-i18n</code> 这个第三方的包。</p>\n<p>关于国际化的实现原理大家可以参照 <strong>国际化实现原理</strong> 这一小节，这里我们就不再赘述了。</p>\n<p>而  <code>i18n</code> 的使用，整体来说就分为这么四步：</p>\n<ol>\n<li>创建 <code>messages</code> 数据源</li>\n<li>创建 <code>locale</code> 语言变量</li>\n<li>初始化 <code>i18n</code> 实例</li>\n<li>注册 <code>i18n</code> 实例</li>\n</ol>\n<p>核心的内容其实就是 数据源的部分，但是大家需要注意，如果你的项目中使用了 <strong>第三方组件库</strong> ，那么不要忘记 <strong>第三方组件库的数据源</strong> 需要 <strong>单独</strong> 进行处理！</p>\n<h1 id=\"动态换肤原理分析\"><a href=\"#动态换肤原理分析\" class=\"headerlink\" title=\"动态换肤原理分析\"></a>动态换肤原理分析</h1><p>想要实现 <strong>动态换肤</strong> 的一个前置条件就是：<strong>色值不可以写死！</strong></p>\n<p>首先我们先来说一下动态换肤的实现方式。</p>\n<p>在 <code>scss</code> 中，我们可以通过 <code>$变量名:变量值</code> 的方式定义 <code>css 变量</code> ，然后通过该 <code>css</code> 来去指定某一块 <code>DOM</code> 对应的颜色。</p>\n<p>那么大家可以想一下，如果我此时改变了该 <code>css</code> 变量的值，那么对应的 <code>DOM</code> 颜色是不是也会同步发生变化。</p>\n<p>当大量的 <code>DOM</code> 都依赖这个 <code>css 变量</code> 设置颜色时，我们是不是只需要改变这个 <code>css 变量</code> ，那么所有 <code>DOM</code> 的颜色是不是都会发生变化，所谓的 <strong>动态换肤</strong> 是不是就可以实现了！</p>\n<p>这个就是 <strong>动态换肤</strong> 的实现原理!</p>\n<p>实现换肤和主题大致有两种方案:</p>\n<ol>\n<li>使用原生支持的 css var</li>\n<li>通过一些手段覆盖 element plus 样式</li>\n</ol>\n<p>我们先看来看看 css var 的实现吧。</p>\n<h2 id=\"css变量\"><a href=\"#css变量\" class=\"headerlink\" title=\"css变量\"></a>css变量</h2><blockquote>\n<p><a href=\"https://developer.mozilla.org/zh-CN/docs/Web/CSS/:root\">https://developer.mozilla.org/zh-CN/docs/Web/CSS/:root</a></p>\n</blockquote>\n<p>变量 与 color、font-size 等正式属性没有什么不同，只是没有默认含义。</p>\n<p>所以 CSS 变量（CSS variable）又叫做”CSS 自定义属性”（CSS custom properties）。因为变量与自定义的 CSS 属性其实是一回事。</p>\n<p>变量可以分为</p>\n<ul>\n<li>全局变量</li>\n<li>局部变量</li>\n</ul>\n<p><strong>全局变量</strong><br>通过 <code>:root</code> 去定义，其他所有的元素都可以通过 <code>var(--xxx)</code> 的形式去使用<code>全局变量</code>，我们来看下面这个例子:</p>\n<blockquote>\n<p>var()函数还可以使用第二个参数，表示变量的默认值。如果该变量不存在，就会使用这个默认值。</p>\n</blockquote>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\">&lt;style&gt;<br>  :root &#123;<br>    --<span class=\"hljs-attr\">color</span>: skyblue;<br>  &#125;<br><br>  .<span class=\"hljs-property\">use</span>-<span class=\"hljs-variable language_\">global</span> &#123;<br>    <span class=\"hljs-attr\">color</span>: <span class=\"hljs-title function_\">var</span>(--color)<br>  &#125;<br>&lt;/style&gt;<br><br><span class=\"hljs-comment\">// body</span><br><span class=\"language-xml\"><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">div</span> <span class=\"hljs-attr\">class</span>=<span class=\"hljs-string\">&quot;use-global&quot;</span>&gt;</span>使用了全局变量<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">div</span>&gt;</span></span><br></code></pre></td></tr></table></figure>\n<p><strong>:root</strong></p>\n<blockquote>\n<p>:root 这个 CSS 伪类匹配文档树的根元素。对于 HTML 来说，:root 表示 <html> 元素，除了优先级更高之外，与 html 选择器相同。</p>\n</blockquote>\n<p><strong>自定义属性 (–*)：CSS 变量</strong></p>\n<blockquote>\n<p>带有前缀–的属性名，比如–example–name，表示的是带有值的自定义属性，其可以通过 var 函数在全文档范围内复用的。</p>\n</blockquote>\n<p><strong>局部变量</strong></p>\n<p>我们可以在某个选择器下去定义变量，或者在元素的 <code>style</code> 属性上定义变量：</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\"><span class=\"hljs-comment\">// style</span><br>:root &#123;<br>  --<span class=\"hljs-attr\">color</span>: skyblue;<br>&#125;<br><br>.<span class=\"hljs-property\">parent</span> &#123;<br>  --<span class=\"hljs-attr\">color</span>: pink; <span class=\"hljs-comment\">// 优先级更高</span><br>&#125;<br><br>h3 &#123;<br>  <span class=\"hljs-attr\">color</span>: <span class=\"hljs-title function_\">var</span>(--color)<br>&#125;<br><br><span class=\"hljs-comment\">// html</span><br>&lt;div <span class=\"hljs-keyword\">class</span>=<span class=\"hljs-string\">&quot;parent&quot;</span>&gt;<br>  <span class=\"language-xml\"><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">h3</span>&gt;</span>child title<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">h3</span>&gt;</span></span><br>&lt;/div&gt;<br></code></pre></td></tr></table></figure>\n\n<p>这里 <code>h3</code> 标签会显示红色。虽然我们在 <code>:root</code> 上也定义了 <code>--color</code> 变量，但是根据就近原则，<code>h3</code> 会取父级定义的变量。</p>\n<p>我们还可以在 <code>style</code> 属性上定义变量，这里我们定义了一个 <code>--bg</code> 变量，其子元素可以访问到这个变量。</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\">.<span class=\"hljs-property\">parent</span> &#123;<br>  --<span class=\"hljs-attr\">color</span>: pink;<br>&#125;<br><br>h3 &#123;<br>  <span class=\"hljs-attr\">color</span>: <span class=\"hljs-title function_\">var</span>(--color);<br>  background-<span class=\"hljs-attr\">color</span>: <span class=\"hljs-title function_\">var</span>(--bg);<br>&#125;<br><br>&lt;div <span class=\"hljs-keyword\">class</span>=<span class=\"hljs-string\">&quot;parent&quot;</span> style=<span class=\"hljs-string\">&quot;--bg: black;&quot;</span>&gt;<br>  <span class=\"language-xml\"><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">h3</span>&gt;</span>child title<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">h3</span>&gt;</span></span><br>&lt;/div&gt;<br></code></pre></td></tr></table></figure>\n\n<h2 id=\"修改-css-变量\"><a href=\"#修改-css-变量\" class=\"headerlink\" title=\"修改 css 变量\"></a>修改 css 变量</h2><p>这里定义了两个按钮，一个修改全局的（根组件）的变量，一个用来修改特定元素上的定义的变量：</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\">&lt;button <span class=\"hljs-keyword\">class</span>=<span class=\"hljs-string\">&quot;btn&quot;</span>&gt;change root&lt;/button&gt;<br><span class=\"language-xml\"><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">button</span> <span class=\"hljs-attr\">class</span>=<span class=\"hljs-string\">&quot;variable&quot;</span>&gt;</span>change local variable<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">button</span>&gt;</span></span><br></code></pre></td></tr></table></figure>\n\n<p><strong>修改全局变量</strong></p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\"><span class=\"hljs-keyword\">const</span> btn = <span class=\"hljs-variable language_\">document</span>.<span class=\"hljs-title function_\">querySelector</span>(<span class=\"hljs-string\">&#x27;.btn&#x27;</span>)<br><br>btn.<span class=\"hljs-title function_\">addEventListener</span>(<span class=\"hljs-string\">&#x27;click&#x27;</span>, <span class=\"hljs-function\">() =&gt;</span> &#123;<br>  <span class=\"hljs-keyword\">const</span> html = <span class=\"hljs-variable language_\">document</span>.<span class=\"hljs-property\">documentElement</span><br><br>  html.<span class=\"hljs-property\">style</span>.<span class=\"hljs-title function_\">setProperty</span>(<span class=\"hljs-string\">&#x27;--color&#x27;</span>, <span class=\"hljs-string\">&#x27;red&#x27;</span>)<br>&#125;)<br></code></pre></td></tr></table></figure>\n\n<p><strong>修改局部变量</strong></p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\"><span class=\"hljs-keyword\">const</span> variableBtn = <span class=\"hljs-variable language_\">document</span>.<span class=\"hljs-title function_\">querySelector</span>(<span class=\"hljs-string\">&#x27;.variable&#x27;</span>)<br><br>variableBtn.<span class=\"hljs-title function_\">addEventListener</span>(<span class=\"hljs-string\">&#x27;click&#x27;</span>, <span class=\"hljs-function\">() =&gt;</span> &#123;<br>  <span class=\"hljs-keyword\">const</span> parent = <span class=\"hljs-variable language_\">document</span>.<span class=\"hljs-title function_\">querySelector</span>(<span class=\"hljs-string\">&#x27;.parent&#x27;</span>)<br><br>  parent.<span class=\"hljs-property\">style</span>.<span class=\"hljs-title function_\">setProperty</span>(<span class=\"hljs-string\">&#x27;--color&#x27;</span>, <span class=\"hljs-string\">&#x27;green&#x27;</span>)<br>&#125;)<br></code></pre></td></tr></table></figure>\n\n<h1 id=\"暗黑模式原理分析\"><a href=\"#暗黑模式原理分析\" class=\"headerlink\" title=\"暗黑模式原理分析\"></a>暗黑模式原理分析</h1><blockquote>\n<p>prefers-color-scheme</p>\n<p>prefers-color-scheme CSS 媒体特性: 用于检测用户是否有将系统的主题色设置为亮色或者暗色。</p>\n</blockquote>\n<h2 id=\"主题色实现原理\"><a href=\"#主题色实现原理\" class=\"headerlink\" title=\"主题色实现原理\"></a>主题色实现原理</h2><p>通过 <code>媒体查询</code> 去监听系统主题色的变化。</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\"><span class=\"hljs-comment\">// style</span><br>@media (prefers-color-<span class=\"hljs-attr\">scheme</span>: dark) &#123;<br>  .<span class=\"hljs-property\">day</span>.<span class=\"hljs-property\">dark</span>-scheme   &#123; <span class=\"hljs-attr\">background</span>:  #<span class=\"hljs-number\">333</span>; <span class=\"hljs-attr\">color</span>: white; &#125;<br>  .<span class=\"hljs-property\">night</span>.<span class=\"hljs-property\">dark</span>-scheme &#123; <span class=\"hljs-attr\">background</span>: black; <span class=\"hljs-attr\">color</span>:  red; &#125;<br>&#125;<br><br>@media (prefers-color-<span class=\"hljs-attr\">scheme</span>: light) &#123;<br>  .<span class=\"hljs-property\">day</span>.<span class=\"hljs-property\">light</span>-scheme   &#123; <span class=\"hljs-attr\">background</span>: skyblue; <span class=\"hljs-attr\">color</span>:  #<span class=\"hljs-number\">333</span>; &#125;<br>  .<span class=\"hljs-property\">night</span>.<span class=\"hljs-property\">light</span>-scheme &#123; <span class=\"hljs-attr\">background</span>:  pink; <span class=\"hljs-attr\">color</span>: #<span class=\"hljs-number\">333</span>; &#125;<br>&#125;<br><br>.<span class=\"hljs-property\">day</span>, .<span class=\"hljs-property\">night</span> &#123;<br>  <span class=\"hljs-attr\">display</span>: inline-block;<br>  <span class=\"hljs-attr\">padding</span>: 1em;<br>  <span class=\"hljs-attr\">width</span>: 7em;<br>  <span class=\"hljs-attr\">height</span>: 7em;<br>  vertical-<span class=\"hljs-attr\">align</span>: middle;<br>&#125;<br><br><span class=\"hljs-comment\">// html</span><br>&lt;div <span class=\"hljs-keyword\">class</span>=<span class=\"hljs-string\">&quot;day light-scheme&quot;</span>&gt;<span class=\"hljs-title class_\">Day</span> (changes <span class=\"hljs-keyword\">in</span> light scheme)&lt;/div&gt;<br><span class=\"language-xml\"><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">div</span> <span class=\"hljs-attr\">class</span>=<span class=\"hljs-string\">&quot;day dark-scheme&quot;</span>&gt;</span>Day (changes in dark scheme)<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">div</span>&gt;</span></span> &lt;br&gt;<br><br><span class=\"language-xml\"><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">div</span> <span class=\"hljs-attr\">class</span>=<span class=\"hljs-string\">&quot;night light-scheme&quot;</span>&gt;</span>Night (changes in light scheme)<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">div</span>&gt;</span></span><br><span class=\"language-xml\"><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">div</span> <span class=\"hljs-attr\">class</span>=<span class=\"hljs-string\">&quot;night dark-scheme&quot;</span>&gt;</span>Night (changes in dark scheme)<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">div</span>&gt;</span></span><br></code></pre></td></tr></table></figure>\n\n<p>现在，我们可以去切换系统的主题色，就会发现页面上的颜色跟着变化了，这是因为我们通过 <code>@media</code> 监听 <code>prefers-color-scheme</code> 起作用了。</p>\n<h2 id=\"window-matchMedia\"><a href=\"#window-matchMedia\" class=\"headerlink\" title=\"window.matchMedia\"></a>window.matchMedia</h2><p>虽然我们通过 css @media 能够应对系统的主题色切换，但是我们如何在 <code>js</code> 中去监听呢？</p>\n<p>答案是通过 <code>window.matchMedia</code> 方法：</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\"><span class=\"hljs-comment\">// 如果匹配成功，scheme.matches === true</span><br><span class=\"hljs-comment\">// 也就是说，如果我们的系统是暗黑色，那么这个 matches 就是true，否则是 false</span><br><span class=\"hljs-keyword\">const</span> scheme = <span class=\"hljs-variable language_\">window</span>.<span class=\"hljs-title function_\">matchMedia</span>(<span class=\"hljs-string\">&#x27;(prefers-color-scheme: dark)&#x27;</span>)<br><br>scheme.<span class=\"hljs-title function_\">addEventListener</span>(<span class=\"hljs-string\">&#x27;change&#x27;</span>, <span class=\"hljs-function\"><span class=\"hljs-params\">e</span> =&gt;</span> &#123;<br>  <span class=\"hljs-keyword\">if</span> (e.<span class=\"hljs-property\">matches</span>) &#123;<br>    <span class=\"hljs-comment\">// 暗黑色</span><br>  &#125; <span class=\"hljs-keyword\">else</span> &#123;<br>    <span class=\"hljs-comment\">// 亮色</span><br>  &#125;<br>&#125;)<br></code></pre></td></tr></table></figure>\n\n<h2 id=\"修改主题色\"><a href=\"#修改主题色\" class=\"headerlink\" title=\"修改主题色\"></a>修改主题色</h2><p>到此，我们知道了主题色的实现原理，我们如何在项目里去实现主题色的切换呢？</p>\n<p>我们来看一个小例子</p>\n<p>首先，我们先定义好 <code>全局变量</code>，里面包含了一些 <code>亮色模式</code> 下的变量：</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\">:root &#123;<br>  --<span class=\"hljs-attr\">color</span>: #<span class=\"hljs-number\">333</span>;<br>  --background-<span class=\"hljs-attr\">color</span>: pink;<br>&#125;<br><br>&lt;h1 style=<span class=\"hljs-string\">&quot;background-color: var(--background-color); color: var(--color)&quot;</span>&gt;<br>  我是一个标题。！！！<br>&lt;/h1&gt;<br><br><span class=\"language-xml\"><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">button</span> <span class=\"hljs-attr\">class</span>=<span class=\"hljs-string\">&quot;dark-btn&quot;</span>&gt;</span>dark mode<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">button</span>&gt;</span></span><br></code></pre></td></tr></table></figure>\n\n<p>在页面初始时，我们的背景色是粉色，颜色是浅黑色。</p>\n<p>现在我们创建一个按钮，来修改主题颜色，这个之前实现过了很简单对吧。</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\"><span class=\"hljs-keyword\">const</span> darkBtn = <span class=\"hljs-variable language_\">document</span>.<span class=\"hljs-title function_\">querySelector</span>(<span class=\"hljs-string\">&#x27;.dark-btn&#x27;</span>)<br><br>darkBtn.<span class=\"hljs-title function_\">addEventListener</span>(<span class=\"hljs-string\">&#x27;click&#x27;</span>, <span class=\"hljs-function\">() =&gt;</span> &#123;<br>  <span class=\"hljs-comment\">// 修改变量</span><br>  <span class=\"hljs-variable language_\">document</span>.<span class=\"hljs-property\">documentElement</span>.<span class=\"hljs-property\">style</span>.<span class=\"hljs-title function_\">setProperty</span>(<span class=\"hljs-string\">&#x27;--color&#x27;</span>, <span class=\"hljs-string\">&#x27;#fff&#x27;</span>)<br>  <span class=\"hljs-variable language_\">document</span>.<span class=\"hljs-property\">documentElement</span>.<span class=\"hljs-property\">style</span>.<span class=\"hljs-title function_\">setProperty</span>(<span class=\"hljs-string\">&#x27;--background-color&#x27;</span>, <span class=\"hljs-string\">&#x27;#000&#x27;</span>)<br>&#125;)<br></code></pre></td></tr></table></figure>\n\n<p>好无疑问这样是可以实现的，但是，如果变量多起来了，几十上百个，我们也要一个个去修改吗？</p>\n<p>既然我们的变量都定义在根元素上，那么我们可以采取 <strong>属性覆盖</strong> 的形式。</p>\n<p>我们定义一个 <code>[data-theme=&quot;dark&quot;]</code> 样式表，专门用来处理 <code>暗黑模式</code> 下的变量，这里是黑色背景白色字体。</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\">[data-theme=<span class=\"hljs-string\">&quot;dark&quot;</span>] &#123;<br>  --<span class=\"hljs-attr\">color</span>: #fff;<br>  --background-<span class=\"hljs-attr\">color</span>: #<span class=\"hljs-number\">000</span>;<br>&#125;<br></code></pre></td></tr></table></figure>\n\n<p>或者属性选择器：</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\"><span class=\"hljs-comment\">/* 浅色模式 */</span><br>html[data-theme=<span class=\"hljs-string\">&quot;light&quot;</span>]:root &#123;<br>  --body-<span class=\"hljs-attr\">background</span>: #efefef;<br>  --text-<span class=\"hljs-attr\">color</span>: #<span class=\"hljs-number\">333</span>;<br>&#125;<br><br><span class=\"hljs-comment\">/* 深色模式 */</span><br>html[data-theme=<span class=\"hljs-string\">&quot;dark&quot;</span>]:root &#123;<br>  --body-<span class=\"hljs-attr\">background</span>: #<span class=\"hljs-number\">000</span>;<br>  --text-<span class=\"hljs-attr\">color</span>: #ededed;<br>&#125;<br></code></pre></td></tr></table></figure>\n\n<p>一开始，这个样式表并不会生效，因为根标签上根本没有 <code>data-theme=&quot;dark&quot;</code> 属性，我们通过按钮来修改：</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\">darkBtn.<span class=\"hljs-title function_\">addEventListener</span>(<span class=\"hljs-string\">&#x27;click&#x27;</span>, <span class=\"hljs-function\">() =&gt;</span> &#123;<br>  <span class=\"hljs-variable language_\">document</span>.<span class=\"hljs-property\">documentElement</span>.<span class=\"hljs-title function_\">setAttribute</span>(<span class=\"hljs-string\">&#x27;data-theme&#x27;</span>, <span class=\"hljs-string\">&#x27;dark&#x27;</span>)<br>&#125;)<br></code></pre></td></tr></table></figure>\n\n<p>我们给根标签设置了 <code>data-theme=&quot;dark&quot;</code> 属性，同时内部定了暗黑相关的变量，这时，<code>data-theme=&quot;dark&quot;</code> 内部的变量就会覆盖 <code>:root</code> 中的变量了，从而达到切换主题色的效果。</p>\n<p>同时，我们需要根据系统的主题色，来设置项目的主题色，这里就要用到 <code>window.matchMedia</code> 方法了。</p>\n<p>如果在 <code>Vue</code> 项目中，我们可以这样去实现:</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\"><span class=\"hljs-keyword\">const</span> theme = <span class=\"hljs-title function_\">computed</span>(<span class=\"hljs-function\">() =&gt;</span> store.<span class=\"hljs-property\">state</span>.<span class=\"hljs-property\">settings</span>.<span class=\"hljs-property\">theme</span>);<br><br><span class=\"hljs-comment\">// 查看当前是否是 暗黑模式</span><br><span class=\"hljs-keyword\">const</span> mediaQueryListDark = <span class=\"hljs-variable language_\">window</span>.<span class=\"hljs-title function_\">matchMedia</span>(<span class=\"hljs-string\">&#x27;(prefers-color-scheme: dark)&#x27;</span>);<br><br><span class=\"hljs-keyword\">const</span> <span class=\"hljs-title function_\">changeTheme</span> = (<span class=\"hljs-params\">theme</span>) =&gt; &#123;<br>  <span class=\"hljs-comment\">// 批量覆盖全局的变量</span><br>\t<span class=\"hljs-variable language_\">document</span>.<span class=\"hljs-property\">documentElement</span>.<span class=\"hljs-title function_\">setAttribute</span>(<span class=\"hljs-string\">&#x27;data-theme&#x27;</span>, theme);<br>&#125;;<br><br><span class=\"hljs-keyword\">const</span> <span class=\"hljs-title function_\">handleColorSchemeChange</span> = evt =&gt; &#123;<br>  <span class=\"hljs-keyword\">if</span> (evt.<span class=\"hljs-property\">matches</span>) &#123;<br>    <span class=\"hljs-title function_\">changeTheme</span>(<span class=\"hljs-string\">&#x27;dark&#x27;</span>);<br>  &#125; <span class=\"hljs-keyword\">else</span> &#123;<br>    <span class=\"hljs-title function_\">changeTheme</span>(<span class=\"hljs-string\">&#x27;light&#x27;</span>);<br>  &#125;<br>&#125;;<br><br><span class=\"hljs-title function_\">watchEffect</span>(<span class=\"hljs-function\">() =&gt;</span> &#123;<br>  <span class=\"hljs-keyword\">if</span> (theme.<span class=\"hljs-property\">value</span> === <span class=\"hljs-string\">&#x27;Follow System&#x27;</span>) &#123;<br>    <span class=\"hljs-comment\">// 初始值：跟随系统设置</span><br>    <span class=\"hljs-title function_\">handleColorSchemeChange</span>(mediaQueryListDark);<br><br>    <span class=\"hljs-comment\">// 监听系统主题的变化</span><br>    mediaQueryListDark.<span class=\"hljs-title function_\">addEventListener</span>(<span class=\"hljs-string\">&#x27;change&#x27;</span>, handleColorSchemeChange);<br>  &#125; <span class=\"hljs-keyword\">else</span> <span class=\"hljs-keyword\">if</span> (theme.<span class=\"hljs-property\">value</span>) &#123;<br>    <span class=\"hljs-title function_\">changeTheme</span>(theme.<span class=\"hljs-property\">value</span>.<span class=\"hljs-title function_\">toLowerCase</span>());<br><br>    <span class=\"hljs-comment\">// 如果不是跟随系统设置主题了，用户自己设置的主题色，我们就不需要监听系统的主题色切换了</span><br>    mediaQueryListDark.<span class=\"hljs-title function_\">removeEventListener</span>(<span class=\"hljs-string\">&#x27;change&#x27;</span>, handleColorSchemeChange);<br>  &#125;<br>&#125;);<br></code></pre></td></tr></table></figure>\n\n<h2 id=\"总结\"><a href=\"#总结\" class=\"headerlink\" title=\"总结\"></a>总结</h2><p>到这里，我们花了大量的时间和实例对换肤和主题的原理进行了研究，那么接下来就要进入正式的项目开发环节了。</p>\n<h1 id=\"官方换肤方案\"><a href=\"#官方换肤方案\" class=\"headerlink\" title=\"官方换肤方案\"></a>官方换肤方案</h1><blockquote>\n<p>官方样式路径：/node_modules/element-plus/theme-chalk/src/common/var.scss</p>\n</blockquote>\n<p>定义自己的 scss 文件，然后在 main.ts 导入。</p>\n<figure class=\"highlight css\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs css\">$<span class=\"hljs-attr\">--colors</span>: (<br>  <span class=\"hljs-string\">&quot;primary&quot;</span>: (<br>    <span class=\"hljs-string\">&quot;base&quot;</span>: pink,<br>  ),<br>  <span class=\"hljs-string\">&quot;success&quot;</span>: (<br>    <span class=\"hljs-string\">&quot;base&quot;</span>: blue,<br>  ),<br>  <span class=\"hljs-string\">&quot;warning&quot;</span>: (<br>    <span class=\"hljs-string\">&quot;base&quot;</span>: <span class=\"hljs-number\">#f2711c</span>,<br>  ),<br>  <span class=\"hljs-string\">&quot;danger&quot;</span>: (<br>    <span class=\"hljs-string\">&quot;base&quot;</span>: <span class=\"hljs-number\">#db2828</span>,<br>  ),<br>  <span class=\"hljs-string\">&quot;error&quot;</span>: (<br>    <span class=\"hljs-string\">&quot;base&quot;</span>: <span class=\"hljs-number\">#db2828</span>,<br>  ),<br>  <span class=\"hljs-string\">&quot;info&quot;</span>: (<br>    <span class=\"hljs-string\">&quot;base&quot;</span>: <span class=\"hljs-number\">#42b8dd</span>,<br>  ),<br>);<br><br><span class=\"hljs-keyword\">@forward</span> <span class=\"hljs-string\">&#x27;element-plus/theme-chalk/src/common/var.scss&#x27;</span> with (<br>  $<span class=\"hljs-attribute\">colors</span>: $--colors,<br>);<br><br><span class=\"hljs-comment\">/* 导入所有的样式变量 */</span><br><span class=\"hljs-keyword\">@use</span> <span class=\"hljs-string\">&quot;element-plus/theme-chalk/src/index.scss&quot;</span> as *;<br></code></pre></td></tr></table></figure>\n\n<p>修改 <code>main.ts</code></p>\n<figure class=\"highlight css\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs css\">// 注释原导入的 element-plus 样式<br>// import &#x27;element-plus/dist/index<span class=\"hljs-selector-class\">.css</span>&#x27;<br><br><br>// 导入我们自己的定义的样式<br>import &#x27;@/styles/cover-element-plus.scss&#x27;<br></code></pre></td></tr></table></figure>\n\n<h2 id=\"通过-CSS-变量设置\"><a href=\"#通过-CSS-变量设置\" class=\"headerlink\" title=\"通过 CSS 变量设置\"></a>通过 CSS 变量设置</h2><p>如果不通过上面那种方案，我们还可以定义全局的变量，来覆盖官方的样式。</p>\n<p>在自己的样式文件中写入需要覆盖的样式变量：</p>\n<figure class=\"highlight css\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs css\"><span class=\"hljs-selector-pseudo\">:root</span> &#123;<br>  <span class=\"hljs-attr\">--el-color-primary</span>: green;<br>&#125;<br></code></pre></td></tr></table></figure>\n\n<p>如果你只想自定义一个特定的组件，只需为某些组件单独添加内联样式。</p>\n<figure class=\"highlight css\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs css\">&lt;el-tag style=&quot;<span class=\"hljs-attr\">--el-tag-bg-color</span>: red<span class=\"hljs-string\">&quot;&gt;Tag&lt;/el-tag&gt;</span><br></code></pre></td></tr></table></figure>\n\n<p>出于性能原因，更加推荐你在类名下添加自定义 css 变量，而不是在全局的 :root 下。</p>\n<figure class=\"highlight css\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs css\"><span class=\"hljs-selector-class\">.custom-class</span> &#123;<br>  <span class=\"hljs-attr\">--el-tag-bg-color</span>: red;<br>&#125;<br></code></pre></td></tr></table></figure>\n\n<p>如果您想要通过 js 控制 css 变量，可以这样做：</p>\n<figure class=\"highlight css\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs css\">// document<span class=\"hljs-selector-class\">.documentElement</span> 是全局变量时<br>const el = document<span class=\"hljs-selector-class\">.documentElement</span><br>// const el = document<span class=\"hljs-selector-class\">.getElementById</span>(&#x27;xxx&#x27;)<br><br>// 获取 css 变量<br>getComputedStyle(el)<span class=\"hljs-selector-class\">.getPropertyValue</span>(`<span class=\"hljs-attr\">--el-color-primary</span>`)<br><br>// 设置 css 变量<br>el<span class=\"hljs-selector-class\">.style</span><span class=\"hljs-selector-class\">.setProperty</span>(&#x27;<span class=\"hljs-attr\">--el-color-primary</span>&#x27;, &#x27;red&#x27;)<br></code></pre></td></tr></table></figure>\n\n<h2 id=\"总结。\"><a href=\"#总结。\" class=\"headerlink\" title=\"总结。\"></a>总结。</h2><p>相当于我们重新定义了变量，覆盖了官方自己定义的变量，如果我们项目只需要一种颜色，那么这种方案是可行的，但是我们项目需要支持用户选择主题来替换，那么这种方案就不适用了。</p>\n<p>那么我来用另一种方案来实现吧。</p>\n<h1 id=\"换肤方案落地\"><a href=\"#换肤方案落地\" class=\"headerlink\" title=\"换肤方案落地\"></a>换肤方案落地</h1><p>在我们的项目中想要实现动态换肤，需要同时处理两个方面的内容：</p>\n<ol>\n<li><code>element-plus</code> 主题</li>\n<li>非 <code>element-plus</code> 主题</li>\n</ol>\n<p>明确好了原理之后，接下来我们就来理一下咱们的实现思路。</p>\n<p>从原理中我们可以得到以下两个关键信息：</p>\n<ol>\n<li>动态换肤的关键是修改 <code>css 变量</code> 的值</li>\n<li>换肤需要同时兼顾<ol>\n<li><code>element-plus</code> </li>\n<li>非 <code>element-plus</code> </li>\n</ol>\n</li>\n</ol>\n<p>那么根据以上关键信息，我们就可以得出对应的实现方案:</p>\n<ol>\n<li>创建一个组件 <code>ThemeSelect</code> 用来处理修改之后的 <code>css 变量</code> 的值</li>\n<li>根据新值修改 <code>element-plus</code>  主题色</li>\n<li>根据新值修改非 <code>element-plus</code>  主题色</li>\n</ol>\n<h2 id=\"创建-ThemeSelect-组件\"><a href=\"#创建-ThemeSelect-组件\" class=\"headerlink\" title=\"创建 ThemeSelect 组件\"></a>创建 ThemeSelect 组件</h2><p><code>ThemeSelect</code> 组件将由两部分组成：</p>\n<ol>\n<li><code>navbar</code> 中的展示图标</li>\n<li>选择颜色的弹出层</li>\n</ol>\n<p>这是效果图：</p>\n<p><img src=\"/img/theme-select.png\" alt=\"\"></p>\n<p><strong>创建 <code>components/ThemeSelect/index</code> 组件</strong></p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\">&lt;template&gt;<br>  &lt;!-- 主题图标 v-bind：<span class=\"hljs-attr\">https</span>:<span class=\"hljs-comment\">//v3.cn.vuejs.org/api/instance-properties.html#attrs --&gt;</span><br>  <span class=\"language-xml\"><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">el-dropdown</span></span></span><br><span class=\"hljs-tag\"><span class=\"language-xml\">    <span class=\"hljs-attr\">v-bind</span>=<span class=\"hljs-string\">&quot;$attrs&quot;</span></span></span><br><span class=\"hljs-tag\"><span class=\"language-xml\">    <span class=\"hljs-attr\">trigger</span>=<span class=\"hljs-string\">&quot;click&quot;</span></span></span><br><span class=\"hljs-tag\"><span class=\"language-xml\">    <span class=\"hljs-attr\">class</span>=<span class=\"hljs-string\">&quot;theme&quot;</span></span></span><br><span class=\"hljs-tag\"><span class=\"language-xml\">    @<span class=\"hljs-attr\">command</span>=<span class=\"hljs-string\">&quot;handleSetTheme&quot;</span></span></span><br><span class=\"hljs-tag\"><span class=\"language-xml\">  &gt;</span></span><br><span class=\"language-xml\">    <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">div</span>&gt;</span></span><br><span class=\"language-xml\">      <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">el-tooltip</span> <span class=\"hljs-attr\">:content</span>=<span class=\"hljs-string\">&quot;$t(&#x27;msg.navBar.themeChange&#x27;)&quot;</span>&gt;</span></span><br><span class=\"language-xml\">        <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">svg-icon</span> <span class=\"hljs-attr\">icon</span>=<span class=\"hljs-string\">&quot;change-theme&quot;</span> /&gt;</span></span><br><span class=\"language-xml\">      <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">el-tooltip</span>&gt;</span></span><br><span class=\"language-xml\">    <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">div</span>&gt;</span></span><br><span class=\"language-xml\">    <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">template</span> #<span class=\"hljs-attr\">dropdown</span>&gt;</span></span><br><span class=\"language-xml\">      <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">el-dropdown-menu</span>&gt;</span></span><br><span class=\"language-xml\">        <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">el-dropdown-item</span> <span class=\"hljs-attr\">command</span>=<span class=\"hljs-string\">&quot;color&quot;</span>&gt;</span></span><br><span class=\"language-xml\">          &#123;&#123; $t(&#x27;msg.theme.themeColorChange&#x27;) &#125;&#125;</span><br><span class=\"language-xml\">        <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">el-dropdown-item</span>&gt;</span></span><br><span class=\"language-xml\">      <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">el-dropdown-menu</span>&gt;</span></span><br><span class=\"language-xml\">    <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">template</span>&gt;</span></span><br><span class=\"language-xml\">  <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">el-dropdown</span>&gt;</span></span><br><br>  &lt;!-- 展示弹出层 --&gt;<br>  <span class=\"language-xml\"><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">div</span>&gt;</span></span><br><span class=\"language-xml\">    ...</span><br><span class=\"language-xml\">  <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">div</span>&gt;</span></span><br>&lt;/template&gt;<br><br><span class=\"language-xml\"><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">script</span> <span class=\"hljs-attr\">setup</span>&gt;</span><span class=\"language-javascript\"></span></span><br><span class=\"language-javascript\"><span class=\"language-xml\"><span class=\"hljs-keyword\">const</span> <span class=\"hljs-title function_\">handleSetTheme</span> = command =&gt; &#123;&#125;</span></span><br><span class=\"language-javascript\"><span class=\"language-xml\"></span><span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">script</span>&gt;</span></span><br><br><span class=\"language-xml\"><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">style</span> <span class=\"hljs-attr\">lang</span>=<span class=\"hljs-string\">&quot;scss&quot;</span> <span class=\"hljs-attr\">scoped</span>&gt;</span><span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">style</span>&gt;</span></span><br></code></pre></td></tr></table></figure>\n\n<p>在 <code>layout/components/navbar</code> 中进行引用</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\">&lt;div <span class=\"hljs-keyword\">class</span>=<span class=\"hljs-string\">&quot;right-menu&quot;</span>&gt;<br>  <span class=\"language-xml\"><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">theme-picker</span> <span class=\"hljs-attr\">class</span>=<span class=\"hljs-string\">&quot;right-menu-item hover-effect&quot;</span>&gt;</span><span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">theme-picker</span>&gt;</span></span><br>&lt;/div&gt;<br><br>... <br><br><span class=\"hljs-keyword\">import</span> <span class=\"hljs-title class_\">ThemePicker</span> <span class=\"hljs-keyword\">from</span> <span class=\"hljs-string\">&#x27;@/components/ThemeSelect/index&#x27;</span><br></code></pre></td></tr></table></figure>\n\n<p><strong>创建 <code>SelectColor</code> 组件</strong></p>\n<p>在有了 <code>ThemeSelect</code> 之后，接下来我们来去处理颜色选择的组件 <code>SelectColor</code>，在这里我们会用到 <code>element</code> 中的 <code>el-color-picker</code> 组件</p>\n<p>对于 <code>SelectColor</code> 的处理，我们需要分成两步进行：</p>\n<ol>\n<li>完成 <code>SelectColor</code> 弹窗展示的双向数据绑定</li>\n<li>把选中的色值进行本地缓存</li>\n</ol>\n<p>那么下面咱们先来看第一步：<strong>完成 <code>SelectColor</code> 弹窗展示的双向数据绑定</strong></p>\n<p>创建 <code>components/ThemePicker/components/SelectColor.vue</code> </p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\">&lt;template&gt;<br>  <span class=\"language-xml\"><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">el-dialog</span> <span class=\"hljs-attr\">title</span>=<span class=\"hljs-string\">&quot;提示&quot;</span> <span class=\"hljs-attr\">:model-value</span>=<span class=\"hljs-string\">&quot;modelValue&quot;</span> @<span class=\"hljs-attr\">close</span>=<span class=\"hljs-string\">&quot;closed&quot;</span> <span class=\"hljs-attr\">width</span>=<span class=\"hljs-string\">&quot;22%&quot;</span>&gt;</span></span><br><span class=\"language-xml\">    <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">div</span> <span class=\"hljs-attr\">class</span>=<span class=\"hljs-string\">&quot;center&quot;</span>&gt;</span></span><br><span class=\"language-xml\">      <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">p</span> <span class=\"hljs-attr\">class</span>=<span class=\"hljs-string\">&quot;title&quot;</span>&gt;</span>&#123;&#123; $t(&#x27;msg.theme.themeColorChange&#x27;) &#125;&#125;<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">p</span>&gt;</span></span><br><span class=\"language-xml\">      <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">el-color-picker</span></span></span><br><span class=\"hljs-tag\"><span class=\"language-xml\">        <span class=\"hljs-attr\">v-model</span>=<span class=\"hljs-string\">&quot;mColor&quot;</span></span></span><br><span class=\"hljs-tag\"><span class=\"language-xml\">        <span class=\"hljs-attr\">:predefine</span>=<span class=\"hljs-string\">&quot;predefineColors&quot;</span></span></span><br><span class=\"hljs-tag\"><span class=\"language-xml\">      &gt;</span><span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">el-color-picker</span>&gt;</span></span><br><span class=\"language-xml\">    <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">div</span>&gt;</span></span><br><span class=\"language-xml\">    <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">template</span> #<span class=\"hljs-attr\">footer</span>&gt;</span></span><br><span class=\"language-xml\">      <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">span</span> <span class=\"hljs-attr\">class</span>=<span class=\"hljs-string\">&quot;dialog-footer&quot;</span>&gt;</span></span><br><span class=\"language-xml\">        <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">el-button</span> @<span class=\"hljs-attr\">click</span>=<span class=\"hljs-string\">&quot;closed&quot;</span>&gt;</span>&#123;&#123; $t(&#x27;msg.universal.cancel&#x27;) &#125;&#125;<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">el-button</span>&gt;</span></span><br><span class=\"language-xml\">        <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">el-button</span> <span class=\"hljs-attr\">type</span>=<span class=\"hljs-string\">&quot;primary&quot;</span> @<span class=\"hljs-attr\">click</span>=<span class=\"hljs-string\">&quot;comfirm&quot;</span>&gt;</span>&#123;&#123;</span><br><span class=\"language-xml\">          $t(&#x27;msg.universal.confirm&#x27;)</span><br><span class=\"language-xml\">        &#125;&#125;<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">el-button</span>&gt;</span></span><br><span class=\"language-xml\">      <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">span</span>&gt;</span></span><br><span class=\"language-xml\">    <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">template</span>&gt;</span></span><br><span class=\"language-xml\">  <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">el-dialog</span>&gt;</span></span><br>&lt;/template&gt;<br><br><span class=\"language-xml\"><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">script</span> <span class=\"hljs-attr\">setup</span>&gt;</span><span class=\"language-javascript\"></span></span><br><span class=\"language-javascript\"><span class=\"language-xml\"><span class=\"hljs-keyword\">import</span> &#123; defineProps, defineEmits, ref &#125; <span class=\"hljs-keyword\">from</span> <span class=\"hljs-string\">&#x27;vue&#x27;</span></span></span><br><span class=\"language-javascript\"><span class=\"language-xml\"><span class=\"hljs-title function_\">defineProps</span>(&#123;</span></span><br><span class=\"language-javascript\"><span class=\"language-xml\">  <span class=\"hljs-attr\">modelValue</span>: &#123;</span></span><br><span class=\"language-javascript\"><span class=\"language-xml\">    <span class=\"hljs-attr\">type</span>: <span class=\"hljs-title class_\">Boolean</span>,</span></span><br><span class=\"language-javascript\"><span class=\"language-xml\">    <span class=\"hljs-attr\">required</span>: <span class=\"hljs-literal\">true</span></span></span><br><span class=\"language-javascript\"><span class=\"language-xml\">  &#125;</span></span><br><span class=\"language-javascript\"><span class=\"language-xml\">&#125;)</span></span><br><span class=\"language-javascript\"><span class=\"language-xml\"><span class=\"hljs-keyword\">const</span> emits = <span class=\"hljs-title function_\">defineEmits</span>([<span class=\"hljs-string\">&#x27;update:modelValue&#x27;</span>])</span></span><br><span class=\"language-javascript\"><span class=\"language-xml\"></span></span><br><span class=\"language-javascript\"><span class=\"language-xml\"><span class=\"hljs-comment\">// 预定义色值</span></span></span><br><span class=\"language-javascript\"><span class=\"language-xml\"><span class=\"hljs-keyword\">const</span> predefineColors = [</span></span><br><span class=\"language-javascript\"><span class=\"language-xml\">  <span class=\"hljs-string\">&#x27;#ff4500&#x27;</span>,</span></span><br><span class=\"language-javascript\"><span class=\"language-xml\">  <span class=\"hljs-string\">&#x27;#ff8c00&#x27;</span>,</span></span><br><span class=\"language-javascript\"><span class=\"language-xml\">  <span class=\"hljs-string\">&#x27;#ffd700&#x27;</span>,</span></span><br><span class=\"language-javascript\"><span class=\"language-xml\">  <span class=\"hljs-string\">&#x27;#90ee90&#x27;</span>,</span></span><br><span class=\"language-javascript\"><span class=\"language-xml\">  <span class=\"hljs-string\">&#x27;#00ced1&#x27;</span>,</span></span><br><span class=\"language-javascript\"><span class=\"language-xml\">  <span class=\"hljs-string\">&#x27;#1e90ff&#x27;</span>,</span></span><br><span class=\"language-javascript\"><span class=\"language-xml\">  <span class=\"hljs-string\">&#x27;#c71585&#x27;</span>,</span></span><br><span class=\"language-javascript\"><span class=\"language-xml\">  <span class=\"hljs-string\">&#x27;rgba(255, 69, 0, 0.68)&#x27;</span>,</span></span><br><span class=\"language-javascript\"><span class=\"language-xml\">  <span class=\"hljs-string\">&#x27;rgb(255, 120, 0)&#x27;</span>,</span></span><br><span class=\"language-javascript\"><span class=\"language-xml\">  <span class=\"hljs-string\">&#x27;hsv(51, 100, 98)&#x27;</span>,</span></span><br><span class=\"language-javascript\"><span class=\"language-xml\">  <span class=\"hljs-string\">&#x27;hsva(120, 40, 94, 0.5)&#x27;</span>,</span></span><br><span class=\"language-javascript\"><span class=\"language-xml\">  <span class=\"hljs-string\">&#x27;hsl(181, 100%, 37%)&#x27;</span>,</span></span><br><span class=\"language-javascript\"><span class=\"language-xml\">  <span class=\"hljs-string\">&#x27;hsla(209, 100%, 56%, 0.73)&#x27;</span>,</span></span><br><span class=\"language-javascript\"><span class=\"language-xml\">  <span class=\"hljs-string\">&#x27;#c7158577&#x27;</span></span></span><br><span class=\"language-javascript\"><span class=\"language-xml\">]</span></span><br><span class=\"language-javascript\"><span class=\"language-xml\"><span class=\"hljs-comment\">// 默认色值</span></span></span><br><span class=\"language-javascript\"><span class=\"language-xml\"><span class=\"hljs-keyword\">const</span> mColor = <span class=\"hljs-title function_\">ref</span>(<span class=\"hljs-string\">&#x27;#00ff00&#x27;</span>)</span></span><br><span class=\"language-javascript\"><span class=\"language-xml\"></span></span><br><span class=\"language-javascript\"><span class=\"language-xml\"><span class=\"hljs-comment\">/**</span></span></span><br><span class=\"hljs-comment\"><span class=\"language-javascript\"><span class=\"language-xml\"> * 关闭</span></span></span><br><span class=\"hljs-comment\"><span class=\"language-javascript\"><span class=\"language-xml\"> */</span></span></span><br><span class=\"language-javascript\"><span class=\"language-xml\"><span class=\"hljs-keyword\">const</span> <span class=\"hljs-title function_\">closed</span> = (<span class=\"hljs-params\"></span>) =&gt; &#123;</span></span><br><span class=\"language-javascript\"><span class=\"language-xml\">  <span class=\"hljs-title function_\">emits</span>(<span class=\"hljs-string\">&#x27;update:modelValue&#x27;</span>, <span class=\"hljs-literal\">false</span>)</span></span><br><span class=\"language-javascript\"><span class=\"language-xml\">&#125;</span></span><br><span class=\"language-javascript\"><span class=\"language-xml\"><span class=\"hljs-comment\">/**</span></span></span><br><span class=\"hljs-comment\"><span class=\"language-javascript\"><span class=\"language-xml\"> * 确定</span></span></span><br><span class=\"hljs-comment\"><span class=\"language-javascript\"><span class=\"language-xml\"> * 1. 修改主题色</span></span></span><br><span class=\"hljs-comment\"><span class=\"language-javascript\"><span class=\"language-xml\"> * 2. 保存最新的主题色</span></span></span><br><span class=\"hljs-comment\"><span class=\"language-javascript\"><span class=\"language-xml\"> * 3. 关闭 dialog</span></span></span><br><span class=\"hljs-comment\"><span class=\"language-javascript\"><span class=\"language-xml\"> */</span></span></span><br><span class=\"language-javascript\"><span class=\"language-xml\"><span class=\"hljs-keyword\">const</span> <span class=\"hljs-title function_\">comfirm</span> = <span class=\"hljs-keyword\">async</span> (<span class=\"hljs-params\"></span>) =&gt; &#123;</span></span><br><span class=\"language-javascript\"><span class=\"language-xml\">  <span class=\"hljs-title function_\">closed</span>()</span></span><br><span class=\"language-javascript\"><span class=\"language-xml\">&#125;</span></span><br><span class=\"language-javascript\"><span class=\"language-xml\"></span><span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">script</span>&gt;</span></span><br><br><span class=\"language-xml\"><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">style</span> <span class=\"hljs-attr\">lang</span>=<span class=\"hljs-string\">&quot;scss&quot;</span> <span class=\"hljs-attr\">scoped</span>&gt;</span><span class=\"language-css\"></span></span><br><span class=\"language-css\"><span class=\"language-xml\"><span class=\"hljs-selector-class\">.center</span> &#123;</span></span><br><span class=\"language-css\"><span class=\"language-xml\">  <span class=\"hljs-attribute\">text-align</span>: center;</span></span><br><span class=\"language-css\"><span class=\"language-xml\">  <span class=\"hljs-selector-class\">.title</span> &#123;</span></span><br><span class=\"language-css\"><span class=\"language-xml\">    <span class=\"hljs-attribute\">margin-bottom</span>: <span class=\"hljs-number\">12px</span>;</span></span><br><span class=\"language-css\"><span class=\"language-xml\">  &#125;</span></span><br><span class=\"language-css\"><span class=\"language-xml\">&#125;</span></span><br><span class=\"language-css\"><span class=\"language-xml\"></span><span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">style</span>&gt;</span></span><br><br></code></pre></td></tr></table></figure>\n\n<p>在 <code>ThemePicker/index</code> 中使用该组件</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\">&lt;template&gt;<br>  ...<br>  &lt;!-- 展示弹出层 --&gt;<br>  <span class=\"language-xml\"><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">div</span>&gt;</span></span><br><span class=\"language-xml\">    <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">select-color</span> <span class=\"hljs-attr\">v-model</span>=<span class=\"hljs-string\">&quot;selectColorVisible&quot;</span>&gt;</span><span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">select-color</span>&gt;</span></span><br><span class=\"language-xml\">  <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">div</span>&gt;</span></span><br>&lt;/template&gt;<br><br><span class=\"language-xml\"><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">script</span> <span class=\"hljs-attr\">setup</span>&gt;</span><span class=\"language-javascript\"></span></span><br><span class=\"language-javascript\"><span class=\"language-xml\"><span class=\"hljs-keyword\">import</span> <span class=\"hljs-title class_\">SelectColor</span> <span class=\"hljs-keyword\">from</span> <span class=\"hljs-string\">&#x27;./components/SelectColor.vue&#x27;</span></span></span><br><span class=\"language-javascript\"><span class=\"language-xml\"><span class=\"hljs-keyword\">import</span> &#123; ref &#125; <span class=\"hljs-keyword\">from</span> <span class=\"hljs-string\">&#x27;vue&#x27;</span></span></span><br><span class=\"language-javascript\"><span class=\"language-xml\"></span></span><br><span class=\"language-javascript\"><span class=\"language-xml\"><span class=\"hljs-keyword\">const</span> selectColorVisible = <span class=\"hljs-title function_\">ref</span>(<span class=\"hljs-literal\">false</span>)</span></span><br><span class=\"language-javascript\"><span class=\"language-xml\"><span class=\"hljs-keyword\">const</span> <span class=\"hljs-title function_\">handleSetTheme</span> = command =&gt; &#123;</span></span><br><span class=\"language-javascript\"><span class=\"language-xml\">  selectColorVisible.<span class=\"hljs-property\">value</span> = <span class=\"hljs-literal\">true</span></span></span><br><span class=\"language-javascript\"><span class=\"language-xml\">&#125;</span></span><br><span class=\"language-javascript\"><span class=\"language-xml\"></span><span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">script</span>&gt;</span></span><br><br></code></pre></td></tr></table></figure>\n\n<p>完成双向数据绑定之后，我们来处理第二步：<strong>把选中的色值进行本地缓存</strong></p>\n<p>缓存的方式分为两种：</p>\n<ol>\n<li><code>vuex</code></li>\n<li>本地存储</li>\n</ol>\n<p>在 <code>constants/index</code> 下新建常量值</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\"><span class=\"hljs-comment\">// 主题色保存的 key</span><br><span class=\"hljs-keyword\">export</span> <span class=\"hljs-keyword\">const</span> <span class=\"hljs-variable constant_\">MAIN_COLOR</span> = <span class=\"hljs-string\">&#x27;mainColor&#x27;</span><br><span class=\"hljs-comment\">// 默认色值</span><br><span class=\"hljs-keyword\">export</span> <span class=\"hljs-keyword\">const</span> <span class=\"hljs-variable constant_\">DEFAULT_COLOR</span> = <span class=\"hljs-string\">&#x27;#409eff&#x27;</span><br></code></pre></td></tr></table></figure>\n\n<p>创建 <code>store/modules/theme</code> 模块，用来处理 <strong>主题色</strong> 相关内容</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\"><span class=\"hljs-keyword\">import</span> &#123; getItem, setItem &#125; <span class=\"hljs-keyword\">from</span> <span class=\"hljs-string\">&#x27;@/utils/storage&#x27;</span><br><span class=\"hljs-keyword\">import</span> &#123; <span class=\"hljs-variable constant_\">MAIN_COLOR</span>, <span class=\"hljs-variable constant_\">DEFAULT_COLOR</span> &#125; <span class=\"hljs-keyword\">from</span> <span class=\"hljs-string\">&#x27;@/constant&#x27;</span><br><span class=\"hljs-keyword\">export</span> <span class=\"hljs-keyword\">default</span> &#123;<br>  <span class=\"hljs-attr\">namespaced</span>: <span class=\"hljs-literal\">true</span>,<br>  <span class=\"hljs-attr\">state</span>: <span class=\"hljs-function\">() =&gt;</span> (&#123;<br>    <span class=\"hljs-attr\">mainColor</span>: <span class=\"hljs-title function_\">getItem</span>(<span class=\"hljs-variable constant_\">MAIN_COLOR</span>) || <span class=\"hljs-variable constant_\">DEFAULT_COLOR</span><br>  &#125;),<br>  <span class=\"hljs-attr\">mutations</span>: &#123;<br>    <span class=\"hljs-comment\">/**</span><br><span class=\"hljs-comment\">     * 设置主题色</span><br><span class=\"hljs-comment\">     */</span><br>    <span class=\"hljs-title function_\">setMainColor</span>(<span class=\"hljs-params\">state, newColor</span>) &#123;<br>      state.<span class=\"hljs-property\">mainColor</span> = newColor<br>      <span class=\"hljs-title function_\">setItem</span>(<span class=\"hljs-variable constant_\">MAIN_COLOR</span>, newColor)<br>    &#125;<br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure>\n\n<p>在 <code>store/getters</code> 下指定快捷访问</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\"><span class=\"hljs-attr\">mainColor</span>: <span class=\"hljs-function\"><span class=\"hljs-params\">state</span> =&gt;</span> state.<span class=\"hljs-property\">theme</span>.<span class=\"hljs-property\">mainColor</span><br></code></pre></td></tr></table></figure>\n\n<p>在 <code>store/index</code> 中导入 <code>theme</code></p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\">...<br><span class=\"hljs-keyword\">import</span> theme <span class=\"hljs-keyword\">from</span> <span class=\"hljs-string\">&#x27;./modules/theme.js&#x27;</span><br><br><span class=\"hljs-keyword\">export</span> <span class=\"hljs-keyword\">default</span> <span class=\"hljs-title function_\">createStore</span>(&#123;<br>  getters,<br>  <span class=\"hljs-attr\">modules</span>: &#123;<br>    ...<br>    theme<br>  &#125;<br>&#125;)<br></code></pre></td></tr></table></figure>\n\n<p>在 <code>selectColor</code> 中，设置初始色值 和  缓存色值</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\">...<br><br>&lt;script setup&gt;<br><span class=\"hljs-keyword\">import</span> &#123; defineProps, defineEmits, ref &#125; <span class=\"hljs-keyword\">from</span> <span class=\"hljs-string\">&#x27;vue&#x27;</span><br><span class=\"hljs-keyword\">import</span> &#123; useStore &#125; <span class=\"hljs-keyword\">from</span> <span class=\"hljs-string\">&#x27;vuex&#x27;</span><br>...<br><span class=\"hljs-keyword\">const</span> store = <span class=\"hljs-title function_\">useStore</span>()<br><br><span class=\"hljs-comment\">// 默认色值</span><br><span class=\"hljs-keyword\">const</span> mColor = <span class=\"hljs-title function_\">ref</span>(store.<span class=\"hljs-property\">getters</span>.<span class=\"hljs-property\">mainColor</span>)<br><br>...<br><br><span class=\"hljs-comment\">/**</span><br><span class=\"hljs-comment\"> * 确定按钮</span><br><span class=\"hljs-comment\"> *</span><br><span class=\"hljs-comment\"> * 1. 修改主题色</span><br><span class=\"hljs-comment\"> * 2. 保存最新的主题色</span><br><span class=\"hljs-comment\"> * 3. 关闭 dialog</span><br><span class=\"hljs-comment\"> *</span><br><span class=\"hljs-comment\"> */</span><br><span class=\"hljs-keyword\">const</span> <span class=\"hljs-title function_\">comfirm</span> = <span class=\"hljs-keyword\">async</span> (<span class=\"hljs-params\"></span>) =&gt; &#123;<br>  <span class=\"hljs-comment\">// 2. 保存最新的主题色</span><br>  store.<span class=\"hljs-title function_\">commit</span>(<span class=\"hljs-string\">&#x27;theme/setMainColor&#x27;</span>, mColor.<span class=\"hljs-property\">value</span>)<br>  <span class=\"hljs-comment\">// 3. 关闭 dialog</span><br>  <span class=\"hljs-title function_\">closed</span>()<br>&#125;<br>&lt;/script&gt;<br></code></pre></td></tr></table></figure>\n\n<h2 id=\"scss-mix方法\"><a href=\"#scss-mix方法\" class=\"headerlink\" title=\"scss mix方法\"></a>scss mix方法</h2><figure class=\"highlight css\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs css\">// 给当前的颜色值，添加上 <span class=\"hljs-number\">50%</span> 的白色<br><span class=\"hljs-selector-class\">.white</span> &#123;<br>  <span class=\"hljs-attribute\">color</span>: <span class=\"hljs-built_in\">mix</span>(white, $color, <span class=\"hljs-number\">50%</span>);<br>&#125;<br><br>// 给当前的颜色值，添加上 <span class=\"hljs-number\">50%</span> 的黑色<br><span class=\"hljs-selector-class\">.black</span> &#123;<br>  <span class=\"hljs-attribute\">color</span>: <span class=\"hljs-built_in\">mix</span>(black, $color, <span class=\"hljs-number\">50%</span>);<br>&#125;<br></code></pre></td></tr></table></figure>\n\n<h2 id=\"处理-element-plus-主题色变更原理与步骤分析\"><a href=\"#处理-element-plus-主题色变更原理与步骤分析\" class=\"headerlink\" title=\"处理 element-plus 主题色变更原理与步骤分析\"></a>处理 element-plus 主题色变更原理与步骤分析</h2><p>对于 <code>element-plus</code> 的主题变更，相对比较复杂，所以说整个过程我们会分为三部分：</p>\n<ol>\n<li>实现原理</li>\n<li>实现步骤</li>\n<li>实现过程</li>\n</ol>\n<p><strong>实现原理：</strong></p>\n<p>在之前我们分析主题变更的实现原理时，我们说过，核心的原理是：*<em>通过修改 <code>scss</code> 变量 *</em> 的形式修改主题色完成主题变更</p>\n<p>但是对于 <code>element-plus</code> 而言，我们怎么去修改这样的主题色呢？</p>\n<p>其实整体的原理非常简单，分为三步：</p>\n<ol>\n<li>获取当前 <code>element-plus</code> 的所有样式</li>\n<li>找到我们想要替换的样式部分，通过正则完成替换</li>\n<li>把替换后的样式写入到 <code>style</code> 标签中，利用样式优先级的特性，替代固有样式</li>\n</ol>\n<p><strong>实现步骤：</strong></p>\n<p>那么明确了原理之后，我们的实现步骤也就呼之欲出了，对应原理总体可分为四步：</p>\n<ol>\n<li>获取当前 <code>element-plus</code> 的所有样式</li>\n<li>定义我们要替换之后的样式</li>\n<li>在原样式中，利用正则替换新样式</li>\n<li>把替换后的样式写入到 <code>style</code> 标签中</li>\n</ol>\n<p><strong>创建 <code>utils/theme</code> 工具类，写入两个方法</strong></p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\"><span class=\"hljs-comment\">/**</span><br><span class=\"hljs-comment\"> * 写入新样式到 style</span><br><span class=\"hljs-comment\"> * <span class=\"hljs-doctag\">@param</span> &#123;<span class=\"hljs-type\">*</span>&#125; elNewStyle  element-plus 的新样式</span><br><span class=\"hljs-comment\"> * <span class=\"hljs-doctag\">@param</span> &#123;<span class=\"hljs-type\">*</span>&#125; isNewStyleTag 是否生成新的 style 标签</span><br><span class=\"hljs-comment\"> */</span><br><span class=\"hljs-keyword\">export</span> <span class=\"hljs-keyword\">const</span> <span class=\"hljs-title function_\">writeNewStyle</span> = elNewStyle =&gt; &#123;<br>  <br>&#125;<br><br><span class=\"hljs-comment\">/**</span><br><span class=\"hljs-comment\"> * 根据主色值，生成最新的样式表</span><br><span class=\"hljs-comment\"> */</span><br><span class=\"hljs-keyword\">export</span> <span class=\"hljs-keyword\">const</span> <span class=\"hljs-title function_\">generateNewStyle</span> =  primaryColor =&gt; &#123;<br> <br>&#125;<br></code></pre></td></tr></table></figure>\n\n<p>那么接下来我们先实现第一个方法 <code>generateNewStyle</code>，在实现的过程中，我们需要安装两个工具类：</p>\n<ol>\n<li><a href=\"https://www.npmjs.com/package/rgb-hex\">rgb-hex</a>：转换RGB(A)颜色为十六进制</li>\n<li><a href=\"https://www.npmjs.com/package/css-color-function\">css-color-function</a>：在 CSS 中 Tab Atkins 提出的颜色函数的解析器和转换器。</li>\n</ol>\n<p><strong>示例</strong></p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\"><span class=\"hljs-keyword\">import</span> rgbHex <span class=\"hljs-keyword\">from</span> <span class=\"hljs-string\">&#x27;rgb-hex&#x27;</span><br><br><span class=\"hljs-title function_\">rgbHex</span>(<span class=\"hljs-number\">65</span>, <span class=\"hljs-number\">131</span>, <span class=\"hljs-number\">196</span>);<br><span class=\"hljs-comment\">//=&gt; &#x27;4183c4&#x27;</span><br><br><span class=\"hljs-title function_\">rgbHex</span>(<span class=\"hljs-string\">&#x27;rgb(40, 42, 54)&#x27;</span>);<br><span class=\"hljs-comment\">//=&gt; &#x27;282a36&#x27;</span><br><br><span class=\"hljs-title function_\">rgbHex</span>(<span class=\"hljs-number\">65</span>, <span class=\"hljs-number\">131</span>, <span class=\"hljs-number\">196</span>, <span class=\"hljs-number\">0.2</span>);<br><span class=\"hljs-comment\">//=&gt; &#x27;4183c433&#x27;</span><br><br><span class=\"hljs-title function_\">rgbHex</span>(<span class=\"hljs-number\">40</span>, <span class=\"hljs-number\">42</span>, <span class=\"hljs-number\">54</span>, <span class=\"hljs-string\">&#x27;75%&#x27;</span>);<br><span class=\"hljs-comment\">//=&gt; &#x27;282a36bf&#x27;</span><br><br><span class=\"hljs-title function_\">rgbHex</span>(<span class=\"hljs-string\">&#x27;rgba(40, 42, 54, 75%)&#x27;</span>);<br><span class=\"hljs-comment\">//=&gt; &#x27;282a36bf&#x27;</span><br><br>------------------------------------------------<br><br><span class=\"hljs-keyword\">import</span> color <span class=\"hljs-keyword\">from</span> <span class=\"hljs-string\">&#x27;css-color-function&#x27;</span><br> <br>color.<span class=\"hljs-title function_\">convert</span>(<span class=\"hljs-string\">&#x27;color(red tint(50%))&#x27;</span>);<br><span class=\"hljs-comment\">// &quot;rgb(255, 128, 128)&quot;</span><br></code></pre></td></tr></table></figure>\n\n<p>然后还需要写入一个 <strong>颜色转化计算器  <code>formula.json</code></strong>，这里主要是以 <code>primary</code> 色值为例</p>\n<p>创建 <code>constants/formula.json</code> </p>\n<figure class=\"highlight json\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs json\"><span class=\"hljs-punctuation\">&#123;</span><br>  <span class=\"hljs-attr\">&quot;shade-1&quot;</span><span class=\"hljs-punctuation\">:</span> <span class=\"hljs-string\">&quot;color(primary shade(10%))&quot;</span><span class=\"hljs-punctuation\">,</span><br>  <span class=\"hljs-attr\">&quot;light-1&quot;</span><span class=\"hljs-punctuation\">:</span> <span class=\"hljs-string\">&quot;color(primary tint(10%))&quot;</span><span class=\"hljs-punctuation\">,</span><br>  <span class=\"hljs-attr\">&quot;light-2&quot;</span><span class=\"hljs-punctuation\">:</span> <span class=\"hljs-string\">&quot;color(primary tint(20%))&quot;</span><span class=\"hljs-punctuation\">,</span><br>  <span class=\"hljs-attr\">&quot;light-3&quot;</span><span class=\"hljs-punctuation\">:</span> <span class=\"hljs-string\">&quot;color(primary tint(30%))&quot;</span><span class=\"hljs-punctuation\">,</span><br>  <span class=\"hljs-attr\">&quot;light-4&quot;</span><span class=\"hljs-punctuation\">:</span> <span class=\"hljs-string\">&quot;color(primary tint(40%))&quot;</span><span class=\"hljs-punctuation\">,</span><br>  <span class=\"hljs-attr\">&quot;light-5&quot;</span><span class=\"hljs-punctuation\">:</span> <span class=\"hljs-string\">&quot;color(primary tint(50%))&quot;</span><span class=\"hljs-punctuation\">,</span><br>  <span class=\"hljs-attr\">&quot;light-6&quot;</span><span class=\"hljs-punctuation\">:</span> <span class=\"hljs-string\">&quot;color(primary tint(60%))&quot;</span><span class=\"hljs-punctuation\">,</span><br>  <span class=\"hljs-attr\">&quot;light-7&quot;</span><span class=\"hljs-punctuation\">:</span> <span class=\"hljs-string\">&quot;color(primary tint(70%))&quot;</span><span class=\"hljs-punctuation\">,</span><br>  <span class=\"hljs-attr\">&quot;light-8&quot;</span><span class=\"hljs-punctuation\">:</span> <span class=\"hljs-string\">&quot;color(primary tint(80%))&quot;</span><span class=\"hljs-punctuation\">,</span><br>  <span class=\"hljs-attr\">&quot;light-9&quot;</span><span class=\"hljs-punctuation\">:</span> <span class=\"hljs-string\">&quot;color(primary tint(90%))&quot;</span><span class=\"hljs-punctuation\">,</span><br>  <span class=\"hljs-attr\">&quot;subMenuHover&quot;</span><span class=\"hljs-punctuation\">:</span> <span class=\"hljs-string\">&quot;color(primary tint(70%))&quot;</span><span class=\"hljs-punctuation\">,</span><br>  <span class=\"hljs-attr\">&quot;subMenuBg&quot;</span><span class=\"hljs-punctuation\">:</span> <span class=\"hljs-string\">&quot;color(primary tint(80%))&quot;</span><span class=\"hljs-punctuation\">,</span><br>  <span class=\"hljs-attr\">&quot;menuHover&quot;</span><span class=\"hljs-punctuation\">:</span> <span class=\"hljs-string\">&quot;color(primary tint(90%))&quot;</span><span class=\"hljs-punctuation\">,</span><br>  <span class=\"hljs-attr\">&quot;menuBg&quot;</span><span class=\"hljs-punctuation\">:</span> <span class=\"hljs-string\">&quot;color(primary)&quot;</span><br><span class=\"hljs-punctuation\">&#125;</span><br></code></pre></td></tr></table></figure>\n\n<p>我们来看下 element plus 定义的 <code>primary</code> 变量，<code>light-i</code> 表示颜色的深浅。</p>\n<p><img src=\"/img/primary.png\" alt=\"\"></p>\n<p>如果我们想要定义其它颜色，比如<code>--el-color-success</code>，已同样的方法，添加到 <code>formula.json</code> 中即可。</p>\n<p>同时我们还定义了自己变量在 <code>formula</code> 颜色转换器中，因为我们的 <code>菜单</code> 部分，也是需要跟着主题色变化的。</p>\n<p><strong>shade tint 方法其实就是利用了 scss 的 mix 方法</strong>，css-color-function 库内部调用进行解析，对某个颜色加深或者淡化！！</p>\n<figure class=\"highlight css\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs css\">// scss<br><br>// 给当前的颜色值，添加上 <span class=\"hljs-number\">50%</span> 的白色<br><span class=\"hljs-selector-class\">.white</span> &#123;<br>  <span class=\"hljs-attribute\">color</span>: <span class=\"hljs-built_in\">mix</span>(white, $color, <span class=\"hljs-number\">50%</span>);<br>&#125;<br><br>// 给当前的颜色值，添加上 <span class=\"hljs-number\">50%</span> 的黑色<br><span class=\"hljs-selector-class\">.black</span> &#123;<br>  <span class=\"hljs-attribute\">color</span>: <span class=\"hljs-built_in\">mix</span>(black, $color, <span class=\"hljs-number\">50%</span>);<br>&#125;<br><br><span class=\"hljs-keyword\">@function</span> tint($<span class=\"hljs-attribute\">color</span>, $parcent) &#123;<br>  <span class=\"hljs-keyword\">@return</span> mix(white, $<span class=\"hljs-attribute\">color</span>, $parcent)<br>&#125;<br>@function shade($<span class=\"hljs-attribute\">color</span>, $parcent) &#123;<br>  <span class=\"hljs-keyword\">@return</span> mix(black, $<span class=\"hljs-attribute\">color</span>, $parcent)<br>&#125;<br></code></pre></td></tr></table></figure>\n\n<p>准备就绪后，我们来实现 <code>generateNewStyle</code> 方法：</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br><span class=\"line\">103</span><br><span class=\"line\">104</span><br><span class=\"line\">105</span><br><span class=\"line\">106</span><br><span class=\"line\">107</span><br><span class=\"line\">108</span><br><span class=\"line\">109</span><br><span class=\"line\">110</span><br><span class=\"line\">111</span><br><span class=\"line\">112</span><br><span class=\"line\">113</span><br><span class=\"line\">114</span><br><span class=\"line\">115</span><br><span class=\"line\">116</span><br><span class=\"line\">117</span><br><span class=\"line\">118</span><br><span class=\"line\">119</span><br><span class=\"line\">120</span><br><span class=\"line\">121</span><br><span class=\"line\">122</span><br><span class=\"line\">123</span><br><span class=\"line\">124</span><br><span class=\"line\">125</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\"><span class=\"hljs-comment\">// https://www.npmjs.com/package/css-color-function</span><br><span class=\"hljs-keyword\">import</span> color <span class=\"hljs-keyword\">from</span> <span class=\"hljs-string\">&#x27;css-color-function&#x27;</span><br><br><span class=\"hljs-comment\">// https://www.npmjs.com/package/rgb-hex</span><br><span class=\"hljs-keyword\">import</span> rgbHex <span class=\"hljs-keyword\">from</span> <span class=\"hljs-string\">&#x27;rgb-hex&#x27;</span><br><span class=\"hljs-keyword\">import</span> axios <span class=\"hljs-keyword\">from</span> <span class=\"hljs-string\">&#x27;axios&#x27;</span><br><span class=\"hljs-keyword\">import</span> formula <span class=\"hljs-keyword\">from</span> <span class=\"hljs-string\">&#x27;@/constants/formula.json&#x27;</span><br><span class=\"hljs-comment\">/**</span><br><span class=\"hljs-comment\"> * 写入新样式到 style</span><br><span class=\"hljs-comment\"> * <span class=\"hljs-doctag\">@param</span> &#123;<span class=\"hljs-type\">*</span>&#125; cssText  element-plus 的新样式</span><br><span class=\"hljs-comment\"> * <span class=\"hljs-doctag\">@param</span> &#123;<span class=\"hljs-type\">*</span>&#125; isNewStyleTag 是否生成新的 style 标签</span><br><span class=\"hljs-comment\"> */</span><br><span class=\"hljs-keyword\">export</span> <span class=\"hljs-keyword\">const</span> <span class=\"hljs-title function_\">writeNewStyle</span> = (<span class=\"hljs-params\">cssText: string</span>) =&gt; &#123;<br>  <span class=\"hljs-keyword\">const</span> style = <span class=\"hljs-variable language_\">document</span>.<span class=\"hljs-title function_\">createElement</span>(<span class=\"hljs-string\">&#x27;style&#x27;</span>)<br>  style.<span class=\"hljs-property\">innerText</span> = cssText<br>  <span class=\"hljs-variable language_\">document</span>.<span class=\"hljs-property\">head</span>.<span class=\"hljs-title function_\">appendChild</span>(style)<br>&#125;<br><br><span class=\"hljs-comment\">/**</span><br><span class=\"hljs-comment\"> * 根据主色值，生成最新的样式表</span><br><span class=\"hljs-comment\"> */</span><br>type <span class=\"hljs-title class_\">TObject</span> = &#123; [<span class=\"hljs-attr\">key</span>: string]: string &#125;<br><span class=\"hljs-keyword\">export</span> <span class=\"hljs-keyword\">const</span> <span class=\"hljs-title function_\">generateNewStyle</span> = <span class=\"hljs-keyword\">async</span> (<span class=\"hljs-params\">primaryColor: string</span>) =&gt; &#123;<br>  <span class=\"hljs-comment\">// colors ===&gt; &#123; primary: &#x27;rgba(8, 12, 132, 0.68)&#x27;, shade-1: &#x27;#070b77ad&#x27;, light-1: &#x27;#212490ad&#x27;, ...... &#125;</span><br>  <span class=\"hljs-keyword\">const</span> <span class=\"hljs-attr\">colors</span>: <span class=\"hljs-title class_\">TObject</span> = <span class=\"hljs-title function_\">generateColors</span>(primaryColor) <span class=\"hljs-keyword\">as</span> <span class=\"hljs-title class_\">TObject</span><br><br>  <span class=\"hljs-comment\">// 拿到整个 element plus 样式表，并对需要修改的变量打上了标记</span><br>  <span class=\"hljs-keyword\">let</span> cssText = <span class=\"hljs-keyword\">await</span> <span class=\"hljs-title function_\">getOriginalStyle</span>()<br><br>  <span class=\"hljs-comment\">// 遍历生成的样式表，在 CSS 的原样式中进行全局替换</span><br>  <span class=\"hljs-title class_\">Object</span>.<span class=\"hljs-title function_\">keys</span>(colors).<span class=\"hljs-title function_\">forEach</span>(<span class=\"hljs-function\"><span class=\"hljs-params\">key</span> =&gt;</span> &#123;<br>    <span class=\"hljs-comment\">// reg pattern</span><br>    <span class=\"hljs-comment\">// /(:|\\s+)primary/g</span><br>    <span class=\"hljs-comment\">// /(:|\\s+)shade-1/g</span><br>    <span class=\"hljs-comment\">// /(:|\\s+)menuBg/g</span><br>    <span class=\"hljs-comment\">// ...</span><br><br>    <span class=\"hljs-comment\">// 这个模式中的 (:|\\\\s+) 表示一个冒号或一个或多个空白字符（包括空格、制表符和换行符）。</span><br>    <span class=\"hljs-comment\">// \\\\s+ 的第一个 \\ 是转义字符</span><br>    <span class=\"hljs-comment\">// key 是一个变量，代表一个需要匹配的字符串，比如匹配 `primary`</span><br><br>    <span class=\"hljs-comment\">// &#x27;$1&#x27; + colors[key]</span><br>    <span class=\"hljs-comment\">// 关于为什么要在色值前面加上 $1，我们需要查看 replace 方法的第二个参数。</span><br>    <span class=\"hljs-comment\">// 在这里，第二个参数是一个字符串，字符串中的 $1 会被替换成第一个括号捕获组（即 (:|\\\\s+)）匹配到的文本。</span><br>    <span class=\"hljs-comment\">// 所以加上 $1 就是为了在【替换的文本】中【保留原本匹配到的文本】。</span><br>    cssText = cssText.<span class=\"hljs-title function_\">replace</span>(<br>      <span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">RegExp</span>(<span class=\"hljs-string\">&#x27;(:|\\\\s+)&#x27;</span> + key, <span class=\"hljs-string\">&#x27;g&#x27;</span>),<br>      <span class=\"hljs-string\">&#x27;$1&#x27;</span> + colors[key]<br>    )<br>  &#125;)<br><br>  <span class=\"hljs-comment\">// 最终，新的样式表中，含有我们自定义的颜色主题</span><br>  <span class=\"hljs-keyword\">return</span> cssText<br>&#125;<br><br><span class=\"hljs-comment\">/**</span><br><span class=\"hljs-comment\"> * 根据主色生成色值表</span><br><span class=\"hljs-comment\"> */</span><br>type <span class=\"hljs-title class_\">TFormulaKey</span> = keyof <span class=\"hljs-keyword\">typeof</span> formula<br><span class=\"hljs-keyword\">export</span> <span class=\"hljs-keyword\">const</span> <span class=\"hljs-title function_\">generateColors</span> = (<span class=\"hljs-params\">primary: string</span>) =&gt; &#123;<br>  <span class=\"hljs-keyword\">if</span> (!primary) <span class=\"hljs-keyword\">return</span><br>  <span class=\"hljs-keyword\">const</span> <span class=\"hljs-attr\">colors</span>: &#123; [<span class=\"hljs-attr\">key</span>: string]: string &#125; = &#123;<br>    primary<br>  &#125;<br><br>  ;(<span class=\"hljs-title class_\">Object</span>.<span class=\"hljs-title function_\">keys</span>(formula) <span class=\"hljs-keyword\">as</span> <span class=\"hljs-title class_\">Array</span>&lt;<span class=\"hljs-title class_\">TFormulaKey</span>&gt;).<span class=\"hljs-title function_\">forEach</span>(<br>    &lt;K <span class=\"hljs-keyword\">extends</span> <span class=\"hljs-title class_\">TFormulaKey</span>&gt;<span class=\"hljs-function\">(<span class=\"hljs-params\">key: K</span>) =&gt;</span> &#123;<br>      <span class=\"hljs-comment\">// 将所有的主色，替换成我们选中的主题色，形式如 &gt;&gt;&gt; color(rgba(255, 69, 0, 1) shade(10%))</span><br>      <span class=\"hljs-keyword\">const</span> value = formula[key].<span class=\"hljs-title function_\">replace</span>(<span class=\"hljs-regexp\">/primary/g</span>, primary)<br><br>      <span class=\"hljs-comment\">// 通过 color 的 conver 方法，计算出 rgba 色值</span><br>      <span class=\"hljs-comment\">// color.convert(value)  ===&gt;&gt;&gt;  rgba(0, 12, 230, 0.68)</span><br><br>      <span class=\"hljs-comment\">// 最终将转为每个颜色，转为十六进制：#030420ad，写入到 colors 对象中，并返回</span><br>      colors[key] = <span class=\"hljs-string\">&#x27;#&#x27;</span> + <span class=\"hljs-title function_\">rgbHex</span>(color.<span class=\"hljs-title function_\">convert</span>(value))<br>    &#125;<br>  )<br>  <span class=\"hljs-keyword\">return</span> colors<br>&#125;<br><br><span class=\"hljs-comment\">/**</span><br><span class=\"hljs-comment\"> * 获取当前 element-plus 的默认样式表</span><br><span class=\"hljs-comment\"> */</span><br><span class=\"hljs-keyword\">const</span> <span class=\"hljs-title function_\">getOriginalStyle</span> = <span class=\"hljs-keyword\">async</span> (<span class=\"hljs-params\"></span>) =&gt; &#123;<br>  <span class=\"hljs-keyword\">const</span> version = <span class=\"hljs-built_in\">require</span>(<span class=\"hljs-string\">&#x27;element-plus/package.json&#x27;</span>).<span class=\"hljs-property\">version</span><br>  <span class=\"hljs-keyword\">const</span> url = <span class=\"hljs-string\">`https://unpkg.com/element-plus@<span class=\"hljs-subst\">$&#123;version&#125;</span>/dist/index.css`</span><br>  <span class=\"hljs-keyword\">const</span> &#123; data &#125; = <span class=\"hljs-keyword\">await</span> <span class=\"hljs-title function_\">axios</span>(url)<br><br>  <span class=\"hljs-comment\">// 把获取到的数据筛选为原样式模板</span><br>  <span class=\"hljs-keyword\">return</span> <span class=\"hljs-title function_\">getStyleTemplate</span>(data)<br>&#125;<br><br><span class=\"hljs-comment\">/**</span><br><span class=\"hljs-comment\"> * 返回 style 的 template</span><br><span class=\"hljs-comment\"> */</span><br><span class=\"hljs-keyword\">const</span> <span class=\"hljs-title function_\">getStyleTemplate</span> = (<span class=\"hljs-params\">data: string</span>) =&gt; &#123;<br>  <span class=\"hljs-comment\">// element-plus 默认色值</span><br>  <span class=\"hljs-keyword\">const</span> <span class=\"hljs-attr\">colorMap</span>: &#123; [<span class=\"hljs-attr\">key</span>: string]: string &#125; = &#123;<br>    <span class=\"hljs-string\">&#x27;#3a8ee6&#x27;</span>: <span class=\"hljs-string\">&#x27;shade-1&#x27;</span>,<br>    <span class=\"hljs-string\">&#x27;#409eff&#x27;</span>: <span class=\"hljs-string\">&#x27;primary&#x27;</span>, <span class=\"hljs-comment\">// element-plus 中含有变量 `--el-color-primary: #409eff`</span><br>    <span class=\"hljs-string\">&#x27;#53a8ff&#x27;</span>: <span class=\"hljs-string\">&#x27;light-1&#x27;</span>,<br>    <span class=\"hljs-string\">&#x27;#66b1ff&#x27;</span>: <span class=\"hljs-string\">&#x27;light-2&#x27;</span>,<br>    <span class=\"hljs-string\">&#x27;#79bbff&#x27;</span>: <span class=\"hljs-string\">&#x27;light-3&#x27;</span>,<br>    <span class=\"hljs-string\">&#x27;#8cc5ff&#x27;</span>: <span class=\"hljs-string\">&#x27;light-4&#x27;</span>,<br>    <span class=\"hljs-string\">&#x27;#a0cfff&#x27;</span>: <span class=\"hljs-string\">&#x27;light-5&#x27;</span>,<br>    <span class=\"hljs-string\">&#x27;#b3d8ff&#x27;</span>: <span class=\"hljs-string\">&#x27;light-6&#x27;</span>,<br>    <span class=\"hljs-string\">&#x27;#c6e2ff&#x27;</span>: <span class=\"hljs-string\">&#x27;light-7&#x27;</span>,<br>    <span class=\"hljs-string\">&#x27;#d9ecff&#x27;</span>: <span class=\"hljs-string\">&#x27;light-8&#x27;</span>,<br>    <span class=\"hljs-string\">&#x27;#ecf5ff&#x27;</span>: <span class=\"hljs-string\">&#x27;light-9&#x27;</span><br>  &#125;<br>  <span class=\"hljs-comment\">// 根据默认色值为要替换的色值打上标记</span><br>  <span class=\"hljs-title class_\">Object</span>.<span class=\"hljs-title function_\">keys</span>(colorMap).<span class=\"hljs-title function_\">forEach</span>(<span class=\"hljs-function\"><span class=\"hljs-params\">key</span> =&gt;</span> &#123;<br>    <span class=\"hljs-keyword\">const</span> value = colorMap[key]<br>    data = data.<span class=\"hljs-title function_\">replace</span>(<span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">RegExp</span>(key, <span class=\"hljs-string\">&#x27;ig&#x27;</span>), value)<br>  &#125;)<br><br>  <span class=\"hljs-comment\">// 替换完之后</span><br>  <span class=\"hljs-comment\">// `--el-color-primary: #409eff` 就变成了 `--el-color-primary: primary`</span><br>  <span class=\"hljs-comment\">// --el-color-primary-light-3: #79bbff;  变成了  --el-color-primary-light-3: light-3</span><br>  <span class=\"hljs-comment\">// ...</span><br>  <span class=\"hljs-comment\">// ...</span><br>  <span class=\"hljs-comment\">// `--el-color-primary-light-9: #ecf5ff` 变成了 `--el-color-primary-light-9: light-9`</span><br><br>  <span class=\"hljs-keyword\">return</span> data<br>&#125;<br></code></pre></td></tr></table></figure>\n\n<p><strong>我们来分析一下 theme.ts 中函数的执行流程</strong></p>\n<ol>\n<li><p>首先，外部调用 <code>generateNewStyle</code> 方法，传入 primaryColor，我们通过 el-color-picker 选中后的值，就是 <code>primaryColor</code>，它的色值长这样 <code>rgba(8, 12, 132, 0.68)</code>。</p>\n</li>\n<li><p>通过 <code>generateColors</code> 方法生成色值表</p>\n<ol>\n<li><p>通过 <code>css-color-function</code> 处理我们的颜色转化计算器<code>formula.json</code></p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\"><span class=\"hljs-title function_\">color</span>(<span class=\"hljs-title function_\">rgba</span>(<span class=\"hljs-number\">255</span>, <span class=\"hljs-number\">69</span>, <span class=\"hljs-number\">0</span>, <span class=\"hljs-number\">1</span>) <span class=\"hljs-title function_\">shade</span>(<span class=\"hljs-number\">10</span>%)) &gt;&gt;&gt; color.<span class=\"hljs-title function_\">convert</span>(value) &gt;&gt;&gt; <span class=\"hljs-title function_\">rgba</span>(<span class=\"hljs-number\">0</span>, <span class=\"hljs-number\">12</span>, <span class=\"hljs-number\">230</span>, <span class=\"hljs-number\">0.68</span>)<br></code></pre></td></tr></table></figure>\n</li>\n<li><p>使用 <code>rgbHex</code> 方法将 rgba 转化为十六进制格式</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\"><span class=\"hljs-title function_\">rgbHex</span>(color.<span class=\"hljs-title function_\">convert</span>(value))  ===&gt;&gt;&gt;  <span class=\"hljs-string\">&#x27;#030420ad&#x27;</span><br></code></pre></td></tr></table></figure></li>\n<li><p>返回处理过后的色值表 <code>colors</code></p>\n</li>\n</ol>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\">&#123;<br>  <span class=\"hljs-attr\">primary</span>: <span class=\"hljs-string\">&#x27;rgba(8, 12, 132, 0.68)&#x27;</span>, <span class=\"hljs-comment\">// 保留了原始的rgba格式</span><br>  shade-<span class=\"hljs-number\">1</span>: <span class=\"hljs-string\">&#x27;#070b77ad&#x27;</span>,<br>  light-<span class=\"hljs-number\">1</span>: <span class=\"hljs-string\">&#x27;#212490ad&#x27;</span>,<br>  light-<span class=\"hljs-number\">2</span>: <span class=\"hljs-string\">&#x27;#393d9dad&#x27;</span>,<br>  ......<br>&#125;<br></code></pre></td></tr></table></figure></li>\n<li><p>通过 <code>getOriginalStyle</code> 方法，获取 element plus 样式表</p>\n</li>\n<li><p>拿到 element plus 样式数据后，通过 <code>getStyleTemplate</code> 方法，根据默认色值 <code>colorMap</code> 为要替换的色值打上标记</p>\n<ol>\n<li>element-plus 中含有变量 <code>--el-color-primary: #409eff</code>，而我们定义的 colorMap 默认值 <code>&#39;#409eff&#39;: &#39;primary&#39;</code> 就是与 element plus 中的十六进制值是对应。</li>\n<li>我们就是要将 element plus 中的 primary 十六进制值替换成我们的标记，<code>primary、shade-*</code>。因为我们已经处理过 <code>formula.json</code> 了，处理过后得到的是 <strong><code>&#123; primary: &#39;rgba(8, 12, 132, 0.68)&#39;, shade-1: &#39;#070b77ad&#39;, light-1: &#39;#212490ad&#39;, ...&#125;</code></strong> 这种形式，这里面的色值，就是我们需要应用到页面上的颜色。</li>\n<li>替换完之后，element plus 中的颜色变量就被标记上了记号，表示将来需要替换成真正的色值。<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\"><span class=\"hljs-string\">`--el-color-primary: #409eff`</span> 就变成了 <span class=\"hljs-string\">`--el-color-primary: primary`</span><br><span class=\"hljs-string\">`--el-color-primary-light-9: #ecf5ff`</span> 变成了 <span class=\"hljs-string\">`--el-color-primary-light-9: light-9`</span><br></code></pre></td></tr></table></figure></li>\n<li>返回处理过后的 element plus 样式表 <code>cssText</code></li>\n</ol>\n</li>\n<li><p>接着，我们通过正则以及第二步 <code>generateColors</code> 方法返回的 colors，将 <code>cssText</code> 中每个打了标记的变量值替换</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\">cssText = cssText.<span class=\"hljs-title function_\">replace</span>(<span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">RegExp</span>(<span class=\"hljs-string\">&#x27;(:|\\\\s+)&#x27;</span> + key, <span class=\"hljs-string\">&#x27;g&#x27;</span>), <span class=\"hljs-string\">&#x27;$1&#x27;</span> + colors[key])<br></code></pre></td></tr></table></figure>\n\n<ol>\n<li>这个模式中的 (:|\\s+) 表示一个冒号或一个【或】多个空白字符(\\s+)（包括空格、制表符和换行符）</li>\n<li>\\s+ 的第一个 \\ 是转义字符</li>\n<li>key 是一个变量，代表一个需要匹配的字符串，比如匹配 <code>primary</code></li>\n<li><code>&#39;$1&#39; + colors[key]</code>: replace 第二个参数是一个字符串，字符串中的 $1 会被替换成第一个括号捕获组（即 (:|\\s+)）匹配到的文本。所以加上 $1 就是为了在【替换的文本】中【保留原本匹配到的文本】。</li>\n<li>最后返回 cssText，新的样式表中，含有我们自定义的颜色主题</li>\n</ol>\n</li>\n<li><p>最后，通过 <code>writeNewStyle</code> 将新的样式表 <code>cssText</code> 插入到文档中。</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\"><span class=\"hljs-keyword\">const</span> style = <span class=\"hljs-variable language_\">document</span>.<span class=\"hljs-title function_\">createElement</span>(<span class=\"hljs-string\">&#x27;style&#x27;</span>)<br>style.<span class=\"hljs-property\">innerText</span> = cssText<br><span class=\"hljs-variable language_\">document</span>.<span class=\"hljs-property\">head</span>.<span class=\"hljs-title function_\">appendChild</span>(style)<br></code></pre></td></tr></table></figure>\n\n</li>\n</ol>\n<p><strong>总结</strong></p>\n<p>到这里，我们对 <code>element plus</code> 的主题换肤就完成了。</p>\n<p>原理就是：拿到用户选中的颜色值(rgba)，通过 formula 颜色转换器转换成十六进制表 colors，然后拿到 <code>element plus</code> 的样式表，将其中需要修改的变量打上标记并返回含有标记的新样式表 cssText，最后，遍历 colors，通过正则将所有标记替换成 colors 中的值。完成样式的替换。</p>\n<h2 id=\"element-plus-新主题的立即生效\"><a href=\"#element-plus-新主题的立即生效\" class=\"headerlink\" title=\"element-plus 新主题的立即生效\"></a>element-plus 新主题的立即生效</h2><p>到目前我们已经完成了 <code>element-plus</code> 的主题变更，但是当前的主题变更还有一个小问题，那就是：<strong>在刷新页面后，新主题会失效</strong></p>\n<p>那么出现这个问题的原因，非常简单：<strong>因为没有写入新的 <code>style</code></strong></p>\n<p>所以我们只需要在 <strong>应用加载后，写入 <code>style</code> 即可</strong></p>\n<p>那么写入的时机，我们可以放入到 <code>app.vue</code> 中</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\">&lt;script setup&gt;<br><span class=\"hljs-keyword\">import</span> &#123; useStore &#125; <span class=\"hljs-keyword\">from</span> <span class=\"hljs-string\">&#x27;vuex&#x27;</span><br><span class=\"hljs-keyword\">import</span> &#123; generateNewStyle, writeNewStyle &#125; <span class=\"hljs-keyword\">from</span> <span class=\"hljs-string\">&#x27;@/utils/theme&#x27;</span><br><br><span class=\"hljs-keyword\">const</span> store = <span class=\"hljs-title function_\">useStore</span>()<br><span class=\"hljs-title function_\">generateNewStyle</span>(store.<span class=\"hljs-property\">getters</span>.<span class=\"hljs-property\">mainColor</span>).<span class=\"hljs-title function_\">then</span>(<span class=\"hljs-function\"><span class=\"hljs-params\">newStyleText</span> =&gt;</span> &#123;<br>  <span class=\"hljs-title function_\">writeNewStyle</span>(newStyleText)<br>&#125;)<br>&lt;/script&gt;<br></code></pre></td></tr></table></figure>\n\n<h2 id=\"自定义主题变更\"><a href=\"#自定义主题变更\" class=\"headerlink\" title=\"自定义主题变更\"></a>自定义主题变更</h2><p>自定义主题变更相对来说比较简单，因为 <strong>自己的代码更加可控</strong>。</p>\n<p>目前在我们的代码中，需要进行 <strong>自定义主题变更</strong> 为  <strong><code>menu</code> 菜单背景色</strong></p>\n<p>而目前指定 <code>menu</code> 菜单背景色的位置在 <code>layout/components/sidebar/SidebarMenu.vue</code> 中</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\">&lt;el-menu<br>  :<span class=\"hljs-keyword\">default</span>-active=<span class=\"hljs-string\">&quot;activeMenu&quot;</span><br>  :collapse=<span class=\"hljs-string\">&quot;!$store.getters.sidebarOpened&quot;</span><br>  :background-color=<span class=\"hljs-string\">&quot;$store.getters.cssVar.menuBg&quot;</span><br>  :text-color=<span class=\"hljs-string\">&quot;$store.getters.cssVar.menuText&quot;</span><br>  :active-text-color=<span class=\"hljs-string\">&quot;$store.getters.cssVar.menuActiveText&quot;</span><br>  :unique-opened=<span class=\"hljs-string\">&quot;true&quot;</span><br>  router<br>&gt;<br></code></pre></td></tr></table></figure>\n\n<p>此处的 背景色是通过 <code>getters</code> 进行指定的，该 <code>cssVar</code> 的 <code>getters</code> 为：</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\"><span class=\"hljs-attr\">cssVar</span>: <span class=\"hljs-function\"><span class=\"hljs-params\">state</span> =&gt;</span> variables,<br></code></pre></td></tr></table></figure>\n\n<p>所以，我们想要修改 <strong>自定义主题</strong> ，只需要从这里入手即可。</p>\n<p><strong>根据当前保存的 <code>mainColor</code> 覆盖原有的默认色值</strong></p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\"><span class=\"hljs-keyword\">import</span> variables <span class=\"hljs-keyword\">from</span> <span class=\"hljs-string\">&#x27;@/styles/variables.scss&#x27;</span><br><span class=\"hljs-keyword\">import</span> &#123; <span class=\"hljs-variable constant_\">MAIN_COLOR</span> &#125; <span class=\"hljs-keyword\">from</span> <span class=\"hljs-string\">&#x27;@/constant&#x27;</span><br><span class=\"hljs-keyword\">import</span> &#123; getItem &#125; <span class=\"hljs-keyword\">from</span> <span class=\"hljs-string\">&#x27;@/utils/storage&#x27;</span><br><span class=\"hljs-keyword\">import</span> &#123; generateColors &#125; <span class=\"hljs-keyword\">from</span> <span class=\"hljs-string\">&#x27;@/utils/theme&#x27;</span><br><br><span class=\"hljs-keyword\">const</span> getters = &#123;<br>  ...<br>  <span class=\"hljs-attr\">cssVar</span>: <span class=\"hljs-function\"><span class=\"hljs-params\">state</span> =&gt;</span> &#123;<br>    <span class=\"hljs-keyword\">return</span> &#123;<br>      ...variables,<br>      ...<span class=\"hljs-title function_\">generateColors</span>(<span class=\"hljs-title function_\">getItem</span>(<span class=\"hljs-variable constant_\">MAIN_COLOR</span>))<br>    &#125;<br>  &#125;,<br>  ...<br>&#125;<br><span class=\"hljs-keyword\">export</span> <span class=\"hljs-keyword\">default</span> getters<br><br></code></pre></td></tr></table></figure>\n\n<p>但是我们这样设定之后，整个自定义主题变更，还存在两个问题：</p>\n<ol>\n<li><code>menuBg</code> 背景颜色没有变化</li>\n</ol>\n<p>这个问题是因为咱们的 <code>sidebar</code> 的背景色未被替换，所以我们可以在 <code>layout/index</code> 中设置 <code>sidebar</code> 的 <code>backgroundColor</code></p>\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs html\"><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">sidebar</span></span><br><span class=\"hljs-tag\">  <span class=\"hljs-attr\">id</span>=<span class=\"hljs-string\">&quot;guide-sidebar&quot;</span></span><br><span class=\"hljs-tag\">  <span class=\"hljs-attr\">class</span>=<span class=\"hljs-string\">&quot;sidebar-container&quot;</span></span><br><span class=\"hljs-tag\">  <span class=\"hljs-attr\">:style</span>=<span class=\"hljs-string\">&quot;&#123; backgroundColor: $store.getters.cssVar.menuBg &#125;&quot;</span></span><br><span class=\"hljs-tag\">/&gt;</span><br></code></pre></td></tr></table></figure>\n\n<ol start=\"2\">\n<li>主题色替换之后，需要刷新页面才可响应</li>\n</ol>\n<p>这个是因为 <code>getters</code> 中没有监听到 <strong>依赖值的响应变化</strong>，所以我们希望修改依赖值</p>\n<p>在 <code>store/modules/theme</code> 中</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\">...<br><span class=\"hljs-keyword\">import</span> variables <span class=\"hljs-keyword\">from</span> <span class=\"hljs-string\">&#x27;@/styles/variables.scss&#x27;</span><br><span class=\"hljs-keyword\">export</span> <span class=\"hljs-keyword\">default</span> &#123;<br>  <span class=\"hljs-attr\">namespaced</span>: <span class=\"hljs-literal\">true</span>,<br>  <span class=\"hljs-attr\">state</span>: <span class=\"hljs-function\">() =&gt;</span> (&#123;<br>    ...<br>    variables<br>  &#125;),<br>  <span class=\"hljs-attr\">mutations</span>: &#123;<br>    <span class=\"hljs-comment\">/**</span><br><span class=\"hljs-comment\">     * 设置主题色</span><br><span class=\"hljs-comment\">     */</span><br>    <span class=\"hljs-title function_\">setMainColor</span>(<span class=\"hljs-params\">state, newColor</span>) &#123;<br>      ...<br>      state.<span class=\"hljs-property\">variables</span>.<span class=\"hljs-property\">menuBg</span> = newColor<br>      ...<br>    &#125;<br>  &#125;<br>&#125;<br><br></code></pre></td></tr></table></figure>\n\n<p>在 <code>getters</code> 中</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\">....<br><br><span class=\"hljs-keyword\">const</span> getters = &#123;<br> ...<br>  <span class=\"hljs-attr\">cssVar</span>: <span class=\"hljs-function\"><span class=\"hljs-params\">state</span> =&gt;</span> &#123;<br>    <span class=\"hljs-keyword\">return</span> &#123;<br>      ...state.<span class=\"hljs-property\">theme</span>.<span class=\"hljs-property\">variables</span>,<br>      ...<span class=\"hljs-title function_\">generateColors</span>(<span class=\"hljs-title function_\">getItem</span>(<span class=\"hljs-variable constant_\">MAIN_COLOR</span>))<br>    &#125;<br>  &#125;,<br>  ...<br>&#125;<br><span class=\"hljs-keyword\">export</span> <span class=\"hljs-keyword\">default</span> getters<br><br></code></pre></td></tr></table></figure>\n\n<p>那么到这里整个自定义主题我们就处理完成了。</p>\n<p>对于 <strong>自定义主题而言</strong>，核心的原理其实就是 <strong>修改<code>scss</code>变量来进行实现主题色变化</strong> </p>\n<p>明确好了原理之后，对后续实现的步骤就具体情况具体分析了。</p>\n<ol>\n<li>对于 <code>element-plus</code>：因为 <code>element-plus</code> 是第三方的包，所以它 <strong>不是完全可控</strong> 的，那么对于这种最简单直白的方案，就是直接拿到它编译后的 <code>css</code> 进行色值替换，利用 <code>style</code> <strong>内部样式表</strong> 优先级高于 <strong>外部样式表</strong> 的特性，来进行主题替换</li>\n<li>对于自定义主题：因为自定义主题是 <strong>完全可控</strong> 的，所以我们实现起来就轻松很多，只需要修改对应的 <code>scss</code>变量即可</li>\n</ol>\n<p>那么在之后大家遇到 <strong>自定义主题</strong> 的处理时，就可以按照这里所梳理的方案进行处理了。</p>\n<h1 id=\"结束语\"><a href=\"#结束语\" class=\"headerlink\" title=\"结束语\"></a>结束语</h1><p>这一章我们花了大量的篇幅来介绍换肤的原理以及业务场景如何实现换肤，篇幅有点长，就不在此添加其他功能的描述了。</p>\n<p>如下功能我们放到下一章节去实现：</p>\n<ul>\n<li>screenfull</li>\n<li>headerSearch</li>\n<li>tagView</li>\n<li>guide</li>\n</ul>\n<h1 id=\"参考链接\"><a href=\"#参考链接\" class=\"headerlink\" title=\"参考链接\"></a>参考链接</h1><ul>\n<li><a href=\"https://www.ruanyifeng.com/blog/2017/05/css-variables.html\">CSS变量教程</a></li>\n</ul>\n"},{"layout":"Vue3","title":"Vue3项目实战(四)：Layout架构实现","date":"2022-12-24T07:00:48.000Z","banner_img":"/img/layout.png","index_img":"/img/layout.png","excerpt":"layout架构实现，包括动态菜单栏、动态的面包屑等方案、侧边栏伸缩动画、退出的通用逻辑封装以及Vue3.2版本中的组件状态驱动的动态 CSS 值等等。","_content":"\n# 实现 layout 布局\n\n首先，我们要改造 `layout/index.vue`，先定义好结构，然后写样式即可。\n\n```html\n<div class=\"app-wrapper\">\n  <!-- 左侧 menu -->\n  <siderbar class=\"sidebar-container\"></siderbar>\n\n  <div class=\"main-container\">\n    <div class=\"fixed-header\">\n      <!-- 顶部 -->\n      <nav-bar></nav-bar>\n    </div>\n\n    <!-- 主要内容 -->\n    <app-main></app-main>\n  </div>\n</div>\n```\n\n结构定义好了，我再定义样式以及样式文件。在 `src` 下创建 `styles` 文件夹，主要存放 `scss` 的一些样式文件，其中就包括通用的 `reset.scss` 文件，处理基础的 html 元素样式。`mixin.scss` 编写通用的样式表，定义通用的样式变量 `variables.scss`。\n\n```scss\n// styles/index.scss\n\n@import './reset.scss';\n@import './variables.scss';\n@import './mixin.scss';\n@import './sidebar.scss';\n```\n\n## scss 的使用技巧\n\n这里我们主要看下 `mixin.scss` 和 `variables.scss` 的一些技巧和用法：\n\n- mixin.scss\n\n```css\n/* 清除浮动，在 .vue 文件中使用的时候直接引用即可：@include clearfix; */\n@mixin clearfix {\n  &:after {\n    content: '';\n    display: table;\n    clear: both;\n  }\n}\n\n/* 滚动条的设置 */\n@mixin scrollBar {\n  &::-webkit-scrollbar-track-piece {\n    background: #d3dce6;\n  }\n\n  &::-webkit-scrollbar {\n    width: 6px;\n  }\n\n  &::-webkit-scrollbar-thumb {\n    background: #99a9bf;\n    border-radius: 20px;\n  }\n}\n\n@mixin relative {\n  position: relative;\n  width: 100%;\n  height: 100%;\n}\n\n\n```\n- variables.scss\n\n```scss\n// sidebar\n$menuText: #bfcbd9;\n$menuActiveText: #ffffff;\n$subMenuActiveText: #f4f4f5;\n\n$menuBg: #304156;\n$menuHover: #263445;\n\n$subMenuBg: #1f2d3d;\n$subMenuHover: #001528;\n\n$sideBarWidth: 210px;\n$hideSideBarWidth: 54px;\n$sideBarDuration: 0.28s;\n\n// https://www.bluematador.com/blog/how-to-share-variables-between-js-and-sass\n// JS 与 scss 共享变量，在 scss 中通过 :export 进行导出，在 js 中可通过 ESM 进行导入\n:export {\n  menuText: $menuText;\n  menuActiveText: $menuActiveText;\n  subMenuActiveText: $subMenuActiveText;\n  menuBg: $menuBg;\n  menuHover: $menuHover;\n  subMenuBg: $subMenuBg;\n  subMenuHover: $subMenuHover;\n  sideBarWidth: $sideBarWidth;\n}\n\n```\n\n关于 `:export` 的使用方式，我们可以查阅一些文档：\n\n> https://www.bluematador.com/blog/how-to-share-variables-between-js-and-sass\n\n## 编写 `layout/index.vue` 样式\n```scss\n<style lang=\"scss\" scoped>\n@import '~@/styles/mixin.scss';\n@import '~@/styles/variables.scss';\n\n.app-wrapper {\n  @include clearfix; // 使用 mixin 中的样式\n  position: relative;\n  height: 100%;\n  width: 100%;\n}\n\n.fixed-header {\n  position: fixed;\n  top: 0;\n  right: 0;\n  z-index: 9;\n  width: calc(100% - #{$sideBarWidth});\n}\n</style>\n```\n\n## 给 SideBar 赋予动态的背景色\n```js\n<template>\n...\n  <!-- 左侧 menu -->\n  <sidebar\n    class=\"sidebar-container\"\n    :style=\"{ backgroundColor: variables.menuBg }\"\n  />\n...\n</template>\n\n<script setup>\n// scss 通过 :export 导出了变量\nimport variables from '@/styles/variables.scss'\n</script>\n```\n\n## script导入scss文件报错\n\n在 vue 项目里引用.scss文件，vscode编辑器会有红色波浪线，提示找不到模块\n\n![](/img/import-scss-error.png)\n\n找到 `shims-vue.d.ts` 声明文件，添加如下代码:\n\n```js\ndeclare module '*.scss' {\n  const css: {\n    // 定义的变量，通过 `variables.menuBg` 取值时，就不会报错了\n    menuBg: string;\n  }\n  export default css\n}\n```\n\n将来，新增了新的样式变量，我们在 css 下添加即可。\n\n## 设置NavBar样式和头像布局\n\n```js\n<template>\n  <div class=\"navbar\">\n    <div class=\"right-menu\">\n      <el-dropdown class=\"avatar-container\" trigger=\"click\">\n        <div class=\"avatar-wrapper\">\n          <el-avatar\n            shape=\"square\"\n            :size=\"40\"\n            :src=\"'https://fuss10.elemecdn.com/e/5d/4a731a90594a4af544c0c25941171jpeg.jpeg'\"\n          ></el-avatar>\n          <el-icon><Tools /></el-icon>\n        </div>\n        <template #dropdown>\n          <el-dropdown-menu class=\"user-dropdown\">\n            <router-link to=\"/\">\n              <el-dropdown-item> 主页 </el-dropdown-item>\n            </router-link>\n            <a target=\"_blank\" href=\"\">\n              <el-dropdown-item>Vue3</el-dropdown-item>\n            </a>\n            <el-dropdown-item divided> 退出 </el-dropdown-item>\n          </el-dropdown-menu>\n        </template>\n      </el-dropdown>\n    </div>\n  </div>\n</template>\n\n<script setup lang=\"ts\">\nimport { ref, reactive } from 'vue'\nimport { Tools } from '@element-plus/icons-vue'\n</script>\n<style scoped lang=\"scss\">\n.navbar {\n  height: 50px;\n  overflow: hidden;\n  position: relative;\n  background: #fff;\n  box-shadow: 0 1px 4px rgba(0, 21, 41, 0.08);\n\n  .right-menu {\n    display: flex;\n    align-items: center;\n    float: right;\n    padding-right: 16px;\n\n    ::v-deep .right-menu-item {\n      display: inline-block;\n      padding: 0 18px 0 0;\n      font-size: 24px;\n      color: #5a5e66;\n      vertical-align: text-bottom;\n\n      &.hover-effect {\n        cursor: pointer;\n        transition: background 0.3s;\n\n        &:hover {\n          background: rgba(0, 0, 0, 0.025);\n        }\n      }\n    }\n\n    ::v-deep .avatar-container {\n      cursor: pointer;\n      .avatar-wrapper {\n        margin-top: 5px;\n        position: relative;\n        .el-avatar {\n          --el-avatar-background-color: none;\n          margin-right: 12px;\n        }\n      }\n    }\n  }\n}\n</style>\n```\n\n## 效果图\n\n![](/img/layout-base.png)\n\n# 获取用户信息\n\n到目前为止，头像是静态的，也没有实现登出的逻辑，现在来实现一下。\n\n## 设置请求头\n\n我们不希望每次调接口时，都去设置 `token`，那么我们可以在 `请求拦截器` 中去设置:\n\n```js\nservice.interceptors.request.use(\n  config => {\n    if (store.getters.token) {\n      config.headers.Authorization = `Baerer ${store.getters.token}`\n    }\n\n    return config\n  },\n  error => {\n    return Promise.reject(error)\n  }\n)\n```\n\n## 编写 userInfo 接口\n\n简单实现一下 `/userinfo` 接口，主要是模拟前后端联调的流程。\n\n```js\nconst express = require('express');\nconst app = express()\n\napp.get('/userinfo', (req, res) => {\n  // 存在 token，可以返回用户信息\n  if (req.headers['authorization']) {\n\n    res.json({\n      code: 0,\n      data: {\n        avatar: 'https://fuss10.elemecdn.com/e/5d/4a731a90594a4af544c0c25941171jpeg.jpeg',\n        name: 'Hello_AlexCc',\n        id: 1,\n        role: 'super_admin'\n      },\n      message: '获取用户信息成功',\n      success: true,\n    })\n  }\n})\n\napp.listen(9999, () => {\n  console.log('server site an port 9999 ...')\n})\n```\n\n## 调用 userInfo 接口时机\n\n我们的 `userInfo` 接口已经编写好了，那么我们在什么时候调用呢？\n\n很显然，我们需要在 `permission.ts` 中去调用，当用户登录才有 `token`，也就是说，我们可以在 `token` 存在时，并且 `to.path` 不等于 `/login` 的时候去调用用户信息接口。\n\n```js\nif (store.getters.token) {\n  if (to.path === '/login') {\n    next('/')\n  } else {\n    // 调用用户信息接口\n    await store.dispatch('user/getUserInfo')\n\n    next()\n  }\n}\n```\n\n我们获取用户信息接口的动作，放在了 `module user` 的 `actions` 中：\n\n```js\n// module/user.ts\n\n// state\nstate: () => ({\n  token: getItem('token') || '',\n  userinfo: {}\n}),\n\n// actions\nasync getUserInfo(context) {\n  const info = await getUserInfo()\n  context.commit('setUserInfo', info)\n  return info\n},\n```\n\n方便使用 `userInfo`，我们可以将其放到 `getters` 中：\n\n```js\nconst getters = {\n  token: (state) => state.user.token,\n  userInfo: (state) => state.user.userinfo\n}\n```\n\n最后，我们就能在 `NavBar` 使用获取到的用户信息了。\n\n```html\n<el-avatar\n  shape=\"square\"\n  :size=\"40\"\n  :src=\"$store.getters.userInfo.avatar\"\n></el-avatar>\n```\n\n**避免重复调用 userInfo 接口**\n\n我们发现，每次切换路由时，都会触发路由的前置守卫，从而多次触发 `getUserInfo` 接口，我们把这个问题解决一下\n\n1. 在 store 中定义 `hasUserInfo`，用来判断是否已经有用户信息了，如果有用户信息，我们就不要再触发 `getUserInfo` 接口了\n\n```js\n// getters.ts\n\nhasUserInfo: (state) => {\n  // 如果用户信息存在，return true\n  return JSON.stringify(state.user.userinfo) !== '{}'\n}\n```\n\n2. 修改 `permission.ts` 文件，只有 `hasUserInfo` 为 `false` 时，我们才调用用户信息接口\n\n```js\nif (store.getters.token) {\n  if (to.path === '/login') {\n    next('/')\n  } else {\n    if (!store.getters.hasUserInfo) {\n      await store.dispatch('user/getUserInfo')\n    }\n\n    next()\n  }\n}\n```\n\n# 登出逻辑\n\n登出分为两种形式：\n\n- 用户主动退出\n- 用户被动登录（token 过去 | 账号被挤）\n\n不管以何种形式退出，登出的逻辑都是相同的。\n\n- 清理掉用户的缓存数据\n- 清理掉权限相关的配置\n- 返回到登录页\n\n登出的逻辑，我们也可以写在 `module user` 中去处理。\n\n主要执行 3 个步骤：\n\n- 清空 store token\n- 清除浏览器本地存储\n- 跳转到 login 页\n\n```js\nlogout(context: any) {\n  context.commit('setToken', '')\n  removeAllItem()\n  router.push('/login')\n}\n```\n\n## 主动退出\n\n用户点击登录按钮，通过 store dispatch 触发 action 的 logout 即可。\n\n## 被动退出\n\n被动退出大概分为两种：\n\n- token 失效\n- 账号被挤下去\n\n那么这两种场景下，在前端对应的处理方案一共也分为两种，共分为 主动处理 、被动处理 两种 ：\n\n- 主动处理：主要应对 token 失效\n- 被动处理：同时应对 token 失效 与 单点登录（账号被挤）\n\n### 用户被动退出解决方案之主动处理\n为了保证用户的信息安全，那么对于 token 而言就被制定了很多的安全策略，比如：\n\n- 动态 token（可变 token）\n- 刷新 token\n- 时效 token\n...\n\n我们这里采用 `时效 token`。\n\n那么对应到我们代码中的实现方案为：\n\n- 在用户登陆时，记录当前 登录时间\n- 制定一个 失效时长\n- 在接口调用时，根据 `当前时间` 对比 `登录时间` ，看是否超过了 `时效时长`\n  - 如果未超过，则正常进行后续操作\n  - 如果超过，则进行 退出登录 操作\n\n### 代码实现\n\n创建 `utils/auth.js` 文件，并写入以下代码：\n\n```js\nimport { TIME_STAMP, TOKEN_TIMEOUT_VALUE } from '@/constant'\nimport { setItem, getItem } from '@/utils/storage'\n/**\n * 获取时间戳\n */\nexport function getTimeStamp() {\n  return getItem(TIME_STAMP)\n}\n/**\n * 设置时间戳\n */\nexport function setTimeStamp() {\n  setItem(TIME_STAMP, Date.now())\n}\n/**\n * 是否超时\n */\nexport function isCheckTimeout() {\n  // 当前时间戳\n  var currentTime = Date.now()\n  // 缓存时间戳\n  var timeStamp = getTimeStamp()\n  return currentTime - timeStamp > TOKEN_TIMEOUT_VALUE\n}\n```\n\n在 `constant` 中声明对应常量：\n\n```js\n// token 时间戳\nexport const TIME_STAMP = 'timeStamp'\n// 超时时长(毫秒) 两小时\nexport const TOKEN_TIMEOUT_VALUE = 2 * 60 * 60 * 1000\n```\n\n在用户登录成功之后去设置时间，到 `store/user.js` 的 `login` 中：\n\n```js\nimport { setTimeStamp } from '@/utils/auth'\n\nlogin(context, userInfo) {\n  ...\n  return new Promise((resolve, reject) => {\n    ...\n      .then(data => {\n        ...\n        // 保存登录时间\n        setTimeStamp()\n        resolve()\n      })\n  })\n},\n```\n\n在 `utils/request` 对应的请求拦截器中进行 **主动介入**\n\n```js\nimport { isCheckTimeout } from '@/utils/auth'\n\nif (store.getters.token) {\n  if (isCheckTimeout()) {\n    // 登出操作\n    store.dispatch('user/logout')\n\n    // 失败的话，会走到 interceptors.response 的 error 方法。\n    return Promise.reject(new Error('token 失效'))\n  }\n  ...\n}\n```\n\n那么至此我们就完成了 **主动处理** 对应的业务逻辑。\n\n### 用户被动退出解决方案之被动处理\n\n**背景：**\n\n首先我们需要先明确 **被动处理** 需要应对两种业务场景：\n\n1. `token` 过期\n2.  单点登录\n\n然后我们一个一个来去看，首先是 `token` 过期\n\n> 我们知道对于 `token` 而言，本身就是具备时效的，这个是在服务端生成 `token` 时就已经确定的。\n>\n> 而此时我们所谓的 `token` 过期指的就是：\n>\n> **服务端生成的 `token` 超过 服务端指定时效** 的过程，就像我们前端项目指定 token 的失效性一样。\n\n而对于 单点登录 而言，指的是： \n\n> 当用户 A 登录之后，`token` 过期之前。\n>\n>  用户 A 的账号在其他的设备中进行了二次登录，导致第一次登录的 A 账号被 “顶下来” 的过程。\n>\n> 即：**同一账户仅可以在一个设备中保持在线状态**\n\n那么明确好了对应的背景之后，接下来我们来看对应的业务处理场景：\n\n从背景中我们知道，以上的两种情况，都是在 **服务端进行判断的**，而对于前端而言其实是 **服务端通知前端的一个过程。**\n\n所以说对于其业务处理，将遵循以下逻辑：\n\n1. 服务端返回数据时，会通过特定的状态码通知前端\n2. 当前端接收到特定状态码时，表示遇到了特定状态：**`token` 时效** 或 **单点登录**\n3. 此时进行 **退出登录** 处理\n\n这里只做了 token 的过期处理，如果需要到 **单点登录** 时，只需要增加一个状态码判断即可。\n\n**服务端超时间逻辑**\n我们来简单实现一下后端的超时逻辑。\n\n我们通过 `app.use` 添加了一个中间件，每一次前端触发了接口请求，都会先走这个中间件逻辑。\n\n服务器启动时，我们把 `now` 和 `current` 设置当前时间戳，当有一个接口触发了，会将 `current` 设置新的时间戳。\n\n\n\n```js\nconst express = require('express');\nconst app = express()\n\n// token 超时 2h\nconst TOKEN_TIMEOUT_VALUE = 2 * 60 * 60 * 1000\nlet now = Date.now()\nlet current = Date.now()\n\napp.use(function(req, res, next) {\n  // 每次有接口调用，触发中间件，将 current 更新\n  current = Date.now()\n\n  // 如果是登录逻辑，我们将 now 设置为 current，这样就不会触发超时逻辑\n  // 重新登录，继续走此判断，将 now 设置为 current\n  if (req.path === '/login') {\n    now = current\n  }\n\n  // 每次中间件都会将 current 更新为当前时间戳，一旦时间戳的差值，大于了 2h，就会触发 超时逻辑\n  if (current - now > TOKEN_TIMEOUT_VALUE) {\n    // 超时\n    res.status(401).send({\n      code: 401,\n      message: '服务端message: token 失效啦',\n      success: false,\n    })\n  } else {\n\n    // 没有超时，将执行权交给下一个路由\n    next()\n  }\n})\n```\n\n\n**那么明确好了业务之后，接下来我们来实现前端对应代码：**\n\n在 `utils/request` 的响应拦截器中，增加以下逻辑：\n\n```js\n// 响应拦截器\nservice.interceptors.response.use(\n  response => {\n    ...\n  },\n  error => {\n    // 处理 token 超时问题\n    if (\n      error.response &&\n      error.response.data &&\n      error.response.data.code === 401\n    ) {\n      store.dispatch('user/logout')\n    }\n\n    if (error.response && error.response.data && error.response.data.message) {\n      ElMessage.error(error.response.data.message) // 提示服务端抛出的错误信息\n    } else {\n      ElMessage.error(error.message)\n    }\n    return Promise.reject(error)\n  }\n)\n```\n\n那么至此，我们就已经完成了 **整个用户退出** 方案。\n\n# Sidebar 动态菜单\n\n接下来我们来处理 动态menu菜单。\n\n临时的 menu 菜单，创建 `layout/Sidebar/SidebarMenu` 文件\n\n```js\n<template>\n  <!-- 一级 menu 菜单 -->\n  <el-menu\n    {/* 只允许一个菜单展开 */}\n    :uniqueOpened=\"true\"\n    default-active=\"1\"\n    background-color=\"#545c64\"\n    text-color=\"#fff\"\n    active-text-color=\"#ffd04b\"\n  >\n    <!-- 子集 menu 菜单 -->\n    <el-sub-menu index=\"1\">\n      <template #title>\n        <el-icon><location /></el-icon>\n        <span>导航一</span>\n      </template>\n      <el-menu-item index=\"1-1\">选项1</el-menu-item>\n      <el-menu-item index=\"1-2\">选项2</el-menu-item>\n    </el-sub-menu>\n    <!-- 具体菜单项 -->\n    <el-menu-item index=\"4\">\n      <el-icon><setting /></el-icon>\n      <template #title>导航四</template>\n    </el-menu-item>\n  </el-menu>\n</template>\n\n<script setup lang=\"ts\">\nimport { ref, reactive } from 'vue'\nimport { Location, Setting } from '@element-plus/icons-vue'\n</script>\n<style scoped></style>\n```\n\n在 `layout/Sidebar/index` 中导入该组件\n\n```js\n<template>\n  <div class=\"\">\n    <h1>占位</h1>\n    <el-scrollbar>\n      <sidebar-menu></sidebar-menu>\n    </el-scrollbar>\n  </div>\n</template>\n\n<script setup>\nimport SidebarMenu from './SidebarMenu'\nimport {} from 'vue'\n</script>\n```\n\n那么至此我们生成了一个临时的 `menu` 菜单，从这个临时的 `menu` 菜单出可以看到，`el-menu` 其实分成了三个部分：\n\n1. `el-menu`：整个 `menu` 菜单\n2. `el-submenu`：子集 `menu` 菜单\n3. `el-menu-item`：具体菜单项\n\n那么明确好了这些内容之后，接下来我们就可以来去分析一下 **动态 `menu` 菜单如何生成了**\n\n## 动态menu菜单处理方案解析\n\n**动态`menu`菜单** 其实主要是和 **动态路由表**  配合来去实现 **用户权限** 的。\n\n但是 **用户权限处理** 目前还未涉及到，因为咱们想要处理 **用户权限** 还需要先去处理很多的业务场景，所以暂时先只处理 **动态`menu`菜单** 。\n\n所谓 **动态`menu`菜单** 指的是：\n\n> 根据路由表的配置，自动生成对应的 `menu` 菜单。\n>\n> 当路由表发生变化时，`menu` 菜单自动发生变化\n\n那么明确了 **动态`menu`菜单** 的含义之后，接下来咱们就需要来明确 **动态`menu`菜单** 的实现方案：\n\n1. 定义 **路由表** 对应 **`menu` 菜单规则**\n2. 根据规则制定 **路由表**\n3. 根据规则，依据 **路由表** ，生成 **`menu` 菜单**\n\n那么根据我们的实现方案可以发现，实现 **动态`menu`菜单** 最核心的关键点其实就在步骤一，也就是 \n\n> 定义 **路由表** 对应 **`menu` 菜单规则**\n\n那么下面我们就来看一下，这个规则如何制定：\n\n1. 对于单个路由规则而言（循环）：\n   1. 如果存在 `meta && meta.title && meta.icon` ：则显示在 `menu` 菜单中，其中 `title` 为显示的内容，`icon` 为显示的图标\n      1. 如果存在 `children` ：则以 `el-sub-menu（子菜单）` 展示\n      2. 否则：则以 `el-menu-item（菜单项）` 展示\n   2. 否则：不显示在 `menu` 菜单中\n\n那么明确好了对应的规则之后，接下来我们就可以来去看一下如何进行实现啦！\n\n## 生成项目页面组件\n\n明确了对应的方案之后，那么下面咱们就来实现对应的代码逻辑。\n\n根据我们的分析，想要完成动态的 `menu`，那么我们需要按照以下的步骤来去实现：\n\n1. 创建页面组件\n2. 生成路由表\n3. 解析路由表\n4. 生成 `menu` 菜单\n\n那么明确好了步骤之后，接下来我们就先来实现第一步\n\n**创建页面组件**\n\n在 `views` 文件夹下，创建如下页面：\n\n1. 创建文章：`article-create`\n2. 文章详情：`article-detail`\n3. 文章排名：`article-ranking`\n4. 错误页面：`error-page`\n   1. `404`\n   2. `401`\n5. 导入：`import`\n6. 权限列表：`permission-list`\n7. 个人中心：`profile`\n8. 角色列表：`role-list`\n9. 用户信息：`user-info`\n10. 用户管理：`user-manage`\n\n## 创建结构路由表\n\n想要实现结构路由表，那么我们需要先知道最终我们要实现的结构是什么样子的，大家来看下面的截图：\n\n<img src=\"/img/menu.png\" />\n\n这是我们最终要实现的 `menu` 截图。\n\n根据此截图，我们可以知道两点内容：\n\n1. 我们创建的页面并没有全部进行展示\n   1. 不显示页面表示 **不满足** 该条件 `meta && meta.title && meta.icon`\n\n2. `menu` 菜单将具备父子级的结构\n  1. 按照此结构规划数据，则数据应为\n    ```json\n    [\n        {\n            \"title\": \"个人中心\",\n            \"path\": \"\"\n        },\n        {\n            \"title\": \"用户\",\n            \"children\": [\n                {\n                    \"title\": \"员工管理\",\n                    \"path\": \"\"\n                },\n                {\n                    \"title\": \"角色列表\",\n                    \"path\": \"\"\n                },\n                {\n                    \"title\": \"权限列表\",\n                    \"path\": \"\"\n                }\n            ]\n        },\n        {\n            \"title\": \"文章\",\n            \"children\": [\n                {\n                    \"title\": \"文章排名\",\n                    \"path\": \"\"\n                },\n                {\n                    \"title\": \"创建文章\",\n                    \"path\": \"\"\n                }\n            ]\n        }\n    ]\n    ```\n\n又因为将来我们需要进行 **用户权限处理**，所以此时我们需要先对路由表进行一个划分：\n\n1. 私有路由表 `privateRoutes` ：权限路由\n2. 公有路由表 `publicRoutes`：无权限路由\n\n根据以上理论，生成以下路由表结构：\n\n```js\n/**\n * 私有路由表\n */\nconst privateRoutes = [\n  {\n    path: '/user',\n    component: layout,\n    redirect: '/user/manage',\n    meta: {\n      title: 'user',\n      icon: 'personnel'\n    },\n    children: [\n      {\n        path: '/user/manage',\n        component: () => import('@/views/user-manage/index'),\n        meta: {\n          title: 'userManage',\n          icon: 'personnel-manage'\n        }\n      },\n      {\n        path: '/user/role',\n        component: () => import('@/views/role-list/index'),\n        meta: {\n          title: 'roleList',\n          icon: 'role'\n        }\n      },\n      {\n        path: '/user/permission',\n        component: () => import('@/views/permission-list/index'),\n        meta: {\n          title: 'permissionList',\n          icon: 'permission'\n        }\n      },\n      {\n        path: '/user/info/:id',\n        name: 'userInfo',\n        component: () => import('@/views/user-info/index'),\n        meta: {\n          title: 'userInfo'\n        }\n      },\n      {\n        path: '/user/import',\n        name: 'import',\n        component: () => import('@/views/import/index'),\n        meta: {\n          title: 'excelImport'\n        }\n      }\n    ]\n  },\n  {\n    path: '/article',\n    component: layout,\n    redirect: '/article/ranking',\n    meta: {\n      title: 'article',\n      icon: 'article'\n    },\n    children: [\n      {\n        path: '/article/ranking',\n        component: () => import('@/views/article-ranking/index'),\n        meta: {\n          title: 'articleRanking',\n          icon: 'article-ranking'\n        }\n      },\n      {\n        path: '/article/:id',\n        component: () => import('@/views/article-detail/index'),\n        meta: {\n          title: 'articleDetail'\n        }\n      },\n      {\n        path: '/article/create',\n        component: () => import('@/views/article-create/index'),\n        meta: {\n          title: 'articleCreate',\n          icon: 'article-create'\n        }\n      },\n      {\n        path: '/article/editor/:id',\n        component: () => import('@/views/article-create/index'),\n        meta: {\n          title: 'articleEditor'\n        }\n      }\n    ]\n  }\n]\n\n/**\n * 公开路由表\n */\nconst publicRoutes = [\n  {\n    path: '/login',\n    component: () => import('@/views/login/index')\n  },\n  {\n    path: '/',\n    // 注意：带有路径“/”的记录中的组件“默认”是一个不返回 Promise 的函数\n    component: layout,\n    redirect: '/profile',\n    children: [\n      {\n        path: '/profile',\n        name: 'profile',\n        component: () => import('@/views/profile/index'),\n        meta: {\n          title: 'profile',\n          icon: 'el-icon-user'\n        }\n      },\n      {\n        path: '/404',\n        name: '404',\n        component: () => import('@/views/error-page/404')\n      },\n      {\n        path: '/401',\n        name: '401',\n        component: () => import('@/views/error-page/401')\n      }\n    ]\n  }\n]\n\nconst router = createRouter({\n  history: createWebHashHistory(),\n  routes: [...publicRoutes, ...privateRoutes]\n})\n```\n\n最后不要忘记在 `layout/appMain` 下设置路由出口\n\n```js\n<template>\n  <div class=\"app-main\">\n    <router-view></router-view>\n  </div>\n</template>\n```\n\n## 解析路由表，获取结构化数据\n\n想要获取路由表数据，那么有两种方式：\n\n\n1. [router.options.routes](https://next.router.vuejs.org/zh/api/#routes)：初始路由列表（[新增的路由](https://next.router.vuejs.org/zh/api/#addroute) 无法获取到）\n\n2. [router.getRoutes()](https://next.router.vuejs.org/zh/api/#getroutes)：获取所有 [路由记录](https://next.router.vuejs.org/zh/api/#routerecord) 的完整列表\n\n所以，我们此时使用 `router.getRoutes() ` 方法获取完整的路由列表\n\n在 `layout/components/Sidebar/SidebarMenu` 下写入以下代码：\n\n```js\n<script setup>\nimport { useRouter } from 'vue-router'\n\nconst router = useRouter()\nconsole.log(router.getRoutes())\n</script>\n```\n\n从返回的数据来看，它与我们想要的数据结构相去甚远。\n\n出现这个问题的原因，是因为它返回的是一个 **完整的路由表**\n\n这个路由表距离我们想要的存在两个问题：\n\n1. 存在重复的路由数据\n2. 不满足该条件 `meta && meta.title && meta.icon` 的数据不应该存在\n\n那么接下来我们就应该来处理这两个问题\n\n创建 `utils/route.ts` 文件，创建两个方法分别处理对应的两个问题：\n\n1. `filterRouters`\n2. `generateMenus`\n\n写入以下代码：\n\n```js\nimport path from 'path'\n\n/**\n * 返回所有子路由\n */\nconst getChildrenRoutes = routes => {\n  const result = []\n  routes.forEach(route => {\n    if (route.children && route.children.length > 0) {\n      result.push(...route.children)\n    }\n  })\n  return result\n}\n/**\n * 处理脱离层级的路由：某个一级路由为其他子路由，则剔除该一级路由，保留路由层级\n * @param {*} routes router.getRoutes()\n */\nexport const filterRouters = routes => {\n  const childrenRoutes = getChildrenRoutes(routes)\n  return routes.filter(route => {\n    return !childrenRoutes.find(childrenRoute => {\n      return childrenRoute.path === route.path\n    })\n  })\n}\n\n/**\n * 判断数据是否为空值\n */\nfunction isNull(data) {\n  if (!data) return true\n  if (JSON.stringify(data) === '{}') return true\n  if (JSON.stringify(data) === '[]') return true\n  return false\n}\n/**\n * 根据 routes 数据，返回对应 menu 规则数组\n */\nexport function generateMenus(routes, basePath = '') {\n  const result = []\n  // 遍历路由表\n  routes.forEach(item => {\n    // 不存在 children && 不存在 meta 直接 return\n    if (isNull(item.meta) && isNull(item.children)) return\n    // 存在 children 不存在 meta，进入迭代\n    if (isNull(item.meta) && !isNull(item.children)) {\n      result.push(...generateMenus(item.children))\n      return\n    }\n    // 合并 path 作为跳转路径\n    const routePath = path.resolve(basePath, item.path)\n    // 路由分离之后，存在同名父路由的情况，需要单独处理\n    let route = result.find(item => item.path === routePath)\n    if (!route) {\n      route = {\n        ...item,\n        path: routePath,\n        children: []\n      }\n\n      // icon 与 title 必须全部存在\n      if (route.meta.icon && route.meta.title) {\n        // meta 存在生成 route 对象，放入 arr\n        result.push(route)\n      }\n    }\n\n    // 存在 children 进入迭代到children\n    if (item.children) {\n      route.children.push(...generateMenus(item.children, route.path))\n    }\n  })\n  return result\n}\n\n```\n\n在 `SidebarMenu` 中调用该方法\n\n```js\n<script setup>\nimport { computed } from 'vue'\nimport { useRouter } from 'vue-router'\nimport { filterRouters, generateMenus } from '@/utils/route'\n\nconst router = useRouter()\nconst routes = computed(() => {\n  const filterRoutes = filterRouters(router.getRoutes())\n  return generateMenus(filterRoutes)\n})\nconsole.log(JSON.stringify(routes.value))\n</script>\n```\n\n得到该数据结构\n\n```json\n[\n    {\n        \"path\":\"/profile\",\n        \"name\":\"profile\",\n        \"meta\":{\n            \"title\":\"profile\",\n            \"icon\":\"el-icon-user\"\n        },\n    },\n    {\n        \"path\":\"/user\",\n        \"redirect\":\"/user/manage\",\n        \"meta\":{\n            \"title\":\"user\",\n            \"icon\":\"personnel\"\n        },\n        \"props\":{\n            \"default\":false\n        },\n        \"children\":[\n            {\n                \"path\":\"/user/manage\",\n                \"name\":\"userManage\",\n                \"meta\":{\n                    \"title\":\"userManage\",\n                    \"icon\":\"personnel-manage\"\n                },\n                \"children\":[\n\n                ]\n            },\n            {\n                \"path\":\"/user/role\",\n                \"name\":\"userRole\",\n                \"meta\":{\n                    \"title\":\"roleList\",\n                    \"icon\":\"role\"\n                },\n                \"children\":[\n\n                ]\n            },\n            {\n                \"path\":\"/user/permission\",\n                \"name\":\"userPermission\",\n                \"meta\":{\n                    \"title\":\"permissionList\",\n                    \"icon\":\"permission\"\n                },\n                \"children\":[\n\n                ]\n            }\n        ],\n    },\n    {\n        \"path\":\"/article\",\n        \"redirect\":\"/article/ranking\",\n        \"meta\":{\n            \"title\":\"article\",\n            \"icon\":\"article\"\n        },\n        \"props\":{\n            \"default\":false\n        },\n        \"children\":[\n            {\n                \"path\":\"/article/ranking\",\n                \"name\":\"articleRanking\",\n                \"meta\":{\n                    \"title\":\"articleRanking\",\n                    \"icon\":\"article-ranking\"\n                },\n                \"children\":[\n\n                ]\n            },\n            {\n                \"path\":\"/article/create\",\n                \"name\":\"articleCreate\",\n                \"meta\":{\n                    \"title\":\"articleCreate\",\n                    \"icon\":\"article-create\"\n                },\n                \"children\":[\n\n                ]\n            }\n        ],\n    }\n]\n```\n\n## 生成动态 menu 菜单\n\n有了数据结构之后，最后的步骤就水到渠成了\n\n整个 `menu` 菜单，我们将分成三个组件来进行处理\n\n1. `SidebarMenu`：处理数据，作为最顶层 `menu` 载体\n2. `SidebarItem`：根据数据处理 **当前项为 `el-submenu` || `el-menu-item`** \n3. `MenuItem`：处理 `el-menu-item` 样式\n\n那么下面我们一个个来处理\n\n首先是 `SidebarMenu` \n\n```js\n<template>\n  <!-- 一级 menu 菜单 -->\n  <el-menu\n    ...\n  >\n    <sidebar-item\n      v-for=\"item in routes\"\n      :key=\"item.path\"\n      :route=\"item\"\n    ></sidebar-item>\n  </el-menu>\n</template>\n\n```\n\n\n\n创建 `SidebarItem` 组件，用来根据数据处理 **当前项为 `el-sub-menu` || `el-menu-item`** \n\n```js\n<template>\n  <!-- 支持渲染多级 menu 菜单 -->\n  <el-sub-menu v-if=\"route.children.length > 0\" :index=\"route.path\">\n    <template #title>\n      <menu-item :title=\"route.meta.title\" :icon=\"route.meta.icon\"></menu-item>\n    </template>\n    <!-- 循环渲染 -->\n    <sidebar-item\n      v-for=\"item in route.children\"\n      :key=\"item.path\"\n      :route=\"item\"\n    ></sidebar-item>\n  </el-sub-menu>\n  <!-- 渲染 item 项 -->\n  <el-menu-item v-else :index=\"route.path\">\n    <menu-item :title=\"route.meta.title\" :icon=\"route.meta.icon\"></menu-item>\n  </el-menu-item>\n</template>\n\n<script setup>\nimport MenuItem from './MenuItem'\nimport { defineProps } from 'vue'\n// 定义 props\ndefineProps({\n  route: {\n    type: Object,\n    required: true\n  }\n})\n</script>\n```\n\n创建 `MenuItem` 用来处理 `el-menu-item` 样式\n\n```js\n<template>\n  <i v-if=\"icon.includes('el-icon')\" class=\"sub-el-icon\" :class=\"icon\"></i>\n  <svg-icon v-else :icon=\"icon\"></svg-icon>\n  <span>{{ title }}</span>\n</template>\n\n<script setup>\nimport { defineProps } from 'vue'\ndefineProps({\n  title: {\n    type: String,\n    required: true\n  },\n  icon: {\n    type: String,\n    required: true\n  }\n})\n</script>\n\n<style lang=\"scss\" scoped>\n</style>\n```\n\n至此，整个的 `menu` 菜单结构就已经完成了！\n\n## 修复最后残余问题\n\n目前 `menu` 菜单存在三个问题\n\n1. 样式问题\n2. 路由跳转问题\n3. 默认激活项\n\n**样式问题：**\n\n首先处理样式，因为后面我们需要处理 **主题替换** ，所以此处我们不能把样式写死。因为我们的样式变量都放在 `variables.scss` 文件中，并通过 `:export` 导出了变量以供 js 导入，每次使用都需要导入，比较麻烦，我们可以将其放在 `store getters` 中，以便 **快捷访问**。\n\n```js\nimport variables from '@/styles/variables.scss'\nconst getters = {\n  cssVar: () => variables\n}\nexport default getters\n```\n\n在 `SidebarMenu` 中写入如下样式\n\n```html\n<el-menu\n  :background-color=\"$store.getters.cssVar.menuBg\"\n  :text-color=\"$store.getters.cssVar.menuText\"\n  :active-text-color=\"$store.getters.cssVar.menuActiveText\"\n  :unique-opened=\"true\"\n>\n```\n\n**路由跳转问题：**\n\n为 `el-menu` 指定 `router`\n\n```html\n<el-menu\n  ...\n  router\n>\n```\n\n> 添加 router 属性\n>\n> 表示是否启用 vue-router 模式。 启用该模式会在激活导航时以 index 作为 path 进行路由跳转 使用 default-active 来设置加载时的激活项。\n\n**默认激活项：**\n\n根据当前 `url` 进行判断即可\n\n```js\n<el-menu\n  :default-active=\"activeMenu\"\n  ...\n>\n\n<script setup>\n...\n\n// 计算高亮 menu 的方法\nconst route = useRoute()\nconst activeMenu = computed(() => {\n  const { path } = route\n  return path\n})\n</script>\n```\n\n至此整个 **动态`menu`完成**\n\n## 左侧菜单伸缩功能实现\n\n下面我们来实现一个标准化功能 **左侧菜单伸缩** ，对于这个功能核心的点在于动画处理\n\n样式的改变总是由数据进行驱动，所以首先我们去创建对应的数据\n\n创建 `store/app` 模块，写入如下代码\n\n```js\nexport default {\n  namespaced: true,\n  state: () => ({\n    sidebarOpened: true\n  }),\n  mutations: {\n    triggerSidebarOpened(state) {\n      state.sidebarOpened = !state.sidebarOpened\n    }\n  },\n  actions: {}\n}\n\n```\n\n在 `store/index` 中进行导入\n\n```js\n...\nimport app from './modules/app'\nexport default createStore({\n  getters,\n  modules: {\n    ...\n    app\n  }\n})\n```\n\n在 `store/getters` 中创建快捷访问\n\n```js\nsidebarOpened: state => state.app.sidebarOpened\n```\n\n\n创建 `components/hamburger` 组件，用来控制数据\n\n```js\n<template>\n  <div class=\"hamburger-container\" @click=\"toggleClick\">\n    <svg-icon class=\"hamburger\" :icon=\"icon\"></svg-icon>\n  </div>\n</template>\n\n<script setup>\nimport { computed } from 'vue'\nimport { useStore } from 'vuex'\n\nconst store = useStore()\nconst toggleClick = () => {\n  store.commit('app/triggerSidebarOpened')\n}\n\nconst icon = computed(() =>\n  store.getters.sidebarOpened ? 'hamburger-opened' : 'hamburger-closed'\n)\n</script>\n\n<style lang=\"scss\" scoped>\n.hamburger-container {\n  padding: 0 16px;\n  .hamburger {\n    display: inline-block;\n    vertical-align: middle;\n    width: 20px;\n    height: 20px;\n  }\n}\n</style>\n```\n\n在 `navbar` 中使用该组件\n\n```js\n<template>\n  <div class=\"navbar\">\n    <hamburger class=\"hamburger-container\" />\n    ...\n  </div>\n</template>\n\n<script setup>\nimport Hamburger from '@/components/Hamburger'\n...\n</script>\n\n<style lang=\"scss\" scoped>\n.navbar {\n  ...\n\n  .hamburger-container {\n    line-height: 46px;\n    height: 100%;\n    float: left;\n    cursor: pointer;\n    // hover 动画\n    transition: background 0.5s;\n\n    &:hover {\n      background: rgba(0, 0, 0, 0.1);\n    }\n  }\n\n ...\n}\n</style>\n\n```\n\n在 `SidebarMenu` 中，控制 `el-menu` 的 [collapse](https://element-plus.org/#/zh-CN/component/menu) 属性\n\n```js\n<el-menu\n    :collapse=\"!$store.getters.sidebarOpened\"\n    ...\n```\n\n在 `layout/index` 中指定 **整个侧边栏的宽度和缩放动画**\n\n```js\n<div\n    class=\"app-wrapper\"\n    :class=\"[$store.getters.sidebarOpened ? 'openSidebar' : 'hideSidebar']\"\n  >\n  ...\n```\n\n在 `layout/index` 中 处理 `navbar` 的宽度\n\n```js\n<style lang=\"scss\" scoped>\n...\n\n.fixed-header {\n  position: fixed;\n  top: 0;\n  right: 0;\n  z-index: 9;\n  width: calc(100% - #{$sideBarWidth});\n  transition: width 0.28s;\n}\n\n.hideSidebar .fixed-header {\n  width: calc(100% - #{$hideSideBarWidth});\n}\n</style>\n```\n\n在 `styles/variables.scss` 中指定 `hideSideBarWidth`\n\n```scss\n$hideSideBarWidth: 54px;\n```\n\n\n\n## SidebarHeader 处理\n\n整个左侧的 `menu` 菜单，到现在咱们还剩下最后一个 `header` 没有进行处理\n\n在 `sidebar/index` 中写入如下代码\n\n```js\n<template>\n  <div class=\"\">\n    <div class=\"logo-container\">\n      <el-avatar\n        size=\"44\"\n        shape=\"square\"\n        src=\"https://m.imooc.com/static/wap/static/common/img/logo-small@2x.png\"\n      />\n      <h1 class=\"logo-title\" v-if=\"$store.getters.sidebarOpened\">\n       imooc-admin\n      </h1>\n    </div>\n    ...\n  </div>\n</template>\n\n<style lang=\"scss\" scoped>\n.logo-container {\n  height: 44px;\n  padding: 10px 0 22px 0;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  .logo-title {\n    margin-left: 10px;\n    color: #fff;\n    font-weight: 600;\n    line-height: 50px;\n    font-size: 16px;\n    white-space: nowrap;\n  }\n}\n</style>\n\n```\n\n创建 `styles/element.scss` 文件，统一处理 `el-avatar` 的背景问题\n\n```scss\n.el-avatar {\n  --el-avatar-background-color: none;\n}\n```\n\n在 `styles/index.scss` 中导入\n\n```scss\n...\n@import './element.scss';\n```\n\n统一处理下动画时长的问题，在 `styles/variables.scss` 中，加入以下变量\n\n```css\n$sideBarDuration: 0.28s;\n```\n\n为 `styles/sidebar.scss` 修改时长\n\n```scss\n  .main-container {\n    transition: margin-left #{$sideBarDuration};\n   ...\n  }\n\n  .sidebar-container {\n    transition: width #{$sideBarDuration};\n  \t...\n  }\n```\n\n为 `layout/index` 修改样式\n\n```scss\n.fixed-header {\n  ...\n  transition: width #{$sideBarDuration};\n}\n```\n\n# Vue3.2：组件状态驱动的动态 CSS 值\n\n在 [vue 3.2](https://blog.vuejs.org/posts/vue-3.2.html) 最新更新中，除了之前我们介绍的 **响应式变化** 之外，还有另外一个很重要的更新，那就是 **组件状态驱动的动态 `CSS` 值** ，对应的文档也已经公布，大家可以 [点击这里](https://v3.vuejs.org/api/sfc-style.html#state-driven-dynamic-css) 查看\n\n那么下面我们就使用下最新的特性，来为 `logo-container` 指定下高度：\n\n```js\n<template>\n ...\n <el-avatar\n \t:size=\"logoHeight\"\n ...\n\n</template>\n\n<script setup>\n...\nconst logoHeight = 44\n</script>\n\n<style lang=\"scss\" scoped>\n.logo-container {\n  height: v-bind(logoHeight) + 'px';\n...\n}\n</style>\n\n```\n\n# 动态面包屑方案分析\n\n面包屑导航分为：\n\n1. 静态面包屑\n2. 动态面包屑\n\n**静态面包屑：**\n\n指的是：**在每个页面中写死对应的面包屑菜单**，缺点也很明显：\n\n1. 每个页面都得写一遍\n2. 页面路径结构变化了，得手动更改\n\n简单来说就是 **不好维护，不好扩展** 。\n\n**动态面包屑：**\n\n根据当前的 `url` 自动生成面包屑导航菜单\n\n无论之后路径发生了什么变化，**动态面包屑** 都会正确的进行计算\n\n那么在后面的实现过程中，我们将会分成三大步来实现\n\n1. 创建、渲染基本的面包屑组件\n2. 计算面包屑结构数据\n3. 根据数据渲染动态面包屑内容\n\n## 渲染基本的面包屑组件\n\n完成第一步，先去创建并渲染出基本的 [面包屑](https://element-plus.org/#/zh-CN/component/breadcrumb) 组件\n\n创建 `components/Breadcrumb/index`，并写入如下代码：\n\n```js\n<template>\n  <el-breadcrumb class=\"breadcrumb\" separator=\"/\">\n    <el-breadcrumb-item :to=\"{ path: '/' }\">首页</el-breadcrumb-item>\n    <el-breadcrumb-item><a href=\"/\">活动管理</a></el-breadcrumb-item>\n    <el-breadcrumb-item>活动列表</el-breadcrumb-item>\n    <!-- 面包屑的最后一项 -->\n    <el-breadcrumb-item>\n      <span class=\"no-redirect\">活动详情</span>\n    </el-breadcrumb-item>\n  </el-breadcrumb>\n</template>\n\n<script setup>\nimport {} from 'vue'\n</script>\n\n<style lang=\"scss\" scoped>\n.breadcrumb {\n  display: inline-block;\n  font-size: 14px;\n  line-height: 50px;\n  margin-left: 8px;\n\n  ::v-deep .no-redirect {\n    color: #97a8be;\n    cursor: text;\n  }\n}\n</style>\n\n```\n\n在 `layout/components/Navbar` 组件下导入\n\n```js\n<template>\n  <div class=\"navbar\">\n    <hamburger class=\"hamburger-container\" />\n    <breadcrumb class=\"breadcrumb-container\" />\n\t...\n  </div>\n</template>\n...\n\n<style lang=\"scss\" scoped>\n.navbar {\n ...\n\n  .breadcrumb-container {\n    float: left;\n  }\n   ...\n}\n</style>\n\n```\n\n## 动态计算面包屑结构数据\n\n现在我们是完成了一个静态的 面包屑，接下来咱们就需要依托这个静态的菜单来完成动态的。\n\n对于现在的静态面包屑来说，他分成了两个组件：\n\n1. `el-breadcrumb`：包裹性质的容器\n2. `el-breadcrumb-item`：每个单独项\n\n如果我们想要完成动态的，那么就需要 **依据动态数据，渲染 `el-breadcrumb-item` **\n\n所以说接下来我们需要做的事情就很简单了\n\n1. 动态数据\n2. 渲染 `el-breadcrumb-item`\n\n咱们先来看 **动态数据如何制作**\n\n我们希望可以制作出一个 **数组**，数组中每个 `item` 都表示一个 **路由信息**：\n\n创建一个方法，用来生成数组数据，在这里我们要使用到 [route.match](https://next.router.vuejs.org/zh/api/#matched) 属性来：**获取与给定路由地址匹配的[标准化的路由记录](https://next.router.vuejs.org/zh/api/#routerecord)数组**\n\n如何理解上面这句话呢？其实我们将 `route.matched` 打印出来就可以发现，你每次切换菜单（或者说更换了路由），打印出来的就是当前路由的路由表（包含父级、子集的路由信息）。\n\n```js\n<script setup>\nimport { ref, reactive, watch } from 'vue'\nimport { useRoute, RouteRecordRaw } from 'vue-router'\n\nconst breadcrumbData = ref<RouteRecordRaw[]>([]) // 存放计算出的面包屑数据\n\nconst route = useRoute()\n\nconst getBreadcrumbData = () => {\n  console.log(route.matched)\n\n  // 只有存在 meta 并且 meta.title 的路由，我们才会显示到面包屑中\n  // 就像 menu 菜单一样，类似 404 login 的我们不要显示\n  breadcrumbData.value = route.matched.filter(r => r.meta && r.meta.title)\n}\n\n// 监听路由变化时触发\nwatch(\n  route,\n  () => {\n    getBreadcrumbData()\n  },\n  {\n    immediate: true\n  }\n)\n</script>\n```\n\n## 依据动态数据，渲染面包屑\n\n有了数据之后，根据数据来去渲染面包屑就比较简单了。\n\n```vue\n<template>\n  <el-breadcrumb class=\"breadcrumb\" separator=\"/\">\n    <el-breadcrumb-item\n      v-for=\"(item, index) in breadcrumbData\"\n      :key=\"item.path\"\n    >\n      <!-- 不可点击项 -->\n      <span v-if=\"index === breadcrumbData.length - 1\" class=\"no-redirect\">{{\n        item.meta.title\n      }}</span>\n      <!-- 可点击项 -->\n      <a v-else class=\"redirect\" @click.prevent=\"onLinkClick(item)\">{{\n        item.meta.title\n      }}</a>\n    </el-breadcrumb-item>\n  </el-breadcrumb>\n</template>\n\n<script setup>\nimport { ref, watch } from 'vue'\nimport { useRoute, useRouter, RouteRecordRaw } from 'vue-router'\nimport { useStore } from 'vuex'\n\nconst breadcrumbData = ref<RouteRecordRaw[]>([]) // 存放计算出的面包屑数据\n\nconst store = useStore()\nconst route = useRoute()\nconst router = useRouter()\nconst getBreadcrumbData = () => {\n  console.log(route.matched)\n\n  // 只有存在 meta 并且 meta.title 的路由，我们才会显示到面包屑中\n  // 就像 menu 菜单一样，类似 404 login 的我们不要显示\n  breadcrumbData.value = route.matched.filter(r => r.meta && r.meta.title)\n}\n\nwatch(\n  route,\n  () => {\n    getBreadcrumbData()\n  },\n  {\n    immediate: true\n  }\n)\n\n// 跳转路由\nconst onLinkClick = (item: RouteRecordRaw) => {\n  router.push(item.path)\n}\n\n// 将来需要进行主题替换，所以这里获取下动态样式\nconst linkHoverColor = ref(store.getters.cssVars.menuBg)\n</script>\n\n<style lang=\"scss\" scoped>\n.breadcrumb {\n ...\n\n  .redirect {\n    color: #666;\n    font-weight: 600;\n  }\n\n  .redirect:hover {\n    color: v-bind(linkHoverColor); // 应对主题切换\n  }\n}\n</style>\n\n```\n\n## 面包屑动画\n\nvue3对 [动画](https://v3.cn.vuejs.org/guide/transitions-overview.html#%E5%9F%BA%E4%BA%8E-class-%E7%9A%84%E5%8A%A8%E7%94%BB%E5%92%8C%E8%BF%87%E6%B8%A1) 进行了一些修改（[vue 动画迁移文档](https://v3.cn.vuejs.org/guide/migration/transition.html#%E6%A6%82%E8%A7%88)）\n\n主要的修改其实只有两个：\n\n1. 过渡类名 `v-enter` 修改为 `v-enter-from`\n2. 过渡类名 `v-leave` 修改为 `v-leave-from`\n\n那么依据修改之后的动画，我们来为面包屑增加一些动画样式：\n\n1. 在 `Breadcrumb/index` 中增加 `transition-group`\n\n```js\n  <template>\n    <el-breadcrumb class=\"breadcrumb\" separator=\"/\">\n      <transition-group name=\"breadcrumb\">\n        ...\n      </transition-group>\n    </el-breadcrumb>\n  </template>\n```\n\n2. 新建 `styles/transition` 样式文件\n\n```scss\n  .breadcrumb-enter-active,\n  .breadcrumb-leave-active {\n    transition: all 0.5s;\n  }\n\n  .breadcrumb-enter-from,\n  .breadcrumb-leave-active {\n    opacity: 0;\n    transform: translateX(20px);\n  }\n\n  .breadcrumb-leave-active {\n    position: absolute;\n  }\n```\n\n3. 在 `styles/index` 中导入\n\n```scss\n  @import './transition.scss';\n```\n\n# 总结\n\n到这里我们的 layout 整体架构就已经做完了，我们来看看效果吧。\n\n![](/img/layout-result.png)\n","source":"_posts/vue3-project-layout.md","raw":"---\nlayout: Vue3\ntitle: Vue3项目实战(四)：Layout架构实现\ndate: 2022-12-24 15:00:48\ntags: 工程化,Vue3\nbanner_img: /img/layout.png\nindex_img: /img/layout.png\nexcerpt: layout架构实现，包括动态菜单栏、动态的面包屑等方案、侧边栏伸缩动画、退出的通用逻辑封装以及Vue3.2版本中的组件状态驱动的动态 CSS 值等等。\n---\n\n# 实现 layout 布局\n\n首先，我们要改造 `layout/index.vue`，先定义好结构，然后写样式即可。\n\n```html\n<div class=\"app-wrapper\">\n  <!-- 左侧 menu -->\n  <siderbar class=\"sidebar-container\"></siderbar>\n\n  <div class=\"main-container\">\n    <div class=\"fixed-header\">\n      <!-- 顶部 -->\n      <nav-bar></nav-bar>\n    </div>\n\n    <!-- 主要内容 -->\n    <app-main></app-main>\n  </div>\n</div>\n```\n\n结构定义好了，我再定义样式以及样式文件。在 `src` 下创建 `styles` 文件夹，主要存放 `scss` 的一些样式文件，其中就包括通用的 `reset.scss` 文件，处理基础的 html 元素样式。`mixin.scss` 编写通用的样式表，定义通用的样式变量 `variables.scss`。\n\n```scss\n// styles/index.scss\n\n@import './reset.scss';\n@import './variables.scss';\n@import './mixin.scss';\n@import './sidebar.scss';\n```\n\n## scss 的使用技巧\n\n这里我们主要看下 `mixin.scss` 和 `variables.scss` 的一些技巧和用法：\n\n- mixin.scss\n\n```css\n/* 清除浮动，在 .vue 文件中使用的时候直接引用即可：@include clearfix; */\n@mixin clearfix {\n  &:after {\n    content: '';\n    display: table;\n    clear: both;\n  }\n}\n\n/* 滚动条的设置 */\n@mixin scrollBar {\n  &::-webkit-scrollbar-track-piece {\n    background: #d3dce6;\n  }\n\n  &::-webkit-scrollbar {\n    width: 6px;\n  }\n\n  &::-webkit-scrollbar-thumb {\n    background: #99a9bf;\n    border-radius: 20px;\n  }\n}\n\n@mixin relative {\n  position: relative;\n  width: 100%;\n  height: 100%;\n}\n\n\n```\n- variables.scss\n\n```scss\n// sidebar\n$menuText: #bfcbd9;\n$menuActiveText: #ffffff;\n$subMenuActiveText: #f4f4f5;\n\n$menuBg: #304156;\n$menuHover: #263445;\n\n$subMenuBg: #1f2d3d;\n$subMenuHover: #001528;\n\n$sideBarWidth: 210px;\n$hideSideBarWidth: 54px;\n$sideBarDuration: 0.28s;\n\n// https://www.bluematador.com/blog/how-to-share-variables-between-js-and-sass\n// JS 与 scss 共享变量，在 scss 中通过 :export 进行导出，在 js 中可通过 ESM 进行导入\n:export {\n  menuText: $menuText;\n  menuActiveText: $menuActiveText;\n  subMenuActiveText: $subMenuActiveText;\n  menuBg: $menuBg;\n  menuHover: $menuHover;\n  subMenuBg: $subMenuBg;\n  subMenuHover: $subMenuHover;\n  sideBarWidth: $sideBarWidth;\n}\n\n```\n\n关于 `:export` 的使用方式，我们可以查阅一些文档：\n\n> https://www.bluematador.com/blog/how-to-share-variables-between-js-and-sass\n\n## 编写 `layout/index.vue` 样式\n```scss\n<style lang=\"scss\" scoped>\n@import '~@/styles/mixin.scss';\n@import '~@/styles/variables.scss';\n\n.app-wrapper {\n  @include clearfix; // 使用 mixin 中的样式\n  position: relative;\n  height: 100%;\n  width: 100%;\n}\n\n.fixed-header {\n  position: fixed;\n  top: 0;\n  right: 0;\n  z-index: 9;\n  width: calc(100% - #{$sideBarWidth});\n}\n</style>\n```\n\n## 给 SideBar 赋予动态的背景色\n```js\n<template>\n...\n  <!-- 左侧 menu -->\n  <sidebar\n    class=\"sidebar-container\"\n    :style=\"{ backgroundColor: variables.menuBg }\"\n  />\n...\n</template>\n\n<script setup>\n// scss 通过 :export 导出了变量\nimport variables from '@/styles/variables.scss'\n</script>\n```\n\n## script导入scss文件报错\n\n在 vue 项目里引用.scss文件，vscode编辑器会有红色波浪线，提示找不到模块\n\n![](/img/import-scss-error.png)\n\n找到 `shims-vue.d.ts` 声明文件，添加如下代码:\n\n```js\ndeclare module '*.scss' {\n  const css: {\n    // 定义的变量，通过 `variables.menuBg` 取值时，就不会报错了\n    menuBg: string;\n  }\n  export default css\n}\n```\n\n将来，新增了新的样式变量，我们在 css 下添加即可。\n\n## 设置NavBar样式和头像布局\n\n```js\n<template>\n  <div class=\"navbar\">\n    <div class=\"right-menu\">\n      <el-dropdown class=\"avatar-container\" trigger=\"click\">\n        <div class=\"avatar-wrapper\">\n          <el-avatar\n            shape=\"square\"\n            :size=\"40\"\n            :src=\"'https://fuss10.elemecdn.com/e/5d/4a731a90594a4af544c0c25941171jpeg.jpeg'\"\n          ></el-avatar>\n          <el-icon><Tools /></el-icon>\n        </div>\n        <template #dropdown>\n          <el-dropdown-menu class=\"user-dropdown\">\n            <router-link to=\"/\">\n              <el-dropdown-item> 主页 </el-dropdown-item>\n            </router-link>\n            <a target=\"_blank\" href=\"\">\n              <el-dropdown-item>Vue3</el-dropdown-item>\n            </a>\n            <el-dropdown-item divided> 退出 </el-dropdown-item>\n          </el-dropdown-menu>\n        </template>\n      </el-dropdown>\n    </div>\n  </div>\n</template>\n\n<script setup lang=\"ts\">\nimport { ref, reactive } from 'vue'\nimport { Tools } from '@element-plus/icons-vue'\n</script>\n<style scoped lang=\"scss\">\n.navbar {\n  height: 50px;\n  overflow: hidden;\n  position: relative;\n  background: #fff;\n  box-shadow: 0 1px 4px rgba(0, 21, 41, 0.08);\n\n  .right-menu {\n    display: flex;\n    align-items: center;\n    float: right;\n    padding-right: 16px;\n\n    ::v-deep .right-menu-item {\n      display: inline-block;\n      padding: 0 18px 0 0;\n      font-size: 24px;\n      color: #5a5e66;\n      vertical-align: text-bottom;\n\n      &.hover-effect {\n        cursor: pointer;\n        transition: background 0.3s;\n\n        &:hover {\n          background: rgba(0, 0, 0, 0.025);\n        }\n      }\n    }\n\n    ::v-deep .avatar-container {\n      cursor: pointer;\n      .avatar-wrapper {\n        margin-top: 5px;\n        position: relative;\n        .el-avatar {\n          --el-avatar-background-color: none;\n          margin-right: 12px;\n        }\n      }\n    }\n  }\n}\n</style>\n```\n\n## 效果图\n\n![](/img/layout-base.png)\n\n# 获取用户信息\n\n到目前为止，头像是静态的，也没有实现登出的逻辑，现在来实现一下。\n\n## 设置请求头\n\n我们不希望每次调接口时，都去设置 `token`，那么我们可以在 `请求拦截器` 中去设置:\n\n```js\nservice.interceptors.request.use(\n  config => {\n    if (store.getters.token) {\n      config.headers.Authorization = `Baerer ${store.getters.token}`\n    }\n\n    return config\n  },\n  error => {\n    return Promise.reject(error)\n  }\n)\n```\n\n## 编写 userInfo 接口\n\n简单实现一下 `/userinfo` 接口，主要是模拟前后端联调的流程。\n\n```js\nconst express = require('express');\nconst app = express()\n\napp.get('/userinfo', (req, res) => {\n  // 存在 token，可以返回用户信息\n  if (req.headers['authorization']) {\n\n    res.json({\n      code: 0,\n      data: {\n        avatar: 'https://fuss10.elemecdn.com/e/5d/4a731a90594a4af544c0c25941171jpeg.jpeg',\n        name: 'Hello_AlexCc',\n        id: 1,\n        role: 'super_admin'\n      },\n      message: '获取用户信息成功',\n      success: true,\n    })\n  }\n})\n\napp.listen(9999, () => {\n  console.log('server site an port 9999 ...')\n})\n```\n\n## 调用 userInfo 接口时机\n\n我们的 `userInfo` 接口已经编写好了，那么我们在什么时候调用呢？\n\n很显然，我们需要在 `permission.ts` 中去调用，当用户登录才有 `token`，也就是说，我们可以在 `token` 存在时，并且 `to.path` 不等于 `/login` 的时候去调用用户信息接口。\n\n```js\nif (store.getters.token) {\n  if (to.path === '/login') {\n    next('/')\n  } else {\n    // 调用用户信息接口\n    await store.dispatch('user/getUserInfo')\n\n    next()\n  }\n}\n```\n\n我们获取用户信息接口的动作，放在了 `module user` 的 `actions` 中：\n\n```js\n// module/user.ts\n\n// state\nstate: () => ({\n  token: getItem('token') || '',\n  userinfo: {}\n}),\n\n// actions\nasync getUserInfo(context) {\n  const info = await getUserInfo()\n  context.commit('setUserInfo', info)\n  return info\n},\n```\n\n方便使用 `userInfo`，我们可以将其放到 `getters` 中：\n\n```js\nconst getters = {\n  token: (state) => state.user.token,\n  userInfo: (state) => state.user.userinfo\n}\n```\n\n最后，我们就能在 `NavBar` 使用获取到的用户信息了。\n\n```html\n<el-avatar\n  shape=\"square\"\n  :size=\"40\"\n  :src=\"$store.getters.userInfo.avatar\"\n></el-avatar>\n```\n\n**避免重复调用 userInfo 接口**\n\n我们发现，每次切换路由时，都会触发路由的前置守卫，从而多次触发 `getUserInfo` 接口，我们把这个问题解决一下\n\n1. 在 store 中定义 `hasUserInfo`，用来判断是否已经有用户信息了，如果有用户信息，我们就不要再触发 `getUserInfo` 接口了\n\n```js\n// getters.ts\n\nhasUserInfo: (state) => {\n  // 如果用户信息存在，return true\n  return JSON.stringify(state.user.userinfo) !== '{}'\n}\n```\n\n2. 修改 `permission.ts` 文件，只有 `hasUserInfo` 为 `false` 时，我们才调用用户信息接口\n\n```js\nif (store.getters.token) {\n  if (to.path === '/login') {\n    next('/')\n  } else {\n    if (!store.getters.hasUserInfo) {\n      await store.dispatch('user/getUserInfo')\n    }\n\n    next()\n  }\n}\n```\n\n# 登出逻辑\n\n登出分为两种形式：\n\n- 用户主动退出\n- 用户被动登录（token 过去 | 账号被挤）\n\n不管以何种形式退出，登出的逻辑都是相同的。\n\n- 清理掉用户的缓存数据\n- 清理掉权限相关的配置\n- 返回到登录页\n\n登出的逻辑，我们也可以写在 `module user` 中去处理。\n\n主要执行 3 个步骤：\n\n- 清空 store token\n- 清除浏览器本地存储\n- 跳转到 login 页\n\n```js\nlogout(context: any) {\n  context.commit('setToken', '')\n  removeAllItem()\n  router.push('/login')\n}\n```\n\n## 主动退出\n\n用户点击登录按钮，通过 store dispatch 触发 action 的 logout 即可。\n\n## 被动退出\n\n被动退出大概分为两种：\n\n- token 失效\n- 账号被挤下去\n\n那么这两种场景下，在前端对应的处理方案一共也分为两种，共分为 主动处理 、被动处理 两种 ：\n\n- 主动处理：主要应对 token 失效\n- 被动处理：同时应对 token 失效 与 单点登录（账号被挤）\n\n### 用户被动退出解决方案之主动处理\n为了保证用户的信息安全，那么对于 token 而言就被制定了很多的安全策略，比如：\n\n- 动态 token（可变 token）\n- 刷新 token\n- 时效 token\n...\n\n我们这里采用 `时效 token`。\n\n那么对应到我们代码中的实现方案为：\n\n- 在用户登陆时，记录当前 登录时间\n- 制定一个 失效时长\n- 在接口调用时，根据 `当前时间` 对比 `登录时间` ，看是否超过了 `时效时长`\n  - 如果未超过，则正常进行后续操作\n  - 如果超过，则进行 退出登录 操作\n\n### 代码实现\n\n创建 `utils/auth.js` 文件，并写入以下代码：\n\n```js\nimport { TIME_STAMP, TOKEN_TIMEOUT_VALUE } from '@/constant'\nimport { setItem, getItem } from '@/utils/storage'\n/**\n * 获取时间戳\n */\nexport function getTimeStamp() {\n  return getItem(TIME_STAMP)\n}\n/**\n * 设置时间戳\n */\nexport function setTimeStamp() {\n  setItem(TIME_STAMP, Date.now())\n}\n/**\n * 是否超时\n */\nexport function isCheckTimeout() {\n  // 当前时间戳\n  var currentTime = Date.now()\n  // 缓存时间戳\n  var timeStamp = getTimeStamp()\n  return currentTime - timeStamp > TOKEN_TIMEOUT_VALUE\n}\n```\n\n在 `constant` 中声明对应常量：\n\n```js\n// token 时间戳\nexport const TIME_STAMP = 'timeStamp'\n// 超时时长(毫秒) 两小时\nexport const TOKEN_TIMEOUT_VALUE = 2 * 60 * 60 * 1000\n```\n\n在用户登录成功之后去设置时间，到 `store/user.js` 的 `login` 中：\n\n```js\nimport { setTimeStamp } from '@/utils/auth'\n\nlogin(context, userInfo) {\n  ...\n  return new Promise((resolve, reject) => {\n    ...\n      .then(data => {\n        ...\n        // 保存登录时间\n        setTimeStamp()\n        resolve()\n      })\n  })\n},\n```\n\n在 `utils/request` 对应的请求拦截器中进行 **主动介入**\n\n```js\nimport { isCheckTimeout } from '@/utils/auth'\n\nif (store.getters.token) {\n  if (isCheckTimeout()) {\n    // 登出操作\n    store.dispatch('user/logout')\n\n    // 失败的话，会走到 interceptors.response 的 error 方法。\n    return Promise.reject(new Error('token 失效'))\n  }\n  ...\n}\n```\n\n那么至此我们就完成了 **主动处理** 对应的业务逻辑。\n\n### 用户被动退出解决方案之被动处理\n\n**背景：**\n\n首先我们需要先明确 **被动处理** 需要应对两种业务场景：\n\n1. `token` 过期\n2.  单点登录\n\n然后我们一个一个来去看，首先是 `token` 过期\n\n> 我们知道对于 `token` 而言，本身就是具备时效的，这个是在服务端生成 `token` 时就已经确定的。\n>\n> 而此时我们所谓的 `token` 过期指的就是：\n>\n> **服务端生成的 `token` 超过 服务端指定时效** 的过程，就像我们前端项目指定 token 的失效性一样。\n\n而对于 单点登录 而言，指的是： \n\n> 当用户 A 登录之后，`token` 过期之前。\n>\n>  用户 A 的账号在其他的设备中进行了二次登录，导致第一次登录的 A 账号被 “顶下来” 的过程。\n>\n> 即：**同一账户仅可以在一个设备中保持在线状态**\n\n那么明确好了对应的背景之后，接下来我们来看对应的业务处理场景：\n\n从背景中我们知道，以上的两种情况，都是在 **服务端进行判断的**，而对于前端而言其实是 **服务端通知前端的一个过程。**\n\n所以说对于其业务处理，将遵循以下逻辑：\n\n1. 服务端返回数据时，会通过特定的状态码通知前端\n2. 当前端接收到特定状态码时，表示遇到了特定状态：**`token` 时效** 或 **单点登录**\n3. 此时进行 **退出登录** 处理\n\n这里只做了 token 的过期处理，如果需要到 **单点登录** 时，只需要增加一个状态码判断即可。\n\n**服务端超时间逻辑**\n我们来简单实现一下后端的超时逻辑。\n\n我们通过 `app.use` 添加了一个中间件，每一次前端触发了接口请求，都会先走这个中间件逻辑。\n\n服务器启动时，我们把 `now` 和 `current` 设置当前时间戳，当有一个接口触发了，会将 `current` 设置新的时间戳。\n\n\n\n```js\nconst express = require('express');\nconst app = express()\n\n// token 超时 2h\nconst TOKEN_TIMEOUT_VALUE = 2 * 60 * 60 * 1000\nlet now = Date.now()\nlet current = Date.now()\n\napp.use(function(req, res, next) {\n  // 每次有接口调用，触发中间件，将 current 更新\n  current = Date.now()\n\n  // 如果是登录逻辑，我们将 now 设置为 current，这样就不会触发超时逻辑\n  // 重新登录，继续走此判断，将 now 设置为 current\n  if (req.path === '/login') {\n    now = current\n  }\n\n  // 每次中间件都会将 current 更新为当前时间戳，一旦时间戳的差值，大于了 2h，就会触发 超时逻辑\n  if (current - now > TOKEN_TIMEOUT_VALUE) {\n    // 超时\n    res.status(401).send({\n      code: 401,\n      message: '服务端message: token 失效啦',\n      success: false,\n    })\n  } else {\n\n    // 没有超时，将执行权交给下一个路由\n    next()\n  }\n})\n```\n\n\n**那么明确好了业务之后，接下来我们来实现前端对应代码：**\n\n在 `utils/request` 的响应拦截器中，增加以下逻辑：\n\n```js\n// 响应拦截器\nservice.interceptors.response.use(\n  response => {\n    ...\n  },\n  error => {\n    // 处理 token 超时问题\n    if (\n      error.response &&\n      error.response.data &&\n      error.response.data.code === 401\n    ) {\n      store.dispatch('user/logout')\n    }\n\n    if (error.response && error.response.data && error.response.data.message) {\n      ElMessage.error(error.response.data.message) // 提示服务端抛出的错误信息\n    } else {\n      ElMessage.error(error.message)\n    }\n    return Promise.reject(error)\n  }\n)\n```\n\n那么至此，我们就已经完成了 **整个用户退出** 方案。\n\n# Sidebar 动态菜单\n\n接下来我们来处理 动态menu菜单。\n\n临时的 menu 菜单，创建 `layout/Sidebar/SidebarMenu` 文件\n\n```js\n<template>\n  <!-- 一级 menu 菜单 -->\n  <el-menu\n    {/* 只允许一个菜单展开 */}\n    :uniqueOpened=\"true\"\n    default-active=\"1\"\n    background-color=\"#545c64\"\n    text-color=\"#fff\"\n    active-text-color=\"#ffd04b\"\n  >\n    <!-- 子集 menu 菜单 -->\n    <el-sub-menu index=\"1\">\n      <template #title>\n        <el-icon><location /></el-icon>\n        <span>导航一</span>\n      </template>\n      <el-menu-item index=\"1-1\">选项1</el-menu-item>\n      <el-menu-item index=\"1-2\">选项2</el-menu-item>\n    </el-sub-menu>\n    <!-- 具体菜单项 -->\n    <el-menu-item index=\"4\">\n      <el-icon><setting /></el-icon>\n      <template #title>导航四</template>\n    </el-menu-item>\n  </el-menu>\n</template>\n\n<script setup lang=\"ts\">\nimport { ref, reactive } from 'vue'\nimport { Location, Setting } from '@element-plus/icons-vue'\n</script>\n<style scoped></style>\n```\n\n在 `layout/Sidebar/index` 中导入该组件\n\n```js\n<template>\n  <div class=\"\">\n    <h1>占位</h1>\n    <el-scrollbar>\n      <sidebar-menu></sidebar-menu>\n    </el-scrollbar>\n  </div>\n</template>\n\n<script setup>\nimport SidebarMenu from './SidebarMenu'\nimport {} from 'vue'\n</script>\n```\n\n那么至此我们生成了一个临时的 `menu` 菜单，从这个临时的 `menu` 菜单出可以看到，`el-menu` 其实分成了三个部分：\n\n1. `el-menu`：整个 `menu` 菜单\n2. `el-submenu`：子集 `menu` 菜单\n3. `el-menu-item`：具体菜单项\n\n那么明确好了这些内容之后，接下来我们就可以来去分析一下 **动态 `menu` 菜单如何生成了**\n\n## 动态menu菜单处理方案解析\n\n**动态`menu`菜单** 其实主要是和 **动态路由表**  配合来去实现 **用户权限** 的。\n\n但是 **用户权限处理** 目前还未涉及到，因为咱们想要处理 **用户权限** 还需要先去处理很多的业务场景，所以暂时先只处理 **动态`menu`菜单** 。\n\n所谓 **动态`menu`菜单** 指的是：\n\n> 根据路由表的配置，自动生成对应的 `menu` 菜单。\n>\n> 当路由表发生变化时，`menu` 菜单自动发生变化\n\n那么明确了 **动态`menu`菜单** 的含义之后，接下来咱们就需要来明确 **动态`menu`菜单** 的实现方案：\n\n1. 定义 **路由表** 对应 **`menu` 菜单规则**\n2. 根据规则制定 **路由表**\n3. 根据规则，依据 **路由表** ，生成 **`menu` 菜单**\n\n那么根据我们的实现方案可以发现，实现 **动态`menu`菜单** 最核心的关键点其实就在步骤一，也就是 \n\n> 定义 **路由表** 对应 **`menu` 菜单规则**\n\n那么下面我们就来看一下，这个规则如何制定：\n\n1. 对于单个路由规则而言（循环）：\n   1. 如果存在 `meta && meta.title && meta.icon` ：则显示在 `menu` 菜单中，其中 `title` 为显示的内容，`icon` 为显示的图标\n      1. 如果存在 `children` ：则以 `el-sub-menu（子菜单）` 展示\n      2. 否则：则以 `el-menu-item（菜单项）` 展示\n   2. 否则：不显示在 `menu` 菜单中\n\n那么明确好了对应的规则之后，接下来我们就可以来去看一下如何进行实现啦！\n\n## 生成项目页面组件\n\n明确了对应的方案之后，那么下面咱们就来实现对应的代码逻辑。\n\n根据我们的分析，想要完成动态的 `menu`，那么我们需要按照以下的步骤来去实现：\n\n1. 创建页面组件\n2. 生成路由表\n3. 解析路由表\n4. 生成 `menu` 菜单\n\n那么明确好了步骤之后，接下来我们就先来实现第一步\n\n**创建页面组件**\n\n在 `views` 文件夹下，创建如下页面：\n\n1. 创建文章：`article-create`\n2. 文章详情：`article-detail`\n3. 文章排名：`article-ranking`\n4. 错误页面：`error-page`\n   1. `404`\n   2. `401`\n5. 导入：`import`\n6. 权限列表：`permission-list`\n7. 个人中心：`profile`\n8. 角色列表：`role-list`\n9. 用户信息：`user-info`\n10. 用户管理：`user-manage`\n\n## 创建结构路由表\n\n想要实现结构路由表，那么我们需要先知道最终我们要实现的结构是什么样子的，大家来看下面的截图：\n\n<img src=\"/img/menu.png\" />\n\n这是我们最终要实现的 `menu` 截图。\n\n根据此截图，我们可以知道两点内容：\n\n1. 我们创建的页面并没有全部进行展示\n   1. 不显示页面表示 **不满足** 该条件 `meta && meta.title && meta.icon`\n\n2. `menu` 菜单将具备父子级的结构\n  1. 按照此结构规划数据，则数据应为\n    ```json\n    [\n        {\n            \"title\": \"个人中心\",\n            \"path\": \"\"\n        },\n        {\n            \"title\": \"用户\",\n            \"children\": [\n                {\n                    \"title\": \"员工管理\",\n                    \"path\": \"\"\n                },\n                {\n                    \"title\": \"角色列表\",\n                    \"path\": \"\"\n                },\n                {\n                    \"title\": \"权限列表\",\n                    \"path\": \"\"\n                }\n            ]\n        },\n        {\n            \"title\": \"文章\",\n            \"children\": [\n                {\n                    \"title\": \"文章排名\",\n                    \"path\": \"\"\n                },\n                {\n                    \"title\": \"创建文章\",\n                    \"path\": \"\"\n                }\n            ]\n        }\n    ]\n    ```\n\n又因为将来我们需要进行 **用户权限处理**，所以此时我们需要先对路由表进行一个划分：\n\n1. 私有路由表 `privateRoutes` ：权限路由\n2. 公有路由表 `publicRoutes`：无权限路由\n\n根据以上理论，生成以下路由表结构：\n\n```js\n/**\n * 私有路由表\n */\nconst privateRoutes = [\n  {\n    path: '/user',\n    component: layout,\n    redirect: '/user/manage',\n    meta: {\n      title: 'user',\n      icon: 'personnel'\n    },\n    children: [\n      {\n        path: '/user/manage',\n        component: () => import('@/views/user-manage/index'),\n        meta: {\n          title: 'userManage',\n          icon: 'personnel-manage'\n        }\n      },\n      {\n        path: '/user/role',\n        component: () => import('@/views/role-list/index'),\n        meta: {\n          title: 'roleList',\n          icon: 'role'\n        }\n      },\n      {\n        path: '/user/permission',\n        component: () => import('@/views/permission-list/index'),\n        meta: {\n          title: 'permissionList',\n          icon: 'permission'\n        }\n      },\n      {\n        path: '/user/info/:id',\n        name: 'userInfo',\n        component: () => import('@/views/user-info/index'),\n        meta: {\n          title: 'userInfo'\n        }\n      },\n      {\n        path: '/user/import',\n        name: 'import',\n        component: () => import('@/views/import/index'),\n        meta: {\n          title: 'excelImport'\n        }\n      }\n    ]\n  },\n  {\n    path: '/article',\n    component: layout,\n    redirect: '/article/ranking',\n    meta: {\n      title: 'article',\n      icon: 'article'\n    },\n    children: [\n      {\n        path: '/article/ranking',\n        component: () => import('@/views/article-ranking/index'),\n        meta: {\n          title: 'articleRanking',\n          icon: 'article-ranking'\n        }\n      },\n      {\n        path: '/article/:id',\n        component: () => import('@/views/article-detail/index'),\n        meta: {\n          title: 'articleDetail'\n        }\n      },\n      {\n        path: '/article/create',\n        component: () => import('@/views/article-create/index'),\n        meta: {\n          title: 'articleCreate',\n          icon: 'article-create'\n        }\n      },\n      {\n        path: '/article/editor/:id',\n        component: () => import('@/views/article-create/index'),\n        meta: {\n          title: 'articleEditor'\n        }\n      }\n    ]\n  }\n]\n\n/**\n * 公开路由表\n */\nconst publicRoutes = [\n  {\n    path: '/login',\n    component: () => import('@/views/login/index')\n  },\n  {\n    path: '/',\n    // 注意：带有路径“/”的记录中的组件“默认”是一个不返回 Promise 的函数\n    component: layout,\n    redirect: '/profile',\n    children: [\n      {\n        path: '/profile',\n        name: 'profile',\n        component: () => import('@/views/profile/index'),\n        meta: {\n          title: 'profile',\n          icon: 'el-icon-user'\n        }\n      },\n      {\n        path: '/404',\n        name: '404',\n        component: () => import('@/views/error-page/404')\n      },\n      {\n        path: '/401',\n        name: '401',\n        component: () => import('@/views/error-page/401')\n      }\n    ]\n  }\n]\n\nconst router = createRouter({\n  history: createWebHashHistory(),\n  routes: [...publicRoutes, ...privateRoutes]\n})\n```\n\n最后不要忘记在 `layout/appMain` 下设置路由出口\n\n```js\n<template>\n  <div class=\"app-main\">\n    <router-view></router-view>\n  </div>\n</template>\n```\n\n## 解析路由表，获取结构化数据\n\n想要获取路由表数据，那么有两种方式：\n\n\n1. [router.options.routes](https://next.router.vuejs.org/zh/api/#routes)：初始路由列表（[新增的路由](https://next.router.vuejs.org/zh/api/#addroute) 无法获取到）\n\n2. [router.getRoutes()](https://next.router.vuejs.org/zh/api/#getroutes)：获取所有 [路由记录](https://next.router.vuejs.org/zh/api/#routerecord) 的完整列表\n\n所以，我们此时使用 `router.getRoutes() ` 方法获取完整的路由列表\n\n在 `layout/components/Sidebar/SidebarMenu` 下写入以下代码：\n\n```js\n<script setup>\nimport { useRouter } from 'vue-router'\n\nconst router = useRouter()\nconsole.log(router.getRoutes())\n</script>\n```\n\n从返回的数据来看，它与我们想要的数据结构相去甚远。\n\n出现这个问题的原因，是因为它返回的是一个 **完整的路由表**\n\n这个路由表距离我们想要的存在两个问题：\n\n1. 存在重复的路由数据\n2. 不满足该条件 `meta && meta.title && meta.icon` 的数据不应该存在\n\n那么接下来我们就应该来处理这两个问题\n\n创建 `utils/route.ts` 文件，创建两个方法分别处理对应的两个问题：\n\n1. `filterRouters`\n2. `generateMenus`\n\n写入以下代码：\n\n```js\nimport path from 'path'\n\n/**\n * 返回所有子路由\n */\nconst getChildrenRoutes = routes => {\n  const result = []\n  routes.forEach(route => {\n    if (route.children && route.children.length > 0) {\n      result.push(...route.children)\n    }\n  })\n  return result\n}\n/**\n * 处理脱离层级的路由：某个一级路由为其他子路由，则剔除该一级路由，保留路由层级\n * @param {*} routes router.getRoutes()\n */\nexport const filterRouters = routes => {\n  const childrenRoutes = getChildrenRoutes(routes)\n  return routes.filter(route => {\n    return !childrenRoutes.find(childrenRoute => {\n      return childrenRoute.path === route.path\n    })\n  })\n}\n\n/**\n * 判断数据是否为空值\n */\nfunction isNull(data) {\n  if (!data) return true\n  if (JSON.stringify(data) === '{}') return true\n  if (JSON.stringify(data) === '[]') return true\n  return false\n}\n/**\n * 根据 routes 数据，返回对应 menu 规则数组\n */\nexport function generateMenus(routes, basePath = '') {\n  const result = []\n  // 遍历路由表\n  routes.forEach(item => {\n    // 不存在 children && 不存在 meta 直接 return\n    if (isNull(item.meta) && isNull(item.children)) return\n    // 存在 children 不存在 meta，进入迭代\n    if (isNull(item.meta) && !isNull(item.children)) {\n      result.push(...generateMenus(item.children))\n      return\n    }\n    // 合并 path 作为跳转路径\n    const routePath = path.resolve(basePath, item.path)\n    // 路由分离之后，存在同名父路由的情况，需要单独处理\n    let route = result.find(item => item.path === routePath)\n    if (!route) {\n      route = {\n        ...item,\n        path: routePath,\n        children: []\n      }\n\n      // icon 与 title 必须全部存在\n      if (route.meta.icon && route.meta.title) {\n        // meta 存在生成 route 对象，放入 arr\n        result.push(route)\n      }\n    }\n\n    // 存在 children 进入迭代到children\n    if (item.children) {\n      route.children.push(...generateMenus(item.children, route.path))\n    }\n  })\n  return result\n}\n\n```\n\n在 `SidebarMenu` 中调用该方法\n\n```js\n<script setup>\nimport { computed } from 'vue'\nimport { useRouter } from 'vue-router'\nimport { filterRouters, generateMenus } from '@/utils/route'\n\nconst router = useRouter()\nconst routes = computed(() => {\n  const filterRoutes = filterRouters(router.getRoutes())\n  return generateMenus(filterRoutes)\n})\nconsole.log(JSON.stringify(routes.value))\n</script>\n```\n\n得到该数据结构\n\n```json\n[\n    {\n        \"path\":\"/profile\",\n        \"name\":\"profile\",\n        \"meta\":{\n            \"title\":\"profile\",\n            \"icon\":\"el-icon-user\"\n        },\n    },\n    {\n        \"path\":\"/user\",\n        \"redirect\":\"/user/manage\",\n        \"meta\":{\n            \"title\":\"user\",\n            \"icon\":\"personnel\"\n        },\n        \"props\":{\n            \"default\":false\n        },\n        \"children\":[\n            {\n                \"path\":\"/user/manage\",\n                \"name\":\"userManage\",\n                \"meta\":{\n                    \"title\":\"userManage\",\n                    \"icon\":\"personnel-manage\"\n                },\n                \"children\":[\n\n                ]\n            },\n            {\n                \"path\":\"/user/role\",\n                \"name\":\"userRole\",\n                \"meta\":{\n                    \"title\":\"roleList\",\n                    \"icon\":\"role\"\n                },\n                \"children\":[\n\n                ]\n            },\n            {\n                \"path\":\"/user/permission\",\n                \"name\":\"userPermission\",\n                \"meta\":{\n                    \"title\":\"permissionList\",\n                    \"icon\":\"permission\"\n                },\n                \"children\":[\n\n                ]\n            }\n        ],\n    },\n    {\n        \"path\":\"/article\",\n        \"redirect\":\"/article/ranking\",\n        \"meta\":{\n            \"title\":\"article\",\n            \"icon\":\"article\"\n        },\n        \"props\":{\n            \"default\":false\n        },\n        \"children\":[\n            {\n                \"path\":\"/article/ranking\",\n                \"name\":\"articleRanking\",\n                \"meta\":{\n                    \"title\":\"articleRanking\",\n                    \"icon\":\"article-ranking\"\n                },\n                \"children\":[\n\n                ]\n            },\n            {\n                \"path\":\"/article/create\",\n                \"name\":\"articleCreate\",\n                \"meta\":{\n                    \"title\":\"articleCreate\",\n                    \"icon\":\"article-create\"\n                },\n                \"children\":[\n\n                ]\n            }\n        ],\n    }\n]\n```\n\n## 生成动态 menu 菜单\n\n有了数据结构之后，最后的步骤就水到渠成了\n\n整个 `menu` 菜单，我们将分成三个组件来进行处理\n\n1. `SidebarMenu`：处理数据，作为最顶层 `menu` 载体\n2. `SidebarItem`：根据数据处理 **当前项为 `el-submenu` || `el-menu-item`** \n3. `MenuItem`：处理 `el-menu-item` 样式\n\n那么下面我们一个个来处理\n\n首先是 `SidebarMenu` \n\n```js\n<template>\n  <!-- 一级 menu 菜单 -->\n  <el-menu\n    ...\n  >\n    <sidebar-item\n      v-for=\"item in routes\"\n      :key=\"item.path\"\n      :route=\"item\"\n    ></sidebar-item>\n  </el-menu>\n</template>\n\n```\n\n\n\n创建 `SidebarItem` 组件，用来根据数据处理 **当前项为 `el-sub-menu` || `el-menu-item`** \n\n```js\n<template>\n  <!-- 支持渲染多级 menu 菜单 -->\n  <el-sub-menu v-if=\"route.children.length > 0\" :index=\"route.path\">\n    <template #title>\n      <menu-item :title=\"route.meta.title\" :icon=\"route.meta.icon\"></menu-item>\n    </template>\n    <!-- 循环渲染 -->\n    <sidebar-item\n      v-for=\"item in route.children\"\n      :key=\"item.path\"\n      :route=\"item\"\n    ></sidebar-item>\n  </el-sub-menu>\n  <!-- 渲染 item 项 -->\n  <el-menu-item v-else :index=\"route.path\">\n    <menu-item :title=\"route.meta.title\" :icon=\"route.meta.icon\"></menu-item>\n  </el-menu-item>\n</template>\n\n<script setup>\nimport MenuItem from './MenuItem'\nimport { defineProps } from 'vue'\n// 定义 props\ndefineProps({\n  route: {\n    type: Object,\n    required: true\n  }\n})\n</script>\n```\n\n创建 `MenuItem` 用来处理 `el-menu-item` 样式\n\n```js\n<template>\n  <i v-if=\"icon.includes('el-icon')\" class=\"sub-el-icon\" :class=\"icon\"></i>\n  <svg-icon v-else :icon=\"icon\"></svg-icon>\n  <span>{{ title }}</span>\n</template>\n\n<script setup>\nimport { defineProps } from 'vue'\ndefineProps({\n  title: {\n    type: String,\n    required: true\n  },\n  icon: {\n    type: String,\n    required: true\n  }\n})\n</script>\n\n<style lang=\"scss\" scoped>\n</style>\n```\n\n至此，整个的 `menu` 菜单结构就已经完成了！\n\n## 修复最后残余问题\n\n目前 `menu` 菜单存在三个问题\n\n1. 样式问题\n2. 路由跳转问题\n3. 默认激活项\n\n**样式问题：**\n\n首先处理样式，因为后面我们需要处理 **主题替换** ，所以此处我们不能把样式写死。因为我们的样式变量都放在 `variables.scss` 文件中，并通过 `:export` 导出了变量以供 js 导入，每次使用都需要导入，比较麻烦，我们可以将其放在 `store getters` 中，以便 **快捷访问**。\n\n```js\nimport variables from '@/styles/variables.scss'\nconst getters = {\n  cssVar: () => variables\n}\nexport default getters\n```\n\n在 `SidebarMenu` 中写入如下样式\n\n```html\n<el-menu\n  :background-color=\"$store.getters.cssVar.menuBg\"\n  :text-color=\"$store.getters.cssVar.menuText\"\n  :active-text-color=\"$store.getters.cssVar.menuActiveText\"\n  :unique-opened=\"true\"\n>\n```\n\n**路由跳转问题：**\n\n为 `el-menu` 指定 `router`\n\n```html\n<el-menu\n  ...\n  router\n>\n```\n\n> 添加 router 属性\n>\n> 表示是否启用 vue-router 模式。 启用该模式会在激活导航时以 index 作为 path 进行路由跳转 使用 default-active 来设置加载时的激活项。\n\n**默认激活项：**\n\n根据当前 `url` 进行判断即可\n\n```js\n<el-menu\n  :default-active=\"activeMenu\"\n  ...\n>\n\n<script setup>\n...\n\n// 计算高亮 menu 的方法\nconst route = useRoute()\nconst activeMenu = computed(() => {\n  const { path } = route\n  return path\n})\n</script>\n```\n\n至此整个 **动态`menu`完成**\n\n## 左侧菜单伸缩功能实现\n\n下面我们来实现一个标准化功能 **左侧菜单伸缩** ，对于这个功能核心的点在于动画处理\n\n样式的改变总是由数据进行驱动，所以首先我们去创建对应的数据\n\n创建 `store/app` 模块，写入如下代码\n\n```js\nexport default {\n  namespaced: true,\n  state: () => ({\n    sidebarOpened: true\n  }),\n  mutations: {\n    triggerSidebarOpened(state) {\n      state.sidebarOpened = !state.sidebarOpened\n    }\n  },\n  actions: {}\n}\n\n```\n\n在 `store/index` 中进行导入\n\n```js\n...\nimport app from './modules/app'\nexport default createStore({\n  getters,\n  modules: {\n    ...\n    app\n  }\n})\n```\n\n在 `store/getters` 中创建快捷访问\n\n```js\nsidebarOpened: state => state.app.sidebarOpened\n```\n\n\n创建 `components/hamburger` 组件，用来控制数据\n\n```js\n<template>\n  <div class=\"hamburger-container\" @click=\"toggleClick\">\n    <svg-icon class=\"hamburger\" :icon=\"icon\"></svg-icon>\n  </div>\n</template>\n\n<script setup>\nimport { computed } from 'vue'\nimport { useStore } from 'vuex'\n\nconst store = useStore()\nconst toggleClick = () => {\n  store.commit('app/triggerSidebarOpened')\n}\n\nconst icon = computed(() =>\n  store.getters.sidebarOpened ? 'hamburger-opened' : 'hamburger-closed'\n)\n</script>\n\n<style lang=\"scss\" scoped>\n.hamburger-container {\n  padding: 0 16px;\n  .hamburger {\n    display: inline-block;\n    vertical-align: middle;\n    width: 20px;\n    height: 20px;\n  }\n}\n</style>\n```\n\n在 `navbar` 中使用该组件\n\n```js\n<template>\n  <div class=\"navbar\">\n    <hamburger class=\"hamburger-container\" />\n    ...\n  </div>\n</template>\n\n<script setup>\nimport Hamburger from '@/components/Hamburger'\n...\n</script>\n\n<style lang=\"scss\" scoped>\n.navbar {\n  ...\n\n  .hamburger-container {\n    line-height: 46px;\n    height: 100%;\n    float: left;\n    cursor: pointer;\n    // hover 动画\n    transition: background 0.5s;\n\n    &:hover {\n      background: rgba(0, 0, 0, 0.1);\n    }\n  }\n\n ...\n}\n</style>\n\n```\n\n在 `SidebarMenu` 中，控制 `el-menu` 的 [collapse](https://element-plus.org/#/zh-CN/component/menu) 属性\n\n```js\n<el-menu\n    :collapse=\"!$store.getters.sidebarOpened\"\n    ...\n```\n\n在 `layout/index` 中指定 **整个侧边栏的宽度和缩放动画**\n\n```js\n<div\n    class=\"app-wrapper\"\n    :class=\"[$store.getters.sidebarOpened ? 'openSidebar' : 'hideSidebar']\"\n  >\n  ...\n```\n\n在 `layout/index` 中 处理 `navbar` 的宽度\n\n```js\n<style lang=\"scss\" scoped>\n...\n\n.fixed-header {\n  position: fixed;\n  top: 0;\n  right: 0;\n  z-index: 9;\n  width: calc(100% - #{$sideBarWidth});\n  transition: width 0.28s;\n}\n\n.hideSidebar .fixed-header {\n  width: calc(100% - #{$hideSideBarWidth});\n}\n</style>\n```\n\n在 `styles/variables.scss` 中指定 `hideSideBarWidth`\n\n```scss\n$hideSideBarWidth: 54px;\n```\n\n\n\n## SidebarHeader 处理\n\n整个左侧的 `menu` 菜单，到现在咱们还剩下最后一个 `header` 没有进行处理\n\n在 `sidebar/index` 中写入如下代码\n\n```js\n<template>\n  <div class=\"\">\n    <div class=\"logo-container\">\n      <el-avatar\n        size=\"44\"\n        shape=\"square\"\n        src=\"https://m.imooc.com/static/wap/static/common/img/logo-small@2x.png\"\n      />\n      <h1 class=\"logo-title\" v-if=\"$store.getters.sidebarOpened\">\n       imooc-admin\n      </h1>\n    </div>\n    ...\n  </div>\n</template>\n\n<style lang=\"scss\" scoped>\n.logo-container {\n  height: 44px;\n  padding: 10px 0 22px 0;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  .logo-title {\n    margin-left: 10px;\n    color: #fff;\n    font-weight: 600;\n    line-height: 50px;\n    font-size: 16px;\n    white-space: nowrap;\n  }\n}\n</style>\n\n```\n\n创建 `styles/element.scss` 文件，统一处理 `el-avatar` 的背景问题\n\n```scss\n.el-avatar {\n  --el-avatar-background-color: none;\n}\n```\n\n在 `styles/index.scss` 中导入\n\n```scss\n...\n@import './element.scss';\n```\n\n统一处理下动画时长的问题，在 `styles/variables.scss` 中，加入以下变量\n\n```css\n$sideBarDuration: 0.28s;\n```\n\n为 `styles/sidebar.scss` 修改时长\n\n```scss\n  .main-container {\n    transition: margin-left #{$sideBarDuration};\n   ...\n  }\n\n  .sidebar-container {\n    transition: width #{$sideBarDuration};\n  \t...\n  }\n```\n\n为 `layout/index` 修改样式\n\n```scss\n.fixed-header {\n  ...\n  transition: width #{$sideBarDuration};\n}\n```\n\n# Vue3.2：组件状态驱动的动态 CSS 值\n\n在 [vue 3.2](https://blog.vuejs.org/posts/vue-3.2.html) 最新更新中，除了之前我们介绍的 **响应式变化** 之外，还有另外一个很重要的更新，那就是 **组件状态驱动的动态 `CSS` 值** ，对应的文档也已经公布，大家可以 [点击这里](https://v3.vuejs.org/api/sfc-style.html#state-driven-dynamic-css) 查看\n\n那么下面我们就使用下最新的特性，来为 `logo-container` 指定下高度：\n\n```js\n<template>\n ...\n <el-avatar\n \t:size=\"logoHeight\"\n ...\n\n</template>\n\n<script setup>\n...\nconst logoHeight = 44\n</script>\n\n<style lang=\"scss\" scoped>\n.logo-container {\n  height: v-bind(logoHeight) + 'px';\n...\n}\n</style>\n\n```\n\n# 动态面包屑方案分析\n\n面包屑导航分为：\n\n1. 静态面包屑\n2. 动态面包屑\n\n**静态面包屑：**\n\n指的是：**在每个页面中写死对应的面包屑菜单**，缺点也很明显：\n\n1. 每个页面都得写一遍\n2. 页面路径结构变化了，得手动更改\n\n简单来说就是 **不好维护，不好扩展** 。\n\n**动态面包屑：**\n\n根据当前的 `url` 自动生成面包屑导航菜单\n\n无论之后路径发生了什么变化，**动态面包屑** 都会正确的进行计算\n\n那么在后面的实现过程中，我们将会分成三大步来实现\n\n1. 创建、渲染基本的面包屑组件\n2. 计算面包屑结构数据\n3. 根据数据渲染动态面包屑内容\n\n## 渲染基本的面包屑组件\n\n完成第一步，先去创建并渲染出基本的 [面包屑](https://element-plus.org/#/zh-CN/component/breadcrumb) 组件\n\n创建 `components/Breadcrumb/index`，并写入如下代码：\n\n```js\n<template>\n  <el-breadcrumb class=\"breadcrumb\" separator=\"/\">\n    <el-breadcrumb-item :to=\"{ path: '/' }\">首页</el-breadcrumb-item>\n    <el-breadcrumb-item><a href=\"/\">活动管理</a></el-breadcrumb-item>\n    <el-breadcrumb-item>活动列表</el-breadcrumb-item>\n    <!-- 面包屑的最后一项 -->\n    <el-breadcrumb-item>\n      <span class=\"no-redirect\">活动详情</span>\n    </el-breadcrumb-item>\n  </el-breadcrumb>\n</template>\n\n<script setup>\nimport {} from 'vue'\n</script>\n\n<style lang=\"scss\" scoped>\n.breadcrumb {\n  display: inline-block;\n  font-size: 14px;\n  line-height: 50px;\n  margin-left: 8px;\n\n  ::v-deep .no-redirect {\n    color: #97a8be;\n    cursor: text;\n  }\n}\n</style>\n\n```\n\n在 `layout/components/Navbar` 组件下导入\n\n```js\n<template>\n  <div class=\"navbar\">\n    <hamburger class=\"hamburger-container\" />\n    <breadcrumb class=\"breadcrumb-container\" />\n\t...\n  </div>\n</template>\n...\n\n<style lang=\"scss\" scoped>\n.navbar {\n ...\n\n  .breadcrumb-container {\n    float: left;\n  }\n   ...\n}\n</style>\n\n```\n\n## 动态计算面包屑结构数据\n\n现在我们是完成了一个静态的 面包屑，接下来咱们就需要依托这个静态的菜单来完成动态的。\n\n对于现在的静态面包屑来说，他分成了两个组件：\n\n1. `el-breadcrumb`：包裹性质的容器\n2. `el-breadcrumb-item`：每个单独项\n\n如果我们想要完成动态的，那么就需要 **依据动态数据，渲染 `el-breadcrumb-item` **\n\n所以说接下来我们需要做的事情就很简单了\n\n1. 动态数据\n2. 渲染 `el-breadcrumb-item`\n\n咱们先来看 **动态数据如何制作**\n\n我们希望可以制作出一个 **数组**，数组中每个 `item` 都表示一个 **路由信息**：\n\n创建一个方法，用来生成数组数据，在这里我们要使用到 [route.match](https://next.router.vuejs.org/zh/api/#matched) 属性来：**获取与给定路由地址匹配的[标准化的路由记录](https://next.router.vuejs.org/zh/api/#routerecord)数组**\n\n如何理解上面这句话呢？其实我们将 `route.matched` 打印出来就可以发现，你每次切换菜单（或者说更换了路由），打印出来的就是当前路由的路由表（包含父级、子集的路由信息）。\n\n```js\n<script setup>\nimport { ref, reactive, watch } from 'vue'\nimport { useRoute, RouteRecordRaw } from 'vue-router'\n\nconst breadcrumbData = ref<RouteRecordRaw[]>([]) // 存放计算出的面包屑数据\n\nconst route = useRoute()\n\nconst getBreadcrumbData = () => {\n  console.log(route.matched)\n\n  // 只有存在 meta 并且 meta.title 的路由，我们才会显示到面包屑中\n  // 就像 menu 菜单一样，类似 404 login 的我们不要显示\n  breadcrumbData.value = route.matched.filter(r => r.meta && r.meta.title)\n}\n\n// 监听路由变化时触发\nwatch(\n  route,\n  () => {\n    getBreadcrumbData()\n  },\n  {\n    immediate: true\n  }\n)\n</script>\n```\n\n## 依据动态数据，渲染面包屑\n\n有了数据之后，根据数据来去渲染面包屑就比较简单了。\n\n```vue\n<template>\n  <el-breadcrumb class=\"breadcrumb\" separator=\"/\">\n    <el-breadcrumb-item\n      v-for=\"(item, index) in breadcrumbData\"\n      :key=\"item.path\"\n    >\n      <!-- 不可点击项 -->\n      <span v-if=\"index === breadcrumbData.length - 1\" class=\"no-redirect\">{{\n        item.meta.title\n      }}</span>\n      <!-- 可点击项 -->\n      <a v-else class=\"redirect\" @click.prevent=\"onLinkClick(item)\">{{\n        item.meta.title\n      }}</a>\n    </el-breadcrumb-item>\n  </el-breadcrumb>\n</template>\n\n<script setup>\nimport { ref, watch } from 'vue'\nimport { useRoute, useRouter, RouteRecordRaw } from 'vue-router'\nimport { useStore } from 'vuex'\n\nconst breadcrumbData = ref<RouteRecordRaw[]>([]) // 存放计算出的面包屑数据\n\nconst store = useStore()\nconst route = useRoute()\nconst router = useRouter()\nconst getBreadcrumbData = () => {\n  console.log(route.matched)\n\n  // 只有存在 meta 并且 meta.title 的路由，我们才会显示到面包屑中\n  // 就像 menu 菜单一样，类似 404 login 的我们不要显示\n  breadcrumbData.value = route.matched.filter(r => r.meta && r.meta.title)\n}\n\nwatch(\n  route,\n  () => {\n    getBreadcrumbData()\n  },\n  {\n    immediate: true\n  }\n)\n\n// 跳转路由\nconst onLinkClick = (item: RouteRecordRaw) => {\n  router.push(item.path)\n}\n\n// 将来需要进行主题替换，所以这里获取下动态样式\nconst linkHoverColor = ref(store.getters.cssVars.menuBg)\n</script>\n\n<style lang=\"scss\" scoped>\n.breadcrumb {\n ...\n\n  .redirect {\n    color: #666;\n    font-weight: 600;\n  }\n\n  .redirect:hover {\n    color: v-bind(linkHoverColor); // 应对主题切换\n  }\n}\n</style>\n\n```\n\n## 面包屑动画\n\nvue3对 [动画](https://v3.cn.vuejs.org/guide/transitions-overview.html#%E5%9F%BA%E4%BA%8E-class-%E7%9A%84%E5%8A%A8%E7%94%BB%E5%92%8C%E8%BF%87%E6%B8%A1) 进行了一些修改（[vue 动画迁移文档](https://v3.cn.vuejs.org/guide/migration/transition.html#%E6%A6%82%E8%A7%88)）\n\n主要的修改其实只有两个：\n\n1. 过渡类名 `v-enter` 修改为 `v-enter-from`\n2. 过渡类名 `v-leave` 修改为 `v-leave-from`\n\n那么依据修改之后的动画，我们来为面包屑增加一些动画样式：\n\n1. 在 `Breadcrumb/index` 中增加 `transition-group`\n\n```js\n  <template>\n    <el-breadcrumb class=\"breadcrumb\" separator=\"/\">\n      <transition-group name=\"breadcrumb\">\n        ...\n      </transition-group>\n    </el-breadcrumb>\n  </template>\n```\n\n2. 新建 `styles/transition` 样式文件\n\n```scss\n  .breadcrumb-enter-active,\n  .breadcrumb-leave-active {\n    transition: all 0.5s;\n  }\n\n  .breadcrumb-enter-from,\n  .breadcrumb-leave-active {\n    opacity: 0;\n    transform: translateX(20px);\n  }\n\n  .breadcrumb-leave-active {\n    position: absolute;\n  }\n```\n\n3. 在 `styles/index` 中导入\n\n```scss\n  @import './transition.scss';\n```\n\n# 总结\n\n到这里我们的 layout 整体架构就已经做完了，我们来看看效果吧。\n\n![](/img/layout-result.png)\n","slug":"vue3-project-layout","published":1,"updated":"2023-05-12T10:49:20.016Z","comments":1,"photos":[],"link":"","_id":"clhkizgyn00393y0qepdt6278","content":"<h1 id=\"实现-layout-布局\"><a href=\"#实现-layout-布局\" class=\"headerlink\" title=\"实现 layout 布局\"></a>实现 layout 布局</h1><p>首先，我们要改造 <code>layout/index.vue</code>，先定义好结构，然后写样式即可。</p>\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><div class=\"code-wrapper\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></div></td><td class=\"code\"><pre><code class=\"hljs html\"><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">div</span> <span class=\"hljs-attr\">class</span>=<span class=\"hljs-string\">&quot;app-wrapper&quot;</span>&gt;</span><br>  <span class=\"hljs-comment\">&lt;!-- 左侧 menu --&gt;</span><br>  <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">siderbar</span> <span class=\"hljs-attr\">class</span>=<span class=\"hljs-string\">&quot;sidebar-container&quot;</span>&gt;</span><span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">siderbar</span>&gt;</span><br><br>  <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">div</span> <span class=\"hljs-attr\">class</span>=<span class=\"hljs-string\">&quot;main-container&quot;</span>&gt;</span><br>    <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">div</span> <span class=\"hljs-attr\">class</span>=<span class=\"hljs-string\">&quot;fixed-header&quot;</span>&gt;</span><br>      <span class=\"hljs-comment\">&lt;!-- 顶部 --&gt;</span><br>      <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">nav-bar</span>&gt;</span><span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">nav-bar</span>&gt;</span><br>    <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">div</span>&gt;</span><br><br>    <span class=\"hljs-comment\">&lt;!-- 主要内容 --&gt;</span><br>    <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">app-main</span>&gt;</span><span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">app-main</span>&gt;</span><br>  <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">div</span>&gt;</span><br><span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">div</span>&gt;</span><br></code></pre></td></tr></table></figure>\n\n<p>结构定义好了，我再定义样式以及样式文件。在 <code>src</code> 下创建 <code>styles</code> 文件夹，主要存放 <code>scss</code> 的一些样式文件，其中就包括通用的 <code>reset.scss</code> 文件，处理基础的 html 元素样式。<code>mixin.scss</code> 编写通用的样式表，定义通用的样式变量 <code>variables.scss</code>。</p>\n<figure class=\"highlight scss\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs scss\"><span class=\"hljs-comment\">// styles/index.scss</span><br><br><span class=\"hljs-keyword\">@import</span> <span class=\"hljs-string\">&#x27;./reset.scss&#x27;</span>;<br><span class=\"hljs-keyword\">@import</span> <span class=\"hljs-string\">&#x27;./variables.scss&#x27;</span>;<br><span class=\"hljs-keyword\">@import</span> <span class=\"hljs-string\">&#x27;./mixin.scss&#x27;</span>;<br><span class=\"hljs-keyword\">@import</span> <span class=\"hljs-string\">&#x27;./sidebar.scss&#x27;</span>;<br></code></pre></td></tr></table></figure>\n\n<h2 id=\"scss-的使用技巧\"><a href=\"#scss-的使用技巧\" class=\"headerlink\" title=\"scss 的使用技巧\"></a>scss 的使用技巧</h2><p>这里我们主要看下 <code>mixin.scss</code> 和 <code>variables.scss</code> 的一些技巧和用法：</p>\n<ul>\n<li>mixin.scss</li>\n</ul>\n<figure class=\"highlight css\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs css\"><span class=\"hljs-comment\">/* 清除浮动，在 .vue 文件中使用的时候直接引用即可：@include clearfix; */</span><br><span class=\"hljs-keyword\">@mixin</span> clearfix &#123;<br>  &amp;<span class=\"hljs-selector-pseudo\">:after</span> &#123;<br>    <span class=\"hljs-attribute\">content</span>: <span class=\"hljs-string\">&#x27;&#x27;</span>;<br>    <span class=\"hljs-attribute\">display</span>: table;<br>    <span class=\"hljs-attribute\">clear</span>: both;<br>  &#125;<br>&#125;<br><br><span class=\"hljs-comment\">/* 滚动条的设置 */</span><br><span class=\"hljs-keyword\">@mixin</span> scrollBar &#123;<br>  &amp;::-webkit-scrollbar-track-piece &#123;<br>    <span class=\"hljs-attribute\">background</span>: <span class=\"hljs-number\">#d3dce6</span>;<br>  &#125;<br><br>  &amp;::-webkit-scrollbar &#123;<br>    <span class=\"hljs-attribute\">width</span>: <span class=\"hljs-number\">6px</span>;<br>  &#125;<br><br>  &amp;::-webkit-scrollbar-thumb &#123;<br>    <span class=\"hljs-attribute\">background</span>: <span class=\"hljs-number\">#99a9bf</span>;<br>    <span class=\"hljs-attribute\">border-radius</span>: <span class=\"hljs-number\">20px</span>;<br>  &#125;<br>&#125;<br><br><span class=\"hljs-keyword\">@mixin</span> relative &#123;<br>  <span class=\"hljs-attribute\">position</span>: relative;<br>  <span class=\"hljs-attribute\">width</span>: <span class=\"hljs-number\">100%</span>;<br>  <span class=\"hljs-attribute\">height</span>: <span class=\"hljs-number\">100%</span>;<br>&#125;<br><br><br></code></pre></td></tr></table></figure>\n<ul>\n<li>variables.scss</li>\n</ul>\n<figure class=\"highlight scss\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs scss\"><span class=\"hljs-comment\">// sidebar</span><br><span class=\"hljs-variable\">$menuText</span>: <span class=\"hljs-number\">#bfcbd9</span>;<br><span class=\"hljs-variable\">$menuActiveText</span>: <span class=\"hljs-number\">#ffffff</span>;<br><span class=\"hljs-variable\">$subMenuActiveText</span>: <span class=\"hljs-number\">#f4f4f5</span>;<br><br><span class=\"hljs-variable\">$menuBg</span>: <span class=\"hljs-number\">#304156</span>;<br><span class=\"hljs-variable\">$menuHover</span>: <span class=\"hljs-number\">#263445</span>;<br><br><span class=\"hljs-variable\">$subMenuBg</span>: <span class=\"hljs-number\">#1f2d3d</span>;<br><span class=\"hljs-variable\">$subMenuHover</span>: <span class=\"hljs-number\">#001528</span>;<br><br><span class=\"hljs-variable\">$sideBarWidth</span>: <span class=\"hljs-number\">210px</span>;<br><span class=\"hljs-variable\">$hideSideBarWidth</span>: <span class=\"hljs-number\">54px</span>;<br><span class=\"hljs-variable\">$sideBarDuration</span>: <span class=\"hljs-number\">0.28s</span>;<br><br><span class=\"hljs-comment\">// https://www.bluematador.com/blog/how-to-share-variables-between-js-and-sass</span><br><span class=\"hljs-comment\">// JS 与 scss 共享变量，在 scss 中通过 :export 进行导出，在 js 中可通过 ESM 进行导入</span><br>:export &#123;<br>  menuText: <span class=\"hljs-variable\">$menuText</span>;<br>  menuActiveText: <span class=\"hljs-variable\">$menuActiveText</span>;<br>  subMenuActiveText: <span class=\"hljs-variable\">$subMenuActiveText</span>;<br>  menuBg: <span class=\"hljs-variable\">$menuBg</span>;<br>  menuHover: <span class=\"hljs-variable\">$menuHover</span>;<br>  subMenuBg: <span class=\"hljs-variable\">$subMenuBg</span>;<br>  subMenuHover: <span class=\"hljs-variable\">$subMenuHover</span>;<br>  sideBarWidth: <span class=\"hljs-variable\">$sideBarWidth</span>;<br>&#125;<br><br></code></pre></td></tr></table></figure>\n\n<p>关于 <code>:export</code> 的使用方式，我们可以查阅一些文档：</p>\n<blockquote>\n<p><a href=\"https://www.bluematador.com/blog/how-to-share-variables-between-js-and-sass\">https://www.bluematador.com/blog/how-to-share-variables-between-js-and-sass</a></p>\n</blockquote>\n<h2 id=\"编写-layout-index-vue-样式\"><a href=\"#编写-layout-index-vue-样式\" class=\"headerlink\" title=\"编写 layout/index.vue 样式\"></a>编写 <code>layout/index.vue</code> 样式</h2><figure class=\"highlight scss\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs scss\">&lt;style lang=&quot;scss&quot; scoped&gt;<br><span class=\"hljs-keyword\">@import</span> <span class=\"hljs-string\">&#x27;~@/styles/mixin.scss&#x27;</span>;<br><span class=\"hljs-keyword\">@import</span> <span class=\"hljs-string\">&#x27;~@/styles/variables.scss&#x27;</span>;<br><br><span class=\"hljs-selector-class\">.app-wrapper</span> &#123;<br>  <span class=\"hljs-keyword\">@include</span> clearfix; <span class=\"hljs-comment\">// 使用 mixin 中的样式</span><br>  <span class=\"hljs-attribute\">position</span>: relative;<br>  <span class=\"hljs-attribute\">height</span>: <span class=\"hljs-number\">100%</span>;<br>  <span class=\"hljs-attribute\">width</span>: <span class=\"hljs-number\">100%</span>;<br>&#125;<br><br><span class=\"hljs-selector-class\">.fixed-header</span> &#123;<br>  <span class=\"hljs-attribute\">position</span>: fixed;<br>  <span class=\"hljs-attribute\">top</span>: <span class=\"hljs-number\">0</span>;<br>  <span class=\"hljs-attribute\">right</span>: <span class=\"hljs-number\">0</span>;<br>  <span class=\"hljs-attribute\">z-index</span>: <span class=\"hljs-number\">9</span>;<br>  <span class=\"hljs-attribute\">width</span>: calc(<span class=\"hljs-number\">100%</span> - #&#123;<span class=\"hljs-variable\">$sideBarWidth</span>&#125;);<br>&#125;<br>&lt;/style&gt;<br></code></pre></td></tr></table></figure>\n\n<h2 id=\"给-SideBar-赋予动态的背景色\"><a href=\"#给-SideBar-赋予动态的背景色\" class=\"headerlink\" title=\"给 SideBar 赋予动态的背景色\"></a>给 SideBar 赋予动态的背景色</h2><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\">&lt;template&gt;<br>...<br>  &lt;!-- 左侧 menu --&gt;<br>  <span class=\"language-xml\"><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">sidebar</span></span></span><br><span class=\"hljs-tag\"><span class=\"language-xml\">    <span class=\"hljs-attr\">class</span>=<span class=\"hljs-string\">&quot;sidebar-container&quot;</span></span></span><br><span class=\"hljs-tag\"><span class=\"language-xml\">    <span class=\"hljs-attr\">:style</span>=<span class=\"hljs-string\">&quot;&#123; backgroundColor: variables.menuBg &#125;&quot;</span></span></span><br><span class=\"hljs-tag\"><span class=\"language-xml\">  /&gt;</span></span><br>...<br>&lt;/template&gt;<br><br><span class=\"language-xml\"><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">script</span> <span class=\"hljs-attr\">setup</span>&gt;</span><span class=\"language-javascript\"></span></span><br><span class=\"language-javascript\"><span class=\"language-xml\"><span class=\"hljs-comment\">// scss 通过 :export 导出了变量</span></span></span><br><span class=\"language-javascript\"><span class=\"language-xml\"><span class=\"hljs-keyword\">import</span> variables <span class=\"hljs-keyword\">from</span> <span class=\"hljs-string\">&#x27;@/styles/variables.scss&#x27;</span></span></span><br><span class=\"language-javascript\"><span class=\"language-xml\"></span><span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">script</span>&gt;</span></span><br></code></pre></td></tr></table></figure>\n\n<h2 id=\"script导入scss文件报错\"><a href=\"#script导入scss文件报错\" class=\"headerlink\" title=\"script导入scss文件报错\"></a>script导入scss文件报错</h2><p>在 vue 项目里引用.scss文件，vscode编辑器会有红色波浪线，提示找不到模块</p>\n<p><img src=\"/img/import-scss-error.png\" alt=\"\"></p>\n<p>找到 <code>shims-vue.d.ts</code> 声明文件，添加如下代码:</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\">declare <span class=\"hljs-variable language_\">module</span> <span class=\"hljs-string\">&#x27;*.scss&#x27;</span> &#123;<br>  <span class=\"hljs-keyword\">const</span> <span class=\"hljs-attr\">css</span>: &#123;<br>    <span class=\"hljs-comment\">// 定义的变量，通过 `variables.menuBg` 取值时，就不会报错了</span><br>    <span class=\"hljs-attr\">menuBg</span>: string;<br>  &#125;<br>  <span class=\"hljs-keyword\">export</span> <span class=\"hljs-keyword\">default</span> css<br>&#125;<br></code></pre></td></tr></table></figure>\n\n<p>将来，新增了新的样式变量，我们在 css 下添加即可。</p>\n<h2 id=\"设置NavBar样式和头像布局\"><a href=\"#设置NavBar样式和头像布局\" class=\"headerlink\" title=\"设置NavBar样式和头像布局\"></a>设置NavBar样式和头像布局</h2><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\">&lt;template&gt;<br>  <span class=\"language-xml\"><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">div</span> <span class=\"hljs-attr\">class</span>=<span class=\"hljs-string\">&quot;navbar&quot;</span>&gt;</span></span><br><span class=\"language-xml\">    <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">div</span> <span class=\"hljs-attr\">class</span>=<span class=\"hljs-string\">&quot;right-menu&quot;</span>&gt;</span></span><br><span class=\"language-xml\">      <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">el-dropdown</span> <span class=\"hljs-attr\">class</span>=<span class=\"hljs-string\">&quot;avatar-container&quot;</span> <span class=\"hljs-attr\">trigger</span>=<span class=\"hljs-string\">&quot;click&quot;</span>&gt;</span></span><br><span class=\"language-xml\">        <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">div</span> <span class=\"hljs-attr\">class</span>=<span class=\"hljs-string\">&quot;avatar-wrapper&quot;</span>&gt;</span></span><br><span class=\"language-xml\">          <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">el-avatar</span></span></span><br><span class=\"hljs-tag\"><span class=\"language-xml\">            <span class=\"hljs-attr\">shape</span>=<span class=\"hljs-string\">&quot;square&quot;</span></span></span><br><span class=\"hljs-tag\"><span class=\"language-xml\">            <span class=\"hljs-attr\">:size</span>=<span class=\"hljs-string\">&quot;40&quot;</span></span></span><br><span class=\"hljs-tag\"><span class=\"language-xml\">            <span class=\"hljs-attr\">:src</span>=<span class=\"hljs-string\">&quot;&#x27;https://fuss10.elemecdn.com/e/5d/4a731a90594a4af544c0c25941171jpeg.jpeg&#x27;&quot;</span></span></span><br><span class=\"hljs-tag\"><span class=\"language-xml\">          &gt;</span><span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">el-avatar</span>&gt;</span></span><br><span class=\"language-xml\">          <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">el-icon</span>&gt;</span><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">Tools</span> /&gt;</span><span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">el-icon</span>&gt;</span></span><br><span class=\"language-xml\">        <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">div</span>&gt;</span></span><br><span class=\"language-xml\">        <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">template</span> #<span class=\"hljs-attr\">dropdown</span>&gt;</span></span><br><span class=\"language-xml\">          <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">el-dropdown-menu</span> <span class=\"hljs-attr\">class</span>=<span class=\"hljs-string\">&quot;user-dropdown&quot;</span>&gt;</span></span><br><span class=\"language-xml\">            <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">router-link</span> <span class=\"hljs-attr\">to</span>=<span class=\"hljs-string\">&quot;/&quot;</span>&gt;</span></span><br><span class=\"language-xml\">              <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">el-dropdown-item</span>&gt;</span> 主页 <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">el-dropdown-item</span>&gt;</span></span><br><span class=\"language-xml\">            <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">router-link</span>&gt;</span></span><br><span class=\"language-xml\">            <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">a</span> <span class=\"hljs-attr\">target</span>=<span class=\"hljs-string\">&quot;_blank&quot;</span> <span class=\"hljs-attr\">href</span>=<span class=\"hljs-string\">&quot;&quot;</span>&gt;</span></span><br><span class=\"language-xml\">              <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">el-dropdown-item</span>&gt;</span>Vue3<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">el-dropdown-item</span>&gt;</span></span><br><span class=\"language-xml\">            <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">a</span>&gt;</span></span><br><span class=\"language-xml\">            <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">el-dropdown-item</span> <span class=\"hljs-attr\">divided</span>&gt;</span> 退出 <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">el-dropdown-item</span>&gt;</span></span><br><span class=\"language-xml\">          <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">el-dropdown-menu</span>&gt;</span></span><br><span class=\"language-xml\">        <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">template</span>&gt;</span></span><br><span class=\"language-xml\">      <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">el-dropdown</span>&gt;</span></span><br><span class=\"language-xml\">    <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">div</span>&gt;</span></span><br><span class=\"language-xml\">  <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">div</span>&gt;</span></span><br>&lt;/template&gt;<br><br><span class=\"language-xml\"><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">script</span> <span class=\"hljs-attr\">setup</span> <span class=\"hljs-attr\">lang</span>=<span class=\"hljs-string\">&quot;ts&quot;</span>&gt;</span><span class=\"language-javascript\"></span></span><br><span class=\"language-javascript\"><span class=\"language-xml\"><span class=\"hljs-keyword\">import</span> &#123; ref, reactive &#125; <span class=\"hljs-keyword\">from</span> <span class=\"hljs-string\">&#x27;vue&#x27;</span></span></span><br><span class=\"language-javascript\"><span class=\"language-xml\"><span class=\"hljs-keyword\">import</span> &#123; <span class=\"hljs-title class_\">Tools</span> &#125; <span class=\"hljs-keyword\">from</span> <span class=\"hljs-string\">&#x27;@element-plus/icons-vue&#x27;</span></span></span><br><span class=\"language-javascript\"><span class=\"language-xml\"></span><span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">script</span>&gt;</span></span><br><span class=\"language-xml\"><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">style</span> <span class=\"hljs-attr\">scoped</span> <span class=\"hljs-attr\">lang</span>=<span class=\"hljs-string\">&quot;scss&quot;</span>&gt;</span><span class=\"language-css\"></span></span><br><span class=\"language-css\"><span class=\"language-xml\"><span class=\"hljs-selector-class\">.navbar</span> &#123;</span></span><br><span class=\"language-css\"><span class=\"language-xml\">  <span class=\"hljs-attribute\">height</span>: <span class=\"hljs-number\">50px</span>;</span></span><br><span class=\"language-css\"><span class=\"language-xml\">  <span class=\"hljs-attribute\">overflow</span>: hidden;</span></span><br><span class=\"language-css\"><span class=\"language-xml\">  <span class=\"hljs-attribute\">position</span>: relative;</span></span><br><span class=\"language-css\"><span class=\"language-xml\">  <span class=\"hljs-attribute\">background</span>: <span class=\"hljs-number\">#fff</span>;</span></span><br><span class=\"language-css\"><span class=\"language-xml\">  <span class=\"hljs-attribute\">box-shadow</span>: <span class=\"hljs-number\">0</span> <span class=\"hljs-number\">1px</span> <span class=\"hljs-number\">4px</span> <span class=\"hljs-built_in\">rgba</span>(<span class=\"hljs-number\">0</span>, <span class=\"hljs-number\">21</span>, <span class=\"hljs-number\">41</span>, <span class=\"hljs-number\">0.08</span>);</span></span><br><span class=\"language-css\"><span class=\"language-xml\"></span></span><br><span class=\"language-css\"><span class=\"language-xml\">  <span class=\"hljs-selector-class\">.right-menu</span> &#123;</span></span><br><span class=\"language-css\"><span class=\"language-xml\">    <span class=\"hljs-attribute\">display</span>: flex;</span></span><br><span class=\"language-css\"><span class=\"language-xml\">    <span class=\"hljs-attribute\">align-items</span>: center;</span></span><br><span class=\"language-css\"><span class=\"language-xml\">    <span class=\"hljs-attribute\">float</span>: right;</span></span><br><span class=\"language-css\"><span class=\"language-xml\">    <span class=\"hljs-attribute\">padding-right</span>: <span class=\"hljs-number\">16px</span>;</span></span><br><span class=\"language-css\"><span class=\"language-xml\"></span></span><br><span class=\"language-css\"><span class=\"language-xml\">    ::v-deep .right-menu-item &#123;</span></span><br><span class=\"language-css\"><span class=\"language-xml\">      <span class=\"hljs-attribute\">display</span>: inline-block;</span></span><br><span class=\"language-css\"><span class=\"language-xml\">      <span class=\"hljs-attribute\">padding</span>: <span class=\"hljs-number\">0</span> <span class=\"hljs-number\">18px</span> <span class=\"hljs-number\">0</span> <span class=\"hljs-number\">0</span>;</span></span><br><span class=\"language-css\"><span class=\"language-xml\">      <span class=\"hljs-attribute\">font-size</span>: <span class=\"hljs-number\">24px</span>;</span></span><br><span class=\"language-css\"><span class=\"language-xml\">      <span class=\"hljs-attribute\">color</span>: <span class=\"hljs-number\">#5a5e66</span>;</span></span><br><span class=\"language-css\"><span class=\"language-xml\">      <span class=\"hljs-attribute\">vertical-align</span>: text-bottom;</span></span><br><span class=\"language-css\"><span class=\"language-xml\"></span></span><br><span class=\"language-css\"><span class=\"language-xml\">      &amp;<span class=\"hljs-selector-class\">.hover-effect</span> &#123;</span></span><br><span class=\"language-css\"><span class=\"language-xml\">        <span class=\"hljs-attribute\">cursor</span>: pointer;</span></span><br><span class=\"language-css\"><span class=\"language-xml\">        <span class=\"hljs-attribute\">transition</span>: background <span class=\"hljs-number\">0.3s</span>;</span></span><br><span class=\"language-css\"><span class=\"language-xml\"></span></span><br><span class=\"language-css\"><span class=\"language-xml\">        &amp;<span class=\"hljs-selector-pseudo\">:hover</span> &#123;</span></span><br><span class=\"language-css\"><span class=\"language-xml\">          <span class=\"hljs-attribute\">background</span>: <span class=\"hljs-built_in\">rgba</span>(<span class=\"hljs-number\">0</span>, <span class=\"hljs-number\">0</span>, <span class=\"hljs-number\">0</span>, <span class=\"hljs-number\">0.025</span>);</span></span><br><span class=\"language-css\"><span class=\"language-xml\">        &#125;</span></span><br><span class=\"language-css\"><span class=\"language-xml\">      &#125;</span></span><br><span class=\"language-css\"><span class=\"language-xml\">    &#125;</span></span><br><span class=\"language-css\"><span class=\"language-xml\"></span></span><br><span class=\"language-css\"><span class=\"language-xml\">    ::v-deep .avatar-container &#123;</span></span><br><span class=\"language-css\"><span class=\"language-xml\">      <span class=\"hljs-attribute\">cursor</span>: pointer;</span></span><br><span class=\"language-css\"><span class=\"language-xml\">      <span class=\"hljs-selector-class\">.avatar-wrapper</span> &#123;</span></span><br><span class=\"language-css\"><span class=\"language-xml\">        <span class=\"hljs-attribute\">margin-top</span>: <span class=\"hljs-number\">5px</span>;</span></span><br><span class=\"language-css\"><span class=\"language-xml\">        <span class=\"hljs-attribute\">position</span>: relative;</span></span><br><span class=\"language-css\"><span class=\"language-xml\">        <span class=\"hljs-selector-class\">.el-avatar</span> &#123;</span></span><br><span class=\"language-css\"><span class=\"language-xml\">          <span class=\"hljs-attr\">--el-avatar-background-color</span>: none;</span></span><br><span class=\"language-css\"><span class=\"language-xml\">          <span class=\"hljs-attribute\">margin-right</span>: <span class=\"hljs-number\">12px</span>;</span></span><br><span class=\"language-css\"><span class=\"language-xml\">        &#125;</span></span><br><span class=\"language-css\"><span class=\"language-xml\">      &#125;</span></span><br><span class=\"language-css\"><span class=\"language-xml\">    &#125;</span></span><br><span class=\"language-css\"><span class=\"language-xml\">  &#125;</span></span><br><span class=\"language-css\"><span class=\"language-xml\">&#125;</span></span><br><span class=\"language-css\"><span class=\"language-xml\"></span><span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">style</span>&gt;</span></span><br></code></pre></td></tr></table></figure>\n\n<h2 id=\"效果图\"><a href=\"#效果图\" class=\"headerlink\" title=\"效果图\"></a>效果图</h2><p><img src=\"/img/layout-base.png\" alt=\"\"></p>\n<h1 id=\"获取用户信息\"><a href=\"#获取用户信息\" class=\"headerlink\" title=\"获取用户信息\"></a>获取用户信息</h1><p>到目前为止，头像是静态的，也没有实现登出的逻辑，现在来实现一下。</p>\n<h2 id=\"设置请求头\"><a href=\"#设置请求头\" class=\"headerlink\" title=\"设置请求头\"></a>设置请求头</h2><p>我们不希望每次调接口时，都去设置 <code>token</code>，那么我们可以在 <code>请求拦截器</code> 中去设置:</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\">service.<span class=\"hljs-property\">interceptors</span>.<span class=\"hljs-property\">request</span>.<span class=\"hljs-title function_\">use</span>(<br>  <span class=\"hljs-function\"><span class=\"hljs-params\">config</span> =&gt;</span> &#123;<br>    <span class=\"hljs-keyword\">if</span> (store.<span class=\"hljs-property\">getters</span>.<span class=\"hljs-property\">token</span>) &#123;<br>      config.<span class=\"hljs-property\">headers</span>.<span class=\"hljs-property\">Authorization</span> = <span class=\"hljs-string\">`Baerer <span class=\"hljs-subst\">$&#123;store.getters.token&#125;</span>`</span><br>    &#125;<br><br>    <span class=\"hljs-keyword\">return</span> config<br>  &#125;,<br>  <span class=\"hljs-function\"><span class=\"hljs-params\">error</span> =&gt;</span> &#123;<br>    <span class=\"hljs-keyword\">return</span> <span class=\"hljs-title class_\">Promise</span>.<span class=\"hljs-title function_\">reject</span>(error)<br>  &#125;<br>)<br></code></pre></td></tr></table></figure>\n\n<h2 id=\"编写-userInfo-接口\"><a href=\"#编写-userInfo-接口\" class=\"headerlink\" title=\"编写 userInfo 接口\"></a>编写 userInfo 接口</h2><p>简单实现一下 <code>/userinfo</code> 接口，主要是模拟前后端联调的流程。</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\"><span class=\"hljs-keyword\">const</span> express = <span class=\"hljs-built_in\">require</span>(<span class=\"hljs-string\">&#x27;express&#x27;</span>);<br><span class=\"hljs-keyword\">const</span> app = <span class=\"hljs-title function_\">express</span>()<br><br>app.<span class=\"hljs-title function_\">get</span>(<span class=\"hljs-string\">&#x27;/userinfo&#x27;</span>, <span class=\"hljs-function\">(<span class=\"hljs-params\">req, res</span>) =&gt;</span> &#123;<br>  <span class=\"hljs-comment\">// 存在 token，可以返回用户信息</span><br>  <span class=\"hljs-keyword\">if</span> (req.<span class=\"hljs-property\">headers</span>[<span class=\"hljs-string\">&#x27;authorization&#x27;</span>]) &#123;<br><br>    res.<span class=\"hljs-title function_\">json</span>(&#123;<br>      <span class=\"hljs-attr\">code</span>: <span class=\"hljs-number\">0</span>,<br>      <span class=\"hljs-attr\">data</span>: &#123;<br>        <span class=\"hljs-attr\">avatar</span>: <span class=\"hljs-string\">&#x27;https://fuss10.elemecdn.com/e/5d/4a731a90594a4af544c0c25941171jpeg.jpeg&#x27;</span>,<br>        <span class=\"hljs-attr\">name</span>: <span class=\"hljs-string\">&#x27;Hello_AlexCc&#x27;</span>,<br>        <span class=\"hljs-attr\">id</span>: <span class=\"hljs-number\">1</span>,<br>        <span class=\"hljs-attr\">role</span>: <span class=\"hljs-string\">&#x27;super_admin&#x27;</span><br>      &#125;,<br>      <span class=\"hljs-attr\">message</span>: <span class=\"hljs-string\">&#x27;获取用户信息成功&#x27;</span>,<br>      <span class=\"hljs-attr\">success</span>: <span class=\"hljs-literal\">true</span>,<br>    &#125;)<br>  &#125;<br>&#125;)<br><br>app.<span class=\"hljs-title function_\">listen</span>(<span class=\"hljs-number\">9999</span>, <span class=\"hljs-function\">() =&gt;</span> &#123;<br>  <span class=\"hljs-variable language_\">console</span>.<span class=\"hljs-title function_\">log</span>(<span class=\"hljs-string\">&#x27;server site an port 9999 ...&#x27;</span>)<br>&#125;)<br></code></pre></td></tr></table></figure>\n\n<h2 id=\"调用-userInfo-接口时机\"><a href=\"#调用-userInfo-接口时机\" class=\"headerlink\" title=\"调用 userInfo 接口时机\"></a>调用 userInfo 接口时机</h2><p>我们的 <code>userInfo</code> 接口已经编写好了，那么我们在什么时候调用呢？</p>\n<p>很显然，我们需要在 <code>permission.ts</code> 中去调用，当用户登录才有 <code>token</code>，也就是说，我们可以在 <code>token</code> 存在时，并且 <code>to.path</code> 不等于 <code>/login</code> 的时候去调用用户信息接口。</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\"><span class=\"hljs-keyword\">if</span> (store.<span class=\"hljs-property\">getters</span>.<span class=\"hljs-property\">token</span>) &#123;<br>  <span class=\"hljs-keyword\">if</span> (to.<span class=\"hljs-property\">path</span> === <span class=\"hljs-string\">&#x27;/login&#x27;</span>) &#123;<br>    <span class=\"hljs-title function_\">next</span>(<span class=\"hljs-string\">&#x27;/&#x27;</span>)<br>  &#125; <span class=\"hljs-keyword\">else</span> &#123;<br>    <span class=\"hljs-comment\">// 调用用户信息接口</span><br>    <span class=\"hljs-keyword\">await</span> store.<span class=\"hljs-title function_\">dispatch</span>(<span class=\"hljs-string\">&#x27;user/getUserInfo&#x27;</span>)<br><br>    <span class=\"hljs-title function_\">next</span>()<br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure>\n\n<p>我们获取用户信息接口的动作，放在了 <code>module user</code> 的 <code>actions</code> 中：</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\"><span class=\"hljs-comment\">// module/user.ts</span><br><br><span class=\"hljs-comment\">// state</span><br><span class=\"hljs-attr\">state</span>: <span class=\"hljs-function\">() =&gt;</span> (&#123;<br>  <span class=\"hljs-attr\">token</span>: <span class=\"hljs-title function_\">getItem</span>(<span class=\"hljs-string\">&#x27;token&#x27;</span>) || <span class=\"hljs-string\">&#x27;&#x27;</span>,<br>  <span class=\"hljs-attr\">userinfo</span>: &#123;&#125;<br>&#125;),<br><br><span class=\"hljs-comment\">// actions</span><br><span class=\"hljs-keyword\">async</span> <span class=\"hljs-title function_\">getUserInfo</span>(<span class=\"hljs-params\">context</span>) &#123;<br>  <span class=\"hljs-keyword\">const</span> info = <span class=\"hljs-keyword\">await</span> <span class=\"hljs-title function_\">getUserInfo</span>()<br>  context.<span class=\"hljs-title function_\">commit</span>(<span class=\"hljs-string\">&#x27;setUserInfo&#x27;</span>, info)<br>  <span class=\"hljs-keyword\">return</span> info<br>&#125;,<br></code></pre></td></tr></table></figure>\n\n<p>方便使用 <code>userInfo</code>，我们可以将其放到 <code>getters</code> 中：</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\"><span class=\"hljs-keyword\">const</span> getters = &#123;<br>  <span class=\"hljs-attr\">token</span>: <span class=\"hljs-function\">(<span class=\"hljs-params\">state</span>) =&gt;</span> state.<span class=\"hljs-property\">user</span>.<span class=\"hljs-property\">token</span>,<br>  <span class=\"hljs-attr\">userInfo</span>: <span class=\"hljs-function\">(<span class=\"hljs-params\">state</span>) =&gt;</span> state.<span class=\"hljs-property\">user</span>.<span class=\"hljs-property\">userinfo</span><br>&#125;<br></code></pre></td></tr></table></figure>\n\n<p>最后，我们就能在 <code>NavBar</code> 使用获取到的用户信息了。</p>\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs html\"><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">el-avatar</span></span><br><span class=\"hljs-tag\">  <span class=\"hljs-attr\">shape</span>=<span class=\"hljs-string\">&quot;square&quot;</span></span><br><span class=\"hljs-tag\">  <span class=\"hljs-attr\">:size</span>=<span class=\"hljs-string\">&quot;40&quot;</span></span><br><span class=\"hljs-tag\">  <span class=\"hljs-attr\">:src</span>=<span class=\"hljs-string\">&quot;$store.getters.userInfo.avatar&quot;</span></span><br><span class=\"hljs-tag\">&gt;</span><span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">el-avatar</span>&gt;</span><br></code></pre></td></tr></table></figure>\n\n<p><strong>避免重复调用 userInfo 接口</strong></p>\n<p>我们发现，每次切换路由时，都会触发路由的前置守卫，从而多次触发 <code>getUserInfo</code> 接口，我们把这个问题解决一下</p>\n<ol>\n<li>在 store 中定义 <code>hasUserInfo</code>，用来判断是否已经有用户信息了，如果有用户信息，我们就不要再触发 <code>getUserInfo</code> 接口了</li>\n</ol>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\"><span class=\"hljs-comment\">// getters.ts</span><br><br><span class=\"hljs-attr\">hasUserInfo</span>: <span class=\"hljs-function\">(<span class=\"hljs-params\">state</span>) =&gt;</span> &#123;<br>  <span class=\"hljs-comment\">// 如果用户信息存在，return true</span><br>  <span class=\"hljs-keyword\">return</span> <span class=\"hljs-title class_\">JSON</span>.<span class=\"hljs-title function_\">stringify</span>(state.<span class=\"hljs-property\">user</span>.<span class=\"hljs-property\">userinfo</span>) !== <span class=\"hljs-string\">&#x27;&#123;&#125;&#x27;</span><br>&#125;<br></code></pre></td></tr></table></figure>\n\n<ol start=\"2\">\n<li>修改 <code>permission.ts</code> 文件，只有 <code>hasUserInfo</code> 为 <code>false</code> 时，我们才调用用户信息接口</li>\n</ol>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\"><span class=\"hljs-keyword\">if</span> (store.<span class=\"hljs-property\">getters</span>.<span class=\"hljs-property\">token</span>) &#123;<br>  <span class=\"hljs-keyword\">if</span> (to.<span class=\"hljs-property\">path</span> === <span class=\"hljs-string\">&#x27;/login&#x27;</span>) &#123;<br>    <span class=\"hljs-title function_\">next</span>(<span class=\"hljs-string\">&#x27;/&#x27;</span>)<br>  &#125; <span class=\"hljs-keyword\">else</span> &#123;<br>    <span class=\"hljs-keyword\">if</span> (!store.<span class=\"hljs-property\">getters</span>.<span class=\"hljs-property\">hasUserInfo</span>) &#123;<br>      <span class=\"hljs-keyword\">await</span> store.<span class=\"hljs-title function_\">dispatch</span>(<span class=\"hljs-string\">&#x27;user/getUserInfo&#x27;</span>)<br>    &#125;<br><br>    <span class=\"hljs-title function_\">next</span>()<br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure>\n\n<h1 id=\"登出逻辑\"><a href=\"#登出逻辑\" class=\"headerlink\" title=\"登出逻辑\"></a>登出逻辑</h1><p>登出分为两种形式：</p>\n<ul>\n<li>用户主动退出</li>\n<li>用户被动登录（token 过去 | 账号被挤）</li>\n</ul>\n<p>不管以何种形式退出，登出的逻辑都是相同的。</p>\n<ul>\n<li>清理掉用户的缓存数据</li>\n<li>清理掉权限相关的配置</li>\n<li>返回到登录页</li>\n</ul>\n<p>登出的逻辑，我们也可以写在 <code>module user</code> 中去处理。</p>\n<p>主要执行 3 个步骤：</p>\n<ul>\n<li>清空 store token</li>\n<li>清除浏览器本地存储</li>\n<li>跳转到 login 页</li>\n</ul>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\"><span class=\"hljs-title function_\">logout</span>(<span class=\"hljs-params\">context: any</span>) &#123;<br>  context.<span class=\"hljs-title function_\">commit</span>(<span class=\"hljs-string\">&#x27;setToken&#x27;</span>, <span class=\"hljs-string\">&#x27;&#x27;</span>)<br>  <span class=\"hljs-title function_\">removeAllItem</span>()<br>  router.<span class=\"hljs-title function_\">push</span>(<span class=\"hljs-string\">&#x27;/login&#x27;</span>)<br>&#125;<br></code></pre></td></tr></table></figure>\n\n<h2 id=\"主动退出\"><a href=\"#主动退出\" class=\"headerlink\" title=\"主动退出\"></a>主动退出</h2><p>用户点击登录按钮，通过 store dispatch 触发 action 的 logout 即可。</p>\n<h2 id=\"被动退出\"><a href=\"#被动退出\" class=\"headerlink\" title=\"被动退出\"></a>被动退出</h2><p>被动退出大概分为两种：</p>\n<ul>\n<li>token 失效</li>\n<li>账号被挤下去</li>\n</ul>\n<p>那么这两种场景下，在前端对应的处理方案一共也分为两种，共分为 主动处理 、被动处理 两种 ：</p>\n<ul>\n<li>主动处理：主要应对 token 失效</li>\n<li>被动处理：同时应对 token 失效 与 单点登录（账号被挤）</li>\n</ul>\n<h3 id=\"用户被动退出解决方案之主动处理\"><a href=\"#用户被动退出解决方案之主动处理\" class=\"headerlink\" title=\"用户被动退出解决方案之主动处理\"></a>用户被动退出解决方案之主动处理</h3><p>为了保证用户的信息安全，那么对于 token 而言就被制定了很多的安全策略，比如：</p>\n<ul>\n<li>动态 token（可变 token）</li>\n<li>刷新 token</li>\n<li>时效 token<br>…</li>\n</ul>\n<p>我们这里采用 <code>时效 token</code>。</p>\n<p>那么对应到我们代码中的实现方案为：</p>\n<ul>\n<li>在用户登陆时，记录当前 登录时间</li>\n<li>制定一个 失效时长</li>\n<li>在接口调用时，根据 <code>当前时间</code> 对比 <code>登录时间</code> ，看是否超过了 <code>时效时长</code><ul>\n<li>如果未超过，则正常进行后续操作</li>\n<li>如果超过，则进行 退出登录 操作</li>\n</ul>\n</li>\n</ul>\n<h3 id=\"代码实现\"><a href=\"#代码实现\" class=\"headerlink\" title=\"代码实现\"></a>代码实现</h3><p>创建 <code>utils/auth.js</code> 文件，并写入以下代码：</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\"><span class=\"hljs-keyword\">import</span> &#123; <span class=\"hljs-variable constant_\">TIME_STAMP</span>, <span class=\"hljs-variable constant_\">TOKEN_TIMEOUT_VALUE</span> &#125; <span class=\"hljs-keyword\">from</span> <span class=\"hljs-string\">&#x27;@/constant&#x27;</span><br><span class=\"hljs-keyword\">import</span> &#123; setItem, getItem &#125; <span class=\"hljs-keyword\">from</span> <span class=\"hljs-string\">&#x27;@/utils/storage&#x27;</span><br><span class=\"hljs-comment\">/**</span><br><span class=\"hljs-comment\"> * 获取时间戳</span><br><span class=\"hljs-comment\"> */</span><br><span class=\"hljs-keyword\">export</span> <span class=\"hljs-keyword\">function</span> <span class=\"hljs-title function_\">getTimeStamp</span>(<span class=\"hljs-params\"></span>) &#123;<br>  <span class=\"hljs-keyword\">return</span> <span class=\"hljs-title function_\">getItem</span>(<span class=\"hljs-variable constant_\">TIME_STAMP</span>)<br>&#125;<br><span class=\"hljs-comment\">/**</span><br><span class=\"hljs-comment\"> * 设置时间戳</span><br><span class=\"hljs-comment\"> */</span><br><span class=\"hljs-keyword\">export</span> <span class=\"hljs-keyword\">function</span> <span class=\"hljs-title function_\">setTimeStamp</span>(<span class=\"hljs-params\"></span>) &#123;<br>  <span class=\"hljs-title function_\">setItem</span>(<span class=\"hljs-variable constant_\">TIME_STAMP</span>, <span class=\"hljs-title class_\">Date</span>.<span class=\"hljs-title function_\">now</span>())<br>&#125;<br><span class=\"hljs-comment\">/**</span><br><span class=\"hljs-comment\"> * 是否超时</span><br><span class=\"hljs-comment\"> */</span><br><span class=\"hljs-keyword\">export</span> <span class=\"hljs-keyword\">function</span> <span class=\"hljs-title function_\">isCheckTimeout</span>(<span class=\"hljs-params\"></span>) &#123;<br>  <span class=\"hljs-comment\">// 当前时间戳</span><br>  <span class=\"hljs-keyword\">var</span> currentTime = <span class=\"hljs-title class_\">Date</span>.<span class=\"hljs-title function_\">now</span>()<br>  <span class=\"hljs-comment\">// 缓存时间戳</span><br>  <span class=\"hljs-keyword\">var</span> timeStamp = <span class=\"hljs-title function_\">getTimeStamp</span>()<br>  <span class=\"hljs-keyword\">return</span> currentTime - timeStamp &gt; <span class=\"hljs-variable constant_\">TOKEN_TIMEOUT_VALUE</span><br>&#125;<br></code></pre></td></tr></table></figure>\n\n<p>在 <code>constant</code> 中声明对应常量：</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\"><span class=\"hljs-comment\">// token 时间戳</span><br><span class=\"hljs-keyword\">export</span> <span class=\"hljs-keyword\">const</span> <span class=\"hljs-variable constant_\">TIME_STAMP</span> = <span class=\"hljs-string\">&#x27;timeStamp&#x27;</span><br><span class=\"hljs-comment\">// 超时时长(毫秒) 两小时</span><br><span class=\"hljs-keyword\">export</span> <span class=\"hljs-keyword\">const</span> <span class=\"hljs-variable constant_\">TOKEN_TIMEOUT_VALUE</span> = <span class=\"hljs-number\">2</span> * <span class=\"hljs-number\">60</span> * <span class=\"hljs-number\">60</span> * <span class=\"hljs-number\">1000</span><br></code></pre></td></tr></table></figure>\n\n<p>在用户登录成功之后去设置时间，到 <code>store/user.js</code> 的 <code>login</code> 中：</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\"><span class=\"hljs-keyword\">import</span> &#123; setTimeStamp &#125; <span class=\"hljs-keyword\">from</span> <span class=\"hljs-string\">&#x27;@/utils/auth&#x27;</span><br><br><span class=\"hljs-title function_\">login</span>(<span class=\"hljs-params\">context, userInfo</span>) &#123;<br>  ...<br>  <span class=\"hljs-keyword\">return</span> <span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">Promise</span>(<span class=\"hljs-function\">(<span class=\"hljs-params\">resolve, reject</span>) =&gt;</span> &#123;<br>    ...<br>      .<span class=\"hljs-title function_\">then</span>(<span class=\"hljs-function\"><span class=\"hljs-params\">data</span> =&gt;</span> &#123;<br>        ...<br>        <span class=\"hljs-comment\">// 保存登录时间</span><br>        <span class=\"hljs-title function_\">setTimeStamp</span>()<br>        <span class=\"hljs-title function_\">resolve</span>()<br>      &#125;)<br>  &#125;)<br>&#125;,<br></code></pre></td></tr></table></figure>\n\n<p>在 <code>utils/request</code> 对应的请求拦截器中进行 <strong>主动介入</strong></p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\"><span class=\"hljs-keyword\">import</span> &#123; isCheckTimeout &#125; <span class=\"hljs-keyword\">from</span> <span class=\"hljs-string\">&#x27;@/utils/auth&#x27;</span><br><br><span class=\"hljs-keyword\">if</span> (store.<span class=\"hljs-property\">getters</span>.<span class=\"hljs-property\">token</span>) &#123;<br>  <span class=\"hljs-keyword\">if</span> (<span class=\"hljs-title function_\">isCheckTimeout</span>()) &#123;<br>    <span class=\"hljs-comment\">// 登出操作</span><br>    store.<span class=\"hljs-title function_\">dispatch</span>(<span class=\"hljs-string\">&#x27;user/logout&#x27;</span>)<br><br>    <span class=\"hljs-comment\">// 失败的话，会走到 interceptors.response 的 error 方法。</span><br>    <span class=\"hljs-keyword\">return</span> <span class=\"hljs-title class_\">Promise</span>.<span class=\"hljs-title function_\">reject</span>(<span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">Error</span>(<span class=\"hljs-string\">&#x27;token 失效&#x27;</span>))<br>  &#125;<br>  ...<br>&#125;<br></code></pre></td></tr></table></figure>\n\n<p>那么至此我们就完成了 <strong>主动处理</strong> 对应的业务逻辑。</p>\n<h3 id=\"用户被动退出解决方案之被动处理\"><a href=\"#用户被动退出解决方案之被动处理\" class=\"headerlink\" title=\"用户被动退出解决方案之被动处理\"></a>用户被动退出解决方案之被动处理</h3><p><strong>背景：</strong></p>\n<p>首先我们需要先明确 <strong>被动处理</strong> 需要应对两种业务场景：</p>\n<ol>\n<li><code>token</code> 过期</li>\n<li>单点登录</li>\n</ol>\n<p>然后我们一个一个来去看，首先是 <code>token</code> 过期</p>\n<blockquote>\n<p>我们知道对于 <code>token</code> 而言，本身就是具备时效的，这个是在服务端生成 <code>token</code> 时就已经确定的。</p>\n<p>而此时我们所谓的 <code>token</code> 过期指的就是：</p>\n<p><strong>服务端生成的 <code>token</code> 超过 服务端指定时效</strong> 的过程，就像我们前端项目指定 token 的失效性一样。</p>\n</blockquote>\n<p>而对于 单点登录 而言，指的是： </p>\n<blockquote>\n<p>当用户 A 登录之后，<code>token</code> 过期之前。</p>\n<p> 用户 A 的账号在其他的设备中进行了二次登录，导致第一次登录的 A 账号被 “顶下来” 的过程。</p>\n<p>即：<strong>同一账户仅可以在一个设备中保持在线状态</strong></p>\n</blockquote>\n<p>那么明确好了对应的背景之后，接下来我们来看对应的业务处理场景：</p>\n<p>从背景中我们知道，以上的两种情况，都是在 <strong>服务端进行判断的</strong>，而对于前端而言其实是 <strong>服务端通知前端的一个过程。</strong></p>\n<p>所以说对于其业务处理，将遵循以下逻辑：</p>\n<ol>\n<li>服务端返回数据时，会通过特定的状态码通知前端</li>\n<li>当前端接收到特定状态码时，表示遇到了特定状态：<strong><code>token</code> 时效</strong> 或 <strong>单点登录</strong></li>\n<li>此时进行 <strong>退出登录</strong> 处理</li>\n</ol>\n<p>这里只做了 token 的过期处理，如果需要到 <strong>单点登录</strong> 时，只需要增加一个状态码判断即可。</p>\n<p><strong>服务端超时间逻辑</strong><br>我们来简单实现一下后端的超时逻辑。</p>\n<p>我们通过 <code>app.use</code> 添加了一个中间件，每一次前端触发了接口请求，都会先走这个中间件逻辑。</p>\n<p>服务器启动时，我们把 <code>now</code> 和 <code>current</code> 设置当前时间戳，当有一个接口触发了，会将 <code>current</code> 设置新的时间戳。</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\"><span class=\"hljs-keyword\">const</span> express = <span class=\"hljs-built_in\">require</span>(<span class=\"hljs-string\">&#x27;express&#x27;</span>);<br><span class=\"hljs-keyword\">const</span> app = <span class=\"hljs-title function_\">express</span>()<br><br><span class=\"hljs-comment\">// token 超时 2h</span><br><span class=\"hljs-keyword\">const</span> <span class=\"hljs-variable constant_\">TOKEN_TIMEOUT_VALUE</span> = <span class=\"hljs-number\">2</span> * <span class=\"hljs-number\">60</span> * <span class=\"hljs-number\">60</span> * <span class=\"hljs-number\">1000</span><br><span class=\"hljs-keyword\">let</span> now = <span class=\"hljs-title class_\">Date</span>.<span class=\"hljs-title function_\">now</span>()<br><span class=\"hljs-keyword\">let</span> current = <span class=\"hljs-title class_\">Date</span>.<span class=\"hljs-title function_\">now</span>()<br><br>app.<span class=\"hljs-title function_\">use</span>(<span class=\"hljs-keyword\">function</span>(<span class=\"hljs-params\">req, res, next</span>) &#123;<br>  <span class=\"hljs-comment\">// 每次有接口调用，触发中间件，将 current 更新</span><br>  current = <span class=\"hljs-title class_\">Date</span>.<span class=\"hljs-title function_\">now</span>()<br><br>  <span class=\"hljs-comment\">// 如果是登录逻辑，我们将 now 设置为 current，这样就不会触发超时逻辑</span><br>  <span class=\"hljs-comment\">// 重新登录，继续走此判断，将 now 设置为 current</span><br>  <span class=\"hljs-keyword\">if</span> (req.<span class=\"hljs-property\">path</span> === <span class=\"hljs-string\">&#x27;/login&#x27;</span>) &#123;<br>    now = current<br>  &#125;<br><br>  <span class=\"hljs-comment\">// 每次中间件都会将 current 更新为当前时间戳，一旦时间戳的差值，大于了 2h，就会触发 超时逻辑</span><br>  <span class=\"hljs-keyword\">if</span> (current - now &gt; <span class=\"hljs-variable constant_\">TOKEN_TIMEOUT_VALUE</span>) &#123;<br>    <span class=\"hljs-comment\">// 超时</span><br>    res.<span class=\"hljs-title function_\">status</span>(<span class=\"hljs-number\">401</span>).<span class=\"hljs-title function_\">send</span>(&#123;<br>      <span class=\"hljs-attr\">code</span>: <span class=\"hljs-number\">401</span>,<br>      <span class=\"hljs-attr\">message</span>: <span class=\"hljs-string\">&#x27;服务端message: token 失效啦&#x27;</span>,<br>      <span class=\"hljs-attr\">success</span>: <span class=\"hljs-literal\">false</span>,<br>    &#125;)<br>  &#125; <span class=\"hljs-keyword\">else</span> &#123;<br><br>    <span class=\"hljs-comment\">// 没有超时，将执行权交给下一个路由</span><br>    <span class=\"hljs-title function_\">next</span>()<br>  &#125;<br>&#125;)<br></code></pre></td></tr></table></figure>\n\n\n<p><strong>那么明确好了业务之后，接下来我们来实现前端对应代码：</strong></p>\n<p>在 <code>utils/request</code> 的响应拦截器中，增加以下逻辑：</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\"><span class=\"hljs-comment\">// 响应拦截器</span><br>service.<span class=\"hljs-property\">interceptors</span>.<span class=\"hljs-property\">response</span>.<span class=\"hljs-title function_\">use</span>(<br>  <span class=\"hljs-function\"><span class=\"hljs-params\">response</span> =&gt;</span> &#123;<br>    ...<br>  &#125;,<br>  <span class=\"hljs-function\"><span class=\"hljs-params\">error</span> =&gt;</span> &#123;<br>    <span class=\"hljs-comment\">// 处理 token 超时问题</span><br>    <span class=\"hljs-keyword\">if</span> (<br>      error.<span class=\"hljs-property\">response</span> &amp;&amp;<br>      error.<span class=\"hljs-property\">response</span>.<span class=\"hljs-property\">data</span> &amp;&amp;<br>      error.<span class=\"hljs-property\">response</span>.<span class=\"hljs-property\">data</span>.<span class=\"hljs-property\">code</span> === <span class=\"hljs-number\">401</span><br>    ) &#123;<br>      store.<span class=\"hljs-title function_\">dispatch</span>(<span class=\"hljs-string\">&#x27;user/logout&#x27;</span>)<br>    &#125;<br><br>    <span class=\"hljs-keyword\">if</span> (error.<span class=\"hljs-property\">response</span> &amp;&amp; error.<span class=\"hljs-property\">response</span>.<span class=\"hljs-property\">data</span> &amp;&amp; error.<span class=\"hljs-property\">response</span>.<span class=\"hljs-property\">data</span>.<span class=\"hljs-property\">message</span>) &#123;<br>      <span class=\"hljs-title class_\">ElMessage</span>.<span class=\"hljs-title function_\">error</span>(error.<span class=\"hljs-property\">response</span>.<span class=\"hljs-property\">data</span>.<span class=\"hljs-property\">message</span>) <span class=\"hljs-comment\">// 提示服务端抛出的错误信息</span><br>    &#125; <span class=\"hljs-keyword\">else</span> &#123;<br>      <span class=\"hljs-title class_\">ElMessage</span>.<span class=\"hljs-title function_\">error</span>(error.<span class=\"hljs-property\">message</span>)<br>    &#125;<br>    <span class=\"hljs-keyword\">return</span> <span class=\"hljs-title class_\">Promise</span>.<span class=\"hljs-title function_\">reject</span>(error)<br>  &#125;<br>)<br></code></pre></td></tr></table></figure>\n\n<p>那么至此，我们就已经完成了 <strong>整个用户退出</strong> 方案。</p>\n<h1 id=\"Sidebar-动态菜单\"><a href=\"#Sidebar-动态菜单\" class=\"headerlink\" title=\"Sidebar 动态菜单\"></a>Sidebar 动态菜单</h1><p>接下来我们来处理 动态menu菜单。</p>\n<p>临时的 menu 菜单，创建 <code>layout/Sidebar/SidebarMenu</code> 文件</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\">&lt;template&gt;<br>  &lt;!-- 一级 menu 菜单 --&gt;<br>  <span class=\"language-xml\"><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">el-menu</span></span></span><br><span class=\"hljs-tag\"><span class=\"language-xml\">    &#123;/* 只允许一个菜单展开 */&#125;</span></span><br><span class=\"hljs-tag\"><span class=\"language-xml\">    <span class=\"hljs-attr\">:uniqueOpened</span>=<span class=\"hljs-string\">&quot;true&quot;</span></span></span><br><span class=\"hljs-tag\"><span class=\"language-xml\">    <span class=\"hljs-attr\">default-active</span>=<span class=\"hljs-string\">&quot;1&quot;</span></span></span><br><span class=\"hljs-tag\"><span class=\"language-xml\">    <span class=\"hljs-attr\">background-color</span>=<span class=\"hljs-string\">&quot;#545c64&quot;</span></span></span><br><span class=\"hljs-tag\"><span class=\"language-xml\">    <span class=\"hljs-attr\">text-color</span>=<span class=\"hljs-string\">&quot;#fff&quot;</span></span></span><br><span class=\"hljs-tag\"><span class=\"language-xml\">    <span class=\"hljs-attr\">active-text-color</span>=<span class=\"hljs-string\">&quot;#ffd04b&quot;</span></span></span><br><span class=\"hljs-tag\"><span class=\"language-xml\">  &gt;</span></span><br><span class=\"language-xml\">    <span class=\"hljs-comment\">&lt;!-- 子集 menu 菜单 --&gt;</span></span><br><span class=\"language-xml\">    <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">el-sub-menu</span> <span class=\"hljs-attr\">index</span>=<span class=\"hljs-string\">&quot;1&quot;</span>&gt;</span></span><br><span class=\"language-xml\">      <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">template</span> #<span class=\"hljs-attr\">title</span>&gt;</span></span><br><span class=\"language-xml\">        <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">el-icon</span>&gt;</span><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">location</span> /&gt;</span><span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">el-icon</span>&gt;</span></span><br><span class=\"language-xml\">        <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">span</span>&gt;</span>导航一<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">span</span>&gt;</span></span><br><span class=\"language-xml\">      <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">template</span>&gt;</span></span><br><span class=\"language-xml\">      <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">el-menu-item</span> <span class=\"hljs-attr\">index</span>=<span class=\"hljs-string\">&quot;1-1&quot;</span>&gt;</span>选项1<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">el-menu-item</span>&gt;</span></span><br><span class=\"language-xml\">      <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">el-menu-item</span> <span class=\"hljs-attr\">index</span>=<span class=\"hljs-string\">&quot;1-2&quot;</span>&gt;</span>选项2<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">el-menu-item</span>&gt;</span></span><br><span class=\"language-xml\">    <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">el-sub-menu</span>&gt;</span></span><br><span class=\"language-xml\">    <span class=\"hljs-comment\">&lt;!-- 具体菜单项 --&gt;</span></span><br><span class=\"language-xml\">    <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">el-menu-item</span> <span class=\"hljs-attr\">index</span>=<span class=\"hljs-string\">&quot;4&quot;</span>&gt;</span></span><br><span class=\"language-xml\">      <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">el-icon</span>&gt;</span><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">setting</span> /&gt;</span><span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">el-icon</span>&gt;</span></span><br><span class=\"language-xml\">      <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">template</span> #<span class=\"hljs-attr\">title</span>&gt;</span>导航四<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">template</span>&gt;</span></span><br><span class=\"language-xml\">    <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">el-menu-item</span>&gt;</span></span><br><span class=\"language-xml\">  <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">el-menu</span>&gt;</span></span><br>&lt;/template&gt;<br><br><span class=\"language-xml\"><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">script</span> <span class=\"hljs-attr\">setup</span> <span class=\"hljs-attr\">lang</span>=<span class=\"hljs-string\">&quot;ts&quot;</span>&gt;</span><span class=\"language-javascript\"></span></span><br><span class=\"language-javascript\"><span class=\"language-xml\"><span class=\"hljs-keyword\">import</span> &#123; ref, reactive &#125; <span class=\"hljs-keyword\">from</span> <span class=\"hljs-string\">&#x27;vue&#x27;</span></span></span><br><span class=\"language-javascript\"><span class=\"language-xml\"><span class=\"hljs-keyword\">import</span> &#123; <span class=\"hljs-title class_\">Location</span>, <span class=\"hljs-title class_\">Setting</span> &#125; <span class=\"hljs-keyword\">from</span> <span class=\"hljs-string\">&#x27;@element-plus/icons-vue&#x27;</span></span></span><br><span class=\"language-javascript\"><span class=\"language-xml\"></span><span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">script</span>&gt;</span></span><br><span class=\"language-xml\"><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">style</span> <span class=\"hljs-attr\">scoped</span>&gt;</span><span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">style</span>&gt;</span></span><br></code></pre></td></tr></table></figure>\n\n<p>在 <code>layout/Sidebar/index</code> 中导入该组件</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\">&lt;template&gt;<br>  <span class=\"language-xml\"><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">div</span> <span class=\"hljs-attr\">class</span>=<span class=\"hljs-string\">&quot;&quot;</span>&gt;</span></span><br><span class=\"language-xml\">    <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">h1</span>&gt;</span>占位<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">h1</span>&gt;</span></span><br><span class=\"language-xml\">    <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">el-scrollbar</span>&gt;</span></span><br><span class=\"language-xml\">      <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">sidebar-menu</span>&gt;</span><span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">sidebar-menu</span>&gt;</span></span><br><span class=\"language-xml\">    <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">el-scrollbar</span>&gt;</span></span><br><span class=\"language-xml\">  <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">div</span>&gt;</span></span><br>&lt;/template&gt;<br><br><span class=\"language-xml\"><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">script</span> <span class=\"hljs-attr\">setup</span>&gt;</span><span class=\"language-javascript\"></span></span><br><span class=\"language-javascript\"><span class=\"language-xml\"><span class=\"hljs-keyword\">import</span> <span class=\"hljs-title class_\">SidebarMenu</span> <span class=\"hljs-keyword\">from</span> <span class=\"hljs-string\">&#x27;./SidebarMenu&#x27;</span></span></span><br><span class=\"language-javascript\"><span class=\"language-xml\"><span class=\"hljs-keyword\">import</span> &#123;&#125; <span class=\"hljs-keyword\">from</span> <span class=\"hljs-string\">&#x27;vue&#x27;</span></span></span><br><span class=\"language-javascript\"><span class=\"language-xml\"></span><span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">script</span>&gt;</span></span><br></code></pre></td></tr></table></figure>\n\n<p>那么至此我们生成了一个临时的 <code>menu</code> 菜单，从这个临时的 <code>menu</code> 菜单出可以看到，<code>el-menu</code> 其实分成了三个部分：</p>\n<ol>\n<li><code>el-menu</code>：整个 <code>menu</code> 菜单</li>\n<li><code>el-submenu</code>：子集 <code>menu</code> 菜单</li>\n<li><code>el-menu-item</code>：具体菜单项</li>\n</ol>\n<p>那么明确好了这些内容之后，接下来我们就可以来去分析一下 <strong>动态 <code>menu</code> 菜单如何生成了</strong></p>\n<h2 id=\"动态menu菜单处理方案解析\"><a href=\"#动态menu菜单处理方案解析\" class=\"headerlink\" title=\"动态menu菜单处理方案解析\"></a>动态menu菜单处理方案解析</h2><p><strong>动态<code>menu</code>菜单</strong> 其实主要是和 <strong>动态路由表</strong>  配合来去实现 <strong>用户权限</strong> 的。</p>\n<p>但是 <strong>用户权限处理</strong> 目前还未涉及到，因为咱们想要处理 <strong>用户权限</strong> 还需要先去处理很多的业务场景，所以暂时先只处理 <strong>动态<code>menu</code>菜单</strong> 。</p>\n<p>所谓 <strong>动态<code>menu</code>菜单</strong> 指的是：</p>\n<blockquote>\n<p>根据路由表的配置，自动生成对应的 <code>menu</code> 菜单。</p>\n<p>当路由表发生变化时，<code>menu</code> 菜单自动发生变化</p>\n</blockquote>\n<p>那么明确了 <strong>动态<code>menu</code>菜单</strong> 的含义之后，接下来咱们就需要来明确 <strong>动态<code>menu</code>菜单</strong> 的实现方案：</p>\n<ol>\n<li>定义 <strong>路由表</strong> 对应 <strong><code>menu</code> 菜单规则</strong></li>\n<li>根据规则制定 <strong>路由表</strong></li>\n<li>根据规则，依据 <strong>路由表</strong> ，生成 <strong><code>menu</code> 菜单</strong></li>\n</ol>\n<p>那么根据我们的实现方案可以发现，实现 <strong>动态<code>menu</code>菜单</strong> 最核心的关键点其实就在步骤一，也就是 </p>\n<blockquote>\n<p>定义 <strong>路由表</strong> 对应 <strong><code>menu</code> 菜单规则</strong></p>\n</blockquote>\n<p>那么下面我们就来看一下，这个规则如何制定：</p>\n<ol>\n<li>对于单个路由规则而言（循环）：<ol>\n<li>如果存在 <code>meta &amp;&amp; meta.title &amp;&amp; meta.icon</code> ：则显示在 <code>menu</code> 菜单中，其中 <code>title</code> 为显示的内容，<code>icon</code> 为显示的图标<ol>\n<li>如果存在 <code>children</code> ：则以 <code>el-sub-menu（子菜单）</code> 展示</li>\n<li>否则：则以 <code>el-menu-item（菜单项）</code> 展示</li>\n</ol>\n</li>\n<li>否则：不显示在 <code>menu</code> 菜单中</li>\n</ol>\n</li>\n</ol>\n<p>那么明确好了对应的规则之后，接下来我们就可以来去看一下如何进行实现啦！</p>\n<h2 id=\"生成项目页面组件\"><a href=\"#生成项目页面组件\" class=\"headerlink\" title=\"生成项目页面组件\"></a>生成项目页面组件</h2><p>明确了对应的方案之后，那么下面咱们就来实现对应的代码逻辑。</p>\n<p>根据我们的分析，想要完成动态的 <code>menu</code>，那么我们需要按照以下的步骤来去实现：</p>\n<ol>\n<li>创建页面组件</li>\n<li>生成路由表</li>\n<li>解析路由表</li>\n<li>生成 <code>menu</code> 菜单</li>\n</ol>\n<p>那么明确好了步骤之后，接下来我们就先来实现第一步</p>\n<p><strong>创建页面组件</strong></p>\n<p>在 <code>views</code> 文件夹下，创建如下页面：</p>\n<ol>\n<li>创建文章：<code>article-create</code></li>\n<li>文章详情：<code>article-detail</code></li>\n<li>文章排名：<code>article-ranking</code></li>\n<li>错误页面：<code>error-page</code><ol>\n<li><code>404</code></li>\n<li><code>401</code></li>\n</ol>\n</li>\n<li>导入：<code>import</code></li>\n<li>权限列表：<code>permission-list</code></li>\n<li>个人中心：<code>profile</code></li>\n<li>角色列表：<code>role-list</code></li>\n<li>用户信息：<code>user-info</code></li>\n<li>用户管理：<code>user-manage</code></li>\n</ol>\n<h2 id=\"创建结构路由表\"><a href=\"#创建结构路由表\" class=\"headerlink\" title=\"创建结构路由表\"></a>创建结构路由表</h2><p>想要实现结构路由表，那么我们需要先知道最终我们要实现的结构是什么样子的，大家来看下面的截图：</p>\n<img src=\"/img/menu.png\" />\n\n<p>这是我们最终要实现的 <code>menu</code> 截图。</p>\n<p>根据此截图，我们可以知道两点内容：</p>\n<ol>\n<li><p>我们创建的页面并没有全部进行展示</p>\n<ol>\n<li>不显示页面表示 <strong>不满足</strong> 该条件 <code>meta &amp;&amp; meta.title &amp;&amp; meta.icon</code></li>\n</ol>\n</li>\n<li><p><code>menu</code> 菜单将具备父子级的结构</p>\n<ol>\n<li>按照此结构规划数据，则数据应为<figure class=\"highlight json\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs json\"><span class=\"hljs-punctuation\">[</span><br>    <span class=\"hljs-punctuation\">&#123;</span><br>        <span class=\"hljs-attr\">&quot;title&quot;</span><span class=\"hljs-punctuation\">:</span> <span class=\"hljs-string\">&quot;个人中心&quot;</span><span class=\"hljs-punctuation\">,</span><br>        <span class=\"hljs-attr\">&quot;path&quot;</span><span class=\"hljs-punctuation\">:</span> <span class=\"hljs-string\">&quot;&quot;</span><br>    <span class=\"hljs-punctuation\">&#125;</span><span class=\"hljs-punctuation\">,</span><br>    <span class=\"hljs-punctuation\">&#123;</span><br>        <span class=\"hljs-attr\">&quot;title&quot;</span><span class=\"hljs-punctuation\">:</span> <span class=\"hljs-string\">&quot;用户&quot;</span><span class=\"hljs-punctuation\">,</span><br>        <span class=\"hljs-attr\">&quot;children&quot;</span><span class=\"hljs-punctuation\">:</span> <span class=\"hljs-punctuation\">[</span><br>            <span class=\"hljs-punctuation\">&#123;</span><br>                <span class=\"hljs-attr\">&quot;title&quot;</span><span class=\"hljs-punctuation\">:</span> <span class=\"hljs-string\">&quot;员工管理&quot;</span><span class=\"hljs-punctuation\">,</span><br>                <span class=\"hljs-attr\">&quot;path&quot;</span><span class=\"hljs-punctuation\">:</span> <span class=\"hljs-string\">&quot;&quot;</span><br>            <span class=\"hljs-punctuation\">&#125;</span><span class=\"hljs-punctuation\">,</span><br>            <span class=\"hljs-punctuation\">&#123;</span><br>                <span class=\"hljs-attr\">&quot;title&quot;</span><span class=\"hljs-punctuation\">:</span> <span class=\"hljs-string\">&quot;角色列表&quot;</span><span class=\"hljs-punctuation\">,</span><br>                <span class=\"hljs-attr\">&quot;path&quot;</span><span class=\"hljs-punctuation\">:</span> <span class=\"hljs-string\">&quot;&quot;</span><br>            <span class=\"hljs-punctuation\">&#125;</span><span class=\"hljs-punctuation\">,</span><br>            <span class=\"hljs-punctuation\">&#123;</span><br>                <span class=\"hljs-attr\">&quot;title&quot;</span><span class=\"hljs-punctuation\">:</span> <span class=\"hljs-string\">&quot;权限列表&quot;</span><span class=\"hljs-punctuation\">,</span><br>                <span class=\"hljs-attr\">&quot;path&quot;</span><span class=\"hljs-punctuation\">:</span> <span class=\"hljs-string\">&quot;&quot;</span><br>            <span class=\"hljs-punctuation\">&#125;</span><br>        <span class=\"hljs-punctuation\">]</span><br>    <span class=\"hljs-punctuation\">&#125;</span><span class=\"hljs-punctuation\">,</span><br>    <span class=\"hljs-punctuation\">&#123;</span><br>        <span class=\"hljs-attr\">&quot;title&quot;</span><span class=\"hljs-punctuation\">:</span> <span class=\"hljs-string\">&quot;文章&quot;</span><span class=\"hljs-punctuation\">,</span><br>        <span class=\"hljs-attr\">&quot;children&quot;</span><span class=\"hljs-punctuation\">:</span> <span class=\"hljs-punctuation\">[</span><br>            <span class=\"hljs-punctuation\">&#123;</span><br>                <span class=\"hljs-attr\">&quot;title&quot;</span><span class=\"hljs-punctuation\">:</span> <span class=\"hljs-string\">&quot;文章排名&quot;</span><span class=\"hljs-punctuation\">,</span><br>                <span class=\"hljs-attr\">&quot;path&quot;</span><span class=\"hljs-punctuation\">:</span> <span class=\"hljs-string\">&quot;&quot;</span><br>            <span class=\"hljs-punctuation\">&#125;</span><span class=\"hljs-punctuation\">,</span><br>            <span class=\"hljs-punctuation\">&#123;</span><br>                <span class=\"hljs-attr\">&quot;title&quot;</span><span class=\"hljs-punctuation\">:</span> <span class=\"hljs-string\">&quot;创建文章&quot;</span><span class=\"hljs-punctuation\">,</span><br>                <span class=\"hljs-attr\">&quot;path&quot;</span><span class=\"hljs-punctuation\">:</span> <span class=\"hljs-string\">&quot;&quot;</span><br>            <span class=\"hljs-punctuation\">&#125;</span><br>        <span class=\"hljs-punctuation\">]</span><br>    <span class=\"hljs-punctuation\">&#125;</span><br><span class=\"hljs-punctuation\">]</span><br></code></pre></td></tr></table></figure>\n\n</li>\n</ol>\n</li>\n</ol>\n<p>又因为将来我们需要进行 <strong>用户权限处理</strong>，所以此时我们需要先对路由表进行一个划分：</p>\n<ol>\n<li>私有路由表 <code>privateRoutes</code> ：权限路由</li>\n<li>公有路由表 <code>publicRoutes</code>：无权限路由</li>\n</ol>\n<p>根据以上理论，生成以下路由表结构：</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br><span class=\"line\">103</span><br><span class=\"line\">104</span><br><span class=\"line\">105</span><br><span class=\"line\">106</span><br><span class=\"line\">107</span><br><span class=\"line\">108</span><br><span class=\"line\">109</span><br><span class=\"line\">110</span><br><span class=\"line\">111</span><br><span class=\"line\">112</span><br><span class=\"line\">113</span><br><span class=\"line\">114</span><br><span class=\"line\">115</span><br><span class=\"line\">116</span><br><span class=\"line\">117</span><br><span class=\"line\">118</span><br><span class=\"line\">119</span><br><span class=\"line\">120</span><br><span class=\"line\">121</span><br><span class=\"line\">122</span><br><span class=\"line\">123</span><br><span class=\"line\">124</span><br><span class=\"line\">125</span><br><span class=\"line\">126</span><br><span class=\"line\">127</span><br><span class=\"line\">128</span><br><span class=\"line\">129</span><br><span class=\"line\">130</span><br><span class=\"line\">131</span><br><span class=\"line\">132</span><br><span class=\"line\">133</span><br><span class=\"line\">134</span><br><span class=\"line\">135</span><br><span class=\"line\">136</span><br><span class=\"line\">137</span><br><span class=\"line\">138</span><br><span class=\"line\">139</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\"><span class=\"hljs-comment\">/**</span><br><span class=\"hljs-comment\"> * 私有路由表</span><br><span class=\"hljs-comment\"> */</span><br><span class=\"hljs-keyword\">const</span> privateRoutes = [<br>  &#123;<br>    <span class=\"hljs-attr\">path</span>: <span class=\"hljs-string\">&#x27;/user&#x27;</span>,<br>    <span class=\"hljs-attr\">component</span>: layout,<br>    <span class=\"hljs-attr\">redirect</span>: <span class=\"hljs-string\">&#x27;/user/manage&#x27;</span>,<br>    <span class=\"hljs-attr\">meta</span>: &#123;<br>      <span class=\"hljs-attr\">title</span>: <span class=\"hljs-string\">&#x27;user&#x27;</span>,<br>      <span class=\"hljs-attr\">icon</span>: <span class=\"hljs-string\">&#x27;personnel&#x27;</span><br>    &#125;,<br>    <span class=\"hljs-attr\">children</span>: [<br>      &#123;<br>        <span class=\"hljs-attr\">path</span>: <span class=\"hljs-string\">&#x27;/user/manage&#x27;</span>,<br>        <span class=\"hljs-attr\">component</span>: <span class=\"hljs-function\">() =&gt;</span> <span class=\"hljs-title function_\">import</span>(<span class=\"hljs-string\">&#x27;@/views/user-manage/index&#x27;</span>),<br>        <span class=\"hljs-attr\">meta</span>: &#123;<br>          <span class=\"hljs-attr\">title</span>: <span class=\"hljs-string\">&#x27;userManage&#x27;</span>,<br>          <span class=\"hljs-attr\">icon</span>: <span class=\"hljs-string\">&#x27;personnel-manage&#x27;</span><br>        &#125;<br>      &#125;,<br>      &#123;<br>        <span class=\"hljs-attr\">path</span>: <span class=\"hljs-string\">&#x27;/user/role&#x27;</span>,<br>        <span class=\"hljs-attr\">component</span>: <span class=\"hljs-function\">() =&gt;</span> <span class=\"hljs-title function_\">import</span>(<span class=\"hljs-string\">&#x27;@/views/role-list/index&#x27;</span>),<br>        <span class=\"hljs-attr\">meta</span>: &#123;<br>          <span class=\"hljs-attr\">title</span>: <span class=\"hljs-string\">&#x27;roleList&#x27;</span>,<br>          <span class=\"hljs-attr\">icon</span>: <span class=\"hljs-string\">&#x27;role&#x27;</span><br>        &#125;<br>      &#125;,<br>      &#123;<br>        <span class=\"hljs-attr\">path</span>: <span class=\"hljs-string\">&#x27;/user/permission&#x27;</span>,<br>        <span class=\"hljs-attr\">component</span>: <span class=\"hljs-function\">() =&gt;</span> <span class=\"hljs-title function_\">import</span>(<span class=\"hljs-string\">&#x27;@/views/permission-list/index&#x27;</span>),<br>        <span class=\"hljs-attr\">meta</span>: &#123;<br>          <span class=\"hljs-attr\">title</span>: <span class=\"hljs-string\">&#x27;permissionList&#x27;</span>,<br>          <span class=\"hljs-attr\">icon</span>: <span class=\"hljs-string\">&#x27;permission&#x27;</span><br>        &#125;<br>      &#125;,<br>      &#123;<br>        <span class=\"hljs-attr\">path</span>: <span class=\"hljs-string\">&#x27;/user/info/:id&#x27;</span>,<br>        <span class=\"hljs-attr\">name</span>: <span class=\"hljs-string\">&#x27;userInfo&#x27;</span>,<br>        <span class=\"hljs-attr\">component</span>: <span class=\"hljs-function\">() =&gt;</span> <span class=\"hljs-title function_\">import</span>(<span class=\"hljs-string\">&#x27;@/views/user-info/index&#x27;</span>),<br>        <span class=\"hljs-attr\">meta</span>: &#123;<br>          <span class=\"hljs-attr\">title</span>: <span class=\"hljs-string\">&#x27;userInfo&#x27;</span><br>        &#125;<br>      &#125;,<br>      &#123;<br>        <span class=\"hljs-attr\">path</span>: <span class=\"hljs-string\">&#x27;/user/import&#x27;</span>,<br>        <span class=\"hljs-attr\">name</span>: <span class=\"hljs-string\">&#x27;import&#x27;</span>,<br>        <span class=\"hljs-attr\">component</span>: <span class=\"hljs-function\">() =&gt;</span> <span class=\"hljs-title function_\">import</span>(<span class=\"hljs-string\">&#x27;@/views/import/index&#x27;</span>),<br>        <span class=\"hljs-attr\">meta</span>: &#123;<br>          <span class=\"hljs-attr\">title</span>: <span class=\"hljs-string\">&#x27;excelImport&#x27;</span><br>        &#125;<br>      &#125;<br>    ]<br>  &#125;,<br>  &#123;<br>    <span class=\"hljs-attr\">path</span>: <span class=\"hljs-string\">&#x27;/article&#x27;</span>,<br>    <span class=\"hljs-attr\">component</span>: layout,<br>    <span class=\"hljs-attr\">redirect</span>: <span class=\"hljs-string\">&#x27;/article/ranking&#x27;</span>,<br>    <span class=\"hljs-attr\">meta</span>: &#123;<br>      <span class=\"hljs-attr\">title</span>: <span class=\"hljs-string\">&#x27;article&#x27;</span>,<br>      <span class=\"hljs-attr\">icon</span>: <span class=\"hljs-string\">&#x27;article&#x27;</span><br>    &#125;,<br>    <span class=\"hljs-attr\">children</span>: [<br>      &#123;<br>        <span class=\"hljs-attr\">path</span>: <span class=\"hljs-string\">&#x27;/article/ranking&#x27;</span>,<br>        <span class=\"hljs-attr\">component</span>: <span class=\"hljs-function\">() =&gt;</span> <span class=\"hljs-title function_\">import</span>(<span class=\"hljs-string\">&#x27;@/views/article-ranking/index&#x27;</span>),<br>        <span class=\"hljs-attr\">meta</span>: &#123;<br>          <span class=\"hljs-attr\">title</span>: <span class=\"hljs-string\">&#x27;articleRanking&#x27;</span>,<br>          <span class=\"hljs-attr\">icon</span>: <span class=\"hljs-string\">&#x27;article-ranking&#x27;</span><br>        &#125;<br>      &#125;,<br>      &#123;<br>        <span class=\"hljs-attr\">path</span>: <span class=\"hljs-string\">&#x27;/article/:id&#x27;</span>,<br>        <span class=\"hljs-attr\">component</span>: <span class=\"hljs-function\">() =&gt;</span> <span class=\"hljs-title function_\">import</span>(<span class=\"hljs-string\">&#x27;@/views/article-detail/index&#x27;</span>),<br>        <span class=\"hljs-attr\">meta</span>: &#123;<br>          <span class=\"hljs-attr\">title</span>: <span class=\"hljs-string\">&#x27;articleDetail&#x27;</span><br>        &#125;<br>      &#125;,<br>      &#123;<br>        <span class=\"hljs-attr\">path</span>: <span class=\"hljs-string\">&#x27;/article/create&#x27;</span>,<br>        <span class=\"hljs-attr\">component</span>: <span class=\"hljs-function\">() =&gt;</span> <span class=\"hljs-title function_\">import</span>(<span class=\"hljs-string\">&#x27;@/views/article-create/index&#x27;</span>),<br>        <span class=\"hljs-attr\">meta</span>: &#123;<br>          <span class=\"hljs-attr\">title</span>: <span class=\"hljs-string\">&#x27;articleCreate&#x27;</span>,<br>          <span class=\"hljs-attr\">icon</span>: <span class=\"hljs-string\">&#x27;article-create&#x27;</span><br>        &#125;<br>      &#125;,<br>      &#123;<br>        <span class=\"hljs-attr\">path</span>: <span class=\"hljs-string\">&#x27;/article/editor/:id&#x27;</span>,<br>        <span class=\"hljs-attr\">component</span>: <span class=\"hljs-function\">() =&gt;</span> <span class=\"hljs-title function_\">import</span>(<span class=\"hljs-string\">&#x27;@/views/article-create/index&#x27;</span>),<br>        <span class=\"hljs-attr\">meta</span>: &#123;<br>          <span class=\"hljs-attr\">title</span>: <span class=\"hljs-string\">&#x27;articleEditor&#x27;</span><br>        &#125;<br>      &#125;<br>    ]<br>  &#125;<br>]<br><br><span class=\"hljs-comment\">/**</span><br><span class=\"hljs-comment\"> * 公开路由表</span><br><span class=\"hljs-comment\"> */</span><br><span class=\"hljs-keyword\">const</span> publicRoutes = [<br>  &#123;<br>    <span class=\"hljs-attr\">path</span>: <span class=\"hljs-string\">&#x27;/login&#x27;</span>,<br>    <span class=\"hljs-attr\">component</span>: <span class=\"hljs-function\">() =&gt;</span> <span class=\"hljs-title function_\">import</span>(<span class=\"hljs-string\">&#x27;@/views/login/index&#x27;</span>)<br>  &#125;,<br>  &#123;<br>    <span class=\"hljs-attr\">path</span>: <span class=\"hljs-string\">&#x27;/&#x27;</span>,<br>    <span class=\"hljs-comment\">// 注意：带有路径“/”的记录中的组件“默认”是一个不返回 Promise 的函数</span><br>    <span class=\"hljs-attr\">component</span>: layout,<br>    <span class=\"hljs-attr\">redirect</span>: <span class=\"hljs-string\">&#x27;/profile&#x27;</span>,<br>    <span class=\"hljs-attr\">children</span>: [<br>      &#123;<br>        <span class=\"hljs-attr\">path</span>: <span class=\"hljs-string\">&#x27;/profile&#x27;</span>,<br>        <span class=\"hljs-attr\">name</span>: <span class=\"hljs-string\">&#x27;profile&#x27;</span>,<br>        <span class=\"hljs-attr\">component</span>: <span class=\"hljs-function\">() =&gt;</span> <span class=\"hljs-title function_\">import</span>(<span class=\"hljs-string\">&#x27;@/views/profile/index&#x27;</span>),<br>        <span class=\"hljs-attr\">meta</span>: &#123;<br>          <span class=\"hljs-attr\">title</span>: <span class=\"hljs-string\">&#x27;profile&#x27;</span>,<br>          <span class=\"hljs-attr\">icon</span>: <span class=\"hljs-string\">&#x27;el-icon-user&#x27;</span><br>        &#125;<br>      &#125;,<br>      &#123;<br>        <span class=\"hljs-attr\">path</span>: <span class=\"hljs-string\">&#x27;/404&#x27;</span>,<br>        <span class=\"hljs-attr\">name</span>: <span class=\"hljs-string\">&#x27;404&#x27;</span>,<br>        <span class=\"hljs-attr\">component</span>: <span class=\"hljs-function\">() =&gt;</span> <span class=\"hljs-title function_\">import</span>(<span class=\"hljs-string\">&#x27;@/views/error-page/404&#x27;</span>)<br>      &#125;,<br>      &#123;<br>        <span class=\"hljs-attr\">path</span>: <span class=\"hljs-string\">&#x27;/401&#x27;</span>,<br>        <span class=\"hljs-attr\">name</span>: <span class=\"hljs-string\">&#x27;401&#x27;</span>,<br>        <span class=\"hljs-attr\">component</span>: <span class=\"hljs-function\">() =&gt;</span> <span class=\"hljs-title function_\">import</span>(<span class=\"hljs-string\">&#x27;@/views/error-page/401&#x27;</span>)<br>      &#125;<br>    ]<br>  &#125;<br>]<br><br><span class=\"hljs-keyword\">const</span> router = <span class=\"hljs-title function_\">createRouter</span>(&#123;<br>  <span class=\"hljs-attr\">history</span>: <span class=\"hljs-title function_\">createWebHashHistory</span>(),<br>  <span class=\"hljs-attr\">routes</span>: [...publicRoutes, ...privateRoutes]<br>&#125;)<br></code></pre></td></tr></table></figure>\n\n<p>最后不要忘记在 <code>layout/appMain</code> 下设置路由出口</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\">&lt;template&gt;<br>  <span class=\"language-xml\"><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">div</span> <span class=\"hljs-attr\">class</span>=<span class=\"hljs-string\">&quot;app-main&quot;</span>&gt;</span></span><br><span class=\"language-xml\">    <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">router-view</span>&gt;</span><span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">router-view</span>&gt;</span></span><br><span class=\"language-xml\">  <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">div</span>&gt;</span></span><br>&lt;/template&gt;<br></code></pre></td></tr></table></figure>\n\n<h2 id=\"解析路由表，获取结构化数据\"><a href=\"#解析路由表，获取结构化数据\" class=\"headerlink\" title=\"解析路由表，获取结构化数据\"></a>解析路由表，获取结构化数据</h2><p>想要获取路由表数据，那么有两种方式：</p>\n<ol>\n<li><p><a href=\"https://next.router.vuejs.org/zh/api/#routes\">router.options.routes</a>：初始路由列表（<a href=\"https://next.router.vuejs.org/zh/api/#addroute\">新增的路由</a> 无法获取到）</p>\n</li>\n<li><p><a href=\"https://next.router.vuejs.org/zh/api/#getroutes\">router.getRoutes()</a>：获取所有 <a href=\"https://next.router.vuejs.org/zh/api/#routerecord\">路由记录</a> 的完整列表</p>\n</li>\n</ol>\n<p>所以，我们此时使用 <code>router.getRoutes()</code> 方法获取完整的路由列表</p>\n<p>在 <code>layout/components/Sidebar/SidebarMenu</code> 下写入以下代码：</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\">&lt;script setup&gt;<br><span class=\"hljs-keyword\">import</span> &#123; useRouter &#125; <span class=\"hljs-keyword\">from</span> <span class=\"hljs-string\">&#x27;vue-router&#x27;</span><br><br><span class=\"hljs-keyword\">const</span> router = <span class=\"hljs-title function_\">useRouter</span>()<br><span class=\"hljs-variable language_\">console</span>.<span class=\"hljs-title function_\">log</span>(router.<span class=\"hljs-title function_\">getRoutes</span>())<br>&lt;/script&gt;<br></code></pre></td></tr></table></figure>\n\n<p>从返回的数据来看，它与我们想要的数据结构相去甚远。</p>\n<p>出现这个问题的原因，是因为它返回的是一个 <strong>完整的路由表</strong></p>\n<p>这个路由表距离我们想要的存在两个问题：</p>\n<ol>\n<li>存在重复的路由数据</li>\n<li>不满足该条件 <code>meta &amp;&amp; meta.title &amp;&amp; meta.icon</code> 的数据不应该存在</li>\n</ol>\n<p>那么接下来我们就应该来处理这两个问题</p>\n<p>创建 <code>utils/route.ts</code> 文件，创建两个方法分别处理对应的两个问题：</p>\n<ol>\n<li><code>filterRouters</code></li>\n<li><code>generateMenus</code></li>\n</ol>\n<p>写入以下代码：</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\"><span class=\"hljs-keyword\">import</span> path <span class=\"hljs-keyword\">from</span> <span class=\"hljs-string\">&#x27;path&#x27;</span><br><br><span class=\"hljs-comment\">/**</span><br><span class=\"hljs-comment\"> * 返回所有子路由</span><br><span class=\"hljs-comment\"> */</span><br><span class=\"hljs-keyword\">const</span> <span class=\"hljs-title function_\">getChildrenRoutes</span> = routes =&gt; &#123;<br>  <span class=\"hljs-keyword\">const</span> result = []<br>  routes.<span class=\"hljs-title function_\">forEach</span>(<span class=\"hljs-function\"><span class=\"hljs-params\">route</span> =&gt;</span> &#123;<br>    <span class=\"hljs-keyword\">if</span> (route.<span class=\"hljs-property\">children</span> &amp;&amp; route.<span class=\"hljs-property\">children</span>.<span class=\"hljs-property\">length</span> &gt; <span class=\"hljs-number\">0</span>) &#123;<br>      result.<span class=\"hljs-title function_\">push</span>(...route.<span class=\"hljs-property\">children</span>)<br>    &#125;<br>  &#125;)<br>  <span class=\"hljs-keyword\">return</span> result<br>&#125;<br><span class=\"hljs-comment\">/**</span><br><span class=\"hljs-comment\"> * 处理脱离层级的路由：某个一级路由为其他子路由，则剔除该一级路由，保留路由层级</span><br><span class=\"hljs-comment\"> * <span class=\"hljs-doctag\">@param</span> &#123;<span class=\"hljs-type\">*</span>&#125; routes router.getRoutes()</span><br><span class=\"hljs-comment\"> */</span><br><span class=\"hljs-keyword\">export</span> <span class=\"hljs-keyword\">const</span> <span class=\"hljs-title function_\">filterRouters</span> = routes =&gt; &#123;<br>  <span class=\"hljs-keyword\">const</span> childrenRoutes = <span class=\"hljs-title function_\">getChildrenRoutes</span>(routes)<br>  <span class=\"hljs-keyword\">return</span> routes.<span class=\"hljs-title function_\">filter</span>(<span class=\"hljs-function\"><span class=\"hljs-params\">route</span> =&gt;</span> &#123;<br>    <span class=\"hljs-keyword\">return</span> !childrenRoutes.<span class=\"hljs-title function_\">find</span>(<span class=\"hljs-function\"><span class=\"hljs-params\">childrenRoute</span> =&gt;</span> &#123;<br>      <span class=\"hljs-keyword\">return</span> childrenRoute.<span class=\"hljs-property\">path</span> === route.<span class=\"hljs-property\">path</span><br>    &#125;)<br>  &#125;)<br>&#125;<br><br><span class=\"hljs-comment\">/**</span><br><span class=\"hljs-comment\"> * 判断数据是否为空值</span><br><span class=\"hljs-comment\"> */</span><br><span class=\"hljs-keyword\">function</span> <span class=\"hljs-title function_\">isNull</span>(<span class=\"hljs-params\">data</span>) &#123;<br>  <span class=\"hljs-keyword\">if</span> (!data) <span class=\"hljs-keyword\">return</span> <span class=\"hljs-literal\">true</span><br>  <span class=\"hljs-keyword\">if</span> (<span class=\"hljs-title class_\">JSON</span>.<span class=\"hljs-title function_\">stringify</span>(data) === <span class=\"hljs-string\">&#x27;&#123;&#125;&#x27;</span>) <span class=\"hljs-keyword\">return</span> <span class=\"hljs-literal\">true</span><br>  <span class=\"hljs-keyword\">if</span> (<span class=\"hljs-title class_\">JSON</span>.<span class=\"hljs-title function_\">stringify</span>(data) === <span class=\"hljs-string\">&#x27;[]&#x27;</span>) <span class=\"hljs-keyword\">return</span> <span class=\"hljs-literal\">true</span><br>  <span class=\"hljs-keyword\">return</span> <span class=\"hljs-literal\">false</span><br>&#125;<br><span class=\"hljs-comment\">/**</span><br><span class=\"hljs-comment\"> * 根据 routes 数据，返回对应 menu 规则数组</span><br><span class=\"hljs-comment\"> */</span><br><span class=\"hljs-keyword\">export</span> <span class=\"hljs-keyword\">function</span> <span class=\"hljs-title function_\">generateMenus</span>(<span class=\"hljs-params\">routes, basePath = <span class=\"hljs-string\">&#x27;&#x27;</span></span>) &#123;<br>  <span class=\"hljs-keyword\">const</span> result = []<br>  <span class=\"hljs-comment\">// 遍历路由表</span><br>  routes.<span class=\"hljs-title function_\">forEach</span>(<span class=\"hljs-function\"><span class=\"hljs-params\">item</span> =&gt;</span> &#123;<br>    <span class=\"hljs-comment\">// 不存在 children &amp;&amp; 不存在 meta 直接 return</span><br>    <span class=\"hljs-keyword\">if</span> (<span class=\"hljs-title function_\">isNull</span>(item.<span class=\"hljs-property\">meta</span>) &amp;&amp; <span class=\"hljs-title function_\">isNull</span>(item.<span class=\"hljs-property\">children</span>)) <span class=\"hljs-keyword\">return</span><br>    <span class=\"hljs-comment\">// 存在 children 不存在 meta，进入迭代</span><br>    <span class=\"hljs-keyword\">if</span> (<span class=\"hljs-title function_\">isNull</span>(item.<span class=\"hljs-property\">meta</span>) &amp;&amp; !<span class=\"hljs-title function_\">isNull</span>(item.<span class=\"hljs-property\">children</span>)) &#123;<br>      result.<span class=\"hljs-title function_\">push</span>(...<span class=\"hljs-title function_\">generateMenus</span>(item.<span class=\"hljs-property\">children</span>))<br>      <span class=\"hljs-keyword\">return</span><br>    &#125;<br>    <span class=\"hljs-comment\">// 合并 path 作为跳转路径</span><br>    <span class=\"hljs-keyword\">const</span> routePath = path.<span class=\"hljs-title function_\">resolve</span>(basePath, item.<span class=\"hljs-property\">path</span>)<br>    <span class=\"hljs-comment\">// 路由分离之后，存在同名父路由的情况，需要单独处理</span><br>    <span class=\"hljs-keyword\">let</span> route = result.<span class=\"hljs-title function_\">find</span>(<span class=\"hljs-function\"><span class=\"hljs-params\">item</span> =&gt;</span> item.<span class=\"hljs-property\">path</span> === routePath)<br>    <span class=\"hljs-keyword\">if</span> (!route) &#123;<br>      route = &#123;<br>        ...item,<br>        <span class=\"hljs-attr\">path</span>: routePath,<br>        <span class=\"hljs-attr\">children</span>: []<br>      &#125;<br><br>      <span class=\"hljs-comment\">// icon 与 title 必须全部存在</span><br>      <span class=\"hljs-keyword\">if</span> (route.<span class=\"hljs-property\">meta</span>.<span class=\"hljs-property\">icon</span> &amp;&amp; route.<span class=\"hljs-property\">meta</span>.<span class=\"hljs-property\">title</span>) &#123;<br>        <span class=\"hljs-comment\">// meta 存在生成 route 对象，放入 arr</span><br>        result.<span class=\"hljs-title function_\">push</span>(route)<br>      &#125;<br>    &#125;<br><br>    <span class=\"hljs-comment\">// 存在 children 进入迭代到children</span><br>    <span class=\"hljs-keyword\">if</span> (item.<span class=\"hljs-property\">children</span>) &#123;<br>      route.<span class=\"hljs-property\">children</span>.<span class=\"hljs-title function_\">push</span>(...<span class=\"hljs-title function_\">generateMenus</span>(item.<span class=\"hljs-property\">children</span>, route.<span class=\"hljs-property\">path</span>))<br>    &#125;<br>  &#125;)<br>  <span class=\"hljs-keyword\">return</span> result<br>&#125;<br><br></code></pre></td></tr></table></figure>\n\n<p>在 <code>SidebarMenu</code> 中调用该方法</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\">&lt;script setup&gt;<br><span class=\"hljs-keyword\">import</span> &#123; computed &#125; <span class=\"hljs-keyword\">from</span> <span class=\"hljs-string\">&#x27;vue&#x27;</span><br><span class=\"hljs-keyword\">import</span> &#123; useRouter &#125; <span class=\"hljs-keyword\">from</span> <span class=\"hljs-string\">&#x27;vue-router&#x27;</span><br><span class=\"hljs-keyword\">import</span> &#123; filterRouters, generateMenus &#125; <span class=\"hljs-keyword\">from</span> <span class=\"hljs-string\">&#x27;@/utils/route&#x27;</span><br><br><span class=\"hljs-keyword\">const</span> router = <span class=\"hljs-title function_\">useRouter</span>()<br><span class=\"hljs-keyword\">const</span> routes = <span class=\"hljs-title function_\">computed</span>(<span class=\"hljs-function\">() =&gt;</span> &#123;<br>  <span class=\"hljs-keyword\">const</span> filterRoutes = <span class=\"hljs-title function_\">filterRouters</span>(router.<span class=\"hljs-title function_\">getRoutes</span>())<br>  <span class=\"hljs-keyword\">return</span> <span class=\"hljs-title function_\">generateMenus</span>(filterRoutes)<br>&#125;)<br><span class=\"hljs-variable language_\">console</span>.<span class=\"hljs-title function_\">log</span>(<span class=\"hljs-title class_\">JSON</span>.<span class=\"hljs-title function_\">stringify</span>(routes.<span class=\"hljs-property\">value</span>))<br>&lt;/script&gt;<br></code></pre></td></tr></table></figure>\n\n<p>得到该数据结构</p>\n<figure class=\"highlight json\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs json\"><span class=\"hljs-punctuation\">[</span><br>    <span class=\"hljs-punctuation\">&#123;</span><br>        <span class=\"hljs-attr\">&quot;path&quot;</span><span class=\"hljs-punctuation\">:</span><span class=\"hljs-string\">&quot;/profile&quot;</span><span class=\"hljs-punctuation\">,</span><br>        <span class=\"hljs-attr\">&quot;name&quot;</span><span class=\"hljs-punctuation\">:</span><span class=\"hljs-string\">&quot;profile&quot;</span><span class=\"hljs-punctuation\">,</span><br>        <span class=\"hljs-attr\">&quot;meta&quot;</span><span class=\"hljs-punctuation\">:</span><span class=\"hljs-punctuation\">&#123;</span><br>            <span class=\"hljs-attr\">&quot;title&quot;</span><span class=\"hljs-punctuation\">:</span><span class=\"hljs-string\">&quot;profile&quot;</span><span class=\"hljs-punctuation\">,</span><br>            <span class=\"hljs-attr\">&quot;icon&quot;</span><span class=\"hljs-punctuation\">:</span><span class=\"hljs-string\">&quot;el-icon-user&quot;</span><br>        <span class=\"hljs-punctuation\">&#125;</span><span class=\"hljs-punctuation\">,</span><br>    <span class=\"hljs-punctuation\">&#125;</span><span class=\"hljs-punctuation\">,</span><br>    <span class=\"hljs-punctuation\">&#123;</span><br>        <span class=\"hljs-attr\">&quot;path&quot;</span><span class=\"hljs-punctuation\">:</span><span class=\"hljs-string\">&quot;/user&quot;</span><span class=\"hljs-punctuation\">,</span><br>        <span class=\"hljs-attr\">&quot;redirect&quot;</span><span class=\"hljs-punctuation\">:</span><span class=\"hljs-string\">&quot;/user/manage&quot;</span><span class=\"hljs-punctuation\">,</span><br>        <span class=\"hljs-attr\">&quot;meta&quot;</span><span class=\"hljs-punctuation\">:</span><span class=\"hljs-punctuation\">&#123;</span><br>            <span class=\"hljs-attr\">&quot;title&quot;</span><span class=\"hljs-punctuation\">:</span><span class=\"hljs-string\">&quot;user&quot;</span><span class=\"hljs-punctuation\">,</span><br>            <span class=\"hljs-attr\">&quot;icon&quot;</span><span class=\"hljs-punctuation\">:</span><span class=\"hljs-string\">&quot;personnel&quot;</span><br>        <span class=\"hljs-punctuation\">&#125;</span><span class=\"hljs-punctuation\">,</span><br>        <span class=\"hljs-attr\">&quot;props&quot;</span><span class=\"hljs-punctuation\">:</span><span class=\"hljs-punctuation\">&#123;</span><br>            <span class=\"hljs-attr\">&quot;default&quot;</span><span class=\"hljs-punctuation\">:</span><span class=\"hljs-keyword\">false</span><br>        <span class=\"hljs-punctuation\">&#125;</span><span class=\"hljs-punctuation\">,</span><br>        <span class=\"hljs-attr\">&quot;children&quot;</span><span class=\"hljs-punctuation\">:</span><span class=\"hljs-punctuation\">[</span><br>            <span class=\"hljs-punctuation\">&#123;</span><br>                <span class=\"hljs-attr\">&quot;path&quot;</span><span class=\"hljs-punctuation\">:</span><span class=\"hljs-string\">&quot;/user/manage&quot;</span><span class=\"hljs-punctuation\">,</span><br>                <span class=\"hljs-attr\">&quot;name&quot;</span><span class=\"hljs-punctuation\">:</span><span class=\"hljs-string\">&quot;userManage&quot;</span><span class=\"hljs-punctuation\">,</span><br>                <span class=\"hljs-attr\">&quot;meta&quot;</span><span class=\"hljs-punctuation\">:</span><span class=\"hljs-punctuation\">&#123;</span><br>                    <span class=\"hljs-attr\">&quot;title&quot;</span><span class=\"hljs-punctuation\">:</span><span class=\"hljs-string\">&quot;userManage&quot;</span><span class=\"hljs-punctuation\">,</span><br>                    <span class=\"hljs-attr\">&quot;icon&quot;</span><span class=\"hljs-punctuation\">:</span><span class=\"hljs-string\">&quot;personnel-manage&quot;</span><br>                <span class=\"hljs-punctuation\">&#125;</span><span class=\"hljs-punctuation\">,</span><br>                <span class=\"hljs-attr\">&quot;children&quot;</span><span class=\"hljs-punctuation\">:</span><span class=\"hljs-punctuation\">[</span><br><br>                <span class=\"hljs-punctuation\">]</span><br>            <span class=\"hljs-punctuation\">&#125;</span><span class=\"hljs-punctuation\">,</span><br>            <span class=\"hljs-punctuation\">&#123;</span><br>                <span class=\"hljs-attr\">&quot;path&quot;</span><span class=\"hljs-punctuation\">:</span><span class=\"hljs-string\">&quot;/user/role&quot;</span><span class=\"hljs-punctuation\">,</span><br>                <span class=\"hljs-attr\">&quot;name&quot;</span><span class=\"hljs-punctuation\">:</span><span class=\"hljs-string\">&quot;userRole&quot;</span><span class=\"hljs-punctuation\">,</span><br>                <span class=\"hljs-attr\">&quot;meta&quot;</span><span class=\"hljs-punctuation\">:</span><span class=\"hljs-punctuation\">&#123;</span><br>                    <span class=\"hljs-attr\">&quot;title&quot;</span><span class=\"hljs-punctuation\">:</span><span class=\"hljs-string\">&quot;roleList&quot;</span><span class=\"hljs-punctuation\">,</span><br>                    <span class=\"hljs-attr\">&quot;icon&quot;</span><span class=\"hljs-punctuation\">:</span><span class=\"hljs-string\">&quot;role&quot;</span><br>                <span class=\"hljs-punctuation\">&#125;</span><span class=\"hljs-punctuation\">,</span><br>                <span class=\"hljs-attr\">&quot;children&quot;</span><span class=\"hljs-punctuation\">:</span><span class=\"hljs-punctuation\">[</span><br><br>                <span class=\"hljs-punctuation\">]</span><br>            <span class=\"hljs-punctuation\">&#125;</span><span class=\"hljs-punctuation\">,</span><br>            <span class=\"hljs-punctuation\">&#123;</span><br>                <span class=\"hljs-attr\">&quot;path&quot;</span><span class=\"hljs-punctuation\">:</span><span class=\"hljs-string\">&quot;/user/permission&quot;</span><span class=\"hljs-punctuation\">,</span><br>                <span class=\"hljs-attr\">&quot;name&quot;</span><span class=\"hljs-punctuation\">:</span><span class=\"hljs-string\">&quot;userPermission&quot;</span><span class=\"hljs-punctuation\">,</span><br>                <span class=\"hljs-attr\">&quot;meta&quot;</span><span class=\"hljs-punctuation\">:</span><span class=\"hljs-punctuation\">&#123;</span><br>                    <span class=\"hljs-attr\">&quot;title&quot;</span><span class=\"hljs-punctuation\">:</span><span class=\"hljs-string\">&quot;permissionList&quot;</span><span class=\"hljs-punctuation\">,</span><br>                    <span class=\"hljs-attr\">&quot;icon&quot;</span><span class=\"hljs-punctuation\">:</span><span class=\"hljs-string\">&quot;permission&quot;</span><br>                <span class=\"hljs-punctuation\">&#125;</span><span class=\"hljs-punctuation\">,</span><br>                <span class=\"hljs-attr\">&quot;children&quot;</span><span class=\"hljs-punctuation\">:</span><span class=\"hljs-punctuation\">[</span><br><br>                <span class=\"hljs-punctuation\">]</span><br>            <span class=\"hljs-punctuation\">&#125;</span><br>        <span class=\"hljs-punctuation\">]</span><span class=\"hljs-punctuation\">,</span><br>    <span class=\"hljs-punctuation\">&#125;</span><span class=\"hljs-punctuation\">,</span><br>    <span class=\"hljs-punctuation\">&#123;</span><br>        <span class=\"hljs-attr\">&quot;path&quot;</span><span class=\"hljs-punctuation\">:</span><span class=\"hljs-string\">&quot;/article&quot;</span><span class=\"hljs-punctuation\">,</span><br>        <span class=\"hljs-attr\">&quot;redirect&quot;</span><span class=\"hljs-punctuation\">:</span><span class=\"hljs-string\">&quot;/article/ranking&quot;</span><span class=\"hljs-punctuation\">,</span><br>        <span class=\"hljs-attr\">&quot;meta&quot;</span><span class=\"hljs-punctuation\">:</span><span class=\"hljs-punctuation\">&#123;</span><br>            <span class=\"hljs-attr\">&quot;title&quot;</span><span class=\"hljs-punctuation\">:</span><span class=\"hljs-string\">&quot;article&quot;</span><span class=\"hljs-punctuation\">,</span><br>            <span class=\"hljs-attr\">&quot;icon&quot;</span><span class=\"hljs-punctuation\">:</span><span class=\"hljs-string\">&quot;article&quot;</span><br>        <span class=\"hljs-punctuation\">&#125;</span><span class=\"hljs-punctuation\">,</span><br>        <span class=\"hljs-attr\">&quot;props&quot;</span><span class=\"hljs-punctuation\">:</span><span class=\"hljs-punctuation\">&#123;</span><br>            <span class=\"hljs-attr\">&quot;default&quot;</span><span class=\"hljs-punctuation\">:</span><span class=\"hljs-keyword\">false</span><br>        <span class=\"hljs-punctuation\">&#125;</span><span class=\"hljs-punctuation\">,</span><br>        <span class=\"hljs-attr\">&quot;children&quot;</span><span class=\"hljs-punctuation\">:</span><span class=\"hljs-punctuation\">[</span><br>            <span class=\"hljs-punctuation\">&#123;</span><br>                <span class=\"hljs-attr\">&quot;path&quot;</span><span class=\"hljs-punctuation\">:</span><span class=\"hljs-string\">&quot;/article/ranking&quot;</span><span class=\"hljs-punctuation\">,</span><br>                <span class=\"hljs-attr\">&quot;name&quot;</span><span class=\"hljs-punctuation\">:</span><span class=\"hljs-string\">&quot;articleRanking&quot;</span><span class=\"hljs-punctuation\">,</span><br>                <span class=\"hljs-attr\">&quot;meta&quot;</span><span class=\"hljs-punctuation\">:</span><span class=\"hljs-punctuation\">&#123;</span><br>                    <span class=\"hljs-attr\">&quot;title&quot;</span><span class=\"hljs-punctuation\">:</span><span class=\"hljs-string\">&quot;articleRanking&quot;</span><span class=\"hljs-punctuation\">,</span><br>                    <span class=\"hljs-attr\">&quot;icon&quot;</span><span class=\"hljs-punctuation\">:</span><span class=\"hljs-string\">&quot;article-ranking&quot;</span><br>                <span class=\"hljs-punctuation\">&#125;</span><span class=\"hljs-punctuation\">,</span><br>                <span class=\"hljs-attr\">&quot;children&quot;</span><span class=\"hljs-punctuation\">:</span><span class=\"hljs-punctuation\">[</span><br><br>                <span class=\"hljs-punctuation\">]</span><br>            <span class=\"hljs-punctuation\">&#125;</span><span class=\"hljs-punctuation\">,</span><br>            <span class=\"hljs-punctuation\">&#123;</span><br>                <span class=\"hljs-attr\">&quot;path&quot;</span><span class=\"hljs-punctuation\">:</span><span class=\"hljs-string\">&quot;/article/create&quot;</span><span class=\"hljs-punctuation\">,</span><br>                <span class=\"hljs-attr\">&quot;name&quot;</span><span class=\"hljs-punctuation\">:</span><span class=\"hljs-string\">&quot;articleCreate&quot;</span><span class=\"hljs-punctuation\">,</span><br>                <span class=\"hljs-attr\">&quot;meta&quot;</span><span class=\"hljs-punctuation\">:</span><span class=\"hljs-punctuation\">&#123;</span><br>                    <span class=\"hljs-attr\">&quot;title&quot;</span><span class=\"hljs-punctuation\">:</span><span class=\"hljs-string\">&quot;articleCreate&quot;</span><span class=\"hljs-punctuation\">,</span><br>                    <span class=\"hljs-attr\">&quot;icon&quot;</span><span class=\"hljs-punctuation\">:</span><span class=\"hljs-string\">&quot;article-create&quot;</span><br>                <span class=\"hljs-punctuation\">&#125;</span><span class=\"hljs-punctuation\">,</span><br>                <span class=\"hljs-attr\">&quot;children&quot;</span><span class=\"hljs-punctuation\">:</span><span class=\"hljs-punctuation\">[</span><br><br>                <span class=\"hljs-punctuation\">]</span><br>            <span class=\"hljs-punctuation\">&#125;</span><br>        <span class=\"hljs-punctuation\">]</span><span class=\"hljs-punctuation\">,</span><br>    <span class=\"hljs-punctuation\">&#125;</span><br><span class=\"hljs-punctuation\">]</span><br></code></pre></td></tr></table></figure>\n\n<h2 id=\"生成动态-menu-菜单\"><a href=\"#生成动态-menu-菜单\" class=\"headerlink\" title=\"生成动态 menu 菜单\"></a>生成动态 menu 菜单</h2><p>有了数据结构之后，最后的步骤就水到渠成了</p>\n<p>整个 <code>menu</code> 菜单，我们将分成三个组件来进行处理</p>\n<ol>\n<li><code>SidebarMenu</code>：处理数据，作为最顶层 <code>menu</code> 载体</li>\n<li><code>SidebarItem</code>：根据数据处理 <strong>当前项为 <code>el-submenu</code> || <code>el-menu-item</code></strong> </li>\n<li><code>MenuItem</code>：处理 <code>el-menu-item</code> 样式</li>\n</ol>\n<p>那么下面我们一个个来处理</p>\n<p>首先是 <code>SidebarMenu</code> </p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\">&lt;template&gt;<br>  &lt;!-- 一级 menu 菜单 --&gt;<br>  <span class=\"language-xml\"><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">el-menu</span></span></span><br><span class=\"hljs-tag\"><span class=\"language-xml\">    <span class=\"hljs-attr\">...</span></span></span><br><span class=\"hljs-tag\"><span class=\"language-xml\">  &gt;</span></span><br><span class=\"language-xml\">    <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">sidebar-item</span></span></span><br><span class=\"hljs-tag\"><span class=\"language-xml\">      <span class=\"hljs-attr\">v-for</span>=<span class=\"hljs-string\">&quot;item in routes&quot;</span></span></span><br><span class=\"hljs-tag\"><span class=\"language-xml\">      <span class=\"hljs-attr\">:key</span>=<span class=\"hljs-string\">&quot;item.path&quot;</span></span></span><br><span class=\"hljs-tag\"><span class=\"language-xml\">      <span class=\"hljs-attr\">:route</span>=<span class=\"hljs-string\">&quot;item&quot;</span></span></span><br><span class=\"hljs-tag\"><span class=\"language-xml\">    &gt;</span><span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">sidebar-item</span>&gt;</span></span><br><span class=\"language-xml\">  <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">el-menu</span>&gt;</span></span><br>&lt;/template&gt;<br><br></code></pre></td></tr></table></figure>\n\n\n\n<p>创建 <code>SidebarItem</code> 组件，用来根据数据处理 <strong>当前项为 <code>el-sub-menu</code> || <code>el-menu-item</code></strong> </p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\">&lt;template&gt;<br>  &lt;!-- 支持渲染多级 menu 菜单 --&gt;<br>  <span class=\"language-xml\"><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">el-sub-menu</span> <span class=\"hljs-attr\">v-if</span>=<span class=\"hljs-string\">&quot;route.children.length &gt; 0&quot;</span> <span class=\"hljs-attr\">:index</span>=<span class=\"hljs-string\">&quot;route.path&quot;</span>&gt;</span></span><br><span class=\"language-xml\">    <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">template</span> #<span class=\"hljs-attr\">title</span>&gt;</span></span><br><span class=\"language-xml\">      <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">menu-item</span> <span class=\"hljs-attr\">:title</span>=<span class=\"hljs-string\">&quot;route.meta.title&quot;</span> <span class=\"hljs-attr\">:icon</span>=<span class=\"hljs-string\">&quot;route.meta.icon&quot;</span>&gt;</span><span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">menu-item</span>&gt;</span></span><br><span class=\"language-xml\">    <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">template</span>&gt;</span></span><br><span class=\"language-xml\">    <span class=\"hljs-comment\">&lt;!-- 循环渲染 --&gt;</span></span><br><span class=\"language-xml\">    <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">sidebar-item</span></span></span><br><span class=\"hljs-tag\"><span class=\"language-xml\">      <span class=\"hljs-attr\">v-for</span>=<span class=\"hljs-string\">&quot;item in route.children&quot;</span></span></span><br><span class=\"hljs-tag\"><span class=\"language-xml\">      <span class=\"hljs-attr\">:key</span>=<span class=\"hljs-string\">&quot;item.path&quot;</span></span></span><br><span class=\"hljs-tag\"><span class=\"language-xml\">      <span class=\"hljs-attr\">:route</span>=<span class=\"hljs-string\">&quot;item&quot;</span></span></span><br><span class=\"hljs-tag\"><span class=\"language-xml\">    &gt;</span><span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">sidebar-item</span>&gt;</span></span><br><span class=\"language-xml\">  <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">el-sub-menu</span>&gt;</span></span><br>  &lt;!-- 渲染 item 项 --&gt;<br>  <span class=\"language-xml\"><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">el-menu-item</span> <span class=\"hljs-attr\">v-else</span> <span class=\"hljs-attr\">:index</span>=<span class=\"hljs-string\">&quot;route.path&quot;</span>&gt;</span></span><br><span class=\"language-xml\">    <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">menu-item</span> <span class=\"hljs-attr\">:title</span>=<span class=\"hljs-string\">&quot;route.meta.title&quot;</span> <span class=\"hljs-attr\">:icon</span>=<span class=\"hljs-string\">&quot;route.meta.icon&quot;</span>&gt;</span><span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">menu-item</span>&gt;</span></span><br><span class=\"language-xml\">  <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">el-menu-item</span>&gt;</span></span><br>&lt;/template&gt;<br><br><span class=\"language-xml\"><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">script</span> <span class=\"hljs-attr\">setup</span>&gt;</span><span class=\"language-javascript\"></span></span><br><span class=\"language-javascript\"><span class=\"language-xml\"><span class=\"hljs-keyword\">import</span> <span class=\"hljs-title class_\">MenuItem</span> <span class=\"hljs-keyword\">from</span> <span class=\"hljs-string\">&#x27;./MenuItem&#x27;</span></span></span><br><span class=\"language-javascript\"><span class=\"language-xml\"><span class=\"hljs-keyword\">import</span> &#123; defineProps &#125; <span class=\"hljs-keyword\">from</span> <span class=\"hljs-string\">&#x27;vue&#x27;</span></span></span><br><span class=\"language-javascript\"><span class=\"language-xml\"><span class=\"hljs-comment\">// 定义 props</span></span></span><br><span class=\"language-javascript\"><span class=\"language-xml\"><span class=\"hljs-title function_\">defineProps</span>(&#123;</span></span><br><span class=\"language-javascript\"><span class=\"language-xml\">  <span class=\"hljs-attr\">route</span>: &#123;</span></span><br><span class=\"language-javascript\"><span class=\"language-xml\">    <span class=\"hljs-attr\">type</span>: <span class=\"hljs-title class_\">Object</span>,</span></span><br><span class=\"language-javascript\"><span class=\"language-xml\">    <span class=\"hljs-attr\">required</span>: <span class=\"hljs-literal\">true</span></span></span><br><span class=\"language-javascript\"><span class=\"language-xml\">  &#125;</span></span><br><span class=\"language-javascript\"><span class=\"language-xml\">&#125;)</span></span><br><span class=\"language-javascript\"><span class=\"language-xml\"></span><span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">script</span>&gt;</span></span><br></code></pre></td></tr></table></figure>\n\n<p>创建 <code>MenuItem</code> 用来处理 <code>el-menu-item</code> 样式</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\">&lt;template&gt;<br>  <span class=\"language-xml\"><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">i</span> <span class=\"hljs-attr\">v-if</span>=<span class=\"hljs-string\">&quot;icon.includes(&#x27;el-icon&#x27;)&quot;</span> <span class=\"hljs-attr\">class</span>=<span class=\"hljs-string\">&quot;sub-el-icon&quot;</span> <span class=\"hljs-attr\">:class</span>=<span class=\"hljs-string\">&quot;icon&quot;</span>&gt;</span><span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">i</span>&gt;</span></span><br>  <span class=\"language-xml\"><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">svg-icon</span> <span class=\"hljs-attr\">v-else</span> <span class=\"hljs-attr\">:icon</span>=<span class=\"hljs-string\">&quot;icon&quot;</span>&gt;</span><span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">svg-icon</span>&gt;</span></span><br>  <span class=\"language-xml\"><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">span</span>&gt;</span>&#123;&#123; title &#125;&#125;<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">span</span>&gt;</span></span><br>&lt;/template&gt;<br><br><span class=\"language-xml\"><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">script</span> <span class=\"hljs-attr\">setup</span>&gt;</span><span class=\"language-javascript\"></span></span><br><span class=\"language-javascript\"><span class=\"language-xml\"><span class=\"hljs-keyword\">import</span> &#123; defineProps &#125; <span class=\"hljs-keyword\">from</span> <span class=\"hljs-string\">&#x27;vue&#x27;</span></span></span><br><span class=\"language-javascript\"><span class=\"language-xml\"><span class=\"hljs-title function_\">defineProps</span>(&#123;</span></span><br><span class=\"language-javascript\"><span class=\"language-xml\">  <span class=\"hljs-attr\">title</span>: &#123;</span></span><br><span class=\"language-javascript\"><span class=\"language-xml\">    <span class=\"hljs-attr\">type</span>: <span class=\"hljs-title class_\">String</span>,</span></span><br><span class=\"language-javascript\"><span class=\"language-xml\">    <span class=\"hljs-attr\">required</span>: <span class=\"hljs-literal\">true</span></span></span><br><span class=\"language-javascript\"><span class=\"language-xml\">  &#125;,</span></span><br><span class=\"language-javascript\"><span class=\"language-xml\">  <span class=\"hljs-attr\">icon</span>: &#123;</span></span><br><span class=\"language-javascript\"><span class=\"language-xml\">    <span class=\"hljs-attr\">type</span>: <span class=\"hljs-title class_\">String</span>,</span></span><br><span class=\"language-javascript\"><span class=\"language-xml\">    <span class=\"hljs-attr\">required</span>: <span class=\"hljs-literal\">true</span></span></span><br><span class=\"language-javascript\"><span class=\"language-xml\">  &#125;</span></span><br><span class=\"language-javascript\"><span class=\"language-xml\">&#125;)</span></span><br><span class=\"language-javascript\"><span class=\"language-xml\"></span><span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">script</span>&gt;</span></span><br><br><span class=\"language-xml\"><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">style</span> <span class=\"hljs-attr\">lang</span>=<span class=\"hljs-string\">&quot;scss&quot;</span> <span class=\"hljs-attr\">scoped</span>&gt;</span></span><br><span class=\"language-xml\"><span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">style</span>&gt;</span></span><br></code></pre></td></tr></table></figure>\n\n<p>至此，整个的 <code>menu</code> 菜单结构就已经完成了！</p>\n<h2 id=\"修复最后残余问题\"><a href=\"#修复最后残余问题\" class=\"headerlink\" title=\"修复最后残余问题\"></a>修复最后残余问题</h2><p>目前 <code>menu</code> 菜单存在三个问题</p>\n<ol>\n<li>样式问题</li>\n<li>路由跳转问题</li>\n<li>默认激活项</li>\n</ol>\n<p><strong>样式问题：</strong></p>\n<p>首先处理样式，因为后面我们需要处理 <strong>主题替换</strong> ，所以此处我们不能把样式写死。因为我们的样式变量都放在 <code>variables.scss</code> 文件中，并通过 <code>:export</code> 导出了变量以供 js 导入，每次使用都需要导入，比较麻烦，我们可以将其放在 <code>store getters</code> 中，以便 <strong>快捷访问</strong>。</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\"><span class=\"hljs-keyword\">import</span> variables <span class=\"hljs-keyword\">from</span> <span class=\"hljs-string\">&#x27;@/styles/variables.scss&#x27;</span><br><span class=\"hljs-keyword\">const</span> getters = &#123;<br>  <span class=\"hljs-attr\">cssVar</span>: <span class=\"hljs-function\">() =&gt;</span> variables<br>&#125;<br><span class=\"hljs-keyword\">export</span> <span class=\"hljs-keyword\">default</span> getters<br></code></pre></td></tr></table></figure>\n\n<p>在 <code>SidebarMenu</code> 中写入如下样式</p>\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs html\"><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">el-menu</span></span><br><span class=\"hljs-tag\">  <span class=\"hljs-attr\">:background-color</span>=<span class=\"hljs-string\">&quot;$store.getters.cssVar.menuBg&quot;</span></span><br><span class=\"hljs-tag\">  <span class=\"hljs-attr\">:text-color</span>=<span class=\"hljs-string\">&quot;$store.getters.cssVar.menuText&quot;</span></span><br><span class=\"hljs-tag\">  <span class=\"hljs-attr\">:active-text-color</span>=<span class=\"hljs-string\">&quot;$store.getters.cssVar.menuActiveText&quot;</span></span><br><span class=\"hljs-tag\">  <span class=\"hljs-attr\">:unique-opened</span>=<span class=\"hljs-string\">&quot;true&quot;</span></span><br><span class=\"hljs-tag\">&gt;</span><br></code></pre></td></tr></table></figure>\n\n<p><strong>路由跳转问题：</strong></p>\n<p>为 <code>el-menu</code> 指定 <code>router</code></p>\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs html\"><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">el-menu</span></span><br><span class=\"hljs-tag\">  <span class=\"hljs-attr\">...</span></span><br><span class=\"hljs-tag\">  <span class=\"hljs-attr\">router</span></span><br><span class=\"hljs-tag\">&gt;</span><br></code></pre></td></tr></table></figure>\n\n<blockquote>\n<p>添加 router 属性</p>\n<p>表示是否启用 vue-router 模式。 启用该模式会在激活导航时以 index 作为 path 进行路由跳转 使用 default-active 来设置加载时的激活项。</p>\n</blockquote>\n<p><strong>默认激活项：</strong></p>\n<p>根据当前 <code>url</code> 进行判断即可</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\">&lt;el-menu<br>  :<span class=\"hljs-keyword\">default</span>-active=<span class=\"hljs-string\">&quot;activeMenu&quot;</span><br>  ...<br>&gt;<br><br><span class=\"language-xml\"><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">script</span> <span class=\"hljs-attr\">setup</span>&gt;</span><span class=\"language-javascript\"></span></span><br><span class=\"language-javascript\"><span class=\"language-xml\">...</span></span><br><span class=\"language-javascript\"><span class=\"language-xml\"></span></span><br><span class=\"language-javascript\"><span class=\"language-xml\"><span class=\"hljs-comment\">// 计算高亮 menu 的方法</span></span></span><br><span class=\"language-javascript\"><span class=\"language-xml\"><span class=\"hljs-keyword\">const</span> route = <span class=\"hljs-title function_\">useRoute</span>()</span></span><br><span class=\"language-javascript\"><span class=\"language-xml\"><span class=\"hljs-keyword\">const</span> activeMenu = <span class=\"hljs-title function_\">computed</span>(<span class=\"hljs-function\">() =&gt;</span> &#123;</span></span><br><span class=\"language-javascript\"><span class=\"language-xml\">  <span class=\"hljs-keyword\">const</span> &#123; path &#125; = route</span></span><br><span class=\"language-javascript\"><span class=\"language-xml\">  <span class=\"hljs-keyword\">return</span> path</span></span><br><span class=\"language-javascript\"><span class=\"language-xml\">&#125;)</span></span><br><span class=\"language-javascript\"><span class=\"language-xml\"></span><span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">script</span>&gt;</span></span><br></code></pre></td></tr></table></figure>\n\n<p>至此整个 <strong>动态<code>menu</code>完成</strong></p>\n<h2 id=\"左侧菜单伸缩功能实现\"><a href=\"#左侧菜单伸缩功能实现\" class=\"headerlink\" title=\"左侧菜单伸缩功能实现\"></a>左侧菜单伸缩功能实现</h2><p>下面我们来实现一个标准化功能 <strong>左侧菜单伸缩</strong> ，对于这个功能核心的点在于动画处理</p>\n<p>样式的改变总是由数据进行驱动，所以首先我们去创建对应的数据</p>\n<p>创建 <code>store/app</code> 模块，写入如下代码</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\"><span class=\"hljs-keyword\">export</span> <span class=\"hljs-keyword\">default</span> &#123;<br>  <span class=\"hljs-attr\">namespaced</span>: <span class=\"hljs-literal\">true</span>,<br>  <span class=\"hljs-attr\">state</span>: <span class=\"hljs-function\">() =&gt;</span> (&#123;<br>    <span class=\"hljs-attr\">sidebarOpened</span>: <span class=\"hljs-literal\">true</span><br>  &#125;),<br>  <span class=\"hljs-attr\">mutations</span>: &#123;<br>    <span class=\"hljs-title function_\">triggerSidebarOpened</span>(<span class=\"hljs-params\">state</span>) &#123;<br>      state.<span class=\"hljs-property\">sidebarOpened</span> = !state.<span class=\"hljs-property\">sidebarOpened</span><br>    &#125;<br>  &#125;,<br>  <span class=\"hljs-attr\">actions</span>: &#123;&#125;<br>&#125;<br><br></code></pre></td></tr></table></figure>\n\n<p>在 <code>store/index</code> 中进行导入</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\">...<br><span class=\"hljs-keyword\">import</span> app <span class=\"hljs-keyword\">from</span> <span class=\"hljs-string\">&#x27;./modules/app&#x27;</span><br><span class=\"hljs-keyword\">export</span> <span class=\"hljs-keyword\">default</span> <span class=\"hljs-title function_\">createStore</span>(&#123;<br>  getters,<br>  <span class=\"hljs-attr\">modules</span>: &#123;<br>    ...<br>    app<br>  &#125;<br>&#125;)<br></code></pre></td></tr></table></figure>\n\n<p>在 <code>store/getters</code> 中创建快捷访问</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\"><span class=\"hljs-attr\">sidebarOpened</span>: <span class=\"hljs-function\"><span class=\"hljs-params\">state</span> =&gt;</span> state.<span class=\"hljs-property\">app</span>.<span class=\"hljs-property\">sidebarOpened</span><br></code></pre></td></tr></table></figure>\n\n\n<p>创建 <code>components/hamburger</code> 组件，用来控制数据</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\">&lt;template&gt;<br>  <span class=\"language-xml\"><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">div</span> <span class=\"hljs-attr\">class</span>=<span class=\"hljs-string\">&quot;hamburger-container&quot;</span> @<span class=\"hljs-attr\">click</span>=<span class=\"hljs-string\">&quot;toggleClick&quot;</span>&gt;</span></span><br><span class=\"language-xml\">    <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">svg-icon</span> <span class=\"hljs-attr\">class</span>=<span class=\"hljs-string\">&quot;hamburger&quot;</span> <span class=\"hljs-attr\">:icon</span>=<span class=\"hljs-string\">&quot;icon&quot;</span>&gt;</span><span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">svg-icon</span>&gt;</span></span><br><span class=\"language-xml\">  <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">div</span>&gt;</span></span><br>&lt;/template&gt;<br><br><span class=\"language-xml\"><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">script</span> <span class=\"hljs-attr\">setup</span>&gt;</span><span class=\"language-javascript\"></span></span><br><span class=\"language-javascript\"><span class=\"language-xml\"><span class=\"hljs-keyword\">import</span> &#123; computed &#125; <span class=\"hljs-keyword\">from</span> <span class=\"hljs-string\">&#x27;vue&#x27;</span></span></span><br><span class=\"language-javascript\"><span class=\"language-xml\"><span class=\"hljs-keyword\">import</span> &#123; useStore &#125; <span class=\"hljs-keyword\">from</span> <span class=\"hljs-string\">&#x27;vuex&#x27;</span></span></span><br><span class=\"language-javascript\"><span class=\"language-xml\"></span></span><br><span class=\"language-javascript\"><span class=\"language-xml\"><span class=\"hljs-keyword\">const</span> store = <span class=\"hljs-title function_\">useStore</span>()</span></span><br><span class=\"language-javascript\"><span class=\"language-xml\"><span class=\"hljs-keyword\">const</span> <span class=\"hljs-title function_\">toggleClick</span> = (<span class=\"hljs-params\"></span>) =&gt; &#123;</span></span><br><span class=\"language-javascript\"><span class=\"language-xml\">  store.<span class=\"hljs-title function_\">commit</span>(<span class=\"hljs-string\">&#x27;app/triggerSidebarOpened&#x27;</span>)</span></span><br><span class=\"language-javascript\"><span class=\"language-xml\">&#125;</span></span><br><span class=\"language-javascript\"><span class=\"language-xml\"></span></span><br><span class=\"language-javascript\"><span class=\"language-xml\"><span class=\"hljs-keyword\">const</span> icon = <span class=\"hljs-title function_\">computed</span>(<span class=\"hljs-function\">() =&gt;</span></span></span><br><span class=\"language-javascript\"><span class=\"language-xml\">  store.<span class=\"hljs-property\">getters</span>.<span class=\"hljs-property\">sidebarOpened</span> ? <span class=\"hljs-string\">&#x27;hamburger-opened&#x27;</span> : <span class=\"hljs-string\">&#x27;hamburger-closed&#x27;</span></span></span><br><span class=\"language-javascript\"><span class=\"language-xml\">)</span></span><br><span class=\"language-javascript\"><span class=\"language-xml\"></span><span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">script</span>&gt;</span></span><br><br><span class=\"language-xml\"><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">style</span> <span class=\"hljs-attr\">lang</span>=<span class=\"hljs-string\">&quot;scss&quot;</span> <span class=\"hljs-attr\">scoped</span>&gt;</span><span class=\"language-css\"></span></span><br><span class=\"language-css\"><span class=\"language-xml\"><span class=\"hljs-selector-class\">.hamburger-container</span> &#123;</span></span><br><span class=\"language-css\"><span class=\"language-xml\">  <span class=\"hljs-attribute\">padding</span>: <span class=\"hljs-number\">0</span> <span class=\"hljs-number\">16px</span>;</span></span><br><span class=\"language-css\"><span class=\"language-xml\">  <span class=\"hljs-selector-class\">.hamburger</span> &#123;</span></span><br><span class=\"language-css\"><span class=\"language-xml\">    <span class=\"hljs-attribute\">display</span>: inline-block;</span></span><br><span class=\"language-css\"><span class=\"language-xml\">    <span class=\"hljs-attribute\">vertical-align</span>: middle;</span></span><br><span class=\"language-css\"><span class=\"language-xml\">    <span class=\"hljs-attribute\">width</span>: <span class=\"hljs-number\">20px</span>;</span></span><br><span class=\"language-css\"><span class=\"language-xml\">    <span class=\"hljs-attribute\">height</span>: <span class=\"hljs-number\">20px</span>;</span></span><br><span class=\"language-css\"><span class=\"language-xml\">  &#125;</span></span><br><span class=\"language-css\"><span class=\"language-xml\">&#125;</span></span><br><span class=\"language-css\"><span class=\"language-xml\"></span><span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">style</span>&gt;</span></span><br></code></pre></td></tr></table></figure>\n\n<p>在 <code>navbar</code> 中使用该组件</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\">&lt;template&gt;<br>  <span class=\"language-xml\"><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">div</span> <span class=\"hljs-attr\">class</span>=<span class=\"hljs-string\">&quot;navbar&quot;</span>&gt;</span></span><br><span class=\"language-xml\">    <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">hamburger</span> <span class=\"hljs-attr\">class</span>=<span class=\"hljs-string\">&quot;hamburger-container&quot;</span> /&gt;</span></span><br><span class=\"language-xml\">    ...</span><br><span class=\"language-xml\">  <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">div</span>&gt;</span></span><br>&lt;/template&gt;<br><br><span class=\"language-xml\"><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">script</span> <span class=\"hljs-attr\">setup</span>&gt;</span><span class=\"language-javascript\"></span></span><br><span class=\"language-javascript\"><span class=\"language-xml\"><span class=\"hljs-keyword\">import</span> <span class=\"hljs-title class_\">Hamburger</span> <span class=\"hljs-keyword\">from</span> <span class=\"hljs-string\">&#x27;@/components/Hamburger&#x27;</span></span></span><br><span class=\"language-javascript\"><span class=\"language-xml\">...</span></span><br><span class=\"language-javascript\"><span class=\"language-xml\"></span><span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">script</span>&gt;</span></span><br><br><span class=\"language-xml\"><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">style</span> <span class=\"hljs-attr\">lang</span>=<span class=\"hljs-string\">&quot;scss&quot;</span> <span class=\"hljs-attr\">scoped</span>&gt;</span><span class=\"language-css\"></span></span><br><span class=\"language-css\"><span class=\"language-xml\"><span class=\"hljs-selector-class\">.navbar</span> &#123;</span></span><br><span class=\"language-css\"><span class=\"language-xml\">  ...</span></span><br><span class=\"language-css\"><span class=\"language-xml\"></span></span><br><span class=\"language-css\"><span class=\"language-xml\">  <span class=\"hljs-selector-class\">.hamburger-container</span> &#123;</span></span><br><span class=\"language-css\"><span class=\"language-xml\">    <span class=\"hljs-attribute\">line-height</span>: <span class=\"hljs-number\">46px</span>;</span></span><br><span class=\"language-css\"><span class=\"language-xml\">    <span class=\"hljs-attribute\">height</span>: <span class=\"hljs-number\">100%</span>;</span></span><br><span class=\"language-css\"><span class=\"language-xml\">    <span class=\"hljs-attribute\">float</span>: left;</span></span><br><span class=\"language-css\"><span class=\"language-xml\">    <span class=\"hljs-attribute\">cursor</span>: pointer;</span></span><br><span class=\"language-css\"><span class=\"language-xml\">    // hover 动画</span></span><br><span class=\"language-css\"><span class=\"language-xml\">    <span class=\"hljs-attribute\">transition</span>: background <span class=\"hljs-number\">0.5s</span>;</span></span><br><span class=\"language-css\"><span class=\"language-xml\"></span></span><br><span class=\"language-css\"><span class=\"language-xml\">    &amp;<span class=\"hljs-selector-pseudo\">:hover</span> &#123;</span></span><br><span class=\"language-css\"><span class=\"language-xml\">      <span class=\"hljs-attribute\">background</span>: <span class=\"hljs-built_in\">rgba</span>(<span class=\"hljs-number\">0</span>, <span class=\"hljs-number\">0</span>, <span class=\"hljs-number\">0</span>, <span class=\"hljs-number\">0.1</span>);</span></span><br><span class=\"language-css\"><span class=\"language-xml\">    &#125;</span></span><br><span class=\"language-css\"><span class=\"language-xml\">  &#125;</span></span><br><span class=\"language-css\"><span class=\"language-xml\"></span></span><br><span class=\"language-css\"><span class=\"language-xml\"> ...</span></span><br><span class=\"language-css\"><span class=\"language-xml\">&#125;</span></span><br><span class=\"language-css\"><span class=\"language-xml\"></span><span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">style</span>&gt;</span></span><br><br></code></pre></td></tr></table></figure>\n\n<p>在 <code>SidebarMenu</code> 中，控制 <code>el-menu</code> 的 <a href=\"https://element-plus.org/#/zh-CN/component/menu\">collapse</a> 属性</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\">&lt;el-menu<br>    :collapse=<span class=\"hljs-string\">&quot;!$store.getters.sidebarOpened&quot;</span><br>    ...<br></code></pre></td></tr></table></figure>\n\n<p>在 <code>layout/index</code> 中指定 <strong>整个侧边栏的宽度和缩放动画</strong></p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\">&lt;div<br>    <span class=\"hljs-keyword\">class</span>=<span class=\"hljs-string\">&quot;app-wrapper&quot;</span><br>    :<span class=\"hljs-keyword\">class</span>=<span class=\"hljs-string\">&quot;[$store.getters.sidebarOpened ? &#x27;openSidebar&#x27; : &#x27;hideSidebar&#x27;]&quot;</span><br>  &gt;<br>  ...<br></code></pre></td></tr></table></figure>\n\n<p>在 <code>layout/index</code> 中 处理 <code>navbar</code> 的宽度</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\">&lt;style lang=<span class=\"hljs-string\">&quot;scss&quot;</span> scoped&gt;<br>...<br><br>.<span class=\"hljs-property\">fixed</span>-header &#123;<br>  <span class=\"hljs-attr\">position</span>: fixed;<br>  <span class=\"hljs-attr\">top</span>: <span class=\"hljs-number\">0</span>;<br>  <span class=\"hljs-attr\">right</span>: <span class=\"hljs-number\">0</span>;<br>  z-<span class=\"hljs-attr\">index</span>: <span class=\"hljs-number\">9</span>;<br>  <span class=\"hljs-attr\">width</span>: <span class=\"hljs-title function_\">calc</span>(<span class=\"hljs-number\">100</span>% - #&#123;$sideBarWidth&#125;);<br>  <span class=\"hljs-attr\">transition</span>: width <span class=\"hljs-number\">0.</span>28s;<br>&#125;<br><br>.<span class=\"hljs-property\">hideSidebar</span> .<span class=\"hljs-property\">fixed</span>-header &#123;<br>  <span class=\"hljs-attr\">width</span>: <span class=\"hljs-title function_\">calc</span>(<span class=\"hljs-number\">100</span>% - #&#123;$hideSideBarWidth&#125;);<br>&#125;<br>&lt;/style&gt;<br></code></pre></td></tr></table></figure>\n\n<p>在 <code>styles/variables.scss</code> 中指定 <code>hideSideBarWidth</code></p>\n<figure class=\"highlight scss\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs scss\"><span class=\"hljs-variable\">$hideSideBarWidth</span>: <span class=\"hljs-number\">54px</span>;<br></code></pre></td></tr></table></figure>\n\n\n\n<h2 id=\"SidebarHeader-处理\"><a href=\"#SidebarHeader-处理\" class=\"headerlink\" title=\"SidebarHeader 处理\"></a>SidebarHeader 处理</h2><p>整个左侧的 <code>menu</code> 菜单，到现在咱们还剩下最后一个 <code>header</code> 没有进行处理</p>\n<p>在 <code>sidebar/index</code> 中写入如下代码</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\">&lt;template&gt;<br>  <span class=\"language-xml\"><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">div</span> <span class=\"hljs-attr\">class</span>=<span class=\"hljs-string\">&quot;&quot;</span>&gt;</span></span><br><span class=\"language-xml\">    <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">div</span> <span class=\"hljs-attr\">class</span>=<span class=\"hljs-string\">&quot;logo-container&quot;</span>&gt;</span></span><br><span class=\"language-xml\">      <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">el-avatar</span></span></span><br><span class=\"hljs-tag\"><span class=\"language-xml\">        <span class=\"hljs-attr\">size</span>=<span class=\"hljs-string\">&quot;44&quot;</span></span></span><br><span class=\"hljs-tag\"><span class=\"language-xml\">        <span class=\"hljs-attr\">shape</span>=<span class=\"hljs-string\">&quot;square&quot;</span></span></span><br><span class=\"hljs-tag\"><span class=\"language-xml\">        <span class=\"hljs-attr\">src</span>=<span class=\"hljs-string\">&quot;https://m.imooc.com/static/wap/static/common/img/logo-small@2x.png&quot;</span></span></span><br><span class=\"hljs-tag\"><span class=\"language-xml\">      /&gt;</span></span><br><span class=\"language-xml\">      <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">h1</span> <span class=\"hljs-attr\">class</span>=<span class=\"hljs-string\">&quot;logo-title&quot;</span> <span class=\"hljs-attr\">v-if</span>=<span class=\"hljs-string\">&quot;$store.getters.sidebarOpened&quot;</span>&gt;</span></span><br><span class=\"language-xml\">       imooc-admin</span><br><span class=\"language-xml\">      <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">h1</span>&gt;</span></span><br><span class=\"language-xml\">    <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">div</span>&gt;</span></span><br><span class=\"language-xml\">    ...</span><br><span class=\"language-xml\">  <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">div</span>&gt;</span></span><br>&lt;/template&gt;<br><br><span class=\"language-xml\"><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">style</span> <span class=\"hljs-attr\">lang</span>=<span class=\"hljs-string\">&quot;scss&quot;</span> <span class=\"hljs-attr\">scoped</span>&gt;</span><span class=\"language-css\"></span></span><br><span class=\"language-css\"><span class=\"language-xml\"><span class=\"hljs-selector-class\">.logo-container</span> &#123;</span></span><br><span class=\"language-css\"><span class=\"language-xml\">  <span class=\"hljs-attribute\">height</span>: <span class=\"hljs-number\">44px</span>;</span></span><br><span class=\"language-css\"><span class=\"language-xml\">  <span class=\"hljs-attribute\">padding</span>: <span class=\"hljs-number\">10px</span> <span class=\"hljs-number\">0</span> <span class=\"hljs-number\">22px</span> <span class=\"hljs-number\">0</span>;</span></span><br><span class=\"language-css\"><span class=\"language-xml\">  <span class=\"hljs-attribute\">display</span>: flex;</span></span><br><span class=\"language-css\"><span class=\"language-xml\">  <span class=\"hljs-attribute\">align-items</span>: center;</span></span><br><span class=\"language-css\"><span class=\"language-xml\">  <span class=\"hljs-attribute\">justify-content</span>: center;</span></span><br><span class=\"language-css\"><span class=\"language-xml\">  <span class=\"hljs-selector-class\">.logo-title</span> &#123;</span></span><br><span class=\"language-css\"><span class=\"language-xml\">    <span class=\"hljs-attribute\">margin-left</span>: <span class=\"hljs-number\">10px</span>;</span></span><br><span class=\"language-css\"><span class=\"language-xml\">    <span class=\"hljs-attribute\">color</span>: <span class=\"hljs-number\">#fff</span>;</span></span><br><span class=\"language-css\"><span class=\"language-xml\">    <span class=\"hljs-attribute\">font-weight</span>: <span class=\"hljs-number\">600</span>;</span></span><br><span class=\"language-css\"><span class=\"language-xml\">    <span class=\"hljs-attribute\">line-height</span>: <span class=\"hljs-number\">50px</span>;</span></span><br><span class=\"language-css\"><span class=\"language-xml\">    <span class=\"hljs-attribute\">font-size</span>: <span class=\"hljs-number\">16px</span>;</span></span><br><span class=\"language-css\"><span class=\"language-xml\">    <span class=\"hljs-attribute\">white-space</span>: nowrap;</span></span><br><span class=\"language-css\"><span class=\"language-xml\">  &#125;</span></span><br><span class=\"language-css\"><span class=\"language-xml\">&#125;</span></span><br><span class=\"language-css\"><span class=\"language-xml\"></span><span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">style</span>&gt;</span></span><br><br></code></pre></td></tr></table></figure>\n\n<p>创建 <code>styles/element.scss</code> 文件，统一处理 <code>el-avatar</code> 的背景问题</p>\n<figure class=\"highlight scss\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs scss\"><span class=\"hljs-selector-class\">.el-avatar</span> &#123;<br>  <span class=\"hljs-attr\">--el-avatar-background-color</span>: none;<br>&#125;<br></code></pre></td></tr></table></figure>\n\n<p>在 <code>styles/index.scss</code> 中导入</p>\n<figure class=\"highlight scss\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs scss\">...<br><span class=\"hljs-keyword\">@import</span> <span class=\"hljs-string\">&#x27;./element.scss&#x27;</span>;<br></code></pre></td></tr></table></figure>\n\n<p>统一处理下动画时长的问题，在 <code>styles/variables.scss</code> 中，加入以下变量</p>\n<figure class=\"highlight css\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs css\">$sideBarDuration: <span class=\"hljs-number\">0.28s</span>;<br></code></pre></td></tr></table></figure>\n\n<p>为 <code>styles/sidebar.scss</code> 修改时长</p>\n<figure class=\"highlight scss\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs scss\"><span class=\"hljs-selector-class\">.main-container</span> &#123;<br>  <span class=\"hljs-attribute\">transition</span>: margin-left #&#123;<span class=\"hljs-variable\">$sideBarDuration</span>&#125;;<br> ...<br>&#125;<br><br><span class=\"hljs-selector-class\">.sidebar-container</span> &#123;<br>  <span class=\"hljs-attribute\">transition</span>: width #&#123;<span class=\"hljs-variable\">$sideBarDuration</span>&#125;;<br>\t...<br>&#125;<br></code></pre></td></tr></table></figure>\n\n<p>为 <code>layout/index</code> 修改样式</p>\n<figure class=\"highlight scss\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs scss\"><span class=\"hljs-selector-class\">.fixed-header</span> &#123;<br>  ...<br>  <span class=\"hljs-attribute\">transition</span>: width #&#123;<span class=\"hljs-variable\">$sideBarDuration</span>&#125;;<br>&#125;<br></code></pre></td></tr></table></figure>\n\n<h1 id=\"Vue3-2：组件状态驱动的动态-CSS-值\"><a href=\"#Vue3-2：组件状态驱动的动态-CSS-值\" class=\"headerlink\" title=\"Vue3.2：组件状态驱动的动态 CSS 值\"></a>Vue3.2：组件状态驱动的动态 CSS 值</h1><p>在 <a href=\"https://blog.vuejs.org/posts/vue-3.2.html\">vue 3.2</a> 最新更新中，除了之前我们介绍的 <strong>响应式变化</strong> 之外，还有另外一个很重要的更新，那就是 <strong>组件状态驱动的动态 <code>CSS</code> 值</strong> ，对应的文档也已经公布，大家可以 <a href=\"https://v3.vuejs.org/api/sfc-style.html#state-driven-dynamic-css\">点击这里</a> 查看</p>\n<p>那么下面我们就使用下最新的特性，来为 <code>logo-container</code> 指定下高度：</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\">&lt;template&gt;<br> ...<br> &lt;el-avatar<br> \t:size=<span class=\"hljs-string\">&quot;logoHeight&quot;</span><br> ...<br><br>&lt;/template&gt;<br><br><span class=\"language-xml\"><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">script</span> <span class=\"hljs-attr\">setup</span>&gt;</span><span class=\"language-javascript\"></span></span><br><span class=\"language-javascript\"><span class=\"language-xml\">...</span></span><br><span class=\"language-javascript\"><span class=\"language-xml\"><span class=\"hljs-keyword\">const</span> logoHeight = <span class=\"hljs-number\">44</span></span></span><br><span class=\"language-javascript\"><span class=\"language-xml\"></span><span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">script</span>&gt;</span></span><br><br><span class=\"language-xml\"><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">style</span> <span class=\"hljs-attr\">lang</span>=<span class=\"hljs-string\">&quot;scss&quot;</span> <span class=\"hljs-attr\">scoped</span>&gt;</span><span class=\"language-css\"></span></span><br><span class=\"language-css\"><span class=\"language-xml\"><span class=\"hljs-selector-class\">.logo-container</span> &#123;</span></span><br><span class=\"language-css\"><span class=\"language-xml\">  <span class=\"hljs-attribute\">height</span>: <span class=\"hljs-built_in\">v-bind</span>(logoHeight) + <span class=\"hljs-string\">&#x27;px&#x27;</span>;</span></span><br><span class=\"language-css\"><span class=\"language-xml\">...</span></span><br><span class=\"language-css\"><span class=\"language-xml\">&#125;</span></span><br><span class=\"language-css\"><span class=\"language-xml\"></span><span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">style</span>&gt;</span></span><br><br></code></pre></td></tr></table></figure>\n\n<h1 id=\"动态面包屑方案分析\"><a href=\"#动态面包屑方案分析\" class=\"headerlink\" title=\"动态面包屑方案分析\"></a>动态面包屑方案分析</h1><p>面包屑导航分为：</p>\n<ol>\n<li>静态面包屑</li>\n<li>动态面包屑</li>\n</ol>\n<p><strong>静态面包屑：</strong></p>\n<p>指的是：<strong>在每个页面中写死对应的面包屑菜单</strong>，缺点也很明显：</p>\n<ol>\n<li>每个页面都得写一遍</li>\n<li>页面路径结构变化了，得手动更改</li>\n</ol>\n<p>简单来说就是 <strong>不好维护，不好扩展</strong> 。</p>\n<p><strong>动态面包屑：</strong></p>\n<p>根据当前的 <code>url</code> 自动生成面包屑导航菜单</p>\n<p>无论之后路径发生了什么变化，<strong>动态面包屑</strong> 都会正确的进行计算</p>\n<p>那么在后面的实现过程中，我们将会分成三大步来实现</p>\n<ol>\n<li>创建、渲染基本的面包屑组件</li>\n<li>计算面包屑结构数据</li>\n<li>根据数据渲染动态面包屑内容</li>\n</ol>\n<h2 id=\"渲染基本的面包屑组件\"><a href=\"#渲染基本的面包屑组件\" class=\"headerlink\" title=\"渲染基本的面包屑组件\"></a>渲染基本的面包屑组件</h2><p>完成第一步，先去创建并渲染出基本的 <a href=\"https://element-plus.org/#/zh-CN/component/breadcrumb\">面包屑</a> 组件</p>\n<p>创建 <code>components/Breadcrumb/index</code>，并写入如下代码：</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\">&lt;template&gt;<br>  <span class=\"language-xml\"><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">el-breadcrumb</span> <span class=\"hljs-attr\">class</span>=<span class=\"hljs-string\">&quot;breadcrumb&quot;</span> <span class=\"hljs-attr\">separator</span>=<span class=\"hljs-string\">&quot;/&quot;</span>&gt;</span></span><br><span class=\"language-xml\">    <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">el-breadcrumb-item</span> <span class=\"hljs-attr\">:to</span>=<span class=\"hljs-string\">&quot;&#123; path: &#x27;/&#x27; &#125;&quot;</span>&gt;</span>首页<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">el-breadcrumb-item</span>&gt;</span></span><br><span class=\"language-xml\">    <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">el-breadcrumb-item</span>&gt;</span><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">a</span> <span class=\"hljs-attr\">href</span>=<span class=\"hljs-string\">&quot;/&quot;</span>&gt;</span>活动管理<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">a</span>&gt;</span><span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">el-breadcrumb-item</span>&gt;</span></span><br><span class=\"language-xml\">    <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">el-breadcrumb-item</span>&gt;</span>活动列表<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">el-breadcrumb-item</span>&gt;</span></span><br><span class=\"language-xml\">    <span class=\"hljs-comment\">&lt;!-- 面包屑的最后一项 --&gt;</span></span><br><span class=\"language-xml\">    <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">el-breadcrumb-item</span>&gt;</span></span><br><span class=\"language-xml\">      <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">span</span> <span class=\"hljs-attr\">class</span>=<span class=\"hljs-string\">&quot;no-redirect&quot;</span>&gt;</span>活动详情<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">span</span>&gt;</span></span><br><span class=\"language-xml\">    <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">el-breadcrumb-item</span>&gt;</span></span><br><span class=\"language-xml\">  <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">el-breadcrumb</span>&gt;</span></span><br>&lt;/template&gt;<br><br><span class=\"language-xml\"><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">script</span> <span class=\"hljs-attr\">setup</span>&gt;</span><span class=\"language-javascript\"></span></span><br><span class=\"language-javascript\"><span class=\"language-xml\"><span class=\"hljs-keyword\">import</span> &#123;&#125; <span class=\"hljs-keyword\">from</span> <span class=\"hljs-string\">&#x27;vue&#x27;</span></span></span><br><span class=\"language-javascript\"><span class=\"language-xml\"></span><span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">script</span>&gt;</span></span><br><br><span class=\"language-xml\"><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">style</span> <span class=\"hljs-attr\">lang</span>=<span class=\"hljs-string\">&quot;scss&quot;</span> <span class=\"hljs-attr\">scoped</span>&gt;</span><span class=\"language-css\"></span></span><br><span class=\"language-css\"><span class=\"language-xml\"><span class=\"hljs-selector-class\">.breadcrumb</span> &#123;</span></span><br><span class=\"language-css\"><span class=\"language-xml\">  <span class=\"hljs-attribute\">display</span>: inline-block;</span></span><br><span class=\"language-css\"><span class=\"language-xml\">  <span class=\"hljs-attribute\">font-size</span>: <span class=\"hljs-number\">14px</span>;</span></span><br><span class=\"language-css\"><span class=\"language-xml\">  <span class=\"hljs-attribute\">line-height</span>: <span class=\"hljs-number\">50px</span>;</span></span><br><span class=\"language-css\"><span class=\"language-xml\">  <span class=\"hljs-attribute\">margin-left</span>: <span class=\"hljs-number\">8px</span>;</span></span><br><span class=\"language-css\"><span class=\"language-xml\"></span></span><br><span class=\"language-css\"><span class=\"language-xml\">  ::v-deep .no-redirect &#123;</span></span><br><span class=\"language-css\"><span class=\"language-xml\">    <span class=\"hljs-attribute\">color</span>: <span class=\"hljs-number\">#97a8be</span>;</span></span><br><span class=\"language-css\"><span class=\"language-xml\">    <span class=\"hljs-attribute\">cursor</span>: text;</span></span><br><span class=\"language-css\"><span class=\"language-xml\">  &#125;</span></span><br><span class=\"language-css\"><span class=\"language-xml\">&#125;</span></span><br><span class=\"language-css\"><span class=\"language-xml\"></span><span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">style</span>&gt;</span></span><br><br></code></pre></td></tr></table></figure>\n\n<p>在 <code>layout/components/Navbar</code> 组件下导入</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\">&lt;template&gt;<br>  <span class=\"language-xml\"><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">div</span> <span class=\"hljs-attr\">class</span>=<span class=\"hljs-string\">&quot;navbar&quot;</span>&gt;</span></span><br><span class=\"language-xml\">    <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">hamburger</span> <span class=\"hljs-attr\">class</span>=<span class=\"hljs-string\">&quot;hamburger-container&quot;</span> /&gt;</span></span><br><span class=\"language-xml\">    <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">breadcrumb</span> <span class=\"hljs-attr\">class</span>=<span class=\"hljs-string\">&quot;breadcrumb-container&quot;</span> /&gt;</span></span><br><span class=\"language-xml\">\t...</span><br><span class=\"language-xml\">  <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">div</span>&gt;</span></span><br>&lt;/template&gt;<br>...<br><br>&lt;style lang=<span class=\"hljs-string\">&quot;scss&quot;</span> scoped&gt;<br>.<span class=\"hljs-property\">navbar</span> &#123;<br> ...<br><br>  .<span class=\"hljs-property\">breadcrumb</span>-container &#123;<br>    <span class=\"hljs-attr\">float</span>: left;<br>  &#125;<br>   ...<br>&#125;<br>&lt;/style&gt;<br><br></code></pre></td></tr></table></figure>\n\n<h2 id=\"动态计算面包屑结构数据\"><a href=\"#动态计算面包屑结构数据\" class=\"headerlink\" title=\"动态计算面包屑结构数据\"></a>动态计算面包屑结构数据</h2><p>现在我们是完成了一个静态的 面包屑，接下来咱们就需要依托这个静态的菜单来完成动态的。</p>\n<p>对于现在的静态面包屑来说，他分成了两个组件：</p>\n<ol>\n<li><code>el-breadcrumb</code>：包裹性质的容器</li>\n<li><code>el-breadcrumb-item</code>：每个单独项</li>\n</ol>\n<p>如果我们想要完成动态的，那么就需要 *<em>依据动态数据，渲染 <code>el-breadcrumb-item</code> *</em></p>\n<p>所以说接下来我们需要做的事情就很简单了</p>\n<ol>\n<li>动态数据</li>\n<li>渲染 <code>el-breadcrumb-item</code></li>\n</ol>\n<p>咱们先来看 <strong>动态数据如何制作</strong></p>\n<p>我们希望可以制作出一个 <strong>数组</strong>，数组中每个 <code>item</code> 都表示一个 <strong>路由信息</strong>：</p>\n<p>创建一个方法，用来生成数组数据，在这里我们要使用到 <a href=\"https://next.router.vuejs.org/zh/api/#matched\">route.match</a> 属性来：<strong>获取与给定路由地址匹配的<a href=\"https://next.router.vuejs.org/zh/api/#routerecord\">标准化的路由记录</a>数组</strong></p>\n<p>如何理解上面这句话呢？其实我们将 <code>route.matched</code> 打印出来就可以发现，你每次切换菜单（或者说更换了路由），打印出来的就是当前路由的路由表（包含父级、子集的路由信息）。</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\">&lt;script setup&gt;<br><span class=\"hljs-keyword\">import</span> &#123; ref, reactive, watch &#125; <span class=\"hljs-keyword\">from</span> <span class=\"hljs-string\">&#x27;vue&#x27;</span><br><span class=\"hljs-keyword\">import</span> &#123; useRoute, <span class=\"hljs-title class_\">RouteRecordRaw</span> &#125; <span class=\"hljs-keyword\">from</span> <span class=\"hljs-string\">&#x27;vue-router&#x27;</span><br><br><span class=\"hljs-keyword\">const</span> breadcrumbData = ref&lt;<span class=\"hljs-title class_\">RouteRecordRaw</span>[]&gt;([]) <span class=\"hljs-comment\">// 存放计算出的面包屑数据</span><br><br><span class=\"hljs-keyword\">const</span> route = <span class=\"hljs-title function_\">useRoute</span>()<br><br><span class=\"hljs-keyword\">const</span> <span class=\"hljs-title function_\">getBreadcrumbData</span> = (<span class=\"hljs-params\"></span>) =&gt; &#123;<br>  <span class=\"hljs-variable language_\">console</span>.<span class=\"hljs-title function_\">log</span>(route.<span class=\"hljs-property\">matched</span>)<br><br>  <span class=\"hljs-comment\">// 只有存在 meta 并且 meta.title 的路由，我们才会显示到面包屑中</span><br>  <span class=\"hljs-comment\">// 就像 menu 菜单一样，类似 404 login 的我们不要显示</span><br>  breadcrumbData.<span class=\"hljs-property\">value</span> = route.<span class=\"hljs-property\">matched</span>.<span class=\"hljs-title function_\">filter</span>(<span class=\"hljs-function\"><span class=\"hljs-params\">r</span> =&gt;</span> r.<span class=\"hljs-property\">meta</span> &amp;&amp; r.<span class=\"hljs-property\">meta</span>.<span class=\"hljs-property\">title</span>)<br>&#125;<br><br><span class=\"hljs-comment\">// 监听路由变化时触发</span><br><span class=\"hljs-title function_\">watch</span>(<br>  route,<br>  <span class=\"hljs-function\">() =&gt;</span> &#123;<br>    <span class=\"hljs-title function_\">getBreadcrumbData</span>()<br>  &#125;,<br>  &#123;<br>    <span class=\"hljs-attr\">immediate</span>: <span class=\"hljs-literal\">true</span><br>  &#125;<br>)<br>&lt;/script&gt;<br></code></pre></td></tr></table></figure>\n\n<h2 id=\"依据动态数据，渲染面包屑\"><a href=\"#依据动态数据，渲染面包屑\" class=\"headerlink\" title=\"依据动态数据，渲染面包屑\"></a>依据动态数据，渲染面包屑</h2><p>有了数据之后，根据数据来去渲染面包屑就比较简单了。</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs vue\">&lt;template&gt;<br>  &lt;el-breadcrumb class=&quot;breadcrumb&quot; separator=&quot;/&quot;&gt;<br>    &lt;el-breadcrumb-item<br>      v-for=&quot;(item, index) in breadcrumbData&quot;<br>      :key=&quot;item.path&quot;<br>    &gt;<br>      &lt;!-- 不可点击项 --&gt;<br>      &lt;span v-if=&quot;index === breadcrumbData.length - 1&quot; class=&quot;no-redirect&quot;&gt;&#123;&#123;<br>        item.meta.title<br>      &#125;&#125;&lt;/span&gt;<br>      &lt;!-- 可点击项 --&gt;<br>      &lt;a v-else class=&quot;redirect&quot; @click.prevent=&quot;onLinkClick(item)&quot;&gt;&#123;&#123;<br>        item.meta.title<br>      &#125;&#125;&lt;/a&gt;<br>    &lt;/el-breadcrumb-item&gt;<br>  &lt;/el-breadcrumb&gt;<br>&lt;/template&gt;<br><br>&lt;script setup&gt;<br>import &#123; ref, watch &#125; from &#x27;vue&#x27;<br>import &#123; useRoute, useRouter, RouteRecordRaw &#125; from &#x27;vue-router&#x27;<br>import &#123; useStore &#125; from &#x27;vuex&#x27;<br><br>const breadcrumbData = ref&lt;RouteRecordRaw[]&gt;([]) // 存放计算出的面包屑数据<br><br>const store = useStore()<br>const route = useRoute()<br>const router = useRouter()<br>const getBreadcrumbData = () =&gt; &#123;<br>  console.log(route.matched)<br><br>  // 只有存在 meta 并且 meta.title 的路由，我们才会显示到面包屑中<br>  // 就像 menu 菜单一样，类似 404 login 的我们不要显示<br>  breadcrumbData.value = route.matched.filter(r =&gt; r.meta &amp;&amp; r.meta.title)<br>&#125;<br><br>watch(<br>  route,<br>  () =&gt; &#123;<br>    getBreadcrumbData()<br>  &#125;,<br>  &#123;<br>    immediate: true<br>  &#125;<br>)<br><br>// 跳转路由<br>const onLinkClick = (item: RouteRecordRaw) =&gt; &#123;<br>  router.push(item.path)<br>&#125;<br><br>// 将来需要进行主题替换，所以这里获取下动态样式<br>const linkHoverColor = ref(store.getters.cssVars.menuBg)<br>&lt;/script&gt;<br><br>&lt;style lang=&quot;scss&quot; scoped&gt;<br>.breadcrumb &#123;<br> ...<br><br>  .redirect &#123;<br>    color: #666;<br>    font-weight: 600;<br>  &#125;<br><br>  .redirect:hover &#123;<br>    color: v-bind(linkHoverColor); // 应对主题切换<br>  &#125;<br>&#125;<br>&lt;/style&gt;<br><br></code></pre></td></tr></table></figure>\n\n<h2 id=\"面包屑动画\"><a href=\"#面包屑动画\" class=\"headerlink\" title=\"面包屑动画\"></a>面包屑动画</h2><p>vue3对 <a href=\"https://v3.cn.vuejs.org/guide/transitions-overview.html#%E5%9F%BA%E4%BA%8E-class-%E7%9A%84%E5%8A%A8%E7%94%BB%E5%92%8C%E8%BF%87%E6%B8%A1\">动画</a> 进行了一些修改（<a href=\"https://v3.cn.vuejs.org/guide/migration/transition.html#%E6%A6%82%E8%A7%88\">vue 动画迁移文档</a>）</p>\n<p>主要的修改其实只有两个：</p>\n<ol>\n<li>过渡类名 <code>v-enter</code> 修改为 <code>v-enter-from</code></li>\n<li>过渡类名 <code>v-leave</code> 修改为 <code>v-leave-from</code></li>\n</ol>\n<p>那么依据修改之后的动画，我们来为面包屑增加一些动画样式：</p>\n<ol>\n<li>在 <code>Breadcrumb/index</code> 中增加 <code>transition-group</code></li>\n</ol>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\">&lt;template&gt;<br>  <span class=\"language-xml\"><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">el-breadcrumb</span> <span class=\"hljs-attr\">class</span>=<span class=\"hljs-string\">&quot;breadcrumb&quot;</span> <span class=\"hljs-attr\">separator</span>=<span class=\"hljs-string\">&quot;/&quot;</span>&gt;</span></span><br><span class=\"language-xml\">    <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">transition-group</span> <span class=\"hljs-attr\">name</span>=<span class=\"hljs-string\">&quot;breadcrumb&quot;</span>&gt;</span></span><br><span class=\"language-xml\">      ...</span><br><span class=\"language-xml\">    <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">transition-group</span>&gt;</span></span><br><span class=\"language-xml\">  <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">el-breadcrumb</span>&gt;</span></span><br>&lt;/template&gt;<br></code></pre></td></tr></table></figure>\n\n<ol start=\"2\">\n<li>新建 <code>styles/transition</code> 样式文件</li>\n</ol>\n<figure class=\"highlight scss\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs scss\"><span class=\"hljs-selector-class\">.breadcrumb-enter-active</span>,<br><span class=\"hljs-selector-class\">.breadcrumb-leave-active</span> &#123;<br>  <span class=\"hljs-attribute\">transition</span>: all <span class=\"hljs-number\">0.5s</span>;<br>&#125;<br><br><span class=\"hljs-selector-class\">.breadcrumb-enter-from</span>,<br><span class=\"hljs-selector-class\">.breadcrumb-leave-active</span> &#123;<br>  <span class=\"hljs-attribute\">opacity</span>: <span class=\"hljs-number\">0</span>;<br>  <span class=\"hljs-attribute\">transform</span>: translateX(<span class=\"hljs-number\">20px</span>);<br>&#125;<br><br><span class=\"hljs-selector-class\">.breadcrumb-leave-active</span> &#123;<br>  <span class=\"hljs-attribute\">position</span>: absolute;<br>&#125;<br></code></pre></td></tr></table></figure>\n\n<ol start=\"3\">\n<li>在 <code>styles/index</code> 中导入</li>\n</ol>\n<figure class=\"highlight scss\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs scss\"><span class=\"hljs-keyword\">@import</span> <span class=\"hljs-string\">&#x27;./transition.scss&#x27;</span>;<br></code></pre></td></tr></table></figure>\n\n<h1 id=\"总结\"><a href=\"#总结\" class=\"headerlink\" title=\"总结\"></a>总结</h1><p>到这里我们的 layout 整体架构就已经做完了，我们来看看效果吧。</p>\n<p><img src=\"/img/layout-result.png\" alt=\"\"></p>\n","site":{"data":{}},"wordcount":34603,"more":"<h1 id=\"实现-layout-布局\"><a href=\"#实现-layout-布局\" class=\"headerlink\" title=\"实现 layout 布局\"></a>实现 layout 布局</h1><p>首先，我们要改造 <code>layout/index.vue</code>，先定义好结构，然后写样式即可。</p>\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs html\"><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">div</span> <span class=\"hljs-attr\">class</span>=<span class=\"hljs-string\">&quot;app-wrapper&quot;</span>&gt;</span><br>  <span class=\"hljs-comment\">&lt;!-- 左侧 menu --&gt;</span><br>  <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">siderbar</span> <span class=\"hljs-attr\">class</span>=<span class=\"hljs-string\">&quot;sidebar-container&quot;</span>&gt;</span><span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">siderbar</span>&gt;</span><br><br>  <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">div</span> <span class=\"hljs-attr\">class</span>=<span class=\"hljs-string\">&quot;main-container&quot;</span>&gt;</span><br>    <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">div</span> <span class=\"hljs-attr\">class</span>=<span class=\"hljs-string\">&quot;fixed-header&quot;</span>&gt;</span><br>      <span class=\"hljs-comment\">&lt;!-- 顶部 --&gt;</span><br>      <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">nav-bar</span>&gt;</span><span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">nav-bar</span>&gt;</span><br>    <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">div</span>&gt;</span><br><br>    <span class=\"hljs-comment\">&lt;!-- 主要内容 --&gt;</span><br>    <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">app-main</span>&gt;</span><span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">app-main</span>&gt;</span><br>  <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">div</span>&gt;</span><br><span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">div</span>&gt;</span><br></code></pre></td></tr></table></figure>\n\n<p>结构定义好了，我再定义样式以及样式文件。在 <code>src</code> 下创建 <code>styles</code> 文件夹，主要存放 <code>scss</code> 的一些样式文件，其中就包括通用的 <code>reset.scss</code> 文件，处理基础的 html 元素样式。<code>mixin.scss</code> 编写通用的样式表，定义通用的样式变量 <code>variables.scss</code>。</p>\n<figure class=\"highlight scss\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs scss\"><span class=\"hljs-comment\">// styles/index.scss</span><br><br><span class=\"hljs-keyword\">@import</span> <span class=\"hljs-string\">&#x27;./reset.scss&#x27;</span>;<br><span class=\"hljs-keyword\">@import</span> <span class=\"hljs-string\">&#x27;./variables.scss&#x27;</span>;<br><span class=\"hljs-keyword\">@import</span> <span class=\"hljs-string\">&#x27;./mixin.scss&#x27;</span>;<br><span class=\"hljs-keyword\">@import</span> <span class=\"hljs-string\">&#x27;./sidebar.scss&#x27;</span>;<br></code></pre></td></tr></table></figure>\n\n<h2 id=\"scss-的使用技巧\"><a href=\"#scss-的使用技巧\" class=\"headerlink\" title=\"scss 的使用技巧\"></a>scss 的使用技巧</h2><p>这里我们主要看下 <code>mixin.scss</code> 和 <code>variables.scss</code> 的一些技巧和用法：</p>\n<ul>\n<li>mixin.scss</li>\n</ul>\n<figure class=\"highlight css\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs css\"><span class=\"hljs-comment\">/* 清除浮动，在 .vue 文件中使用的时候直接引用即可：@include clearfix; */</span><br><span class=\"hljs-keyword\">@mixin</span> clearfix &#123;<br>  &amp;<span class=\"hljs-selector-pseudo\">:after</span> &#123;<br>    <span class=\"hljs-attribute\">content</span>: <span class=\"hljs-string\">&#x27;&#x27;</span>;<br>    <span class=\"hljs-attribute\">display</span>: table;<br>    <span class=\"hljs-attribute\">clear</span>: both;<br>  &#125;<br>&#125;<br><br><span class=\"hljs-comment\">/* 滚动条的设置 */</span><br><span class=\"hljs-keyword\">@mixin</span> scrollBar &#123;<br>  &amp;::-webkit-scrollbar-track-piece &#123;<br>    <span class=\"hljs-attribute\">background</span>: <span class=\"hljs-number\">#d3dce6</span>;<br>  &#125;<br><br>  &amp;::-webkit-scrollbar &#123;<br>    <span class=\"hljs-attribute\">width</span>: <span class=\"hljs-number\">6px</span>;<br>  &#125;<br><br>  &amp;::-webkit-scrollbar-thumb &#123;<br>    <span class=\"hljs-attribute\">background</span>: <span class=\"hljs-number\">#99a9bf</span>;<br>    <span class=\"hljs-attribute\">border-radius</span>: <span class=\"hljs-number\">20px</span>;<br>  &#125;<br>&#125;<br><br><span class=\"hljs-keyword\">@mixin</span> relative &#123;<br>  <span class=\"hljs-attribute\">position</span>: relative;<br>  <span class=\"hljs-attribute\">width</span>: <span class=\"hljs-number\">100%</span>;<br>  <span class=\"hljs-attribute\">height</span>: <span class=\"hljs-number\">100%</span>;<br>&#125;<br><br><br></code></pre></td></tr></table></figure>\n<ul>\n<li>variables.scss</li>\n</ul>\n<figure class=\"highlight scss\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs scss\"><span class=\"hljs-comment\">// sidebar</span><br><span class=\"hljs-variable\">$menuText</span>: <span class=\"hljs-number\">#bfcbd9</span>;<br><span class=\"hljs-variable\">$menuActiveText</span>: <span class=\"hljs-number\">#ffffff</span>;<br><span class=\"hljs-variable\">$subMenuActiveText</span>: <span class=\"hljs-number\">#f4f4f5</span>;<br><br><span class=\"hljs-variable\">$menuBg</span>: <span class=\"hljs-number\">#304156</span>;<br><span class=\"hljs-variable\">$menuHover</span>: <span class=\"hljs-number\">#263445</span>;<br><br><span class=\"hljs-variable\">$subMenuBg</span>: <span class=\"hljs-number\">#1f2d3d</span>;<br><span class=\"hljs-variable\">$subMenuHover</span>: <span class=\"hljs-number\">#001528</span>;<br><br><span class=\"hljs-variable\">$sideBarWidth</span>: <span class=\"hljs-number\">210px</span>;<br><span class=\"hljs-variable\">$hideSideBarWidth</span>: <span class=\"hljs-number\">54px</span>;<br><span class=\"hljs-variable\">$sideBarDuration</span>: <span class=\"hljs-number\">0.28s</span>;<br><br><span class=\"hljs-comment\">// https://www.bluematador.com/blog/how-to-share-variables-between-js-and-sass</span><br><span class=\"hljs-comment\">// JS 与 scss 共享变量，在 scss 中通过 :export 进行导出，在 js 中可通过 ESM 进行导入</span><br>:export &#123;<br>  menuText: <span class=\"hljs-variable\">$menuText</span>;<br>  menuActiveText: <span class=\"hljs-variable\">$menuActiveText</span>;<br>  subMenuActiveText: <span class=\"hljs-variable\">$subMenuActiveText</span>;<br>  menuBg: <span class=\"hljs-variable\">$menuBg</span>;<br>  menuHover: <span class=\"hljs-variable\">$menuHover</span>;<br>  subMenuBg: <span class=\"hljs-variable\">$subMenuBg</span>;<br>  subMenuHover: <span class=\"hljs-variable\">$subMenuHover</span>;<br>  sideBarWidth: <span class=\"hljs-variable\">$sideBarWidth</span>;<br>&#125;<br><br></code></pre></td></tr></table></figure>\n\n<p>关于 <code>:export</code> 的使用方式，我们可以查阅一些文档：</p>\n<blockquote>\n<p><a href=\"https://www.bluematador.com/blog/how-to-share-variables-between-js-and-sass\">https://www.bluematador.com/blog/how-to-share-variables-between-js-and-sass</a></p>\n</blockquote>\n<h2 id=\"编写-layout-index-vue-样式\"><a href=\"#编写-layout-index-vue-样式\" class=\"headerlink\" title=\"编写 layout/index.vue 样式\"></a>编写 <code>layout/index.vue</code> 样式</h2><figure class=\"highlight scss\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs scss\">&lt;style lang=&quot;scss&quot; scoped&gt;<br><span class=\"hljs-keyword\">@import</span> <span class=\"hljs-string\">&#x27;~@/styles/mixin.scss&#x27;</span>;<br><span class=\"hljs-keyword\">@import</span> <span class=\"hljs-string\">&#x27;~@/styles/variables.scss&#x27;</span>;<br><br><span class=\"hljs-selector-class\">.app-wrapper</span> &#123;<br>  <span class=\"hljs-keyword\">@include</span> clearfix; <span class=\"hljs-comment\">// 使用 mixin 中的样式</span><br>  <span class=\"hljs-attribute\">position</span>: relative;<br>  <span class=\"hljs-attribute\">height</span>: <span class=\"hljs-number\">100%</span>;<br>  <span class=\"hljs-attribute\">width</span>: <span class=\"hljs-number\">100%</span>;<br>&#125;<br><br><span class=\"hljs-selector-class\">.fixed-header</span> &#123;<br>  <span class=\"hljs-attribute\">position</span>: fixed;<br>  <span class=\"hljs-attribute\">top</span>: <span class=\"hljs-number\">0</span>;<br>  <span class=\"hljs-attribute\">right</span>: <span class=\"hljs-number\">0</span>;<br>  <span class=\"hljs-attribute\">z-index</span>: <span class=\"hljs-number\">9</span>;<br>  <span class=\"hljs-attribute\">width</span>: calc(<span class=\"hljs-number\">100%</span> - #&#123;<span class=\"hljs-variable\">$sideBarWidth</span>&#125;);<br>&#125;<br>&lt;/style&gt;<br></code></pre></td></tr></table></figure>\n\n<h2 id=\"给-SideBar-赋予动态的背景色\"><a href=\"#给-SideBar-赋予动态的背景色\" class=\"headerlink\" title=\"给 SideBar 赋予动态的背景色\"></a>给 SideBar 赋予动态的背景色</h2><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\">&lt;template&gt;<br>...<br>  &lt;!-- 左侧 menu --&gt;<br>  <span class=\"language-xml\"><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">sidebar</span></span></span><br><span class=\"hljs-tag\"><span class=\"language-xml\">    <span class=\"hljs-attr\">class</span>=<span class=\"hljs-string\">&quot;sidebar-container&quot;</span></span></span><br><span class=\"hljs-tag\"><span class=\"language-xml\">    <span class=\"hljs-attr\">:style</span>=<span class=\"hljs-string\">&quot;&#123; backgroundColor: variables.menuBg &#125;&quot;</span></span></span><br><span class=\"hljs-tag\"><span class=\"language-xml\">  /&gt;</span></span><br>...<br>&lt;/template&gt;<br><br><span class=\"language-xml\"><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">script</span> <span class=\"hljs-attr\">setup</span>&gt;</span><span class=\"language-javascript\"></span></span><br><span class=\"language-javascript\"><span class=\"language-xml\"><span class=\"hljs-comment\">// scss 通过 :export 导出了变量</span></span></span><br><span class=\"language-javascript\"><span class=\"language-xml\"><span class=\"hljs-keyword\">import</span> variables <span class=\"hljs-keyword\">from</span> <span class=\"hljs-string\">&#x27;@/styles/variables.scss&#x27;</span></span></span><br><span class=\"language-javascript\"><span class=\"language-xml\"></span><span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">script</span>&gt;</span></span><br></code></pre></td></tr></table></figure>\n\n<h2 id=\"script导入scss文件报错\"><a href=\"#script导入scss文件报错\" class=\"headerlink\" title=\"script导入scss文件报错\"></a>script导入scss文件报错</h2><p>在 vue 项目里引用.scss文件，vscode编辑器会有红色波浪线，提示找不到模块</p>\n<p><img src=\"/img/import-scss-error.png\" alt=\"\"></p>\n<p>找到 <code>shims-vue.d.ts</code> 声明文件，添加如下代码:</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\">declare <span class=\"hljs-variable language_\">module</span> <span class=\"hljs-string\">&#x27;*.scss&#x27;</span> &#123;<br>  <span class=\"hljs-keyword\">const</span> <span class=\"hljs-attr\">css</span>: &#123;<br>    <span class=\"hljs-comment\">// 定义的变量，通过 `variables.menuBg` 取值时，就不会报错了</span><br>    <span class=\"hljs-attr\">menuBg</span>: string;<br>  &#125;<br>  <span class=\"hljs-keyword\">export</span> <span class=\"hljs-keyword\">default</span> css<br>&#125;<br></code></pre></td></tr></table></figure>\n\n<p>将来，新增了新的样式变量，我们在 css 下添加即可。</p>\n<h2 id=\"设置NavBar样式和头像布局\"><a href=\"#设置NavBar样式和头像布局\" class=\"headerlink\" title=\"设置NavBar样式和头像布局\"></a>设置NavBar样式和头像布局</h2><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\">&lt;template&gt;<br>  <span class=\"language-xml\"><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">div</span> <span class=\"hljs-attr\">class</span>=<span class=\"hljs-string\">&quot;navbar&quot;</span>&gt;</span></span><br><span class=\"language-xml\">    <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">div</span> <span class=\"hljs-attr\">class</span>=<span class=\"hljs-string\">&quot;right-menu&quot;</span>&gt;</span></span><br><span class=\"language-xml\">      <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">el-dropdown</span> <span class=\"hljs-attr\">class</span>=<span class=\"hljs-string\">&quot;avatar-container&quot;</span> <span class=\"hljs-attr\">trigger</span>=<span class=\"hljs-string\">&quot;click&quot;</span>&gt;</span></span><br><span class=\"language-xml\">        <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">div</span> <span class=\"hljs-attr\">class</span>=<span class=\"hljs-string\">&quot;avatar-wrapper&quot;</span>&gt;</span></span><br><span class=\"language-xml\">          <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">el-avatar</span></span></span><br><span class=\"hljs-tag\"><span class=\"language-xml\">            <span class=\"hljs-attr\">shape</span>=<span class=\"hljs-string\">&quot;square&quot;</span></span></span><br><span class=\"hljs-tag\"><span class=\"language-xml\">            <span class=\"hljs-attr\">:size</span>=<span class=\"hljs-string\">&quot;40&quot;</span></span></span><br><span class=\"hljs-tag\"><span class=\"language-xml\">            <span class=\"hljs-attr\">:src</span>=<span class=\"hljs-string\">&quot;&#x27;https://fuss10.elemecdn.com/e/5d/4a731a90594a4af544c0c25941171jpeg.jpeg&#x27;&quot;</span></span></span><br><span class=\"hljs-tag\"><span class=\"language-xml\">          &gt;</span><span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">el-avatar</span>&gt;</span></span><br><span class=\"language-xml\">          <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">el-icon</span>&gt;</span><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">Tools</span> /&gt;</span><span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">el-icon</span>&gt;</span></span><br><span class=\"language-xml\">        <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">div</span>&gt;</span></span><br><span class=\"language-xml\">        <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">template</span> #<span class=\"hljs-attr\">dropdown</span>&gt;</span></span><br><span class=\"language-xml\">          <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">el-dropdown-menu</span> <span class=\"hljs-attr\">class</span>=<span class=\"hljs-string\">&quot;user-dropdown&quot;</span>&gt;</span></span><br><span class=\"language-xml\">            <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">router-link</span> <span class=\"hljs-attr\">to</span>=<span class=\"hljs-string\">&quot;/&quot;</span>&gt;</span></span><br><span class=\"language-xml\">              <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">el-dropdown-item</span>&gt;</span> 主页 <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">el-dropdown-item</span>&gt;</span></span><br><span class=\"language-xml\">            <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">router-link</span>&gt;</span></span><br><span class=\"language-xml\">            <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">a</span> <span class=\"hljs-attr\">target</span>=<span class=\"hljs-string\">&quot;_blank&quot;</span> <span class=\"hljs-attr\">href</span>=<span class=\"hljs-string\">&quot;&quot;</span>&gt;</span></span><br><span class=\"language-xml\">              <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">el-dropdown-item</span>&gt;</span>Vue3<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">el-dropdown-item</span>&gt;</span></span><br><span class=\"language-xml\">            <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">a</span>&gt;</span></span><br><span class=\"language-xml\">            <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">el-dropdown-item</span> <span class=\"hljs-attr\">divided</span>&gt;</span> 退出 <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">el-dropdown-item</span>&gt;</span></span><br><span class=\"language-xml\">          <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">el-dropdown-menu</span>&gt;</span></span><br><span class=\"language-xml\">        <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">template</span>&gt;</span></span><br><span class=\"language-xml\">      <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">el-dropdown</span>&gt;</span></span><br><span class=\"language-xml\">    <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">div</span>&gt;</span></span><br><span class=\"language-xml\">  <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">div</span>&gt;</span></span><br>&lt;/template&gt;<br><br><span class=\"language-xml\"><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">script</span> <span class=\"hljs-attr\">setup</span> <span class=\"hljs-attr\">lang</span>=<span class=\"hljs-string\">&quot;ts&quot;</span>&gt;</span><span class=\"language-javascript\"></span></span><br><span class=\"language-javascript\"><span class=\"language-xml\"><span class=\"hljs-keyword\">import</span> &#123; ref, reactive &#125; <span class=\"hljs-keyword\">from</span> <span class=\"hljs-string\">&#x27;vue&#x27;</span></span></span><br><span class=\"language-javascript\"><span class=\"language-xml\"><span class=\"hljs-keyword\">import</span> &#123; <span class=\"hljs-title class_\">Tools</span> &#125; <span class=\"hljs-keyword\">from</span> <span class=\"hljs-string\">&#x27;@element-plus/icons-vue&#x27;</span></span></span><br><span class=\"language-javascript\"><span class=\"language-xml\"></span><span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">script</span>&gt;</span></span><br><span class=\"language-xml\"><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">style</span> <span class=\"hljs-attr\">scoped</span> <span class=\"hljs-attr\">lang</span>=<span class=\"hljs-string\">&quot;scss&quot;</span>&gt;</span><span class=\"language-css\"></span></span><br><span class=\"language-css\"><span class=\"language-xml\"><span class=\"hljs-selector-class\">.navbar</span> &#123;</span></span><br><span class=\"language-css\"><span class=\"language-xml\">  <span class=\"hljs-attribute\">height</span>: <span class=\"hljs-number\">50px</span>;</span></span><br><span class=\"language-css\"><span class=\"language-xml\">  <span class=\"hljs-attribute\">overflow</span>: hidden;</span></span><br><span class=\"language-css\"><span class=\"language-xml\">  <span class=\"hljs-attribute\">position</span>: relative;</span></span><br><span class=\"language-css\"><span class=\"language-xml\">  <span class=\"hljs-attribute\">background</span>: <span class=\"hljs-number\">#fff</span>;</span></span><br><span class=\"language-css\"><span class=\"language-xml\">  <span class=\"hljs-attribute\">box-shadow</span>: <span class=\"hljs-number\">0</span> <span class=\"hljs-number\">1px</span> <span class=\"hljs-number\">4px</span> <span class=\"hljs-built_in\">rgba</span>(<span class=\"hljs-number\">0</span>, <span class=\"hljs-number\">21</span>, <span class=\"hljs-number\">41</span>, <span class=\"hljs-number\">0.08</span>);</span></span><br><span class=\"language-css\"><span class=\"language-xml\"></span></span><br><span class=\"language-css\"><span class=\"language-xml\">  <span class=\"hljs-selector-class\">.right-menu</span> &#123;</span></span><br><span class=\"language-css\"><span class=\"language-xml\">    <span class=\"hljs-attribute\">display</span>: flex;</span></span><br><span class=\"language-css\"><span class=\"language-xml\">    <span class=\"hljs-attribute\">align-items</span>: center;</span></span><br><span class=\"language-css\"><span class=\"language-xml\">    <span class=\"hljs-attribute\">float</span>: right;</span></span><br><span class=\"language-css\"><span class=\"language-xml\">    <span class=\"hljs-attribute\">padding-right</span>: <span class=\"hljs-number\">16px</span>;</span></span><br><span class=\"language-css\"><span class=\"language-xml\"></span></span><br><span class=\"language-css\"><span class=\"language-xml\">    ::v-deep .right-menu-item &#123;</span></span><br><span class=\"language-css\"><span class=\"language-xml\">      <span class=\"hljs-attribute\">display</span>: inline-block;</span></span><br><span class=\"language-css\"><span class=\"language-xml\">      <span class=\"hljs-attribute\">padding</span>: <span class=\"hljs-number\">0</span> <span class=\"hljs-number\">18px</span> <span class=\"hljs-number\">0</span> <span class=\"hljs-number\">0</span>;</span></span><br><span class=\"language-css\"><span class=\"language-xml\">      <span class=\"hljs-attribute\">font-size</span>: <span class=\"hljs-number\">24px</span>;</span></span><br><span class=\"language-css\"><span class=\"language-xml\">      <span class=\"hljs-attribute\">color</span>: <span class=\"hljs-number\">#5a5e66</span>;</span></span><br><span class=\"language-css\"><span class=\"language-xml\">      <span class=\"hljs-attribute\">vertical-align</span>: text-bottom;</span></span><br><span class=\"language-css\"><span class=\"language-xml\"></span></span><br><span class=\"language-css\"><span class=\"language-xml\">      &amp;<span class=\"hljs-selector-class\">.hover-effect</span> &#123;</span></span><br><span class=\"language-css\"><span class=\"language-xml\">        <span class=\"hljs-attribute\">cursor</span>: pointer;</span></span><br><span class=\"language-css\"><span class=\"language-xml\">        <span class=\"hljs-attribute\">transition</span>: background <span class=\"hljs-number\">0.3s</span>;</span></span><br><span class=\"language-css\"><span class=\"language-xml\"></span></span><br><span class=\"language-css\"><span class=\"language-xml\">        &amp;<span class=\"hljs-selector-pseudo\">:hover</span> &#123;</span></span><br><span class=\"language-css\"><span class=\"language-xml\">          <span class=\"hljs-attribute\">background</span>: <span class=\"hljs-built_in\">rgba</span>(<span class=\"hljs-number\">0</span>, <span class=\"hljs-number\">0</span>, <span class=\"hljs-number\">0</span>, <span class=\"hljs-number\">0.025</span>);</span></span><br><span class=\"language-css\"><span class=\"language-xml\">        &#125;</span></span><br><span class=\"language-css\"><span class=\"language-xml\">      &#125;</span></span><br><span class=\"language-css\"><span class=\"language-xml\">    &#125;</span></span><br><span class=\"language-css\"><span class=\"language-xml\"></span></span><br><span class=\"language-css\"><span class=\"language-xml\">    ::v-deep .avatar-container &#123;</span></span><br><span class=\"language-css\"><span class=\"language-xml\">      <span class=\"hljs-attribute\">cursor</span>: pointer;</span></span><br><span class=\"language-css\"><span class=\"language-xml\">      <span class=\"hljs-selector-class\">.avatar-wrapper</span> &#123;</span></span><br><span class=\"language-css\"><span class=\"language-xml\">        <span class=\"hljs-attribute\">margin-top</span>: <span class=\"hljs-number\">5px</span>;</span></span><br><span class=\"language-css\"><span class=\"language-xml\">        <span class=\"hljs-attribute\">position</span>: relative;</span></span><br><span class=\"language-css\"><span class=\"language-xml\">        <span class=\"hljs-selector-class\">.el-avatar</span> &#123;</span></span><br><span class=\"language-css\"><span class=\"language-xml\">          <span class=\"hljs-attr\">--el-avatar-background-color</span>: none;</span></span><br><span class=\"language-css\"><span class=\"language-xml\">          <span class=\"hljs-attribute\">margin-right</span>: <span class=\"hljs-number\">12px</span>;</span></span><br><span class=\"language-css\"><span class=\"language-xml\">        &#125;</span></span><br><span class=\"language-css\"><span class=\"language-xml\">      &#125;</span></span><br><span class=\"language-css\"><span class=\"language-xml\">    &#125;</span></span><br><span class=\"language-css\"><span class=\"language-xml\">  &#125;</span></span><br><span class=\"language-css\"><span class=\"language-xml\">&#125;</span></span><br><span class=\"language-css\"><span class=\"language-xml\"></span><span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">style</span>&gt;</span></span><br></code></pre></td></tr></table></figure>\n\n<h2 id=\"效果图\"><a href=\"#效果图\" class=\"headerlink\" title=\"效果图\"></a>效果图</h2><p><img src=\"/img/layout-base.png\" alt=\"\"></p>\n<h1 id=\"获取用户信息\"><a href=\"#获取用户信息\" class=\"headerlink\" title=\"获取用户信息\"></a>获取用户信息</h1><p>到目前为止，头像是静态的，也没有实现登出的逻辑，现在来实现一下。</p>\n<h2 id=\"设置请求头\"><a href=\"#设置请求头\" class=\"headerlink\" title=\"设置请求头\"></a>设置请求头</h2><p>我们不希望每次调接口时，都去设置 <code>token</code>，那么我们可以在 <code>请求拦截器</code> 中去设置:</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\">service.<span class=\"hljs-property\">interceptors</span>.<span class=\"hljs-property\">request</span>.<span class=\"hljs-title function_\">use</span>(<br>  <span class=\"hljs-function\"><span class=\"hljs-params\">config</span> =&gt;</span> &#123;<br>    <span class=\"hljs-keyword\">if</span> (store.<span class=\"hljs-property\">getters</span>.<span class=\"hljs-property\">token</span>) &#123;<br>      config.<span class=\"hljs-property\">headers</span>.<span class=\"hljs-property\">Authorization</span> = <span class=\"hljs-string\">`Baerer <span class=\"hljs-subst\">$&#123;store.getters.token&#125;</span>`</span><br>    &#125;<br><br>    <span class=\"hljs-keyword\">return</span> config<br>  &#125;,<br>  <span class=\"hljs-function\"><span class=\"hljs-params\">error</span> =&gt;</span> &#123;<br>    <span class=\"hljs-keyword\">return</span> <span class=\"hljs-title class_\">Promise</span>.<span class=\"hljs-title function_\">reject</span>(error)<br>  &#125;<br>)<br></code></pre></td></tr></table></figure>\n\n<h2 id=\"编写-userInfo-接口\"><a href=\"#编写-userInfo-接口\" class=\"headerlink\" title=\"编写 userInfo 接口\"></a>编写 userInfo 接口</h2><p>简单实现一下 <code>/userinfo</code> 接口，主要是模拟前后端联调的流程。</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\"><span class=\"hljs-keyword\">const</span> express = <span class=\"hljs-built_in\">require</span>(<span class=\"hljs-string\">&#x27;express&#x27;</span>);<br><span class=\"hljs-keyword\">const</span> app = <span class=\"hljs-title function_\">express</span>()<br><br>app.<span class=\"hljs-title function_\">get</span>(<span class=\"hljs-string\">&#x27;/userinfo&#x27;</span>, <span class=\"hljs-function\">(<span class=\"hljs-params\">req, res</span>) =&gt;</span> &#123;<br>  <span class=\"hljs-comment\">// 存在 token，可以返回用户信息</span><br>  <span class=\"hljs-keyword\">if</span> (req.<span class=\"hljs-property\">headers</span>[<span class=\"hljs-string\">&#x27;authorization&#x27;</span>]) &#123;<br><br>    res.<span class=\"hljs-title function_\">json</span>(&#123;<br>      <span class=\"hljs-attr\">code</span>: <span class=\"hljs-number\">0</span>,<br>      <span class=\"hljs-attr\">data</span>: &#123;<br>        <span class=\"hljs-attr\">avatar</span>: <span class=\"hljs-string\">&#x27;https://fuss10.elemecdn.com/e/5d/4a731a90594a4af544c0c25941171jpeg.jpeg&#x27;</span>,<br>        <span class=\"hljs-attr\">name</span>: <span class=\"hljs-string\">&#x27;Hello_AlexCc&#x27;</span>,<br>        <span class=\"hljs-attr\">id</span>: <span class=\"hljs-number\">1</span>,<br>        <span class=\"hljs-attr\">role</span>: <span class=\"hljs-string\">&#x27;super_admin&#x27;</span><br>      &#125;,<br>      <span class=\"hljs-attr\">message</span>: <span class=\"hljs-string\">&#x27;获取用户信息成功&#x27;</span>,<br>      <span class=\"hljs-attr\">success</span>: <span class=\"hljs-literal\">true</span>,<br>    &#125;)<br>  &#125;<br>&#125;)<br><br>app.<span class=\"hljs-title function_\">listen</span>(<span class=\"hljs-number\">9999</span>, <span class=\"hljs-function\">() =&gt;</span> &#123;<br>  <span class=\"hljs-variable language_\">console</span>.<span class=\"hljs-title function_\">log</span>(<span class=\"hljs-string\">&#x27;server site an port 9999 ...&#x27;</span>)<br>&#125;)<br></code></pre></td></tr></table></figure>\n\n<h2 id=\"调用-userInfo-接口时机\"><a href=\"#调用-userInfo-接口时机\" class=\"headerlink\" title=\"调用 userInfo 接口时机\"></a>调用 userInfo 接口时机</h2><p>我们的 <code>userInfo</code> 接口已经编写好了，那么我们在什么时候调用呢？</p>\n<p>很显然，我们需要在 <code>permission.ts</code> 中去调用，当用户登录才有 <code>token</code>，也就是说，我们可以在 <code>token</code> 存在时，并且 <code>to.path</code> 不等于 <code>/login</code> 的时候去调用用户信息接口。</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\"><span class=\"hljs-keyword\">if</span> (store.<span class=\"hljs-property\">getters</span>.<span class=\"hljs-property\">token</span>) &#123;<br>  <span class=\"hljs-keyword\">if</span> (to.<span class=\"hljs-property\">path</span> === <span class=\"hljs-string\">&#x27;/login&#x27;</span>) &#123;<br>    <span class=\"hljs-title function_\">next</span>(<span class=\"hljs-string\">&#x27;/&#x27;</span>)<br>  &#125; <span class=\"hljs-keyword\">else</span> &#123;<br>    <span class=\"hljs-comment\">// 调用用户信息接口</span><br>    <span class=\"hljs-keyword\">await</span> store.<span class=\"hljs-title function_\">dispatch</span>(<span class=\"hljs-string\">&#x27;user/getUserInfo&#x27;</span>)<br><br>    <span class=\"hljs-title function_\">next</span>()<br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure>\n\n<p>我们获取用户信息接口的动作，放在了 <code>module user</code> 的 <code>actions</code> 中：</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\"><span class=\"hljs-comment\">// module/user.ts</span><br><br><span class=\"hljs-comment\">// state</span><br><span class=\"hljs-attr\">state</span>: <span class=\"hljs-function\">() =&gt;</span> (&#123;<br>  <span class=\"hljs-attr\">token</span>: <span class=\"hljs-title function_\">getItem</span>(<span class=\"hljs-string\">&#x27;token&#x27;</span>) || <span class=\"hljs-string\">&#x27;&#x27;</span>,<br>  <span class=\"hljs-attr\">userinfo</span>: &#123;&#125;<br>&#125;),<br><br><span class=\"hljs-comment\">// actions</span><br><span class=\"hljs-keyword\">async</span> <span class=\"hljs-title function_\">getUserInfo</span>(<span class=\"hljs-params\">context</span>) &#123;<br>  <span class=\"hljs-keyword\">const</span> info = <span class=\"hljs-keyword\">await</span> <span class=\"hljs-title function_\">getUserInfo</span>()<br>  context.<span class=\"hljs-title function_\">commit</span>(<span class=\"hljs-string\">&#x27;setUserInfo&#x27;</span>, info)<br>  <span class=\"hljs-keyword\">return</span> info<br>&#125;,<br></code></pre></td></tr></table></figure>\n\n<p>方便使用 <code>userInfo</code>，我们可以将其放到 <code>getters</code> 中：</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\"><span class=\"hljs-keyword\">const</span> getters = &#123;<br>  <span class=\"hljs-attr\">token</span>: <span class=\"hljs-function\">(<span class=\"hljs-params\">state</span>) =&gt;</span> state.<span class=\"hljs-property\">user</span>.<span class=\"hljs-property\">token</span>,<br>  <span class=\"hljs-attr\">userInfo</span>: <span class=\"hljs-function\">(<span class=\"hljs-params\">state</span>) =&gt;</span> state.<span class=\"hljs-property\">user</span>.<span class=\"hljs-property\">userinfo</span><br>&#125;<br></code></pre></td></tr></table></figure>\n\n<p>最后，我们就能在 <code>NavBar</code> 使用获取到的用户信息了。</p>\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs html\"><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">el-avatar</span></span><br><span class=\"hljs-tag\">  <span class=\"hljs-attr\">shape</span>=<span class=\"hljs-string\">&quot;square&quot;</span></span><br><span class=\"hljs-tag\">  <span class=\"hljs-attr\">:size</span>=<span class=\"hljs-string\">&quot;40&quot;</span></span><br><span class=\"hljs-tag\">  <span class=\"hljs-attr\">:src</span>=<span class=\"hljs-string\">&quot;$store.getters.userInfo.avatar&quot;</span></span><br><span class=\"hljs-tag\">&gt;</span><span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">el-avatar</span>&gt;</span><br></code></pre></td></tr></table></figure>\n\n<p><strong>避免重复调用 userInfo 接口</strong></p>\n<p>我们发现，每次切换路由时，都会触发路由的前置守卫，从而多次触发 <code>getUserInfo</code> 接口，我们把这个问题解决一下</p>\n<ol>\n<li>在 store 中定义 <code>hasUserInfo</code>，用来判断是否已经有用户信息了，如果有用户信息，我们就不要再触发 <code>getUserInfo</code> 接口了</li>\n</ol>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\"><span class=\"hljs-comment\">// getters.ts</span><br><br><span class=\"hljs-attr\">hasUserInfo</span>: <span class=\"hljs-function\">(<span class=\"hljs-params\">state</span>) =&gt;</span> &#123;<br>  <span class=\"hljs-comment\">// 如果用户信息存在，return true</span><br>  <span class=\"hljs-keyword\">return</span> <span class=\"hljs-title class_\">JSON</span>.<span class=\"hljs-title function_\">stringify</span>(state.<span class=\"hljs-property\">user</span>.<span class=\"hljs-property\">userinfo</span>) !== <span class=\"hljs-string\">&#x27;&#123;&#125;&#x27;</span><br>&#125;<br></code></pre></td></tr></table></figure>\n\n<ol start=\"2\">\n<li>修改 <code>permission.ts</code> 文件，只有 <code>hasUserInfo</code> 为 <code>false</code> 时，我们才调用用户信息接口</li>\n</ol>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\"><span class=\"hljs-keyword\">if</span> (store.<span class=\"hljs-property\">getters</span>.<span class=\"hljs-property\">token</span>) &#123;<br>  <span class=\"hljs-keyword\">if</span> (to.<span class=\"hljs-property\">path</span> === <span class=\"hljs-string\">&#x27;/login&#x27;</span>) &#123;<br>    <span class=\"hljs-title function_\">next</span>(<span class=\"hljs-string\">&#x27;/&#x27;</span>)<br>  &#125; <span class=\"hljs-keyword\">else</span> &#123;<br>    <span class=\"hljs-keyword\">if</span> (!store.<span class=\"hljs-property\">getters</span>.<span class=\"hljs-property\">hasUserInfo</span>) &#123;<br>      <span class=\"hljs-keyword\">await</span> store.<span class=\"hljs-title function_\">dispatch</span>(<span class=\"hljs-string\">&#x27;user/getUserInfo&#x27;</span>)<br>    &#125;<br><br>    <span class=\"hljs-title function_\">next</span>()<br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure>\n\n<h1 id=\"登出逻辑\"><a href=\"#登出逻辑\" class=\"headerlink\" title=\"登出逻辑\"></a>登出逻辑</h1><p>登出分为两种形式：</p>\n<ul>\n<li>用户主动退出</li>\n<li>用户被动登录（token 过去 | 账号被挤）</li>\n</ul>\n<p>不管以何种形式退出，登出的逻辑都是相同的。</p>\n<ul>\n<li>清理掉用户的缓存数据</li>\n<li>清理掉权限相关的配置</li>\n<li>返回到登录页</li>\n</ul>\n<p>登出的逻辑，我们也可以写在 <code>module user</code> 中去处理。</p>\n<p>主要执行 3 个步骤：</p>\n<ul>\n<li>清空 store token</li>\n<li>清除浏览器本地存储</li>\n<li>跳转到 login 页</li>\n</ul>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\"><span class=\"hljs-title function_\">logout</span>(<span class=\"hljs-params\">context: any</span>) &#123;<br>  context.<span class=\"hljs-title function_\">commit</span>(<span class=\"hljs-string\">&#x27;setToken&#x27;</span>, <span class=\"hljs-string\">&#x27;&#x27;</span>)<br>  <span class=\"hljs-title function_\">removeAllItem</span>()<br>  router.<span class=\"hljs-title function_\">push</span>(<span class=\"hljs-string\">&#x27;/login&#x27;</span>)<br>&#125;<br></code></pre></td></tr></table></figure>\n\n<h2 id=\"主动退出\"><a href=\"#主动退出\" class=\"headerlink\" title=\"主动退出\"></a>主动退出</h2><p>用户点击登录按钮，通过 store dispatch 触发 action 的 logout 即可。</p>\n<h2 id=\"被动退出\"><a href=\"#被动退出\" class=\"headerlink\" title=\"被动退出\"></a>被动退出</h2><p>被动退出大概分为两种：</p>\n<ul>\n<li>token 失效</li>\n<li>账号被挤下去</li>\n</ul>\n<p>那么这两种场景下，在前端对应的处理方案一共也分为两种，共分为 主动处理 、被动处理 两种 ：</p>\n<ul>\n<li>主动处理：主要应对 token 失效</li>\n<li>被动处理：同时应对 token 失效 与 单点登录（账号被挤）</li>\n</ul>\n<h3 id=\"用户被动退出解决方案之主动处理\"><a href=\"#用户被动退出解决方案之主动处理\" class=\"headerlink\" title=\"用户被动退出解决方案之主动处理\"></a>用户被动退出解决方案之主动处理</h3><p>为了保证用户的信息安全，那么对于 token 而言就被制定了很多的安全策略，比如：</p>\n<ul>\n<li>动态 token（可变 token）</li>\n<li>刷新 token</li>\n<li>时效 token<br>…</li>\n</ul>\n<p>我们这里采用 <code>时效 token</code>。</p>\n<p>那么对应到我们代码中的实现方案为：</p>\n<ul>\n<li>在用户登陆时，记录当前 登录时间</li>\n<li>制定一个 失效时长</li>\n<li>在接口调用时，根据 <code>当前时间</code> 对比 <code>登录时间</code> ，看是否超过了 <code>时效时长</code><ul>\n<li>如果未超过，则正常进行后续操作</li>\n<li>如果超过，则进行 退出登录 操作</li>\n</ul>\n</li>\n</ul>\n<h3 id=\"代码实现\"><a href=\"#代码实现\" class=\"headerlink\" title=\"代码实现\"></a>代码实现</h3><p>创建 <code>utils/auth.js</code> 文件，并写入以下代码：</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\"><span class=\"hljs-keyword\">import</span> &#123; <span class=\"hljs-variable constant_\">TIME_STAMP</span>, <span class=\"hljs-variable constant_\">TOKEN_TIMEOUT_VALUE</span> &#125; <span class=\"hljs-keyword\">from</span> <span class=\"hljs-string\">&#x27;@/constant&#x27;</span><br><span class=\"hljs-keyword\">import</span> &#123; setItem, getItem &#125; <span class=\"hljs-keyword\">from</span> <span class=\"hljs-string\">&#x27;@/utils/storage&#x27;</span><br><span class=\"hljs-comment\">/**</span><br><span class=\"hljs-comment\"> * 获取时间戳</span><br><span class=\"hljs-comment\"> */</span><br><span class=\"hljs-keyword\">export</span> <span class=\"hljs-keyword\">function</span> <span class=\"hljs-title function_\">getTimeStamp</span>(<span class=\"hljs-params\"></span>) &#123;<br>  <span class=\"hljs-keyword\">return</span> <span class=\"hljs-title function_\">getItem</span>(<span class=\"hljs-variable constant_\">TIME_STAMP</span>)<br>&#125;<br><span class=\"hljs-comment\">/**</span><br><span class=\"hljs-comment\"> * 设置时间戳</span><br><span class=\"hljs-comment\"> */</span><br><span class=\"hljs-keyword\">export</span> <span class=\"hljs-keyword\">function</span> <span class=\"hljs-title function_\">setTimeStamp</span>(<span class=\"hljs-params\"></span>) &#123;<br>  <span class=\"hljs-title function_\">setItem</span>(<span class=\"hljs-variable constant_\">TIME_STAMP</span>, <span class=\"hljs-title class_\">Date</span>.<span class=\"hljs-title function_\">now</span>())<br>&#125;<br><span class=\"hljs-comment\">/**</span><br><span class=\"hljs-comment\"> * 是否超时</span><br><span class=\"hljs-comment\"> */</span><br><span class=\"hljs-keyword\">export</span> <span class=\"hljs-keyword\">function</span> <span class=\"hljs-title function_\">isCheckTimeout</span>(<span class=\"hljs-params\"></span>) &#123;<br>  <span class=\"hljs-comment\">// 当前时间戳</span><br>  <span class=\"hljs-keyword\">var</span> currentTime = <span class=\"hljs-title class_\">Date</span>.<span class=\"hljs-title function_\">now</span>()<br>  <span class=\"hljs-comment\">// 缓存时间戳</span><br>  <span class=\"hljs-keyword\">var</span> timeStamp = <span class=\"hljs-title function_\">getTimeStamp</span>()<br>  <span class=\"hljs-keyword\">return</span> currentTime - timeStamp &gt; <span class=\"hljs-variable constant_\">TOKEN_TIMEOUT_VALUE</span><br>&#125;<br></code></pre></td></tr></table></figure>\n\n<p>在 <code>constant</code> 中声明对应常量：</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\"><span class=\"hljs-comment\">// token 时间戳</span><br><span class=\"hljs-keyword\">export</span> <span class=\"hljs-keyword\">const</span> <span class=\"hljs-variable constant_\">TIME_STAMP</span> = <span class=\"hljs-string\">&#x27;timeStamp&#x27;</span><br><span class=\"hljs-comment\">// 超时时长(毫秒) 两小时</span><br><span class=\"hljs-keyword\">export</span> <span class=\"hljs-keyword\">const</span> <span class=\"hljs-variable constant_\">TOKEN_TIMEOUT_VALUE</span> = <span class=\"hljs-number\">2</span> * <span class=\"hljs-number\">60</span> * <span class=\"hljs-number\">60</span> * <span class=\"hljs-number\">1000</span><br></code></pre></td></tr></table></figure>\n\n<p>在用户登录成功之后去设置时间，到 <code>store/user.js</code> 的 <code>login</code> 中：</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\"><span class=\"hljs-keyword\">import</span> &#123; setTimeStamp &#125; <span class=\"hljs-keyword\">from</span> <span class=\"hljs-string\">&#x27;@/utils/auth&#x27;</span><br><br><span class=\"hljs-title function_\">login</span>(<span class=\"hljs-params\">context, userInfo</span>) &#123;<br>  ...<br>  <span class=\"hljs-keyword\">return</span> <span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">Promise</span>(<span class=\"hljs-function\">(<span class=\"hljs-params\">resolve, reject</span>) =&gt;</span> &#123;<br>    ...<br>      .<span class=\"hljs-title function_\">then</span>(<span class=\"hljs-function\"><span class=\"hljs-params\">data</span> =&gt;</span> &#123;<br>        ...<br>        <span class=\"hljs-comment\">// 保存登录时间</span><br>        <span class=\"hljs-title function_\">setTimeStamp</span>()<br>        <span class=\"hljs-title function_\">resolve</span>()<br>      &#125;)<br>  &#125;)<br>&#125;,<br></code></pre></td></tr></table></figure>\n\n<p>在 <code>utils/request</code> 对应的请求拦截器中进行 <strong>主动介入</strong></p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\"><span class=\"hljs-keyword\">import</span> &#123; isCheckTimeout &#125; <span class=\"hljs-keyword\">from</span> <span class=\"hljs-string\">&#x27;@/utils/auth&#x27;</span><br><br><span class=\"hljs-keyword\">if</span> (store.<span class=\"hljs-property\">getters</span>.<span class=\"hljs-property\">token</span>) &#123;<br>  <span class=\"hljs-keyword\">if</span> (<span class=\"hljs-title function_\">isCheckTimeout</span>()) &#123;<br>    <span class=\"hljs-comment\">// 登出操作</span><br>    store.<span class=\"hljs-title function_\">dispatch</span>(<span class=\"hljs-string\">&#x27;user/logout&#x27;</span>)<br><br>    <span class=\"hljs-comment\">// 失败的话，会走到 interceptors.response 的 error 方法。</span><br>    <span class=\"hljs-keyword\">return</span> <span class=\"hljs-title class_\">Promise</span>.<span class=\"hljs-title function_\">reject</span>(<span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">Error</span>(<span class=\"hljs-string\">&#x27;token 失效&#x27;</span>))<br>  &#125;<br>  ...<br>&#125;<br></code></pre></td></tr></table></figure>\n\n<p>那么至此我们就完成了 <strong>主动处理</strong> 对应的业务逻辑。</p>\n<h3 id=\"用户被动退出解决方案之被动处理\"><a href=\"#用户被动退出解决方案之被动处理\" class=\"headerlink\" title=\"用户被动退出解决方案之被动处理\"></a>用户被动退出解决方案之被动处理</h3><p><strong>背景：</strong></p>\n<p>首先我们需要先明确 <strong>被动处理</strong> 需要应对两种业务场景：</p>\n<ol>\n<li><code>token</code> 过期</li>\n<li>单点登录</li>\n</ol>\n<p>然后我们一个一个来去看，首先是 <code>token</code> 过期</p>\n<blockquote>\n<p>我们知道对于 <code>token</code> 而言，本身就是具备时效的，这个是在服务端生成 <code>token</code> 时就已经确定的。</p>\n<p>而此时我们所谓的 <code>token</code> 过期指的就是：</p>\n<p><strong>服务端生成的 <code>token</code> 超过 服务端指定时效</strong> 的过程，就像我们前端项目指定 token 的失效性一样。</p>\n</blockquote>\n<p>而对于 单点登录 而言，指的是： </p>\n<blockquote>\n<p>当用户 A 登录之后，<code>token</code> 过期之前。</p>\n<p> 用户 A 的账号在其他的设备中进行了二次登录，导致第一次登录的 A 账号被 “顶下来” 的过程。</p>\n<p>即：<strong>同一账户仅可以在一个设备中保持在线状态</strong></p>\n</blockquote>\n<p>那么明确好了对应的背景之后，接下来我们来看对应的业务处理场景：</p>\n<p>从背景中我们知道，以上的两种情况，都是在 <strong>服务端进行判断的</strong>，而对于前端而言其实是 <strong>服务端通知前端的一个过程。</strong></p>\n<p>所以说对于其业务处理，将遵循以下逻辑：</p>\n<ol>\n<li>服务端返回数据时，会通过特定的状态码通知前端</li>\n<li>当前端接收到特定状态码时，表示遇到了特定状态：<strong><code>token</code> 时效</strong> 或 <strong>单点登录</strong></li>\n<li>此时进行 <strong>退出登录</strong> 处理</li>\n</ol>\n<p>这里只做了 token 的过期处理，如果需要到 <strong>单点登录</strong> 时，只需要增加一个状态码判断即可。</p>\n<p><strong>服务端超时间逻辑</strong><br>我们来简单实现一下后端的超时逻辑。</p>\n<p>我们通过 <code>app.use</code> 添加了一个中间件，每一次前端触发了接口请求，都会先走这个中间件逻辑。</p>\n<p>服务器启动时，我们把 <code>now</code> 和 <code>current</code> 设置当前时间戳，当有一个接口触发了，会将 <code>current</code> 设置新的时间戳。</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\"><span class=\"hljs-keyword\">const</span> express = <span class=\"hljs-built_in\">require</span>(<span class=\"hljs-string\">&#x27;express&#x27;</span>);<br><span class=\"hljs-keyword\">const</span> app = <span class=\"hljs-title function_\">express</span>()<br><br><span class=\"hljs-comment\">// token 超时 2h</span><br><span class=\"hljs-keyword\">const</span> <span class=\"hljs-variable constant_\">TOKEN_TIMEOUT_VALUE</span> = <span class=\"hljs-number\">2</span> * <span class=\"hljs-number\">60</span> * <span class=\"hljs-number\">60</span> * <span class=\"hljs-number\">1000</span><br><span class=\"hljs-keyword\">let</span> now = <span class=\"hljs-title class_\">Date</span>.<span class=\"hljs-title function_\">now</span>()<br><span class=\"hljs-keyword\">let</span> current = <span class=\"hljs-title class_\">Date</span>.<span class=\"hljs-title function_\">now</span>()<br><br>app.<span class=\"hljs-title function_\">use</span>(<span class=\"hljs-keyword\">function</span>(<span class=\"hljs-params\">req, res, next</span>) &#123;<br>  <span class=\"hljs-comment\">// 每次有接口调用，触发中间件，将 current 更新</span><br>  current = <span class=\"hljs-title class_\">Date</span>.<span class=\"hljs-title function_\">now</span>()<br><br>  <span class=\"hljs-comment\">// 如果是登录逻辑，我们将 now 设置为 current，这样就不会触发超时逻辑</span><br>  <span class=\"hljs-comment\">// 重新登录，继续走此判断，将 now 设置为 current</span><br>  <span class=\"hljs-keyword\">if</span> (req.<span class=\"hljs-property\">path</span> === <span class=\"hljs-string\">&#x27;/login&#x27;</span>) &#123;<br>    now = current<br>  &#125;<br><br>  <span class=\"hljs-comment\">// 每次中间件都会将 current 更新为当前时间戳，一旦时间戳的差值，大于了 2h，就会触发 超时逻辑</span><br>  <span class=\"hljs-keyword\">if</span> (current - now &gt; <span class=\"hljs-variable constant_\">TOKEN_TIMEOUT_VALUE</span>) &#123;<br>    <span class=\"hljs-comment\">// 超时</span><br>    res.<span class=\"hljs-title function_\">status</span>(<span class=\"hljs-number\">401</span>).<span class=\"hljs-title function_\">send</span>(&#123;<br>      <span class=\"hljs-attr\">code</span>: <span class=\"hljs-number\">401</span>,<br>      <span class=\"hljs-attr\">message</span>: <span class=\"hljs-string\">&#x27;服务端message: token 失效啦&#x27;</span>,<br>      <span class=\"hljs-attr\">success</span>: <span class=\"hljs-literal\">false</span>,<br>    &#125;)<br>  &#125; <span class=\"hljs-keyword\">else</span> &#123;<br><br>    <span class=\"hljs-comment\">// 没有超时，将执行权交给下一个路由</span><br>    <span class=\"hljs-title function_\">next</span>()<br>  &#125;<br>&#125;)<br></code></pre></td></tr></table></figure>\n\n\n<p><strong>那么明确好了业务之后，接下来我们来实现前端对应代码：</strong></p>\n<p>在 <code>utils/request</code> 的响应拦截器中，增加以下逻辑：</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\"><span class=\"hljs-comment\">// 响应拦截器</span><br>service.<span class=\"hljs-property\">interceptors</span>.<span class=\"hljs-property\">response</span>.<span class=\"hljs-title function_\">use</span>(<br>  <span class=\"hljs-function\"><span class=\"hljs-params\">response</span> =&gt;</span> &#123;<br>    ...<br>  &#125;,<br>  <span class=\"hljs-function\"><span class=\"hljs-params\">error</span> =&gt;</span> &#123;<br>    <span class=\"hljs-comment\">// 处理 token 超时问题</span><br>    <span class=\"hljs-keyword\">if</span> (<br>      error.<span class=\"hljs-property\">response</span> &amp;&amp;<br>      error.<span class=\"hljs-property\">response</span>.<span class=\"hljs-property\">data</span> &amp;&amp;<br>      error.<span class=\"hljs-property\">response</span>.<span class=\"hljs-property\">data</span>.<span class=\"hljs-property\">code</span> === <span class=\"hljs-number\">401</span><br>    ) &#123;<br>      store.<span class=\"hljs-title function_\">dispatch</span>(<span class=\"hljs-string\">&#x27;user/logout&#x27;</span>)<br>    &#125;<br><br>    <span class=\"hljs-keyword\">if</span> (error.<span class=\"hljs-property\">response</span> &amp;&amp; error.<span class=\"hljs-property\">response</span>.<span class=\"hljs-property\">data</span> &amp;&amp; error.<span class=\"hljs-property\">response</span>.<span class=\"hljs-property\">data</span>.<span class=\"hljs-property\">message</span>) &#123;<br>      <span class=\"hljs-title class_\">ElMessage</span>.<span class=\"hljs-title function_\">error</span>(error.<span class=\"hljs-property\">response</span>.<span class=\"hljs-property\">data</span>.<span class=\"hljs-property\">message</span>) <span class=\"hljs-comment\">// 提示服务端抛出的错误信息</span><br>    &#125; <span class=\"hljs-keyword\">else</span> &#123;<br>      <span class=\"hljs-title class_\">ElMessage</span>.<span class=\"hljs-title function_\">error</span>(error.<span class=\"hljs-property\">message</span>)<br>    &#125;<br>    <span class=\"hljs-keyword\">return</span> <span class=\"hljs-title class_\">Promise</span>.<span class=\"hljs-title function_\">reject</span>(error)<br>  &#125;<br>)<br></code></pre></td></tr></table></figure>\n\n<p>那么至此，我们就已经完成了 <strong>整个用户退出</strong> 方案。</p>\n<h1 id=\"Sidebar-动态菜单\"><a href=\"#Sidebar-动态菜单\" class=\"headerlink\" title=\"Sidebar 动态菜单\"></a>Sidebar 动态菜单</h1><p>接下来我们来处理 动态menu菜单。</p>\n<p>临时的 menu 菜单，创建 <code>layout/Sidebar/SidebarMenu</code> 文件</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\">&lt;template&gt;<br>  &lt;!-- 一级 menu 菜单 --&gt;<br>  <span class=\"language-xml\"><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">el-menu</span></span></span><br><span class=\"hljs-tag\"><span class=\"language-xml\">    &#123;/* 只允许一个菜单展开 */&#125;</span></span><br><span class=\"hljs-tag\"><span class=\"language-xml\">    <span class=\"hljs-attr\">:uniqueOpened</span>=<span class=\"hljs-string\">&quot;true&quot;</span></span></span><br><span class=\"hljs-tag\"><span class=\"language-xml\">    <span class=\"hljs-attr\">default-active</span>=<span class=\"hljs-string\">&quot;1&quot;</span></span></span><br><span class=\"hljs-tag\"><span class=\"language-xml\">    <span class=\"hljs-attr\">background-color</span>=<span class=\"hljs-string\">&quot;#545c64&quot;</span></span></span><br><span class=\"hljs-tag\"><span class=\"language-xml\">    <span class=\"hljs-attr\">text-color</span>=<span class=\"hljs-string\">&quot;#fff&quot;</span></span></span><br><span class=\"hljs-tag\"><span class=\"language-xml\">    <span class=\"hljs-attr\">active-text-color</span>=<span class=\"hljs-string\">&quot;#ffd04b&quot;</span></span></span><br><span class=\"hljs-tag\"><span class=\"language-xml\">  &gt;</span></span><br><span class=\"language-xml\">    <span class=\"hljs-comment\">&lt;!-- 子集 menu 菜单 --&gt;</span></span><br><span class=\"language-xml\">    <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">el-sub-menu</span> <span class=\"hljs-attr\">index</span>=<span class=\"hljs-string\">&quot;1&quot;</span>&gt;</span></span><br><span class=\"language-xml\">      <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">template</span> #<span class=\"hljs-attr\">title</span>&gt;</span></span><br><span class=\"language-xml\">        <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">el-icon</span>&gt;</span><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">location</span> /&gt;</span><span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">el-icon</span>&gt;</span></span><br><span class=\"language-xml\">        <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">span</span>&gt;</span>导航一<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">span</span>&gt;</span></span><br><span class=\"language-xml\">      <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">template</span>&gt;</span></span><br><span class=\"language-xml\">      <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">el-menu-item</span> <span class=\"hljs-attr\">index</span>=<span class=\"hljs-string\">&quot;1-1&quot;</span>&gt;</span>选项1<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">el-menu-item</span>&gt;</span></span><br><span class=\"language-xml\">      <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">el-menu-item</span> <span class=\"hljs-attr\">index</span>=<span class=\"hljs-string\">&quot;1-2&quot;</span>&gt;</span>选项2<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">el-menu-item</span>&gt;</span></span><br><span class=\"language-xml\">    <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">el-sub-menu</span>&gt;</span></span><br><span class=\"language-xml\">    <span class=\"hljs-comment\">&lt;!-- 具体菜单项 --&gt;</span></span><br><span class=\"language-xml\">    <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">el-menu-item</span> <span class=\"hljs-attr\">index</span>=<span class=\"hljs-string\">&quot;4&quot;</span>&gt;</span></span><br><span class=\"language-xml\">      <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">el-icon</span>&gt;</span><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">setting</span> /&gt;</span><span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">el-icon</span>&gt;</span></span><br><span class=\"language-xml\">      <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">template</span> #<span class=\"hljs-attr\">title</span>&gt;</span>导航四<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">template</span>&gt;</span></span><br><span class=\"language-xml\">    <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">el-menu-item</span>&gt;</span></span><br><span class=\"language-xml\">  <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">el-menu</span>&gt;</span></span><br>&lt;/template&gt;<br><br><span class=\"language-xml\"><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">script</span> <span class=\"hljs-attr\">setup</span> <span class=\"hljs-attr\">lang</span>=<span class=\"hljs-string\">&quot;ts&quot;</span>&gt;</span><span class=\"language-javascript\"></span></span><br><span class=\"language-javascript\"><span class=\"language-xml\"><span class=\"hljs-keyword\">import</span> &#123; ref, reactive &#125; <span class=\"hljs-keyword\">from</span> <span class=\"hljs-string\">&#x27;vue&#x27;</span></span></span><br><span class=\"language-javascript\"><span class=\"language-xml\"><span class=\"hljs-keyword\">import</span> &#123; <span class=\"hljs-title class_\">Location</span>, <span class=\"hljs-title class_\">Setting</span> &#125; <span class=\"hljs-keyword\">from</span> <span class=\"hljs-string\">&#x27;@element-plus/icons-vue&#x27;</span></span></span><br><span class=\"language-javascript\"><span class=\"language-xml\"></span><span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">script</span>&gt;</span></span><br><span class=\"language-xml\"><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">style</span> <span class=\"hljs-attr\">scoped</span>&gt;</span><span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">style</span>&gt;</span></span><br></code></pre></td></tr></table></figure>\n\n<p>在 <code>layout/Sidebar/index</code> 中导入该组件</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\">&lt;template&gt;<br>  <span class=\"language-xml\"><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">div</span> <span class=\"hljs-attr\">class</span>=<span class=\"hljs-string\">&quot;&quot;</span>&gt;</span></span><br><span class=\"language-xml\">    <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">h1</span>&gt;</span>占位<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">h1</span>&gt;</span></span><br><span class=\"language-xml\">    <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">el-scrollbar</span>&gt;</span></span><br><span class=\"language-xml\">      <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">sidebar-menu</span>&gt;</span><span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">sidebar-menu</span>&gt;</span></span><br><span class=\"language-xml\">    <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">el-scrollbar</span>&gt;</span></span><br><span class=\"language-xml\">  <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">div</span>&gt;</span></span><br>&lt;/template&gt;<br><br><span class=\"language-xml\"><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">script</span> <span class=\"hljs-attr\">setup</span>&gt;</span><span class=\"language-javascript\"></span></span><br><span class=\"language-javascript\"><span class=\"language-xml\"><span class=\"hljs-keyword\">import</span> <span class=\"hljs-title class_\">SidebarMenu</span> <span class=\"hljs-keyword\">from</span> <span class=\"hljs-string\">&#x27;./SidebarMenu&#x27;</span></span></span><br><span class=\"language-javascript\"><span class=\"language-xml\"><span class=\"hljs-keyword\">import</span> &#123;&#125; <span class=\"hljs-keyword\">from</span> <span class=\"hljs-string\">&#x27;vue&#x27;</span></span></span><br><span class=\"language-javascript\"><span class=\"language-xml\"></span><span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">script</span>&gt;</span></span><br></code></pre></td></tr></table></figure>\n\n<p>那么至此我们生成了一个临时的 <code>menu</code> 菜单，从这个临时的 <code>menu</code> 菜单出可以看到，<code>el-menu</code> 其实分成了三个部分：</p>\n<ol>\n<li><code>el-menu</code>：整个 <code>menu</code> 菜单</li>\n<li><code>el-submenu</code>：子集 <code>menu</code> 菜单</li>\n<li><code>el-menu-item</code>：具体菜单项</li>\n</ol>\n<p>那么明确好了这些内容之后，接下来我们就可以来去分析一下 <strong>动态 <code>menu</code> 菜单如何生成了</strong></p>\n<h2 id=\"动态menu菜单处理方案解析\"><a href=\"#动态menu菜单处理方案解析\" class=\"headerlink\" title=\"动态menu菜单处理方案解析\"></a>动态menu菜单处理方案解析</h2><p><strong>动态<code>menu</code>菜单</strong> 其实主要是和 <strong>动态路由表</strong>  配合来去实现 <strong>用户权限</strong> 的。</p>\n<p>但是 <strong>用户权限处理</strong> 目前还未涉及到，因为咱们想要处理 <strong>用户权限</strong> 还需要先去处理很多的业务场景，所以暂时先只处理 <strong>动态<code>menu</code>菜单</strong> 。</p>\n<p>所谓 <strong>动态<code>menu</code>菜单</strong> 指的是：</p>\n<blockquote>\n<p>根据路由表的配置，自动生成对应的 <code>menu</code> 菜单。</p>\n<p>当路由表发生变化时，<code>menu</code> 菜单自动发生变化</p>\n</blockquote>\n<p>那么明确了 <strong>动态<code>menu</code>菜单</strong> 的含义之后，接下来咱们就需要来明确 <strong>动态<code>menu</code>菜单</strong> 的实现方案：</p>\n<ol>\n<li>定义 <strong>路由表</strong> 对应 <strong><code>menu</code> 菜单规则</strong></li>\n<li>根据规则制定 <strong>路由表</strong></li>\n<li>根据规则，依据 <strong>路由表</strong> ，生成 <strong><code>menu</code> 菜单</strong></li>\n</ol>\n<p>那么根据我们的实现方案可以发现，实现 <strong>动态<code>menu</code>菜单</strong> 最核心的关键点其实就在步骤一，也就是 </p>\n<blockquote>\n<p>定义 <strong>路由表</strong> 对应 <strong><code>menu</code> 菜单规则</strong></p>\n</blockquote>\n<p>那么下面我们就来看一下，这个规则如何制定：</p>\n<ol>\n<li>对于单个路由规则而言（循环）：<ol>\n<li>如果存在 <code>meta &amp;&amp; meta.title &amp;&amp; meta.icon</code> ：则显示在 <code>menu</code> 菜单中，其中 <code>title</code> 为显示的内容，<code>icon</code> 为显示的图标<ol>\n<li>如果存在 <code>children</code> ：则以 <code>el-sub-menu（子菜单）</code> 展示</li>\n<li>否则：则以 <code>el-menu-item（菜单项）</code> 展示</li>\n</ol>\n</li>\n<li>否则：不显示在 <code>menu</code> 菜单中</li>\n</ol>\n</li>\n</ol>\n<p>那么明确好了对应的规则之后，接下来我们就可以来去看一下如何进行实现啦！</p>\n<h2 id=\"生成项目页面组件\"><a href=\"#生成项目页面组件\" class=\"headerlink\" title=\"生成项目页面组件\"></a>生成项目页面组件</h2><p>明确了对应的方案之后，那么下面咱们就来实现对应的代码逻辑。</p>\n<p>根据我们的分析，想要完成动态的 <code>menu</code>，那么我们需要按照以下的步骤来去实现：</p>\n<ol>\n<li>创建页面组件</li>\n<li>生成路由表</li>\n<li>解析路由表</li>\n<li>生成 <code>menu</code> 菜单</li>\n</ol>\n<p>那么明确好了步骤之后，接下来我们就先来实现第一步</p>\n<p><strong>创建页面组件</strong></p>\n<p>在 <code>views</code> 文件夹下，创建如下页面：</p>\n<ol>\n<li>创建文章：<code>article-create</code></li>\n<li>文章详情：<code>article-detail</code></li>\n<li>文章排名：<code>article-ranking</code></li>\n<li>错误页面：<code>error-page</code><ol>\n<li><code>404</code></li>\n<li><code>401</code></li>\n</ol>\n</li>\n<li>导入：<code>import</code></li>\n<li>权限列表：<code>permission-list</code></li>\n<li>个人中心：<code>profile</code></li>\n<li>角色列表：<code>role-list</code></li>\n<li>用户信息：<code>user-info</code></li>\n<li>用户管理：<code>user-manage</code></li>\n</ol>\n<h2 id=\"创建结构路由表\"><a href=\"#创建结构路由表\" class=\"headerlink\" title=\"创建结构路由表\"></a>创建结构路由表</h2><p>想要实现结构路由表，那么我们需要先知道最终我们要实现的结构是什么样子的，大家来看下面的截图：</p>\n<img src=\"/img/menu.png\" />\n\n<p>这是我们最终要实现的 <code>menu</code> 截图。</p>\n<p>根据此截图，我们可以知道两点内容：</p>\n<ol>\n<li><p>我们创建的页面并没有全部进行展示</p>\n<ol>\n<li>不显示页面表示 <strong>不满足</strong> 该条件 <code>meta &amp;&amp; meta.title &amp;&amp; meta.icon</code></li>\n</ol>\n</li>\n<li><p><code>menu</code> 菜单将具备父子级的结构</p>\n<ol>\n<li>按照此结构规划数据，则数据应为<figure class=\"highlight json\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs json\"><span class=\"hljs-punctuation\">[</span><br>    <span class=\"hljs-punctuation\">&#123;</span><br>        <span class=\"hljs-attr\">&quot;title&quot;</span><span class=\"hljs-punctuation\">:</span> <span class=\"hljs-string\">&quot;个人中心&quot;</span><span class=\"hljs-punctuation\">,</span><br>        <span class=\"hljs-attr\">&quot;path&quot;</span><span class=\"hljs-punctuation\">:</span> <span class=\"hljs-string\">&quot;&quot;</span><br>    <span class=\"hljs-punctuation\">&#125;</span><span class=\"hljs-punctuation\">,</span><br>    <span class=\"hljs-punctuation\">&#123;</span><br>        <span class=\"hljs-attr\">&quot;title&quot;</span><span class=\"hljs-punctuation\">:</span> <span class=\"hljs-string\">&quot;用户&quot;</span><span class=\"hljs-punctuation\">,</span><br>        <span class=\"hljs-attr\">&quot;children&quot;</span><span class=\"hljs-punctuation\">:</span> <span class=\"hljs-punctuation\">[</span><br>            <span class=\"hljs-punctuation\">&#123;</span><br>                <span class=\"hljs-attr\">&quot;title&quot;</span><span class=\"hljs-punctuation\">:</span> <span class=\"hljs-string\">&quot;员工管理&quot;</span><span class=\"hljs-punctuation\">,</span><br>                <span class=\"hljs-attr\">&quot;path&quot;</span><span class=\"hljs-punctuation\">:</span> <span class=\"hljs-string\">&quot;&quot;</span><br>            <span class=\"hljs-punctuation\">&#125;</span><span class=\"hljs-punctuation\">,</span><br>            <span class=\"hljs-punctuation\">&#123;</span><br>                <span class=\"hljs-attr\">&quot;title&quot;</span><span class=\"hljs-punctuation\">:</span> <span class=\"hljs-string\">&quot;角色列表&quot;</span><span class=\"hljs-punctuation\">,</span><br>                <span class=\"hljs-attr\">&quot;path&quot;</span><span class=\"hljs-punctuation\">:</span> <span class=\"hljs-string\">&quot;&quot;</span><br>            <span class=\"hljs-punctuation\">&#125;</span><span class=\"hljs-punctuation\">,</span><br>            <span class=\"hljs-punctuation\">&#123;</span><br>                <span class=\"hljs-attr\">&quot;title&quot;</span><span class=\"hljs-punctuation\">:</span> <span class=\"hljs-string\">&quot;权限列表&quot;</span><span class=\"hljs-punctuation\">,</span><br>                <span class=\"hljs-attr\">&quot;path&quot;</span><span class=\"hljs-punctuation\">:</span> <span class=\"hljs-string\">&quot;&quot;</span><br>            <span class=\"hljs-punctuation\">&#125;</span><br>        <span class=\"hljs-punctuation\">]</span><br>    <span class=\"hljs-punctuation\">&#125;</span><span class=\"hljs-punctuation\">,</span><br>    <span class=\"hljs-punctuation\">&#123;</span><br>        <span class=\"hljs-attr\">&quot;title&quot;</span><span class=\"hljs-punctuation\">:</span> <span class=\"hljs-string\">&quot;文章&quot;</span><span class=\"hljs-punctuation\">,</span><br>        <span class=\"hljs-attr\">&quot;children&quot;</span><span class=\"hljs-punctuation\">:</span> <span class=\"hljs-punctuation\">[</span><br>            <span class=\"hljs-punctuation\">&#123;</span><br>                <span class=\"hljs-attr\">&quot;title&quot;</span><span class=\"hljs-punctuation\">:</span> <span class=\"hljs-string\">&quot;文章排名&quot;</span><span class=\"hljs-punctuation\">,</span><br>                <span class=\"hljs-attr\">&quot;path&quot;</span><span class=\"hljs-punctuation\">:</span> <span class=\"hljs-string\">&quot;&quot;</span><br>            <span class=\"hljs-punctuation\">&#125;</span><span class=\"hljs-punctuation\">,</span><br>            <span class=\"hljs-punctuation\">&#123;</span><br>                <span class=\"hljs-attr\">&quot;title&quot;</span><span class=\"hljs-punctuation\">:</span> <span class=\"hljs-string\">&quot;创建文章&quot;</span><span class=\"hljs-punctuation\">,</span><br>                <span class=\"hljs-attr\">&quot;path&quot;</span><span class=\"hljs-punctuation\">:</span> <span class=\"hljs-string\">&quot;&quot;</span><br>            <span class=\"hljs-punctuation\">&#125;</span><br>        <span class=\"hljs-punctuation\">]</span><br>    <span class=\"hljs-punctuation\">&#125;</span><br><span class=\"hljs-punctuation\">]</span><br></code></pre></td></tr></table></figure>\n\n</li>\n</ol>\n</li>\n</ol>\n<p>又因为将来我们需要进行 <strong>用户权限处理</strong>，所以此时我们需要先对路由表进行一个划分：</p>\n<ol>\n<li>私有路由表 <code>privateRoutes</code> ：权限路由</li>\n<li>公有路由表 <code>publicRoutes</code>：无权限路由</li>\n</ol>\n<p>根据以上理论，生成以下路由表结构：</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br><span class=\"line\">103</span><br><span class=\"line\">104</span><br><span class=\"line\">105</span><br><span class=\"line\">106</span><br><span class=\"line\">107</span><br><span class=\"line\">108</span><br><span class=\"line\">109</span><br><span class=\"line\">110</span><br><span class=\"line\">111</span><br><span class=\"line\">112</span><br><span class=\"line\">113</span><br><span class=\"line\">114</span><br><span class=\"line\">115</span><br><span class=\"line\">116</span><br><span class=\"line\">117</span><br><span class=\"line\">118</span><br><span class=\"line\">119</span><br><span class=\"line\">120</span><br><span class=\"line\">121</span><br><span class=\"line\">122</span><br><span class=\"line\">123</span><br><span class=\"line\">124</span><br><span class=\"line\">125</span><br><span class=\"line\">126</span><br><span class=\"line\">127</span><br><span class=\"line\">128</span><br><span class=\"line\">129</span><br><span class=\"line\">130</span><br><span class=\"line\">131</span><br><span class=\"line\">132</span><br><span class=\"line\">133</span><br><span class=\"line\">134</span><br><span class=\"line\">135</span><br><span class=\"line\">136</span><br><span class=\"line\">137</span><br><span class=\"line\">138</span><br><span class=\"line\">139</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\"><span class=\"hljs-comment\">/**</span><br><span class=\"hljs-comment\"> * 私有路由表</span><br><span class=\"hljs-comment\"> */</span><br><span class=\"hljs-keyword\">const</span> privateRoutes = [<br>  &#123;<br>    <span class=\"hljs-attr\">path</span>: <span class=\"hljs-string\">&#x27;/user&#x27;</span>,<br>    <span class=\"hljs-attr\">component</span>: layout,<br>    <span class=\"hljs-attr\">redirect</span>: <span class=\"hljs-string\">&#x27;/user/manage&#x27;</span>,<br>    <span class=\"hljs-attr\">meta</span>: &#123;<br>      <span class=\"hljs-attr\">title</span>: <span class=\"hljs-string\">&#x27;user&#x27;</span>,<br>      <span class=\"hljs-attr\">icon</span>: <span class=\"hljs-string\">&#x27;personnel&#x27;</span><br>    &#125;,<br>    <span class=\"hljs-attr\">children</span>: [<br>      &#123;<br>        <span class=\"hljs-attr\">path</span>: <span class=\"hljs-string\">&#x27;/user/manage&#x27;</span>,<br>        <span class=\"hljs-attr\">component</span>: <span class=\"hljs-function\">() =&gt;</span> <span class=\"hljs-title function_\">import</span>(<span class=\"hljs-string\">&#x27;@/views/user-manage/index&#x27;</span>),<br>        <span class=\"hljs-attr\">meta</span>: &#123;<br>          <span class=\"hljs-attr\">title</span>: <span class=\"hljs-string\">&#x27;userManage&#x27;</span>,<br>          <span class=\"hljs-attr\">icon</span>: <span class=\"hljs-string\">&#x27;personnel-manage&#x27;</span><br>        &#125;<br>      &#125;,<br>      &#123;<br>        <span class=\"hljs-attr\">path</span>: <span class=\"hljs-string\">&#x27;/user/role&#x27;</span>,<br>        <span class=\"hljs-attr\">component</span>: <span class=\"hljs-function\">() =&gt;</span> <span class=\"hljs-title function_\">import</span>(<span class=\"hljs-string\">&#x27;@/views/role-list/index&#x27;</span>),<br>        <span class=\"hljs-attr\">meta</span>: &#123;<br>          <span class=\"hljs-attr\">title</span>: <span class=\"hljs-string\">&#x27;roleList&#x27;</span>,<br>          <span class=\"hljs-attr\">icon</span>: <span class=\"hljs-string\">&#x27;role&#x27;</span><br>        &#125;<br>      &#125;,<br>      &#123;<br>        <span class=\"hljs-attr\">path</span>: <span class=\"hljs-string\">&#x27;/user/permission&#x27;</span>,<br>        <span class=\"hljs-attr\">component</span>: <span class=\"hljs-function\">() =&gt;</span> <span class=\"hljs-title function_\">import</span>(<span class=\"hljs-string\">&#x27;@/views/permission-list/index&#x27;</span>),<br>        <span class=\"hljs-attr\">meta</span>: &#123;<br>          <span class=\"hljs-attr\">title</span>: <span class=\"hljs-string\">&#x27;permissionList&#x27;</span>,<br>          <span class=\"hljs-attr\">icon</span>: <span class=\"hljs-string\">&#x27;permission&#x27;</span><br>        &#125;<br>      &#125;,<br>      &#123;<br>        <span class=\"hljs-attr\">path</span>: <span class=\"hljs-string\">&#x27;/user/info/:id&#x27;</span>,<br>        <span class=\"hljs-attr\">name</span>: <span class=\"hljs-string\">&#x27;userInfo&#x27;</span>,<br>        <span class=\"hljs-attr\">component</span>: <span class=\"hljs-function\">() =&gt;</span> <span class=\"hljs-title function_\">import</span>(<span class=\"hljs-string\">&#x27;@/views/user-info/index&#x27;</span>),<br>        <span class=\"hljs-attr\">meta</span>: &#123;<br>          <span class=\"hljs-attr\">title</span>: <span class=\"hljs-string\">&#x27;userInfo&#x27;</span><br>        &#125;<br>      &#125;,<br>      &#123;<br>        <span class=\"hljs-attr\">path</span>: <span class=\"hljs-string\">&#x27;/user/import&#x27;</span>,<br>        <span class=\"hljs-attr\">name</span>: <span class=\"hljs-string\">&#x27;import&#x27;</span>,<br>        <span class=\"hljs-attr\">component</span>: <span class=\"hljs-function\">() =&gt;</span> <span class=\"hljs-title function_\">import</span>(<span class=\"hljs-string\">&#x27;@/views/import/index&#x27;</span>),<br>        <span class=\"hljs-attr\">meta</span>: &#123;<br>          <span class=\"hljs-attr\">title</span>: <span class=\"hljs-string\">&#x27;excelImport&#x27;</span><br>        &#125;<br>      &#125;<br>    ]<br>  &#125;,<br>  &#123;<br>    <span class=\"hljs-attr\">path</span>: <span class=\"hljs-string\">&#x27;/article&#x27;</span>,<br>    <span class=\"hljs-attr\">component</span>: layout,<br>    <span class=\"hljs-attr\">redirect</span>: <span class=\"hljs-string\">&#x27;/article/ranking&#x27;</span>,<br>    <span class=\"hljs-attr\">meta</span>: &#123;<br>      <span class=\"hljs-attr\">title</span>: <span class=\"hljs-string\">&#x27;article&#x27;</span>,<br>      <span class=\"hljs-attr\">icon</span>: <span class=\"hljs-string\">&#x27;article&#x27;</span><br>    &#125;,<br>    <span class=\"hljs-attr\">children</span>: [<br>      &#123;<br>        <span class=\"hljs-attr\">path</span>: <span class=\"hljs-string\">&#x27;/article/ranking&#x27;</span>,<br>        <span class=\"hljs-attr\">component</span>: <span class=\"hljs-function\">() =&gt;</span> <span class=\"hljs-title function_\">import</span>(<span class=\"hljs-string\">&#x27;@/views/article-ranking/index&#x27;</span>),<br>        <span class=\"hljs-attr\">meta</span>: &#123;<br>          <span class=\"hljs-attr\">title</span>: <span class=\"hljs-string\">&#x27;articleRanking&#x27;</span>,<br>          <span class=\"hljs-attr\">icon</span>: <span class=\"hljs-string\">&#x27;article-ranking&#x27;</span><br>        &#125;<br>      &#125;,<br>      &#123;<br>        <span class=\"hljs-attr\">path</span>: <span class=\"hljs-string\">&#x27;/article/:id&#x27;</span>,<br>        <span class=\"hljs-attr\">component</span>: <span class=\"hljs-function\">() =&gt;</span> <span class=\"hljs-title function_\">import</span>(<span class=\"hljs-string\">&#x27;@/views/article-detail/index&#x27;</span>),<br>        <span class=\"hljs-attr\">meta</span>: &#123;<br>          <span class=\"hljs-attr\">title</span>: <span class=\"hljs-string\">&#x27;articleDetail&#x27;</span><br>        &#125;<br>      &#125;,<br>      &#123;<br>        <span class=\"hljs-attr\">path</span>: <span class=\"hljs-string\">&#x27;/article/create&#x27;</span>,<br>        <span class=\"hljs-attr\">component</span>: <span class=\"hljs-function\">() =&gt;</span> <span class=\"hljs-title function_\">import</span>(<span class=\"hljs-string\">&#x27;@/views/article-create/index&#x27;</span>),<br>        <span class=\"hljs-attr\">meta</span>: &#123;<br>          <span class=\"hljs-attr\">title</span>: <span class=\"hljs-string\">&#x27;articleCreate&#x27;</span>,<br>          <span class=\"hljs-attr\">icon</span>: <span class=\"hljs-string\">&#x27;article-create&#x27;</span><br>        &#125;<br>      &#125;,<br>      &#123;<br>        <span class=\"hljs-attr\">path</span>: <span class=\"hljs-string\">&#x27;/article/editor/:id&#x27;</span>,<br>        <span class=\"hljs-attr\">component</span>: <span class=\"hljs-function\">() =&gt;</span> <span class=\"hljs-title function_\">import</span>(<span class=\"hljs-string\">&#x27;@/views/article-create/index&#x27;</span>),<br>        <span class=\"hljs-attr\">meta</span>: &#123;<br>          <span class=\"hljs-attr\">title</span>: <span class=\"hljs-string\">&#x27;articleEditor&#x27;</span><br>        &#125;<br>      &#125;<br>    ]<br>  &#125;<br>]<br><br><span class=\"hljs-comment\">/**</span><br><span class=\"hljs-comment\"> * 公开路由表</span><br><span class=\"hljs-comment\"> */</span><br><span class=\"hljs-keyword\">const</span> publicRoutes = [<br>  &#123;<br>    <span class=\"hljs-attr\">path</span>: <span class=\"hljs-string\">&#x27;/login&#x27;</span>,<br>    <span class=\"hljs-attr\">component</span>: <span class=\"hljs-function\">() =&gt;</span> <span class=\"hljs-title function_\">import</span>(<span class=\"hljs-string\">&#x27;@/views/login/index&#x27;</span>)<br>  &#125;,<br>  &#123;<br>    <span class=\"hljs-attr\">path</span>: <span class=\"hljs-string\">&#x27;/&#x27;</span>,<br>    <span class=\"hljs-comment\">// 注意：带有路径“/”的记录中的组件“默认”是一个不返回 Promise 的函数</span><br>    <span class=\"hljs-attr\">component</span>: layout,<br>    <span class=\"hljs-attr\">redirect</span>: <span class=\"hljs-string\">&#x27;/profile&#x27;</span>,<br>    <span class=\"hljs-attr\">children</span>: [<br>      &#123;<br>        <span class=\"hljs-attr\">path</span>: <span class=\"hljs-string\">&#x27;/profile&#x27;</span>,<br>        <span class=\"hljs-attr\">name</span>: <span class=\"hljs-string\">&#x27;profile&#x27;</span>,<br>        <span class=\"hljs-attr\">component</span>: <span class=\"hljs-function\">() =&gt;</span> <span class=\"hljs-title function_\">import</span>(<span class=\"hljs-string\">&#x27;@/views/profile/index&#x27;</span>),<br>        <span class=\"hljs-attr\">meta</span>: &#123;<br>          <span class=\"hljs-attr\">title</span>: <span class=\"hljs-string\">&#x27;profile&#x27;</span>,<br>          <span class=\"hljs-attr\">icon</span>: <span class=\"hljs-string\">&#x27;el-icon-user&#x27;</span><br>        &#125;<br>      &#125;,<br>      &#123;<br>        <span class=\"hljs-attr\">path</span>: <span class=\"hljs-string\">&#x27;/404&#x27;</span>,<br>        <span class=\"hljs-attr\">name</span>: <span class=\"hljs-string\">&#x27;404&#x27;</span>,<br>        <span class=\"hljs-attr\">component</span>: <span class=\"hljs-function\">() =&gt;</span> <span class=\"hljs-title function_\">import</span>(<span class=\"hljs-string\">&#x27;@/views/error-page/404&#x27;</span>)<br>      &#125;,<br>      &#123;<br>        <span class=\"hljs-attr\">path</span>: <span class=\"hljs-string\">&#x27;/401&#x27;</span>,<br>        <span class=\"hljs-attr\">name</span>: <span class=\"hljs-string\">&#x27;401&#x27;</span>,<br>        <span class=\"hljs-attr\">component</span>: <span class=\"hljs-function\">() =&gt;</span> <span class=\"hljs-title function_\">import</span>(<span class=\"hljs-string\">&#x27;@/views/error-page/401&#x27;</span>)<br>      &#125;<br>    ]<br>  &#125;<br>]<br><br><span class=\"hljs-keyword\">const</span> router = <span class=\"hljs-title function_\">createRouter</span>(&#123;<br>  <span class=\"hljs-attr\">history</span>: <span class=\"hljs-title function_\">createWebHashHistory</span>(),<br>  <span class=\"hljs-attr\">routes</span>: [...publicRoutes, ...privateRoutes]<br>&#125;)<br></code></pre></td></tr></table></figure>\n\n<p>最后不要忘记在 <code>layout/appMain</code> 下设置路由出口</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\">&lt;template&gt;<br>  <span class=\"language-xml\"><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">div</span> <span class=\"hljs-attr\">class</span>=<span class=\"hljs-string\">&quot;app-main&quot;</span>&gt;</span></span><br><span class=\"language-xml\">    <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">router-view</span>&gt;</span><span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">router-view</span>&gt;</span></span><br><span class=\"language-xml\">  <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">div</span>&gt;</span></span><br>&lt;/template&gt;<br></code></pre></td></tr></table></figure>\n\n<h2 id=\"解析路由表，获取结构化数据\"><a href=\"#解析路由表，获取结构化数据\" class=\"headerlink\" title=\"解析路由表，获取结构化数据\"></a>解析路由表，获取结构化数据</h2><p>想要获取路由表数据，那么有两种方式：</p>\n<ol>\n<li><p><a href=\"https://next.router.vuejs.org/zh/api/#routes\">router.options.routes</a>：初始路由列表（<a href=\"https://next.router.vuejs.org/zh/api/#addroute\">新增的路由</a> 无法获取到）</p>\n</li>\n<li><p><a href=\"https://next.router.vuejs.org/zh/api/#getroutes\">router.getRoutes()</a>：获取所有 <a href=\"https://next.router.vuejs.org/zh/api/#routerecord\">路由记录</a> 的完整列表</p>\n</li>\n</ol>\n<p>所以，我们此时使用 <code>router.getRoutes()</code> 方法获取完整的路由列表</p>\n<p>在 <code>layout/components/Sidebar/SidebarMenu</code> 下写入以下代码：</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\">&lt;script setup&gt;<br><span class=\"hljs-keyword\">import</span> &#123; useRouter &#125; <span class=\"hljs-keyword\">from</span> <span class=\"hljs-string\">&#x27;vue-router&#x27;</span><br><br><span class=\"hljs-keyword\">const</span> router = <span class=\"hljs-title function_\">useRouter</span>()<br><span class=\"hljs-variable language_\">console</span>.<span class=\"hljs-title function_\">log</span>(router.<span class=\"hljs-title function_\">getRoutes</span>())<br>&lt;/script&gt;<br></code></pre></td></tr></table></figure>\n\n<p>从返回的数据来看，它与我们想要的数据结构相去甚远。</p>\n<p>出现这个问题的原因，是因为它返回的是一个 <strong>完整的路由表</strong></p>\n<p>这个路由表距离我们想要的存在两个问题：</p>\n<ol>\n<li>存在重复的路由数据</li>\n<li>不满足该条件 <code>meta &amp;&amp; meta.title &amp;&amp; meta.icon</code> 的数据不应该存在</li>\n</ol>\n<p>那么接下来我们就应该来处理这两个问题</p>\n<p>创建 <code>utils/route.ts</code> 文件，创建两个方法分别处理对应的两个问题：</p>\n<ol>\n<li><code>filterRouters</code></li>\n<li><code>generateMenus</code></li>\n</ol>\n<p>写入以下代码：</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\"><span class=\"hljs-keyword\">import</span> path <span class=\"hljs-keyword\">from</span> <span class=\"hljs-string\">&#x27;path&#x27;</span><br><br><span class=\"hljs-comment\">/**</span><br><span class=\"hljs-comment\"> * 返回所有子路由</span><br><span class=\"hljs-comment\"> */</span><br><span class=\"hljs-keyword\">const</span> <span class=\"hljs-title function_\">getChildrenRoutes</span> = routes =&gt; &#123;<br>  <span class=\"hljs-keyword\">const</span> result = []<br>  routes.<span class=\"hljs-title function_\">forEach</span>(<span class=\"hljs-function\"><span class=\"hljs-params\">route</span> =&gt;</span> &#123;<br>    <span class=\"hljs-keyword\">if</span> (route.<span class=\"hljs-property\">children</span> &amp;&amp; route.<span class=\"hljs-property\">children</span>.<span class=\"hljs-property\">length</span> &gt; <span class=\"hljs-number\">0</span>) &#123;<br>      result.<span class=\"hljs-title function_\">push</span>(...route.<span class=\"hljs-property\">children</span>)<br>    &#125;<br>  &#125;)<br>  <span class=\"hljs-keyword\">return</span> result<br>&#125;<br><span class=\"hljs-comment\">/**</span><br><span class=\"hljs-comment\"> * 处理脱离层级的路由：某个一级路由为其他子路由，则剔除该一级路由，保留路由层级</span><br><span class=\"hljs-comment\"> * <span class=\"hljs-doctag\">@param</span> &#123;<span class=\"hljs-type\">*</span>&#125; routes router.getRoutes()</span><br><span class=\"hljs-comment\"> */</span><br><span class=\"hljs-keyword\">export</span> <span class=\"hljs-keyword\">const</span> <span class=\"hljs-title function_\">filterRouters</span> = routes =&gt; &#123;<br>  <span class=\"hljs-keyword\">const</span> childrenRoutes = <span class=\"hljs-title function_\">getChildrenRoutes</span>(routes)<br>  <span class=\"hljs-keyword\">return</span> routes.<span class=\"hljs-title function_\">filter</span>(<span class=\"hljs-function\"><span class=\"hljs-params\">route</span> =&gt;</span> &#123;<br>    <span class=\"hljs-keyword\">return</span> !childrenRoutes.<span class=\"hljs-title function_\">find</span>(<span class=\"hljs-function\"><span class=\"hljs-params\">childrenRoute</span> =&gt;</span> &#123;<br>      <span class=\"hljs-keyword\">return</span> childrenRoute.<span class=\"hljs-property\">path</span> === route.<span class=\"hljs-property\">path</span><br>    &#125;)<br>  &#125;)<br>&#125;<br><br><span class=\"hljs-comment\">/**</span><br><span class=\"hljs-comment\"> * 判断数据是否为空值</span><br><span class=\"hljs-comment\"> */</span><br><span class=\"hljs-keyword\">function</span> <span class=\"hljs-title function_\">isNull</span>(<span class=\"hljs-params\">data</span>) &#123;<br>  <span class=\"hljs-keyword\">if</span> (!data) <span class=\"hljs-keyword\">return</span> <span class=\"hljs-literal\">true</span><br>  <span class=\"hljs-keyword\">if</span> (<span class=\"hljs-title class_\">JSON</span>.<span class=\"hljs-title function_\">stringify</span>(data) === <span class=\"hljs-string\">&#x27;&#123;&#125;&#x27;</span>) <span class=\"hljs-keyword\">return</span> <span class=\"hljs-literal\">true</span><br>  <span class=\"hljs-keyword\">if</span> (<span class=\"hljs-title class_\">JSON</span>.<span class=\"hljs-title function_\">stringify</span>(data) === <span class=\"hljs-string\">&#x27;[]&#x27;</span>) <span class=\"hljs-keyword\">return</span> <span class=\"hljs-literal\">true</span><br>  <span class=\"hljs-keyword\">return</span> <span class=\"hljs-literal\">false</span><br>&#125;<br><span class=\"hljs-comment\">/**</span><br><span class=\"hljs-comment\"> * 根据 routes 数据，返回对应 menu 规则数组</span><br><span class=\"hljs-comment\"> */</span><br><span class=\"hljs-keyword\">export</span> <span class=\"hljs-keyword\">function</span> <span class=\"hljs-title function_\">generateMenus</span>(<span class=\"hljs-params\">routes, basePath = <span class=\"hljs-string\">&#x27;&#x27;</span></span>) &#123;<br>  <span class=\"hljs-keyword\">const</span> result = []<br>  <span class=\"hljs-comment\">// 遍历路由表</span><br>  routes.<span class=\"hljs-title function_\">forEach</span>(<span class=\"hljs-function\"><span class=\"hljs-params\">item</span> =&gt;</span> &#123;<br>    <span class=\"hljs-comment\">// 不存在 children &amp;&amp; 不存在 meta 直接 return</span><br>    <span class=\"hljs-keyword\">if</span> (<span class=\"hljs-title function_\">isNull</span>(item.<span class=\"hljs-property\">meta</span>) &amp;&amp; <span class=\"hljs-title function_\">isNull</span>(item.<span class=\"hljs-property\">children</span>)) <span class=\"hljs-keyword\">return</span><br>    <span class=\"hljs-comment\">// 存在 children 不存在 meta，进入迭代</span><br>    <span class=\"hljs-keyword\">if</span> (<span class=\"hljs-title function_\">isNull</span>(item.<span class=\"hljs-property\">meta</span>) &amp;&amp; !<span class=\"hljs-title function_\">isNull</span>(item.<span class=\"hljs-property\">children</span>)) &#123;<br>      result.<span class=\"hljs-title function_\">push</span>(...<span class=\"hljs-title function_\">generateMenus</span>(item.<span class=\"hljs-property\">children</span>))<br>      <span class=\"hljs-keyword\">return</span><br>    &#125;<br>    <span class=\"hljs-comment\">// 合并 path 作为跳转路径</span><br>    <span class=\"hljs-keyword\">const</span> routePath = path.<span class=\"hljs-title function_\">resolve</span>(basePath, item.<span class=\"hljs-property\">path</span>)<br>    <span class=\"hljs-comment\">// 路由分离之后，存在同名父路由的情况，需要单独处理</span><br>    <span class=\"hljs-keyword\">let</span> route = result.<span class=\"hljs-title function_\">find</span>(<span class=\"hljs-function\"><span class=\"hljs-params\">item</span> =&gt;</span> item.<span class=\"hljs-property\">path</span> === routePath)<br>    <span class=\"hljs-keyword\">if</span> (!route) &#123;<br>      route = &#123;<br>        ...item,<br>        <span class=\"hljs-attr\">path</span>: routePath,<br>        <span class=\"hljs-attr\">children</span>: []<br>      &#125;<br><br>      <span class=\"hljs-comment\">// icon 与 title 必须全部存在</span><br>      <span class=\"hljs-keyword\">if</span> (route.<span class=\"hljs-property\">meta</span>.<span class=\"hljs-property\">icon</span> &amp;&amp; route.<span class=\"hljs-property\">meta</span>.<span class=\"hljs-property\">title</span>) &#123;<br>        <span class=\"hljs-comment\">// meta 存在生成 route 对象，放入 arr</span><br>        result.<span class=\"hljs-title function_\">push</span>(route)<br>      &#125;<br>    &#125;<br><br>    <span class=\"hljs-comment\">// 存在 children 进入迭代到children</span><br>    <span class=\"hljs-keyword\">if</span> (item.<span class=\"hljs-property\">children</span>) &#123;<br>      route.<span class=\"hljs-property\">children</span>.<span class=\"hljs-title function_\">push</span>(...<span class=\"hljs-title function_\">generateMenus</span>(item.<span class=\"hljs-property\">children</span>, route.<span class=\"hljs-property\">path</span>))<br>    &#125;<br>  &#125;)<br>  <span class=\"hljs-keyword\">return</span> result<br>&#125;<br><br></code></pre></td></tr></table></figure>\n\n<p>在 <code>SidebarMenu</code> 中调用该方法</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\">&lt;script setup&gt;<br><span class=\"hljs-keyword\">import</span> &#123; computed &#125; <span class=\"hljs-keyword\">from</span> <span class=\"hljs-string\">&#x27;vue&#x27;</span><br><span class=\"hljs-keyword\">import</span> &#123; useRouter &#125; <span class=\"hljs-keyword\">from</span> <span class=\"hljs-string\">&#x27;vue-router&#x27;</span><br><span class=\"hljs-keyword\">import</span> &#123; filterRouters, generateMenus &#125; <span class=\"hljs-keyword\">from</span> <span class=\"hljs-string\">&#x27;@/utils/route&#x27;</span><br><br><span class=\"hljs-keyword\">const</span> router = <span class=\"hljs-title function_\">useRouter</span>()<br><span class=\"hljs-keyword\">const</span> routes = <span class=\"hljs-title function_\">computed</span>(<span class=\"hljs-function\">() =&gt;</span> &#123;<br>  <span class=\"hljs-keyword\">const</span> filterRoutes = <span class=\"hljs-title function_\">filterRouters</span>(router.<span class=\"hljs-title function_\">getRoutes</span>())<br>  <span class=\"hljs-keyword\">return</span> <span class=\"hljs-title function_\">generateMenus</span>(filterRoutes)<br>&#125;)<br><span class=\"hljs-variable language_\">console</span>.<span class=\"hljs-title function_\">log</span>(<span class=\"hljs-title class_\">JSON</span>.<span class=\"hljs-title function_\">stringify</span>(routes.<span class=\"hljs-property\">value</span>))<br>&lt;/script&gt;<br></code></pre></td></tr></table></figure>\n\n<p>得到该数据结构</p>\n<figure class=\"highlight json\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs json\"><span class=\"hljs-punctuation\">[</span><br>    <span class=\"hljs-punctuation\">&#123;</span><br>        <span class=\"hljs-attr\">&quot;path&quot;</span><span class=\"hljs-punctuation\">:</span><span class=\"hljs-string\">&quot;/profile&quot;</span><span class=\"hljs-punctuation\">,</span><br>        <span class=\"hljs-attr\">&quot;name&quot;</span><span class=\"hljs-punctuation\">:</span><span class=\"hljs-string\">&quot;profile&quot;</span><span class=\"hljs-punctuation\">,</span><br>        <span class=\"hljs-attr\">&quot;meta&quot;</span><span class=\"hljs-punctuation\">:</span><span class=\"hljs-punctuation\">&#123;</span><br>            <span class=\"hljs-attr\">&quot;title&quot;</span><span class=\"hljs-punctuation\">:</span><span class=\"hljs-string\">&quot;profile&quot;</span><span class=\"hljs-punctuation\">,</span><br>            <span class=\"hljs-attr\">&quot;icon&quot;</span><span class=\"hljs-punctuation\">:</span><span class=\"hljs-string\">&quot;el-icon-user&quot;</span><br>        <span class=\"hljs-punctuation\">&#125;</span><span class=\"hljs-punctuation\">,</span><br>    <span class=\"hljs-punctuation\">&#125;</span><span class=\"hljs-punctuation\">,</span><br>    <span class=\"hljs-punctuation\">&#123;</span><br>        <span class=\"hljs-attr\">&quot;path&quot;</span><span class=\"hljs-punctuation\">:</span><span class=\"hljs-string\">&quot;/user&quot;</span><span class=\"hljs-punctuation\">,</span><br>        <span class=\"hljs-attr\">&quot;redirect&quot;</span><span class=\"hljs-punctuation\">:</span><span class=\"hljs-string\">&quot;/user/manage&quot;</span><span class=\"hljs-punctuation\">,</span><br>        <span class=\"hljs-attr\">&quot;meta&quot;</span><span class=\"hljs-punctuation\">:</span><span class=\"hljs-punctuation\">&#123;</span><br>            <span class=\"hljs-attr\">&quot;title&quot;</span><span class=\"hljs-punctuation\">:</span><span class=\"hljs-string\">&quot;user&quot;</span><span class=\"hljs-punctuation\">,</span><br>            <span class=\"hljs-attr\">&quot;icon&quot;</span><span class=\"hljs-punctuation\">:</span><span class=\"hljs-string\">&quot;personnel&quot;</span><br>        <span class=\"hljs-punctuation\">&#125;</span><span class=\"hljs-punctuation\">,</span><br>        <span class=\"hljs-attr\">&quot;props&quot;</span><span class=\"hljs-punctuation\">:</span><span class=\"hljs-punctuation\">&#123;</span><br>            <span class=\"hljs-attr\">&quot;default&quot;</span><span class=\"hljs-punctuation\">:</span><span class=\"hljs-keyword\">false</span><br>        <span class=\"hljs-punctuation\">&#125;</span><span class=\"hljs-punctuation\">,</span><br>        <span class=\"hljs-attr\">&quot;children&quot;</span><span class=\"hljs-punctuation\">:</span><span class=\"hljs-punctuation\">[</span><br>            <span class=\"hljs-punctuation\">&#123;</span><br>                <span class=\"hljs-attr\">&quot;path&quot;</span><span class=\"hljs-punctuation\">:</span><span class=\"hljs-string\">&quot;/user/manage&quot;</span><span class=\"hljs-punctuation\">,</span><br>                <span class=\"hljs-attr\">&quot;name&quot;</span><span class=\"hljs-punctuation\">:</span><span class=\"hljs-string\">&quot;userManage&quot;</span><span class=\"hljs-punctuation\">,</span><br>                <span class=\"hljs-attr\">&quot;meta&quot;</span><span class=\"hljs-punctuation\">:</span><span class=\"hljs-punctuation\">&#123;</span><br>                    <span class=\"hljs-attr\">&quot;title&quot;</span><span class=\"hljs-punctuation\">:</span><span class=\"hljs-string\">&quot;userManage&quot;</span><span class=\"hljs-punctuation\">,</span><br>                    <span class=\"hljs-attr\">&quot;icon&quot;</span><span class=\"hljs-punctuation\">:</span><span class=\"hljs-string\">&quot;personnel-manage&quot;</span><br>                <span class=\"hljs-punctuation\">&#125;</span><span class=\"hljs-punctuation\">,</span><br>                <span class=\"hljs-attr\">&quot;children&quot;</span><span class=\"hljs-punctuation\">:</span><span class=\"hljs-punctuation\">[</span><br><br>                <span class=\"hljs-punctuation\">]</span><br>            <span class=\"hljs-punctuation\">&#125;</span><span class=\"hljs-punctuation\">,</span><br>            <span class=\"hljs-punctuation\">&#123;</span><br>                <span class=\"hljs-attr\">&quot;path&quot;</span><span class=\"hljs-punctuation\">:</span><span class=\"hljs-string\">&quot;/user/role&quot;</span><span class=\"hljs-punctuation\">,</span><br>                <span class=\"hljs-attr\">&quot;name&quot;</span><span class=\"hljs-punctuation\">:</span><span class=\"hljs-string\">&quot;userRole&quot;</span><span class=\"hljs-punctuation\">,</span><br>                <span class=\"hljs-attr\">&quot;meta&quot;</span><span class=\"hljs-punctuation\">:</span><span class=\"hljs-punctuation\">&#123;</span><br>                    <span class=\"hljs-attr\">&quot;title&quot;</span><span class=\"hljs-punctuation\">:</span><span class=\"hljs-string\">&quot;roleList&quot;</span><span class=\"hljs-punctuation\">,</span><br>                    <span class=\"hljs-attr\">&quot;icon&quot;</span><span class=\"hljs-punctuation\">:</span><span class=\"hljs-string\">&quot;role&quot;</span><br>                <span class=\"hljs-punctuation\">&#125;</span><span class=\"hljs-punctuation\">,</span><br>                <span class=\"hljs-attr\">&quot;children&quot;</span><span class=\"hljs-punctuation\">:</span><span class=\"hljs-punctuation\">[</span><br><br>                <span class=\"hljs-punctuation\">]</span><br>            <span class=\"hljs-punctuation\">&#125;</span><span class=\"hljs-punctuation\">,</span><br>            <span class=\"hljs-punctuation\">&#123;</span><br>                <span class=\"hljs-attr\">&quot;path&quot;</span><span class=\"hljs-punctuation\">:</span><span class=\"hljs-string\">&quot;/user/permission&quot;</span><span class=\"hljs-punctuation\">,</span><br>                <span class=\"hljs-attr\">&quot;name&quot;</span><span class=\"hljs-punctuation\">:</span><span class=\"hljs-string\">&quot;userPermission&quot;</span><span class=\"hljs-punctuation\">,</span><br>                <span class=\"hljs-attr\">&quot;meta&quot;</span><span class=\"hljs-punctuation\">:</span><span class=\"hljs-punctuation\">&#123;</span><br>                    <span class=\"hljs-attr\">&quot;title&quot;</span><span class=\"hljs-punctuation\">:</span><span class=\"hljs-string\">&quot;permissionList&quot;</span><span class=\"hljs-punctuation\">,</span><br>                    <span class=\"hljs-attr\">&quot;icon&quot;</span><span class=\"hljs-punctuation\">:</span><span class=\"hljs-string\">&quot;permission&quot;</span><br>                <span class=\"hljs-punctuation\">&#125;</span><span class=\"hljs-punctuation\">,</span><br>                <span class=\"hljs-attr\">&quot;children&quot;</span><span class=\"hljs-punctuation\">:</span><span class=\"hljs-punctuation\">[</span><br><br>                <span class=\"hljs-punctuation\">]</span><br>            <span class=\"hljs-punctuation\">&#125;</span><br>        <span class=\"hljs-punctuation\">]</span><span class=\"hljs-punctuation\">,</span><br>    <span class=\"hljs-punctuation\">&#125;</span><span class=\"hljs-punctuation\">,</span><br>    <span class=\"hljs-punctuation\">&#123;</span><br>        <span class=\"hljs-attr\">&quot;path&quot;</span><span class=\"hljs-punctuation\">:</span><span class=\"hljs-string\">&quot;/article&quot;</span><span class=\"hljs-punctuation\">,</span><br>        <span class=\"hljs-attr\">&quot;redirect&quot;</span><span class=\"hljs-punctuation\">:</span><span class=\"hljs-string\">&quot;/article/ranking&quot;</span><span class=\"hljs-punctuation\">,</span><br>        <span class=\"hljs-attr\">&quot;meta&quot;</span><span class=\"hljs-punctuation\">:</span><span class=\"hljs-punctuation\">&#123;</span><br>            <span class=\"hljs-attr\">&quot;title&quot;</span><span class=\"hljs-punctuation\">:</span><span class=\"hljs-string\">&quot;article&quot;</span><span class=\"hljs-punctuation\">,</span><br>            <span class=\"hljs-attr\">&quot;icon&quot;</span><span class=\"hljs-punctuation\">:</span><span class=\"hljs-string\">&quot;article&quot;</span><br>        <span class=\"hljs-punctuation\">&#125;</span><span class=\"hljs-punctuation\">,</span><br>        <span class=\"hljs-attr\">&quot;props&quot;</span><span class=\"hljs-punctuation\">:</span><span class=\"hljs-punctuation\">&#123;</span><br>            <span class=\"hljs-attr\">&quot;default&quot;</span><span class=\"hljs-punctuation\">:</span><span class=\"hljs-keyword\">false</span><br>        <span class=\"hljs-punctuation\">&#125;</span><span class=\"hljs-punctuation\">,</span><br>        <span class=\"hljs-attr\">&quot;children&quot;</span><span class=\"hljs-punctuation\">:</span><span class=\"hljs-punctuation\">[</span><br>            <span class=\"hljs-punctuation\">&#123;</span><br>                <span class=\"hljs-attr\">&quot;path&quot;</span><span class=\"hljs-punctuation\">:</span><span class=\"hljs-string\">&quot;/article/ranking&quot;</span><span class=\"hljs-punctuation\">,</span><br>                <span class=\"hljs-attr\">&quot;name&quot;</span><span class=\"hljs-punctuation\">:</span><span class=\"hljs-string\">&quot;articleRanking&quot;</span><span class=\"hljs-punctuation\">,</span><br>                <span class=\"hljs-attr\">&quot;meta&quot;</span><span class=\"hljs-punctuation\">:</span><span class=\"hljs-punctuation\">&#123;</span><br>                    <span class=\"hljs-attr\">&quot;title&quot;</span><span class=\"hljs-punctuation\">:</span><span class=\"hljs-string\">&quot;articleRanking&quot;</span><span class=\"hljs-punctuation\">,</span><br>                    <span class=\"hljs-attr\">&quot;icon&quot;</span><span class=\"hljs-punctuation\">:</span><span class=\"hljs-string\">&quot;article-ranking&quot;</span><br>                <span class=\"hljs-punctuation\">&#125;</span><span class=\"hljs-punctuation\">,</span><br>                <span class=\"hljs-attr\">&quot;children&quot;</span><span class=\"hljs-punctuation\">:</span><span class=\"hljs-punctuation\">[</span><br><br>                <span class=\"hljs-punctuation\">]</span><br>            <span class=\"hljs-punctuation\">&#125;</span><span class=\"hljs-punctuation\">,</span><br>            <span class=\"hljs-punctuation\">&#123;</span><br>                <span class=\"hljs-attr\">&quot;path&quot;</span><span class=\"hljs-punctuation\">:</span><span class=\"hljs-string\">&quot;/article/create&quot;</span><span class=\"hljs-punctuation\">,</span><br>                <span class=\"hljs-attr\">&quot;name&quot;</span><span class=\"hljs-punctuation\">:</span><span class=\"hljs-string\">&quot;articleCreate&quot;</span><span class=\"hljs-punctuation\">,</span><br>                <span class=\"hljs-attr\">&quot;meta&quot;</span><span class=\"hljs-punctuation\">:</span><span class=\"hljs-punctuation\">&#123;</span><br>                    <span class=\"hljs-attr\">&quot;title&quot;</span><span class=\"hljs-punctuation\">:</span><span class=\"hljs-string\">&quot;articleCreate&quot;</span><span class=\"hljs-punctuation\">,</span><br>                    <span class=\"hljs-attr\">&quot;icon&quot;</span><span class=\"hljs-punctuation\">:</span><span class=\"hljs-string\">&quot;article-create&quot;</span><br>                <span class=\"hljs-punctuation\">&#125;</span><span class=\"hljs-punctuation\">,</span><br>                <span class=\"hljs-attr\">&quot;children&quot;</span><span class=\"hljs-punctuation\">:</span><span class=\"hljs-punctuation\">[</span><br><br>                <span class=\"hljs-punctuation\">]</span><br>            <span class=\"hljs-punctuation\">&#125;</span><br>        <span class=\"hljs-punctuation\">]</span><span class=\"hljs-punctuation\">,</span><br>    <span class=\"hljs-punctuation\">&#125;</span><br><span class=\"hljs-punctuation\">]</span><br></code></pre></td></tr></table></figure>\n\n<h2 id=\"生成动态-menu-菜单\"><a href=\"#生成动态-menu-菜单\" class=\"headerlink\" title=\"生成动态 menu 菜单\"></a>生成动态 menu 菜单</h2><p>有了数据结构之后，最后的步骤就水到渠成了</p>\n<p>整个 <code>menu</code> 菜单，我们将分成三个组件来进行处理</p>\n<ol>\n<li><code>SidebarMenu</code>：处理数据，作为最顶层 <code>menu</code> 载体</li>\n<li><code>SidebarItem</code>：根据数据处理 <strong>当前项为 <code>el-submenu</code> || <code>el-menu-item</code></strong> </li>\n<li><code>MenuItem</code>：处理 <code>el-menu-item</code> 样式</li>\n</ol>\n<p>那么下面我们一个个来处理</p>\n<p>首先是 <code>SidebarMenu</code> </p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\">&lt;template&gt;<br>  &lt;!-- 一级 menu 菜单 --&gt;<br>  <span class=\"language-xml\"><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">el-menu</span></span></span><br><span class=\"hljs-tag\"><span class=\"language-xml\">    <span class=\"hljs-attr\">...</span></span></span><br><span class=\"hljs-tag\"><span class=\"language-xml\">  &gt;</span></span><br><span class=\"language-xml\">    <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">sidebar-item</span></span></span><br><span class=\"hljs-tag\"><span class=\"language-xml\">      <span class=\"hljs-attr\">v-for</span>=<span class=\"hljs-string\">&quot;item in routes&quot;</span></span></span><br><span class=\"hljs-tag\"><span class=\"language-xml\">      <span class=\"hljs-attr\">:key</span>=<span class=\"hljs-string\">&quot;item.path&quot;</span></span></span><br><span class=\"hljs-tag\"><span class=\"language-xml\">      <span class=\"hljs-attr\">:route</span>=<span class=\"hljs-string\">&quot;item&quot;</span></span></span><br><span class=\"hljs-tag\"><span class=\"language-xml\">    &gt;</span><span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">sidebar-item</span>&gt;</span></span><br><span class=\"language-xml\">  <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">el-menu</span>&gt;</span></span><br>&lt;/template&gt;<br><br></code></pre></td></tr></table></figure>\n\n\n\n<p>创建 <code>SidebarItem</code> 组件，用来根据数据处理 <strong>当前项为 <code>el-sub-menu</code> || <code>el-menu-item</code></strong> </p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\">&lt;template&gt;<br>  &lt;!-- 支持渲染多级 menu 菜单 --&gt;<br>  <span class=\"language-xml\"><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">el-sub-menu</span> <span class=\"hljs-attr\">v-if</span>=<span class=\"hljs-string\">&quot;route.children.length &gt; 0&quot;</span> <span class=\"hljs-attr\">:index</span>=<span class=\"hljs-string\">&quot;route.path&quot;</span>&gt;</span></span><br><span class=\"language-xml\">    <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">template</span> #<span class=\"hljs-attr\">title</span>&gt;</span></span><br><span class=\"language-xml\">      <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">menu-item</span> <span class=\"hljs-attr\">:title</span>=<span class=\"hljs-string\">&quot;route.meta.title&quot;</span> <span class=\"hljs-attr\">:icon</span>=<span class=\"hljs-string\">&quot;route.meta.icon&quot;</span>&gt;</span><span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">menu-item</span>&gt;</span></span><br><span class=\"language-xml\">    <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">template</span>&gt;</span></span><br><span class=\"language-xml\">    <span class=\"hljs-comment\">&lt;!-- 循环渲染 --&gt;</span></span><br><span class=\"language-xml\">    <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">sidebar-item</span></span></span><br><span class=\"hljs-tag\"><span class=\"language-xml\">      <span class=\"hljs-attr\">v-for</span>=<span class=\"hljs-string\">&quot;item in route.children&quot;</span></span></span><br><span class=\"hljs-tag\"><span class=\"language-xml\">      <span class=\"hljs-attr\">:key</span>=<span class=\"hljs-string\">&quot;item.path&quot;</span></span></span><br><span class=\"hljs-tag\"><span class=\"language-xml\">      <span class=\"hljs-attr\">:route</span>=<span class=\"hljs-string\">&quot;item&quot;</span></span></span><br><span class=\"hljs-tag\"><span class=\"language-xml\">    &gt;</span><span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">sidebar-item</span>&gt;</span></span><br><span class=\"language-xml\">  <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">el-sub-menu</span>&gt;</span></span><br>  &lt;!-- 渲染 item 项 --&gt;<br>  <span class=\"language-xml\"><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">el-menu-item</span> <span class=\"hljs-attr\">v-else</span> <span class=\"hljs-attr\">:index</span>=<span class=\"hljs-string\">&quot;route.path&quot;</span>&gt;</span></span><br><span class=\"language-xml\">    <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">menu-item</span> <span class=\"hljs-attr\">:title</span>=<span class=\"hljs-string\">&quot;route.meta.title&quot;</span> <span class=\"hljs-attr\">:icon</span>=<span class=\"hljs-string\">&quot;route.meta.icon&quot;</span>&gt;</span><span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">menu-item</span>&gt;</span></span><br><span class=\"language-xml\">  <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">el-menu-item</span>&gt;</span></span><br>&lt;/template&gt;<br><br><span class=\"language-xml\"><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">script</span> <span class=\"hljs-attr\">setup</span>&gt;</span><span class=\"language-javascript\"></span></span><br><span class=\"language-javascript\"><span class=\"language-xml\"><span class=\"hljs-keyword\">import</span> <span class=\"hljs-title class_\">MenuItem</span> <span class=\"hljs-keyword\">from</span> <span class=\"hljs-string\">&#x27;./MenuItem&#x27;</span></span></span><br><span class=\"language-javascript\"><span class=\"language-xml\"><span class=\"hljs-keyword\">import</span> &#123; defineProps &#125; <span class=\"hljs-keyword\">from</span> <span class=\"hljs-string\">&#x27;vue&#x27;</span></span></span><br><span class=\"language-javascript\"><span class=\"language-xml\"><span class=\"hljs-comment\">// 定义 props</span></span></span><br><span class=\"language-javascript\"><span class=\"language-xml\"><span class=\"hljs-title function_\">defineProps</span>(&#123;</span></span><br><span class=\"language-javascript\"><span class=\"language-xml\">  <span class=\"hljs-attr\">route</span>: &#123;</span></span><br><span class=\"language-javascript\"><span class=\"language-xml\">    <span class=\"hljs-attr\">type</span>: <span class=\"hljs-title class_\">Object</span>,</span></span><br><span class=\"language-javascript\"><span class=\"language-xml\">    <span class=\"hljs-attr\">required</span>: <span class=\"hljs-literal\">true</span></span></span><br><span class=\"language-javascript\"><span class=\"language-xml\">  &#125;</span></span><br><span class=\"language-javascript\"><span class=\"language-xml\">&#125;)</span></span><br><span class=\"language-javascript\"><span class=\"language-xml\"></span><span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">script</span>&gt;</span></span><br></code></pre></td></tr></table></figure>\n\n<p>创建 <code>MenuItem</code> 用来处理 <code>el-menu-item</code> 样式</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\">&lt;template&gt;<br>  <span class=\"language-xml\"><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">i</span> <span class=\"hljs-attr\">v-if</span>=<span class=\"hljs-string\">&quot;icon.includes(&#x27;el-icon&#x27;)&quot;</span> <span class=\"hljs-attr\">class</span>=<span class=\"hljs-string\">&quot;sub-el-icon&quot;</span> <span class=\"hljs-attr\">:class</span>=<span class=\"hljs-string\">&quot;icon&quot;</span>&gt;</span><span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">i</span>&gt;</span></span><br>  <span class=\"language-xml\"><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">svg-icon</span> <span class=\"hljs-attr\">v-else</span> <span class=\"hljs-attr\">:icon</span>=<span class=\"hljs-string\">&quot;icon&quot;</span>&gt;</span><span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">svg-icon</span>&gt;</span></span><br>  <span class=\"language-xml\"><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">span</span>&gt;</span>&#123;&#123; title &#125;&#125;<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">span</span>&gt;</span></span><br>&lt;/template&gt;<br><br><span class=\"language-xml\"><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">script</span> <span class=\"hljs-attr\">setup</span>&gt;</span><span class=\"language-javascript\"></span></span><br><span class=\"language-javascript\"><span class=\"language-xml\"><span class=\"hljs-keyword\">import</span> &#123; defineProps &#125; <span class=\"hljs-keyword\">from</span> <span class=\"hljs-string\">&#x27;vue&#x27;</span></span></span><br><span class=\"language-javascript\"><span class=\"language-xml\"><span class=\"hljs-title function_\">defineProps</span>(&#123;</span></span><br><span class=\"language-javascript\"><span class=\"language-xml\">  <span class=\"hljs-attr\">title</span>: &#123;</span></span><br><span class=\"language-javascript\"><span class=\"language-xml\">    <span class=\"hljs-attr\">type</span>: <span class=\"hljs-title class_\">String</span>,</span></span><br><span class=\"language-javascript\"><span class=\"language-xml\">    <span class=\"hljs-attr\">required</span>: <span class=\"hljs-literal\">true</span></span></span><br><span class=\"language-javascript\"><span class=\"language-xml\">  &#125;,</span></span><br><span class=\"language-javascript\"><span class=\"language-xml\">  <span class=\"hljs-attr\">icon</span>: &#123;</span></span><br><span class=\"language-javascript\"><span class=\"language-xml\">    <span class=\"hljs-attr\">type</span>: <span class=\"hljs-title class_\">String</span>,</span></span><br><span class=\"language-javascript\"><span class=\"language-xml\">    <span class=\"hljs-attr\">required</span>: <span class=\"hljs-literal\">true</span></span></span><br><span class=\"language-javascript\"><span class=\"language-xml\">  &#125;</span></span><br><span class=\"language-javascript\"><span class=\"language-xml\">&#125;)</span></span><br><span class=\"language-javascript\"><span class=\"language-xml\"></span><span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">script</span>&gt;</span></span><br><br><span class=\"language-xml\"><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">style</span> <span class=\"hljs-attr\">lang</span>=<span class=\"hljs-string\">&quot;scss&quot;</span> <span class=\"hljs-attr\">scoped</span>&gt;</span></span><br><span class=\"language-xml\"><span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">style</span>&gt;</span></span><br></code></pre></td></tr></table></figure>\n\n<p>至此，整个的 <code>menu</code> 菜单结构就已经完成了！</p>\n<h2 id=\"修复最后残余问题\"><a href=\"#修复最后残余问题\" class=\"headerlink\" title=\"修复最后残余问题\"></a>修复最后残余问题</h2><p>目前 <code>menu</code> 菜单存在三个问题</p>\n<ol>\n<li>样式问题</li>\n<li>路由跳转问题</li>\n<li>默认激活项</li>\n</ol>\n<p><strong>样式问题：</strong></p>\n<p>首先处理样式，因为后面我们需要处理 <strong>主题替换</strong> ，所以此处我们不能把样式写死。因为我们的样式变量都放在 <code>variables.scss</code> 文件中，并通过 <code>:export</code> 导出了变量以供 js 导入，每次使用都需要导入，比较麻烦，我们可以将其放在 <code>store getters</code> 中，以便 <strong>快捷访问</strong>。</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\"><span class=\"hljs-keyword\">import</span> variables <span class=\"hljs-keyword\">from</span> <span class=\"hljs-string\">&#x27;@/styles/variables.scss&#x27;</span><br><span class=\"hljs-keyword\">const</span> getters = &#123;<br>  <span class=\"hljs-attr\">cssVar</span>: <span class=\"hljs-function\">() =&gt;</span> variables<br>&#125;<br><span class=\"hljs-keyword\">export</span> <span class=\"hljs-keyword\">default</span> getters<br></code></pre></td></tr></table></figure>\n\n<p>在 <code>SidebarMenu</code> 中写入如下样式</p>\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs html\"><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">el-menu</span></span><br><span class=\"hljs-tag\">  <span class=\"hljs-attr\">:background-color</span>=<span class=\"hljs-string\">&quot;$store.getters.cssVar.menuBg&quot;</span></span><br><span class=\"hljs-tag\">  <span class=\"hljs-attr\">:text-color</span>=<span class=\"hljs-string\">&quot;$store.getters.cssVar.menuText&quot;</span></span><br><span class=\"hljs-tag\">  <span class=\"hljs-attr\">:active-text-color</span>=<span class=\"hljs-string\">&quot;$store.getters.cssVar.menuActiveText&quot;</span></span><br><span class=\"hljs-tag\">  <span class=\"hljs-attr\">:unique-opened</span>=<span class=\"hljs-string\">&quot;true&quot;</span></span><br><span class=\"hljs-tag\">&gt;</span><br></code></pre></td></tr></table></figure>\n\n<p><strong>路由跳转问题：</strong></p>\n<p>为 <code>el-menu</code> 指定 <code>router</code></p>\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs html\"><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">el-menu</span></span><br><span class=\"hljs-tag\">  <span class=\"hljs-attr\">...</span></span><br><span class=\"hljs-tag\">  <span class=\"hljs-attr\">router</span></span><br><span class=\"hljs-tag\">&gt;</span><br></code></pre></td></tr></table></figure>\n\n<blockquote>\n<p>添加 router 属性</p>\n<p>表示是否启用 vue-router 模式。 启用该模式会在激活导航时以 index 作为 path 进行路由跳转 使用 default-active 来设置加载时的激活项。</p>\n</blockquote>\n<p><strong>默认激活项：</strong></p>\n<p>根据当前 <code>url</code> 进行判断即可</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\">&lt;el-menu<br>  :<span class=\"hljs-keyword\">default</span>-active=<span class=\"hljs-string\">&quot;activeMenu&quot;</span><br>  ...<br>&gt;<br><br><span class=\"language-xml\"><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">script</span> <span class=\"hljs-attr\">setup</span>&gt;</span><span class=\"language-javascript\"></span></span><br><span class=\"language-javascript\"><span class=\"language-xml\">...</span></span><br><span class=\"language-javascript\"><span class=\"language-xml\"></span></span><br><span class=\"language-javascript\"><span class=\"language-xml\"><span class=\"hljs-comment\">// 计算高亮 menu 的方法</span></span></span><br><span class=\"language-javascript\"><span class=\"language-xml\"><span class=\"hljs-keyword\">const</span> route = <span class=\"hljs-title function_\">useRoute</span>()</span></span><br><span class=\"language-javascript\"><span class=\"language-xml\"><span class=\"hljs-keyword\">const</span> activeMenu = <span class=\"hljs-title function_\">computed</span>(<span class=\"hljs-function\">() =&gt;</span> &#123;</span></span><br><span class=\"language-javascript\"><span class=\"language-xml\">  <span class=\"hljs-keyword\">const</span> &#123; path &#125; = route</span></span><br><span class=\"language-javascript\"><span class=\"language-xml\">  <span class=\"hljs-keyword\">return</span> path</span></span><br><span class=\"language-javascript\"><span class=\"language-xml\">&#125;)</span></span><br><span class=\"language-javascript\"><span class=\"language-xml\"></span><span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">script</span>&gt;</span></span><br></code></pre></td></tr></table></figure>\n\n<p>至此整个 <strong>动态<code>menu</code>完成</strong></p>\n<h2 id=\"左侧菜单伸缩功能实现\"><a href=\"#左侧菜单伸缩功能实现\" class=\"headerlink\" title=\"左侧菜单伸缩功能实现\"></a>左侧菜单伸缩功能实现</h2><p>下面我们来实现一个标准化功能 <strong>左侧菜单伸缩</strong> ，对于这个功能核心的点在于动画处理</p>\n<p>样式的改变总是由数据进行驱动，所以首先我们去创建对应的数据</p>\n<p>创建 <code>store/app</code> 模块，写入如下代码</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\"><span class=\"hljs-keyword\">export</span> <span class=\"hljs-keyword\">default</span> &#123;<br>  <span class=\"hljs-attr\">namespaced</span>: <span class=\"hljs-literal\">true</span>,<br>  <span class=\"hljs-attr\">state</span>: <span class=\"hljs-function\">() =&gt;</span> (&#123;<br>    <span class=\"hljs-attr\">sidebarOpened</span>: <span class=\"hljs-literal\">true</span><br>  &#125;),<br>  <span class=\"hljs-attr\">mutations</span>: &#123;<br>    <span class=\"hljs-title function_\">triggerSidebarOpened</span>(<span class=\"hljs-params\">state</span>) &#123;<br>      state.<span class=\"hljs-property\">sidebarOpened</span> = !state.<span class=\"hljs-property\">sidebarOpened</span><br>    &#125;<br>  &#125;,<br>  <span class=\"hljs-attr\">actions</span>: &#123;&#125;<br>&#125;<br><br></code></pre></td></tr></table></figure>\n\n<p>在 <code>store/index</code> 中进行导入</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\">...<br><span class=\"hljs-keyword\">import</span> app <span class=\"hljs-keyword\">from</span> <span class=\"hljs-string\">&#x27;./modules/app&#x27;</span><br><span class=\"hljs-keyword\">export</span> <span class=\"hljs-keyword\">default</span> <span class=\"hljs-title function_\">createStore</span>(&#123;<br>  getters,<br>  <span class=\"hljs-attr\">modules</span>: &#123;<br>    ...<br>    app<br>  &#125;<br>&#125;)<br></code></pre></td></tr></table></figure>\n\n<p>在 <code>store/getters</code> 中创建快捷访问</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\"><span class=\"hljs-attr\">sidebarOpened</span>: <span class=\"hljs-function\"><span class=\"hljs-params\">state</span> =&gt;</span> state.<span class=\"hljs-property\">app</span>.<span class=\"hljs-property\">sidebarOpened</span><br></code></pre></td></tr></table></figure>\n\n\n<p>创建 <code>components/hamburger</code> 组件，用来控制数据</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\">&lt;template&gt;<br>  <span class=\"language-xml\"><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">div</span> <span class=\"hljs-attr\">class</span>=<span class=\"hljs-string\">&quot;hamburger-container&quot;</span> @<span class=\"hljs-attr\">click</span>=<span class=\"hljs-string\">&quot;toggleClick&quot;</span>&gt;</span></span><br><span class=\"language-xml\">    <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">svg-icon</span> <span class=\"hljs-attr\">class</span>=<span class=\"hljs-string\">&quot;hamburger&quot;</span> <span class=\"hljs-attr\">:icon</span>=<span class=\"hljs-string\">&quot;icon&quot;</span>&gt;</span><span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">svg-icon</span>&gt;</span></span><br><span class=\"language-xml\">  <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">div</span>&gt;</span></span><br>&lt;/template&gt;<br><br><span class=\"language-xml\"><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">script</span> <span class=\"hljs-attr\">setup</span>&gt;</span><span class=\"language-javascript\"></span></span><br><span class=\"language-javascript\"><span class=\"language-xml\"><span class=\"hljs-keyword\">import</span> &#123; computed &#125; <span class=\"hljs-keyword\">from</span> <span class=\"hljs-string\">&#x27;vue&#x27;</span></span></span><br><span class=\"language-javascript\"><span class=\"language-xml\"><span class=\"hljs-keyword\">import</span> &#123; useStore &#125; <span class=\"hljs-keyword\">from</span> <span class=\"hljs-string\">&#x27;vuex&#x27;</span></span></span><br><span class=\"language-javascript\"><span class=\"language-xml\"></span></span><br><span class=\"language-javascript\"><span class=\"language-xml\"><span class=\"hljs-keyword\">const</span> store = <span class=\"hljs-title function_\">useStore</span>()</span></span><br><span class=\"language-javascript\"><span class=\"language-xml\"><span class=\"hljs-keyword\">const</span> <span class=\"hljs-title function_\">toggleClick</span> = (<span class=\"hljs-params\"></span>) =&gt; &#123;</span></span><br><span class=\"language-javascript\"><span class=\"language-xml\">  store.<span class=\"hljs-title function_\">commit</span>(<span class=\"hljs-string\">&#x27;app/triggerSidebarOpened&#x27;</span>)</span></span><br><span class=\"language-javascript\"><span class=\"language-xml\">&#125;</span></span><br><span class=\"language-javascript\"><span class=\"language-xml\"></span></span><br><span class=\"language-javascript\"><span class=\"language-xml\"><span class=\"hljs-keyword\">const</span> icon = <span class=\"hljs-title function_\">computed</span>(<span class=\"hljs-function\">() =&gt;</span></span></span><br><span class=\"language-javascript\"><span class=\"language-xml\">  store.<span class=\"hljs-property\">getters</span>.<span class=\"hljs-property\">sidebarOpened</span> ? <span class=\"hljs-string\">&#x27;hamburger-opened&#x27;</span> : <span class=\"hljs-string\">&#x27;hamburger-closed&#x27;</span></span></span><br><span class=\"language-javascript\"><span class=\"language-xml\">)</span></span><br><span class=\"language-javascript\"><span class=\"language-xml\"></span><span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">script</span>&gt;</span></span><br><br><span class=\"language-xml\"><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">style</span> <span class=\"hljs-attr\">lang</span>=<span class=\"hljs-string\">&quot;scss&quot;</span> <span class=\"hljs-attr\">scoped</span>&gt;</span><span class=\"language-css\"></span></span><br><span class=\"language-css\"><span class=\"language-xml\"><span class=\"hljs-selector-class\">.hamburger-container</span> &#123;</span></span><br><span class=\"language-css\"><span class=\"language-xml\">  <span class=\"hljs-attribute\">padding</span>: <span class=\"hljs-number\">0</span> <span class=\"hljs-number\">16px</span>;</span></span><br><span class=\"language-css\"><span class=\"language-xml\">  <span class=\"hljs-selector-class\">.hamburger</span> &#123;</span></span><br><span class=\"language-css\"><span class=\"language-xml\">    <span class=\"hljs-attribute\">display</span>: inline-block;</span></span><br><span class=\"language-css\"><span class=\"language-xml\">    <span class=\"hljs-attribute\">vertical-align</span>: middle;</span></span><br><span class=\"language-css\"><span class=\"language-xml\">    <span class=\"hljs-attribute\">width</span>: <span class=\"hljs-number\">20px</span>;</span></span><br><span class=\"language-css\"><span class=\"language-xml\">    <span class=\"hljs-attribute\">height</span>: <span class=\"hljs-number\">20px</span>;</span></span><br><span class=\"language-css\"><span class=\"language-xml\">  &#125;</span></span><br><span class=\"language-css\"><span class=\"language-xml\">&#125;</span></span><br><span class=\"language-css\"><span class=\"language-xml\"></span><span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">style</span>&gt;</span></span><br></code></pre></td></tr></table></figure>\n\n<p>在 <code>navbar</code> 中使用该组件</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\">&lt;template&gt;<br>  <span class=\"language-xml\"><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">div</span> <span class=\"hljs-attr\">class</span>=<span class=\"hljs-string\">&quot;navbar&quot;</span>&gt;</span></span><br><span class=\"language-xml\">    <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">hamburger</span> <span class=\"hljs-attr\">class</span>=<span class=\"hljs-string\">&quot;hamburger-container&quot;</span> /&gt;</span></span><br><span class=\"language-xml\">    ...</span><br><span class=\"language-xml\">  <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">div</span>&gt;</span></span><br>&lt;/template&gt;<br><br><span class=\"language-xml\"><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">script</span> <span class=\"hljs-attr\">setup</span>&gt;</span><span class=\"language-javascript\"></span></span><br><span class=\"language-javascript\"><span class=\"language-xml\"><span class=\"hljs-keyword\">import</span> <span class=\"hljs-title class_\">Hamburger</span> <span class=\"hljs-keyword\">from</span> <span class=\"hljs-string\">&#x27;@/components/Hamburger&#x27;</span></span></span><br><span class=\"language-javascript\"><span class=\"language-xml\">...</span></span><br><span class=\"language-javascript\"><span class=\"language-xml\"></span><span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">script</span>&gt;</span></span><br><br><span class=\"language-xml\"><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">style</span> <span class=\"hljs-attr\">lang</span>=<span class=\"hljs-string\">&quot;scss&quot;</span> <span class=\"hljs-attr\">scoped</span>&gt;</span><span class=\"language-css\"></span></span><br><span class=\"language-css\"><span class=\"language-xml\"><span class=\"hljs-selector-class\">.navbar</span> &#123;</span></span><br><span class=\"language-css\"><span class=\"language-xml\">  ...</span></span><br><span class=\"language-css\"><span class=\"language-xml\"></span></span><br><span class=\"language-css\"><span class=\"language-xml\">  <span class=\"hljs-selector-class\">.hamburger-container</span> &#123;</span></span><br><span class=\"language-css\"><span class=\"language-xml\">    <span class=\"hljs-attribute\">line-height</span>: <span class=\"hljs-number\">46px</span>;</span></span><br><span class=\"language-css\"><span class=\"language-xml\">    <span class=\"hljs-attribute\">height</span>: <span class=\"hljs-number\">100%</span>;</span></span><br><span class=\"language-css\"><span class=\"language-xml\">    <span class=\"hljs-attribute\">float</span>: left;</span></span><br><span class=\"language-css\"><span class=\"language-xml\">    <span class=\"hljs-attribute\">cursor</span>: pointer;</span></span><br><span class=\"language-css\"><span class=\"language-xml\">    // hover 动画</span></span><br><span class=\"language-css\"><span class=\"language-xml\">    <span class=\"hljs-attribute\">transition</span>: background <span class=\"hljs-number\">0.5s</span>;</span></span><br><span class=\"language-css\"><span class=\"language-xml\"></span></span><br><span class=\"language-css\"><span class=\"language-xml\">    &amp;<span class=\"hljs-selector-pseudo\">:hover</span> &#123;</span></span><br><span class=\"language-css\"><span class=\"language-xml\">      <span class=\"hljs-attribute\">background</span>: <span class=\"hljs-built_in\">rgba</span>(<span class=\"hljs-number\">0</span>, <span class=\"hljs-number\">0</span>, <span class=\"hljs-number\">0</span>, <span class=\"hljs-number\">0.1</span>);</span></span><br><span class=\"language-css\"><span class=\"language-xml\">    &#125;</span></span><br><span class=\"language-css\"><span class=\"language-xml\">  &#125;</span></span><br><span class=\"language-css\"><span class=\"language-xml\"></span></span><br><span class=\"language-css\"><span class=\"language-xml\"> ...</span></span><br><span class=\"language-css\"><span class=\"language-xml\">&#125;</span></span><br><span class=\"language-css\"><span class=\"language-xml\"></span><span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">style</span>&gt;</span></span><br><br></code></pre></td></tr></table></figure>\n\n<p>在 <code>SidebarMenu</code> 中，控制 <code>el-menu</code> 的 <a href=\"https://element-plus.org/#/zh-CN/component/menu\">collapse</a> 属性</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\">&lt;el-menu<br>    :collapse=<span class=\"hljs-string\">&quot;!$store.getters.sidebarOpened&quot;</span><br>    ...<br></code></pre></td></tr></table></figure>\n\n<p>在 <code>layout/index</code> 中指定 <strong>整个侧边栏的宽度和缩放动画</strong></p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\">&lt;div<br>    <span class=\"hljs-keyword\">class</span>=<span class=\"hljs-string\">&quot;app-wrapper&quot;</span><br>    :<span class=\"hljs-keyword\">class</span>=<span class=\"hljs-string\">&quot;[$store.getters.sidebarOpened ? &#x27;openSidebar&#x27; : &#x27;hideSidebar&#x27;]&quot;</span><br>  &gt;<br>  ...<br></code></pre></td></tr></table></figure>\n\n<p>在 <code>layout/index</code> 中 处理 <code>navbar</code> 的宽度</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\">&lt;style lang=<span class=\"hljs-string\">&quot;scss&quot;</span> scoped&gt;<br>...<br><br>.<span class=\"hljs-property\">fixed</span>-header &#123;<br>  <span class=\"hljs-attr\">position</span>: fixed;<br>  <span class=\"hljs-attr\">top</span>: <span class=\"hljs-number\">0</span>;<br>  <span class=\"hljs-attr\">right</span>: <span class=\"hljs-number\">0</span>;<br>  z-<span class=\"hljs-attr\">index</span>: <span class=\"hljs-number\">9</span>;<br>  <span class=\"hljs-attr\">width</span>: <span class=\"hljs-title function_\">calc</span>(<span class=\"hljs-number\">100</span>% - #&#123;$sideBarWidth&#125;);<br>  <span class=\"hljs-attr\">transition</span>: width <span class=\"hljs-number\">0.</span>28s;<br>&#125;<br><br>.<span class=\"hljs-property\">hideSidebar</span> .<span class=\"hljs-property\">fixed</span>-header &#123;<br>  <span class=\"hljs-attr\">width</span>: <span class=\"hljs-title function_\">calc</span>(<span class=\"hljs-number\">100</span>% - #&#123;$hideSideBarWidth&#125;);<br>&#125;<br>&lt;/style&gt;<br></code></pre></td></tr></table></figure>\n\n<p>在 <code>styles/variables.scss</code> 中指定 <code>hideSideBarWidth</code></p>\n<figure class=\"highlight scss\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs scss\"><span class=\"hljs-variable\">$hideSideBarWidth</span>: <span class=\"hljs-number\">54px</span>;<br></code></pre></td></tr></table></figure>\n\n\n\n<h2 id=\"SidebarHeader-处理\"><a href=\"#SidebarHeader-处理\" class=\"headerlink\" title=\"SidebarHeader 处理\"></a>SidebarHeader 处理</h2><p>整个左侧的 <code>menu</code> 菜单，到现在咱们还剩下最后一个 <code>header</code> 没有进行处理</p>\n<p>在 <code>sidebar/index</code> 中写入如下代码</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\">&lt;template&gt;<br>  <span class=\"language-xml\"><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">div</span> <span class=\"hljs-attr\">class</span>=<span class=\"hljs-string\">&quot;&quot;</span>&gt;</span></span><br><span class=\"language-xml\">    <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">div</span> <span class=\"hljs-attr\">class</span>=<span class=\"hljs-string\">&quot;logo-container&quot;</span>&gt;</span></span><br><span class=\"language-xml\">      <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">el-avatar</span></span></span><br><span class=\"hljs-tag\"><span class=\"language-xml\">        <span class=\"hljs-attr\">size</span>=<span class=\"hljs-string\">&quot;44&quot;</span></span></span><br><span class=\"hljs-tag\"><span class=\"language-xml\">        <span class=\"hljs-attr\">shape</span>=<span class=\"hljs-string\">&quot;square&quot;</span></span></span><br><span class=\"hljs-tag\"><span class=\"language-xml\">        <span class=\"hljs-attr\">src</span>=<span class=\"hljs-string\">&quot;https://m.imooc.com/static/wap/static/common/img/logo-small@2x.png&quot;</span></span></span><br><span class=\"hljs-tag\"><span class=\"language-xml\">      /&gt;</span></span><br><span class=\"language-xml\">      <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">h1</span> <span class=\"hljs-attr\">class</span>=<span class=\"hljs-string\">&quot;logo-title&quot;</span> <span class=\"hljs-attr\">v-if</span>=<span class=\"hljs-string\">&quot;$store.getters.sidebarOpened&quot;</span>&gt;</span></span><br><span class=\"language-xml\">       imooc-admin</span><br><span class=\"language-xml\">      <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">h1</span>&gt;</span></span><br><span class=\"language-xml\">    <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">div</span>&gt;</span></span><br><span class=\"language-xml\">    ...</span><br><span class=\"language-xml\">  <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">div</span>&gt;</span></span><br>&lt;/template&gt;<br><br><span class=\"language-xml\"><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">style</span> <span class=\"hljs-attr\">lang</span>=<span class=\"hljs-string\">&quot;scss&quot;</span> <span class=\"hljs-attr\">scoped</span>&gt;</span><span class=\"language-css\"></span></span><br><span class=\"language-css\"><span class=\"language-xml\"><span class=\"hljs-selector-class\">.logo-container</span> &#123;</span></span><br><span class=\"language-css\"><span class=\"language-xml\">  <span class=\"hljs-attribute\">height</span>: <span class=\"hljs-number\">44px</span>;</span></span><br><span class=\"language-css\"><span class=\"language-xml\">  <span class=\"hljs-attribute\">padding</span>: <span class=\"hljs-number\">10px</span> <span class=\"hljs-number\">0</span> <span class=\"hljs-number\">22px</span> <span class=\"hljs-number\">0</span>;</span></span><br><span class=\"language-css\"><span class=\"language-xml\">  <span class=\"hljs-attribute\">display</span>: flex;</span></span><br><span class=\"language-css\"><span class=\"language-xml\">  <span class=\"hljs-attribute\">align-items</span>: center;</span></span><br><span class=\"language-css\"><span class=\"language-xml\">  <span class=\"hljs-attribute\">justify-content</span>: center;</span></span><br><span class=\"language-css\"><span class=\"language-xml\">  <span class=\"hljs-selector-class\">.logo-title</span> &#123;</span></span><br><span class=\"language-css\"><span class=\"language-xml\">    <span class=\"hljs-attribute\">margin-left</span>: <span class=\"hljs-number\">10px</span>;</span></span><br><span class=\"language-css\"><span class=\"language-xml\">    <span class=\"hljs-attribute\">color</span>: <span class=\"hljs-number\">#fff</span>;</span></span><br><span class=\"language-css\"><span class=\"language-xml\">    <span class=\"hljs-attribute\">font-weight</span>: <span class=\"hljs-number\">600</span>;</span></span><br><span class=\"language-css\"><span class=\"language-xml\">    <span class=\"hljs-attribute\">line-height</span>: <span class=\"hljs-number\">50px</span>;</span></span><br><span class=\"language-css\"><span class=\"language-xml\">    <span class=\"hljs-attribute\">font-size</span>: <span class=\"hljs-number\">16px</span>;</span></span><br><span class=\"language-css\"><span class=\"language-xml\">    <span class=\"hljs-attribute\">white-space</span>: nowrap;</span></span><br><span class=\"language-css\"><span class=\"language-xml\">  &#125;</span></span><br><span class=\"language-css\"><span class=\"language-xml\">&#125;</span></span><br><span class=\"language-css\"><span class=\"language-xml\"></span><span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">style</span>&gt;</span></span><br><br></code></pre></td></tr></table></figure>\n\n<p>创建 <code>styles/element.scss</code> 文件，统一处理 <code>el-avatar</code> 的背景问题</p>\n<figure class=\"highlight scss\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs scss\"><span class=\"hljs-selector-class\">.el-avatar</span> &#123;<br>  <span class=\"hljs-attr\">--el-avatar-background-color</span>: none;<br>&#125;<br></code></pre></td></tr></table></figure>\n\n<p>在 <code>styles/index.scss</code> 中导入</p>\n<figure class=\"highlight scss\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs scss\">...<br><span class=\"hljs-keyword\">@import</span> <span class=\"hljs-string\">&#x27;./element.scss&#x27;</span>;<br></code></pre></td></tr></table></figure>\n\n<p>统一处理下动画时长的问题，在 <code>styles/variables.scss</code> 中，加入以下变量</p>\n<figure class=\"highlight css\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs css\">$sideBarDuration: <span class=\"hljs-number\">0.28s</span>;<br></code></pre></td></tr></table></figure>\n\n<p>为 <code>styles/sidebar.scss</code> 修改时长</p>\n<figure class=\"highlight scss\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs scss\"><span class=\"hljs-selector-class\">.main-container</span> &#123;<br>  <span class=\"hljs-attribute\">transition</span>: margin-left #&#123;<span class=\"hljs-variable\">$sideBarDuration</span>&#125;;<br> ...<br>&#125;<br><br><span class=\"hljs-selector-class\">.sidebar-container</span> &#123;<br>  <span class=\"hljs-attribute\">transition</span>: width #&#123;<span class=\"hljs-variable\">$sideBarDuration</span>&#125;;<br>\t...<br>&#125;<br></code></pre></td></tr></table></figure>\n\n<p>为 <code>layout/index</code> 修改样式</p>\n<figure class=\"highlight scss\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs scss\"><span class=\"hljs-selector-class\">.fixed-header</span> &#123;<br>  ...<br>  <span class=\"hljs-attribute\">transition</span>: width #&#123;<span class=\"hljs-variable\">$sideBarDuration</span>&#125;;<br>&#125;<br></code></pre></td></tr></table></figure>\n\n<h1 id=\"Vue3-2：组件状态驱动的动态-CSS-值\"><a href=\"#Vue3-2：组件状态驱动的动态-CSS-值\" class=\"headerlink\" title=\"Vue3.2：组件状态驱动的动态 CSS 值\"></a>Vue3.2：组件状态驱动的动态 CSS 值</h1><p>在 <a href=\"https://blog.vuejs.org/posts/vue-3.2.html\">vue 3.2</a> 最新更新中，除了之前我们介绍的 <strong>响应式变化</strong> 之外，还有另外一个很重要的更新，那就是 <strong>组件状态驱动的动态 <code>CSS</code> 值</strong> ，对应的文档也已经公布，大家可以 <a href=\"https://v3.vuejs.org/api/sfc-style.html#state-driven-dynamic-css\">点击这里</a> 查看</p>\n<p>那么下面我们就使用下最新的特性，来为 <code>logo-container</code> 指定下高度：</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\">&lt;template&gt;<br> ...<br> &lt;el-avatar<br> \t:size=<span class=\"hljs-string\">&quot;logoHeight&quot;</span><br> ...<br><br>&lt;/template&gt;<br><br><span class=\"language-xml\"><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">script</span> <span class=\"hljs-attr\">setup</span>&gt;</span><span class=\"language-javascript\"></span></span><br><span class=\"language-javascript\"><span class=\"language-xml\">...</span></span><br><span class=\"language-javascript\"><span class=\"language-xml\"><span class=\"hljs-keyword\">const</span> logoHeight = <span class=\"hljs-number\">44</span></span></span><br><span class=\"language-javascript\"><span class=\"language-xml\"></span><span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">script</span>&gt;</span></span><br><br><span class=\"language-xml\"><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">style</span> <span class=\"hljs-attr\">lang</span>=<span class=\"hljs-string\">&quot;scss&quot;</span> <span class=\"hljs-attr\">scoped</span>&gt;</span><span class=\"language-css\"></span></span><br><span class=\"language-css\"><span class=\"language-xml\"><span class=\"hljs-selector-class\">.logo-container</span> &#123;</span></span><br><span class=\"language-css\"><span class=\"language-xml\">  <span class=\"hljs-attribute\">height</span>: <span class=\"hljs-built_in\">v-bind</span>(logoHeight) + <span class=\"hljs-string\">&#x27;px&#x27;</span>;</span></span><br><span class=\"language-css\"><span class=\"language-xml\">...</span></span><br><span class=\"language-css\"><span class=\"language-xml\">&#125;</span></span><br><span class=\"language-css\"><span class=\"language-xml\"></span><span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">style</span>&gt;</span></span><br><br></code></pre></td></tr></table></figure>\n\n<h1 id=\"动态面包屑方案分析\"><a href=\"#动态面包屑方案分析\" class=\"headerlink\" title=\"动态面包屑方案分析\"></a>动态面包屑方案分析</h1><p>面包屑导航分为：</p>\n<ol>\n<li>静态面包屑</li>\n<li>动态面包屑</li>\n</ol>\n<p><strong>静态面包屑：</strong></p>\n<p>指的是：<strong>在每个页面中写死对应的面包屑菜单</strong>，缺点也很明显：</p>\n<ol>\n<li>每个页面都得写一遍</li>\n<li>页面路径结构变化了，得手动更改</li>\n</ol>\n<p>简单来说就是 <strong>不好维护，不好扩展</strong> 。</p>\n<p><strong>动态面包屑：</strong></p>\n<p>根据当前的 <code>url</code> 自动生成面包屑导航菜单</p>\n<p>无论之后路径发生了什么变化，<strong>动态面包屑</strong> 都会正确的进行计算</p>\n<p>那么在后面的实现过程中，我们将会分成三大步来实现</p>\n<ol>\n<li>创建、渲染基本的面包屑组件</li>\n<li>计算面包屑结构数据</li>\n<li>根据数据渲染动态面包屑内容</li>\n</ol>\n<h2 id=\"渲染基本的面包屑组件\"><a href=\"#渲染基本的面包屑组件\" class=\"headerlink\" title=\"渲染基本的面包屑组件\"></a>渲染基本的面包屑组件</h2><p>完成第一步，先去创建并渲染出基本的 <a href=\"https://element-plus.org/#/zh-CN/component/breadcrumb\">面包屑</a> 组件</p>\n<p>创建 <code>components/Breadcrumb/index</code>，并写入如下代码：</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\">&lt;template&gt;<br>  <span class=\"language-xml\"><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">el-breadcrumb</span> <span class=\"hljs-attr\">class</span>=<span class=\"hljs-string\">&quot;breadcrumb&quot;</span> <span class=\"hljs-attr\">separator</span>=<span class=\"hljs-string\">&quot;/&quot;</span>&gt;</span></span><br><span class=\"language-xml\">    <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">el-breadcrumb-item</span> <span class=\"hljs-attr\">:to</span>=<span class=\"hljs-string\">&quot;&#123; path: &#x27;/&#x27; &#125;&quot;</span>&gt;</span>首页<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">el-breadcrumb-item</span>&gt;</span></span><br><span class=\"language-xml\">    <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">el-breadcrumb-item</span>&gt;</span><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">a</span> <span class=\"hljs-attr\">href</span>=<span class=\"hljs-string\">&quot;/&quot;</span>&gt;</span>活动管理<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">a</span>&gt;</span><span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">el-breadcrumb-item</span>&gt;</span></span><br><span class=\"language-xml\">    <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">el-breadcrumb-item</span>&gt;</span>活动列表<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">el-breadcrumb-item</span>&gt;</span></span><br><span class=\"language-xml\">    <span class=\"hljs-comment\">&lt;!-- 面包屑的最后一项 --&gt;</span></span><br><span class=\"language-xml\">    <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">el-breadcrumb-item</span>&gt;</span></span><br><span class=\"language-xml\">      <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">span</span> <span class=\"hljs-attr\">class</span>=<span class=\"hljs-string\">&quot;no-redirect&quot;</span>&gt;</span>活动详情<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">span</span>&gt;</span></span><br><span class=\"language-xml\">    <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">el-breadcrumb-item</span>&gt;</span></span><br><span class=\"language-xml\">  <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">el-breadcrumb</span>&gt;</span></span><br>&lt;/template&gt;<br><br><span class=\"language-xml\"><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">script</span> <span class=\"hljs-attr\">setup</span>&gt;</span><span class=\"language-javascript\"></span></span><br><span class=\"language-javascript\"><span class=\"language-xml\"><span class=\"hljs-keyword\">import</span> &#123;&#125; <span class=\"hljs-keyword\">from</span> <span class=\"hljs-string\">&#x27;vue&#x27;</span></span></span><br><span class=\"language-javascript\"><span class=\"language-xml\"></span><span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">script</span>&gt;</span></span><br><br><span class=\"language-xml\"><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">style</span> <span class=\"hljs-attr\">lang</span>=<span class=\"hljs-string\">&quot;scss&quot;</span> <span class=\"hljs-attr\">scoped</span>&gt;</span><span class=\"language-css\"></span></span><br><span class=\"language-css\"><span class=\"language-xml\"><span class=\"hljs-selector-class\">.breadcrumb</span> &#123;</span></span><br><span class=\"language-css\"><span class=\"language-xml\">  <span class=\"hljs-attribute\">display</span>: inline-block;</span></span><br><span class=\"language-css\"><span class=\"language-xml\">  <span class=\"hljs-attribute\">font-size</span>: <span class=\"hljs-number\">14px</span>;</span></span><br><span class=\"language-css\"><span class=\"language-xml\">  <span class=\"hljs-attribute\">line-height</span>: <span class=\"hljs-number\">50px</span>;</span></span><br><span class=\"language-css\"><span class=\"language-xml\">  <span class=\"hljs-attribute\">margin-left</span>: <span class=\"hljs-number\">8px</span>;</span></span><br><span class=\"language-css\"><span class=\"language-xml\"></span></span><br><span class=\"language-css\"><span class=\"language-xml\">  ::v-deep .no-redirect &#123;</span></span><br><span class=\"language-css\"><span class=\"language-xml\">    <span class=\"hljs-attribute\">color</span>: <span class=\"hljs-number\">#97a8be</span>;</span></span><br><span class=\"language-css\"><span class=\"language-xml\">    <span class=\"hljs-attribute\">cursor</span>: text;</span></span><br><span class=\"language-css\"><span class=\"language-xml\">  &#125;</span></span><br><span class=\"language-css\"><span class=\"language-xml\">&#125;</span></span><br><span class=\"language-css\"><span class=\"language-xml\"></span><span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">style</span>&gt;</span></span><br><br></code></pre></td></tr></table></figure>\n\n<p>在 <code>layout/components/Navbar</code> 组件下导入</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\">&lt;template&gt;<br>  <span class=\"language-xml\"><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">div</span> <span class=\"hljs-attr\">class</span>=<span class=\"hljs-string\">&quot;navbar&quot;</span>&gt;</span></span><br><span class=\"language-xml\">    <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">hamburger</span> <span class=\"hljs-attr\">class</span>=<span class=\"hljs-string\">&quot;hamburger-container&quot;</span> /&gt;</span></span><br><span class=\"language-xml\">    <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">breadcrumb</span> <span class=\"hljs-attr\">class</span>=<span class=\"hljs-string\">&quot;breadcrumb-container&quot;</span> /&gt;</span></span><br><span class=\"language-xml\">\t...</span><br><span class=\"language-xml\">  <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">div</span>&gt;</span></span><br>&lt;/template&gt;<br>...<br><br>&lt;style lang=<span class=\"hljs-string\">&quot;scss&quot;</span> scoped&gt;<br>.<span class=\"hljs-property\">navbar</span> &#123;<br> ...<br><br>  .<span class=\"hljs-property\">breadcrumb</span>-container &#123;<br>    <span class=\"hljs-attr\">float</span>: left;<br>  &#125;<br>   ...<br>&#125;<br>&lt;/style&gt;<br><br></code></pre></td></tr></table></figure>\n\n<h2 id=\"动态计算面包屑结构数据\"><a href=\"#动态计算面包屑结构数据\" class=\"headerlink\" title=\"动态计算面包屑结构数据\"></a>动态计算面包屑结构数据</h2><p>现在我们是完成了一个静态的 面包屑，接下来咱们就需要依托这个静态的菜单来完成动态的。</p>\n<p>对于现在的静态面包屑来说，他分成了两个组件：</p>\n<ol>\n<li><code>el-breadcrumb</code>：包裹性质的容器</li>\n<li><code>el-breadcrumb-item</code>：每个单独项</li>\n</ol>\n<p>如果我们想要完成动态的，那么就需要 *<em>依据动态数据，渲染 <code>el-breadcrumb-item</code> *</em></p>\n<p>所以说接下来我们需要做的事情就很简单了</p>\n<ol>\n<li>动态数据</li>\n<li>渲染 <code>el-breadcrumb-item</code></li>\n</ol>\n<p>咱们先来看 <strong>动态数据如何制作</strong></p>\n<p>我们希望可以制作出一个 <strong>数组</strong>，数组中每个 <code>item</code> 都表示一个 <strong>路由信息</strong>：</p>\n<p>创建一个方法，用来生成数组数据，在这里我们要使用到 <a href=\"https://next.router.vuejs.org/zh/api/#matched\">route.match</a> 属性来：<strong>获取与给定路由地址匹配的<a href=\"https://next.router.vuejs.org/zh/api/#routerecord\">标准化的路由记录</a>数组</strong></p>\n<p>如何理解上面这句话呢？其实我们将 <code>route.matched</code> 打印出来就可以发现，你每次切换菜单（或者说更换了路由），打印出来的就是当前路由的路由表（包含父级、子集的路由信息）。</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\">&lt;script setup&gt;<br><span class=\"hljs-keyword\">import</span> &#123; ref, reactive, watch &#125; <span class=\"hljs-keyword\">from</span> <span class=\"hljs-string\">&#x27;vue&#x27;</span><br><span class=\"hljs-keyword\">import</span> &#123; useRoute, <span class=\"hljs-title class_\">RouteRecordRaw</span> &#125; <span class=\"hljs-keyword\">from</span> <span class=\"hljs-string\">&#x27;vue-router&#x27;</span><br><br><span class=\"hljs-keyword\">const</span> breadcrumbData = ref&lt;<span class=\"hljs-title class_\">RouteRecordRaw</span>[]&gt;([]) <span class=\"hljs-comment\">// 存放计算出的面包屑数据</span><br><br><span class=\"hljs-keyword\">const</span> route = <span class=\"hljs-title function_\">useRoute</span>()<br><br><span class=\"hljs-keyword\">const</span> <span class=\"hljs-title function_\">getBreadcrumbData</span> = (<span class=\"hljs-params\"></span>) =&gt; &#123;<br>  <span class=\"hljs-variable language_\">console</span>.<span class=\"hljs-title function_\">log</span>(route.<span class=\"hljs-property\">matched</span>)<br><br>  <span class=\"hljs-comment\">// 只有存在 meta 并且 meta.title 的路由，我们才会显示到面包屑中</span><br>  <span class=\"hljs-comment\">// 就像 menu 菜单一样，类似 404 login 的我们不要显示</span><br>  breadcrumbData.<span class=\"hljs-property\">value</span> = route.<span class=\"hljs-property\">matched</span>.<span class=\"hljs-title function_\">filter</span>(<span class=\"hljs-function\"><span class=\"hljs-params\">r</span> =&gt;</span> r.<span class=\"hljs-property\">meta</span> &amp;&amp; r.<span class=\"hljs-property\">meta</span>.<span class=\"hljs-property\">title</span>)<br>&#125;<br><br><span class=\"hljs-comment\">// 监听路由变化时触发</span><br><span class=\"hljs-title function_\">watch</span>(<br>  route,<br>  <span class=\"hljs-function\">() =&gt;</span> &#123;<br>    <span class=\"hljs-title function_\">getBreadcrumbData</span>()<br>  &#125;,<br>  &#123;<br>    <span class=\"hljs-attr\">immediate</span>: <span class=\"hljs-literal\">true</span><br>  &#125;<br>)<br>&lt;/script&gt;<br></code></pre></td></tr></table></figure>\n\n<h2 id=\"依据动态数据，渲染面包屑\"><a href=\"#依据动态数据，渲染面包屑\" class=\"headerlink\" title=\"依据动态数据，渲染面包屑\"></a>依据动态数据，渲染面包屑</h2><p>有了数据之后，根据数据来去渲染面包屑就比较简单了。</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs vue\">&lt;template&gt;<br>  &lt;el-breadcrumb class=&quot;breadcrumb&quot; separator=&quot;/&quot;&gt;<br>    &lt;el-breadcrumb-item<br>      v-for=&quot;(item, index) in breadcrumbData&quot;<br>      :key=&quot;item.path&quot;<br>    &gt;<br>      &lt;!-- 不可点击项 --&gt;<br>      &lt;span v-if=&quot;index === breadcrumbData.length - 1&quot; class=&quot;no-redirect&quot;&gt;&#123;&#123;<br>        item.meta.title<br>      &#125;&#125;&lt;/span&gt;<br>      &lt;!-- 可点击项 --&gt;<br>      &lt;a v-else class=&quot;redirect&quot; @click.prevent=&quot;onLinkClick(item)&quot;&gt;&#123;&#123;<br>        item.meta.title<br>      &#125;&#125;&lt;/a&gt;<br>    &lt;/el-breadcrumb-item&gt;<br>  &lt;/el-breadcrumb&gt;<br>&lt;/template&gt;<br><br>&lt;script setup&gt;<br>import &#123; ref, watch &#125; from &#x27;vue&#x27;<br>import &#123; useRoute, useRouter, RouteRecordRaw &#125; from &#x27;vue-router&#x27;<br>import &#123; useStore &#125; from &#x27;vuex&#x27;<br><br>const breadcrumbData = ref&lt;RouteRecordRaw[]&gt;([]) // 存放计算出的面包屑数据<br><br>const store = useStore()<br>const route = useRoute()<br>const router = useRouter()<br>const getBreadcrumbData = () =&gt; &#123;<br>  console.log(route.matched)<br><br>  // 只有存在 meta 并且 meta.title 的路由，我们才会显示到面包屑中<br>  // 就像 menu 菜单一样，类似 404 login 的我们不要显示<br>  breadcrumbData.value = route.matched.filter(r =&gt; r.meta &amp;&amp; r.meta.title)<br>&#125;<br><br>watch(<br>  route,<br>  () =&gt; &#123;<br>    getBreadcrumbData()<br>  &#125;,<br>  &#123;<br>    immediate: true<br>  &#125;<br>)<br><br>// 跳转路由<br>const onLinkClick = (item: RouteRecordRaw) =&gt; &#123;<br>  router.push(item.path)<br>&#125;<br><br>// 将来需要进行主题替换，所以这里获取下动态样式<br>const linkHoverColor = ref(store.getters.cssVars.menuBg)<br>&lt;/script&gt;<br><br>&lt;style lang=&quot;scss&quot; scoped&gt;<br>.breadcrumb &#123;<br> ...<br><br>  .redirect &#123;<br>    color: #666;<br>    font-weight: 600;<br>  &#125;<br><br>  .redirect:hover &#123;<br>    color: v-bind(linkHoverColor); // 应对主题切换<br>  &#125;<br>&#125;<br>&lt;/style&gt;<br><br></code></pre></td></tr></table></figure>\n\n<h2 id=\"面包屑动画\"><a href=\"#面包屑动画\" class=\"headerlink\" title=\"面包屑动画\"></a>面包屑动画</h2><p>vue3对 <a href=\"https://v3.cn.vuejs.org/guide/transitions-overview.html#%E5%9F%BA%E4%BA%8E-class-%E7%9A%84%E5%8A%A8%E7%94%BB%E5%92%8C%E8%BF%87%E6%B8%A1\">动画</a> 进行了一些修改（<a href=\"https://v3.cn.vuejs.org/guide/migration/transition.html#%E6%A6%82%E8%A7%88\">vue 动画迁移文档</a>）</p>\n<p>主要的修改其实只有两个：</p>\n<ol>\n<li>过渡类名 <code>v-enter</code> 修改为 <code>v-enter-from</code></li>\n<li>过渡类名 <code>v-leave</code> 修改为 <code>v-leave-from</code></li>\n</ol>\n<p>那么依据修改之后的动画，我们来为面包屑增加一些动画样式：</p>\n<ol>\n<li>在 <code>Breadcrumb/index</code> 中增加 <code>transition-group</code></li>\n</ol>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\">&lt;template&gt;<br>  <span class=\"language-xml\"><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">el-breadcrumb</span> <span class=\"hljs-attr\">class</span>=<span class=\"hljs-string\">&quot;breadcrumb&quot;</span> <span class=\"hljs-attr\">separator</span>=<span class=\"hljs-string\">&quot;/&quot;</span>&gt;</span></span><br><span class=\"language-xml\">    <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">transition-group</span> <span class=\"hljs-attr\">name</span>=<span class=\"hljs-string\">&quot;breadcrumb&quot;</span>&gt;</span></span><br><span class=\"language-xml\">      ...</span><br><span class=\"language-xml\">    <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">transition-group</span>&gt;</span></span><br><span class=\"language-xml\">  <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">el-breadcrumb</span>&gt;</span></span><br>&lt;/template&gt;<br></code></pre></td></tr></table></figure>\n\n<ol start=\"2\">\n<li>新建 <code>styles/transition</code> 样式文件</li>\n</ol>\n<figure class=\"highlight scss\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs scss\"><span class=\"hljs-selector-class\">.breadcrumb-enter-active</span>,<br><span class=\"hljs-selector-class\">.breadcrumb-leave-active</span> &#123;<br>  <span class=\"hljs-attribute\">transition</span>: all <span class=\"hljs-number\">0.5s</span>;<br>&#125;<br><br><span class=\"hljs-selector-class\">.breadcrumb-enter-from</span>,<br><span class=\"hljs-selector-class\">.breadcrumb-leave-active</span> &#123;<br>  <span class=\"hljs-attribute\">opacity</span>: <span class=\"hljs-number\">0</span>;<br>  <span class=\"hljs-attribute\">transform</span>: translateX(<span class=\"hljs-number\">20px</span>);<br>&#125;<br><br><span class=\"hljs-selector-class\">.breadcrumb-leave-active</span> &#123;<br>  <span class=\"hljs-attribute\">position</span>: absolute;<br>&#125;<br></code></pre></td></tr></table></figure>\n\n<ol start=\"3\">\n<li>在 <code>styles/index</code> 中导入</li>\n</ol>\n<figure class=\"highlight scss\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs scss\"><span class=\"hljs-keyword\">@import</span> <span class=\"hljs-string\">&#x27;./transition.scss&#x27;</span>;<br></code></pre></td></tr></table></figure>\n\n<h1 id=\"总结\"><a href=\"#总结\" class=\"headerlink\" title=\"总结\"></a>总结</h1><p>到这里我们的 layout 整体架构就已经做完了，我们来看看效果吧。</p>\n<p><img src=\"/img/layout-result.png\" alt=\"\"></p>\n"},{"layout":"JavaScript","title":"温故而知新（JavaScript）","date":"2023-05-12T10:55:02.000Z","banner_img":"/img/js.jpg","index_img":"/img/js.jpg","excerpt":"JavaScript","_content":"\n# 数据类型(7)\n1. 原始数据类型(6种)\na. 数值\nb. 字符串\nc. 布尔值\nd. undefined\ne. Null\nf. Symbol（ECMAScript 6 新增）\n\ng.任意精度的整数 (BigInt) ，可以安全地存储和操作大整数，甚至可以超过数字的安全整数限制\n\n2. 引用数据类型\na. 对象\nb. 数组\nc. 函数\n...\n\n# 运算符\n\n加减乘除、取模、自增自减\n\n```js\nvar a = 1;\nvar b;\n\nvar sum = (b = a++ + --a) + a-- + b++;\n```\n\n\n# 数组\n\n## 创建数组\n\n```js\nvar arr = [1,2,3]\nvar arr = new Array()\n\nvar arr = new Array(9)\nvar arr = new Array('first', 'second', 'name')\n```\n\n## 数组方法\nconcat: 连接两个或多个数组，并返回一个新数组。\n\njoin: 将数组中的所有项连接成一个字符串。\n\npop: 删除并返回数组的最后一项。\n\npush: 在数组的末尾添加一个或多项并返回数组的新长度。\n\nshift: 删除并返回数组的第一项。\n\nunshift: 在数组的开头添加一个或多项。\n\nslice: 返回一个数组的片段，该片段包括开始索引到结束索引（不包括结束索引）的所有项。\n\nsplice: 在数组中插入、删除或替换项。\n\nsort: 对数组的所有项进行排序。\n\nreverse: 反转数组中的项的顺序。\n\nindexOf: 返回数组中第一个与给定值匹配的项的索引，如果未找到，则返回 -1。\n\nlastIndexOf: 返回数组中最后一个与给定值匹配的项的索引，如果未找到，则返回 -1。\n\nforEach: 对数组中的每一项执行给定的回调函数。\n\nmap: 对数组中的每一项执行给定的回调函数，并返回一个新数组，其中的每一项是回调函数的返回值。\n\nfilter: 对数组中的每一项执行给定的回调函数，并返回一个新数组，其中只包含回调函数返回 true 的项。\n\nreduce: 从左到右对数组中的所有项进行累加，并返回单个值。\n\nreduceRight: 从右到左对数组中的所有项进行累加，并返回单个值。\n\nsome: 如果数组中至少有一个项通过了给定的测试，则返回 true，否则返回 false。\n\nevery: 如果数组中的所有项都通过了给定的测试，则返回 true，否则返回 false。\n\n\n# JS编译原理\n\nJavaScript 是一种解释型语言，而非编译型语言。这意味着，JavaScript 代码在运行时被动态解释，而不是在编译时预先翻译成机器代码。\n\n在 JavaScript 中，代码会被加载到浏览器或 Node.js 环境中，然后通过 JavaScript 引擎（例如 V8）解释和执行代码。在解释代码之前，JavaScript 引擎会对代码进行词法分析和语法分析，以确定代码的语法正确性和语义。然后，代码将被执行。\n\n总的来说，JavaScript 没有明确的编译过程，但它在加载和运行代码之前经过了词法和语法分析。\n\n\n## 词法分析\n\n词法分析的目的是将 JavaScript 代码的字符串形式转换为一系列词法单元 (tokens)，每个词法单元代表 JavaScript 代码的一个有意义的组成部分，如变量名，运算符，函数等。\n\n## 语法分析\n\n语法分析的目的是将词法单元组合成语法树，语法树代表 JavaScript 代码的结构和语义。\n\n\n# 闭包\n\n产生条件\n\n1. 函数内部有另一个函数\n\n2. 函数内部的函数里面用到了外部函数的局部变量\n\n3. 外部函数将内部函数作为返回值 return 出去了。\n\n好处：\n\n闭包中的变量，充当全局变量使用，减少全局变量的混乱程度。\n\n清除：\n\n将变量设置为 null 即可。\n\n# new关键字\n\n当我们在代码中使用 new 关键字，它会执行以下操作：\n\n- 创建一个空对象\n- 将该对象的原型链指向构造函数的原型对象\n- 将函数内部的 this 关键字指向新创建的对象\n- 在新创建的对象上执行构造函数中的代码\n- 返回该对象\n\n# this\n\n1. 普通函数中，谁调用此函数，this 就指向谁。箭头函数中没有自己的this，在哪里定义，或者说箭头函数外部的this指向谁，就是谁。\n\n2. 方法中的this，指向调用方法的对象。\n\n3. 指向全局对象：全局函数中的this\n\n4. 事件中的 this，指向 dom 对象。\n\n5. 构造函数中的 this，指向 new 创建的对象。\n\n# call、apply、bind\n\n它们的作用都是为了改变 this 的指向\n\n区别是参数不同，第一个参数是想要使用的对象，第二个参数是传递给函数的参数\n\n```js\nconst dog = {\n  name: 'is dog',\n  sayName(name1, name2, name3) {\n    console.log(this.name)\n  }\n}\n\nconst cat = {\n  name: '喵喵喵'\n}\n\ndog.sayName.call(cat, 1, 2, 3)\ndog.sayName.apply(cat, [1, 2, 3])\n\nconst fn = dog.sayName.bind(cat, 1, 2, 3)\nfn()\n\n```\n\n\n```js\nconst cat = {\n  name: '喵喵喵',\n  sayName() {\n\n    // 等价于 window 对象调用定时器\n    setTimeout(function() {\n      console.log(this) // window\n    })\n  }\n}\n\nconst cat = {\n  name: '喵喵喵',\n  sayName() {\n    setTimeout(() => {\n      console.log(this) // cat\n      console.log(this.name) // 喵喵喵\n    })\n  }\n}\n\ncat.sayName()\n```\n\n# nextTick 和 setImmediate\n\n同步代码执行完毕，执行 nextTick，然后是异步代码（setTimeout），最后执行 setImmediate\n\n```js\nsetImmediate(() => {\n  console.log('setImmediate')\n})\n\nprocess.nextTick(() => {\n  console.log(1)\n})\n\nconsole.log(2)\n\nsetTimeout(() => {\n  console.log(3)\n}, 0);\n\n\n// =>>>>>>  2 1 3 setImmediate\n```\n\n\nsetImmediate表示当前事件循环即将结束时，执行。\n\n```js\nsetImmediate(() => {\n  console.log('setImmediate')\n})\n\nprocess.nextTick(() => {\n  console.log(1)\n})\n\nconsole.log(2)\n\nsetTimeout(() => {\n  console.log(3)\n}, 0);\nsetTimeout(() => {\n  console.log(4)\n}, 1000);\nsetTimeout(() => {\n  console.log(5)\n}, 0);\n\n\nconsole.log(6)\n\n// =====> 2 6 1 3 5 setImmediate 4(一秒后输出4)\n```\n\n# 宏任务&微任务\n\n宏任务：计时器、ajax、读取文件\n\n微任务：promise.then\n\n一次事件循环的执行顺序:\n\n1. 同步程序\n\n2. process.nextTick\n\n3. 微任务\n\n4. 宏任务\n\n5. setImmediate\n\n```js\n// 当前事件循环最后执行\nsetImmediate(() => {\n  console.log('setImmediate')\n})\n\n// 宏任务执行完毕之后 微任务执行之前执行\nprocess.nextTick(() => {\n  console.log(1)\n})\n\n// 立即执行\nconsole.log(2)\n\nnew Promise(r => {\n  // 立即执行\n  console.log(7)\n  r()\n}).then(() => {\n  // 微任务，process.nextTick 执行之后执行\n  console.log(8)\n})\n\n// 宏任务\nsetTimeout(() => {\n  // 微任务执行后执行\n  console.log(3)\n}, 0);\nsetTimeout(() => {\n  // 放到下一次循环中执行\n  console.log(4)\n}, 1000);\nsetTimeout(() => {\n  // 微任务执行后执行\n  console.log(5)\n}, 0);\n\n// 立即执行\nconsole.log(6)\n\n\n// 2 7 6 1 8 3 5 setImmediate 4\n```\n\n# 浅拷贝、深拷贝\n\n浅拷贝\n\n```js\nconst obj = {\n  name: 'is obj',\n  girlfriend: {\n    name: '小红'\n  }\n}\n\nconst o = Object.assign({}, obj)\n\nobj.name = 'is o'\nobj.girlfriend.name = '小花'\n\nconsole.log(o)\n```\n\n深拷贝\n\n```js\nconst obj = {\n  name: 'is obj',\n  girlfriend: {\n    name: '小红'\n  }\n}\n\nfunction deepClone(obj) {\n  const o = {}\n\n  for (const key in obj) {\n    if (Object.hasOwnProperty.call(obj, key)) {\n      \n      if(typeof obj[key] === 'object') {\n        o[key] = deepClone(obj[key])\n      } else {\n        o[key] = obj[key];\n      }\n    }\n  }\n\n  return o\n}\n```\n\n# JSON.stringify实现深克隆\n\n将一个 JSON 对象，转化为字符串，通过 JSON.parse 将字符串转化为对象，从而实现深克隆\n\n```js\nconst obj = {\n  name: 'is obj',\n  girlfriend: {\n    name: '小红'\n  }\n}\n\nconst o = JSON.parse(JSON.stringify(obj))\n\nconsole.log(o)\n```\n\nJSON.stringify 存在的问题：\n\n如果属性值是 undefined 或者是方法（含箭头函数），克隆出来后，undefined 和函数会丢失\n\n# parseInt\n\n> parseInt(string, radix) 解析一个字符串并返回指定基数的十进制整数，radix 是 2-36 之间的整数，表示被解析字符串的基数。\n\nstring: 要被解析的值。\n- 如果参数不是一个字符串，则将其转换为字符串 (使用 ToString抽象操作)。\n- 字符串开头的空白符将会被忽略。\n\n## **parseInt (0.0000005) === 5 为 true**\n\n```js\n(0.5).toString(); //  '0.5'\n(0.05).toString(); //  '0.05'\n(0.005).toString(); //  '0.005'\n(0.0005).toString(); //  '0.0005'\n(0.00005).toString(); //  '0.00005'\n(0.000005).toString(); //  '0.000005'\n(0.0000005).toString(); //  '5e-7'\n```\n- 可以发现当数字过小时，toString 输出的结果是科学计数法形式。\n- parseInt 只能将字符串的前导部分解释为整数值；它忽略任何不能被解释为整数的代码单元，并且不会有忽略指示。\n\n```js\nparseInt(0.5) // 0\n\nparseInt(0.0000005) // 5\n```\n\n## radix 默认值是 10 吗，何种情况返回值是 NaN？\n\n1. 当 radix 值为 undefined、0 或未指定的，那 JavaScript 会如何处理这种情况:\n\n- 如果输入的 string 以 0x 或 0X 开头，那么 radix 会被假定为 16 ，字符串的其他部分按照十六进制来解析。\n```js\nparseInt('0x51') // 5*16^1 + 1*16^0 = 81\n```\n- 如果输入的 string 以 0 开头，ES5 规定使用十进制，但并非所有的浏览器都支持，因此使用 parseInt 时，需要指定 radix\n- 如果输入的 string 以其他任何值开头，radix 值为 10\n\n2. radix 参数的值为 2 ~ 36，当 radix 小于 2 或 大于 36(不包含 0)，返回值为 NaN\n\n```js\nparseInt(\"123\", 1); // NaN\nparseInt(\"123\", 38); // NaN\nparseInt(\"123\", -1); // NaN\n```\n\n3. 待转换字符串中，所有的可转换数字都不小于 radix 值\n\n例如 radix 值为 2 (二进制)，而待转换字符串为 '3456'，二进制内只有 0、1 是基本算符，因此字符串 '3456' 无法转换成二进制，返回值为 NaN。\n\n```js\nparseInt(\"3456\", 2); // NaN\nparseInt(\"45px\", 3); // NaN\n```\n\n## ['1', '2', '3'].map(parseInt)\n\n> [parseInt(\"1\", 0), parseInt(\"2\", 1), parseInt(\"3\", 2)]\n\n- parseInt(\"1\", 0)\nradix 为 0，且 string 以字符 1 开始，radix 值为 10，值为 1。\n\n- parseInt(\"2\", 1)\n符合 2.2 ，radix 小于 2，返回 NaN\n\n- parseInt(\"3\", 2)\n待转换字符串中，所有的可转换数字大于 radix 值，返回 NaN\n\n# 渲染进程\n\n- GUI渲染线程\n  - 负责渲染页面，布局和绘制\n  - 页面需要重绘和回流时，该线程就会执行\n  - 与js引擎线程互斥，防止渲染结果不可预期\n\n- JS引擎线程\n  - 负责处理解析和执行javascript脚本程序\n  - 只有一个JS引擎线程（单线程）\n  - 与GUI渲染线程互斥，防止渲染结果不可预期\n\n- 事件触发线程\n  - 用来控制事件循环（鼠标点击、setTimeout、ajax等）\n  - 当事件满足触发条件时，将事件放入到JS引擎所在的执行队列中\n\n- 定时触发器线程\n  - setInterval与setTimeout所在的线程\n  - 定时任务并不是由JS引擎计时的，是由定时触发线程来计时的\n  - 计时完毕后，通知事件触发线程\n\n\n- 异步http请求线程\n  - 浏览器有一个单独的线程用于处理AJAX请求\n  - 当请求完成时，若有回调函数，通知事件触发线程\n\n# 为什么 javascript 是单线程的?\n\n首先是历史原因，在创建 javascript 这门语言时，多进程多线程的架构并不流行，硬件支持并不好。\n\n其次是因为多线程的复杂性，多线程操作需要加锁，编码的复杂性会增高。\n\n而且，如果同时操作 DOM ，在多线程不加锁的情况下，最终会导致 DOM 渲染的结果不可预期。\n\n# 为什么 GUI 渲染线程与 JS 引擎线程互斥?\n\n这是由于 JS 是可以操作 DOM 的，如果同时修改元素属性并同时渲染界面(即 JS线程和UI线程同时运行)，\n那么渲染线程前后获得的元素就可能不一致了。\n\n因此，为了防止渲染出现不可预期的结果，浏览器设定 GUI渲染线程和JS引擎线程为互斥关系，\n当JS引擎线程执行时GUI渲染线程会被挂起，GUI更新则会被保存在一个队列中等待JS引擎线程空闲时立即被执行。\n\n# 如何理解 JS 的运行机制（Event Loop）?\n\n> https://juejin.cn/post/6844903919789801486\n\n## 核心概念\n\n1. JS分为同步任务和异步任务\n2. 同步任务都在 `JS 引擎线程` 上执行，形成一个执行栈\n3. `事件触发线程` 管理一个任务队里，异步任务触发条件达成，将回调事件放入执行栈中执行\n4. 执行栈中所有同步任务执行完毕，此时JS引擎线程空闲，系统会读取任务队列，将可运行的异步任务回调事件添加到执行栈中，开始执行\n\n## Event Loop\n\n1. 执行一个宏任务（栈中没有，就从任务队列中获取）\n2. 执行过程中如果遇到了微任务，就将它添加到微任务的任务队列中\n3. 宏任务执行完毕，立即执行微任务队列中的所有微任务（依次执行）\n4. 当前宏任务执行完毕，开始检查渲染，然后 GUI 渲染线程接管，开始渲染\n5. 渲染完毕后，JS 线程接管，开始下一个宏任务（从任务队列中获取）\n\n<img src=\"/img/event loop.jpg\" />\n\n# var 和 let 的区别\n\n1. var 声明的变量，其作用域为当前函数、模块或全局；let 声明的变量，其作用域总是在当前的代码块，例如语句块。\n2. 在同一个代码块中，var可以多次声明变量名；let只能声明一次，覆盖一个已经声明的 let 变量会导致语法错误。\n3. 用户可以在声明语句之前使用 var 变量，其值是 undefined. 而 let 必须先声明后使用。\n4. 全局模块下，var 声明的变量作为global上的属性，let声明的变量则不是 global上的属性，而是作为全局模块中的标识符。\n\n# 垃圾回收机制\n\n- 引用计数：被引用，则计数+1，不再引用，计数减一。存在循环引用问题。\n- 标记清除（常用）：当变量进入到执行环境，则标记上已进入执行环境，当执行完成后，变量离开执行环境则标记已离开执行环境。\n\n# 原型链 & 继承\n\n每个构造函数都有一个原型对象（prototype），原型有一个属性（constructor）指回构造函数，而实例有一个内部指针（__proto__）指向原型。\n\n原型链最顶端是 null\n\n任何函数的默认原型都是一个Object的实例，这意味着这个实例有一个内部指针指向Object.prototype。\n\n这也是为什么自定义类型能够继承包括toString()、valueOf()在内的所有默认方法的原因\n\n```js\n\nfunction Person(params) {\n    console.log(params)\n}\nconst p = new Person(1)\n\np.__proto__.constructor === Person >>> true\n\np.__proto__ === Person.prototype >>> true\n\np.__proto__.__proto__ === Object.prototype >>> true\n\np.__proto__.__proto__.constructor === Object >>> true\n\np.__proto__.__proto__.__proto__ === null\n```\n\n## 原型与继承的关系\n\n原型与实例的关系可以通过`两种`方式来确定。\n\n第一种方式是使用`instanceof操作符`，**如果一个实例的原型链中出现过相应的构造函数，则instanceof返回true**\n\n```js\no instanceof Object // true 实例的原型链中出现过相应的构造函数\n```\n\n第二种方式是使用`isPrototypeOf()`方法\n\n```js\nObject.prototype.isPrototypeOf(o)\n```\n\n## 原型链的问题\n\n问题一：原型中包含的引用值会在所有实例间共享\n\n```js\nfunction Super() {\n  this.colors = ['red', 'blue']\n}\n\nfunction Sub() {}\n\nSub.prototype = new Super() // Super 实例的属性值，变成了 Sub 原型对象上的属性\n\nconst o1 = new Sub()\n\no1.colors.push('black')\n\n// 所有实例共享原型对象上的 colors\nconst o2 = new Sub()\nconsole.log(o2.colors) // ['red', 'blue', 'black']\n```\n\n问题二：子类型在实例化时不能给父类型的构造函数传参\n\n## 盗用构造函数继承\n\n> 为了解决原型包含引用值导致的继承问题\n\n在子类构造函数中调用父类构造函数。\n\n```js\nfunction Super() {\n  this.colors = ['red', 'blue']\n}\n\nfunction Sub() {\n  // 实例化 Sub 时，给每个 Sub 实例上都复制（拷贝）一份 colors，实例间不共享 colors，都有属于自己的那一份 colors\n  Super.call(this)\n}\n\nconst o1 = new Sub()\no1.colors.push('black')\n\nconst o2 = new Sub()\nconsole.log(o2.colors) // ['red', 'blue']\n```\n\n也可以给父类传递参数\n\n```js\nfunction Sub() {\n  Super.call(this, 'Hello world')\n\n  // 这里可以额外添加属性\n  this.age = 18\n}\n```\n\n盗用构造函数也是有缺点的：\n\n1. 不是原型链继承，无法使用父类原型对象上的属性和方法。\n2. 父类上定义的所有属性和方法，都会被复制到子类实例上，如果属性和方法太多，占用内存就会较大。并且继承的目的是为了属性和方法的`复用`，而且借用构造函数是将父类定义的方法和属性进行了`复制`。\n\n\n## 组合继承（伪经典继承）\n\n> 综合了原型链和借用构造函数\n\n基本的思路是使用原型链继承原型上的属性和方法，而通过盗用构造函数继承实例属性。这样既可以把方法定义在原型上以实现重用，又可以让每个实例都有自己的属性。\n\n```js\nfunction Person(name) {\n  this.name = name\n  this.colors = ['red', 'blue']\n}\n\nPerson.prototype.sayName = function() {\n  console.log(this.name)\n}\n\nfunction User(name) {\n\n  // 借用构造函数\n  Person.call(this, name)\n\n  this.age = 19\n}\n\n// 原型链继承\nUser.prototype = new Person()\n\nconst u = new User('xiaoming')\n\nconsole.log(u.sayName())\n```\n\n组合继承弥补了原型链和盗用构造函数的不足，是JavaScript中使用最多的继承模式。而且组合继承也保留了 `instanceof操作符` 和 `isPrototypeOf()` 方法识别合成对象的能力。\n\n```js\n// true\n\nconsole.log(u instanceof User)\nconsole.log(u instanceof Person)\nconsole.log(User.prototype.isPrototypeOf(u))\nconsole.log(Person.prototype.isPrototypeOf(u))\n```\n\n## 原型式继承\n\n> 创建一个临时构造函数，将传入的对象赋值给这个构造函数的原型，然后返回这个临时类型的一个实例\n\n```js\nfunction object(o) {\n  function F() {}\n\n  F.prototype = o\n\n  return new F()\n}\n```\n\nECMAScript 5通过增加`Object.create()`方法将原型式继承的概念规范化了。这个方法接收两个参数：作为新对象原型的对象，以及给新对象定义额外属性的对象（第二个可选: Object.defineProperties()）。在只有一个参数时，Object.create()与这里的object()方法效果相同。\n\n在 `组合式继承`中，我们可以将原型链继承那部分可以改写一下:\n\n```js\nUser.prototype = Object.create(Person.prototype)\n```\n\n## 寄生式继承\n\n> 创建一个实现继承的函数，以某种方式增强对象，然后返回这个对象\n\n```js\nfunction createAnother(original){\n  let clone = Object.create(original) // 通过调用函数创建一个新对象\n\n  clone.sayHi = function() { // 以某种方式增强这个对象\n    console.log(\"hi\")\n  }\n  return clone\n}\n```\n\n## 寄生式组合继承(继承的最佳模式)\n\n组合继承其实也存在效率问题。最主要的效率问题就是父类构造函数始终会被调用两次：一次在是创建子类原型时调用，另一次是在子类构造函数中调用。\n\n```js\n  function SuperType(name) {\n    this.name = name;\n    this.colors = [\"red\", \"blue\", \"green\"];\n  }\n  SuperType.prototype.sayName = function() {\n    console.log(this.name);\n  };\n  function SubType(name, age){\n    SuperType.call(this, name);   //第二次调用SuperType()\n    this.age = age;\n  }\n  SubType.prototype=newSuperType();   //第一次调用SuperType()\n  SubType.prototype.constructor = SubType;\n  SubType.prototype.sayAge = function() {\n    console.log(this.age);\n  };\n```\n\n有两组name和colors属性：一组在实例上，另一组在SubType的原型上。\n\n<img src=\"/img/组合继承.jpg\" />\n\n> 寄生式组合继承通过盗用构造函数继承属性，但使用混合式原型链继承方法。基本思路是不通过调用父类构造函数给子类原型赋值，而是取得父类原型的一个副本。\n\n说到底就是使用寄生式继承来继承父类原型，然后将返回的新对象赋值给子类原型。\n\n```js\nfunction inheritPrototype(subType, superType) {\n  const prototype = Object.create(superType.prototype) // 将superType.prototype作为新对象的原型对象\n\n  prototype.constructor = subType // 增强对象\n\n  subType.prototype = prototype// 新对象赋值给子类原型\n}\n```\n\n我们再来改写 `组合继承`\n\n```js\nfunction SuperType(name) {\n  this.name = name;\n  this.colors = [\"red\", \"blue\", \"green\"];\n}\nSuperType.prototype.sayName = function() {\n  console.log(this.name);\n};\nfunction SubType(name, age) {\n  SuperType.call(this, name);\n  this.age = age;\n}\n\ninheritPrototype(SubType, SuperType);\n\nSubType.prototype.sayAge = function() {\n  console.log(this.age);\n};\n```\n\n这里只调用了一次SuperType构造函数，避免了SubType.prototype上不必要也用不到的属性，因此可以说这个例子的效率更高。\n\n而且，原型链仍然保持不变，因此instanceof操作符和isPrototypeOf()方法正常有效。寄生式组合继承可以算是引用类型`继承的最佳模式`。\n\n## ES6 class 的 extends 关键字\n\n```js\nclass Point {\n  constructor(x, y) {\n    this.x = x\n    this.y = y\n  }\n}\n\nclass ColorPoint extends Point {\n  constructor(x, y, color) {\n    super(x, y) // 必须调用 super (父类的 this 对象)\n\n    this.color = color\n  }\n}\n```\n\n子类必须在constructor方法中调用super方法，否则新建实例时会报错。这是因为子类没有自己的this对象，而是继承了父类的this对象，然后对其进行加工。如果不调用super方法，子类就得不到this对象。\n\n如果在一个方法前加上static关键字，就表示该方法不会被实例继承，而是直接通过类调用，称为“静态方法”。\n\n```js\nclass Foo {\n  static staticMethod() {\n    console.log('static')\n  }\n}\n\nFoo.staticMethod()\n```\n\n父类的静态方法可以被子类继承。\n\n```js\nclass Bar extends Foo {}\n\nBar.staticMethod() // static\n```\n\n父类的静态方法可以在子类中通过 `super` 关键字调用。\n\n```js\nclass Bar extends Foo {\n  static say() {\n    return super.staticMethod() + ' method'\n  }\n}\n\nBar.say() // static method\n```\n\n# class 和构造函数有什么区别？\n\n1. 类必须使用new调用，直接调用会报错\n\n2. 类和模块的内部，默认就是严格模式，所以不需要使用use strict指定运行模式。\n\n3. 类不存在变量提升（hoist），这一点与 ES5 完全不同。\n\n4. 类的内部所有定义的方法，都是不可枚举的\n\n5. 子类必须在constructor方法中调用super方法，否则新建实例时会报错。\n\n    这是因为子类自己的this对象，必须先通过父类的构造函数完成塑造，得到与父类同样的实例属性和方法，然后再对其进行加工，加上子类自己的实例属性和方法。如果不调用super方法，子类就得不到this对象。\n\nsuper作为函数调用时，代表父类的构造函数。\n\n```js\n<script>\nclass A {}\nclass B extends A { constructor() { super() }}\n</script>\n```\n\nsuper虽然代表了父类A的构造函数，但是返回的是子类B的实例，即super内部的this指的是B的实例，因此super()在这里相当于A.prototype.constructor.call(this)。\n\n**继承区别**\n\n1. ES5 的继承，实质是先创造子类的实例对象this，然后再将父类的方法添加到this上面 Parent.call(this)\n\n\n2. ES6 的继承机制，实质是先将父类实例对象的属性和方法加到this上面（所以必须先调用super方法），然后再用子类的构造函数修改this。\n\n# 防抖&节流\n\n防抖：用户触发事件频繁，只需要用户最后一次操作的结果\n\n```js\nconst input = document.querySelector('input')\nlet timer = null\n\ninput.oninput = function(){\n  if (timer !== null) {\n    timer = clearTimeout(timer)\n  }\n\n  timer = setTimeout(() => {\n    console.log(this.value)\n  }, 1000)\n\n}\n```\n\n封装防抖函数\n\n```js\nfunction debounce(fn, delay = 500) {\n  // 闭包\n  let timer = null\n  // this ===> window\n\n  return function() {\n    // this ===> input\n    if (timer !== null) {\n      clearTimeout(timer)\n    }\n\n    timer = setTimeout(() => {\n      fn.call(this)\n    }, delay);\n  }\n}\n\nconst input = document.querySelector('#input')\n\ninput.oninput = debounce(function() {\n  console.log('value: ', this.value)\n}, 800)\n```\n\n节流：控制事件执行的次数，每个多少时间间隔执行一次。\n\n比如监听滚动条的触发事件。\n\n```js\nlet time = 0\nwindow.onscroll = function() {\n  if (Date.now() - time > 1000) {\n    console.log('执行')\n    time = Date.now()\n  }\n}\n```\n\n封装节流函数 throttle\n\n```js\nfunction throttle(fn, delay) {\n  let time = 0\n\n  return function() {\n    let now = Date.now()\n    if (now - time > delay) {\n      fn.call(this)\n      time = now\n    }\n  }\n}\n```\n\n\n# 纯函数\n\n1. 函数的返回结果只依赖于它的参数，相同的输入始终得到相同的输出。\n2. 函数执行过程中没有副作用（不改变、不依赖外部任何可观察的变化）\n\n```js\n\nfunction add(a, b) {\n  return a + b;\n}\n\nadd(1, 2)\n```\n\n## 可缓存的纯函数\n\n当我们的计算量非常大，可能耗时很长或者很好性能，那么我们通过缓存的方式，避免函数多次计算。从而，计算了一次之后，以后再输入相同的参数，就直接返回上次计算的结果。\n\n\n> lodash.memozie(add, resolver)\n\n实现 memoize 函数\n\n```js\nfunction add(a, b) {\n  console.log('计算中...')\n\n  return a + b\n}\n\nconst resolver = (...args) => JSON.stringify(args)\n\nfunction memoize(func, resolver) {\n  const cache = {}\n\n  return function(...args) {\n    const key = resolver(...args) // \"[a, b]\"\n\n    if (cache[key]) {\n      return cache[key]\n    } else {\n      return cache[key] = func(...args)\n    }\n  }\n}\n\nconst memoized = memoize(add, resolver)\n\nconsole.log(memoized(9, 9)) // 第一次打印 \"计算中...\"\nconsole.log(memoized(9, 9)) // 不会打印\nconsole.log(memoized(9, 9)) // 不会打印\n```\n\n\n# 函数柯里化\n\n给一个函数传入一部分参数，让其返回的函数接收剩余的参数。直到所有的参数都给到了，才会计算结果。\n\n> lodash.curry(fn)\n\n```js\n\nfunction add(a, b, c) {\n  return a + b + c\n}\n\nconst fn = lodash.curry(add)\n\nconsole.log(fn(1, 2, 3))\nconsole.log(fn(1)(2, 3))\nconsole.log(fn(1)(2)(3))\n```\n\n实现 curry 函数\n\n```js\nfunction curry(func) {\n  const curried = function(...args) {\n    // 函数的length 表示它有几个参数\n    if (args.length < func.length) {\n      // 累加参数\n      return (...rest) => curried(...args, ...rest)\n    } else {\n      // 传入的参数和方法接收的参数相同，直接执行 func 函数\n      return func(...args)\n    }\n  }\n\n  return curried\n}\n\nfunction add(a, b, c) {\n  return a + b + c\n}\n\nconst curried = curry(add)\nconst fn = curried(1)\n\nconsole.log(fn(2)(3))\n```\n\n# 函数组合\n\n看个例子\n\n```js\nconst str = 'hello '\n\nfunction add1(str) {\n  return str + 'wor'\n}\n\nfunction add2(str) {\n  return str + 'l'\n}\n\nfunction add3(str) {\n  return str + 'd'\n}\n\nconsole.log(add3(add2(add1(str)))) // hello wrold\n\n```\n\n我们通过手动组合的方式，将每个函数的结果拼接了起来，能实现想要的结果，但是过于繁琐，假设还有几个函数或者十几个函数，恐怕写下去人都麻了。\n\n好在 lodash 这个库也帮我们实现了这个方法 `flow & flowRight`\n\n```js\nconst f = lodash.flow(add1, add2, add3)\n\nf(str)\n```\n\n手动实现\n\n```js\nconst str = 'hello - '\n\nfunction add1(str) {\n  return str + 'wor'\n}\n\nfunction add2(str) {\n  return str + 'l'\n}\n\nfunction add3(str) {\n  return str + 'd'\n}\n\n// console.log(add3(add2(add1(str))))\n\nfunction flow(...fns) {\n  if (fns.length === 1) {\n    return fns[0]\n  }\n\n  return fns.reduceRight((a, b) => {\n    // 从右往左\n    // 第一步 a === add3, b === add2\n    // 第二步 a === (...args) => add3(add2(...args)), b === add1\n    // 第二步的 a 显示为 (...args) => a(b(...args))\n    // 返回 a(add1(...args))\n\n    // 当我们最后调用 f 时，会先计算 add1(...args)，拿到结果后，执行 a \"add3(add2(add1(...args)))\"\n    return (...args) => a(b(...args))\n  })\n}\n\nconst f = flow(add1, add2, add3)\n\nconsole.log(f(str))\n```\n\n# 跨域\n\n> 什么是跨域？\n>\n> CORS 全称是 Cross-Origin Resource Sharing，意为跨域资源共享。当一个资源去访问另一个不同域名或者不同端口的资源时，就会发出跨域请求。如果另一个资源不允许其进行跨域资源访问，就会造成跨域。 \n\n**跨域不是问题，是浏览器的安全机制**\n\n跨域不会阻止请求的发出，也不会阻止请求的接收，跨域是浏览器为了保护当前页面，你的请求得到了响应，但是浏览器不会将请求到的数据提交给当前页面上的回调，取而代之的是去提示你这是一个跨域数据。\n\n**同源策略**导致。\n\n所谓同源策略，就是`协议、域名、端口号`都要相同，有一个不相同，那么就是非同源，就会出现跨域。\n\n\n```js\n// 跨域(端口不同)\n\nhttp://localhost:8080\nhttp://localhost:3000\n\n\n// 跨域(协议不同)\nhttps://localhost:8080\nhttp://localhost:8080\n\n// 跨域(域名)\nhttps://localhost:8080\nhttps://192.168.1.2:8080\n\n\n// 跨域(协议不同，端口也不同)\n// http 默认端口是 80，https 默认端口是 443\nhttp://localhost/bbb\nhttps://localhost/aaa\n```\n\n## 解决跨域\n\n1. 纯后端方式\n\n假设我们有个后端服务 3000，提供了 `/user` 接口，我们可以直接在 `.html` 文件中访问，如果后端不设置跨域，那么肯定会出现跨域提示的。\n\n```js\n// server\nconst express = require('express')\nconst app = express()\n\napp.get('/user', (req, res) => {\n  res.json({\n    code: 0,\n    msg: '请求user成功'\n  })\n})\n\napp.listen('3000', () => {\n  console.log('server running at port 3000...')\n})\n\n\n// client\n<script>\n  const xhr = new XMLHttpRequest()\n  xhr.open('get', 'http://localhost:3000/user')\n  xhr.onload = function() {\n    consolelog(xhr.response)\n  }\n  xhr.send()\n\n\n  // fetch\n  fetch('http://localhost:3000/user')\n    .then(res => res.text())\n    .then(res => {\n      console.log(res)\n    })\n</script>\n```\n\n**后端设置跨域访问**\n\n```js\n// CORS\napp.all('*', function(req, res, next) {\n  // 允许所有请求源\n  res.header(\"Access-Control-Allow-Origin\", \"*\")\n  res.header(\"Access-Control-Allow-Headers\", \"*\")\n  res.header(\"Access-Control-Allow-Methods\", \"*\")\n\n  next()\n})\n```\n\n2. 前端处理\n主要是通过 `webpack devServer` 的 `proxy` 来处理。\n\n```js\n...\ndevServer: {\n  proxy: {\n    '/api': {\n      target: 'http://localhost:3000/' // http://localhost:8080/api/user => http://localhost:3000/api/user\n    }\n  },\n  proxy: {\n    '/no-api': {\n      target: 'http://localhost:3000/', // http://localhost:8080/no-api/user => http://localhost:3000/user\n      pathRewrite: {\n        '/no-api': '', // 后端接口中一般不会含有 api 标识符，我们可以去掉\n      }\n    }\n  },\n}\n...\n```\n\n3. Nginx\n\n要注意的是，devServer 配置 proxy 只是存在于我们开发项目时有用，如果项目要上线，devServer 就没有了，这时可以考虑采用 `Nginx` 来代理。\n\n4. 前后端合并方式\n\n我们可以不采用 `devServer proxy` 方式，而是在后端配置 `webpack-dev-middleware`，将前后端进行合并。\n\n```js\nconst express = require('express')\nconst webpack = require('webpack')\nconst middle = require('webpack-dev-middleware')\nconst compile = require('./webpack.config.js')\n\n\nconst app = express()\n\napp.use(middle(compile))\n\n\napp.get('/user', (req, res) => {\n  res.json({\n    code: 0,\n    msg: '请求user成功'\n  })\n})\n\napp.listen('3000', () => {\n  console.log('server running at port 3000...')\n})\n```\n\n5. jsonp\n\n比较老、兼容性好的方式。\n\n利用标签没有跨域限制的漏洞，在 script 标签上我们可以引用其他服务上的脚本。\n\n最常见的场景就是 CDN.\n\n```js\n<script src=\"https://cdn.jsdelivr.net/npm/vue@2.7.14/dist/vue.js\"></script>\n```\n\n使用方式：\n\n```js\nfunction callback(res) {\n  console.log(JSON.stringify(res, null, 2))\n}\n\n// 动态创建 script 标签，设置好 scr 属性，主要参数是 cb=callback\n\nconst script = document.createElement('script')\nscript.src = 'http://127.0.0.1:3000/info/jsonp?cb=callback'\n\ndocument.getElementByTagsName('head')[0].appendChild(script)\n```\n\n# 前端路由\n\n模式有两种：\n\n1. hash 模式\n2. history 模式\n\n---\n\n- **hash 模式**\n\nURL 的 hash 也就是锚点（#），本质上是改变 window.location 的 href 属性。可以直接给 href 复制，但是页面不刷新。\n\n```js\nlocation.href // 获取当前浏览器 url: 'https://www.baidu.com/'\n\nlocation.href = '/foo'\n```\n\n- **history 模式**\n\nHTML5 新增。\n\n它有五种模式改变 url 而不刷新页面。\n\n```js\nhistory.pushState({}, '', '/foo')\nhistory.replaceState({}, '', '/foo')\nhistory.go(-1)\n\nhistory.back() // 等价 history.go(-1)\nhistory.forward() // history.go(1)\n```\n\n- vue-router\n\n在 Vue 中，有两种方式可以跳转路由：\n\n- 申明式路由 `<router-link to=\"/go\">跳转</router-link>`\n- 编程式路由 `this.$router.go('/go')`\n\n\n**实现 vue-router 路由**\n\n> https://www.bilibili.com/video/BV1n24y1w7kP?p=25&spm_id_from=pageDriver&vd_source=a9f38e58a519cc0570c2dacd34ad7ebe\n\n\n# Promise\n\n> 所谓Promise，就是一个对象，用来传递异步操作的消息。它代表了某个未来才会知道结果的事件（通常是一个异步操作），并且这个事件提供统一的API，可供进一步处理。\n\n\n特点：\n\n1. 对象的状态不受外界影响（pedding, resolved, rejected）\n\n2. 一旦状态改变就不会再改变\n\n\n```js\nconst p = new Promise((resolve, reject) => {\n  if (true) {\n    resolve(true)\n  } else {\n    reject(false)\n  }\n})\n```\n\nresolve函数的作用是，将Promise对象的状态从“未完成”变为“成功”（即从Pending变为Resolved）\n\nreject函数的作用是，将Promise对象的状态从“未完成”变为“失败”（即从Pending变为Rejected）\n\n```js\nfunction timeout(ms) {\n  return new Promise(resolve => {\n    // setTimeout 第三个参数，是传递给第一个函数的，这里是resolve 方法\n    setTimeout(resolve, ms, 'done')\n  })\n}\n\ntimeout(1000).then(res => {\n  console.log(res)\n})\n```\n\nresolve函数的参数除了正常的值外，还可能是另一个Promise实例，表示异步操作的结果有可能是一个值，也有可能是另一个异步操作：\n\n**p1的状态决定了p2的状态**\n\n```js\nconst p1 = new Promise((r, reject) => {\n  setTimeout(() => {\n    reject(new Error('fail'))\n  }, 3000);\n})\n\nconst p2 = new Promise((r, reject) => {\n  r(p1)\n})\n\np2.then(result => {\n  console.log('result ', result)\n}, error => {\n  console.log('error ', error)\n})\n```\n\n上面的代码中，p1是一个Promise,3秒之后变为Rejected。p2的状态由p1决定，p2调用resolve方法，但是此时p1的状态还没有改变，因此p2的状态也不会变。等3秒过后，p1变为Rejected,p2也跟着变为Rejected。\n\n**需要注意的是，catch方法返回的还是一个Promise对象，因此后面还可以接着调用then方法。**\n\n```js\nnew Promise(r => {\n  r(x + 2)\n}).then(res => {\n  console.log('结果 ', res)\n}).catch(err => {\n  console.log('错误 ', err)\n}).then(() => {\n  console.log('随便打印')\n}).finally(() => {\n  console.log('最后打印')\n})\n\n// =======>\n错误  ReferenceError: x is not defined\n\n随便打印\n\n最后打印\n```\n\n## Promise.all\n\n> Promise.all方法用于将多个Promise实例包装成一个新的Promise实例。\n\n```js\nconst p = Promise.all([p1, p2, p3])\n```\n\np的状态由p1、p2、p3决定，分成两种情况。\n1. 只有p1、p2、p3的状态都变成Fulfilled,p的状态才会变成Fulfilled，此时p1、p2、p3的返回值组成一个数组，传递给p的回调函数。\n\n2. 只要p1、p2、p3中有一个被Rejected,p的状态就变成Rejected，此时第一个被Rejected的实例的返回值会传递给p的回调函数。\n\n```js\nconst p3 = function() {\n  return new Promise(r => {\n    setTimeout(() => {\n      r('p3 success')\n    }, 3000);\n  })\n}\n\nconst allP = Promise.all([1, 2, p3()])\n\nallP.then(r => {\n  console.log(r)\n})\n```\n\n上面的例子，3秒后，输出 `[ 1, 2, 'p3 success' ]`\n\n## Promise.race\n\n> 竞速\n>\n> 有一个实例率先改变状态，p的状态就跟着改变。那个率先改变的Promise实例的返回值，就传递给p的回调函数。\n\n\n超时处理\n\n```js\nconst p = Promise.race([\n  fetch('http://localhost:3000/api/user'),\n  new Promise((r, reject) => {\n    setTimeout(() => {\n      reject(new Error('Request timeout'))\n    }, 5000)\n  })\n])\n```\n\n上面的代码中，如果5秒之内fetch方法无法返回结果，变量p的状态就会变为Rejected，从而触发catch方法指定的回调函数。\n\n\n# async await\n\n> async函数就是Generator函数的语法糖。\n\nasync函数返回一个Promise对象，可以使用then方法添加回调函数\n\n```js\nasync function sayName() {\n  return 'name'\n}\n\nconsole.log(sayName()) // Promise { 'name' }\n\nsayName().then(res => console.log(res)) // name\n```\n\n当函数执行时，一旦遇到await就会先返回，等到触发的异步操作完成，再接着执行函数体内后面的语句。\n\n我们来实现一个 sleep 睡眠函数：\n\n```js\n// 睡眠函数\nconst sleep = function(ms) {\n  return new Promise(r => {\n    setTimeout(() => {\n      r()\n    }, ms);\n  })\n}\n\nasync function sayName() {\n  console.log(1)\n\n  await sleep(3000)\n\n\n  console.log(2)\n  \n  return 'name'\n}\n\nsayName().then(res => console.log(res))\n```\n\n当我们调用 sayName 方法时，会立即打印出 1, 3秒过后，打印 2 和 ’name‘\n\n**注意**\n\nawait命令后面的Promise对象，运行结果可能是Rejected，所以最好把 await 命令放在try...catch代码块中。\n\n```js\nconst sleep = function(ms) {\n  return new Promise(r => {\n    // 这里报错，会被外面的 try-catch 接收到\n    console.log(xxxxx + 3)\n\n    setTimeout(() => {\n      // setTimeout 内部报错，不会被外部的 try catch 捕获到\n      r()\n    }, ms)\n  })\n}\n\nasync function sayName() {\n  try {\n    await sleep(3000)\n  } catch (error) {\n    console.log(' - - - ', error)\n  }\n}\n\nsayName().then(res => console.log(res))\n```","source":"_posts/重温JavaScript.md","raw":"---\nlayout: JavaScript\ntitle: 温故而知新（JavaScript）\ndate: 2023-05-12 18:55:02\ntags: JavaScript\nbanner_img: /img/js.jpg\nindex_img: /img/js.jpg\nexcerpt: JavaScript\n---\n\n# 数据类型(7)\n1. 原始数据类型(6种)\na. 数值\nb. 字符串\nc. 布尔值\nd. undefined\ne. Null\nf. Symbol（ECMAScript 6 新增）\n\ng.任意精度的整数 (BigInt) ，可以安全地存储和操作大整数，甚至可以超过数字的安全整数限制\n\n2. 引用数据类型\na. 对象\nb. 数组\nc. 函数\n...\n\n# 运算符\n\n加减乘除、取模、自增自减\n\n```js\nvar a = 1;\nvar b;\n\nvar sum = (b = a++ + --a) + a-- + b++;\n```\n\n\n# 数组\n\n## 创建数组\n\n```js\nvar arr = [1,2,3]\nvar arr = new Array()\n\nvar arr = new Array(9)\nvar arr = new Array('first', 'second', 'name')\n```\n\n## 数组方法\nconcat: 连接两个或多个数组，并返回一个新数组。\n\njoin: 将数组中的所有项连接成一个字符串。\n\npop: 删除并返回数组的最后一项。\n\npush: 在数组的末尾添加一个或多项并返回数组的新长度。\n\nshift: 删除并返回数组的第一项。\n\nunshift: 在数组的开头添加一个或多项。\n\nslice: 返回一个数组的片段，该片段包括开始索引到结束索引（不包括结束索引）的所有项。\n\nsplice: 在数组中插入、删除或替换项。\n\nsort: 对数组的所有项进行排序。\n\nreverse: 反转数组中的项的顺序。\n\nindexOf: 返回数组中第一个与给定值匹配的项的索引，如果未找到，则返回 -1。\n\nlastIndexOf: 返回数组中最后一个与给定值匹配的项的索引，如果未找到，则返回 -1。\n\nforEach: 对数组中的每一项执行给定的回调函数。\n\nmap: 对数组中的每一项执行给定的回调函数，并返回一个新数组，其中的每一项是回调函数的返回值。\n\nfilter: 对数组中的每一项执行给定的回调函数，并返回一个新数组，其中只包含回调函数返回 true 的项。\n\nreduce: 从左到右对数组中的所有项进行累加，并返回单个值。\n\nreduceRight: 从右到左对数组中的所有项进行累加，并返回单个值。\n\nsome: 如果数组中至少有一个项通过了给定的测试，则返回 true，否则返回 false。\n\nevery: 如果数组中的所有项都通过了给定的测试，则返回 true，否则返回 false。\n\n\n# JS编译原理\n\nJavaScript 是一种解释型语言，而非编译型语言。这意味着，JavaScript 代码在运行时被动态解释，而不是在编译时预先翻译成机器代码。\n\n在 JavaScript 中，代码会被加载到浏览器或 Node.js 环境中，然后通过 JavaScript 引擎（例如 V8）解释和执行代码。在解释代码之前，JavaScript 引擎会对代码进行词法分析和语法分析，以确定代码的语法正确性和语义。然后，代码将被执行。\n\n总的来说，JavaScript 没有明确的编译过程，但它在加载和运行代码之前经过了词法和语法分析。\n\n\n## 词法分析\n\n词法分析的目的是将 JavaScript 代码的字符串形式转换为一系列词法单元 (tokens)，每个词法单元代表 JavaScript 代码的一个有意义的组成部分，如变量名，运算符，函数等。\n\n## 语法分析\n\n语法分析的目的是将词法单元组合成语法树，语法树代表 JavaScript 代码的结构和语义。\n\n\n# 闭包\n\n产生条件\n\n1. 函数内部有另一个函数\n\n2. 函数内部的函数里面用到了外部函数的局部变量\n\n3. 外部函数将内部函数作为返回值 return 出去了。\n\n好处：\n\n闭包中的变量，充当全局变量使用，减少全局变量的混乱程度。\n\n清除：\n\n将变量设置为 null 即可。\n\n# new关键字\n\n当我们在代码中使用 new 关键字，它会执行以下操作：\n\n- 创建一个空对象\n- 将该对象的原型链指向构造函数的原型对象\n- 将函数内部的 this 关键字指向新创建的对象\n- 在新创建的对象上执行构造函数中的代码\n- 返回该对象\n\n# this\n\n1. 普通函数中，谁调用此函数，this 就指向谁。箭头函数中没有自己的this，在哪里定义，或者说箭头函数外部的this指向谁，就是谁。\n\n2. 方法中的this，指向调用方法的对象。\n\n3. 指向全局对象：全局函数中的this\n\n4. 事件中的 this，指向 dom 对象。\n\n5. 构造函数中的 this，指向 new 创建的对象。\n\n# call、apply、bind\n\n它们的作用都是为了改变 this 的指向\n\n区别是参数不同，第一个参数是想要使用的对象，第二个参数是传递给函数的参数\n\n```js\nconst dog = {\n  name: 'is dog',\n  sayName(name1, name2, name3) {\n    console.log(this.name)\n  }\n}\n\nconst cat = {\n  name: '喵喵喵'\n}\n\ndog.sayName.call(cat, 1, 2, 3)\ndog.sayName.apply(cat, [1, 2, 3])\n\nconst fn = dog.sayName.bind(cat, 1, 2, 3)\nfn()\n\n```\n\n\n```js\nconst cat = {\n  name: '喵喵喵',\n  sayName() {\n\n    // 等价于 window 对象调用定时器\n    setTimeout(function() {\n      console.log(this) // window\n    })\n  }\n}\n\nconst cat = {\n  name: '喵喵喵',\n  sayName() {\n    setTimeout(() => {\n      console.log(this) // cat\n      console.log(this.name) // 喵喵喵\n    })\n  }\n}\n\ncat.sayName()\n```\n\n# nextTick 和 setImmediate\n\n同步代码执行完毕，执行 nextTick，然后是异步代码（setTimeout），最后执行 setImmediate\n\n```js\nsetImmediate(() => {\n  console.log('setImmediate')\n})\n\nprocess.nextTick(() => {\n  console.log(1)\n})\n\nconsole.log(2)\n\nsetTimeout(() => {\n  console.log(3)\n}, 0);\n\n\n// =>>>>>>  2 1 3 setImmediate\n```\n\n\nsetImmediate表示当前事件循环即将结束时，执行。\n\n```js\nsetImmediate(() => {\n  console.log('setImmediate')\n})\n\nprocess.nextTick(() => {\n  console.log(1)\n})\n\nconsole.log(2)\n\nsetTimeout(() => {\n  console.log(3)\n}, 0);\nsetTimeout(() => {\n  console.log(4)\n}, 1000);\nsetTimeout(() => {\n  console.log(5)\n}, 0);\n\n\nconsole.log(6)\n\n// =====> 2 6 1 3 5 setImmediate 4(一秒后输出4)\n```\n\n# 宏任务&微任务\n\n宏任务：计时器、ajax、读取文件\n\n微任务：promise.then\n\n一次事件循环的执行顺序:\n\n1. 同步程序\n\n2. process.nextTick\n\n3. 微任务\n\n4. 宏任务\n\n5. setImmediate\n\n```js\n// 当前事件循环最后执行\nsetImmediate(() => {\n  console.log('setImmediate')\n})\n\n// 宏任务执行完毕之后 微任务执行之前执行\nprocess.nextTick(() => {\n  console.log(1)\n})\n\n// 立即执行\nconsole.log(2)\n\nnew Promise(r => {\n  // 立即执行\n  console.log(7)\n  r()\n}).then(() => {\n  // 微任务，process.nextTick 执行之后执行\n  console.log(8)\n})\n\n// 宏任务\nsetTimeout(() => {\n  // 微任务执行后执行\n  console.log(3)\n}, 0);\nsetTimeout(() => {\n  // 放到下一次循环中执行\n  console.log(4)\n}, 1000);\nsetTimeout(() => {\n  // 微任务执行后执行\n  console.log(5)\n}, 0);\n\n// 立即执行\nconsole.log(6)\n\n\n// 2 7 6 1 8 3 5 setImmediate 4\n```\n\n# 浅拷贝、深拷贝\n\n浅拷贝\n\n```js\nconst obj = {\n  name: 'is obj',\n  girlfriend: {\n    name: '小红'\n  }\n}\n\nconst o = Object.assign({}, obj)\n\nobj.name = 'is o'\nobj.girlfriend.name = '小花'\n\nconsole.log(o)\n```\n\n深拷贝\n\n```js\nconst obj = {\n  name: 'is obj',\n  girlfriend: {\n    name: '小红'\n  }\n}\n\nfunction deepClone(obj) {\n  const o = {}\n\n  for (const key in obj) {\n    if (Object.hasOwnProperty.call(obj, key)) {\n      \n      if(typeof obj[key] === 'object') {\n        o[key] = deepClone(obj[key])\n      } else {\n        o[key] = obj[key];\n      }\n    }\n  }\n\n  return o\n}\n```\n\n# JSON.stringify实现深克隆\n\n将一个 JSON 对象，转化为字符串，通过 JSON.parse 将字符串转化为对象，从而实现深克隆\n\n```js\nconst obj = {\n  name: 'is obj',\n  girlfriend: {\n    name: '小红'\n  }\n}\n\nconst o = JSON.parse(JSON.stringify(obj))\n\nconsole.log(o)\n```\n\nJSON.stringify 存在的问题：\n\n如果属性值是 undefined 或者是方法（含箭头函数），克隆出来后，undefined 和函数会丢失\n\n# parseInt\n\n> parseInt(string, radix) 解析一个字符串并返回指定基数的十进制整数，radix 是 2-36 之间的整数，表示被解析字符串的基数。\n\nstring: 要被解析的值。\n- 如果参数不是一个字符串，则将其转换为字符串 (使用 ToString抽象操作)。\n- 字符串开头的空白符将会被忽略。\n\n## **parseInt (0.0000005) === 5 为 true**\n\n```js\n(0.5).toString(); //  '0.5'\n(0.05).toString(); //  '0.05'\n(0.005).toString(); //  '0.005'\n(0.0005).toString(); //  '0.0005'\n(0.00005).toString(); //  '0.00005'\n(0.000005).toString(); //  '0.000005'\n(0.0000005).toString(); //  '5e-7'\n```\n- 可以发现当数字过小时，toString 输出的结果是科学计数法形式。\n- parseInt 只能将字符串的前导部分解释为整数值；它忽略任何不能被解释为整数的代码单元，并且不会有忽略指示。\n\n```js\nparseInt(0.5) // 0\n\nparseInt(0.0000005) // 5\n```\n\n## radix 默认值是 10 吗，何种情况返回值是 NaN？\n\n1. 当 radix 值为 undefined、0 或未指定的，那 JavaScript 会如何处理这种情况:\n\n- 如果输入的 string 以 0x 或 0X 开头，那么 radix 会被假定为 16 ，字符串的其他部分按照十六进制来解析。\n```js\nparseInt('0x51') // 5*16^1 + 1*16^0 = 81\n```\n- 如果输入的 string 以 0 开头，ES5 规定使用十进制，但并非所有的浏览器都支持，因此使用 parseInt 时，需要指定 radix\n- 如果输入的 string 以其他任何值开头，radix 值为 10\n\n2. radix 参数的值为 2 ~ 36，当 radix 小于 2 或 大于 36(不包含 0)，返回值为 NaN\n\n```js\nparseInt(\"123\", 1); // NaN\nparseInt(\"123\", 38); // NaN\nparseInt(\"123\", -1); // NaN\n```\n\n3. 待转换字符串中，所有的可转换数字都不小于 radix 值\n\n例如 radix 值为 2 (二进制)，而待转换字符串为 '3456'，二进制内只有 0、1 是基本算符，因此字符串 '3456' 无法转换成二进制，返回值为 NaN。\n\n```js\nparseInt(\"3456\", 2); // NaN\nparseInt(\"45px\", 3); // NaN\n```\n\n## ['1', '2', '3'].map(parseInt)\n\n> [parseInt(\"1\", 0), parseInt(\"2\", 1), parseInt(\"3\", 2)]\n\n- parseInt(\"1\", 0)\nradix 为 0，且 string 以字符 1 开始，radix 值为 10，值为 1。\n\n- parseInt(\"2\", 1)\n符合 2.2 ，radix 小于 2，返回 NaN\n\n- parseInt(\"3\", 2)\n待转换字符串中，所有的可转换数字大于 radix 值，返回 NaN\n\n# 渲染进程\n\n- GUI渲染线程\n  - 负责渲染页面，布局和绘制\n  - 页面需要重绘和回流时，该线程就会执行\n  - 与js引擎线程互斥，防止渲染结果不可预期\n\n- JS引擎线程\n  - 负责处理解析和执行javascript脚本程序\n  - 只有一个JS引擎线程（单线程）\n  - 与GUI渲染线程互斥，防止渲染结果不可预期\n\n- 事件触发线程\n  - 用来控制事件循环（鼠标点击、setTimeout、ajax等）\n  - 当事件满足触发条件时，将事件放入到JS引擎所在的执行队列中\n\n- 定时触发器线程\n  - setInterval与setTimeout所在的线程\n  - 定时任务并不是由JS引擎计时的，是由定时触发线程来计时的\n  - 计时完毕后，通知事件触发线程\n\n\n- 异步http请求线程\n  - 浏览器有一个单独的线程用于处理AJAX请求\n  - 当请求完成时，若有回调函数，通知事件触发线程\n\n# 为什么 javascript 是单线程的?\n\n首先是历史原因，在创建 javascript 这门语言时，多进程多线程的架构并不流行，硬件支持并不好。\n\n其次是因为多线程的复杂性，多线程操作需要加锁，编码的复杂性会增高。\n\n而且，如果同时操作 DOM ，在多线程不加锁的情况下，最终会导致 DOM 渲染的结果不可预期。\n\n# 为什么 GUI 渲染线程与 JS 引擎线程互斥?\n\n这是由于 JS 是可以操作 DOM 的，如果同时修改元素属性并同时渲染界面(即 JS线程和UI线程同时运行)，\n那么渲染线程前后获得的元素就可能不一致了。\n\n因此，为了防止渲染出现不可预期的结果，浏览器设定 GUI渲染线程和JS引擎线程为互斥关系，\n当JS引擎线程执行时GUI渲染线程会被挂起，GUI更新则会被保存在一个队列中等待JS引擎线程空闲时立即被执行。\n\n# 如何理解 JS 的运行机制（Event Loop）?\n\n> https://juejin.cn/post/6844903919789801486\n\n## 核心概念\n\n1. JS分为同步任务和异步任务\n2. 同步任务都在 `JS 引擎线程` 上执行，形成一个执行栈\n3. `事件触发线程` 管理一个任务队里，异步任务触发条件达成，将回调事件放入执行栈中执行\n4. 执行栈中所有同步任务执行完毕，此时JS引擎线程空闲，系统会读取任务队列，将可运行的异步任务回调事件添加到执行栈中，开始执行\n\n## Event Loop\n\n1. 执行一个宏任务（栈中没有，就从任务队列中获取）\n2. 执行过程中如果遇到了微任务，就将它添加到微任务的任务队列中\n3. 宏任务执行完毕，立即执行微任务队列中的所有微任务（依次执行）\n4. 当前宏任务执行完毕，开始检查渲染，然后 GUI 渲染线程接管，开始渲染\n5. 渲染完毕后，JS 线程接管，开始下一个宏任务（从任务队列中获取）\n\n<img src=\"/img/event loop.jpg\" />\n\n# var 和 let 的区别\n\n1. var 声明的变量，其作用域为当前函数、模块或全局；let 声明的变量，其作用域总是在当前的代码块，例如语句块。\n2. 在同一个代码块中，var可以多次声明变量名；let只能声明一次，覆盖一个已经声明的 let 变量会导致语法错误。\n3. 用户可以在声明语句之前使用 var 变量，其值是 undefined. 而 let 必须先声明后使用。\n4. 全局模块下，var 声明的变量作为global上的属性，let声明的变量则不是 global上的属性，而是作为全局模块中的标识符。\n\n# 垃圾回收机制\n\n- 引用计数：被引用，则计数+1，不再引用，计数减一。存在循环引用问题。\n- 标记清除（常用）：当变量进入到执行环境，则标记上已进入执行环境，当执行完成后，变量离开执行环境则标记已离开执行环境。\n\n# 原型链 & 继承\n\n每个构造函数都有一个原型对象（prototype），原型有一个属性（constructor）指回构造函数，而实例有一个内部指针（__proto__）指向原型。\n\n原型链最顶端是 null\n\n任何函数的默认原型都是一个Object的实例，这意味着这个实例有一个内部指针指向Object.prototype。\n\n这也是为什么自定义类型能够继承包括toString()、valueOf()在内的所有默认方法的原因\n\n```js\n\nfunction Person(params) {\n    console.log(params)\n}\nconst p = new Person(1)\n\np.__proto__.constructor === Person >>> true\n\np.__proto__ === Person.prototype >>> true\n\np.__proto__.__proto__ === Object.prototype >>> true\n\np.__proto__.__proto__.constructor === Object >>> true\n\np.__proto__.__proto__.__proto__ === null\n```\n\n## 原型与继承的关系\n\n原型与实例的关系可以通过`两种`方式来确定。\n\n第一种方式是使用`instanceof操作符`，**如果一个实例的原型链中出现过相应的构造函数，则instanceof返回true**\n\n```js\no instanceof Object // true 实例的原型链中出现过相应的构造函数\n```\n\n第二种方式是使用`isPrototypeOf()`方法\n\n```js\nObject.prototype.isPrototypeOf(o)\n```\n\n## 原型链的问题\n\n问题一：原型中包含的引用值会在所有实例间共享\n\n```js\nfunction Super() {\n  this.colors = ['red', 'blue']\n}\n\nfunction Sub() {}\n\nSub.prototype = new Super() // Super 实例的属性值，变成了 Sub 原型对象上的属性\n\nconst o1 = new Sub()\n\no1.colors.push('black')\n\n// 所有实例共享原型对象上的 colors\nconst o2 = new Sub()\nconsole.log(o2.colors) // ['red', 'blue', 'black']\n```\n\n问题二：子类型在实例化时不能给父类型的构造函数传参\n\n## 盗用构造函数继承\n\n> 为了解决原型包含引用值导致的继承问题\n\n在子类构造函数中调用父类构造函数。\n\n```js\nfunction Super() {\n  this.colors = ['red', 'blue']\n}\n\nfunction Sub() {\n  // 实例化 Sub 时，给每个 Sub 实例上都复制（拷贝）一份 colors，实例间不共享 colors，都有属于自己的那一份 colors\n  Super.call(this)\n}\n\nconst o1 = new Sub()\no1.colors.push('black')\n\nconst o2 = new Sub()\nconsole.log(o2.colors) // ['red', 'blue']\n```\n\n也可以给父类传递参数\n\n```js\nfunction Sub() {\n  Super.call(this, 'Hello world')\n\n  // 这里可以额外添加属性\n  this.age = 18\n}\n```\n\n盗用构造函数也是有缺点的：\n\n1. 不是原型链继承，无法使用父类原型对象上的属性和方法。\n2. 父类上定义的所有属性和方法，都会被复制到子类实例上，如果属性和方法太多，占用内存就会较大。并且继承的目的是为了属性和方法的`复用`，而且借用构造函数是将父类定义的方法和属性进行了`复制`。\n\n\n## 组合继承（伪经典继承）\n\n> 综合了原型链和借用构造函数\n\n基本的思路是使用原型链继承原型上的属性和方法，而通过盗用构造函数继承实例属性。这样既可以把方法定义在原型上以实现重用，又可以让每个实例都有自己的属性。\n\n```js\nfunction Person(name) {\n  this.name = name\n  this.colors = ['red', 'blue']\n}\n\nPerson.prototype.sayName = function() {\n  console.log(this.name)\n}\n\nfunction User(name) {\n\n  // 借用构造函数\n  Person.call(this, name)\n\n  this.age = 19\n}\n\n// 原型链继承\nUser.prototype = new Person()\n\nconst u = new User('xiaoming')\n\nconsole.log(u.sayName())\n```\n\n组合继承弥补了原型链和盗用构造函数的不足，是JavaScript中使用最多的继承模式。而且组合继承也保留了 `instanceof操作符` 和 `isPrototypeOf()` 方法识别合成对象的能力。\n\n```js\n// true\n\nconsole.log(u instanceof User)\nconsole.log(u instanceof Person)\nconsole.log(User.prototype.isPrototypeOf(u))\nconsole.log(Person.prototype.isPrototypeOf(u))\n```\n\n## 原型式继承\n\n> 创建一个临时构造函数，将传入的对象赋值给这个构造函数的原型，然后返回这个临时类型的一个实例\n\n```js\nfunction object(o) {\n  function F() {}\n\n  F.prototype = o\n\n  return new F()\n}\n```\n\nECMAScript 5通过增加`Object.create()`方法将原型式继承的概念规范化了。这个方法接收两个参数：作为新对象原型的对象，以及给新对象定义额外属性的对象（第二个可选: Object.defineProperties()）。在只有一个参数时，Object.create()与这里的object()方法效果相同。\n\n在 `组合式继承`中，我们可以将原型链继承那部分可以改写一下:\n\n```js\nUser.prototype = Object.create(Person.prototype)\n```\n\n## 寄生式继承\n\n> 创建一个实现继承的函数，以某种方式增强对象，然后返回这个对象\n\n```js\nfunction createAnother(original){\n  let clone = Object.create(original) // 通过调用函数创建一个新对象\n\n  clone.sayHi = function() { // 以某种方式增强这个对象\n    console.log(\"hi\")\n  }\n  return clone\n}\n```\n\n## 寄生式组合继承(继承的最佳模式)\n\n组合继承其实也存在效率问题。最主要的效率问题就是父类构造函数始终会被调用两次：一次在是创建子类原型时调用，另一次是在子类构造函数中调用。\n\n```js\n  function SuperType(name) {\n    this.name = name;\n    this.colors = [\"red\", \"blue\", \"green\"];\n  }\n  SuperType.prototype.sayName = function() {\n    console.log(this.name);\n  };\n  function SubType(name, age){\n    SuperType.call(this, name);   //第二次调用SuperType()\n    this.age = age;\n  }\n  SubType.prototype=newSuperType();   //第一次调用SuperType()\n  SubType.prototype.constructor = SubType;\n  SubType.prototype.sayAge = function() {\n    console.log(this.age);\n  };\n```\n\n有两组name和colors属性：一组在实例上，另一组在SubType的原型上。\n\n<img src=\"/img/组合继承.jpg\" />\n\n> 寄生式组合继承通过盗用构造函数继承属性，但使用混合式原型链继承方法。基本思路是不通过调用父类构造函数给子类原型赋值，而是取得父类原型的一个副本。\n\n说到底就是使用寄生式继承来继承父类原型，然后将返回的新对象赋值给子类原型。\n\n```js\nfunction inheritPrototype(subType, superType) {\n  const prototype = Object.create(superType.prototype) // 将superType.prototype作为新对象的原型对象\n\n  prototype.constructor = subType // 增强对象\n\n  subType.prototype = prototype// 新对象赋值给子类原型\n}\n```\n\n我们再来改写 `组合继承`\n\n```js\nfunction SuperType(name) {\n  this.name = name;\n  this.colors = [\"red\", \"blue\", \"green\"];\n}\nSuperType.prototype.sayName = function() {\n  console.log(this.name);\n};\nfunction SubType(name, age) {\n  SuperType.call(this, name);\n  this.age = age;\n}\n\ninheritPrototype(SubType, SuperType);\n\nSubType.prototype.sayAge = function() {\n  console.log(this.age);\n};\n```\n\n这里只调用了一次SuperType构造函数，避免了SubType.prototype上不必要也用不到的属性，因此可以说这个例子的效率更高。\n\n而且，原型链仍然保持不变，因此instanceof操作符和isPrototypeOf()方法正常有效。寄生式组合继承可以算是引用类型`继承的最佳模式`。\n\n## ES6 class 的 extends 关键字\n\n```js\nclass Point {\n  constructor(x, y) {\n    this.x = x\n    this.y = y\n  }\n}\n\nclass ColorPoint extends Point {\n  constructor(x, y, color) {\n    super(x, y) // 必须调用 super (父类的 this 对象)\n\n    this.color = color\n  }\n}\n```\n\n子类必须在constructor方法中调用super方法，否则新建实例时会报错。这是因为子类没有自己的this对象，而是继承了父类的this对象，然后对其进行加工。如果不调用super方法，子类就得不到this对象。\n\n如果在一个方法前加上static关键字，就表示该方法不会被实例继承，而是直接通过类调用，称为“静态方法”。\n\n```js\nclass Foo {\n  static staticMethod() {\n    console.log('static')\n  }\n}\n\nFoo.staticMethod()\n```\n\n父类的静态方法可以被子类继承。\n\n```js\nclass Bar extends Foo {}\n\nBar.staticMethod() // static\n```\n\n父类的静态方法可以在子类中通过 `super` 关键字调用。\n\n```js\nclass Bar extends Foo {\n  static say() {\n    return super.staticMethod() + ' method'\n  }\n}\n\nBar.say() // static method\n```\n\n# class 和构造函数有什么区别？\n\n1. 类必须使用new调用，直接调用会报错\n\n2. 类和模块的内部，默认就是严格模式，所以不需要使用use strict指定运行模式。\n\n3. 类不存在变量提升（hoist），这一点与 ES5 完全不同。\n\n4. 类的内部所有定义的方法，都是不可枚举的\n\n5. 子类必须在constructor方法中调用super方法，否则新建实例时会报错。\n\n    这是因为子类自己的this对象，必须先通过父类的构造函数完成塑造，得到与父类同样的实例属性和方法，然后再对其进行加工，加上子类自己的实例属性和方法。如果不调用super方法，子类就得不到this对象。\n\nsuper作为函数调用时，代表父类的构造函数。\n\n```js\n<script>\nclass A {}\nclass B extends A { constructor() { super() }}\n</script>\n```\n\nsuper虽然代表了父类A的构造函数，但是返回的是子类B的实例，即super内部的this指的是B的实例，因此super()在这里相当于A.prototype.constructor.call(this)。\n\n**继承区别**\n\n1. ES5 的继承，实质是先创造子类的实例对象this，然后再将父类的方法添加到this上面 Parent.call(this)\n\n\n2. ES6 的继承机制，实质是先将父类实例对象的属性和方法加到this上面（所以必须先调用super方法），然后再用子类的构造函数修改this。\n\n# 防抖&节流\n\n防抖：用户触发事件频繁，只需要用户最后一次操作的结果\n\n```js\nconst input = document.querySelector('input')\nlet timer = null\n\ninput.oninput = function(){\n  if (timer !== null) {\n    timer = clearTimeout(timer)\n  }\n\n  timer = setTimeout(() => {\n    console.log(this.value)\n  }, 1000)\n\n}\n```\n\n封装防抖函数\n\n```js\nfunction debounce(fn, delay = 500) {\n  // 闭包\n  let timer = null\n  // this ===> window\n\n  return function() {\n    // this ===> input\n    if (timer !== null) {\n      clearTimeout(timer)\n    }\n\n    timer = setTimeout(() => {\n      fn.call(this)\n    }, delay);\n  }\n}\n\nconst input = document.querySelector('#input')\n\ninput.oninput = debounce(function() {\n  console.log('value: ', this.value)\n}, 800)\n```\n\n节流：控制事件执行的次数，每个多少时间间隔执行一次。\n\n比如监听滚动条的触发事件。\n\n```js\nlet time = 0\nwindow.onscroll = function() {\n  if (Date.now() - time > 1000) {\n    console.log('执行')\n    time = Date.now()\n  }\n}\n```\n\n封装节流函数 throttle\n\n```js\nfunction throttle(fn, delay) {\n  let time = 0\n\n  return function() {\n    let now = Date.now()\n    if (now - time > delay) {\n      fn.call(this)\n      time = now\n    }\n  }\n}\n```\n\n\n# 纯函数\n\n1. 函数的返回结果只依赖于它的参数，相同的输入始终得到相同的输出。\n2. 函数执行过程中没有副作用（不改变、不依赖外部任何可观察的变化）\n\n```js\n\nfunction add(a, b) {\n  return a + b;\n}\n\nadd(1, 2)\n```\n\n## 可缓存的纯函数\n\n当我们的计算量非常大，可能耗时很长或者很好性能，那么我们通过缓存的方式，避免函数多次计算。从而，计算了一次之后，以后再输入相同的参数，就直接返回上次计算的结果。\n\n\n> lodash.memozie(add, resolver)\n\n实现 memoize 函数\n\n```js\nfunction add(a, b) {\n  console.log('计算中...')\n\n  return a + b\n}\n\nconst resolver = (...args) => JSON.stringify(args)\n\nfunction memoize(func, resolver) {\n  const cache = {}\n\n  return function(...args) {\n    const key = resolver(...args) // \"[a, b]\"\n\n    if (cache[key]) {\n      return cache[key]\n    } else {\n      return cache[key] = func(...args)\n    }\n  }\n}\n\nconst memoized = memoize(add, resolver)\n\nconsole.log(memoized(9, 9)) // 第一次打印 \"计算中...\"\nconsole.log(memoized(9, 9)) // 不会打印\nconsole.log(memoized(9, 9)) // 不会打印\n```\n\n\n# 函数柯里化\n\n给一个函数传入一部分参数，让其返回的函数接收剩余的参数。直到所有的参数都给到了，才会计算结果。\n\n> lodash.curry(fn)\n\n```js\n\nfunction add(a, b, c) {\n  return a + b + c\n}\n\nconst fn = lodash.curry(add)\n\nconsole.log(fn(1, 2, 3))\nconsole.log(fn(1)(2, 3))\nconsole.log(fn(1)(2)(3))\n```\n\n实现 curry 函数\n\n```js\nfunction curry(func) {\n  const curried = function(...args) {\n    // 函数的length 表示它有几个参数\n    if (args.length < func.length) {\n      // 累加参数\n      return (...rest) => curried(...args, ...rest)\n    } else {\n      // 传入的参数和方法接收的参数相同，直接执行 func 函数\n      return func(...args)\n    }\n  }\n\n  return curried\n}\n\nfunction add(a, b, c) {\n  return a + b + c\n}\n\nconst curried = curry(add)\nconst fn = curried(1)\n\nconsole.log(fn(2)(3))\n```\n\n# 函数组合\n\n看个例子\n\n```js\nconst str = 'hello '\n\nfunction add1(str) {\n  return str + 'wor'\n}\n\nfunction add2(str) {\n  return str + 'l'\n}\n\nfunction add3(str) {\n  return str + 'd'\n}\n\nconsole.log(add3(add2(add1(str)))) // hello wrold\n\n```\n\n我们通过手动组合的方式，将每个函数的结果拼接了起来，能实现想要的结果，但是过于繁琐，假设还有几个函数或者十几个函数，恐怕写下去人都麻了。\n\n好在 lodash 这个库也帮我们实现了这个方法 `flow & flowRight`\n\n```js\nconst f = lodash.flow(add1, add2, add3)\n\nf(str)\n```\n\n手动实现\n\n```js\nconst str = 'hello - '\n\nfunction add1(str) {\n  return str + 'wor'\n}\n\nfunction add2(str) {\n  return str + 'l'\n}\n\nfunction add3(str) {\n  return str + 'd'\n}\n\n// console.log(add3(add2(add1(str))))\n\nfunction flow(...fns) {\n  if (fns.length === 1) {\n    return fns[0]\n  }\n\n  return fns.reduceRight((a, b) => {\n    // 从右往左\n    // 第一步 a === add3, b === add2\n    // 第二步 a === (...args) => add3(add2(...args)), b === add1\n    // 第二步的 a 显示为 (...args) => a(b(...args))\n    // 返回 a(add1(...args))\n\n    // 当我们最后调用 f 时，会先计算 add1(...args)，拿到结果后，执行 a \"add3(add2(add1(...args)))\"\n    return (...args) => a(b(...args))\n  })\n}\n\nconst f = flow(add1, add2, add3)\n\nconsole.log(f(str))\n```\n\n# 跨域\n\n> 什么是跨域？\n>\n> CORS 全称是 Cross-Origin Resource Sharing，意为跨域资源共享。当一个资源去访问另一个不同域名或者不同端口的资源时，就会发出跨域请求。如果另一个资源不允许其进行跨域资源访问，就会造成跨域。 \n\n**跨域不是问题，是浏览器的安全机制**\n\n跨域不会阻止请求的发出，也不会阻止请求的接收，跨域是浏览器为了保护当前页面，你的请求得到了响应，但是浏览器不会将请求到的数据提交给当前页面上的回调，取而代之的是去提示你这是一个跨域数据。\n\n**同源策略**导致。\n\n所谓同源策略，就是`协议、域名、端口号`都要相同，有一个不相同，那么就是非同源，就会出现跨域。\n\n\n```js\n// 跨域(端口不同)\n\nhttp://localhost:8080\nhttp://localhost:3000\n\n\n// 跨域(协议不同)\nhttps://localhost:8080\nhttp://localhost:8080\n\n// 跨域(域名)\nhttps://localhost:8080\nhttps://192.168.1.2:8080\n\n\n// 跨域(协议不同，端口也不同)\n// http 默认端口是 80，https 默认端口是 443\nhttp://localhost/bbb\nhttps://localhost/aaa\n```\n\n## 解决跨域\n\n1. 纯后端方式\n\n假设我们有个后端服务 3000，提供了 `/user` 接口，我们可以直接在 `.html` 文件中访问，如果后端不设置跨域，那么肯定会出现跨域提示的。\n\n```js\n// server\nconst express = require('express')\nconst app = express()\n\napp.get('/user', (req, res) => {\n  res.json({\n    code: 0,\n    msg: '请求user成功'\n  })\n})\n\napp.listen('3000', () => {\n  console.log('server running at port 3000...')\n})\n\n\n// client\n<script>\n  const xhr = new XMLHttpRequest()\n  xhr.open('get', 'http://localhost:3000/user')\n  xhr.onload = function() {\n    consolelog(xhr.response)\n  }\n  xhr.send()\n\n\n  // fetch\n  fetch('http://localhost:3000/user')\n    .then(res => res.text())\n    .then(res => {\n      console.log(res)\n    })\n</script>\n```\n\n**后端设置跨域访问**\n\n```js\n// CORS\napp.all('*', function(req, res, next) {\n  // 允许所有请求源\n  res.header(\"Access-Control-Allow-Origin\", \"*\")\n  res.header(\"Access-Control-Allow-Headers\", \"*\")\n  res.header(\"Access-Control-Allow-Methods\", \"*\")\n\n  next()\n})\n```\n\n2. 前端处理\n主要是通过 `webpack devServer` 的 `proxy` 来处理。\n\n```js\n...\ndevServer: {\n  proxy: {\n    '/api': {\n      target: 'http://localhost:3000/' // http://localhost:8080/api/user => http://localhost:3000/api/user\n    }\n  },\n  proxy: {\n    '/no-api': {\n      target: 'http://localhost:3000/', // http://localhost:8080/no-api/user => http://localhost:3000/user\n      pathRewrite: {\n        '/no-api': '', // 后端接口中一般不会含有 api 标识符，我们可以去掉\n      }\n    }\n  },\n}\n...\n```\n\n3. Nginx\n\n要注意的是，devServer 配置 proxy 只是存在于我们开发项目时有用，如果项目要上线，devServer 就没有了，这时可以考虑采用 `Nginx` 来代理。\n\n4. 前后端合并方式\n\n我们可以不采用 `devServer proxy` 方式，而是在后端配置 `webpack-dev-middleware`，将前后端进行合并。\n\n```js\nconst express = require('express')\nconst webpack = require('webpack')\nconst middle = require('webpack-dev-middleware')\nconst compile = require('./webpack.config.js')\n\n\nconst app = express()\n\napp.use(middle(compile))\n\n\napp.get('/user', (req, res) => {\n  res.json({\n    code: 0,\n    msg: '请求user成功'\n  })\n})\n\napp.listen('3000', () => {\n  console.log('server running at port 3000...')\n})\n```\n\n5. jsonp\n\n比较老、兼容性好的方式。\n\n利用标签没有跨域限制的漏洞，在 script 标签上我们可以引用其他服务上的脚本。\n\n最常见的场景就是 CDN.\n\n```js\n<script src=\"https://cdn.jsdelivr.net/npm/vue@2.7.14/dist/vue.js\"></script>\n```\n\n使用方式：\n\n```js\nfunction callback(res) {\n  console.log(JSON.stringify(res, null, 2))\n}\n\n// 动态创建 script 标签，设置好 scr 属性，主要参数是 cb=callback\n\nconst script = document.createElement('script')\nscript.src = 'http://127.0.0.1:3000/info/jsonp?cb=callback'\n\ndocument.getElementByTagsName('head')[0].appendChild(script)\n```\n\n# 前端路由\n\n模式有两种：\n\n1. hash 模式\n2. history 模式\n\n---\n\n- **hash 模式**\n\nURL 的 hash 也就是锚点（#），本质上是改变 window.location 的 href 属性。可以直接给 href 复制，但是页面不刷新。\n\n```js\nlocation.href // 获取当前浏览器 url: 'https://www.baidu.com/'\n\nlocation.href = '/foo'\n```\n\n- **history 模式**\n\nHTML5 新增。\n\n它有五种模式改变 url 而不刷新页面。\n\n```js\nhistory.pushState({}, '', '/foo')\nhistory.replaceState({}, '', '/foo')\nhistory.go(-1)\n\nhistory.back() // 等价 history.go(-1)\nhistory.forward() // history.go(1)\n```\n\n- vue-router\n\n在 Vue 中，有两种方式可以跳转路由：\n\n- 申明式路由 `<router-link to=\"/go\">跳转</router-link>`\n- 编程式路由 `this.$router.go('/go')`\n\n\n**实现 vue-router 路由**\n\n> https://www.bilibili.com/video/BV1n24y1w7kP?p=25&spm_id_from=pageDriver&vd_source=a9f38e58a519cc0570c2dacd34ad7ebe\n\n\n# Promise\n\n> 所谓Promise，就是一个对象，用来传递异步操作的消息。它代表了某个未来才会知道结果的事件（通常是一个异步操作），并且这个事件提供统一的API，可供进一步处理。\n\n\n特点：\n\n1. 对象的状态不受外界影响（pedding, resolved, rejected）\n\n2. 一旦状态改变就不会再改变\n\n\n```js\nconst p = new Promise((resolve, reject) => {\n  if (true) {\n    resolve(true)\n  } else {\n    reject(false)\n  }\n})\n```\n\nresolve函数的作用是，将Promise对象的状态从“未完成”变为“成功”（即从Pending变为Resolved）\n\nreject函数的作用是，将Promise对象的状态从“未完成”变为“失败”（即从Pending变为Rejected）\n\n```js\nfunction timeout(ms) {\n  return new Promise(resolve => {\n    // setTimeout 第三个参数，是传递给第一个函数的，这里是resolve 方法\n    setTimeout(resolve, ms, 'done')\n  })\n}\n\ntimeout(1000).then(res => {\n  console.log(res)\n})\n```\n\nresolve函数的参数除了正常的值外，还可能是另一个Promise实例，表示异步操作的结果有可能是一个值，也有可能是另一个异步操作：\n\n**p1的状态决定了p2的状态**\n\n```js\nconst p1 = new Promise((r, reject) => {\n  setTimeout(() => {\n    reject(new Error('fail'))\n  }, 3000);\n})\n\nconst p2 = new Promise((r, reject) => {\n  r(p1)\n})\n\np2.then(result => {\n  console.log('result ', result)\n}, error => {\n  console.log('error ', error)\n})\n```\n\n上面的代码中，p1是一个Promise,3秒之后变为Rejected。p2的状态由p1决定，p2调用resolve方法，但是此时p1的状态还没有改变，因此p2的状态也不会变。等3秒过后，p1变为Rejected,p2也跟着变为Rejected。\n\n**需要注意的是，catch方法返回的还是一个Promise对象，因此后面还可以接着调用then方法。**\n\n```js\nnew Promise(r => {\n  r(x + 2)\n}).then(res => {\n  console.log('结果 ', res)\n}).catch(err => {\n  console.log('错误 ', err)\n}).then(() => {\n  console.log('随便打印')\n}).finally(() => {\n  console.log('最后打印')\n})\n\n// =======>\n错误  ReferenceError: x is not defined\n\n随便打印\n\n最后打印\n```\n\n## Promise.all\n\n> Promise.all方法用于将多个Promise实例包装成一个新的Promise实例。\n\n```js\nconst p = Promise.all([p1, p2, p3])\n```\n\np的状态由p1、p2、p3决定，分成两种情况。\n1. 只有p1、p2、p3的状态都变成Fulfilled,p的状态才会变成Fulfilled，此时p1、p2、p3的返回值组成一个数组，传递给p的回调函数。\n\n2. 只要p1、p2、p3中有一个被Rejected,p的状态就变成Rejected，此时第一个被Rejected的实例的返回值会传递给p的回调函数。\n\n```js\nconst p3 = function() {\n  return new Promise(r => {\n    setTimeout(() => {\n      r('p3 success')\n    }, 3000);\n  })\n}\n\nconst allP = Promise.all([1, 2, p3()])\n\nallP.then(r => {\n  console.log(r)\n})\n```\n\n上面的例子，3秒后，输出 `[ 1, 2, 'p3 success' ]`\n\n## Promise.race\n\n> 竞速\n>\n> 有一个实例率先改变状态，p的状态就跟着改变。那个率先改变的Promise实例的返回值，就传递给p的回调函数。\n\n\n超时处理\n\n```js\nconst p = Promise.race([\n  fetch('http://localhost:3000/api/user'),\n  new Promise((r, reject) => {\n    setTimeout(() => {\n      reject(new Error('Request timeout'))\n    }, 5000)\n  })\n])\n```\n\n上面的代码中，如果5秒之内fetch方法无法返回结果，变量p的状态就会变为Rejected，从而触发catch方法指定的回调函数。\n\n\n# async await\n\n> async函数就是Generator函数的语法糖。\n\nasync函数返回一个Promise对象，可以使用then方法添加回调函数\n\n```js\nasync function sayName() {\n  return 'name'\n}\n\nconsole.log(sayName()) // Promise { 'name' }\n\nsayName().then(res => console.log(res)) // name\n```\n\n当函数执行时，一旦遇到await就会先返回，等到触发的异步操作完成，再接着执行函数体内后面的语句。\n\n我们来实现一个 sleep 睡眠函数：\n\n```js\n// 睡眠函数\nconst sleep = function(ms) {\n  return new Promise(r => {\n    setTimeout(() => {\n      r()\n    }, ms);\n  })\n}\n\nasync function sayName() {\n  console.log(1)\n\n  await sleep(3000)\n\n\n  console.log(2)\n  \n  return 'name'\n}\n\nsayName().then(res => console.log(res))\n```\n\n当我们调用 sayName 方法时，会立即打印出 1, 3秒过后，打印 2 和 ’name‘\n\n**注意**\n\nawait命令后面的Promise对象，运行结果可能是Rejected，所以最好把 await 命令放在try...catch代码块中。\n\n```js\nconst sleep = function(ms) {\n  return new Promise(r => {\n    // 这里报错，会被外面的 try-catch 接收到\n    console.log(xxxxx + 3)\n\n    setTimeout(() => {\n      // setTimeout 内部报错，不会被外部的 try catch 捕获到\n      r()\n    }, ms)\n  })\n}\n\nasync function sayName() {\n  try {\n    await sleep(3000)\n  } catch (error) {\n    console.log(' - - - ', error)\n  }\n}\n\nsayName().then(res => console.log(res))\n```","slug":"重温JavaScript","published":1,"updated":"2023-05-12T12:12:44.558Z","comments":1,"photos":[],"link":"","_id":"clhkizgyp003c3y0q0ix98g39","content":"<h1 id=\"数据类型-7\"><a href=\"#数据类型-7\" class=\"headerlink\" title=\"数据类型(7)\"></a>数据类型(7)</h1><ol>\n<li>原始数据类型(6种)<br>a. 数值<br>b. 字符串<br>c. 布尔值<br>d. undefined<br>e. Null<br>f. Symbol（ECMAScript 6 新增）</li>\n</ol>\n<p>g.任意精度的整数 (BigInt) ，可以安全地存储和操作大整数，甚至可以超过数字的安全整数限制</p>\n<ol start=\"2\">\n<li>引用数据类型<br>a. 对象<br>b. 数组<br>c. 函数<br>…</li>\n</ol>\n<h1 id=\"运算符\"><a href=\"#运算符\" class=\"headerlink\" title=\"运算符\"></a>运算符</h1><p>加减乘除、取模、自增自减</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><div class=\"code-wrapper\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></div></td><td class=\"code\"><pre><code class=\"hljs js\"><span class=\"hljs-keyword\">var</span> a = <span class=\"hljs-number\">1</span>;<br><span class=\"hljs-keyword\">var</span> b;<br><br><span class=\"hljs-keyword\">var</span> sum = (b = a++ + --a) + a-- + b++;<br></code></pre></td></tr></table></figure>\n\n\n<h1 id=\"数组\"><a href=\"#数组\" class=\"headerlink\" title=\"数组\"></a>数组</h1><h2 id=\"创建数组\"><a href=\"#创建数组\" class=\"headerlink\" title=\"创建数组\"></a>创建数组</h2><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\"><span class=\"hljs-keyword\">var</span> arr = [<span class=\"hljs-number\">1</span>,<span class=\"hljs-number\">2</span>,<span class=\"hljs-number\">3</span>]<br><span class=\"hljs-keyword\">var</span> arr = <span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">Array</span>()<br><br><span class=\"hljs-keyword\">var</span> arr = <span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">Array</span>(<span class=\"hljs-number\">9</span>)<br><span class=\"hljs-keyword\">var</span> arr = <span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">Array</span>(<span class=\"hljs-string\">&#x27;first&#x27;</span>, <span class=\"hljs-string\">&#x27;second&#x27;</span>, <span class=\"hljs-string\">&#x27;name&#x27;</span>)<br></code></pre></td></tr></table></figure>\n\n<h2 id=\"数组方法\"><a href=\"#数组方法\" class=\"headerlink\" title=\"数组方法\"></a>数组方法</h2><p>concat: 连接两个或多个数组，并返回一个新数组。</p>\n<p>join: 将数组中的所有项连接成一个字符串。</p>\n<p>pop: 删除并返回数组的最后一项。</p>\n<p>push: 在数组的末尾添加一个或多项并返回数组的新长度。</p>\n<p>shift: 删除并返回数组的第一项。</p>\n<p>unshift: 在数组的开头添加一个或多项。</p>\n<p>slice: 返回一个数组的片段，该片段包括开始索引到结束索引（不包括结束索引）的所有项。</p>\n<p>splice: 在数组中插入、删除或替换项。</p>\n<p>sort: 对数组的所有项进行排序。</p>\n<p>reverse: 反转数组中的项的顺序。</p>\n<p>indexOf: 返回数组中第一个与给定值匹配的项的索引，如果未找到，则返回 -1。</p>\n<p>lastIndexOf: 返回数组中最后一个与给定值匹配的项的索引，如果未找到，则返回 -1。</p>\n<p>forEach: 对数组中的每一项执行给定的回调函数。</p>\n<p>map: 对数组中的每一项执行给定的回调函数，并返回一个新数组，其中的每一项是回调函数的返回值。</p>\n<p>filter: 对数组中的每一项执行给定的回调函数，并返回一个新数组，其中只包含回调函数返回 true 的项。</p>\n<p>reduce: 从左到右对数组中的所有项进行累加，并返回单个值。</p>\n<p>reduceRight: 从右到左对数组中的所有项进行累加，并返回单个值。</p>\n<p>some: 如果数组中至少有一个项通过了给定的测试，则返回 true，否则返回 false。</p>\n<p>every: 如果数组中的所有项都通过了给定的测试，则返回 true，否则返回 false。</p>\n<h1 id=\"JS编译原理\"><a href=\"#JS编译原理\" class=\"headerlink\" title=\"JS编译原理\"></a>JS编译原理</h1><p>JavaScript 是一种解释型语言，而非编译型语言。这意味着，JavaScript 代码在运行时被动态解释，而不是在编译时预先翻译成机器代码。</p>\n<p>在 JavaScript 中，代码会被加载到浏览器或 Node.js 环境中，然后通过 JavaScript 引擎（例如 V8）解释和执行代码。在解释代码之前，JavaScript 引擎会对代码进行词法分析和语法分析，以确定代码的语法正确性和语义。然后，代码将被执行。</p>\n<p>总的来说，JavaScript 没有明确的编译过程，但它在加载和运行代码之前经过了词法和语法分析。</p>\n<h2 id=\"词法分析\"><a href=\"#词法分析\" class=\"headerlink\" title=\"词法分析\"></a>词法分析</h2><p>词法分析的目的是将 JavaScript 代码的字符串形式转换为一系列词法单元 (tokens)，每个词法单元代表 JavaScript 代码的一个有意义的组成部分，如变量名，运算符，函数等。</p>\n<h2 id=\"语法分析\"><a href=\"#语法分析\" class=\"headerlink\" title=\"语法分析\"></a>语法分析</h2><p>语法分析的目的是将词法单元组合成语法树，语法树代表 JavaScript 代码的结构和语义。</p>\n<h1 id=\"闭包\"><a href=\"#闭包\" class=\"headerlink\" title=\"闭包\"></a>闭包</h1><p>产生条件</p>\n<ol>\n<li><p>函数内部有另一个函数</p>\n</li>\n<li><p>函数内部的函数里面用到了外部函数的局部变量</p>\n</li>\n<li><p>外部函数将内部函数作为返回值 return 出去了。</p>\n</li>\n</ol>\n<p>好处：</p>\n<p>闭包中的变量，充当全局变量使用，减少全局变量的混乱程度。</p>\n<p>清除：</p>\n<p>将变量设置为 null 即可。</p>\n<h1 id=\"new关键字\"><a href=\"#new关键字\" class=\"headerlink\" title=\"new关键字\"></a>new关键字</h1><p>当我们在代码中使用 new 关键字，它会执行以下操作：</p>\n<ul>\n<li>创建一个空对象</li>\n<li>将该对象的原型链指向构造函数的原型对象</li>\n<li>将函数内部的 this 关键字指向新创建的对象</li>\n<li>在新创建的对象上执行构造函数中的代码</li>\n<li>返回该对象</li>\n</ul>\n<h1 id=\"this\"><a href=\"#this\" class=\"headerlink\" title=\"this\"></a>this</h1><ol>\n<li><p>普通函数中，谁调用此函数，this 就指向谁。箭头函数中没有自己的this，在哪里定义，或者说箭头函数外部的this指向谁，就是谁。</p>\n</li>\n<li><p>方法中的this，指向调用方法的对象。</p>\n</li>\n<li><p>指向全局对象：全局函数中的this</p>\n</li>\n<li><p>事件中的 this，指向 dom 对象。</p>\n</li>\n<li><p>构造函数中的 this，指向 new 创建的对象。</p>\n</li>\n</ol>\n<h1 id=\"call、apply、bind\"><a href=\"#call、apply、bind\" class=\"headerlink\" title=\"call、apply、bind\"></a>call、apply、bind</h1><p>它们的作用都是为了改变 this 的指向</p>\n<p>区别是参数不同，第一个参数是想要使用的对象，第二个参数是传递给函数的参数</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\"><span class=\"hljs-keyword\">const</span> dog = &#123;<br>  <span class=\"hljs-attr\">name</span>: <span class=\"hljs-string\">&#x27;is dog&#x27;</span>,<br>  <span class=\"hljs-title function_\">sayName</span>(<span class=\"hljs-params\">name1, name2, name3</span>) &#123;<br>    <span class=\"hljs-variable language_\">console</span>.<span class=\"hljs-title function_\">log</span>(<span class=\"hljs-variable language_\">this</span>.<span class=\"hljs-property\">name</span>)<br>  &#125;<br>&#125;<br><br><span class=\"hljs-keyword\">const</span> cat = &#123;<br>  <span class=\"hljs-attr\">name</span>: <span class=\"hljs-string\">&#x27;喵喵喵&#x27;</span><br>&#125;<br><br>dog.<span class=\"hljs-property\">sayName</span>.<span class=\"hljs-title function_\">call</span>(cat, <span class=\"hljs-number\">1</span>, <span class=\"hljs-number\">2</span>, <span class=\"hljs-number\">3</span>)<br>dog.<span class=\"hljs-property\">sayName</span>.<span class=\"hljs-title function_\">apply</span>(cat, [<span class=\"hljs-number\">1</span>, <span class=\"hljs-number\">2</span>, <span class=\"hljs-number\">3</span>])<br><br><span class=\"hljs-keyword\">const</span> fn = dog.<span class=\"hljs-property\">sayName</span>.<span class=\"hljs-title function_\">bind</span>(cat, <span class=\"hljs-number\">1</span>, <span class=\"hljs-number\">2</span>, <span class=\"hljs-number\">3</span>)<br><span class=\"hljs-title function_\">fn</span>()<br><br></code></pre></td></tr></table></figure>\n\n\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\"><span class=\"hljs-keyword\">const</span> cat = &#123;<br>  <span class=\"hljs-attr\">name</span>: <span class=\"hljs-string\">&#x27;喵喵喵&#x27;</span>,<br>  <span class=\"hljs-title function_\">sayName</span>(<span class=\"hljs-params\"></span>) &#123;<br><br>    <span class=\"hljs-comment\">// 等价于 window 对象调用定时器</span><br>    <span class=\"hljs-built_in\">setTimeout</span>(<span class=\"hljs-keyword\">function</span>(<span class=\"hljs-params\"></span>) &#123;<br>      <span class=\"hljs-variable language_\">console</span>.<span class=\"hljs-title function_\">log</span>(<span class=\"hljs-variable language_\">this</span>) <span class=\"hljs-comment\">// window</span><br>    &#125;)<br>  &#125;<br>&#125;<br><br><span class=\"hljs-keyword\">const</span> cat = &#123;<br>  <span class=\"hljs-attr\">name</span>: <span class=\"hljs-string\">&#x27;喵喵喵&#x27;</span>,<br>  <span class=\"hljs-title function_\">sayName</span>(<span class=\"hljs-params\"></span>) &#123;<br>    <span class=\"hljs-built_in\">setTimeout</span>(<span class=\"hljs-function\">() =&gt;</span> &#123;<br>      <span class=\"hljs-variable language_\">console</span>.<span class=\"hljs-title function_\">log</span>(<span class=\"hljs-variable language_\">this</span>) <span class=\"hljs-comment\">// cat</span><br>      <span class=\"hljs-variable language_\">console</span>.<span class=\"hljs-title function_\">log</span>(<span class=\"hljs-variable language_\">this</span>.<span class=\"hljs-property\">name</span>) <span class=\"hljs-comment\">// 喵喵喵</span><br>    &#125;)<br>  &#125;<br>&#125;<br><br>cat.<span class=\"hljs-title function_\">sayName</span>()<br></code></pre></td></tr></table></figure>\n\n<h1 id=\"nextTick-和-setImmediate\"><a href=\"#nextTick-和-setImmediate\" class=\"headerlink\" title=\"nextTick 和 setImmediate\"></a>nextTick 和 setImmediate</h1><p>同步代码执行完毕，执行 nextTick，然后是异步代码（setTimeout），最后执行 setImmediate</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\"><span class=\"hljs-title function_\">setImmediate</span>(<span class=\"hljs-function\">() =&gt;</span> &#123;<br>  <span class=\"hljs-variable language_\">console</span>.<span class=\"hljs-title function_\">log</span>(<span class=\"hljs-string\">&#x27;setImmediate&#x27;</span>)<br>&#125;)<br><br>process.<span class=\"hljs-title function_\">nextTick</span>(<span class=\"hljs-function\">() =&gt;</span> &#123;<br>  <span class=\"hljs-variable language_\">console</span>.<span class=\"hljs-title function_\">log</span>(<span class=\"hljs-number\">1</span>)<br>&#125;)<br><br><span class=\"hljs-variable language_\">console</span>.<span class=\"hljs-title function_\">log</span>(<span class=\"hljs-number\">2</span>)<br><br><span class=\"hljs-built_in\">setTimeout</span>(<span class=\"hljs-function\">() =&gt;</span> &#123;<br>  <span class=\"hljs-variable language_\">console</span>.<span class=\"hljs-title function_\">log</span>(<span class=\"hljs-number\">3</span>)<br>&#125;, <span class=\"hljs-number\">0</span>);<br><br><br><span class=\"hljs-comment\">// =&gt;&gt;&gt;&gt;&gt;&gt;  2 1 3 setImmediate</span><br></code></pre></td></tr></table></figure>\n\n\n<p>setImmediate表示当前事件循环即将结束时，执行。</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\"><span class=\"hljs-title function_\">setImmediate</span>(<span class=\"hljs-function\">() =&gt;</span> &#123;<br>  <span class=\"hljs-variable language_\">console</span>.<span class=\"hljs-title function_\">log</span>(<span class=\"hljs-string\">&#x27;setImmediate&#x27;</span>)<br>&#125;)<br><br>process.<span class=\"hljs-title function_\">nextTick</span>(<span class=\"hljs-function\">() =&gt;</span> &#123;<br>  <span class=\"hljs-variable language_\">console</span>.<span class=\"hljs-title function_\">log</span>(<span class=\"hljs-number\">1</span>)<br>&#125;)<br><br><span class=\"hljs-variable language_\">console</span>.<span class=\"hljs-title function_\">log</span>(<span class=\"hljs-number\">2</span>)<br><br><span class=\"hljs-built_in\">setTimeout</span>(<span class=\"hljs-function\">() =&gt;</span> &#123;<br>  <span class=\"hljs-variable language_\">console</span>.<span class=\"hljs-title function_\">log</span>(<span class=\"hljs-number\">3</span>)<br>&#125;, <span class=\"hljs-number\">0</span>);<br><span class=\"hljs-built_in\">setTimeout</span>(<span class=\"hljs-function\">() =&gt;</span> &#123;<br>  <span class=\"hljs-variable language_\">console</span>.<span class=\"hljs-title function_\">log</span>(<span class=\"hljs-number\">4</span>)<br>&#125;, <span class=\"hljs-number\">1000</span>);<br><span class=\"hljs-built_in\">setTimeout</span>(<span class=\"hljs-function\">() =&gt;</span> &#123;<br>  <span class=\"hljs-variable language_\">console</span>.<span class=\"hljs-title function_\">log</span>(<span class=\"hljs-number\">5</span>)<br>&#125;, <span class=\"hljs-number\">0</span>);<br><br><br><span class=\"hljs-variable language_\">console</span>.<span class=\"hljs-title function_\">log</span>(<span class=\"hljs-number\">6</span>)<br><br><span class=\"hljs-comment\">// =====&gt; 2 6 1 3 5 setImmediate 4(一秒后输出4)</span><br></code></pre></td></tr></table></figure>\n\n<h1 id=\"宏任务-amp-微任务\"><a href=\"#宏任务-amp-微任务\" class=\"headerlink\" title=\"宏任务&amp;微任务\"></a>宏任务&amp;微任务</h1><p>宏任务：计时器、ajax、读取文件</p>\n<p>微任务：promise.then</p>\n<p>一次事件循环的执行顺序:</p>\n<ol>\n<li><p>同步程序</p>\n</li>\n<li><p>process.nextTick</p>\n</li>\n<li><p>微任务</p>\n</li>\n<li><p>宏任务</p>\n</li>\n<li><p>setImmediate</p>\n</li>\n</ol>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\"><span class=\"hljs-comment\">// 当前事件循环最后执行</span><br><span class=\"hljs-title function_\">setImmediate</span>(<span class=\"hljs-function\">() =&gt;</span> &#123;<br>  <span class=\"hljs-variable language_\">console</span>.<span class=\"hljs-title function_\">log</span>(<span class=\"hljs-string\">&#x27;setImmediate&#x27;</span>)<br>&#125;)<br><br><span class=\"hljs-comment\">// 宏任务执行完毕之后 微任务执行之前执行</span><br>process.<span class=\"hljs-title function_\">nextTick</span>(<span class=\"hljs-function\">() =&gt;</span> &#123;<br>  <span class=\"hljs-variable language_\">console</span>.<span class=\"hljs-title function_\">log</span>(<span class=\"hljs-number\">1</span>)<br>&#125;)<br><br><span class=\"hljs-comment\">// 立即执行</span><br><span class=\"hljs-variable language_\">console</span>.<span class=\"hljs-title function_\">log</span>(<span class=\"hljs-number\">2</span>)<br><br><span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">Promise</span>(<span class=\"hljs-function\"><span class=\"hljs-params\">r</span> =&gt;</span> &#123;<br>  <span class=\"hljs-comment\">// 立即执行</span><br>  <span class=\"hljs-variable language_\">console</span>.<span class=\"hljs-title function_\">log</span>(<span class=\"hljs-number\">7</span>)<br>  <span class=\"hljs-title function_\">r</span>()<br>&#125;).<span class=\"hljs-title function_\">then</span>(<span class=\"hljs-function\">() =&gt;</span> &#123;<br>  <span class=\"hljs-comment\">// 微任务，process.nextTick 执行之后执行</span><br>  <span class=\"hljs-variable language_\">console</span>.<span class=\"hljs-title function_\">log</span>(<span class=\"hljs-number\">8</span>)<br>&#125;)<br><br><span class=\"hljs-comment\">// 宏任务</span><br><span class=\"hljs-built_in\">setTimeout</span>(<span class=\"hljs-function\">() =&gt;</span> &#123;<br>  <span class=\"hljs-comment\">// 微任务执行后执行</span><br>  <span class=\"hljs-variable language_\">console</span>.<span class=\"hljs-title function_\">log</span>(<span class=\"hljs-number\">3</span>)<br>&#125;, <span class=\"hljs-number\">0</span>);<br><span class=\"hljs-built_in\">setTimeout</span>(<span class=\"hljs-function\">() =&gt;</span> &#123;<br>  <span class=\"hljs-comment\">// 放到下一次循环中执行</span><br>  <span class=\"hljs-variable language_\">console</span>.<span class=\"hljs-title function_\">log</span>(<span class=\"hljs-number\">4</span>)<br>&#125;, <span class=\"hljs-number\">1000</span>);<br><span class=\"hljs-built_in\">setTimeout</span>(<span class=\"hljs-function\">() =&gt;</span> &#123;<br>  <span class=\"hljs-comment\">// 微任务执行后执行</span><br>  <span class=\"hljs-variable language_\">console</span>.<span class=\"hljs-title function_\">log</span>(<span class=\"hljs-number\">5</span>)<br>&#125;, <span class=\"hljs-number\">0</span>);<br><br><span class=\"hljs-comment\">// 立即执行</span><br><span class=\"hljs-variable language_\">console</span>.<span class=\"hljs-title function_\">log</span>(<span class=\"hljs-number\">6</span>)<br><br><br><span class=\"hljs-comment\">// 2 7 6 1 8 3 5 setImmediate 4</span><br></code></pre></td></tr></table></figure>\n\n<h1 id=\"浅拷贝、深拷贝\"><a href=\"#浅拷贝、深拷贝\" class=\"headerlink\" title=\"浅拷贝、深拷贝\"></a>浅拷贝、深拷贝</h1><p>浅拷贝</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\"><span class=\"hljs-keyword\">const</span> obj = &#123;<br>  <span class=\"hljs-attr\">name</span>: <span class=\"hljs-string\">&#x27;is obj&#x27;</span>,<br>  <span class=\"hljs-attr\">girlfriend</span>: &#123;<br>    <span class=\"hljs-attr\">name</span>: <span class=\"hljs-string\">&#x27;小红&#x27;</span><br>  &#125;<br>&#125;<br><br><span class=\"hljs-keyword\">const</span> o = <span class=\"hljs-title class_\">Object</span>.<span class=\"hljs-title function_\">assign</span>(&#123;&#125;, obj)<br><br>obj.<span class=\"hljs-property\">name</span> = <span class=\"hljs-string\">&#x27;is o&#x27;</span><br>obj.<span class=\"hljs-property\">girlfriend</span>.<span class=\"hljs-property\">name</span> = <span class=\"hljs-string\">&#x27;小花&#x27;</span><br><br><span class=\"hljs-variable language_\">console</span>.<span class=\"hljs-title function_\">log</span>(o)<br></code></pre></td></tr></table></figure>\n\n<p>深拷贝</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\"><span class=\"hljs-keyword\">const</span> obj = &#123;<br>  <span class=\"hljs-attr\">name</span>: <span class=\"hljs-string\">&#x27;is obj&#x27;</span>,<br>  <span class=\"hljs-attr\">girlfriend</span>: &#123;<br>    <span class=\"hljs-attr\">name</span>: <span class=\"hljs-string\">&#x27;小红&#x27;</span><br>  &#125;<br>&#125;<br><br><span class=\"hljs-keyword\">function</span> <span class=\"hljs-title function_\">deepClone</span>(<span class=\"hljs-params\">obj</span>) &#123;<br>  <span class=\"hljs-keyword\">const</span> o = &#123;&#125;<br><br>  <span class=\"hljs-keyword\">for</span> (<span class=\"hljs-keyword\">const</span> key <span class=\"hljs-keyword\">in</span> obj) &#123;<br>    <span class=\"hljs-keyword\">if</span> (<span class=\"hljs-title class_\">Object</span>.<span class=\"hljs-property\">hasOwnProperty</span>.<span class=\"hljs-title function_\">call</span>(obj, key)) &#123;<br>      <br>      <span class=\"hljs-keyword\">if</span>(<span class=\"hljs-keyword\">typeof</span> obj[key] === <span class=\"hljs-string\">&#x27;object&#x27;</span>) &#123;<br>        o[key] = <span class=\"hljs-title function_\">deepClone</span>(obj[key])<br>      &#125; <span class=\"hljs-keyword\">else</span> &#123;<br>        o[key] = obj[key];<br>      &#125;<br>    &#125;<br>  &#125;<br><br>  <span class=\"hljs-keyword\">return</span> o<br>&#125;<br></code></pre></td></tr></table></figure>\n\n<h1 id=\"JSON-stringify实现深克隆\"><a href=\"#JSON-stringify实现深克隆\" class=\"headerlink\" title=\"JSON.stringify实现深克隆\"></a>JSON.stringify实现深克隆</h1><p>将一个 JSON 对象，转化为字符串，通过 JSON.parse 将字符串转化为对象，从而实现深克隆</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\"><span class=\"hljs-keyword\">const</span> obj = &#123;<br>  <span class=\"hljs-attr\">name</span>: <span class=\"hljs-string\">&#x27;is obj&#x27;</span>,<br>  <span class=\"hljs-attr\">girlfriend</span>: &#123;<br>    <span class=\"hljs-attr\">name</span>: <span class=\"hljs-string\">&#x27;小红&#x27;</span><br>  &#125;<br>&#125;<br><br><span class=\"hljs-keyword\">const</span> o = <span class=\"hljs-title class_\">JSON</span>.<span class=\"hljs-title function_\">parse</span>(<span class=\"hljs-title class_\">JSON</span>.<span class=\"hljs-title function_\">stringify</span>(obj))<br><br><span class=\"hljs-variable language_\">console</span>.<span class=\"hljs-title function_\">log</span>(o)<br></code></pre></td></tr></table></figure>\n\n<p>JSON.stringify 存在的问题：</p>\n<p>如果属性值是 undefined 或者是方法（含箭头函数），克隆出来后，undefined 和函数会丢失</p>\n<h1 id=\"parseInt\"><a href=\"#parseInt\" class=\"headerlink\" title=\"parseInt\"></a>parseInt</h1><blockquote>\n<p>parseInt(string, radix) 解析一个字符串并返回指定基数的十进制整数，radix 是 2-36 之间的整数，表示被解析字符串的基数。</p>\n</blockquote>\n<p>string: 要被解析的值。</p>\n<ul>\n<li>如果参数不是一个字符串，则将其转换为字符串 (使用 ToString抽象操作)。</li>\n<li>字符串开头的空白符将会被忽略。</li>\n</ul>\n<h2 id=\"parseInt-0-0000005-5-为-true\"><a href=\"#parseInt-0-0000005-5-为-true\" class=\"headerlink\" title=\"parseInt (0.0000005) === 5 为 true\"></a><strong>parseInt (0.0000005) === 5 为 true</strong></h2><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\">(<span class=\"hljs-number\">0.5</span>).<span class=\"hljs-title function_\">toString</span>(); <span class=\"hljs-comment\">//  &#x27;0.5&#x27;</span><br>(<span class=\"hljs-number\">0.05</span>).<span class=\"hljs-title function_\">toString</span>(); <span class=\"hljs-comment\">//  &#x27;0.05&#x27;</span><br>(<span class=\"hljs-number\">0.005</span>).<span class=\"hljs-title function_\">toString</span>(); <span class=\"hljs-comment\">//  &#x27;0.005&#x27;</span><br>(<span class=\"hljs-number\">0.0005</span>).<span class=\"hljs-title function_\">toString</span>(); <span class=\"hljs-comment\">//  &#x27;0.0005&#x27;</span><br>(<span class=\"hljs-number\">0.00005</span>).<span class=\"hljs-title function_\">toString</span>(); <span class=\"hljs-comment\">//  &#x27;0.00005&#x27;</span><br>(<span class=\"hljs-number\">0.000005</span>).<span class=\"hljs-title function_\">toString</span>(); <span class=\"hljs-comment\">//  &#x27;0.000005&#x27;</span><br>(<span class=\"hljs-number\">0.0000005</span>).<span class=\"hljs-title function_\">toString</span>(); <span class=\"hljs-comment\">//  &#x27;5e-7&#x27;</span><br></code></pre></td></tr></table></figure>\n<ul>\n<li>可以发现当数字过小时，toString 输出的结果是科学计数法形式。</li>\n<li>parseInt 只能将字符串的前导部分解释为整数值；它忽略任何不能被解释为整数的代码单元，并且不会有忽略指示。</li>\n</ul>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\"><span class=\"hljs-built_in\">parseInt</span>(<span class=\"hljs-number\">0.5</span>) <span class=\"hljs-comment\">// 0</span><br><br><span class=\"hljs-built_in\">parseInt</span>(<span class=\"hljs-number\">0.0000005</span>) <span class=\"hljs-comment\">// 5</span><br></code></pre></td></tr></table></figure>\n\n<h2 id=\"radix-默认值是-10-吗，何种情况返回值是-NaN？\"><a href=\"#radix-默认值是-10-吗，何种情况返回值是-NaN？\" class=\"headerlink\" title=\"radix 默认值是 10 吗，何种情况返回值是 NaN？\"></a>radix 默认值是 10 吗，何种情况返回值是 NaN？</h2><ol>\n<li>当 radix 值为 undefined、0 或未指定的，那 JavaScript 会如何处理这种情况:</li>\n</ol>\n<ul>\n<li>如果输入的 string 以 0x 或 0X 开头，那么 radix 会被假定为 16 ，字符串的其他部分按照十六进制来解析。<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\"><span class=\"hljs-built_in\">parseInt</span>(<span class=\"hljs-string\">&#x27;0x51&#x27;</span>) <span class=\"hljs-comment\">// 5*16^1 + 1*16^0 = 81</span><br></code></pre></td></tr></table></figure></li>\n<li>如果输入的 string 以 0 开头，ES5 规定使用十进制，但并非所有的浏览器都支持，因此使用 parseInt 时，需要指定 radix</li>\n<li>如果输入的 string 以其他任何值开头，radix 值为 10</li>\n</ul>\n<ol start=\"2\">\n<li>radix 参数的值为 2 ~ 36，当 radix 小于 2 或 大于 36(不包含 0)，返回值为 NaN</li>\n</ol>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\"><span class=\"hljs-built_in\">parseInt</span>(<span class=\"hljs-string\">&quot;123&quot;</span>, <span class=\"hljs-number\">1</span>); <span class=\"hljs-comment\">// NaN</span><br><span class=\"hljs-built_in\">parseInt</span>(<span class=\"hljs-string\">&quot;123&quot;</span>, <span class=\"hljs-number\">38</span>); <span class=\"hljs-comment\">// NaN</span><br><span class=\"hljs-built_in\">parseInt</span>(<span class=\"hljs-string\">&quot;123&quot;</span>, -<span class=\"hljs-number\">1</span>); <span class=\"hljs-comment\">// NaN</span><br></code></pre></td></tr></table></figure>\n\n<ol start=\"3\">\n<li>待转换字符串中，所有的可转换数字都不小于 radix 值</li>\n</ol>\n<p>例如 radix 值为 2 (二进制)，而待转换字符串为 ‘3456’，二进制内只有 0、1 是基本算符，因此字符串 ‘3456’ 无法转换成二进制，返回值为 NaN。</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\"><span class=\"hljs-built_in\">parseInt</span>(<span class=\"hljs-string\">&quot;3456&quot;</span>, <span class=\"hljs-number\">2</span>); <span class=\"hljs-comment\">// NaN</span><br><span class=\"hljs-built_in\">parseInt</span>(<span class=\"hljs-string\">&quot;45px&quot;</span>, <span class=\"hljs-number\">3</span>); <span class=\"hljs-comment\">// NaN</span><br></code></pre></td></tr></table></figure>\n\n<h2 id=\"‘1’-‘2’-‘3’-map-parseInt\"><a href=\"#‘1’-‘2’-‘3’-map-parseInt\" class=\"headerlink\" title=\"[‘1’, ‘2’, ‘3’].map(parseInt)\"></a>[‘1’, ‘2’, ‘3’].map(parseInt)</h2><blockquote>\n<p>[parseInt(“1”, 0), parseInt(“2”, 1), parseInt(“3”, 2)]</p>\n</blockquote>\n<ul>\n<li><p>parseInt(“1”, 0)<br>radix 为 0，且 string 以字符 1 开始，radix 值为 10，值为 1。</p>\n</li>\n<li><p>parseInt(“2”, 1)<br>符合 2.2 ，radix 小于 2，返回 NaN</p>\n</li>\n<li><p>parseInt(“3”, 2)<br>待转换字符串中，所有的可转换数字大于 radix 值，返回 NaN</p>\n</li>\n</ul>\n<h1 id=\"渲染进程\"><a href=\"#渲染进程\" class=\"headerlink\" title=\"渲染进程\"></a>渲染进程</h1><ul>\n<li><p>GUI渲染线程</p>\n<ul>\n<li>负责渲染页面，布局和绘制</li>\n<li>页面需要重绘和回流时，该线程就会执行</li>\n<li>与js引擎线程互斥，防止渲染结果不可预期</li>\n</ul>\n</li>\n<li><p>JS引擎线程</p>\n<ul>\n<li>负责处理解析和执行javascript脚本程序</li>\n<li>只有一个JS引擎线程（单线程）</li>\n<li>与GUI渲染线程互斥，防止渲染结果不可预期</li>\n</ul>\n</li>\n<li><p>事件触发线程</p>\n<ul>\n<li>用来控制事件循环（鼠标点击、setTimeout、ajax等）</li>\n<li>当事件满足触发条件时，将事件放入到JS引擎所在的执行队列中</li>\n</ul>\n</li>\n<li><p>定时触发器线程</p>\n<ul>\n<li>setInterval与setTimeout所在的线程</li>\n<li>定时任务并不是由JS引擎计时的，是由定时触发线程来计时的</li>\n<li>计时完毕后，通知事件触发线程</li>\n</ul>\n</li>\n</ul>\n<ul>\n<li>异步http请求线程<ul>\n<li>浏览器有一个单独的线程用于处理AJAX请求</li>\n<li>当请求完成时，若有回调函数，通知事件触发线程</li>\n</ul>\n</li>\n</ul>\n<h1 id=\"为什么-javascript-是单线程的\"><a href=\"#为什么-javascript-是单线程的\" class=\"headerlink\" title=\"为什么 javascript 是单线程的?\"></a>为什么 javascript 是单线程的?</h1><p>首先是历史原因，在创建 javascript 这门语言时，多进程多线程的架构并不流行，硬件支持并不好。</p>\n<p>其次是因为多线程的复杂性，多线程操作需要加锁，编码的复杂性会增高。</p>\n<p>而且，如果同时操作 DOM ，在多线程不加锁的情况下，最终会导致 DOM 渲染的结果不可预期。</p>\n<h1 id=\"为什么-GUI-渲染线程与-JS-引擎线程互斥\"><a href=\"#为什么-GUI-渲染线程与-JS-引擎线程互斥\" class=\"headerlink\" title=\"为什么 GUI 渲染线程与 JS 引擎线程互斥?\"></a>为什么 GUI 渲染线程与 JS 引擎线程互斥?</h1><p>这是由于 JS 是可以操作 DOM 的，如果同时修改元素属性并同时渲染界面(即 JS线程和UI线程同时运行)，<br>那么渲染线程前后获得的元素就可能不一致了。</p>\n<p>因此，为了防止渲染出现不可预期的结果，浏览器设定 GUI渲染线程和JS引擎线程为互斥关系，<br>当JS引擎线程执行时GUI渲染线程会被挂起，GUI更新则会被保存在一个队列中等待JS引擎线程空闲时立即被执行。</p>\n<h1 id=\"如何理解-JS-的运行机制（Event-Loop）\"><a href=\"#如何理解-JS-的运行机制（Event-Loop）\" class=\"headerlink\" title=\"如何理解 JS 的运行机制（Event Loop）?\"></a>如何理解 JS 的运行机制（Event Loop）?</h1><blockquote>\n<p><a href=\"https://juejin.cn/post/6844903919789801486\">https://juejin.cn/post/6844903919789801486</a></p>\n</blockquote>\n<h2 id=\"核心概念\"><a href=\"#核心概念\" class=\"headerlink\" title=\"核心概念\"></a>核心概念</h2><ol>\n<li>JS分为同步任务和异步任务</li>\n<li>同步任务都在 <code>JS 引擎线程</code> 上执行，形成一个执行栈</li>\n<li><code>事件触发线程</code> 管理一个任务队里，异步任务触发条件达成，将回调事件放入执行栈中执行</li>\n<li>执行栈中所有同步任务执行完毕，此时JS引擎线程空闲，系统会读取任务队列，将可运行的异步任务回调事件添加到执行栈中，开始执行</li>\n</ol>\n<h2 id=\"Event-Loop\"><a href=\"#Event-Loop\" class=\"headerlink\" title=\"Event Loop\"></a>Event Loop</h2><ol>\n<li>执行一个宏任务（栈中没有，就从任务队列中获取）</li>\n<li>执行过程中如果遇到了微任务，就将它添加到微任务的任务队列中</li>\n<li>宏任务执行完毕，立即执行微任务队列中的所有微任务（依次执行）</li>\n<li>当前宏任务执行完毕，开始检查渲染，然后 GUI 渲染线程接管，开始渲染</li>\n<li>渲染完毕后，JS 线程接管，开始下一个宏任务（从任务队列中获取）</li>\n</ol>\n<img src=\"/img/event loop.jpg\" />\n\n<h1 id=\"var-和-let-的区别\"><a href=\"#var-和-let-的区别\" class=\"headerlink\" title=\"var 和 let 的区别\"></a>var 和 let 的区别</h1><ol>\n<li>var 声明的变量，其作用域为当前函数、模块或全局；let 声明的变量，其作用域总是在当前的代码块，例如语句块。</li>\n<li>在同一个代码块中，var可以多次声明变量名；let只能声明一次，覆盖一个已经声明的 let 变量会导致语法错误。</li>\n<li>用户可以在声明语句之前使用 var 变量，其值是 undefined. 而 let 必须先声明后使用。</li>\n<li>全局模块下，var 声明的变量作为global上的属性，let声明的变量则不是 global上的属性，而是作为全局模块中的标识符。</li>\n</ol>\n<h1 id=\"垃圾回收机制\"><a href=\"#垃圾回收机制\" class=\"headerlink\" title=\"垃圾回收机制\"></a>垃圾回收机制</h1><ul>\n<li>引用计数：被引用，则计数+1，不再引用，计数减一。存在循环引用问题。</li>\n<li>标记清除（常用）：当变量进入到执行环境，则标记上已进入执行环境，当执行完成后，变量离开执行环境则标记已离开执行环境。</li>\n</ul>\n<h1 id=\"原型链-amp-继承\"><a href=\"#原型链-amp-继承\" class=\"headerlink\" title=\"原型链 &amp; 继承\"></a>原型链 &amp; 继承</h1><p>每个构造函数都有一个原型对象（prototype），原型有一个属性（constructor）指回构造函数，而实例有一个内部指针（<strong>proto</strong>）指向原型。</p>\n<p>原型链最顶端是 null</p>\n<p>任何函数的默认原型都是一个Object的实例，这意味着这个实例有一个内部指针指向Object.prototype。</p>\n<p>这也是为什么自定义类型能够继承包括toString()、valueOf()在内的所有默认方法的原因</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\"><br><span class=\"hljs-keyword\">function</span> <span class=\"hljs-title function_\">Person</span>(<span class=\"hljs-params\">params</span>) &#123;<br>    <span class=\"hljs-variable language_\">console</span>.<span class=\"hljs-title function_\">log</span>(params)<br>&#125;<br><span class=\"hljs-keyword\">const</span> p = <span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">Person</span>(<span class=\"hljs-number\">1</span>)<br><br>p.<span class=\"hljs-property\">__proto__</span>.<span class=\"hljs-property\">constructor</span> === <span class=\"hljs-title class_\">Person</span> &gt;&gt;&gt; <span class=\"hljs-literal\">true</span><br><br>p.<span class=\"hljs-property\">__proto__</span> === <span class=\"hljs-title class_\">Person</span>.<span class=\"hljs-property\"><span class=\"hljs-keyword\">prototype</span></span> &gt;&gt;&gt; <span class=\"hljs-literal\">true</span><br><br>p.<span class=\"hljs-property\">__proto__</span>.<span class=\"hljs-property\">__proto__</span> === <span class=\"hljs-title class_\">Object</span>.<span class=\"hljs-property\"><span class=\"hljs-keyword\">prototype</span></span> &gt;&gt;&gt; <span class=\"hljs-literal\">true</span><br><br>p.<span class=\"hljs-property\">__proto__</span>.<span class=\"hljs-property\">__proto__</span>.<span class=\"hljs-property\">constructor</span> === <span class=\"hljs-title class_\">Object</span> &gt;&gt;&gt; <span class=\"hljs-literal\">true</span><br><br>p.<span class=\"hljs-property\">__proto__</span>.<span class=\"hljs-property\">__proto__</span>.<span class=\"hljs-property\">__proto__</span> === <span class=\"hljs-literal\">null</span><br></code></pre></td></tr></table></figure>\n\n<h2 id=\"原型与继承的关系\"><a href=\"#原型与继承的关系\" class=\"headerlink\" title=\"原型与继承的关系\"></a>原型与继承的关系</h2><p>原型与实例的关系可以通过<code>两种</code>方式来确定。</p>\n<p>第一种方式是使用<code>instanceof操作符</code>，<strong>如果一个实例的原型链中出现过相应的构造函数，则instanceof返回true</strong></p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\">o <span class=\"hljs-keyword\">instanceof</span> <span class=\"hljs-title class_\">Object</span> <span class=\"hljs-comment\">// true 实例的原型链中出现过相应的构造函数</span><br></code></pre></td></tr></table></figure>\n\n<p>第二种方式是使用<code>isPrototypeOf()</code>方法</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\"><span class=\"hljs-title class_\">Object</span>.<span class=\"hljs-property\"><span class=\"hljs-keyword\">prototype</span></span>.<span class=\"hljs-title function_\">isPrototypeOf</span>(o)<br></code></pre></td></tr></table></figure>\n\n<h2 id=\"原型链的问题\"><a href=\"#原型链的问题\" class=\"headerlink\" title=\"原型链的问题\"></a>原型链的问题</h2><p>问题一：原型中包含的引用值会在所有实例间共享</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\"><span class=\"hljs-keyword\">function</span> <span class=\"hljs-title function_\">Super</span>(<span class=\"hljs-params\"></span>) &#123;<br>  <span class=\"hljs-variable language_\">this</span>.<span class=\"hljs-property\">colors</span> = [<span class=\"hljs-string\">&#x27;red&#x27;</span>, <span class=\"hljs-string\">&#x27;blue&#x27;</span>]<br>&#125;<br><br><span class=\"hljs-keyword\">function</span> <span class=\"hljs-title function_\">Sub</span>(<span class=\"hljs-params\"></span>) &#123;&#125;<br><br><span class=\"hljs-title class_\">Sub</span>.<span class=\"hljs-property\"><span class=\"hljs-keyword\">prototype</span></span> = <span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">Super</span>() <span class=\"hljs-comment\">// Super 实例的属性值，变成了 Sub 原型对象上的属性</span><br><br><span class=\"hljs-keyword\">const</span> o1 = <span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">Sub</span>()<br><br>o1.<span class=\"hljs-property\">colors</span>.<span class=\"hljs-title function_\">push</span>(<span class=\"hljs-string\">&#x27;black&#x27;</span>)<br><br><span class=\"hljs-comment\">// 所有实例共享原型对象上的 colors</span><br><span class=\"hljs-keyword\">const</span> o2 = <span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">Sub</span>()<br><span class=\"hljs-variable language_\">console</span>.<span class=\"hljs-title function_\">log</span>(o2.<span class=\"hljs-property\">colors</span>) <span class=\"hljs-comment\">// [&#x27;red&#x27;, &#x27;blue&#x27;, &#x27;black&#x27;]</span><br></code></pre></td></tr></table></figure>\n\n<p>问题二：子类型在实例化时不能给父类型的构造函数传参</p>\n<h2 id=\"盗用构造函数继承\"><a href=\"#盗用构造函数继承\" class=\"headerlink\" title=\"盗用构造函数继承\"></a>盗用构造函数继承</h2><blockquote>\n<p>为了解决原型包含引用值导致的继承问题</p>\n</blockquote>\n<p>在子类构造函数中调用父类构造函数。</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\"><span class=\"hljs-keyword\">function</span> <span class=\"hljs-title function_\">Super</span>(<span class=\"hljs-params\"></span>) &#123;<br>  <span class=\"hljs-variable language_\">this</span>.<span class=\"hljs-property\">colors</span> = [<span class=\"hljs-string\">&#x27;red&#x27;</span>, <span class=\"hljs-string\">&#x27;blue&#x27;</span>]<br>&#125;<br><br><span class=\"hljs-keyword\">function</span> <span class=\"hljs-title function_\">Sub</span>(<span class=\"hljs-params\"></span>) &#123;<br>  <span class=\"hljs-comment\">// 实例化 Sub 时，给每个 Sub 实例上都复制（拷贝）一份 colors，实例间不共享 colors，都有属于自己的那一份 colors</span><br>  <span class=\"hljs-title class_\">Super</span>.<span class=\"hljs-title function_\">call</span>(<span class=\"hljs-variable language_\">this</span>)<br>&#125;<br><br><span class=\"hljs-keyword\">const</span> o1 = <span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">Sub</span>()<br>o1.<span class=\"hljs-property\">colors</span>.<span class=\"hljs-title function_\">push</span>(<span class=\"hljs-string\">&#x27;black&#x27;</span>)<br><br><span class=\"hljs-keyword\">const</span> o2 = <span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">Sub</span>()<br><span class=\"hljs-variable language_\">console</span>.<span class=\"hljs-title function_\">log</span>(o2.<span class=\"hljs-property\">colors</span>) <span class=\"hljs-comment\">// [&#x27;red&#x27;, &#x27;blue&#x27;]</span><br></code></pre></td></tr></table></figure>\n\n<p>也可以给父类传递参数</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\"><span class=\"hljs-keyword\">function</span> <span class=\"hljs-title function_\">Sub</span>(<span class=\"hljs-params\"></span>) &#123;<br>  <span class=\"hljs-title class_\">Super</span>.<span class=\"hljs-title function_\">call</span>(<span class=\"hljs-variable language_\">this</span>, <span class=\"hljs-string\">&#x27;Hello world&#x27;</span>)<br><br>  <span class=\"hljs-comment\">// 这里可以额外添加属性</span><br>  <span class=\"hljs-variable language_\">this</span>.<span class=\"hljs-property\">age</span> = <span class=\"hljs-number\">18</span><br>&#125;<br></code></pre></td></tr></table></figure>\n\n<p>盗用构造函数也是有缺点的：</p>\n<ol>\n<li>不是原型链继承，无法使用父类原型对象上的属性和方法。</li>\n<li>父类上定义的所有属性和方法，都会被复制到子类实例上，如果属性和方法太多，占用内存就会较大。并且继承的目的是为了属性和方法的<code>复用</code>，而且借用构造函数是将父类定义的方法和属性进行了<code>复制</code>。</li>\n</ol>\n<h2 id=\"组合继承（伪经典继承）\"><a href=\"#组合继承（伪经典继承）\" class=\"headerlink\" title=\"组合继承（伪经典继承）\"></a>组合继承（伪经典继承）</h2><blockquote>\n<p>综合了原型链和借用构造函数</p>\n</blockquote>\n<p>基本的思路是使用原型链继承原型上的属性和方法，而通过盗用构造函数继承实例属性。这样既可以把方法定义在原型上以实现重用，又可以让每个实例都有自己的属性。</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\"><span class=\"hljs-keyword\">function</span> <span class=\"hljs-title function_\">Person</span>(<span class=\"hljs-params\">name</span>) &#123;<br>  <span class=\"hljs-variable language_\">this</span>.<span class=\"hljs-property\">name</span> = name<br>  <span class=\"hljs-variable language_\">this</span>.<span class=\"hljs-property\">colors</span> = [<span class=\"hljs-string\">&#x27;red&#x27;</span>, <span class=\"hljs-string\">&#x27;blue&#x27;</span>]<br>&#125;<br><br><span class=\"hljs-title class_\">Person</span>.<span class=\"hljs-property\"><span class=\"hljs-keyword\">prototype</span></span>.<span class=\"hljs-property\">sayName</span> = <span class=\"hljs-keyword\">function</span>(<span class=\"hljs-params\"></span>) &#123;<br>  <span class=\"hljs-variable language_\">console</span>.<span class=\"hljs-title function_\">log</span>(<span class=\"hljs-variable language_\">this</span>.<span class=\"hljs-property\">name</span>)<br>&#125;<br><br><span class=\"hljs-keyword\">function</span> <span class=\"hljs-title function_\">User</span>(<span class=\"hljs-params\">name</span>) &#123;<br><br>  <span class=\"hljs-comment\">// 借用构造函数</span><br>  <span class=\"hljs-title class_\">Person</span>.<span class=\"hljs-title function_\">call</span>(<span class=\"hljs-variable language_\">this</span>, name)<br><br>  <span class=\"hljs-variable language_\">this</span>.<span class=\"hljs-property\">age</span> = <span class=\"hljs-number\">19</span><br>&#125;<br><br><span class=\"hljs-comment\">// 原型链继承</span><br><span class=\"hljs-title class_\">User</span>.<span class=\"hljs-property\"><span class=\"hljs-keyword\">prototype</span></span> = <span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">Person</span>()<br><br><span class=\"hljs-keyword\">const</span> u = <span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">User</span>(<span class=\"hljs-string\">&#x27;xiaoming&#x27;</span>)<br><br><span class=\"hljs-variable language_\">console</span>.<span class=\"hljs-title function_\">log</span>(u.<span class=\"hljs-title function_\">sayName</span>())<br></code></pre></td></tr></table></figure>\n\n<p>组合继承弥补了原型链和盗用构造函数的不足，是JavaScript中使用最多的继承模式。而且组合继承也保留了 <code>instanceof操作符</code> 和 <code>isPrototypeOf()</code> 方法识别合成对象的能力。</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\"><span class=\"hljs-comment\">// true</span><br><br><span class=\"hljs-variable language_\">console</span>.<span class=\"hljs-title function_\">log</span>(u <span class=\"hljs-keyword\">instanceof</span> <span class=\"hljs-title class_\">User</span>)<br><span class=\"hljs-variable language_\">console</span>.<span class=\"hljs-title function_\">log</span>(u <span class=\"hljs-keyword\">instanceof</span> <span class=\"hljs-title class_\">Person</span>)<br><span class=\"hljs-variable language_\">console</span>.<span class=\"hljs-title function_\">log</span>(<span class=\"hljs-title class_\">User</span>.<span class=\"hljs-property\"><span class=\"hljs-keyword\">prototype</span></span>.<span class=\"hljs-title function_\">isPrototypeOf</span>(u))<br><span class=\"hljs-variable language_\">console</span>.<span class=\"hljs-title function_\">log</span>(<span class=\"hljs-title class_\">Person</span>.<span class=\"hljs-property\"><span class=\"hljs-keyword\">prototype</span></span>.<span class=\"hljs-title function_\">isPrototypeOf</span>(u))<br></code></pre></td></tr></table></figure>\n\n<h2 id=\"原型式继承\"><a href=\"#原型式继承\" class=\"headerlink\" title=\"原型式继承\"></a>原型式继承</h2><blockquote>\n<p>创建一个临时构造函数，将传入的对象赋值给这个构造函数的原型，然后返回这个临时类型的一个实例</p>\n</blockquote>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\"><span class=\"hljs-keyword\">function</span> <span class=\"hljs-title function_\">object</span>(<span class=\"hljs-params\">o</span>) &#123;<br>  <span class=\"hljs-keyword\">function</span> <span class=\"hljs-title function_\">F</span>(<span class=\"hljs-params\"></span>) &#123;&#125;<br><br>  F.<span class=\"hljs-property\"><span class=\"hljs-keyword\">prototype</span></span> = o<br><br>  <span class=\"hljs-keyword\">return</span> <span class=\"hljs-keyword\">new</span> <span class=\"hljs-title function_\">F</span>()<br>&#125;<br></code></pre></td></tr></table></figure>\n\n<p>ECMAScript 5通过增加<code>Object.create()</code>方法将原型式继承的概念规范化了。这个方法接收两个参数：作为新对象原型的对象，以及给新对象定义额外属性的对象（第二个可选: Object.defineProperties()）。在只有一个参数时，Object.create()与这里的object()方法效果相同。</p>\n<p>在 <code>组合式继承</code>中，我们可以将原型链继承那部分可以改写一下:</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\"><span class=\"hljs-title class_\">User</span>.<span class=\"hljs-property\"><span class=\"hljs-keyword\">prototype</span></span> = <span class=\"hljs-title class_\">Object</span>.<span class=\"hljs-title function_\">create</span>(<span class=\"hljs-title class_\">Person</span>.<span class=\"hljs-property\"><span class=\"hljs-keyword\">prototype</span></span>)<br></code></pre></td></tr></table></figure>\n\n<h2 id=\"寄生式继承\"><a href=\"#寄生式继承\" class=\"headerlink\" title=\"寄生式继承\"></a>寄生式继承</h2><blockquote>\n<p>创建一个实现继承的函数，以某种方式增强对象，然后返回这个对象</p>\n</blockquote>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\"><span class=\"hljs-keyword\">function</span> <span class=\"hljs-title function_\">createAnother</span>(<span class=\"hljs-params\">original</span>)&#123;<br>  <span class=\"hljs-keyword\">let</span> clone = <span class=\"hljs-title class_\">Object</span>.<span class=\"hljs-title function_\">create</span>(original) <span class=\"hljs-comment\">// 通过调用函数创建一个新对象</span><br><br>  clone.<span class=\"hljs-property\">sayHi</span> = <span class=\"hljs-keyword\">function</span>(<span class=\"hljs-params\"></span>) &#123; <span class=\"hljs-comment\">// 以某种方式增强这个对象</span><br>    <span class=\"hljs-variable language_\">console</span>.<span class=\"hljs-title function_\">log</span>(<span class=\"hljs-string\">&quot;hi&quot;</span>)<br>  &#125;<br>  <span class=\"hljs-keyword\">return</span> clone<br>&#125;<br></code></pre></td></tr></table></figure>\n\n<h2 id=\"寄生式组合继承-继承的最佳模式\"><a href=\"#寄生式组合继承-继承的最佳模式\" class=\"headerlink\" title=\"寄生式组合继承(继承的最佳模式)\"></a>寄生式组合继承(继承的最佳模式)</h2><p>组合继承其实也存在效率问题。最主要的效率问题就是父类构造函数始终会被调用两次：一次在是创建子类原型时调用，另一次是在子类构造函数中调用。</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\"><span class=\"hljs-keyword\">function</span> <span class=\"hljs-title function_\">SuperType</span>(<span class=\"hljs-params\">name</span>) &#123;<br>  <span class=\"hljs-variable language_\">this</span>.<span class=\"hljs-property\">name</span> = name;<br>  <span class=\"hljs-variable language_\">this</span>.<span class=\"hljs-property\">colors</span> = [<span class=\"hljs-string\">&quot;red&quot;</span>, <span class=\"hljs-string\">&quot;blue&quot;</span>, <span class=\"hljs-string\">&quot;green&quot;</span>];<br>&#125;<br><span class=\"hljs-title class_\">SuperType</span>.<span class=\"hljs-property\"><span class=\"hljs-keyword\">prototype</span></span>.<span class=\"hljs-property\">sayName</span> = <span class=\"hljs-keyword\">function</span>(<span class=\"hljs-params\"></span>) &#123;<br>  <span class=\"hljs-variable language_\">console</span>.<span class=\"hljs-title function_\">log</span>(<span class=\"hljs-variable language_\">this</span>.<span class=\"hljs-property\">name</span>);<br>&#125;;<br><span class=\"hljs-keyword\">function</span> <span class=\"hljs-title function_\">SubType</span>(<span class=\"hljs-params\">name, age</span>)&#123;<br>  <span class=\"hljs-title class_\">SuperType</span>.<span class=\"hljs-title function_\">call</span>(<span class=\"hljs-variable language_\">this</span>, name);   <span class=\"hljs-comment\">//第二次调用SuperType()</span><br>  <span class=\"hljs-variable language_\">this</span>.<span class=\"hljs-property\">age</span> = age;<br>&#125;<br><span class=\"hljs-title class_\">SubType</span>.<span class=\"hljs-property\"><span class=\"hljs-keyword\">prototype</span></span>=<span class=\"hljs-title function_\">newSuperType</span>();   <span class=\"hljs-comment\">//第一次调用SuperType()</span><br><span class=\"hljs-title class_\">SubType</span>.<span class=\"hljs-property\"><span class=\"hljs-keyword\">prototype</span></span>.<span class=\"hljs-property\">constructor</span> = <span class=\"hljs-title class_\">SubType</span>;<br><span class=\"hljs-title class_\">SubType</span>.<span class=\"hljs-property\"><span class=\"hljs-keyword\">prototype</span></span>.<span class=\"hljs-property\">sayAge</span> = <span class=\"hljs-keyword\">function</span>(<span class=\"hljs-params\"></span>) &#123;<br>  <span class=\"hljs-variable language_\">console</span>.<span class=\"hljs-title function_\">log</span>(<span class=\"hljs-variable language_\">this</span>.<span class=\"hljs-property\">age</span>);<br>&#125;;<br></code></pre></td></tr></table></figure>\n\n<p>有两组name和colors属性：一组在实例上，另一组在SubType的原型上。</p>\n<img src=\"/img/组合继承.jpg\" />\n\n<blockquote>\n<p>寄生式组合继承通过盗用构造函数继承属性，但使用混合式原型链继承方法。基本思路是不通过调用父类构造函数给子类原型赋值，而是取得父类原型的一个副本。</p>\n</blockquote>\n<p>说到底就是使用寄生式继承来继承父类原型，然后将返回的新对象赋值给子类原型。</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\"><span class=\"hljs-keyword\">function</span> <span class=\"hljs-title function_\">inheritPrototype</span>(<span class=\"hljs-params\">subType, superType</span>) &#123;<br>  <span class=\"hljs-keyword\">const</span> prototype = <span class=\"hljs-title class_\">Object</span>.<span class=\"hljs-title function_\">create</span>(superType.<span class=\"hljs-property\"><span class=\"hljs-keyword\">prototype</span></span>) <span class=\"hljs-comment\">// 将superType.prototype作为新对象的原型对象</span><br><br>  prototype.<span class=\"hljs-property\">constructor</span> = subType <span class=\"hljs-comment\">// 增强对象</span><br><br>  subType.<span class=\"hljs-property\"><span class=\"hljs-keyword\">prototype</span></span> = prototype<span class=\"hljs-comment\">// 新对象赋值给子类原型</span><br>&#125;<br></code></pre></td></tr></table></figure>\n\n<p>我们再来改写 <code>组合继承</code></p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\"><span class=\"hljs-keyword\">function</span> <span class=\"hljs-title function_\">SuperType</span>(<span class=\"hljs-params\">name</span>) &#123;<br>  <span class=\"hljs-variable language_\">this</span>.<span class=\"hljs-property\">name</span> = name;<br>  <span class=\"hljs-variable language_\">this</span>.<span class=\"hljs-property\">colors</span> = [<span class=\"hljs-string\">&quot;red&quot;</span>, <span class=\"hljs-string\">&quot;blue&quot;</span>, <span class=\"hljs-string\">&quot;green&quot;</span>];<br>&#125;<br><span class=\"hljs-title class_\">SuperType</span>.<span class=\"hljs-property\"><span class=\"hljs-keyword\">prototype</span></span>.<span class=\"hljs-property\">sayName</span> = <span class=\"hljs-keyword\">function</span>(<span class=\"hljs-params\"></span>) &#123;<br>  <span class=\"hljs-variable language_\">console</span>.<span class=\"hljs-title function_\">log</span>(<span class=\"hljs-variable language_\">this</span>.<span class=\"hljs-property\">name</span>);<br>&#125;;<br><span class=\"hljs-keyword\">function</span> <span class=\"hljs-title function_\">SubType</span>(<span class=\"hljs-params\">name, age</span>) &#123;<br>  <span class=\"hljs-title class_\">SuperType</span>.<span class=\"hljs-title function_\">call</span>(<span class=\"hljs-variable language_\">this</span>, name);<br>  <span class=\"hljs-variable language_\">this</span>.<span class=\"hljs-property\">age</span> = age;<br>&#125;<br><br><span class=\"hljs-title function_\">inheritPrototype</span>(<span class=\"hljs-title class_\">SubType</span>, <span class=\"hljs-title class_\">SuperType</span>);<br><br><span class=\"hljs-title class_\">SubType</span>.<span class=\"hljs-property\"><span class=\"hljs-keyword\">prototype</span></span>.<span class=\"hljs-property\">sayAge</span> = <span class=\"hljs-keyword\">function</span>(<span class=\"hljs-params\"></span>) &#123;<br>  <span class=\"hljs-variable language_\">console</span>.<span class=\"hljs-title function_\">log</span>(<span class=\"hljs-variable language_\">this</span>.<span class=\"hljs-property\">age</span>);<br>&#125;;<br></code></pre></td></tr></table></figure>\n\n<p>这里只调用了一次SuperType构造函数，避免了SubType.prototype上不必要也用不到的属性，因此可以说这个例子的效率更高。</p>\n<p>而且，原型链仍然保持不变，因此instanceof操作符和isPrototypeOf()方法正常有效。寄生式组合继承可以算是引用类型<code>继承的最佳模式</code>。</p>\n<h2 id=\"ES6-class-的-extends-关键字\"><a href=\"#ES6-class-的-extends-关键字\" class=\"headerlink\" title=\"ES6 class 的 extends 关键字\"></a>ES6 class 的 extends 关键字</h2><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\"><span class=\"hljs-keyword\">class</span> <span class=\"hljs-title class_\">Point</span> &#123;<br>  <span class=\"hljs-title function_\">constructor</span>(<span class=\"hljs-params\">x, y</span>) &#123;<br>    <span class=\"hljs-variable language_\">this</span>.<span class=\"hljs-property\">x</span> = x<br>    <span class=\"hljs-variable language_\">this</span>.<span class=\"hljs-property\">y</span> = y<br>  &#125;<br>&#125;<br><br><span class=\"hljs-keyword\">class</span> <span class=\"hljs-title class_\">ColorPoint</span> <span class=\"hljs-keyword\">extends</span> <span class=\"hljs-title class_ inherited__\">Point</span> &#123;<br>  <span class=\"hljs-title function_\">constructor</span>(<span class=\"hljs-params\">x, y, color</span>) &#123;<br>    <span class=\"hljs-variable language_\">super</span>(x, y) <span class=\"hljs-comment\">// 必须调用 super (父类的 this 对象)</span><br><br>    <span class=\"hljs-variable language_\">this</span>.<span class=\"hljs-property\">color</span> = color<br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure>\n\n<p>子类必须在constructor方法中调用super方法，否则新建实例时会报错。这是因为子类没有自己的this对象，而是继承了父类的this对象，然后对其进行加工。如果不调用super方法，子类就得不到this对象。</p>\n<p>如果在一个方法前加上static关键字，就表示该方法不会被实例继承，而是直接通过类调用，称为“静态方法”。</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\"><span class=\"hljs-keyword\">class</span> <span class=\"hljs-title class_\">Foo</span> &#123;<br>  <span class=\"hljs-keyword\">static</span> <span class=\"hljs-title function_\">staticMethod</span>(<span class=\"hljs-params\"></span>) &#123;<br>    <span class=\"hljs-variable language_\">console</span>.<span class=\"hljs-title function_\">log</span>(<span class=\"hljs-string\">&#x27;static&#x27;</span>)<br>  &#125;<br>&#125;<br><br><span class=\"hljs-title class_\">Foo</span>.<span class=\"hljs-title function_\">staticMethod</span>()<br></code></pre></td></tr></table></figure>\n\n<p>父类的静态方法可以被子类继承。</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\"><span class=\"hljs-keyword\">class</span> <span class=\"hljs-title class_\">Bar</span> <span class=\"hljs-keyword\">extends</span> <span class=\"hljs-title class_ inherited__\">Foo</span> &#123;&#125;<br><br><span class=\"hljs-title class_\">Bar</span>.<span class=\"hljs-title function_\">staticMethod</span>() <span class=\"hljs-comment\">// static</span><br></code></pre></td></tr></table></figure>\n\n<p>父类的静态方法可以在子类中通过 <code>super</code> 关键字调用。</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\"><span class=\"hljs-keyword\">class</span> <span class=\"hljs-title class_\">Bar</span> <span class=\"hljs-keyword\">extends</span> <span class=\"hljs-title class_ inherited__\">Foo</span> &#123;<br>  <span class=\"hljs-keyword\">static</span> <span class=\"hljs-title function_\">say</span>(<span class=\"hljs-params\"></span>) &#123;<br>    <span class=\"hljs-keyword\">return</span> <span class=\"hljs-variable language_\">super</span>.<span class=\"hljs-title function_\">staticMethod</span>() + <span class=\"hljs-string\">&#x27; method&#x27;</span><br>  &#125;<br>&#125;<br><br><span class=\"hljs-title class_\">Bar</span>.<span class=\"hljs-title function_\">say</span>() <span class=\"hljs-comment\">// static method</span><br></code></pre></td></tr></table></figure>\n\n<h1 id=\"class-和构造函数有什么区别？\"><a href=\"#class-和构造函数有什么区别？\" class=\"headerlink\" title=\"class 和构造函数有什么区别？\"></a>class 和构造函数有什么区别？</h1><ol>\n<li><p>类必须使用new调用，直接调用会报错</p>\n</li>\n<li><p>类和模块的内部，默认就是严格模式，所以不需要使用use strict指定运行模式。</p>\n</li>\n<li><p>类不存在变量提升（hoist），这一点与 ES5 完全不同。</p>\n</li>\n<li><p>类的内部所有定义的方法，都是不可枚举的</p>\n</li>\n<li><p>子类必须在constructor方法中调用super方法，否则新建实例时会报错。</p>\n<p> 这是因为子类自己的this对象，必须先通过父类的构造函数完成塑造，得到与父类同样的实例属性和方法，然后再对其进行加工，加上子类自己的实例属性和方法。如果不调用super方法，子类就得不到this对象。</p>\n</li>\n</ol>\n<p>super作为函数调用时，代表父类的构造函数。</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\">&lt;script&gt;<br><span class=\"hljs-keyword\">class</span> <span class=\"hljs-title class_\">A</span> &#123;&#125;<br><span class=\"hljs-keyword\">class</span> <span class=\"hljs-title class_\">B</span> <span class=\"hljs-keyword\">extends</span> <span class=\"hljs-title class_ inherited__\">A</span> &#123; <span class=\"hljs-title function_\">constructor</span>(<span class=\"hljs-params\"></span>) &#123; <span class=\"hljs-variable language_\">super</span>() &#125;&#125;<br>&lt;/script&gt;<br></code></pre></td></tr></table></figure>\n\n<p>super虽然代表了父类A的构造函数，但是返回的是子类B的实例，即super内部的this指的是B的实例，因此super()在这里相当于A.prototype.constructor.call(this)。</p>\n<p><strong>继承区别</strong></p>\n<ol>\n<li>ES5 的继承，实质是先创造子类的实例对象this，然后再将父类的方法添加到this上面 Parent.call(this)</li>\n</ol>\n<ol start=\"2\">\n<li>ES6 的继承机制，实质是先将父类实例对象的属性和方法加到this上面（所以必须先调用super方法），然后再用子类的构造函数修改this。</li>\n</ol>\n<h1 id=\"防抖-amp-节流\"><a href=\"#防抖-amp-节流\" class=\"headerlink\" title=\"防抖&amp;节流\"></a>防抖&amp;节流</h1><p>防抖：用户触发事件频繁，只需要用户最后一次操作的结果</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\"><span class=\"hljs-keyword\">const</span> input = <span class=\"hljs-variable language_\">document</span>.<span class=\"hljs-title function_\">querySelector</span>(<span class=\"hljs-string\">&#x27;input&#x27;</span>)<br><span class=\"hljs-keyword\">let</span> timer = <span class=\"hljs-literal\">null</span><br><br>input.<span class=\"hljs-property\">oninput</span> = <span class=\"hljs-keyword\">function</span>(<span class=\"hljs-params\"></span>)&#123;<br>  <span class=\"hljs-keyword\">if</span> (timer !== <span class=\"hljs-literal\">null</span>) &#123;<br>    timer = <span class=\"hljs-built_in\">clearTimeout</span>(timer)<br>  &#125;<br><br>  timer = <span class=\"hljs-built_in\">setTimeout</span>(<span class=\"hljs-function\">() =&gt;</span> &#123;<br>    <span class=\"hljs-variable language_\">console</span>.<span class=\"hljs-title function_\">log</span>(<span class=\"hljs-variable language_\">this</span>.<span class=\"hljs-property\">value</span>)<br>  &#125;, <span class=\"hljs-number\">1000</span>)<br><br>&#125;<br></code></pre></td></tr></table></figure>\n\n<p>封装防抖函数</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\"><span class=\"hljs-keyword\">function</span> <span class=\"hljs-title function_\">debounce</span>(<span class=\"hljs-params\">fn, delay = <span class=\"hljs-number\">500</span></span>) &#123;<br>  <span class=\"hljs-comment\">// 闭包</span><br>  <span class=\"hljs-keyword\">let</span> timer = <span class=\"hljs-literal\">null</span><br>  <span class=\"hljs-comment\">// this ===&gt; window</span><br><br>  <span class=\"hljs-keyword\">return</span> <span class=\"hljs-keyword\">function</span>(<span class=\"hljs-params\"></span>) &#123;<br>    <span class=\"hljs-comment\">// this ===&gt; input</span><br>    <span class=\"hljs-keyword\">if</span> (timer !== <span class=\"hljs-literal\">null</span>) &#123;<br>      <span class=\"hljs-built_in\">clearTimeout</span>(timer)<br>    &#125;<br><br>    timer = <span class=\"hljs-built_in\">setTimeout</span>(<span class=\"hljs-function\">() =&gt;</span> &#123;<br>      fn.<span class=\"hljs-title function_\">call</span>(<span class=\"hljs-variable language_\">this</span>)<br>    &#125;, delay);<br>  &#125;<br>&#125;<br><br><span class=\"hljs-keyword\">const</span> input = <span class=\"hljs-variable language_\">document</span>.<span class=\"hljs-title function_\">querySelector</span>(<span class=\"hljs-string\">&#x27;#input&#x27;</span>)<br><br>input.<span class=\"hljs-property\">oninput</span> = <span class=\"hljs-title function_\">debounce</span>(<span class=\"hljs-keyword\">function</span>(<span class=\"hljs-params\"></span>) &#123;<br>  <span class=\"hljs-variable language_\">console</span>.<span class=\"hljs-title function_\">log</span>(<span class=\"hljs-string\">&#x27;value: &#x27;</span>, <span class=\"hljs-variable language_\">this</span>.<span class=\"hljs-property\">value</span>)<br>&#125;, <span class=\"hljs-number\">800</span>)<br></code></pre></td></tr></table></figure>\n\n<p>节流：控制事件执行的次数，每个多少时间间隔执行一次。</p>\n<p>比如监听滚动条的触发事件。</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\"><span class=\"hljs-keyword\">let</span> time = <span class=\"hljs-number\">0</span><br><span class=\"hljs-variable language_\">window</span>.<span class=\"hljs-property\">onscroll</span> = <span class=\"hljs-keyword\">function</span>(<span class=\"hljs-params\"></span>) &#123;<br>  <span class=\"hljs-keyword\">if</span> (<span class=\"hljs-title class_\">Date</span>.<span class=\"hljs-title function_\">now</span>() - time &gt; <span class=\"hljs-number\">1000</span>) &#123;<br>    <span class=\"hljs-variable language_\">console</span>.<span class=\"hljs-title function_\">log</span>(<span class=\"hljs-string\">&#x27;执行&#x27;</span>)<br>    time = <span class=\"hljs-title class_\">Date</span>.<span class=\"hljs-title function_\">now</span>()<br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure>\n\n<p>封装节流函数 throttle</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\"><span class=\"hljs-keyword\">function</span> <span class=\"hljs-title function_\">throttle</span>(<span class=\"hljs-params\">fn, delay</span>) &#123;<br>  <span class=\"hljs-keyword\">let</span> time = <span class=\"hljs-number\">0</span><br><br>  <span class=\"hljs-keyword\">return</span> <span class=\"hljs-keyword\">function</span>(<span class=\"hljs-params\"></span>) &#123;<br>    <span class=\"hljs-keyword\">let</span> now = <span class=\"hljs-title class_\">Date</span>.<span class=\"hljs-title function_\">now</span>()<br>    <span class=\"hljs-keyword\">if</span> (now - time &gt; delay) &#123;<br>      fn.<span class=\"hljs-title function_\">call</span>(<span class=\"hljs-variable language_\">this</span>)<br>      time = now<br>    &#125;<br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure>\n\n\n<h1 id=\"纯函数\"><a href=\"#纯函数\" class=\"headerlink\" title=\"纯函数\"></a>纯函数</h1><ol>\n<li>函数的返回结果只依赖于它的参数，相同的输入始终得到相同的输出。</li>\n<li>函数执行过程中没有副作用（不改变、不依赖外部任何可观察的变化）</li>\n</ol>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\"><br><span class=\"hljs-keyword\">function</span> <span class=\"hljs-title function_\">add</span>(<span class=\"hljs-params\">a, b</span>) &#123;<br>  <span class=\"hljs-keyword\">return</span> a + b;<br>&#125;<br><br><span class=\"hljs-title function_\">add</span>(<span class=\"hljs-number\">1</span>, <span class=\"hljs-number\">2</span>)<br></code></pre></td></tr></table></figure>\n\n<h2 id=\"可缓存的纯函数\"><a href=\"#可缓存的纯函数\" class=\"headerlink\" title=\"可缓存的纯函数\"></a>可缓存的纯函数</h2><p>当我们的计算量非常大，可能耗时很长或者很好性能，那么我们通过缓存的方式，避免函数多次计算。从而，计算了一次之后，以后再输入相同的参数，就直接返回上次计算的结果。</p>\n<blockquote>\n<p>lodash.memozie(add, resolver)</p>\n</blockquote>\n<p>实现 memoize 函数</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\"><span class=\"hljs-keyword\">function</span> <span class=\"hljs-title function_\">add</span>(<span class=\"hljs-params\">a, b</span>) &#123;<br>  <span class=\"hljs-variable language_\">console</span>.<span class=\"hljs-title function_\">log</span>(<span class=\"hljs-string\">&#x27;计算中...&#x27;</span>)<br><br>  <span class=\"hljs-keyword\">return</span> a + b<br>&#125;<br><br><span class=\"hljs-keyword\">const</span> <span class=\"hljs-title function_\">resolver</span> = (<span class=\"hljs-params\">...args</span>) =&gt; <span class=\"hljs-title class_\">JSON</span>.<span class=\"hljs-title function_\">stringify</span>(args)<br><br><span class=\"hljs-keyword\">function</span> <span class=\"hljs-title function_\">memoize</span>(<span class=\"hljs-params\">func, resolver</span>) &#123;<br>  <span class=\"hljs-keyword\">const</span> cache = &#123;&#125;<br><br>  <span class=\"hljs-keyword\">return</span> <span class=\"hljs-keyword\">function</span>(<span class=\"hljs-params\">...args</span>) &#123;<br>    <span class=\"hljs-keyword\">const</span> key = <span class=\"hljs-title function_\">resolver</span>(...args) <span class=\"hljs-comment\">// &quot;[a, b]&quot;</span><br><br>    <span class=\"hljs-keyword\">if</span> (cache[key]) &#123;<br>      <span class=\"hljs-keyword\">return</span> cache[key]<br>    &#125; <span class=\"hljs-keyword\">else</span> &#123;<br>      <span class=\"hljs-keyword\">return</span> cache[key] = <span class=\"hljs-title function_\">func</span>(...args)<br>    &#125;<br>  &#125;<br>&#125;<br><br><span class=\"hljs-keyword\">const</span> memoized = <span class=\"hljs-title function_\">memoize</span>(add, resolver)<br><br><span class=\"hljs-variable language_\">console</span>.<span class=\"hljs-title function_\">log</span>(<span class=\"hljs-title function_\">memoized</span>(<span class=\"hljs-number\">9</span>, <span class=\"hljs-number\">9</span>)) <span class=\"hljs-comment\">// 第一次打印 &quot;计算中...&quot;</span><br><span class=\"hljs-variable language_\">console</span>.<span class=\"hljs-title function_\">log</span>(<span class=\"hljs-title function_\">memoized</span>(<span class=\"hljs-number\">9</span>, <span class=\"hljs-number\">9</span>)) <span class=\"hljs-comment\">// 不会打印</span><br><span class=\"hljs-variable language_\">console</span>.<span class=\"hljs-title function_\">log</span>(<span class=\"hljs-title function_\">memoized</span>(<span class=\"hljs-number\">9</span>, <span class=\"hljs-number\">9</span>)) <span class=\"hljs-comment\">// 不会打印</span><br></code></pre></td></tr></table></figure>\n\n\n<h1 id=\"函数柯里化\"><a href=\"#函数柯里化\" class=\"headerlink\" title=\"函数柯里化\"></a>函数柯里化</h1><p>给一个函数传入一部分参数，让其返回的函数接收剩余的参数。直到所有的参数都给到了，才会计算结果。</p>\n<blockquote>\n<p>lodash.curry(fn)</p>\n</blockquote>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\"><br><span class=\"hljs-keyword\">function</span> <span class=\"hljs-title function_\">add</span>(<span class=\"hljs-params\">a, b, c</span>) &#123;<br>  <span class=\"hljs-keyword\">return</span> a + b + c<br>&#125;<br><br><span class=\"hljs-keyword\">const</span> fn = lodash.<span class=\"hljs-title function_\">curry</span>(add)<br><br><span class=\"hljs-variable language_\">console</span>.<span class=\"hljs-title function_\">log</span>(<span class=\"hljs-title function_\">fn</span>(<span class=\"hljs-number\">1</span>, <span class=\"hljs-number\">2</span>, <span class=\"hljs-number\">3</span>))<br><span class=\"hljs-variable language_\">console</span>.<span class=\"hljs-title function_\">log</span>(<span class=\"hljs-title function_\">fn</span>(<span class=\"hljs-number\">1</span>)(<span class=\"hljs-number\">2</span>, <span class=\"hljs-number\">3</span>))<br><span class=\"hljs-variable language_\">console</span>.<span class=\"hljs-title function_\">log</span>(<span class=\"hljs-title function_\">fn</span>(<span class=\"hljs-number\">1</span>)(<span class=\"hljs-number\">2</span>)(<span class=\"hljs-number\">3</span>))<br></code></pre></td></tr></table></figure>\n\n<p>实现 curry 函数</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\"><span class=\"hljs-keyword\">function</span> <span class=\"hljs-title function_\">curry</span>(<span class=\"hljs-params\">func</span>) &#123;<br>  <span class=\"hljs-keyword\">const</span> curried = <span class=\"hljs-keyword\">function</span>(<span class=\"hljs-params\">...args</span>) &#123;<br>    <span class=\"hljs-comment\">// 函数的length 表示它有几个参数</span><br>    <span class=\"hljs-keyword\">if</span> (args.<span class=\"hljs-property\">length</span> &lt; func.<span class=\"hljs-property\">length</span>) &#123;<br>      <span class=\"hljs-comment\">// 累加参数</span><br>      <span class=\"hljs-keyword\">return</span> <span class=\"hljs-function\">(<span class=\"hljs-params\">...rest</span>) =&gt;</span> <span class=\"hljs-title function_\">curried</span>(...args, ...rest)<br>    &#125; <span class=\"hljs-keyword\">else</span> &#123;<br>      <span class=\"hljs-comment\">// 传入的参数和方法接收的参数相同，直接执行 func 函数</span><br>      <span class=\"hljs-keyword\">return</span> <span class=\"hljs-title function_\">func</span>(...args)<br>    &#125;<br>  &#125;<br><br>  <span class=\"hljs-keyword\">return</span> curried<br>&#125;<br><br><span class=\"hljs-keyword\">function</span> <span class=\"hljs-title function_\">add</span>(<span class=\"hljs-params\">a, b, c</span>) &#123;<br>  <span class=\"hljs-keyword\">return</span> a + b + c<br>&#125;<br><br><span class=\"hljs-keyword\">const</span> curried = <span class=\"hljs-title function_\">curry</span>(add)<br><span class=\"hljs-keyword\">const</span> fn = <span class=\"hljs-title function_\">curried</span>(<span class=\"hljs-number\">1</span>)<br><br><span class=\"hljs-variable language_\">console</span>.<span class=\"hljs-title function_\">log</span>(<span class=\"hljs-title function_\">fn</span>(<span class=\"hljs-number\">2</span>)(<span class=\"hljs-number\">3</span>))<br></code></pre></td></tr></table></figure>\n\n<h1 id=\"函数组合\"><a href=\"#函数组合\" class=\"headerlink\" title=\"函数组合\"></a>函数组合</h1><p>看个例子</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\"><span class=\"hljs-keyword\">const</span> str = <span class=\"hljs-string\">&#x27;hello &#x27;</span><br><br><span class=\"hljs-keyword\">function</span> <span class=\"hljs-title function_\">add1</span>(<span class=\"hljs-params\">str</span>) &#123;<br>  <span class=\"hljs-keyword\">return</span> str + <span class=\"hljs-string\">&#x27;wor&#x27;</span><br>&#125;<br><br><span class=\"hljs-keyword\">function</span> <span class=\"hljs-title function_\">add2</span>(<span class=\"hljs-params\">str</span>) &#123;<br>  <span class=\"hljs-keyword\">return</span> str + <span class=\"hljs-string\">&#x27;l&#x27;</span><br>&#125;<br><br><span class=\"hljs-keyword\">function</span> <span class=\"hljs-title function_\">add3</span>(<span class=\"hljs-params\">str</span>) &#123;<br>  <span class=\"hljs-keyword\">return</span> str + <span class=\"hljs-string\">&#x27;d&#x27;</span><br>&#125;<br><br><span class=\"hljs-variable language_\">console</span>.<span class=\"hljs-title function_\">log</span>(<span class=\"hljs-title function_\">add3</span>(<span class=\"hljs-title function_\">add2</span>(<span class=\"hljs-title function_\">add1</span>(str)))) <span class=\"hljs-comment\">// hello wrold</span><br><br></code></pre></td></tr></table></figure>\n\n<p>我们通过手动组合的方式，将每个函数的结果拼接了起来，能实现想要的结果，但是过于繁琐，假设还有几个函数或者十几个函数，恐怕写下去人都麻了。</p>\n<p>好在 lodash 这个库也帮我们实现了这个方法 <code>flow &amp; flowRight</code></p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\"><span class=\"hljs-keyword\">const</span> f = lodash.<span class=\"hljs-title function_\">flow</span>(add1, add2, add3)<br><br><span class=\"hljs-title function_\">f</span>(str)<br></code></pre></td></tr></table></figure>\n\n<p>手动实现</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\"><span class=\"hljs-keyword\">const</span> str = <span class=\"hljs-string\">&#x27;hello - &#x27;</span><br><br><span class=\"hljs-keyword\">function</span> <span class=\"hljs-title function_\">add1</span>(<span class=\"hljs-params\">str</span>) &#123;<br>  <span class=\"hljs-keyword\">return</span> str + <span class=\"hljs-string\">&#x27;wor&#x27;</span><br>&#125;<br><br><span class=\"hljs-keyword\">function</span> <span class=\"hljs-title function_\">add2</span>(<span class=\"hljs-params\">str</span>) &#123;<br>  <span class=\"hljs-keyword\">return</span> str + <span class=\"hljs-string\">&#x27;l&#x27;</span><br>&#125;<br><br><span class=\"hljs-keyword\">function</span> <span class=\"hljs-title function_\">add3</span>(<span class=\"hljs-params\">str</span>) &#123;<br>  <span class=\"hljs-keyword\">return</span> str + <span class=\"hljs-string\">&#x27;d&#x27;</span><br>&#125;<br><br><span class=\"hljs-comment\">// console.log(add3(add2(add1(str))))</span><br><br><span class=\"hljs-keyword\">function</span> <span class=\"hljs-title function_\">flow</span>(<span class=\"hljs-params\">...fns</span>) &#123;<br>  <span class=\"hljs-keyword\">if</span> (fns.<span class=\"hljs-property\">length</span> === <span class=\"hljs-number\">1</span>) &#123;<br>    <span class=\"hljs-keyword\">return</span> fns[<span class=\"hljs-number\">0</span>]<br>  &#125;<br><br>  <span class=\"hljs-keyword\">return</span> fns.<span class=\"hljs-title function_\">reduceRight</span>(<span class=\"hljs-function\">(<span class=\"hljs-params\">a, b</span>) =&gt;</span> &#123;<br>    <span class=\"hljs-comment\">// 从右往左</span><br>    <span class=\"hljs-comment\">// 第一步 a === add3, b === add2</span><br>    <span class=\"hljs-comment\">// 第二步 a === (...args) =&gt; add3(add2(...args)), b === add1</span><br>    <span class=\"hljs-comment\">// 第二步的 a 显示为 (...args) =&gt; a(b(...args))</span><br>    <span class=\"hljs-comment\">// 返回 a(add1(...args))</span><br><br>    <span class=\"hljs-comment\">// 当我们最后调用 f 时，会先计算 add1(...args)，拿到结果后，执行 a &quot;add3(add2(add1(...args)))&quot;</span><br>    <span class=\"hljs-keyword\">return</span> <span class=\"hljs-function\">(<span class=\"hljs-params\">...args</span>) =&gt;</span> <span class=\"hljs-title function_\">a</span>(<span class=\"hljs-title function_\">b</span>(...args))<br>  &#125;)<br>&#125;<br><br><span class=\"hljs-keyword\">const</span> f = <span class=\"hljs-title function_\">flow</span>(add1, add2, add3)<br><br><span class=\"hljs-variable language_\">console</span>.<span class=\"hljs-title function_\">log</span>(<span class=\"hljs-title function_\">f</span>(str))<br></code></pre></td></tr></table></figure>\n\n<h1 id=\"跨域\"><a href=\"#跨域\" class=\"headerlink\" title=\"跨域\"></a>跨域</h1><blockquote>\n<p>什么是跨域？</p>\n<p>CORS 全称是 Cross-Origin Resource Sharing，意为跨域资源共享。当一个资源去访问另一个不同域名或者不同端口的资源时，就会发出跨域请求。如果另一个资源不允许其进行跨域资源访问，就会造成跨域。 </p>\n</blockquote>\n<p><strong>跨域不是问题，是浏览器的安全机制</strong></p>\n<p>跨域不会阻止请求的发出，也不会阻止请求的接收，跨域是浏览器为了保护当前页面，你的请求得到了响应，但是浏览器不会将请求到的数据提交给当前页面上的回调，取而代之的是去提示你这是一个跨域数据。</p>\n<p><strong>同源策略</strong>导致。</p>\n<p>所谓同源策略，就是<code>协议、域名、端口号</code>都要相同，有一个不相同，那么就是非同源，就会出现跨域。</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\"><span class=\"hljs-comment\">// 跨域(端口不同)</span><br><br><span class=\"hljs-attr\">http</span>:<span class=\"hljs-comment\">//localhost:8080</span><br><span class=\"hljs-attr\">http</span>:<span class=\"hljs-comment\">//localhost:3000</span><br><br><br><span class=\"hljs-comment\">// 跨域(协议不同)</span><br><span class=\"hljs-attr\">https</span>:<span class=\"hljs-comment\">//localhost:8080</span><br><span class=\"hljs-attr\">http</span>:<span class=\"hljs-comment\">//localhost:8080</span><br><br><span class=\"hljs-comment\">// 跨域(域名)</span><br><span class=\"hljs-attr\">https</span>:<span class=\"hljs-comment\">//localhost:8080</span><br><span class=\"hljs-attr\">https</span>:<span class=\"hljs-comment\">//192.168.1.2:8080</span><br><br><br><span class=\"hljs-comment\">// 跨域(协议不同，端口也不同)</span><br><span class=\"hljs-comment\">// http 默认端口是 80，https 默认端口是 443</span><br><span class=\"hljs-attr\">http</span>:<span class=\"hljs-comment\">//localhost/bbb</span><br><span class=\"hljs-attr\">https</span>:<span class=\"hljs-comment\">//localhost/aaa</span><br></code></pre></td></tr></table></figure>\n\n<h2 id=\"解决跨域\"><a href=\"#解决跨域\" class=\"headerlink\" title=\"解决跨域\"></a>解决跨域</h2><ol>\n<li>纯后端方式</li>\n</ol>\n<p>假设我们有个后端服务 3000，提供了 <code>/user</code> 接口，我们可以直接在 <code>.html</code> 文件中访问，如果后端不设置跨域，那么肯定会出现跨域提示的。</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\"><span class=\"hljs-comment\">// server</span><br><span class=\"hljs-keyword\">const</span> express = <span class=\"hljs-built_in\">require</span>(<span class=\"hljs-string\">&#x27;express&#x27;</span>)<br><span class=\"hljs-keyword\">const</span> app = <span class=\"hljs-title function_\">express</span>()<br><br>app.<span class=\"hljs-title function_\">get</span>(<span class=\"hljs-string\">&#x27;/user&#x27;</span>, <span class=\"hljs-function\">(<span class=\"hljs-params\">req, res</span>) =&gt;</span> &#123;<br>  res.<span class=\"hljs-title function_\">json</span>(&#123;<br>    <span class=\"hljs-attr\">code</span>: <span class=\"hljs-number\">0</span>,<br>    <span class=\"hljs-attr\">msg</span>: <span class=\"hljs-string\">&#x27;请求user成功&#x27;</span><br>  &#125;)<br>&#125;)<br><br>app.<span class=\"hljs-title function_\">listen</span>(<span class=\"hljs-string\">&#x27;3000&#x27;</span>, <span class=\"hljs-function\">() =&gt;</span> &#123;<br>  <span class=\"hljs-variable language_\">console</span>.<span class=\"hljs-title function_\">log</span>(<span class=\"hljs-string\">&#x27;server running at port 3000...&#x27;</span>)<br>&#125;)<br><br><br><span class=\"hljs-comment\">// client</span><br>&lt;script&gt;<br>  <span class=\"hljs-keyword\">const</span> xhr = <span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">XMLHttpRequest</span>()<br>  xhr.<span class=\"hljs-title function_\">open</span>(<span class=\"hljs-string\">&#x27;get&#x27;</span>, <span class=\"hljs-string\">&#x27;http://localhost:3000/user&#x27;</span>)<br>  xhr.<span class=\"hljs-property\">onload</span> = <span class=\"hljs-keyword\">function</span>(<span class=\"hljs-params\"></span>) &#123;<br>    <span class=\"hljs-title function_\">consolelog</span>(xhr.<span class=\"hljs-property\">response</span>)<br>  &#125;<br>  xhr.<span class=\"hljs-title function_\">send</span>()<br><br><br>  <span class=\"hljs-comment\">// fetch</span><br>  <span class=\"hljs-title function_\">fetch</span>(<span class=\"hljs-string\">&#x27;http://localhost:3000/user&#x27;</span>)<br>    .<span class=\"hljs-title function_\">then</span>(<span class=\"hljs-function\"><span class=\"hljs-params\">res</span> =&gt;</span> res.<span class=\"hljs-title function_\">text</span>())<br>    .<span class=\"hljs-title function_\">then</span>(<span class=\"hljs-function\"><span class=\"hljs-params\">res</span> =&gt;</span> &#123;<br>      <span class=\"hljs-variable language_\">console</span>.<span class=\"hljs-title function_\">log</span>(res)<br>    &#125;)<br>&lt;/script&gt;<br></code></pre></td></tr></table></figure>\n\n<p><strong>后端设置跨域访问</strong></p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\"><span class=\"hljs-comment\">// CORS</span><br>app.<span class=\"hljs-title function_\">all</span>(<span class=\"hljs-string\">&#x27;*&#x27;</span>, <span class=\"hljs-keyword\">function</span>(<span class=\"hljs-params\">req, res, next</span>) &#123;<br>  <span class=\"hljs-comment\">// 允许所有请求源</span><br>  res.<span class=\"hljs-title function_\">header</span>(<span class=\"hljs-string\">&quot;Access-Control-Allow-Origin&quot;</span>, <span class=\"hljs-string\">&quot;*&quot;</span>)<br>  res.<span class=\"hljs-title function_\">header</span>(<span class=\"hljs-string\">&quot;Access-Control-Allow-Headers&quot;</span>, <span class=\"hljs-string\">&quot;*&quot;</span>)<br>  res.<span class=\"hljs-title function_\">header</span>(<span class=\"hljs-string\">&quot;Access-Control-Allow-Methods&quot;</span>, <span class=\"hljs-string\">&quot;*&quot;</span>)<br><br>  <span class=\"hljs-title function_\">next</span>()<br>&#125;)<br></code></pre></td></tr></table></figure>\n\n<ol start=\"2\">\n<li>前端处理<br>主要是通过 <code>webpack devServer</code> 的 <code>proxy</code> 来处理。</li>\n</ol>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\">...<br><span class=\"hljs-attr\">devServer</span>: &#123;<br>  <span class=\"hljs-attr\">proxy</span>: &#123;<br>    <span class=\"hljs-string\">&#x27;/api&#x27;</span>: &#123;<br>      <span class=\"hljs-attr\">target</span>: <span class=\"hljs-string\">&#x27;http://localhost:3000/&#x27;</span> <span class=\"hljs-comment\">// http://localhost:8080/api/user =&gt; http://localhost:3000/api/user</span><br>    &#125;<br>  &#125;,<br>  <span class=\"hljs-attr\">proxy</span>: &#123;<br>    <span class=\"hljs-string\">&#x27;/no-api&#x27;</span>: &#123;<br>      <span class=\"hljs-attr\">target</span>: <span class=\"hljs-string\">&#x27;http://localhost:3000/&#x27;</span>, <span class=\"hljs-comment\">// http://localhost:8080/no-api/user =&gt; http://localhost:3000/user</span><br>      <span class=\"hljs-attr\">pathRewrite</span>: &#123;<br>        <span class=\"hljs-string\">&#x27;/no-api&#x27;</span>: <span class=\"hljs-string\">&#x27;&#x27;</span>, <span class=\"hljs-comment\">// 后端接口中一般不会含有 api 标识符，我们可以去掉</span><br>      &#125;<br>    &#125;<br>  &#125;,<br>&#125;<br>...<br></code></pre></td></tr></table></figure>\n\n<ol start=\"3\">\n<li>Nginx</li>\n</ol>\n<p>要注意的是，devServer 配置 proxy 只是存在于我们开发项目时有用，如果项目要上线，devServer 就没有了，这时可以考虑采用 <code>Nginx</code> 来代理。</p>\n<ol start=\"4\">\n<li>前后端合并方式</li>\n</ol>\n<p>我们可以不采用 <code>devServer proxy</code> 方式，而是在后端配置 <code>webpack-dev-middleware</code>，将前后端进行合并。</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\"><span class=\"hljs-keyword\">const</span> express = <span class=\"hljs-built_in\">require</span>(<span class=\"hljs-string\">&#x27;express&#x27;</span>)<br><span class=\"hljs-keyword\">const</span> webpack = <span class=\"hljs-built_in\">require</span>(<span class=\"hljs-string\">&#x27;webpack&#x27;</span>)<br><span class=\"hljs-keyword\">const</span> middle = <span class=\"hljs-built_in\">require</span>(<span class=\"hljs-string\">&#x27;webpack-dev-middleware&#x27;</span>)<br><span class=\"hljs-keyword\">const</span> compile = <span class=\"hljs-built_in\">require</span>(<span class=\"hljs-string\">&#x27;./webpack.config.js&#x27;</span>)<br><br><br><span class=\"hljs-keyword\">const</span> app = <span class=\"hljs-title function_\">express</span>()<br><br>app.<span class=\"hljs-title function_\">use</span>(<span class=\"hljs-title function_\">middle</span>(compile))<br><br><br>app.<span class=\"hljs-title function_\">get</span>(<span class=\"hljs-string\">&#x27;/user&#x27;</span>, <span class=\"hljs-function\">(<span class=\"hljs-params\">req, res</span>) =&gt;</span> &#123;<br>  res.<span class=\"hljs-title function_\">json</span>(&#123;<br>    <span class=\"hljs-attr\">code</span>: <span class=\"hljs-number\">0</span>,<br>    <span class=\"hljs-attr\">msg</span>: <span class=\"hljs-string\">&#x27;请求user成功&#x27;</span><br>  &#125;)<br>&#125;)<br><br>app.<span class=\"hljs-title function_\">listen</span>(<span class=\"hljs-string\">&#x27;3000&#x27;</span>, <span class=\"hljs-function\">() =&gt;</span> &#123;<br>  <span class=\"hljs-variable language_\">console</span>.<span class=\"hljs-title function_\">log</span>(<span class=\"hljs-string\">&#x27;server running at port 3000...&#x27;</span>)<br>&#125;)<br></code></pre></td></tr></table></figure>\n\n<ol start=\"5\">\n<li>jsonp</li>\n</ol>\n<p>比较老、兼容性好的方式。</p>\n<p>利用标签没有跨域限制的漏洞，在 script 标签上我们可以引用其他服务上的脚本。</p>\n<p>最常见的场景就是 CDN.</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\">&lt;script src=<span class=\"hljs-string\">&quot;https://cdn.jsdelivr.net/npm/vue@2.7.14/dist/vue.js&quot;</span>&gt;&lt;/script&gt;<br></code></pre></td></tr></table></figure>\n\n<p>使用方式：</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\"><span class=\"hljs-keyword\">function</span> <span class=\"hljs-title function_\">callback</span>(<span class=\"hljs-params\">res</span>) &#123;<br>  <span class=\"hljs-variable language_\">console</span>.<span class=\"hljs-title function_\">log</span>(<span class=\"hljs-title class_\">JSON</span>.<span class=\"hljs-title function_\">stringify</span>(res, <span class=\"hljs-literal\">null</span>, <span class=\"hljs-number\">2</span>))<br>&#125;<br><br><span class=\"hljs-comment\">// 动态创建 script 标签，设置好 scr 属性，主要参数是 cb=callback</span><br><br><span class=\"hljs-keyword\">const</span> script = <span class=\"hljs-variable language_\">document</span>.<span class=\"hljs-title function_\">createElement</span>(<span class=\"hljs-string\">&#x27;script&#x27;</span>)<br>script.<span class=\"hljs-property\">src</span> = <span class=\"hljs-string\">&#x27;http://127.0.0.1:3000/info/jsonp?cb=callback&#x27;</span><br><br><span class=\"hljs-variable language_\">document</span>.<span class=\"hljs-title function_\">getElementByTagsName</span>(<span class=\"hljs-string\">&#x27;head&#x27;</span>)[<span class=\"hljs-number\">0</span>].<span class=\"hljs-title function_\">appendChild</span>(script)<br></code></pre></td></tr></table></figure>\n\n<h1 id=\"前端路由\"><a href=\"#前端路由\" class=\"headerlink\" title=\"前端路由\"></a>前端路由</h1><p>模式有两种：</p>\n<ol>\n<li>hash 模式</li>\n<li>history 模式</li>\n</ol>\n<hr>\n<ul>\n<li><strong>hash 模式</strong></li>\n</ul>\n<p>URL 的 hash 也就是锚点（#），本质上是改变 window.location 的 href 属性。可以直接给 href 复制，但是页面不刷新。</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\">location.<span class=\"hljs-property\">href</span> <span class=\"hljs-comment\">// 获取当前浏览器 url: &#x27;https://www.baidu.com/&#x27;</span><br><br>location.<span class=\"hljs-property\">href</span> = <span class=\"hljs-string\">&#x27;/foo&#x27;</span><br></code></pre></td></tr></table></figure>\n\n<ul>\n<li><strong>history 模式</strong></li>\n</ul>\n<p>HTML5 新增。</p>\n<p>它有五种模式改变 url 而不刷新页面。</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\">history.<span class=\"hljs-title function_\">pushState</span>(&#123;&#125;, <span class=\"hljs-string\">&#x27;&#x27;</span>, <span class=\"hljs-string\">&#x27;/foo&#x27;</span>)<br>history.<span class=\"hljs-title function_\">replaceState</span>(&#123;&#125;, <span class=\"hljs-string\">&#x27;&#x27;</span>, <span class=\"hljs-string\">&#x27;/foo&#x27;</span>)<br>history.<span class=\"hljs-title function_\">go</span>(-<span class=\"hljs-number\">1</span>)<br><br>history.<span class=\"hljs-title function_\">back</span>() <span class=\"hljs-comment\">// 等价 history.go(-1)</span><br>history.<span class=\"hljs-title function_\">forward</span>() <span class=\"hljs-comment\">// history.go(1)</span><br></code></pre></td></tr></table></figure>\n\n<ul>\n<li>vue-router</li>\n</ul>\n<p>在 Vue 中，有两种方式可以跳转路由：</p>\n<ul>\n<li>申明式路由 <code>&lt;router-link to=&quot;/go&quot;&gt;跳转&lt;/router-link&gt;</code></li>\n<li>编程式路由 <code>this.$router.go(&#39;/go&#39;)</code></li>\n</ul>\n<p><strong>实现 vue-router 路由</strong></p>\n<blockquote>\n<p><a href=\"https://www.bilibili.com/video/BV1n24y1w7kP?p=25&amp;spm_id_from=pageDriver&amp;vd_source=a9f38e58a519cc0570c2dacd34ad7ebe\">https://www.bilibili.com/video/BV1n24y1w7kP?p=25&amp;spm_id_from=pageDriver&amp;vd_source=a9f38e58a519cc0570c2dacd34ad7ebe</a></p>\n</blockquote>\n<h1 id=\"Promise\"><a href=\"#Promise\" class=\"headerlink\" title=\"Promise\"></a>Promise</h1><blockquote>\n<p>所谓Promise，就是一个对象，用来传递异步操作的消息。它代表了某个未来才会知道结果的事件（通常是一个异步操作），并且这个事件提供统一的API，可供进一步处理。</p>\n</blockquote>\n<p>特点：</p>\n<ol>\n<li><p>对象的状态不受外界影响（pedding, resolved, rejected）</p>\n</li>\n<li><p>一旦状态改变就不会再改变</p>\n</li>\n</ol>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\"><span class=\"hljs-keyword\">const</span> p = <span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">Promise</span>(<span class=\"hljs-function\">(<span class=\"hljs-params\">resolve, reject</span>) =&gt;</span> &#123;<br>  <span class=\"hljs-keyword\">if</span> (<span class=\"hljs-literal\">true</span>) &#123;<br>    <span class=\"hljs-title function_\">resolve</span>(<span class=\"hljs-literal\">true</span>)<br>  &#125; <span class=\"hljs-keyword\">else</span> &#123;<br>    <span class=\"hljs-title function_\">reject</span>(<span class=\"hljs-literal\">false</span>)<br>  &#125;<br>&#125;)<br></code></pre></td></tr></table></figure>\n\n<p>resolve函数的作用是，将Promise对象的状态从“未完成”变为“成功”（即从Pending变为Resolved）</p>\n<p>reject函数的作用是，将Promise对象的状态从“未完成”变为“失败”（即从Pending变为Rejected）</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\"><span class=\"hljs-keyword\">function</span> <span class=\"hljs-title function_\">timeout</span>(<span class=\"hljs-params\">ms</span>) &#123;<br>  <span class=\"hljs-keyword\">return</span> <span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">Promise</span>(<span class=\"hljs-function\"><span class=\"hljs-params\">resolve</span> =&gt;</span> &#123;<br>    <span class=\"hljs-comment\">// setTimeout 第三个参数，是传递给第一个函数的，这里是resolve 方法</span><br>    <span class=\"hljs-built_in\">setTimeout</span>(resolve, ms, <span class=\"hljs-string\">&#x27;done&#x27;</span>)<br>  &#125;)<br>&#125;<br><br><span class=\"hljs-title function_\">timeout</span>(<span class=\"hljs-number\">1000</span>).<span class=\"hljs-title function_\">then</span>(<span class=\"hljs-function\"><span class=\"hljs-params\">res</span> =&gt;</span> &#123;<br>  <span class=\"hljs-variable language_\">console</span>.<span class=\"hljs-title function_\">log</span>(res)<br>&#125;)<br></code></pre></td></tr></table></figure>\n\n<p>resolve函数的参数除了正常的值外，还可能是另一个Promise实例，表示异步操作的结果有可能是一个值，也有可能是另一个异步操作：</p>\n<p><strong>p1的状态决定了p2的状态</strong></p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\"><span class=\"hljs-keyword\">const</span> p1 = <span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">Promise</span>(<span class=\"hljs-function\">(<span class=\"hljs-params\">r, reject</span>) =&gt;</span> &#123;<br>  <span class=\"hljs-built_in\">setTimeout</span>(<span class=\"hljs-function\">() =&gt;</span> &#123;<br>    <span class=\"hljs-title function_\">reject</span>(<span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">Error</span>(<span class=\"hljs-string\">&#x27;fail&#x27;</span>))<br>  &#125;, <span class=\"hljs-number\">3000</span>);<br>&#125;)<br><br><span class=\"hljs-keyword\">const</span> p2 = <span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">Promise</span>(<span class=\"hljs-function\">(<span class=\"hljs-params\">r, reject</span>) =&gt;</span> &#123;<br>  <span class=\"hljs-title function_\">r</span>(p1)<br>&#125;)<br><br>p2.<span class=\"hljs-title function_\">then</span>(<span class=\"hljs-function\"><span class=\"hljs-params\">result</span> =&gt;</span> &#123;<br>  <span class=\"hljs-variable language_\">console</span>.<span class=\"hljs-title function_\">log</span>(<span class=\"hljs-string\">&#x27;result &#x27;</span>, result)<br>&#125;, <span class=\"hljs-function\"><span class=\"hljs-params\">error</span> =&gt;</span> &#123;<br>  <span class=\"hljs-variable language_\">console</span>.<span class=\"hljs-title function_\">log</span>(<span class=\"hljs-string\">&#x27;error &#x27;</span>, error)<br>&#125;)<br></code></pre></td></tr></table></figure>\n\n<p>上面的代码中，p1是一个Promise,3秒之后变为Rejected。p2的状态由p1决定，p2调用resolve方法，但是此时p1的状态还没有改变，因此p2的状态也不会变。等3秒过后，p1变为Rejected,p2也跟着变为Rejected。</p>\n<p><strong>需要注意的是，catch方法返回的还是一个Promise对象，因此后面还可以接着调用then方法。</strong></p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\"><span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">Promise</span>(<span class=\"hljs-function\"><span class=\"hljs-params\">r</span> =&gt;</span> &#123;<br>  <span class=\"hljs-title function_\">r</span>(x + <span class=\"hljs-number\">2</span>)<br>&#125;).<span class=\"hljs-title function_\">then</span>(<span class=\"hljs-function\"><span class=\"hljs-params\">res</span> =&gt;</span> &#123;<br>  <span class=\"hljs-variable language_\">console</span>.<span class=\"hljs-title function_\">log</span>(<span class=\"hljs-string\">&#x27;结果 &#x27;</span>, res)<br>&#125;).<span class=\"hljs-title function_\">catch</span>(<span class=\"hljs-function\"><span class=\"hljs-params\">err</span> =&gt;</span> &#123;<br>  <span class=\"hljs-variable language_\">console</span>.<span class=\"hljs-title function_\">log</span>(<span class=\"hljs-string\">&#x27;错误 &#x27;</span>, err)<br>&#125;).<span class=\"hljs-title function_\">then</span>(<span class=\"hljs-function\">() =&gt;</span> &#123;<br>  <span class=\"hljs-variable language_\">console</span>.<span class=\"hljs-title function_\">log</span>(<span class=\"hljs-string\">&#x27;随便打印&#x27;</span>)<br>&#125;).<span class=\"hljs-title function_\">finally</span>(<span class=\"hljs-function\">() =&gt;</span> &#123;<br>  <span class=\"hljs-variable language_\">console</span>.<span class=\"hljs-title function_\">log</span>(<span class=\"hljs-string\">&#x27;最后打印&#x27;</span>)<br>&#125;)<br><br><span class=\"hljs-comment\">// =======&gt;</span><br>错误  <span class=\"hljs-title class_\">ReferenceError</span>: x is not defined<br><br>随便打印<br><br>最后打印<br></code></pre></td></tr></table></figure>\n\n<h2 id=\"Promise-all\"><a href=\"#Promise-all\" class=\"headerlink\" title=\"Promise.all\"></a>Promise.all</h2><blockquote>\n<p>Promise.all方法用于将多个Promise实例包装成一个新的Promise实例。</p>\n</blockquote>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\"><span class=\"hljs-keyword\">const</span> p = <span class=\"hljs-title class_\">Promise</span>.<span class=\"hljs-title function_\">all</span>([p1, p2, p3])<br></code></pre></td></tr></table></figure>\n\n<p>p的状态由p1、p2、p3决定，分成两种情况。</p>\n<ol>\n<li><p>只有p1、p2、p3的状态都变成Fulfilled,p的状态才会变成Fulfilled，此时p1、p2、p3的返回值组成一个数组，传递给p的回调函数。</p>\n</li>\n<li><p>只要p1、p2、p3中有一个被Rejected,p的状态就变成Rejected，此时第一个被Rejected的实例的返回值会传递给p的回调函数。</p>\n</li>\n</ol>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\"><span class=\"hljs-keyword\">const</span> p3 = <span class=\"hljs-keyword\">function</span>(<span class=\"hljs-params\"></span>) &#123;<br>  <span class=\"hljs-keyword\">return</span> <span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">Promise</span>(<span class=\"hljs-function\"><span class=\"hljs-params\">r</span> =&gt;</span> &#123;<br>    <span class=\"hljs-built_in\">setTimeout</span>(<span class=\"hljs-function\">() =&gt;</span> &#123;<br>      <span class=\"hljs-title function_\">r</span>(<span class=\"hljs-string\">&#x27;p3 success&#x27;</span>)<br>    &#125;, <span class=\"hljs-number\">3000</span>);<br>  &#125;)<br>&#125;<br><br><span class=\"hljs-keyword\">const</span> allP = <span class=\"hljs-title class_\">Promise</span>.<span class=\"hljs-title function_\">all</span>([<span class=\"hljs-number\">1</span>, <span class=\"hljs-number\">2</span>, <span class=\"hljs-title function_\">p3</span>()])<br><br>allP.<span class=\"hljs-title function_\">then</span>(<span class=\"hljs-function\"><span class=\"hljs-params\">r</span> =&gt;</span> &#123;<br>  <span class=\"hljs-variable language_\">console</span>.<span class=\"hljs-title function_\">log</span>(r)<br>&#125;)<br></code></pre></td></tr></table></figure>\n\n<p>上面的例子，3秒后，输出 <code>[ 1, 2, &#39;p3 success&#39; ]</code></p>\n<h2 id=\"Promise-race\"><a href=\"#Promise-race\" class=\"headerlink\" title=\"Promise.race\"></a>Promise.race</h2><blockquote>\n<p>竞速</p>\n<p>有一个实例率先改变状态，p的状态就跟着改变。那个率先改变的Promise实例的返回值，就传递给p的回调函数。</p>\n</blockquote>\n<p>超时处理</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\"><span class=\"hljs-keyword\">const</span> p = <span class=\"hljs-title class_\">Promise</span>.<span class=\"hljs-title function_\">race</span>([<br>  <span class=\"hljs-title function_\">fetch</span>(<span class=\"hljs-string\">&#x27;http://localhost:3000/api/user&#x27;</span>),<br>  <span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">Promise</span>(<span class=\"hljs-function\">(<span class=\"hljs-params\">r, reject</span>) =&gt;</span> &#123;<br>    <span class=\"hljs-built_in\">setTimeout</span>(<span class=\"hljs-function\">() =&gt;</span> &#123;<br>      <span class=\"hljs-title function_\">reject</span>(<span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">Error</span>(<span class=\"hljs-string\">&#x27;Request timeout&#x27;</span>))<br>    &#125;, <span class=\"hljs-number\">5000</span>)<br>  &#125;)<br>])<br></code></pre></td></tr></table></figure>\n\n<p>上面的代码中，如果5秒之内fetch方法无法返回结果，变量p的状态就会变为Rejected，从而触发catch方法指定的回调函数。</p>\n<h1 id=\"async-await\"><a href=\"#async-await\" class=\"headerlink\" title=\"async await\"></a>async await</h1><blockquote>\n<p>async函数就是Generator函数的语法糖。</p>\n</blockquote>\n<p>async函数返回一个Promise对象，可以使用then方法添加回调函数</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\"><span class=\"hljs-keyword\">async</span> <span class=\"hljs-keyword\">function</span> <span class=\"hljs-title function_\">sayName</span>(<span class=\"hljs-params\"></span>) &#123;<br>  <span class=\"hljs-keyword\">return</span> <span class=\"hljs-string\">&#x27;name&#x27;</span><br>&#125;<br><br><span class=\"hljs-variable language_\">console</span>.<span class=\"hljs-title function_\">log</span>(<span class=\"hljs-title function_\">sayName</span>()) <span class=\"hljs-comment\">// Promise &#123; &#x27;name&#x27; &#125;</span><br><br><span class=\"hljs-title function_\">sayName</span>().<span class=\"hljs-title function_\">then</span>(<span class=\"hljs-function\"><span class=\"hljs-params\">res</span> =&gt;</span> <span class=\"hljs-variable language_\">console</span>.<span class=\"hljs-title function_\">log</span>(res)) <span class=\"hljs-comment\">// name</span><br></code></pre></td></tr></table></figure>\n\n<p>当函数执行时，一旦遇到await就会先返回，等到触发的异步操作完成，再接着执行函数体内后面的语句。</p>\n<p>我们来实现一个 sleep 睡眠函数：</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\"><span class=\"hljs-comment\">// 睡眠函数</span><br><span class=\"hljs-keyword\">const</span> sleep = <span class=\"hljs-keyword\">function</span>(<span class=\"hljs-params\">ms</span>) &#123;<br>  <span class=\"hljs-keyword\">return</span> <span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">Promise</span>(<span class=\"hljs-function\"><span class=\"hljs-params\">r</span> =&gt;</span> &#123;<br>    <span class=\"hljs-built_in\">setTimeout</span>(<span class=\"hljs-function\">() =&gt;</span> &#123;<br>      <span class=\"hljs-title function_\">r</span>()<br>    &#125;, ms);<br>  &#125;)<br>&#125;<br><br><span class=\"hljs-keyword\">async</span> <span class=\"hljs-keyword\">function</span> <span class=\"hljs-title function_\">sayName</span>(<span class=\"hljs-params\"></span>) &#123;<br>  <span class=\"hljs-variable language_\">console</span>.<span class=\"hljs-title function_\">log</span>(<span class=\"hljs-number\">1</span>)<br><br>  <span class=\"hljs-keyword\">await</span> <span class=\"hljs-title function_\">sleep</span>(<span class=\"hljs-number\">3000</span>)<br><br><br>  <span class=\"hljs-variable language_\">console</span>.<span class=\"hljs-title function_\">log</span>(<span class=\"hljs-number\">2</span>)<br>  <br>  <span class=\"hljs-keyword\">return</span> <span class=\"hljs-string\">&#x27;name&#x27;</span><br>&#125;<br><br><span class=\"hljs-title function_\">sayName</span>().<span class=\"hljs-title function_\">then</span>(<span class=\"hljs-function\"><span class=\"hljs-params\">res</span> =&gt;</span> <span class=\"hljs-variable language_\">console</span>.<span class=\"hljs-title function_\">log</span>(res))<br></code></pre></td></tr></table></figure>\n\n<p>当我们调用 sayName 方法时，会立即打印出 1, 3秒过后，打印 2 和 ’name‘</p>\n<p><strong>注意</strong></p>\n<p>await命令后面的Promise对象，运行结果可能是Rejected，所以最好把 await 命令放在try…catch代码块中。</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\"><span class=\"hljs-keyword\">const</span> sleep = <span class=\"hljs-keyword\">function</span>(<span class=\"hljs-params\">ms</span>) &#123;<br>  <span class=\"hljs-keyword\">return</span> <span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">Promise</span>(<span class=\"hljs-function\"><span class=\"hljs-params\">r</span> =&gt;</span> &#123;<br>    <span class=\"hljs-comment\">// 这里报错，会被外面的 try-catch 接收到</span><br>    <span class=\"hljs-variable language_\">console</span>.<span class=\"hljs-title function_\">log</span>(xxxxx + <span class=\"hljs-number\">3</span>)<br><br>    <span class=\"hljs-built_in\">setTimeout</span>(<span class=\"hljs-function\">() =&gt;</span> &#123;<br>      <span class=\"hljs-comment\">// setTimeout 内部报错，不会被外部的 try catch 捕获到</span><br>      <span class=\"hljs-title function_\">r</span>()<br>    &#125;, ms)<br>  &#125;)<br>&#125;<br><br><span class=\"hljs-keyword\">async</span> <span class=\"hljs-keyword\">function</span> <span class=\"hljs-title function_\">sayName</span>(<span class=\"hljs-params\"></span>) &#123;<br>  <span class=\"hljs-keyword\">try</span> &#123;<br>    <span class=\"hljs-keyword\">await</span> <span class=\"hljs-title function_\">sleep</span>(<span class=\"hljs-number\">3000</span>)<br>  &#125; <span class=\"hljs-keyword\">catch</span> (error) &#123;<br>    <span class=\"hljs-variable language_\">console</span>.<span class=\"hljs-title function_\">log</span>(<span class=\"hljs-string\">&#x27; - - - &#x27;</span>, error)<br>  &#125;<br>&#125;<br><br><span class=\"hljs-title function_\">sayName</span>().<span class=\"hljs-title function_\">then</span>(<span class=\"hljs-function\"><span class=\"hljs-params\">res</span> =&gt;</span> <span class=\"hljs-variable language_\">console</span>.<span class=\"hljs-title function_\">log</span>(res))<br></code></pre></td></tr></table></figure>","site":{"data":{}},"wordcount":24017,"more":"<h1 id=\"数据类型-7\"><a href=\"#数据类型-7\" class=\"headerlink\" title=\"数据类型(7)\"></a>数据类型(7)</h1><ol>\n<li>原始数据类型(6种)<br>a. 数值<br>b. 字符串<br>c. 布尔值<br>d. undefined<br>e. Null<br>f. Symbol（ECMAScript 6 新增）</li>\n</ol>\n<p>g.任意精度的整数 (BigInt) ，可以安全地存储和操作大整数，甚至可以超过数字的安全整数限制</p>\n<ol start=\"2\">\n<li>引用数据类型<br>a. 对象<br>b. 数组<br>c. 函数<br>…</li>\n</ol>\n<h1 id=\"运算符\"><a href=\"#运算符\" class=\"headerlink\" title=\"运算符\"></a>运算符</h1><p>加减乘除、取模、自增自减</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\"><span class=\"hljs-keyword\">var</span> a = <span class=\"hljs-number\">1</span>;<br><span class=\"hljs-keyword\">var</span> b;<br><br><span class=\"hljs-keyword\">var</span> sum = (b = a++ + --a) + a-- + b++;<br></code></pre></td></tr></table></figure>\n\n\n<h1 id=\"数组\"><a href=\"#数组\" class=\"headerlink\" title=\"数组\"></a>数组</h1><h2 id=\"创建数组\"><a href=\"#创建数组\" class=\"headerlink\" title=\"创建数组\"></a>创建数组</h2><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\"><span class=\"hljs-keyword\">var</span> arr = [<span class=\"hljs-number\">1</span>,<span class=\"hljs-number\">2</span>,<span class=\"hljs-number\">3</span>]<br><span class=\"hljs-keyword\">var</span> arr = <span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">Array</span>()<br><br><span class=\"hljs-keyword\">var</span> arr = <span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">Array</span>(<span class=\"hljs-number\">9</span>)<br><span class=\"hljs-keyword\">var</span> arr = <span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">Array</span>(<span class=\"hljs-string\">&#x27;first&#x27;</span>, <span class=\"hljs-string\">&#x27;second&#x27;</span>, <span class=\"hljs-string\">&#x27;name&#x27;</span>)<br></code></pre></td></tr></table></figure>\n\n<h2 id=\"数组方法\"><a href=\"#数组方法\" class=\"headerlink\" title=\"数组方法\"></a>数组方法</h2><p>concat: 连接两个或多个数组，并返回一个新数组。</p>\n<p>join: 将数组中的所有项连接成一个字符串。</p>\n<p>pop: 删除并返回数组的最后一项。</p>\n<p>push: 在数组的末尾添加一个或多项并返回数组的新长度。</p>\n<p>shift: 删除并返回数组的第一项。</p>\n<p>unshift: 在数组的开头添加一个或多项。</p>\n<p>slice: 返回一个数组的片段，该片段包括开始索引到结束索引（不包括结束索引）的所有项。</p>\n<p>splice: 在数组中插入、删除或替换项。</p>\n<p>sort: 对数组的所有项进行排序。</p>\n<p>reverse: 反转数组中的项的顺序。</p>\n<p>indexOf: 返回数组中第一个与给定值匹配的项的索引，如果未找到，则返回 -1。</p>\n<p>lastIndexOf: 返回数组中最后一个与给定值匹配的项的索引，如果未找到，则返回 -1。</p>\n<p>forEach: 对数组中的每一项执行给定的回调函数。</p>\n<p>map: 对数组中的每一项执行给定的回调函数，并返回一个新数组，其中的每一项是回调函数的返回值。</p>\n<p>filter: 对数组中的每一项执行给定的回调函数，并返回一个新数组，其中只包含回调函数返回 true 的项。</p>\n<p>reduce: 从左到右对数组中的所有项进行累加，并返回单个值。</p>\n<p>reduceRight: 从右到左对数组中的所有项进行累加，并返回单个值。</p>\n<p>some: 如果数组中至少有一个项通过了给定的测试，则返回 true，否则返回 false。</p>\n<p>every: 如果数组中的所有项都通过了给定的测试，则返回 true，否则返回 false。</p>\n<h1 id=\"JS编译原理\"><a href=\"#JS编译原理\" class=\"headerlink\" title=\"JS编译原理\"></a>JS编译原理</h1><p>JavaScript 是一种解释型语言，而非编译型语言。这意味着，JavaScript 代码在运行时被动态解释，而不是在编译时预先翻译成机器代码。</p>\n<p>在 JavaScript 中，代码会被加载到浏览器或 Node.js 环境中，然后通过 JavaScript 引擎（例如 V8）解释和执行代码。在解释代码之前，JavaScript 引擎会对代码进行词法分析和语法分析，以确定代码的语法正确性和语义。然后，代码将被执行。</p>\n<p>总的来说，JavaScript 没有明确的编译过程，但它在加载和运行代码之前经过了词法和语法分析。</p>\n<h2 id=\"词法分析\"><a href=\"#词法分析\" class=\"headerlink\" title=\"词法分析\"></a>词法分析</h2><p>词法分析的目的是将 JavaScript 代码的字符串形式转换为一系列词法单元 (tokens)，每个词法单元代表 JavaScript 代码的一个有意义的组成部分，如变量名，运算符，函数等。</p>\n<h2 id=\"语法分析\"><a href=\"#语法分析\" class=\"headerlink\" title=\"语法分析\"></a>语法分析</h2><p>语法分析的目的是将词法单元组合成语法树，语法树代表 JavaScript 代码的结构和语义。</p>\n<h1 id=\"闭包\"><a href=\"#闭包\" class=\"headerlink\" title=\"闭包\"></a>闭包</h1><p>产生条件</p>\n<ol>\n<li><p>函数内部有另一个函数</p>\n</li>\n<li><p>函数内部的函数里面用到了外部函数的局部变量</p>\n</li>\n<li><p>外部函数将内部函数作为返回值 return 出去了。</p>\n</li>\n</ol>\n<p>好处：</p>\n<p>闭包中的变量，充当全局变量使用，减少全局变量的混乱程度。</p>\n<p>清除：</p>\n<p>将变量设置为 null 即可。</p>\n<h1 id=\"new关键字\"><a href=\"#new关键字\" class=\"headerlink\" title=\"new关键字\"></a>new关键字</h1><p>当我们在代码中使用 new 关键字，它会执行以下操作：</p>\n<ul>\n<li>创建一个空对象</li>\n<li>将该对象的原型链指向构造函数的原型对象</li>\n<li>将函数内部的 this 关键字指向新创建的对象</li>\n<li>在新创建的对象上执行构造函数中的代码</li>\n<li>返回该对象</li>\n</ul>\n<h1 id=\"this\"><a href=\"#this\" class=\"headerlink\" title=\"this\"></a>this</h1><ol>\n<li><p>普通函数中，谁调用此函数，this 就指向谁。箭头函数中没有自己的this，在哪里定义，或者说箭头函数外部的this指向谁，就是谁。</p>\n</li>\n<li><p>方法中的this，指向调用方法的对象。</p>\n</li>\n<li><p>指向全局对象：全局函数中的this</p>\n</li>\n<li><p>事件中的 this，指向 dom 对象。</p>\n</li>\n<li><p>构造函数中的 this，指向 new 创建的对象。</p>\n</li>\n</ol>\n<h1 id=\"call、apply、bind\"><a href=\"#call、apply、bind\" class=\"headerlink\" title=\"call、apply、bind\"></a>call、apply、bind</h1><p>它们的作用都是为了改变 this 的指向</p>\n<p>区别是参数不同，第一个参数是想要使用的对象，第二个参数是传递给函数的参数</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\"><span class=\"hljs-keyword\">const</span> dog = &#123;<br>  <span class=\"hljs-attr\">name</span>: <span class=\"hljs-string\">&#x27;is dog&#x27;</span>,<br>  <span class=\"hljs-title function_\">sayName</span>(<span class=\"hljs-params\">name1, name2, name3</span>) &#123;<br>    <span class=\"hljs-variable language_\">console</span>.<span class=\"hljs-title function_\">log</span>(<span class=\"hljs-variable language_\">this</span>.<span class=\"hljs-property\">name</span>)<br>  &#125;<br>&#125;<br><br><span class=\"hljs-keyword\">const</span> cat = &#123;<br>  <span class=\"hljs-attr\">name</span>: <span class=\"hljs-string\">&#x27;喵喵喵&#x27;</span><br>&#125;<br><br>dog.<span class=\"hljs-property\">sayName</span>.<span class=\"hljs-title function_\">call</span>(cat, <span class=\"hljs-number\">1</span>, <span class=\"hljs-number\">2</span>, <span class=\"hljs-number\">3</span>)<br>dog.<span class=\"hljs-property\">sayName</span>.<span class=\"hljs-title function_\">apply</span>(cat, [<span class=\"hljs-number\">1</span>, <span class=\"hljs-number\">2</span>, <span class=\"hljs-number\">3</span>])<br><br><span class=\"hljs-keyword\">const</span> fn = dog.<span class=\"hljs-property\">sayName</span>.<span class=\"hljs-title function_\">bind</span>(cat, <span class=\"hljs-number\">1</span>, <span class=\"hljs-number\">2</span>, <span class=\"hljs-number\">3</span>)<br><span class=\"hljs-title function_\">fn</span>()<br><br></code></pre></td></tr></table></figure>\n\n\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\"><span class=\"hljs-keyword\">const</span> cat = &#123;<br>  <span class=\"hljs-attr\">name</span>: <span class=\"hljs-string\">&#x27;喵喵喵&#x27;</span>,<br>  <span class=\"hljs-title function_\">sayName</span>(<span class=\"hljs-params\"></span>) &#123;<br><br>    <span class=\"hljs-comment\">// 等价于 window 对象调用定时器</span><br>    <span class=\"hljs-built_in\">setTimeout</span>(<span class=\"hljs-keyword\">function</span>(<span class=\"hljs-params\"></span>) &#123;<br>      <span class=\"hljs-variable language_\">console</span>.<span class=\"hljs-title function_\">log</span>(<span class=\"hljs-variable language_\">this</span>) <span class=\"hljs-comment\">// window</span><br>    &#125;)<br>  &#125;<br>&#125;<br><br><span class=\"hljs-keyword\">const</span> cat = &#123;<br>  <span class=\"hljs-attr\">name</span>: <span class=\"hljs-string\">&#x27;喵喵喵&#x27;</span>,<br>  <span class=\"hljs-title function_\">sayName</span>(<span class=\"hljs-params\"></span>) &#123;<br>    <span class=\"hljs-built_in\">setTimeout</span>(<span class=\"hljs-function\">() =&gt;</span> &#123;<br>      <span class=\"hljs-variable language_\">console</span>.<span class=\"hljs-title function_\">log</span>(<span class=\"hljs-variable language_\">this</span>) <span class=\"hljs-comment\">// cat</span><br>      <span class=\"hljs-variable language_\">console</span>.<span class=\"hljs-title function_\">log</span>(<span class=\"hljs-variable language_\">this</span>.<span class=\"hljs-property\">name</span>) <span class=\"hljs-comment\">// 喵喵喵</span><br>    &#125;)<br>  &#125;<br>&#125;<br><br>cat.<span class=\"hljs-title function_\">sayName</span>()<br></code></pre></td></tr></table></figure>\n\n<h1 id=\"nextTick-和-setImmediate\"><a href=\"#nextTick-和-setImmediate\" class=\"headerlink\" title=\"nextTick 和 setImmediate\"></a>nextTick 和 setImmediate</h1><p>同步代码执行完毕，执行 nextTick，然后是异步代码（setTimeout），最后执行 setImmediate</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\"><span class=\"hljs-title function_\">setImmediate</span>(<span class=\"hljs-function\">() =&gt;</span> &#123;<br>  <span class=\"hljs-variable language_\">console</span>.<span class=\"hljs-title function_\">log</span>(<span class=\"hljs-string\">&#x27;setImmediate&#x27;</span>)<br>&#125;)<br><br>process.<span class=\"hljs-title function_\">nextTick</span>(<span class=\"hljs-function\">() =&gt;</span> &#123;<br>  <span class=\"hljs-variable language_\">console</span>.<span class=\"hljs-title function_\">log</span>(<span class=\"hljs-number\">1</span>)<br>&#125;)<br><br><span class=\"hljs-variable language_\">console</span>.<span class=\"hljs-title function_\">log</span>(<span class=\"hljs-number\">2</span>)<br><br><span class=\"hljs-built_in\">setTimeout</span>(<span class=\"hljs-function\">() =&gt;</span> &#123;<br>  <span class=\"hljs-variable language_\">console</span>.<span class=\"hljs-title function_\">log</span>(<span class=\"hljs-number\">3</span>)<br>&#125;, <span class=\"hljs-number\">0</span>);<br><br><br><span class=\"hljs-comment\">// =&gt;&gt;&gt;&gt;&gt;&gt;  2 1 3 setImmediate</span><br></code></pre></td></tr></table></figure>\n\n\n<p>setImmediate表示当前事件循环即将结束时，执行。</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\"><span class=\"hljs-title function_\">setImmediate</span>(<span class=\"hljs-function\">() =&gt;</span> &#123;<br>  <span class=\"hljs-variable language_\">console</span>.<span class=\"hljs-title function_\">log</span>(<span class=\"hljs-string\">&#x27;setImmediate&#x27;</span>)<br>&#125;)<br><br>process.<span class=\"hljs-title function_\">nextTick</span>(<span class=\"hljs-function\">() =&gt;</span> &#123;<br>  <span class=\"hljs-variable language_\">console</span>.<span class=\"hljs-title function_\">log</span>(<span class=\"hljs-number\">1</span>)<br>&#125;)<br><br><span class=\"hljs-variable language_\">console</span>.<span class=\"hljs-title function_\">log</span>(<span class=\"hljs-number\">2</span>)<br><br><span class=\"hljs-built_in\">setTimeout</span>(<span class=\"hljs-function\">() =&gt;</span> &#123;<br>  <span class=\"hljs-variable language_\">console</span>.<span class=\"hljs-title function_\">log</span>(<span class=\"hljs-number\">3</span>)<br>&#125;, <span class=\"hljs-number\">0</span>);<br><span class=\"hljs-built_in\">setTimeout</span>(<span class=\"hljs-function\">() =&gt;</span> &#123;<br>  <span class=\"hljs-variable language_\">console</span>.<span class=\"hljs-title function_\">log</span>(<span class=\"hljs-number\">4</span>)<br>&#125;, <span class=\"hljs-number\">1000</span>);<br><span class=\"hljs-built_in\">setTimeout</span>(<span class=\"hljs-function\">() =&gt;</span> &#123;<br>  <span class=\"hljs-variable language_\">console</span>.<span class=\"hljs-title function_\">log</span>(<span class=\"hljs-number\">5</span>)<br>&#125;, <span class=\"hljs-number\">0</span>);<br><br><br><span class=\"hljs-variable language_\">console</span>.<span class=\"hljs-title function_\">log</span>(<span class=\"hljs-number\">6</span>)<br><br><span class=\"hljs-comment\">// =====&gt; 2 6 1 3 5 setImmediate 4(一秒后输出4)</span><br></code></pre></td></tr></table></figure>\n\n<h1 id=\"宏任务-amp-微任务\"><a href=\"#宏任务-amp-微任务\" class=\"headerlink\" title=\"宏任务&amp;微任务\"></a>宏任务&amp;微任务</h1><p>宏任务：计时器、ajax、读取文件</p>\n<p>微任务：promise.then</p>\n<p>一次事件循环的执行顺序:</p>\n<ol>\n<li><p>同步程序</p>\n</li>\n<li><p>process.nextTick</p>\n</li>\n<li><p>微任务</p>\n</li>\n<li><p>宏任务</p>\n</li>\n<li><p>setImmediate</p>\n</li>\n</ol>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\"><span class=\"hljs-comment\">// 当前事件循环最后执行</span><br><span class=\"hljs-title function_\">setImmediate</span>(<span class=\"hljs-function\">() =&gt;</span> &#123;<br>  <span class=\"hljs-variable language_\">console</span>.<span class=\"hljs-title function_\">log</span>(<span class=\"hljs-string\">&#x27;setImmediate&#x27;</span>)<br>&#125;)<br><br><span class=\"hljs-comment\">// 宏任务执行完毕之后 微任务执行之前执行</span><br>process.<span class=\"hljs-title function_\">nextTick</span>(<span class=\"hljs-function\">() =&gt;</span> &#123;<br>  <span class=\"hljs-variable language_\">console</span>.<span class=\"hljs-title function_\">log</span>(<span class=\"hljs-number\">1</span>)<br>&#125;)<br><br><span class=\"hljs-comment\">// 立即执行</span><br><span class=\"hljs-variable language_\">console</span>.<span class=\"hljs-title function_\">log</span>(<span class=\"hljs-number\">2</span>)<br><br><span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">Promise</span>(<span class=\"hljs-function\"><span class=\"hljs-params\">r</span> =&gt;</span> &#123;<br>  <span class=\"hljs-comment\">// 立即执行</span><br>  <span class=\"hljs-variable language_\">console</span>.<span class=\"hljs-title function_\">log</span>(<span class=\"hljs-number\">7</span>)<br>  <span class=\"hljs-title function_\">r</span>()<br>&#125;).<span class=\"hljs-title function_\">then</span>(<span class=\"hljs-function\">() =&gt;</span> &#123;<br>  <span class=\"hljs-comment\">// 微任务，process.nextTick 执行之后执行</span><br>  <span class=\"hljs-variable language_\">console</span>.<span class=\"hljs-title function_\">log</span>(<span class=\"hljs-number\">8</span>)<br>&#125;)<br><br><span class=\"hljs-comment\">// 宏任务</span><br><span class=\"hljs-built_in\">setTimeout</span>(<span class=\"hljs-function\">() =&gt;</span> &#123;<br>  <span class=\"hljs-comment\">// 微任务执行后执行</span><br>  <span class=\"hljs-variable language_\">console</span>.<span class=\"hljs-title function_\">log</span>(<span class=\"hljs-number\">3</span>)<br>&#125;, <span class=\"hljs-number\">0</span>);<br><span class=\"hljs-built_in\">setTimeout</span>(<span class=\"hljs-function\">() =&gt;</span> &#123;<br>  <span class=\"hljs-comment\">// 放到下一次循环中执行</span><br>  <span class=\"hljs-variable language_\">console</span>.<span class=\"hljs-title function_\">log</span>(<span class=\"hljs-number\">4</span>)<br>&#125;, <span class=\"hljs-number\">1000</span>);<br><span class=\"hljs-built_in\">setTimeout</span>(<span class=\"hljs-function\">() =&gt;</span> &#123;<br>  <span class=\"hljs-comment\">// 微任务执行后执行</span><br>  <span class=\"hljs-variable language_\">console</span>.<span class=\"hljs-title function_\">log</span>(<span class=\"hljs-number\">5</span>)<br>&#125;, <span class=\"hljs-number\">0</span>);<br><br><span class=\"hljs-comment\">// 立即执行</span><br><span class=\"hljs-variable language_\">console</span>.<span class=\"hljs-title function_\">log</span>(<span class=\"hljs-number\">6</span>)<br><br><br><span class=\"hljs-comment\">// 2 7 6 1 8 3 5 setImmediate 4</span><br></code></pre></td></tr></table></figure>\n\n<h1 id=\"浅拷贝、深拷贝\"><a href=\"#浅拷贝、深拷贝\" class=\"headerlink\" title=\"浅拷贝、深拷贝\"></a>浅拷贝、深拷贝</h1><p>浅拷贝</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\"><span class=\"hljs-keyword\">const</span> obj = &#123;<br>  <span class=\"hljs-attr\">name</span>: <span class=\"hljs-string\">&#x27;is obj&#x27;</span>,<br>  <span class=\"hljs-attr\">girlfriend</span>: &#123;<br>    <span class=\"hljs-attr\">name</span>: <span class=\"hljs-string\">&#x27;小红&#x27;</span><br>  &#125;<br>&#125;<br><br><span class=\"hljs-keyword\">const</span> o = <span class=\"hljs-title class_\">Object</span>.<span class=\"hljs-title function_\">assign</span>(&#123;&#125;, obj)<br><br>obj.<span class=\"hljs-property\">name</span> = <span class=\"hljs-string\">&#x27;is o&#x27;</span><br>obj.<span class=\"hljs-property\">girlfriend</span>.<span class=\"hljs-property\">name</span> = <span class=\"hljs-string\">&#x27;小花&#x27;</span><br><br><span class=\"hljs-variable language_\">console</span>.<span class=\"hljs-title function_\">log</span>(o)<br></code></pre></td></tr></table></figure>\n\n<p>深拷贝</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\"><span class=\"hljs-keyword\">const</span> obj = &#123;<br>  <span class=\"hljs-attr\">name</span>: <span class=\"hljs-string\">&#x27;is obj&#x27;</span>,<br>  <span class=\"hljs-attr\">girlfriend</span>: &#123;<br>    <span class=\"hljs-attr\">name</span>: <span class=\"hljs-string\">&#x27;小红&#x27;</span><br>  &#125;<br>&#125;<br><br><span class=\"hljs-keyword\">function</span> <span class=\"hljs-title function_\">deepClone</span>(<span class=\"hljs-params\">obj</span>) &#123;<br>  <span class=\"hljs-keyword\">const</span> o = &#123;&#125;<br><br>  <span class=\"hljs-keyword\">for</span> (<span class=\"hljs-keyword\">const</span> key <span class=\"hljs-keyword\">in</span> obj) &#123;<br>    <span class=\"hljs-keyword\">if</span> (<span class=\"hljs-title class_\">Object</span>.<span class=\"hljs-property\">hasOwnProperty</span>.<span class=\"hljs-title function_\">call</span>(obj, key)) &#123;<br>      <br>      <span class=\"hljs-keyword\">if</span>(<span class=\"hljs-keyword\">typeof</span> obj[key] === <span class=\"hljs-string\">&#x27;object&#x27;</span>) &#123;<br>        o[key] = <span class=\"hljs-title function_\">deepClone</span>(obj[key])<br>      &#125; <span class=\"hljs-keyword\">else</span> &#123;<br>        o[key] = obj[key];<br>      &#125;<br>    &#125;<br>  &#125;<br><br>  <span class=\"hljs-keyword\">return</span> o<br>&#125;<br></code></pre></td></tr></table></figure>\n\n<h1 id=\"JSON-stringify实现深克隆\"><a href=\"#JSON-stringify实现深克隆\" class=\"headerlink\" title=\"JSON.stringify实现深克隆\"></a>JSON.stringify实现深克隆</h1><p>将一个 JSON 对象，转化为字符串，通过 JSON.parse 将字符串转化为对象，从而实现深克隆</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\"><span class=\"hljs-keyword\">const</span> obj = &#123;<br>  <span class=\"hljs-attr\">name</span>: <span class=\"hljs-string\">&#x27;is obj&#x27;</span>,<br>  <span class=\"hljs-attr\">girlfriend</span>: &#123;<br>    <span class=\"hljs-attr\">name</span>: <span class=\"hljs-string\">&#x27;小红&#x27;</span><br>  &#125;<br>&#125;<br><br><span class=\"hljs-keyword\">const</span> o = <span class=\"hljs-title class_\">JSON</span>.<span class=\"hljs-title function_\">parse</span>(<span class=\"hljs-title class_\">JSON</span>.<span class=\"hljs-title function_\">stringify</span>(obj))<br><br><span class=\"hljs-variable language_\">console</span>.<span class=\"hljs-title function_\">log</span>(o)<br></code></pre></td></tr></table></figure>\n\n<p>JSON.stringify 存在的问题：</p>\n<p>如果属性值是 undefined 或者是方法（含箭头函数），克隆出来后，undefined 和函数会丢失</p>\n<h1 id=\"parseInt\"><a href=\"#parseInt\" class=\"headerlink\" title=\"parseInt\"></a>parseInt</h1><blockquote>\n<p>parseInt(string, radix) 解析一个字符串并返回指定基数的十进制整数，radix 是 2-36 之间的整数，表示被解析字符串的基数。</p>\n</blockquote>\n<p>string: 要被解析的值。</p>\n<ul>\n<li>如果参数不是一个字符串，则将其转换为字符串 (使用 ToString抽象操作)。</li>\n<li>字符串开头的空白符将会被忽略。</li>\n</ul>\n<h2 id=\"parseInt-0-0000005-5-为-true\"><a href=\"#parseInt-0-0000005-5-为-true\" class=\"headerlink\" title=\"parseInt (0.0000005) === 5 为 true\"></a><strong>parseInt (0.0000005) === 5 为 true</strong></h2><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\">(<span class=\"hljs-number\">0.5</span>).<span class=\"hljs-title function_\">toString</span>(); <span class=\"hljs-comment\">//  &#x27;0.5&#x27;</span><br>(<span class=\"hljs-number\">0.05</span>).<span class=\"hljs-title function_\">toString</span>(); <span class=\"hljs-comment\">//  &#x27;0.05&#x27;</span><br>(<span class=\"hljs-number\">0.005</span>).<span class=\"hljs-title function_\">toString</span>(); <span class=\"hljs-comment\">//  &#x27;0.005&#x27;</span><br>(<span class=\"hljs-number\">0.0005</span>).<span class=\"hljs-title function_\">toString</span>(); <span class=\"hljs-comment\">//  &#x27;0.0005&#x27;</span><br>(<span class=\"hljs-number\">0.00005</span>).<span class=\"hljs-title function_\">toString</span>(); <span class=\"hljs-comment\">//  &#x27;0.00005&#x27;</span><br>(<span class=\"hljs-number\">0.000005</span>).<span class=\"hljs-title function_\">toString</span>(); <span class=\"hljs-comment\">//  &#x27;0.000005&#x27;</span><br>(<span class=\"hljs-number\">0.0000005</span>).<span class=\"hljs-title function_\">toString</span>(); <span class=\"hljs-comment\">//  &#x27;5e-7&#x27;</span><br></code></pre></td></tr></table></figure>\n<ul>\n<li>可以发现当数字过小时，toString 输出的结果是科学计数法形式。</li>\n<li>parseInt 只能将字符串的前导部分解释为整数值；它忽略任何不能被解释为整数的代码单元，并且不会有忽略指示。</li>\n</ul>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\"><span class=\"hljs-built_in\">parseInt</span>(<span class=\"hljs-number\">0.5</span>) <span class=\"hljs-comment\">// 0</span><br><br><span class=\"hljs-built_in\">parseInt</span>(<span class=\"hljs-number\">0.0000005</span>) <span class=\"hljs-comment\">// 5</span><br></code></pre></td></tr></table></figure>\n\n<h2 id=\"radix-默认值是-10-吗，何种情况返回值是-NaN？\"><a href=\"#radix-默认值是-10-吗，何种情况返回值是-NaN？\" class=\"headerlink\" title=\"radix 默认值是 10 吗，何种情况返回值是 NaN？\"></a>radix 默认值是 10 吗，何种情况返回值是 NaN？</h2><ol>\n<li>当 radix 值为 undefined、0 或未指定的，那 JavaScript 会如何处理这种情况:</li>\n</ol>\n<ul>\n<li>如果输入的 string 以 0x 或 0X 开头，那么 radix 会被假定为 16 ，字符串的其他部分按照十六进制来解析。<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\"><span class=\"hljs-built_in\">parseInt</span>(<span class=\"hljs-string\">&#x27;0x51&#x27;</span>) <span class=\"hljs-comment\">// 5*16^1 + 1*16^0 = 81</span><br></code></pre></td></tr></table></figure></li>\n<li>如果输入的 string 以 0 开头，ES5 规定使用十进制，但并非所有的浏览器都支持，因此使用 parseInt 时，需要指定 radix</li>\n<li>如果输入的 string 以其他任何值开头，radix 值为 10</li>\n</ul>\n<ol start=\"2\">\n<li>radix 参数的值为 2 ~ 36，当 radix 小于 2 或 大于 36(不包含 0)，返回值为 NaN</li>\n</ol>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\"><span class=\"hljs-built_in\">parseInt</span>(<span class=\"hljs-string\">&quot;123&quot;</span>, <span class=\"hljs-number\">1</span>); <span class=\"hljs-comment\">// NaN</span><br><span class=\"hljs-built_in\">parseInt</span>(<span class=\"hljs-string\">&quot;123&quot;</span>, <span class=\"hljs-number\">38</span>); <span class=\"hljs-comment\">// NaN</span><br><span class=\"hljs-built_in\">parseInt</span>(<span class=\"hljs-string\">&quot;123&quot;</span>, -<span class=\"hljs-number\">1</span>); <span class=\"hljs-comment\">// NaN</span><br></code></pre></td></tr></table></figure>\n\n<ol start=\"3\">\n<li>待转换字符串中，所有的可转换数字都不小于 radix 值</li>\n</ol>\n<p>例如 radix 值为 2 (二进制)，而待转换字符串为 ‘3456’，二进制内只有 0、1 是基本算符，因此字符串 ‘3456’ 无法转换成二进制，返回值为 NaN。</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\"><span class=\"hljs-built_in\">parseInt</span>(<span class=\"hljs-string\">&quot;3456&quot;</span>, <span class=\"hljs-number\">2</span>); <span class=\"hljs-comment\">// NaN</span><br><span class=\"hljs-built_in\">parseInt</span>(<span class=\"hljs-string\">&quot;45px&quot;</span>, <span class=\"hljs-number\">3</span>); <span class=\"hljs-comment\">// NaN</span><br></code></pre></td></tr></table></figure>\n\n<h2 id=\"‘1’-‘2’-‘3’-map-parseInt\"><a href=\"#‘1’-‘2’-‘3’-map-parseInt\" class=\"headerlink\" title=\"[‘1’, ‘2’, ‘3’].map(parseInt)\"></a>[‘1’, ‘2’, ‘3’].map(parseInt)</h2><blockquote>\n<p>[parseInt(“1”, 0), parseInt(“2”, 1), parseInt(“3”, 2)]</p>\n</blockquote>\n<ul>\n<li><p>parseInt(“1”, 0)<br>radix 为 0，且 string 以字符 1 开始，radix 值为 10，值为 1。</p>\n</li>\n<li><p>parseInt(“2”, 1)<br>符合 2.2 ，radix 小于 2，返回 NaN</p>\n</li>\n<li><p>parseInt(“3”, 2)<br>待转换字符串中，所有的可转换数字大于 radix 值，返回 NaN</p>\n</li>\n</ul>\n<h1 id=\"渲染进程\"><a href=\"#渲染进程\" class=\"headerlink\" title=\"渲染进程\"></a>渲染进程</h1><ul>\n<li><p>GUI渲染线程</p>\n<ul>\n<li>负责渲染页面，布局和绘制</li>\n<li>页面需要重绘和回流时，该线程就会执行</li>\n<li>与js引擎线程互斥，防止渲染结果不可预期</li>\n</ul>\n</li>\n<li><p>JS引擎线程</p>\n<ul>\n<li>负责处理解析和执行javascript脚本程序</li>\n<li>只有一个JS引擎线程（单线程）</li>\n<li>与GUI渲染线程互斥，防止渲染结果不可预期</li>\n</ul>\n</li>\n<li><p>事件触发线程</p>\n<ul>\n<li>用来控制事件循环（鼠标点击、setTimeout、ajax等）</li>\n<li>当事件满足触发条件时，将事件放入到JS引擎所在的执行队列中</li>\n</ul>\n</li>\n<li><p>定时触发器线程</p>\n<ul>\n<li>setInterval与setTimeout所在的线程</li>\n<li>定时任务并不是由JS引擎计时的，是由定时触发线程来计时的</li>\n<li>计时完毕后，通知事件触发线程</li>\n</ul>\n</li>\n</ul>\n<ul>\n<li>异步http请求线程<ul>\n<li>浏览器有一个单独的线程用于处理AJAX请求</li>\n<li>当请求完成时，若有回调函数，通知事件触发线程</li>\n</ul>\n</li>\n</ul>\n<h1 id=\"为什么-javascript-是单线程的\"><a href=\"#为什么-javascript-是单线程的\" class=\"headerlink\" title=\"为什么 javascript 是单线程的?\"></a>为什么 javascript 是单线程的?</h1><p>首先是历史原因，在创建 javascript 这门语言时，多进程多线程的架构并不流行，硬件支持并不好。</p>\n<p>其次是因为多线程的复杂性，多线程操作需要加锁，编码的复杂性会增高。</p>\n<p>而且，如果同时操作 DOM ，在多线程不加锁的情况下，最终会导致 DOM 渲染的结果不可预期。</p>\n<h1 id=\"为什么-GUI-渲染线程与-JS-引擎线程互斥\"><a href=\"#为什么-GUI-渲染线程与-JS-引擎线程互斥\" class=\"headerlink\" title=\"为什么 GUI 渲染线程与 JS 引擎线程互斥?\"></a>为什么 GUI 渲染线程与 JS 引擎线程互斥?</h1><p>这是由于 JS 是可以操作 DOM 的，如果同时修改元素属性并同时渲染界面(即 JS线程和UI线程同时运行)，<br>那么渲染线程前后获得的元素就可能不一致了。</p>\n<p>因此，为了防止渲染出现不可预期的结果，浏览器设定 GUI渲染线程和JS引擎线程为互斥关系，<br>当JS引擎线程执行时GUI渲染线程会被挂起，GUI更新则会被保存在一个队列中等待JS引擎线程空闲时立即被执行。</p>\n<h1 id=\"如何理解-JS-的运行机制（Event-Loop）\"><a href=\"#如何理解-JS-的运行机制（Event-Loop）\" class=\"headerlink\" title=\"如何理解 JS 的运行机制（Event Loop）?\"></a>如何理解 JS 的运行机制（Event Loop）?</h1><blockquote>\n<p><a href=\"https://juejin.cn/post/6844903919789801486\">https://juejin.cn/post/6844903919789801486</a></p>\n</blockquote>\n<h2 id=\"核心概念\"><a href=\"#核心概念\" class=\"headerlink\" title=\"核心概念\"></a>核心概念</h2><ol>\n<li>JS分为同步任务和异步任务</li>\n<li>同步任务都在 <code>JS 引擎线程</code> 上执行，形成一个执行栈</li>\n<li><code>事件触发线程</code> 管理一个任务队里，异步任务触发条件达成，将回调事件放入执行栈中执行</li>\n<li>执行栈中所有同步任务执行完毕，此时JS引擎线程空闲，系统会读取任务队列，将可运行的异步任务回调事件添加到执行栈中，开始执行</li>\n</ol>\n<h2 id=\"Event-Loop\"><a href=\"#Event-Loop\" class=\"headerlink\" title=\"Event Loop\"></a>Event Loop</h2><ol>\n<li>执行一个宏任务（栈中没有，就从任务队列中获取）</li>\n<li>执行过程中如果遇到了微任务，就将它添加到微任务的任务队列中</li>\n<li>宏任务执行完毕，立即执行微任务队列中的所有微任务（依次执行）</li>\n<li>当前宏任务执行完毕，开始检查渲染，然后 GUI 渲染线程接管，开始渲染</li>\n<li>渲染完毕后，JS 线程接管，开始下一个宏任务（从任务队列中获取）</li>\n</ol>\n<img src=\"/img/event loop.jpg\" />\n\n<h1 id=\"var-和-let-的区别\"><a href=\"#var-和-let-的区别\" class=\"headerlink\" title=\"var 和 let 的区别\"></a>var 和 let 的区别</h1><ol>\n<li>var 声明的变量，其作用域为当前函数、模块或全局；let 声明的变量，其作用域总是在当前的代码块，例如语句块。</li>\n<li>在同一个代码块中，var可以多次声明变量名；let只能声明一次，覆盖一个已经声明的 let 变量会导致语法错误。</li>\n<li>用户可以在声明语句之前使用 var 变量，其值是 undefined. 而 let 必须先声明后使用。</li>\n<li>全局模块下，var 声明的变量作为global上的属性，let声明的变量则不是 global上的属性，而是作为全局模块中的标识符。</li>\n</ol>\n<h1 id=\"垃圾回收机制\"><a href=\"#垃圾回收机制\" class=\"headerlink\" title=\"垃圾回收机制\"></a>垃圾回收机制</h1><ul>\n<li>引用计数：被引用，则计数+1，不再引用，计数减一。存在循环引用问题。</li>\n<li>标记清除（常用）：当变量进入到执行环境，则标记上已进入执行环境，当执行完成后，变量离开执行环境则标记已离开执行环境。</li>\n</ul>\n<h1 id=\"原型链-amp-继承\"><a href=\"#原型链-amp-继承\" class=\"headerlink\" title=\"原型链 &amp; 继承\"></a>原型链 &amp; 继承</h1><p>每个构造函数都有一个原型对象（prototype），原型有一个属性（constructor）指回构造函数，而实例有一个内部指针（<strong>proto</strong>）指向原型。</p>\n<p>原型链最顶端是 null</p>\n<p>任何函数的默认原型都是一个Object的实例，这意味着这个实例有一个内部指针指向Object.prototype。</p>\n<p>这也是为什么自定义类型能够继承包括toString()、valueOf()在内的所有默认方法的原因</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\"><br><span class=\"hljs-keyword\">function</span> <span class=\"hljs-title function_\">Person</span>(<span class=\"hljs-params\">params</span>) &#123;<br>    <span class=\"hljs-variable language_\">console</span>.<span class=\"hljs-title function_\">log</span>(params)<br>&#125;<br><span class=\"hljs-keyword\">const</span> p = <span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">Person</span>(<span class=\"hljs-number\">1</span>)<br><br>p.<span class=\"hljs-property\">__proto__</span>.<span class=\"hljs-property\">constructor</span> === <span class=\"hljs-title class_\">Person</span> &gt;&gt;&gt; <span class=\"hljs-literal\">true</span><br><br>p.<span class=\"hljs-property\">__proto__</span> === <span class=\"hljs-title class_\">Person</span>.<span class=\"hljs-property\"><span class=\"hljs-keyword\">prototype</span></span> &gt;&gt;&gt; <span class=\"hljs-literal\">true</span><br><br>p.<span class=\"hljs-property\">__proto__</span>.<span class=\"hljs-property\">__proto__</span> === <span class=\"hljs-title class_\">Object</span>.<span class=\"hljs-property\"><span class=\"hljs-keyword\">prototype</span></span> &gt;&gt;&gt; <span class=\"hljs-literal\">true</span><br><br>p.<span class=\"hljs-property\">__proto__</span>.<span class=\"hljs-property\">__proto__</span>.<span class=\"hljs-property\">constructor</span> === <span class=\"hljs-title class_\">Object</span> &gt;&gt;&gt; <span class=\"hljs-literal\">true</span><br><br>p.<span class=\"hljs-property\">__proto__</span>.<span class=\"hljs-property\">__proto__</span>.<span class=\"hljs-property\">__proto__</span> === <span class=\"hljs-literal\">null</span><br></code></pre></td></tr></table></figure>\n\n<h2 id=\"原型与继承的关系\"><a href=\"#原型与继承的关系\" class=\"headerlink\" title=\"原型与继承的关系\"></a>原型与继承的关系</h2><p>原型与实例的关系可以通过<code>两种</code>方式来确定。</p>\n<p>第一种方式是使用<code>instanceof操作符</code>，<strong>如果一个实例的原型链中出现过相应的构造函数，则instanceof返回true</strong></p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\">o <span class=\"hljs-keyword\">instanceof</span> <span class=\"hljs-title class_\">Object</span> <span class=\"hljs-comment\">// true 实例的原型链中出现过相应的构造函数</span><br></code></pre></td></tr></table></figure>\n\n<p>第二种方式是使用<code>isPrototypeOf()</code>方法</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\"><span class=\"hljs-title class_\">Object</span>.<span class=\"hljs-property\"><span class=\"hljs-keyword\">prototype</span></span>.<span class=\"hljs-title function_\">isPrototypeOf</span>(o)<br></code></pre></td></tr></table></figure>\n\n<h2 id=\"原型链的问题\"><a href=\"#原型链的问题\" class=\"headerlink\" title=\"原型链的问题\"></a>原型链的问题</h2><p>问题一：原型中包含的引用值会在所有实例间共享</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\"><span class=\"hljs-keyword\">function</span> <span class=\"hljs-title function_\">Super</span>(<span class=\"hljs-params\"></span>) &#123;<br>  <span class=\"hljs-variable language_\">this</span>.<span class=\"hljs-property\">colors</span> = [<span class=\"hljs-string\">&#x27;red&#x27;</span>, <span class=\"hljs-string\">&#x27;blue&#x27;</span>]<br>&#125;<br><br><span class=\"hljs-keyword\">function</span> <span class=\"hljs-title function_\">Sub</span>(<span class=\"hljs-params\"></span>) &#123;&#125;<br><br><span class=\"hljs-title class_\">Sub</span>.<span class=\"hljs-property\"><span class=\"hljs-keyword\">prototype</span></span> = <span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">Super</span>() <span class=\"hljs-comment\">// Super 实例的属性值，变成了 Sub 原型对象上的属性</span><br><br><span class=\"hljs-keyword\">const</span> o1 = <span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">Sub</span>()<br><br>o1.<span class=\"hljs-property\">colors</span>.<span class=\"hljs-title function_\">push</span>(<span class=\"hljs-string\">&#x27;black&#x27;</span>)<br><br><span class=\"hljs-comment\">// 所有实例共享原型对象上的 colors</span><br><span class=\"hljs-keyword\">const</span> o2 = <span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">Sub</span>()<br><span class=\"hljs-variable language_\">console</span>.<span class=\"hljs-title function_\">log</span>(o2.<span class=\"hljs-property\">colors</span>) <span class=\"hljs-comment\">// [&#x27;red&#x27;, &#x27;blue&#x27;, &#x27;black&#x27;]</span><br></code></pre></td></tr></table></figure>\n\n<p>问题二：子类型在实例化时不能给父类型的构造函数传参</p>\n<h2 id=\"盗用构造函数继承\"><a href=\"#盗用构造函数继承\" class=\"headerlink\" title=\"盗用构造函数继承\"></a>盗用构造函数继承</h2><blockquote>\n<p>为了解决原型包含引用值导致的继承问题</p>\n</blockquote>\n<p>在子类构造函数中调用父类构造函数。</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\"><span class=\"hljs-keyword\">function</span> <span class=\"hljs-title function_\">Super</span>(<span class=\"hljs-params\"></span>) &#123;<br>  <span class=\"hljs-variable language_\">this</span>.<span class=\"hljs-property\">colors</span> = [<span class=\"hljs-string\">&#x27;red&#x27;</span>, <span class=\"hljs-string\">&#x27;blue&#x27;</span>]<br>&#125;<br><br><span class=\"hljs-keyword\">function</span> <span class=\"hljs-title function_\">Sub</span>(<span class=\"hljs-params\"></span>) &#123;<br>  <span class=\"hljs-comment\">// 实例化 Sub 时，给每个 Sub 实例上都复制（拷贝）一份 colors，实例间不共享 colors，都有属于自己的那一份 colors</span><br>  <span class=\"hljs-title class_\">Super</span>.<span class=\"hljs-title function_\">call</span>(<span class=\"hljs-variable language_\">this</span>)<br>&#125;<br><br><span class=\"hljs-keyword\">const</span> o1 = <span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">Sub</span>()<br>o1.<span class=\"hljs-property\">colors</span>.<span class=\"hljs-title function_\">push</span>(<span class=\"hljs-string\">&#x27;black&#x27;</span>)<br><br><span class=\"hljs-keyword\">const</span> o2 = <span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">Sub</span>()<br><span class=\"hljs-variable language_\">console</span>.<span class=\"hljs-title function_\">log</span>(o2.<span class=\"hljs-property\">colors</span>) <span class=\"hljs-comment\">// [&#x27;red&#x27;, &#x27;blue&#x27;]</span><br></code></pre></td></tr></table></figure>\n\n<p>也可以给父类传递参数</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\"><span class=\"hljs-keyword\">function</span> <span class=\"hljs-title function_\">Sub</span>(<span class=\"hljs-params\"></span>) &#123;<br>  <span class=\"hljs-title class_\">Super</span>.<span class=\"hljs-title function_\">call</span>(<span class=\"hljs-variable language_\">this</span>, <span class=\"hljs-string\">&#x27;Hello world&#x27;</span>)<br><br>  <span class=\"hljs-comment\">// 这里可以额外添加属性</span><br>  <span class=\"hljs-variable language_\">this</span>.<span class=\"hljs-property\">age</span> = <span class=\"hljs-number\">18</span><br>&#125;<br></code></pre></td></tr></table></figure>\n\n<p>盗用构造函数也是有缺点的：</p>\n<ol>\n<li>不是原型链继承，无法使用父类原型对象上的属性和方法。</li>\n<li>父类上定义的所有属性和方法，都会被复制到子类实例上，如果属性和方法太多，占用内存就会较大。并且继承的目的是为了属性和方法的<code>复用</code>，而且借用构造函数是将父类定义的方法和属性进行了<code>复制</code>。</li>\n</ol>\n<h2 id=\"组合继承（伪经典继承）\"><a href=\"#组合继承（伪经典继承）\" class=\"headerlink\" title=\"组合继承（伪经典继承）\"></a>组合继承（伪经典继承）</h2><blockquote>\n<p>综合了原型链和借用构造函数</p>\n</blockquote>\n<p>基本的思路是使用原型链继承原型上的属性和方法，而通过盗用构造函数继承实例属性。这样既可以把方法定义在原型上以实现重用，又可以让每个实例都有自己的属性。</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\"><span class=\"hljs-keyword\">function</span> <span class=\"hljs-title function_\">Person</span>(<span class=\"hljs-params\">name</span>) &#123;<br>  <span class=\"hljs-variable language_\">this</span>.<span class=\"hljs-property\">name</span> = name<br>  <span class=\"hljs-variable language_\">this</span>.<span class=\"hljs-property\">colors</span> = [<span class=\"hljs-string\">&#x27;red&#x27;</span>, <span class=\"hljs-string\">&#x27;blue&#x27;</span>]<br>&#125;<br><br><span class=\"hljs-title class_\">Person</span>.<span class=\"hljs-property\"><span class=\"hljs-keyword\">prototype</span></span>.<span class=\"hljs-property\">sayName</span> = <span class=\"hljs-keyword\">function</span>(<span class=\"hljs-params\"></span>) &#123;<br>  <span class=\"hljs-variable language_\">console</span>.<span class=\"hljs-title function_\">log</span>(<span class=\"hljs-variable language_\">this</span>.<span class=\"hljs-property\">name</span>)<br>&#125;<br><br><span class=\"hljs-keyword\">function</span> <span class=\"hljs-title function_\">User</span>(<span class=\"hljs-params\">name</span>) &#123;<br><br>  <span class=\"hljs-comment\">// 借用构造函数</span><br>  <span class=\"hljs-title class_\">Person</span>.<span class=\"hljs-title function_\">call</span>(<span class=\"hljs-variable language_\">this</span>, name)<br><br>  <span class=\"hljs-variable language_\">this</span>.<span class=\"hljs-property\">age</span> = <span class=\"hljs-number\">19</span><br>&#125;<br><br><span class=\"hljs-comment\">// 原型链继承</span><br><span class=\"hljs-title class_\">User</span>.<span class=\"hljs-property\"><span class=\"hljs-keyword\">prototype</span></span> = <span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">Person</span>()<br><br><span class=\"hljs-keyword\">const</span> u = <span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">User</span>(<span class=\"hljs-string\">&#x27;xiaoming&#x27;</span>)<br><br><span class=\"hljs-variable language_\">console</span>.<span class=\"hljs-title function_\">log</span>(u.<span class=\"hljs-title function_\">sayName</span>())<br></code></pre></td></tr></table></figure>\n\n<p>组合继承弥补了原型链和盗用构造函数的不足，是JavaScript中使用最多的继承模式。而且组合继承也保留了 <code>instanceof操作符</code> 和 <code>isPrototypeOf()</code> 方法识别合成对象的能力。</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\"><span class=\"hljs-comment\">// true</span><br><br><span class=\"hljs-variable language_\">console</span>.<span class=\"hljs-title function_\">log</span>(u <span class=\"hljs-keyword\">instanceof</span> <span class=\"hljs-title class_\">User</span>)<br><span class=\"hljs-variable language_\">console</span>.<span class=\"hljs-title function_\">log</span>(u <span class=\"hljs-keyword\">instanceof</span> <span class=\"hljs-title class_\">Person</span>)<br><span class=\"hljs-variable language_\">console</span>.<span class=\"hljs-title function_\">log</span>(<span class=\"hljs-title class_\">User</span>.<span class=\"hljs-property\"><span class=\"hljs-keyword\">prototype</span></span>.<span class=\"hljs-title function_\">isPrototypeOf</span>(u))<br><span class=\"hljs-variable language_\">console</span>.<span class=\"hljs-title function_\">log</span>(<span class=\"hljs-title class_\">Person</span>.<span class=\"hljs-property\"><span class=\"hljs-keyword\">prototype</span></span>.<span class=\"hljs-title function_\">isPrototypeOf</span>(u))<br></code></pre></td></tr></table></figure>\n\n<h2 id=\"原型式继承\"><a href=\"#原型式继承\" class=\"headerlink\" title=\"原型式继承\"></a>原型式继承</h2><blockquote>\n<p>创建一个临时构造函数，将传入的对象赋值给这个构造函数的原型，然后返回这个临时类型的一个实例</p>\n</blockquote>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\"><span class=\"hljs-keyword\">function</span> <span class=\"hljs-title function_\">object</span>(<span class=\"hljs-params\">o</span>) &#123;<br>  <span class=\"hljs-keyword\">function</span> <span class=\"hljs-title function_\">F</span>(<span class=\"hljs-params\"></span>) &#123;&#125;<br><br>  F.<span class=\"hljs-property\"><span class=\"hljs-keyword\">prototype</span></span> = o<br><br>  <span class=\"hljs-keyword\">return</span> <span class=\"hljs-keyword\">new</span> <span class=\"hljs-title function_\">F</span>()<br>&#125;<br></code></pre></td></tr></table></figure>\n\n<p>ECMAScript 5通过增加<code>Object.create()</code>方法将原型式继承的概念规范化了。这个方法接收两个参数：作为新对象原型的对象，以及给新对象定义额外属性的对象（第二个可选: Object.defineProperties()）。在只有一个参数时，Object.create()与这里的object()方法效果相同。</p>\n<p>在 <code>组合式继承</code>中，我们可以将原型链继承那部分可以改写一下:</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\"><span class=\"hljs-title class_\">User</span>.<span class=\"hljs-property\"><span class=\"hljs-keyword\">prototype</span></span> = <span class=\"hljs-title class_\">Object</span>.<span class=\"hljs-title function_\">create</span>(<span class=\"hljs-title class_\">Person</span>.<span class=\"hljs-property\"><span class=\"hljs-keyword\">prototype</span></span>)<br></code></pre></td></tr></table></figure>\n\n<h2 id=\"寄生式继承\"><a href=\"#寄生式继承\" class=\"headerlink\" title=\"寄生式继承\"></a>寄生式继承</h2><blockquote>\n<p>创建一个实现继承的函数，以某种方式增强对象，然后返回这个对象</p>\n</blockquote>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\"><span class=\"hljs-keyword\">function</span> <span class=\"hljs-title function_\">createAnother</span>(<span class=\"hljs-params\">original</span>)&#123;<br>  <span class=\"hljs-keyword\">let</span> clone = <span class=\"hljs-title class_\">Object</span>.<span class=\"hljs-title function_\">create</span>(original) <span class=\"hljs-comment\">// 通过调用函数创建一个新对象</span><br><br>  clone.<span class=\"hljs-property\">sayHi</span> = <span class=\"hljs-keyword\">function</span>(<span class=\"hljs-params\"></span>) &#123; <span class=\"hljs-comment\">// 以某种方式增强这个对象</span><br>    <span class=\"hljs-variable language_\">console</span>.<span class=\"hljs-title function_\">log</span>(<span class=\"hljs-string\">&quot;hi&quot;</span>)<br>  &#125;<br>  <span class=\"hljs-keyword\">return</span> clone<br>&#125;<br></code></pre></td></tr></table></figure>\n\n<h2 id=\"寄生式组合继承-继承的最佳模式\"><a href=\"#寄生式组合继承-继承的最佳模式\" class=\"headerlink\" title=\"寄生式组合继承(继承的最佳模式)\"></a>寄生式组合继承(继承的最佳模式)</h2><p>组合继承其实也存在效率问题。最主要的效率问题就是父类构造函数始终会被调用两次：一次在是创建子类原型时调用，另一次是在子类构造函数中调用。</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\"><span class=\"hljs-keyword\">function</span> <span class=\"hljs-title function_\">SuperType</span>(<span class=\"hljs-params\">name</span>) &#123;<br>  <span class=\"hljs-variable language_\">this</span>.<span class=\"hljs-property\">name</span> = name;<br>  <span class=\"hljs-variable language_\">this</span>.<span class=\"hljs-property\">colors</span> = [<span class=\"hljs-string\">&quot;red&quot;</span>, <span class=\"hljs-string\">&quot;blue&quot;</span>, <span class=\"hljs-string\">&quot;green&quot;</span>];<br>&#125;<br><span class=\"hljs-title class_\">SuperType</span>.<span class=\"hljs-property\"><span class=\"hljs-keyword\">prototype</span></span>.<span class=\"hljs-property\">sayName</span> = <span class=\"hljs-keyword\">function</span>(<span class=\"hljs-params\"></span>) &#123;<br>  <span class=\"hljs-variable language_\">console</span>.<span class=\"hljs-title function_\">log</span>(<span class=\"hljs-variable language_\">this</span>.<span class=\"hljs-property\">name</span>);<br>&#125;;<br><span class=\"hljs-keyword\">function</span> <span class=\"hljs-title function_\">SubType</span>(<span class=\"hljs-params\">name, age</span>)&#123;<br>  <span class=\"hljs-title class_\">SuperType</span>.<span class=\"hljs-title function_\">call</span>(<span class=\"hljs-variable language_\">this</span>, name);   <span class=\"hljs-comment\">//第二次调用SuperType()</span><br>  <span class=\"hljs-variable language_\">this</span>.<span class=\"hljs-property\">age</span> = age;<br>&#125;<br><span class=\"hljs-title class_\">SubType</span>.<span class=\"hljs-property\"><span class=\"hljs-keyword\">prototype</span></span>=<span class=\"hljs-title function_\">newSuperType</span>();   <span class=\"hljs-comment\">//第一次调用SuperType()</span><br><span class=\"hljs-title class_\">SubType</span>.<span class=\"hljs-property\"><span class=\"hljs-keyword\">prototype</span></span>.<span class=\"hljs-property\">constructor</span> = <span class=\"hljs-title class_\">SubType</span>;<br><span class=\"hljs-title class_\">SubType</span>.<span class=\"hljs-property\"><span class=\"hljs-keyword\">prototype</span></span>.<span class=\"hljs-property\">sayAge</span> = <span class=\"hljs-keyword\">function</span>(<span class=\"hljs-params\"></span>) &#123;<br>  <span class=\"hljs-variable language_\">console</span>.<span class=\"hljs-title function_\">log</span>(<span class=\"hljs-variable language_\">this</span>.<span class=\"hljs-property\">age</span>);<br>&#125;;<br></code></pre></td></tr></table></figure>\n\n<p>有两组name和colors属性：一组在实例上，另一组在SubType的原型上。</p>\n<img src=\"/img/组合继承.jpg\" />\n\n<blockquote>\n<p>寄生式组合继承通过盗用构造函数继承属性，但使用混合式原型链继承方法。基本思路是不通过调用父类构造函数给子类原型赋值，而是取得父类原型的一个副本。</p>\n</blockquote>\n<p>说到底就是使用寄生式继承来继承父类原型，然后将返回的新对象赋值给子类原型。</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\"><span class=\"hljs-keyword\">function</span> <span class=\"hljs-title function_\">inheritPrototype</span>(<span class=\"hljs-params\">subType, superType</span>) &#123;<br>  <span class=\"hljs-keyword\">const</span> prototype = <span class=\"hljs-title class_\">Object</span>.<span class=\"hljs-title function_\">create</span>(superType.<span class=\"hljs-property\"><span class=\"hljs-keyword\">prototype</span></span>) <span class=\"hljs-comment\">// 将superType.prototype作为新对象的原型对象</span><br><br>  prototype.<span class=\"hljs-property\">constructor</span> = subType <span class=\"hljs-comment\">// 增强对象</span><br><br>  subType.<span class=\"hljs-property\"><span class=\"hljs-keyword\">prototype</span></span> = prototype<span class=\"hljs-comment\">// 新对象赋值给子类原型</span><br>&#125;<br></code></pre></td></tr></table></figure>\n\n<p>我们再来改写 <code>组合继承</code></p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\"><span class=\"hljs-keyword\">function</span> <span class=\"hljs-title function_\">SuperType</span>(<span class=\"hljs-params\">name</span>) &#123;<br>  <span class=\"hljs-variable language_\">this</span>.<span class=\"hljs-property\">name</span> = name;<br>  <span class=\"hljs-variable language_\">this</span>.<span class=\"hljs-property\">colors</span> = [<span class=\"hljs-string\">&quot;red&quot;</span>, <span class=\"hljs-string\">&quot;blue&quot;</span>, <span class=\"hljs-string\">&quot;green&quot;</span>];<br>&#125;<br><span class=\"hljs-title class_\">SuperType</span>.<span class=\"hljs-property\"><span class=\"hljs-keyword\">prototype</span></span>.<span class=\"hljs-property\">sayName</span> = <span class=\"hljs-keyword\">function</span>(<span class=\"hljs-params\"></span>) &#123;<br>  <span class=\"hljs-variable language_\">console</span>.<span class=\"hljs-title function_\">log</span>(<span class=\"hljs-variable language_\">this</span>.<span class=\"hljs-property\">name</span>);<br>&#125;;<br><span class=\"hljs-keyword\">function</span> <span class=\"hljs-title function_\">SubType</span>(<span class=\"hljs-params\">name, age</span>) &#123;<br>  <span class=\"hljs-title class_\">SuperType</span>.<span class=\"hljs-title function_\">call</span>(<span class=\"hljs-variable language_\">this</span>, name);<br>  <span class=\"hljs-variable language_\">this</span>.<span class=\"hljs-property\">age</span> = age;<br>&#125;<br><br><span class=\"hljs-title function_\">inheritPrototype</span>(<span class=\"hljs-title class_\">SubType</span>, <span class=\"hljs-title class_\">SuperType</span>);<br><br><span class=\"hljs-title class_\">SubType</span>.<span class=\"hljs-property\"><span class=\"hljs-keyword\">prototype</span></span>.<span class=\"hljs-property\">sayAge</span> = <span class=\"hljs-keyword\">function</span>(<span class=\"hljs-params\"></span>) &#123;<br>  <span class=\"hljs-variable language_\">console</span>.<span class=\"hljs-title function_\">log</span>(<span class=\"hljs-variable language_\">this</span>.<span class=\"hljs-property\">age</span>);<br>&#125;;<br></code></pre></td></tr></table></figure>\n\n<p>这里只调用了一次SuperType构造函数，避免了SubType.prototype上不必要也用不到的属性，因此可以说这个例子的效率更高。</p>\n<p>而且，原型链仍然保持不变，因此instanceof操作符和isPrototypeOf()方法正常有效。寄生式组合继承可以算是引用类型<code>继承的最佳模式</code>。</p>\n<h2 id=\"ES6-class-的-extends-关键字\"><a href=\"#ES6-class-的-extends-关键字\" class=\"headerlink\" title=\"ES6 class 的 extends 关键字\"></a>ES6 class 的 extends 关键字</h2><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\"><span class=\"hljs-keyword\">class</span> <span class=\"hljs-title class_\">Point</span> &#123;<br>  <span class=\"hljs-title function_\">constructor</span>(<span class=\"hljs-params\">x, y</span>) &#123;<br>    <span class=\"hljs-variable language_\">this</span>.<span class=\"hljs-property\">x</span> = x<br>    <span class=\"hljs-variable language_\">this</span>.<span class=\"hljs-property\">y</span> = y<br>  &#125;<br>&#125;<br><br><span class=\"hljs-keyword\">class</span> <span class=\"hljs-title class_\">ColorPoint</span> <span class=\"hljs-keyword\">extends</span> <span class=\"hljs-title class_ inherited__\">Point</span> &#123;<br>  <span class=\"hljs-title function_\">constructor</span>(<span class=\"hljs-params\">x, y, color</span>) &#123;<br>    <span class=\"hljs-variable language_\">super</span>(x, y) <span class=\"hljs-comment\">// 必须调用 super (父类的 this 对象)</span><br><br>    <span class=\"hljs-variable language_\">this</span>.<span class=\"hljs-property\">color</span> = color<br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure>\n\n<p>子类必须在constructor方法中调用super方法，否则新建实例时会报错。这是因为子类没有自己的this对象，而是继承了父类的this对象，然后对其进行加工。如果不调用super方法，子类就得不到this对象。</p>\n<p>如果在一个方法前加上static关键字，就表示该方法不会被实例继承，而是直接通过类调用，称为“静态方法”。</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\"><span class=\"hljs-keyword\">class</span> <span class=\"hljs-title class_\">Foo</span> &#123;<br>  <span class=\"hljs-keyword\">static</span> <span class=\"hljs-title function_\">staticMethod</span>(<span class=\"hljs-params\"></span>) &#123;<br>    <span class=\"hljs-variable language_\">console</span>.<span class=\"hljs-title function_\">log</span>(<span class=\"hljs-string\">&#x27;static&#x27;</span>)<br>  &#125;<br>&#125;<br><br><span class=\"hljs-title class_\">Foo</span>.<span class=\"hljs-title function_\">staticMethod</span>()<br></code></pre></td></tr></table></figure>\n\n<p>父类的静态方法可以被子类继承。</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\"><span class=\"hljs-keyword\">class</span> <span class=\"hljs-title class_\">Bar</span> <span class=\"hljs-keyword\">extends</span> <span class=\"hljs-title class_ inherited__\">Foo</span> &#123;&#125;<br><br><span class=\"hljs-title class_\">Bar</span>.<span class=\"hljs-title function_\">staticMethod</span>() <span class=\"hljs-comment\">// static</span><br></code></pre></td></tr></table></figure>\n\n<p>父类的静态方法可以在子类中通过 <code>super</code> 关键字调用。</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\"><span class=\"hljs-keyword\">class</span> <span class=\"hljs-title class_\">Bar</span> <span class=\"hljs-keyword\">extends</span> <span class=\"hljs-title class_ inherited__\">Foo</span> &#123;<br>  <span class=\"hljs-keyword\">static</span> <span class=\"hljs-title function_\">say</span>(<span class=\"hljs-params\"></span>) &#123;<br>    <span class=\"hljs-keyword\">return</span> <span class=\"hljs-variable language_\">super</span>.<span class=\"hljs-title function_\">staticMethod</span>() + <span class=\"hljs-string\">&#x27; method&#x27;</span><br>  &#125;<br>&#125;<br><br><span class=\"hljs-title class_\">Bar</span>.<span class=\"hljs-title function_\">say</span>() <span class=\"hljs-comment\">// static method</span><br></code></pre></td></tr></table></figure>\n\n<h1 id=\"class-和构造函数有什么区别？\"><a href=\"#class-和构造函数有什么区别？\" class=\"headerlink\" title=\"class 和构造函数有什么区别？\"></a>class 和构造函数有什么区别？</h1><ol>\n<li><p>类必须使用new调用，直接调用会报错</p>\n</li>\n<li><p>类和模块的内部，默认就是严格模式，所以不需要使用use strict指定运行模式。</p>\n</li>\n<li><p>类不存在变量提升（hoist），这一点与 ES5 完全不同。</p>\n</li>\n<li><p>类的内部所有定义的方法，都是不可枚举的</p>\n</li>\n<li><p>子类必须在constructor方法中调用super方法，否则新建实例时会报错。</p>\n<p> 这是因为子类自己的this对象，必须先通过父类的构造函数完成塑造，得到与父类同样的实例属性和方法，然后再对其进行加工，加上子类自己的实例属性和方法。如果不调用super方法，子类就得不到this对象。</p>\n</li>\n</ol>\n<p>super作为函数调用时，代表父类的构造函数。</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\">&lt;script&gt;<br><span class=\"hljs-keyword\">class</span> <span class=\"hljs-title class_\">A</span> &#123;&#125;<br><span class=\"hljs-keyword\">class</span> <span class=\"hljs-title class_\">B</span> <span class=\"hljs-keyword\">extends</span> <span class=\"hljs-title class_ inherited__\">A</span> &#123; <span class=\"hljs-title function_\">constructor</span>(<span class=\"hljs-params\"></span>) &#123; <span class=\"hljs-variable language_\">super</span>() &#125;&#125;<br>&lt;/script&gt;<br></code></pre></td></tr></table></figure>\n\n<p>super虽然代表了父类A的构造函数，但是返回的是子类B的实例，即super内部的this指的是B的实例，因此super()在这里相当于A.prototype.constructor.call(this)。</p>\n<p><strong>继承区别</strong></p>\n<ol>\n<li>ES5 的继承，实质是先创造子类的实例对象this，然后再将父类的方法添加到this上面 Parent.call(this)</li>\n</ol>\n<ol start=\"2\">\n<li>ES6 的继承机制，实质是先将父类实例对象的属性和方法加到this上面（所以必须先调用super方法），然后再用子类的构造函数修改this。</li>\n</ol>\n<h1 id=\"防抖-amp-节流\"><a href=\"#防抖-amp-节流\" class=\"headerlink\" title=\"防抖&amp;节流\"></a>防抖&amp;节流</h1><p>防抖：用户触发事件频繁，只需要用户最后一次操作的结果</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\"><span class=\"hljs-keyword\">const</span> input = <span class=\"hljs-variable language_\">document</span>.<span class=\"hljs-title function_\">querySelector</span>(<span class=\"hljs-string\">&#x27;input&#x27;</span>)<br><span class=\"hljs-keyword\">let</span> timer = <span class=\"hljs-literal\">null</span><br><br>input.<span class=\"hljs-property\">oninput</span> = <span class=\"hljs-keyword\">function</span>(<span class=\"hljs-params\"></span>)&#123;<br>  <span class=\"hljs-keyword\">if</span> (timer !== <span class=\"hljs-literal\">null</span>) &#123;<br>    timer = <span class=\"hljs-built_in\">clearTimeout</span>(timer)<br>  &#125;<br><br>  timer = <span class=\"hljs-built_in\">setTimeout</span>(<span class=\"hljs-function\">() =&gt;</span> &#123;<br>    <span class=\"hljs-variable language_\">console</span>.<span class=\"hljs-title function_\">log</span>(<span class=\"hljs-variable language_\">this</span>.<span class=\"hljs-property\">value</span>)<br>  &#125;, <span class=\"hljs-number\">1000</span>)<br><br>&#125;<br></code></pre></td></tr></table></figure>\n\n<p>封装防抖函数</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\"><span class=\"hljs-keyword\">function</span> <span class=\"hljs-title function_\">debounce</span>(<span class=\"hljs-params\">fn, delay = <span class=\"hljs-number\">500</span></span>) &#123;<br>  <span class=\"hljs-comment\">// 闭包</span><br>  <span class=\"hljs-keyword\">let</span> timer = <span class=\"hljs-literal\">null</span><br>  <span class=\"hljs-comment\">// this ===&gt; window</span><br><br>  <span class=\"hljs-keyword\">return</span> <span class=\"hljs-keyword\">function</span>(<span class=\"hljs-params\"></span>) &#123;<br>    <span class=\"hljs-comment\">// this ===&gt; input</span><br>    <span class=\"hljs-keyword\">if</span> (timer !== <span class=\"hljs-literal\">null</span>) &#123;<br>      <span class=\"hljs-built_in\">clearTimeout</span>(timer)<br>    &#125;<br><br>    timer = <span class=\"hljs-built_in\">setTimeout</span>(<span class=\"hljs-function\">() =&gt;</span> &#123;<br>      fn.<span class=\"hljs-title function_\">call</span>(<span class=\"hljs-variable language_\">this</span>)<br>    &#125;, delay);<br>  &#125;<br>&#125;<br><br><span class=\"hljs-keyword\">const</span> input = <span class=\"hljs-variable language_\">document</span>.<span class=\"hljs-title function_\">querySelector</span>(<span class=\"hljs-string\">&#x27;#input&#x27;</span>)<br><br>input.<span class=\"hljs-property\">oninput</span> = <span class=\"hljs-title function_\">debounce</span>(<span class=\"hljs-keyword\">function</span>(<span class=\"hljs-params\"></span>) &#123;<br>  <span class=\"hljs-variable language_\">console</span>.<span class=\"hljs-title function_\">log</span>(<span class=\"hljs-string\">&#x27;value: &#x27;</span>, <span class=\"hljs-variable language_\">this</span>.<span class=\"hljs-property\">value</span>)<br>&#125;, <span class=\"hljs-number\">800</span>)<br></code></pre></td></tr></table></figure>\n\n<p>节流：控制事件执行的次数，每个多少时间间隔执行一次。</p>\n<p>比如监听滚动条的触发事件。</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\"><span class=\"hljs-keyword\">let</span> time = <span class=\"hljs-number\">0</span><br><span class=\"hljs-variable language_\">window</span>.<span class=\"hljs-property\">onscroll</span> = <span class=\"hljs-keyword\">function</span>(<span class=\"hljs-params\"></span>) &#123;<br>  <span class=\"hljs-keyword\">if</span> (<span class=\"hljs-title class_\">Date</span>.<span class=\"hljs-title function_\">now</span>() - time &gt; <span class=\"hljs-number\">1000</span>) &#123;<br>    <span class=\"hljs-variable language_\">console</span>.<span class=\"hljs-title function_\">log</span>(<span class=\"hljs-string\">&#x27;执行&#x27;</span>)<br>    time = <span class=\"hljs-title class_\">Date</span>.<span class=\"hljs-title function_\">now</span>()<br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure>\n\n<p>封装节流函数 throttle</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\"><span class=\"hljs-keyword\">function</span> <span class=\"hljs-title function_\">throttle</span>(<span class=\"hljs-params\">fn, delay</span>) &#123;<br>  <span class=\"hljs-keyword\">let</span> time = <span class=\"hljs-number\">0</span><br><br>  <span class=\"hljs-keyword\">return</span> <span class=\"hljs-keyword\">function</span>(<span class=\"hljs-params\"></span>) &#123;<br>    <span class=\"hljs-keyword\">let</span> now = <span class=\"hljs-title class_\">Date</span>.<span class=\"hljs-title function_\">now</span>()<br>    <span class=\"hljs-keyword\">if</span> (now - time &gt; delay) &#123;<br>      fn.<span class=\"hljs-title function_\">call</span>(<span class=\"hljs-variable language_\">this</span>)<br>      time = now<br>    &#125;<br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure>\n\n\n<h1 id=\"纯函数\"><a href=\"#纯函数\" class=\"headerlink\" title=\"纯函数\"></a>纯函数</h1><ol>\n<li>函数的返回结果只依赖于它的参数，相同的输入始终得到相同的输出。</li>\n<li>函数执行过程中没有副作用（不改变、不依赖外部任何可观察的变化）</li>\n</ol>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\"><br><span class=\"hljs-keyword\">function</span> <span class=\"hljs-title function_\">add</span>(<span class=\"hljs-params\">a, b</span>) &#123;<br>  <span class=\"hljs-keyword\">return</span> a + b;<br>&#125;<br><br><span class=\"hljs-title function_\">add</span>(<span class=\"hljs-number\">1</span>, <span class=\"hljs-number\">2</span>)<br></code></pre></td></tr></table></figure>\n\n<h2 id=\"可缓存的纯函数\"><a href=\"#可缓存的纯函数\" class=\"headerlink\" title=\"可缓存的纯函数\"></a>可缓存的纯函数</h2><p>当我们的计算量非常大，可能耗时很长或者很好性能，那么我们通过缓存的方式，避免函数多次计算。从而，计算了一次之后，以后再输入相同的参数，就直接返回上次计算的结果。</p>\n<blockquote>\n<p>lodash.memozie(add, resolver)</p>\n</blockquote>\n<p>实现 memoize 函数</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\"><span class=\"hljs-keyword\">function</span> <span class=\"hljs-title function_\">add</span>(<span class=\"hljs-params\">a, b</span>) &#123;<br>  <span class=\"hljs-variable language_\">console</span>.<span class=\"hljs-title function_\">log</span>(<span class=\"hljs-string\">&#x27;计算中...&#x27;</span>)<br><br>  <span class=\"hljs-keyword\">return</span> a + b<br>&#125;<br><br><span class=\"hljs-keyword\">const</span> <span class=\"hljs-title function_\">resolver</span> = (<span class=\"hljs-params\">...args</span>) =&gt; <span class=\"hljs-title class_\">JSON</span>.<span class=\"hljs-title function_\">stringify</span>(args)<br><br><span class=\"hljs-keyword\">function</span> <span class=\"hljs-title function_\">memoize</span>(<span class=\"hljs-params\">func, resolver</span>) &#123;<br>  <span class=\"hljs-keyword\">const</span> cache = &#123;&#125;<br><br>  <span class=\"hljs-keyword\">return</span> <span class=\"hljs-keyword\">function</span>(<span class=\"hljs-params\">...args</span>) &#123;<br>    <span class=\"hljs-keyword\">const</span> key = <span class=\"hljs-title function_\">resolver</span>(...args) <span class=\"hljs-comment\">// &quot;[a, b]&quot;</span><br><br>    <span class=\"hljs-keyword\">if</span> (cache[key]) &#123;<br>      <span class=\"hljs-keyword\">return</span> cache[key]<br>    &#125; <span class=\"hljs-keyword\">else</span> &#123;<br>      <span class=\"hljs-keyword\">return</span> cache[key] = <span class=\"hljs-title function_\">func</span>(...args)<br>    &#125;<br>  &#125;<br>&#125;<br><br><span class=\"hljs-keyword\">const</span> memoized = <span class=\"hljs-title function_\">memoize</span>(add, resolver)<br><br><span class=\"hljs-variable language_\">console</span>.<span class=\"hljs-title function_\">log</span>(<span class=\"hljs-title function_\">memoized</span>(<span class=\"hljs-number\">9</span>, <span class=\"hljs-number\">9</span>)) <span class=\"hljs-comment\">// 第一次打印 &quot;计算中...&quot;</span><br><span class=\"hljs-variable language_\">console</span>.<span class=\"hljs-title function_\">log</span>(<span class=\"hljs-title function_\">memoized</span>(<span class=\"hljs-number\">9</span>, <span class=\"hljs-number\">9</span>)) <span class=\"hljs-comment\">// 不会打印</span><br><span class=\"hljs-variable language_\">console</span>.<span class=\"hljs-title function_\">log</span>(<span class=\"hljs-title function_\">memoized</span>(<span class=\"hljs-number\">9</span>, <span class=\"hljs-number\">9</span>)) <span class=\"hljs-comment\">// 不会打印</span><br></code></pre></td></tr></table></figure>\n\n\n<h1 id=\"函数柯里化\"><a href=\"#函数柯里化\" class=\"headerlink\" title=\"函数柯里化\"></a>函数柯里化</h1><p>给一个函数传入一部分参数，让其返回的函数接收剩余的参数。直到所有的参数都给到了，才会计算结果。</p>\n<blockquote>\n<p>lodash.curry(fn)</p>\n</blockquote>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\"><br><span class=\"hljs-keyword\">function</span> <span class=\"hljs-title function_\">add</span>(<span class=\"hljs-params\">a, b, c</span>) &#123;<br>  <span class=\"hljs-keyword\">return</span> a + b + c<br>&#125;<br><br><span class=\"hljs-keyword\">const</span> fn = lodash.<span class=\"hljs-title function_\">curry</span>(add)<br><br><span class=\"hljs-variable language_\">console</span>.<span class=\"hljs-title function_\">log</span>(<span class=\"hljs-title function_\">fn</span>(<span class=\"hljs-number\">1</span>, <span class=\"hljs-number\">2</span>, <span class=\"hljs-number\">3</span>))<br><span class=\"hljs-variable language_\">console</span>.<span class=\"hljs-title function_\">log</span>(<span class=\"hljs-title function_\">fn</span>(<span class=\"hljs-number\">1</span>)(<span class=\"hljs-number\">2</span>, <span class=\"hljs-number\">3</span>))<br><span class=\"hljs-variable language_\">console</span>.<span class=\"hljs-title function_\">log</span>(<span class=\"hljs-title function_\">fn</span>(<span class=\"hljs-number\">1</span>)(<span class=\"hljs-number\">2</span>)(<span class=\"hljs-number\">3</span>))<br></code></pre></td></tr></table></figure>\n\n<p>实现 curry 函数</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\"><span class=\"hljs-keyword\">function</span> <span class=\"hljs-title function_\">curry</span>(<span class=\"hljs-params\">func</span>) &#123;<br>  <span class=\"hljs-keyword\">const</span> curried = <span class=\"hljs-keyword\">function</span>(<span class=\"hljs-params\">...args</span>) &#123;<br>    <span class=\"hljs-comment\">// 函数的length 表示它有几个参数</span><br>    <span class=\"hljs-keyword\">if</span> (args.<span class=\"hljs-property\">length</span> &lt; func.<span class=\"hljs-property\">length</span>) &#123;<br>      <span class=\"hljs-comment\">// 累加参数</span><br>      <span class=\"hljs-keyword\">return</span> <span class=\"hljs-function\">(<span class=\"hljs-params\">...rest</span>) =&gt;</span> <span class=\"hljs-title function_\">curried</span>(...args, ...rest)<br>    &#125; <span class=\"hljs-keyword\">else</span> &#123;<br>      <span class=\"hljs-comment\">// 传入的参数和方法接收的参数相同，直接执行 func 函数</span><br>      <span class=\"hljs-keyword\">return</span> <span class=\"hljs-title function_\">func</span>(...args)<br>    &#125;<br>  &#125;<br><br>  <span class=\"hljs-keyword\">return</span> curried<br>&#125;<br><br><span class=\"hljs-keyword\">function</span> <span class=\"hljs-title function_\">add</span>(<span class=\"hljs-params\">a, b, c</span>) &#123;<br>  <span class=\"hljs-keyword\">return</span> a + b + c<br>&#125;<br><br><span class=\"hljs-keyword\">const</span> curried = <span class=\"hljs-title function_\">curry</span>(add)<br><span class=\"hljs-keyword\">const</span> fn = <span class=\"hljs-title function_\">curried</span>(<span class=\"hljs-number\">1</span>)<br><br><span class=\"hljs-variable language_\">console</span>.<span class=\"hljs-title function_\">log</span>(<span class=\"hljs-title function_\">fn</span>(<span class=\"hljs-number\">2</span>)(<span class=\"hljs-number\">3</span>))<br></code></pre></td></tr></table></figure>\n\n<h1 id=\"函数组合\"><a href=\"#函数组合\" class=\"headerlink\" title=\"函数组合\"></a>函数组合</h1><p>看个例子</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\"><span class=\"hljs-keyword\">const</span> str = <span class=\"hljs-string\">&#x27;hello &#x27;</span><br><br><span class=\"hljs-keyword\">function</span> <span class=\"hljs-title function_\">add1</span>(<span class=\"hljs-params\">str</span>) &#123;<br>  <span class=\"hljs-keyword\">return</span> str + <span class=\"hljs-string\">&#x27;wor&#x27;</span><br>&#125;<br><br><span class=\"hljs-keyword\">function</span> <span class=\"hljs-title function_\">add2</span>(<span class=\"hljs-params\">str</span>) &#123;<br>  <span class=\"hljs-keyword\">return</span> str + <span class=\"hljs-string\">&#x27;l&#x27;</span><br>&#125;<br><br><span class=\"hljs-keyword\">function</span> <span class=\"hljs-title function_\">add3</span>(<span class=\"hljs-params\">str</span>) &#123;<br>  <span class=\"hljs-keyword\">return</span> str + <span class=\"hljs-string\">&#x27;d&#x27;</span><br>&#125;<br><br><span class=\"hljs-variable language_\">console</span>.<span class=\"hljs-title function_\">log</span>(<span class=\"hljs-title function_\">add3</span>(<span class=\"hljs-title function_\">add2</span>(<span class=\"hljs-title function_\">add1</span>(str)))) <span class=\"hljs-comment\">// hello wrold</span><br><br></code></pre></td></tr></table></figure>\n\n<p>我们通过手动组合的方式，将每个函数的结果拼接了起来，能实现想要的结果，但是过于繁琐，假设还有几个函数或者十几个函数，恐怕写下去人都麻了。</p>\n<p>好在 lodash 这个库也帮我们实现了这个方法 <code>flow &amp; flowRight</code></p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\"><span class=\"hljs-keyword\">const</span> f = lodash.<span class=\"hljs-title function_\">flow</span>(add1, add2, add3)<br><br><span class=\"hljs-title function_\">f</span>(str)<br></code></pre></td></tr></table></figure>\n\n<p>手动实现</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\"><span class=\"hljs-keyword\">const</span> str = <span class=\"hljs-string\">&#x27;hello - &#x27;</span><br><br><span class=\"hljs-keyword\">function</span> <span class=\"hljs-title function_\">add1</span>(<span class=\"hljs-params\">str</span>) &#123;<br>  <span class=\"hljs-keyword\">return</span> str + <span class=\"hljs-string\">&#x27;wor&#x27;</span><br>&#125;<br><br><span class=\"hljs-keyword\">function</span> <span class=\"hljs-title function_\">add2</span>(<span class=\"hljs-params\">str</span>) &#123;<br>  <span class=\"hljs-keyword\">return</span> str + <span class=\"hljs-string\">&#x27;l&#x27;</span><br>&#125;<br><br><span class=\"hljs-keyword\">function</span> <span class=\"hljs-title function_\">add3</span>(<span class=\"hljs-params\">str</span>) &#123;<br>  <span class=\"hljs-keyword\">return</span> str + <span class=\"hljs-string\">&#x27;d&#x27;</span><br>&#125;<br><br><span class=\"hljs-comment\">// console.log(add3(add2(add1(str))))</span><br><br><span class=\"hljs-keyword\">function</span> <span class=\"hljs-title function_\">flow</span>(<span class=\"hljs-params\">...fns</span>) &#123;<br>  <span class=\"hljs-keyword\">if</span> (fns.<span class=\"hljs-property\">length</span> === <span class=\"hljs-number\">1</span>) &#123;<br>    <span class=\"hljs-keyword\">return</span> fns[<span class=\"hljs-number\">0</span>]<br>  &#125;<br><br>  <span class=\"hljs-keyword\">return</span> fns.<span class=\"hljs-title function_\">reduceRight</span>(<span class=\"hljs-function\">(<span class=\"hljs-params\">a, b</span>) =&gt;</span> &#123;<br>    <span class=\"hljs-comment\">// 从右往左</span><br>    <span class=\"hljs-comment\">// 第一步 a === add3, b === add2</span><br>    <span class=\"hljs-comment\">// 第二步 a === (...args) =&gt; add3(add2(...args)), b === add1</span><br>    <span class=\"hljs-comment\">// 第二步的 a 显示为 (...args) =&gt; a(b(...args))</span><br>    <span class=\"hljs-comment\">// 返回 a(add1(...args))</span><br><br>    <span class=\"hljs-comment\">// 当我们最后调用 f 时，会先计算 add1(...args)，拿到结果后，执行 a &quot;add3(add2(add1(...args)))&quot;</span><br>    <span class=\"hljs-keyword\">return</span> <span class=\"hljs-function\">(<span class=\"hljs-params\">...args</span>) =&gt;</span> <span class=\"hljs-title function_\">a</span>(<span class=\"hljs-title function_\">b</span>(...args))<br>  &#125;)<br>&#125;<br><br><span class=\"hljs-keyword\">const</span> f = <span class=\"hljs-title function_\">flow</span>(add1, add2, add3)<br><br><span class=\"hljs-variable language_\">console</span>.<span class=\"hljs-title function_\">log</span>(<span class=\"hljs-title function_\">f</span>(str))<br></code></pre></td></tr></table></figure>\n\n<h1 id=\"跨域\"><a href=\"#跨域\" class=\"headerlink\" title=\"跨域\"></a>跨域</h1><blockquote>\n<p>什么是跨域？</p>\n<p>CORS 全称是 Cross-Origin Resource Sharing，意为跨域资源共享。当一个资源去访问另一个不同域名或者不同端口的资源时，就会发出跨域请求。如果另一个资源不允许其进行跨域资源访问，就会造成跨域。 </p>\n</blockquote>\n<p><strong>跨域不是问题，是浏览器的安全机制</strong></p>\n<p>跨域不会阻止请求的发出，也不会阻止请求的接收，跨域是浏览器为了保护当前页面，你的请求得到了响应，但是浏览器不会将请求到的数据提交给当前页面上的回调，取而代之的是去提示你这是一个跨域数据。</p>\n<p><strong>同源策略</strong>导致。</p>\n<p>所谓同源策略，就是<code>协议、域名、端口号</code>都要相同，有一个不相同，那么就是非同源，就会出现跨域。</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\"><span class=\"hljs-comment\">// 跨域(端口不同)</span><br><br><span class=\"hljs-attr\">http</span>:<span class=\"hljs-comment\">//localhost:8080</span><br><span class=\"hljs-attr\">http</span>:<span class=\"hljs-comment\">//localhost:3000</span><br><br><br><span class=\"hljs-comment\">// 跨域(协议不同)</span><br><span class=\"hljs-attr\">https</span>:<span class=\"hljs-comment\">//localhost:8080</span><br><span class=\"hljs-attr\">http</span>:<span class=\"hljs-comment\">//localhost:8080</span><br><br><span class=\"hljs-comment\">// 跨域(域名)</span><br><span class=\"hljs-attr\">https</span>:<span class=\"hljs-comment\">//localhost:8080</span><br><span class=\"hljs-attr\">https</span>:<span class=\"hljs-comment\">//192.168.1.2:8080</span><br><br><br><span class=\"hljs-comment\">// 跨域(协议不同，端口也不同)</span><br><span class=\"hljs-comment\">// http 默认端口是 80，https 默认端口是 443</span><br><span class=\"hljs-attr\">http</span>:<span class=\"hljs-comment\">//localhost/bbb</span><br><span class=\"hljs-attr\">https</span>:<span class=\"hljs-comment\">//localhost/aaa</span><br></code></pre></td></tr></table></figure>\n\n<h2 id=\"解决跨域\"><a href=\"#解决跨域\" class=\"headerlink\" title=\"解决跨域\"></a>解决跨域</h2><ol>\n<li>纯后端方式</li>\n</ol>\n<p>假设我们有个后端服务 3000，提供了 <code>/user</code> 接口，我们可以直接在 <code>.html</code> 文件中访问，如果后端不设置跨域，那么肯定会出现跨域提示的。</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\"><span class=\"hljs-comment\">// server</span><br><span class=\"hljs-keyword\">const</span> express = <span class=\"hljs-built_in\">require</span>(<span class=\"hljs-string\">&#x27;express&#x27;</span>)<br><span class=\"hljs-keyword\">const</span> app = <span class=\"hljs-title function_\">express</span>()<br><br>app.<span class=\"hljs-title function_\">get</span>(<span class=\"hljs-string\">&#x27;/user&#x27;</span>, <span class=\"hljs-function\">(<span class=\"hljs-params\">req, res</span>) =&gt;</span> &#123;<br>  res.<span class=\"hljs-title function_\">json</span>(&#123;<br>    <span class=\"hljs-attr\">code</span>: <span class=\"hljs-number\">0</span>,<br>    <span class=\"hljs-attr\">msg</span>: <span class=\"hljs-string\">&#x27;请求user成功&#x27;</span><br>  &#125;)<br>&#125;)<br><br>app.<span class=\"hljs-title function_\">listen</span>(<span class=\"hljs-string\">&#x27;3000&#x27;</span>, <span class=\"hljs-function\">() =&gt;</span> &#123;<br>  <span class=\"hljs-variable language_\">console</span>.<span class=\"hljs-title function_\">log</span>(<span class=\"hljs-string\">&#x27;server running at port 3000...&#x27;</span>)<br>&#125;)<br><br><br><span class=\"hljs-comment\">// client</span><br>&lt;script&gt;<br>  <span class=\"hljs-keyword\">const</span> xhr = <span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">XMLHttpRequest</span>()<br>  xhr.<span class=\"hljs-title function_\">open</span>(<span class=\"hljs-string\">&#x27;get&#x27;</span>, <span class=\"hljs-string\">&#x27;http://localhost:3000/user&#x27;</span>)<br>  xhr.<span class=\"hljs-property\">onload</span> = <span class=\"hljs-keyword\">function</span>(<span class=\"hljs-params\"></span>) &#123;<br>    <span class=\"hljs-title function_\">consolelog</span>(xhr.<span class=\"hljs-property\">response</span>)<br>  &#125;<br>  xhr.<span class=\"hljs-title function_\">send</span>()<br><br><br>  <span class=\"hljs-comment\">// fetch</span><br>  <span class=\"hljs-title function_\">fetch</span>(<span class=\"hljs-string\">&#x27;http://localhost:3000/user&#x27;</span>)<br>    .<span class=\"hljs-title function_\">then</span>(<span class=\"hljs-function\"><span class=\"hljs-params\">res</span> =&gt;</span> res.<span class=\"hljs-title function_\">text</span>())<br>    .<span class=\"hljs-title function_\">then</span>(<span class=\"hljs-function\"><span class=\"hljs-params\">res</span> =&gt;</span> &#123;<br>      <span class=\"hljs-variable language_\">console</span>.<span class=\"hljs-title function_\">log</span>(res)<br>    &#125;)<br>&lt;/script&gt;<br></code></pre></td></tr></table></figure>\n\n<p><strong>后端设置跨域访问</strong></p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\"><span class=\"hljs-comment\">// CORS</span><br>app.<span class=\"hljs-title function_\">all</span>(<span class=\"hljs-string\">&#x27;*&#x27;</span>, <span class=\"hljs-keyword\">function</span>(<span class=\"hljs-params\">req, res, next</span>) &#123;<br>  <span class=\"hljs-comment\">// 允许所有请求源</span><br>  res.<span class=\"hljs-title function_\">header</span>(<span class=\"hljs-string\">&quot;Access-Control-Allow-Origin&quot;</span>, <span class=\"hljs-string\">&quot;*&quot;</span>)<br>  res.<span class=\"hljs-title function_\">header</span>(<span class=\"hljs-string\">&quot;Access-Control-Allow-Headers&quot;</span>, <span class=\"hljs-string\">&quot;*&quot;</span>)<br>  res.<span class=\"hljs-title function_\">header</span>(<span class=\"hljs-string\">&quot;Access-Control-Allow-Methods&quot;</span>, <span class=\"hljs-string\">&quot;*&quot;</span>)<br><br>  <span class=\"hljs-title function_\">next</span>()<br>&#125;)<br></code></pre></td></tr></table></figure>\n\n<ol start=\"2\">\n<li>前端处理<br>主要是通过 <code>webpack devServer</code> 的 <code>proxy</code> 来处理。</li>\n</ol>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\">...<br><span class=\"hljs-attr\">devServer</span>: &#123;<br>  <span class=\"hljs-attr\">proxy</span>: &#123;<br>    <span class=\"hljs-string\">&#x27;/api&#x27;</span>: &#123;<br>      <span class=\"hljs-attr\">target</span>: <span class=\"hljs-string\">&#x27;http://localhost:3000/&#x27;</span> <span class=\"hljs-comment\">// http://localhost:8080/api/user =&gt; http://localhost:3000/api/user</span><br>    &#125;<br>  &#125;,<br>  <span class=\"hljs-attr\">proxy</span>: &#123;<br>    <span class=\"hljs-string\">&#x27;/no-api&#x27;</span>: &#123;<br>      <span class=\"hljs-attr\">target</span>: <span class=\"hljs-string\">&#x27;http://localhost:3000/&#x27;</span>, <span class=\"hljs-comment\">// http://localhost:8080/no-api/user =&gt; http://localhost:3000/user</span><br>      <span class=\"hljs-attr\">pathRewrite</span>: &#123;<br>        <span class=\"hljs-string\">&#x27;/no-api&#x27;</span>: <span class=\"hljs-string\">&#x27;&#x27;</span>, <span class=\"hljs-comment\">// 后端接口中一般不会含有 api 标识符，我们可以去掉</span><br>      &#125;<br>    &#125;<br>  &#125;,<br>&#125;<br>...<br></code></pre></td></tr></table></figure>\n\n<ol start=\"3\">\n<li>Nginx</li>\n</ol>\n<p>要注意的是，devServer 配置 proxy 只是存在于我们开发项目时有用，如果项目要上线，devServer 就没有了，这时可以考虑采用 <code>Nginx</code> 来代理。</p>\n<ol start=\"4\">\n<li>前后端合并方式</li>\n</ol>\n<p>我们可以不采用 <code>devServer proxy</code> 方式，而是在后端配置 <code>webpack-dev-middleware</code>，将前后端进行合并。</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\"><span class=\"hljs-keyword\">const</span> express = <span class=\"hljs-built_in\">require</span>(<span class=\"hljs-string\">&#x27;express&#x27;</span>)<br><span class=\"hljs-keyword\">const</span> webpack = <span class=\"hljs-built_in\">require</span>(<span class=\"hljs-string\">&#x27;webpack&#x27;</span>)<br><span class=\"hljs-keyword\">const</span> middle = <span class=\"hljs-built_in\">require</span>(<span class=\"hljs-string\">&#x27;webpack-dev-middleware&#x27;</span>)<br><span class=\"hljs-keyword\">const</span> compile = <span class=\"hljs-built_in\">require</span>(<span class=\"hljs-string\">&#x27;./webpack.config.js&#x27;</span>)<br><br><br><span class=\"hljs-keyword\">const</span> app = <span class=\"hljs-title function_\">express</span>()<br><br>app.<span class=\"hljs-title function_\">use</span>(<span class=\"hljs-title function_\">middle</span>(compile))<br><br><br>app.<span class=\"hljs-title function_\">get</span>(<span class=\"hljs-string\">&#x27;/user&#x27;</span>, <span class=\"hljs-function\">(<span class=\"hljs-params\">req, res</span>) =&gt;</span> &#123;<br>  res.<span class=\"hljs-title function_\">json</span>(&#123;<br>    <span class=\"hljs-attr\">code</span>: <span class=\"hljs-number\">0</span>,<br>    <span class=\"hljs-attr\">msg</span>: <span class=\"hljs-string\">&#x27;请求user成功&#x27;</span><br>  &#125;)<br>&#125;)<br><br>app.<span class=\"hljs-title function_\">listen</span>(<span class=\"hljs-string\">&#x27;3000&#x27;</span>, <span class=\"hljs-function\">() =&gt;</span> &#123;<br>  <span class=\"hljs-variable language_\">console</span>.<span class=\"hljs-title function_\">log</span>(<span class=\"hljs-string\">&#x27;server running at port 3000...&#x27;</span>)<br>&#125;)<br></code></pre></td></tr></table></figure>\n\n<ol start=\"5\">\n<li>jsonp</li>\n</ol>\n<p>比较老、兼容性好的方式。</p>\n<p>利用标签没有跨域限制的漏洞，在 script 标签上我们可以引用其他服务上的脚本。</p>\n<p>最常见的场景就是 CDN.</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\">&lt;script src=<span class=\"hljs-string\">&quot;https://cdn.jsdelivr.net/npm/vue@2.7.14/dist/vue.js&quot;</span>&gt;&lt;/script&gt;<br></code></pre></td></tr></table></figure>\n\n<p>使用方式：</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\"><span class=\"hljs-keyword\">function</span> <span class=\"hljs-title function_\">callback</span>(<span class=\"hljs-params\">res</span>) &#123;<br>  <span class=\"hljs-variable language_\">console</span>.<span class=\"hljs-title function_\">log</span>(<span class=\"hljs-title class_\">JSON</span>.<span class=\"hljs-title function_\">stringify</span>(res, <span class=\"hljs-literal\">null</span>, <span class=\"hljs-number\">2</span>))<br>&#125;<br><br><span class=\"hljs-comment\">// 动态创建 script 标签，设置好 scr 属性，主要参数是 cb=callback</span><br><br><span class=\"hljs-keyword\">const</span> script = <span class=\"hljs-variable language_\">document</span>.<span class=\"hljs-title function_\">createElement</span>(<span class=\"hljs-string\">&#x27;script&#x27;</span>)<br>script.<span class=\"hljs-property\">src</span> = <span class=\"hljs-string\">&#x27;http://127.0.0.1:3000/info/jsonp?cb=callback&#x27;</span><br><br><span class=\"hljs-variable language_\">document</span>.<span class=\"hljs-title function_\">getElementByTagsName</span>(<span class=\"hljs-string\">&#x27;head&#x27;</span>)[<span class=\"hljs-number\">0</span>].<span class=\"hljs-title function_\">appendChild</span>(script)<br></code></pre></td></tr></table></figure>\n\n<h1 id=\"前端路由\"><a href=\"#前端路由\" class=\"headerlink\" title=\"前端路由\"></a>前端路由</h1><p>模式有两种：</p>\n<ol>\n<li>hash 模式</li>\n<li>history 模式</li>\n</ol>\n<hr>\n<ul>\n<li><strong>hash 模式</strong></li>\n</ul>\n<p>URL 的 hash 也就是锚点（#），本质上是改变 window.location 的 href 属性。可以直接给 href 复制，但是页面不刷新。</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\">location.<span class=\"hljs-property\">href</span> <span class=\"hljs-comment\">// 获取当前浏览器 url: &#x27;https://www.baidu.com/&#x27;</span><br><br>location.<span class=\"hljs-property\">href</span> = <span class=\"hljs-string\">&#x27;/foo&#x27;</span><br></code></pre></td></tr></table></figure>\n\n<ul>\n<li><strong>history 模式</strong></li>\n</ul>\n<p>HTML5 新增。</p>\n<p>它有五种模式改变 url 而不刷新页面。</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\">history.<span class=\"hljs-title function_\">pushState</span>(&#123;&#125;, <span class=\"hljs-string\">&#x27;&#x27;</span>, <span class=\"hljs-string\">&#x27;/foo&#x27;</span>)<br>history.<span class=\"hljs-title function_\">replaceState</span>(&#123;&#125;, <span class=\"hljs-string\">&#x27;&#x27;</span>, <span class=\"hljs-string\">&#x27;/foo&#x27;</span>)<br>history.<span class=\"hljs-title function_\">go</span>(-<span class=\"hljs-number\">1</span>)<br><br>history.<span class=\"hljs-title function_\">back</span>() <span class=\"hljs-comment\">// 等价 history.go(-1)</span><br>history.<span class=\"hljs-title function_\">forward</span>() <span class=\"hljs-comment\">// history.go(1)</span><br></code></pre></td></tr></table></figure>\n\n<ul>\n<li>vue-router</li>\n</ul>\n<p>在 Vue 中，有两种方式可以跳转路由：</p>\n<ul>\n<li>申明式路由 <code>&lt;router-link to=&quot;/go&quot;&gt;跳转&lt;/router-link&gt;</code></li>\n<li>编程式路由 <code>this.$router.go(&#39;/go&#39;)</code></li>\n</ul>\n<p><strong>实现 vue-router 路由</strong></p>\n<blockquote>\n<p><a href=\"https://www.bilibili.com/video/BV1n24y1w7kP?p=25&amp;spm_id_from=pageDriver&amp;vd_source=a9f38e58a519cc0570c2dacd34ad7ebe\">https://www.bilibili.com/video/BV1n24y1w7kP?p=25&amp;spm_id_from=pageDriver&amp;vd_source=a9f38e58a519cc0570c2dacd34ad7ebe</a></p>\n</blockquote>\n<h1 id=\"Promise\"><a href=\"#Promise\" class=\"headerlink\" title=\"Promise\"></a>Promise</h1><blockquote>\n<p>所谓Promise，就是一个对象，用来传递异步操作的消息。它代表了某个未来才会知道结果的事件（通常是一个异步操作），并且这个事件提供统一的API，可供进一步处理。</p>\n</blockquote>\n<p>特点：</p>\n<ol>\n<li><p>对象的状态不受外界影响（pedding, resolved, rejected）</p>\n</li>\n<li><p>一旦状态改变就不会再改变</p>\n</li>\n</ol>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\"><span class=\"hljs-keyword\">const</span> p = <span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">Promise</span>(<span class=\"hljs-function\">(<span class=\"hljs-params\">resolve, reject</span>) =&gt;</span> &#123;<br>  <span class=\"hljs-keyword\">if</span> (<span class=\"hljs-literal\">true</span>) &#123;<br>    <span class=\"hljs-title function_\">resolve</span>(<span class=\"hljs-literal\">true</span>)<br>  &#125; <span class=\"hljs-keyword\">else</span> &#123;<br>    <span class=\"hljs-title function_\">reject</span>(<span class=\"hljs-literal\">false</span>)<br>  &#125;<br>&#125;)<br></code></pre></td></tr></table></figure>\n\n<p>resolve函数的作用是，将Promise对象的状态从“未完成”变为“成功”（即从Pending变为Resolved）</p>\n<p>reject函数的作用是，将Promise对象的状态从“未完成”变为“失败”（即从Pending变为Rejected）</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\"><span class=\"hljs-keyword\">function</span> <span class=\"hljs-title function_\">timeout</span>(<span class=\"hljs-params\">ms</span>) &#123;<br>  <span class=\"hljs-keyword\">return</span> <span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">Promise</span>(<span class=\"hljs-function\"><span class=\"hljs-params\">resolve</span> =&gt;</span> &#123;<br>    <span class=\"hljs-comment\">// setTimeout 第三个参数，是传递给第一个函数的，这里是resolve 方法</span><br>    <span class=\"hljs-built_in\">setTimeout</span>(resolve, ms, <span class=\"hljs-string\">&#x27;done&#x27;</span>)<br>  &#125;)<br>&#125;<br><br><span class=\"hljs-title function_\">timeout</span>(<span class=\"hljs-number\">1000</span>).<span class=\"hljs-title function_\">then</span>(<span class=\"hljs-function\"><span class=\"hljs-params\">res</span> =&gt;</span> &#123;<br>  <span class=\"hljs-variable language_\">console</span>.<span class=\"hljs-title function_\">log</span>(res)<br>&#125;)<br></code></pre></td></tr></table></figure>\n\n<p>resolve函数的参数除了正常的值外，还可能是另一个Promise实例，表示异步操作的结果有可能是一个值，也有可能是另一个异步操作：</p>\n<p><strong>p1的状态决定了p2的状态</strong></p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\"><span class=\"hljs-keyword\">const</span> p1 = <span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">Promise</span>(<span class=\"hljs-function\">(<span class=\"hljs-params\">r, reject</span>) =&gt;</span> &#123;<br>  <span class=\"hljs-built_in\">setTimeout</span>(<span class=\"hljs-function\">() =&gt;</span> &#123;<br>    <span class=\"hljs-title function_\">reject</span>(<span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">Error</span>(<span class=\"hljs-string\">&#x27;fail&#x27;</span>))<br>  &#125;, <span class=\"hljs-number\">3000</span>);<br>&#125;)<br><br><span class=\"hljs-keyword\">const</span> p2 = <span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">Promise</span>(<span class=\"hljs-function\">(<span class=\"hljs-params\">r, reject</span>) =&gt;</span> &#123;<br>  <span class=\"hljs-title function_\">r</span>(p1)<br>&#125;)<br><br>p2.<span class=\"hljs-title function_\">then</span>(<span class=\"hljs-function\"><span class=\"hljs-params\">result</span> =&gt;</span> &#123;<br>  <span class=\"hljs-variable language_\">console</span>.<span class=\"hljs-title function_\">log</span>(<span class=\"hljs-string\">&#x27;result &#x27;</span>, result)<br>&#125;, <span class=\"hljs-function\"><span class=\"hljs-params\">error</span> =&gt;</span> &#123;<br>  <span class=\"hljs-variable language_\">console</span>.<span class=\"hljs-title function_\">log</span>(<span class=\"hljs-string\">&#x27;error &#x27;</span>, error)<br>&#125;)<br></code></pre></td></tr></table></figure>\n\n<p>上面的代码中，p1是一个Promise,3秒之后变为Rejected。p2的状态由p1决定，p2调用resolve方法，但是此时p1的状态还没有改变，因此p2的状态也不会变。等3秒过后，p1变为Rejected,p2也跟着变为Rejected。</p>\n<p><strong>需要注意的是，catch方法返回的还是一个Promise对象，因此后面还可以接着调用then方法。</strong></p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\"><span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">Promise</span>(<span class=\"hljs-function\"><span class=\"hljs-params\">r</span> =&gt;</span> &#123;<br>  <span class=\"hljs-title function_\">r</span>(x + <span class=\"hljs-number\">2</span>)<br>&#125;).<span class=\"hljs-title function_\">then</span>(<span class=\"hljs-function\"><span class=\"hljs-params\">res</span> =&gt;</span> &#123;<br>  <span class=\"hljs-variable language_\">console</span>.<span class=\"hljs-title function_\">log</span>(<span class=\"hljs-string\">&#x27;结果 &#x27;</span>, res)<br>&#125;).<span class=\"hljs-title function_\">catch</span>(<span class=\"hljs-function\"><span class=\"hljs-params\">err</span> =&gt;</span> &#123;<br>  <span class=\"hljs-variable language_\">console</span>.<span class=\"hljs-title function_\">log</span>(<span class=\"hljs-string\">&#x27;错误 &#x27;</span>, err)<br>&#125;).<span class=\"hljs-title function_\">then</span>(<span class=\"hljs-function\">() =&gt;</span> &#123;<br>  <span class=\"hljs-variable language_\">console</span>.<span class=\"hljs-title function_\">log</span>(<span class=\"hljs-string\">&#x27;随便打印&#x27;</span>)<br>&#125;).<span class=\"hljs-title function_\">finally</span>(<span class=\"hljs-function\">() =&gt;</span> &#123;<br>  <span class=\"hljs-variable language_\">console</span>.<span class=\"hljs-title function_\">log</span>(<span class=\"hljs-string\">&#x27;最后打印&#x27;</span>)<br>&#125;)<br><br><span class=\"hljs-comment\">// =======&gt;</span><br>错误  <span class=\"hljs-title class_\">ReferenceError</span>: x is not defined<br><br>随便打印<br><br>最后打印<br></code></pre></td></tr></table></figure>\n\n<h2 id=\"Promise-all\"><a href=\"#Promise-all\" class=\"headerlink\" title=\"Promise.all\"></a>Promise.all</h2><blockquote>\n<p>Promise.all方法用于将多个Promise实例包装成一个新的Promise实例。</p>\n</blockquote>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\"><span class=\"hljs-keyword\">const</span> p = <span class=\"hljs-title class_\">Promise</span>.<span class=\"hljs-title function_\">all</span>([p1, p2, p3])<br></code></pre></td></tr></table></figure>\n\n<p>p的状态由p1、p2、p3决定，分成两种情况。</p>\n<ol>\n<li><p>只有p1、p2、p3的状态都变成Fulfilled,p的状态才会变成Fulfilled，此时p1、p2、p3的返回值组成一个数组，传递给p的回调函数。</p>\n</li>\n<li><p>只要p1、p2、p3中有一个被Rejected,p的状态就变成Rejected，此时第一个被Rejected的实例的返回值会传递给p的回调函数。</p>\n</li>\n</ol>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\"><span class=\"hljs-keyword\">const</span> p3 = <span class=\"hljs-keyword\">function</span>(<span class=\"hljs-params\"></span>) &#123;<br>  <span class=\"hljs-keyword\">return</span> <span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">Promise</span>(<span class=\"hljs-function\"><span class=\"hljs-params\">r</span> =&gt;</span> &#123;<br>    <span class=\"hljs-built_in\">setTimeout</span>(<span class=\"hljs-function\">() =&gt;</span> &#123;<br>      <span class=\"hljs-title function_\">r</span>(<span class=\"hljs-string\">&#x27;p3 success&#x27;</span>)<br>    &#125;, <span class=\"hljs-number\">3000</span>);<br>  &#125;)<br>&#125;<br><br><span class=\"hljs-keyword\">const</span> allP = <span class=\"hljs-title class_\">Promise</span>.<span class=\"hljs-title function_\">all</span>([<span class=\"hljs-number\">1</span>, <span class=\"hljs-number\">2</span>, <span class=\"hljs-title function_\">p3</span>()])<br><br>allP.<span class=\"hljs-title function_\">then</span>(<span class=\"hljs-function\"><span class=\"hljs-params\">r</span> =&gt;</span> &#123;<br>  <span class=\"hljs-variable language_\">console</span>.<span class=\"hljs-title function_\">log</span>(r)<br>&#125;)<br></code></pre></td></tr></table></figure>\n\n<p>上面的例子，3秒后，输出 <code>[ 1, 2, &#39;p3 success&#39; ]</code></p>\n<h2 id=\"Promise-race\"><a href=\"#Promise-race\" class=\"headerlink\" title=\"Promise.race\"></a>Promise.race</h2><blockquote>\n<p>竞速</p>\n<p>有一个实例率先改变状态，p的状态就跟着改变。那个率先改变的Promise实例的返回值，就传递给p的回调函数。</p>\n</blockquote>\n<p>超时处理</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\"><span class=\"hljs-keyword\">const</span> p = <span class=\"hljs-title class_\">Promise</span>.<span class=\"hljs-title function_\">race</span>([<br>  <span class=\"hljs-title function_\">fetch</span>(<span class=\"hljs-string\">&#x27;http://localhost:3000/api/user&#x27;</span>),<br>  <span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">Promise</span>(<span class=\"hljs-function\">(<span class=\"hljs-params\">r, reject</span>) =&gt;</span> &#123;<br>    <span class=\"hljs-built_in\">setTimeout</span>(<span class=\"hljs-function\">() =&gt;</span> &#123;<br>      <span class=\"hljs-title function_\">reject</span>(<span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">Error</span>(<span class=\"hljs-string\">&#x27;Request timeout&#x27;</span>))<br>    &#125;, <span class=\"hljs-number\">5000</span>)<br>  &#125;)<br>])<br></code></pre></td></tr></table></figure>\n\n<p>上面的代码中，如果5秒之内fetch方法无法返回结果，变量p的状态就会变为Rejected，从而触发catch方法指定的回调函数。</p>\n<h1 id=\"async-await\"><a href=\"#async-await\" class=\"headerlink\" title=\"async await\"></a>async await</h1><blockquote>\n<p>async函数就是Generator函数的语法糖。</p>\n</blockquote>\n<p>async函数返回一个Promise对象，可以使用then方法添加回调函数</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\"><span class=\"hljs-keyword\">async</span> <span class=\"hljs-keyword\">function</span> <span class=\"hljs-title function_\">sayName</span>(<span class=\"hljs-params\"></span>) &#123;<br>  <span class=\"hljs-keyword\">return</span> <span class=\"hljs-string\">&#x27;name&#x27;</span><br>&#125;<br><br><span class=\"hljs-variable language_\">console</span>.<span class=\"hljs-title function_\">log</span>(<span class=\"hljs-title function_\">sayName</span>()) <span class=\"hljs-comment\">// Promise &#123; &#x27;name&#x27; &#125;</span><br><br><span class=\"hljs-title function_\">sayName</span>().<span class=\"hljs-title function_\">then</span>(<span class=\"hljs-function\"><span class=\"hljs-params\">res</span> =&gt;</span> <span class=\"hljs-variable language_\">console</span>.<span class=\"hljs-title function_\">log</span>(res)) <span class=\"hljs-comment\">// name</span><br></code></pre></td></tr></table></figure>\n\n<p>当函数执行时，一旦遇到await就会先返回，等到触发的异步操作完成，再接着执行函数体内后面的语句。</p>\n<p>我们来实现一个 sleep 睡眠函数：</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\"><span class=\"hljs-comment\">// 睡眠函数</span><br><span class=\"hljs-keyword\">const</span> sleep = <span class=\"hljs-keyword\">function</span>(<span class=\"hljs-params\">ms</span>) &#123;<br>  <span class=\"hljs-keyword\">return</span> <span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">Promise</span>(<span class=\"hljs-function\"><span class=\"hljs-params\">r</span> =&gt;</span> &#123;<br>    <span class=\"hljs-built_in\">setTimeout</span>(<span class=\"hljs-function\">() =&gt;</span> &#123;<br>      <span class=\"hljs-title function_\">r</span>()<br>    &#125;, ms);<br>  &#125;)<br>&#125;<br><br><span class=\"hljs-keyword\">async</span> <span class=\"hljs-keyword\">function</span> <span class=\"hljs-title function_\">sayName</span>(<span class=\"hljs-params\"></span>) &#123;<br>  <span class=\"hljs-variable language_\">console</span>.<span class=\"hljs-title function_\">log</span>(<span class=\"hljs-number\">1</span>)<br><br>  <span class=\"hljs-keyword\">await</span> <span class=\"hljs-title function_\">sleep</span>(<span class=\"hljs-number\">3000</span>)<br><br><br>  <span class=\"hljs-variable language_\">console</span>.<span class=\"hljs-title function_\">log</span>(<span class=\"hljs-number\">2</span>)<br>  <br>  <span class=\"hljs-keyword\">return</span> <span class=\"hljs-string\">&#x27;name&#x27;</span><br>&#125;<br><br><span class=\"hljs-title function_\">sayName</span>().<span class=\"hljs-title function_\">then</span>(<span class=\"hljs-function\"><span class=\"hljs-params\">res</span> =&gt;</span> <span class=\"hljs-variable language_\">console</span>.<span class=\"hljs-title function_\">log</span>(res))<br></code></pre></td></tr></table></figure>\n\n<p>当我们调用 sayName 方法时，会立即打印出 1, 3秒过后，打印 2 和 ’name‘</p>\n<p><strong>注意</strong></p>\n<p>await命令后面的Promise对象，运行结果可能是Rejected，所以最好把 await 命令放在try…catch代码块中。</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\"><span class=\"hljs-keyword\">const</span> sleep = <span class=\"hljs-keyword\">function</span>(<span class=\"hljs-params\">ms</span>) &#123;<br>  <span class=\"hljs-keyword\">return</span> <span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">Promise</span>(<span class=\"hljs-function\"><span class=\"hljs-params\">r</span> =&gt;</span> &#123;<br>    <span class=\"hljs-comment\">// 这里报错，会被外面的 try-catch 接收到</span><br>    <span class=\"hljs-variable language_\">console</span>.<span class=\"hljs-title function_\">log</span>(xxxxx + <span class=\"hljs-number\">3</span>)<br><br>    <span class=\"hljs-built_in\">setTimeout</span>(<span class=\"hljs-function\">() =&gt;</span> &#123;<br>      <span class=\"hljs-comment\">// setTimeout 内部报错，不会被外部的 try catch 捕获到</span><br>      <span class=\"hljs-title function_\">r</span>()<br>    &#125;, ms)<br>  &#125;)<br>&#125;<br><br><span class=\"hljs-keyword\">async</span> <span class=\"hljs-keyword\">function</span> <span class=\"hljs-title function_\">sayName</span>(<span class=\"hljs-params\"></span>) &#123;<br>  <span class=\"hljs-keyword\">try</span> &#123;<br>    <span class=\"hljs-keyword\">await</span> <span class=\"hljs-title function_\">sleep</span>(<span class=\"hljs-number\">3000</span>)<br>  &#125; <span class=\"hljs-keyword\">catch</span> (error) &#123;<br>    <span class=\"hljs-variable language_\">console</span>.<span class=\"hljs-title function_\">log</span>(<span class=\"hljs-string\">&#x27; - - - &#x27;</span>, error)<br>  &#125;<br>&#125;<br><br><span class=\"hljs-title function_\">sayName</span>().<span class=\"hljs-title function_\">then</span>(<span class=\"hljs-function\"><span class=\"hljs-params\">res</span> =&gt;</span> <span class=\"hljs-variable language_\">console</span>.<span class=\"hljs-title function_\">log</span>(res))<br></code></pre></td></tr></table></figure>"}],"PostAsset":[],"PostCategory":[],"PostTag":[{"post_id":"clhkizgx900033y0q1xqa2rjz","tag_id":"clhkizgxc00063y0q57bjen37","_id":"clhkizgxh000e3y0qfebg5ejo"},{"post_id":"clhkizgxb00053y0qdbo8htvg","tag_id":"clhkizgxg000d3y0qbkwj3cgv","_id":"clhkizgxj000m3y0qgyih63va"},{"post_id":"clhkizgxd00083y0q0vmy1uay","tag_id":"clhkizgxi000j3y0q34495bjr","_id":"clhkizgxl000s3y0qermqetwa"},{"post_id":"clhkizgxl000r3y0q7cum0wm0","tag_id":"clhkizgxc00063y0q57bjen37","_id":"clhkizgxm000v3y0q25llb4a9"},{"post_id":"clhkizgxe000a3y0qgva8ec1w","tag_id":"clhkizgxk000p3y0qcrw5b53j","_id":"clhkizgxn000z3y0q82dcf3kt"},{"post_id":"clhkizgxg000c3y0qdeaj9tgs","tag_id":"clhkizgxm000w3y0q40tr5ywn","_id":"clhkizgxp00153y0qd38temy0"},{"post_id":"clhkizgxh000g3y0qha7cctjq","tag_id":"clhkizgxp00143y0q5sckd3dt","_id":"clhkizgxs001d3y0q66c58k81"},{"post_id":"clhkizgxi000i3y0q0xatdvk6","tag_id":"clhkizgxr001a3y0q3lut8c5w","_id":"clhkizgxv001i3y0q643c6ta7"},{"post_id":"clhkizgxj000l3y0q30u488vj","tag_id":"clhkizgxu001g3y0q1izgfb6q","_id":"clhkizgxv001m3y0qhpxqfmkh"},{"post_id":"clhkizgxk000o3y0qase5ho29","tag_id":"clhkizgxv001k3y0qf1ongdaf","_id":"clhkizgxx001q3y0q12gnc3vn"},{"post_id":"clhkizgxm000u3y0qd7z1d63w","tag_id":"clhkizgxv001k3y0qf1ongdaf","_id":"clhkizgxy001u3y0qfi5n5nsf"},{"post_id":"clhkizgxn000y3y0q7b41gs5m","tag_id":"clhkizgxy001t3y0q0si2feze","_id":"clhkizgxz001z3y0q619ah731"},{"post_id":"clhkizgxo00113y0q9zwt9q5q","tag_id":"clhkizgxz001x3y0qf37mf55e","_id":"clhkizgy000233y0q0x796w1d"},{"post_id":"clhkizgxp00133y0qdq1n1mq4","tag_id":"clhkizgy000213y0q50xsa99e","_id":"clhkizgy100273y0qgth4f2sk"},{"post_id":"clhkizgxq00173y0q59pn2npa","tag_id":"clhkizgxz001x3y0qf37mf55e","_id":"clhkizgy2002b3y0q02bb8uhk"},{"post_id":"clhkizgxq00193y0qcpul4shp","tag_id":"clhkizgy200293y0qh3fj2jzs","_id":"clhkizgy3002f3y0q53wual9o"},{"post_id":"clhkizgxr001c3y0qfwuzb4g5","tag_id":"clhkizgy3002e3y0qappxfs41","_id":"clhkizgy4002k3y0qawhcenaa"},{"post_id":"clhkizgxt001f3y0qgvnz59ir","tag_id":"clhkizgy4002i3y0q3gb90epz","_id":"clhkizgy5002n3y0q2iqya49l"},{"post_id":"clhkizgy9002w3y0q91mw9zlr","tag_id":"clhkizgya002y3y0q99aa6152","_id":"clhkizgyb00323y0qcfwgf8uk"},{"post_id":"clhkizgy9002x3y0qbrnr9vze","tag_id":"clhkizgyb00313y0q8o0e21tm","_id":"clhkizgyb00343y0qbqnf6g9w"},{"post_id":"clhkizgya002z3y0qg7fp3obv","tag_id":"clhkizgyb00333y0q58fahh9b","_id":"clhkizgyb00363y0q6kh1f1wg"},{"post_id":"clhkizgya00303y0qh7oi6ba8","tag_id":"clhkizgyb00353y0q84vu3py2","_id":"clhkizgyb00373y0q86yocn9l"},{"post_id":"clhkizgyd00383y0qgsg2ddnv","tag_id":"clhkizgyb00333y0q58fahh9b","_id":"clhkizgyo003a3y0qf93684b0"},{"post_id":"clhkizgyn00393y0qepdt6278","tag_id":"clhkizgxz001x3y0qf37mf55e","_id":"clhkizgyo003b3y0q74yx4zif"},{"post_id":"clhkizgyp003c3y0q0ix98g39","tag_id":"clhkizgyp003d3y0q7m4e9bci","_id":"clhkizgyq003e3y0qdlp55n7p"}],"Tag":[{"name":"Nodejs","_id":"clhkizgxc00063y0q57bjen37"},{"name":"Web3","_id":"clhkizgxg000d3y0qbkwj3cgv"},{"name":"RN H5","_id":"clhkizgxi000j3y0q34495bjr"},{"name":"One","_id":"clhkizgxk000p3y0qcrw5b53j"},{"name":"JavaScript, ES6","_id":"clhkizgxm000w3y0q40tr5ywn"},{"name":"微前端","_id":"clhkizgxp00143y0q5sckd3dt"},{"name":"Nginx","_id":"clhkizgxr001a3y0q3lut8c5w"},{"name":"React，Hooks","_id":"clhkizgxu001g3y0q1izgfb6q"},{"name":"JS","_id":"clhkizgxv001k3y0qf1ongdaf"},{"name":"JS,Vue-Router,Vue3,","_id":"clhkizgxy001t3y0q0si2feze"},{"name":"工程化,Vue3","_id":"clhkizgxz001x3y0qf37mf55e"},{"name":"工程化,Vue3,Config","_id":"clhkizgy000213y0q50xsa99e"},{"name":"Reactive,Vue3","_id":"clhkizgy200293y0qh3fj2jzs"},{"name":"组件","_id":"clhkizgy3002e3y0qappxfs41"},{"name":"TypeScript TS","_id":"clhkizgy4002i3y0q3gb90epz"},{"name":"English","_id":"clhkizgya002y3y0q99aa6152"},{"name":"ESM ESModule ESBuild","_id":"clhkizgyb00313y0q8o0e21tm"},{"name":"工程化,Vue3,通用功能","_id":"clhkizgyb00333y0q58fahh9b"},{"name":"JS,Vue3","_id":"clhkizgyb00353y0q84vu3py2"},{"name":"JavaScript","_id":"clhkizgyp003d3y0q7m4e9bci"}]}}