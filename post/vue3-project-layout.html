

<!DOCTYPE html>
<html lang="zh-CN" data-default-color-scheme=auto>



<head>
  <meta charset="UTF-8">
  <link rel="apple-touch-icon" sizes="76x76" href="/img/favicon.png">
  <link rel="icon" href="/img/favicon.png">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, shrink-to-fit=no">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  
  <meta name="theme-color" content="#2f4154">
  <meta name="author" content="Hello_AlexCc">
  <meta name="keywords" content="Full stack engineer">
  
    <meta name="description" content="layout架构实现，包括动态菜单栏、动态的面包屑等方案、侧边栏伸缩动画、退出的通用逻辑封装以及Vue3.2版本中的组件状态驱动的动态 CSS 值等等。">
<meta property="og:type" content="article">
<meta property="og:title" content="Vue3项目实战(四)：Layout架构实现">
<meta property="og:url" content="http://yoursite.com/post/vue3-project-layout.html">
<meta property="og:site_name" content="Hello_AlexCc">
<meta property="og:description" content="layout架构实现，包括动态菜单栏、动态的面包屑等方案、侧边栏伸缩动画、退出的通用逻辑封装以及Vue3.2版本中的组件状态驱动的动态 CSS 值等等。">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="http://yoursite.com/img/layout.png">
<meta property="article:published_time" content="2022-12-24T07:00:48.000Z">
<meta property="article:modified_time" content="2024-06-11T08:52:17.355Z">
<meta property="article:author" content="Hello_AlexCc">
<meta property="article:tag" content="工程化,Vue3">
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:image" content="http://yoursite.com/img/layout.png">
  
  
  <title>Vue3项目实战(四)：Layout架构实现 - Hello_AlexCc</title>

  <link  rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4/dist/css/bootstrap.min.css" />


  <link  rel="stylesheet" href="https://cdn.jsdelivr.net/npm/github-markdown-css@4/github-markdown.min.css" />
  <link  rel="stylesheet" href="https://cdn.jsdelivr.net/npm/hint.css@2/hint.min.css" />

  
    
    
      
      <link  rel="stylesheet" href="https://cdn.jsdelivr.net/npm/highlight.js@10/styles/github-gist.min.css" />
    
  

  
    <link  rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3/dist/jquery.fancybox.min.css" />
  


<!-- 主题依赖的图标库，不要自行修改 -->

<link rel="stylesheet" href="//at.alicdn.com/t/font_1749284_ba1fz6golrf.css">



<link rel="stylesheet" href="//at.alicdn.com/t/font_1736178_lbnruvf0jn.css">


<link  rel="stylesheet" href="/css/main.css" />

<!-- 自定义样式保持在最底部 -->


  <script id="fluid-configs">
    var Fluid = window.Fluid || {};
    var CONFIG = {"hostname":"yoursite.com","root":"/","version":"1.8.14","typing":{"enable":true,"typeSpeed":70,"cursorChar":"_","loop":false},"anchorjs":{"enable":true,"element":"h1,h2,h3,h4,h5,h6","placement":"right","visible":"hover","icon":""},"progressbar":{"enable":true,"height_px":3,"color":"#29d","options":{"showSpinner":false,"trickleSpeed":100}},"copy_btn":true,"image_zoom":{"enable":true,"img_url_replace":["",""]},"toc":{"enable":true,"headingSelector":"h1,h2,h3,h4,h5,h6","collapseDepth":0},"lazyload":{"enable":true,"loading_img":"/img/loading.gif","onlypost":false,"offset_factor":2},"web_analytics":{"enable":false,"baidu":null,"google":null,"gtag":null,"tencent":{"sid":null,"cid":null},"woyaola":null,"cnzz":null,"leancloud":{"app_id":null,"app_key":null,"server_url":null,"path":"window.location.pathname","ignore_local":false}},"search_path":"/local-search.xml"};
  </script>
  <script  src="/js/utils.js" ></script>
  <script  src="/js/color-schema.js" ></script>
<meta name="generator" content="Hexo 6.1.0"></head>


<body>
  <header style="height: 70vh;">
    <nav id="navbar" class="navbar fixed-top  navbar-expand-lg navbar-dark scrolling-navbar">
  <div class="container">
    <a class="navbar-brand" href="/">
      <strong>Hello_AlexCc</strong>
    </a>

    <button id="navbar-toggler-btn" class="navbar-toggler" type="button" data-toggle="collapse"
            data-target="#navbarSupportedContent"
            aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
      <div class="animated-icon"><span></span><span></span><span></span></div>
    </button>

    <!-- Collapsible content -->
    <div class="collapse navbar-collapse" id="navbarSupportedContent">
      <ul class="navbar-nav ml-auto text-center">
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/">
                <i class="iconfont icon-home-fill"></i>
                首页
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/archives/">
                <i class="iconfont icon-archive-fill"></i>
                归档
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/categories/">
                <i class="iconfont icon-category-fill"></i>
                分类
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/tags/">
                <i class="iconfont icon-tags-fill"></i>
                标签
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/about/">
                <i class="iconfont icon-user-fill"></i>
                关于
              </a>
            </li>
          
        
        
          <li class="nav-item" id="search-btn">
            <a class="nav-link" target="_self" href="javascript:;" data-toggle="modal" data-target="#modalSearch" aria-label="Search">
              &nbsp;<i class="iconfont icon-search"></i>&nbsp;
            </a>
          </li>
        
        
          <li class="nav-item" id="color-toggle-btn">
            <a class="nav-link" target="_self" href="javascript:;" aria-label="Color Toggle">&nbsp;<i
                class="iconfont icon-dark" id="color-toggle-icon"></i>&nbsp;</a>
          </li>
        
      </ul>
    </div>
  </div>
</nav>

    <div class="banner" id="banner" parallax=true
         style="background: url('/img/layout.png') no-repeat center center;
           background-size: cover;">
      <div class="full-bg-img">
        <div class="mask flex-center" style="background-color: rgba(0, 0, 0, 0.3)">
          <div class="page-header text-center fade-in-up">
            <span class="h2" id="subtitle" title="Vue3项目实战(四)：Layout架构实现">
              
            </span>

            
              <div class="mt-3">
  
  
    <span class="post-meta">
      <i class="iconfont icon-date-fill" aria-hidden="true"></i>
      <time datetime="2022-12-24 15:00" pubdate>
        2022年12月24日 下午
      </time>
    </span>
  
</div>

<div class="mt-1">
  
    <span class="post-meta mr-2">
      <i class="iconfont icon-chart"></i>
      35k 字
    </span>
  

  
    <span class="post-meta mr-2">
      <i class="iconfont icon-clock-fill"></i>
      
      
      289 分钟
    </span>
  

  
  
</div>

            
          </div>

          
        </div>
      </div>
    </div>
  </header>

  <main>
    
      

<div class="container-fluid nopadding-x">
  <div class="row nomargin-x">
    <div class="d-none d-lg-block col-lg-2"></div>
    <div class="col-lg-8 nopadding-x-md">
      <div class="container nopadding-x-md" id="board-ctn">
        <div class="py-5" id="board">
          <article class="post-content mx-auto">
            <!-- SEO header -->
            <h1 style="display: none">Vue3项目实战(四)：Layout架构实现</h1>
            
            <div class="markdown-body">
              <h1 id="实现-layout-布局"><a href="#实现-layout-布局" class="headerlink" title="实现 layout 布局"></a>实现 layout 布局</h1><p>首先，我们要改造 <code>layout/index.vue</code>，先定义好结构，然后写样式即可。</p>
<figure class="highlight html"><table><tr><td class="gutter"><div class="code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></div></td><td class="code"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;app-wrapper&quot;</span>&gt;</span><br>  <span class="hljs-comment">&lt;!-- 左侧 menu --&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">siderbar</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;sidebar-container&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">siderbar</span>&gt;</span><br><br>  <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;main-container&quot;</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;fixed-header&quot;</span>&gt;</span><br>      <span class="hljs-comment">&lt;!-- 顶部 --&gt;</span><br>      <span class="hljs-tag">&lt;<span class="hljs-name">nav-bar</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">nav-bar</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br><br>    <span class="hljs-comment">&lt;!-- 主要内容 --&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">app-main</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">app-main</span>&gt;</span><br>  <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br></code></pre></td></tr></table></figure>

<p>结构定义好了，我再定义样式以及样式文件。在 <code>src</code> 下创建 <code>styles</code> 文件夹，主要存放 <code>scss</code> 的一些样式文件，其中就包括通用的 <code>reset.scss</code> 文件，处理基础的 html 元素样式。<code>mixin.scss</code> 编写通用的样式表，定义通用的样式变量 <code>variables.scss</code>。</p>
<figure class="highlight scss"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs scss"><span class="hljs-comment">// styles/index.scss</span><br><br><span class="hljs-keyword">@import</span> <span class="hljs-string">&#x27;./reset.scss&#x27;</span>;<br><span class="hljs-keyword">@import</span> <span class="hljs-string">&#x27;./variables.scss&#x27;</span>;<br><span class="hljs-keyword">@import</span> <span class="hljs-string">&#x27;./mixin.scss&#x27;</span>;<br><span class="hljs-keyword">@import</span> <span class="hljs-string">&#x27;./sidebar.scss&#x27;</span>;<br></code></pre></td></tr></table></figure>

<h2 id="scss-的使用技巧"><a href="#scss-的使用技巧" class="headerlink" title="scss 的使用技巧"></a>scss 的使用技巧</h2><p>这里我们主要看下 <code>mixin.scss</code> 和 <code>variables.scss</code> 的一些技巧和用法：</p>
<ul>
<li>mixin.scss</li>
</ul>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><code class="hljs css"><span class="hljs-comment">/* 清除浮动，在 .vue 文件中使用的时候直接引用即可：@include clearfix; */</span><br><span class="hljs-keyword">@mixin</span> clearfix &#123;<br>  &amp;<span class="hljs-selector-pseudo">:after</span> &#123;<br>    <span class="hljs-attribute">content</span>: <span class="hljs-string">&#x27;&#x27;</span>;<br>    <span class="hljs-attribute">display</span>: table;<br>    <span class="hljs-attribute">clear</span>: both;<br>  &#125;<br>&#125;<br><br><span class="hljs-comment">/* 滚动条的设置 */</span><br><span class="hljs-keyword">@mixin</span> scrollBar &#123;<br>  &amp;::-webkit-scrollbar-track-piece &#123;<br>    <span class="hljs-attribute">background</span>: <span class="hljs-number">#d3dce6</span>;<br>  &#125;<br><br>  &amp;::-webkit-scrollbar &#123;<br>    <span class="hljs-attribute">width</span>: <span class="hljs-number">6px</span>;<br>  &#125;<br><br>  &amp;::-webkit-scrollbar-thumb &#123;<br>    <span class="hljs-attribute">background</span>: <span class="hljs-number">#99a9bf</span>;<br>    <span class="hljs-attribute">border-radius</span>: <span class="hljs-number">20px</span>;<br>  &#125;<br>&#125;<br><br><span class="hljs-keyword">@mixin</span> relative &#123;<br>  <span class="hljs-attribute">position</span>: relative;<br>  <span class="hljs-attribute">width</span>: <span class="hljs-number">100%</span>;<br>  <span class="hljs-attribute">height</span>: <span class="hljs-number">100%</span>;<br>&#125;<br><br><br></code></pre></td></tr></table></figure>
<ul>
<li>variables.scss</li>
</ul>
<figure class="highlight scss"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><code class="hljs scss"><span class="hljs-comment">// sidebar</span><br><span class="hljs-variable">$menuText</span>: <span class="hljs-number">#bfcbd9</span>;<br><span class="hljs-variable">$menuActiveText</span>: <span class="hljs-number">#ffffff</span>;<br><span class="hljs-variable">$subMenuActiveText</span>: <span class="hljs-number">#f4f4f5</span>;<br><br><span class="hljs-variable">$menuBg</span>: <span class="hljs-number">#304156</span>;<br><span class="hljs-variable">$menuHover</span>: <span class="hljs-number">#263445</span>;<br><br><span class="hljs-variable">$subMenuBg</span>: <span class="hljs-number">#1f2d3d</span>;<br><span class="hljs-variable">$subMenuHover</span>: <span class="hljs-number">#001528</span>;<br><br><span class="hljs-variable">$sideBarWidth</span>: <span class="hljs-number">210px</span>;<br><span class="hljs-variable">$hideSideBarWidth</span>: <span class="hljs-number">54px</span>;<br><span class="hljs-variable">$sideBarDuration</span>: <span class="hljs-number">0.28s</span>;<br><br><span class="hljs-comment">// https://www.bluematador.com/blog/how-to-share-variables-between-js-and-sass</span><br><span class="hljs-comment">// JS 与 scss 共享变量，在 scss 中通过 :export 进行导出，在 js 中可通过 ESM 进行导入</span><br>:export &#123;<br>  menuText: <span class="hljs-variable">$menuText</span>;<br>  menuActiveText: <span class="hljs-variable">$menuActiveText</span>;<br>  subMenuActiveText: <span class="hljs-variable">$subMenuActiveText</span>;<br>  menuBg: <span class="hljs-variable">$menuBg</span>;<br>  menuHover: <span class="hljs-variable">$menuHover</span>;<br>  subMenuBg: <span class="hljs-variable">$subMenuBg</span>;<br>  subMenuHover: <span class="hljs-variable">$subMenuHover</span>;<br>  sideBarWidth: <span class="hljs-variable">$sideBarWidth</span>;<br>&#125;<br><br></code></pre></td></tr></table></figure>

<p>关于 <code>:export</code> 的使用方式，我们可以查阅一些文档：</p>
<blockquote>
<p><a target="_blank" rel="noopener" href="https://www.bluematador.com/blog/how-to-share-variables-between-js-and-sass">https://www.bluematador.com/blog/how-to-share-variables-between-js-and-sass</a></p>
</blockquote>
<h2 id="编写-layout-index-vue-样式"><a href="#编写-layout-index-vue-样式" class="headerlink" title="编写 layout/index.vue 样式"></a>编写 <code>layout/index.vue</code> 样式</h2><figure class="highlight scss"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs scss">&lt;style lang=&quot;scss&quot; scoped&gt;<br><span class="hljs-keyword">@import</span> <span class="hljs-string">&#x27;~@/styles/mixin.scss&#x27;</span>;<br><span class="hljs-keyword">@import</span> <span class="hljs-string">&#x27;~@/styles/variables.scss&#x27;</span>;<br><br><span class="hljs-selector-class">.app-wrapper</span> &#123;<br>  <span class="hljs-keyword">@include</span> clearfix; <span class="hljs-comment">// 使用 mixin 中的样式</span><br>  <span class="hljs-attribute">position</span>: relative;<br>  <span class="hljs-attribute">height</span>: <span class="hljs-number">100%</span>;<br>  <span class="hljs-attribute">width</span>: <span class="hljs-number">100%</span>;<br>&#125;<br><br><span class="hljs-selector-class">.fixed-header</span> &#123;<br>  <span class="hljs-attribute">position</span>: fixed;<br>  <span class="hljs-attribute">top</span>: <span class="hljs-number">0</span>;<br>  <span class="hljs-attribute">right</span>: <span class="hljs-number">0</span>;<br>  <span class="hljs-attribute">z-index</span>: <span class="hljs-number">9</span>;<br>  <span class="hljs-attribute">width</span>: calc(<span class="hljs-number">100%</span> - #&#123;<span class="hljs-variable">$sideBarWidth</span>&#125;);<br>&#125;<br>&lt;/style&gt;<br></code></pre></td></tr></table></figure>

<h2 id="给-SideBar-赋予动态的背景色"><a href="#给-SideBar-赋予动态的背景色" class="headerlink" title="给 SideBar 赋予动态的背景色"></a>给 SideBar 赋予动态的背景色</h2><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs js">&lt;template&gt;<br>...<br>  &lt;!-- 左侧 menu --&gt;<br>  <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">sidebar</span></span></span><br><span class="hljs-tag"><span class="language-xml">    <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;sidebar-container&quot;</span></span></span><br><span class="hljs-tag"><span class="language-xml">    <span class="hljs-attr">:style</span>=<span class="hljs-string">&quot;&#123; backgroundColor: variables.menuBg &#125;&quot;</span></span></span><br><span class="hljs-tag"><span class="language-xml">  /&gt;</span></span><br>...<br>&lt;/template&gt;<br><br><span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">setup</span>&gt;</span><span class="language-javascript"></span></span><br><span class="language-javascript"><span class="language-xml"><span class="hljs-comment">// scss 通过 :export 导出了变量</span></span></span><br><span class="language-javascript"><span class="language-xml"><span class="hljs-keyword">import</span> variables <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;@/styles/variables.scss&#x27;</span></span></span><br><span class="language-javascript"><span class="language-xml"></span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span></span><br></code></pre></td></tr></table></figure>

<h2 id="script导入scss文件报错"><a href="#script导入scss文件报错" class="headerlink" title="script导入scss文件报错"></a>script导入scss文件报错</h2><p>在 vue 项目里引用.scss文件，vscode编辑器会有红色波浪线，提示找不到模块</p>
<p><img src="/img/import-scss-error.png" srcset="/img/loading.gif" lazyload alt=""></p>
<p>找到 <code>shims-vue.d.ts</code> 声明文件，添加如下代码:</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs js">declare <span class="hljs-variable language_">module</span> <span class="hljs-string">&#x27;*.scss&#x27;</span> &#123;<br>  <span class="hljs-keyword">const</span> <span class="hljs-attr">css</span>: &#123;<br>    <span class="hljs-comment">// 定义的变量，通过 `variables.menuBg` 取值时，就不会报错了</span><br>    <span class="hljs-attr">menuBg</span>: string;<br>  &#125;<br>  <span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> css<br>&#125;<br></code></pre></td></tr></table></figure>

<p>将来，新增了新的样式变量，我们在 css 下添加即可。</p>
<h2 id="设置NavBar样式和头像布局"><a href="#设置NavBar样式和头像布局" class="headerlink" title="设置NavBar样式和头像布局"></a>设置NavBar样式和头像布局</h2><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br></pre></td><td class="code"><pre><code class="hljs js">&lt;template&gt;<br>  <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;navbar&quot;</span>&gt;</span></span><br><span class="language-xml">    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;right-menu&quot;</span>&gt;</span></span><br><span class="language-xml">      <span class="hljs-tag">&lt;<span class="hljs-name">el-dropdown</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;avatar-container&quot;</span> <span class="hljs-attr">trigger</span>=<span class="hljs-string">&quot;click&quot;</span>&gt;</span></span><br><span class="language-xml">        <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;avatar-wrapper&quot;</span>&gt;</span></span><br><span class="language-xml">          <span class="hljs-tag">&lt;<span class="hljs-name">el-avatar</span></span></span><br><span class="hljs-tag"><span class="language-xml">            <span class="hljs-attr">shape</span>=<span class="hljs-string">&quot;square&quot;</span></span></span><br><span class="hljs-tag"><span class="language-xml">            <span class="hljs-attr">:size</span>=<span class="hljs-string">&quot;40&quot;</span></span></span><br><span class="hljs-tag"><span class="language-xml">            <span class="hljs-attr">:src</span>=<span class="hljs-string">&quot;&#x27;https://fuss10.elemecdn.com/e/5d/4a731a90594a4af544c0c25941171jpeg.jpeg&#x27;&quot;</span></span></span><br><span class="hljs-tag"><span class="language-xml">          &gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">el-avatar</span>&gt;</span></span><br><span class="language-xml">          <span class="hljs-tag">&lt;<span class="hljs-name">el-icon</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">Tools</span> /&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">el-icon</span>&gt;</span></span><br><span class="language-xml">        <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span><br><span class="language-xml">        <span class="hljs-tag">&lt;<span class="hljs-name">template</span> #<span class="hljs-attr">dropdown</span>&gt;</span></span><br><span class="language-xml">          <span class="hljs-tag">&lt;<span class="hljs-name">el-dropdown-menu</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;user-dropdown&quot;</span>&gt;</span></span><br><span class="language-xml">            <span class="hljs-tag">&lt;<span class="hljs-name">router-link</span> <span class="hljs-attr">to</span>=<span class="hljs-string">&quot;/&quot;</span>&gt;</span></span><br><span class="language-xml">              <span class="hljs-tag">&lt;<span class="hljs-name">el-dropdown-item</span>&gt;</span> 主页 <span class="hljs-tag">&lt;/<span class="hljs-name">el-dropdown-item</span>&gt;</span></span><br><span class="language-xml">            <span class="hljs-tag">&lt;/<span class="hljs-name">router-link</span>&gt;</span></span><br><span class="language-xml">            <span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">target</span>=<span class="hljs-string">&quot;_blank&quot;</span> <span class="hljs-attr">href</span>=<span class="hljs-string">&quot;&quot;</span>&gt;</span></span><br><span class="language-xml">              <span class="hljs-tag">&lt;<span class="hljs-name">el-dropdown-item</span>&gt;</span>Vue3<span class="hljs-tag">&lt;/<span class="hljs-name">el-dropdown-item</span>&gt;</span></span><br><span class="language-xml">            <span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span></span><br><span class="language-xml">            <span class="hljs-tag">&lt;<span class="hljs-name">el-dropdown-item</span> <span class="hljs-attr">divided</span>&gt;</span> 退出 <span class="hljs-tag">&lt;/<span class="hljs-name">el-dropdown-item</span>&gt;</span></span><br><span class="language-xml">          <span class="hljs-tag">&lt;/<span class="hljs-name">el-dropdown-menu</span>&gt;</span></span><br><span class="language-xml">        <span class="hljs-tag">&lt;/<span class="hljs-name">template</span>&gt;</span></span><br><span class="language-xml">      <span class="hljs-tag">&lt;/<span class="hljs-name">el-dropdown</span>&gt;</span></span><br><span class="language-xml">    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span><br><span class="language-xml">  <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span><br>&lt;/template&gt;<br><br><span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">setup</span> <span class="hljs-attr">lang</span>=<span class="hljs-string">&quot;ts&quot;</span>&gt;</span><span class="language-javascript"></span></span><br><span class="language-javascript"><span class="language-xml"><span class="hljs-keyword">import</span> &#123; ref, reactive &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;vue&#x27;</span></span></span><br><span class="language-javascript"><span class="language-xml"><span class="hljs-keyword">import</span> &#123; <span class="hljs-title class_">Tools</span> &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;@element-plus/icons-vue&#x27;</span></span></span><br><span class="language-javascript"><span class="language-xml"></span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span></span><br><span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">style</span> <span class="hljs-attr">scoped</span> <span class="hljs-attr">lang</span>=<span class="hljs-string">&quot;scss&quot;</span>&gt;</span><span class="language-css"></span></span><br><span class="language-css"><span class="language-xml"><span class="hljs-selector-class">.navbar</span> &#123;</span></span><br><span class="language-css"><span class="language-xml">  <span class="hljs-attribute">height</span>: <span class="hljs-number">50px</span>;</span></span><br><span class="language-css"><span class="language-xml">  <span class="hljs-attribute">overflow</span>: hidden;</span></span><br><span class="language-css"><span class="language-xml">  <span class="hljs-attribute">position</span>: relative;</span></span><br><span class="language-css"><span class="language-xml">  <span class="hljs-attribute">background</span>: <span class="hljs-number">#fff</span>;</span></span><br><span class="language-css"><span class="language-xml">  <span class="hljs-attribute">box-shadow</span>: <span class="hljs-number">0</span> <span class="hljs-number">1px</span> <span class="hljs-number">4px</span> <span class="hljs-built_in">rgba</span>(<span class="hljs-number">0</span>, <span class="hljs-number">21</span>, <span class="hljs-number">41</span>, <span class="hljs-number">0.08</span>);</span></span><br><span class="language-css"><span class="language-xml"></span></span><br><span class="language-css"><span class="language-xml">  <span class="hljs-selector-class">.right-menu</span> &#123;</span></span><br><span class="language-css"><span class="language-xml">    <span class="hljs-attribute">display</span>: flex;</span></span><br><span class="language-css"><span class="language-xml">    <span class="hljs-attribute">align-items</span>: center;</span></span><br><span class="language-css"><span class="language-xml">    <span class="hljs-attribute">float</span>: right;</span></span><br><span class="language-css"><span class="language-xml">    <span class="hljs-attribute">padding-right</span>: <span class="hljs-number">16px</span>;</span></span><br><span class="language-css"><span class="language-xml"></span></span><br><span class="language-css"><span class="language-xml">    ::v-deep .right-menu-item &#123;</span></span><br><span class="language-css"><span class="language-xml">      <span class="hljs-attribute">display</span>: inline-block;</span></span><br><span class="language-css"><span class="language-xml">      <span class="hljs-attribute">padding</span>: <span class="hljs-number">0</span> <span class="hljs-number">18px</span> <span class="hljs-number">0</span> <span class="hljs-number">0</span>;</span></span><br><span class="language-css"><span class="language-xml">      <span class="hljs-attribute">font-size</span>: <span class="hljs-number">24px</span>;</span></span><br><span class="language-css"><span class="language-xml">      <span class="hljs-attribute">color</span>: <span class="hljs-number">#5a5e66</span>;</span></span><br><span class="language-css"><span class="language-xml">      <span class="hljs-attribute">vertical-align</span>: text-bottom;</span></span><br><span class="language-css"><span class="language-xml"></span></span><br><span class="language-css"><span class="language-xml">      &amp;<span class="hljs-selector-class">.hover-effect</span> &#123;</span></span><br><span class="language-css"><span class="language-xml">        <span class="hljs-attribute">cursor</span>: pointer;</span></span><br><span class="language-css"><span class="language-xml">        <span class="hljs-attribute">transition</span>: background <span class="hljs-number">0.3s</span>;</span></span><br><span class="language-css"><span class="language-xml"></span></span><br><span class="language-css"><span class="language-xml">        &amp;<span class="hljs-selector-pseudo">:hover</span> &#123;</span></span><br><span class="language-css"><span class="language-xml">          <span class="hljs-attribute">background</span>: <span class="hljs-built_in">rgba</span>(<span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0.025</span>);</span></span><br><span class="language-css"><span class="language-xml">        &#125;</span></span><br><span class="language-css"><span class="language-xml">      &#125;</span></span><br><span class="language-css"><span class="language-xml">    &#125;</span></span><br><span class="language-css"><span class="language-xml"></span></span><br><span class="language-css"><span class="language-xml">    ::v-deep .avatar-container &#123;</span></span><br><span class="language-css"><span class="language-xml">      <span class="hljs-attribute">cursor</span>: pointer;</span></span><br><span class="language-css"><span class="language-xml">      <span class="hljs-selector-class">.avatar-wrapper</span> &#123;</span></span><br><span class="language-css"><span class="language-xml">        <span class="hljs-attribute">margin-top</span>: <span class="hljs-number">5px</span>;</span></span><br><span class="language-css"><span class="language-xml">        <span class="hljs-attribute">position</span>: relative;</span></span><br><span class="language-css"><span class="language-xml">        <span class="hljs-selector-class">.el-avatar</span> &#123;</span></span><br><span class="language-css"><span class="language-xml">          <span class="hljs-attr">--el-avatar-background-color</span>: none;</span></span><br><span class="language-css"><span class="language-xml">          <span class="hljs-attribute">margin-right</span>: <span class="hljs-number">12px</span>;</span></span><br><span class="language-css"><span class="language-xml">        &#125;</span></span><br><span class="language-css"><span class="language-xml">      &#125;</span></span><br><span class="language-css"><span class="language-xml">    &#125;</span></span><br><span class="language-css"><span class="language-xml">  &#125;</span></span><br><span class="language-css"><span class="language-xml">&#125;</span></span><br><span class="language-css"><span class="language-xml"></span><span class="hljs-tag">&lt;/<span class="hljs-name">style</span>&gt;</span></span><br></code></pre></td></tr></table></figure>

<h2 id="效果图"><a href="#效果图" class="headerlink" title="效果图"></a>效果图</h2><p><img src="/img/layout-base.png" srcset="/img/loading.gif" lazyload alt=""></p>
<h1 id="获取用户信息"><a href="#获取用户信息" class="headerlink" title="获取用户信息"></a>获取用户信息</h1><p>到目前为止，头像是静态的，也没有实现登出的逻辑，现在来实现一下。</p>
<h2 id="设置请求头"><a href="#设置请求头" class="headerlink" title="设置请求头"></a>设置请求头</h2><p>我们不希望每次调接口时，都去设置 <code>token</code>，那么我们可以在 <code>请求拦截器</code> 中去设置:</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs js">service.<span class="hljs-property">interceptors</span>.<span class="hljs-property">request</span>.<span class="hljs-title function_">use</span>(<br>  <span class="hljs-function"><span class="hljs-params">config</span> =&gt;</span> &#123;<br>    <span class="hljs-keyword">if</span> (store.<span class="hljs-property">getters</span>.<span class="hljs-property">token</span>) &#123;<br>      config.<span class="hljs-property">headers</span>.<span class="hljs-property">Authorization</span> = <span class="hljs-string">`Baerer <span class="hljs-subst">$&#123;store.getters.token&#125;</span>`</span><br>    &#125;<br><br>    <span class="hljs-keyword">return</span> config<br>  &#125;,<br>  <span class="hljs-function"><span class="hljs-params">error</span> =&gt;</span> &#123;<br>    <span class="hljs-keyword">return</span> <span class="hljs-title class_">Promise</span>.<span class="hljs-title function_">reject</span>(error)<br>  &#125;<br>)<br></code></pre></td></tr></table></figure>

<h2 id="编写-userInfo-接口"><a href="#编写-userInfo-接口" class="headerlink" title="编写 userInfo 接口"></a>编写 userInfo 接口</h2><p>简单实现一下 <code>/userinfo</code> 接口，主要是模拟前后端联调的流程。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">const</span> express = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;express&#x27;</span>);<br><span class="hljs-keyword">const</span> app = <span class="hljs-title function_">express</span>()<br><br>app.<span class="hljs-title function_">get</span>(<span class="hljs-string">&#x27;/userinfo&#x27;</span>, <span class="hljs-function">(<span class="hljs-params">req, res</span>) =&gt;</span> &#123;<br>  <span class="hljs-comment">// 存在 token，可以返回用户信息</span><br>  <span class="hljs-keyword">if</span> (req.<span class="hljs-property">headers</span>[<span class="hljs-string">&#x27;authorization&#x27;</span>]) &#123;<br><br>    res.<span class="hljs-title function_">json</span>(&#123;<br>      <span class="hljs-attr">code</span>: <span class="hljs-number">0</span>,<br>      <span class="hljs-attr">data</span>: &#123;<br>        <span class="hljs-attr">avatar</span>: <span class="hljs-string">&#x27;https://fuss10.elemecdn.com/e/5d/4a731a90594a4af544c0c25941171jpeg.jpeg&#x27;</span>,<br>        <span class="hljs-attr">name</span>: <span class="hljs-string">&#x27;Hello_AlexCc&#x27;</span>,<br>        <span class="hljs-attr">id</span>: <span class="hljs-number">1</span>,<br>        <span class="hljs-attr">role</span>: <span class="hljs-string">&#x27;super_admin&#x27;</span><br>      &#125;,<br>      <span class="hljs-attr">message</span>: <span class="hljs-string">&#x27;获取用户信息成功&#x27;</span>,<br>      <span class="hljs-attr">success</span>: <span class="hljs-literal">true</span>,<br>    &#125;)<br>  &#125;<br>&#125;)<br><br>app.<span class="hljs-title function_">listen</span>(<span class="hljs-number">9999</span>, <span class="hljs-function">() =&gt;</span> &#123;<br>  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&#x27;server site an port 9999 ...&#x27;</span>)<br>&#125;)<br></code></pre></td></tr></table></figure>

<h2 id="调用-userInfo-接口时机"><a href="#调用-userInfo-接口时机" class="headerlink" title="调用 userInfo 接口时机"></a>调用 userInfo 接口时机</h2><p>我们的 <code>userInfo</code> 接口已经编写好了，那么我们在什么时候调用呢？</p>
<p>很显然，我们需要在 <code>permission.ts</code> 中去调用，当用户登录才有 <code>token</code>，也就是说，我们可以在 <code>token</code> 存在时，并且 <code>to.path</code> 不等于 <code>/login</code> 的时候去调用用户信息接口。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">if</span> (store.<span class="hljs-property">getters</span>.<span class="hljs-property">token</span>) &#123;<br>  <span class="hljs-keyword">if</span> (to.<span class="hljs-property">path</span> === <span class="hljs-string">&#x27;/login&#x27;</span>) &#123;<br>    <span class="hljs-title function_">next</span>(<span class="hljs-string">&#x27;/&#x27;</span>)<br>  &#125; <span class="hljs-keyword">else</span> &#123;<br>    <span class="hljs-comment">// 调用用户信息接口</span><br>    <span class="hljs-keyword">await</span> store.<span class="hljs-title function_">dispatch</span>(<span class="hljs-string">&#x27;user/getUserInfo&#x27;</span>)<br><br>    <span class="hljs-title function_">next</span>()<br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<p>我们获取用户信息接口的动作，放在了 <code>module user</code> 的 <code>actions</code> 中：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-comment">// module/user.ts</span><br><br><span class="hljs-comment">// state</span><br><span class="hljs-attr">state</span>: <span class="hljs-function">() =&gt;</span> (&#123;<br>  <span class="hljs-attr">token</span>: <span class="hljs-title function_">getItem</span>(<span class="hljs-string">&#x27;token&#x27;</span>) || <span class="hljs-string">&#x27;&#x27;</span>,<br>  <span class="hljs-attr">userinfo</span>: &#123;&#125;<br>&#125;),<br><br><span class="hljs-comment">// actions</span><br><span class="hljs-keyword">async</span> <span class="hljs-title function_">getUserInfo</span>(<span class="hljs-params">context</span>) &#123;<br>  <span class="hljs-keyword">const</span> info = <span class="hljs-keyword">await</span> <span class="hljs-title function_">getUserInfo</span>()<br>  context.<span class="hljs-title function_">commit</span>(<span class="hljs-string">&#x27;setUserInfo&#x27;</span>, info)<br>  <span class="hljs-keyword">return</span> info<br>&#125;,<br></code></pre></td></tr></table></figure>

<p>方便使用 <code>userInfo</code>，我们可以将其放到 <code>getters</code> 中：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">const</span> getters = &#123;<br>  <span class="hljs-attr">token</span>: <span class="hljs-function">(<span class="hljs-params">state</span>) =&gt;</span> state.<span class="hljs-property">user</span>.<span class="hljs-property">token</span>,<br>  <span class="hljs-attr">userInfo</span>: <span class="hljs-function">(<span class="hljs-params">state</span>) =&gt;</span> state.<span class="hljs-property">user</span>.<span class="hljs-property">userinfo</span><br>&#125;<br></code></pre></td></tr></table></figure>

<p>最后，我们就能在 <code>NavBar</code> 使用获取到的用户信息了。</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">el-avatar</span></span><br><span class="hljs-tag">  <span class="hljs-attr">shape</span>=<span class="hljs-string">&quot;square&quot;</span></span><br><span class="hljs-tag">  <span class="hljs-attr">:size</span>=<span class="hljs-string">&quot;40&quot;</span></span><br><span class="hljs-tag">  <span class="hljs-attr">:src</span>=<span class="hljs-string">&quot;$store.getters.userInfo.avatar&quot;</span></span><br><span class="hljs-tag">&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">el-avatar</span>&gt;</span><br></code></pre></td></tr></table></figure>

<p><strong>避免重复调用 userInfo 接口</strong></p>
<p>我们发现，每次切换路由时，都会触发路由的前置守卫，从而多次触发 <code>getUserInfo</code> 接口，我们把这个问题解决一下</p>
<ol>
<li>在 store 中定义 <code>hasUserInfo</code>，用来判断是否已经有用户信息了，如果有用户信息，我们就不要再触发 <code>getUserInfo</code> 接口了</li>
</ol>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-comment">// getters.ts</span><br><br><span class="hljs-attr">hasUserInfo</span>: <span class="hljs-function">(<span class="hljs-params">state</span>) =&gt;</span> &#123;<br>  <span class="hljs-comment">// 如果用户信息存在，return true</span><br>  <span class="hljs-keyword">return</span> <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>(state.<span class="hljs-property">user</span>.<span class="hljs-property">userinfo</span>) !== <span class="hljs-string">&#x27;&#123;&#125;&#x27;</span><br>&#125;<br></code></pre></td></tr></table></figure>

<ol start="2">
<li>修改 <code>permission.ts</code> 文件，只有 <code>hasUserInfo</code> 为 <code>false</code> 时，我们才调用用户信息接口</li>
</ol>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">if</span> (store.<span class="hljs-property">getters</span>.<span class="hljs-property">token</span>) &#123;<br>  <span class="hljs-keyword">if</span> (to.<span class="hljs-property">path</span> === <span class="hljs-string">&#x27;/login&#x27;</span>) &#123;<br>    <span class="hljs-title function_">next</span>(<span class="hljs-string">&#x27;/&#x27;</span>)<br>  &#125; <span class="hljs-keyword">else</span> &#123;<br>    <span class="hljs-keyword">if</span> (!store.<span class="hljs-property">getters</span>.<span class="hljs-property">hasUserInfo</span>) &#123;<br>      <span class="hljs-keyword">await</span> store.<span class="hljs-title function_">dispatch</span>(<span class="hljs-string">&#x27;user/getUserInfo&#x27;</span>)<br>    &#125;<br><br>    <span class="hljs-title function_">next</span>()<br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<h1 id="登出逻辑"><a href="#登出逻辑" class="headerlink" title="登出逻辑"></a>登出逻辑</h1><p>登出分为两种形式：</p>
<ul>
<li>用户主动退出</li>
<li>用户被动登录（token 过去 | 账号被挤）</li>
</ul>
<p>不管以何种形式退出，登出的逻辑都是相同的。</p>
<ul>
<li>清理掉用户的缓存数据</li>
<li>清理掉权限相关的配置</li>
<li>返回到登录页</li>
</ul>
<p>登出的逻辑，我们也可以写在 <code>module user</code> 中去处理。</p>
<p>主要执行 3 个步骤：</p>
<ul>
<li>清空 store token</li>
<li>清除浏览器本地存储</li>
<li>跳转到 login 页</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-title function_">logout</span>(<span class="hljs-params">context: any</span>) &#123;<br>  context.<span class="hljs-title function_">commit</span>(<span class="hljs-string">&#x27;setToken&#x27;</span>, <span class="hljs-string">&#x27;&#x27;</span>)<br>  <span class="hljs-title function_">removeAllItem</span>()<br>  router.<span class="hljs-title function_">push</span>(<span class="hljs-string">&#x27;/login&#x27;</span>)<br>&#125;<br></code></pre></td></tr></table></figure>

<h2 id="主动退出"><a href="#主动退出" class="headerlink" title="主动退出"></a>主动退出</h2><p>用户点击登录按钮，通过 store dispatch 触发 action 的 logout 即可。</p>
<h2 id="被动退出"><a href="#被动退出" class="headerlink" title="被动退出"></a>被动退出</h2><p>被动退出大概分为两种：</p>
<ul>
<li>token 失效</li>
<li>账号被挤下去</li>
</ul>
<p>那么这两种场景下，在前端对应的处理方案一共也分为两种，共分为 主动处理 、被动处理 两种 ：</p>
<ul>
<li>主动处理：主要应对 token 失效</li>
<li>被动处理：同时应对 token 失效 与 单点登录（账号被挤）</li>
</ul>
<h3 id="用户被动退出解决方案之主动处理"><a href="#用户被动退出解决方案之主动处理" class="headerlink" title="用户被动退出解决方案之主动处理"></a>用户被动退出解决方案之主动处理</h3><p>为了保证用户的信息安全，那么对于 token 而言就被制定了很多的安全策略，比如：</p>
<ul>
<li>动态 token（可变 token）</li>
<li>刷新 token</li>
<li>时效 token<br>…</li>
</ul>
<p>我们这里采用 <code>时效 token</code>。</p>
<p>那么对应到我们代码中的实现方案为：</p>
<ul>
<li>在用户登陆时，记录当前 登录时间</li>
<li>制定一个 失效时长</li>
<li>在接口调用时，根据 <code>当前时间</code> 对比 <code>登录时间</code> ，看是否超过了 <code>时效时长</code><ul>
<li>如果未超过，则正常进行后续操作</li>
<li>如果超过，则进行 退出登录 操作</li>
</ul>
</li>
</ul>
<h3 id="代码实现"><a href="#代码实现" class="headerlink" title="代码实现"></a>代码实现</h3><p>创建 <code>utils/auth.js</code> 文件，并写入以下代码：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">import</span> &#123; <span class="hljs-variable constant_">TIME_STAMP</span>, <span class="hljs-variable constant_">TOKEN_TIMEOUT_VALUE</span> &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;@/constant&#x27;</span><br><span class="hljs-keyword">import</span> &#123; setItem, getItem &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;@/utils/storage&#x27;</span><br><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * 获取时间戳</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">export</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">getTimeStamp</span>(<span class="hljs-params"></span>) &#123;<br>  <span class="hljs-keyword">return</span> <span class="hljs-title function_">getItem</span>(<span class="hljs-variable constant_">TIME_STAMP</span>)<br>&#125;<br><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * 设置时间戳</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">export</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">setTimeStamp</span>(<span class="hljs-params"></span>) &#123;<br>  <span class="hljs-title function_">setItem</span>(<span class="hljs-variable constant_">TIME_STAMP</span>, <span class="hljs-title class_">Date</span>.<span class="hljs-title function_">now</span>())<br>&#125;<br><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * 是否超时</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">export</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">isCheckTimeout</span>(<span class="hljs-params"></span>) &#123;<br>  <span class="hljs-comment">// 当前时间戳</span><br>  <span class="hljs-keyword">var</span> currentTime = <span class="hljs-title class_">Date</span>.<span class="hljs-title function_">now</span>()<br>  <span class="hljs-comment">// 缓存时间戳</span><br>  <span class="hljs-keyword">var</span> timeStamp = <span class="hljs-title function_">getTimeStamp</span>()<br>  <span class="hljs-keyword">return</span> currentTime - timeStamp &gt; <span class="hljs-variable constant_">TOKEN_TIMEOUT_VALUE</span><br>&#125;<br></code></pre></td></tr></table></figure>

<p>在 <code>constant</code> 中声明对应常量：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-comment">// token 时间戳</span><br><span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> <span class="hljs-variable constant_">TIME_STAMP</span> = <span class="hljs-string">&#x27;timeStamp&#x27;</span><br><span class="hljs-comment">// 超时时长(毫秒) 两小时</span><br><span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> <span class="hljs-variable constant_">TOKEN_TIMEOUT_VALUE</span> = <span class="hljs-number">2</span> * <span class="hljs-number">60</span> * <span class="hljs-number">60</span> * <span class="hljs-number">1000</span><br></code></pre></td></tr></table></figure>

<p>在用户登录成功之后去设置时间，到 <code>store/user.js</code> 的 <code>login</code> 中：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">import</span> &#123; setTimeStamp &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;@/utils/auth&#x27;</span><br><br><span class="hljs-title function_">login</span>(<span class="hljs-params">context, userInfo</span>) &#123;<br>  ...<br>  <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Promise</span>(<span class="hljs-function">(<span class="hljs-params">resolve, reject</span>) =&gt;</span> &#123;<br>    ...<br>      .<span class="hljs-title function_">then</span>(<span class="hljs-function"><span class="hljs-params">data</span> =&gt;</span> &#123;<br>        ...<br>        <span class="hljs-comment">// 保存登录时间</span><br>        <span class="hljs-title function_">setTimeStamp</span>()<br>        <span class="hljs-title function_">resolve</span>()<br>      &#125;)<br>  &#125;)<br>&#125;,<br></code></pre></td></tr></table></figure>

<p>在 <code>utils/request</code> 对应的请求拦截器中进行 <strong>主动介入</strong></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">import</span> &#123; isCheckTimeout &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;@/utils/auth&#x27;</span><br><br><span class="hljs-keyword">if</span> (store.<span class="hljs-property">getters</span>.<span class="hljs-property">token</span>) &#123;<br>  <span class="hljs-keyword">if</span> (<span class="hljs-title function_">isCheckTimeout</span>()) &#123;<br>    <span class="hljs-comment">// 登出操作</span><br>    store.<span class="hljs-title function_">dispatch</span>(<span class="hljs-string">&#x27;user/logout&#x27;</span>)<br><br>    <span class="hljs-comment">// 失败的话，会走到 interceptors.response 的 error 方法。</span><br>    <span class="hljs-keyword">return</span> <span class="hljs-title class_">Promise</span>.<span class="hljs-title function_">reject</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Error</span>(<span class="hljs-string">&#x27;token 失效&#x27;</span>))<br>  &#125;<br>  ...<br>&#125;<br></code></pre></td></tr></table></figure>

<p>那么至此我们就完成了 <strong>主动处理</strong> 对应的业务逻辑。</p>
<h3 id="用户被动退出解决方案之被动处理"><a href="#用户被动退出解决方案之被动处理" class="headerlink" title="用户被动退出解决方案之被动处理"></a>用户被动退出解决方案之被动处理</h3><p><strong>背景：</strong></p>
<p>首先我们需要先明确 <strong>被动处理</strong> 需要应对两种业务场景：</p>
<ol>
<li><code>token</code> 过期</li>
<li>单点登录</li>
</ol>
<p>然后我们一个一个来去看，首先是 <code>token</code> 过期</p>
<blockquote>
<p>我们知道对于 <code>token</code> 而言，本身就是具备时效的，这个是在服务端生成 <code>token</code> 时就已经确定的。</p>
<p>而此时我们所谓的 <code>token</code> 过期指的就是：</p>
<p><strong>服务端生成的 <code>token</code> 超过 服务端指定时效</strong> 的过程，就像我们前端项目指定 token 的失效性一样。</p>
</blockquote>
<p>而对于 单点登录 而言，指的是： </p>
<blockquote>
<p>当用户 A 登录之后，<code>token</code> 过期之前。</p>
<p> 用户 A 的账号在其他的设备中进行了二次登录，导致第一次登录的 A 账号被 “顶下来” 的过程。</p>
<p>即：<strong>同一账户仅可以在一个设备中保持在线状态</strong></p>
</blockquote>
<p>那么明确好了对应的背景之后，接下来我们来看对应的业务处理场景：</p>
<p>从背景中我们知道，以上的两种情况，都是在 <strong>服务端进行判断的</strong>，而对于前端而言其实是 <strong>服务端通知前端的一个过程。</strong></p>
<p>所以说对于其业务处理，将遵循以下逻辑：</p>
<ol>
<li>服务端返回数据时，会通过特定的状态码通知前端</li>
<li>当前端接收到特定状态码时，表示遇到了特定状态：<strong><code>token</code> 时效</strong> 或 <strong>单点登录</strong></li>
<li>此时进行 <strong>退出登录</strong> 处理</li>
</ol>
<p>这里只做了 token 的过期处理，如果需要到 <strong>单点登录</strong> 时，只需要增加一个状态码判断即可。</p>
<p><strong>服务端超时间逻辑</strong><br>我们来简单实现一下后端的超时逻辑。</p>
<p>我们通过 <code>app.use</code> 添加了一个中间件，每一次前端触发了接口请求，都会先走这个中间件逻辑。</p>
<p>服务器启动时，我们把 <code>now</code> 和 <code>current</code> 设置当前时间戳，当有一个接口触发了，会将 <code>current</code> 设置新的时间戳。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">const</span> express = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;express&#x27;</span>);<br><span class="hljs-keyword">const</span> app = <span class="hljs-title function_">express</span>()<br><br><span class="hljs-comment">// token 超时 2h</span><br><span class="hljs-keyword">const</span> <span class="hljs-variable constant_">TOKEN_TIMEOUT_VALUE</span> = <span class="hljs-number">2</span> * <span class="hljs-number">60</span> * <span class="hljs-number">60</span> * <span class="hljs-number">1000</span><br><span class="hljs-keyword">let</span> now = <span class="hljs-title class_">Date</span>.<span class="hljs-title function_">now</span>()<br><span class="hljs-keyword">let</span> current = <span class="hljs-title class_">Date</span>.<span class="hljs-title function_">now</span>()<br><br>app.<span class="hljs-title function_">use</span>(<span class="hljs-keyword">function</span>(<span class="hljs-params">req, res, next</span>) &#123;<br>  <span class="hljs-comment">// 每次有接口调用，触发中间件，将 current 更新</span><br>  current = <span class="hljs-title class_">Date</span>.<span class="hljs-title function_">now</span>()<br><br>  <span class="hljs-comment">// 如果是登录逻辑，我们将 now 设置为 current，这样就不会触发超时逻辑</span><br>  <span class="hljs-comment">// 重新登录，继续走此判断，将 now 设置为 current</span><br>  <span class="hljs-keyword">if</span> (req.<span class="hljs-property">path</span> === <span class="hljs-string">&#x27;/login&#x27;</span>) &#123;<br>    now = current<br>  &#125;<br><br>  <span class="hljs-comment">// 每次中间件都会将 current 更新为当前时间戳，一旦时间戳的差值，大于了 2h，就会触发 超时逻辑</span><br>  <span class="hljs-keyword">if</span> (current - now &gt; <span class="hljs-variable constant_">TOKEN_TIMEOUT_VALUE</span>) &#123;<br>    <span class="hljs-comment">// 超时</span><br>    res.<span class="hljs-title function_">status</span>(<span class="hljs-number">401</span>).<span class="hljs-title function_">send</span>(&#123;<br>      <span class="hljs-attr">code</span>: <span class="hljs-number">401</span>,<br>      <span class="hljs-attr">message</span>: <span class="hljs-string">&#x27;服务端message: token 失效啦&#x27;</span>,<br>      <span class="hljs-attr">success</span>: <span class="hljs-literal">false</span>,<br>    &#125;)<br>  &#125; <span class="hljs-keyword">else</span> &#123;<br><br>    <span class="hljs-comment">// 没有超时，将执行权交给下一个路由</span><br>    <span class="hljs-title function_">next</span>()<br>  &#125;<br>&#125;)<br></code></pre></td></tr></table></figure>


<p><strong>那么明确好了业务之后，接下来我们来实现前端对应代码：</strong></p>
<p>在 <code>utils/request</code> 的响应拦截器中，增加以下逻辑：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-comment">// 响应拦截器</span><br>service.<span class="hljs-property">interceptors</span>.<span class="hljs-property">response</span>.<span class="hljs-title function_">use</span>(<br>  <span class="hljs-function"><span class="hljs-params">response</span> =&gt;</span> &#123;<br>    ...<br>  &#125;,<br>  <span class="hljs-function"><span class="hljs-params">error</span> =&gt;</span> &#123;<br>    <span class="hljs-comment">// 处理 token 超时问题</span><br>    <span class="hljs-keyword">if</span> (<br>      error.<span class="hljs-property">response</span> &amp;&amp;<br>      error.<span class="hljs-property">response</span>.<span class="hljs-property">data</span> &amp;&amp;<br>      error.<span class="hljs-property">response</span>.<span class="hljs-property">data</span>.<span class="hljs-property">code</span> === <span class="hljs-number">401</span><br>    ) &#123;<br>      store.<span class="hljs-title function_">dispatch</span>(<span class="hljs-string">&#x27;user/logout&#x27;</span>)<br>    &#125;<br><br>    <span class="hljs-keyword">if</span> (error.<span class="hljs-property">response</span> &amp;&amp; error.<span class="hljs-property">response</span>.<span class="hljs-property">data</span> &amp;&amp; error.<span class="hljs-property">response</span>.<span class="hljs-property">data</span>.<span class="hljs-property">message</span>) &#123;<br>      <span class="hljs-title class_">ElMessage</span>.<span class="hljs-title function_">error</span>(error.<span class="hljs-property">response</span>.<span class="hljs-property">data</span>.<span class="hljs-property">message</span>) <span class="hljs-comment">// 提示服务端抛出的错误信息</span><br>    &#125; <span class="hljs-keyword">else</span> &#123;<br>      <span class="hljs-title class_">ElMessage</span>.<span class="hljs-title function_">error</span>(error.<span class="hljs-property">message</span>)<br>    &#125;<br>    <span class="hljs-keyword">return</span> <span class="hljs-title class_">Promise</span>.<span class="hljs-title function_">reject</span>(error)<br>  &#125;<br>)<br></code></pre></td></tr></table></figure>

<p>那么至此，我们就已经完成了 <strong>整个用户退出</strong> 方案。</p>
<h1 id="Sidebar-动态菜单"><a href="#Sidebar-动态菜单" class="headerlink" title="Sidebar 动态菜单"></a>Sidebar 动态菜单</h1><p>接下来我们来处理 动态menu菜单。</p>
<p>临时的 menu 菜单，创建 <code>layout/Sidebar/SidebarMenu</code> 文件</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><code class="hljs js">&lt;template&gt;<br>  &lt;!-- 一级 menu 菜单 --&gt;<br>  <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">el-menu</span></span></span><br><span class="hljs-tag"><span class="language-xml">    &#123;/* 只允许一个菜单展开 */&#125;</span></span><br><span class="hljs-tag"><span class="language-xml">    <span class="hljs-attr">:uniqueOpened</span>=<span class="hljs-string">&quot;true&quot;</span></span></span><br><span class="hljs-tag"><span class="language-xml">    <span class="hljs-attr">default-active</span>=<span class="hljs-string">&quot;1&quot;</span></span></span><br><span class="hljs-tag"><span class="language-xml">    <span class="hljs-attr">background-color</span>=<span class="hljs-string">&quot;#545c64&quot;</span></span></span><br><span class="hljs-tag"><span class="language-xml">    <span class="hljs-attr">text-color</span>=<span class="hljs-string">&quot;#fff&quot;</span></span></span><br><span class="hljs-tag"><span class="language-xml">    <span class="hljs-attr">active-text-color</span>=<span class="hljs-string">&quot;#ffd04b&quot;</span></span></span><br><span class="hljs-tag"><span class="language-xml">  &gt;</span></span><br><span class="language-xml">    <span class="hljs-comment">&lt;!-- 子集 menu 菜单 --&gt;</span></span><br><span class="language-xml">    <span class="hljs-tag">&lt;<span class="hljs-name">el-sub-menu</span> <span class="hljs-attr">index</span>=<span class="hljs-string">&quot;1&quot;</span>&gt;</span></span><br><span class="language-xml">      <span class="hljs-tag">&lt;<span class="hljs-name">template</span> #<span class="hljs-attr">title</span>&gt;</span></span><br><span class="language-xml">        <span class="hljs-tag">&lt;<span class="hljs-name">el-icon</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">location</span> /&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">el-icon</span>&gt;</span></span><br><span class="language-xml">        <span class="hljs-tag">&lt;<span class="hljs-name">span</span>&gt;</span>导航一<span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span></span><br><span class="language-xml">      <span class="hljs-tag">&lt;/<span class="hljs-name">template</span>&gt;</span></span><br><span class="language-xml">      <span class="hljs-tag">&lt;<span class="hljs-name">el-menu-item</span> <span class="hljs-attr">index</span>=<span class="hljs-string">&quot;1-1&quot;</span>&gt;</span>选项1<span class="hljs-tag">&lt;/<span class="hljs-name">el-menu-item</span>&gt;</span></span><br><span class="language-xml">      <span class="hljs-tag">&lt;<span class="hljs-name">el-menu-item</span> <span class="hljs-attr">index</span>=<span class="hljs-string">&quot;1-2&quot;</span>&gt;</span>选项2<span class="hljs-tag">&lt;/<span class="hljs-name">el-menu-item</span>&gt;</span></span><br><span class="language-xml">    <span class="hljs-tag">&lt;/<span class="hljs-name">el-sub-menu</span>&gt;</span></span><br><span class="language-xml">    <span class="hljs-comment">&lt;!-- 具体菜单项 --&gt;</span></span><br><span class="language-xml">    <span class="hljs-tag">&lt;<span class="hljs-name">el-menu-item</span> <span class="hljs-attr">index</span>=<span class="hljs-string">&quot;4&quot;</span>&gt;</span></span><br><span class="language-xml">      <span class="hljs-tag">&lt;<span class="hljs-name">el-icon</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">setting</span> /&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">el-icon</span>&gt;</span></span><br><span class="language-xml">      <span class="hljs-tag">&lt;<span class="hljs-name">template</span> #<span class="hljs-attr">title</span>&gt;</span>导航四<span class="hljs-tag">&lt;/<span class="hljs-name">template</span>&gt;</span></span><br><span class="language-xml">    <span class="hljs-tag">&lt;/<span class="hljs-name">el-menu-item</span>&gt;</span></span><br><span class="language-xml">  <span class="hljs-tag">&lt;/<span class="hljs-name">el-menu</span>&gt;</span></span><br>&lt;/template&gt;<br><br><span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">setup</span> <span class="hljs-attr">lang</span>=<span class="hljs-string">&quot;ts&quot;</span>&gt;</span><span class="language-javascript"></span></span><br><span class="language-javascript"><span class="language-xml"><span class="hljs-keyword">import</span> &#123; ref, reactive &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;vue&#x27;</span></span></span><br><span class="language-javascript"><span class="language-xml"><span class="hljs-keyword">import</span> &#123; <span class="hljs-title class_">Location</span>, <span class="hljs-title class_">Setting</span> &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;@element-plus/icons-vue&#x27;</span></span></span><br><span class="language-javascript"><span class="language-xml"></span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span></span><br><span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">style</span> <span class="hljs-attr">scoped</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">style</span>&gt;</span></span><br></code></pre></td></tr></table></figure>

<p>在 <code>layout/Sidebar/index</code> 中导入该组件</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs js">&lt;template&gt;<br>  <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;&quot;</span>&gt;</span></span><br><span class="language-xml">    <span class="hljs-tag">&lt;<span class="hljs-name">h1</span>&gt;</span>占位<span class="hljs-tag">&lt;/<span class="hljs-name">h1</span>&gt;</span></span><br><span class="language-xml">    <span class="hljs-tag">&lt;<span class="hljs-name">el-scrollbar</span>&gt;</span></span><br><span class="language-xml">      <span class="hljs-tag">&lt;<span class="hljs-name">sidebar-menu</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">sidebar-menu</span>&gt;</span></span><br><span class="language-xml">    <span class="hljs-tag">&lt;/<span class="hljs-name">el-scrollbar</span>&gt;</span></span><br><span class="language-xml">  <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span><br>&lt;/template&gt;<br><br><span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">setup</span>&gt;</span><span class="language-javascript"></span></span><br><span class="language-javascript"><span class="language-xml"><span class="hljs-keyword">import</span> <span class="hljs-title class_">SidebarMenu</span> <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;./SidebarMenu&#x27;</span></span></span><br><span class="language-javascript"><span class="language-xml"><span class="hljs-keyword">import</span> &#123;&#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;vue&#x27;</span></span></span><br><span class="language-javascript"><span class="language-xml"></span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span></span><br></code></pre></td></tr></table></figure>

<p>那么至此我们生成了一个临时的 <code>menu</code> 菜单，从这个临时的 <code>menu</code> 菜单出可以看到，<code>el-menu</code> 其实分成了三个部分：</p>
<ol>
<li><code>el-menu</code>：整个 <code>menu</code> 菜单</li>
<li><code>el-submenu</code>：子集 <code>menu</code> 菜单</li>
<li><code>el-menu-item</code>：具体菜单项</li>
</ol>
<p>那么明确好了这些内容之后，接下来我们就可以来去分析一下 <strong>动态 <code>menu</code> 菜单如何生成了</strong></p>
<h2 id="动态menu菜单处理方案解析"><a href="#动态menu菜单处理方案解析" class="headerlink" title="动态menu菜单处理方案解析"></a>动态menu菜单处理方案解析</h2><p><strong>动态<code>menu</code>菜单</strong> 其实主要是和 <strong>动态路由表</strong>  配合来去实现 <strong>用户权限</strong> 的。</p>
<p>但是 <strong>用户权限处理</strong> 目前还未涉及到，因为咱们想要处理 <strong>用户权限</strong> 还需要先去处理很多的业务场景，所以暂时先只处理 <strong>动态<code>menu</code>菜单</strong> 。</p>
<p>所谓 <strong>动态<code>menu</code>菜单</strong> 指的是：</p>
<blockquote>
<p>根据路由表的配置，自动生成对应的 <code>menu</code> 菜单。</p>
<p>当路由表发生变化时，<code>menu</code> 菜单自动发生变化</p>
</blockquote>
<p>那么明确了 <strong>动态<code>menu</code>菜单</strong> 的含义之后，接下来咱们就需要来明确 <strong>动态<code>menu</code>菜单</strong> 的实现方案：</p>
<ol>
<li>定义 <strong>路由表</strong> 对应 <strong><code>menu</code> 菜单规则</strong></li>
<li>根据规则制定 <strong>路由表</strong></li>
<li>根据规则，依据 <strong>路由表</strong> ，生成 <strong><code>menu</code> 菜单</strong></li>
</ol>
<p>那么根据我们的实现方案可以发现，实现 <strong>动态<code>menu</code>菜单</strong> 最核心的关键点其实就在步骤一，也就是 </p>
<blockquote>
<p>定义 <strong>路由表</strong> 对应 <strong><code>menu</code> 菜单规则</strong></p>
</blockquote>
<p>那么下面我们就来看一下，这个规则如何制定：</p>
<ol>
<li>对于单个路由规则而言（循环）：<ol>
<li>如果存在 <code>meta &amp;&amp; meta.title &amp;&amp; meta.icon</code> ：则显示在 <code>menu</code> 菜单中，其中 <code>title</code> 为显示的内容，<code>icon</code> 为显示的图标<ol>
<li>如果存在 <code>children</code> ：则以 <code>el-sub-menu（子菜单）</code> 展示</li>
<li>否则：则以 <code>el-menu-item（菜单项）</code> 展示</li>
</ol>
</li>
<li>否则：不显示在 <code>menu</code> 菜单中</li>
</ol>
</li>
</ol>
<p>那么明确好了对应的规则之后，接下来我们就可以来去看一下如何进行实现啦！</p>
<h2 id="生成项目页面组件"><a href="#生成项目页面组件" class="headerlink" title="生成项目页面组件"></a>生成项目页面组件</h2><p>明确了对应的方案之后，那么下面咱们就来实现对应的代码逻辑。</p>
<p>根据我们的分析，想要完成动态的 <code>menu</code>，那么我们需要按照以下的步骤来去实现：</p>
<ol>
<li>创建页面组件</li>
<li>生成路由表</li>
<li>解析路由表</li>
<li>生成 <code>menu</code> 菜单</li>
</ol>
<p>那么明确好了步骤之后，接下来我们就先来实现第一步</p>
<p><strong>创建页面组件</strong></p>
<p>在 <code>views</code> 文件夹下，创建如下页面：</p>
<ol>
<li>创建文章：<code>article-create</code></li>
<li>文章详情：<code>article-detail</code></li>
<li>文章排名：<code>article-ranking</code></li>
<li>错误页面：<code>error-page</code><ol>
<li><code>404</code></li>
<li><code>401</code></li>
</ol>
</li>
<li>导入：<code>import</code></li>
<li>权限列表：<code>permission-list</code></li>
<li>个人中心：<code>profile</code></li>
<li>角色列表：<code>role-list</code></li>
<li>用户信息：<code>user-info</code></li>
<li>用户管理：<code>user-manage</code></li>
</ol>
<h2 id="创建结构路由表"><a href="#创建结构路由表" class="headerlink" title="创建结构路由表"></a>创建结构路由表</h2><p>想要实现结构路由表，那么我们需要先知道最终我们要实现的结构是什么样子的，大家来看下面的截图：</p>
<img src="/img/menu.png" srcset="/img/loading.gif" lazyload />

<p>这是我们最终要实现的 <code>menu</code> 截图。</p>
<p>根据此截图，我们可以知道两点内容：</p>
<ol>
<li><p>我们创建的页面并没有全部进行展示</p>
<ol>
<li>不显示页面表示 <strong>不满足</strong> 该条件 <code>meta &amp;&amp; meta.title &amp;&amp; meta.icon</code></li>
</ol>
</li>
<li><p><code>menu</code> 菜单将具备父子级的结构</p>
<ol>
<li>按照此结构规划数据，则数据应为<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><code class="hljs json"><span class="hljs-punctuation">[</span><br>    <span class="hljs-punctuation">&#123;</span><br>        <span class="hljs-attr">&quot;title&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;个人中心&quot;</span><span class="hljs-punctuation">,</span><br>        <span class="hljs-attr">&quot;path&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;&quot;</span><br>    <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-punctuation">&#123;</span><br>        <span class="hljs-attr">&quot;title&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;用户&quot;</span><span class="hljs-punctuation">,</span><br>        <span class="hljs-attr">&quot;children&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><br>            <span class="hljs-punctuation">&#123;</span><br>                <span class="hljs-attr">&quot;title&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;员工管理&quot;</span><span class="hljs-punctuation">,</span><br>                <span class="hljs-attr">&quot;path&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;&quot;</span><br>            <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br>            <span class="hljs-punctuation">&#123;</span><br>                <span class="hljs-attr">&quot;title&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;角色列表&quot;</span><span class="hljs-punctuation">,</span><br>                <span class="hljs-attr">&quot;path&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;&quot;</span><br>            <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br>            <span class="hljs-punctuation">&#123;</span><br>                <span class="hljs-attr">&quot;title&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;权限列表&quot;</span><span class="hljs-punctuation">,</span><br>                <span class="hljs-attr">&quot;path&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;&quot;</span><br>            <span class="hljs-punctuation">&#125;</span><br>        <span class="hljs-punctuation">]</span><br>    <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-punctuation">&#123;</span><br>        <span class="hljs-attr">&quot;title&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;文章&quot;</span><span class="hljs-punctuation">,</span><br>        <span class="hljs-attr">&quot;children&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><br>            <span class="hljs-punctuation">&#123;</span><br>                <span class="hljs-attr">&quot;title&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;文章排名&quot;</span><span class="hljs-punctuation">,</span><br>                <span class="hljs-attr">&quot;path&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;&quot;</span><br>            <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br>            <span class="hljs-punctuation">&#123;</span><br>                <span class="hljs-attr">&quot;title&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;创建文章&quot;</span><span class="hljs-punctuation">,</span><br>                <span class="hljs-attr">&quot;path&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;&quot;</span><br>            <span class="hljs-punctuation">&#125;</span><br>        <span class="hljs-punctuation">]</span><br>    <span class="hljs-punctuation">&#125;</span><br><span class="hljs-punctuation">]</span><br></code></pre></td></tr></table></figure>

</li>
</ol>
</li>
</ol>
<p>又因为将来我们需要进行 <strong>用户权限处理</strong>，所以此时我们需要先对路由表进行一个划分：</p>
<ol>
<li>私有路由表 <code>privateRoutes</code> ：权限路由</li>
<li>公有路由表 <code>publicRoutes</code>：无权限路由</li>
</ol>
<p>根据以上理论，生成以下路由表结构：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * 私有路由表</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">const</span> privateRoutes = [<br>  &#123;<br>    <span class="hljs-attr">path</span>: <span class="hljs-string">&#x27;/user&#x27;</span>,<br>    <span class="hljs-attr">component</span>: layout,<br>    <span class="hljs-attr">redirect</span>: <span class="hljs-string">&#x27;/user/manage&#x27;</span>,<br>    <span class="hljs-attr">meta</span>: &#123;<br>      <span class="hljs-attr">title</span>: <span class="hljs-string">&#x27;user&#x27;</span>,<br>      <span class="hljs-attr">icon</span>: <span class="hljs-string">&#x27;personnel&#x27;</span><br>    &#125;,<br>    <span class="hljs-attr">children</span>: [<br>      &#123;<br>        <span class="hljs-attr">path</span>: <span class="hljs-string">&#x27;/user/manage&#x27;</span>,<br>        <span class="hljs-attr">component</span>: <span class="hljs-function">() =&gt;</span> <span class="hljs-title function_">import</span>(<span class="hljs-string">&#x27;@/views/user-manage/index&#x27;</span>),<br>        <span class="hljs-attr">meta</span>: &#123;<br>          <span class="hljs-attr">title</span>: <span class="hljs-string">&#x27;userManage&#x27;</span>,<br>          <span class="hljs-attr">icon</span>: <span class="hljs-string">&#x27;personnel-manage&#x27;</span><br>        &#125;<br>      &#125;,<br>      &#123;<br>        <span class="hljs-attr">path</span>: <span class="hljs-string">&#x27;/user/role&#x27;</span>,<br>        <span class="hljs-attr">component</span>: <span class="hljs-function">() =&gt;</span> <span class="hljs-title function_">import</span>(<span class="hljs-string">&#x27;@/views/role-list/index&#x27;</span>),<br>        <span class="hljs-attr">meta</span>: &#123;<br>          <span class="hljs-attr">title</span>: <span class="hljs-string">&#x27;roleList&#x27;</span>,<br>          <span class="hljs-attr">icon</span>: <span class="hljs-string">&#x27;role&#x27;</span><br>        &#125;<br>      &#125;,<br>      &#123;<br>        <span class="hljs-attr">path</span>: <span class="hljs-string">&#x27;/user/permission&#x27;</span>,<br>        <span class="hljs-attr">component</span>: <span class="hljs-function">() =&gt;</span> <span class="hljs-title function_">import</span>(<span class="hljs-string">&#x27;@/views/permission-list/index&#x27;</span>),<br>        <span class="hljs-attr">meta</span>: &#123;<br>          <span class="hljs-attr">title</span>: <span class="hljs-string">&#x27;permissionList&#x27;</span>,<br>          <span class="hljs-attr">icon</span>: <span class="hljs-string">&#x27;permission&#x27;</span><br>        &#125;<br>      &#125;,<br>      &#123;<br>        <span class="hljs-attr">path</span>: <span class="hljs-string">&#x27;/user/info/:id&#x27;</span>,<br>        <span class="hljs-attr">name</span>: <span class="hljs-string">&#x27;userInfo&#x27;</span>,<br>        <span class="hljs-attr">component</span>: <span class="hljs-function">() =&gt;</span> <span class="hljs-title function_">import</span>(<span class="hljs-string">&#x27;@/views/user-info/index&#x27;</span>),<br>        <span class="hljs-attr">meta</span>: &#123;<br>          <span class="hljs-attr">title</span>: <span class="hljs-string">&#x27;userInfo&#x27;</span><br>        &#125;<br>      &#125;,<br>      &#123;<br>        <span class="hljs-attr">path</span>: <span class="hljs-string">&#x27;/user/import&#x27;</span>,<br>        <span class="hljs-attr">name</span>: <span class="hljs-string">&#x27;import&#x27;</span>,<br>        <span class="hljs-attr">component</span>: <span class="hljs-function">() =&gt;</span> <span class="hljs-title function_">import</span>(<span class="hljs-string">&#x27;@/views/import/index&#x27;</span>),<br>        <span class="hljs-attr">meta</span>: &#123;<br>          <span class="hljs-attr">title</span>: <span class="hljs-string">&#x27;excelImport&#x27;</span><br>        &#125;<br>      &#125;<br>    ]<br>  &#125;,<br>  &#123;<br>    <span class="hljs-attr">path</span>: <span class="hljs-string">&#x27;/article&#x27;</span>,<br>    <span class="hljs-attr">component</span>: layout,<br>    <span class="hljs-attr">redirect</span>: <span class="hljs-string">&#x27;/article/ranking&#x27;</span>,<br>    <span class="hljs-attr">meta</span>: &#123;<br>      <span class="hljs-attr">title</span>: <span class="hljs-string">&#x27;article&#x27;</span>,<br>      <span class="hljs-attr">icon</span>: <span class="hljs-string">&#x27;article&#x27;</span><br>    &#125;,<br>    <span class="hljs-attr">children</span>: [<br>      &#123;<br>        <span class="hljs-attr">path</span>: <span class="hljs-string">&#x27;/article/ranking&#x27;</span>,<br>        <span class="hljs-attr">component</span>: <span class="hljs-function">() =&gt;</span> <span class="hljs-title function_">import</span>(<span class="hljs-string">&#x27;@/views/article-ranking/index&#x27;</span>),<br>        <span class="hljs-attr">meta</span>: &#123;<br>          <span class="hljs-attr">title</span>: <span class="hljs-string">&#x27;articleRanking&#x27;</span>,<br>          <span class="hljs-attr">icon</span>: <span class="hljs-string">&#x27;article-ranking&#x27;</span><br>        &#125;<br>      &#125;,<br>      &#123;<br>        <span class="hljs-attr">path</span>: <span class="hljs-string">&#x27;/article/:id&#x27;</span>,<br>        <span class="hljs-attr">component</span>: <span class="hljs-function">() =&gt;</span> <span class="hljs-title function_">import</span>(<span class="hljs-string">&#x27;@/views/article-detail/index&#x27;</span>),<br>        <span class="hljs-attr">meta</span>: &#123;<br>          <span class="hljs-attr">title</span>: <span class="hljs-string">&#x27;articleDetail&#x27;</span><br>        &#125;<br>      &#125;,<br>      &#123;<br>        <span class="hljs-attr">path</span>: <span class="hljs-string">&#x27;/article/create&#x27;</span>,<br>        <span class="hljs-attr">component</span>: <span class="hljs-function">() =&gt;</span> <span class="hljs-title function_">import</span>(<span class="hljs-string">&#x27;@/views/article-create/index&#x27;</span>),<br>        <span class="hljs-attr">meta</span>: &#123;<br>          <span class="hljs-attr">title</span>: <span class="hljs-string">&#x27;articleCreate&#x27;</span>,<br>          <span class="hljs-attr">icon</span>: <span class="hljs-string">&#x27;article-create&#x27;</span><br>        &#125;<br>      &#125;,<br>      &#123;<br>        <span class="hljs-attr">path</span>: <span class="hljs-string">&#x27;/article/editor/:id&#x27;</span>,<br>        <span class="hljs-attr">component</span>: <span class="hljs-function">() =&gt;</span> <span class="hljs-title function_">import</span>(<span class="hljs-string">&#x27;@/views/article-create/index&#x27;</span>),<br>        <span class="hljs-attr">meta</span>: &#123;<br>          <span class="hljs-attr">title</span>: <span class="hljs-string">&#x27;articleEditor&#x27;</span><br>        &#125;<br>      &#125;<br>    ]<br>  &#125;<br>]<br><br><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * 公开路由表</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">const</span> publicRoutes = [<br>  &#123;<br>    <span class="hljs-attr">path</span>: <span class="hljs-string">&#x27;/login&#x27;</span>,<br>    <span class="hljs-attr">component</span>: <span class="hljs-function">() =&gt;</span> <span class="hljs-title function_">import</span>(<span class="hljs-string">&#x27;@/views/login/index&#x27;</span>)<br>  &#125;,<br>  &#123;<br>    <span class="hljs-attr">path</span>: <span class="hljs-string">&#x27;/&#x27;</span>,<br>    <span class="hljs-comment">// 注意：带有路径“/”的记录中的组件“默认”是一个不返回 Promise 的函数</span><br>    <span class="hljs-attr">component</span>: layout,<br>    <span class="hljs-attr">redirect</span>: <span class="hljs-string">&#x27;/profile&#x27;</span>,<br>    <span class="hljs-attr">children</span>: [<br>      &#123;<br>        <span class="hljs-attr">path</span>: <span class="hljs-string">&#x27;/profile&#x27;</span>,<br>        <span class="hljs-attr">name</span>: <span class="hljs-string">&#x27;profile&#x27;</span>,<br>        <span class="hljs-attr">component</span>: <span class="hljs-function">() =&gt;</span> <span class="hljs-title function_">import</span>(<span class="hljs-string">&#x27;@/views/profile/index&#x27;</span>),<br>        <span class="hljs-attr">meta</span>: &#123;<br>          <span class="hljs-attr">title</span>: <span class="hljs-string">&#x27;profile&#x27;</span>,<br>          <span class="hljs-attr">icon</span>: <span class="hljs-string">&#x27;el-icon-user&#x27;</span><br>        &#125;<br>      &#125;,<br>      &#123;<br>        <span class="hljs-attr">path</span>: <span class="hljs-string">&#x27;/404&#x27;</span>,<br>        <span class="hljs-attr">name</span>: <span class="hljs-string">&#x27;404&#x27;</span>,<br>        <span class="hljs-attr">component</span>: <span class="hljs-function">() =&gt;</span> <span class="hljs-title function_">import</span>(<span class="hljs-string">&#x27;@/views/error-page/404&#x27;</span>)<br>      &#125;,<br>      &#123;<br>        <span class="hljs-attr">path</span>: <span class="hljs-string">&#x27;/401&#x27;</span>,<br>        <span class="hljs-attr">name</span>: <span class="hljs-string">&#x27;401&#x27;</span>,<br>        <span class="hljs-attr">component</span>: <span class="hljs-function">() =&gt;</span> <span class="hljs-title function_">import</span>(<span class="hljs-string">&#x27;@/views/error-page/401&#x27;</span>)<br>      &#125;<br>    ]<br>  &#125;<br>]<br><br><span class="hljs-keyword">const</span> router = <span class="hljs-title function_">createRouter</span>(&#123;<br>  <span class="hljs-attr">history</span>: <span class="hljs-title function_">createWebHashHistory</span>(),<br>  <span class="hljs-attr">routes</span>: [...publicRoutes, ...privateRoutes]<br>&#125;)<br></code></pre></td></tr></table></figure>

<p>最后不要忘记在 <code>layout/appMain</code> 下设置路由出口</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs js">&lt;template&gt;<br>  <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;app-main&quot;</span>&gt;</span></span><br><span class="language-xml">    <span class="hljs-tag">&lt;<span class="hljs-name">router-view</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">router-view</span>&gt;</span></span><br><span class="language-xml">  <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span><br>&lt;/template&gt;<br></code></pre></td></tr></table></figure>

<h2 id="解析路由表，获取结构化数据"><a href="#解析路由表，获取结构化数据" class="headerlink" title="解析路由表，获取结构化数据"></a>解析路由表，获取结构化数据</h2><p>想要获取路由表数据，那么有两种方式：</p>
<ol>
<li><p><a target="_blank" rel="noopener" href="https://next.router.vuejs.org/zh/api/#routes">router.options.routes</a>：初始路由列表（<a target="_blank" rel="noopener" href="https://next.router.vuejs.org/zh/api/#addroute">新增的路由</a> 无法获取到）</p>
</li>
<li><p><a target="_blank" rel="noopener" href="https://next.router.vuejs.org/zh/api/#getroutes">router.getRoutes()</a>：获取所有 <a target="_blank" rel="noopener" href="https://next.router.vuejs.org/zh/api/#routerecord">路由记录</a> 的完整列表</p>
</li>
</ol>
<p>所以，我们此时使用 <code>router.getRoutes()</code> 方法获取完整的路由列表</p>
<p>在 <code>layout/components/Sidebar/SidebarMenu</code> 下写入以下代码：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs js">&lt;script setup&gt;<br><span class="hljs-keyword">import</span> &#123; useRouter &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;vue-router&#x27;</span><br><br><span class="hljs-keyword">const</span> router = <span class="hljs-title function_">useRouter</span>()<br><span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(router.<span class="hljs-title function_">getRoutes</span>())<br>&lt;/script&gt;<br></code></pre></td></tr></table></figure>

<p>从返回的数据来看，它与我们想要的数据结构相去甚远。</p>
<p>出现这个问题的原因，是因为它返回的是一个 <strong>完整的路由表</strong></p>
<p>这个路由表距离我们想要的存在两个问题：</p>
<ol>
<li>存在重复的路由数据</li>
<li>不满足该条件 <code>meta &amp;&amp; meta.title &amp;&amp; meta.icon</code> 的数据不应该存在</li>
</ol>
<p>那么接下来我们就应该来处理这两个问题</p>
<p>创建 <code>utils/route.ts</code> 文件，创建两个方法分别处理对应的两个问题：</p>
<ol>
<li><code>filterRouters</code></li>
<li><code>generateMenus</code></li>
</ol>
<p>写入以下代码：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">import</span> path <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;path&#x27;</span><br><br><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * 返回所有子路由</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">const</span> <span class="hljs-title function_">getChildrenRoutes</span> = routes =&gt; &#123;<br>  <span class="hljs-keyword">const</span> result = []<br>  routes.<span class="hljs-title function_">forEach</span>(<span class="hljs-function"><span class="hljs-params">route</span> =&gt;</span> &#123;<br>    <span class="hljs-keyword">if</span> (route.<span class="hljs-property">children</span> &amp;&amp; route.<span class="hljs-property">children</span>.<span class="hljs-property">length</span> &gt; <span class="hljs-number">0</span>) &#123;<br>      result.<span class="hljs-title function_">push</span>(...route.<span class="hljs-property">children</span>)<br>    &#125;<br>  &#125;)<br>  <span class="hljs-keyword">return</span> result<br>&#125;<br><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * 处理脱离层级的路由：某个一级路由为其他子路由，则剔除该一级路由，保留路由层级</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@param</span> &#123;<span class="hljs-type">*</span>&#125; routes router.getRoutes()</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> <span class="hljs-title function_">filterRouters</span> = routes =&gt; &#123;<br>  <span class="hljs-keyword">const</span> childrenRoutes = <span class="hljs-title function_">getChildrenRoutes</span>(routes)<br>  <span class="hljs-keyword">return</span> routes.<span class="hljs-title function_">filter</span>(<span class="hljs-function"><span class="hljs-params">route</span> =&gt;</span> &#123;<br>    <span class="hljs-keyword">return</span> !childrenRoutes.<span class="hljs-title function_">find</span>(<span class="hljs-function"><span class="hljs-params">childrenRoute</span> =&gt;</span> &#123;<br>      <span class="hljs-keyword">return</span> childrenRoute.<span class="hljs-property">path</span> === route.<span class="hljs-property">path</span><br>    &#125;)<br>  &#125;)<br>&#125;<br><br><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * 判断数据是否为空值</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">function</span> <span class="hljs-title function_">isNull</span>(<span class="hljs-params">data</span>) &#123;<br>  <span class="hljs-keyword">if</span> (!data) <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span><br>  <span class="hljs-keyword">if</span> (<span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>(data) === <span class="hljs-string">&#x27;&#123;&#125;&#x27;</span>) <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span><br>  <span class="hljs-keyword">if</span> (<span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>(data) === <span class="hljs-string">&#x27;[]&#x27;</span>) <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span><br>  <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span><br>&#125;<br><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * 根据 routes 数据，返回对应 menu 规则数组</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">export</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">generateMenus</span>(<span class="hljs-params">routes, basePath = <span class="hljs-string">&#x27;&#x27;</span></span>) &#123;<br>  <span class="hljs-keyword">const</span> result = []<br>  <span class="hljs-comment">// 遍历路由表</span><br>  routes.<span class="hljs-title function_">forEach</span>(<span class="hljs-function"><span class="hljs-params">item</span> =&gt;</span> &#123;<br>    <span class="hljs-comment">// 不存在 children &amp;&amp; 不存在 meta 直接 return</span><br>    <span class="hljs-keyword">if</span> (<span class="hljs-title function_">isNull</span>(item.<span class="hljs-property">meta</span>) &amp;&amp; <span class="hljs-title function_">isNull</span>(item.<span class="hljs-property">children</span>)) <span class="hljs-keyword">return</span><br>    <span class="hljs-comment">// 存在 children 不存在 meta，进入迭代</span><br>    <span class="hljs-keyword">if</span> (<span class="hljs-title function_">isNull</span>(item.<span class="hljs-property">meta</span>) &amp;&amp; !<span class="hljs-title function_">isNull</span>(item.<span class="hljs-property">children</span>)) &#123;<br>      result.<span class="hljs-title function_">push</span>(...<span class="hljs-title function_">generateMenus</span>(item.<span class="hljs-property">children</span>))<br>      <span class="hljs-keyword">return</span><br>    &#125;<br>    <span class="hljs-comment">// 合并 path 作为跳转路径</span><br>    <span class="hljs-keyword">const</span> routePath = path.<span class="hljs-title function_">resolve</span>(basePath, item.<span class="hljs-property">path</span>)<br>    <span class="hljs-comment">// 路由分离之后，存在同名父路由的情况，需要单独处理</span><br>    <span class="hljs-keyword">let</span> route = result.<span class="hljs-title function_">find</span>(<span class="hljs-function"><span class="hljs-params">item</span> =&gt;</span> item.<span class="hljs-property">path</span> === routePath)<br>    <span class="hljs-keyword">if</span> (!route) &#123;<br>      route = &#123;<br>        ...item,<br>        <span class="hljs-attr">path</span>: routePath,<br>        <span class="hljs-attr">children</span>: []<br>      &#125;<br><br>      <span class="hljs-comment">// icon 与 title 必须全部存在</span><br>      <span class="hljs-keyword">if</span> (route.<span class="hljs-property">meta</span>.<span class="hljs-property">icon</span> &amp;&amp; route.<span class="hljs-property">meta</span>.<span class="hljs-property">title</span>) &#123;<br>        <span class="hljs-comment">// meta 存在生成 route 对象，放入 arr</span><br>        result.<span class="hljs-title function_">push</span>(route)<br>      &#125;<br>    &#125;<br><br>    <span class="hljs-comment">// 存在 children 进入迭代到children</span><br>    <span class="hljs-keyword">if</span> (item.<span class="hljs-property">children</span>) &#123;<br>      route.<span class="hljs-property">children</span>.<span class="hljs-title function_">push</span>(...<span class="hljs-title function_">generateMenus</span>(item.<span class="hljs-property">children</span>, route.<span class="hljs-property">path</span>))<br>    &#125;<br>  &#125;)<br>  <span class="hljs-keyword">return</span> result<br>&#125;<br><br></code></pre></td></tr></table></figure>

<p>在 <code>SidebarMenu</code> 中调用该方法</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs js">&lt;script setup&gt;<br><span class="hljs-keyword">import</span> &#123; computed &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;vue&#x27;</span><br><span class="hljs-keyword">import</span> &#123; useRouter &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;vue-router&#x27;</span><br><span class="hljs-keyword">import</span> &#123; filterRouters, generateMenus &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;@/utils/route&#x27;</span><br><br><span class="hljs-keyword">const</span> router = <span class="hljs-title function_">useRouter</span>()<br><span class="hljs-keyword">const</span> routes = <span class="hljs-title function_">computed</span>(<span class="hljs-function">() =&gt;</span> &#123;<br>  <span class="hljs-keyword">const</span> filterRoutes = <span class="hljs-title function_">filterRouters</span>(router.<span class="hljs-title function_">getRoutes</span>())<br>  <span class="hljs-keyword">return</span> <span class="hljs-title function_">generateMenus</span>(filterRoutes)<br>&#125;)<br><span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>(routes.<span class="hljs-property">value</span>))<br>&lt;/script&gt;<br></code></pre></td></tr></table></figure>

<p>得到该数据结构</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br></pre></td><td class="code"><pre><code class="hljs json"><span class="hljs-punctuation">[</span><br>    <span class="hljs-punctuation">&#123;</span><br>        <span class="hljs-attr">&quot;path&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-string">&quot;/profile&quot;</span><span class="hljs-punctuation">,</span><br>        <span class="hljs-attr">&quot;name&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-string">&quot;profile&quot;</span><span class="hljs-punctuation">,</span><br>        <span class="hljs-attr">&quot;meta&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-punctuation">&#123;</span><br>            <span class="hljs-attr">&quot;title&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-string">&quot;profile&quot;</span><span class="hljs-punctuation">,</span><br>            <span class="hljs-attr">&quot;icon&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-string">&quot;el-icon-user&quot;</span><br>        <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-punctuation">&#123;</span><br>        <span class="hljs-attr">&quot;path&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-string">&quot;/user&quot;</span><span class="hljs-punctuation">,</span><br>        <span class="hljs-attr">&quot;redirect&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-string">&quot;/user/manage&quot;</span><span class="hljs-punctuation">,</span><br>        <span class="hljs-attr">&quot;meta&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-punctuation">&#123;</span><br>            <span class="hljs-attr">&quot;title&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-string">&quot;user&quot;</span><span class="hljs-punctuation">,</span><br>            <span class="hljs-attr">&quot;icon&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-string">&quot;personnel&quot;</span><br>        <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br>        <span class="hljs-attr">&quot;props&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-punctuation">&#123;</span><br>            <span class="hljs-attr">&quot;default&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-keyword">false</span><br>        <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br>        <span class="hljs-attr">&quot;children&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-punctuation">[</span><br>            <span class="hljs-punctuation">&#123;</span><br>                <span class="hljs-attr">&quot;path&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-string">&quot;/user/manage&quot;</span><span class="hljs-punctuation">,</span><br>                <span class="hljs-attr">&quot;name&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-string">&quot;userManage&quot;</span><span class="hljs-punctuation">,</span><br>                <span class="hljs-attr">&quot;meta&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-punctuation">&#123;</span><br>                    <span class="hljs-attr">&quot;title&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-string">&quot;userManage&quot;</span><span class="hljs-punctuation">,</span><br>                    <span class="hljs-attr">&quot;icon&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-string">&quot;personnel-manage&quot;</span><br>                <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br>                <span class="hljs-attr">&quot;children&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-punctuation">[</span><br><br>                <span class="hljs-punctuation">]</span><br>            <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br>            <span class="hljs-punctuation">&#123;</span><br>                <span class="hljs-attr">&quot;path&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-string">&quot;/user/role&quot;</span><span class="hljs-punctuation">,</span><br>                <span class="hljs-attr">&quot;name&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-string">&quot;userRole&quot;</span><span class="hljs-punctuation">,</span><br>                <span class="hljs-attr">&quot;meta&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-punctuation">&#123;</span><br>                    <span class="hljs-attr">&quot;title&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-string">&quot;roleList&quot;</span><span class="hljs-punctuation">,</span><br>                    <span class="hljs-attr">&quot;icon&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-string">&quot;role&quot;</span><br>                <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br>                <span class="hljs-attr">&quot;children&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-punctuation">[</span><br><br>                <span class="hljs-punctuation">]</span><br>            <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br>            <span class="hljs-punctuation">&#123;</span><br>                <span class="hljs-attr">&quot;path&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-string">&quot;/user/permission&quot;</span><span class="hljs-punctuation">,</span><br>                <span class="hljs-attr">&quot;name&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-string">&quot;userPermission&quot;</span><span class="hljs-punctuation">,</span><br>                <span class="hljs-attr">&quot;meta&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-punctuation">&#123;</span><br>                    <span class="hljs-attr">&quot;title&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-string">&quot;permissionList&quot;</span><span class="hljs-punctuation">,</span><br>                    <span class="hljs-attr">&quot;icon&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-string">&quot;permission&quot;</span><br>                <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br>                <span class="hljs-attr">&quot;children&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-punctuation">[</span><br><br>                <span class="hljs-punctuation">]</span><br>            <span class="hljs-punctuation">&#125;</span><br>        <span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-punctuation">&#123;</span><br>        <span class="hljs-attr">&quot;path&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-string">&quot;/article&quot;</span><span class="hljs-punctuation">,</span><br>        <span class="hljs-attr">&quot;redirect&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-string">&quot;/article/ranking&quot;</span><span class="hljs-punctuation">,</span><br>        <span class="hljs-attr">&quot;meta&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-punctuation">&#123;</span><br>            <span class="hljs-attr">&quot;title&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-string">&quot;article&quot;</span><span class="hljs-punctuation">,</span><br>            <span class="hljs-attr">&quot;icon&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-string">&quot;article&quot;</span><br>        <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br>        <span class="hljs-attr">&quot;props&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-punctuation">&#123;</span><br>            <span class="hljs-attr">&quot;default&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-keyword">false</span><br>        <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br>        <span class="hljs-attr">&quot;children&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-punctuation">[</span><br>            <span class="hljs-punctuation">&#123;</span><br>                <span class="hljs-attr">&quot;path&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-string">&quot;/article/ranking&quot;</span><span class="hljs-punctuation">,</span><br>                <span class="hljs-attr">&quot;name&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-string">&quot;articleRanking&quot;</span><span class="hljs-punctuation">,</span><br>                <span class="hljs-attr">&quot;meta&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-punctuation">&#123;</span><br>                    <span class="hljs-attr">&quot;title&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-string">&quot;articleRanking&quot;</span><span class="hljs-punctuation">,</span><br>                    <span class="hljs-attr">&quot;icon&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-string">&quot;article-ranking&quot;</span><br>                <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br>                <span class="hljs-attr">&quot;children&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-punctuation">[</span><br><br>                <span class="hljs-punctuation">]</span><br>            <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br>            <span class="hljs-punctuation">&#123;</span><br>                <span class="hljs-attr">&quot;path&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-string">&quot;/article/create&quot;</span><span class="hljs-punctuation">,</span><br>                <span class="hljs-attr">&quot;name&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-string">&quot;articleCreate&quot;</span><span class="hljs-punctuation">,</span><br>                <span class="hljs-attr">&quot;meta&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-punctuation">&#123;</span><br>                    <span class="hljs-attr">&quot;title&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-string">&quot;articleCreate&quot;</span><span class="hljs-punctuation">,</span><br>                    <span class="hljs-attr">&quot;icon&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-string">&quot;article-create&quot;</span><br>                <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br>                <span class="hljs-attr">&quot;children&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-punctuation">[</span><br><br>                <span class="hljs-punctuation">]</span><br>            <span class="hljs-punctuation">&#125;</span><br>        <span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-punctuation">&#125;</span><br><span class="hljs-punctuation">]</span><br></code></pre></td></tr></table></figure>

<h2 id="生成动态-menu-菜单"><a href="#生成动态-menu-菜单" class="headerlink" title="生成动态 menu 菜单"></a>生成动态 menu 菜单</h2><p>有了数据结构之后，最后的步骤就水到渠成了</p>
<p>整个 <code>menu</code> 菜单，我们将分成三个组件来进行处理</p>
<ol>
<li><code>SidebarMenu</code>：处理数据，作为最顶层 <code>menu</code> 载体</li>
<li><code>SidebarItem</code>：根据数据处理 <strong>当前项为 <code>el-submenu</code> || <code>el-menu-item</code></strong> </li>
<li><code>MenuItem</code>：处理 <code>el-menu-item</code> 样式</li>
</ol>
<p>那么下面我们一个个来处理</p>
<p>首先是 <code>SidebarMenu</code> </p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs js">&lt;template&gt;<br>  &lt;!-- 一级 menu 菜单 --&gt;<br>  <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">el-menu</span></span></span><br><span class="hljs-tag"><span class="language-xml">    <span class="hljs-attr">...</span></span></span><br><span class="hljs-tag"><span class="language-xml">  &gt;</span></span><br><span class="language-xml">    <span class="hljs-tag">&lt;<span class="hljs-name">sidebar-item</span></span></span><br><span class="hljs-tag"><span class="language-xml">      <span class="hljs-attr">v-for</span>=<span class="hljs-string">&quot;item in routes&quot;</span></span></span><br><span class="hljs-tag"><span class="language-xml">      <span class="hljs-attr">:key</span>=<span class="hljs-string">&quot;item.path&quot;</span></span></span><br><span class="hljs-tag"><span class="language-xml">      <span class="hljs-attr">:route</span>=<span class="hljs-string">&quot;item&quot;</span></span></span><br><span class="hljs-tag"><span class="language-xml">    &gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">sidebar-item</span>&gt;</span></span><br><span class="language-xml">  <span class="hljs-tag">&lt;/<span class="hljs-name">el-menu</span>&gt;</span></span><br>&lt;/template&gt;<br><br></code></pre></td></tr></table></figure>



<p>创建 <code>SidebarItem</code> 组件，用来根据数据处理 <strong>当前项为 <code>el-sub-menu</code> || <code>el-menu-item</code></strong> </p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><code class="hljs js">&lt;template&gt;<br>  &lt;!-- 支持渲染多级 menu 菜单 --&gt;<br>  <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">el-sub-menu</span> <span class="hljs-attr">v-if</span>=<span class="hljs-string">&quot;route.children.length &gt; 0&quot;</span> <span class="hljs-attr">:index</span>=<span class="hljs-string">&quot;route.path&quot;</span>&gt;</span></span><br><span class="language-xml">    <span class="hljs-tag">&lt;<span class="hljs-name">template</span> #<span class="hljs-attr">title</span>&gt;</span></span><br><span class="language-xml">      <span class="hljs-tag">&lt;<span class="hljs-name">menu-item</span> <span class="hljs-attr">:title</span>=<span class="hljs-string">&quot;route.meta.title&quot;</span> <span class="hljs-attr">:icon</span>=<span class="hljs-string">&quot;route.meta.icon&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">menu-item</span>&gt;</span></span><br><span class="language-xml">    <span class="hljs-tag">&lt;/<span class="hljs-name">template</span>&gt;</span></span><br><span class="language-xml">    <span class="hljs-comment">&lt;!-- 循环渲染 --&gt;</span></span><br><span class="language-xml">    <span class="hljs-tag">&lt;<span class="hljs-name">sidebar-item</span></span></span><br><span class="hljs-tag"><span class="language-xml">      <span class="hljs-attr">v-for</span>=<span class="hljs-string">&quot;item in route.children&quot;</span></span></span><br><span class="hljs-tag"><span class="language-xml">      <span class="hljs-attr">:key</span>=<span class="hljs-string">&quot;item.path&quot;</span></span></span><br><span class="hljs-tag"><span class="language-xml">      <span class="hljs-attr">:route</span>=<span class="hljs-string">&quot;item&quot;</span></span></span><br><span class="hljs-tag"><span class="language-xml">    &gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">sidebar-item</span>&gt;</span></span><br><span class="language-xml">  <span class="hljs-tag">&lt;/<span class="hljs-name">el-sub-menu</span>&gt;</span></span><br>  &lt;!-- 渲染 item 项 --&gt;<br>  <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">el-menu-item</span> <span class="hljs-attr">v-else</span> <span class="hljs-attr">:index</span>=<span class="hljs-string">&quot;route.path&quot;</span>&gt;</span></span><br><span class="language-xml">    <span class="hljs-tag">&lt;<span class="hljs-name">menu-item</span> <span class="hljs-attr">:title</span>=<span class="hljs-string">&quot;route.meta.title&quot;</span> <span class="hljs-attr">:icon</span>=<span class="hljs-string">&quot;route.meta.icon&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">menu-item</span>&gt;</span></span><br><span class="language-xml">  <span class="hljs-tag">&lt;/<span class="hljs-name">el-menu-item</span>&gt;</span></span><br>&lt;/template&gt;<br><br><span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">setup</span>&gt;</span><span class="language-javascript"></span></span><br><span class="language-javascript"><span class="language-xml"><span class="hljs-keyword">import</span> <span class="hljs-title class_">MenuItem</span> <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;./MenuItem&#x27;</span></span></span><br><span class="language-javascript"><span class="language-xml"><span class="hljs-keyword">import</span> &#123; defineProps &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;vue&#x27;</span></span></span><br><span class="language-javascript"><span class="language-xml"><span class="hljs-comment">// 定义 props</span></span></span><br><span class="language-javascript"><span class="language-xml"><span class="hljs-title function_">defineProps</span>(&#123;</span></span><br><span class="language-javascript"><span class="language-xml">  <span class="hljs-attr">route</span>: &#123;</span></span><br><span class="language-javascript"><span class="language-xml">    <span class="hljs-attr">type</span>: <span class="hljs-title class_">Object</span>,</span></span><br><span class="language-javascript"><span class="language-xml">    <span class="hljs-attr">required</span>: <span class="hljs-literal">true</span></span></span><br><span class="language-javascript"><span class="language-xml">  &#125;</span></span><br><span class="language-javascript"><span class="language-xml">&#125;)</span></span><br><span class="language-javascript"><span class="language-xml"></span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span></span><br></code></pre></td></tr></table></figure>

<p>创建 <code>MenuItem</code> 用来处理 <code>el-menu-item</code> 样式</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs js">&lt;template&gt;<br>  <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">i</span> <span class="hljs-attr">v-if</span>=<span class="hljs-string">&quot;icon.includes(&#x27;el-icon&#x27;)&quot;</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;sub-el-icon&quot;</span> <span class="hljs-attr">:class</span>=<span class="hljs-string">&quot;icon&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">i</span>&gt;</span></span><br>  <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">svg-icon</span> <span class="hljs-attr">v-else</span> <span class="hljs-attr">:icon</span>=<span class="hljs-string">&quot;icon&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">svg-icon</span>&gt;</span></span><br>  <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">span</span>&gt;</span>&#123;&#123; title &#125;&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span></span><br>&lt;/template&gt;<br><br><span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">setup</span>&gt;</span><span class="language-javascript"></span></span><br><span class="language-javascript"><span class="language-xml"><span class="hljs-keyword">import</span> &#123; defineProps &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;vue&#x27;</span></span></span><br><span class="language-javascript"><span class="language-xml"><span class="hljs-title function_">defineProps</span>(&#123;</span></span><br><span class="language-javascript"><span class="language-xml">  <span class="hljs-attr">title</span>: &#123;</span></span><br><span class="language-javascript"><span class="language-xml">    <span class="hljs-attr">type</span>: <span class="hljs-title class_">String</span>,</span></span><br><span class="language-javascript"><span class="language-xml">    <span class="hljs-attr">required</span>: <span class="hljs-literal">true</span></span></span><br><span class="language-javascript"><span class="language-xml">  &#125;,</span></span><br><span class="language-javascript"><span class="language-xml">  <span class="hljs-attr">icon</span>: &#123;</span></span><br><span class="language-javascript"><span class="language-xml">    <span class="hljs-attr">type</span>: <span class="hljs-title class_">String</span>,</span></span><br><span class="language-javascript"><span class="language-xml">    <span class="hljs-attr">required</span>: <span class="hljs-literal">true</span></span></span><br><span class="language-javascript"><span class="language-xml">  &#125;</span></span><br><span class="language-javascript"><span class="language-xml">&#125;)</span></span><br><span class="language-javascript"><span class="language-xml"></span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span></span><br><br><span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">style</span> <span class="hljs-attr">lang</span>=<span class="hljs-string">&quot;scss&quot;</span> <span class="hljs-attr">scoped</span>&gt;</span></span><br><span class="language-xml"><span class="hljs-tag">&lt;/<span class="hljs-name">style</span>&gt;</span></span><br></code></pre></td></tr></table></figure>

<p>至此，整个的 <code>menu</code> 菜单结构就已经完成了！</p>
<h2 id="修复最后残余问题"><a href="#修复最后残余问题" class="headerlink" title="修复最后残余问题"></a>修复最后残余问题</h2><p>目前 <code>menu</code> 菜单存在三个问题</p>
<ol>
<li>样式问题</li>
<li>路由跳转问题</li>
<li>默认激活项</li>
</ol>
<p><strong>样式问题：</strong></p>
<p>首先处理样式，因为后面我们需要处理 <strong>主题替换</strong> ，所以此处我们不能把样式写死。因为我们的样式变量都放在 <code>variables.scss</code> 文件中，并通过 <code>:export</code> 导出了变量以供 js 导入，每次使用都需要导入，比较麻烦，我们可以将其放在 <code>store getters</code> 中，以便 <strong>快捷访问</strong>。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">import</span> variables <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;@/styles/variables.scss&#x27;</span><br><span class="hljs-keyword">const</span> getters = &#123;<br>  <span class="hljs-attr">cssVar</span>: <span class="hljs-function">() =&gt;</span> variables<br>&#125;<br><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> getters<br></code></pre></td></tr></table></figure>

<p>在 <code>SidebarMenu</code> 中写入如下样式</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">el-menu</span></span><br><span class="hljs-tag">  <span class="hljs-attr">:background-color</span>=<span class="hljs-string">&quot;$store.getters.cssVar.menuBg&quot;</span></span><br><span class="hljs-tag">  <span class="hljs-attr">:text-color</span>=<span class="hljs-string">&quot;$store.getters.cssVar.menuText&quot;</span></span><br><span class="hljs-tag">  <span class="hljs-attr">:active-text-color</span>=<span class="hljs-string">&quot;$store.getters.cssVar.menuActiveText&quot;</span></span><br><span class="hljs-tag">  <span class="hljs-attr">:unique-opened</span>=<span class="hljs-string">&quot;true&quot;</span></span><br><span class="hljs-tag">&gt;</span><br></code></pre></td></tr></table></figure>

<p><strong>路由跳转问题：</strong></p>
<p>为 <code>el-menu</code> 指定 <code>router</code></p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">el-menu</span></span><br><span class="hljs-tag">  <span class="hljs-attr">...</span></span><br><span class="hljs-tag">  <span class="hljs-attr">router</span></span><br><span class="hljs-tag">&gt;</span><br></code></pre></td></tr></table></figure>

<blockquote>
<p>添加 router 属性</p>
<p>表示是否启用 vue-router 模式。 启用该模式会在激活导航时以 index 作为 path 进行路由跳转 使用 default-active 来设置加载时的激活项。</p>
</blockquote>
<p><strong>默认激活项：</strong></p>
<p>根据当前 <code>url</code> 进行判断即可</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs js">&lt;el-menu<br>  :<span class="hljs-keyword">default</span>-active=<span class="hljs-string">&quot;activeMenu&quot;</span><br>  ...<br>&gt;<br><br><span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">setup</span>&gt;</span><span class="language-javascript"></span></span><br><span class="language-javascript"><span class="language-xml">...</span></span><br><span class="language-javascript"><span class="language-xml"></span></span><br><span class="language-javascript"><span class="language-xml"><span class="hljs-comment">// 计算高亮 menu 的方法</span></span></span><br><span class="language-javascript"><span class="language-xml"><span class="hljs-keyword">const</span> route = <span class="hljs-title function_">useRoute</span>()</span></span><br><span class="language-javascript"><span class="language-xml"><span class="hljs-keyword">const</span> activeMenu = <span class="hljs-title function_">computed</span>(<span class="hljs-function">() =&gt;</span> &#123;</span></span><br><span class="language-javascript"><span class="language-xml">  <span class="hljs-keyword">const</span> &#123; path &#125; = route</span></span><br><span class="language-javascript"><span class="language-xml">  <span class="hljs-keyword">return</span> path</span></span><br><span class="language-javascript"><span class="language-xml">&#125;)</span></span><br><span class="language-javascript"><span class="language-xml"></span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span></span><br></code></pre></td></tr></table></figure>

<p>至此整个 <strong>动态<code>menu</code>完成</strong></p>
<h2 id="左侧菜单伸缩功能实现"><a href="#左侧菜单伸缩功能实现" class="headerlink" title="左侧菜单伸缩功能实现"></a>左侧菜单伸缩功能实现</h2><p>下面我们来实现一个标准化功能 <strong>左侧菜单伸缩</strong> ，对于这个功能核心的点在于动画处理</p>
<p>样式的改变总是由数据进行驱动，所以首先我们去创建对应的数据</p>
<p>创建 <code>store/app</code> 模块，写入如下代码</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> &#123;<br>  <span class="hljs-attr">namespaced</span>: <span class="hljs-literal">true</span>,<br>  <span class="hljs-attr">state</span>: <span class="hljs-function">() =&gt;</span> (&#123;<br>    <span class="hljs-attr">sidebarOpened</span>: <span class="hljs-literal">true</span><br>  &#125;),<br>  <span class="hljs-attr">mutations</span>: &#123;<br>    <span class="hljs-title function_">triggerSidebarOpened</span>(<span class="hljs-params">state</span>) &#123;<br>      state.<span class="hljs-property">sidebarOpened</span> = !state.<span class="hljs-property">sidebarOpened</span><br>    &#125;<br>  &#125;,<br>  <span class="hljs-attr">actions</span>: &#123;&#125;<br>&#125;<br><br></code></pre></td></tr></table></figure>

<p>在 <code>store/index</code> 中进行导入</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs js">...<br><span class="hljs-keyword">import</span> app <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;./modules/app&#x27;</span><br><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-title function_">createStore</span>(&#123;<br>  getters,<br>  <span class="hljs-attr">modules</span>: &#123;<br>    ...<br>    app<br>  &#125;<br>&#125;)<br></code></pre></td></tr></table></figure>

<p>在 <code>store/getters</code> 中创建快捷访问</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-attr">sidebarOpened</span>: <span class="hljs-function"><span class="hljs-params">state</span> =&gt;</span> state.<span class="hljs-property">app</span>.<span class="hljs-property">sidebarOpened</span><br></code></pre></td></tr></table></figure>


<p>创建 <code>components/hamburger</code> 组件，用来控制数据</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><code class="hljs js">&lt;template&gt;<br>  <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;hamburger-container&quot;</span> @<span class="hljs-attr">click</span>=<span class="hljs-string">&quot;toggleClick&quot;</span>&gt;</span></span><br><span class="language-xml">    <span class="hljs-tag">&lt;<span class="hljs-name">svg-icon</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;hamburger&quot;</span> <span class="hljs-attr">:icon</span>=<span class="hljs-string">&quot;icon&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">svg-icon</span>&gt;</span></span><br><span class="language-xml">  <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span><br>&lt;/template&gt;<br><br><span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">setup</span>&gt;</span><span class="language-javascript"></span></span><br><span class="language-javascript"><span class="language-xml"><span class="hljs-keyword">import</span> &#123; computed &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;vue&#x27;</span></span></span><br><span class="language-javascript"><span class="language-xml"><span class="hljs-keyword">import</span> &#123; useStore &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;vuex&#x27;</span></span></span><br><span class="language-javascript"><span class="language-xml"></span></span><br><span class="language-javascript"><span class="language-xml"><span class="hljs-keyword">const</span> store = <span class="hljs-title function_">useStore</span>()</span></span><br><span class="language-javascript"><span class="language-xml"><span class="hljs-keyword">const</span> <span class="hljs-title function_">toggleClick</span> = (<span class="hljs-params"></span>) =&gt; &#123;</span></span><br><span class="language-javascript"><span class="language-xml">  store.<span class="hljs-title function_">commit</span>(<span class="hljs-string">&#x27;app/triggerSidebarOpened&#x27;</span>)</span></span><br><span class="language-javascript"><span class="language-xml">&#125;</span></span><br><span class="language-javascript"><span class="language-xml"></span></span><br><span class="language-javascript"><span class="language-xml"><span class="hljs-keyword">const</span> icon = <span class="hljs-title function_">computed</span>(<span class="hljs-function">() =&gt;</span></span></span><br><span class="language-javascript"><span class="language-xml">  store.<span class="hljs-property">getters</span>.<span class="hljs-property">sidebarOpened</span> ? <span class="hljs-string">&#x27;hamburger-opened&#x27;</span> : <span class="hljs-string">&#x27;hamburger-closed&#x27;</span></span></span><br><span class="language-javascript"><span class="language-xml">)</span></span><br><span class="language-javascript"><span class="language-xml"></span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span></span><br><br><span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">style</span> <span class="hljs-attr">lang</span>=<span class="hljs-string">&quot;scss&quot;</span> <span class="hljs-attr">scoped</span>&gt;</span><span class="language-css"></span></span><br><span class="language-css"><span class="language-xml"><span class="hljs-selector-class">.hamburger-container</span> &#123;</span></span><br><span class="language-css"><span class="language-xml">  <span class="hljs-attribute">padding</span>: <span class="hljs-number">0</span> <span class="hljs-number">16px</span>;</span></span><br><span class="language-css"><span class="language-xml">  <span class="hljs-selector-class">.hamburger</span> &#123;</span></span><br><span class="language-css"><span class="language-xml">    <span class="hljs-attribute">display</span>: inline-block;</span></span><br><span class="language-css"><span class="language-xml">    <span class="hljs-attribute">vertical-align</span>: middle;</span></span><br><span class="language-css"><span class="language-xml">    <span class="hljs-attribute">width</span>: <span class="hljs-number">20px</span>;</span></span><br><span class="language-css"><span class="language-xml">    <span class="hljs-attribute">height</span>: <span class="hljs-number">20px</span>;</span></span><br><span class="language-css"><span class="language-xml">  &#125;</span></span><br><span class="language-css"><span class="language-xml">&#125;</span></span><br><span class="language-css"><span class="language-xml"></span><span class="hljs-tag">&lt;/<span class="hljs-name">style</span>&gt;</span></span><br></code></pre></td></tr></table></figure>

<p>在 <code>navbar</code> 中使用该组件</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><code class="hljs js">&lt;template&gt;<br>  <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;navbar&quot;</span>&gt;</span></span><br><span class="language-xml">    <span class="hljs-tag">&lt;<span class="hljs-name">hamburger</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;hamburger-container&quot;</span> /&gt;</span></span><br><span class="language-xml">    ...</span><br><span class="language-xml">  <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span><br>&lt;/template&gt;<br><br><span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">setup</span>&gt;</span><span class="language-javascript"></span></span><br><span class="language-javascript"><span class="language-xml"><span class="hljs-keyword">import</span> <span class="hljs-title class_">Hamburger</span> <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;@/components/Hamburger&#x27;</span></span></span><br><span class="language-javascript"><span class="language-xml">...</span></span><br><span class="language-javascript"><span class="language-xml"></span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span></span><br><br><span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">style</span> <span class="hljs-attr">lang</span>=<span class="hljs-string">&quot;scss&quot;</span> <span class="hljs-attr">scoped</span>&gt;</span><span class="language-css"></span></span><br><span class="language-css"><span class="language-xml"><span class="hljs-selector-class">.navbar</span> &#123;</span></span><br><span class="language-css"><span class="language-xml">  ...</span></span><br><span class="language-css"><span class="language-xml"></span></span><br><span class="language-css"><span class="language-xml">  <span class="hljs-selector-class">.hamburger-container</span> &#123;</span></span><br><span class="language-css"><span class="language-xml">    <span class="hljs-attribute">line-height</span>: <span class="hljs-number">46px</span>;</span></span><br><span class="language-css"><span class="language-xml">    <span class="hljs-attribute">height</span>: <span class="hljs-number">100%</span>;</span></span><br><span class="language-css"><span class="language-xml">    <span class="hljs-attribute">float</span>: left;</span></span><br><span class="language-css"><span class="language-xml">    <span class="hljs-attribute">cursor</span>: pointer;</span></span><br><span class="language-css"><span class="language-xml">    // hover 动画</span></span><br><span class="language-css"><span class="language-xml">    <span class="hljs-attribute">transition</span>: background <span class="hljs-number">0.5s</span>;</span></span><br><span class="language-css"><span class="language-xml"></span></span><br><span class="language-css"><span class="language-xml">    &amp;<span class="hljs-selector-pseudo">:hover</span> &#123;</span></span><br><span class="language-css"><span class="language-xml">      <span class="hljs-attribute">background</span>: <span class="hljs-built_in">rgba</span>(<span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0.1</span>);</span></span><br><span class="language-css"><span class="language-xml">    &#125;</span></span><br><span class="language-css"><span class="language-xml">  &#125;</span></span><br><span class="language-css"><span class="language-xml"></span></span><br><span class="language-css"><span class="language-xml"> ...</span></span><br><span class="language-css"><span class="language-xml">&#125;</span></span><br><span class="language-css"><span class="language-xml"></span><span class="hljs-tag">&lt;/<span class="hljs-name">style</span>&gt;</span></span><br><br></code></pre></td></tr></table></figure>

<p>在 <code>SidebarMenu</code> 中，控制 <code>el-menu</code> 的 <a target="_blank" rel="noopener" href="https://element-plus.org/#/zh-CN/component/menu">collapse</a> 属性</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs js">&lt;el-menu<br>    :collapse=<span class="hljs-string">&quot;!$store.getters.sidebarOpened&quot;</span><br>    ...<br></code></pre></td></tr></table></figure>

<p>在 <code>layout/index</code> 中指定 <strong>整个侧边栏的宽度和缩放动画</strong></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs js">&lt;div<br>    <span class="hljs-keyword">class</span>=<span class="hljs-string">&quot;app-wrapper&quot;</span><br>    :<span class="hljs-keyword">class</span>=<span class="hljs-string">&quot;[$store.getters.sidebarOpened ? &#x27;openSidebar&#x27; : &#x27;hideSidebar&#x27;]&quot;</span><br>  &gt;<br>  ...<br></code></pre></td></tr></table></figure>

<p>在 <code>layout/index</code> 中 处理 <code>navbar</code> 的宽度</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs js">&lt;style lang=<span class="hljs-string">&quot;scss&quot;</span> scoped&gt;<br>...<br><br>.<span class="hljs-property">fixed</span>-header &#123;<br>  <span class="hljs-attr">position</span>: fixed;<br>  <span class="hljs-attr">top</span>: <span class="hljs-number">0</span>;<br>  <span class="hljs-attr">right</span>: <span class="hljs-number">0</span>;<br>  z-<span class="hljs-attr">index</span>: <span class="hljs-number">9</span>;<br>  <span class="hljs-attr">width</span>: <span class="hljs-title function_">calc</span>(<span class="hljs-number">100</span>% - #&#123;$sideBarWidth&#125;);<br>  <span class="hljs-attr">transition</span>: width <span class="hljs-number">0.</span>28s;<br>&#125;<br><br>.<span class="hljs-property">hideSidebar</span> .<span class="hljs-property">fixed</span>-header &#123;<br>  <span class="hljs-attr">width</span>: <span class="hljs-title function_">calc</span>(<span class="hljs-number">100</span>% - #&#123;$hideSideBarWidth&#125;);<br>&#125;<br>&lt;/style&gt;<br></code></pre></td></tr></table></figure>

<p>在 <code>styles/variables.scss</code> 中指定 <code>hideSideBarWidth</code></p>
<figure class="highlight scss"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs scss"><span class="hljs-variable">$hideSideBarWidth</span>: <span class="hljs-number">54px</span>;<br></code></pre></td></tr></table></figure>



<h2 id="SidebarHeader-处理"><a href="#SidebarHeader-处理" class="headerlink" title="SidebarHeader 处理"></a>SidebarHeader 处理</h2><p>整个左侧的 <code>menu</code> 菜单，到现在咱们还剩下最后一个 <code>header</code> 没有进行处理</p>
<p>在 <code>sidebar/index</code> 中写入如下代码</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><code class="hljs js">&lt;template&gt;<br>  <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;&quot;</span>&gt;</span></span><br><span class="language-xml">    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;logo-container&quot;</span>&gt;</span></span><br><span class="language-xml">      <span class="hljs-tag">&lt;<span class="hljs-name">el-avatar</span></span></span><br><span class="hljs-tag"><span class="language-xml">        <span class="hljs-attr">size</span>=<span class="hljs-string">&quot;44&quot;</span></span></span><br><span class="hljs-tag"><span class="language-xml">        <span class="hljs-attr">shape</span>=<span class="hljs-string">&quot;square&quot;</span></span></span><br><span class="hljs-tag"><span class="language-xml">        <span class="hljs-attr">src</span>=<span class="hljs-string">&quot;https://m.imooc.com/static/wap/static/common/img/logo-small@2x.png&quot;</span></span></span><br><span class="hljs-tag"><span class="language-xml">      /&gt;</span></span><br><span class="language-xml">      <span class="hljs-tag">&lt;<span class="hljs-name">h1</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;logo-title&quot;</span> <span class="hljs-attr">v-if</span>=<span class="hljs-string">&quot;$store.getters.sidebarOpened&quot;</span>&gt;</span></span><br><span class="language-xml">       imooc-admin</span><br><span class="language-xml">      <span class="hljs-tag">&lt;/<span class="hljs-name">h1</span>&gt;</span></span><br><span class="language-xml">    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span><br><span class="language-xml">    ...</span><br><span class="language-xml">  <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span><br>&lt;/template&gt;<br><br><span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">style</span> <span class="hljs-attr">lang</span>=<span class="hljs-string">&quot;scss&quot;</span> <span class="hljs-attr">scoped</span>&gt;</span><span class="language-css"></span></span><br><span class="language-css"><span class="language-xml"><span class="hljs-selector-class">.logo-container</span> &#123;</span></span><br><span class="language-css"><span class="language-xml">  <span class="hljs-attribute">height</span>: <span class="hljs-number">44px</span>;</span></span><br><span class="language-css"><span class="language-xml">  <span class="hljs-attribute">padding</span>: <span class="hljs-number">10px</span> <span class="hljs-number">0</span> <span class="hljs-number">22px</span> <span class="hljs-number">0</span>;</span></span><br><span class="language-css"><span class="language-xml">  <span class="hljs-attribute">display</span>: flex;</span></span><br><span class="language-css"><span class="language-xml">  <span class="hljs-attribute">align-items</span>: center;</span></span><br><span class="language-css"><span class="language-xml">  <span class="hljs-attribute">justify-content</span>: center;</span></span><br><span class="language-css"><span class="language-xml">  <span class="hljs-selector-class">.logo-title</span> &#123;</span></span><br><span class="language-css"><span class="language-xml">    <span class="hljs-attribute">margin-left</span>: <span class="hljs-number">10px</span>;</span></span><br><span class="language-css"><span class="language-xml">    <span class="hljs-attribute">color</span>: <span class="hljs-number">#fff</span>;</span></span><br><span class="language-css"><span class="language-xml">    <span class="hljs-attribute">font-weight</span>: <span class="hljs-number">600</span>;</span></span><br><span class="language-css"><span class="language-xml">    <span class="hljs-attribute">line-height</span>: <span class="hljs-number">50px</span>;</span></span><br><span class="language-css"><span class="language-xml">    <span class="hljs-attribute">font-size</span>: <span class="hljs-number">16px</span>;</span></span><br><span class="language-css"><span class="language-xml">    <span class="hljs-attribute">white-space</span>: nowrap;</span></span><br><span class="language-css"><span class="language-xml">  &#125;</span></span><br><span class="language-css"><span class="language-xml">&#125;</span></span><br><span class="language-css"><span class="language-xml"></span><span class="hljs-tag">&lt;/<span class="hljs-name">style</span>&gt;</span></span><br><br></code></pre></td></tr></table></figure>

<p>创建 <code>styles/element.scss</code> 文件，统一处理 <code>el-avatar</code> 的背景问题</p>
<figure class="highlight scss"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs scss"><span class="hljs-selector-class">.el-avatar</span> &#123;<br>  <span class="hljs-attr">--el-avatar-background-color</span>: none;<br>&#125;<br></code></pre></td></tr></table></figure>

<p>在 <code>styles/index.scss</code> 中导入</p>
<figure class="highlight scss"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs scss">...<br><span class="hljs-keyword">@import</span> <span class="hljs-string">&#x27;./element.scss&#x27;</span>;<br></code></pre></td></tr></table></figure>

<p>统一处理下动画时长的问题，在 <code>styles/variables.scss</code> 中，加入以下变量</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs css">$sideBarDuration: <span class="hljs-number">0.28s</span>;<br></code></pre></td></tr></table></figure>

<p>为 <code>styles/sidebar.scss</code> 修改时长</p>
<figure class="highlight scss"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs scss"><span class="hljs-selector-class">.main-container</span> &#123;<br>  <span class="hljs-attribute">transition</span>: margin-left #&#123;<span class="hljs-variable">$sideBarDuration</span>&#125;;<br> ...<br>&#125;<br><br><span class="hljs-selector-class">.sidebar-container</span> &#123;<br>  <span class="hljs-attribute">transition</span>: width #&#123;<span class="hljs-variable">$sideBarDuration</span>&#125;;<br>	...<br>&#125;<br></code></pre></td></tr></table></figure>

<p>为 <code>layout/index</code> 修改样式</p>
<figure class="highlight scss"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs scss"><span class="hljs-selector-class">.fixed-header</span> &#123;<br>  ...<br>  <span class="hljs-attribute">transition</span>: width #&#123;<span class="hljs-variable">$sideBarDuration</span>&#125;;<br>&#125;<br></code></pre></td></tr></table></figure>

<h1 id="Vue3-2：组件状态驱动的动态-CSS-值"><a href="#Vue3-2：组件状态驱动的动态-CSS-值" class="headerlink" title="Vue3.2：组件状态驱动的动态 CSS 值"></a>Vue3.2：组件状态驱动的动态 CSS 值</h1><p>在 <a target="_blank" rel="noopener" href="https://blog.vuejs.org/posts/vue-3.2.html">vue 3.2</a> 最新更新中，除了之前我们介绍的 <strong>响应式变化</strong> 之外，还有另外一个很重要的更新，那就是 <strong>组件状态驱动的动态 <code>CSS</code> 值</strong> ，对应的文档也已经公布，大家可以 <a target="_blank" rel="noopener" href="https://v3.vuejs.org/api/sfc-style.html#state-driven-dynamic-css">点击这里</a> 查看</p>
<p>那么下面我们就使用下最新的特性，来为 <code>logo-container</code> 指定下高度：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs js">&lt;template&gt;<br> ...<br> &lt;el-avatar<br> 	:size=<span class="hljs-string">&quot;logoHeight&quot;</span><br> ...<br><br>&lt;/template&gt;<br><br><span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">setup</span>&gt;</span><span class="language-javascript"></span></span><br><span class="language-javascript"><span class="language-xml">...</span></span><br><span class="language-javascript"><span class="language-xml"><span class="hljs-keyword">const</span> logoHeight = <span class="hljs-number">44</span></span></span><br><span class="language-javascript"><span class="language-xml"></span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span></span><br><br><span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">style</span> <span class="hljs-attr">lang</span>=<span class="hljs-string">&quot;scss&quot;</span> <span class="hljs-attr">scoped</span>&gt;</span><span class="language-css"></span></span><br><span class="language-css"><span class="language-xml"><span class="hljs-selector-class">.logo-container</span> &#123;</span></span><br><span class="language-css"><span class="language-xml">  <span class="hljs-attribute">height</span>: <span class="hljs-built_in">v-bind</span>(logoHeight) + <span class="hljs-string">&#x27;px&#x27;</span>;</span></span><br><span class="language-css"><span class="language-xml">...</span></span><br><span class="language-css"><span class="language-xml">&#125;</span></span><br><span class="language-css"><span class="language-xml"></span><span class="hljs-tag">&lt;/<span class="hljs-name">style</span>&gt;</span></span><br><br></code></pre></td></tr></table></figure>

<h1 id="动态面包屑方案分析"><a href="#动态面包屑方案分析" class="headerlink" title="动态面包屑方案分析"></a>动态面包屑方案分析</h1><p>面包屑导航分为：</p>
<ol>
<li>静态面包屑</li>
<li>动态面包屑</li>
</ol>
<p><strong>静态面包屑：</strong></p>
<p>指的是：<strong>在每个页面中写死对应的面包屑菜单</strong>，缺点也很明显：</p>
<ol>
<li>每个页面都得写一遍</li>
<li>页面路径结构变化了，得手动更改</li>
</ol>
<p>简单来说就是 <strong>不好维护，不好扩展</strong> 。</p>
<p><strong>动态面包屑：</strong></p>
<p>根据当前的 <code>url</code> 自动生成面包屑导航菜单</p>
<p>无论之后路径发生了什么变化，<strong>动态面包屑</strong> 都会正确的进行计算</p>
<p>那么在后面的实现过程中，我们将会分成三大步来实现</p>
<ol>
<li>创建、渲染基本的面包屑组件</li>
<li>计算面包屑结构数据</li>
<li>根据数据渲染动态面包屑内容</li>
</ol>
<h2 id="渲染基本的面包屑组件"><a href="#渲染基本的面包屑组件" class="headerlink" title="渲染基本的面包屑组件"></a>渲染基本的面包屑组件</h2><p>完成第一步，先去创建并渲染出基本的 <a target="_blank" rel="noopener" href="https://element-plus.org/#/zh-CN/component/breadcrumb">面包屑</a> 组件</p>
<p>创建 <code>components/Breadcrumb/index</code>，并写入如下代码：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><code class="hljs js">&lt;template&gt;<br>  <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">el-breadcrumb</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;breadcrumb&quot;</span> <span class="hljs-attr">separator</span>=<span class="hljs-string">&quot;/&quot;</span>&gt;</span></span><br><span class="language-xml">    <span class="hljs-tag">&lt;<span class="hljs-name">el-breadcrumb-item</span> <span class="hljs-attr">:to</span>=<span class="hljs-string">&quot;&#123; path: &#x27;/&#x27; &#125;&quot;</span>&gt;</span>首页<span class="hljs-tag">&lt;/<span class="hljs-name">el-breadcrumb-item</span>&gt;</span></span><br><span class="language-xml">    <span class="hljs-tag">&lt;<span class="hljs-name">el-breadcrumb-item</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">&quot;/&quot;</span>&gt;</span>活动管理<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">el-breadcrumb-item</span>&gt;</span></span><br><span class="language-xml">    <span class="hljs-tag">&lt;<span class="hljs-name">el-breadcrumb-item</span>&gt;</span>活动列表<span class="hljs-tag">&lt;/<span class="hljs-name">el-breadcrumb-item</span>&gt;</span></span><br><span class="language-xml">    <span class="hljs-comment">&lt;!-- 面包屑的最后一项 --&gt;</span></span><br><span class="language-xml">    <span class="hljs-tag">&lt;<span class="hljs-name">el-breadcrumb-item</span>&gt;</span></span><br><span class="language-xml">      <span class="hljs-tag">&lt;<span class="hljs-name">span</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;no-redirect&quot;</span>&gt;</span>活动详情<span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span></span><br><span class="language-xml">    <span class="hljs-tag">&lt;/<span class="hljs-name">el-breadcrumb-item</span>&gt;</span></span><br><span class="language-xml">  <span class="hljs-tag">&lt;/<span class="hljs-name">el-breadcrumb</span>&gt;</span></span><br>&lt;/template&gt;<br><br><span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">setup</span>&gt;</span><span class="language-javascript"></span></span><br><span class="language-javascript"><span class="language-xml"><span class="hljs-keyword">import</span> &#123;&#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;vue&#x27;</span></span></span><br><span class="language-javascript"><span class="language-xml"></span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span></span><br><br><span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">style</span> <span class="hljs-attr">lang</span>=<span class="hljs-string">&quot;scss&quot;</span> <span class="hljs-attr">scoped</span>&gt;</span><span class="language-css"></span></span><br><span class="language-css"><span class="language-xml"><span class="hljs-selector-class">.breadcrumb</span> &#123;</span></span><br><span class="language-css"><span class="language-xml">  <span class="hljs-attribute">display</span>: inline-block;</span></span><br><span class="language-css"><span class="language-xml">  <span class="hljs-attribute">font-size</span>: <span class="hljs-number">14px</span>;</span></span><br><span class="language-css"><span class="language-xml">  <span class="hljs-attribute">line-height</span>: <span class="hljs-number">50px</span>;</span></span><br><span class="language-css"><span class="language-xml">  <span class="hljs-attribute">margin-left</span>: <span class="hljs-number">8px</span>;</span></span><br><span class="language-css"><span class="language-xml"></span></span><br><span class="language-css"><span class="language-xml">  ::v-deep .no-redirect &#123;</span></span><br><span class="language-css"><span class="language-xml">    <span class="hljs-attribute">color</span>: <span class="hljs-number">#97a8be</span>;</span></span><br><span class="language-css"><span class="language-xml">    <span class="hljs-attribute">cursor</span>: text;</span></span><br><span class="language-css"><span class="language-xml">  &#125;</span></span><br><span class="language-css"><span class="language-xml">&#125;</span></span><br><span class="language-css"><span class="language-xml"></span><span class="hljs-tag">&lt;/<span class="hljs-name">style</span>&gt;</span></span><br><br></code></pre></td></tr></table></figure>

<p>在 <code>layout/components/Navbar</code> 组件下导入</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs js">&lt;template&gt;<br>  <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;navbar&quot;</span>&gt;</span></span><br><span class="language-xml">    <span class="hljs-tag">&lt;<span class="hljs-name">hamburger</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;hamburger-container&quot;</span> /&gt;</span></span><br><span class="language-xml">    <span class="hljs-tag">&lt;<span class="hljs-name">breadcrumb</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;breadcrumb-container&quot;</span> /&gt;</span></span><br><span class="language-xml">	...</span><br><span class="language-xml">  <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span><br>&lt;/template&gt;<br>...<br><br>&lt;style lang=<span class="hljs-string">&quot;scss&quot;</span> scoped&gt;<br>.<span class="hljs-property">navbar</span> &#123;<br> ...<br><br>  .<span class="hljs-property">breadcrumb</span>-container &#123;<br>    <span class="hljs-attr">float</span>: left;<br>  &#125;<br>   ...<br>&#125;<br>&lt;/style&gt;<br><br></code></pre></td></tr></table></figure>

<h2 id="动态计算面包屑结构数据"><a href="#动态计算面包屑结构数据" class="headerlink" title="动态计算面包屑结构数据"></a>动态计算面包屑结构数据</h2><p>现在我们是完成了一个静态的 面包屑，接下来咱们就需要依托这个静态的菜单来完成动态的。</p>
<p>对于现在的静态面包屑来说，他分成了两个组件：</p>
<ol>
<li><code>el-breadcrumb</code>：包裹性质的容器</li>
<li><code>el-breadcrumb-item</code>：每个单独项</li>
</ol>
<p>如果我们想要完成动态的，那么就需要 *<em>依据动态数据，渲染 <code>el-breadcrumb-item</code> *</em></p>
<p>所以说接下来我们需要做的事情就很简单了</p>
<ol>
<li>动态数据</li>
<li>渲染 <code>el-breadcrumb-item</code></li>
</ol>
<p>咱们先来看 <strong>动态数据如何制作</strong></p>
<p>我们希望可以制作出一个 <strong>数组</strong>，数组中每个 <code>item</code> 都表示一个 <strong>路由信息</strong>：</p>
<p>创建一个方法，用来生成数组数据，在这里我们要使用到 <a target="_blank" rel="noopener" href="https://next.router.vuejs.org/zh/api/#matched">route.match</a> 属性来：<strong>获取与给定路由地址匹配的<a target="_blank" rel="noopener" href="https://next.router.vuejs.org/zh/api/#routerecord">标准化的路由记录</a>数组</strong></p>
<p>如何理解上面这句话呢？其实我们将 <code>route.matched</code> 打印出来就可以发现，你每次切换菜单（或者说更换了路由），打印出来的就是当前路由的路由表（包含父级、子集的路由信息）。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><code class="hljs js">&lt;script setup&gt;<br><span class="hljs-keyword">import</span> &#123; ref, reactive, watch &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;vue&#x27;</span><br><span class="hljs-keyword">import</span> &#123; useRoute, <span class="hljs-title class_">RouteRecordRaw</span> &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;vue-router&#x27;</span><br><br><span class="hljs-keyword">const</span> breadcrumbData = ref&lt;<span class="hljs-title class_">RouteRecordRaw</span>[]&gt;([]) <span class="hljs-comment">// 存放计算出的面包屑数据</span><br><br><span class="hljs-keyword">const</span> route = <span class="hljs-title function_">useRoute</span>()<br><br><span class="hljs-keyword">const</span> <span class="hljs-title function_">getBreadcrumbData</span> = (<span class="hljs-params"></span>) =&gt; &#123;<br>  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(route.<span class="hljs-property">matched</span>)<br><br>  <span class="hljs-comment">// 只有存在 meta 并且 meta.title 的路由，我们才会显示到面包屑中</span><br>  <span class="hljs-comment">// 就像 menu 菜单一样，类似 404 login 的我们不要显示</span><br>  breadcrumbData.<span class="hljs-property">value</span> = route.<span class="hljs-property">matched</span>.<span class="hljs-title function_">filter</span>(<span class="hljs-function"><span class="hljs-params">r</span> =&gt;</span> r.<span class="hljs-property">meta</span> &amp;&amp; r.<span class="hljs-property">meta</span>.<span class="hljs-property">title</span>)<br>&#125;<br><br><span class="hljs-comment">// 监听路由变化时触发</span><br><span class="hljs-title function_">watch</span>(<br>  route,<br>  <span class="hljs-function">() =&gt;</span> &#123;<br>    <span class="hljs-title function_">getBreadcrumbData</span>()<br>  &#125;,<br>  &#123;<br>    <span class="hljs-attr">immediate</span>: <span class="hljs-literal">true</span><br>  &#125;<br>)<br>&lt;/script&gt;<br></code></pre></td></tr></table></figure>

<h2 id="依据动态数据，渲染面包屑"><a href="#依据动态数据，渲染面包屑" class="headerlink" title="依据动态数据，渲染面包屑"></a>依据动态数据，渲染面包屑</h2><p>有了数据之后，根据数据来去渲染面包屑就比较简单了。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br></pre></td><td class="code"><pre><code class="hljs vue">&lt;template&gt;<br>  &lt;el-breadcrumb class=&quot;breadcrumb&quot; separator=&quot;/&quot;&gt;<br>    &lt;el-breadcrumb-item<br>      v-for=&quot;(item, index) in breadcrumbData&quot;<br>      :key=&quot;item.path&quot;<br>    &gt;<br>      &lt;!-- 不可点击项 --&gt;<br>      &lt;span v-if=&quot;index === breadcrumbData.length - 1&quot; class=&quot;no-redirect&quot;&gt;&#123;&#123;<br>        item.meta.title<br>      &#125;&#125;&lt;/span&gt;<br>      &lt;!-- 可点击项 --&gt;<br>      &lt;a v-else class=&quot;redirect&quot; @click.prevent=&quot;onLinkClick(item)&quot;&gt;&#123;&#123;<br>        item.meta.title<br>      &#125;&#125;&lt;/a&gt;<br>    &lt;/el-breadcrumb-item&gt;<br>  &lt;/el-breadcrumb&gt;<br>&lt;/template&gt;<br><br>&lt;script setup&gt;<br>import &#123; ref, watch &#125; from &#x27;vue&#x27;<br>import &#123; useRoute, useRouter, RouteRecordRaw &#125; from &#x27;vue-router&#x27;<br>import &#123; useStore &#125; from &#x27;vuex&#x27;<br><br>const breadcrumbData = ref&lt;RouteRecordRaw[]&gt;([]) // 存放计算出的面包屑数据<br><br>const store = useStore()<br>const route = useRoute()<br>const router = useRouter()<br>const getBreadcrumbData = () =&gt; &#123;<br>  console.log(route.matched)<br><br>  // 只有存在 meta 并且 meta.title 的路由，我们才会显示到面包屑中<br>  // 就像 menu 菜单一样，类似 404 login 的我们不要显示<br>  breadcrumbData.value = route.matched.filter(r =&gt; r.meta &amp;&amp; r.meta.title)<br>&#125;<br><br>watch(<br>  route,<br>  () =&gt; &#123;<br>    getBreadcrumbData()<br>  &#125;,<br>  &#123;<br>    immediate: true<br>  &#125;<br>)<br><br>// 跳转路由<br>const onLinkClick = (item: RouteRecordRaw) =&gt; &#123;<br>  router.push(item.path)<br>&#125;<br><br>// 将来需要进行主题替换，所以这里获取下动态样式<br>const linkHoverColor = ref(store.getters.cssVars.menuBg)<br>&lt;/script&gt;<br><br>&lt;style lang=&quot;scss&quot; scoped&gt;<br>.breadcrumb &#123;<br> ...<br><br>  .redirect &#123;<br>    color: #666;<br>    font-weight: 600;<br>  &#125;<br><br>  .redirect:hover &#123;<br>    color: v-bind(linkHoverColor); // 应对主题切换<br>  &#125;<br>&#125;<br>&lt;/style&gt;<br><br></code></pre></td></tr></table></figure>

<h2 id="面包屑动画"><a href="#面包屑动画" class="headerlink" title="面包屑动画"></a>面包屑动画</h2><p>vue3对 <a target="_blank" rel="noopener" href="https://v3.cn.vuejs.org/guide/transitions-overview.html#%E5%9F%BA%E4%BA%8E-class-%E7%9A%84%E5%8A%A8%E7%94%BB%E5%92%8C%E8%BF%87%E6%B8%A1">动画</a> 进行了一些修改（<a target="_blank" rel="noopener" href="https://v3.cn.vuejs.org/guide/migration/transition.html#%E6%A6%82%E8%A7%88">vue 动画迁移文档</a>）</p>
<p>主要的修改其实只有两个：</p>
<ol>
<li>过渡类名 <code>v-enter</code> 修改为 <code>v-enter-from</code></li>
<li>过渡类名 <code>v-leave</code> 修改为 <code>v-leave-from</code></li>
</ol>
<p>那么依据修改之后的动画，我们来为面包屑增加一些动画样式：</p>
<ol>
<li>在 <code>Breadcrumb/index</code> 中增加 <code>transition-group</code></li>
</ol>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs js">&lt;template&gt;<br>  <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">el-breadcrumb</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;breadcrumb&quot;</span> <span class="hljs-attr">separator</span>=<span class="hljs-string">&quot;/&quot;</span>&gt;</span></span><br><span class="language-xml">    <span class="hljs-tag">&lt;<span class="hljs-name">transition-group</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;breadcrumb&quot;</span>&gt;</span></span><br><span class="language-xml">      ...</span><br><span class="language-xml">    <span class="hljs-tag">&lt;/<span class="hljs-name">transition-group</span>&gt;</span></span><br><span class="language-xml">  <span class="hljs-tag">&lt;/<span class="hljs-name">el-breadcrumb</span>&gt;</span></span><br>&lt;/template&gt;<br></code></pre></td></tr></table></figure>

<ol start="2">
<li>新建 <code>styles/transition</code> 样式文件</li>
</ol>
<figure class="highlight scss"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs scss"><span class="hljs-selector-class">.breadcrumb-enter-active</span>,<br><span class="hljs-selector-class">.breadcrumb-leave-active</span> &#123;<br>  <span class="hljs-attribute">transition</span>: all <span class="hljs-number">0.5s</span>;<br>&#125;<br><br><span class="hljs-selector-class">.breadcrumb-enter-from</span>,<br><span class="hljs-selector-class">.breadcrumb-leave-active</span> &#123;<br>  <span class="hljs-attribute">opacity</span>: <span class="hljs-number">0</span>;<br>  <span class="hljs-attribute">transform</span>: translateX(<span class="hljs-number">20px</span>);<br>&#125;<br><br><span class="hljs-selector-class">.breadcrumb-leave-active</span> &#123;<br>  <span class="hljs-attribute">position</span>: absolute;<br>&#125;<br></code></pre></td></tr></table></figure>

<ol start="3">
<li>在 <code>styles/index</code> 中导入</li>
</ol>
<figure class="highlight scss"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs scss"><span class="hljs-keyword">@import</span> <span class="hljs-string">&#x27;./transition.scss&#x27;</span>;<br></code></pre></td></tr></table></figure>

<h1 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h1><p>到这里我们的 layout 整体架构就已经做完了，我们来看看效果吧。</p>
<p><img src="/img/layout-result.png" srcset="/img/loading.gif" lazyload alt=""></p>

            </div>
            <hr>
            <div>
              <div class="post-metas mb-3">
                
                
                  <div class="post-meta">
                    <i class="iconfont icon-tags"></i>
                    
                      <a class="hover-with-bg" href="/tags/%E5%B7%A5%E7%A8%8B%E5%8C%96-Vue3/">工程化,Vue3</a>
                    
                  </div>
                
              </div>
              
                <p class="note note-warning">
                  
                    本博客所有文章除特别声明外，均采用 <a target="_blank" href="https://creativecommons.org/licenses/by-sa/4.0/deed.zh" rel="nofollow noopener noopener">CC BY-SA 4.0 协议</a> ，转载请注明出处！
                  
                </p>
              
              
                <div class="post-prevnext">
                  <article class="post-prev col-6">
                    
                    
                      <a href="/post/vue3-project-generalModule.html">
                        <i class="iconfont icon-arrowleft"></i>
                        <span class="hidden-mobile">Vue3项目实战(五)：通用功能开发（一）</span>
                        <span class="visible-mobile">上一篇</span>
                      </a>
                    
                  </article>
                  <article class="post-next col-6">
                    
                    
                      <a href="/post/vue3-project-generalLogin.html">
                        <span class="hidden-mobile">Vue3项目实战(三)：登录/请求模块/鉴权</span>
                        <span class="visible-mobile">下一篇</span>
                        <i class="iconfont icon-arrowright"></i>
                      </a>
                    
                  </article>
                </div>
              
            </div>

            
              <!-- Comments -->
              <article class="comments" id="comments" lazyload>
                
                  
                
                
  <div class="disqus" style="width:100%">
    <div id="disqus_thread"></div>
    
      <script type="text/javascript">
        var disqus_config = function() {
          this.page.url = 'http://yoursite.com/post/vue3-project-layout.html';
          this.page.identifier = '/post/vue3-project-layout.html';
        };
        Fluid.utils.loadComments('#disqus_thread', function() {
          var d = document, s = d.createElement('script');
          s.src = '//' + 'helloalexcc' + '.disqus.com/embed.js';
          s.setAttribute('data-timestamp', new Date());
          (d.head || d.body).appendChild(s);
        });
      </script>
    
    <noscript>Please enable JavaScript to view the comments</noscript>
  </div>


              </article>
            
          </article>
        </div>
      </div>
    </div>
    
      <div class="d-none d-lg-block col-lg-2 toc-container" id="toc-ctn">
        <div id="toc">
  <p class="toc-header"><i class="iconfont icon-list"></i>&nbsp;目录</p>
  <div class="toc-body" id="toc-body"></div>
</div>

      </div>
    
  </div>
</div>

<!-- Custom -->


    

    
      <a id="scroll-top-button" aria-label="TOP" href="#" role="button">
        <i class="iconfont icon-arrowup" aria-hidden="true"></i>
      </a>
    

    
      <div class="modal fade" id="modalSearch" tabindex="-1" role="dialog" aria-labelledby="ModalLabel"
     aria-hidden="true">
  <div class="modal-dialog modal-dialog-scrollable modal-lg" role="document">
    <div class="modal-content">
      <div class="modal-header text-center">
        <h4 class="modal-title w-100 font-weight-bold">搜索</h4>
        <button type="button" id="local-search-close" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body mx-3">
        <div class="md-form mb-5">
          <input type="text" id="local-search-input" class="form-control validate">
          <label data-error="x" data-success="v"
                 for="local-search-input">关键词</label>
        </div>
        <div class="list-group" id="local-search-result"></div>
      </div>
    </div>
  </div>
</div>
    

    
  </main>

  <footer class="text-center mt-5 py-3">
  <div class="footer-content">
     <a href="https://hello-alex-cheng.github.io/" target="_blank" rel="nofollow noopener"><span>I</span></a> <i class="iconfont icon-love"></i> <a href="https://hello-alex-cheng.github.io/" target="_blank" rel="nofollow noopener"><span>YOU</span></a> 
  </div>
  

  

  
</footer>


  <!-- SCRIPTS -->
  
  <script  src="https://cdn.jsdelivr.net/npm/nprogress@0/nprogress.min.js" ></script>
  <link  rel="stylesheet" href="https://cdn.jsdelivr.net/npm/nprogress@0/nprogress.min.css" />

  <script>
    NProgress.configure({"showSpinner":false,"trickleSpeed":100})
    NProgress.start()
    window.addEventListener('load', function() {
      NProgress.done();
    })
  </script>


<script  src="https://cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js" ></script>
<script  src="https://cdn.jsdelivr.net/npm/bootstrap@4/dist/js/bootstrap.min.js" ></script>
<script  src="/js/events.js" ></script>
<script  src="/js/plugins.js" ></script>

<!-- Plugins -->


  <script  src="/js/local-search.js" ></script>



  
    <script  src="/js/img-lazyload.js" ></script>
  



  



  
    <script  src="https://cdn.jsdelivr.net/npm/tocbot@4/dist/tocbot.min.js" ></script>
  
  
    <script  src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3/dist/jquery.fancybox.min.js" ></script>
  
  
    <script  src="https://cdn.jsdelivr.net/npm/anchor-js@4/anchor.min.js" ></script>
  
  
    <script defer src="https://cdn.jsdelivr.net/npm/clipboard@2/dist/clipboard.min.js" ></script>
  






  <script  src="https://cdn.jsdelivr.net/npm/typed.js@2/lib/typed.min.js" ></script>
  <script>
    (function (window, document) {
      var typing = Fluid.plugins.typing;
      var title = document.getElementById('subtitle').title;
      
        typing(title);
      
    })(window, document);
  </script>















<!-- 主题的启动项 保持在最底部 -->
<script  src="/js/boot.js" ></script>


</body>
</html>
