

<!DOCTYPE html>
<html lang="zh-CN" data-default-color-scheme=auto>



<head>
  <meta charset="UTF-8">
  <link rel="apple-touch-icon" sizes="76x76" href="/img/favicon.png">
  <link rel="icon" href="/img/favicon.png">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, shrink-to-fit=no">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  
  <meta name="theme-color" content="#2f4154">
  <meta name="author" content="Hello_AlexCc">
  <meta name="keywords" content="Full stack engineer">
  
    <meta name="description" content="screenfull&#x2F;headerSearch&#x2F;tagView&#x2F;guide">
<meta property="og:type" content="article">
<meta property="og:title" content="Vue3项目实战(六)：通用功能开发(二)">
<meta property="og:url" content="http://yoursite.com/post/vue3-project-generalModule2.html">
<meta property="og:site_name" content="Hello_AlexCc">
<meta property="og:description" content="screenfull&#x2F;headerSearch&#x2F;tagView&#x2F;guide">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="http://yoursite.com/img/general2.png">
<meta property="article:published_time" content="2023-01-01T06:53:36.000Z">
<meta property="article:modified_time" content="2024-06-11T08:52:17.354Z">
<meta property="article:author" content="Hello_AlexCc">
<meta property="article:tag" content="工程化,Vue3,通用功能">
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:image" content="http://yoursite.com/img/general2.png">
  
  
  <title>Vue3项目实战(六)：通用功能开发(二) - Hello_AlexCc</title>

  <link  rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4/dist/css/bootstrap.min.css" />


  <link  rel="stylesheet" href="https://cdn.jsdelivr.net/npm/github-markdown-css@4/github-markdown.min.css" />
  <link  rel="stylesheet" href="https://cdn.jsdelivr.net/npm/hint.css@2/hint.min.css" />

  
    
    
      
      <link  rel="stylesheet" href="https://cdn.jsdelivr.net/npm/highlight.js@10/styles/github-gist.min.css" />
    
  

  
    <link  rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3/dist/jquery.fancybox.min.css" />
  


<!-- 主题依赖的图标库，不要自行修改 -->

<link rel="stylesheet" href="//at.alicdn.com/t/font_1749284_ba1fz6golrf.css">



<link rel="stylesheet" href="//at.alicdn.com/t/font_1736178_lbnruvf0jn.css">


<link  rel="stylesheet" href="/css/main.css" />

<!-- 自定义样式保持在最底部 -->


  <script id="fluid-configs">
    var Fluid = window.Fluid || {};
    var CONFIG = {"hostname":"yoursite.com","root":"/","version":"1.8.14","typing":{"enable":true,"typeSpeed":70,"cursorChar":"_","loop":false},"anchorjs":{"enable":true,"element":"h1,h2,h3,h4,h5,h6","placement":"right","visible":"hover","icon":""},"progressbar":{"enable":true,"height_px":3,"color":"#29d","options":{"showSpinner":false,"trickleSpeed":100}},"copy_btn":true,"image_zoom":{"enable":true,"img_url_replace":["",""]},"toc":{"enable":true,"headingSelector":"h1,h2,h3,h4,h5,h6","collapseDepth":0},"lazyload":{"enable":true,"loading_img":"/img/loading.gif","onlypost":false,"offset_factor":2},"web_analytics":{"enable":false,"baidu":null,"google":null,"gtag":null,"tencent":{"sid":null,"cid":null},"woyaola":null,"cnzz":null,"leancloud":{"app_id":null,"app_key":null,"server_url":null,"path":"window.location.pathname","ignore_local":false}},"search_path":"/local-search.xml"};
  </script>
  <script  src="/js/utils.js" ></script>
  <script  src="/js/color-schema.js" ></script>
<meta name="generator" content="Hexo 6.1.0"></head>


<body>
  <header style="height: 70vh;">
    <nav id="navbar" class="navbar fixed-top  navbar-expand-lg navbar-dark scrolling-navbar">
  <div class="container">
    <a class="navbar-brand" href="/">
      <strong>Hello_AlexCc</strong>
    </a>

    <button id="navbar-toggler-btn" class="navbar-toggler" type="button" data-toggle="collapse"
            data-target="#navbarSupportedContent"
            aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
      <div class="animated-icon"><span></span><span></span><span></span></div>
    </button>

    <!-- Collapsible content -->
    <div class="collapse navbar-collapse" id="navbarSupportedContent">
      <ul class="navbar-nav ml-auto text-center">
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/">
                <i class="iconfont icon-home-fill"></i>
                首页
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/archives/">
                <i class="iconfont icon-archive-fill"></i>
                归档
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/categories/">
                <i class="iconfont icon-category-fill"></i>
                分类
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/tags/">
                <i class="iconfont icon-tags-fill"></i>
                标签
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/about/">
                <i class="iconfont icon-user-fill"></i>
                关于
              </a>
            </li>
          
        
        
          <li class="nav-item" id="search-btn">
            <a class="nav-link" target="_self" href="javascript:;" data-toggle="modal" data-target="#modalSearch" aria-label="Search">
              &nbsp;<i class="iconfont icon-search"></i>&nbsp;
            </a>
          </li>
        
        
          <li class="nav-item" id="color-toggle-btn">
            <a class="nav-link" target="_self" href="javascript:;" aria-label="Color Toggle">&nbsp;<i
                class="iconfont icon-dark" id="color-toggle-icon"></i>&nbsp;</a>
          </li>
        
      </ul>
    </div>
  </div>
</nav>

    <div class="banner" id="banner" parallax=true
         style="background: url('/img/general2.png') no-repeat center center;
           background-size: cover;">
      <div class="full-bg-img">
        <div class="mask flex-center" style="background-color: rgba(0, 0, 0, 0.3)">
          <div class="page-header text-center fade-in-up">
            <span class="h2" id="subtitle" title="Vue3项目实战(六)：通用功能开发(二)">
              
            </span>

            
              <div class="mt-3">
  
  
    <span class="post-meta">
      <i class="iconfont icon-date-fill" aria-hidden="true"></i>
      <time datetime="2023-01-01 14:53" pubdate>
        2023年1月1日 下午
      </time>
    </span>
  
</div>

<div class="mt-1">
  
    <span class="post-meta mr-2">
      <i class="iconfont icon-chart"></i>
      21k 字
    </span>
  

  
    <span class="post-meta mr-2">
      <i class="iconfont icon-clock-fill"></i>
      
      
      180 分钟
    </span>
  

  
  
</div>

            
          </div>

          
        </div>
      </div>
    </div>
  </header>

  <main>
    
      

<div class="container-fluid nopadding-x">
  <div class="row nomargin-x">
    <div class="d-none d-lg-block col-lg-2"></div>
    <div class="col-lg-8 nopadding-x-md">
      <div class="container nopadding-x-md" id="board-ctn">
        <div class="py-5" id="board">
          <article class="post-content mx-auto">
            <!-- SEO header -->
            <h1 style="display: none">Vue3项目实战(六)：通用功能开发(二)</h1>
            
            <div class="markdown-body">
              <h1 id="screenfull"><a href="#screenfull" class="headerlink" title="screenfull"></a>screenfull</h1><p>对于 <code>screenfull</code> 和之前一样 ，我们还是先分析它的原理，然后在制定对应的方案实现</p>
<p><strong>原理：</strong></p>
<p>对于 <code>screenfull</code> 而言，浏览器本身已经提供了对用的 <code>API</code>，<a target="_blank" rel="noopener" href="https://developer.mozilla.org/zh-CN/docs/Web/API/Fullscreen_API">点击这里即可查看</a>，这个 <code>API</code> 中，主要提供了两个方法：</p>
<ol>
<li><a target="_blank" rel="noopener" href="https://developer.mozilla.org/zh-CN/docs/Web/API/Document/exitFullscreen"><code>Document.exitFullscreen()</code></a>：该方法用于请求从全屏模式切换到窗口模式</li>
<li><a target="_blank" rel="noopener" href="https://developer.mozilla.org/zh-CN/docs/Web/API/Element/requestFullScreen"><code>Element.requestFullscreen()</code></a>：该方法用于请求浏览器（user agent）将特定元素（甚至延伸到它的后代元素）置为全屏模式<ol>
<li>比如我们可以通过 <code>document.getElementById(&#39;app&#39;).requestFullscreen()</code> 在获取 <code>id=app</code> 的 <code>DOM</code> 之后，把该区域置为全屏</li>
</ol>
</li>
</ol>
<p>但是该方法存在一定的小问题，兼容性也不是那么好。</p>
<p>所以通常情况下我们不会直接使用该 <code>API</code> 来去实现全屏效果，而是会使用它的包装库 <a target="_blank" rel="noopener" href="https://www.npmjs.com/package/screenfull">screenfull</a></p>
<p>整体的方案实现分为两步：</p>
<ol>
<li>封装 <code>screenfull</code> 组件<ol>
<li>展示切换按钮</li>
<li>基于 <a target="_blank" rel="noopener" href="https://www.npmjs.com/package/screenfull">screenfull</a> 实现切换功能</li>
</ol>
</li>
<li>在 <code>navbar</code> 中引入该组件</li>
</ol>
<p>明确好了方案之后，接下来我们就落地该方案</p>
<p><strong>封装 <code>screenfull</code> 组件：</strong></p>
<ol>
<li>下来依赖包  <a target="_blank" rel="noopener" href="https://www.npmjs.com/package/screenfull">screenfull</a> </li>
</ol>
<figure class="highlight apache"><table><tr><td class="gutter"><div class="code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">npm</span> i screenfull@<span class="hljs-number">5</span>.<span class="hljs-number">1</span>.<span class="hljs-number">0</span> -S<br></code></pre></td></tr></table></figure>

<ol start="2">
<li>创建 <code>components/Screenfull/index</code></li>
</ol>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><code class="hljs js">&lt;template&gt;<br>  <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span></span><br><span class="language-xml">    <span class="hljs-tag">&lt;<span class="hljs-name">svg-icon</span></span></span><br><span class="hljs-tag"><span class="language-xml">      <span class="hljs-attr">:icon</span>=<span class="hljs-string">&quot;isFullscreen ? &#x27;exit-fullscreen&#x27; : &#x27;fullscreen&#x27;&quot;</span></span></span><br><span class="hljs-tag"><span class="language-xml">      @<span class="hljs-attr">click</span>=<span class="hljs-string">&quot;onToggle&quot;</span></span></span><br><span class="hljs-tag"><span class="language-xml">    /&gt;</span></span><br><span class="language-xml">  <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span><br>&lt;/template&gt;<br><br><span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">setup</span>&gt;</span><span class="language-javascript"></span></span><br><span class="language-javascript"><span class="language-xml"><span class="hljs-keyword">import</span> &#123; ref, onMounted, onUnmounted &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;vue&#x27;</span></span></span><br><span class="language-javascript"><span class="language-xml"><span class="hljs-keyword">import</span> screenfull <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;screenfull&#x27;</span></span></span><br><span class="language-javascript"><span class="language-xml"></span></span><br><span class="language-javascript"><span class="language-xml"><span class="hljs-comment">// 是否全屏</span></span></span><br><span class="language-javascript"><span class="language-xml"><span class="hljs-keyword">const</span> isFullscreen = <span class="hljs-title function_">ref</span>(<span class="hljs-literal">false</span>)</span></span><br><span class="language-javascript"><span class="language-xml"></span></span><br><span class="language-javascript"><span class="language-xml"><span class="hljs-comment">// 切换事件</span></span></span><br><span class="language-javascript"><span class="language-xml"><span class="hljs-keyword">const</span> <span class="hljs-title function_">onToggle</span> = (<span class="hljs-params"></span>) =&gt; &#123;</span></span><br><span class="language-javascript"><span class="language-xml">  <span class="hljs-keyword">if</span> (screenfull.<span class="hljs-property">isEnabled</span>) &#123;</span></span><br><span class="language-javascript"><span class="language-xml">    screenfull.<span class="hljs-title function_">toggle</span>()</span></span><br><span class="language-javascript"><span class="language-xml">  &#125;</span></span><br><span class="language-javascript"><span class="language-xml">&#125;</span></span><br><span class="language-javascript"><span class="language-xml"></span></span><br><span class="language-javascript"><span class="language-xml"><span class="hljs-comment">// 监听变化</span></span></span><br><span class="language-javascript"><span class="language-xml"><span class="hljs-keyword">const</span> <span class="hljs-title function_">change</span> = (<span class="hljs-params"></span>) =&gt; &#123;</span></span><br><span class="language-javascript"><span class="language-xml">  <span class="hljs-keyword">if</span> (screenfull.<span class="hljs-property">isEnabled</span>) &#123;</span></span><br><span class="language-javascript"><span class="language-xml">    isFullscreen.<span class="hljs-property">value</span> = screenfull.<span class="hljs-property">isFullscreen</span></span></span><br><span class="language-javascript"><span class="language-xml">  &#125;</span></span><br><span class="language-javascript"><span class="language-xml">&#125;</span></span><br><span class="language-javascript"><span class="language-xml"></span></span><br><span class="language-javascript"><span class="language-xml"><span class="hljs-comment">// 设置侦听器</span></span></span><br><span class="language-javascript"><span class="language-xml"><span class="hljs-title function_">onMounted</span>(<span class="hljs-function">() =&gt;</span> &#123;</span></span><br><span class="language-javascript"><span class="language-xml">  <span class="hljs-keyword">if</span> (screenfull.<span class="hljs-property">isEnabled</span>) &#123;</span></span><br><span class="language-javascript"><span class="language-xml">    screenfull.<span class="hljs-title function_">on</span>(<span class="hljs-string">&#x27;change&#x27;</span>, change)</span></span><br><span class="language-javascript"><span class="language-xml">  &#125;</span></span><br><span class="language-javascript"><span class="language-xml">&#125;)</span></span><br><span class="language-javascript"><span class="language-xml"></span></span><br><span class="language-javascript"><span class="language-xml"><span class="hljs-comment">// 删除侦听器</span></span></span><br><span class="language-javascript"><span class="language-xml"><span class="hljs-title function_">onUnmounted</span>(<span class="hljs-function">() =&gt;</span> &#123;</span></span><br><span class="language-javascript"><span class="language-xml">  <span class="hljs-keyword">if</span> (screenfull.<span class="hljs-property">isEnabled</span>) &#123;</span></span><br><span class="language-javascript"><span class="language-xml">    screenfull.<span class="hljs-title function_">off</span>(<span class="hljs-string">&#x27;change&#x27;</span>, change)</span></span><br><span class="language-javascript"><span class="language-xml">  &#125;</span></span><br><span class="language-javascript"><span class="language-xml">&#125;)</span></span><br><span class="language-javascript"><span class="language-xml"></span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span></span><br><br><span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">style</span> <span class="hljs-attr">lang</span>=<span class="hljs-string">&quot;scss&quot;</span> <span class="hljs-attr">scoped</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">style</span>&gt;</span></span><br><br></code></pre></td></tr></table></figure>

<p><strong>在 <code>navbar</code> 中引入该组件：</strong></p>
<figure class="highlight clean"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs clean">&lt;screenfull <span class="hljs-keyword">class</span>=<span class="hljs-string">&quot;right-menu-item hover-effect&quot;</span> /&gt;<br><br>...<br><br><span class="hljs-keyword">import</span> Screenfull <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;@/components/Screenfull&#x27;</span><br></code></pre></td></tr></table></figure>

<h1 id="headerSeach"><a href="#headerSeach" class="headerlink" title="headerSeach"></a>headerSeach</h1><blockquote>
<p>所谓 <code>headerSearch</code> 一般是指 <strong>页面搜索</strong></p>
</blockquote>
<p><strong>原理：</strong></p>
<p><code>headerSearch</code> 是复杂后台系统中非常常见的一个功能，它可以：<strong>在指定搜索框中对当前应用中所有页面进行检索，以 <code>select</code> 的形式展示出被检索的页面，以达到快速进入的目的</strong></p>
<p>那么明确好了 <code>headerSearch</code>  的作用之后，接下来我们来看一下对应的实现原理</p>
<p>根据前面的目的我们可以发现，整个 <code>headerSearch</code> 其实可以分为三个核心的功能点：</p>
<ol>
<li>根据指定内容对所有页面进行检索</li>
<li>以 <code>select</code> 形式展示检索出的页面</li>
<li>通过检索页面可快速进入对应页面</li>
</ol>
<p>那么围绕着这三个核心的功能点，我们想要分析它的原理就非常简单了：<strong>根据指定内容检索所有页面，把检索出的页面以 <code>select</code> 展示，点击对应 <code>option</code> 可进入到指定页面</strong></p>
<p><strong>方案：</strong></p>
<p>对照着三个核心功能点和原理，想要指定对应的实现方案是非常简单的一件事情了</p>
<ol>
<li>创建 <code>headerSearch</code> 组件，用作样式展示和用户输入内容获取</li>
<li>获取所有的页面数据，用作被检索的数据源</li>
<li>根据用户输入内容在数据源中进行模糊搜索(<a target="_blank" rel="noopener" href="https://fusejs.io/">https://fusejs.io/</a>) </li>
<li>把搜索到的内容以 <code>select</code> 进行展示</li>
<li>监听 <code>select</code> 的 <code>change</code> 事件，完成对应跳转</li>
</ol>
<h2 id="headerSearch-组件"><a href="#headerSearch-组件" class="headerlink" title="headerSearch 组件"></a>headerSearch 组件</h2><p>创建 <code>components/headerSearch/index</code> 组件，当点击搜索图标时，通过 <code>transition</code> 动画，将其长度展示出来，并且自动聚焦 <code>focus()</code>:</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br></pre></td><td class="code"><pre><code class="hljs js">&lt;template&gt;<br>  <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">:class</span>=<span class="hljs-string">&quot;&#123; show: isShow &#125;&quot;</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;header-search&quot;</span>&gt;</span></span><br><span class="language-xml">    <span class="hljs-tag">&lt;<span class="hljs-name">svg-icon</span></span></span><br><span class="hljs-tag"><span class="language-xml">      <span class="hljs-attr">class-name</span>=<span class="hljs-string">&quot;search-icon&quot;</span></span></span><br><span class="hljs-tag"><span class="language-xml">      <span class="hljs-attr">icon</span>=<span class="hljs-string">&quot;search&quot;</span></span></span><br><span class="hljs-tag"><span class="language-xml">      @<span class="hljs-attr">click.stop</span>=<span class="hljs-string">&quot;onShowClick&quot;</span></span></span><br><span class="hljs-tag"><span class="language-xml">    /&gt;</span></span><br><span class="language-xml">    <span class="hljs-tag">&lt;<span class="hljs-name">el-select</span></span></span><br><span class="hljs-tag"><span class="language-xml">      <span class="hljs-attr">ref</span>=<span class="hljs-string">&quot;headerSearchSelectRef&quot;</span></span></span><br><span class="hljs-tag"><span class="language-xml">      <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;header-search-select&quot;</span></span></span><br><span class="hljs-tag"><span class="language-xml">      <span class="hljs-attr">v-model</span>=<span class="hljs-string">&quot;search&quot;</span></span></span><br><span class="hljs-tag"><span class="language-xml">      <span class="hljs-attr">filterable</span></span></span><br><span class="hljs-tag"><span class="language-xml">      <span class="hljs-attr">default-first-option</span></span></span><br><span class="hljs-tag"><span class="language-xml">      <span class="hljs-attr">remote</span></span></span><br><span class="hljs-tag"><span class="language-xml">      <span class="hljs-attr">placeholder</span>=<span class="hljs-string">&quot;Search&quot;</span></span></span><br><span class="hljs-tag"><span class="language-xml">      <span class="hljs-attr">:remote-method</span>=<span class="hljs-string">&quot;querySearch&quot;</span></span></span><br><span class="hljs-tag"><span class="language-xml">      @<span class="hljs-attr">change</span>=<span class="hljs-string">&quot;onSelectChange&quot;</span></span></span><br><span class="hljs-tag"><span class="language-xml">    &gt;</span></span><br><span class="language-xml">      <span class="hljs-tag">&lt;<span class="hljs-name">el-option</span></span></span><br><span class="hljs-tag"><span class="language-xml">        <span class="hljs-attr">v-for</span>=<span class="hljs-string">&quot;option in 5&quot;</span></span></span><br><span class="hljs-tag"><span class="language-xml">        <span class="hljs-attr">:key</span>=<span class="hljs-string">&quot;option&quot;</span></span></span><br><span class="hljs-tag"><span class="language-xml">        <span class="hljs-attr">:label</span>=<span class="hljs-string">&quot;option&quot;</span></span></span><br><span class="hljs-tag"><span class="language-xml">        <span class="hljs-attr">:value</span>=<span class="hljs-string">&quot;option&quot;</span></span></span><br><span class="hljs-tag"><span class="language-xml">      &gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">el-option</span>&gt;</span></span><br><span class="language-xml">    <span class="hljs-tag">&lt;/<span class="hljs-name">el-select</span>&gt;</span></span><br><span class="language-xml">  <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span><br>&lt;/template&gt;<br><br><span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">setup</span>&gt;</span><span class="language-javascript"></span></span><br><span class="language-javascript"><span class="language-xml"><span class="hljs-keyword">import</span> &#123; ref &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;vue&#x27;</span></span></span><br><span class="language-javascript"><span class="language-xml"></span></span><br><span class="language-javascript"><span class="language-xml"><span class="hljs-comment">// 控制 search 显示</span></span></span><br><span class="language-javascript"><span class="language-xml"><span class="hljs-keyword">const</span> isShow = <span class="hljs-title function_">ref</span>(<span class="hljs-literal">false</span>)</span></span><br><span class="language-javascript"><span class="language-xml"><span class="hljs-comment">// el-select 实例</span></span></span><br><span class="language-javascript"><span class="language-xml"><span class="hljs-keyword">const</span> headerSearchSelectRef = <span class="hljs-title function_">ref</span>(<span class="hljs-literal">null</span>)</span></span><br><span class="language-javascript"><span class="language-xml"><span class="hljs-keyword">const</span> <span class="hljs-title function_">onShowClick</span> = (<span class="hljs-params"></span>) =&gt; &#123;</span></span><br><span class="language-javascript"><span class="language-xml">  isShow.<span class="hljs-property">value</span> = !isShow.<span class="hljs-property">value</span></span></span><br><span class="language-javascript"><span class="language-xml">  headerSearchSelectRef.<span class="hljs-property">value</span>.<span class="hljs-title function_">focus</span>()</span></span><br><span class="language-javascript"><span class="language-xml">&#125;</span></span><br><span class="language-javascript"><span class="language-xml"></span></span><br><span class="language-javascript"><span class="language-xml"><span class="hljs-comment">// search 相关</span></span></span><br><span class="language-javascript"><span class="language-xml"><span class="hljs-keyword">const</span> search = <span class="hljs-title function_">ref</span>(<span class="hljs-string">&#x27;&#x27;</span>)</span></span><br><span class="language-javascript"><span class="language-xml"><span class="hljs-comment">// 搜索方法</span></span></span><br><span class="language-javascript"><span class="language-xml"><span class="hljs-keyword">const</span> <span class="hljs-title function_">querySearch</span> = (<span class="hljs-params"></span>) =&gt; &#123;</span></span><br><span class="language-javascript"><span class="language-xml">  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&#x27;querySearch&#x27;</span>)</span></span><br><span class="language-javascript"><span class="language-xml">&#125;</span></span><br><span class="language-javascript"><span class="language-xml"><span class="hljs-comment">// 选中回调</span></span></span><br><span class="language-javascript"><span class="language-xml"><span class="hljs-keyword">const</span> <span class="hljs-title function_">onSelectChange</span> = (<span class="hljs-params"></span>) =&gt; &#123;</span></span><br><span class="language-javascript"><span class="language-xml">  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&#x27;onSelectChange&#x27;</span>)</span></span><br><span class="language-javascript"><span class="language-xml">&#125;</span></span><br><span class="language-javascript"><span class="language-xml"></span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span></span><br><br><span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">style</span> <span class="hljs-attr">lang</span>=<span class="hljs-string">&quot;scss&quot;</span> <span class="hljs-attr">scoped</span>&gt;</span><span class="language-css"></span></span><br><span class="language-css"><span class="language-xml"><span class="hljs-selector-class">.header-search</span> &#123;</span></span><br><span class="language-css"><span class="language-xml">  <span class="hljs-attribute">font-size</span>: <span class="hljs-number">0</span> <span class="hljs-meta">!important</span>;</span></span><br><span class="language-css"><span class="language-xml">  <span class="hljs-selector-class">.search-icon</span> &#123;</span></span><br><span class="language-css"><span class="language-xml">    <span class="hljs-attribute">cursor</span>: pointer;</span></span><br><span class="language-css"><span class="language-xml">    <span class="hljs-attribute">font-size</span>: <span class="hljs-number">18px</span>;</span></span><br><span class="language-css"><span class="language-xml">    <span class="hljs-attribute">vertical-align</span>: middle;</span></span><br><span class="language-css"><span class="language-xml">  &#125;</span></span><br><span class="language-css"><span class="language-xml">  <span class="hljs-selector-class">.header-search-select</span> &#123;</span></span><br><span class="language-css"><span class="language-xml">    <span class="hljs-attribute">font-size</span>: <span class="hljs-number">18px</span>;</span></span><br><span class="language-css"><span class="language-xml">    <span class="hljs-attribute">transition</span>: width <span class="hljs-number">0.2s</span>; // <span class="hljs-attribute">width</span> 动画</span></span><br><span class="language-css"><span class="language-xml">    <span class="hljs-attribute">width</span>: <span class="hljs-number">0</span>;</span></span><br><span class="language-css"><span class="language-xml">    <span class="hljs-attribute">overflow</span>: hidden;</span></span><br><span class="language-css"><span class="language-xml">    <span class="hljs-attribute">background</span>: transparent;</span></span><br><span class="language-css"><span class="language-xml">    <span class="hljs-attribute">border-radius</span>: <span class="hljs-number">0</span>;</span></span><br><span class="language-css"><span class="language-xml">    <span class="hljs-attribute">display</span>: inline-block;</span></span><br><span class="language-css"><span class="language-xml">    <span class="hljs-attribute">vertical-align</span>: middle;</span></span><br><span class="language-css"><span class="language-xml"></span></span><br><span class="language-css"><span class="language-xml">    ::v-deep .el-input__inner &#123;</span></span><br><span class="language-css"><span class="language-xml">      <span class="hljs-attribute">border-radius</span>: <span class="hljs-number">0</span>;</span></span><br><span class="language-css"><span class="language-xml">      <span class="hljs-attribute">border</span>: <span class="hljs-number">0</span>;</span></span><br><span class="language-css"><span class="language-xml">      <span class="hljs-attribute">padding-left</span>: <span class="hljs-number">0</span>;</span></span><br><span class="language-css"><span class="language-xml">      <span class="hljs-attribute">padding-right</span>: <span class="hljs-number">0</span>;</span></span><br><span class="language-css"><span class="language-xml">      <span class="hljs-attribute">box-shadow</span>: none <span class="hljs-meta">!important</span>;</span></span><br><span class="language-css"><span class="language-xml">      <span class="hljs-attribute">border-bottom</span>: <span class="hljs-number">1px</span> solid <span class="hljs-number">#d9d9d9</span>;</span></span><br><span class="language-css"><span class="language-xml">      <span class="hljs-attribute">vertical-align</span>: middle;</span></span><br><span class="language-css"><span class="language-xml">    &#125;</span></span><br><span class="language-css"><span class="language-xml">  &#125;</span></span><br><span class="language-css"><span class="language-xml">  &amp;<span class="hljs-selector-class">.show</span> &#123;</span></span><br><span class="language-css"><span class="language-xml">    <span class="hljs-selector-class">.header-search-select</span> &#123;</span></span><br><span class="language-css"><span class="language-xml">      <span class="hljs-attribute">width</span>: <span class="hljs-number">210px</span>;</span></span><br><span class="language-css"><span class="language-xml">      <span class="hljs-attribute">margin-left</span>: <span class="hljs-number">10px</span>;</span></span><br><span class="language-css"><span class="language-xml">    &#125;</span></span><br><span class="language-css"><span class="language-xml">  &#125;</span></span><br><span class="language-css"><span class="language-xml">&#125;</span></span><br><span class="language-css"><span class="language-xml"></span><span class="hljs-tag">&lt;/<span class="hljs-name">style</span>&gt;</span></span><br><br></code></pre></td></tr></table></figure>

<p>在 <code>navbar</code> 中导入该组件</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs js">&lt;header-search <span class="hljs-keyword">class</span>=<span class="hljs-string">&quot;right-menu-item hover-effect&quot;</span>&gt;&lt;/header-search&gt;<br><br>...<br><br><span class="hljs-keyword">import</span> <span class="hljs-title class_">HeaderSearch</span> <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;@/components/HeaderSearch/index.vue&#x27;</span><br></code></pre></td></tr></table></figure>

<h2 id="获取数据源"><a href="#获取数据源" class="headerlink" title="获取数据源"></a>获取数据源</h2><p>在有了 <code>headerSearch</code> 之后，接下来就可以来处理对应的 <strong>检索数据源了</strong></p>
<p><strong>检索数据源</strong> 表示：<strong>有哪些页面希望检索</strong></p>
<p>那么对于我们当前的业务而言，我们希望被检索的页面其实就是左侧菜单中的页面，那么我们检索数据源即为：<strong>左侧菜单对应的数据源</strong></p>
<p>根据以上原理，我们可以得出以下代码：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs js">&lt;script setup&gt;<br><span class="hljs-keyword">import</span> &#123; ref, computed &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;vue&#x27;</span><br><span class="hljs-keyword">import</span> &#123; filterRouters, generateMenus &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;@/utils/route&#x27;</span><br><span class="hljs-keyword">import</span> &#123; useRouter &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;vue-router&#x27;</span><br>...<br><span class="hljs-comment">// 检索数据源</span><br><span class="hljs-keyword">const</span> router = <span class="hljs-title function_">useRouter</span>()<br><span class="hljs-keyword">const</span> searchPool = <span class="hljs-title function_">computed</span>(<span class="hljs-function">() =&gt;</span> &#123;<br>  <span class="hljs-keyword">const</span> filterRoutes = <span class="hljs-title function_">filterRouters</span>(router.<span class="hljs-title function_">getRoutes</span>())<br>  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-title function_">generateMenus</span>(filterRoutes))<br>  <span class="hljs-keyword">return</span> <span class="hljs-title function_">generateMenus</span>(filterRoutes)<br>&#125;)<br><span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(searchPool)<br>&lt;/script&gt;<br></code></pre></td></tr></table></figure>

<h2 id="模糊搜索Fuse-js"><a href="#模糊搜索Fuse-js" class="headerlink" title="模糊搜索Fuse.js"></a>模糊搜索Fuse.js</h2><blockquote>
<p>Fuse.js is a powerful, lightweight fuzzy-search library, with zero dependencies.</p>
</blockquote>
<p>如果我们想要进行  <a target="_blank" rel="noopener" href="https://fusejs.io/">模糊搜索</a>  的话，那么需要依赖一个第三方的库  <a target="_blank" rel="noopener" href="https://fusejs.io/">fuse.js</a> </p>
<p>它是0️⃣依赖的，专门处理模糊搜索的库。</p>
<p><strong>Why should I use it?</strong></p>
<ul>
<li>使用 Fuse.js，您不需要仅仅为了处理搜索而设置专用的后端。</li>
<li>简单性和性能是开发这个库的主要标准。</li>
</ul>
<ol>
<li>安装 <a target="_blank" rel="noopener" href="https://fusejs.io/">fuse.js</a></li>
</ol>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs js">npm install --save fuse.<span class="hljs-property">js</span>@<span class="hljs-number">6.4</span><span class="hljs-number">.6</span><br></code></pre></td></tr></table></figure>

<ol start="2">
<li>初始化 <code>Fuse</code>，更多初始化配置项 <a target="_blank" rel="noopener" href="https://fusejs.io/api/options.html">可点击这里</a></li>
</ol>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">import</span> <span class="hljs-title class_">Fuse</span> <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;fuse.js&#x27;</span><br><br><span class="hljs-comment">/**</span><br><span class="hljs-comment">* 搜索库相关</span><br><span class="hljs-comment">*/</span><br><span class="hljs-keyword">const</span> fuse = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Fuse</span>(list, &#123;<br>    <span class="hljs-comment">// 是否按优先级进行排序</span><br>    <span class="hljs-attr">shouldSort</span>: <span class="hljs-literal">true</span>,<br>    <span class="hljs-comment">// 匹配长度超过这个值的才会被认为是匹配的</span><br>    <span class="hljs-attr">minMatchCharLength</span>: <span class="hljs-number">1</span>,<br>    <span class="hljs-comment">// 将被搜索的键列表。 这支持嵌套路径、加权搜索、在字符串和对象数组中搜索。</span><br>    <span class="hljs-comment">// name：搜索的键</span><br>    <span class="hljs-comment">// weight：对应的权重</span><br>    <span class="hljs-comment">// 表示我们将用户输入的值，与 title 和 path 进行匹配</span><br>    <span class="hljs-attr">keys</span>: [<br>      &#123;<br>        <span class="hljs-attr">name</span>: <span class="hljs-string">&#x27;title&#x27;</span>,<br>        <span class="hljs-attr">weight</span>: <span class="hljs-number">0.7</span><br>      &#125;,<br>      &#123;<br>        <span class="hljs-attr">name</span>: <span class="hljs-string">&#x27;path&#x27;</span>,<br>        <span class="hljs-attr">weight</span>: <span class="hljs-number">0.3</span><br>      &#125;<br>    ]<br>  &#125;)<br></code></pre></td></tr></table></figure>

<ol start="3">
<li>参考 <a target="_blank" rel="noopener" href="https://fusejs.io/demo.html">Fuse Demo</a> 与 最终效果，可以得出，我们最终期望得到如下的检索数据源结构</li>
</ol>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><code class="hljs json"><span class="hljs-punctuation">[</span><br>    <span class="hljs-punctuation">&#123;</span><br>        <span class="hljs-attr">&quot;path&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-string">&quot;/my&quot;</span><span class="hljs-punctuation">,</span><br>        <span class="hljs-attr">&quot;title&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-punctuation">[</span><br>            <span class="hljs-string">&quot;个人中心&quot;</span><br>        <span class="hljs-punctuation">]</span><br>    <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-punctuation">&#123;</span><br>        <span class="hljs-attr">&quot;path&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-string">&quot;/user&quot;</span><span class="hljs-punctuation">,</span><br>        <span class="hljs-attr">&quot;title&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-punctuation">[</span><br>            <span class="hljs-string">&quot;用户&quot;</span><br>        <span class="hljs-punctuation">]</span><br>    <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-punctuation">&#123;</span><br>        <span class="hljs-attr">&quot;path&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-string">&quot;/user/manage&quot;</span><span class="hljs-punctuation">,</span><br>        <span class="hljs-attr">&quot;title&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-punctuation">[</span><br>            <span class="hljs-string">&quot;用户&quot;</span><span class="hljs-punctuation">,</span><br>            <span class="hljs-string">&quot;用户管理&quot;</span><br>        <span class="hljs-punctuation">]</span><br>    <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-punctuation">&#123;</span><br>        <span class="hljs-attr">&quot;path&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-string">&quot;/user/info&quot;</span><span class="hljs-punctuation">,</span><br>        <span class="hljs-attr">&quot;title&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-punctuation">[</span><br>            <span class="hljs-string">&quot;用户&quot;</span><span class="hljs-punctuation">,</span><br>            <span class="hljs-string">&quot;用户信息&quot;</span><br>        <span class="hljs-punctuation">]</span><br>    <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-punctuation">&#123;</span><br>        <span class="hljs-attr">&quot;path&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-string">&quot;/article&quot;</span><span class="hljs-punctuation">,</span><br>        <span class="hljs-attr">&quot;title&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-punctuation">[</span><br>            <span class="hljs-string">&quot;文章&quot;</span><br>        <span class="hljs-punctuation">]</span><br>    <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-punctuation">&#123;</span><br>        <span class="hljs-attr">&quot;path&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-string">&quot;/article/ranking&quot;</span><span class="hljs-punctuation">,</span><br>        <span class="hljs-attr">&quot;title&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-punctuation">[</span><br>            <span class="hljs-string">&quot;文章&quot;</span><span class="hljs-punctuation">,</span><br>            <span class="hljs-string">&quot;文章排名&quot;</span><br>        <span class="hljs-punctuation">]</span><br>    <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-punctuation">&#123;</span><br>        <span class="hljs-attr">&quot;path&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-string">&quot;/article/create&quot;</span><span class="hljs-punctuation">,</span><br>        <span class="hljs-attr">&quot;title&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-punctuation">[</span><br>            <span class="hljs-string">&quot;文章&quot;</span><span class="hljs-punctuation">,</span><br>            <span class="hljs-string">&quot;创建文章&quot;</span><br>        <span class="hljs-punctuation">]</span><br>    <span class="hljs-punctuation">&#125;</span><br><span class="hljs-punctuation">]</span><br></code></pre></td></tr></table></figure>

<ol start="4">
<li>所以我们之前处理了的数据源并不符合我们的需要，所以我们需要对数据源进行重新处理</li>
</ol>
<h2 id="数据源重处理，生成-searchPool"><a href="#数据源重处理，生成-searchPool" class="headerlink" title="数据源重处理，生成 searchPool"></a>数据源重处理，生成 searchPool</h2><p>我们明确了最终我们期望得到数据源结构，那么接下来我们就对重新计算数据源，生成对应的 <code>searchPoll</code></p>
<p>创建 <code>components/HeaderSearch/FuseData.js</code></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">import</span> path <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;path&#x27;</span><br><span class="hljs-keyword">import</span> i18n <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;@/i18n&#x27;</span><br><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * 筛选出可供搜索的路由对象</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@param</span> routes 路由表</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@param</span> basePath 基础路径，默认为 /</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@param</span> prefixTitle 父级title，子集title集合 [文章，文章排名]</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> <span class="hljs-title function_">generateRoutes</span> = (<span class="hljs-params">routes, basePath = <span class="hljs-string">&#x27;/&#x27;</span>, prefixTitle = []</span>) =&gt; &#123;<br>  <span class="hljs-comment">// 创建 result 数据</span><br>  <span class="hljs-keyword">let</span> res = []<br>  <span class="hljs-comment">// 循环 routes 路由</span><br>  <span class="hljs-keyword">for</span> (<span class="hljs-keyword">const</span> route <span class="hljs-keyword">of</span> routes) &#123;<br>    <span class="hljs-comment">// 创建包含 path 和 title 的 item</span><br>    <span class="hljs-keyword">const</span> data = &#123;<br>      <span class="hljs-attr">path</span>: path.<span class="hljs-title function_">resolve</span>(basePath, route.<span class="hljs-property">path</span>),<br>      <span class="hljs-attr">title</span>: [...prefixTitle]<br>    &#125;<br>    <span class="hljs-comment">// 当前存在 meta 时，使用 i18n 解析国际化数据，组合成新的 title 内容</span><br>    <span class="hljs-comment">// 动态路由不允许被搜索（类似：user/:id 这种）</span><br>    <span class="hljs-comment">// 匹配动态路由的正则</span><br>    <span class="hljs-keyword">const</span> re = <span class="hljs-regexp">/.*\/:.*/</span><br>    <span class="hljs-keyword">if</span> (route.<span class="hljs-property">meta</span> &amp;&amp; route.<span class="hljs-property">meta</span>.<span class="hljs-property">title</span> &amp;&amp; !re.<span class="hljs-title function_">exec</span>(route.<span class="hljs-property">path</span>)) &#123;<br>      <span class="hljs-keyword">const</span> i18ntitle = i18n.<span class="hljs-property">global</span>.<span class="hljs-title function_">t</span>(<span class="hljs-string">`msg.route.<span class="hljs-subst">$&#123;route.meta.title&#125;</span>`</span>)<br>      data.<span class="hljs-property">title</span> = [...data.<span class="hljs-property">title</span>, i18ntitle]<br>      res.<span class="hljs-title function_">push</span>(data)<br>    &#125;<br><br>    <span class="hljs-comment">// 存在 children 时，迭代调用</span><br>    <span class="hljs-keyword">if</span> (route.<span class="hljs-property">children</span>) &#123;<br>      <span class="hljs-keyword">const</span> tempRoutes = <span class="hljs-title function_">generateRoutes</span>(route.<span class="hljs-property">children</span>, data.<span class="hljs-property">path</span>, data.<span class="hljs-property">title</span>)<br>      <span class="hljs-keyword">if</span> (tempRoutes.<span class="hljs-property">length</span> &gt;= <span class="hljs-number">1</span>) &#123;<br>        res = [...res, ...tempRoutes]<br>      &#125;<br>    &#125;<br>  &#125;<br>  <span class="hljs-keyword">return</span> res<br>&#125;<br><br></code></pre></td></tr></table></figure>

<p>这样，我们就通过 <code>generateRoutes</code> 方法，根据咱们的路由表，生成了符合 <code>fuse.js</code> 的数据。</p>
<p>在 <code>headerSearch</code> 中导入 <code>generateRoutes</code></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs vue">&lt;script setup&gt;<br>import &#123; computed, ref &#125; from &#x27;vue&#x27;<br>import &#123; generateRoutes &#125; from &#x27;./FuseData&#x27;<br>import Fuse from &#x27;fuse.js&#x27;<br>import &#123; filterRouters &#125; from &#x27;@/utils/route&#x27;<br>import &#123; useRouter &#125; from &#x27;vue-router&#x27;<br><br>...<br><br>// 检索数据源<br>const router = useRouter()<br>const searchPool = computed(() =&gt; &#123;<br>  const filterRoutes = filterRouters(router.getRoutes())<br>  return generateRoutes(filterRoutes)<br>&#125;)<br>/**<br> * 搜索库相关<br> */<br>const fuse = new Fuse(searchPool.value, &#123;<br>  ...<br>&#125;)<br>&lt;/script&gt;<br></code></pre></td></tr></table></figure>

<p>通过 <code>querySearch</code> 测试搜索结果</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-comment">// 搜索方法</span><br><span class="hljs-keyword">const</span> <span class="hljs-title function_">querySearch</span> = query =&gt; &#123;<br>  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(fuse.<span class="hljs-title function_">search</span>(query))<br>&#125;<br></code></pre></td></tr></table></figure>

<h2 id="渲染检索数据"><a href="#渲染检索数据" class="headerlink" title="渲染检索数据"></a>渲染检索数据</h2><p>数据源处理完成之后，最后我们就只需要完成:</p>
<ol>
<li>渲染检索出的数据</li>
<li>完成对应跳转</li>
</ol>
<p>那么下面我们按照步骤进行实现：</p>
<ol>
<li>渲染检索出的数据</li>
</ol>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs js">&lt;template&gt;<br>  <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">el-option</span></span></span><br><span class="hljs-tag"><span class="language-xml">      <span class="hljs-attr">v-for</span>=<span class="hljs-string">&quot;option in searchOptions&quot;</span></span></span><br><span class="hljs-tag"><span class="language-xml">      <span class="hljs-attr">:key</span>=<span class="hljs-string">&quot;option.item.path&quot;</span></span></span><br><span class="hljs-tag"><span class="language-xml">      <span class="hljs-attr">:label</span>=<span class="hljs-string">&quot;option.item.title.join(&#x27; &gt; &#x27;)&quot;</span></span></span><br><span class="hljs-tag"><span class="language-xml">      <span class="hljs-attr">:value</span>=<span class="hljs-string">&quot;option.item&quot;</span></span></span><br><span class="hljs-tag"><span class="language-xml">  &gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">el-option</span>&gt;</span></span><br>&lt;/template&gt;<br><br><span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">setup</span>&gt;</span><span class="language-javascript"></span></span><br><span class="language-javascript"><span class="language-xml">...</span></span><br><span class="language-javascript"><span class="language-xml"><span class="hljs-comment">// 搜索结果</span></span></span><br><span class="language-javascript"><span class="language-xml"><span class="hljs-keyword">const</span> searchOptions = <span class="hljs-title function_">ref</span>([])</span></span><br><span class="language-javascript"><span class="language-xml"><span class="hljs-comment">// 搜索方法</span></span></span><br><span class="language-javascript"><span class="language-xml"><span class="hljs-keyword">const</span> <span class="hljs-title function_">querySearch</span> = query =&gt; &#123;</span></span><br><span class="language-javascript"><span class="language-xml">  <span class="hljs-keyword">if</span> (query !== <span class="hljs-string">&#x27;&#x27;</span>) &#123;</span></span><br><span class="language-javascript"><span class="language-xml">    searchOptions.<span class="hljs-property">value</span> = fuse.<span class="hljs-title function_">search</span>(query)</span></span><br><span class="language-javascript"><span class="language-xml">  &#125; <span class="hljs-keyword">else</span> &#123;</span></span><br><span class="language-javascript"><span class="language-xml">    searchOptions.<span class="hljs-property">value</span> = []</span></span><br><span class="language-javascript"><span class="language-xml">  &#125;</span></span><br><span class="language-javascript"><span class="language-xml">&#125;</span></span><br><span class="language-javascript"><span class="language-xml">...</span></span><br><span class="language-javascript"><span class="language-xml"></span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span></span><br><br></code></pre></td></tr></table></figure>

<ol start="2">
<li>完成对应跳转</li>
</ol>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">const</span> <span class="hljs-title function_">onSelectChange</span> = val =&gt; &#123;<br>  router.<span class="hljs-title function_">push</span>(val.<span class="hljs-property">path</span>)<br>&#125;<br></code></pre></td></tr></table></figure>

<h2 id="剩余问题处理"><a href="#剩余问题处理" class="headerlink" title="剩余问题处理"></a>剩余问题处理</h2><p>这里我们的 <code>headerSearch</code> 功能基本上就已经处理完成了，但是还存在一些小 <code>bug</code> ，那么最后这一小节我们就处理下这些剩余的 <code>bug</code></p>
<ol>
<li>在 <code>search</code> 打开时，点击 <code>body</code> 关闭 <code>search</code></li>
<li>在 <code>search</code> 关闭时，清理 <code>searchOptions</code></li>
<li><code>headerSearch</code> 应该具备国际化能力</li>
</ol>
<p>明确好问题之后，接下来我们进行处理</p>
<p>首先我们先处理前前面两个问题：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * 关闭 search 的处理事件</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">const</span> <span class="hljs-title function_">onClose</span> = (<span class="hljs-params"></span>) =&gt; &#123;<br>  headerSearchSelectRef.<span class="hljs-property">value</span>.<span class="hljs-title function_">blur</span>()<br>  isShow.<span class="hljs-property">value</span> = <span class="hljs-literal">false</span><br>  searchOptions.<span class="hljs-property">value</span> = []<br>&#125;<br><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * 监听 search 打开，处理 close 事件</span><br><span class="hljs-comment"> */</span><br><span class="hljs-title function_">watch</span>(isShow, <span class="hljs-function"><span class="hljs-params">val</span> =&gt;</span> &#123;<br>  <span class="hljs-keyword">if</span> (val) &#123;<br>    <span class="hljs-variable language_">document</span>.<span class="hljs-property">body</span>.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">&#x27;click&#x27;</span>, onClose)<br>  &#125; <span class="hljs-keyword">else</span> &#123;<br>    <span class="hljs-variable language_">document</span>.<span class="hljs-property">body</span>.<span class="hljs-title function_">removeEventListener</span>(<span class="hljs-string">&#x27;click&#x27;</span>, onClose)<br>  &#125;<br>&#125;)<br></code></pre></td></tr></table></figure>

<p>接下来是国际化的问题，想要处理这个问题非常简单，我们只需要：<strong>监听语言变化，重新计算数据源初始化 <code>fuse</code> 即可</strong></p>
<ol>
<li>在 <code>utils/i18n</code> 下，新建方法 <code>watchSwitchLang</code></li>
</ol>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">import</span> &#123; watch &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;vue&#x27;</span><br><span class="hljs-keyword">import</span> store <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;@/store&#x27;</span><br><br>type <span class="hljs-title class_">IProps</span> = (<span class="hljs-function">(<span class="hljs-params">lang: string</span>) =&gt;</span> <span class="hljs-keyword">void</span>)[]<br><br><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">watchSwitchLang</span>(<span class="hljs-params">...cbs: IProps</span>) &#123;<br>  <span class="hljs-title function_">watch</span>(<br>    <span class="hljs-function">() =&gt;</span> store.<span class="hljs-property">getters</span>.<span class="hljs-property">language</span>,<br>    <span class="hljs-function">() =&gt;</span> &#123;<br>      cbs.<span class="hljs-title function_">forEach</span>(<span class="hljs-function"><span class="hljs-params">cb</span> =&gt;</span> cbs.<span class="hljs-title function_">forEach</span>(<span class="hljs-function"><span class="hljs-params">cb</span> =&gt;</span> <span class="hljs-title function_">cb</span>(store.<span class="hljs-property">getters</span>.<span class="hljs-property">language</span>)))<br>    &#125;<br>  )<br>&#125;<br></code></pre></td></tr></table></figure>

<ol start="2">
<li>在 <code>headerSearch</code> 监听变化，重新赋值</li>
</ol>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><code class="hljs js">&lt;script setup&gt;<br>...<br><span class="hljs-keyword">import</span> &#123; watchSwitchLang &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;@/utils/i18n&#x27;</span><br><br>...<br><br><span class="hljs-comment">// 检索数据源</span><br><span class="hljs-keyword">const</span> router = <span class="hljs-title function_">useRouter</span>()<br><span class="hljs-keyword">let</span> searchPool = <span class="hljs-title function_">computed</span>(<span class="hljs-function">() =&gt;</span> &#123;<br>  <span class="hljs-keyword">const</span> filterRoutes = <span class="hljs-title function_">filterRouters</span>(router.<span class="hljs-title function_">getRoutes</span>())<br>  <span class="hljs-keyword">return</span> <span class="hljs-title function_">generateRoutes</span>(filterRoutes)<br>&#125;)<br><span class="hljs-comment">/**</span><br><span class="hljs-comment">* 搜索库相关</span><br><span class="hljs-comment">*/</span><br><span class="hljs-keyword">let</span> fuse<br><span class="hljs-keyword">const</span> <span class="hljs-title function_">initFuse</span> = searchPool =&gt; &#123;<br>  fuse = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Fuse</span>(searchPool, &#123;<br>    ...<br>&#125;<br><span class="hljs-title function_">initFuse</span>(searchPool.<span class="hljs-property">value</span>)<br><br>...<br><br><span class="hljs-comment">// 处理国际化</span><br><span class="hljs-title function_">watchSwitchLang</span>(<span class="hljs-function">() =&gt;</span> &#123;<br>  searchPool = <span class="hljs-title function_">computed</span>(<span class="hljs-function">() =&gt;</span> &#123;<br>    <span class="hljs-keyword">const</span> filterRoutes = <span class="hljs-title function_">filterRouters</span>(router.<span class="hljs-title function_">getRoutes</span>())<br>    <span class="hljs-keyword">return</span> <span class="hljs-title function_">generateRoutes</span>(filterRoutes)<br>  &#125;)<br>  <span class="hljs-title function_">initFuse</span>(searchPool.<span class="hljs-property">value</span>)<br>&#125;)<br>&lt;/script&gt;<br></code></pre></td></tr></table></figure>

<h2 id="headerSearch-方案总结"><a href="#headerSearch-方案总结" class="headerlink" title="headerSearch 方案总结"></a>headerSearch 方案总结</h2><p>那么到这里整个的 <code>headerSearch</code> 我们就已经全部处理完成了，整个 <code>headerSearch</code> 我们只需要把握住三个核心的关键点</p>
<ol>
<li>根据指定内容对所有页面进行检索</li>
<li>以 <code>select</code> 形式展示检索出的页面</li>
<li>通过检索页面可快速进入对应页面</li>
</ol>
<p>保证大方向没有错误，那么具体的细节处理我们具体分析就可以了。</p>
<p>关于细节的处理，可能比较复杂的地方有两个：</p>
<ol>
<li>模糊搜索</li>
<li>检索数据源</li>
</ol>
<p>对于这两块，我们依赖于 <code>fuse.js</code> 进行了实现，大大简化了我们的业务处理流程。</p>
<h1 id="tagsView-原理及方案分析"><a href="#tagsView-原理及方案分析" class="headerlink" title="tagsView 原理及方案分析"></a>tagsView 原理及方案分析</h1><p>所谓 <code>tagsView</code> 可以分成两部分来去看：</p>
<ol>
<li>tags</li>
<li>view</li>
</ol>
<p>好像和废话一样是吧。那怎么分开看呢？</p>
<p>首先我们先来看 <code>tags</code>：</p>
<p>所谓 <code>tgas</code> 指的是：<strong>位于 <code>appmain</code> 之上的标签</strong></p>
<p>那么现在我们忽略掉 <code>view</code>，现在只有一个要求：</p>
<blockquote>
<p>在 <code>view</code> 之上渲染这个 <code>tag</code> </p>
</blockquote>
<p>仅看这一个要求，很简单吧。</p>
<p><strong>views：</strong></p>
<p>明确好了 <code>tags</code> 之后，我们来看 <code>views</code>。</p>
<p>脱离了 <code>tags</code> 只看 <code>views</code> 就更简单了，所谓 <code>views</code> ：<strong>指的就是一个用来渲染组件的位置</strong>，就像我们之前的 <code>Appmain</code> 一样，只不过这里的 <code>views</code> 可能稍微复杂一点，因为它需要在渲染的基础上增加：</p>
<ol>
<li>动画</li>
<li>缓存</li>
</ol>
<p>这两个额外的功能。</p>
<p>加上这两个功能之后可能会略显复杂，但是 <a target="_blank" rel="noopener" href="https://next.router.vuejs.org/zh/guide/advanced/transitions.html#%E5%9F%BA%E4%BA%8E%E8%B7%AF%E7%94%B1%E7%9A%84%E5%8A%A8%E6%80%81%E8%BF%87%E6%B8%A1">官网已经帮助我们处理了这个问题</a> </p>
<p>所以 单看 <code>views</code> 也是一个很简单的功能。</p>
<p>那么接下来我们需要做的就是把 <code>tags</code> 和 <code>view</code> 合并起来而已。</p>
<p>那么明确好了原理之后，我们就来看 <strong>实现方案：</strong></p>
<ol>
<li>创建 <code>tagsView</code> 组件：用来处理 <code>tags</code> 的展示</li>
<li>处理基于路由的动态过渡，在 <code>AppMain</code> 中进行：用于处理 <code>view</code> 的部分</li>
</ol>
<p>整个的方案就是这么两大部，但是其中我们还需要处理一些细节相关的，<strong>完整的方案为</strong>：</p>
<ol>
<li>监听路由变化，组成用于渲染 <code>tags</code> 的数据源</li>
<li>创建 <code>tags</code> 组件，根据数据源渲染 <code>tag</code>，渲染出来的 <code>tags</code> 需要同时具备<ol>
<li>国际化 <code>title</code></li>
<li>路由跳转</li>
</ol>
</li>
<li>处理鼠标右键效果，根据右键处理对应数据源</li>
<li>处理基于路由的动态过渡</li>
</ol>
<p>那么明确好了方案之后，接下来我们根据方案进行处理即可。</p>
<h2 id="创建-tags-数据源"><a href="#创建-tags-数据源" class="headerlink" title="创建 tags 数据源"></a>创建 tags 数据源</h2><p><code>tags</code> 的数据源分为两部分：</p>
<ol>
<li>保存数据：<code>appmain</code> 组件中进行</li>
<li>展示数据：<code>tags</code> 组件中进行</li>
</ol>
<p>所以 <code>tags</code> 的数据我们最好把它保存到 <code>vuex</code> 中。</p>
<ol>
<li><p>在 <code>constant</code> 中新建常量</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-comment">// tags</span><br><span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> <span class="hljs-variable constant_">TAGS_VIEW</span> = <span class="hljs-string">&#x27;tagsView&#x27;</span><br></code></pre></td></tr></table></figure>
</li>
<li><p>在 <code>store/app</code> 中创建 <code>tagsViewList</code></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">import</span> &#123; <span class="hljs-variable constant_">LANG</span>, <span class="hljs-variable constant_">TAGS_VIEW</span> &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;@/constant&#x27;</span><br><span class="hljs-keyword">import</span> &#123; getItem, setItem &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;@/utils/storage&#x27;</span><br><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> &#123;<br>  <span class="hljs-attr">namespaced</span>: <span class="hljs-literal">true</span>,<br>  <span class="hljs-attr">state</span>: <span class="hljs-function">() =&gt;</span> (&#123;<br>    ...<br>    <span class="hljs-attr">tagsViewList</span>: <span class="hljs-title function_">getItem</span>(<span class="hljs-variable constant_">TAGS_VIEW</span>) || []<br>  &#125;),<br>  <span class="hljs-attr">mutations</span>: &#123;<br>    ...<br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * 添加 tags</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-title function_">addTagsViewList</span>(<span class="hljs-params">state, tag</span>) &#123;<br>      <span class="hljs-keyword">const</span> isFind = state.<span class="hljs-property">tagsViewList</span>.<span class="hljs-title function_">find</span>(<span class="hljs-function"><span class="hljs-params">item</span> =&gt;</span> &#123;<br>        <span class="hljs-keyword">return</span> item.<span class="hljs-property">path</span> === tag.<span class="hljs-property">path</span><br>      &#125;)<br>    <span class="hljs-comment">// 处理重复</span><br>      <span class="hljs-keyword">if</span> (!isFind) &#123;<br>        state.<span class="hljs-property">tagsViewList</span>.<span class="hljs-title function_">push</span>(tag)<br>        <span class="hljs-title function_">setItem</span>(<span class="hljs-variable constant_">TAGS_VIEW</span>, state.<span class="hljs-property">tagsViewList</span>)<br>      &#125;<br>    &#125;<br>  &#125;,<br>  <span class="hljs-attr">actions</span>: &#123;&#125;<br>&#125;<br><br></code></pre></td></tr></table></figure>
</li>
<li><p>在 <code>appmain</code> 中监听路由的变化</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><code class="hljs js">&lt;script setup&gt;<br><span class="hljs-keyword">import</span> &#123; watch &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;vue&#x27;</span><br><span class="hljs-keyword">import</span> &#123; isTags &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;@/utils/tags&#x27;</span><br><span class="hljs-keyword">import</span> &#123; generateTitle &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;@/utils/i18n&#x27;</span><br><span class="hljs-keyword">import</span> &#123; useRoute &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;vue-router&#x27;</span><br><span class="hljs-keyword">import</span> &#123; useStore &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;vuex&#x27;</span><br><br><span class="hljs-keyword">const</span> route = <span class="hljs-title function_">useRoute</span>()<br><br><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * 生成 title</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">const</span> <span class="hljs-title function_">getTitle</span> = route =&gt; &#123;<br>  <span class="hljs-keyword">let</span> title = <span class="hljs-string">&#x27;&#x27;</span><br>  <span class="hljs-keyword">if</span> (!route.<span class="hljs-property">meta</span>) &#123;<br>    <span class="hljs-comment">// 处理无 meta 的路由</span><br>    <span class="hljs-keyword">const</span> pathArr = route.<span class="hljs-property">path</span>.<span class="hljs-title function_">split</span>(<span class="hljs-string">&#x27;/&#x27;</span>)<br>    title = pathArr[pathArr.<span class="hljs-property">length</span> - <span class="hljs-number">1</span>]<br>  &#125; <span class="hljs-keyword">else</span> &#123;<br>    title = <span class="hljs-title function_">generateTitle</span>(route.<span class="hljs-property">meta</span>.<span class="hljs-property">title</span>)<br>  &#125;<br>  <span class="hljs-keyword">return</span> title<br>&#125;<br><br><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * 监听路由变化</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">const</span> store = <span class="hljs-title function_">useStore</span>()<br><span class="hljs-title function_">watch</span>(<br>  route,<br>  <span class="hljs-function">(<span class="hljs-params">to, <span class="hljs-keyword">from</span></span>) =&gt;</span> &#123;<br>    <span class="hljs-keyword">if</span> (!<span class="hljs-title function_">isTags</span>(to.<span class="hljs-property">path</span>)) <span class="hljs-keyword">return</span><br>    <span class="hljs-keyword">const</span> &#123; fullPath, meta, name, params, path, query &#125; = to<br>    store.<span class="hljs-title function_">commit</span>(<span class="hljs-string">&#x27;app/addTagsViewList&#x27;</span>, &#123;<br>      fullPath,<br>      meta,<br>      name,<br>      params,<br>      path,<br>      query,<br>      <span class="hljs-attr">title</span>: <span class="hljs-title function_">getTitle</span>(to)<br>    &#125;)<br>  &#125;,<br>  &#123;<br>    <span class="hljs-attr">immediate</span>: <span class="hljs-literal">true</span><br>  &#125;<br>)<br>&lt;/script&gt;<br><br><br></code></pre></td></tr></table></figure>
</li>
<li><p>创建 <code>utils/tags</code></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">const</span> whiteList = [<span class="hljs-string">&#x27;/login&#x27;</span>, <span class="hljs-string">&#x27;/import&#x27;</span>, <span class="hljs-string">&#x27;/404&#x27;</span>, <span class="hljs-string">&#x27;/401&#x27;</span>]<br><br><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * path 是否需要被缓存</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@param</span> &#123;<span class="hljs-type">*</span>&#125; <span class="hljs-variable">path</span></span><br><span class="hljs-comment"> * <span class="hljs-doctag">@returns</span></span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">export</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">isTags</span>(<span class="hljs-params">path</span>) &#123;<br>  <span class="hljs-keyword">return</span> !whiteList.<span class="hljs-title function_">includes</span>(path)<br>&#125;<br><br></code></pre></td></tr></table></figure>



</li>
</ol>
<h2 id="生成-tagsView"><a href="#生成-tagsView" class="headerlink" title="生成 tagsView"></a>生成 tagsView</h2><p>目前数据已经被保存到 <code>store</code> 中，那么接下来我们就依赖数据渲染 <code>tags</code></p>
<ol>
<li><p>创建 <code>store/app</code> 中 <code>tagsViewList</code> 的快捷访问</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-attr">tagsViewList</span>: <span class="hljs-function"><span class="hljs-params">state</span> =&gt;</span> state.<span class="hljs-property">app</span>.<span class="hljs-property">tagsViewList</span><br></code></pre></td></tr></table></figure>
</li>
<li><p>创建 <code>components/tagsview</code></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br></pre></td><td class="code"><pre><code class="hljs js">&lt;template&gt;<br>  <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;tags-view-container&quot;</span>&gt;</span></span><br><span class="language-xml">      <span class="hljs-tag">&lt;<span class="hljs-name">router-link</span></span></span><br><span class="hljs-tag"><span class="language-xml">        <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;tags-view-item&quot;</span></span></span><br><span class="hljs-tag"><span class="language-xml">        <span class="hljs-attr">:class</span>=<span class="hljs-string">&quot;isActive(tag) ? &#x27;active&#x27; : &#x27;&#x27;&quot;</span></span></span><br><span class="hljs-tag"><span class="language-xml">        <span class="hljs-attr">:style</span>=<span class="hljs-string">&quot;&#123;</span></span></span><br><span class="hljs-string"><span class="hljs-tag"><span class="language-xml">          backgroundColor: isActive(tag) ? $store.getters.cssVar.menuBg : &#x27;&#x27;,</span></span></span><br><span class="hljs-string"><span class="hljs-tag"><span class="language-xml">          borderColor: isActive(tag) ? $store.getters.cssVar.menuBg : &#x27;&#x27;</span></span></span><br><span class="hljs-string"><span class="hljs-tag"><span class="language-xml">        &#125;&quot;</span></span></span><br><span class="hljs-tag"><span class="language-xml">        <span class="hljs-attr">v-for</span>=<span class="hljs-string">&quot;(tag, index) in $store.getters.tagsViewList&quot;</span></span></span><br><span class="hljs-tag"><span class="language-xml">        <span class="hljs-attr">:key</span>=<span class="hljs-string">&quot;tag.fullPath&quot;</span></span></span><br><span class="hljs-tag"><span class="language-xml">        <span class="hljs-attr">:to</span>=<span class="hljs-string">&quot;&#123; path: tag.fullPath &#125;&quot;</span></span></span><br><span class="hljs-tag"><span class="language-xml">      &gt;</span></span><br><span class="language-xml">        &#123;&#123; tag.title &#125;&#125;</span><br><span class="language-xml">        <span class="hljs-tag">&lt;<span class="hljs-name">i</span></span></span><br><span class="hljs-tag"><span class="language-xml">          <span class="hljs-attr">v-show</span>=<span class="hljs-string">&quot;!isActive(tag)&quot;</span></span></span><br><span class="hljs-tag"><span class="language-xml">          <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;el-icon-close&quot;</span></span></span><br><span class="hljs-tag"><span class="language-xml">          @<span class="hljs-attr">click.prevent.stop</span>=<span class="hljs-string">&quot;onCloseClick(index)&quot;</span></span></span><br><span class="hljs-tag"><span class="language-xml">        /&gt;</span></span><br><span class="language-xml">      <span class="hljs-tag">&lt;/<span class="hljs-name">router-link</span>&gt;</span></span><br><span class="language-xml">  <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span><br>&lt;/template&gt;<br><br><span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">setup</span>&gt;</span><span class="language-javascript"></span></span><br><span class="language-javascript"><span class="language-xml"><span class="hljs-keyword">import</span> &#123; useRoute &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;vue-router&#x27;</span></span></span><br><span class="language-javascript"><span class="language-xml"><span class="hljs-keyword">const</span> route = <span class="hljs-title function_">useRoute</span>()</span></span><br><span class="language-javascript"><span class="language-xml"></span></span><br><span class="language-javascript"><span class="language-xml"><span class="hljs-comment">/**</span></span></span><br><span class="hljs-comment"><span class="language-javascript"><span class="language-xml"> * 是否被选中</span></span></span><br><span class="hljs-comment"><span class="language-javascript"><span class="language-xml"> */</span></span></span><br><span class="language-javascript"><span class="language-xml"><span class="hljs-keyword">const</span> <span class="hljs-title function_">isActive</span> = tag =&gt; &#123;</span></span><br><span class="language-javascript"><span class="language-xml">  <span class="hljs-keyword">return</span> tag.<span class="hljs-property">path</span> === route.<span class="hljs-property">path</span></span></span><br><span class="language-javascript"><span class="language-xml">&#125;</span></span><br><span class="language-javascript"><span class="language-xml"></span></span><br><span class="language-javascript"><span class="language-xml"><span class="hljs-comment">/**</span></span></span><br><span class="hljs-comment"><span class="language-javascript"><span class="language-xml"> * 关闭 tag 的点击事件</span></span></span><br><span class="hljs-comment"><span class="language-javascript"><span class="language-xml"> */</span></span></span><br><span class="language-javascript"><span class="language-xml"><span class="hljs-keyword">const</span> <span class="hljs-title function_">onCloseClick</span> = index =&gt; &#123;&#125;</span></span><br><span class="language-javascript"><span class="language-xml"></span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span></span><br><br><span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">style</span> <span class="hljs-attr">lang</span>=<span class="hljs-string">&quot;scss&quot;</span> <span class="hljs-attr">scoped</span>&gt;</span><span class="language-css"></span></span><br><span class="language-css"><span class="language-xml"><span class="hljs-selector-class">.tags-view-container</span> &#123;</span></span><br><span class="language-css"><span class="language-xml">  <span class="hljs-attribute">height</span>: <span class="hljs-number">34px</span>;</span></span><br><span class="language-css"><span class="language-xml">  <span class="hljs-attribute">width</span>: <span class="hljs-number">100%</span>;</span></span><br><span class="language-css"><span class="language-xml">  <span class="hljs-attribute">background</span>: <span class="hljs-number">#fff</span>;</span></span><br><span class="language-css"><span class="language-xml">  <span class="hljs-attribute">border-bottom</span>: <span class="hljs-number">1px</span> solid <span class="hljs-number">#d8dce5</span>;</span></span><br><span class="language-css"><span class="language-xml">  <span class="hljs-attribute">box-shadow</span>: <span class="hljs-number">0</span> <span class="hljs-number">1px</span> <span class="hljs-number">3px</span> <span class="hljs-number">0</span> <span class="hljs-built_in">rgba</span>(<span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0.12</span>), <span class="hljs-number">0</span> <span class="hljs-number">0</span> <span class="hljs-number">3px</span> <span class="hljs-number">0</span> <span class="hljs-built_in">rgba</span>(<span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0.04</span>);</span></span><br><span class="language-css"><span class="language-xml">    <span class="hljs-selector-class">.tags-view-item</span> &#123;</span></span><br><span class="language-css"><span class="language-xml">      <span class="hljs-attribute">display</span>: inline-block;</span></span><br><span class="language-css"><span class="language-xml">      <span class="hljs-attribute">position</span>: relative;</span></span><br><span class="language-css"><span class="language-xml">      <span class="hljs-attribute">cursor</span>: pointer;</span></span><br><span class="language-css"><span class="language-xml">      <span class="hljs-attribute">height</span>: <span class="hljs-number">26px</span>;</span></span><br><span class="language-css"><span class="language-xml">      <span class="hljs-attribute">line-height</span>: <span class="hljs-number">26px</span>;</span></span><br><span class="language-css"><span class="language-xml">      <span class="hljs-attribute">border</span>: <span class="hljs-number">1px</span> solid <span class="hljs-number">#d8dce5</span>;</span></span><br><span class="language-css"><span class="language-xml">      <span class="hljs-attribute">color</span>: <span class="hljs-number">#495060</span>;</span></span><br><span class="language-css"><span class="language-xml">      <span class="hljs-attribute">background</span>: <span class="hljs-number">#fff</span>;</span></span><br><span class="language-css"><span class="language-xml">      <span class="hljs-attribute">padding</span>: <span class="hljs-number">0</span> <span class="hljs-number">8px</span>;</span></span><br><span class="language-css"><span class="language-xml">      <span class="hljs-attribute">font-size</span>: <span class="hljs-number">12px</span>;</span></span><br><span class="language-css"><span class="language-xml">      <span class="hljs-attribute">margin-left</span>: <span class="hljs-number">5px</span>;</span></span><br><span class="language-css"><span class="language-xml">      <span class="hljs-attribute">margin-top</span>: <span class="hljs-number">4px</span>;</span></span><br><span class="language-css"><span class="language-xml">      &amp;<span class="hljs-selector-pseudo">:first</span>-of-type &#123;</span></span><br><span class="language-css"><span class="language-xml">        <span class="hljs-attribute">margin-left</span>: <span class="hljs-number">15px</span>;</span></span><br><span class="language-css"><span class="language-xml">      &#125;</span></span><br><span class="language-css"><span class="language-xml">      &amp;<span class="hljs-selector-pseudo">:last-of-type</span> &#123;</span></span><br><span class="language-css"><span class="language-xml">        <span class="hljs-attribute">margin-right</span>: <span class="hljs-number">15px</span>;</span></span><br><span class="language-css"><span class="language-xml">      &#125;</span></span><br><span class="language-css"><span class="language-xml">      &amp;<span class="hljs-selector-class">.active</span> &#123;</span></span><br><span class="language-css"><span class="language-xml">        <span class="hljs-attribute">color</span>: <span class="hljs-number">#fff</span>;</span></span><br><span class="language-css"><span class="language-xml">        &amp;<span class="hljs-selector-pseudo">::before</span> &#123;</span></span><br><span class="language-css"><span class="language-xml">          <span class="hljs-attribute">content</span>: <span class="hljs-string">&#x27;&#x27;</span>;</span></span><br><span class="language-css"><span class="language-xml">          <span class="hljs-attribute">background</span>: <span class="hljs-number">#fff</span>;</span></span><br><span class="language-css"><span class="language-xml">          <span class="hljs-attribute">display</span>: inline-block;</span></span><br><span class="language-css"><span class="language-xml">          <span class="hljs-attribute">width</span>: <span class="hljs-number">8px</span>;</span></span><br><span class="language-css"><span class="language-xml">          <span class="hljs-attribute">height</span>: <span class="hljs-number">8px</span>;</span></span><br><span class="language-css"><span class="language-xml">          <span class="hljs-attribute">border-radius</span>: <span class="hljs-number">50%</span>;</span></span><br><span class="language-css"><span class="language-xml">          <span class="hljs-attribute">position</span>: relative;</span></span><br><span class="language-css"><span class="language-xml">          <span class="hljs-attribute">margin-right</span>: <span class="hljs-number">4px</span>;</span></span><br><span class="language-css"><span class="language-xml">        &#125;</span></span><br><span class="language-css"><span class="language-xml">      &#125;</span></span><br><span class="language-css"><span class="language-xml">      // close 按钮</span></span><br><span class="language-css"><span class="language-xml">      <span class="hljs-selector-class">.el-icon-close</span> &#123;</span></span><br><span class="language-css"><span class="language-xml">        <span class="hljs-attribute">width</span>: <span class="hljs-number">16px</span>;</span></span><br><span class="language-css"><span class="language-xml">        <span class="hljs-attribute">height</span>: <span class="hljs-number">16px</span>;</span></span><br><span class="language-css"><span class="language-xml">        <span class="hljs-attribute">line-height</span>: <span class="hljs-number">10px</span>;</span></span><br><span class="language-css"><span class="language-xml">        <span class="hljs-attribute">vertical-align</span>: <span class="hljs-number">2px</span>;</span></span><br><span class="language-css"><span class="language-xml">        <span class="hljs-attribute">border-radius</span>: <span class="hljs-number">50%</span>;</span></span><br><span class="language-css"><span class="language-xml">        <span class="hljs-attribute">text-align</span>: center;</span></span><br><span class="language-css"><span class="language-xml">        <span class="hljs-attribute">transition</span>: all <span class="hljs-number">0.3s</span> <span class="hljs-built_in">cubic-bezier</span>(<span class="hljs-number">0.645</span>, <span class="hljs-number">0.045</span>, <span class="hljs-number">0.355</span>, <span class="hljs-number">1</span>);</span></span><br><span class="language-css"><span class="language-xml">        <span class="hljs-attribute">transform-origin</span>: <span class="hljs-number">100%</span> <span class="hljs-number">50%</span>;</span></span><br><span class="language-css"><span class="language-xml">        &amp;<span class="hljs-selector-pseudo">:before</span> &#123;</span></span><br><span class="language-css"><span class="language-xml">          <span class="hljs-attribute">transform</span>: <span class="hljs-built_in">scale</span>(<span class="hljs-number">0.6</span>);</span></span><br><span class="language-css"><span class="language-xml">          <span class="hljs-attribute">display</span>: inline-block;</span></span><br><span class="language-css"><span class="language-xml">          <span class="hljs-attribute">vertical-align</span>: -<span class="hljs-number">3px</span>;</span></span><br><span class="language-css"><span class="language-xml">        &#125;</span></span><br><span class="language-css"><span class="language-xml">        &amp;<span class="hljs-selector-pseudo">:hover</span> &#123;</span></span><br><span class="language-css"><span class="language-xml">          <span class="hljs-attribute">background-color</span>: <span class="hljs-number">#b4bccc</span>;</span></span><br><span class="language-css"><span class="language-xml">          <span class="hljs-attribute">color</span>: <span class="hljs-number">#fff</span>;</span></span><br><span class="language-css"><span class="language-xml">        &#125;</span></span><br><span class="language-css"><span class="language-xml">      &#125;</span></span><br><span class="language-css"><span class="language-xml">    </span></span><br><span class="language-css"><span class="language-xml">  &#125;</span></span><br><span class="language-css"><span class="language-xml">&#125;</span></span><br><span class="language-css"><span class="language-xml"></span><span class="hljs-tag">&lt;/<span class="hljs-name">style</span>&gt;</span></span><br></code></pre></td></tr></table></figure>
</li>
<li><p>在 <code>layout/index</code> 中导入</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs js">&lt;div <span class="hljs-keyword">class</span>=<span class="hljs-string">&quot;fixed-header&quot;</span>&gt;<br>    &lt;!-- 顶部的 navbar --&gt;<br>    <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">navbar</span> /&gt;</span></span><br>    &lt;!-- tags --&gt;<br>    <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">tags-view</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">tags-view</span>&gt;</span></span><br>&lt;/div&gt;<br><br><span class="hljs-keyword">import</span> <span class="hljs-title class_">TagsView</span> <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;@/components/TagsView&#x27;</span><br><br></code></pre></td></tr></table></figure>



</li>
</ol>
<h2 id="tagsView-国际化处理"><a href="#tagsView-国际化处理" class="headerlink" title="tagsView 国际化处理"></a>tagsView 国际化处理</h2><p><code>tagsView</code> 的国际化处理可以理解为修改现有 <code>tags</code> 的 <code>title</code>。</p>
<p>所以我们只需要：</p>
<ol>
<li>监听到语言变化</li>
<li>国际化对应的 <code>title</code> 即可</li>
</ol>
<p>根据方案，可生成如下代码：</p>
<ol>
<li><p>在 <code>store/app</code> 中，创建修改 <code>ttile</code> 的 <code>mutations</code></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-comment">/**</span><br><span class="hljs-comment">* 为指定的 tag 修改 title</span><br><span class="hljs-comment">*/</span><br><span class="hljs-title function_">changeTagsView</span>(<span class="hljs-params">state, &#123; index, tag &#125;</span>) &#123;<br>    state.<span class="hljs-property">tagsViewList</span>[index] = tag<br>    <span class="hljs-title function_">setItem</span>(<span class="hljs-variable constant_">TAGS_VIEW</span>, state.<span class="hljs-property">tagsViewList</span>)<br>&#125;<br></code></pre></td></tr></table></figure>



</li>
</ol>
<ol start="2">
<li><p>在 <code>appmain</code> 中监听语言变化</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">import</span> &#123; generateTitle, watchSwitchLang &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;@/utils/i18n&#x27;</span><br><br><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * 国际化 tags</span><br><span class="hljs-comment"> */</span><br><span class="hljs-title function_">watchSwitchLang</span>(<span class="hljs-function">() =&gt;</span> &#123;<br>  store.<span class="hljs-property">getters</span>.<span class="hljs-property">tagsViewList</span>.<span class="hljs-title function_">forEach</span>(<span class="hljs-function">(<span class="hljs-params">route, index</span>) =&gt;</span> &#123;<br>    store.<span class="hljs-title function_">commit</span>(<span class="hljs-string">&#x27;app/changeTagsView&#x27;</span>, &#123;<br>      index,<br>      <span class="hljs-attr">tag</span>: &#123;<br>        ...route,<br>        <span class="hljs-attr">title</span>: <span class="hljs-title function_">getTitle</span>(route)<br>      &#125;<br>    &#125;)<br>  &#125;)<br>&#125;)<br></code></pre></td></tr></table></figure>



</li>
</ol>
<h2 id="contextMenu-展示处理"><a href="#contextMenu-展示处理" class="headerlink" title="contextMenu 展示处理"></a>contextMenu 展示处理</h2><blockquote>
<p><a target="_blank" rel="noopener" href="https://developer.mozilla.org/zh-CN/docs/Web/API/Element/contextmenu_event">contextMenu</a> 为 鼠标右键事件</p>
</blockquote>
<p><a target="_blank" rel="noopener" href="https://developer.mozilla.org/zh-CN/docs/Web/API/Element/contextmenu_event">contextMenu</a> 事件的处理分为两部分：</p>
<ol>
<li><code>contextMenu</code> 的展示</li>
<li>右键项对应逻辑处理</li>
</ol>
<p>那么这一小节我们先处理第一部分：<code>contextMenu</code> 的展示：</p>
<ol>
<li><p>创建 <code>components/TagsView/ContextMenu</code> 组件，作为右键展示部分</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><code class="hljs js">&lt;template&gt;<br>  <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">ul</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;context-menu-container&quot;</span>&gt;</span></span><br><span class="language-xml">    <span class="hljs-tag">&lt;<span class="hljs-name">li</span> @<span class="hljs-attr">click</span>=<span class="hljs-string">&quot;onRefreshClick&quot;</span>&gt;</span></span><br><span class="language-xml">      &#123;&#123; $t(&#x27;msg.tagsView.refresh&#x27;) &#125;&#125;</span><br><span class="language-xml">    <span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span></span><br><span class="language-xml">    <span class="hljs-tag">&lt;<span class="hljs-name">li</span> @<span class="hljs-attr">click</span>=<span class="hljs-string">&quot;onCloseRightClick&quot;</span>&gt;</span></span><br><span class="language-xml">      &#123;&#123; $t(&#x27;msg.tagsView.closeRight&#x27;) &#125;&#125;</span><br><span class="language-xml">    <span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span></span><br><span class="language-xml">    <span class="hljs-tag">&lt;<span class="hljs-name">li</span> @<span class="hljs-attr">click</span>=<span class="hljs-string">&quot;onCloseOtherClick&quot;</span>&gt;</span></span><br><span class="language-xml">      &#123;&#123; $t(&#x27;msg.tagsView.closeOther&#x27;) &#125;&#125;</span><br><span class="language-xml">    <span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span></span><br><span class="language-xml">  <span class="hljs-tag">&lt;/<span class="hljs-name">ul</span>&gt;</span></span><br>&lt;/template&gt;<br><br><span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">setup</span>&gt;</span><span class="language-javascript"></span></span><br><span class="language-javascript"><span class="language-xml"><span class="hljs-keyword">import</span> &#123; defineProps &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;vue&#x27;</span></span></span><br><span class="language-javascript"><span class="language-xml"><span class="hljs-title function_">defineProps</span>(&#123;</span></span><br><span class="language-javascript"><span class="language-xml">  <span class="hljs-attr">index</span>: &#123;</span></span><br><span class="language-javascript"><span class="language-xml">    <span class="hljs-attr">type</span>: <span class="hljs-title class_">Number</span>,</span></span><br><span class="language-javascript"><span class="language-xml">    <span class="hljs-attr">required</span>: <span class="hljs-literal">true</span></span></span><br><span class="language-javascript"><span class="language-xml">  &#125;</span></span><br><span class="language-javascript"><span class="language-xml">&#125;)</span></span><br><span class="language-javascript"><span class="language-xml"></span></span><br><span class="language-javascript"><span class="language-xml"><span class="hljs-keyword">const</span> <span class="hljs-title function_">onRefreshClick</span> = (<span class="hljs-params"></span>) =&gt; &#123;&#125;</span></span><br><span class="language-javascript"><span class="language-xml"></span></span><br><span class="language-javascript"><span class="language-xml"><span class="hljs-keyword">const</span> <span class="hljs-title function_">onCloseRightClick</span> = (<span class="hljs-params"></span>) =&gt; &#123;&#125;</span></span><br><span class="language-javascript"><span class="language-xml"></span></span><br><span class="language-javascript"><span class="language-xml"><span class="hljs-keyword">const</span> <span class="hljs-title function_">onCloseOtherClick</span> = (<span class="hljs-params"></span>) =&gt; &#123;&#125;</span></span><br><span class="language-javascript"><span class="language-xml"></span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span></span><br><br><span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">style</span> <span class="hljs-attr">lang</span>=<span class="hljs-string">&quot;scss&quot;</span> <span class="hljs-attr">scoped</span>&gt;</span><span class="language-css"></span></span><br><span class="language-css"><span class="language-xml"><span class="hljs-selector-class">.context-menu-container</span> &#123;</span></span><br><span class="language-css"><span class="language-xml">  <span class="hljs-attribute">position</span>: fixed;</span></span><br><span class="language-css"><span class="language-xml">  <span class="hljs-attribute">background</span>: <span class="hljs-number">#fff</span>;</span></span><br><span class="language-css"><span class="language-xml">  <span class="hljs-attribute">z-index</span>: <span class="hljs-number">3000</span>;</span></span><br><span class="language-css"><span class="language-xml">  <span class="hljs-attribute">list-style-type</span>: none;</span></span><br><span class="language-css"><span class="language-xml">  <span class="hljs-attribute">padding</span>: <span class="hljs-number">5px</span> <span class="hljs-number">0</span>;</span></span><br><span class="language-css"><span class="language-xml">  <span class="hljs-attribute">border-radius</span>: <span class="hljs-number">4px</span>;</span></span><br><span class="language-css"><span class="language-xml">  <span class="hljs-attribute">font-size</span>: <span class="hljs-number">12px</span>;</span></span><br><span class="language-css"><span class="language-xml">  <span class="hljs-attribute">font-weight</span>: <span class="hljs-number">400</span>;</span></span><br><span class="language-css"><span class="language-xml">  <span class="hljs-attribute">color</span>: <span class="hljs-number">#333</span>;</span></span><br><span class="language-css"><span class="language-xml">  <span class="hljs-attribute">box-shadow</span>: <span class="hljs-number">2px</span> <span class="hljs-number">2px</span> <span class="hljs-number">3px</span> <span class="hljs-number">0</span> <span class="hljs-built_in">rgba</span>(<span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0.3</span>);</span></span><br><span class="language-css"><span class="language-xml">  <span class="hljs-selector-tag">li</span> &#123;</span></span><br><span class="language-css"><span class="language-xml">    <span class="hljs-attribute">margin</span>: <span class="hljs-number">0</span>;</span></span><br><span class="language-css"><span class="language-xml">    <span class="hljs-attribute">padding</span>: <span class="hljs-number">7px</span> <span class="hljs-number">16px</span>;</span></span><br><span class="language-css"><span class="language-xml">    <span class="hljs-attribute">cursor</span>: pointer;</span></span><br><span class="language-css"><span class="language-xml">    &amp;<span class="hljs-selector-pseudo">:hover</span> &#123;</span></span><br><span class="language-css"><span class="language-xml">      <span class="hljs-attribute">background</span>: <span class="hljs-number">#eee</span>;</span></span><br><span class="language-css"><span class="language-xml">    &#125;</span></span><br><span class="language-css"><span class="language-xml">  &#125;</span></span><br><span class="language-css"><span class="language-xml">&#125;</span></span><br><span class="language-css"><span class="language-xml"></span><span class="hljs-tag">&lt;/<span class="hljs-name">style</span>&gt;</span></span><br><br></code></pre></td></tr></table></figure>
</li>
<li><p>在 <code>tagsview</code> 中控制 <code>contextMenu</code> 的展示</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><code class="hljs js">&lt;template&gt;<br>  <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;tags-view-container&quot;</span>&gt;</span></span><br><span class="language-xml">    <span class="hljs-tag">&lt;<span class="hljs-name">el-scrollbar</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;tags-view-wrapper&quot;</span>&gt;</span></span><br><span class="language-xml">      <span class="hljs-tag">&lt;<span class="hljs-name">router-link</span></span></span><br><span class="hljs-tag"><span class="language-xml">        <span class="hljs-attr">...</span></span></span><br><span class="hljs-tag"><span class="language-xml">        @<span class="hljs-attr">contextmenu.prevent</span>=<span class="hljs-string">&quot;openMenu($event, index)&quot;</span></span></span><br><span class="hljs-tag"><span class="language-xml">      &gt;</span></span><br><span class="language-xml">        ...</span><br><span class="language-xml">    <span class="hljs-tag">&lt;/<span class="hljs-name">el-scrollbar</span>&gt;</span></span><br><span class="language-xml">    <span class="hljs-tag">&lt;<span class="hljs-name">context-menu</span></span></span><br><span class="hljs-tag"><span class="language-xml">      <span class="hljs-attr">v-show</span>=<span class="hljs-string">&quot;visible&quot;</span></span></span><br><span class="hljs-tag"><span class="language-xml">      <span class="hljs-attr">:style</span>=<span class="hljs-string">&quot;menuStyle&quot;</span></span></span><br><span class="hljs-tag"><span class="language-xml">      <span class="hljs-attr">:index</span>=<span class="hljs-string">&quot;selectIndex&quot;</span></span></span><br><span class="hljs-tag"><span class="language-xml">    &gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">context-menu</span>&gt;</span></span><br><span class="language-xml">  <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span><br><span class="language-xml"><span class="hljs-tag">&lt;/<span class="hljs-name">template</span>&gt;</span></span><br><br><span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">setup</span>&gt;</span><span class="language-javascript"></span></span><br><span class="language-javascript"><span class="language-xml"><span class="hljs-keyword">import</span> <span class="hljs-title class_">ContextMenu</span> <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;./ContextMenu.vue&#x27;</span></span></span><br><span class="language-javascript"><span class="language-xml"><span class="hljs-keyword">import</span> &#123; ref, reactive, watch &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;vue&#x27;</span></span></span><br><span class="language-javascript"><span class="language-xml"><span class="hljs-keyword">import</span> &#123; useRoute &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;vue-router&#x27;</span></span></span><br><span class="language-javascript"><span class="language-xml">...</span></span><br><span class="language-javascript"><span class="language-xml"></span></span><br><span class="language-javascript"><span class="language-xml"><span class="hljs-comment">// contextMenu 相关</span></span></span><br><span class="language-javascript"><span class="language-xml"><span class="hljs-keyword">const</span> selectIndex = <span class="hljs-title function_">ref</span>(<span class="hljs-number">0</span>)</span></span><br><span class="language-javascript"><span class="language-xml"><span class="hljs-keyword">const</span> visible = <span class="hljs-title function_">ref</span>(<span class="hljs-literal">false</span>)</span></span><br><span class="language-javascript"><span class="language-xml"><span class="hljs-keyword">const</span> menuStyle = <span class="hljs-title function_">reactive</span>(&#123;</span></span><br><span class="language-javascript"><span class="language-xml">  <span class="hljs-attr">left</span>: <span class="hljs-number">0</span>,</span></span><br><span class="language-javascript"><span class="language-xml">  <span class="hljs-attr">top</span>: <span class="hljs-number">0</span></span></span><br><span class="language-javascript"><span class="language-xml">&#125;)</span></span><br><span class="language-javascript"><span class="language-xml"><span class="hljs-comment">/**</span></span></span><br><span class="hljs-comment"><span class="language-javascript"><span class="language-xml"> * 展示 menu</span></span></span><br><span class="hljs-comment"><span class="language-javascript"><span class="language-xml"> */</span></span></span><br><span class="language-javascript"><span class="language-xml"><span class="hljs-keyword">const</span> <span class="hljs-title function_">openMenu</span> = (<span class="hljs-params">e, index</span>) =&gt; &#123;</span></span><br><span class="language-javascript"><span class="language-xml">  <span class="hljs-keyword">const</span> &#123; x, y &#125; = e</span></span><br><span class="language-javascript"><span class="language-xml">  menuStyle.<span class="hljs-property">left</span> = x + <span class="hljs-string">&#x27;px&#x27;</span></span></span><br><span class="language-javascript"><span class="language-xml">  menuStyle.<span class="hljs-property">top</span> = y + <span class="hljs-string">&#x27;px&#x27;</span></span></span><br><span class="language-javascript"><span class="language-xml">  selectIndex.<span class="hljs-property">value</span> = index</span></span><br><span class="language-javascript"><span class="language-xml">  visible.<span class="hljs-property">value</span> = <span class="hljs-literal">true</span></span></span><br><span class="language-javascript"><span class="language-xml">&#125;</span></span><br><span class="language-javascript"><span class="language-xml"></span></span><br><span class="language-javascript"><span class="language-xml"></span></span><br><span class="language-javascript"><span class="language-xml"></span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span></span><br></code></pre></td></tr></table></figure>



</li>
</ol>
<h2 id="contextMenu-事件处理"><a href="#contextMenu-事件处理" class="headerlink" title="contextMenu 事件处理"></a>contextMenu 事件处理</h2><p>对于 <code>contextMenu</code> 的事件一共分为三个：</p>
<ol>
<li>刷新</li>
<li>关闭右侧</li>
<li>关闭所有</li>
</ol>
<p>但是不要忘记，我们之前 <strong>关闭单个 <code>tags</code></strong> 的事件还没有进行处理，所以这一小节我们一共需要处理 4 个对应的事件</p>
<ol>
<li><p>刷新事件</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">const</span> router = <span class="hljs-title function_">useRouter</span>()<br><span class="hljs-keyword">const</span> <span class="hljs-title function_">onRefreshClick</span> = (<span class="hljs-params"></span>) =&gt; &#123;<br>  router.<span class="hljs-title function_">go</span>(<span class="hljs-number">0</span>)<br>&#125;<br></code></pre></td></tr></table></figure>
</li>
<li><p>在 <code>store/app</code> 中，创建删除 <code>tags</code> 的 <code>mutations</code>，该 <code>mutations</code> 需要同时具备以下三个能力：</p>
<ol>
<li>删除 “右侧”</li>
<li>删除 “其他”</li>
<li>删除 “当前”</li>
</ol>
</li>
<li><p>根据以上理论得出以下代码：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-comment">/**</span><br><span class="hljs-comment">* 删除 tag</span><br><span class="hljs-comment">* <span class="hljs-doctag">@param</span> &#123;<span class="hljs-type">type: &#x27;other&#x27;||&#x27;right&#x27;||&#x27;index&#x27;, index: index</span>&#125; <span class="hljs-variable">payload</span></span><br><span class="hljs-comment">*/</span><br><span class="hljs-title function_">removeTagsView</span>(<span class="hljs-params">state, payload</span>) &#123;<br>  <span class="hljs-keyword">if</span> (payload.<span class="hljs-property">type</span> === <span class="hljs-string">&#x27;index&#x27;</span>) &#123;<br>    state.<span class="hljs-property">tagsViewList</span>.<span class="hljs-title function_">splice</span>(payload.<span class="hljs-property">index</span>, <span class="hljs-number">1</span>)<br>    <span class="hljs-keyword">return</span><br>  &#125; <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (payload.<span class="hljs-property">type</span> === <span class="hljs-string">&#x27;other&#x27;</span>) &#123;<br>    state.<span class="hljs-property">tagsViewList</span>.<span class="hljs-title function_">splice</span>(<br>      payload.<span class="hljs-property">index</span> + <span class="hljs-number">1</span>,<br>      state.<span class="hljs-property">tagsViewList</span>.<span class="hljs-property">length</span> - payload.<span class="hljs-property">index</span> + <span class="hljs-number">1</span><br>    )<br>    state.<span class="hljs-property">tagsViewList</span>.<span class="hljs-title function_">splice</span>(<span class="hljs-number">0</span>, payload.<span class="hljs-property">index</span>)<br>  &#125; <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (payload.<span class="hljs-property">type</span> === <span class="hljs-string">&#x27;right&#x27;</span>) &#123;<br>    state.<span class="hljs-property">tagsViewList</span>.<span class="hljs-title function_">splice</span>(<br>      payload.<span class="hljs-property">index</span> + <span class="hljs-number">1</span>,<br>      state.<span class="hljs-property">tagsViewList</span>.<span class="hljs-property">length</span> - payload.<span class="hljs-property">index</span> + <span class="hljs-number">1</span><br>    )<br>  &#125;<br>  <span class="hljs-title function_">setItem</span>(<span class="hljs-variable constant_">TAGS_VIEW</span>, state.<span class="hljs-property">tagsViewList</span>)<br>&#125;,<br></code></pre></td></tr></table></figure>
</li>
<li><p>关闭右侧事件</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">const</span> store = <span class="hljs-title function_">useStore</span>()<br><span class="hljs-keyword">const</span> <span class="hljs-title function_">onCloseRightClick</span> = (<span class="hljs-params"></span>) =&gt; &#123;<br>  store.<span class="hljs-title function_">commit</span>(<span class="hljs-string">&#x27;app/removeTagsView&#x27;</span>, &#123;<br>    <span class="hljs-attr">type</span>: <span class="hljs-string">&#x27;right&#x27;</span>,<br>    <span class="hljs-attr">index</span>: props.<span class="hljs-property">index</span><br>  &#125;)<br>&#125;<br></code></pre></td></tr></table></figure>
</li>
<li><p>关闭其他</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">const</span> <span class="hljs-title function_">onCloseOtherClick</span> = (<span class="hljs-params"></span>) =&gt; &#123;<br>  store.<span class="hljs-title function_">commit</span>(<span class="hljs-string">&#x27;app/removeTagsView&#x27;</span>, &#123;<br>    <span class="hljs-attr">type</span>: <span class="hljs-string">&#x27;other&#x27;</span>,<br>    <span class="hljs-attr">index</span>: props.<span class="hljs-property">index</span><br>  &#125;)<br>&#125;<br></code></pre></td></tr></table></figure>
</li>
<li><p>关闭当前（<code>tagsview</code>）</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * 关闭 tag 的点击事件</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">const</span> store = <span class="hljs-title function_">useStore</span>()<br><span class="hljs-keyword">const</span> <span class="hljs-title function_">onCloseClick</span> = index =&gt; &#123;<br>  store.<span class="hljs-title function_">commit</span>(<span class="hljs-string">&#x27;app/removeTagsView&#x27;</span>, &#123;<br>    <span class="hljs-attr">type</span>: <span class="hljs-string">&#x27;index&#x27;</span>,<br>    <span class="hljs-attr">index</span>: index<br>  &#125;)<br>&#125;<br></code></pre></td></tr></table></figure>



</li>
</ol>
<h2 id="处理-contextMenu-的关闭行为"><a href="#处理-contextMenu-的关闭行为" class="headerlink" title="处理 contextMenu 的关闭行为"></a>处理 contextMenu 的关闭行为</h2><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * 关闭 menu</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">const</span> <span class="hljs-title function_">closeMenu</span> = (<span class="hljs-params"></span>) =&gt; &#123;<br>  visible.<span class="hljs-property">value</span> = <span class="hljs-literal">false</span><br>&#125;<br><br><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * 监听变化</span><br><span class="hljs-comment"> */</span><br><span class="hljs-title function_">watch</span>(visible, <span class="hljs-function"><span class="hljs-params">val</span> =&gt;</span> &#123;<br>  <span class="hljs-keyword">if</span> (val) &#123;<br>    <span class="hljs-variable language_">document</span>.<span class="hljs-property">body</span>.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">&#x27;click&#x27;</span>, closeMenu)<br>  &#125; <span class="hljs-keyword">else</span> &#123;<br>    <span class="hljs-variable language_">document</span>.<span class="hljs-property">body</span>.<span class="hljs-title function_">removeEventListener</span>(<span class="hljs-string">&#x27;click&#x27;</span>, closeMenu)<br>  &#125;<br>&#125;)<br></code></pre></td></tr></table></figure>


<h2 id="处理基于路由的动态过渡"><a href="#处理基于路由的动态过渡" class="headerlink" title="处理基于路由的动态过渡"></a>处理基于路由的动态过渡</h2><p><a target="_blank" rel="noopener" href="https://next.router.vuejs.org/zh/guide/advanced/transitions.html#%E5%9F%BA%E4%BA%8E%E8%B7%AF%E7%94%B1%E7%9A%84%E5%8A%A8%E6%80%81%E8%BF%87%E6%B8%A1">处理基于路由的动态过渡</a>  官方已经给出了示例代码，结合 <code>router-view</code> 和 <code>transition</code> 我们可以非常方便的实现这个功能</p>
<ol>
<li><p>在 <code>appmain</code> 中处理对应代码逻辑</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs js">&lt;template&gt;<br>  <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;app-main&quot;</span>&gt;</span></span><br><span class="language-xml">    <span class="hljs-tag">&lt;<span class="hljs-name">router-view</span> <span class="hljs-attr">v-slot</span>=<span class="hljs-string">&quot;&#123; Component, route &#125;&quot;</span>&gt;</span></span><br><span class="language-xml">      <span class="hljs-tag">&lt;<span class="hljs-name">transition</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;fade-transform&quot;</span> <span class="hljs-attr">mode</span>=<span class="hljs-string">&quot;out-in&quot;</span>&gt;</span></span><br><span class="language-xml">        <span class="hljs-tag">&lt;<span class="hljs-name">keep-alive</span>&gt;</span></span><br><span class="language-xml">          <span class="hljs-tag">&lt;<span class="hljs-name">component</span> <span class="hljs-attr">:is</span>=<span class="hljs-string">&quot;Component&quot;</span> <span class="hljs-attr">:key</span>=<span class="hljs-string">&quot;route.path&quot;</span> /&gt;</span></span><br><span class="language-xml">        <span class="hljs-tag">&lt;/<span class="hljs-name">keep-alive</span>&gt;</span></span><br><span class="language-xml">      <span class="hljs-tag">&lt;/<span class="hljs-name">transition</span>&gt;</span></span><br><span class="language-xml">    <span class="hljs-tag">&lt;/<span class="hljs-name">router-view</span>&gt;</span></span><br><span class="language-xml">  <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span><br>&lt;/template&gt;<br></code></pre></td></tr></table></figure>
</li>
<li><p>增加了 <code>tags</code> 之后，<code>app-main</code> 的位置需要进行以下处理</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs js">&lt;style lang=<span class="hljs-string">&quot;scss&quot;</span> scoped&gt;<br>.<span class="hljs-property">app</span>-main &#123;<br>  min-<span class="hljs-attr">height</span>: <span class="hljs-title function_">calc</span>(100vh - 50px - 43px);<br>  ...<br>  <span class="hljs-attr">padding</span>: 104px 20px 20px 20px;<br>  ...<br>&#125;<br>&lt;/style&gt;<br></code></pre></td></tr></table></figure>
</li>
<li><p>在 <code>styles/transition</code> 中增加动画渲染</p>
<figure class="highlight scss"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs scss"><span class="hljs-comment">/* fade-transform */</span><br><span class="hljs-selector-class">.fade-transform-leave-active</span>,<br><span class="hljs-selector-class">.fade-transform-enter-active</span> &#123;<br>  <span class="hljs-attribute">transition</span>: all <span class="hljs-number">0.5s</span>;<br>&#125;<br><br><span class="hljs-selector-class">.fade-transform-enter-from</span> &#123;<br>  <span class="hljs-attribute">opacity</span>: <span class="hljs-number">0</span>;<br>  <span class="hljs-attribute">transform</span>: translateX(-<span class="hljs-number">30px</span>);<br>&#125;<br><br><span class="hljs-selector-class">.fade-transform-leave-to</span> &#123;<br>  <span class="hljs-attribute">opacity</span>: <span class="hljs-number">0</span>;<br>  <span class="hljs-attribute">transform</span>: translateX(<span class="hljs-number">30px</span>);<br>&#125;<br></code></pre></td></tr></table></figure>



</li>
</ol>
<h2 id="tagsView-方案总结"><a href="#tagsView-方案总结" class="headerlink" title="tagsView 方案总结"></a>tagsView 方案总结</h2><p>那么到这里关于 <code>tagsView</code> 的内容我们就已经处理完成了。</p>
<p>整个 <code>tagsView</code> 就像我们之前说的，拆开来看之后，会显得明确很多。</p>
<p>整个 <code>tagsView</code> 整体来看就是三块大的内容：</p>
<ol>
<li><code>tags</code>：<code>tagsView</code> 组件</li>
<li><code>contextMenu</code>：<code>contextMenu</code> 组件</li>
<li><code>view</code>：<code>appmain</code> 组件</li>
</ol>
<p>再加上一部分的数据处理即可。</p>
<p>最后关于 <code>tags</code> 的国际化部分，其实处理的方案有非常多，大家也可以在后面的 <strong>讨论题</strong> 中探讨一下关于 <strong>此处国家化</strong> 的实现，相信会有很多新的思路被打开的。</p>

            </div>
            <hr>
            <div>
              <div class="post-metas mb-3">
                
                
                  <div class="post-meta">
                    <i class="iconfont icon-tags"></i>
                    
                      <a class="hover-with-bg" href="/tags/%E5%B7%A5%E7%A8%8B%E5%8C%96-Vue3-%E9%80%9A%E7%94%A8%E5%8A%9F%E8%83%BD/">工程化,Vue3,通用功能</a>
                    
                  </div>
                
              </div>
              
                <p class="note note-warning">
                  
                    本博客所有文章除特别声明外，均采用 <a target="_blank" href="https://creativecommons.org/licenses/by-sa/4.0/deed.zh" rel="nofollow noopener noopener">CC BY-SA 4.0 协议</a> ，转载请注明出处！
                  
                </p>
              
              
                <div class="post-prevnext">
                  <article class="post-prev col-6">
                    
                    
                      <a href="/post/micro-qiankun.html">
                        <i class="iconfont icon-arrowleft"></i>
                        <span class="hidden-mobile">微前端-qiankun</span>
                        <span class="visible-mobile">上一篇</span>
                      </a>
                    
                  </article>
                  <article class="post-next col-6">
                    
                    
                      <a href="/post/vue3-project-generalModule.html">
                        <span class="hidden-mobile">Vue3项目实战(五)：通用功能开发（一）</span>
                        <span class="visible-mobile">下一篇</span>
                        <i class="iconfont icon-arrowright"></i>
                      </a>
                    
                  </article>
                </div>
              
            </div>

            
              <!-- Comments -->
              <article class="comments" id="comments" lazyload>
                
                  
                
                
  <div class="disqus" style="width:100%">
    <div id="disqus_thread"></div>
    
      <script type="text/javascript">
        var disqus_config = function() {
          this.page.url = 'http://yoursite.com/post/vue3-project-generalModule2.html';
          this.page.identifier = '/post/vue3-project-generalModule2.html';
        };
        Fluid.utils.loadComments('#disqus_thread', function() {
          var d = document, s = d.createElement('script');
          s.src = '//' + 'helloalexcc' + '.disqus.com/embed.js';
          s.setAttribute('data-timestamp', new Date());
          (d.head || d.body).appendChild(s);
        });
      </script>
    
    <noscript>Please enable JavaScript to view the comments</noscript>
  </div>


              </article>
            
          </article>
        </div>
      </div>
    </div>
    
      <div class="d-none d-lg-block col-lg-2 toc-container" id="toc-ctn">
        <div id="toc">
  <p class="toc-header"><i class="iconfont icon-list"></i>&nbsp;目录</p>
  <div class="toc-body" id="toc-body"></div>
</div>

      </div>
    
  </div>
</div>

<!-- Custom -->


    

    
      <a id="scroll-top-button" aria-label="TOP" href="#" role="button">
        <i class="iconfont icon-arrowup" aria-hidden="true"></i>
      </a>
    

    
      <div class="modal fade" id="modalSearch" tabindex="-1" role="dialog" aria-labelledby="ModalLabel"
     aria-hidden="true">
  <div class="modal-dialog modal-dialog-scrollable modal-lg" role="document">
    <div class="modal-content">
      <div class="modal-header text-center">
        <h4 class="modal-title w-100 font-weight-bold">搜索</h4>
        <button type="button" id="local-search-close" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body mx-3">
        <div class="md-form mb-5">
          <input type="text" id="local-search-input" class="form-control validate">
          <label data-error="x" data-success="v"
                 for="local-search-input">关键词</label>
        </div>
        <div class="list-group" id="local-search-result"></div>
      </div>
    </div>
  </div>
</div>
    

    
  </main>

  <footer class="text-center mt-5 py-3">
  <div class="footer-content">
     <a href="https://hello-alex-cheng.github.io/" target="_blank" rel="nofollow noopener"><span>I</span></a> <i class="iconfont icon-love"></i> <a href="https://hello-alex-cheng.github.io/" target="_blank" rel="nofollow noopener"><span>YOU</span></a> 
  </div>
  

  

  
</footer>


  <!-- SCRIPTS -->
  
  <script  src="https://cdn.jsdelivr.net/npm/nprogress@0/nprogress.min.js" ></script>
  <link  rel="stylesheet" href="https://cdn.jsdelivr.net/npm/nprogress@0/nprogress.min.css" />

  <script>
    NProgress.configure({"showSpinner":false,"trickleSpeed":100})
    NProgress.start()
    window.addEventListener('load', function() {
      NProgress.done();
    })
  </script>


<script  src="https://cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js" ></script>
<script  src="https://cdn.jsdelivr.net/npm/bootstrap@4/dist/js/bootstrap.min.js" ></script>
<script  src="/js/events.js" ></script>
<script  src="/js/plugins.js" ></script>

<!-- Plugins -->


  <script  src="/js/local-search.js" ></script>



  
    <script  src="/js/img-lazyload.js" ></script>
  



  



  
    <script  src="https://cdn.jsdelivr.net/npm/tocbot@4/dist/tocbot.min.js" ></script>
  
  
    <script  src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3/dist/jquery.fancybox.min.js" ></script>
  
  
    <script  src="https://cdn.jsdelivr.net/npm/anchor-js@4/anchor.min.js" ></script>
  
  
    <script defer src="https://cdn.jsdelivr.net/npm/clipboard@2/dist/clipboard.min.js" ></script>
  






  <script  src="https://cdn.jsdelivr.net/npm/typed.js@2/lib/typed.min.js" ></script>
  <script>
    (function (window, document) {
      var typing = Fluid.plugins.typing;
      var title = document.getElementById('subtitle').title;
      
        typing(title);
      
    })(window, document);
  </script>















<!-- 主题的启动项 保持在最底部 -->
<script  src="/js/boot.js" ></script>


</body>
</html>
